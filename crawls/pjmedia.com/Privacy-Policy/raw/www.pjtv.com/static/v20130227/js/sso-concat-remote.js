PJTV=(function(){function b(){$("body").on("click",".truncated-text .show-full-text, .truncated-text .show-shortened-text",function(g){var e=$(this).closest(".truncated-text"),h=e.find(".shortend-text"),f=e.find(".full-text");h.toggle();f.toggle();g.preventDefault();g.stopPropagation()});$("body").on("click",".thumb-rating.votable .thumb-button",function(h){var i={},e=$(this),g=e.data("count"),j=e.find(".thumb-count").text();i.cmd="thumb-rating";i.ajax=true;i["video-id"]=e.closest(".thumb-rating").data("video-id");i["media-type-id"]=e.closest(".thumb-rating").data("media-type-id");i["thumbs-up"]=e.data("up");function f(k){$(".thumb-rating-message").html(k);$(".thumb-rating-message").show().delay(10000).fadeOut("fast")}$.get("/",i,function(k){if(k.success){if(j.indexOf("k")===-1){e.find(".thumb-count").text(parseInt(g+1))}f(k.message);if(e.data("up")){e.toggleClass("share-widget-thumbs-up-voted share-widget-thumbs-up");e.closest(".thumb-rating").toggleClass("votable");e.closest(".thumb-rating").find(".share-widget-thumbs-down").toggleClass("share-widget-thumbs-down share-widget-thumbs-down-fixed")}else{e.toggleClass("share-widget-thumbs-down-voted share-widget-thumbs-down");e.closest(".thumb-rating").toggleClass("votable");e.closest(".thumb-rating").find(".share-widget-thumbs-up").toggleClass("share-widget-thumbs-up share-widget-thumbs-up-fixed")}}else{if(k.loggedIn===false){$(".thumb-rating-message").show();$(".thumb-rating-no-user-message").show()}else{f(k.message)}}});h.stopPropagation();h.preventDefault()});$("body").on("click",".share-widget-show-url",function(e){var g=$(this).closest("#shareBarForVideo, .flash-snippet-share-widget, #ach-referral"),f=g.find($(".url-copy-div"));f.toggle();e.stopPropagation();e.preventDefault()})}function a(e){var f={};_.each(e.split(";"),function(h){var g=h.split(":");if(g.length===2){f[g[0]]=g[1]}});return f}function c(){var e=$(".hoverstyle");e.removeClass("hoverstyle");$.each(e,function(){var f=$(this),g=a(f.data("mouseenter")),h=a(f.data("mouseleave"));f.mouseenter(function(){f.css(g)});f.mouseleave(function(){f.css(h)})})}function d(){jQuery.extend({postJSON:function(e,f,g){return jQuery.post(e,f,g,"json")}});b();PJTV.SearchOverlay.init()}$(document).ready(function(){c()});return{init:d}}());
PJTV.SingleSignOn=(function(I,w,z){try{if(jQuerySSO){w=jQuerySSO}}catch(H){}var A={},r="pjdialog",k="pjdialog-iframe",F="pjdialog-close",d="pjdialog-clickshield",E="#"+r,i="#"+k,a="#"+F,G="#"+d,p=false,B="sso-link",u=-1,f=0,y=1,b=2,v=3,s=4,o=2;function K(){w("video").each(function(){var e=w(this);if(e.data("controlsTemporarilyDisabled")){e.data("controlsTemporarilyDisabled",false);e.attr("controls",e.data("oldControlsValue"))}})}function c(){w("video").each(function(){var e=w(this);if(e.attr("controls")){e.data("oldControlsValue",e.attr("controls"));e.attr("controls",false);e.data("controlsTemporarilyDisabled",true)}})}function h(){return(window.location!==window.parent.location)}function J(){if(q()){top.videoDivWidths={};top.videoDivHeights={};w("video").each(function(M,N){var O=w(N).attr("id");var e=O.replace("Object","");top.videoDivWidths[e]=w("#"+e).css("width");top.videoDivHeights[e]=w("#"+e).css("height");w("#"+e).css("width",w(N).attr("width"));w("#"+e).css("height",w(N).attr("height"));w(N).css("display","none")})}}function j(){if(q()){w("video").each(function(M,N){var O=w(N).attr("id");var e=O.replace("Object","");w("#"+e).css("width",top.videoDivWidths[e]);w("#"+e).css("height",top.videoDivHeights[e]);w(N).css("display","block")})}}A.openDialog=function(O,S,M){var U=this.getVideoPlayer(),P,N,Q,V;c();w("body").append('<div id="'+r+'"></div><div id="'+F+'"></div><div id="'+d+'">&nbsp;</div>');if(!S){try{if(ReferUrlContext){S=ReferUrlContext.getUrl()}}catch(T){}}if(!S||S==null||S==""){S=top.location.toString()}if(S!=null&&S!=""){O+="&ssor="+escape(S)}S=C(S);var R="&start-videos=";try{if(U!=null&&U.isPlaying()){R+=U.getClip().videoID;P=U.getTime();if(typeof(P)==="object"){P=0}R+=":"+P;R+=","}}catch(T){}w("video").each(function(W,X){try{if(!X.paused&&!X.ended&&X.currentTime>0){R+=w(X).attr("data-video-id");R+=":"+X.currentTime;R+=","}}catch(Y){}});O+=R;p=true;this.pauseVideoPlayers();J();N='style="visibility:hidden;"';if(w.browser.mozilla){N=""}Q='<iframe allowtransparency="true" '+N+' onload="this.style.visibility =\'visible\';PJTV.SingleSignOn.showCloseButton();" scrolling="no" name="'+k+'" id="'+k+'" src="'+O+'" frameborder="0" scrollbars="no"></iframe>';V=w(E);V.html(Q);V.removeClass();V.addClass("pjdialog");if(O.indexOf("profile")>-1||O.indexOf("show-account")>-1||O.indexOf("confirm-email-verification")>-1){V.addClass("pjdialog-profile")}w(window).resize(function(e){if(!q()){I.SingleSignOn.positionDialog();I.SingleSignOn.showCloseButton()}});w(G).show();V.show();I.SingleSignOn.positionDialog();if(O.indexOf("cmd=logout")<0){w("body").on("click",a,function(){I.SingleSignOn.closeDialog(M,C(top.location.toString()))});w(G).on("click",function(){I.SingleSignOn.closeDialog(M,C(top.location.toString()))})}};A.showCloseButton=function(){w(a).show()};A.getVideoPlayer=function(){var N=null;try{N=$f()}catch(M){}return N};A.positionDialog=function(){var S=w(a).height()/2,O=0,T=w(G),U=w(E),N=w(a),Q,P,R,M,e;Q=(w(window).width()/2)-(U.outerWidth()/2);P=(w(window).height()/2)-(U.outerHeight()/2)+(w(window).scrollTop());if(Q<O){Q=O}if(P<S){P=S}R=w(document).width();if(w.browser.msie&&w.browser.version>=8){R=Math.max(document.documentElement.clientWidth,document.documentElement.scrollWidth,document.body.scrollWidth)}T.css("width",R);T.css("height",w(document).height());U.css("top",P);U.css("left",Q);M=Q+U.width();e=P-(N.height()/2);M=M-50;e=e+28;N.hide();N.css("top",e);N.css("left",M)};A.closeDialog=function(e,M){w(G).remove();w(a).remove();if(e){if(!M){M=top.location}if(M.indexOf("#")>0){M=M.split("#");M=M[0]}I.SingleSignOn.reload(M,"_top",true);return}w(E).remove();K();p=false;j();this.unPauseVideoPlayers()};A.gotoAfter=function(M,e){setTimeout("location = '"+M+"'",e)};A.reload=function(P,O,M){if(h()||M){if(!O||O==null){O="_top"}try{w(E).html("",window.parent);if(P&&P!=null&&P!=""){if(O=="_self"){setTimeout("location='"+P+"';",20)}else{setTimeout("top.location='"+P+"';",20)}}else{setTimeout("top.location.reload();",20)}}catch(N){}}};A.isLoggedIn=function(){return(m("pjtv-logged-in")==1)};A.openDialogIfNecessary=function(e,N,M){if(A.isLoggedIn()){location=N}else{A.openDialog(e,N,M)}};function m(O){var P=document.cookie.split(";");for(var M=0;M<P.length;M++){var e=P[M].substr(0,P[M].indexOf("="));var N=P[M].substr(P[M].indexOf("=")+1);e=e.replace(/^\s+|\s+$/g,"");if(e==O){return unescape(N)}}}function L(Q){var U=w(Q),e=U.attr("id"),S=10,P=4,V,M,T,N,O,R;if(U.attr("data-instruction")){w("body").append('<div class="tooltip" id="tooltip'+e+'"></div>');w("#tooltip"+e).html(U.attr("data-instruction"));V=parseInt(w("#tooltip"+e).css("height"),10);M=parseInt(w("#tooltip"+e).css("width"),10);T=parseInt(U.offset().top,10)-V-P;N=parseInt(U.offset().left,10);O=parseInt(w("body").css("height"),10);R=parseInt(w("body").css("width"),10);while((N+M+S)>R){N-=1}w("#tooltip"+e).css("top",T+"px");w("#tooltip"+e).css("left",N+"px");w("#tooltip"+e).show()}}function C(e){e=e.replace(/\?show-account=true.*/g,"");e=e.replace("&show-account=true","");e=e.replace("?cmd=confirm-email-verification","");return e}function D(){w(".tooltip").each(function(){w(this).html("").hide()})}function n(M){var N=w(M).attr("id"),e=w("#tooltip"+N);e.html("");e.hide()}function g(){w("body .text").each(function(){var N,M,e=w(this);if(e.attr("data-cover-id")){N="#"+e.attr("data-cover-id");M=w(N);e.attr("placeholder",M.val());e.attr("holder",e.attr("data-default-value"));e.show();M.remove()}else{if(e.attr("data-default-value")){e.attr("placeholder",e.attr("data-default-value"));e.attr("holder",e.attr("data-default-value"));e.removeAttr("data-default-value")}}});w("body").on("change","select.text",function(){var e=w(this);if(e.attr("holder")&&e.val()===e.attr("holder")){e.css("color","#8ca4af")}else{e.css("color","#000000")}w("select.text option").css("color","black")});w("body select.text").each(function(){w(this).trigger("change")});w("body").on("focus",".text",function(){var e=w(this);if(e.attr("placeholder")){e.attr("holder",e.attr("placeholder"));e.removeAttr("placeholder")}});w("body").on("blur",".text",function(){var e=w(this);if(e.attr("holder")){e.attr("placeholder",e.attr("holder"));e.removeAttr("holder")}})}function l(){w("body .text").each(function(){var e=w(this);if(!e.attr("data-default-value")&&!e.attr("data-cover-id")){return}if(e.val()===e.attr("data-default-value")||e.val()===""){e.css("color","#8ca4af");e.val(e.attr("data-default-value"))}});w(".password-cover").each(function(){var e=w(this);e.attr("data-default-value",e.val())});w(":password").each(function(){var e=w(this),O,N;if(e.attr("data-cover-id")&&e.attr("data-error")=="true"){O="#"+w(this).attr("data-cover-id");N=w(O);N.addClass("errored");N.attr("data-instruction",e.attr("data-instruction"))}});try{w("body").on("focus",".password-cover",function(){var P=w(this).attr("id").toString(),N="#"+P.replace("-cover",""),O=w(this),e=w(N);O.hide();e.css("color","#000000");e.focus();e.show();setTimeout(function(){w(N).focus()},10)});w("body").on("focus",".text",function(){var e=w(this),N;if(!e.attr("data-default-value")&&!e.attr("data-cover-id")){return}if(e.val()===e.attr("data-default-value")){e.css("color","#000000");e.val("")}if(e.attr("data-cover-id")){N="#"+e.attr("data-cover-id");w(N).css("color","#000000")}});w("body").on("blur",".text",function(){var e=w(this),O,N;if(e.attr("data-cover-id")){if(e.val()===w(this).attr("data-default-value")||e.val()===""){O="#"+w(this).attr("data-cover-id");N=w(O);e.css("color","#8ca4af");N.css("color","#8ca4af");N.val(w(O).attr("data-default-value"));e.hide();N.show()}}else{if(e.val()===""||e.val()===e.attr("data-default-value")){e.css("color","#8ca4af");e.val(e.attr("data-default-value"))}}})}catch(M){}}function t(){return"ontouchend" in document}function q(){if(navigator&&navigator.userAgent&&navigator.userAgent!=null){var e=navigator.userAgent.toLowerCase();if(e.match(/(iphone|ipod|ipad)/)){return true}}return false}function x(){if(z.input.placeholder){g()}else{l()}try{w("body").on("mouseover",".errored",function(){if(!t()){L(this)}});w("body").on("mouseleave",".errored",function(){if(!t()){n(this)}});w("body").on("focus",".errored",function(){if(t()){L(this)}});w("body").on("blur",".errored",function(){if(t()){n(this)}});w("body").on("click","a",function(){D()});w("body").on("click",".errored",function(N){if(!t()){N.preventDefault();n(this)}});w("body").on("change",".covered-file-input",function(O){var N="#"+w(this).attr("data-cover-id");w(N).val(w(this).val());O.preventDefault()})}catch(M){}}A.initialize=function(){try{w("body").on("click","."+B,function(O){var P=false;var N=false;if(w(this).data("confirm-message")!==undefined){if(confirm(w(this).data("confirm-message"))){window.onbeforeunload=null}else{return false}}if(w(this).attr("data_redirect")!=null&&w(this).attr("data_redirect")!=""){P=w(this).attr("data_redirect")}if(w(this).attr("data_reload")=="true"){N=true}var e=w(this).attr("rel");if(typeof e==="undefined"){e=w(this).attr("data_rel")}top.PJTV.SingleSignOn.openDialog(e,P,N);O.preventDefault()})}catch(M){}x()};A.setCloseButtonURL=function(e,M){if(!M){M=0}w("body").on("click",a,function(){I.SingleSignOn.gotoAfter(e,M)});w("body").on("click",G,function(){I.SingleSignOn.gotoAfter(e,M)})};A.unPauseVideoPlayers=function(){w("video").each(function(M,N){try{if(N.paused&&!N.ended&&N.currentTime>0&&w(N).attr("pausedBySSO")=="true"){N.play();w(N).attr("pausedBySSO","false")}}catch(O){}});var e=this.getVideoPlayer();if(e!=null&&e.getState()==s&&w(e).attr("pausedBySSO")=="true"){e.resume();w(e).attr("pausedBySSO"," false")}};A.pauseVideoPlayers=function(){w("video").each(function(O,P){try{if(!P.paused&&!P.ended&&P.currentTime>0){P.pause();w(P).attr("pausedBySSO","true")}}catch(Q){}});var M=this.getVideoPlayer();try{if(M!=null){if(M.getState()==v){M.pause();w(M).attr("pausedBySSO","true")}else{if(M.getState()<v){if(p){setTimeout(function(){I.SingleSignOn.pauseVideoPlayers()},1000)}}}}}catch(N){}};w(document).ready(function(){I.SingleSignOn.initialize()});return A}(PJTV,$,Modernizr));
PJTV.CommonComment=(function(s,f){function k(H,G,E){var F={};F.cmd="add-common-comment-form";F["item-type"]=H;F["item-id"]=G;E.load("/",F)}function o(K,J,F,I,H,E,L){var G={};G.cmd="view-common-comments-ajax";G["item-type"]=K;G["item-id"]=J;G.style=F;G.commonCommentsSortType=I;G["common-comments-page"]=H;E.load("/",G,L)}function B(J,I,H,F,G,K){var E={};E.cmd="process-new-comment";E["text-"+I+"-"+H]=encodeURIComponent(J);E["item-type"]=I;E["item-id"]=H;E["root-item-type"]=F;E["root-item-id"]=G;f.post("/",E,K,"json")}function z(H,G,I){var F={},E=H+"-"+G;F.cmd="submit-comment-report";F["item-type"]=H;F["item-id"]=G;f.post("/",F,I,"json")}function A(G,F,H){var E={};E.cmd="ajax-restore-common-comment";E["item-type"]=G;E["item-id"]=F;f.post("/",E,H,"json")}function w(G,F,H){var E={};E.cmd="ajax-remove-common-comment";E["item-type"]=G;E["item-id"]=F;f.post("/",E,H,"json")}function C(E,H){var G=prompt("Please enter a reason for this ban (optional). Press escape or cancel if you do not wish to ban this user."),F;if(G!=null){F={};F.cmd="ajax-ban-common-commenter";F["user-id"]=E;F.reason=G;f.post("/",F,H,"json")}}function y(E,G){var F={};F.cmd="ajax-restore-banned-commenter";F.id=E;f.post("/",F,G,"json")}function m(E,G){var F={};F.cmd="ajax-restore-banned-ip-address";F.id=E;f.post("/",F,G,"json")}function p(E,G){var F={};F.cmd="ajax-restore-banned-word";F.id=E;f.post("/",F,G,"json")}function j(I,H,E,G){if(!f("#view-comments-"+I+"-"+H+"> .comments").length){var F={};F.cmd="view-common-comments-ajax";F["item-type"]=I;F["item-id"]=H;F.style=E;if(G){F["common-comments-page"]=G}f("#view-comments-"+I+"-"+H).load("/",F);f("#view-comments-"+I+"-"+H).show()}else{f("#view-comments-"+I+"-"+H).empty()}f("#usefulness-vote-message-"+I+"-"+H).empty();f("#common-comment-message-"+I+"-"+H).empty();f("#hide-comments-link-"+I+"-"+H).toggleClass("hidden");f("#view-comments-link-"+I+"-"+H).toggleClass("hidden")}function u(G,F){var E={};E["title-"+G+"-"+F]=f("#title-"+G+"-"+F).val();E["text-"+G+"-"+F]=f("#text-"+G+"-"+F).val();E["rating-"+G+"-"+F]=f("#rating-"+G+"-"+F).val();E.cmd="process-new-review";E["item-type"]=G;E["item-id"]=F;f.post("/",E,function(H){if(H.success.toString()=="false"){f("#add-common-review-message-"+G+"-"+F).text(H.message)}else{f(".add-common-review").remove()}},"json")}function v(F,E){f("#add-common-review").remove()}function r(G,F){if(!f(".add-common-review").length){var E={};E.cmd="add-common-review-form";E["item-type"]=G;E["item-id"]=F;f(".add-review").load("/",E);f(".add-review").show()}else{f(".add-common-review").remove();f(".add-review-"+G+"-"+F).hide()}}function l(G,F){var E=G+"-"+F;f("#review-upvotes-"+E).removeClass("hidden");f("#review-title-line-"+E).removeClass("hidden");f("#review-text-"+E).removeClass("hidden");f("#review-comment-links-"+E).removeClass("hidden");f("#report-review-"+E).removeClass("hidden");f("#review-content-"+E+" > .review-break").removeClass("hidden");f("#common-usefulness-vote-"+E).removeClass("hidden");f("#review-reported-message-"+E).addClass("hidden")}function n(H,G){var F={},E;F.cmd="submit-review-report";F["item-type"]=H;F["item-id"]=G;f.post("/",F,function(I){E=H+"-"+G;f("#usefulness-vote-message-"+H+"-"+G).empty();f("#report-review-"+H+"-"+G).text(I.message);if(I.success===true){f("#review-upvotes-"+E).addClass("hidden");f("#review-title-line-"+E).addClass("hidden");f("#review-text-"+E).addClass("hidden");f("#review-comment-links-"+E).addClass("hidden");f("#report-review-"+E).addClass("hidden");f("#review-content-"+E+" > .review-break").addClass("hidden");f("#common-usefulness-vote-"+E).addClass("hidden");f("#review-reported-message-"+E).removeClass("hidden");f("#restore-review-link-"+G).removeClass("hidden")}},"json")}function x(){f(".review-count-box-toggle-icon").toggle();f(".review-count-box").toggle()}function a(){f(".review-toggle-icon").toggle();f(".individual-reviews-content").toggle()}function e(G,H,F){var E;if(!G.success){alert(G.message)}else{E=G["item-type"]+"-"+G["item-id"];f("#report-review-"+G["item-type"]+"-"+G["item-id"]).text("Report");f("#review-upvotes-"+E).removeClass("hidden");f("#review-title-line-"+E).removeClass("hidden");f("#review-text-"+E).removeClass("hidden");f("#review-comment-links-"+E).removeClass("hidden");f("#report-review-"+E).removeClass("hidden");f("#review-content-"+E+" > .review-break").removeClass("hidden");f("#common-usefulness-vote-"+E).removeClass("hidden");f("#review-reported-message-"+E).addClass("hidden");f("#restore-review-link-"+G["item-id"]).addClass("hidden")}}function d(F,G,E){if(!F.success){alert(F.message)}else{f("#reported-review-row-"+F["item-id"]).remove()}}function c(G,F,H){var E={};E.cmd="ajax-restore-common-review";E["item-type"]=G;E["item-id"]=F;f.post("/",E,H,"json")}function b(G,H,F){var E;if(!G.success){alert(G.message)}else{E=G["item-type"]+"-"+G["item-id"];f("#review-"+E).remove()}}function q(F,G,E){if(!F.success){alert(F.message)}else{f("#reported-review-row-"+F["item-id"]).remove()}}function t(G,F,H){var E={};E.cmd="ajax-remove-common-review";E["item-type"]=G;E["item-id"]=F;f.post("/",E,H,"json")}function D(){f(".review[rank]").removeClass("hidden")}function g(E){f(".review[rank="+E+"]").removeClass("hidden");f(".review[rank!="+E+"]").addClass("hidden")}function i(E){return{$focusedElement:E,getContainer:function(){return this.$focusedElement.closest(".common-usefulness-vote")},storeData:function(F,G){this.getContainer().data(F,G)},getData:function(F){return this.getContainer().data(F)}}}function h(G,H,J,I){var E={},F=H+"-"+J;E.cmd="submit-common-vote";E["vote-value"]=G;E["commentable-item-type"]=H;E.id=J;f.post("/",E,I,"json")}return{sortVoteDesc:"votes-desc",sortDateDesc:"date-desc",sortDateAsc:"date-asc",getUpvoteContext:i,insertAddCommentForm:k,processNewComment:B,toggleViewComments:j,loadComments:o,reportComment:z,restoreComment:A,removeComment:w,banCommenter:C,restoreBannedCommenter:y,processUsefulnessVote:h,processNewReview:u,cancelNewReview:v,toggleAddReviewForm:r,viewReportedReview:l,reportReview:n,restoreReviewFromAdminLink:e,restoreReviewFromTable:d,restoreReview:c,removeReviewFromAdminLink:b,removeReviewFromTable:q,removeReview:t,toggleReviewCountBox:x,toggleReviewsContent:a,showAllRanks:D,limitToRank:g,restoreBannedIPAddress:m,restoreBannedWord:p}}(PJTV,$));
PJTV.RemoteCommonComment=(function(z){var b;var n;var g;var u;var j;var L;var p;var x=false;function c(O){b=O}function o(O){n=O}function D(Q,P,O){var S=prompt("Please enter a reason for this ban (optional). Press escape or cancel if you do not wish to ban this user.","");if(!S||S==null){S=""}var R={};R.cmd="ban-common-commenter-remote";R["user-id"]=Q;R.reason=S;R.id=P;R["root-item-id"]=g;z.post(b,R,l,"json");R.container=O;top.pjRequestData=R}function l(P){if(P.success){z(".ban-user-link-"+top.pjRequestData["user-id"]).html("User Banned");z("body").undelegate(".ban-user-link-"+top.pjRequestData["user-id"],"click");z(".ban-user-link-"+top.pjRequestData["user-id"]).removeClass("ban-user-link");z(".ban-user-link-"+top.pjRequestData["user-id"]).addClass("user-banned-label")}else{var O=top.pjRequestData.container;O.find(".common-comment-message-"+top.pjRequestData.id).show();O.find(".common-comment-message-"+top.pjRequestData.id).html(P.message)}}function E(P,O){var Q={};Q.cmd="remove-common-comment-remote";Q.id=P;Q["root-item-id"]=g;z.post(b,Q,C,"json");Q.container=O;top.pjRequestData=Q}function C(P){var O=top.pjRequestData.container;if(P.success){z(".common-comment-"+top.pjRequestData.id).remove();z(".common-comment-total-count").html("&nbsp;&nbsp;("+P.commentCount+")")}else{O.find(".common-comment-message-"+top.pjRequestData.id).show();O.find(".common-comment-message-"+top.pjRequestData.id).html(P.message)}}function t(P){var O={};O.cmd="submit-comment-report-remote";O["item-id"]=P;O["root-item-id"]=g;top.pjRequestData=O;z.post(b,O,y,"json")}function y(P){var O=top.pjRequestData["item-id"];if(P.success){z(".comment-text-"+O).hide();z(".comment-meta-"+O).hide();z(".comment-reported-message-"+O).show();z(".report-comment-"+O).html("Reported");z(".restore-comment-section-"+O).show();z(".restore-comment-section-"+O+" .restore-comment-link").show()}else{z("#common-comment-message-"+O).show();z("#common-comment-message-"+O).html(P.message)}}function B(P,O){var Q={};Q.cmd="restore-common-comment-remote";Q.id=P;Q["root-item-id"]=g;z.post(b,Q,h,"json");Q.container=O;top.pjRequestData=Q}function h(P){if(P.success){PJTV.RemoteCommonComment.viewReportedComment(top.pjRequestData.id);z(".restore-comment-section-"+top.pjRequestData.id).hide();z(".restore-comment-section-"+top.pjRequestData.id+" .restore-comment-link").hide();z(".report-comment-"+top.pjRequestData.id).html("Report Abuse")}else{var O=top.pjRequestData.container;O.find(".common-comment-message-"+top.pjRequestData.id).show();O.find(".common-comment-message-"+top.pjRequestData.id).html(P.message)}}function s(P){var O=P;z(".truncated-comment-text-"+O).show();z(".comment-meta-"+O).show();z(".common-comment-add-reply-link-"+O).hide();z(".comment-reported-message-"+O).hide()}function m(Q,P,O){var R={};R.cmd="submit-common-vote-remote";R["vote-value"]=Q;R.id=P;R["root-item-id"]=g;z.post(b,R,I,"json");R.container=O;top.pjRequestData=R}function I(R,S,Q){var P=top.pjRequestData.id;if(R.success){z(".common-usefulness-vote-block-"+P).each(function(T){z(this).addClass("hidden")});z(".common-usefulness-vote-feedback-"+P).each(function(T){z(this).removeClass("hidden")});if(R.upVoteCount>=R.upVoteThreshold){z(".common-usefulness-voted-below-threshold-"+P).each(function(T){z(this).removeClass("common-usefulness-voted-below-threshold");z(this).addClass("common-usefulness-voted-above-threshold")})}z(".common-usefulness-vote-"+P).each(function(T){z(this).attr("count",R.upVoteCount)});z(".vote-count-"+P).each(function(T){z(this).text(R.upVoteCount)});z(".vote-count-text-"+P).each(function(T){jQuerySSO(this).prop("onclick",null);z(this).removeClass("vote-count-text-live-link")});if(R.reloadTopComments&&!PJTV.RemoteCommonComment.viewMoreTop){z(".common-comment-top-comments").html(R.renderedTopComments)}}else{var O=top.pjRequestData.container;O.find(".common-comment-message-"+P).text(R.message)}}function q(O){var P={};P.page=O;N(P)}function M(){var O={};O.cmd="get-common-comments-pending";O["item-id"]=g;O["item-type"]=u;if(PJInterop.CookieCache.get("email")&&!PJInterop.CookieCache.get("isEmailVerified")){z.get(b,O,k,"json")}}function k(O){z("#view-pending-comments").html(O.renderedPendingComments)}function N(O){if(!O.sort){O.sort=PJTV.RemoteCommonComment.sort}if(!O["view-more-top"]){O["view-more-top"]=PJTV.RemoteCommonComment.viewMoreTop}O.cmd="get-common-comments-remote";O["item-id"]=g;O["item-type"]=u;top.pjRequestData=O;z.get(b,O,a,"json")}function a(O){jQuerySSO(window).trigger("pj:comments-loaded",O);var Q=O.renderedComments;J().html(Q);if(PJInterop&&PJInterop.CookieCache){try{PJInterop.CookieCache.bind()}catch(P){}}}function i(){var O=top.location.protocol+"//"+top.location.host+top.location.pathname+"?x="+Math.random();O+="#pj-cc-header-a";top.location=O}function G(){z("#pj-cc-top-comments-wrapper").css("display","none")}function J(){return z("#pj-interop-comments")}function H(P,Q,O){O.find(".add-comment-"+P).toggle()}function v(R,O){var Q=R;var P=top.location.toString();P=P.replace(/show-at-comment.*/,"");P=P.replace(/#.*/,"");if(P.indexOf("?")>=0){P+="&"}else{P+="?"}P+="show-at-comment="+escape(R);P+="#comment-"+escape(R);O.find(".show-link-to-comment-div-"+Q).toggle();O.find(".show-link-to-comment-textarea-"+Q).val(P)}function w(R,T,S,P,O){if(this.submitting){return}var Q={};Q.cmd="save-common-comment-remote";Q["item-type"]=T;Q["item-id"]=R;Q["root-item-id"]=g;Q["root-item-type"]=u;Q.text=encodeURIComponent(S);Q.rawtext=S;Q.instanceId=P;Q.identifier=T+"-"+R+"-"+P;Q.sort=PJTV.RemoteCommonComment.sort;Q["view-more-top"]=PJTV.RemoteCommonComment.viewMoreTop;if(S.replace(/ /g,"").length==0){O.find(".add-common-comment-message-"+Q.identifier).show();O.find(".add-common-comment-message-"+Q.identifier).html("You must enter some text!");return}this.submitting=true;z(".submit-common-comment").each(function(U){if(z(this).attr("data-instance-id")==P){z(this).addClass("common-comment-timestamp");z(this).removeClass("cursor-pointer")}});z.post(b,Q,K,"json");Q.container=O;top.pjRequestData=Q}function K(Q){PJTV.RemoteCommonComment.submitting=false;z(".submit-common-comment").each(function(R){if(z(this).attr("data-instance-id")==top.pjRequestData.instanceId){z(this).removeClass("common-comment-timestamp");z(this).addClass("cursor-pointer")}});var O=top.pjRequestData.container;if(Q.action&&Q.action=="show-screen-name-dialog"){var P=n;P+="?cmd=screenname-prompt";PJTV.SingleSignOn.openDialog(P,null,true)}if(Q.action&&Q.action=="reload"){top.location.reload()}if(Q.success){if(Q.pending){k(Q);z(".common-comment-textarea").val("")}else{a(Q)}z("#"+O[0].id+" .add-common-comment-message-"+top.pjRequestData.identifier).show();z("#"+O[0].id+" .add-common-comment-message-"+top.pjRequestData.identifier).html(Q.message);z("#"+O[0].id+" .add-common-comment-message-"+top.pjRequestData.identifier).delay(10000).fadeOut("fast")}else{O.find(".add-common-comment-message-"+top.pjRequestData.identifier).show();O.find(".add-common-comment-message-"+top.pjRequestData.identifier).html(Q.message)}}function r(P,O){O.find("#truncated-comment-text-"+P).hide();O.find("#full-comment-text-"+P).show()}function F(P,O){O.find("#full-comment-text-"+P).hide();O.find("#truncated-comment-text-"+P).show()}function A(){z("body").delegate(".common-comment-add-reply-link","click",function(R){var P=z(R.currentTarget).attr("data-item-id");var Q=z(R.currentTarget).attr("data-item-type");var O=z(R.currentTarget).closest(".common-comment-container");PJTV.RemoteCommonComment.reply(P,Q,O)});z("body").delegate(".submit-common-comment","click",function(S){var P=z(S.currentTarget).attr("data-item-id");var Q=z(S.currentTarget).attr("data-item-type");var R=z(S.currentTarget).attr("data-instance-id");var T=z("#text-"+Q+"-"+P+"-"+R).val();var O=z(S.currentTarget).closest(".common-comment-container");PJTV.RemoteCommonComment.postComment(P,Q,T,R,O)});z("body").delegate(".common-comment-guidelines","click",function(O){if(e()){z(".comment-guidelines-iphone").toggle();return}});z("body").delegate(".common-comment-guidelines","mouseover",function(R){if(e()){return}var Q=z('<img class="guidelines-popup">');Q.attr("class","guidelines-popup");Q.attr("src","/wp-content/plugins/pjinteropplugin/images/commoncomment/comment-guidelines.png");Q.css("display","none");var P=(parseInt(z(R.target).position().top,10)+15);var O=(parseInt(z(R.target).position().left,10)-80);Q.css("top",P);Q.css("left",O);Q.appendTo(R.target);Q.fadeIn();jQuerySSO(R.target).on("mouseout",function(S){Q.fadeOut(function(T){Q.remove()})})});z("body").delegate(".common-comment-sort-link","click",function(P){var O={};O.sort=z(P.currentTarget).attr("data-sort-option");O.page=1;if(O.sort=="votes-desc"){O["view-more-top"]=1}else{O["view-more-top"]=0}PJTV.RemoteCommonComment.sort=O.sort;PJTV.RemoteCommonComment.viewMoreTop=O["view-more-top"];PJTV.RemoteCommonComment.getComments(O)});z("body").delegate(".common-comment-paging-page","click",function(P){var O={};O.page=z(P.currentTarget).attr("data-page");PJTV.RemoteCommonComment.getComments(O)});z("body").delegate("#common-comment-view-all-link","click",function(P){var O={};O["view-all"]=1;PJTV.RemoteCommonComment.getComments(O)});z("body").delegate("#common-comment-view-more-top-link","click",function(P){var O={};O["view-more-top"]=1;O.sort="votes-desc";PJTV.RemoteCommonComment.sort=O.sort;PJTV.RemoteCommonComment.viewMoreTop=O["view-more-top"];PJTV.RemoteCommonComment.getComments(O)});z("body").delegate(".report-comment","click",function(P){var O=z(P.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.reportComment(O)});z("body").delegate(".comment-view-reported","click",function(P){var O=z(P.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.viewReportedComment(O)});z("body").delegate(".common-usefulness-vote","click",function(R){var Q=z(R.currentTarget).attr("data-item-id");var P=z(R.currentTarget).attr("data-vote-value");var O=z(R.currentTarget).closest(".common-comment-container");PJTV.RemoteCommonComment.upVote(P,Q,O)});z("body").delegate(".link-to-comment","click",function(Q){var P=z(Q.currentTarget).attr("data-item-id");var O=z(Q.currentTarget).closest(".common-comment-container");PJTV.RemoteCommonComment.linkToComment(P,O)});z("body").delegate(".remove-comment-link","click",function(Q){var O=z(Q.currentTarget).closest(".common-comment-container");var P=z(Q.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.removeComment(P,O)});z("body").delegate(".ban-user-link","click",function(R){var O=z(R.currentTarget).closest(".common-comment-container");var Q=z(R.currentTarget).attr("data-user-id");var P=z(R.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.banCommenter(Q,P,O)});z("body").delegate(".restore-comment-link","click",function(Q){var O=z(Q.currentTarget).closest(".common-comment-container");var P=z(Q.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.restoreComment(P,O)});z("body").delegate(".show-more-link","click",function(Q){var O=z(Q.currentTarget).closest(".common-comment-container");var P=z(Q.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.showMore(P,O)});z("body").delegate(".show-less-link","click",function(Q){var O=z(Q.currentTarget).closest(".common-comment-container");var P=z(Q.currentTarget).attr("data-item-id");PJTV.RemoteCommonComment.showLess(P,O)})}function d(R,O,P,Q){if(!j){j=true;g=R;u=O;c(P);o(Q);A()}setTimeout(function(){z(".comment-highlight").addClass("comment-highlight-fadeout")},3000);if(PJInterop.CookieCache.get("isEmailVerified")==false){z(".common-comment-textarea").attr("placeholder","Your comment will not appear until you verify your email address. Please check your email to complete the registration process.")}M()}function f(P){var O=RegExp("[?&]"+P+"=([^&]*)").exec(window.location.search);return O&&decodeURIComponent(O[1].replace(/\+/g," "))}function e(){if((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i))){return true}return false}return{restoreComment:B,reportComment:t,banCommenter:D,removeComment:E,upVote:m,hideTopComments:G,reply:H,postComment:w,viewReportedComment:s,getComments:N,getPendingComments:M,linkToComment:v,showMore:r,showLess:F,initialize:d,submitting:x}}($));
