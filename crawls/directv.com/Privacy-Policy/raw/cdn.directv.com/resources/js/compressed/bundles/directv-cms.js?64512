(function(){var c={name:"CMSModule",maxInstances:1,autoMapping:"dtv_body_tup",prototype:{_init:function(){Dtv.app.cmsModule=this;this.el.select(".js-collapsible-tabs").invoke("behavior","CollapsibleTab");this.el.select(".js-accordion").invoke("behavior","Accordion");this.el.select(".js-order-module").invoke("behavior","OrderModule");this.el.select(".js-mediaplayer").invoke("lazyBehavior","MediaPlayer");this.el.select(".js-mediajukebox").invoke("lazyBehavior","MediaCarousel");this.el.select(".js-AjaxCmsModule").invoke("lazyBehavior","AjaxCmsModule");
this.el.select(".js-VideoPlayer").invoke("lazyBehavior","VideoPlayer");this.el.select(".cms2PhotoGalleryModule").invoke("behavior","photoInPage");var b=$("header_slider");if(b){this.headerSlider=b.behavior("HeaderSlider")}var a=$("guide");if(a){a.lazyBehavior("ChannelGuide")}this.el.select(".ep-carousel:not(.ep-carousel-contingency)").invoke("lazyBehavior","EpCarousel");this.el.select(".ep-feed-list:not(.ep-list-contingency)").invoke("lazyBehavior","EpFeedList");this.el.select(".ctm-scroller-module .js-horizontal-scroller").invoke("lazyBehavior","ChannelScroller",{orientation:"horizontal"});
this.el.select(".ctm-scroller-module .js-vertical-scroller").invoke("lazyBehavior","ChannelScroller",{orientation:"vertical"})},_initEvents:function(){this.onDom(this.el,"click",{"a.js-CMSModule-showSpecialOffersMenu":this.showSpecialOffersMenu,"a.js-CMSModule-showShareMenu":this.showShareMenu,"a.js-CMSModule-hideShareMenu":this.hideShareMenu,"a.js-CMSModule-addBookmark":this.addBookmark,"a.js-CMSModule-shareLink":this._handleShareLink,"a.js-CMSModule-showVideoLightbox":this._handleShowVideoLightbox,"a.js-CMSModule-showMediaLightbox":this._handleShowMediaLightbox,"a.js-CMSModule-showPhotoLightbox":this._handleShowPhotoLightbox,"a.js-action[rel=CMSModule:mediaLightbox.show]":this._handleShowMediaLightbox,"a.js-CMSModule-showModuleLightbox":this._handleShowModuleLightbox},this)
},_initDefaultState:function(){this.el.select(".ctm-content-module").each(function(a){a.select("h1 span img, h2 span img, h3 span img, h4 img, .content .link a img").each(function(b){b.addClassName("icon");pngFix(b)})})},_handleShowVideoLightbox:function(a,e){var b=e.getVar("videoData");this.getVideoLightbox().show(b)},_handleShowPhotoLightbox:function(a,e){var b=e.getVar("photoData");this.getPhotoLightbox().show(b)},_handleShowMediaLightbox:function(a,b){this.getMediaLightbox().show(b.href,b.getVar("lightboxTitle"),b.getVar("lightboxCaption"));
a.preventDefault()},_handleShowModuleLightbox:function(a,b){this.showModuleLightbox(b.getVar("lightboxModuleId"))},_handleShareLink:function(b,e){var h=e.getVar("shareType");var a="";if(h=="buzzup"){a="http://buzz.yahoo.com/buzz?src=addthis&targetUrl="+encodeURIComponent(document.location.href)+"&headline="+encodeURIComponent(document.title)}else{if(h=="delicious"){a="http://del.icio.us/post?url="+encodeURIComponent(document.location.href)+"&title="+encodeURIComponent(document.title)}else{if(h=="digg"){a="http://digg.com/submit?phase=2&url="+encodeURIComponent(document.location.href)
}else{if(h=="facebook"){a="http://www.facebook.com/sharer.php?u="+encodeURIComponent(document.location.href)+"&t="+encodeURIComponent(document.title)}else{if(h=="twitter"){a="http://twitter.com/home?status="+encodeURIComponent(document.location.href)}}}}}if(a){openCenteredWindow(a,"shareWindow",800,600,true,true)}return false},showModuleLightbox:function(a){Dtv.app.ajaxLightbox.show("/DTVAPP/global/lightbox/lightboxCmsModule.jsp?moduleId="+a,{onAfterShow:function(){this.ajaxPanel.ajaxContent.addDisposableObjs(this.el.select(".js-VideoPlayer").invoke("behavior","VideoPlayer"));
this.ajaxPanel.ajaxContent.addDisposableObjs(this.el.select(".js-mediaplayer").invoke("behavior","MediaPlayer"));this.ajaxPanel.ajaxContent.addDisposableObjs(this.el.select(".js-mediajukebox").invoke("behavior","MediaCarousel"));this.ajaxPanel.ajaxContent.addDisposableObjs(this.el.select(".ep-carousel:not(.ep-carousel-contingency)").invoke("behavior","EpCarousel"));this.ajaxPanel.ajaxContent.addDisposableObjs(this.el.select("#guide").invoke("behavior","ChannelGuide"))}})},addBookmark:function(){if(window.sidebar){window.sidebar.addPanel(document.title,document.location.href,"")
}else{if(window.external){window.external.AddFavorite(document.location.href,document.title)}}return false},hideShareMenu:function(){$("share_menu").hide()},showShareMenu:function(){$("share_menu").show();$("content_page_email_content").hide()},cmsSaveEmail:function(){var g="/DTVAPP/content/component/email.jsp";var a=new Array();var h=document.forms.signupForm.emailField.value;a.push("email="+escape(h));$("email_signup_preferences_id").innerHTML=h;var b=new Ajax.Request(g,{method:"get",parameters:a.join("&"),onComplete:function(e){Dtv.app.cmsModule.cmsProcessResult(e)
}})},cmsProcessResult:function(a){$("default").hide();if(a.responseText.match(/success/)){$("fr").hide();$("success").toggle();$("validation").hide();$("error").hide();this.cmsEmailSignupPopup()}else{if(a.responseText.match(/exception/)){$("validation").hide();$("error").show();$("error").setStyle({color:"red"})}else{$("error").hide();$("validation").show();$("validation").setStyle({color:"red"})}}},cmsEmailSignupPopup:function(a){if(!a){email=document.forms.signupForm.emailField.value}else{email=a
}$("email_signup_preferences_id2").innerHTML=email;$("email_signup_preferences_id1").innerHTML=email;if(!this.anonUserInterestFormInited){this.anonUserInterestForm()}$("thankyou_email_content").show()},anonUserInterestForm:function(){var a=$("lb_btn_preferences");if(a){new Dtv.FormController($("anonUserInterestForm"),{disableFormOnSuccess:false,onSubmitSuccess:function(b,f){if(f.preferencesUpdated){$("email_signup_preferences_container").hide();window.location.reload();$("email_signup_preferences_confirmation").show();
return}}})}this.anonUserInterestFormInited=true},showSpecialOffersMenu:function(){$("share_menu").hide();if(!this._emailSignupFormInited){this._initEmailSignupForm()}$("content_page_email_content").show()},_initEmailSignupForm:function(){var a=$("email_signup_submit");if(a){new Dtv.FormController($("email_signup_form"),{disableFormOnSuccess:false,onSubmitSuccess:function(j,l){var m=$("email_signup_email_address1");var n=$("email_signup_email_address2");var b=$("email_signup_email_input");if(m&&n&&b){m.innerHTML=b.value;
n.innerHTML=b.value}if(l.preferencesUpdated){$("email_signup_form_container").hide();$("email_signup_confirmation").show();return}var k=$("email_signup_not_signed_up");if(k){k.remove()}$("email_signup_signed_up").show()}})}this._emailSignupFormInited=true},getProgramInfoBoxPopup:function(){if(!this._programInfoBoxPopup){this._programInfoBoxPopup=new Element("div").behavior("ProgramInfoPopup")}return this._programInfoBoxPopup},getPhotoLightbox:function(){if(!this._photoLightbox){var a=$("photo_lightbox");
if(a){this._photoLightbox=a.behavior("PhotoLightbox")}}return this._photoLightbox},getVideoLightbox:function(){if(!this._videoLightbox){var a=$("video_lightbox");if(a){this._videoLightbox=a.behavior("VideoLightbox")}}return this._videoLightbox},getMediaLightbox:function(){if(!this._mediaLightbox){var a=$("magnifying_media_lightbox");if(a){this._mediaLightbox=a.behavior("MediaLightbox")}else{this.debug('MediaLightbox could not be created. "magnifying_media_lightbox" element is not included on page.',null,"warn")
}}return this._mediaLightbox}}};var d={name:"AjaxCmsModule",inherits:"LazyAjaxContent",prototype:{_getAjaxPanelEl:function(){return this.el.up(".js-cms-module")},_initLazyContent:function(){this.ajaxPanel.el.select(".ep-carousel:not(.ep-carousel-contingency)").invoke("behavior","EpCarousel");this.ajaxPanel.el.select(".ep-feed-list:not(.ep-list-contingency)").invoke("behavior","EpFeedList")}}};Dtv.Behaviors.create(c,d)})();(function(){if(!Dtv.Pep){Dtv.Pep={}}Dtv.Pep.initMRVChkboxHandler=function(c){var a=c.getField("/directv/formhandler/PepBasePackageFormHandler.mrvSkuId");
var b=window.location.search;if(a){a.on("change",function(i){var k=c.getFields("CheckboxField");if(a.getChecked()){if(k){for(var l=0;l<k.length;l++){if(k[l].id.indexOf("_mrv")==-1){k[l].setChecked(true);k[l].disable()}}}}else{if(!a.isDirty()){c.reset()}else{k.invoke(i.element().checked?"reset":"clear")}if(window.location.search.length>0){if(b.include("B000100771_000000001")){k.invoke(i.element().checked?"reset":"clear")}}k.invoke("enable")}});c.on("submitcomplete",function(h){if(h.memo.json){switch(h.memo.json.handlerName){case"ajaxCheckMRVPrereq":if(c.options.disableFormOnSuccess){c.enable()
}break}}})}};var e="_h";var d={name:"CartFlyout",inherits:"AjaxLightbox",options:{zIndex:1001,ajaxHistoryParam:"_h",contentBehavior:{name:"AjaxPanel.AjaxContent",options:{}}},statics:{showAsLightbox:function(i,a){var j=i.lightboxUrl.toQueryParams();if(!j.lightbox){i.lightboxUrl+="&lightbox=true"}var b=this.getDefault();b._savedChanges=false;b.showWithHistory(i.lightboxUrl,{actions:{proceed:function(){if(a){a()}else{b._savedChanges=true;b.hide()}}},form:{hideOnSuccess:false,options:{suppressMessageUpdatesOnSuccess:true,onSubmitCreate:function(){b.showWaiting();
return true},onSubmitSuccess:function(g,h){b._savedChanges=true;if(h.hideDependency&&j.dependency){c()}else{b.refresh(h.refreshUrlParams)}}}},onHide:function(){if(b._savedChanges){if(a){a()}else{c()}}}});function c(){Dtv.app.hideThinking=Prototype.emptyFunction;Dtv.app.enableScreen=Prototype.emptyFunction;Dtv.app.disableScreen();Dtv.app.showThinking();document.location.href="/DTVAPP/new_customer/shopping_cart.jsp"}}},prototype:{_handleWindowResize:function($super,a){if(this.visible()){this.refreshLayout(true)
}},refreshLayout:function($super,a){if(!this.visible()){$super();this.el.setStyle({display:"block",visibility:"hidden"});this.currentPage.refreshLayout();this._adjustPageHeight();this.el.setStyle({display:"none",visibility:"visible"})}else{if(a){$super()}this.currentPage.refreshLayout();this._adjustPageHeight()}},_adjustLayoutStyle:function(b){if(this.options.stalker){var h=this.options.stalker.el;var a={};if(h.viewportOffset().top<0){a.top=h.cumulativeScrollOffset().top}else{a.top=h.cumulativeOffset().top
}a.left=this._getRelatedEl().cumulativeOffset().left;var c=Prototype.X.Browser.IE<8?24:14;b.left=a.left-c;b.top=a.top-6;b.position="absolute"}},_adjustPageHeight:function(a){var c=this.currentPage.el.getHeight();if(c>0){if(this._pageMorphFx&&this._pageMorphFx.state!="finished"){if(this._pageMorphFx.options.style.contains("height:"+c+"px")){return false}else{this._pageMorphFx.cancel();a=true}}var b=this.pageList.el.up();if(a){this._pageMorphFx=new Effect.Morph(b,{style:"height:"+c+"px"})}else{b.style.height=c+"px"
}return true}return false},_afterShow:function($super){$super();if(this.options.stalker&&this.options.stalker.el){this.options.stalker.el.style.visibility="hidden"}this.refreshLayout(true)},_afterHide:function($super){$super();if(this.options.stalker&&this.options.stalker.el){this.options.stalker.el.style.visibility="visible"}if(typeof Inq!="undefined"){Inq.reinitChat(201198)}},show:function($super,b,c,a){delete this.currentPage;delete this._currentPageNdx;$super(b,c,a)},_initContent:function($super){this.pageList=this.el.down("#flyout-pages").behavior("ScrollableList",{mouseWheelEnabled:false,transition:Effect.Transitions.easeFromTo,effectDuration:1,visibleBleed:0});
this.ajaxPanel.ajaxContent.addDisposableObj(this.pageList);this._resetFormControllers();$super();var a=this.el.down(".js-cart-totals");if(a){if(Dtv.Behaviors.CartTotals){this.cartTotals=a.behavior("CartTotals")}else{a.remove()}}this._setCurrentPage();this.currentPage.initContent()},_resetFormControllers:function(){this.formControllers=[];this.el.select("form").each(this._initFormController.bind(this))},_initFormController:function(c){var a=this._getFormControllerConfig(c);var b=new Dtv.FormController(c,a.options);
if(a.onInit){a.onInit.call(this,b,this.ajaxPanel.ajaxContent)}this.addFormController(b,a);return b},addFormController:function(b,a){b.on(b.EVENTS.SUBMIT_RESPONSE,this._handleSubmitResponse.bind(this,a));b.on(b.EVENTS.SUBMIT_SUCCESS,this._handleSubmitSuccess.bind(this,a));b.on(b.EVENTS.SUBMIT_FAILURE,this._handleSubmitFailure.bind(this,a));b.findMessageContainer(this.el);this.formControllers.push(b);this.ajaxPanel.ajaxContent.addDisposableObj(b)},_getFormControllerConfig:function(c){var a=this.config.form||{options:{}};
if(this.config.forms){for(var b in this.config.forms){if(c.matchAny(b)){a=this.config.forms[b];break}}}return $extend({},a)},_handleSubmitResponse:function(a,b){this.refreshLayout()},_handleSubmitSuccess:function(a,b){},_handleSubmitFailure:function(a,b){this.refreshLayout.bind(this).defer()},refresh:function(b){this.showWaiting();this.formControllers.invoke("disable");var a=this.currentPage.url||this.url;if(this.currentPage.lastJsonResponse){a+=(a.contains("?")?"&":"?")+"refreshReason="+this.currentPage.lastJsonResponse.handlerName
}if(b&&b.startsWith("&")){a+=b}var c=this;new Ajax.Request(a,{parameters:b,timeout:true,onSuccess:function(j){try{h();c.update(j.responseText)}catch(g){c.debug(g);throw g}},onCancel:function(){h()},onException:function(g){h();Dtv.debug(new Error("Failed to refresh flyout: "+g.responseText))}});function h(){c.hideWaiting();c.formControllers.invoke("enable")}},update:function(a){var b=new Element("div").update(a);this.currentPage.update($member(b.down("li.flyout-page"),"innerHTML"));this._initContent();
if(this.cartTotals){var c=b.down(".js-cart-totals");if(c&&!c.empty()){this.cartTotals.update(c.innerHTML)}else{this.cartTotals.hideWaiting()}}this.pageList.update();this._navigateToCurrentPage();this.refreshLayout();if(this.isDependencyVisible()){this._showClosePageButton()}},isDependencyVisible:function(){return(this._currentPageNdx>0)},showDependencyPage:function(a){this._enabledEls=this.currentPage.el.select("a:enable");this._setCurrentPage(1);this.currentPage.url=a;this.refresh()},hideDependencyPage:function(){this.currentPage.disableLinks();
this._setCurrentPage(0);if(this._enabledEls){this._enabledEls.invoke("enable");delete this._enabledEls}this.currentPage.formControllers.invoke("reset");this._hideClosePageButton();if(this._savedChanges){this.refresh()}else{if(this.pageList.getNavIndex()==0){this.hide()}else{this._navigateToCurrentPage()}}},_showClosePageButton:function(){this._closePgBtn=this.el.down("a.dependency-close-btn");if(!this._closePgBtn){this._closePgBtn=new Element("a",{"class":"dependency-close-btn js-action",rel:"CartFlyout:hideDependencyPage"}).appendTo(this.el)
}this._closePgBtn.setStyle({display:"block",top:((this.currentPage.el.getHeight()/2)-30)+"px"})},_hideClosePageButton:function(){if(this._closePgBtn){this._closePgBtn.hide()}},_setCurrentPage:function(a){a=$chk(a)?a:this._currentPageNdx||0;this._currentPageNdx=a;this.currentPage=this.pageList.getNavItem(a).behavior("CartFlyoutPage",{flyout:this});this.ajaxPanel.ajaxContent.addDisposableObj(this.currentPage);this.currentPage.update()},_navigateToCurrentPage:function(){if(this.pageList.navigateToIndex(this._currentPageNdx)){if(this._enabledEls){this._enabledEls.invoke("disable")
}this._adjustPageHeight(true)}},enableLinks:function(){this.el.select("a").invoke("enable");this.el.select("div.js-lb-help").invoke("removeClassName","lb-help-disabled");if(this.cartTotals){this.cartTotals.enable()}},disableLinks:function(){this.el.select("a").invoke("disable");this.el.select("div.js-lb-help").invoke("addClassName","lb-help-disabled");if(this.cartTotals){this.cartTotals.disableLinks()}},showWaiting:function($super){if(this.visible()){if(this.cartTotals){this.cartTotals.showWaiting()
}this.disableLinks()}else{$super()}},hideWaiting:function($super){if(this.visible()){if(this.cartTotals){this.cartTotals.hideWaiting()}this.enableLinks()}$super()}}};var f={name:"CartFlyoutPage",prototype:{_initDefaultState:function(){this.el.select("ul.receivers input:checked[type='radio']").each(this.selectReceiverItem.bind(this));if(this.options.flyout.el.down().id=="lb_receiver"&&this.el.select(".js-flyout-item").length==1){$("flyout_receiver_btn_done").disable()}},initContent:function(){this.formControllers=[];
this.el.select("form").each(function(c){var b=this._initFormController(c.getController());if(b){this.formControllers.push(b)}}.bind(this));var a=$("verisign_seal");if(a&&a.empty()){a.update($("verisign_call").innerHTML)}},_initFormController:function(b){var a=this;b.on(b.EVENTS.SUBMIT_COMPLETE,function(c){a.lastJsonResponse=c.memo.json});if(Dtv.Pep.initMRVChkboxHandler){Dtv.Pep.initMRVChkboxHandler(b)}if(b.fields.length==0){return}switch(b.el.className){case"js-receivers-form":a._setupReceiversFormController(b);
break;case"js-account-info-form":a._setupAccountInfoFormController(b);break;case"js-payment-form":a._setupPaymentFormController(b);b.options.timeout=180;break;case"js-packages-form":a._noShowItemAfterUpdate=true;break}b.on(b.EVENTS.CHANGE,function(c){var j=b.getDefaultTrigger();if(j&&!j.hasClassName("js-no-disable")){j[(b.isDirty()?"en":"dis")+"able"]();if(b.el.className=="js-packages-form"){var i=j.down("span");if(!b.origSubmitTxt){b.origSubmitTxt=i.innerHTML}if(b.isDirty()){i.update(j.getVar("updateTxt"))
}else{i.update(b.origSubmitTxt)}}}});b.fireEvent(b.EVENTS.CHANGE);return b},_setupReceiversFormController:function(b){this._noShowItemAfterUpdate=true;var a=b.el.select("input[type='checkbox']");a.each(function(h){var c=h.up("li").down("input[type='radio']");h.disabled=!c.checked;if(h.disabled){h.checked=false}})},_setupAccountInfoFormController:function(c){var a=this;var b=new Element("li").update(c.el.getVar("rebateWarning"));if(typeof b!="undefined"&&b.length>1){this.onDom($("allUserEmailInterests"),"click",function(h){if(!h.element().checked){c.setMessages("warning",[b],true);
a.options.flyout.refreshLayout()}})}},_setupPaymentFormController:function(m){var o=m.fields.findAll(function(g){return g.el.id.startsWith("bill")});this.onDom("sameAsInstallationAddressCb","click",function(g){o.invoke(g.element().checked?"reset":"clear")});this.onDom("enrollInAutoBillPay","click",function(J){var C=$$("#monthly_price_dollars")[1];var j=$$("#programming_package_savings")[1];var K=new Number(C.innerHTML);var N=j.innerHTML;var H=$$("#checkout_flyout_content #message_container")[0].getVar("abpAmount");
var G=new Number(H);var E=$$("#checkout_flyout_content #message_container")[0].getVar("abppbAmount");var i=new Number(E);var h=document.getElementById("enrollInPaperlessBill");if(!!h&&h.checked){G=G+i}var L=new Number(N.indexOf(" "));var I=new Number(N.indexOf("$"));var g=N.substring(I+1,L);var F=new Number(g);var D=N.substring(L);var M=N.substring(0,I+1);if(J.element().checked){K=K-G;F=F+G}else{K=K+G;F=F-G}var k=M+F.toFixed(2)+D;j.innerHTML=k;C.innerHTML=K});if(!m.rebateWarningInited){var c=this;
var l=new Element("li").update(m.el.getVar("rebateWarning"));var a=new Element("li").update(m.el.getVar("rebateHide"));if($("ABP_info")){this.onDom("enrollInAutoBillPay","click",function(g){if(!g.element().checked){m.setMessages("warning",[l],true);c.options.flyout.refreshLayout();$("ABP_info").hide();c.options.flyout.refreshLayout()}})}var b=$$("#checkout_flyout_content #message_container")[0].getVar("abpwarning");var p=$$("#checkout_flyout_content #message_container")[0].getVar("pbwarning");var n=$$("#checkout_flyout_content #message_container")[0].getVar("abppbwarning");
if($("ABP_PB_info")){this.onDom("enrollInAutoBillPay","click",function(g){if(!document.getElementById("enrollInAutoBillPay").checked&&document.getElementById("enrollInPaperlessBill").checked){l=new Element("li").update(b)}if(document.getElementById("enrollInAutoBillPay").checked&&!document.getElementById("enrollInPaperlessBill").checked){l=new Element("li").update(p)}if(!document.getElementById("enrollInAutoBillPay").checked&&!document.getElementById("enrollInPaperlessBill").checked){l=new Element("li").update(n)
}if(!g.element().checked){m.setMessages("warning",[l],false);c.options.flyout.refreshLayout();$("ABP_PB_info").hide();c.options.flyout.refreshLayout()}})}m.rebateWarningInited=true}this.onDom("enrollInPaperlessBill","click",function(H){var k=$$("#monthly_price_dollars")[1];var i=$$("#programming_package_savings")[1];var J=new Number(k.innerHTML);var g=i.innerHTML;var I=$$("#checkout_flyout_content #message_container")[0].getVar("pbAmount");var F=new Number(I);var C=$$("#checkout_flyout_content #message_container")[0].getVar("abppbAmount");
var j=new Number(C);if(document.getElementById("enrollInAutoBillPay").checked){F=F+j}var K=new Number(g.indexOf(" "));var G=new Number(g.indexOf("$"));var h=g.substring(G+1,K);var D=new Number(h);var B=g.substring(K);var L=g.substring(0,G+1);if(H.element().checked){J=J-F;D=D+F}else{J=J+F;D=D-F}var E=L+D.toFixed(2)+B;i.innerHTML=E;k.innerHTML=J});if(!m.rebateWarningInited1){var c=this;var l=new Element("li").update(m.el.getVar("rebateWarning"));var a=new Element("li").update(m.el.getVar("rebateHide"));
if($("PB_info")){this.onDom("enrollInPaperlessBill","click",function(g){if(!g.element().checked){m.setMessages("warning",[l],true);c.options.flyout.refreshLayout();$("PB_info").hide();c.options.flyout.refreshLayout()}})}var b=$$("#checkout_flyout_content #message_container")[0].getVar("abpwarning");var p=$$("#checkout_flyout_content #message_container")[0].getVar("pbwarning");var n=$$("#checkout_flyout_content #message_container")[0].getVar("abppbwarning");if($("ABP_PB_info")){this.onDom("enrollInPaperlessBill","click",function(g){if(!document.getElementById("enrollInAutoBillPay").checked&&document.getElementById("enrollInPaperlessBill").checked){l=new Element("li").update(b)
}if(document.getElementById("enrollInAutoBillPay").checked&&!document.getElementById("enrollInPaperlessBill").checked){l=new Element("li").update(p)}if(!document.getElementById("enrollInAutoBillPay").checked&&!document.getElementById("enrollInPaperlessBill").checked){l=new Element("li").update(n)}if(!g.element().checked){m.setMessages("warning",[l],false);c.options.flyout.refreshLayout();$("ABP_PB_info").hide();c.options.flyout.refreshLayout()}})}m.rebateWarningInited1=true}c.options.flyout.refreshLayout();
o.invoke("on",m.EVENTS.CHANGE,function(g){if(g.memo.field.isDirty()){addressCb.checked=false}})},showItem:function(a){if(!$chk(a)){return false}this.hideReceiverInfo(true);this._flyoutItemEls.each(function(b){b.up().removeClassName("active")});this._flyoutItemEls[a].up().addClassName("active");this._flyoutContentEls.invoke("hide");this._flyoutContentEls[a].show();this.currentItemIndex=a;this.options.flyout.refreshLayout();return true},showLastItem:function(){this.showItem(this._flyoutContentEls.length-1)
},showReceiverInfo:function(b){var c=b.up("li");var h=c.up("li");var a=h.select(".js-info-container")[c.getSiblingIndex()];a.down().style.top=(8+(c.getSiblingIndex()*80))+"px";a.show()},hideReceiverInfo:function(){this.el.select(".js-info-container").invoke("hide")},selectReceiverItem:function(a){a=$(a);a.up("ul.receivers").select("li").invoke("removeClassName","checked");a.up("li").addClassName("checked");this.hideReceiverInfo()},_togglePane:function(a,c){if(!this._vPaneTriggerEl){return}var b=this._vPaneTriggerEl.hasClassName(a+"-active");
this.vertPanes.togglePane(this._vPaneTriggerEl,a,c);this.el.select("#btn_checkout_flyout_continue").invoke(((b)?"enable":"disable"))},refreshLayout:function(){if(this.vertPanes){var b=this.vertPanes.getNavItem(0).getHeight();if(b>0){var a={height:b+"px"};this.vertPanes.el.up().setStyle(a);this.vertPanes.getNavItem(1).setStyle(a)}this.vertPanes.update()}},update:function(a){if(a){this.el.update(a)}this.el.show();this._contentEl=this.el.down(".js-ajax-content");this._flyoutItemEls=this.el.select(".js-flyout-item");
this._flyoutContentEls=this.el.select(".js-flyout-content");this._vPaneTriggerEl=this.el.down(".js-lb-help, .js-lb-privpolicy");var b=this.el.down("ul.flyout-v-panes");if(b){this.vertPanes=b.behavior("ScrollablePane")}if(a){this.refreshLayout();if(!this._noShowItemAfterUpdate){this.showItem(this.currentItemIndex)}this._initDefaultState()}}},actionAdapters:{toggleHelp:function(){this._togglePane("lb-help","Close Help")},togglePrivPolicy:function(){this._togglePane("message","Close")},showItem:function(a,b){this.showItem(this._flyoutItemEls.indexOf(b))
},showReceiverInfo:function(a,b){this.showReceiverInfo(b)}}};Dtv.Behaviors.create(d,f)})();(function(){var programInfoPopupDef={name:"ProgramInfoPopup",inherits:"AjaxPopup",consts:{DEFAULT_HTML:'<div class="ep-infobox"><b class="shim"><b class="t"></b><b class="b"></b><b class="l"></b><b class="r"></b><b class="tl"></b><b class="tr"></b><b class="bl"></b><b class="br"></b><b class="lv"><div class="om"></div></b></b><div class="content"><div class="infobox-content ajax-popup-loading"></div></div></div>'},options:{hideOnMouseLeave:true,hideOnAnchorClick:true,stickyDuration:0.75,showBeforeLoad:true,loadDelay:0.5,showFxOptions:{duration:0.2,delay:0.2},hideFxOptions:{duration:0,delay:0.01},ajaxPanelOptions:{overlay:true,requestManagerOptions:{useCaching:true}}},prototype:{_init:function($super){$super();
this.el.setStyle("position:absolute").appendTo(document.body).hide();this.el.id="ep_program_info_popup";Dtv.app.el.behavior("ProgramCtaLinks")},_initEvents:function($super){$super();this.onDom(this.el,"click",".js-ProgramCtaLinks-showVideo",this.hide.bind(this).ignoreEvent())},show:function($super,animate){if($super(animate)||this.options.showBeforeLoad){this._updatePosition()}},_setTarget:function(targetEl,options){if(typeof(options)=="boolean"){options={hidePoster:options}}options=options||{};this.useFixedPopup=!!options.useFixedPopup;
var li=targetEl.up("li"),ctlTup=$("ctl_tup");var data=options.data||li.getVar("programInfoPopupData")||li.getVar("data");if(data&&data.tmsProgramId){this.load("/entertainment/component/programInfoPopup.jsp",{parameters:$extend(data,{ajax:true,programid:data.tmsProgramId,hidePoster:options.hidePoster,darkTheme:(ctlTup&&ctlTup.hasClassName("dark-theme"))})},this.DEFAULT_HTML)}else{this.debug("Could not show info pop - no data found",null,"warn")}},_prepareAjaxContent:function(){if(Prototype.Browser.MobileWebKit&&$("ep_program_info_popup").getStyle("position")=="fixed"){this.el.select(".js-ProgramCtaLinks-showVideo").each(function(a,i){a._href=a.href;
a.href="javascript:return false;"})}},_updatePosition:function(){var pos=this._targetEl.cumulativeOffset(),h=this.el.getHeight(),w=this.el.getWidth(),left=pos.left+this._targetEl.getWidth()+11,top=pos.top;var vpHeight=document.viewport.getHeight();var vpWidth=Math.max(document.viewport.getWidth(),$("dtv_tup").getWidth());var scrollOffsets=document.viewport.getScrollOffsets();var bottomBound=vpHeight+scrollOffsets.top;var targetH=this._targetEl.getHeight();var beakH=null;var isGuide=this._targetEl.up("#guide_grid")!=null;
var isCarousel=false;if(targetH<=40){var centerVPoint=(h-targetH)/2;top=pos.top-centerVPoint;if(top+h>bottomBound){top-=(((top+h)-bottomBound)+10)}else{if(top<scrollOffsets.top){top=scrollOffsets.top+10}}var offset=pos.top-top;beakH=offset+(targetH/2);left=left+12}else{var spacingOffset=30;var beakOffset=35;isCarousel=true;top=pos.top+spacingOffset;beakH=beakOffset;if(top+h>bottomBound||this.useFixedPopup){top=pos.top-h+targetH-(spacingOffset*2);beakH=h-beakOffset}}var vEl=this.el.down("b.lv, b.rv");
if(vEl){vEl.show();var leftMargin=10;if(left+w>=vpWidth-leftMargin){left=pos.left-w-11;if(left<leftMargin&&!isCarousel){left=leftMargin}vEl.className="rv";if(isGuide){left+=3}}else{vEl.className="lv";if(isGuide){left-=10}}if(beakH){if(beakH>5&&beakH<h-5){vEl.setStyle({top:beakH+"px"})}else{vEl.hide()}}if(isCarousel&&vEl.down(".om")!=null){vEl.down(".om").show()}}if(this.useFixedPopup){}this.el.setStyle({left:left+"px",top:top+"px",position:this.useFixedPopup?"fixed":"absolute"})}}};var programCtaLinksDef={name:"ProgramCtaLinks",prototype:{_init:function(){Dtv.app.el.behavior("SocialSharing")
},_initEvents:function(){this.onDom(this.el,"click",{".js-ProgramCtaLinks-sendRequest":this._handleSendRequest,".js-ProgramCtaLinks-showVideo":this._handleShowVideo,".js-ProgramCtaLinks-showInlineRecordLightbox":this._handleShowInlineRecordLightbox},this)},_clickedTitles:{},_handleShowInlineRecordLightbox:function(e,clickedEl){var data=clickedEl.getVar("showInlineRecordLightbox")||clickedEl.getVar("data");var that=this;if(!!data){var tmsId=data.tmsId||data.tmsProgramId;if(tmsId){e.preventDefault();
if(!(!!this._clickedTitles[tmsId])){var href=clickedEl.href;var nonLinear=(!!data.nonLinear)?data.nonLinear:"false";this._clickedTitles[tmsId]=href;var params=$H({programid:tmsId,nonLinear:nonLinear});if(data.dataMode=="request"){params.update(data)}new Ajax.Request("/entertainment/data/quickRecordUrl.json.jsp?"+params.toQueryString(),{onSuccess:function(response){that._clickedTitles[tmsId]=null;if(!!response.responseJSON){var inlineRecordUrl=response.responseJSON.quickRecordUrl;if(!!inlineRecordUrl){that._showRequestLightbox(inlineRecordUrl+"&omnitureReferrer=IC&inline=true"+(data.additionalParams||""))
}else{window.location.href=href}}},onFailure:function(){window.location.href=href}})}}}},_handleShowVideo:function(e,clickedEl){var data=clickedEl.getVar("videoData");data.sharingEl=clickedEl.up().down(".js-VideoPlayer-mediaSharing");if(data.isProtected){if(!Dtv.app.getLoginInfo().pgwsAuthorized){if(!clickedEl.href){Dtv.app.showLoginLightbox(function(){window.location.reloadWithParams({autoClick:"ctaWatchNow"})},true)}else{if(clickedEl._href){window.location.href=clickedEl._href}}return}else{if(Prototype.Browser.IsMobile){Dtv.Util.Mobile.handleMediaPlayback(data);
e.preventDefault();return}}}Dtv.app.cmsModule.getVideoLightbox().show(data);e.preventDefault()},_handleSendRequest:function(e,clickedEl){e.preventDefault();var options=clickedEl.getVar("sendRequest")||{};var detailsUrl=options.detailsUrl||clickedEl.href;if(!options.url&&!detailsUrl){throw this.debug(new RangeError("url is missing")).error}var loginInfo=Dtv.app.getLoginInfo();var secure=!!options.secure;if((secure&&loginInfo.pgwsAuthorized&&loginInfo.securedCustomer)||(!secure&&loginInfo.pgwsAuthorized)){if(clickedEl.hasClassName("js-use-spinner")){Dtv.app.waitButton(clickedEl)
}if(options.url){this._showRequestLightbox(options.url.unescapeHTML())}else{window.location.href=detailsUrl.unescapeHTML()}}else{if(detailsUrl){window.location.href=detailsUrl.unescapeHTML()}else{var params={};if(clickedEl.hasClassName("js-autoclick-ctaRecord")){params.autoClick="ctaRecord"}else{if(clickedEl.hasClassName("js-autoclick-ctaRecordEpisode")){params.autoClick="ctaRecordEpisode"}else{if(clickedEl.hasClassName("js-autoclick-ctaRecordSeries")){params.autoClick="ctaRecordSeries"}else{if(clickedEl.hasClassName("js-autoclick-ctaOrder")){params.autoClick="ctaOrder|ctaWatchNow"
}else{if(clickedEl.id){params.autoClick=clickedEl.id}}}}}Dtv.app.showLoginLightbox(function(){window.location.reloadWithParams(params)},true)}}},_showRequestLightbox:function(url,json){if(!url){throw new RangeError("url is empty")}var progLinks=this;var reviewFormOptions={suppressMessageUpdatesOnSuccess:true,onSubmitSuccess:function(fc,json){if(json.nextLightboxUrl){Dtv.Behaviors.Lightbox.queue(progLinks._showRequestLightbox.bind(progLinks,json.nextLightboxUrl,json))}else{if(json.reloadPage){fc._messagesEl=$$("#dtv_body_tup .js-message-container")[0];
fc.setMessages(json.messageLevel,json.messages);if(json.handlerName=="ajaxOrderPpv"&&json.reportingData){var reportingData=json.reportingData[0].data;var programTitle=reportingData.programTitle;var purchasePrice=reportingData.price;var titleId=reportingData.titleId;eval("mboxUpdate('OCP_PPV_CSS','title="+programTitle+"','price="+purchasePrice+"','titleId="+titleId+"');")}if(json.handlerName=="ajaxOrderPpv"&&json.success&&json.reportingData){var programType="";for(var i=0,j=json.reportingData.length;
i<j;i++){var currentItem=json.reportingData[i];if(!!currentItem.data.programType){programType=currentItem.data.programType;break}}if(programType==="S"){var beforeOrderCtaEl=$("beforeOrderCta");var afterOrderCtaEl=$("afterOrderCta");var beforeOrderShowTimesCtaEl=$("beforeOrderShowTimesCta");var afterOrderShowTimesCtaEl=$("afterOrderShowTimesCta");var beforeOrderDescEl=$("beforeOrderDesc");var afterOrderDescEl=$("afterOrderDesc");var beforeOrderShowTimesDescEl=$("beforeOrderShowTimesDesc");var afterOrderShowTimesDescEl=$("afterOrderShowTimesDesc");
var showVideo=$("showVideo");if(!!beforeOrderCtaEl){beforeOrderCtaEl.hide()}if(!!afterOrderCtaEl){afterOrderCtaEl.show()}if(!!beforeOrderShowTimesCtaEl){beforeOrderShowTimesCtaEl.hide()}if(!!afterOrderShowTimesCtaEl){afterOrderShowTimesCtaEl.show()}if(!!beforeOrderDescEl){beforeOrderDescEl.hide()}if(!!afterOrderDescEl){afterOrderDescEl.show()}if(!!beforeOrderShowTimesDescEl){beforeOrderShowTimesDescEl.hide()}if(!!afterOrderShowTimesDescEl){afterOrderShowTimesDescEl.show()}if(!!showVideo){showVideo.simulate("click")
}}}}}},onSubmitFailure:function(){var msg=$("review_info_msg");if(msg){msg.hide()}}};Dtv.app.ajaxLightbox.show(url,{onInitContent:function(){this.el.behavior("ProgramFavoriteLink");if(this.el.getVar("isStreaming")&&!Prototype.Browser.MobileSafari){var plugins=CMPPluginDetection.getInstance();var msgKey=null;if(plugins.isBrowserSupported()==2){if(!plugins.isOSSupported()){msgKey="ep.player.browser_os_unsupported.message"}else{msgKey="ep.player.browser_unsupported.message"}}else{if(!plugins.isOSSupported()){msgKey="ep.player.os_unsupported.message"
}else{if(!plugins.isProtectedPlayerInstalled()){msgKey="ep.player.install.message"}else{if(!plugins.isFlashPlayerInstalled()){msgKey="ep.player.flash_plugin.message"}}}}if(msgKey){$("lb_order_ppv_message_container").behavior("VideoPlayer.MessageContainer",{tmsId:Dtv.app.el.getVar("tmsId")}).setMessageKeys("warning",[msgKey],{useFx:true});this.refreshLayout.bind(this).delay(0.3)}}},forms:{"#orderPpvConfirmForm, #recordConfirmForm":{onInit:function(fc){if(json){fc.setMessages(json.messageLevel,json.messages)
}}},"#orderPpvForm":{onInit:function(fc,container){var addCcLink=null;var addCheckingLink=null;var newCcCloseBtn=null;var newEftCloseBtn=null;var savedCcDiv=null;var savedEftDiv=null;var newCcDiv=$("ppv_section_newcc");var newEftDiv=$("ppv_section_neweft");var ccRadioBtn=$("rb_paymentMethod_cc")||$("rb_paymentMethod_newcc");if(ccRadioBtn==$("rb_paymentMethod_cc")){addCcLink=$("add-cc-link");newCcCloseBtn=$("ppv_newcc_close");savedCcDiv=$("ppv_section_cc")}var eftRadioBtn=$("rb_paymentMethod_eft")||$("rb_paymentMethod_neweft");
if(eftRadioBtn==$("rb_paymentMethod_eft")){addCheckingLink=$("add-checking-link");newEftCloseBtn=$("ppv_neweft_close");savedEftDiv=$("ppv_section_eft")}var currentSection=null;fc.on("change",function(e){if(e.memo.field.isAtgField(".paymentMethod")){if(currentSection){currentSection.hide()}currentSection=$("ppv_section_"+e.memo.field.el.value.toLowerCase());if(currentSection==$("ppv_section_neweft")&&eftRadioBtn==$("rb_paymentMethod_eft")){currentSection=$("ppv_section_eft")}if(currentSection==$("ppv_section_newcc")&&ccRadioBtn==$("rb_paymentMethod_cc")){currentSection=$("ppv_section_cc")
}currentSection.show()}});var firstPaymentRadio=fc.getField("rb_paymentMethod_cc")||fc.getField("rb_paymentMethod_eft")||fc.getField("rb_paymentMethod_ledger");if(firstPaymentRadio){firstPaymentRadio.el.click()}var verisignSeal=$("verisign_seal");if(verisignSeal&&verisignSeal.empty()){verisignSeal.update($("verisign_call").innerHTML)}if(addCcLink){addCcLink.on("click",function(e){savedCcDiv.hide();newCcDiv.show();ccRadioBtn.value="newCC";currentSection=lastSection=$("ppv_section_newcc")})}if(addCheckingLink){addCheckingLink.on("click",function(e){savedEftDiv.hide();
newEftDiv.show();eftRadioBtn.value="newEFT";currentSection=$("ppv_section_neweft")})}if(newCcCloseBtn){newCcCloseBtn.on("click",function(e){newCcDiv.hide();savedCcDiv.show();ccRadioBtn.value="CC";currentSection=lastSection=$("ppv_section_cc")})}if(newEftCloseBtn){newEftCloseBtn.on("click",function(e){newEftDiv.hide();savedEftDiv.show();eftRadioBtn.value="EFT";currentSection=$("ppv_section_eft")})}},options:reviewFormOptions},"#recordProgramForm":{options:reviewFormOptions}}})}}};var socialSharingDef={name:"SocialSharing",maxInstances:1,prototype:{_init:function(){Dtv.app.socialSharing=this
},_initEvents:function(){this.onDom(this.el,"macro:click",".js-SocialSharing-shareOnTwitter",this.shareOnTwitter.bind(this));this.onDom(this.el,"macro:click",".js-SocialSharing-shareOnEmail",this.genericShare.curry("email").bind(this))},shareOnTwitter:function(e,el){var data=this._getData(el);var options=data.twitter;document.fire(DTV_REPORTING_SHARE,{type:"twitter",data:data});Dtv.Util.Social.Twitter.share(options.message,options.tinyUrl||options.url,!options.tinyUrl);if(e){e.stop()}},genericShare:function(type,e,el){var data=this._getData(el.dom);
document.fire(DTV_REPORTING_SHARE,{type:type,data:data})},_getData:function(el){return el.getVar("socialSharingData")||this.el.getVar("socialSharingData")}}};var favoriteLinkDef={name:"FavoriteLink",options:{selectorPrefix:"",rolloverIds:{add:"favs_rollover_add",remove:"favs_rollover_remove",maxReached:"favs_rollover_maxreached"}},prototype:{_initEvents:function(){this.onDom(this.el,"macro:click",this._getSelector("toggleFav:not(.disabled, .updating)"),this.toggleFav.bind(this));this._getFavsRequestManagers().each(function(rm){if(rm){this.addDisposableObjs(rm.on({favchanged:this._handleFavChanged,allfavsremoved:this._handleAllFavsRemoved,maxreachedchanged:this._handleMaxReachedChanged},this))
}}.bind(this))},_handleMaxReachedChanged:function(e){var favEl=this._getFavEl();if(favEl){if(e.memo.maxReached){if(!favEl.hasClassName("active")){if(this.options.rolloverIds){Dtv.app.rollovers.setRollover(favEl,this.options.rolloverIds.maxReached)}favEl.disable()}}else{favEl.enable();if(this.options.rolloverIds){Dtv.app.rollovers.setRollover(favEl,this.options.rolloverIds[favEl.hasClassName("active")?"remove":"add"])}}}},_handleFavChanged:function(e){if(this._isSameFav(e.memo.params)){var favEl=this._getFavEl();
if(favEl){favEl.removeClassName("updating");favEl.toggleClassName("active");if(this.options.rolloverIds){Dtv.app.rollovers.setRollover(favEl,this.options.rolloverIds[favEl.hasClassName("active")?"remove":"add"])}}}},_handleAllFavsRemoved:function(e){var el=this._getFavEl();if(el){el.removeClassName("active");if(this.options.rolloverIds){Dtv.app.rollovers.setRollover(favEl,this.options.rolloverIds.remove)}}},toggleFav:function(){var favEl=this._getFavEl();if(!favEl.hasClassName("updating")){favEl.addClassName("updating");
this._getFavsRequestManager().toggleFav(this._getData().favParams,!favEl.hasClassName("active"))}},_isSameFav:function(params){var data=this._getData().favParams;var same=true;for(paramName in params){if(paramName!="tealeafid"){if(!data[paramName]||data[paramName]!=params[paramName]){same=false;break}}}return same},_getFavEl:function(){return this.el.down(this._getSelector("toggleFav"))},_getFavsRequestManager:function(){return Dtv.RequestManager.instances.get(this.options.favType+"favs")},_getFavsRequestManagers:function(){return[this._getFavsRequestManager()]
},_getData:function(){return this.el.getVar("favoriteLinkData")},_getSelector:function(suffix){return".js-"+this.options.selectorPrefix+"FavoriteLink-"+suffix}}};var programFavoriteLinkDef={name:"ProgramFavoriteLink",inherits:"FavoriteLink",options:{selectorPrefix:"Program",rolloverIds:{add:"favs_pg_rollover_add",remove:"favs_pg_rollover_remove",maxReached:"favs_pg_rollover_maxreached"}},prototype:{_getFavsRequestManager:function(){return Dtv.RequestManager.instances.get(this._getData().isMovie?"moviesfavs":"tvseriesfavs")
},_getFavsRequestManagers:function(){return[Dtv.RequestManager.instances.get("moviesfavs"),Dtv.RequestManager.instances.get("tvseriesfavs")]}}};var programListInfoPopControllerDef={name:"ProgramListInfoPopController",options:{activateEventName:"mouseover",targetSelector:"dl",mobileTargetSelector:"dd.image a:not(.remove)",hidePoster:true,mouseOverValidator:null,useFixedPopup:false},prototype:{_init:function(){Dtv.app.el.behavior("ProgramCtaLinks")},_initEvents:function(){this.onDom(this.el,this.options.activateEventName,this.options.targetSelector,this._handleItemMouseOver.bind(this));
if(Prototype.Browser.MobileWebKit){if(this.el.up(".utility_bar_popup")){this.el.select(this.options.mobileTargetSelector).each(function(a,i){a._href=a.href;a.href="javascript:return false;"})}this.onDom(this.el,"click",this.options.mobileTargetSelector,this._handleMobileImageClick.bind(this));Dtv.app.cmsModule.getProgramInfoBoxPopup().on("hide",this._handleInfoBoxHide.bind(this))}},_handleInfoBoxHide:function(){this._lastMobileClickedEl=null},_handleMobileImageClick:function(e,itemEl){if(this._lastMobileClickedEl!=itemEl){this._lastMobileClickedEl=itemEl;
e.preventDefault()}else{if(itemEl._href){window.location.href=itemEl._href}}},_handleItemMouseOver:function(e,itemEl){if(!this.options.mouseOverValidator||this.options.mouseOverValidator(itemEl)){Dtv.app.cmsModule.getProgramInfoBoxPopup().setTarget(itemEl,{hidePoster:this.options.hidePoster,useFixedPopup:this.options.useFixedPopup})}}}};var epFeedListDef={name:"EpFeedList",prototype:{_init:function(){this._truncateLongTitles();Dtv.app.el.behavior("SocialSharing");this.el.behavior("ProgramListInfoPopController",{targetSelector:"dt a",mobileTargetSelector:"dt a",hidePoster:false});
if(modid&&modid!=null){adjustCarouselListModuleItemHeights(modid,colspan)}},_truncateLongTitles:function(){this.el.select("dt a").each(function(el){Dtv.Util.truncateElementText.defer(el)})}}};var epCarouselDef={name:"EpCarousel",options:{visibleCount:6,itemOffset:106,cacheSize:3,infinite:true,listTagName:"ul",orientation:"horizontal",updateDelay:0,carouselIndex:null,enableInfoHoverBehavior:true,fxOptions:{duration:0.5,transition:Effect.Transitions.Pow.easeOut.custom(3)}},prototype:{_init:function($super){if(this.options.enableInfoHoverBehavior){this.el.behavior("ProgramListInfoPopController",{useFixedPopup:this.options.useFixedPopup})
}var renderedListType="PreRenderedList";var carouselCssClass=this.el.className;var listEl=this.el.down(".ep-carousel-content");if(carouselCssClass.indexOf("ep-carousel-4")!=-1){this.options.colspan=4;this.options.visibleCount=8;this.options.itemOffset=106}else{if(carouselCssClass.indexOf("ep-carousel-3")!=-1){this.options.colspan=3;this.options.visibleCount=6;this.options.itemOffset=106}else{if(carouselCssClass.indexOf("ep-carousel-2")!=-1){this.options.colspan=2;this.options.fxOptions.transition=Effect.Transitions.Pow.easeOut.custom(5);
this.options.visibleCount=4;this.options.itemOffset=100}else{if(carouselCssClass.indexOf("ep-carousel-1-single")!=-1){this.options.colspan=1;this.options.visibleCount=1;this.options.itemOffset=95;this.options.fxOptions.duration=0.5;this.options.fxOptions.transition=Effect.Transitions.Pow.easeOut.custom(3);this.options.cacheSize=1}else{if(carouselCssClass.indexOf("ep-carousel-1")!=-1){this.options.colspan=1;this.options.groupSize=1;this.options.visibleCount=3;this.options.itemOffset=95;this.options.fxOptions.duration=0.5;
this.options.fxOptions.transition=Effect.Transitions.Pow.easeOut.custom(5);this.options.cacheSize=1;this.options.infinite=listEl.select("li").length>=3;renderedListType="EpCarousel.SingleColPreRenderedList"}}}}}this.list=listEl.behavior(renderedListType,this.options);var defaultNdx=this.el.getVar("carouselIndex");if(defaultNdx>0){this.list.moveToPosition(defaultNdx,true)}if(this.list.getTotalCount()>0){this.el.down(".ep-carousel-prev").show();this.el.down(".ep-carousel-next").show()}if(this.options.colspan==1&&this.list.getTotalCount()<this.options.visibleCount){this.el.addClassName("ep-carousel-1-single")
}this.disableTextSelection();this._updateButtons();if(Prototype.Browser.Gecko&&Prototype.X.Browser.Firefox<7){this._truncateLongTitles()}},_initEvents:function(){this.onDom(this.el,"macro:click",{".ep-carousel-prev:not(.disabled)":this.list.moveToPreviousGroup.ignoreEvent(),".ep-carousel-next:not(.disabled)":this.list.moveToNextGroup.ignoreEvent()},this.list);if(Prototype.Browser.MobileWebKit){if(this.list.getTotalCount()>this.options.visibleCount){this.onDom(this.el,{"macro:swiperight":this.list.moveToPreviousGroup.ignoreEvent(),"macro:swipeleft":this.list.moveToNextGroup.ignoreEvent()},this.list)
}}if(!this.options.infinite){this.list.on("indexchanged",this._updateButtons.bind(this))}},_getDisplayActionName:function(){return this.list.getGroupCount()>1?"enable":"disable"},_updateButtons:function(){var displayAction=this._getDisplayActionName();var prevEl=this.el.down(".ep-carousel-prev");var nextEl=this.el.down(".ep-carousel-next");if(prevEl){prevEl[displayAction]();if(!this.options.infinite){prevEl[this.list.currentIndex==0?"disable":"enable"]()}}if(nextEl){nextEl[displayAction]();if(!this.options.infinite){nextEl[this.list.isAtEnd()?"disable":"enable"]()
}}},_truncateLongTitles:function(){this.el.select("dd.title-short a").each(function(titleEl){titleEl.setStyle({whiteSpace:"normal"});Dtv.Util.truncateElementText(titleEl)})}}};var epCarouselSingleColPreRenderedListDef={name:"EpCarousel.SingleColPreRenderedList",inherits:"PreRenderedList",prototype:{_init:function($super){$super();if(!this.options.infinite){this._data.insert(0,this._createPlaceholder());this._data.push(this._createPlaceholder())}this._renderList()},_createPlaceholder:function(){return new Element("li").update('<dl class="placeholder"></dl>')
},_getDisplayActionName:function(){return this.list.getTotalCount()>3?"enable":"disable"}}};var dayListingsDef={name:"DayListings",prototype:{_init:function(){this._dropdownEl=this.el.down(".listings-date-dropdown");if(this._dropdownEl){$("listings_data_view").setStyle({minHeight:(this._dropdownEl.select("li").length+2)*24+"px"})}},_initEvents:function(){if(this._dropdownEl){this.onDom(this._dropdownEl,"click",{"li a":this._handleDayChange},this);this.onDom(this._dropdownEl,{mouseover:this._handleMouseOver,mouseout:this._handleMouseOut},this)
}},_handleDayChange:function(e,linkEl){var ndx=linkEl.up().getSiblingIndex();var dateLabel=$("listings_data_content").down("h4");var airingsEl=$("listings_airings");this._dropdownEl.select("li a").each(function(links){links.removeClassName("active")});linkEl.addClassName("active");dateLabel.innerHTML=linkEl.innerHTML;airingsEl.childElements().invoke("hide");airingsEl.childElementAt(ndx).show();this._dropdownEl.down("ul").hide()},_handleMouseOver:function(e){this._dropdownEl.down("ul").show()},_handleMouseOut:function(e){}}};
Dtv.Behaviors.create(programInfoPopupDef,socialSharingDef,favoriteLinkDef,programFavoriteLinkDef,programCtaLinksDef,programListInfoPopControllerDef,epFeedListDef,epCarouselDef,epCarouselSingleColPreRenderedListDef,dayListingsDef)})();(function(){var j=Class.create(Dtv.RequestManager,{getNumChannels:function(){return this.channelData?this.channelData.channels:null},getAlphaChannels:function(){if(!this._alphaChannels){if(!this.channelData){return null}this._alphaChannels=this.channelData.channels.clone().sort(function(b,d){if(!Object.isString(b.chCall)){return 1
}if(!Object.isString(d.chCall)){return -1}var c=(b.chCall||b.chName).toUpperCase(),a=(d.chCall||d.chName).toUpperCase();if(c==a){return b.chNum==d.chNum?0:b.chNum<d.chNum?-1:1}return c<a?-1:1})}return this._alphaChannels},getChannels:function(){if(!this._sort){throw"Sort has not been set"}return this._sort=="NUMERIC"?this.getNumChannels():this.getAlphaChannels()},getSort:function(){return this._sort},setSort:function(a){if(this._sort!=a){this._sort=a;this.fireEvent("sortchanged",{sort:a})}},isFavoritesView:function(){return this._channelParams&&this._channelParams.view=="FAVORITES"
},isMyChannelsView:function(){return this._channelParams&&this._channelParams.view=="MY"},requestChannels:function(a){if(!this._channelParams){this._channelParams=a}else{if(a){$extend(this._channelParams,a)}}if(this.isFavoritesView()){this._channelParams.favtype="channels"}else{delete this._channelParams.favtype}if(this._channelParams.channelnumbers&&this._channelParams.channelnumbers.length>0){this._channelParams.listType="custom"}else{delete this._channelParams.listType}var a=Object.clone(this._channelParams);
if(!!$("ctl_tup")&&$("ctl_tup").hasClassName("dark-theme")){a.logoType="web_grid_dark";a.logoTheme="dark"}if(a.channelnumbers){a.channelnumbers=a.channelnumbers.join(",")}this.channelData=null;var b=this;this.request("/entertainment/data/guideChannelList.json.jsp",{eventName:"channels",parameters:a,onSuccess:function(c){if(c.responseJSON){b.channelData=c.responseJSON;b._alphaChannels=null}},onValidateSuccess:function(d){var c=d.responseJSON;if(!c||!c.success){return false}if(!c.channels){if(b.isFavoritesView()){b.fireEvent("requestchannelsnofavs")
}return false}return true}})},requestSchedule:function(f,e,b){this.scheduleData=null;this._scheduleParams={startDate:f,channelStartIndex:e,queryParams:b};var c=this.getChannels().slice(e,e+this.options.numChannels);var a={scheduleType:"custom",starttime:f.toFormat("Y-M-D R:I"),channelnumbers:c.pluck("chNum").join(),authorizedonly:(this.isMyChannelsView())?"true":"",blockduration:Math.ceil(this.options.blockHours)};if(this._sort=="ALPHA"){a.sortby="ChlName"}$extend(a,b);var d=this;this.request("/entertainment/data/guideScheduleSegment.json.jsp",{eventName:"schedule",parameters:a,onSuccess:function(n){if(n.responseJSON){d.scheduleData=d._sortScheduleDataByCustomOrder(c,n.responseJSON);
d.scheduleData.startDate=f}},onValidateSuccess:function(n){return n.responseJSON.success&&n.responseJSON.channels}})},_sortScheduleDataByCustomOrder:function(f,a){function b(m){return m.chNum+"_"+m.chHd}if(this._sort=="ALPHA"){if(a&&a.channels){var q=f.length;var e=new Array(q);for(var c=0;c<q;c++){var d=b(f[c]);for(var n=0;n<a.channels.length;n++){if(b(a.channels[n])==d){e[c]=a.channels[n];break}}}a.channels=e}}return a},updateSessionValue:function(c,b){var a={};a[c]=b;new Ajax.Request("/entertainment/data/updateSession.jsp",{parameters:a})
}});var k={name:"ChannelGuide",maxInstances:1,options:{blocksPerDay:8,blockHours:3,totalDays:14,numChannels:10,channelHeight:41},prototype:{_init:function(){Dtv.app.channelGuide=this;$extend(this.options,this.el.getVar("serverOptions"));if(!this.options.halfHourWidth){if($("guide_grid").getWidth()){this.options.halfHourWidth=Math.ceil($("guide_grid").getWidth()/this.options.blockHours/2)}else{this.options.halfHourWidth=Math.ceil(parseInt($("guide_grid").getStyle("width"))/this.options.blockHours/2)
}}this.requestManager=new j($extend({name:"channelGuideData"},this.options));this.timeline=$("guide_timeline").behavior("ChannelGuide.Timeline",this.options);this.channelBar=$("guide_nav_channels").behavior("ChannelGuide.ChannelBar",this.options);this.dataView=$("guide_grid").behavior("ChannelGuide.DataView",this.options);this.addDisposableObjs([this.requestManager,this.timeline,this.channelBar,this.dataView]);this._noFavsMessage=$("guide_favorites_message");this._settingsMenuEl=$("guide_settings_menu");
if(this._settingsMenuEl){this._settingsMenuEl.down("form").reset()}this.disableTextSelection();Dtv.app.el.behavior("SocialSharing")},_initEvents:function(){this.channelBar.on("updating",this._handleChannelBarUpdating.bind(this));this.timeline.on("updating",this._handleTimelineUpdating.bind(this));this.channelBar.on("updated",this._updateDataView.bind(this));this.timeline.on("updated",this._updateDataView.bind(this));this.onDom(this.el,"click",{"#guide_favorites_message a":this._handleFavMessageLinkClick,"#guide_settings_menu_trigger":this._handleMenuTriggerClick,"div.guide-dropdown-trigger":this._handleMenuTriggerClick},this);
if(this._settingsMenuEl){this.onDom(this._settingsMenuEl,"click",{"#guide_settings_bar ul li>a":this._handleSettingsBarMenuItemClick,"#guide_settings_views a":this._handleViewSettingsClick,"#guide_settings_sort a":this._handleSortSettingsClick,"#guide_settings_highlight a":this._handleHighlightSettingsClick,"#flag_hide_sd":this._handleHideChannelsSettingsClick.curry("no_sd_dups"),"#flag_hide_hd":this._handleHideChannelsSettingsClick.curry("no_hd"),"#guide_settings_menu":function(b){var a=b.element().id;
if(a!="flag_hide_sd"&&a!="flag_hide_hd"){b.stop()}}},this);this.onDom(this._settingsMenuEl,"mouseover",{"#guide_settings_bar #guide_settings_menu>ol>li:not(.non-menu)":function(a,b){b.addClassName("mouseover");b.addClassName("hover")}},this);this.onDom(this._settingsMenuEl,"mouseout",{"#guide_settings_bar #guide_settings_menu>ol>li":function(a,b){b.removeClassName("mouseover");var c=setInterval(function(){clearInterval(c);if(!b.hasClassName("mouseover")){b.removeClassName("hover")}},50)}},this)}this.onDom(document,"click",this._hideMenu,this);
this.requestManager.on({requestchannelssuccess:this._noFavsMessage.hide.ignoreEvent(),requestchannelsnofavs:this._noFavsMessage.show.ignoreEvent()},this._noFavsMessage)},_initDefaultState:function(){this.requestManager.requestChannels(this.el.getVar("channelParams"));var a=this.el.getVar("defaults");this.setHighlight(a.highlightType);this.requestManager.setSort(a.sort);this.timeline.moveToNow()},_handleSettingsBarMenuClick:function(a,b){if(!b.hasClassName("hide-sd")){if(b.hasClassName("non-menu")){this._hideMenu()
}else{if(b.hasClassName("active")){b.removeClassName("active")}else{this._hideMenu();b.addClassName("active")}}}},_handleSettingsBarMenuItemClick:function(a,b){var c=b.up("ul").previous("h5");if(c){c.update(b.innerHTML)}(function(){var d=b.up("li.hover");if(d){d.removeClassName("hover")}}).defer()},_handleMenuTriggerClick:function(a,b){if(!b.menuEl){b.menuEl=$(b.id.replace("_trigger",""))}if(b.menuEl.visible()){this._hideMenu();return}this._showMenu(b);a.stop()},_handleHideChannelsSettingsClick:function(c,a,b){this.requestManager.updateSessionValue("hideDupes",b.checked);
this.requestManager.requestChannels({hideDupes:b.checked});this._hideMenu();a.abandon=true},_handleHighlightSettingsClick:function(a,c){var e=h(c);if(!e){return}var d=e.getVar("highlightInfo");this.setHighlight(d.type);var f=$("guide_settings_highlight_info"),b=$("guide_settings_timezone_info");if(f&&b){if(!d.label){f.hide();b.show()}else{f.down("p").innerHTML=d.label;f.show();b.hide()}}this.requestManager.updateSessionValue("highlight",d.type);this._hideMenu()},_handleSortSettingsClick:function(a,b){var c=h(b);
if(!c){return}this.requestManager.updateSessionValue("sort",c.getVar("sort"));this.requestManager.setSort(c.getVar("sort"));this._hideMenu()},_handleViewSettingsClick:function(a,b){var d=h(b);if(!d){return}var c=d.getVar("view");this.requestManager.updateSessionValue("view",d.getVar("view"));this.requestManager.requestChannels({view:c});this._hideMenu()},_handleFavMessageLinkClick:function(a){this.dataView.slide("down");$("guide_error_message").hide();this._noFavsMessage.hide();this.el.down("#guide_settings_views li a").simulate("click")
},_handleTimelineUpdating:function(a){this.requestManager.cancel("schedule");if(a.memo.direction){this.dataView.slide(a.memo.direction)}},_handleChannelBarUpdating:function(a){this.requestManager.cancel("schedule");if(a.memo.direction){this.dataView.slide(a.memo.direction)}},setHighlight:function(b){var a=$("guide_tup");if(this._highlightClassName){a.removeClassName(this._highlightClassName)}this._highlightClassName="hl-"+b.toLowerCase();a.addClassName(this._highlightClassName)},showZipCodeWarning:function(a){$("guide_zip_warning").removeClassName("no-locals").removeClassName("no-zip").addClassName(a).show()
},_updateDataView:function(){if(!this.channelBar.isUpdating&&!this.timeline.isUpdating){this.requestManager.requestSchedule(this.timeline.getDateFromBlockIndex(),this.channelBar.getCurrentIndex(),this._params);return true}return false},_showMenu:function(b){if(!b.menuEl.visible()){this._hideMenu();b.addClassName("active");var a={top:b.measure("top")+b.getHeight()-2,left:b.measure("left")-1};var e=b.viewportOffset();var c=document.viewport.getWidth()-50;var d=e.left+b.menuEl.getWidth();if(d>=c){a.left=c-d
}b.menuEl.setStyle({top:a.top+"px",left:a.left+"px"}).show()}},_hideMenu:function(){var a=this.el.down("#guide_settings_menu_trigger.active, div.guide-dropdown-trigger.active, #guide_day_select_menu_trigger.active");if(a){a.menuEl.hide();a.removeClassName("active")}this.el.select("#guide_settings_bar #guide_settings_menu ol>li.active").invoke("removeClassName","active")}}};var l={name:"ChannelGuide.Timeline",consts:{EVENTS:{UPDATING:"updating",UPDATED:"updated"}},options:{},prototype:{_init:function(){this._serverParams=this.el.getVar("serverParams");
this._minDate=Date.fromUTCStr(this._serverParams.minDate,this._serverParams.tzOffset);this._minDate.setHours(0);this._maxDate=this._minDate.clone();this._maxDate.increment("day",this.options.totalDays);this._maxDate.increment("minutes",-1);this.isUpdating=false;var a={totalCount:this.options.totalDays*48,visibleCount:this.options.blockHours*2,groupSize:(24/this.options.blocksPerDay)*2,itemOffset:this.options.halfHourWidth,orientation:"horizontal"};this._timeScroller=this.el.down("#guide_top_hours_bar div.guide-hours-list").behavior("RenderedList",a);
var b=this.el.down("#guide_btm_hours_bar div.guide-hours-list");if(b){this._btmTimeScroller=b.behavior("RenderedList",a)}this._datesBarEl=$("guide_timeline");if(this._datesBarEl){this._datesBarOffsetX=this._datesBarEl.cumulativeOffset().left-this._datesBarEl.positionedOffset().left;this._datesBarTimeblockOffsetX=-33}this._datesListEl=$("guide_dates_list");this._datesMenuEl=$("guide_dates_menu");this._datesMenuTriggerEl=$("guide_dates_menu_trigger");this._timeslotLabels=[];var d=new Date(1970,0,1);
for(var c=0;c<48;c++){if(c>0){d.increment("minutes",30)}this._timeslotLabels.push(d.toFormat("h:I A"))}if(this._datesMenuEl){this._renderDatesMenuList()}},_initEvents:function(){this.onDom(this.el,"click",{"a.prev":this._handlePrevBlockClick,"a.next":this._handleNextBlockClick,"#guide_dates_list li li":this._handleTimeBlockClick,"#guide_dates_list li":this._handleDateBlockClick},this);if(!Prototype.Browser.MobileWebKit){this.onDom(this.el,"mouseover",{"#guide_dates_bar li li":this._handleTimeBlockMouseOver},this);
this.onDom(this.el,"mouseout",{"#guide_dates_bar li li":this._handleTimeBlockMouseOut},this)}if(this._datesMenuEl){this.onDom(this._datesMenuEl,"macro:click",{"#guide_dates_list li li":this._handleTimeBlockClick,"#guide_dates_list li":this._handleDateBlockClick},this)}this._timeScroller.on({indexchanged:this._handleTimeScrollerIndexChanged,renderindex:this._handleTimeScrollerRenderIndex},this);if(this._btmTimeScroller){this._btmTimeScroller.on("renderindex",this._handleTimeScrollerRenderIndex.bind(this))
}},_onUpdating:function(a){this.fireEvent(this.EVENTS.UPDATING,{direction:a});this.isUpdating=true},_onUpdated:function(){this.isUpdating=false;this.fireEvent(this.EVENTS.UPDATED)},_handleNextBlockClick:function(a){Dtv.app.rollovers.hide();this.moveToNextBlock()},_handlePrevBlockClick:function(a){Dtv.app.rollovers.hide();this.moveToPreviousBlock()},_handleDateBlockClick:function(a,b){if(!b.match("#guide_dates_list li li")){this.moveToDay(b.getSiblingIndex())}},_handleTimeBlockClick:function(a,b){var c=this._getBlockIndexFromTimeItem(b);
if(c>=this._getNowBlockIndex()){this.moveToBlock(c)}a.abandon=true},_handleTimeBlockMouseOver:function(a,b){if(Prototype.Browser.MobileWebKit){return}var c=this._getBlockIndexFromTimeItem(b);if(c<this._getNowBlockIndex()){b.style.cursor="default";return}b.addClassName("hover");$("block_label").setStyle({left:b.cumulativeOffset().left-this._datesBarOffsetX+this._datesBarTimeblockOffsetX+"px"}).update(b.down("span").innerHTML).show()},_handleTimeBlockMouseOut:function(a,b){b.removeClassName("hover");
$("block_label").hide()},_handleTimeScrollerRenderIndex:function(a){var c=new Element("li").appendTo(a.memo.listEl);c.setStyle({width:this.options.halfHourWidth+"px"});if(a.memo.renderIndex===0){c.addClassName("first")}var b="";if(this.options.blockHours<1){b+=this._getBlockLabelText(this.getCurrentBlockIndex(),false,true)+" "}b+=this._timeslotLabels[a.memo.index%this._timeslotLabels.length];c.update("<span>"+b+"</span>")},_handleTimeScrollerIndexChanged:function(a){try{if(this._btmTimeScroller){this._btmTimeScroller.moveToPosition(a.memo.index)
}var e=this._timeScroller.getGroupIndex(a.memo.index);var b=this._timeScroller.getGroupIndex(a.memo.oldIndex);this._updateDatesListUI(e);if(this._datesMenuTriggerEl){this._datesMenuTriggerEl.down("label").update(this._getBlockLabelText(e,this._datesMenuEl.hasClassName("has-sub-menu")))}if(!this.isUpdating){this._onUpdating(e>b?"right":"left")}var d=this;this.el.select("a.prev").each(function(f){if(e<=d._getNowBlockIndex()){f.disable();Dtv.app.rollovers.setRollover(f,"guide_hours_rollover_prev_disabled")
}else{f.enable();Dtv.app.rollovers.setRollover(f,"guide_hours_rollover_prev")}});this.el.select("a.next").each(function(f){if(d._timeScroller.isAtEnd()){f.disable();Dtv.app.rollovers.setRollover(f,"guide_hours_rollover_next_disabled")}else{f.enable();Dtv.app.rollovers.setRollover(f,"guide_hours_rollover_next")}});clearTimeout(this._updatedTimeout);this._updatedTimeout=this._onUpdated.bind(this).delay(1)}catch(c){this.debug(c,"Failed to handle time scroller index change")}},_renderDatesMenuList:function(){var b=this._datesMenuEl.getVar("subMenu");
var c="";for(var d=0;d<14;d++){var a=d*this.options.blocksPerDay;c+='<li class="day day-'+d+'"><span>';c+=this._getBlockLabelText(a);c+="</span>";if(b){c+="<ul>";for(var e=0;e<this.options.blocksPerDay;e++){c+='<li class="block block-'+e+'"><span>';c+=this._getBlockLabelText(a+e,true,false,true);c+="</span></li>"}c+="</ul>"}c+="</li>"}this._datesListEl.update(c)},_updateDatesListUI:function(d){if(this._datesListEl){this._datesListEl.select("li.active").invoke("removeClassName","active");var a=this._getDayIndex(d);
var c=$("guide_dates_list");var b=this._datesListEl.childElements()[a].addClassName("active");if(b.down("ul")){b.select("li")[this._getTimeIndex(d)].addClassName("active")}}},_getBlockLabelText:function(e,a,r,c){var d=this._getDayIndex(e);var b="";if(!c){if(d==0){b="Today"}else{var s=this._minDate.clone();s.increment("day",d);b=s.toFormat(r?"m/d":"w m/d")}}if(a){if(!c){b+=": "}var q=this._getTimeIndex(e);var t=this._timeslotLabels.length/this.options.blocksPerDay;var f=q*t+(this.options.blockHours*2);
b+=this._timeslotLabels[q*t];b+=" - ";b+=this._timeslotLabels[f<this._timeslotLabels.length?f:0]}return b},_getBlockIndexFromTimeItem:function(a){return a.getSiblingIndex()+(a.up("li").getSiblingIndex()*this.options.blocksPerDay)},_getDayIndex:function(a){return Math.floor(a/this.options.blocksPerDay)},_getTimeIndex:function(a){return a%this.options.blocksPerDay},getCurrentBlockIndex:function(){return this._timeScroller.getGroupIndex()},getServerTzOffset:function(){return this._serverParams.tzOffset
},_getBlockIndexFromDate:function(b){if(b<this._minDate){b=this._minDate.clone();this.debug("date is before minDate",null,"warn")}else{if(b>this._maxDate){b=this._maxDate.clone();this.debug("date is after maxDate",null,"warn")}}var a=(b.getDayOfYear()-this._minDate.getDayOfYear())*this.options.blocksPerDay;var c=Math.floor((b.getHours())/(24/this.options.blocksPerDay));return a+c},getDateFromBlockIndex:function(b){if(!$chk(b)){b=this.getCurrentBlockIndex()}var a=this._minDate.clone();a.increment("day",this._getDayIndex(b));
var c=this._getTimeIndex(b)*(24/this.options.blocksPerDay);a.increment("minutes",c*60);if(a.getTimezoneOffset()!==this._minDate.getTimezoneOffset()){a.increment("minutes",a.getTimezoneOffset()-this._minDate.getTimezoneOffset())}return a},_getNowBlockIndex:function(){var a=new Date();a.increment("hours",(this._minDate.getTimezoneOffset()/60)+this._serverParams.tzOffset);return this._getBlockIndexFromDate(a)},moveToBlock:function(a){this._timeScroller.moveToPosition(a*this._timeScroller.getGroupSize())
},moveToNow:function(){this.moveToBlock(this._getNowBlockIndex())},moveToDay:function(a){this.debug("moveToDay: "+a);a=a*this.options.blocksPerDay;var b=this._getTimeIndex(this.getCurrentBlockIndex());if(a+b!=this.getCurrentBlockIndex()){this.moveToBlock(a+b)}},moveToDate:function(a){this.moveToBlock(this._getBlockIndexFromDate(a))},moveToPreviousBlock:function(){if(this.getCurrentBlockIndex()>this._getNowBlockIndex()){this._timeScroller.moveToPreviousGroup()}},moveToNextBlock:function(){this._timeScroller.moveToNextGroup()
}}};var g={name:"ChannelGuide.ChannelBar",consts:{SORT:{ALPHA:"ALPHA",NUMERIC:"NUMERIC"},EVENTS:{UPDATING:"updating",UPDATED:"updated"}},prototype:{_init:function(){this._requestManager=Dtv.RequestManager.instances.get("channelGuideData");this._favsRequestManager=Dtv.RequestManager.instances.get("channelsfavs");this._overlay=this.el.down("div.channels").behavior("Overlayable");this.channelsList=$("guide_channel_list").behavior("RenderedList",{visibleCount:this.options.numChannels,itemOffset:41});
this._jumpLinkMenuEl=$("guide_jumplinks_menu");this._jumpLinkMenuTriggerEl=$("guide_jumplinks_menu_trigger");this.isUpdating=false},_initLayout:function(){this.channelsList.el.style.height=(this.options.numChannels*this.options.channelHeight)+"px"},_initEvents:function(){this.onDom(this.el,"macro:click",{"#guide_chscroll_down":this._handleScrollDownClick,"#guide_chscroll_up":this._handleScrollUpClick,"div.numeric:not(.disabled) li span":this._handleNumericJumpLinkClick,"div.alpha:not(.disabled) li span":this._handleAlphaJumpLinkClick,"span.chFav b:not(.disabled)":this._handleFavClick},this);
this.onDom(this.channelsList.el,{"macro:swipeup":this._handleScrollDownClick,"macro:swipedown":this._handleScrollUpClick},this);if(this._jumpLinkMenuEl){this.onDom(this._jumpLinkMenuEl,"click",{"div.numeric li span":this._handleNumericJumpLinkClick,"div.alpha li span":this._handleAlphaJumpLinkClick},this)}this.channelsList.on({indexchanged:this._handleListIndexChanged,renderindex:this._handleListRenderIndex},this);this._requestManager.on({requestchannelssent:this._handleRequestChannelsSent,requestchannelssuccess:this._handleRequestChannelsSuccess,requestchannelsinvalid:this._handleRequestChannelsInvalid,requestchannelscomplete:this._handleRequestChannelsComplete,sortchanged:this._handleSortChanged},this);
if(this._favsRequestManager){this._favsRequestManager.on({favchanged:this._handleFavChanged,allfavsremoved:this._handleAllFavsRemoved},this);this._favsRequestManager.on({maxreachedchanged:this.channelsList.refresh},this.channelsList)}},_handleScrollUpClick:function(a){Dtv.app.rollovers.hide();this.channelsList.moveToPreviousGroup()},_handleScrollDownClick:function(a){Dtv.app.rollovers.hide();this.channelsList.moveToNextGroup()},_handleFavClick:function(a,b){if(this._favsRequestManager){if(!b.hasClassName("updating")){Dtv.app.rollovers.hide();
var d=b.up("li");var c=this._requestManager.getChannels()[d.channelNdx];b.addClassName("updating");this._favsRequestManager.toggleFav({channelnum:c.chNum,channelkey:c.chKey},!b.hasClassName("active"))}}},_handleFavChanged:function(a){var b=this._requestManager.getChannels().findAll(function(c){return c.chNum==a.memo.params.channelnum});b.put("chFav",a.memo.added?1:0);this.channelsList.refresh()},_handleAllFavsRemoved:function(a){this._requestManager.getChannels().each(function(b){b.chFav=0});this.channelsList.refresh()
},_handleNumericJumpLinkClick:function(b,d){var a=parseInt(d.innerHTML);for(var e=0;e<this._requestManager.getNumChannels().length;e++){var c=this._requestManager.getNumChannels()[e];if(c.chNum>=a){this.channelsList.moveToPosition(e);break}}this._setActiveJumpLink(d.up())},_handleAlphaJumpLinkClick:function(b,d){var e=d.innerHTML.strip().toArray();for(var f=0;f<this._requestManager.getAlphaChannels().length;f++){var c=this._requestManager.getAlphaChannels()[f],a=c.chCall.charAt(0);if(e.first()=="0"){if(!isNaN(parseInt(a,10))){this.channelsList.moveToPosition(f);
break}}else{if(a==e.first()||a==e.last()){this.channelsList.moveToPosition(f);break}}}this._setActiveJumpLink(d.up())},_handleSortChanged:function(a){var b=this._getSortInfo(this.SORT.ALPHA);var c=this._getSortInfo(this.SORT.NUMERIC);switch(a.memo.sort){case this.SORT.ALPHA:if(b.el){b.el.show();c.el.hide()}this._sortInfo=b;break;case this.SORT.NUMERIC:if(b.el){b.el.hide();c.el.show()}this._sortInfo=c;break;default:throw"Invalid sort parameter value: "+params.sort}this.channelsList.reset()},_handleListRenderIndex:function(c){var s=Dtv.app.getLoginInfo().isLoggedIn();
var b=new Element("li").appendTo(c.memo.listEl);var r=this._requestManager.getChannels()[c.memo.index];var t=(r.chFav)?" active":"";var f=!s?"disabled":r.chFav?"remove":"add";if(this._favsRequestManager&&this._favsRequestManager.maxReached&&!r.chFav){f="maxreached";t+=" disabled"}var u="/entertainment/channel/details/"+r.chNum+"?format="+(r.chHd==1?"HD":"SD");var d={light:"/images/channel_call_sign/EP/grid/grid_light__GENERIC.png",dark:"/images/channel_call_sign/EP/grid/grid_dark__GENERIC.png"};var v=(!!$("ctl_tup")&&$("ctl_tup").hasClassName("dark-theme"))?"dark":"light";
var a=(!!r.chLogoUrl)?this._requestManager.channelData.serviceParams.logoHost+r.chLogoUrl:document.location.protocol+"//cdn.directv.com"+d[v];var e=['<span class="chLogo"><a><img src="',a,'"></a></span><span class="chNum"><a href="',u,'">',r.chNum,'</a></span><span class="chCall"><a href="',u,'">',r.chCall,'</a></span><span class="chFav"><b class="js_rollover',t,'" title="favs_rollover_',f,'"></b></span>'];b.update(e.join(""));Dtv.app.rollovers.addRolloverToEl(b.down(".chLogo"),r.chName);Dtv.app.rollovers.addRolloverToEl(b.down(".chCall"),r.chName);
Dtv.app.rollovers.addRolloverToEl(b.down(".chNum"),r.chName);b.channelNdx=c.memo.index},_handleRequestChannelsSent:function(a){this._onUpdating();this.disableLinks();this._overlay.showOverlay();this.el.select(".jumplinks").invoke("disable")},_handleRequestChannelsSuccess:function(a){$("guide_error_message").hide();this.channelsList.reset(this._requestManager.getChannels().length);this.enableLinks();this._onUpdated();if(!this._requestManager.isFavoritesView()){this.el.select(".jumplinks").invoke("enable")
}},_handleRequestChannelsInvalid:function(a){if(!this._requestManager.isFavoritesView()){$("guide_favorites_message").hide()}$("guide_error_message").show();this.channelsList.reset(0)},_handleRequestChannelsComplete:function(a){this._overlay.hideOverlay()},_handleListIndexChanged:function(c){var d=this._requestManager.getChannels()[c.memo.index];var f=this._getSortInfo().data;var a;switch(this._requestManager.getSort()){case this.SORT.ALPHA:for(var e=0;e<f.length;e++){var b=d.chCall.charAt(0);if(f[e].first()=="0"){if(!isNaN(parseInt(b,10))){a=this._setActiveJumpLink(e);
break}}else{if(b==f[e].first()||b==f[e].last()){a=this._setActiveJumpLink(e);break}else{if(e==f.length-1){a=this._setActiveJumpLink(e);break}}}}break;case this.SORT.NUMERIC:for(var e=0;e<f.length;e++){if(d.chNum<f[e]){a=this._setActiveJumpLink(e-1);break}else{if(e==f.length-1){a=this._setActiveJumpLink(e);break}}}break}$("guide_chscroll_up")[c.memo.index==0?"disable":"enable"]();$("guide_chscroll_down")[this.channelsList.isAtEnd()?"disable":"enable"]();if(this._jumpLinkMenuTriggerEl){this._jumpLinkMenuTriggerEl.down("label").update(this._getJumpLinkMenuLabelText(a))
}if(!this.isUpdating){this._onUpdating(c.memo.index>c.memo.oldIndex?"down":"up")}clearTimeout(this._updatedTimeout);this._updatedTimeout=this._onUpdated.bind(this).delay(1.5)},_onUpdating:function(a){this.fireEvent(this.EVENTS.UPDATING,{direction:a});this.isUpdating=true},_onUpdated:function(){clearTimeout(this._updatedTimeout);this.isUpdating=false;this.fireEvent(this.EVENTS.UPDATED)},_getJumpLinkMenuLabelText:function(a){var b="Channels: "+a.down("span").innerHTML;if(this._requestManager.getSort()==this.SORT.NUMERIC){var d=this._getSortInfo().jumpLinks;
var c=a.getSiblingIndex()+1;if(d.length>c){b+=" - "+d[c].down("span").innerHTML}else{b+="+"}}return b},_setActiveJumpLink:function(b){var a=this._getSortInfo().jumpLinks;if(a){a.invoke("removeClassName","active");if(Object.isNumber(b)){b=a[b]}b.addClassName("active")}return b},_getSortInfo:function(c){c=c||this._requestManager.getSort();if(!this._sortInfo){this._sortInfo={}}if(!this._sortInfo[c]){var a={el:this.el.down("."+c.toLowerCase())||(this._jumpLinkMenuEl?this._jumpLinkMenuEl.down("."+c.toLowerCase()):null),data:[]};
if(a.el){a.jumpLinks=a.el.select("li");for(var d=0;d<a.jumpLinks.length;d++){var b=a.jumpLinks[d].down("span").innerHTML;switch(c){case this.SORT.NUMERIC:a.data.push(parseInt(b));break;case this.SORT.ALPHA:a.data.push(b.strip().toArray());break}}}this._sortInfo[c]=a}return this._sortInfo[c]},getCurrentIndex:function(){return this.channelsList.currentIndex}}};var i={name:"ChannelGuide.DataView",prototype:{_init:function(){this._requestManager=Dtv.RequestManager.instances.get("channelGuideData");this._overlay=this.el.behavior("Overlayable");
this._dataListEl=this.el.down("ol")},_initLayout:function(){this.el.style.height=(this.options.numChannels*this.options.channelHeight)+"px"},_initEvents:function(){this.onDom(this.el,"macro:click",{"ol li ul li":this._handleScheduleClick},this);this.onDom(this.el,"mouseover",{"ol li ul li":this._handleItemMouseOver,"ol li ul":this._handleRowMouseOver},this);this.onDom(this.el,{"macro:swipeleft":function(){Dtv.app.channelGuide.timeline.moveToNextBlock()},"macro:swiperight":function(){Dtv.app.channelGuide.timeline.moveToPreviousBlock()
},"macro:swipeup":function(a){Dtv.app.channelGuide.channelBar.channelsList.moveToNextGroup()},"macro:swipedown":function(a){Dtv.app.channelGuide.channelBar.channelsList.moveToPreviousGroup()}});this._requestManager.on({requestschedulesent:this._handleRequestScheduleSent,requestschedulesuccess:this._handleRequestScheduleSuccess,requestscheduleinvalid:this._handleRequestScheduleInvalid,requestschedulefailure:this._handleRequestScheduleInvalid,requestscheduleexception:this._handleRequestScheduleInvalid,requestschedulecomplete:this._handleRequestScheduleComplete},this)
},_handleItemMouseOver:function(a){Dtv.app.rollovers.hide();a.abandon=true},_handleRowMouseOver:function(a,b){Dtv.app.rollovers.show(b,$("guide_rollover_no_programming"))},_handleScheduleClick:function(a,b){if(b.id){var c=this._scheduleItemsData[b.id];Dtv.app.cmsModule.getProgramInfoBoxPopup().setTarget(b,{data:{ppv:(!!c.prOrd)?c.prOrd:"",authCode:c.authCode,blackoutCode:c.blackoutCode,format:(c.dimension=="3D")?c.dimension:c.videoFormat,channelId:c.channelData.chId,airTime:c.prAir,durationMs:c.prLen*60000,tmsProgramId:c.prId,chLogoId:c.channelData.chLogoId,chCall:c.channelData.chCall,chNum:c.channelData.chNum,primaryDeliveryMethod:"Linear",hidePoster:false}})
}},_handleRequestScheduleSent:function(a){this._overlay.showOverlay()},_handleRequestScheduleSuccess:function(a){$("guide_error_message").hide();this._dataListEl.update();this._tzOffset=Dtv.app.channelGuide.timeline.getServerTzOffset();this._width=this.el.getWidth();var b=0,z=this._requestManager.scheduleData.channels;var D=Dtv.app.channelGuide.channelBar.getCurrentIndex(),I=this._requestManager.getChannels();var A={};for(var b=0,d=z.length;b<d;b++){var J=z[b];if(!!J&&!!J.chKey){var e=J.chKey;var G=(e.contains("_"))?e.split("_")[0]:e;
A[G]=J}}var E=[];var H=(z.length>10)?10:z.length;if((D+H-1)>=I.length){H=I.length-D}for(var c=D,B=0;B<H;B++,c++){var F=I[c];var e=F.chKey;var C=(e.contains("_"))?e.split("_")[0]:e;var f=A[C];if(!!!f){f=F}E[E.length]=f}this._scheduleItemsData={};for(var b=0;b<E.length;b++){this._renderRow(E[b])}},_handleRequestScheduleInvalid:function(a){this._dataListEl.update();$("guide_favorites_message").hide();$("guide_error_message").show()},_handleRequestScheduleComplete:function(a){this._overlay.hideOverlay();
this.recenter()},slide:function(a){var c={top:0,left:0};var b=this.el.getDimensions();switch(a){case"left":c.left=b.width;break;case"right":c.left=b.width*-1;break;case"up":c.top=b.height;break;case"down":c.top=b.height*-1;break;default:throw this.debug(new Error("invalid direction passed in to slide")).error}c.top+="px";c.left+="px";if(this._fx){this._fx.cancel()}this._fx=new Effect.Morph(this._dataListEl,{style:c,duration:Prototype.X.Browser.IE==6?0:0.8,transition:Effect.Transitions.Pow.easeOut})
},recenter:function(){if(this._fx){this._fx.cancel()}this._dataListEl.setStyle({top:"0px",left:"0px"})},_renderRow:function(b){try{if(!b){this.debug("_renderRow called without any channel data",null,"error");b={}}var o=new Element("li",{id:"chKey_"+b.chKey}).appendTo(this._dataListEl);var f=new Element("ul",{"class":b.chRec?"recordable":""}).appendTo(o);f.addClassName("chnum-"+b.chNum);var c="";if(b.schedules){for(var d=0;d<b.schedules.length;d++){var a=b.schedules[d];a.channelData=b;c+=this._renderSchedule(a,d)
}}f.update(c)}catch(e){this.debug(e,"Failed to render row")}},_renderSchedule:function(z,a){try{function u(m){return(m/30*this.options.halfHourWidth)}if(!z||!z.prTitle){return""}var b=new Element("li",{id:"prId_"+z.prId+":"+a});if(z.mainCategory){b.addClassName("hl-"+z.mainCategory.toLowerCase())}this._scheduleItemsData[b.id]=z;var e=z.prLen;var f=Date.fromUTCStr(z.prAir,this._tzOffset);var x={left:0};if(a==0){var w=this._requestManager.scheduleData.startDate-f;if(w>0){e-=(w/60000)}}else{x.left=u.call(this,(f-this._requestManager.scheduleData.startDate)/60000)
}z.blockLen=e;x.width=u.call(this,e);if(x.left+x.width>this._width){x.width-=(x.left+x.width)-this._width}x.left+="px";x.width=x.width<0?0:x.width;x.width+="px";b.setStyle(x);var y=new Element("div",{"class":"sched-item"}).appendTo(b);var t="";t+='<span class="prTitle"><span>'+z.prTitle+"</span></span>";if(z.prOrd){t+='<b class="prOrd"></b>'}else{t+='<b class="prRec"></b>'}if(z.dimension=="3D"){t+='<b class="pr3d"></b>'}else{if(z.prHd){t+='<b class="prHd"></b>'}}y.update(t);var v=b.down(".prTitle span");
if(v.getHeight()>14||v.getWidth()>b.getWidth()){Dtv.app.rollovers.addRolloverToEl(b,v.innerHTML);v=b.down(".prTitle span");while(v.getHeight()>14){var c=v.innerHTML;v.update(c.substr(0,c.lastIndexOf(" "))+"...")}}return b.toHTML()}catch(d){this.debug(d,"Failed to render schedule")}}}};Dtv.Behaviors.create(k,l,g,i);function h(a){var b=a.nodeName=="LI"?a:a.up("li");if(b.hasClassName("active")){return null}b.up().down(".active").removeClassName("active");b.addClassName("active");return b}})();(function(){var c={name:"ReceiversPage",autoMapping:"dtv_body_tup",prototype:{_init:function(a){var i=$("receivers_tabs");
if(i){var j=i.behavior("CollapsibleTab",{useEffects:false,allowCollapseToggle:false,classNames:{opener:"js-selectTVTab",content:"js-receivers-tab-content",active:"active"},ajaxPanelOptions:{overlay:false}});this.tabs=j}var b=$("off_air_tuner_form");if(b){this._fcOffAirTuner=new Dtv.FormController(b,{onSubmitCreate:this._handleReceiverSubmitCreate.bind(this),onSubmitSuccess:this._handleReceiverSuccess.bind(this),onSubmitFailure:this._handleReceiverFailure.bind(this),disableFormOnSuccess:false})}this.onDom(this.el,"click",{"input.js-selectDigitalTuner":this._handleDigitalTunerClick,"#off_air_antenna_btn":this._handleOffAirBtnClick},this);
this._fc=[];this.el.select("form.js-receivers-form").each(function(f,h){var g=f.up();this._fc[h]=new Dtv.FormController(f,{onSubmitCreate:this._handleReceiverSubmitCreate.bind(this),onSubmitSuccess:this._handleReceiverSuccess.bind(this),onSubmitFailure:this._handleReceiverFailure.bind(this),disableFormOnSuccess:false})}.bind(this));this.openRecDetailId="";this.receiversSelection=$("receivers-selection").behavior("AjaxPanel");this._infoCardPopup=new Element("div").behavior("InfoCardPopup");if(a&&a.memo&&a.memo.ajaxPanel){var e=this.receiversSelection.getHtmlAsElement(a.memo.ajaxPanel.el.outerHTML);
if(e.select("div.js-message-container li:not(.hidden)").length>0){if(document.viewport.getScrollOffsets()[1]!=0){this.receiversSelection.el.scrollTo()}}}},_initEvents:function(){this.receiversSelection.on("update",this._init.bind(this));this.onDom(this.el,"click",{".js-ReceiversPage-more-link":this._handleMoreClick},this)},_handleMoreClick:function(b,e){var a=e.rel;if(a){var h=$("infocard_popup_"+a);if(h){if(this._infoCardPopup.isVisible()&&this._infoCardPopup._targetEl===e){this._infoCardPopup.hide()
}else{this._infoCardPopup.el.update(h.innerHTML);this._infoCardPopup.hide();this._infoCardPopup.setTarget(e);this._infoCardPopup.show.bind(this._infoCardPopup).defer()}}}},_handleReceiverSubmitCreate:function(){this.tabs.disabled=true;return true},_handleReceiverSuccess:function(g,h){Dtv.debug("_handleReceiverSuccess()");if(h.isPreReqReceiverAdded&&(window.location.search.length>1)&&(window.location.search.indexOf("preSelectedSkuId=")>-1)){window.location.href=window.location.href.replace(window.location.search,"");
return true}var a={ajax:"true"};var b=window.location.getParams();if(b.preSelectedSkuId&&(!h.isPreReqReceiverAdded||(h.isPreReqReceiverAdded===false))){a.preSelectedSkuId=b.preSelectedSkuId}if(h.refreshUrlParams.indexOf("&")==0){h.refreshUrlParams="?"+h.refreshUrlParams.substr(1)}this.receiversSelection.load("/DTVAPP/new_customer/component/receiversSelection.jsp"+h.refreshUrlParams,{parameters:a})},_handleReceiverFailure:function(a,b){Dtv.debug("_handleReceiverFailure()");this.tabs.disabled=false
},_handleDigitalTunerClick:function(){var a=$("off_air_tuner_submit");if(a){this._fcOffAirTuner.submit(0,null,a)}},_handleOffAirBtnClick:function(){var b=$("off_air_antenna_btn");if(b&&b.hasClassName("disabled")){return}var f=$("off_air_tuner_submit");var a=$("off_air_antenna_chkbox");if(f&&a){a.click();this._fcOffAirTuner.submit(0,null,f)}},addOrUpdateReceiver:function(h,j,b){var i=$("receiver_sku_id_hidden_"+h);var a=this._fc[h];if(i&&a){i.value=j;a.submit(0,null,b)}else{Dtv.debug("addOrUpdateReceiver: form submit problem")
}},removeReceiver:function(h,j,b){var i=$("receiver_sku_id_hidden_"+h);var a=this._fc[h];if(i&&a){i.value=j;a.submit(1,null,b)}else{Dtv.debug("removeReceiver: form submit problem")}}}};var d={name:"InfoCardPopup",inherits:"Popup",consts:{DEFAULT_HTML:'<div class="ep-infobox"><b class="shim"><b class="t"></b><b class="b"></b><b class="l"></b><b class="r"></b><b class="tl"></b><b class="tr"></b><b class="bl"></b><b class="br"></b><b class="lv"></b></b><div class="content"><div class="infobox-content ajax-popup-loading"></div></div></div>'},options:{hideOnMouseLeave:false,hideOnAnchorClick:true,hideOnOutsideClick:true,stickyDuration:0.75,showBeforeLoad:true,loadDelay:0.5,showFxOptions:{duration:0.2,delay:0.2},hideFxOptions:{duration:0,delay:0.01}},prototype:{_init:function(){this.el.setStyle("position:absolute").appendTo(document.body).hide();
this.el.id="receivers_infocard_popup"},_initEvents:function($super){$super();Dtv.app.on("resize",this._updatePosition.bind(this).ignoreEvent())},show:function($super,a){if($super(a)){this._updatePosition()}},_updatePosition:function(){if(!this._targetEl){return}var u=this._targetEl.cumulativeOffset(),w=this.el.getHeight(),h=this.el.getWidth(),B=u.left+this._targetEl.getWidth()+11,t=u.top;var s=document.viewport.getHeight();var A=Math.max(document.viewport.getWidth(),$("dtv_tup").getWidth());var v=document.viewport.getScrollOffsets();
var D=s+v.top;var x=this._targetEl.getHeight();var b=null;var y=(w-x)/2;t=u.top-y;if(t+w>D){t-=(((t+w)-D)+10)}else{if(t<v.top){t=v.top+10}}var z=u.top-t;b=z+(x/2);B=B+12;var a=this.el.down("b.lv, b.rv");if(a){a.show();var C=10;if(B+h>=A-C){B=u.left-h-11;if(B<C){B=C}a.className="rv"}else{a.className="lv"}if(b){if(b>5&&b<w-5){a.setStyle({top:b+"px"})}else{a.hide()}}}this.el.setStyle({left:B+"px",top:t+"px"})}}};Dtv.Behaviors.create(c,d)})();