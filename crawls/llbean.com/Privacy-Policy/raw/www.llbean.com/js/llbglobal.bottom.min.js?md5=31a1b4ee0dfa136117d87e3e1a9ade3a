/*
 Contains: jquery.postmessage.js,llbean.global.js,social.js,universalVideo.js  
 social.js
 @Version 1.0 @Copyright 2013, LLBean Inc.
 @Author: Brian K. Cribb (current version)
 @Author: Michael H. (initial version) 
 @Summary: Social icon generator

 universalVideo.js
 @Version 1.0 @Copyright 2013, LLBean Inc.
 @Author: Jay Lokhande (current version)
 @Author: Michael H. (initial version, beta) 
 @Summary: Script for loading Video assets when required.

 ToDo: list
 - cache jQuery selector results
 - do not download touchswipe script if not needed.
 - change the if condition order on setDelegate() so that mobile OS are verified first.

 3/26/2013: Added fix for opening video on iOS devices
*/
(function($){"$:nomunge";var interval_id,last_hash,cache_bust=1,rm_callback,window=this,FALSE=!1,postMessage="postMessage",addEventListener="addEventListener",p_receiveMessage,has_postMessage=window[postMessage];$[postMessage]=function(message,target_url,target){if(!target_url)return;message=typeof message==="string"?message:$.param(message);target=target||parent;if(has_postMessage)target[postMessage](message,target_url.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));else if(target_url)target.location=target_url.replace(/#.*$/,
"")+"#"+ +new Date+cache_bust++ +"&"+message};$.receiveMessage=p_receiveMessage=function(callback,source_origin,delay){if(has_postMessage){if(callback){rm_callback&&p_receiveMessage();rm_callback=function(e){if(typeof source_origin==="string"&&e.origin!==source_origin||$.isFunction(source_origin)&&source_origin(e.origin)===FALSE)return FALSE;callback(e)}}if(window[addEventListener])window[callback?addEventListener:"removeEventListener"]("message",rm_callback,FALSE);else window[callback?"attachEvent":
"detachEvent"]("onmessage",rm_callback)}else{interval_id&&clearInterval(interval_id);interval_id=null;if(callback){delay=typeof source_origin==="number"?source_origin:typeof delay==="number"?delay:100;interval_id=setInterval(function(){var hash=document.location.hash,re=/^#?\d+&/;if(hash!==last_hash&&re.test(hash)){last_hash=hash;callback({data:hash.replace(re,"")})}},delay)}}}})(jQuery);
$(document).ready(function(){$.ajaxSetup({converters:{"text json":function(stringData){return jQuery.parseJSON(stringData.replace("for(;;);",""))}}})});
var loginConfig={displayType:"GL",isSignature:typeof sbConfig==="undefined"?"":sbConfig.miscobj.isSignature,iframeSource:"https://"+window.location.hostname+"/webapp/wcs/stores/servlet/ShowLoginDialog",layerWidth:"620",layerHeight:"auto",layerCSS:"background: url('/images/ajax-loader.gif') no-repeat 50% 50%;",layerMinHeight:"300",layerTitle:"",redirectURL:"",currentURL:window.location.href};var config={};
function globalLoginLayer(){loginConfig.displayType="GL";loginConfig.layerWidth="620";loginConfig.layerHeight="auto";loginConfig.layerCSS="background: url('/images/ajax-loader.gif') no-repeat 50% 50%; padding: 15px;";loginConfig.layerMinHeight="300";loginConfig.layerTitle="";loginConfig.redirectURL="";loginConfig.currentURL=window.location;if(typeof window.postMessage==="undefined")window.location="https://"+window.location.hostname+"/webapp/wcs/stores/servlet/MSProtect?storeId=1";else loginLayer()}
function loginLayer(configObj){if(typeof configObj=="undefined")configObj={};config=$.extend({},loginConfig,configObj);var dialogs=$(".ui-dialog-content");if(dialogs.length>0)if(dialogs.dialog("isOpen"))dialogs.dialog("close");callIframe();openLoginDialog();try{sendMetricsTagLoginLayer()}catch(e){}}function callIframe(){var $loginDialog=$("#loginDialog");if(!$loginDialog.length)$("body").append('<div id="loginDialog" style="'+config.layerCSS+'"></div>')}
function openLoginDialog(){var loginClass;if(config.isSignature!="true")loginClass="coreDialog";else loginClass="sigDialog";$("#loginDialog").dialog({modal:true,resizable:false,draggable:false,zIndex:1001,dialogClass:loginClass,title:config.layerTitle,minHeight:config.layerMinHeight,width:config.layerWidth,height:config.layerHeight,create:function(event,ui){},open:function(event,ui){var iframeSrcUrl=config.iframeSource;if(typeof llbHostName!=="undefined")iframeSrcUrl="https://"+llbHostName+"/webapp/wcs/stores/servlet/ShowLoginDialog";
var iframeURL=""+iframeSrcUrl+"?displayType="+config.displayType+"&isSignature="+config.isSignature+"";if(typeof config.isPPCC!=="undefined")iframeURL+="&isPP="+config.isPPCC;$(this).append('<IFRAME id="loginLayer" name="loginLayer" src="'+iframeURL+'" scrolling="no" width="100%"  marginheight="0" marginwidth="0"  frameborder="0">');initLoginReceiveMessage()},close:function(event,ui){$("#loginDialog").empty()}});$(".ui-widget-overlay").click(function(){$("#loginDialog").dialog("close")})}
var initLoginReceiveMessage=function(){$.receiveMessage(function(e){var message=e.data.split("+");if(message[0]=="layerTitle")if(message[1]!=""&&config.layerTitle==""){config.layerTitle=message[1];$("#ui-dialog-title-loginDialog").empty().append(message[1])}if(message[0]==="redirectURL"){if(config.redirectURL!==""){$("#loginDialog").dialog("close");if(typeof sb_blockUI==typeof Function&&config.displayType!="GL"&&config.displayType!="WL")sb_blockUI();window.location=config.redirectURL}else if(message[1]!==
""){$("#loginDialog").dialog("close");if(typeof gnJsonData!=="undefined")window.location.reload();else{if(typeof sb_blockUI==typeof Function&&config.displayType!="GL"&&config.displayType!="WL")sb_blockUI();window.location=message[1]}return false}if(message[1]!=""&&config.redirectURL==""){config.redirectURL=message[1];$("#loginDialog").dialog("close");window.location.href=message[1]}else if(config.redirectURL!=""){$("#loginDialog").dialog("close");window.location.href=config.redirectURL}else if(message[1]==
""&&config.redirectURL==""){var currentURL=config.currentURL;if(currentURL.indexOf("krypto")!==-1){$("#loginDialog").dialog("close");window.location.href="http://ecwebs01.llbean.com"}else{$("#loginDialog").dialog("close");window.location.href=config.currentURL}}}if($.inArray(message[0],["createAccount","checkoutAsGuest","forgotPassword","notYouURL"])>-1){$("#loginDialog").dialog("close");window.location.href=message[1]}if(message[0]=="iframeHeight")$("#loginLayer").attr("height",message[1]);if(e.data==
"cancelLogin")$("#loginDialog").dialog("destroy").remove()})};
(function(window,document){var root=window,$=jQuery;var Sociallb;if(typeof exports!=="undefined")Sociallb=exports;else Sociallb=root.Sociallb={};function fbLike(options){var defaults={style:"button_count",send:false,verb:"like",width:95,ref:"llb-social",href:"",template:'<div class="fb-like" data-show-faces="false" data-send="<%=send%>" data-href="<%=href%>" data-layout="<%=style%>" data-ref="<%=ref%>" data-width="<%=width%>" data-action="<%=verb%>"></div>'};var settings=$.extend({},defaults,options);
settings.width=settings.width<defaults.width?defaults.width:settings.width;if(typeof $.data($("body")[0],"fbsdk")==="undefined"){if(!window.fbAsyncInit)window.fbAsyncInit=function(){FB.init({xfbml:true});log("fbLike(): window.fbAsyncInit is set.")};(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/all.js";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk");$.data($("body")[0],
"fbsdk",true)}log("Social: rendering fbLike...");return util.tmpl(settings.template,settings)}function twShare(options){var defaults={url:"",count:"horizontal",text:"",size:"medium",dnt:true,template:'<div class="tw-Share"><a href="https://twitter.com/share" class="twitter-share-button" data-count="<%=count%>" data-url="<%=url%>" data-text="<%=text%>" data-size="<%=size%>" data-dnt="<%=dnt%> data-lang="en" >Tweet</a></div>'};var settings=$.extend({},defaults,options);if(typeof $.data($("body")[0],
"tweetsdk")==="undefined")loadTwitterSDK();log("Social: rendering twShare...");return util.tmpl(settings.template,settings)}function twFollow(options){var defaults={user:"llbean",count:false,showName:true,size:"medium",align:"none",width:200,dnt:true,template:'<div class="tw-follow"><a href="https://twitter.com/<%=user%>" class="twitter-follow-button" data-width="<%=width%>" data-show-count="<%=count%>" data-show-screen-name="<%=showName%>" data-align="<%=align%>" data-size="<%=size%>" data-lang="en" >Follow @<%=user%></a></div>'};
var settings=$.extend({},defaults,options);settings.width=settings.width<defaults.width?defaults.width:settings.width;settings.width+="px";if(typeof $.data($("body")[0],"tweetsdk")==="undefined")loadTwitterSDK();log("Social: rendering twFollow...");return util.tmpl(settings.template,settings)}function gPlus1(options){var defaults={href:"",size:"medium",style:"bubble",width:120,template:'<div class="gPlus1"><div class="g-plusone" data-href="<%=href%>" data-size="<%=size%>" data-annotation="<%=style%>" data-width="<%=width%>"></div></div>'};
var settings=$.extend({},defaults,options);settings.width=settings.width<defaults.width?defaults.width:settings.width;if(!window.gapi)loadGPlusSDK();log("Social: rendering gPlus1...");return util.tmpl(settings.template,settings)}function gPlusShare(options){var defaults={size:"20",style:"bubble",template:'<div class="gPlusShare"><div class="g-plus" data-action="share" data-annotation="<%=style%>" data-height="<%=size%>"></div>'};var settings=$.extend({},defaults,options);settings.size=settings.size===
"medium"?"20":settings.size;settings.size=settings.size==="small"?"15":settings.size;settings.size=settings.size==="large"?"24":settings.size;settings.size=settings.style==="vertical-bubble"?"60":settings.size;log("settings.size = "+settings.size);if(!window.gapi)loadGPlusSDK();log("Social: rendering gPlus1...");return util.tmpl(settings.template,settings)}function genericFollow(options){var defaults={url:"http://ecwebs01.llbean.com",linkText:"",customClass:"",template:'<a class="<%=customClass%>" href="<%=url%>" target="_blank" ><%=linkText%></a>'};
var profiles={Facebook:"http://www.facebook.com/llbean",Twitter:"http://twitter.com/llbean",GooglePlus:"https://plus.google.com/103841372034114205123",Pinterest:"http://www.pinterest.com/llbean",YouTube:"http://www.youtube.com/llbean",FourSquare:"http://www.foursquare.com/llbean",InstagramSig:"http://followgram.me/llbeansignature",TwitterSig:"http://twitter.com/LLBeansignature",PinterestSig:"http://pinterest.com/llbeansignature"};var settings=$.extend({},defaults,options);if(typeof options.url!==
"undefined"&&profiles.hasOwnProperty(options.url))settings.url=profiles[options.url];log("Social: rendering a generic follow link...");return util.tmpl(settings.template,settings)}function loadTwitterSDK(){try{var d=document,s="script",id="twitter-wjs";var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs)}$.data($("body")[0],"tweetsdk",true);log("Social: loading Twitter sdk....")}catch(err){}}
function loadGPlusSDK(){try{var po=document.createElement("script");po.type="text/javascript";po.async=true;po.src="//apis.google.com/js/plusone.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(po,s)}catch(err){}}function getDefault(element){var bar=fbLike();bar+=twFollow();element.append(bar)}Sociallb.scan=function(context,options){var c=typeof context!=="undefined"?typeof context==="string"?$(context):context:$("body");if(c.length<1)return;c.find("*[data-social]").each(function(index){render(this,
options)})};var render=function(element,options){var self=$(element).first();if(self.data("social-rendered")===true){log("render: Already rendered. Returning from function.");return}var socials=typeof options==="undefined"?util.getAttrJSON(self.attr("data-social")):options;log("Social: ",self,socials);if(socials===null)getDefault(self);else{var socialBar=document.createDocumentFragment();var bar="";$.each(socials,function(icon,val){log("Social Icon: ",icon,val);bar+=icon==="fbLike"?fbLike(val):"";
bar+=icon==="twShare"?twShare(val):"";bar+=icon==="twFollow"?twFollow(val):"";bar+=icon==="fbFollow"?fbFollow(val):"";bar+=icon==="twFollowLink"?twFollowLink(val):"";bar+=icon==="gPlus1"?gPlus1(val):"";bar+=icon==="gPlusShare"?gPlusShare(val):"";bar+=icon==="genericFollow"?genericFollow(val):""});self.append(bar);self.data("social-rendered",true)}};$.fn.Sociallb=function(options){var $element=this instanceof jQuery?this:$(this);log("Social Plugin:",$element);$element.each(function(idx,elem){log("Social Plugin each:",
elem,options);render(elem,options)})}})(window,document);Sociallb.scan();
(function($,window,document,undefined){var UniversalVideo,assetsReady=false;UniversalVideo=window.UniversalVideo={};var defaults={assetType:"VIDEO",config:"LLBean/DefaultViewerAPOn",flashMode:"transparent"};function createVideo(element,settings){var videoc=element.find(".video-player-container:first");var id=videoc.attr("id");if(typeof id==="undefined"){id=(new Date).getTime();videoc.attr("id","video-"+id)}var uvconfig={assetType:"VIDEO",config:settings.config,flashMode:"transparent",containerId:"video-"+
id,asset:settings.assetId};s7uev.EmbeddedViewer(uvconfig);return true}function createVideoClick(settings){var uvconfig=$.extend(defaults,settings);s7uev.EmbeddedViewer(uvconfig);return true}function createCarousel(element,settings){var uvVideoCarouselul=element.find(settings.videoCarouselul+":first > ul"),uvnumberOfItems=uvVideoCarouselul.children().length,uvmissingItems=settings.uvvisibleItems-uvnumberOfItems%settings.uvvisibleItems;if(uvnumberOfItems%settings.uvvisibleItems!=0)for(var a=0;a<uvmissingItems;a++)uvVideoCarouselul.append("<span class='uvEmptySpan'></span>");
uvVideoCarouselul.carouFredSel({prev:settings.prev,next:settings.next,pagination:settings.pagination,scroll:800,pauseOnHover:true,items:settings.uvvisibleItems,swipe:{onMouse:true,onTouch:true},auto:false})}UniversalVideo.setDelegate=function(){$(document).delegate(".uvPlay, .video-elem","click",function(e){log("Delegate, .uvPlay, .video-elem, click: ");e.preventDefault();var $this=$(this),vars=util.getAttrJSON($this.data("variables"));var videoc=$this.parents(".video-component:first").find(".video-player-container:first");
log("Delegate, .uvPlay, .video-elem, click: ",vars);var options={asset:vars.asset,viewer:vars.config,containerId:videoc.attr("id")};createVideoClick(options)});if($("body").hasClass("signature"))uvDialogClass="sigDialog";else uvDialogClass="coreDialog";if(s7ueUtils.device.name=="desktop"){log("I am desktop");$("#universalVideoPopIn").dialog({autoOpen:false,dialogClass:uvDialogClass+" uvDialog",height:500,width:772,modal:true,resizable:false,closeOnEscape:false});$(document).delegate(".uvPopInBtn",
"click",function(e){var $this=$(this),vars=util.getAttrJSON($this.data("variables"));var options={asset:vars.asset,viewer:vars.config,containerId:"universalVideoPopIn"};createVideoClick(options);$("#universalVideoPopIn").dialog("open");return false});$(document).delegate(".ui-widget-overlay","click",function(e){$("#universalVideoPopIn").dialog("close");$("#universalVideoPopIn object").remove()});$(".ui-dialog-titlebar-close").bind("click",function(e){$("#universalVideoPopIn object").remove()})}else if(s7ueUtils.device.isIOS()){$(".uvVideoCarousel").css("margin-top",
"-30px");var uvPlayLink=$(".uvPopInBtn");$(".uvPopInBtn").each(function(){var $this=$(this),vars=util.getAttrJSON($this.data("variables"));if($this.attr("href")=="#")$this.attr("href","http://s7d9.scene7.com/is/content/"+vars.asset+".m3u8")});$("body").delegate("a.uvPopInBtn","click",function(){window.location=this.href;return false})}else if(s7ueUtils.device.isAndroid()){$(".uvVideoCarousel").css("margin-top","-30px");$("#universalVideoPopIn").dialog({autoOpen:false,dialogClass:uvDialogClass+" uvDialog",
height:500,width:772,modal:true,resizable:false,closeOnEscape:false});$(document).delegate(".uvPopInBtn","click",function(e){var $this=$(this),vars=util.getAttrJSON($this.data("variables"));var options={asset:vars.asset,viewer:vars.config,containerId:"universalVideoPopIn"};createVideoClick(options);$("#universalVideoPopIn").dialog("open");$("#universalVideoPopIn").css("width","768px");$("#universalVideoPopIn").css("height","492px");return false});$(document).delegate(".ui-widget-overlay","click",
function(e){$("#universalVideoPopIn").dialog("close");$("#universalVideoPopIn div").remove()});$(".ui-dialog-titlebar-close").bind("click",function(e){$("#universalVideoPopIn div").remove()})}};UniversalVideo.setAssetsReady=function(){assetsReady=true};UniversalVideo.assetsReady=function(){return assetsReady};UniversalVideo.createComponent=function(container,CarouslPrev,CarouslNext,Pager,options){var element=container instanceof jQuery?container:$(container);if(element.length<1||options.assetId===
undefined)return;var defaults={carousel:false,config:"LLBean/DefaultViewerAPOff",uvvisibleItems:4,prev:CarouslPrev,next:CarouslNext,pagination:Pager,videoCarouselul:".video-carousel"};var settings=$.extend({},defaults,options);createVideo(element,settings);settings.carousel&&createCarousel(element,settings)}})(jQuery,window,document);$.extend(UniversalVideo,util.eventMethods);
UniversalVideo.on("scene7Ready",function(){var videoComponents=$(".video-component");$.each(videoComponents,function(index,value){var self=$(this),selfid=self.attr("id"),dataoptions=self.data("options");if(!selfid){var stamp=(new Date).getTime();selfid="scene7-"+stamp;self.attr("id",selfid)}if(dataoptions===null)return;var options=util.getAttrJSON(dataoptions);if(options!==null&&options.assetId!==undefined&&options.assetId!="")UniversalVideo.createComponent("#"+selfid,options.prev,options.next,options.pagination,
{carousel:options.carousel,assetId:options.assetId})})});
Radar.regModule("Scene7VideoModule",{scripts:["http://s7d9.scene7.com/s7/JavaScript/s7ueUtils.js","http://s7d9.scene7.com/s7/JavaScript/s7ueViewers.js","/js/jquery.touchSwipe.min.js","/js/jquery.carouFredSel-6.1.0-packed.js"],callbacks:[function(self){$(".uvVideoCarousel").css("display","inline-block");if(UniversalVideo.assetsReady()===true)return;UniversalVideo.setAssetsReady();log("Scene7 Assets are ready!!");UniversalVideo.trigger("scene7Ready");$("body").append('<div id="universalVideoPopIn" class="universalVideoPopIn"></div>');
UniversalVideo.setDelegate()}],unique:false});
