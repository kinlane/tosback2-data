/*
 Contains: jquery.postmessage.js,llbean.global.js  */
(function($){"$:nomunge";var interval_id,last_hash,cache_bust=1,rm_callback,window=this,FALSE=!1,postMessage="postMessage",addEventListener="addEventListener",p_receiveMessage,has_postMessage=window[postMessage];$[postMessage]=function(message,target_url,target){if(!target_url)return;message=typeof message==="string"?message:$.param(message);target=target||parent;if(has_postMessage)target[postMessage](message,target_url.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));else if(target_url)target.location=target_url.replace(/#.*$/,
"")+"#"+ +new Date+cache_bust++ +"&"+message};$.receiveMessage=p_receiveMessage=function(callback,source_origin,delay){if(has_postMessage){if(callback){rm_callback&&p_receiveMessage();rm_callback=function(e){if(typeof source_origin==="string"&&e.origin!==source_origin||$.isFunction(source_origin)&&source_origin(e.origin)===FALSE)return FALSE;callback(e)}}if(window[addEventListener])window[callback?addEventListener:"removeEventListener"]("message",rm_callback,FALSE);else window[callback?"attachEvent":
"detachEvent"]("onmessage",rm_callback)}else{interval_id&&clearInterval(interval_id);interval_id=null;if(callback){delay=typeof source_origin==="number"?source_origin:typeof delay==="number"?delay:100;interval_id=setInterval(function(){var hash=document.location.hash,re=/^#?\d+&/;if(hash!==last_hash&&re.test(hash)){last_hash=hash;callback({data:hash.replace(re,"")})}},delay)}}}})(jQuery);
$(document).ready(function(){$.ajaxSetup({converters:{"text json":function(stringData){return jQuery.parseJSON(stringData.replace("for(;;);",""))}}})});
var loginConfig={displayType:"GL",isSignature:typeof sbConfig==="undefined"?"":sbConfig.miscobj.isSignature,iframeSource:"https://"+window.location.hostname+"/webapp/wcs/stores/servlet/ShowLoginDialog",layerWidth:"620",layerHeight:"auto",layerCSS:"background: url('/images/ajax-loader.gif') no-repeat 50% 50%;",layerMinHeight:"300",layerTitle:"",redirectURL:"",currentURL:window.location};
function globalLoginLayer(){loginConfig.displayType="GL";loginConfig.layerWidth="620";loginConfig.layerHeight="auto";loginConfig.layerCSS="background: url('/images/ajax-loader.gif') no-repeat 50% 50%;";loginConfig.layerMinHeight="300";loginConfig.layerTitle="";loginConfig.redirectURL="";loginConfig.currentURL=window.location;if(typeof window.postMessage==="undefined")window.location="https://"+window.location.hostname+"/webapp/wcs/stores/servlet/MSProtect?storeId=1";else loginLayer()}
function loginLayer(){if(!$(".ui-dialog").is(":visible"))$(this).dialog("close");callIframe();openLoginDialog();sendMetricsTagLoginLayer()}function callIframe(){$("body").append('<div id="loginDialog" style="'+loginConfig.layerCSS+'"></div>')}
function openLoginDialog(){$("#loginDialog").dialog({modal:true,resizable:false,draggable:false,zIndex:1001,title:loginConfig.layerTitle,minHeight:loginConfig.layerMinHeight,width:loginConfig.layerWidth,height:loginConfig.layerHeight,create:function(event,ui){if(loginConfig.isSignature!="true")$("#loginDialog").parent().wrap('<div class="global" />');else $("#loginDialog").parent().wrap('<div class="globalSig" />')},open:function(event,ui){var iframeURL=""+loginConfig.iframeSource+"?displayType="+
loginConfig.displayType+"&isSignature="+loginConfig.isSignature+"";$(this).append('<IFRAME id="loginLayer" name="loginLayer" src="'+iframeURL+'" scrolling="no" width="100%"  marginheight="0" marginwidth="0"  frameborder="0">');if(loginConfig.isSignature!="true")$(".ui-widget-overlay").wrap('<div class="global" />');else $(".ui-widget-overlay").wrap('<div class="globalSig" />')},close:function(event,ui){$(this).dialog("destroy").remove();$(".global").filter(function(){if($(this).text()=="")return true;
return false}).remove();$(".globalSig").filter(function(){if($(this).text()=="")return true;return false}).remove()}});jQuery("body").bind("click",function(e){if(jQuery("#loginDialog").dialog("isOpen")&&!jQuery(e.target).is(".ui-dialog, a")&&!jQuery(e.target).closest(".ui-dialog").length)jQuery("#loginDialog").dialog("close")})}
$.receiveMessage(function(e){var message=e.data.split("+");if(message[0]=="layerTitle")if(message[1]!=""&&loginConfig.layerTitle==""){loginConfig.layerTitle=message[1];$("#ui-dialog-title-loginDialog").empty().append(message[1])}if(message[0]==="redirectURL")if(loginConfig.redirectURL!=="")window.location=loginConfig.redirectURL;else if(message[1]!==""){$("#loginDialog").dialog("close");if(typeof gnJsonData!=="undefined")window.location.reload();else window.location=message[1];return false}else{var currentURL=
loginConfig.currentURL;if(currentURL.indexOf("krypto")!==-1){$("#loginDialog").dialog("close");window.location="http://www.llbean.com"}else{$("#loginDialog").dialog("close");window.location=loginConfig.currentURL}}if(message[0]=="createAccount"){$("#loginDialog").dialog("close");window.location.href=message[1]}if(message[0]=="forgotPassword"){$("#loginDialog").dialog("close");window.location.href=message[1]}if(message[0]=="iframeHeight")$("#loginLayer").attr("height",message[1]);if(e.data=="cancelLogin")$("#loginDialog").dialog("destroy").remove()});
