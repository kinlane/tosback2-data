/*
 Contains: jquery.postmessage.js,llbean.global.js  */
(function($){"$:nomunge";var interval_id,last_hash,cache_bust=1,rm_callback,window=this,FALSE=!1,postMessage="postMessage",addEventListener="addEventListener",p_receiveMessage,has_postMessage=window[postMessage];$[postMessage]=function(message,target_url,target){if(!target_url)return;message=typeof message==="string"?message:$.param(message);target=target||parent;if(has_postMessage)target[postMessage](message,target_url.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));else if(target_url)target.location=target_url.replace(/#.*$/,
"")+"#"+ +new Date+cache_bust++ +"&"+message};$.receiveMessage=p_receiveMessage=function(callback,source_origin,delay){if(has_postMessage){if(callback){rm_callback&&p_receiveMessage();rm_callback=function(e){if(typeof source_origin==="string"&&e.origin!==source_origin||$.isFunction(source_origin)&&source_origin(e.origin)===FALSE)return FALSE;callback(e)}}if(window[addEventListener])window[callback?addEventListener:"removeEventListener"]("message",rm_callback,FALSE);else window[callback?"attachEvent":
"detachEvent"]("onmessage",rm_callback)}else{interval_id&&clearInterval(interval_id);interval_id=null;if(callback){delay=typeof source_origin==="number"?source_origin:typeof delay==="number"?delay:100;interval_id=setInterval(function(){var hash=document.location.hash,re=/^#?\d+&/;if(hash!==last_hash&&re.test(hash)){last_hash=hash;callback({data:hash.replace(re,"")})}},delay)}}}})(jQuery);
$(document).ready(function(){$.ajaxSetup({converters:{"text json":function(stringData){return jQuery.parseJSON(stringData.replace("for(;;);",""))}}})});
var loginConfig={displayType:"GL",isSignature:typeof sbConfig==="undefined"?"":sbConfig.miscobj.isSignature,iframeSource:"https://"+window.location.hostname+"/webapp/wcs/stores/servlet/ShowLoginDialog",layerWidth:"620",layerHeight:"auto",layerCSS:"background: url('/images/ajax-loader.gif') no-repeat 50% 50%;",layerMinHeight:"300",layerTitle:"",redirectURL:"",currentURL:window.location.href};var config={};
function globalLoginLayer(){loginConfig.displayType="GL";loginConfig.layerWidth="620";loginConfig.layerHeight="auto";loginConfig.layerCSS="background: url('/images/ajax-loader.gif') no-repeat 50% 50%; padding: 15px;";loginConfig.layerMinHeight="300";loginConfig.layerTitle="";loginConfig.redirectURL="";loginConfig.currentURL=window.location;if(typeof window.postMessage==="undefined")window.location="https://"+window.location.hostname+"/webapp/wcs/stores/servlet/MSProtect?storeId=1";else loginLayer()}
function loginLayer(configObj){if(typeof configObj=="undefined")configObj={};config=$.extend({},loginConfig,configObj);if(!$(".ui-dialog").is(":visible"))$(this).dialog("close");callIframe();openLoginDialog();try{sendMetricsTagLoginLayer()}catch(e){}}function callIframe(){var $loginDialog=$("#loginDialog");if(!$loginDialog.length)$("body").append('<div id="loginDialog" style="'+config.layerCSS+'"></div>')}
function openLoginDialog(){var loginClass;if(config.isSignature!="true")loginClass="coreDialog";else loginClass="sigDialog";$("#loginDialog").dialog({modal:true,resizable:false,draggable:false,zIndex:1001,dialogClass:loginClass,title:config.layerTitle,minHeight:config.layerMinHeight,width:config.layerWidth,height:config.layerHeight,create:function(event,ui){},open:function(event,ui){var iframeSrcUrl=config.iframeSource;if(typeof llbHostName!=="undefined")iframeSrcUrl="https://"+llbHostName+"/webapp/wcs/stores/servlet/ShowLoginDialog";
var iframeURL=""+iframeSrcUrl+"?displayType="+config.displayType+"&isSignature="+config.isSignature+"";if(typeof config.isPPCC!=="undefined")iframeURL+="&isPP="+config.isPPCC;$(this).append('<IFRAME id="loginLayer" name="loginLayer" src="'+iframeURL+'" scrolling="no" width="100%"  marginheight="0" marginwidth="0"  frameborder="0">')},close:function(event,ui){$("#loginDialog").empty()}});$(".ui-widget-overlay").click(function(){$("#loginDialog").dialog("close")})}
$.receiveMessage(function(e){var message=e.data.split("+");if(message[0]=="layerTitle")if(message[1]!=""&&config.layerTitle==""){config.layerTitle=message[1];$("#ui-dialog-title-loginDialog").empty().append(message[1])}if(message[0]==="redirectURL"){if(config.redirectURL!==""){$("#loginDialog").dialog("close");if(typeof sb_blockUI==typeof Function&&config.displayType!="GL"&&config.displayType!="WL")sb_blockUI();window.location=config.redirectURL}else if(message[1]!==""){$("#loginDialog").dialog("close");
if(typeof gnJsonData!=="undefined")window.location.reload();else{if(typeof sb_blockUI==typeof Function&&config.displayType!="GL"&&config.displayType!="WL")sb_blockUI();window.location=message[1]}return false}if(message[1]!=""&&config.redirectURL==""){config.redirectURL=message[1];$("#loginDialog").dialog("close");window.location.href=message[1]}else if(config.redirectURL!=""){$("#loginDialog").dialog("close");window.location.href=config.redirectURL}else if(message[1]==""&&config.redirectURL==""){var currentURL=
config.currentURL;if(currentURL.indexOf("krypto")!==-1){$("#loginDialog").dialog("close");window.location.href="http://www.llbean.com"}else{$("#loginDialog").dialog("close");window.location.href=config.currentURL}}}if($.inArray(message[0],["createAccount","checkoutAsGuest","forgotPassword","notYouURL"])>-1){$("#loginDialog").dialog("close");window.location.href=message[1]}if(message[0]=="iframeHeight")$("#loginLayer").attr("height",message[1]);if(e.data=="cancelLogin")$("#loginDialog").dialog("destroy").remove()});
