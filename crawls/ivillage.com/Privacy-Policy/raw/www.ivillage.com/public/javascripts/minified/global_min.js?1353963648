/* Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version 2.1.2
 */
(function($){$.fn.bgiframe=($.browser.msie&&/msie 6\.0/i.test(navigator.userAgent)?function(s){s=$.extend({top:"auto",left:"auto",width:"auto",height:"auto",opacity:true,src:"javascript:false;"},s);var html='<iframe class="bgiframe"frameborder="0"tabindex="-1"src="'+s.src+'"style="display:block;position:absolute;z-index:-1;'+(s.opacity!==false?"filter:Alpha(Opacity='0');":"")+"top:"+(s.top=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px')":prop(s.top))+";left:"+(s.left=="auto"?"expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px')":prop(s.left))+";width:"+(s.width=="auto"?"expression(this.parentNode.offsetWidth+'px')":prop(s.width))+";height:"+(s.height=="auto"?"expression(this.parentNode.offsetHeight+'px')":prop(s.height))+';"/>';return this.each(function(){if($(this).children("iframe.bgiframe").length===0){this.insertBefore(document.createElement(html),this.firstChild);}});}:function(){return this;});$.fn.bgIframe=$.fn.bgiframe;function prop(n){return n&&n.constructor===Number?n+"px":n;}})(jQuery);(function($){var trailing_whitespace=true;$.fn.truncate=function(options){var opts=$.extend({},$.fn.truncate.defaults,options);$(this).each(function(){var content_length=$.trim(squeeze($(this).text())).length;if(content_length<=opts.max_length){return;}var actual_max_length=opts.max_length-opts.more.length-1;var truncated_node=recursivelyTruncate(this,actual_max_length);var full_node=$(this).hide();truncated_node.insertAfter(full_node);findNodeForMore(truncated_node).append((opts.expandable?' <a href="#show more content">':" ")+opts.more+(opts.expandable?"</a>":""));findNodeForLess(full_node).append(' <a href="#show less content">'+opts.less+"</a>");truncated_node.find("a:last").click(function(){truncated_node.hide();full_node.show();return false;});full_node.find("a:last").click(function(){truncated_node.show();full_node.hide();return false;});});};$.fn.truncate.defaults={max_length:100,more:"(â€¦more)",less:"(less)",expandable:true};function recursivelyTruncate(node,max_length){return(node.nodeType==3)?truncateText(node,max_length):truncateNode(node,max_length);}function truncateNode(node,max_length){var node=$(node);var new_node=node.clone().empty();var truncatedChild;node.contents().each(function(){var remaining_length=max_length-new_node.text().length;if(remaining_length==0){return;}truncatedChild=recursivelyTruncate(this,remaining_length);if(truncatedChild){new_node.append(truncatedChild);}});return new_node;}function truncateText(node,max_length){var text=squeeze(node.data);if(trailing_whitespace){text=text.replace(/^ /,"");}trailing_whitespace=!!text.match(/ $/);var text=text.slice(0,max_length);text=$("<div/>").text(text).html();return text;}function squeeze(string){return string.replace(/\s+/g," ");}function findNodeForMore(node){var $node=$(node);var last_child=$node.children(":last");if(!last_child){return node;}var display=last_child.css("display");if(!display||display=="inline"){return $node;}return findNodeForMore(last_child);}function findNodeForLess(node){var $node=$(node);var last_child=$node.children(":last");if(last_child&&last_child.is("p")){return last_child;}return node;}})(jQuery);(function($){$.url={};$.extend($.url,{_params:{},init:function(){var paramsRaw="";try{paramsRaw=(document.location.href.split("?",2)[1]||"").split("#")[0].split("&")||[];for(var i=0;i<paramsRaw.length;i++){var single=paramsRaw[i].split("=");if(single[0]){this._params[single[0]]=unescape(single[1]);}}}catch(e){alert(e);}},param:function(name){return this._params[name]||"";},paramAll:function(){return this._params;}});$.url.init();})(jQuery);jQuery.fn.center=function(params){var options={vertical:true,horizontal:true};op=jQuery.extend(options,params);return this.each(function(){var $self=jQuery(this);var width=$self.width();var height=$self.height();var paddingTop=parseInt($self.css("padding-top"));var paddingBottom=parseInt($self.css("padding-bottom"));var borderTop=parseInt($self.css("border-top-width"));var borderBottom=parseInt($self.css("border-bottom-width"));var mediaBorder=(borderTop+borderBottom)/2;var mediaPadding=(paddingTop+paddingBottom)/2;var positionType=$self.parent().css("position");var halfWidth=(width/2)*(-1);var halfHeight=((height/2)*(-1))-mediaPadding-mediaBorder;var cssProp={position:"absolute"};if(op.vertical){cssProp.height=height;cssProp.top="50%";cssProp.marginTop=halfHeight;}if(op.horizontal){cssProp.width=width;cssProp.left="50%";cssProp.marginLeft=halfWidth;}if(positionType=="static"){$self.parent().css("position","relative");}$self.css(cssProp);});};(function($){$.open={};$.open.defaultParams={width:"800",height:"600",top:"0",left:"0",directories:"no",location:"no",resizeable:"yes",menubar:"no",toolbar:"no",scrollbars:"yes",status:"no"};$.open.defaultConfig={autoFocus:true};$.open.newWindow=function(href,params,config){var windowParams=$.extend($.open.defaultParams,params);var windowConfig=$.extend($.open.defaultConfig,config);var windowName=params.windowName||"new_window";var i,paramString="";for(i in windowParams){if(windowParams.hasOwnProperty(i)){paramString+=(paramString==="")?"":",";paramString+=i+"=";if(windowParams[i]===true||windowParams[i]===false){paramString+=(windowParams[i])?"yes":"no";}else{paramString+=windowParams[i];}}}var popupWindow=window.open(href,windowName,paramString);if(windowConfig.autoFocus){popupWindow.focus();}return popupWindow;};$.fn.open=function(parameters,callback){var params=parameters.params||parameters;var config=parameters.config||{};this.each(function(){$(this).click(function(event){event.preventDefault();if($(this).attr("target")){params.windowName=$(this).attr("target");}var href;if(params.href){href=params.href;}else{if($(this).attr("href")){href=$(this).attr("href");}else{return;}}var windowObject=$.open.newWindow(href,params,config);if(callback){callback(windowObject);}});});return $;};})(jQuery);/*
 * jQuery outside events - v1.1 - 3/16/2010
 * http://benalman.com/projects/jquery-outside-events-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($,doc,outside){$.map("click dblclick mousemove mousedown mouseup mouseover mouseout change select submit keydown keypress keyup".split(" "),function(event_name){jq_addOutsideEvent(event_name);});jq_addOutsideEvent("focusin","focus"+outside);jq_addOutsideEvent("focusout","blur"+outside);$.addOutsideEvent=jq_addOutsideEvent;function jq_addOutsideEvent(event_name,outside_event_name){outside_event_name=outside_event_name||event_name+outside;var elems=$(),event_namespaced=event_name+"."+outside_event_name+"-special-event";$.event.special[outside_event_name]={setup:function(){elems=elems.add(this);if(elems.length===1){$(doc).bind(event_namespaced,handle_event);}},teardown:function(){elems=elems.not(this);if(elems.length===0){$(doc).unbind(event_namespaced);}},add:function(handleObj){var old_handler=handleObj.handler;handleObj.handler=function(event,elem){event.target=elem;old_handler.apply(this,arguments);};}};function handle_event(event){$(elems).each(function(){var elem=$(this);if(this!==event.target&&!elem.has(event.target).length){elem.triggerHandler(outside_event_name,[event.target]);}});}}})(jQuery,document,"outside");(function($){$.fn.vTicker=function(options){var defaults={speed:700,pause:4000,showItems:3,animation:"",mousePause:true,isPaused:false,direction:"up",height:0};var options=$.extend(defaults,options);moveUp=function(obj2,height,options){if(options.isPaused){return;}var obj=obj2.children("ul");var clone=obj.children("li:first").clone(true);if(options.height>0){height=obj.children("li:first").outerHeight(true);}obj.animate({top:"-="+height+"px"},options.speed,function(){$(this).children("li:first").remove();$(this).css("top","0px");});if(options.animation=="fade"){obj.children("li:first").fadeOut(options.speed);if(options.height==0){obj.children("li:eq("+options.showItems+")").hide().fadeIn(options.speed).show();}}clone.appendTo(obj);};moveDown=function(obj2,height,options){if(options.isPaused){return;}var obj=obj2.children("ul");var clone=obj.children("li:last").clone(true);if(options.height>0){height=obj.children("li:first").outerHeight(true);}obj.css("top","-"+height+"px").prepend(clone);obj.animate({top:0},options.speed,function(){$(this).children("li:last").remove();});if(options.animation=="fade"){if(options.height==0){obj.children("li:eq("+options.showItems+")").fadeOut(options.speed);}obj.children("li:first").hide().fadeIn(options.speed).show();}};return this.each(function(){var obj=$(this);var maxHeight=0;var maxLIHeight=0;obj.css({overflow:"hidden",position:"relative"});if(options.height==0){obj.children("ul").children("li").each(function(){console.log($(this).outerHeight(true));if($(this).outerHeight(true)>maxHeight){maxHeight=$(this).outerHeight(true);}if($(this).height()>maxLIHeight){maxLIHeight=$(this).height();}});obj.children("ul").children("li").each(function(){$(this).height(maxLIHeight);});obj.height(maxHeight*options.showItems+5);}else{obj.height(options.height);}obj.children("ul").css({position:"absolute"});var interval=setInterval(function(){if(options.direction=="up"){moveUp(obj,maxHeight,options);}else{moveDown(obj,maxHeight,options);}},options.pause);if(options.mousePause){obj.bind("mouseenter",function(){options.isPaused=true;}).bind("mouseleave",function(){options.isPaused=false;});}});};})(jQuery);(function($){iVillage.runners.application=function(){var USER_LOGIN_COOKIE_NAME="iv_auth";var USER_LOGIN_COOKIE_ID="iv_id";var USER_IMAGE=null;var PROFILE_IMG_PATH="http://hp.ivillage.com/mzinga_api_profile_img/";var RANDOM_IMAGE_MAX_COUNT=2;var RANDOM_IMAGE_PATH="/public/images/globalnav";var RANDOM_IMAGE_NAME_PREFIX="/header_";var RANDOM_IMAGE_NAME_SUFFIX=".jpg";var AVATAR_IMAGE_MAX_COUNT=4;var AVATAR_IMAGE_PATH="/public/images/avatars";var AVATAR_IMAGE_NAME_PREFIX="/image";var AVATAR_IMAGE_NAME_SUFFIX=".png";var RANDOM_IMAGE_ON=true;var login_cookie=$.cookie(USER_LOGIN_COOKIE_NAME);var iv_user_id=$.cookie(USER_LOGIN_COOKIE_ID);function iv_get_user_avatar(loginCode){$.getJSON(PROFILE_IMG_PATH+loginCode+"?callback=?",function(data){if(data.status=="ok"){$("#iv_home_member_avatar img").attr("src",data.url);}else{var rand_no=Math.floor(AVATAR_IMAGE_MAX_COUNT*Math.random())+1;$("#iv_home_member_avatar img").attr("src",AVATAR_IMAGE_PATH+AVATAR_IMAGE_NAME_PREFIX+rand_no+AVATAR_IMAGE_NAME_SUFFIX);}});}function iv_user_loggedin(){$("#iv_home_welcome").css("display","none");$("#iv_home_welcome_signed_in").css("display","block");$("#iv_home_header").css("background","none");if(iv_user_id!=null){iv_get_user_avatar(iv_user_id);iv_user_id=(iv_user_id.length<10)?iv_user_id:iv_user_id.substring(0,9)+"...";$("#iv_home_welcome_signed_in_welcome H3").text("Hello "+iv_user_id);}else{$("#iv_home_welcome_signed_in_welcome H3").text("Welcome");}}function iv_user_not_loggedin(){if(RANDOM_IMAGE_ON){var rand_no=Math.floor(RANDOM_IMAGE_MAX_COUNT*Math.random())+1;$("#iv_home_header").css("background","transparent url("+RANDOM_IMAGE_PATH+RANDOM_IMAGE_NAME_PREFIX+rand_no+RANDOM_IMAGE_NAME_SUFFIX+") no-repeat scroll 0 0");}else{$("#iv_home_welcome").css("left","0px");}$("#iv_home_welcome_signed_in").css("display","none");$("#iv_home_welcome").css("display","block");}if(login_cookie==null||login_cookie=="NA"){iv_user_not_loggedin();}else{RANDOM_IMAGE_ON=false;iv_user_loggedin();}$("#iv_home_login_open").mouseover(function(){$(this).css("background-position","0px -21px");}).mouseout(function(){$(this).css("background-position","0px 0px");});$("#search_button").mouseover(function(){$(this).css("background-position","0px -30px");}).mouseout(function(){$(this).css("background-position","0px 0px");});if($("#member-support-form").length){var theErrorArrow='<span class="error-arrow"></span>';$("#member-support-form").validate({rules:{txtFirstName:{required:true},txtLastName:{required:true},txtFromEmail:{required:true,email:true},txtConfirmEmail:{required:true,email:true,equalTo:"#txtFromEmail"},txtComment:{required:true}},messages:{txtFirstName:{required:theErrorArrow+"Please enter first name."},txtLastName:{required:theErrorArrow+"Please enter last name."},txtFromEmail:{required:theErrorArrow+"Please enter email address.",email:theErrorArrow+"Please enter a valid email address."},txtConfirmEmail:{required:theErrorArrow+"Please confirm email address.",email:theErrorArrow+"Please enter a valid email address.",equalTo:theErrorArrow+"Please enter the same email as above."},txtComment:{required:theErrorArrow+"Please enter your question/comment."}}});$(".refreshCaptcha").live("click",function(e){e.preventDefault();var timeStamp=new Date().getTime();$(this).parent().children("img.capImage").attr("src","/ivcaptcha?"+timeStamp.toString());});}if($("#contact-us-form").length){var theErrorArrow='<span class="error-arrow"></span>';$("#contact-us-form").validate({rules:{txtFirstName:{required:true},txtLastName:{required:true},txtFromEmail:{required:true,email:true},txtConfirmEmail:{required:true,email:true,equalTo:"#txtFromEmail"},txtComment:{required:true},txtTerms:{required:true}},messages:{txtFirstName:{required:theErrorArrow+"Please enter first name."},txtLastName:{required:theErrorArrow+"Please enter last name."},txtFromEmail:{required:theErrorArrow+"Please enter email address.",email:theErrorArrow+"Please enter a valid email address."},txtConfirmEmail:{required:theErrorArrow+"Please confirm email address.",email:theErrorArrow+"Please enter a valid email address.",equalTo:theErrorArrow+"Please enter the same email as above."},txtComment:{required:theErrorArrow+"Please enter your question/comment."},txtTerms:{required:theErrorArrow+"Please accept terms & conditions."}}});$(".refreshCaptcha").live("click",function(e){e.preventDefault();var timeStamp=new Date().getTime();$(this).parent().children("img.capImage").attr("src","/ivcaptcha?"+timeStamp.toString());});}};})(jQuery);iVillage.runners.blocks.care_circle_globals=function(){var avatar_list=$('<div id="avatar-list"/>').load("/care_circle_render/avatar_list",function(){$("#wrapper").append(avatar_list);});$.fn.select_avatar=function(options){return this.each(function(){var base=$(this);var fieldset=base.closest("fieldset");var avatar_list_showing=false;var target_avatar=fieldset.find("img.selected-avatar");var gender_input=fieldset.find(':input[name="gender"]');var dob_input=fieldset.find('input[name="birth_year"]');gender_input.bind("change",filter_avatars);dob_input.bind("change",filter_avatars);var original_gender=undefined;if(gender_input.is(":radio")){gender_input.each(function(){if($(this).is(":checked")){original_gender=$(this).val();}});}else{original_gender=gender_input.find("option:selected").val();}var original_age_group=calculate_age_group(dob_input.val());function calculate_age_group(dob){var age_group=false;dob=parseInt(dob,10);if(dob){var d=new Date();var age=d.getFullYear()-dob;if(age<=16){age_group="young";}else{if(age<=65){age_group="medium";}else{if(age<=120){age_group="old";}}}}return age_group;}function filter_avatars(e){var age_group=undefined;var gender=undefined;if(gender_input.is(":radio")){gender_input.each(function(){if($(this).is(":checked")){gender=$(this).val();}});}else{gender=gender_input.find("option:selected").val();}age_group=calculate_age_group(dob_input.val());if(gender||age_group){$("#avatar-list").find("li").show();if(gender){$("#avatar-list").find("li:not(."+gender+")").hide();}if(age_group){$("#avatar-list").find("li:not(."+age_group+")").hide();}}if(gender!=original_gender){var first_item=$("#avatar-list").find("li."+gender+":first");target_avatar.attr({src:$("img",first_item).attr("src"),alt:$("img",first_item).attr("alt")});target_avatar.closest("fieldset").find('input[name="avatar_id"]').val(target_avatar.attr("alt"));original_gender=gender;}if(gender&&age_group&&age_group!=original_age_group){if(!target_avatar.hasClass(age_group)){first_item=$("#avatar-list").find("li."+gender+"."+age_group+":first");target_avatar.attr({src:$("img",first_item).attr("src"),alt:$("img",first_item).attr("alt")});target_avatar.closest("fieldset").find('input[name="avatar_id"]').val(target_avatar.attr("alt"));}}}function position_avatar_list(){var position=$(base).offset();var left=position.left;var top=position.top;var width=$(base).width();var height=$(base).height();if((left+width+$("#avatar-list").width())>$(window).width()){$("#avatar-list").css({left:(left-$("#avatar-list").width()+width)+"px",top:(top+height)+"px"});}else{$("#avatar-list").css({left:(left)+"px",top:(top+height)+"px"});}}function hide_avatar_list(e){toggle_form_elements_for_ie(true);e.stopImmediatePropagation();$(window).unbind("resize",position_avatar_list);$("#avatar-list").unbind("clickoutside");$("#avatar-list").hide();avatar_list_showing=false;}function show_avatar_list(e){toggle_form_elements_for_ie(false);e.stopImmediatePropagation();$(window).bind("resize",position_avatar_list);$("#avatar-list").bind("clickoutside",function(e){hide_avatar_list(e);});$("#avatar-list").bind("focusoutside",function(e){hide_avatar_list(e);});$("#avatar-list").show();avatar_list_showing=true;}function toggle_form_elements_for_ie(bool){if(iVillage.msie6||iVillage.msie7){if(bool){$("#overlay-add-someone button.add-to-care-circle").show();$("#care-circle-overlay-add-topic").show();$("#care-circle-overlay .care-circle-col a.more-link").show();$("#care-circle-overlay form.care-circle-add-topic").show();$("#care-circle-overlay p.care-circle-heart-info").show();$('#care-circle-overlay form.edit-member-profile select[name="gender"]').show();$('#care-circle-overlay form.edit-member-profile select[name="relationship"]').show();$("#care-circle-overlay form.edit-member-profile button.save-changes").show();$("#care-circle-overlay form.edit-member-profile a.delete-profile").show();$('#add_someone_form select[name="tid"]').show();}else{$("#overlay-add-someone button.add-to-care-circle").hide();$("#care-circle-overlay-add-topic").hide();$("#care-circle-overlay .care-circle-col a.more-link").hide();$("#care-circle-overlay form.care-circle-add-topic").hide();$("#care-circle-overlay p.care-circle-heart-info").hide();$('#care-circle-overlay form.edit-member-profile select[name="gender"]').hide();$('#care-circle-overlay form.edit-member-profile select[name="relationship"]').hide();$("#care-circle-overlay form.edit-member-profile button.save-changes").hide();$("#care-circle-overlay form.edit-member-profile a.delete-profile").hide();$('#add_someone_form select[name="tid"]').hide();}}}$(this).bind("click",function(e){if(avatar_list_showing){hide_avatar_list(e);return;}$("#avatar-list li").show();position_avatar_list();$(gender_input).trigger("change");$(dob_input).trigger("change");var avatar_id=$(this).closest("fieldset").find('input[name="avatar_id"]');$("#avatar-list li").each(function(){$(this).unbind("click");$(this).bind("click",function(e){target_avatar.attr({src:$("img",this).attr("src"),alt:$("img",this).attr("alt")});avatar_id.val($("img",this).attr("alt"));hide_avatar_list(e);});});show_avatar_list(e);});});};$.fn.care_circle_load_hp_data=function(options){var base=this;base.init=function(){base.options=$.extend({},$.fn.care_circle_load_hp_data.defaults,options);};base.init();return base.each(function(){var parent=this;$(this).unbind("fetch_hp_data");$(this).bind("fetch_hp_data",function(){$.getJSON("/care_circle/fetch_hp_data",function(data){if(data.members){var ul;if(base.options.location=="home_page"){ul=[];}else{ul=$('<ul class="member-content clearfix">');}for(var key in data.members){var member=data.members[key];var li=$("<li>");var care_title=$("<div class='care-title'></div>");care_title.html("For "+member.member_name);li.append(care_title);var child_ul=$("<ul>");var i=0;while(i<base.options.articles&&i<member.data.length){var article=member.data[i];var child_li=$('<li class="clearfix">');var span=$("<span>");span.html(article.type);child_li.append(span);var child_a=$('<a href="'+article.url+'">'+article.title+"</a>");child_li.append(child_a);child_ul.append(child_li);i++;}li.append(child_ul);var more_link=$('<a class="more-link member-link" href="#care-circle-person-'+key+'">See All</a>');more_link.bind("click",function(e){e.preventDefault();$(this).colorbox({href:"#care-circle-overlay",inline:true,onLoad:function(){$("#care-circle-overlay").tabs().tabs("select",$(this).attr("href"));},onOpen:function(){$("#cboxWrapper").addClass("care-circle-cbox");}});});li.append(more_link);if(base.options.location=="home_page"){ul.push(li);}else{ul.append(li);}}if(base.options.location=="home_page"){$(".mod-care-circle #care-circle-large .care-circle-col:not(.care-circle-last-col, .care-circle-logo-col)").remove();for(i=0;i<ul.length;i++){ul[i].addClass("care-circle-col");$(".mod-care-circle #care-circle-quickstart").before(ul[i]);}}else{$(parent).html(ul);}$.fn.reload_cc_overlay();base.options.onSuccess();}});});});};$.fn.care_circle_load_hp_data.defaults={articles:2,location:"home_page",onSuccess:function(){}};$.fn.reload_cc_overlay=function(){$("#care-circle-overlay-container").load("/ajax/care_circle_overlay #care-circle-overlay",function(){iVillage.runners.blocks.care_circle_overlay();});};};var CC_Home={};iVillage.runners.blocks.care_circle_home=function(){function build_carousel(){$(".care-circle-column-content ul").equalizeChildHeights({only_visible_children:true});if($(".care-circle-column-content > ul > li:visible").size()>3){$("#care-circle-large").prepend('<div class="carousel-navigation"><span class="care-circle-prev">Previous</span><span class="care-circle-next">Next</span></div>');$(".care-circle-column-content").jCarouselLite({btnNext:"#care-circle-large .care-circle-next",btnPrev:"#care-circle-large .care-circle-prev",visible:3,circular:false});}}$.fn.update_page=function(){$(this).care_circle_load_hp_data({articles:3,onSuccess:function(){build_carousel();$("#care-circle-add-someone-success").css("height","auto");}}).trigger("fetch_hp_data");};$(".check_year_len").focus(function(){if($(this).val().length>4){$(this).val("");}$(this).attr("maxlength",4);});$(".check_year_len").blur(function(){$(this).attr("maxlength",10);if($(this).val().length==0){$(this).val("Birth Date");}});$("#care-circle-quickstart a, #care-circle-add-someone-success a, #care-circle-add-topic-success a").unbind("click");$("#care-circle-quickstart a, #care-circle-add-someone-success a, #care-circle-add-topic-success a").bind("click",function(){$("#care-circle-large .care-circle-last-col").hide();$($(this).attr("href")).show();return false;});$("#care-circle-large .cancel").unbind("click");$("#care-circle-large .cancel").bind("click",function(){$("#care-circle-large .care-circle-last-col").hide();$("#care-circle-quickstart").show();return false;});build_carousel();$("#care-circle-large .care-circle-help-link").care_circle_help_link();$(".mod-care-circle .manage-link").care_circle_manage_link();$(".mod-care-circle .member-link").bind("click",function(e){e.preventDefault();$(this).colorbox({href:"#care-circle-overlay",inline:true,onLoad:function(){$("#care-circle-overlay").tabs().tabs("select",$(this).attr("href"));},onOpen:function(){$("#cboxWrapper").addClass("care-circle-cbox");}});});$("#care-circle-add-someone-form input[name='name']").clearDefault();$(".mod-care-circle .birth-year").clearDefault();$("#care-circle-large .care-circle-select-avatar").select_avatar();$("#care-circle-large #care-circle-add-someone-form form").ivAjaxPost({loading:false,onTrigger:function(parent){$(parent).find(".btn-controls").hide();$(parent).find(".loading").show();},validate:function(target){var name=$(target).find("input[name='name']");if(name.val()=="Name"||name.val()==""){alert("Please provide a name.");name.focus();return false;}if(!$(target).find("input[name='gender']").is(":checked")){alert("Please select Male or Female.");return false;}var birth_year=$(target).find("input[name='birth_year']");if(birth_year.val()=="Birth year"||birth_year.val()==""){alert("Please provide a birth year.");birth_year.focus();return false;}var current_date=new Date();var current_year=current_date.getFullYear();var r_birthyear=new RegExp("^[0-9]{4}$");if(!r_birthyear.test(birth_year.val())){alert("Please provide a valid 4-digit birth year.");birth_year.focus();return false;}if(birth_year.val()>current_year){alert("Please enter a birth year between 1900 - "+current_year+".");birth_year.focus();return false;}if(birth_year.val()<1900){alert("Please provide a birth year after 1900.");birth_year.focus();return false;}return true;},additionalData:function(){return{save_name:$("#care-circle-add-someone-form select[name='tid'] option:selected").html()};},onSuccess:function(data,parent){$.fn.reload_cc_overlay();$(parent).find(".btn-controls").show();$(parent).find(".loading").hide();$("#care-circle-large .care-circle-last-col").hide();$("#care-circle-add-someone-success .green-check").html("You added "+data.name+"!");$("#care-circle-add-someone-success .added-info").html('<div class="avatar-image"><img src="'+$("#care-circle-add-someone-form .selected-avatar").attr("src")+'" alt="" /></div><div class="info"><div class="name">'+data.name+"</div><p>"+data.gender+", "+data.age+' years old</p><div class="topic">'+$("#care-circle-add-someone-form select[name='tid'] option:selected").html()+'</div><p><a href="#care-circle-person-'+data.member_id+'" rel="'+data.member_id+'" class="member-link add-more-details" name="care-circle:member:add-more-details">Add More Details</a></p></div>');$("#care-circle-add-someone-success .added-info .info a.add-more-details").unbind("click");$("#care-circle-add-someone-success .added-info .info a.add-more-details").bind("click",function(e){e.preventDefault();$(this).colorbox({href:"#care-circle-overlay",inline:true,onLoad:function(){$("#care-circle-overlay").tabs().tabs("select","#care-circle-person-"+$(this).attr("rel"));},onOpen:function(){$("#cboxWrapper").addClass("care-circle-cbox");}});});CC_Overlay.Member.create(data,parent);$("#add_someone_form")[0].reset();$("#care-circle-add-someone-success").show();$(parent).update_page();},onError:function(form,request,status,e){$(form).find(".btn-controls").show();$(form).find(".loading").hide();alert("Your Care Circle can only contain 10 members. If you would like to add another, please delete an existing member and try again.");}});$("#care-circle-large #care-circle-add-topic-form #add_topic_form").ivAjaxPost({loading:false,onTrigger:function(parent){$(parent).find(".btn-controls").hide();$(parent).find(".loading").show();return false;},additionalData:function(parent){return{save_name:$(parent).find("select[name='tid'] option:selected").html()};},onSuccess:function(data,parent){$(parent).find(".btn-controls").show();$(parent).find(".loading").hide();$("#care-circle-large .care-circle-last-col").hide();$("#care-circle-add-topic-success .green-check").html('You added the Topic <div class="topic-name">'+data.save_name+"</div>");$("a.add-a-health-topic").removeClass("add-a-health-topic").addClass("add-another-topic");$("#care-circle-add-topic-success").show();$(parent).update_page();$(parent).find("select[name='tid'] option:selected").remove();}});$("#care-circle-large #care-circle-add-topic-form #add_first_time_user_form").ivAjaxPost({loading:false,onTrigger:function(parent){$(parent).find(".btn-controls").hide();$(parent).find(".loading").show();},additionalData:function(parent){return{save_name:$(parent).find("select[name='tid'] option:selected").html()};},onSuccess:function(data,parent){$(parent).find(".loading").hide();$(parent).find(".btn-controls").show();$("#add_first_time_user_form input[name='member_id']").val(data.member_id);$("#add_first_time_user_form").attr("action","/care_circle/add_save");$("#care-circle-large .care-circle-last-col").hide();$("#care-circle-add-topic-success .green-check").html('You added the Topic <div class="topic-name">'+data.save_name+"</div>");$("a.add-a-health-topic").removeClass("add-a-health-topic").addClass("add-another-topic");$("#care-circle-add-topic-success").show();$(parent).update_page();}});if($(".mod-essential-tool-list li.care-circle a").length){var link=$(".mod-essential-tool-list li.care-circle a");link.unbind("click");link.bind("click",function(e){e.preventDefault();var offset=$("#care-circle-large").offset();$("html, body").animate({scrollTop:offset.top-102},"slow");});}$(".care-circle-logo").ifixpng();};var CC_Overlay={};iVillage.runners.blocks.care_circle_overlay=function(){var tracking_prefix="iv:health:care-circle-overlay:";CC_Overlay={tabs:$("#care-circle-overlay").tabs({add:function(event,ui){var tab=$(".care-circle-tabs").find("li:eq("+ui.index+")");var tab_text=tab.find("a span").text();tab.find("a").empty().text(tab_text);tab.find("a").attr("name","iv:health:health:care-circle-overlay:member");tab.addClass("care-circle-person");$(ui.panel).find("form.care-circle-add-topic").care_circle_add_topic_to_member();}}),reload:function(){$.fn.reload_cc_overlay();},add_topic:function(data,parent){},remove_topic:function(data,parent){$("#care-circle-manage-follows").find("tr.topic-"+data.tid+".member-"+data.member_id).remove();$("#care-circle-person-"+data.member_id+" ul.care-circle-follows li.topic-"+data.tid).remove();},Manage:{create_follows_row:function(data){var row=$('<tr class="topic topic-'+data.tid+" member-"+data.member_id+'"><td><a name="iv:health:health:care-circle-overlay:follows">'+data.save_name+'</a></td><td><form action="/care_circle/remove_save" method="post"><input name="save_type" type="hidden" value="topic"><input name="tid" type="hidden" value="'+data.tid+'"><input name="member_id" type="hidden" value="'+data.member_id+'"><input name="save_name" type="hidden" value="'+data.save_name+'"><button name="iv:health:health:care-circle-overlay:follows:delete" type="submit">Delete</button></form>'+data.member_name+"</td></tr>");row.find("form").ivAjaxPost({additionalData:{save_name:data.save_name},onSuccess:function(data,parent){CC_Overlay.remove_topic(data,parent);}});row.addHover();return row;}},Member:{create:function(data,parent){var number_of_member_tabs=$("#care-circle-overlay .member-panel").length;$("#manage-add-someone span").html(data.name+" added!");$("#manage-add-someone").show("fast").delay(1200).hide("fast");$.post("/care_circle_render/member_panels",{member_id:data.member_id},function(d,textStatus){$("#care-circle-overlay .member-panel:last").after(d);$("#care-circle-overlay .member-panel:last").addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");var tab_count=$("#care-circle-overlay .member-panel").length;var tab_id="#care-circle-person-"+(data.member_id);$("#care-circle-overlay").tabs("add",tab_id,data.name,(tab_count-1));});CC_Overlay.Member.add_to_sortable(data);},remove:function(member_id){$("#care-circle-order li[rel='#care-circle-person-"+member_id+"']").remove();$("#care-circle-manage-follows tr.member-"+member_id).remove();},add_to_sortable:function(data){var member_tab_count=$("#care-circle-overlay .member-panel").length;var order_tab=$('<li rel="#care-circle-person-'+(member_tab_count+1)+'"><img width="25" height="25" src="/public/images/icons/components/care_circle/avatars/'+data.avatar_file+'" class="selected-avatar" alt="'+data.member_id+'">'+data.name+'<form method="post" action="/care_circle/remove_member"><input type="hidden" value="'+data.member_id+'" name="member_id"><button type="submit" name="iv:health:health:care-circle-overlay:member:delete">Delete</button></form></li>');order_tab.addHover();order_tab.find("form").ivAjaxPost({onSuccess:function(data,parent){var href=$(parent).closest("li").attr("rel");$("#care-circle-overlay .ui-tabs-nav a[href='"+href+"']").closest("li").remove();$(parent).closest("li").remove();}});$("#care-circle-order li:last").after(order_tab);},create_follows_row:function(data){var row=$('<li class="topic-'+data.tid+'"><a rel="'+data.tid+'" name="iv:health:care-circle-overlay:follows">'+data.save_name+'</a><form method="post" action="/care_circle/remove_save"><input type="hidden" name="member_id" value="'+data.member_id+'"><input type="hidden" name="tid" value="'+data.tid+'"><input type="hidden" name="save_type" value="topic"><input type="hidden" name="save_name" value="'+data.save_name+'"><button name="iv:health:care-circle-overlay:follows:delete" type="submit">Delete</button></form><div class="loading"></div></li>');row.find("form").ivAjaxPost({additionalData:{save_name:data.save_name},loading:false,onTrigger:function(parent){$(parent).parent().find(".loading").show();$(parent).find("button").hide();},onSuccess:function(data,parent){CC_Overlay.remove_topic(data,parent);}});row.addHover();return row;}}};$.fn.care_circle_help_link=function(){var base=this;return base.each(function(){var parent=this;$(this).iv_colorbox({cboxClass:"care-circle-cbox"},{href:"#care-circle-overlay",inline:true,onLoad:function(){CC_Overlay.tabs.tabs("select","#care-circle-help");}});});};$.fn.care_circle_manage_link=function(){var base=this;return base.each(function(){var parent=this;$(this).iv_colorbox({cboxClass:"care-circle-cbox"},{href:"#care-circle-overlay",inline:true,onLoad:function(){CC_Overlay.tabs.tabs("select","#care-circle-manage");}});});};$.fn.care_circle_member_link=function(){var base=this;return base.each(function(){var parent=this;$(parent).iv_colorbox({cboxClass:"care-circle-cbox"},{href:"#care-circle-overlay",inline:true,onLoad:function(){CC_Overlay.tabs.tabs("select",$(parent).attr("href"));}});});};$.fn.care_circle_add_topic_to_member=function(){var base=this;return base.each(function(){$(this).ivAjaxPost({loading:false,additionalData:function(parent){return{save_name:$(parent).find("select[name='tid'] option:selected").html()};},onTrigger:function(parent){$(parent).find(".loading").show();},onSuccess:function(data,parent){$(parent).find(".loading").hide();$(parent).find("select option:selected").remove();data.member_name=$("li.care-circle-person a[href='#care-circle-person-"+data.member_id+"']").html();var manage_row=CC_Overlay.Manage.create_follows_row(data);$("#care-circle-manage-follows table tbody").append(manage_row);$(manage_row).addHover();var member_row=CC_Overlay.Member.create_follows_row(data);var care_circle_person_tab=$("#care-circle-overlay #care-circle-person-"+data.member_id);if(!care_circle_person_tab.find("ul.care-circle-follows").length){care_circle_person_tab.find("p.empty-follows-content").before($('<ul class="care-circle-follows">'));care_circle_person_tab.find("p.empty-follows-content").remove();}care_circle_person_tab.find("ul.care-circle-follows").append(member_row);}});});};$("#care-circle-overlay .care-circle-select-avatar").select_avatar();$("#care-circle-overlay .edit-member-profile").live("submit",function(e){e.preventDefault();$(this).ivAjaxPost({bindSubmit:false,loading:false,onTrigger:function(parent){$(parent).parent().find(".loading").show();},onSuccess:function(data,parent){$(parent).parent().find(".loading").hide();}});});$("#care-circle-overlay .care-circle-saved li").addHover();$("#care-circle-overlay .care-circle-follows li").addHover();$("#care-circle-overlay .care-circle-for li").addHover();$("#care-circle-overlay #care-circle-order li").addHover();$("#care-circle-overlay tr").addHover();function build_overlay_carousel(){var max_width=550;var width=0;if(!$("#care-circle-overlay-container:visible").length){$("#care-circle-overlay-container").css({position:"absolute",visibility:"hidden",display:"block"});$("#care-circle-overlay .care-circle-person").each(function(){width+=$(this).width();});$("#care-circle-overlay-container").css({position:"",visibility:"",display:""});}else{$("#care-circle-overlay .care-circle-person").each(function(){width+=$(this).width();});}if(width>max_width){$("#care-circle-overlay > ul").prepend('<li class="care-circle-prev">Previous</li>');$("#care-circle-overlay .care-circle-help-nav").before('<li class="care-circle-next">Next</li>');$("#care-circle-overlay .care-circle-next").unbind("click");$("#care-circle-overlay .care-circle-next").bind("click",function(){if(!$("#care-circle-overlay .care-circle-person:last:visible").length){var last_visible_index=$("#care-circle-overlay .care-circle-person:visible:last").index()-1;$("#care-circle-overlay .care-circle-person:gt("+last_visible_index+"):first").show();$("#care-circle-overlay .care-circle-person:visible:first").hide();}});$("#care-circle-overlay .care-circle-prev").unbind("click");$("#care-circle-overlay .care-circle-prev").bind("click",function(){if(!$("#care-circle-overlay .care-circle-person:first:visible").length){var first_visible_index=$("#care-circle-overlay .care-circle-person:visible:first").index()-1;$("#care-circle-overlay .care-circle-person:visible:last").hide();$("#care-circle-overlay .care-circle-person:lt("+first_visible_index+"):last").show();}});var tab_width=0;var hide_tabs=false;$("#care-circle-overlay .care-circle-person").each(function(i){if(hide_tabs){$(this).hide();}else{if(!$(this).is(":visible")){$("#care-circle-overlay-container").css({position:"absolute",visibility:"hidden",display:"block"});tab_width+=$(this).width();$("#care-circle-overlay-container").css({position:"",visibility:"",display:""});}else{tab_width+=$(this).width();}if(tab_width>max_width){hide_tabs=true;if(i!=0){$(this).hide();}}}});}}build_overlay_carousel();$("#care-circle-overlay > ul li").each(function(){$(this).attr("rel",$(this).index());});jQuery.fn.sort=function(){return this.pushStack([].sort.apply(this,arguments),[]);};function sort_by_index(a,b){return $(a).attr("rel")>$(b).attr("rel")?1:-1;}$("#care-circle-overlay #care-circle-order").sortable({stop:function(event,ui){$("#care-circle-overlay #care-circle-order li").each(function(){var tab_li=$("#care-circle-overlay > ul a[href='"+$(this).attr("rel")+"']").parent("li");tab_li.attr("rel",$(this).index());});$("#care-circle-overlay > ul li").sort(sort_by_index).appendTo("#care-circle-overlay > ul");var member_order="[";$("#care-circle-overlay #care-circle-order li").each(function(i){member_order+=$(this).attr("rel").replace("#care-circle-person-","")+",";});member_order=member_order.substr(0,member_order.length-1);member_order+="]";$.post("/care_circle/arrange_members",{members:member_order});}});function ajax_delete_follows(jquery_object){jquery_object.ivAjaxPost({additionalData:{save_name:$(parent).closest("li").find("a").html()},onSuccess:function(data,parent){var option=$('<option value="'+data.tid+'">');
option.html($(parent).closest("li").find("a").html());$(parent).closest(".care-circle-col").find("select[name='tid']").append(option);$(parent).closest("li").remove();}});}function ajax_remove_save(jquery_object){jquery_object.ivAjaxPost({onSuccess:function(data,parent){$(parent).closest("li").remove();}});}ajax_remove_save($("#care-circle-overlay .care-circle-saved form"));$("#care-circle-overlay .care-circle-for form").ivAjaxPost({loading:false,validate:function(parent){var needle=$(parent).closest("li").find("a").html();$(parent).closest(".ui-tabs-panel").find(".care-circle-saved").find("li").each(function(){if($.trim(needle)==$.trim($(this).find("a").html())){$(parent).closest("li").find(".already-saved").slideDown("fast").delay(1000).slideUp("fast");return false;}return true;});return true;},onTrigger:function(){$(parent).parent().find(".loading").show();},onSuccess:function(data,parent){$(parent).parent().find(".loading").hide();var item=$('<li class="clearfix"><a href="'+($(parent).closest("li").find("a").attr("href"))+'" name="iv:health:care-circle-overlay:follows">'+data.save_name+'</a><form method="post" action="/care_circle/remove_save"><fieldset><input type="hidden" name="save_type" value="node"><input type="hidden" name="nid" value="'+data.nid+'"><input type="hidden" name="member_id" value="'+data.member_id+'"><input type="hidden" name="save_name" value="'+data.save_name+'"><button type="submit" name="iv:health:care-circle-overlay:follows:delete">Delete</button></fieldset></form></li>');ajax_remove_save(item.find("form"));item.addHover();var ul=$(parent).closest(".ui-tabs-panel").find(".care-circle-saved");if(ul.length){ul.append(item);}else{var last_col=$(parent).closest(".ui-tabs-panel").find(".care-circle-last-col");var new_ul=$('<ul class="care-circle-saved">');new_ul.append(item);last_col.find(".empty-content").remove();last_col.find(".care-title").after(new_ul);}$(parent).closest("li").find(".success").slideDown("fast").delay(1000).slideUp("fast");}});$("#care-circle-overlay .add-someone").ivAjaxPost({loading:false,validate:function(target){var name=$(target).find("input[name='name']");if(name.val()=="Name"||name.val()==""){alert("Please provide a name.");name.focus();return false;}var birth_year=$(target).find("input[name='birth_year']");if(birth_year.val()=="Birth year"||birth_year.val()==""){alert("Please provide a birth year.");birth_year.focus();return false;}var current_date=new Date();var current_year=current_date.getFullYear();var r_birthyear=new RegExp("^[0-9]{4}$");if(!r_birthyear.test(birth_year.val())){alert("Please provide a valid 4-digit birth year.");birth_year.focus();return false;}if(birth_year.val()>current_year){alert("Please enter a birth year between 1900 - "+current_year+".");birth_year.focus();return false;}if(birth_year.val()<1900){alert("Please provide a birth year after 1900.");birth_year.focus();return false;}return true;},onTrigger:function(parent){$(parent).find(".btn-controls").hide();$(parent).find(".loading").show();},onSuccess:function(data,parent){$(parent).find(".btn-controls").show();$(parent).find(".loading").hide();CC_Overlay.Member.create(data,parent);},onError:function(form,request,status,e){$(form).find(".btn-controls").show();$(form).find(".loading").hide();alert("Your Care Circle can only contain 10 members. If you would like to add another, please delete an existing member and try again.");}});$("#care-circle-overlay #care-circle-order form").ivAjaxPost({onSuccess:function(data,parent){var href=$(parent).closest("li").attr("rel");$("#care-circle-overlay .ui-tabs-nav a[href='"+href+"']").closest("li").remove();$(parent).closest("li").remove();}});$(".care-circle-follows form, #care-circle-manage-follows form","#care-circle-overlay").ivAjaxPost({loading:false,onTrigger:function(parent){$(parent).parent().find(".loading").show();$(parent).find("button").hide();},onSuccess:function(data,parent){CC_Overlay.remove_topic(data,parent);}});$("tr.topic, li.topic","#care-circle-overlay").addHover();$("#care-circle-overlay form.care-circle-add-topic").care_circle_add_topic_to_member();$("#care-circle-overlay #care-circle-overlay-add-topic").ivAjaxPost({additionalData:function(parent){return{save_name:$(parent).find("select[name='tid'] option:selected").html()};},onSuccess:function(data,parent){var save_name=$(parent).find("select[name='tid'] option:selected").html();var member_name=$(parent).find("select[name='member_id'] option:selected").html();var span=$('<span class="green-check">'+save_name+" added for "+member_name+"</span>");span.unbind("click");span.bind("click",function(){$(this).remove();});$(parent).find("fieldset span.green-check").remove();$(parent).find("fieldset").append(span);data.save_name=save_name;data.member_name=member_name;var manage_row=CC_Overlay.Manage.create_follows_row(data);$("#care-circle-manage-follows table tbody").append(manage_row);var member_row=CC_Overlay.Member.create_follows_row(data);var care_circle_person_tab=$("#care-circle-overlay #care-circle-person-"+data.member_id);if(!care_circle_person_tab.find("ul.care-circle-follows").length){care_circle_person_tab.find("p.empty-follows-content").before($('<ul class="care-circle-follows">'));care_circle_person_tab.find("p.empty-follows-content").remove();}care_circle_person_tab.find("ul.care-circle-follows").append(member_row);}});$("#care-circle-overlay .self-avatar").change(function(){$(this).closest("form").submit();});$("#care-circle-overlay .delete-profile").bind("click",function(){if(!confirm("Are you sure you want to delete this Profile?")){return false;}var member_id=$(this).closest("fieldset").find('input[name="member_id"]').val();var member_tab=$("#care-circle-person-"+member_id);$.post("/care_circle/remove_member",{member_id:member_id},function(data){var href="#care-circle-person-"+member_id;$("#care-circle-overlay > ul a[href='"+href+"']").parent("li").remove();CC_Overlay.tabs.tabs("select","#care-circle-manage");member_tab.remove();CC_Overlay.Member.remove(member_id);});return true;});$("#care-circle-overlay a.sign-in").unbind("click");$("#care-circle-overlay a.sign-in").bind("click",function(e){e.preventDefault();$("#cboxClose").trigger("click");});$(':input[name="gender"]').trigger("change");$('input[name="birth_year"]').trigger("change");};iVillage.runners.blocks.care_circle_small=function(){$(".mod-care-circle-small .learn-more-link").care_circle_help_link();$(".mod-care-circle-small .manage-link").care_circle_manage_link();$(".mod-care-circle .member-link, .mod-care-circle-small .member-link").bind("click",function(e){e.preventDefault();$(this).colorbox({href:"#care-circle-overlay",inline:true,onLoad:function(){$("#care-circle-overlay").tabs().tabs("select",$(this).attr("href"));},onOpen:function(){$("#cboxWrapper").addClass("care-circle-cbox");}});});function build_carousel(){$(".mod-care-circle-small").each(function(){if($(this).find("ul.member-content li:visible").size()>1){$(this).prepend('<span class="care-circle-next">Next</span>');$(this).find(".carousel-content").jCarouselLite({btnNext:".mod-care-circle-small .care-circle-next",visible:1,circular:true});}});$(".mod-care-circle-small .member-link").unbind("click").bind("click",function(e){e.preventDefault();$(this).colorbox({href:"#care-circle-overlay",inline:true,onLoad:function(){$("#care-circle-overlay").tabs().tabs("select",$(this).attr("href"));},onOpen:function(){$("#cboxWrapper").addClass("care-circle-cbox");}});});}$(".intro .add-someone, .intro .add-a-health-topic,",".mod-care-circle-small").bind("click",function(){$(this).closest(".mod-care-circle-small").children("div").hide();$(this).closest(".mod-care-circle-small").children("form").hide();$($(this).attr("href")).show();$(".mod-care-circle-small .sub-title").show();return false;});$(".mod-care-circle-small .cancel").bind("click",function(){$(this).closest(".mod-care-circle-small").find("form").hide();$(this).closest(".mod-care-circle-small").find(".intro").show();return false;});$(".care-circle-select-avatar").select_avatar();build_carousel();$(".mod-care-circle-small .add-someone input[name='name']").clearDefault();$(".mod-care-circle-small .add-someone input[name='birth_year']").clearDefault();$(".mod-care-circle-small .add-topic").ivAjaxPost({additionalData:function(){return{save_name:$(".mod-care-circle-small .add-topic select[name='tid'] option:selected").html()};},onSuccess:function(data,parent){$.fn.reload_cc_overlay();var carousel_content=$("<div>");carousel_content.addClass("carousel-content");carousel_content.care_circle_load_hp_data({location:"small_module",onSuccess:function(){var manage_link=$('<a class="manage-link">Manage My Care Circle</a>');manage_link.care_circle_manage_link();carousel_content.append(manage_link);$(parent).closest(".mod-care-circle-small").find("div, form").hide();$(parent).closest(".mod-care-circle-small").append(carousel_content);$(".mod-care-circle-small .sub-title").show();build_carousel();}});carousel_content.trigger("fetch_hp_data");}});$(".mod-care-circle-small .add-someone").ivAjaxPost({loading:false,onTrigger:function(parent){$(".mod-care-circle-small #care-circle-small-add-someone").find(".btn-controls").hide();$(".mod-care-circle-small #care-circle-small-add-someone").find(".loading").show();},validate:function(target){var base=$(".mod-care-circle-small #care-circle-small-add-someone");var name=base.find("input[name='name']");if(name.val()=="Name"||name.val()==""){alert("Please provide a name.");name.focus();return false;}if(!base.find("input[name='gender']").is(":checked")){alert("Please select Male or Female.");return false;}var birth_year=base.find("input[name='birth_year']");if(birth_year.val()=="Birth year"||birth_year.val()==""){alert("Please provide a birth year.");birth_year.focus();return false;}var current_date=new Date();var current_year=current_date.getFullYear();var r_birthyear=new RegExp("^[0-9]{4}$");if(!r_birthyear.test(birth_year.val())){alert("Please provide a valid 4-digit birth year.");birth_year.focus();return false;}if(birth_year.val()>=current_year){alert("Please provide a birth year in the past.");birth_year.focus();return false;}if(birth_year.val()<1900){alert("Please provide a birth year after 1900.");birth_year.focus();return false;}return true;},additionalData:function(){return{term:$(".mod-care-circle-small #care-circle-small-add-someone select[name='tid'] option:selected").html()};},onSuccess:function(data,parent){alert("success");var base=$(".mod-care-circle-small #care-circle-small-add-someone");$(base).find(".btn-controls").show();$(base).find(".loading").hide();$.fn.reload_cc_overlay();$(".mod-care-circle-small form").hide();$(".mod-care-circle-small .green-check").html("You added "+data.name+"!");$(".mod-care-circle-small .added-info").html('<img src="'+$(".mod-care-circle-small .add-someone .selected-avatar").attr("src")+'" alt="" /><div class="name">'+data.name+"</div><p>"+data.gender+", "+data.age+" years old</p>"+(typeof(data.term)!="undefined"?('<div class="topic">'+data.term+"</div>"):""));$(".mod-care-circle-small .add-someone-success").show();var carousel_content=$("<div>");carousel_content.addClass("carousel-content");carousel_content.care_circle_load_hp_data({location:"small_module",onSuccess:function(){var manage_link=$('<a class="manage-link">Manage My Care Circle</a>');manage_link.care_circle_manage_link();carousel_content.append(manage_link);$(".mod-care-circle-small").find("div, form").hide();$(".mod-care-circle-small").append(carousel_content);$(".mod-care-circle-small .sub-title").show();build_carousel();}});carousel_content.trigger("fetch_hp_data");},onError:function(form,request,status,e){$(form).find(".btn-controls").show();$(form).find(".loading").hide();alert("Your Care Circle can only contain 10 members. If you would like to add another, please delete an existing member and try again.");}});};(function($){$(document).bind("OPEN_LOGIN",function(){if($("body").hasClass("member-login")){$.fn.colorbox({href:"/ajax/login-popup-member",open:true});}else{$.fn.colorbox({href:"/ajax/login-popup?redirect_to="+location.href,open:true});}jQuery(document).ready(function(){$(document).bind("cbox_complete",function(){$("#ov-submit").inputRollover();var request_url=location.href+location.hash;var login_form=$("#ov-login-form");var old_action=login_form.attr("action");login_form.attr("action",old_action.replace("[request_url]",request_url));var opacity_wraps=$("#ov-login .opacity-wrap");var post_anon=$('#ov-login-form input[name="post_anon"]');var login_method="";opacity_wraps.hover(function(){$(this).animate({opacity:1},250);opacity_wraps.not(this).each(function(){if(!$(this).hasClass("active")){$(this).dequeue().animate({opacity:0.3},250);}});if(!post_anon.parent().hasClass("inactive")){post_anon.parent().dequeue().animate({opacity:0.3},250);}},function(){opacity_wraps.each(function(){if($(this).hasClass("inactive")){$(this).dequeue().animate({opacity:0.3},250);}if(!$(this).hasClass("inactive")){$(this).dequeue().animate({opacity:1},250);}if(!post_anon.parent().hasClass("inactive")){post_anon.parent().dequeue().animate({opacity:1},250);}});}).click(function(){$(this).removeClass("inactive").addClass("active");opacity_wraps.not(this).removeClass("active").addClass("inactive").find("input").val("").end().find(".err-msg").remove().end().dequeue().animate({opacity:0.3},250);post_anon.removeAttr("checked").parent().addClass("inactive").dequeue().animate({opacity:0.3},250);post_anon.parent().hover(function(){if($(this).hasClass("inactive")){$(this).dequeue().animate({opacity:1},250);}},function(){if($(this).hasClass("inactive")){$(this).dequeue().animate({opacity:0.3},250);}});login_method=($(this).parent().attr("id")=="member-login")?"member":"guest";});$('input[name="post_anon"]').parent().hover(function(){if(!$(this).hasClass("active")){opacity_wraps.not(".active").animate({opacity:0.3},250);}},function(){if(!$(this).hasClass("active")){opacity_wraps.not(".inactive").animate({opacity:1},250);}});$('input[name="post_anon"]').bind("click",function(e){switch($(this).attr("checked")){case true:$(this).parent().removeClass("inactive").addClass("active");login_method="anonymous";opacity_wraps.removeClass("active").addClass("inactive").find("input").val("").end().find(".err-msg").remove().end().dequeue().animate({opacity:0.3},250);break;case false:$(this).parent().removeClass("active");login_method="none";$(this).parent().remove;opacity_wraps.removeClass("inactive").find("input").val("").end().dequeue().animate({opacity:1},250);break;}});function validEmail(email){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(email);}function validateLogin(form){var the_form=$("#"+form);var form_inputs=the_form.find("input");var err_msg="Invalid ";var err_count=0;the_form.find("input").each(function(){if(!$.trim($(this).val()).length||($(this).prev("label").text()=="Email"&&!validEmail($(this).val()))){err_msg+=$(this).prev("label").text();err_msg+="/";err_count++;}});if(err_count){err_msg=err_msg.substr(0,err_msg.length-1);err_msg=err_msg.replace("Forgot password?","");var err_msg_elem=$(".err-msg",the_form);if(!err_msg_elem.length){err_msg_elem=$('<span class="err-msg"></span>').insertAfter(form_inputs.filter(":last"));}err_msg_elem.text(err_msg);return false;}else{return true;}}$("#ov-login-form").bind("submit",function(e){switch(login_method){case"member":if(!$(this).hasClass("comment-stored")){if(validateLogin("member-login")){$(document).bind("LOGIN_STORE_COMPLETE",function(){$(document).unbind("LOGIN_STORE_COMPLETE");$("#ov-login-form").addClass("comment-stored").trigger("submit");});$(document).trigger("LOGIN_STORE");e.preventDefault();}else{e.preventDefault();}}break;case"guest":e.preventDefault();if(validateLogin("guest-login")){$(document).trigger("LOGIN_COMPLETE",["guest",$("#guest-name").val(),$("#guest-email").val()]);$.fn.colorbox.close();}break;case"anonymous":e.preventDefault();$(document).trigger("LOGIN_COMPLETE",["anon"]);$.fn.colorbox.close();break;default:e.preventDefault();break;}});});});});})(jQuery);iVillage.runners.blocks.toolkit=function(){$(".buttons").prepend('<div id="please" style="position:relative; top:20px;margin-bottom:-15px;">Please select a need and ingredient.</div>');theselector=$("#healthy-recipe-lookup .btn-find-121x39");$(theselector).hide();$("#dietary_need, #add_main_ingredient").change(function(){if($("#dietary_need  option:selected").index()===0||$("#add_main_ingredient option:selected").index()===0){$(theselector).hide();$("#healthy-recipe-lookup #please").show();}else{$(theselector).show();$("#healthy-recipe-lookup #please").hide();}});};iVillage.runners.blocks.coupons=function(){try{var category=coupons_category!=null?"&category="+coupons_category:"";$.getJSON("/coupons?format=json"+category,function(data){var counter=0;$.each(data.coupons,function(i,val){try{counter++;var description=val.description.match(/\$(\d{1,3}(\,\d{3})*|(\d+))(\.\d{2})?/)[0];var tracking=(typeof coupons_tracking==="undefined")?"iv:food:coupons":coupons_tracking;tracking+=":coupon:"+counter.toString()+":"+escape(val.brand);$("#external-coupons-container").append('<div class="coupon-item">                                                        <div class="coupon-item-inner">                                                                <a class="coupon-item-img" href="/coupons?url='+escape(val.link)+'" name="'+tracking+'"><img src="'+val.image+'" width="80" height="100" /></a>                                                                <div class="coupon-item-saving">Save '+description+'</div>                                                                <div class="coupon-item-brand"><a href="/coupons?url='+escape(val.link)+'" name="'+tracking+'">'+val.brand+"</a></div>                                                        </div>                                                </div>");}catch(err){}});});}catch(err){}};iVillage.runners.blocks.newsletter_expecting=function(){$(".mod-newsletter-expecting #newsletter-signup input").clearDefault();var signup_form=$(".mod-newsletter-expecting #newsletter-signup");signup_form.bind("submit",function(e){e.preventDefault();CS_validatePreg(signup_form);});function CS_validatePreg(formObj){year=$(formObj).find("input.due-year").val();month=$(formObj).find("input.due-month").val();day=$(formObj).find("input.due-day").val();if(month==""||month=="M"){alert("Please enter a month.");return false;}if(day==""||day=="D"){alert("Please enter a day.");return false;}if(year==""||year=="Year"){alert("Please enter a year.");return false;}tempMonth=month;tempDay=day;if(!iv_isValidDate(tempDay,tempMonth,year)){return false;}month=tempMonth;day=tempDay;bDateObj=new Date(month+"/"+day+"/"+year);if(!isPregnant(bDateObj)){alert("You have entered a due date that is more than 40 weeks in the future. Please check your information.");return false;}if(!stillPreg(bDateObj)){alert("You have entered a due date that has already passed. Please check your information.");return false;}bDateStr="s=|n1=|b1="+year+month+day;iv_SetCookie("iv_tpar",bDateStr,"","/",".ivillage.com");$(formObj).delay(500,CS_goLogin);return false;}function CS_goLogin(formObj){document.location="/user/sign-up?referrer=https%3A%2F%2Fsubscriber%2Eivillage%2Ecom%2Ffamilyprofile%3Frd%3Dhttp%3A%2F%2Fparenting%2Eivillage%2Ecom%2Fpregnancy%2Fcalendar%2Fmain";return false;}function isPregnant(dateObj){daysPreg=dateObj.getTimeDiff("dd",new Date());if(daysPreg>=279){return false;}return true;}function stillPreg(dateObj){today=new Date();if(dateObj.getTime()<=today.getTime()){return false;}return true;}function daysInFebruary(year){var numDays=28;if((year%4==0)&&(year%100!=0)||(year%400==0)){numDays=29;}return numDays;}function DaysArray(n){tempDays=new Array(n);for(var i=1;i<=n;i++){this[i]=31;if(i==4||i==6||i==9||i==11){tempDays[i]=30;}if(i==2){tempDays[i]=29;}}return tempDays;}function iv_isValidDate(argDay,argMonth,argYear){var daysInMonth=DaysArray(12);var strMonth=argMonth;var strDay=argDay;var strYr=argYear;var minYear=1900;var maxYear=2100;if(strDay.charAt(0)=="0"&&strDay.length>1){strDay=strDay.substring(1);}if(strMonth.charAt(0)=="0"&&strMonth.length>1){strMonth=strMonth.substring(1);}for(var i=1;i<=3;i++){if(strYr.charAt(0)=="0"&&strYr.length>1){strYr=strYr.substring(1);}}month=parseInt(strMonth);day=parseInt(strDay);year=parseInt(strYr);if(strMonth.length<1||month<1||month>12){alert("Please enter a valid month");return false;}if(strDay.length<1||day<1||day>31||(month==2&&day>daysInFebruary(year))||day>daysInMonth[month]){alert("Please enter a valid day");return false;}if(strYr.length!=4||year==0||year<minYear||year>maxYear){alert("Please enter a valid year");return false;}return true;}function iv_SetCookie(name,value,expires,path,domain){var ckToday=new Date();if(expires!=null){var exp=new Date(ckToday.getTime()+expires*24*60*60*1000);}document.cookie=name+"="+escape(value)+((expires)?"; expires="+exp.toGMTString():"")+"; path="+((path)?path:"/")+((domain)?"; domain="+domain:"");}Date.prototype.getTimeDiff=function(unit,dateRef,doNotRound){if(!(dateRef instanceof Date)){return;}this.unitValues=this.getUnitsInMilliseconds();var offset=this.unitValues.mi*(this.getTimezoneOffset()-dateRef.getTimezoneOffset());var oms=dateRef.getTime();var mms=this.getTime();var diff=mms-oms;diff-=offset;return(Math.floor(diff/this.unitValues[unit]));};Date.prototype.getUnitsInMilliseconds=function(){var obj=new Object();obj.ms=1;obj.ss=1000;obj.mi=obj.ss*60;obj.hh=obj.mi*60;obj.dd=obj.hh*24;obj.wk=obj.dd*7;obj.mm=obj.dd*30;obj.yyyy=obj.dd*365;return obj;};};iVillage.runners.blocks.ask_your_question=function(){var ayq={};ayq.settings={colorbox:{config:{inline:true,href:".mod-ask-your-question",maxHeight:600,maxWidth:600,title:false,onOpen:null,onCleanup:null,onResize:null},cboxClass:"ask-your-question-cbox"},validate:{errorElement:"em",wrapper:"div class='error'",submitHandler:null},topicContainer:".mod-search-container",messages:{success:{headline:"Your question has been submitted!",body1:"Our editors and experts will review your question.",body2:"Check back, we are posting new questions all the time."},failure:{headline:"We are unable to submit your question at this time",body1:"Please reload this page and try submitting your question again"},login:{headline:"Login Required",body1:"Please click the link below to login or register"}},responseClasses:{header:"mod-ask-your-question-success-header",body:"mod-ask-your-question-success-message"},form:{id:"askYourQuestionForm",container:".mod-ask-your-question-form-container",loaderClass:"mod-ask-your-question-loader-div",defaultValues:{questionTitle:null,emailBody:null},source:null,filters:{f1:"#filter1",f2:"#filter2",f3:"#filter3"}}};ayq.colorboxOpen=function(){$("#colorbox").addClass(ayq.settings.colorbox.cboxClass);$("#cboxTitle").remove();$("#cboxWrapper").next().width("100%");};ayq.colorboxCleanUp=function(){$("#colorbox").removeClass(ayq.settings.colorbox.cboxClass);};ayq.colorboxResize=function(){$("#colorbox, #cboxWrapper").css("overflow","visible");};ayq.showOverlay=function(e){e.preventDefault();if(!iV_SSO.isLoggedIn()){iV_SSO.login(e);}else{ayq.populateSelectList();$.fn.colorbox(ayq.settings.colorbox.config);}};ayq.hideOverlay=function(){$.fn.colorbox.close();return false;};ayq.populateSelectList=function(){var filter=iVillage.qaFilters;var filterLevel=1;var setFocus=$(ayq.settings.form.filters["f"+filterLevel]).children().length>0?true:false;var needsLoading=true;var enabledSelects=$("#"+ayq.settings.form.id+" select:not(:disabled)");if(setFocus){$("#"+ayq.settings.form.id+" input").focus();}enabledSelects.each(function(i){var selected=$(this).children(":selected");if(selected.length>0){if(ayq.settings.form.selectedFilters["f"+filterLevel]==selected.text()&&ayq.settings.form.selectedFilters["f"+filterLevel]!=null){needsLoading=false;}else{needsLoading=true;}if(ayq.settings.form.selectedFilters["f"+filterLevel]!=null&&ayq.settings.form.selectedFilters["f"+filterLevel]!=selected.text()){$(this).nextAll("select").empty().attr("disabled","disabled");}ayq.settings.form.selectedFilters["f"+filterLevel]=selected.text();filter=filter[selected.text()]["sub-filters"];filterLevel++;}else{$(this).nextAll("select").empty().attr("disabled","disabled");}});if(setFocus){$("#"+ayq.settings.form.id+" input").blur();var filter_i=filterLevel>1?filterLevel-1:filterLevel;$(ayq.settings.form.filters["f"+filter_i]).focus();}if(needsLoading){ayq.loadOptions(filter,filterLevel);}};ayq.loadOptions=function(filter,filterLevel){for(var name in filter){if(filter[name]["tid"]!=null){$("<option></option>").attr({title:name,name:name,id:name,value:filter[name]["tid"]}).text(name).appendTo(ayq.settings.form.filters["f"+filterLevel]);$(ayq.settings.form.filters["f"+filterLevel]).removeAttr("disabled");}else{$(ayq.settings.form.filters["f"+filterLevel]).attr("disabled","disabled");}}};ayq.replaceOverlayContent=function(newContent){$("#"+ayq.settings.form.id).hide().siblings().remove();$(ayq.settings.form.container).append(newContent);$(ayq.settings.colorbox.config.href).height("auto");$.fn.colorbox.resize();};ayq.revertToForm=function(){$("#"+ayq.settings.form.id).show().siblings().remove();$("#"+ayq.settings.form.id+" input").val(ayq.settings.form.defaultValues.questionTitle);$("#"+ayq.settings.form.id+" textarea").val(ayq.settings.form.defaultValues.emailBody);$("#"+ayq.settings.form.id+" select").empty();};ayq.ajaxSumbitCallback=function(response,textStatus){var html="";if(response.success==true){html+='<p class="'+ayq.settings.responseClasses.header+'">'+ayq.settings.messages.success.headline+"</p>";html+='<p class="'+ayq.settings.responseClasses.body+'">'+ayq.settings.messages.success.body1+"</p>";html+='<p class="'+ayq.settings.responseClasses.body+'">'+ayq.settings.messages.success.body2+"</p>";}else{html+='<p class="'+ayq.settings.responseClasses.header+'">'+ayq.settings.messages.failure.headline+"</p>";html+='<p class="'+ayq.settings.responseClasses.body+'">'+ayq.settings.messages.failure.body1+"</p>";}html+='<a class="mod-ask-your-question-close-button" href="#">Close</a>';ayq.replaceOverlayContent(html);};ayq.submitForm=function(form,data){var containerHeight=$("#"+ayq.settings.form.id).height();var html='<div class="'+ayq.settings.form.loaderClass+'" style="height:'+containerHeight+'px;"></div>';ayq.replaceOverlayContent(html);$.getJSON($(form).attr("action"),data,ayq.ajaxSumbitCallback);};ayq.settings.form.defaultValues.questionTitle=$("#user_question").val();ayq.settings.form.defaultValues.emailBody=$("#question_details").text();ayq.settings.form.source=$("#"+ayq.settings.form.id);ayq.settings.form.selectedFilters={};ayq.settings.form.selectedFilters.f1=null;ayq.settings.form.selectedFilters.f2=null;ayq.settings.form.selectedFilters.f3=null;ayq.settings.colorbox.config.onOpen=ayq.colorboxOpen;ayq.settings.colorbox.config.onCleanup=ayq.colorboxCleanUp;ayq.settings.colorbox.config.onResize=ayq.colorboxResize;ayq.settings.validate.submitHandler=ayq.submitForm;$("#"+ayq.settings.form.id+" input, #"+ayq.settings.form.id+" textarea").clearDefault();$("#"+ayq.settings.form.id).validate(ayq.settings.validate);$.validator.addMethod("isNotDefaultText",function(value,element,defaultValue){return this.optional(element)||$.trim(value)!=$.trim(defaultValue);},"This field is required.");$("#user_question").rules("add",{isNotDefaultText:ayq.settings.form.defaultValues.questionTitle});$("#question_details").rules("add",{isNotDefaultText:ayq.settings.form.defaultValues.emailBody});$("#show-quesiton-overlay").click(ayq.showOverlay);$("a.mod-ask-your-question-close-button").live("click",ayq.hideOverlay);$("#"+ayq.settings.form.id+" select").live("click",ayq.populateSelectList);$(document).bind("cbox_closed",ayq.revertToForm);};iVillage.runners.blocks.recipe_search=function(){var qp=window.location.search,has_time_meta=qp.indexOf("total-time")>-1,refine_time=function(time){window.location=$(".recipe-filter .slider-points .pt-"+time+" a").attr("href");},remove_filter=function(type,name){},display_time=function(time){$(".recipe-filter #search-slider").addClass("selected-"+time);$(".recipe-filter .slider-points").addClass("selected-"+time);},slider_val=15;if(has_time_meta){slider_val=/&total-time=(\d+)/.exec(qp)[1];display_time(slider_val);}$.fn.qtip.styles.foodSearch={width:{min:200,max:1000},title:{background:"#ffffff","border-bottom":"dotted 1px #cccccc","margin-left":"9px","margin-right":"9px","padding-left":"0","padding-right":"0"},border:{width:2,radius:4,color:"#cccccc"},tip:{corner:"leftMiddle",size:{x:8,y:12}}};$(".recipe-filter .filters a").each(function(){var items=$(this).next(),contents=items.find(".contents"),title=items.find(".title").html();$(this).qtip({content:{text:contents,title:{text:title,button:"&nbsp;"}},style:"foodSearch",position:{corner:{target:"rightMiddle",tooltip:"leftMiddle"}},show:{solo:true,when:{event:"click"}},hide:{when:{event:"click"}}});});$("#search-slider").slider({min:15,max:60,step:15,value:slider_val,change:function(event,ui){refine_time(ui.value);display_time(ui.value);}});};iVillage.runners.blocks.slideshow=function(){$(".slideshow #slideshow").slideshow({debug:"false"});$("#list-view").removeClass("hide");};(function($){var o;var image,tooltip,tooltip_t,tooltip_l;$.fn.slideshow=function(options){var opts=$.extend({},$.fn.slideshow.defaults,options);return this.each(function(){$this=$(this);o=opts;debug("Initializing slideshow...");var valid_image=getImageSize();if(valid_image){bindSlideControls();}centerControls();alignGridImages();createTabs();});};createTabs=function(){debug("Creating tabs...");if($.fn.tabs){debug("Tabs plugin available...");$("div.slideshow-tabs").tabs({fx:{opacity:"toggle",duration:"medium"}});}};getImageSize=function(){image=$this.find("#slideshow-img img");if(image.length){image.w=parseInt(image.attr("width"));image.h=parseInt(image.attr("height"));image.prop=(image.h>image.w)?"p":"l";debug("Image dimensions: "+image.w+" x "+image.h);debug("Image proporation: "+image.prop);return true;}else{return false;}};bindSlideControls=function(){debug("Binding slide controls...");var arrow_top_pos=parseInt(image.h/2);debug("Arrow top: "+arrow_top_pos+"px");var slide_ctrls=$(".slide-ctrls",$this);if(image.prop=="p"){$("#slideshow-img",$this).addClass("portrait");}slide_ctrls.removeClass("hide").css("display","none");slide_ctrls.children().css("top",arrow_top_pos).end().fadeIn("slow").find("li a").bind("mouseover",dispPreviewTooltip);};dispPreviewTooltip=function(){debug("* Tooltip hover");var $this=$(this);$this.addClass("active");$("html,body").bind("mouseover",hidePreviewTooltip);};hidePreviewTooltip=function(){debug("* Tooltip out");$("html,body").unbind("mouseover");$(".slide-ctrls a.active").removeClass("active");};centerControls=function(){var slideshow_end=$("#slideshow-end");if(slideshow_end.length){$(".related-wrap, #controls",slideshow_end).centerHoriz();}};alignGridImages=function(){$("#list-view > ul > li > a > img",$this).each(function(){var grid_item_img=$(this);if(parseInt(grid_item_img.height())>parseInt(grid_item_img.width())){grid_item_img.parent().addClass("port");}});};debug=function(obj){if(window.console&&window.console.log&&o.debug=="true"){window.console.log(obj);}};$.fn.slideshow.defaults={debug:"false"};})(jQuery);(function($){iVillage.runners.blocks.healthwise=function(){var topic_carousel=$("#topic-carousel");var caro_wrap=topic_carousel.find(".carousel-wrap");var caro_length=caro_wrap.find("img").length;if(caro_length>1){var caro_ctrls=topic_carousel.find(".caro-ctrls");var caro_count=topic_carousel.find(".caro-count");var caro_count_current=caro_count.find(".caro-current");var caro_count_total=caro_count.find(".caro-total");caro_wrap.jCarouselLite({btnNext:"ul.caro-ctrls .next a",btnPrev:"ul.caro-ctrls .prev a",speed:750,beforeStart:function(slide){},afterEnd:function(slide){var new_caro_count=caro_wrap.find("ul li").index(slide);if(new_caro_count>caro_length){new_caro_count=1;}else{if(new_caro_count<=0){new_caro_count=caro_length;}}caro_count_current.text(new_caro_count);},visible:1});caro_count_total.text(caro_length);caro_count.hide().removeClass("hide").fadeIn("slow");caro_ctrls.hide().removeClass("hide").fadeIn("slow");}$("a.popup").open({width:"600",height:"400",resizable:"1"});};})(jQuery);iVillage.runners.blocks.share_your_story=function(){$.fn.fileBrowseReplace=function(){if($(":file").length!=0){$(":file").filestyle({image:"/public/images/buttons/browse.png",imagewidth:65,imageheight:30,width:303,yoffset:0});}};$.fn.fileBrowseReplace();if($("#share_your_story_form").length){$("#share_your_story_form").charcounter({text_input:"#title",chars_elem:".chars-remaining",char_limit:200});}jQuery("#share_your_story_form #title").trigger("focus").trigger("keyup");$("ul.themes li a").bind("click",function(e){var theme=$(this).attr("rel");$("#story_theme").val(theme);$("ul.themes li a.active").removeClass("active");$(this).addClass("active");e.preventDefault();});if($("input[type=radio]").length>0){$("#success_story_fitness").click(function(){$("#weight-loss").hide();$("#fitness").show();});$("#success_story_weight_loss").click(function(){$("#fitness").hide();$("#weight-loss").show();});}var _iVillage_shareRealStories={inputStatus:function(selector,nodeType){this.selector=selector;this.nodeType=nodeType;jQuery(this.selector).find(this.nodeType).addClass("clean");jQuery(this.selector).find(this.nodeType).focus(function(){jQuery(".share-story-errors").addClass("hide");jQuery(this).removeClass("clean").addClass("focused");if(this.value==this.defaultValue){this.value="";}if(this.value!=this.defaultValue){this.select();}});jQuery(this.selector).find(this.nodeType).blur(function(){jQuery(this).removeClass("focused").addClass("clean");if(jQuery.trim(this.value)==""){this.value=(this.defaultValue?this.defaultValue:"");}});},checkInput:function(selector,nodeType){this.selector=selector;this.nodeType=nodeType;var targetElem=this.selector;var targetType=this.nodeType;jQuery("<div class='form-errors hide'>Oops! You forgot to fill this field</div>").insertBefore(jQuery(this.selector).find("button"));jQuery(this.selector).find("button").click(function(){var currentValue=jQuery(targetElem).find(targetType).val();var trimValue=jQuery.trim(currentValue);if(trimValue=="What's your story about?"||trimValue=="Whatâ€™s Your Story About?"){jQuery("div.form-errors").removeClass("hide").addClass("share-story-errors");return false;}else{return true;}});}};var dietFitnessStories=function(){if(jQuery("form[name=realStories]").parent().attr("class")!="share-form"){var checkInputFocus=new _iVillage_shareRealStories.inputStatus("div#share-your-story","input");var validateInput=new _iVillage_shareRealStories.checkInput("div#share-your-story","input");$("div#share-your-story").find("input").blur();}};var realStories=function(){if(jQuery("form.share-real-stories")){var checkTextFocus=new _iVillage_shareRealStories.inputStatus("form.share-real-stories","textarea");var validateText=new _iVillage_shareRealStories.checkInput("form.share-real-stories","textarea");}};dietFitnessStories();realStories();};(function($){iVillage.runners.blocks.beyond_bmi=function(){$.fn.beyond_bmi();};})(jQuery);(function($){$.fn.beyond_bmi=function(){$("input:radio[@name='gender']").click(function(){var choice=$("input:radio[@name='gender']:checked").val();switch(choice){case"male":$(".male-body-types").show();$(".female-body-types").hide();break;case"female":$(".male-body-types").hide();$(".female-body-types").show();break;}});$("a","#beyond-bmi-form li.bodytype").click(function(e){e.preventDefault();var index=$(this).closest(".bodytype").index();$("a.selected","#beyond-bmi-form li.bodytype").removeClass("selected");$(this).addClass("selected");$("#bodytype_selected").val(index);});$(document).ready(function(){$("#beyond-bmi-form").validate({rules:{age:{required:true,number:true,range:[1,120]},feet:{required:true,number:true,range:[1,10]},inches:{required:true,number:true,range:[0,12]},weight:{required:true,number:true,range:[1,1000]}},messages:{age:{number:"Please enter only digits.",range:"Please enter between 1-120."},feet:{number:"Please enter only digits.",range:"Please enter between 1-10."},inches:{number:"Please enter only digits.",range:"Please enter between 0-12."},weight:{number:"Please enter only digits.",range:"Please enter between 1-1000."}}});});};})(jQuery);jQuery.fn.hint=function(blurClass){if(!blurClass){blurClass="blurTextField";}return this.each(function(){var $input=jQuery(this),title=$input.attr("title"),$form=jQuery(this.form),$win=jQuery(window);function remove(){if($input.val()===title&&$input.hasClass(blurClass)){$input.val("").removeClass(blurClass);}}if(title){$input.blur(function(){if(this.value===""){$input.val(title).addClass(blurClass);}}).focus(remove).blur();$form.submit(remove);$win.unload(remove);}});};(function($){iVillage.runners.blocks.faccordion=function(){$("#accordion li a").click(function(){var a=$(this);if(a.hasClass("preview-newsletter")){return true;}var verticalContent=a.parent().siblings(".verticalContent");if(iVillage.msie!=null){verticalContent.find("table").hide(0);}verticalContent.slideToggle("normal",function(){if(a.hasClass("openArrow")){a.removeClass("openArrow");if(iVillage.msie!=null){verticalContent.find("table").show(0);}}else{a.addClass("openArrow");}$(".itemsColumn").css("position","relative");$(".newsletterItem").css("display","block");});return false;});};iVillage.runners.blocks.funnel_two=function(){$("#submitContainer > input").click(function(){if($(this).attr("name")=="subscribe"){$("form[name=subscriptionsForm]").submit();}});};iVillage.runners.blocks.funnel_five=function(){$("#submitContainer #submitDiv_funnel_five > input").click(function(){if($(this).attr("name")=="subscribe"){$("form[name=subscriptionsForm]").submit();}});$('input[title!=""]').hint();};iVillage.runners.blocks.funnel_nine=function(){$("#submitContainer #submitDiv_funnelNine > input").click(function(){if($(this).attr("name")=="subscribe"){$("form[name=unsubscriptionForm]").submit();}});$('input[title!=""]').hint();};})(jQuery);(function($){iVillage.runners.blocks.vertical_ticker=function(){if($(".discussions-container").length!=0&&$(".discussions-container ul li").size()>2){$(".discussions-container").vTicker({speed:500,pause:3500,showItems:2,animation:"fade",mousePause:true,height:0,direction:"up"});}};iVillage.runners.blocks.new_window_opener=function(){$("a").each(function(){var a=new RegExp("ivillage.com");if(!a.test(this.href)){$(this).attr("target","_blank");}});};iVillage.runners.blocks.media_tabs=function(){var tabSelected=$.cookie("iv-home-tab");if(tabSelected=="video"){$("#home-hero").tabs("select",2);$.cookie("iv-home-tab","photo");}else{$("#home-hero").tabs("select",1);$.cookie("iv-home-tab","video");}};})(jQuery);(function($){iVillage.runners.blocks.holidaily_bg_image_flip=function(){var d=new Date();var hour=d.getHours();var image="";if(hour>=6&&hour<19){image="Holidaily-Winter-Day-BG.jpg";}else{image="Holidaily-Winter-Night-BG.jpg";}var path="/public/images/icons/"+image;};})(jQuery);function validateEmail(email){email=trim(email);var reg=/^([A-Za-z0-9_\-\.\+])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;if(reg.test(email)==false){return false;}return true;}function trim(str,chars){return ltrim(rtrim(str,chars),chars);}function ltrim(str,chars){chars=chars||"\\s";return str.replace(new RegExp("^["+chars+"]+","g"),"");}function rtrim(str,chars){chars=chars||"\\s";return str.replace(new RegExp("["+chars+"]+$","g"),"");}jQuery.fn.hint=function(blurClass){if(!blurClass){blurClass="blurTextField";}return this.each(function(){var $input=jQuery(this),title=$input.attr("title"),$form=jQuery(this.form),$win=jQuery(window);function remove(){if($input.val()===title&&$input.hasClass(blurClass)){$input.val("").removeClass(blurClass);}}if(title){$input.blur(function(){if(this.value===""){$input.val(title).addClass(blurClass);}}).focus(remove).blur();$form.submit(remove);$win.unload(remove);}});};function isNewsletterSelected(validateDate){var res=false;$("#subscriptionsForm input[type=checkbox]:checked").each(function(){res=true;var chb=$(this).attr("name");if(validateDate==true&&!checkDate($("[name="+chb+".month] option:selected").val(),$("[name="+chb+".day] option:selected").val(),$("[name="+chb+".year] option:selected").val())){res=-1;return false;}if(res==-1){return false;}});return res;}function checkDate(month,day,year){if(year==undefined||month==undefined||day==undefined){return true;}if(year=="-1"||month=="-1"||day=="-1"){return false;}month=month-1;var d=new Date(year,month,day);return d.getFullYear()==year&&d.getMonth()==month&&d.getDate()==day;}$(document).ready(function(){$("#submitContainer > input").click(function(){if($(this).attr("name")=="subscribe"){if(!isNewsletterSelected()){alert("Please select at least one newsletter !");return;}$("form[name=subscriptionsForm]").submit();}else{window.location="/";}});});$(document).ready(function(){$("#enable-javascript").remove();$(".funnel-list-row").equalizeChildHeights();$.get("/ajax/time",function(txt){$("#hiddenfields").append('<input type="hidden" name="ts" value="'+txt+'" />');});$("#submitDiv_funnelFive .submitBtn").click(function(){if($(this).attr("name")=="subscribe"){var email=$(".emailField").attr("value");if(email==""||email=="Email Address"||validateEmail(email)==false){alert("Please enter a valid email address!");return;}var res=isNewsletterSelected(true);if(res==false){alert("Please select at least one newsletter !");return;}if(res==-1){alert("Please select a valid date !");return;}$("form[name=subscriptionsForm]").submit();}});$('input[title!=""]').hint();});$(document).ready(function(){$("#funnelSixUnsubscribe").click(function(){if($(this).attr("name")=="unsubscribe"){var email=$(".emailField").attr("value");if(email==""||email=="Email Address"||validateEmail(email)==false){alert("Please enter a valid email address!");return;}if(!isNewsletterSelected(false)){alert("Please select at least one newsletter !");return;}$("form[name=subscriptionsForm]").submit();}});$('input[title!=""]').hint();});$(document).ready(function(){$("#submitDiv_funnelNine > input").click(function(){if($(this).attr("name")=="unsubscribe"){var email=$(".emailField").attr("value");if(email==""||email=="Email Address"||validateEmail(email)==false){alert("Please enter a valid email address!");return;}$("form[name=unsubscriptionForm]").submit();}});$('input[title!=""]').hint();});$(document).bind("gigya.ready",function(e){$("#comments").externalComments(gigya,iVillage);var chatId="gigyaChatPlugin";$("#"+chatId).gigyaChat(gigya,iVillage,chatId);});var app={};$.Deferred=function(){this.callbacks=[];this.fired=false;$.extend(this,{resolve:function(resolveValue){this.resolveValue=resolveValue;this.fired=true;for(x in this.callbacks){this.callbacks[x](resolveValue);}},then:function(fn){if(!this.fired){this.callbacks.push(fn);}else{fn(this.resolveValue);}}});};$.extend($,{genUid:function(){var result="";for(var i=0;i<32;i++){result+=Math.floor(Math.random()*16).toString(16).toUpperCase();}return result;}});(function(d){var cache={};d.publish=function(topic,args){d.each(cache[topic],function(){this.apply(d,args||[]);});};d.subscribe=function(topic,callback){if(!cache[topic]){cache[topic]=[];}cache[topic].push(callback);return[topic,callback];};d.unsubscribe=function(handle){var t=handle[0];cache[t]&&d.each(cache[t],function(idx){if(this==handle[1]){cache[t].splice(idx,1);}});};})(jQuery);(function(){var _after=1;var _afterThrow=2;var _afterFinally=3;var _before=4;var _around=5;var _intro=6;var _regexEnabled=true;var _arguments="arguments";var _undef="undefined";var getType=(function(){var toString=Object.prototype.toString,toStrings={},nodeTypes={1:"element",3:"textnode",9:"document",11:"fragment"},types="Arguments Array Boolean Date Document Element Error Fragment Function NodeList Null Number Object RegExp String TextNode Undefined Window".split(" ");for(var i=types.length;i--;){var type=types[i],constructor=window[type];if(constructor){try{toStrings[toString.call(new constructor)]=type.toLowerCase();}catch(e){}}}return function(item){return item==null&&(item===undefined?_undef:"null")||item.nodeType&&nodeTypes[item.nodeType]||typeof item.length=="number"&&(item.callee&&_arguments||item.alert&&"window"||item.item&&"nodelist")||toStrings[toString.call(item)];};})();var isFunc=function(obj){return getType(obj)=="function";};var weaveOne=function(source,method,advice){var old=source[method];if(advice.type!=_intro&&!isFunc(old)){var oldObject=old;old=function(){var code=arguments.length>0?_arguments+"[0]":"";for(var i=1;i<arguments.length;i++){code+=","+_arguments+"["+i+"]";}return eval("oldObject("+code+");");};}var aspect;if(advice.type==_after||advice.type==_afterThrow||advice.type==_afterFinally){aspect=function(){var returnValue,exceptionThrown=null;try{returnValue=old.apply(this,arguments);}catch(e){exceptionThrown=e;}if(advice.type==_after){if(exceptionThrown==null){returnValue=advice.value.apply(this,[returnValue,method]);}else{throw exceptionThrown;}}else{if(advice.type==_afterThrow&&exceptionThrown!=null){returnValue=advice.value.apply(this,[exceptionThrown,method]);}else{if(advice.type==_afterFinally){returnValue=advice.value.apply(this,[returnValue,exceptionThrown,method]);}}}return returnValue;};}else{if(advice.type==_before){aspect=function(){advice.value.apply(this,[arguments,method]);return old.apply(this,arguments);};}else{if(advice.type==_intro){aspect=function(){return advice.value.apply(this,arguments);};}else{if(advice.type==_around){aspect=function(){var invocation={object:this,args:Array.prototype.slice.call(arguments)};return advice.value.apply(invocation.object,[{arguments:invocation.args,method:method,proceed:function(){return old.apply(invocation.object,invocation.args);}}]);};}}}}aspect.unweave=function(){source[method]=old;pointcut=source=aspect=old=null;};source[method]=aspect;return aspect;};var search=function(source,pointcut,advice){var methods=[];for(var method in source){var item=null;try{item=source[method];}catch(e){}if(item!=null&&method.match(pointcut.method)&&isFunc(item)){methods[methods.length]={source:source,method:method,advice:advice};}}return methods;};var weave=function(pointcut,advice){var source=typeof(pointcut.target.prototype)!=_undef?pointcut.target.prototype:pointcut.target;var advices=[];if(advice.type!=_intro&&typeof(source[pointcut.method])==_undef){var methods=search(pointcut.target,pointcut,advice);if(methods.length==0){methods=search(source,pointcut,advice);}for(var i in methods){advices[advices.length]=weaveOne(methods[i].source,methods[i].method,methods[i].advice);}}else{advices[0]=weaveOne(source,pointcut.method,advice);}return _regexEnabled?advices:advices[0];};jQuery.aop={after:function(pointcut,advice){return weave(pointcut,{type:_after,value:advice});},afterThrow:function(pointcut,advice){return weave(pointcut,{type:_afterThrow,value:advice});},afterFinally:function(pointcut,advice){return weave(pointcut,{type:_afterFinally,value:advice});},before:function(pointcut,advice){return weave(pointcut,{type:_before,value:advice});},around:function(pointcut,advice){return weave(pointcut,{type:_around,value:advice});},introduction:function(pointcut,advice){return weave(pointcut,{type:_intro,value:advice});},setup:function(settings){_regexEnabled=settings.regexMatch;}};})();$.extend($,{declare:function(str_className,objArr_superclasses,obj_props){var arr_path=str_className.split(".");var anchor=window;for(var j=0;j<arr_path.length;j++){if(j+1<arr_path.length){if(anchor[arr_path[j]]==null){anchor[arr_path[j]]={};}else{if(typeof anchor[arr_path[j]]=="object"){}else{console.error("invalid namespace",anchor[arr_path[j]],arr_path[j]);throw"invalid namespace";}}anchor=anchor[arr_path[j]];}else{anchor[arr_path[j]]=function(obj_instanceProps){obj_instanceProps=(obj_instanceProps)?obj_instanceProps:{};this.declaredClass=str_className;this._inheritedClasses=objArr_superclasses;this.constructor=function(args){this.inherited(arguments);};this.inherited=function(args){for(x in this){if(this[x]==args.callee){for(var i=0;i<this._inheritedClasses.length;i++){var inheritedClass=this._inheritedClasses[i];if(inheritedClass!=null&&typeof inheritedClass.prototype[x]=="function"){inheritedClass.prototype[x].apply(this,args);}}}}};for(var inheritedSuperclasses in objArr_superclasses){var superClass=new objArr_superclasses[inheritedSuperclasses]();for(var scpk in superClass){if(scpk=="declaredClass"||scpk=="uid"){continue;}this[scpk]=superClass[scpk];}}window._registry=window._registry||{};this.register=function(){this.uid=this.uid||$.genUid();window._registry[this.uid]=this;};this.get=function(key){return this[key];};this.set=function(key,value){this[key]=value;return this[key];};$.extend(this,obj_props,obj_instanceProps);if(obj_props!=null){if(obj_props.constructor){$.proxy(obj_props.constructor,this)(obj_instanceProps);}else{$.proxy(this.constructor(obj_instanceProps),this);}}else{$.proxy(this.constructor(obj_instanceProps),this);}};for(var b in obj_props){anchor[arr_path[j]].prototype[b]=obj_props[b];}}}},getByUid:function(str_uid){return window._registry[str_uid];}});$.declare("ivillage.ui.Entity",[],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.Item",[],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.entity.User",[],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.entity.GigyaUser",[ivillage.ui.entity.User],{constructor:function(args){this.inherited(arguments);},getUserIdentities:function(){return this.get("user").identities;},get:function(str_key){if(str_key=="name"){return this.user.nickname;}else{if(str_key=="loginProvider"){console.log("user",this.user);return this.user.providers[0];}else{if(str_key=="photoURL"){return this.user.photoURL;}}}return this[str_key];}});$.declare("ivillage.ui.social.ShareEntity",[ivillage.ui.Item],{constructor:function(args){this.inherited(arguments);this.domNode=$("<div/>").addClass("shareEntity").append('<input type="checkbox"/>').children().last().parent().append("<div/>").children().last().addClass(this.get("loginProvider")+" icon").parent().append("<span/>").children().last().addClass("name").html(this.get("name")).parent();this.domNodeClones=[];},bindDomNode:function(domNode_dm){$(domNode_dm).bind("change",$.proxy(function(e){this.onChange(e);},this));},onChange:function(e){var value=e.target.checked;this.changeCheckbox(value);},changeCheckbox:function(boolean_checked){for(var i=0,l=this.domNodeClones.length;i<l;i++){var clone=this.domNodeClones[i];$(clone).find("input:checkbox").attr("checked",boolean_checked);}$(this.domNode).find("input:checkbox").attr("checked",boolean_checked);this.set("checked",boolean_checked);},get:function(key){if(key=="domNode"){var clone=$(this.domNode).clone();this.bindDomNode(clone);this.domNodeClones.push(clone);return clone;}else{if(key=="checked"){return $(this.domNode).find("input:checkbox").attr("checked");}}return this[key];}});$.declare("ivillage.ui.Thread",[],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.Comment",[],{constructor:function(args){this.inherited(arguments);this.children=[];this.generateChrome();},generateChrome:function(){this.domNode=$("<div/>").addClass("commentWrap").append("<div/>").children().last().append("<div/>").children().last().addClass("thumbnail").append("<img/>").children().last().addClass("avatar").parent().append("<span/>").children().last().addClass("icon").parent().parent().append("<div/>").children().last().addClass("main").append("<div/>").children().last().addClass("meta").append("<span/>").children().last().addClass("username").parent().append("<span/>").children().last().addClass("datetime").parent().parent().append("<div/>").children().last().addClass("text").append("<div/>").children().last().parent().parent().parent().append("<div/>").children().last().addClass("actions").append("<div/>").children().last().addClass("reply").html("Reply").parent().append("<div/>").children().last().addClass("flag").append("<span/>").children().last().html("Flag as inappropriate").parent().append('<img src="/public/images/icons/flag-inappropriate.png" />').children().last().attr("alt","Flag Inappropriate").parent().parent().parent().parent().append("<div/>").children().last().addClass("authoring").parent().append("<div/>").children().last().addClass("comments children").parent();
},markAsFlaggedError:function(message){this.get("domNode").find(" > div > .actions > .flag ").empty().append("<span>"+message+"</span>");},markAsFlagged:function(){this.get("domNode").find(" > div > .actions > .flag ").empty().append("<span>Flagged</span>");}});$.declare("ivillage.ui.GigyaComment",[ivillage.ui.Comment],{constructor:function(args){this.inherited(arguments);this.register();this.sender=this.sender||{loginProvider:"ivillage",name:"Guest",photoURL:"/public/images/components/comments/default_avatar.gif"};$(this.domNode).find(".username").html(this.get("sender").name||"Guest");$(this.domNode).find(".text").html(this.get("commentText"));var timeSinceReplied=parseInt((new Date()-this.get("timestamp"))/86400000);timeSinceReplied=(timeSinceReplied>=0)?timeSinceReplied:0;var timeUnit="day";if(timeSinceReplied>=1&&timeSinceReplied<30){}else{if(timeSinceReplied>=30&&timeSinceReplied<=360){timeSinceReplied=parseInt(timeSinceReplied/30);timeUnit="month";}else{if(timeSinceReplied>360){timeSinceReplied=parseInt(timeSinceReplied/365);timeUnit="year";}else{if(timeSinceReplied<1){timeSinceReplied=parseInt((new Date()-this.get("timestamp"))/1000);console.log("timeSinceReplied",timeSinceReplied);if(timeSinceReplied<60){timeSinceReplied=timeSinceReplied;timeUnit="second";}else{if(timeSinceReplied<3600){timeSinceReplied=parseInt(timeSinceReplied/60);timeUnit="minute";}else{timeSinceReplied=parseInt(timeSinceReplied/3600);timeUnit="hour";}}}else{timeSinceReplied=timeSinceReplied;timeUnit="day";}}}}if(timeSinceReplied>1){timeUnit=timeUnit+"s";}$(this.domNode).find(".datetime").html(" replied "+timeSinceReplied+" "+timeUnit+" ago");$(this.domNode).find(".avatar").attr("src",this.get("sender").photoURL||"/public/images/components/comments/default_avatar.gif").attr("alt",this.get("sender").name);$(this.domNode).find(".icon").addClass(this.get("sender").loginProvider).attr("alt",this.get("sender").loginProvider);$(this.domNode).find(".icon").append(this.get("sender").loginProvider||"");$(this.domNode).find(".reply").attr("uid",this.get("uid"));$(this.domNode).find(".flag").attr("uid",this.get("uid"));$(this.domNode).find(".flag > *").attr("uid",this.get("uid"));if(this.get("replies")){for(var i=this.get("replies").length-1;i>=0;i--){var childComment=new ivillage.ui.GigyaComment(this.get("replies")[i]);this.addChildComment(childComment);}}},addChildComment:function(GigyaComment_gc){this.get("children").push(GigyaComment_gc);$(this.domNode).find("> .children").prepend(GigyaComment_gc.get("domNode"));},setReply:function(AuthoringWidget_aw){this.get("domNode").find("> .authoring").append(AuthoringWidget_aw.get("domNode"));$.proxy(function(){this.get("domNode").find(".flag").empty().html("Marked as Inappropriate");},this);}});$.declare("ivillage.ui.IvillageComment",[ivillage.ui.Comment],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.store.Item",[ivillage.ui.Item],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.store.AsyncStore",[],{constructor:function(args){},fetch:function(){},_fetch:function($ajax_data){return $.ajax({url:this.url,global:false,type:"GET",data:$ajax_data});}});$.declare("ivillage.ui.store.JsonAsyncStore",[ivillage.ui.store.AsyncStore],{constructor:function(args){this.inherited(arguments);},_fetch:function($ajax_data){return $.ajax({url:this.url,global:false,type:"GET",dataType:"jsonp",data:$ajax_data});}});$.declare("ivillage.ui.store.GigyaAsyncStore",[ivillage.ui.store.JsonAsyncStore],{constructor:function(args){this.inherited(arguments);this.gigya=this.gigya||gigya;}});$.declare("ivillage.ui.store.GigyaCommentsAsyncStore",[ivillage.ui.store.GigyaAsyncStore],{constructor:function(args){this.inherited(arguments);this.url="http://socialize-api.gigya.com/socialize.getComments";this.gigya=this.gigya||window.gigya;this.guestName=this.guestName||"Guest";},fetch:function(){var conf={};var params={categoryID:this.categoryId,streamId:this.streamId,callback:console.log};gigya.services.comments.getComments(conf,params);this.get("gigya").services.comments.getComments(conf,params);var AsyncStoreDeferred_def=this._fetch(params);return AsyncStoreDeferred_def;},getComments:function(args){var conf={};var params={categoryID:this.categoryId,streamID:this.streamId};$.extend(params,args);this.get("gigya").services.comments.getComments(conf,params);},postComment:function(args){var conf={};var params={categoryID:this.categoryId,streamID:this.streamId};$.extend(params,args);if(!params.enabledProviders){params.guestName=this.guestName;}this.get("gigya").services.comments.postComment(conf,params);if(typeof iVillage.loyalty!="undefined"&&typeof iVillage.loyalty.commentPostCredit!="undefined"){iVillage.loyalty.commentPostCredit(params.enabledProviders);}},flagComment:function(args){var conf={};var params={categoryID:this.categoryId,streamID:this.streamId};$.extend(params,args);this.get("gigya").services.comments.flagComment(conf,params);},save:function(GigyaComment){return"unsupported";var conf={};var params={categoryID:this.categoryId,streamID:this.streamId,commentText:"Hello World!"};gigya.services.comments.postComment(conf,params);}});$.declare("ivillage.ui.Dialog",[],{constructor:function(args){this.inherited(arguments);},show:function(){$(this.get("domNode")).show();},hide:function(){$(this.get("domNode")).hide();}});$.declare("ivillage.ui.widget.comments.ShareDialog",[ivillage.ui.Dialog],{constructor:function(args){this.inherited(arguments);this.generateChrome();this.bindDom();},generateChrome:function(){this.domNode=$("<div/>").addClass("comment-modal-dialog").append("<div/>").children().last().addClass("bg").parent().append("<form/>").children().last().addClass("box").append("<div/>").children().last().append("<h3/>").children().last().html("User Comments").parent().parent().append("<div/>").children().last().addClass("main").append("<div/>").children().last().html("You're about to post this comment to iVillage and the following:").parent().append("<div/>").children().last().addClass("shareEntities").parent().append("<div/>").children().last().addClass("actions").append('<input type="button" />').children().last().attr("value","Cancel").addClass("cancel").parent().append('<input type="button" />').children().last().attr("value","Share").addClass("share").parent().parent().parent().append("<div/>").children().last().addClass("footer").append('<input type="checkbox"/>').children().last().addClass("showAgain").parent().append("<span/>").children().last().html("Don&#39;t show this again.").parent().parent().parent();},bindDom:function(){this.domNode.find(".actions input").bind("click",$.proxy(function(e){e.preventDefault();this.onClick(e);},this));this.domNode.find("form").bind("submit",$.proxy(function(e){e.preventDefault();this.onSubmit(e);},this));},getShowAgain:function(){return $(this.domNode.find("input.showAgain")[0]).attr("checked");},onClick:function(e){},onSubmit:function(e){},addShareEntity:function(ShareEntity_se){this.get("domNode").find(".shareEntities").append("<div/>").children().last().append(ShareEntity_se.get("domNode")).children().last().parent().parent();},clearShareEntities:function(){this.get("domNode").find(".shareEntities").empty();}});$.declare("ivillage.ui.widget.UserState",[],{constructor:function(args){this.inherited(arguments);this.generateChrome();this.sso=iV_SSO||{};this.user=new ivillage.ui.entity.User({loginProvider:"ivillage",name:this.get("sso").getUsername()||$("#iv_user_is_signed_in").html()||"Guest",photoURL:"/public/images/components/comments/default_avatar.gif"});this.set("loggedIn",this.get("sso").isLoggedIn());},generateChrome:function(){this.domNode=$("<div/>").addClass("userState").append("<div/>").children().last().addClass("thumbnail").append("<img/>").children().last().addClass("avatar").parent().append("<div/>").children().last().addClass("icon").parent().parent().append("<div/>").children().last().addClass("main").append("<div/>").children().last().addClass("username").parent().append('<a title="Sign Out of iVillage" name="iv:global:wel:logout" href="/user/logout?forward='+window.document.location.href+'" class="iv_home_link_general iv_home_link_emphisized sso-logout">(logout)</a>').children().last().parent().parent();},update:function(){if(this.get("gigyaUser")){this.user=this.get("gigyaUser");}else{}if(this.isLoggedIn()){this.get("domNode").show();}else{this.get("domNode").hide();}this.get("domNode").find(".username").html(this.user.get("name"));this.get("domNode").find(".avatar").attr("src",this.user.get("photoURL"));console.log("loginProvider",this.user.get("loginProvider"));this.get("domNode").find(".icon").addClass(this.user.get("loginProvider"));},isLoggedIn:function(){return this.get("loggedIn");},getUsername:function(){return this.user.name;},setGigyaUser:function(gu){if(gu.get("name")!=""){this.set("gigyaUser",gu);this.set("user",gu);this.set("loggedIn",true);}else{this.user=new ivillage.ui.entity.User({loginProvider:"ivillage",name:this.get("sso").getUsername()||$("#iv_user_is_signed_in").html()||"Guest",photoURL:"/public/images/components/comments/default_avatar.gif"});this.set("loggedIn",this.get("sso").isLoggedIn());if(!this.get("sso").getUsername()){this.set("loggedIn",false);}else{this.set("loggedIn",true);}}this.update();}});$.declare("ivillage.ui.widget.comments.Viewer",[],{constructor:function(args){this.inherited(arguments);this.threadsPerPage=this.threadsPerPage||10;this.generateChrome();this.bindDom();},generateChrome:function(){this.domNode=$("<div/>").addClass("viewer").append("<div/>").children().last().addClass("comments children").parent().append("<div/>").children().last().addClass("pagination").append("<span/>").children().last().addClass("resultText").append("<span/>").children().last().html("Results ").parent().append("<span/>").children().last().addClass("range").html(" - ").parent().append("<span/>").children().last().html(" out of ").parent().append("<span/>").children().last().addClass("threadCount").html("-").parent().parent().append("<span/>").children().last().addClass("next").html("Next").parent().append("<span/>").children().last().addClass("pages").parent().append("<div/>").children().last().addClass("prev").html("Previous").parent().parent();
this.get("domNode").find(".pagination").hide();},bindDom:function(){$(".reply",$(this.domNode)[0]).live("click",$.proxy(function(e){this.onReply(e);},this));$(".flag",$(this.domNode)[0]).live("click",$.proxy(function(e){this.onFlag(e);},this));$(".pagination .pages .page",$(this.domNode)[0]).live("click",$.proxy(function(e){this.goToPage($(e.target).html());},this));$(".pagination .prev",$(this.domNode)[0]).live("click",$.proxy(function(e){var prevPage=parseInt(this.get("currentPage"))-1;if(prevPage>0){this.goToPage(prevPage);}},this));$(".pagination .next",$(this.domNode)[0]).live("click",$.proxy(function(e){var numThreads=this.get("threadCount");var numPages=numThreads/this.get("threadsPerPage");var nextPage=parseInt(this.get("currentPage"))+1;if(nextPage<=numPages+1){this.goToPage(nextPage);}},this));},onClick:function(e){},onReply:function(e){},onFlag:function(e){},setCommentCount:function(int_val){this.set("commentCount",int_val);if(int_val==0){this.get("domNode").find(".pagination").hide();}else{this.get("domNode").find(".pagination").show();}this.get("domNode").find(".commentCount").html(int_val);},setThreadCount:function(int_val){this.set("threadCount",int_val);this.get("domNode").find(".threadCount").html(int_val);this.setPagination();$(".update-chime-count:first").html(int_val+" chime");},setPagination:function(){var numThreads=this.get("threadCount");var numPages=numThreads/this.get("threadsPerPage");this.get("domNode").find(".pagination .pages").empty();for(var i=0;i<numPages;i++){var page=$("<span/>").addClass("page").html(i+1);this.get("domNode").find(".pagination .pages").append(page);}this.goToPage(1);},goToPage:function(int_pageNum){this.domNode.find(".page").removeClass("selected");this.domNode.find(".page:nth-child("+int_pageNum+")").addClass("selected");this.set("currentPage",int_pageNum);var threads=this.get("domNode").find("> .comments .commentWrap");var pageIndexThread=(int_pageNum-1)*this.get("threadsPerPage");var pageIndexThreadEnd=pageIndexThread+this.get("threadsPerPage");if(this.get("threadCount")<this.get("threadsPerPage")+1){var startIndex=(this.get("threadCount")>0)?1:0;this.get("domNode").find(".pagination .range").empty().html(startIndex+" - "+this.get("threadCount"));this.get("domNode").find(".prev").empty();this.get("domNode").find(".next").empty();}else{if(this.get("threadCount")<pageIndexThreadEnd){this.get("domNode").find(".pagination .range").empty().html((pageIndexThread+1)+" - "+this.get("threadCount"));}else{this.get("domNode").find(".pagination .range").empty().html((pageIndexThread+1)+" - "+pageIndexThreadEnd);}}for(var i=0;i<threads.length;i++){if(i>=pageIndexThread&&i<pageIndexThreadEnd){$(threads[i]).show();}else{$(threads[i]).hide();}}},addComment:function(Comment_c){this.get("domNode").find("> .children").prepend(Comment_c.get("domNode"));},set:function(str_key,value){if(str_key=="count"){this.get("domNode").find("count").html(value);}this[str_key]=value;}});$.declare("ivillage.ui.widget.comments.Authoring",[],{charLimit:800,constructor:function(args){this.inherited(arguments);this.generateChrome();this.bindDom();this.set("charCount",this.charLimit);},generateChrome:function(){this.defaultQuestionText=this.get("defaultQuestionText")||"";this.defaultCommentText=this.get("defaultCommentText")||"";this.domNode=$("<div/>").addClass("btm").append("<div/>").children().last().addClass("comment-question-title subject").html(this.defaultQuestionText).parent().append("<form/>").children().last().addClass("comments-form").append("<fieldset/>").children().last().append("<textarea />").children().last().addClass("user-input label-hide clear-default").html(this.defaultCommentText).parent().append('<input type="button" />').children().last().addClass("submit btn-form-custom").parent().append("<div/>").children().last().addClass("chars-rem").append("<span/>").children().last().addClass("charCount").html("-").parent().append("<span/>").children().last().html(" Characters Remaining").parent().append("<div/>").children().last().parent().parent().parent().append("<div/>").children().last().append("<span/>").children().last().html("").parent().append("<span/>").children().last().addClass("shareEntities").append("<div/>").children().last().html(" ").parent().parent().parent().append("<div/>").children().last().parent().parent();},bindDom:function(){this.get("textarea").bind("click",$.proxy(function(e){this.onTextareaClick(e);},this)).bind("keyup",$.proxy(function(e){this.onKeyup(e);},this)).bind("focus",$.proxy(function(e){this.onFocus(e);},this)).bind("blur",$.proxy(function(e){this.onBlur(e);},this));this.get("form").bind("submit",$.proxy(function(e){e.preventDefault();this.onSubmit(e);},this));this.get("domNode").find("fieldset .submit").bind("click",$.proxy(function(e){e.preventDefault();this.onSubmit(e);},this));this.get("domNode").bind("click",$.proxy(function(e){this.onClick(e);},this));},onClick:function(e){},onTextareaClick:function(e){},onSubmit:function(e){e.preventDefault();},onKeyup:function(e){this.removeExtraChars();this.setCharCount();},removeExtraChars:function(){var textarea=this.get("textarea");if(textarea.val().length>this.charLimit){textarea.val(textarea.val().substr(0,this.charLimit));}},setCharCount:function(){var textarea=this.get("textarea");this.set("charCount",this.charLimit-textarea.val().length);},onFocus:function(e){var textarea=this.get("textarea")[0];if($(textarea).val()==this.defaultCommentText){$(textarea).val("");}else{$(textarea).select();}},onBlur:function(e){var textarea=this.get("textarea");if($(textarea).val()==""){$(textarea).val(this.defaultCommentText);this.set("charCount",this.charLimit);}},getCommentText:function(){return this.domNode.find("textarea").val();},setCommentText:function(str_text){return this.domNode.find("textarea").val(str_text);this.onBlur();},reset:function(){this.setCommentText("");this.setCharCount();},isCommentValid:function(){var commentText=this.getCommentText();if($.trim(commentText).length==0){return false;}if($.trim(commentText)==$.trim(this.get("defaultCommentText"))){return false;}return true;},get:function(key){if(key=="textarea"){return this.domNode.find("textarea");}else{if(key=="submitBtn"){return this.domNode.find("input");}else{if(key=="form"){return this.domNode;}else{if(key=="charCount"){return this.domNode.find(".charCount");}}}}return this[key];},set:function(key,value){if(key=="defaultCommentText"){this.get("textarea").html(value);}else{if(key=="charCount"){this.get("charCount").html(value);}}this[key]=value;},addShareEntity:function(ShareEntity_se){this.get("domNode").find(".shareEntities").append(ShareEntity_se.get("domNode")).children().last().parent();}});$.declare("ivillage.ui.CommentAnalytics",[],{constructor:function(args){this.inherited(arguments);},trackShowGigyaCommentDialog:function(social){this.trackEvent(social+"dialogShowGigyaComment");},trackCancelGigyaCommentShareDialog:function(social){this.trackEvent(social+"cancelShareDialogGigyaComment");},trackGigyaCommentShareAttempted:function(social){this.trackEvent(social+"shareAttemptedGigyaComment");},trackGigyaCommentShareComment:function(social){this.trackEvent(social+"shareComment0GigyaComment");},trackGigyaCommentShareReply1:function(social){this.trackEvent(social+"shareReply1GigyaComment");},trackGigyaCommentShareReply2:function(social){this.trackEvent(social+"shareReply2GigyaComment");},trackEvent:function(title){var trackStr=title;this._trackEvent(trackStr);},_trackEvent:function(nonPrefixed){var trackStr=$.trim(iVillage.ev13_prefix+":"+nonPrefixed);var trackSuccess=iv_doTracking(trackStr,"","s_iv.eVar13");}});$.declare("ivillage.ui._App",[],{constructor:function(args){this.inherited(arguments);}});$.declare("ivillage.ui.app.Comments",[ivillage.ui._App],{constructor:function(args){this.inherited(arguments);this.userStateWidget=this.userStateWidget||new ivillage.ui.widget.UserState();this.analyticsWidget=this.analyticsWidget||new ivillage.ui.CommentAnalytics();var defaultUsername="Anonymous";if(this.userStateWidget.isLoggedIn()){defaultUsername=this.userStateWidget.getUsername()||"Anonymous";}this.gigyaCommentsAS=this.gigyaCommentsAS||new ivillage.ui.store.GigyaCommentsAsyncStore({categoryId:"URI",streamId:document.location.href}),this.gigyaCommentsAS.set("guestName",defaultUsername);this.viewingWidget=this.viewingWidget||new ivillage.ui.widget.comments.Viewer();this.defaultQuestionText=this.defaultQuestionText||"Share your thoughts!";this.defaultCommentText=this.defaultCommentText||"What do you think?";this.authoringWidget=this.authoringWidget||new ivillage.ui.widget.comments.Authoring({defaultQuestionText:this.defaultQuestionText,defaultCommentText:this.defaultCommentText});this.replyWidget=this.replyWidget||new ivillage.ui.widget.comments.Authoring({defaultQuestionText:this.defaultQuestionText,defaultCommentText:this.defaultCommentText});this.get("replyWidget").get("domNode").addClass("authoring");this.lastTouch=this.authoringWidget;this.generateChrome();this.shareDialog=new ivillage.ui.widget.comments.ShareDialog();$("body").append(this.get("shareDialog").get("domNode"));this.get("shareDialog").hide();this.shareEntities=[];this.bindDom();this.bindEvents();this.bindAnalytics();},init:function(){this.get("gigyaCommentsAS").getComments({callback:$.proxy(function(response){this.onCommentsLoaded(response);},this)});this.loadSavedComment();this.initGigyaUserInfo();},onCommentsLoaded:function(response){var commentCount=response.commentCount;var threadCount=response.threadCount;var comments=response.comments;threadCount=0;for(var i=comments.length-1;i>=0;i--){var flagCount=comments[i].flagCount;if(flagCount>=2){continue;}threadCount++;var comment=comments[i];this.addCommentRoot(comment);}this.get("viewingWidget").setCommentCount(commentCount);this.get("viewingWidget").setThreadCount(threadCount);},setViewerPagination:function(){this.get("viewingWidget").setPagination();},bindAnalytics:function(){$.aop.before({target:this,method:"showShareDialog"},$.proxy(function(args){this.get("analyticsWidget").trackShowGigyaCommentDialog(this.getShareTargetsNames());
},this));$.aop.before({target:this,method:"cancelShareDialog"},$.proxy(function(args){this.get("analyticsWidget").trackCancelGigyaCommentShareDialog(this.getShareTargetsNames());},this));$.aop.before({target:this.get("authoringWidget"),method:"onSubmit"},$.proxy(function(args){this.get("analyticsWidget").trackGigyaCommentShareAttempted(this.getShareTargetsNames());},this));$.aop.before({target:this.get("replyWidget"),method:"onSubmit"},$.proxy(function(args){this.get("analyticsWidget").trackGigyaCommentShareAttempted(this.getShareTargetsNames());},this));$.aop.before({target:this,method:"shareComment"},$.proxy(function(args){var twoDepthAuthoring=$(".mod-comments .viewer > .comments > .commentWrap > .comments > .commentWrap .btm.authoring");var oneDepthAuthoring=$(".mod-comments .viewer > .comments > .commentWrap .btm.authoring");if(twoDepthAuthoring.length>0){this.get("analyticsWidget").trackGigyaCommentShareReply2(this.getShareTargetsNames());}else{if(twoDepthAuthoring.length>0){this.get("analyticsWidget").trackGigyaCommentShareReply1(this.getShareTargetsNames());}else{this.get("analyticsWidget").trackGigyaCommentShareComment(this.getShareTargetsNames());}}},this));},initGigyaUserInfo:function(){var shareEntities=[];gigya.services.socialize.getUserInfo({},{callback:$.proxy(function(GigyaUser_gu){console.log("init gigya user info returned!");var gu=new ivillage.ui.entity.GigyaUser(GigyaUser_gu);this.get("userStateWidget").setGigyaUser(gu);var obj_userIdentities=gu.getUserIdentities();for(var identity in obj_userIdentities){var shareEntity=new ivillage.ui.social.ShareEntity({name:identity.charAt(0).toUpperCase()+identity.slice(1),loginProvider:identity});shareEntities.push(shareEntity);}this.setShareEntities(shareEntities);},this)});},generateChrome:function(){var commentAuthoring=this.authoringWidget.get("domNode");var commentViewer=this.viewingWidget.get("domNode");var userState=this.userStateWidget.get("domNode");this.domNode=$("<div/>").addClass("comments").append("<div/>").children().last().addClass("pngfix sec-title").parent().append(userState).children().last().addClass("user-state").parent().append("<div/>").children().last().addClass("user-comment").append(commentAuthoring).children().last().addClass("authoring").parent().parent().append(commentViewer).children().last().parent().append("<div/>").children().last().parent();},bindDom:function(){},_bindAuthoringWidget:function(AuthoringWidget_aw){$.aop.before({target:AuthoringWidget_aw,method:"onSubmit"},$.proxy(function(result){this.saveComment();var aw=this.get("lastTouch");var commentValid=aw.isCommentValid();if(!commentValid){alert($.trim("Please enter a comment!"));return;}$(".sso-sign-in").trigger("click");if($(".sso-sign-in").length==0){if($.cookie("showDialogAgain")=="false"||this.shareEntities.length==0){this.shareComment();}else{this.showShareDialog();}}return result;},this));$.aop.before({target:AuthoringWidget_aw,method:"onClick"},$.proxy(function(result){var e=result[0];var aw=$(e.target).parents(".authoring")[0];if(aw==this.get("authoringWidget").get("domNode")[0]){this.set("replyTarget",null);this.set("lastTouch",this.get("authoringWidget"));}else{if(aw==this.get("replyWidget").get("domNode")[0]){this.set("lastTouch",this.get("replyWidget"));}}return result;},this));},bindEvents:function(){this._bindAuthoringWidget(this.authoringWidget);this._bindAuthoringWidget(this.replyWidget);$.aop.before({target:this.viewingWidget,method:"onReply"},$.proxy(function(args){var e=args[0];var uid=$(e.target).attr("uid");var commentWidget=$.getByUid(uid);this.set("replyTarget",commentWidget);commentWidget.setReply(this.replyWidget);return args;},this));$.aop.before({target:this.viewingWidget,method:"onFlag"},$.proxy(function(args){var e=args[0];var uid=$(e.target).attr("uid");var commentWidget=$.getByUid(uid);this.flagComment(commentWidget);return args;},this));$.aop.before({target:this.shareDialog,method:"onClick"},$.proxy(function(args){var e=args[0];if($(e.target).hasClass("share")){this.shareComment();}else{this.cancelShareDialog();}this.hideShareDialog();return args;},this));},cancelShareDialog:function(){},shareComment:function(){var showAgain=this.get("shareDialog").getShowAgain();$.cookie("showDialogAgain",!showAgain);var aw=this.get("lastTouch");var commentText=aw.getCommentText();var commentValid=aw.isCommentValid();if(!commentValid){return;}if(this.get("replyWidget")==aw){aw.get("domNode").detach();}var arr_shareTargets=this.getShareTargets();var str_shareTargets="";for(var i=0;i<arr_shareTargets.length;i++){var target=arr_shareTargets[i];if(i!=0){str_shareTargets=str_shareTargets+",";}str_shareTargets=str_shareTargets+target.get("loginProvider");}var act=new gigya.services.socialize.UserAction();act.setTitle($("title").html());act.setUserMessage(commentText);act.setDescription($("meta[name=description]").attr("content"));act.setLinkBack(document.location.href);var image_src=$("link[rel=image_src]").attr("href");var image={type:"image",src:image_src||"http://www.ivillage.com/public/images/logos/logo-ivillage-50x50.png",href:"http://www.ivillage.com/"};act.addMediaItem(image);if(this.get("replyTarget")){var callback=$.proxy(function(resp){var newGigyaComment=new ivillage.ui.GigyaComment(resp.comment);this.get("replyTarget").addChildComment(newGigyaComment);$.cookie("savedComment",null);},this);var parentId=this.get("replyTarget").get("ID");this.get("gigyaCommentsAS").postComment({commentText:commentText,enabledProviders:str_shareTargets,callback:callback,userAction:act,parentID:parentId});}else{var callback=$.proxy(function(resp){this.addCommentRoot(resp.comment);$.cookie("savedComment",null);},this);this.get("gigyaCommentsAS").postComment({commentText:commentText,enabledProviders:str_shareTargets,userAction:act,callback:callback});}this.get("lastTouch").reset();this.clearSavedComment();},flagComment:function(Comment_c){this.get("gigyaCommentsAS").flagComment({commentID:Comment_c.get("ID"),callback:function(response){console.log("flag",response);if(response.errorMessage=="Permission denied"){Comment_c.markAsFlaggedError("Error flagging");}else{Comment_c.markAsFlagged();}}});},showShareDialog:function(){this.get("shareDialog").show();},hideShareDialog:function(){this.get("shareDialog").hide();},clearSavedComment:function(){$.cookie("savedComment-text",null,{expires:-1});$.cookie("savedComment-location",null,{expires:-1});},saveComment:function(){$.cookie("savedComment-text",this.get("lastTouch").getCommentText());$.cookie("savedComment-location",document.location.pathname);},loadSavedComment:function(){var savedCommentText=$.cookie("savedComment-text");var savedCommentLocation=$.cookie("savedComment-location");if(savedCommentText&&(savedCommentLocation==document.location.pathname)){this.get("authoringWidget").setCommentText(savedCommentText);}},addShareEntity:function(ShareEntity_se){this.get("shareEntities").push(ShareEntity_se);this.get("shareDialog").addShareEntity(ShareEntity_se);this.get("authoringWidget").addShareEntity(ShareEntity_se);this.get("replyWidget").addShareEntity(ShareEntity_se);},setShareEntities:function(ShareEntity_Array_shareEntities){this.get("domNode").find("shareEntities").empty().html("Share to:");for(var i=0,l=ShareEntity_Array_shareEntities.length;i<l;i++){this.addShareEntity(ShareEntity_Array_shareEntities[i]);}},addCommentRoot:function(jsonComment_c){var c=new ivillage.ui.GigyaComment(jsonComment_c);this.get("viewingWidget").addComment(c);},getShareTargets:function(){var shareEntities=this.get("shareEntities");var ShareEntity_arr_targets=[];for(var i=0,l=this.shareEntities.length;i<l;i++){var se=this.shareEntities[i];if(typeof se.get("checked")=="undefined"||se.get("checked")==false){}else{ShareEntity_arr_targets.push(se);}}return ShareEntity_arr_targets;},getShareTargetsNames:function(){var shareEntities=this.get("shareEntities");var str_arr_names=[];for(var i=0,l=this.shareEntities.length;i<l;i++){var se=this.shareEntities[i];str_arr_names.push(se.get("name"));}return str_arr_names;}});$.declare("ivillage.ui.service.external.echo.EchoService",[ivillage.ui.store.JsonAsyncStore],{constructor:function(args){this.set("apiLoaded",new $.Deferred());if(typeof window.Echo==="undefined"){console.log("loading echo api");this.loadApi();}else{this.set("Echo",window.Echo);this.get("apiLoaded").resolve();}},loadApi:function(){var jqueryPackDef=new $.Deferred();$.getScript("http://cdn.echoenabled.com/clientapps/v2/jquery-pack.js",$.proxy(function(){jqueryPackDef.resolve();this.attemptApiLoadedResolve();},this));this.set("jqueryPackLoadDef",jqueryPackDef);var streamDef=new $.Deferred();$.getScript("http://cdn.echoenabled.com/clientapps/v2/stream.js",$.proxy(function(){streamDef.resolve();this.attemptApiLoadedResolve();},this));this.set("streamLoadDef",streamDef);},attemptApiLoadedResolve:function(){var streamLoadDef=this.get("streamLoadDef");var jqueryPackDef=this.get("jqueryPackLoadDef");jqueryPackDef.then($.proxy(function(){streamLoadDef.then($.proxy(function(){this.set("Echo",window.Echo);this.get("apiLoaded").resolve();},this));},this));},fetch:function(params){return this._fetch(params);},fetchItems:function(params){var itemsDef=new $.Deferred();this.get("apiLoaded").then($.proxy(function(){var query=params.query;this.fetch(params);itemsDef.resolve();},this));return itemsDef;}});$.declare("ivillage.ui.widget.comments.plugin.Echo",[ivillage.ui._App],{constructor:function(args){this.bindToCommentsWidget();this.set("echoService",new ivillage.ui.service.external.echo.EchoService());},bindToCommentsWidget:function(){var commentsWidget=this.get("commentsWidget");$.aop.after({target:commentsWidget,method:"onCommentsLoaded"},$.proxy(function(result){console.log("RESULT OF ON COMMENTS LOADED",result);this.attachEchoComments();return result;},this));},attachEchoComments:function(){console.log("attaching comments",this);this.loadEchoComments.then($.proxy(function(response){var items=response.items;for(var i=0;i<items.length;i++){var item=items[0];
this.attachComment(item);}},this));this.sortComments();this.setPagination();},attachComment:function(){this.get("commentsWidget").addCommentRoot();},sortComments:function(){},setPagination:function(){this.get("commentsWidget").setViewerPagination();},loadEchoComments:function(){var echoItemsDef=this.get("echoService").fetchItems();return echoItemsDef;}});$.fn.gigyaChat=function(gigya,iVillage,id){var params={categoryID:42187363,width:600,height:670,containerID:id,cid:""};gigya.socialize.showChatUI(params);};$.fn.externalComments=function(gigya,iVillage){if($("#comments").length==0){return;}var defaultQuestionText=$("#comments .comment-question-title").html()||"";var defaultCommentText=$("#comments textarea.user-input").html()||"";if($("#comments").width()<500){$("#comments").addClass("mini");}$(".update-chime-count:first").empty();$("#comments").empty();var categoryID="TestNodeID";var streamID="testStreamFoo";if(document.location.host=="www.ivillage.com"){categoryID="NodeID";}var urlNodeInfo=document.location.pathname.split("/")[2];var urlNodeId;if(!urlNodeInfo){urlNodeId=null;}else{urlNodeId=urlNodeInfo.split("-")[2];urlNodeId=parseInt(urlNodeId);}var nodeId;if(typeof urlNodeId==="number"&&urlNodeId%1==0){nodeId=urlNodeId;}else{nodeId=$(".canvas").attr("data-nid");}console.log("!!! comments stream nodeId",nodeId);streamID=nodeId;app=new ivillage.ui.app.Comments({store:{gigya:{}},categoryId:"URI",streamId:document.location.href,gigya:gigya,ivDefaults:iVillage.defaults,defaultQuestionText:defaultQuestionText,defaultCommentText:defaultCommentText,gigyaCommentsAS:new ivillage.ui.store.GigyaCommentsAsyncStore({categoryId:categoryID,streamId:streamID})});var echoEnabled=false;if(echoEnabled){console.log("ECHO ENABLED");new ivillage.ui.widget.comments.plugin.Echo({commentsWidget:app});}app.init();$(app.get("domNode")).appendTo(this);};(function(){iVillage.defaults={comments:{display_comments:3,see_all_link:true,valid_listener:"CC_STATUS"},charcounter:{char_limit:800},shoppingList:function(){if($.isFunction($.shoppingList)){window.shopping_list=$(".mod-shopping-list").shoppingList();}},panelTabs:function(){var options={event:"mouseover",fx:[null,{opacity:"show"}],cookie:{name:"iv-tabbed-side",expires:30},rotate:2000};$(".pane-carousel-tabbed .content .container").tabs(options);$("#TabsCarousel").tabs({event:"click",fx:[null,{opacity:"show"}],cookie:{name:"iv-tabbed-side",expires:30},rotate:2000});$(".pane-carousel-tabbed .content .container ul li a").click(function(){var url=$(this).attr("data-href");window.location.href=url;});},panels:function(){$("img").error(function(){$(this).attr("src","/public/images/pixel.gif");});}};})();(function(){iVillage.templates={Global:{blocks:["nav","newsletter_signup","share_tools",["care_circle_globals","health"],["care_circle_overlay","health"],["care_circle_small","health"],"follow_save_share_print","third_party","lazyloadad"]},Chooser_Controller:{index:{blocks:["chooser_tool"]}},Static_Page_Controller:{show:{blocks:["dream_kitchen_tool"]}},Content_Controller:{show:{blocks:[]}},Look_It_Up_Controller:{index:{blocks:["follow_ivillage"]},landing:{blocks:["follow_ivillage"]}},Advice_Controller:{index:{blocks:["carousel_horizontal","snack_swapper"]}},Food_For_Kids_Controller:{index:{blocks:["carousel_horizontal","snack_swapper","polls_standard"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Games_Controller:{index:{blocks:["carousel_horizontal","games"]},show:{blocks:["games"]},brain:{blocks:["carousel_horizontal","games"]}},pages_Controller:{funnel_two:{blocks:["funnel_two","faccordion"]},funnel_five:{blocks:["funnel_five","faccordion"]},funnel_two:{blocks:["funnel_nine","faccordion"]}},Entertainment_Controller:{index:{blocks:["carousel_big","nbc_player_4_0_large"],plugins:[["#comments","charcounter"]]}},Beauty_Controller:{index:{blocks:["hero_three_element_carousel","polls_beauty"]}},Deals_Controller:{index:{blocks:["polls_beauty"]}},Makeover_Controller:{index:{plugins:[[".top-items ul li","tryItOnOverlay"],[".top-items ul li","addHover"]]},member:{plugins:[[".top-items ul li","tryItOnOverlay"],[".top-items ul li","addHover"]]},makeover_tool:{blocks:["makeovermatic"],plugins:[[".top-items ul li","tryItOnOverlay"],[".top-items ul li","addHover"]]}},Skinsolver_Controller:{results:{blocks:["skinsolverAds"]}},Product_Lists_Controller:{show:{blocks:["article","follow_ivillage","characterCount"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Stuff_We_Love_Controller:{product_search:{blocks:["stuff_we_love"]}},Health_Controller:{index:{blocks:["follow_ivillage","tabbed_side","care_circle_home"]}},Health_Conditions_Controller:{index:{blocks:["follow_ivillage"]},show:{blocks:["healthwise","sponsored"]},show_sub:{blocks:["healthwise","follow_ivillage"]}},Healthwise_Controller:{show:{blocks:["follow_ivillage","healthwise"]},show_sub:{blocks:["healthwise"]},tier_c_condition_report:{blocks:["follow_ivillage","healthwise"]},drug_result:{blocks:["follow_ivillage","healthwise"]},test_proc_result:{blocks:["follow_ivillage","healthwise"]}},Articles_Controller:{show:{blocks:["article","follow_ivillage","polls_standard","sponsored",["rating","health"]],plugins:[["#comments","comments",{display_comments:3,see_all_link:true,valid_listener:"CC_STATUS",comments_ul:".comments"}],["#comments","charcounter",iVillage.defaults.charcounter]]},index:{blocks:["follow_ivillage","polls_multiple_choice","centered_title","carousel_horizontal","nbc_player_4_0_large"]}},Experts_Controller:{show:{blocks:["follow_ivillage","qa","qa_submit","centered_title","sponsored"],plugins:[[".expandable .trigger","qa"]]}},Diet_Fitness_Controller:{index:{blocks:["follow_ivillage","tabbed_side","toolkit","share_your_story"]}},Videos_Controller:{index:{blocks:["follow_ivillage","nbc_player_4_0_large","videos","new_this_week_carousel"]},show:{blocks:["follow_ivillage","nbc_player_4_0_large","videos","new_this_week_carousel"]}},Packages_Controller:{show:{blocks:["tabbed_side","follow_ivillage","nbc_player_4_0_large","polls_multiple_choice","new_this_week_carousel","carousel_horizontal"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Profile_Controller:{private_profile:{blocks:["private_profile"]},public_profile:{blocks:["public_profile"]},public_user_profile:{blocks:["public_profile"]},photos:{blocks:["private_photos"]},photo_public_view:{blocks:["public_photos"]},account_info:{blocks:["account_info"]},newsletters:{blocks:["account_newsletters"]},signatures:{blocks:["account_signatures"]},add_signatures:{blocks:["account_add_signatures"]},loyalty_rewards:{blocks:["user_rewards"]},public_user_rewards:{blocks:["user_rewards"]},public_rewards:{blocks:["user_rewards"]}},Healthy_Living_Controller:{index:{blocks:["centered_title","coupons","follow_ivillage","tabbed_side"]}},Health_Love_Sex_Controller:{index:{blocks:["centered_title","coupons","follow_ivillage","tabbed_side"]}},Kids_Health_Controller:{index:{blocks:["coupons","follow_ivillage","tabbed_side","newsletter_expecting","ask_your_question","health_by_age"]}},Panel_Pages_Controller:{routed:{blocks:["nbc_player_4_0_large","videos","stripCarousel","panel_tabbed_pane","tabbed_home_hero","challenge_signup_form","challenge_assignment_slider","holidaily_bg_image_flip","ivote_bg_image","join_challenge_signup_form","google_conversion"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Parenting_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Health_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Entertainment_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Beauty_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Food_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Homeandgarden_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Love_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Photo_Hub_Panel_Controller:{routed:{blocks:["stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Video_Hub_Panel_Controller:{routed:{blocks:["nbc_player_4_0_large","videos","stripCarousel","panel_tabbed_pane","tabbed_home_hero"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();$(".pane-ad").each(function(){var elem=$(this).find("object, embed");if(elem.length>0){var objectWidth=elem.width();$(this).find("div").width(objectWidth);$(this).width(objectWidth).css("margin","0 auto");}});if($("title").text().indexOf("My Best Idea")!=-1){$("body").addClass("layout-flexible-best-idea").removeClass("layout-flexible-challenges");}}}},Challenges_Panel_Controller:{routed:{blocks:["challenge_signup_form","challenge_assignment_slider","join_challenge_signup_form","google_conversion"],fire:function(){iVillage.defaults.panelTabs();iVillage.defaults.panels();}}},Sweepstakes_Controller:{show:{blocks:["sweepstakes_runner"]}},Content_Rating_Page_Controller:{show:{blocks:["content_rating_page"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Quizzes_Controller:{show:{blocks:["follow_ivillage","quizzes","sponsored"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Slideshows_Controller:{show:{blocks:["slideshow","follow_ivillage","sponsored","polls_standard"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]},index:{blocks:["carousel_horizontal"]}},Health_Topics_Controller:{show:{blocks:["follow_ivillage","tabbed_side","healthwise","sponsored"]}},Share_Your_Story_Controller:{index:{blocks:["follow_ivillage","share_your_story"],plugins:[["#comments","charcounter",iVillage.defaults.charcounter]]}},Calories_Burned_Calculator_Controller:{index:{blocks:["calories_burned_calculator"]}},Symptom_Checker_Controller:{index:{blocks:["follow_ivillage","symptom_checker_globals","symptom_checker_locals"]}},Beyond_Bmi_Controller:{index:{blocks:["follow_ivillage","beyond_bmi","jquery_validate_min"]},result:{blocks:["follow_ivillage","beyond_bmi"]}},Browse_Controller:{index:{blocks:["coupons","follow_ivillage","browse_shortcuts"]}},Tools_Controller:{index:{blocks:[]}},Health_Decision_Points_Controller:{show:{blocks:["healthwise","decision_point"]}},QA_Controller:{index:{blocks:["ask_your_question"]}},QA_Articles_Controller:{index:{plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]},show:{blocks:[["ask_your_question","parenting"]],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Parenting_Controller:{index:{blocks:["centered_title","tabbed_side","polls_parenting","chatter","ask_your_question"]},wrapper:{blocks:["centered_title","tabbed_side","polls_parenting","chatter","ask_your_question"]}},Products_Controller:{show:{blocks:["rating"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Parenting_Weeks_Controller:{show:{blocks:["tabbed_side","weeks_tabbed","centered_title","ask_your_question"],plugins:[[".my-week-by-week","parenting_calendar"]]}},Sub_Channel_Controller:{show:{blocks:["centered_title"]}},Pregnancy_Controller:{index:{blocks:["centered_title","ask_your_question"]}},Baby_Controller:{index:{blocks:["centered_title","ask_your_question"],plugins:[[".my-week-by-week","parenting_calendar"]]}},Toddler_Preschool_Controller:{index:{blocks:["centered_title","ask_your_question"]}},Due_Date_Predictor_Controller:{index:{blocks:["due_date"]}},Ovulation_Predictor_Controller:{index:{blocks:["ovulation_predictor"]}},Chinese_Gender_Chart_Controller:{index:{blocks:["chinese_gender_chart"]}},Pregnancy_Calendar_Controller:{index:{plugins:[[".my-week-by-week","parenting_calendar"]]}},Baby_Calendar_Controller:{index:{plugins:[[".my-week-by-week","parenting_calendar"]]}},Ivillage_Controller:{index:{blocks:["tabbed_home_hero","polls_standard","hp_photos_tabbed_side","vertical_ticker","new_window_opener","media_tabs"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]],fire:function(){}}},Food_Controller:{index:{blocks:["tabbed_food_hero","polls_standard"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]],fire:function(){iVillage.defaults.shoppingList();
}}},Love_Sex_Controller:{index:{blocks:["ask_your_question"]}},Big_Kids_Controller:{index:{blocks:["ask_your_question"]}},Parenting_Topics_Controller:{show:{blocks:["ask_your_question"]}},Homeandgarden_Controller:{index:{blocks:["tabbed_side","ask_your_question"]}},Family_Finance_Controller:{index:{blocks:["ask_your_question"]}},Homemaking_Controller:{index:{blocks:["ask_your_question"]}},Gardening_Controller:{index:{blocks:["ask_your_question"]}},Calendar_Controller:{index:{blocks:["activity_browser"]}},Calendar_Controller:{index:{blocks:["activity_browser"]}},Table_Talk_Controller:{index:{plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Baby_Calendar_Controller:{index:{plugins:[[".my-week-by-week","parenting_calendar"]]}},Food_Controller:{index:{blocks:["tabbed_food_hero","polls_standard"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]],fire:function(){iVillage.defaults.shoppingList();}}},Love_Sex_Controller:{index:{blocks:["ask_your_question"]}},Big_Kids_Controller:{index:{blocks:["ask_your_question"]}},Parenting_Topics_Controller:{show:{blocks:["ask_your_question"]}},Calendar_Controller:{index:{blocks:["activity_browser"]}},Table_Talk_Controller:{index:{plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Baby_Calendar_Controller:{index:{plugins:[[".my-week-by-week","parenting_calendar"]]}},Recipes_Controller:{show:{blocks:["rating","recipes","coupons"],plugins:[["#twists","twists"],["#comments","comments",{display_comments:3,see_all_link:true,valid_listener:"CC_STATUS",comments_container:"ul.pnl-twists",comments_ul:"ul.pnl-twists",content_type:"twists",submit_btn:".twists-submit",rating:true,render_external:function(data,source_data){return $.fn.twists.renderComment(data,source_data);}}],["#comments","charcounter",{char_limit:400}]],fire:function(){iVillage.defaults.shoppingList();}},index:{blocks:["recipe_tabs_hookup"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},UGC_Recipes_Controller:{congrats:{plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]}},Home_Inspiration_Controller:{slideshow:{blocks:["slideshow","follow_ivillage","sponsored","polls_standard","hig_slide_poster"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]},user_board_single_view:{blocks:["slideshow","follow_ivillage","sponsored","polls_standard","hig_slide_poster"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]},user_board_view_all:{blocks:["follow_ivillage","sponsored","polls_standard"],plugins:[["#comments","comments",iVillage.defaults.comments],["#comments","charcounter",iVillage.defaults.charcounter]]},create_board:{blocks:["hig_create_board"]},user_profile:{blocks:["hig_slide_manager"]}},Search_Controller:{go:{blocks:["recipe_search"]}},Love_Controller:{index:{blocks:["tabbed_side","video_carousel_small"]}},Shopping_List_Controller:{index:{fire:function(){iVillage.defaults.shoppingList();}},print_list:{fire:function(){iVillage.defaults.shoppingList();}}},Iframed_Components_Controller:{beautykit:{blocks:["beauty_kit"]}}};})();(function($){if($.cookie("debugger")==true||$.getUrlVar("debugger")=="true"){var growl,path="/public/javascripts/libs/jsGrowl/";$("document").ready(function(){$.cookie("debugger",true);$("body").append('<div id="jsGrowl">HELLO WORLD</div>');$.getScript(path+"jsGrowl.js",function(){$.getScript(path+"jsGrowl_jquery.js",function(){growl=new jsGrowl("js_growl");var nid=$(".canvas").data("nid");if(nid!=null){growl.addMessage({msg:"Page NID : "+nid,sticky:true});}$("#Debugger").children("input").each(function(){growl.addMessage({msg:$(this).attr("name")+" : "+$(this).attr("value"),sticky:true});});});});});}})(jQuery);(function($){iVillage.activate_runners=function(){var i,max,template,blocks,block;var siteName=iVillage.siteName.toLowerCase();var templates=iVillage.templates;var runners=iVillage.runners;var controller=iVillage.controller;var action=iVillage.action;runners.global();if(runners.application!=undefined){runners.application();}if(templates.Global){blocks=templates.Global.blocks;for(i=0,max=blocks.length;i<max;i++){block=blocks[i];if(typeof block==="string"){if(typeof runners.blocks[block]==="function"){runners.blocks[block]();}}else{if(block[1]===siteName){if(typeof runners.blocks[block[0]]==="function"){runners.blocks[block[0]]();}}}}}if(templates[controller]){if(templates[controller][action]){template=templates[controller][action];blocks=template.blocks;plugins=template.plugins;functs=template.functs;if(blocks){for(i=0,max=blocks.length;i<max;i++){block=blocks[i];if(typeof block==="string"){if(typeof runners.blocks[block]==="function"){runners.blocks[block]();}}else{if(block[1]===siteName){if(typeof runners.blocks[block[0]]==="function"){runners.blocks[block[0]]();}}}}}if(template.fire){template.fire();}if(functs){for(i=0;i<functs.length;i++){var funct=functs[i][0],params=(typeof(functs[i][1])!="Array")?[functs[i][1]]:functs[i][1],plugin=functs[i][2],selector=functs[i][3];if(funct=="$.fn"){$.fn[plugin].apply($(selector),params);}else{window[funct].apply(null,params);}}}if(plugins){for(i=0;i<plugins.length;i++){var selector=$(plugins[i][0]),plugin=plugins[i][1],opts=(typeof(plugins[i][2])!="Array")?[plugins[i][2]]:plugins[i][2];if($.fn[plugin]){$.fn[plugin].apply($(selector),opts);}else{console.warn("Missing Plugin: "+plugin);}}}}}};iVillage.activate_click=function(){if($("body").hasClass("iframed")){return true;}if(($.cookie("iVillagePrompt")!=1)&&(window.location.href.indexOf("nlcid=")==-1)&&!$("body").hasClass("no-intercept")){var nClick=parseInt($.cookie("iVillageClick"));if(isNaN(nClick)){nClick=0;}nClick++;if(nClick>=4){if(typeof iV_SSO!="undefined"){iV_SSO.newsletters_nudge();$.cookie("iVillagePrompt",1,{path:"/",expires:(iV_SSO.isLoggedIn()?182:91)});i;}}$.cookie("iVillageClick",nClick,{path:"/"});}};})(jQuery);var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac};}(),k=function(){if(!M.w3){return;}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f();}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false);}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f();}});if(O==top){(function(){if(J){return;}try{j.documentElement.doScroll("left");}catch(X){setTimeout(arguments.callee,0);return;}f();})();}}if(M.wk){(function(){if(J){return;}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return;}f();})();}s(f);}}();function f(){if(J){return;}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z);}catch(aa){return;}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]();}}function K(X){if(J){X();}else{U[U.length]=X;}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false);}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false);}else{if(typeof O.attachEvent!=D){i(O,"onload",Y);}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y();};}else{O.onload=Y;}}}}}function h(){if(T){V();}else{H();}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return;}}X.removeChild(aa);Z=null;H();})();}else{H();}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa);}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class");}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align");}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value");}}P(ai,ah,Y,ab);}else{p(ae);if(ab){ab(aa);}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z;}ab(aa);}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y;}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z;}}}return X;}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312);}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null;}else{l=ae;Q=X;}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310";}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137";}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac;}else{ab.flashvars=ac;}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae);}else{setTimeout(arguments.callee,10);}})();}u(aa,ab,X);}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y);}else{setTimeout(arguments.callee,10);}})();}else{Y.parentNode.replaceChild(g(Y),Y);}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML;}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true));}}}}}return aa;}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X;}if(aa){if(typeof ai.id==D){ai.id=Y;}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae];}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"';}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"';}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />';}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id);}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac]);}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac]);}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab]);}}aa.parentNode.replaceChild(Z,aa);X=Z;}}return X;}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa);}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y);}else{setTimeout(arguments.callee,10);}})();}else{X.parentNode.removeChild(X);}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null;}}Y.parentNode.removeChild(Y);}}function c(Z){var X=null;try{X=j.getElementById(Z);}catch(Y){}return X;}function C(X){return j.createElement(X);}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y];}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false;}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return;}var aa=j.getElementsByTagName("head")[0];if(!aa){return;}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null;}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1];}G=X;}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y);}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"));}}}function w(Z,X){if(!m){return;}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y;}else{v("#"+Z,"visibility:"+Y);}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y;}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2]);}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa]);}for(var Y in M){M[Y]=null;}M=null;for(var X in swfobject){swfobject[X]=null;}swfobject=null;});}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false);}else{if(Z){Z({success:false,id:ab});}}},getObjectById:function(X){if(M.w3){return z(X);}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al];}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak];}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai];}else{am.flashvars=ai+"="+Z[ai];}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true);}X.success=true;X.ref=an;}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return;}else{w(ah,true);}}if(ac){ac(X);}});}else{if(ac){ac(X);}}},switchOffAutoHideShow:function(){m=false;},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]};},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X);}else{return undefined;}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y);}},removeSWF:function(X){if(M.w3){y(X);}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X);}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1];}if(aa==null){return L(Z);}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)));
}}}return"";},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block";}}if(E){E(B);}}a=false;}}};}();(function($){var colorbox="colorbox",hover="hover",TRUE=true,FALSE=false,cboxPublic,isIE=!$.support.opacity,isIE6=isIE&&!window.XMLHttpRequest,cbox_open="sso_cbox_open",cbox_load="sso_cbox_load",cbox_complete="sso_cbox_complete",cbox_cleanup="sso_cbox_cleanup",cbox_closed="sso_cbox_closed",cbox_resize="resize.sso_cbox_resize",$overlay,$cbox,$wrap,$content,$topBorder,$leftBorder,$rightBorder,$bottomBorder,$related,$window,$loaded,$loadingBay,$loadingOverlay,$loadingGraphic,$title,$current,$slideshow,$next,$prev,$close,interfaceHeight,interfaceWidth,loadedHeight,loadedWidth,element,bookmark,index,settings,open,active,defaults={transition:"elastic",speed:350,width:FALSE,height:FALSE,innerWidth:FALSE,innerHeight:FALSE,initialWidth:"400",initialHeight:"400",maxWidth:FALSE,maxHeight:FALSE,scalePhotos:TRUE,scrolling:TRUE,inline:FALSE,html:FALSE,iframe:FALSE,photo:FALSE,href:FALSE,title:FALSE,rel:FALSE,opacity:0.9,preloading:TRUE,current:"image {current} of {total}",previous:"previous",next:"next",close:"close",open:FALSE,overlayClose:TRUE,slideshow:FALSE,slideshowAuto:TRUE,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",onOpen:FALSE,onLoad:FALSE,onComplete:FALSE,onCleanup:FALSE,onClosed:FALSE};function setSize(size,dimension){dimension=dimension==="x"?$window.width():$window.height();return(typeof size==="string")?Math.round((size.match(/%/)?(dimension/100)*parseInt(size,10):parseInt(size,10))):size;}function isImage(url){url=$.isFunction(url)?url.call(element):url;return settings.photo||url.match(/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i);}function process(){for(var i in settings){if($.isFunction(settings[i])&&i.substring(0,2)!=="on"){settings[i]=settings[i].call(element);}}settings.rel=settings.rel||element.rel;settings.href=settings.href||element.href;settings.title=settings.title||element.title;}function launch(elem){element=elem;settings=$(element).data(colorbox);process();if(settings.rel&&settings.rel!=="nofollow"){$related=$(".cboxElement").filter(function(){var relRelated=$(this).data(colorbox).rel||this.rel;return(relRelated===settings.rel);});index=$related.index(element);if(index<0){$related=$related.add(element);index=$related.length-1;}}else{$related=$(element);index=0;}if(!open){open=TRUE;active=TRUE;bookmark=element;bookmark.blur();$(document).bind("keydown.cbox_close",function(e){if(e.keyCode===27){e.preventDefault();cboxPublic.close();}}).bind("keydown.cbox_arrows",function(e){if($related.length>1){if(e.keyCode===37){e.preventDefault();$prev.click();}else{if(e.keyCode===39){e.preventDefault();$next.click();}}}});if(settings.overlayClose){$overlay.css({cursor:"pointer"}).one("click",cboxPublic.close);}$.event.trigger(cbox_open);if(settings.onOpen){settings.onOpen.call(element);}$overlay.css({opacity:settings.opacity}).show();settings.w=setSize(settings.initialWidth,"x");settings.h=setSize(settings.initialHeight,"y");cboxPublic.position(0);if(isIE6){$window.bind("resize.cboxie6 scroll.cboxie6",function(){$overlay.css({width:$window.width(),height:$window.height(),top:$window.scrollTop(),left:$window.scrollLeft()});}).trigger("scroll.cboxie6");}}$current.add($prev).add($next).add($slideshow).add($title).hide();$close.html(settings.close).show();cboxPublic.slideshow();cboxPublic.load();}cboxPublic=$.fn.ssoColorbox=function(options,callback){var $this=this;if(!$this.length){if($this.selector===""){$this=$("<a/>");options.open=TRUE;}else{return this;}}$this.each(function(){var data=$.extend({},$(this).data(colorbox)?$(this).data(colorbox):defaults,options);$(this).data(colorbox,data).addClass("cboxElement");if(callback){$(this).data(colorbox).onComplete=callback;}});if(options&&options.open){launch($this);}return this;};cboxPublic.init=function(){function $div(id){return $('<div id="sso-cbox-'+id+'"/>');}$window=$(window);$cbox=$('<div id="sso-cbox"/>');$overlay=$div("overlay").hide();$wrap=$div("wrapper");$content=$div("content").append($loaded=$div("loaded-content").addClass("clearfix").css({width:0,height:0}),$loadingOverlay=$div("loading-overlay"),$loadingGraphic=$div("loading-graphic"),$title=$div("title"),$current=$div("current"),$slideshow=$div("slideshow"),$next=$div("next"),$prev=$div("previous"),$close=$div("close"));$wrap.append($('<div id="sso-cbox-top-corners"/>').append($div("top-left"),$topBorder=$div("top-center"),$div("top-right")),$("<div/>").append($leftBorder=$div("middle-left"),$content,$rightBorder=$div("middle-right")),$('<div id="sso-cbox-bottom-corners"/>').append($div("bottom-left"),$bottomBorder=$div("bottom-center"),$div("bottom-right"))).children().children().css({"float":"left"});$loadingBay=$("<div style='position:absolute; top:0; left:0; width:9999px; height:0;'/>");$("body").append($overlay,$cbox.append($wrap,$loadingBay));if(isIE){$cbox.addClass("cbox-ie");if(isIE6){$overlay.css("position","absolute");}}$content.children().bind("mouseover mouseout",function(){$(this).toggleClass(hover);}).addClass(hover);interfaceHeight=$topBorder.height()+$bottomBorder.height()+$content.outerHeight(TRUE)-$content.height();interfaceWidth=$leftBorder.width()+$rightBorder.width()+$content.outerWidth(TRUE)-$content.width();loadedHeight=$loaded.outerHeight(TRUE);loadedWidth=$loaded.outerWidth(TRUE);$cbox.css({"padding-bottom":interfaceHeight,"padding-right":interfaceWidth}).hide();$next.click(cboxPublic.next);$prev.click(cboxPublic.prev);$close.click(cboxPublic.close);$content.children().removeClass(hover);$(".sso-cbox-element").live("click",function(e){if(e.button!==0&&typeof e.button!=="undefined"){return TRUE;}else{launch(this);return FALSE;}});};cboxPublic.position=function(speed,loadedCallback){var animate_speed,winHeight=$window.height(),posTop=Math.max(winHeight-settings.h-loadedHeight-interfaceHeight,0)/2+$window.scrollTop(),posLeft=Math.max(document.documentElement.clientWidth-settings.w-loadedWidth-interfaceWidth,0)/2+$window.scrollLeft();animate_speed=($cbox.width()===settings.w+loadedWidth&&$cbox.height()===settings.h+loadedHeight)?0:speed;$wrap[0].style.width=$wrap[0].style.height="9999px";function modalDimensions(that){$topBorder[0].style.width=$bottomBorder[0].style.width=$content[0].style.width=that.style.width;$loadingGraphic[0].style.height=$loadingOverlay[0].style.height=$content[0].style.height=$leftBorder[0].style.height=$rightBorder[0].style.height=that.style.height;}$cbox.dequeue().animate({width:settings.w+loadedWidth,height:settings.h+loadedHeight,top:posTop,left:posLeft},{duration:animate_speed,complete:function(){modalDimensions(this);active=FALSE;$wrap[0].style.width=(settings.w+loadedWidth+interfaceWidth)+"px";$wrap[0].style.height=(settings.h+loadedHeight+interfaceHeight)+"px";if(loadedCallback){loadedCallback();}},step:function(){modalDimensions(this);}});};cboxPublic.resize=function(object){if(!open){return;}var topMargin,prev,prevSrc,next,nextSrc,photo,timeout,speed=settings.transition==="none"?0:settings.speed;$window.unbind(cbox_resize);if(!object){timeout=setTimeout(function(){var $child=$loaded.wrapInner("<div style='overflow:auto'></div>").children();settings.h=$child.height();$loaded.css({height:settings.h});$child.replaceWith($child.children());cboxPublic.position(speed);},1);return;}$loaded.remove();$loaded=$('<div id="sso-cbox-loaded-content"/>').html(object);function getWidth(){settings.w=settings.w||$loaded.width();settings.w=settings.mw&&settings.mw<settings.w?settings.mw:settings.w;return settings.w;}function getHeight(){settings.h=settings.h||$loaded.height();settings.h=settings.mh&&settings.mh<settings.h?settings.mh:settings.h;return settings.h;}$loaded.hide().appendTo($loadingBay).css({width:getWidth(),overflow:settings.scrolling?"auto":"hidden"}).css({height:getHeight()}).prependTo($content);$("#sso-cbox-photo").css({cssFloat:"none"});if(isIE6){$("select:not(#sso-colorbox select)").filter(function(){return this.style.visibility!=="hidden";}).css({visibility:"hidden"}).one(cbox_cleanup,function(){this.style.visibility="inherit";});}function setPosition(s){cboxPublic.position(s,function(){if(!open){return;}if(isIE){if(photo){$loaded.fadeIn(100);}$cbox[0].style.removeAttribute("filter");}if(settings.iframe){$loaded.append("<iframe id='sso-cbox-iframe'"+(settings.scrolling?" ":"scrolling='no'")+" name='iframe_"+new Date().getTime()+"' frameborder=0 src='"+settings.href+"' "+(isIE?"allowtransparency='true'":"")+" />");}$loaded.show();$title.show().html(settings.title);if($related.length>1){$current.html(settings.current.replace(/\{current\}/,index+1).replace(/\{total\}/,$related.length)).show();$next.html(settings.next).show();$prev.html(settings.previous).show();if(settings.slideshow){$slideshow.show();}}$loadingOverlay.hide();$loadingGraphic.hide();$.event.trigger(cbox_complete);if(settings.onComplete){settings.onComplete.call(element);}if(settings.transition==="fade"){$cbox.fadeTo(speed,1,function(){if(isIE){$cbox[0].style.removeAttribute("filter");}});}$window.bind(cbox_resize,function(){cboxPublic.position(0);});});}if((settings.transition==="fade"&&$cbox.fadeTo(speed,0,function(){setPosition(0);}))||setPosition(speed)){}if(settings.preloading&&$related.length>1){prev=index>0?$related[index-1]:$related[$related.length-1];next=index<$related.length-1?$related[index+1]:$related[0];nextSrc=$(next).data(colorbox).href||next.href;prevSrc=$(prev).data(colorbox).href||prev.href;if(isImage(nextSrc)){$("<img />").attr("src",nextSrc);}if(isImage(prevSrc)){$("<img />").attr("src",prevSrc);}}$("#sso-cbox-content").css("paddingBottom","0");};cboxPublic.load=function(){var href,img,setResize,resize=cboxPublic.resize;active=TRUE;element=$related[index];settings=$(element).data(colorbox);process();$.event.trigger(cbox_load);if(settings.onLoad){settings.onLoad.call(element);}settings.h=settings.height?setSize(settings.height,"y")-loadedHeight-interfaceHeight:settings.innerHeight?setSize(settings.innerHeight,"y"):FALSE;settings.w=settings.width?setSize(settings.width,"x")-loadedWidth-interfaceWidth:settings.innerWidth?setSize(settings.innerWidth,"x"):FALSE;
settings.mw=settings.w;settings.mh=settings.h;if(settings.maxWidth){settings.mw=setSize(settings.maxWidth,"x")-loadedWidth-interfaceWidth;settings.mw=settings.w&&settings.w<settings.mw?settings.w:settings.mw;}if(settings.maxHeight){settings.mh=setSize(settings.maxHeight,"y")-loadedHeight-interfaceHeight;settings.mh=settings.h&&settings.h<settings.mh?settings.h:settings.mh;}href=settings.href;$loadingOverlay.show();$loadingGraphic.show();if(settings.inline){$('<div id="sso-cbox-inline-temp" />').hide().insertBefore($(href)[0]).bind(cbox_load+" "+cbox_cleanup,function(){$(this).replaceWith($loaded.children());});resize($(href));}else{if(settings.iframe){resize(" ");}else{if(settings.html){resize(settings.html);}else{if(isImage(href)){img=new Image();img.onload=function(){var percent;img.onload=null;img.id="sso-cbox-photo";$(img).css({margin:"auto",border:"none",display:"block",cssFloat:"left"});if(settings.scalePhotos){setResize=function(){img.height-=img.height*percent;img.width-=img.width*percent;};if(settings.mw&&img.width>settings.mw){percent=(img.width-settings.mw)/img.width;setResize();}if(settings.mh&&img.height>settings.mh){percent=(img.height-settings.mh)/img.height;setResize();}}if(settings.h){img.style.marginTop=Math.max(settings.h-img.height,0)/2+"px";}resize(img);if($related.length>1){$(img).css({cursor:"pointer"}).click(cboxPublic.next);}if(isIE){img.style.msInterpolationMode="bicubic";}};img.src=href;}else{$("<div />").appendTo($loadingBay).load(href,function(data,textStatus){if(textStatus==="success"){resize(this);}else{resize($("<p>Request unsuccessful.</p>"));}});}}}}};cboxPublic.next=function(){if(!active){index=index<$related.length-1?index+1:0;cboxPublic.load();}};cboxPublic.prev=function(){if(!active){index=index>0?index-1:$related.length-1;cboxPublic.load();}};cboxPublic.slideshow=function(){var stop,timeOut,className="sso-cbox-slideshow-";$slideshow.bind(cbox_closed,function(){$slideshow.unbind();clearTimeout(timeOut);$cbox.removeClass(className+"off "+className+"on");});function start(){$slideshow.text(settings.slideshowStop).bind(cbox_complete,function(){timeOut=setTimeout(cboxPublic.next,settings.slideshowSpeed);}).bind(cbox_load,function(){clearTimeout(timeOut);}).one("click",function(){stop();$(this).removeClass(hover);});$cbox.removeClass(className+"off").addClass(className+"on");}stop=function(){clearTimeout(timeOut);$slideshow.text(settings.slideshowStart).unbind(cbox_complete+" "+cbox_load).one("click",function(){start();timeOut=setTimeout(cboxPublic.next,settings.slideshowSpeed);$(this).removeClass(hover);});$cbox.removeClass(className+"on").addClass(className+"off");};if(settings.slideshow&&$related.length>1){if(settings.slideshowAuto){start();}else{stop();}}};cboxPublic.close=function(){$.event.trigger(cbox_cleanup);if(settings.onCleanup){settings.onCleanup.call(element);}open=FALSE;$(document).unbind("keydown.cbox_close keydown.cbox_arrows");$window.unbind(cbox_resize+" resize.cboxie6 scroll.cboxie6");$overlay.css({cursor:"auto"}).fadeOut("fast");$cbox.stop(TRUE,FALSE).fadeOut("fast",function(){$("#colorbox iframe").attr("src","about:blank");$loaded.remove();$cbox.css({opacity:1});try{bookmark.focus();}catch(er){}$.event.trigger(cbox_closed);if(settings.onClosed){settings.onClosed.call(element);}});};cboxPublic.element=function(){return $(element);};cboxPublic.settings=defaults;$(cboxPublic.init);}(jQuery));iVillage=window.iVillage||{omniEvent:function(){},siteName:"",gigya_api_key:"2_TAACrzG-_a9IkzLfWB3YsVoaBvKoZSfmy-eAfFSA0_XZPEk1Lpd5dWthUDHdRtu-"};var iV_SSO=(function(window,$){var ssoReady,htmlBase,uploadSwf,postPaths,getPaths,origEventTarget,origEventType,avatarOverlay,cropApi,chimeType,regNlid,userSocialData;var options={baseUrl:"/",proxyUrl:false,vertical:1,gigyaAPIURL:"http://cdn.gigya.com/JS/socialize.js",gigyaConfig:{enabledProviders:"facebook,twitter,yahoo,messenger,google,aol",newUsersPendingRegistration:false},basicLoginParams:{buttonsStyle:"standard",hideGigyaLink:true,includeiRank:true,width:240,height:165,showTermsLink:false,showTooltips:true,headerText:"<ul><li class='sc social-sign-in'>Save time by using your existing account to sign in to iVillage.</li><li class='sc social-privacy'>We'll never share your information or post anything to your account without your permission.</li></ul>",sessionExpiration:0,pendingRegistration:false,lastLoginIndication:"welcome",lastLoginButtonSize:30,UIConfig:'<config><body><controls><snbuttons buttonsize="35"></snbuttons></controls></body></config>',cid:"iVillage",context:"iVillage",onLoad:function(eventObj){log("Gigya: Signin Plugin Loaded.");}},loginUIParams:{containerID:"loginOptionsBox",includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.",eventObj);showGigyaError(eventObj,options.loginUIParams.containerID);}},registrationUIParams:{containerID:"registrationOptionsBox",includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.");showGigyaError(eventObj,options.registrationUIParams.containerID);}},forgotPwdLoginUIParams:{containerID:"forgotOptionsBox",includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.");showGigyaError(eventObj,options.forgotPwdLoginUIParams.containerID);}},chimeLoginUIParams:{containerID:"chimeLoginBox",UIConfig:'<config><body><controls><snbuttons buttonsize="25"></snbuttons></controls></body></config>',lastLoginButtonSize:25,height:92,width:200,includeiRank:true,onError:function(eventObj){log("Gigya: Unable to load Plugin.");showGigyaError(eventObj,options.chimeLoginUIParams.containerID);}},globalLayoutLoginUIParams:{containerID:"globalLayoutLoginBox",headerText:"",lastLoginIndication:"border",context:"iVillageHeader",width:100,height:26,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>'},channelLayoutLoginUIParams:{containerID:"channelLayoutLoginBox",headerText:"",lastLoginIndication:"border",context:"iVillageHeader",width:100,height:26,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>'},addConnectionsUIParams:{containerID:"addConnectionsBox",width:280,height:200,hideGigyaLink:true,showEditLink:true,showTermsLink:false,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>',sessionExpiration:0,cid:"iVillage"},addConnectionsUISmallParams:{containerID:"addConnectionsBoxSmall",width:130,height:26,hideGigyaLink:true,showTermsLink:false,includeiRank:true,UIConfig:'<config><body><controls><snbuttons buttonsize="20"></snbuttons></controls></body></config>',sessionExpiration:0,cid:"iVillage"},addConnectionsUILoaded:false,loginUILoadindAttempts:0,loginUILoaded:false,addConnectionsUILoadindAttempts:0,registrationBoxExpanded:false,onLoginParams:{onLogin:function(eventObj){steps.gigyaLogin(eventObj);}},onConnectionEditParams:{onConnectionAdded:function(eventObj){editedConnection(eventObj);},onConnectionRemoved:function(eventObj){editedConnection(eventObj);}},loginParamsPassed:false,submitUGCForm:false,slide_information:{},gigya_share_ugc_config:{operationMode:"multiSelect",containerID:"ugc-gigya-share-plugin",context:"UGCShare",cid:"iVillage",shortURLs:"always",showTooltips:true,showMoreButton:false,showEmailButton:true}};var inited=false;var isAuthenticated=false;var userId=0;var avatarId=0;var username="";var sessionToken="";var flowType="none";var lastFlow="none";var flowSuccess=false;var uploadPhotoId=0;var saveURL="";var saveId="";var errorArrow='<span class="error-arrow"></span>';var proxyOrBase="";var completeUploads=0;$.validator.addMethod("not_default",function(value,element){return this.optional(element)||value!=="default";},errorArrow+"Please select an option.");$.validator.addMethod("us_check",function(value,element){if(parseInt($("#sso_country_id").val(),10)===1){$("#sso_zip_code").rules("add",{required:true,minlength:5,maxlength:5,messages:{required:errorArrow+"Please enter a valid 5 digit US zip code.",minlength:errorArrow+"Please enter a valid 5 digit US zip code.",maxlength:errorArrow+"Please enter a valid 5 digit US zip code."}});}else{$("#sso_zip_code").rules("remove");}return true;},errorArrow+"Enter a zip.");$.validator.addMethod("start_date_check",function(value,element){element=$(element);var selects;if(element.hasClass("start-date-required")){selects=element.parent().find("select");if(element.is(":checked")){selects.each(function(){var type=this.id.split("_")[0];$(this).rules("add",{not_default:true,messages:{not_default:errorArrow+"Please select a "+type+"."}});});}else{selects.each(function(){$(this).rules("remove");});}}return true;},errorArrow+"Enter a start date.");$.validator.addMethod("at_least_one",function(value,element){return $.find(":checkbox:checked").length>0;},errorArrow+'Please select the newsletters you\'d like to receive before clicking "Subscribe"');$.validator.addMethod("community_leader_check",function(value,element){var firstThree=value.substring(0,3);return firstThree!=="cl-"&&firstThree!=="cl_";},errorArrow+'Your username cannot begin with "cl-" or "cl_"');$.validator.addMethod("additional_field_validation",function(value,element){return $(element).parent().css("display")=="none"||value!="";},errorArrow+"This field is required.");$.validator.addMethod("additional_field_length",function(value,element){return $(element).parent().css("display")=="none"||value.length<51;},errorArrow+"Should not be more than 50 characters.");$.validator.addMethod("selected_ugc_category",function(value,element){if($("#sso-upload #ugc_categorization_group").find("input[type=radio]:checked").length==0){if($("#sso-upload #ugc_categorization_group span.error").length>0){$("#sso-upload #ugc_categorization_group span.error").remove();}$("#sso-upload #ugc_categorization_group").append("<span class='error' style='line-height: 120%'>Please select one category.</span>");return false;}else{return true;}},"");var validation={login:{rules:{sso_email_username:{required:true},sso_password:{required:true}},messages:{sso_email_username:{required:errorArrow+"Please enter your email or username."},sso_password:{required:errorArrow+"Please provide a password."}},invalidHandler:function(){setTimeout(omnitureSignInErrors,100);}},register:{rules:{sso_email:{required:true,email:true},sso_username:{required:true,community_leader_check:true},sso_password:{required:true,minlength:4},sso_confirm_password:{required:true,equalTo:"#sso_password"},sso_dob_month:{not_default:true},sso_dob_day:{not_default:true},sso_dob_year:{not_default:true},sso_country_id:{not_default:true,us_check:true},sso_zip_code:{required:true},sso_terms:{required:true}},messages:{sso_username:{required:errorArrow+"Please enter a username."},sso_password:{required:errorArrow+"Please provide a password.",minlength:errorArrow+"Please choose at least 4 characters."},sso_confirm_password:{required:errorArrow+"Please provide a password.",equalTo:errorArrow+"Please enter the same password as above."},sso_dob_month:{not_default:errorArrow+"Please select your birth month."},sso_dob_day:{not_default:errorArrow+"Please select your birth day."},sso_dob_year:{not_default:errorArrow+"Please select your birth year."},sso_country_id:{not_default:errorArrow+"Please select your country."},sso_zip_code:{required:errorArrow+"Please enter a valid 5 digit US zip code."},sso_email:errorArrow+"Please enter a valid email address.",sso_terms:errorArrow+"Required."},invalidHandler:function(){setTimeout(omnitureRegistrationErrors,100);}},gigya_register:{rules:{sso_email:{required:true,email:true},sso_username:{required:true,community_leader_check:true},sso_password:{required:true,minlength:4},sso_confirm_password:{required:true,equalTo:"#sso_password2"},sso_dob_month:{not_default:true},sso_dob_day:{not_default:true},sso_dob_year:{not_default:true},sso_country_id:{not_default:true,us_check:true},sso_zip_code:{required:true},sso_terms:{required:true}},messages:{sso_username:{required:errorArrow+"Please enter a username."},sso_password:{required:errorArrow+"Please provide a password.",minlength:errorArrow+"Please choose at least 4 characters."},sso_confirm_password:{required:errorArrow+"Please provide a password.",equalTo:errorArrow+"Please enter the same password as above."},sso_dob_month:{not_default:errorArrow+"Please select your birth month."},sso_dob_day:{not_default:errorArrow+"Please select your birth day."},sso_dob_year:{not_default:errorArrow+"Please select your birth year."},sso_country_id:{not_default:errorArrow+"Please select your country."},sso_zip_code:{required:errorArrow+"Please enter a valid 5 digit US zip code."},sso_email:errorArrow+"Please enter a valid email address.",sso_terms:errorArrow+"Required."},invalidHandler:function(){setTimeout(omnitureGigyaRegistrationErrors,100);}},fb_link_existing:{rules:{sso_email:{required:true,email:true},sso_username:{required:true,community_leader_check:true},sso_password:{required:true,minlength:4},sso_confirm_password:{required:true,equalTo:"#sso_password3"},sso_dob_month:{not_default:true},sso_dob_day:{not_default:true},sso_dob_year:{not_default:true},sso_country_id:{not_default:true,us_check:true},sso_zip_code:{required:true},sso_terms:{required:true}},messages:{sso_username:{required:errorArrow+"Please enter a username."},sso_password:{required:errorArrow+"Please provide a password.",minlength:errorArrow+"Please choose at least 4 characters."},sso_confirm_password:{required:errorArrow+"Please provide a password.",equalTo:errorArrow+"Please enter the same password as above."},sso_dob_month:{not_default:errorArrow+"Please select your birth month."},sso_dob_day:{not_default:errorArrow+"Please select your birth day."},sso_dob_year:{not_default:errorArrow+"Please select your birth year."},sso_country_id:{not_default:errorArrow+"Please select your country."},sso_zip_code:{required:errorArrow+"Please enter a valid 5 digit US zip code."},sso_email:errorArrow+"Please enter a valid email address.",sso_terms:errorArrow+"Required."},invalidHandler:function(){setTimeout(omnitureGigyaRegistrationErrors,100);
}},chime:{rules:{sso_guest_name:{required:"#sso_guest_email:filled"},sso_guest_email:{email:true,required:"#sso_guest_name:filled"},sso_member_email:{email:true},sso_member_password:{required:"#sso_email_username:filled"}},messages:{sso_guest_name:{required:errorArrow+"Please enter your name."},sso_guest_email:{email:errorArrow+"Please enter a valid email address.",required:errorArrow+"Please enter an email address."},sso_member_email:{email:errorArrow+"Please enter a valid email address."},sso_member_password:{required:errorArrow+"Please enter your password."}}},social_email:{rules:{sso_social_email:{required:true,email:true}},messages:{sso_social_email:{required:errorArrow+"Please enter your email address.",email:errorArrow+"Please enter a valid email address."}}},ugc_upload:{rules:{title:{required:true,maxlength:50},description:{required:true,maxlength:140},additional_optin:{required:true},sso_additional_field_1:{additional_field_validation:true,additional_field_length:true},sso_additional_field_2:{additional_field_validation:true,additional_field_length:true},ugc_categories:{selected_ugc_category:true}},messages:{title:{required:errorArrow+"Please provide a title for this image.",maxlength:errorArrow+"Title should not be more than 50 characters."},description:{required:errorArrow+"Please describe this image in brief.",maxlength:errorArrow+"Descripiton should not be more than 140 characters."},additional_optin:{required:errorArrow+"Please accept the terms and conditions."}}}};var steps={addSave:function(e){log("steps.addSave()");requestHTML("addSave",function(){$("#sso-cbox-close").show();$("#sso-add-save .buttons a").click(handleAddSave);});},deleteSave:function(e){log("steps.deleteSave()");requestHTML("deleteSave",function(){$("#sso-cbox-close").show();$("#sso-delete-save #delete-save").click(handleDeleteSave);$("#sso-delete-save a.btn-nope").click(function(e){e.preventDefault();closeAfter(0);});});},editSave:function(e){log("steps.editSave()");requestHTML("editSave",function(){$("#sso-cbox-close").show();$("#sso-add-save a#edit-save").click(handleEditSave);});},insertSave:function(e){log("steps.insertSave()");requestHTML("insertSave",function(){$("#sso-cbox-close").show();$("#save-insert-list li").click(embedSaveToTextarea);});},login:function(){log("steps.login()");if(!isAuthenticated){requestHTML("login",function(){if(typeof(gigya)!="undefined"){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.loginUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$("#sso-cbox-close").show();$("#sso-sign-in").validate(validation.login);customOmniEvent(null,25,"Start sign-in process.");});}},gigyaLogin:function(eventObj){log("steps.gigyaLogin() > Start Authentication",eventObj);var omniVerticalMsg="gigyasignin_"+iVillage.siteName;omniVerticalMsg=omniVerticalMsg.toLowerCase();iVillage.omniEvent(null,null,"Start sign-in/registration process VIA Gigya.",omniVerticalMsg);$.ajax({type:"POST",url:postPaths.gigyaLogin,cache:false,data:{vertical:options.vertical,data:eventObj},dataType:"json",error:function(data){log("steps.gigyaLogin() error!",data);var list=$("#sso-cbox-loaded-content div.social-connect > ul");displayErrors(list,{message:"We're sorry, but we were unable to connect you with "+eventObj.provider+" at this time. Please try again later."});omnitureSignInErrors(true);},success:function(data){log("steps.gigyaLogin() > Success received from server!");userSocialData=eventObj;if(data.success){if(data.new_registration){if(typeof(data.new_email_id)!="undefined"&&data.new_email_id!=""){steps.registerNewUser(eventObj);}else{steps.askForEmail(eventObj,data);}}else{if(typeof(data.matched_id)!="undefined"&&data.matched_id){flowSuccess=true;if(eventObj.context=="iVillageHeader"){location.reload();}else{closeAfter(0);if(flowType==="chime"){triggerChimeEvent({type:"member"});}}}else{if(typeof(data.is_fb_user)!="undefined"&&data.is_fb_user){steps.linkExistingFBUser(eventObj,data);}else{steps.askForPassword(eventObj,data);}}}}else{log("steps.gigyaLogin() error!",data);var list=$("#sso-cbox-loaded-content div.social-connect > ul");displayErrors(list,{message:"We're sorry, but we were unable to connect you with "+eventObj.provider+" at this time. Please try again later."});omnitureSignInErrors(true);}}});},registerNewUser:function(eventObj,user_email){log("steps.registerNewUser()");requestHTML("gigyaRegister",function(){var custom_message="You're almost done. Fill in the fields below to complete your registration.";var fill_gigya_register_form=fillUserInfoHeader(eventObj,"link-or-register-forms",custom_message);fill_gigya_register_form=fillGigyaRegisterForm(eventObj,user_email);$("#sso-cbox-close").show();$("#sso-gigya-register").validate(validation.gigya_register);customOmniEvent(null,54,"Reg Missing Request");setTimeout(function(){$.fn.ssoColorbox.resize();},100);});},askForEmail:function(eventObj,data){log("steps.askForEmail()");if(flowType=="chime"){lastFlow="chime";}flowType="emailLookup";requestHTML("askForEmail",function(){var custom_message="Please provide your email address to complete your registration.";var fill_email_lookup_form=fillUserInfoHeader(eventObj,"ask-social-email",custom_message);$("#sso-social-get-email").find('input[name="email_lookup"]').val(1);$("#sso-cbox-close").show();$("#sso-social-get-email").validate(validation.social_email);customOmniEvent(null,52,"Reg Email Request");$.fn.ssoColorbox.resize();});},askForPassword:function(eventObj,data){log("steps.askForPassword()");if(flowType=="chime"){lastFlow="chime";}flowType="linkingAccounts";requestHTML("askForPassword",function(){var custom_message="We found an existing iVillage account for <strong>"+data.user.primary_email+"</strong>. Please enter your password to link your accounts and finish logging in.";var fill_password_form=fillUserInfoHeader(eventObj,"link-or-register-forms",custom_message);fill_password_form=fillAccountLinkForm(eventObj);$("#sso-ask-for-password").find('input[name="sso_email_username"]').val(data.user.primary_email).parents("li").hide();$("#sso-cbox-close").show();$("#sso-ask-for-password").validate(validation.login);customOmniEvent(null,53,"Reg Password Request");$.fn.ssoColorbox.resize();});},finalizeLinking:function(data){log("steps.finalizeLinking() > Accounts linked. Completing login process.");flowSuccess=true;closeAfter(0);if(flowType==="chime"||lastFlow=="chime"){triggerChimeEvent({type:"member"});}},linkExistingFBUser:function(eventObj,data){log("steps.linkExistingFBUser() > User was in iVillage via FB connect");if(flowType=="chime"){lastFlow="chime";}flowType="linkingAccounts";requestHTML("linkExistingFBUser",function(){var custom_message="You're almost done. Fill in the fields below to complete your registration.";var fill_password_form=fillUserInfoHeader(eventObj,"link-or-register-forms",custom_message);fill_password_form=fillFBAccountLinkForm(eventObj);if(!data.ask_for_email){$("#sso-link-existing-fb-user").find('input[name="sso_email"]').val(data.user.primary_email).parents("li").hide();}else{if(typeof(data.new_email_id)!="indefined"&&data.new_email_id!=""){$("#sso-link-existing-fb-user").find('input[name="sso_email"]').val(data.new_email_id).parents("li").hide();}}$("#sso-link-existing-fb-user").find('input[name="id"]').val(data.user.id);$("#sso-cbox-close").show();$("#sso-link-existing-fb-user").validate(validation.fb_link_existing);customOmniEvent(null,54,"Reg Missing Request");$.fn.ssoColorbox.resize();});},socialGetEmail:function(){requestHTML("socialGetEmail",function(){$("#sso-cbox-close").hide();$("#sso-social-get-email").validate(validation.social_email);});},forgotPassword:function(){log("steps.forgotPassword()");if(!isAuthenticated){requestHTML("forgotPassword",function(){if(typeof(gigya)!="undefined"){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.forgotPwdLoginUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$("#sso-cbox-close").show();});}},logout:function(){log("steps.logout()");function logoutPost(){$.ajax({type:"POST",url:postPaths.logout,cache:false,error:ajaxError,success:function(data,status,XHR){log("steps.logout() > Returned from server.",data);isAuthenticated=false;userId=0;flowSuccess=true;fireOriginalEventOrReload();}});}log("steps.logout() Authenticated, logging out...");if(typeof(gigya)!="undefined"){log("steps.logout() Logging out with Gigya...");options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});var logoutParams={callback:function(responseObj){logoutPost();},forceProvidersLogout:true};gigya.services.socialize.logout(options.gigyaConfig,logoutParams);$(".add_connection_edit_btn").fadeOut("slow");}else{log("steps.logout() Logging out without Gigya...");logoutPost();}},register:function(){log("steps.register()");if(!isAuthenticated){requestHTML("register",function(){if(typeof(gigya)!="undefined"){if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.registrationUIParams));
}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$('[name="sso_confirm_password"]').live("focusin",function(e){if(!options.registrationBoxExpanded){e.preventDefault();var need_resize=displayHiddenFields("#sso-register","li");setTimeout(function(){$.fn.ssoColorbox.resize();},500);$(this).focus();options.registrationBoxExpanded=true;}});$("#sso-cbox-close").show();$("#sso-register").validate(validation.register);$("#sso-register").find('input[type="text"], input[type="password"]').keypress(function(e){var code=e.keyCode||e.which;if(code===13){$("#sso-register").submit();}});filterLoginMessage(false);customOmniEvent(null,20,"Start registration flow");});}},chime:function(){log("steps.chime()");if(!isAuthenticated){requestHTML("chime",function(){if(typeof(gigya)!="undefined"){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.chimeLoginUIParams));}else{var list=$("#sso-cbox-loaded-content div.social-connect > ul.error-list");displayErrors(list,{message:"Connecting via social networks is not available at the moment. Please use normal login option."});}$("#sso-cbox-close").show();$("#sso-chime-in").validate(validation.chime);});}},avatarOrUpload:function(that){log("steps.avatarOrUpload()");if(isAuthenticated){requestHTML("avatarOrUpload",function(){$("#sso-cbox-close").show();});}else{steps.login();}},allAvatars:function(that){log("steps.allAvatars()");if(isAuthenticated){requestHTML("allAvatars",function(){$("#sso-cbox-close").show();});}else{steps.login();}},uploadPhoto:function(that,isAvatar){isAvatar=isAvatar||false;var getPath=isAvatar?"uploadAvatar":"uploadPhoto";var postPath=postPaths.createPhoto;log("steps.uploadAvatar()",[that,isAvatar]);if(isAuthenticated){requestHTML(getPath,function(){$("#sso-cbox-close").show();var cancel=$("#sso-submit-photo a.btn-cancel.sso-close");$("#sso-upload input[type='file']").uploadify({uploader:uploadSwf,width:65,height:25,script:postPath,fileDataName:"photo",sizeLimit:2500000,scriptData:{token:sessionToken},cancelImg:options.baseUrl+"public/sso/images/cancel.png",buttonImg:options.baseUrl+"public/sso/images/btn-browse-for-flash.png",auto:true,fileExt:"*.gif;*.jpg;*.jpeg;*.png",fileDesc:"Choose a picture to upload.",onSelect:function(event,queueID,fileObj){cancel.addClass("btn-hide");$("#sso-cbox-close").hide();},onError:function(a,b,c,d){cancel.removeClass("btn-hide");$("#sso-cbox-close").show();},onComplete:function(event,queueID,fileObj,response){log("uploadify > onComplete()");establishSession(function(){response=$.parseJSON(response);uploadPhotoId=response.photo_id;$("#sso_photo_id").val(uploadPhotoId);finalizePhotoUpload(response.url,event,queueID,fileObj,response);});},onAllComplete:function(){log("uploadify > onAllComplete()");completeUploads=0;}});});}else{steps.login();}},uploadAvatar:function(that){log("steps.uploadAvatar()");this.uploadPhoto(that,true);},thanks:function(){log("steps.thanks()");if(isAuthenticated){avatarOverlayCleanup();}requestHTML("thanks",function(){$("#sso-cbox-close").show();});},newslettersByVertical:function(){log("steps.newslettersByVertical()");if(isAuthenticated||(typeof(newsletterOverride)!="undefined")){requestHTML("newsletterList",function(){$("#sso-cbox-close").show();if(flowType==="register"){var eventArray;if($.isArray(regNlid)&&regNlid.length>0){eventArray=[22,23,24];iVillage.omniEvent(31,eventArray,"Registration completed, newsletter signups, begin newsletter registration.",null,regNlid);}else{eventArray=[22,23];iVillage.omniEvent(null,eventArray,"Registration completed, begin newsletter registration.");}}else{iVillage.omniEvent(null,23,"Newsletter Intercept");}var form=$("#sso-newsletters");var validationSettings={rules:{email:{at_least_one:true,email:true}},messages:{email:{at_least_one:errorArrow+'Please select the newsletters you\'d like to receive before clicking "Subscribe"',email:errorArrow+"Please enter a valid email address."}}};if(form.length){form.find("input.start-date-required").each(function(){validationSettings.rules[this.id]={start_date_check:true};}).live("click",function(){$(this).closest("form").valid();});form.find("input.user-email").bind("focus",function(){if($(this).val()==$(this)[0].title){$(this).removeClass("default_text");$(this).val("");}});form.find("input.user-email").bind("blur",function(){if($(this).val()==""){$(this).addClass("default_text");$(this).val($(this)[0].title);}});if(form.find("input.user-email").length<=0){form.find("input[type=checkbox]").first().each(function(){validationSettings.rules[this.id]={at_least_one:true};});}form.validate(validationSettings);}});}else{steps.login();}},insertOrUploadPhoto:function(e){log("steps.insertOrUploadPhoto()");if(isAuthenticated){requestHTML("insertOrUploadPhoto",function(){$("#sso-cbox-close").show();});}else{steps.login();}},pickPhoto:function(){log("steps.pickPhoto()");if(isAuthenticated){requestHTML("pickPhoto",function(){$("#sso-cbox-close").show();});}else{steps.login();}},ugc_upload:function(){log("steps.ugc_upload()");if(typeof(ugc_data)!="undefined"&&typeof(ugc_data.permission)!="undefined"&&!ugc_data.permission){$.fn.ssoColorbox({title:"Welcome to iVillage!",html:"<div id='sso-cbox-intro' style='width: 400px; height: 100px;'><span class='error'>"+ugc_data.reason+"</span></div>",scrolling:false,onComplete:function(){closeAfter(7000);},overlayClose:false});return;}var postPath=postPaths.createUGCPhoto;var size_limit=2500000;var file_extension="*.gif;*.jpg;*.jpeg;*.png";var file_desc="Choose a picture to upload.";if(typeof(ugc_data)!="undefined"){size_limit=ugc_data.size_limit;file_extension=ugc_data.file_extension;file_desc=ugc_data.file_desc;}if(isAuthenticated){$("#ugc-preview-area a.sso-ugc-edit").unbind("click").live("click",function(e){e.preventDefault();options.submitUGCForm=false;steps.toggel_ugc_upload_form("upload");});requestHTML("uploadUGC",function(){updateUGCLayover("sso-upload-ugc");$.fn.ssoColorbox.resize();$("#sso-cbox-close").show();$("#sso-upload").validate(validation.ugc_upload);$("#sso-upload #ugc_categorization_group").find("input[type=radio]").change(function(){if($("#sso-upload #ugc_categorization_group span.error").length>0){$("#sso-upload #ugc_categorization_group span.error").remove();}});bind_uploadify_for_ugc_photo("sso-upload",postPath,size_limit,file_extension,file_desc);});}else{steps.login();}},toggel_ugc_upload_form:function(switch_option,form){log("steps.toggel_ugc_upload_form()",switch_option);if(typeof(switch_option)=="undefined"){return;}if(switch_option=="preview"){options.submitUGCForm=true;formData=form.serializeArray();log("formData:ugc_upload()",formData);hideUGCUploadError();if(typeof(ugc_data)!="undefined"){if(typeof(ugc_data.username)!="undefined"){var captionHeading=(ugc_data.ugc_caption_heading&&ugc_data.ugc_caption_heading!=undefined)?(ugc_data.ugc_caption_heading):"";}var ugcCaptionPresent=($(".ugc_caption").length>0)?true:false;if(!ugcCaptionPresent){var captionHeading=(ugc_data.ugc_caption_heading&&ugc_data.ugc_caption_heading!=undefined)?(ugc_data.ugc_caption_heading):"";$("#ugc-preview-area .ugc-preview-username").html("Uploaded by "+ugc_data.username+"<br/><br/><div class='ugc_caption'>"+captionHeading+"</div>");$("#ugc-preview-area .ugc-preview-username").html("Uploaded by "+ugc_data.username+"<br/>");}else{$("#ugc-preview-area .ugc-preview-username").html("Uploaded by "+ugc_data.username+"<br/>");}if(typeof(ugc_data.header_copy_preview_page)!="undefined"){$("#ugc-preview-header").html(ugc_data.header_copy_preview_page);}}for(var ii=0;ii<formData.length;ii++){switch(formData[ii].name){case"ugc_id":$("#ugc-preview-area .ugc-preview-image").html("<img alt='If you are seeing this message for more than 1 minute then please close this and try again.' src='/photo/get-for-ugc?photo_id="+formData[ii].value+"' />");options.slide_information.ugc_id=formData[ii].value;break;case"title":$("#ugc-preview-area .ugc-preview-photo-title").html(formData[ii].value);options.slide_information.title=formData[ii].value;break;case"description":$("#ugc-preview-area .ugc-preview-photo-desc").html(formData[ii].value);options.slide_information.description=formData[ii].value;break;}}if(typeof(ugc_data.sponsor_html)!="undefined"){$("#ugc-preview-area .ugc-sponsored-by").html(ugc_data.sponsor_html);}$("#sso-upload-ugc").hide();$("#ugc-preview-header").show();$("#ugc-preview-area").show();setTimeout(function(){$.fn.ssoColorbox.resize();},50);}else{if(switch_option=="upload"){options.submitUGCForm=false;hideUGCUploadError();$("#ugc-preview-header").hide();$("#ugc-preview-area").hide();$("#sso-upload-ugc").show();setTimeout(function(){$.fn.ssoColorbox.resize();},50);}else{if(switch_option=="share"){hideUGCUploadError();var final_image_url="/photo/get-for-ugc?photo_id="+options.slide_information.ugc_id;var poll_graphic_url="http://i.ivillage.com/ugc/hot_dad/poll_graphics.jpg";if(typeof(options.slide_information.image_url)!="undefined"&&options.slide_information.image_url!=""){final_image_url=options.slide_information.image_url;}$("#ugc-share-header").html(ugc_data.header_copy_thankyou_page);$("#ugc-share-area .ugc-share-image").html("<a class='anchor_with_delay' href='"+options.slide_information.full_url+"'><img alt='UGC Photo' src='"+final_image_url+"' /></a>");$("#ugc-share-area .ugc-share-username").html("Uploaded by "+ugc_data.username+"<br/><br/>"+ugc_data.ugc_caption_heading);$("#ugc-share-area .ugc-share-photo-title").html(options.slide_information.title);$("#ugc-share-area .ugc-share-photo-desc").html(options.slide_information.description);$("#ugc-share-area .ugc-share-poll-graphic").html("<a class='anchor_with_delay' href='"+options.slide_information.full_url+"'><img alt='UGC Photo' src='"+poll_graphic_url+"' /></a>");
$("#ugc-share-area a.btn-finish").live("click",function(e){e.preventDefault();$("#ugc-share-area .ugc-share-image").html("<img alt='UGC Photo' src='"+final_image_url+"' />");$("#ugc-share-area .ugc-share-poll-graphic").html("<img alt='UGC Photo' src='"+poll_graphic_url+"' />");$("#ugc-share-area .ugc-waiting-area .waiting-countdown").css("color","#090").html("We are taking you to the Gallery. Your photo could take up to 5 minutes to appear").css("line-height","20px");console.log("page url",options.slide_information.full_url,"/node/"+ugc_data.slideshow_nid);window.location="/node/"+ugc_data.slideshow_nid;});if(typeof(ugc_data.sponsor_html)!="undefined"){$("#ugc-share-area .ugc-sponsored-by").html(ugc_data.sponsor_html);}if(typeof(gigya)!="undefined"){var user_action=new gigya.services.socialize.UserAction();user_action.setUserMessage("This is the user message");user_action.setTitle(options.slide_information.title);user_action.setLinkBack(options.slide_information.full_url);user_action.setDescription(ugc_data.share_description);user_action.addMediaItem({type:"image",src:final_image_url,href:"http://www.ivillage.com"});gigya.services.socialize.showShareUI(options.gigyaConfig,$.extend({userAction:user_action},options.gigya_share_ugc_config));}else{log("Gigya Undefined!!");}$("#sso-cbox-close, a.btn-cancel").unbind("click",deletePhoto);$("#sso-upload-ugc").hide();$("#ugc-preview-header").hide();$("#ugc-preview-area").hide();$("#ugc-share-header").show();$("#ugc-share-area").show();setTimeout(function(){$.fn.ssoColorbox.resize();},50);}}}},create_ugc_slide:function(form){hideUGCUploadError();switchButtonToLoading(form);submitData=form.serializeArray();submitData.push({name:"slideshow_nid",value:ugc_data.slideshow_nid});submitData.push({name:"ugc_nid",value:ugc_data.ugc_nid});submitData.push({name:"channel_tid",value:ugc_data.channel_tid});log("steps.create_ugc_slide()",submitData);$.ajax({type:"POST",url:postPaths.createUGCSlide,cache:false,data:submitData,dataType:"json",beforeSend:function(){form.find("div.buttons").hide();form.find("#ugc-preview-area .ugc-waiting-area .waiting-message").html("Preparing data for submission...");form.find("#ugc-preview-area .ugc-waiting-area").show();var target_element=$("#ugc-preview-area .ugc-waiting-area .waiting-countdown");},success:function(data){log("steps.create_ugc_slide() > Returned from server.",data);switchLoadingToButton(form);form.find("div.buttons").show();form.find("#ugc-preview-area .ugc-waiting-area").hide();if(data&&data.success){flowSuccess=true;options.slide_information.full_url=data.full_url;options.slide_information.image_url=data.slide_image_url;steps.toggel_ugc_upload_form("share",form);}else{if(data&&!data.success){showUGCUploadError(data.error);}}},error:function(){switchLoadingToButton(form);showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please try again later.");form.find("div.buttons").show();form.find("#ugc-preview-area .ugc-waiting-area").hide();$.fn.ssoColorbox.resize();}});}};function ajaxError(XHR,status,error){if(typeof window.console==="object"&&"log" in window.console){window.console.log("There was a server error, please try again later.",error);}}function handleStep(e){e.preventDefault();var that=$(this);var which=that.attr("step");if($.isFunction(steps[which])){steps[which](that);}}function handleNewWindow(e){e.preventDefault();window.open(this.href);}function handleFormSubmitter(e){log("handleFormSubmitter()");e.preventDefault();$(this).parents("form").submit();}function handleAddSave(e){e.preventDefault();log("handleAddSave()");var postData={privacy_level:$("#sso-add-save #save-privacy").val(),url:saveURL};$("#sso-add-save form, #sso-add-save p.query").hide();$("#sso-add-save").append('<div class="ajax-load"></div>');$.fn.ssoColorbox.resize();$.ajax({type:"POST",url:postPaths.addSave,cache:false,data:postData,dataType:"json",error:ajaxError,success:function(data){log("handleAddSave() > Returned from server.",data);closeAfter(0);if($("#profile-private").length){$.event.trigger("saveChange");}saveURL="";}});}function handleDeleteSave(e){e.preventDefault();log("handleDeleteSave()");$("#sso-delete-save").children().hide();$("#sso-delete-save").append('<div class="ajax-load"></div>');$.fn.ssoColorbox.resize();$.ajax({type:"POST",url:postPaths.deleteSave,cache:false,data:{id:saveId,url:saveURL},dataType:"json",error:ajaxError,success:function(data){log("handleDeleteSave() > Returned from server.",data);closeAfter(0);if($("#profile-private").length){$.event.trigger("saveChange");}saveId=0;}});}function handleEditSave(e){e.preventDefault();log("handleEditSave()");$("#sso-add-save").children().hide();$("#sso-add-save").append('<div class="ajax-load"></div>');$.fn.ssoColorbox.resize();var privacy=$("#sso-add-save form select.privacy").val();$.ajax({type:"POST",url:postPaths.editSave,cache:false,data:{id:saveId,privacy_level:privacy},dataType:"json",error:ajaxError,success:function(data){log("handleEditSave() > Returned from server.",data);closeAfter(0);saveId=0;}});}function embedSaveToTextarea(e){e.preventDefault();saveId=$(this).find("#save-id").attr("rel");log("embedSaveToTextarea()");$.ajax({type:"POST",url:postPaths.embedSave,cache:false,data:{id:saveId},error:ajaxError,success:function(data){log("embedSaveToTextarea() > Returned from server.",data);closeAfter(0);saveId=0;var textarea=origEventTarget.parent().siblings("textarea");if(typeof tinyMCE==="object"){textarea.tinymce().execCommand("mceInsertContent",false,data);}else{textarea.append(data);}}});}function handleChooseAvatar(e){e.preventDefault();var id=parseInt($(this).attr("rel"),10);$.ajax({type:"POST",url:postPaths.setAvatar,cache:false,data:{photo_id:id},dataType:"json",error:ajaxError,success:function(data){log("handleChooseAvatar() > Returned from server.",data);if(data&&data.success){if(flowType!=="register"){flowSuccess=true;}steps.thanks();}}});}function handleAddAnotherPhoto(e){e.preventDefault();$("input#sso-upload-more").attr("value","1");$("form#sso-upload").submit();uploadPhotoId=0;}function handlePickPhoto(e){var photo_id=$(this).attr("rel");e.preventDefault();embedPhotoToTextarea(photo_id);closeAfter(0);}function handlePaginate(e){var url=this.href;var con=$("#sso-cbox-loaded-content");e.preventDefault();con.html('<div class="ajax-load">Loading ...</div>');$.fn.ssoColorbox.resize();$.ajax({url:url,cache:false,error:ajaxError,dataType:"html",success:function(data){con.html(data);$.fn.ssoColorbox.resize();}});}function handleFinish(e){e.preventDefault();var that=$(this);if(that.hasClass("btn-finish")){sendDates(closeAfter);}else{sendDates(function(){window.location=that.attr("href");});}}function handleClose(e){e.preventDefault();closeAfter();}function fireOriginalEventOrReload(){log("fireOriginalEventOrReload() > Flow complete.",[flowType,flowSuccess]);options.registrationBoxExpanded=false;if(flowSuccess&&flowType!=="chime"&&lastFlow!=="chime"){if(typeof(origEventTarget)!="undefined"&&origEventTarget.hasClass("sso-pass-thru")){log("fireOriginalEventOrReload() > Fire original event!",[origEventTarget,origEventType]);if(origEventTarget.is("a")){log("fireOriginalEventOrReload() > It was a link.");var href=origEventTarget.attr("href");if(href==="#"){window.location.reload(true);}else{window.location=origEventTarget.attr("href");}}else{log("fireOriginalEventOrReload() > It was another element type.");origEventTarget.trigger(origEventType);}}else{log("fireOriginalEventOrReload() > Reload.");var theurl=window.location.href;if(theurl.indexOf("avatarOrUpload=true")>0){var randomnum=(Math.random()*11);$(location).attr("href","/profile/private?"+randomnum);}else{window.location.reload(true);}}}if(flowType==="chime"){closeAfter(20);}flowSuccess=false;flowType="none";}function log(str,vars){if(typeof iVillage!="undefined"&&typeof iVillage.showLogs!="undefined"&&iVillage.showLogs){if(window.console&&window.console.log){var date=new Date();var hours=date.getHours().toString();var mins=date.getMinutes().toString();var secs=date.getSeconds().toString();var msecs=date.getMilliseconds().toString();hours=(hours.length===1)?"0"+hours:hours;mins=(mins.length===1)?"0"+mins:mins;secs=(secs.length===1)?"0"+secs:secs;msecs+=(msecs.length===1)?"    ":(msecs.length===2)?" ":"";str=hours+":"+mins+":"+secs+":"+msecs+" > SSO > "+str;if(vars){console.log(str,vars);}else{console.log(str);}}}}function filterLoginMessage(login){if(origEventTarget.hasClass("sso-comment")){var head=$("#sso-cbox-intro h3");var para=$("#sso-cbox-intro p");var headerMsg,paraMsg;headerMsg="Want to post a comment? You need to be an iVillage member";if(login){paraMsg='Sign in below or log in through Social Providers. New around here? <a href="#" class="sso-register">Join now!</a>';}else{paraMsg='Be inspired, get advice, and find support from women with shared experiences. You can create<br />your very own iVillage user account or sign in through Social Provider. Already a member? <a href="#" class="sso-log-in">Sign in.</a>';}head.html(headerMsg);para.html(paraMsg);$.fn.ssoColorbox.resize();}}function createPhotoUrl(id,h,w){return options.baseUrl+"photo/get?photo_id="+id+"&height="+h+"&width="+w;}function switchButtonToLoading(form){form.find("div.buttons").hide().after('<div class="ajax-load">Loading...</div>');}function switchGigyaToLoading(){$("#sso-cbox-loaded-content").find("div#"+options.loginUIParams.containerID).hide().after('<div class="ajax-load">Loading...</div>');$.fn.ssoColorbox.resize();}function switchLoadingToButton(form){form.find("div.buttons").show().next().remove();}function switchLoadingToGigya(){$("#sso-cbox-loaded-content").find("div#"+options.loginUIParams.containerID).show().next().remove();$.fn.ssoColorbox.resize();}function closeAfter(msecs){if(typeof msecs==="number"&&msecs>0){setTimeout($.fn.ssoColorbox.close,msecs);}else{var theurl=window.location.href;if(theurl.indexOf("avatarOrUpload=true")>0){var randomnum=(Math.random()*11);$(location).attr("href","/profile/private#?"+randomnum);
}else{$.fn.ssoColorbox.close();}}}function serializedArrayToObject(data){var finalData={};for(var i=0;i<data.length;i++){finalData[data[i].name]=data[i].value;}return finalData;}function displayErrors(list,data){log("displayErrors()",[list,data]);removeErrors(list);if(data.message.length>0){list.prepend('<li class="error">'+data.message+"</li>");}if(typeof data.errors==="object"){$.each(data.errors,function(key,value){log("data.errors",[key,value]);var input=list.find("#"+key);if(input.length>0){var label=$('<label class="error">'+errorArrow+value+"</label>");var inputId=input.attr("id");if(inputId){label.attr("for",inputId);}input.addClass("error").after(label);}});}}function displaySuccess(list,data){log("displaySuccess()",[list,data]);removeErrors(list);if(data.message.length){list.prepend('<li class="success">'+data.message+"</li>");}closeAfter(4000);}function removeErrors(list){log("removeErrors()",list);list.find("li.error, label.error").remove();list.find("input.error").removeClass("error");}function getToken(){log("getToken()");if(typeof(iVillage)!="undefined"&&typeof(iVillage.arw_token)!="undefined"){isAuthenticated=true;userId=parseInt(iVillage.arw_person_id,10);avatarId=parseInt(iVillage.arw_avatar_id,10);username=iVillage.arw_username;if(sessionToken.length>23){}else{sessionToken=iVillage.arw_token;}}if(!ssoReady){ssoReady=true;setTimeout(function(){log("getToken() > Firing the sso.ready event.");$(document).trigger("sso.ready");},1000);}}function establishSession(callback,callonerror){log("establishSession()");$.ajax({type:"POST",url:postPaths.establishSession,cache:false,data:{token:sessionToken},dataType:"json",error:ajaxError,success:function(data){log("establishSession() > Returned from server.",data);isAuthenticated=data.success;if(data&&data.success){sessionToken=data.token;iVillage.arw_token=sessionToken;if($.isFunction(callback)){callback();}}else{if(data&&!data.success){if($.isFunction(callonerror)){callonerror(data);}}}}});}function requestHTML(which,complete){var url_params="?flow_type="+flowType+"&vertical="+options.vertical;var light_box_title="Welcome to iVillage!";if(flowType=="ugc-upload"){if(typeof(ugc_data)!="undefined"){if(typeof(ugc_data.lightbox_title)!="undefined"&&ugc_data.lightbox_title!=""){light_box_title=ugc_data.lightbox_title;}else{if(typeof(ugc_data.media_used)!="undefined"){light_box_title="Upload Your "+ugc_data.media_used;}else{light_box_title="Upload Your File";}}}else{light_box_title="Upload Your File";}}if(options.proxyUrl){url_params=escape(url_params);}log("requestHTML()",which,url_params);if(typeof getPaths[which]==="string"){$.ajax({type:"GET",url:getPaths[which]+url_params,cache:false,dataType:"html",error:ajaxError,success:function(data){if(data){$.fn.ssoColorbox({title:light_box_title,html:data,scrolling:false,onComplete:complete,overlayClose:false});}}});}}function formProcessor(e){log("submit");log("formProcessor()");e.preventDefault();var form=$(e.target);var id=form.attr("id");var name=form.attr("name");var submitData=form.serialize();switch(id){case"sso-sign-in":case"sso-ask-for-password":if(name==="forgot-password"){userForgotPassword(form,submitData);}else{userSignIn(form,submitData);}break;case"sso-register":flowType="register";userRegister(form,submitData);break;case"sso-gigya-register":if(flowType!="chime"){flowType="register";}userRegister(form,submitData,true);break;case"sso-link-existing-fb-user":userUpdateFBProfile(form,submitData);break;case"sso-newsletters":submitData=form.serializeArray();newsletterSignups(form,submitData);break;case"sso-chime-in":submitData=serializedArrayToObject(form.serializeArray());log("formProcessor() > sso-chime-in",submitData);if(submitData.sso_email_username&&submitData.sso_password){userSignIn(form,submitData);}else{guestChimeIn(form,submitData);}break;case"sso-upload":photoEdit(form);break;case"sso-social-get-email":submitSocialEmail(form,submitData);break;}}function userSignIn(form,submitData){log("userSignIn()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.login,cache:false,data:submitData,dataType:"json",success:function(data){log("userSignIn() > Returned from server.",data);isAuthenticated=data.success;if(data&&data.success){if(flowType==="login"){iVillage.omniEvent(null,27,"Succesfully finish sign-in.");}userId=parseInt(data.person_id,10);avatarId=parseInt(data.photo_id,10);username=data.username;sessionToken=data.token;if(flowType==="login"||flowType==="register"){flowSuccess=true;closeAfter(0);}else{if(flowType==="chime"){flowSuccess=true;closeAfter(0);triggerChimeEvent({type:"member",dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{if(flowType==="avatar"){steps.avatarOrUpload();}else{if(flowType==="newsletters"){steps.newslettersByVertical();}else{if(flowType==="linkingAccounts"){steps.finalizeLinking(data);}}}}}}else{if(flowType==="linkingAccounts"){displayErrors(form.find("fieldset.sso-ask-for-password > ol"),data);}else{displayErrors(form.find("fieldset.sso-sign-in > ol"),data);}omnitureSignInErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}},error:function(){displayErrors(form.find("fieldset.sso-sign-in > ol"),{message:"We're sorry, but we were unable to log you in at this time. Please try again later."});omnitureSignInErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}});}function userForgotPassword(form,submitData){log("userForgotPassword()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.forgotPassword,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){log("userForgotPassword() > Returned from server.",data);if(data&&data.success){displaySuccess(form.find("fieldset.sso-sign-in > ol"),data);}else{displayErrors(form.find("fieldset.sso-sign-in > ol"),data);}switchLoadingToButton(form);}});}function userRegister(form,submitData,is_gigya){log("userRegister()",[form,submitData]);switchButtonToLoading(form);var register_path=postPaths.register;if(typeof(is_gigya)!="undefined"&&is_gigya){log("userRegister() via gigya");register_path=postPaths.gigyaRegister;}$.ajax({type:"POST",url:register_path,cache:false,data:submitData,dataType:"json",success:function(data){log("userRegister() > Returned from server.",data);isAuthenticated=data.success;flowSuccess=data.success;if(data&&data.success){userId=parseInt(data.person_id,10);username=data.username;sessionToken=data.token;var daily=$("#sso_daily_newsletter");var offer=$("#sso_offers_promotions");if(daily.length||offer.length){regNlid=[];if(daily.is(":checked")){regNlid.push(6);}if(offer.is(":checked")){regNlid.push(68);}}if(flowType==="chime"||lastFlow=="chime"){flowSuccess=true;closeAfter(0);triggerChimeEvent({type:"member",dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{steps.newslettersByVertical();}}else{displayErrors(form.find("fieldset > ol"),data);omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}},error:function(){displayErrors(form.find("fieldset.sso-sign-in > ol"),{message:"We're sorry, but we were unable to create your account at this time. Please try again later."});omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}});}function userUpdateFBProfile(form,submitData){log("userUpdateFBProfile()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.userUpdateFBProfile,cache:false,data:submitData,dataType:"json",success:function(data){log("userUpdateFBProfile() > Returned from server.",data);isAuthenticated=data.success;flowSuccess=data.success;if(data&&data.success){userId=parseInt(data.person_id,10);username=data.username;sessionToken=data.token;flowSuccess=true;closeAfter(0);if(flowType==="chime"||lastFlow=="chime"){triggerChimeEvent({type:"member"});}}else{displayErrors(form.find("fieldset > ol"),data);omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}},error:function(){displayErrors(form.find("fieldset.sso-sign-in > ol"),{message:"We're sorry, but we were unable to update your account at this time. Please try again later."});omnitureRegistrationErrors();switchLoadingToButton(form);$.fn.ssoColorbox.resize();}});}function guestChimeIn(form,submitData){var errorData={};log("guestChimeIn()",[form,submitData]);switchButtonToLoading(form);if(submitData.sso_guest_email&&submitData.sso_guest_name){log("guestChimeIn() > Guest chime success!");closeAfter(0);triggerChimeEvent({type:submitData.sso_anonymous==="on"?"anon":"guest",guestName:submitData.sso_guest_name,guestEmail:submitData.sso_guest_email,dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{errorData.message="If you choose not to log in, you must enter your name and email.";if(submitData.sso_anonymous){errorData.message+=" Although we won't display this information, it's still required.";}displayErrors(form.find("fieldset.chime-guest > ol"),errorData);switchLoadingToButton(form);$.fn.ssoColorbox.resize();}}function submitSocialEmail(form,submitData){log("submitSocialEmail()",[form,submitData]);switchButtonToLoading(form);$.ajax({type:"POST",url:postPaths.socialEmail,cache:false,data:submitData,error:ajaxError,dataType:"json",success:function(data){if(data&&data.valid){if(flowType=="emailLookup"){if(data.new_registration){steps.registerNewUser(userSocialData,data.new_email_id);}else{steps.askForPassword(userSocialData,data);}}else{if(flowType==="avatar"){steps.avatarOrUpload();}else{steps.newslettersByVertical();}}}else{displayErrors(form.find("ol"),{message:"Please provide a valid email address."});switchLoadingToButton(form);$.fn.ssoColorbox.resize();}}});}function triggerChimeEvent(extras){log("triggerChimeEvent() > sso."+chimeType,extras);$(document).trigger("sso."+chimeType,extras);}function newsletterSignups(form,submitData){log("newsletterSignups()",[form,submitData]);switchButtonToLoading(form);var buttons=$("#sso-newsletters div.buttons");var nothanks=buttons.find("a.btn-no-thanks");
nothanks.hide();var error=false;var required=form.find("input.start-date-required");if(required.length){required.each(function(){var that,nl_id,li;if(error){return false;}that=$(this);nl_id=that.attr("id").replace("nl_","");if(that.is(":checked")){li=that.parent("li");nl_id=that.attr("id");li.find("select").each(function(){if($(this).val()==="default"){li.append('<label for="'+nl_id+'" generated="true" class="error"><span class="error-arrow"></span>Please provide a date</label>');switchLoadingToButton(form);nothanks.show();error=true;return false;}});}});}if(!error){submitData=prepareNewsletterData(submitData);log("newsletterSignups() > Final data.",submitData);$.ajax({type:"POST",url:postPaths.newsletterSignUp,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){if(data&&data.success){omnitureNewsletterEvent(submitData.newsletters,submitData.startDates);if(flowType==="chime"||lastFlow=="chime"){flowSuccess=true;closeAfter(0);triggerChimeEvent({type:"member",dailyNews:submitData.sso_daily_newsletter==="on"?true:false});}else{steps.thanks();}}else{switchLoadingToButton(form);nothanks.show();var nl_id=form.find('li:eq(0) input[type="checkbox"]').attr("id");buttons.append('<label for="'+nl_id+'" class="error" generated="true"><span class="error-arrow"></span>'+data.message+"</label>");error=true;return;}}});}}function prepareNewsletterData(data){var finalData={startDates:{},newsletters:[],funnelid:"",email:"",sourceid:0,verticalid:0};log("prepareNewsletterData()",data);$.each(data,function(i,item){var type=item.name.split("_")[0];var id=item.name.split("_")[1];if(type==="nl"){finalData.newsletters.push(item.value);}else{if(type==="email"){finalData.email=item.value;}else{if(type==="funnelid"){finalData.funnelid=item.value;}else{if(type==="sourceid"){finalData.sourceid=item.value;}else{if(type==="verticalid"){finalData.verticalid=item.value;}else{if(item.value!=="default"){finalData.startDates[id]=finalData.startDates[id]||{};finalData.startDates[id][type]=item.value;}}}}}}});return finalData;}function omnitureNewsletterEvent(newsletters,startDates){var omniIds=[];for(var i=0;i<newsletters.length;i++){var nlid=newsletters[i]*1;if(typeof(startDates[nlid])!=="undefined"&&typeof(startDates[nlid]["omni"])!=="undefined"){omniIds.push(startDates[nlid]["omni"]);}}iVillage.omniEvent(31,24,"Newsletter registration.",null,omniIds);}function avatarTelescope(e){var that=$(this);if(e.type==="mouseover"){that.data("over",true);setTimeout(function(){if(that.data("over")){avatarOverlayReveal(that);}},750);}else{that.data("over",false);}}function avatarOverlayReveal(that){var offset=that.offset();var outerWidth=that.outerWidth(true);var listOffset=that.parent().offset();var link=that.children("a");var photoId=parseInt(link.attr("rel"),10);var thumb=link.children("img");var bigLink=avatarOverlay.children("a");var bigThumb=new Image();var overlayCss={display:"block",top:offset.top-4,left:offset.left-4,opacity:0.5};bigLink.attr("name",":iv:registration:avatar-select");avatarOverlay.data("callerSize",outerWidth).data("alignLeft",true);if(outerWidth>60&&(offset.left-listOffset.left>268)){avatarOverlay.data("alignLeft",false);overlayCss.left-=154-outerWidth;}bigLink.empty();bigThumb.src=createPhotoUrl(photoId,150,150);bigThumb.onload=function(){bigLink.html(bigThumb);avatarOverlay.css("opacity",1);$(bigThumb).fadeIn("fast");};bigLink.attr("rel",photoId);avatarOverlay.css(overlayCss);}function avatarOverlayCheckPosition(e){var callerSize=avatarOverlay.data("callerSize");var outerWidth=avatarOverlay.outerWidth(true);var offset=avatarOverlay.offset();if(avatarOverlay.data("alignLeft")){if(e.pageX-offset.left>callerSize){avatarOverlayCleanup();}}else{if(offset.left+outerWidth-e.pageX>callerSize){avatarOverlayCleanup();}}if(e.pageY-offset.top>callerSize){avatarOverlayCleanup();}}function avatarOverlayCleanup(){avatarOverlay.hide().data("callerSize",0).data("alignLeft",true).data("over",false);avatarOverlay.children("a").empty();}function rotatePhoto(direction){log("rotatePhoto()",direction);var container=$("#sso-jcrop-container");var photoId=uploadPhotoId;var postData={photo_id:photoId,clockwise:direction};if(photoId){establishSession(function(){container.find("#sso-jcrop-target-img").remove();container.children().hide();container.find(".ajax-load").show();$.fn.ssoColorbox.resize();$.ajax({type:"POST",url:postPaths.rotatePhoto,cache:false,data:postData,dataType:"json",error:ajaxError,success:function(data){if(data&&data.success){if(flowType=="ugc-upload"){cleanUploadButtonForUploadify("sso-upload");}completeUploads=0;finalizePhotoUpload("/photo/get?photo_id="+photoId);}}});});}}function rotateClockwise(){rotatePhoto(1);}function rotateCounterClockwise(){rotatePhoto(0);}function deletePhoto(){log("deletePhoto()");establishSession(function(){if(uploadPhotoId!==0){$.ajax({type:"POST",url:postPaths.deletePhoto,cache:false,data:{photo_ids:{"0":uploadPhotoId}}});}if(flowType==="avatar"){steps.avatarOrUpload();}getToken();});}function finalizePhotoUpload(image_path){log("finalizePhotoUpload()",image_path);completeUploads++;if(completeUploads>1){log("finalizePhotoUpload() > completeUploads",completeUploads);return false;}$("#sso-cbox-close, a.btn-cancel").bind("click",deletePhoto);var container=$("#sso-jcrop-container");var cancel=$("#sso-upload a.btn-cancel");var controls=container.find("#sso-pic-controls");var loader=container.find(".ajax-load");var image=new Image();container.show();if(loader.length){loader.show();}else{controls.before('<div class="ajax-load"></div>');loader=container.find(".ajax-load");}$("#sso-jcrop-after").show();var stamp=new Date().getTime();image_path=options.baseUrl.replace(/\/$/,"")+image_path+"&"+stamp;log(image_path);$.fn.ssoColorbox.resize();image.id="sso-jcrop-target-img";image.onload=function(){var register=(flowType==="avatar"||flowType==="register");var cropHeight=register?160:image.height*0.95;var cropWidth=register?160:image.width*0.95;cancel.removeClass("btn-hide");$("#sso-cbox-close").show();loader.hide();controls.before(image).show();container.find("#sso-pic-controls").show();$.fn.ssoColorbox.resize();$("#sso-photo-details").fadeIn();cropApi=$.Jcrop("#sso-jcrop-target-img",{boxWidth:400,boxHeight:600,aspectRatio:register?1:"",setSelect:[10,10,cropWidth,cropHeight],allowSelect:false});if(flowType==="ugc-upload"){$("#sso-submit-ugc .sso-control-ugc").children().show();}else{$("#sso-submit-photo").children().show();}if(flowType==="insert-photo"){$("#sso-submit-photo #sso-upload-another").hide();}};image.src=image_path;return true;}function embedPhotoToTextarea(photo_id){var textarea=origEventTarget.parent().siblings("textarea");var string='<p><img src="/photo/get?photo_id='+photo_id+'" alt="" /></p>';if(window.tinyMCE){textarea.tinymce().execCommand("mceInsertContent",false,string);}else{textarea.append(string);}}function photoEdit(form){log("photoEdit()",form);if(flowType==="ugc-upload"){if(options.submitUGCForm&&$("#sso-upload-ugc").css("display")=="none"){steps.create_ugc_slide(form);return;}}var cropCoords=cropApi.tellSelect();var submitData={photo_id:uploadPhotoId,height:cropCoords.h,width:cropCoords.w,top:cropCoords.y,left:cropCoords.x,title:null,description:null};if(flowType!=="avatar"&&flowType!=="register"){submitData.title=$("input#sso_title").val();var subDesc=$("textarea#sso_description").val();subDesc=(subDesc.length>140)?subDesc.substring(0,140):subDesc;submitData.description=subDesc;}if(flowType=="ugc-upload"){submitData.privacy="hidden";}switchButtonToLoading(form);establishSession(function(){$.ajax({type:"POST",url:postPaths.cropAvatar,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){log("photoEdit() > Returned from server.",data);if(flowType==="avatar"||flowType==="register"){flowSuccess=true;setAvatar(uploadPhotoId,steps.thanks);}else{if(flowType==="insert-photo"){embedPhotoToTextarea(uploadPhotoId);closeAfter(0);}else{if(flowType==="ugc-upload"){switchLoadingToButton(form);steps.toggel_ugc_upload_form("preview",form);}else{if($("input#sso-upload-more").val()=="1"){steps.uploadPhoto();}else{closeAfter(0);window.location.reload(true);}}}}}});});}function setAvatar(id,callback){log("setAvatar()",[id,callback]);$.ajax({type:"POST",url:postPaths.setAvatar,cache:false,data:{photo_id:id},dataType:"json",error:ajaxError,success:function(data){log("setAvatar() > Returned from server.",data);if(data&&data.success){avatarId=parseInt(data.photo_id,10);if($.isFunction(callback)){callback();}}}});}function cloneBirthdayRow(e){log("cloneBirthdayRow()");e.preventDefault();var list=$("#sso-children > fieldset.child > ol");var items=list.children("li");var btnRow=list.children("li:last");var newLi=btnRow.prev().clone();newLi.children("select").each(function(){var that=$(this);var id=that.attr("id");var idArr=id.split("-");var name=that.attr("name");var nameArr=name.split("-");idArr[idArr.length-1]=items.length;that.attr("id",idArr.join("-"));nameArr[nameArr.length-1]=items.length;that.attr("name",nameArr.join("-"));});btnRow.before(newLi);$.fn.ssoColorbox.resize();}function prepareDates(data){log("prepareDates()",data);var finalData={birthdays:[],due_date:{}};$.each(data,function(itemIndex,item){var nameArr=item.name.replace("sso_","").split("_");var obj={};var index;if(nameArr[0]==="due"){finalData.due_date[nameArr[1]]=item.value;}else{if(nameArr[0]==="bday"){index=parseInt(nameArr[2],10)-1;if(finalData.birthdays[index]){finalData.birthdays[index][nameArr[1]]=item.value;}else{obj[nameArr[1]]=item.value;finalData.birthdays.push(obj);}}}});return finalData;}function sendDates(callback){log("sendDates()");var submitData=prepareDates($("#sso-children").serializeArray());$.ajax({type:"POST",url:postPaths.setChildren,cache:false,data:submitData,dataType:"json",error:ajaxError,success:function(data){log("sendDates() > Returned from server.",data);if(data&&data.success){if($.isFunction(callback)){callback();}}}});}function omnitureRegistrationErrors(){var form=$("#sso-register");
var errors=form.find("label.error");var propCodes=[];var errorMap={sso_email:3,sso_username:4,sso_dob_year:8,sso_dob_day:9,sso_dob_month:10,sso_country_id:11,sso_zip_code:12,sso_terms:13};errors.each(function(){if($(this).is(":visible")){var labelFor=$(this).attr("for");if(errorMap[labelFor]!=="undefined"&&errorMap[labelFor]){propCodes.push(errorMap[labelFor]);}else{if(labelFor==="sso_password"){var val=$("#sso_password").val();if(val.length===0){propCodes.push(5);}else{if(val.length<4){propCodes.push(6);}}}else{if(labelFor==="sso_confirm_password"){var val=$("#sso_password").val();if(val.length>0){propCodes.push(7);}}}}}});iVillage.omniEvent(32,21,"Registration Error",null,propCodes);}function omnitureGigyaRegistrationErrors(){var form=$("#sso-gigya-register");var errors=form.find("label.error");var propCodes=[];var errorMap={sso_email:3,sso_username:4,sso_dob_year:8,sso_dob_day:9,sso_dob_month:10,sso_country_id:11,sso_zip_code:12,sso_terms:13};errors.each(function(){if($(this).is(":visible")){var labelFor=$(this).attr("for");if(errorMap[labelFor]!=="undefined"&&errorMap[labelFor]){propCodes.push(errorMap[labelFor]);}else{if(labelFor==="sso_password"){var val=$("#sso_password2").val();if(val.length===0){propCodes.push(5);}else{if(val.length<4){propCodes.push(6);}}}else{if(labelFor==="sso_confirm_password"){var val=$("#sso_password2").val();if(val.length>0){propCodes.push(7);}}}}}});iVillage.omniEvent(32,21,"Gigya Registration Error",null,propCodes);}function omnitureSignInErrors(gigyalogin){var form=$("#sso-sign-in");var errors=form.find("label.error");var propCodes=[];if(typeof gigyalogin!=="undefined"&&gigyalogin===true){propCodes.push(27);}var errorMap={sso_password:2};if(form.find("fieldset ol li:eq(0)").hasClass("error")){propCodes.push(1);}errors.each(function(){var labelFor=$(this).attr("for");if(errorMap[labelFor]!=="undefined"&&errorMap[labelFor]){propCodes.push(errorMap[labelFor]);}});iVillage.omniEvent(32,26,"Sign-in Error",null,propCodes);}function customOmniEvent(prop,events,message){var verticalMsg=null;var vertical=iVillage.siteName;if(vertical.length&&typeof vertical==="string"){vertical=vertical.toLowerCase();switch(events){case 20:verticalMsg="joinnow_";break;case 25:if(message.indexOf("gigyaconnect")!==-1){verticalMsg="gigyasignin_";}else{verticalMsg="signin_";}if(flowType==="forgot-password"){vertical="forgotpassword";}break;}verticalMsg=verticalMsg+vertical;}log("Firing Omniture Event");iVillage.omniEvent(prop,events,message,verticalMsg);}function fillAccountLinkForm(eventObj){$("#sso-ask-for-password").find('input[name="link_accounts"]').val("1");$("#sso-ask-for-password").find('input[name="uid"]').val(eventObj.UID);$("#sso-ask-for-password").find('input[name="provider"]').val(eventObj.provider);if(typeof(eventObj.user.firstName)!="undefined"){$("#sso-ask-for-password").find('input[name="first_name"]').val(eventObj.user.firstName);}if(typeof(eventObj.user.lastName)!="undefined"){$("#sso-ask-for-password").find('input[name="last_name"]').val(eventObj.user.lastName);}if(typeof(eventObj.user.gender)!="undefined"){$("#sso-ask-for-password").find('input[name="gender"]').val(eventObj.user.gender);}if(typeof(eventObj.user.birthYear)!="undefined"){$("#sso-ask-for-password").find('input[name="birthYear"]').val(eventObj.user.birthYear);}if(typeof(eventObj.user.birthMonth)!="undefined"){$("#sso-ask-for-password").find('input[name="birthMonth"]').val(eventObj.user.birthMonth);}if(typeof(eventObj.user.birthDay)!="undefined"){$("#sso-ask-for-password").find('input[name="birthDay"]').val(eventObj.user.birthDay);}$.fn.ssoColorbox.resize();return true;}function fillUserInfoHeader(eventObj,user_info_container,custom_message){var user_information="";if(typeof(eventObj.user.thumbnailURL)!="undefined"&&eventObj.user.thumbnailURL!=""){user_information+='<img src="'+eventObj.user.thumbnailURL+'" alt="User Thumbnail" />';}user_information+=" Welcome";if(typeof(eventObj.user.firstName)!="undefined"&&eventObj.user.firstName!=""){user_information+=", "+eventObj.user.firstName;}else{if(typeof(eventObj.user.email)!="undefined"&&eventObj.user.email!=""){user_information+=", "+eventObj.user.firstName;}}user_information+="! "+custom_message;$("."+user_info_container+" .user-information").html(user_information);$.fn.ssoColorbox.resize();return true;}function fillGigyaRegisterForm(eventObj,user_email){$("#sso-gigya-register").find('input[name="uid"]').val(eventObj.UID);$("#sso-gigya-register").find('input[name="provider"]').val(eventObj.provider);if(typeof(user_email)!="undefined"&&user_email!=""){$("#sso-gigya-register").find('input[name="sso_email"]').val(user_email).parents("li").hide();}else{if(typeof(eventObj.user.email)!="undefined"&&eventObj.user.email!=""){$("#sso-gigya-register").find('input[name="sso_email"]').val(eventObj.user.email).parents("li").hide();user_email=eventObj.user.email;}}if(typeof(eventObj.user.gender)!="undefined"&&eventObj.user.gender!=""){$("#sso-gigya-register").find('[name="sso_gender"]').val(eventObj.user.gender).parents("li").hide();}if(typeof(eventObj.user.birthYear)!="undefined"&&typeof(eventObj.user.birthMonth)!="undefined"&&typeof(eventObj.user.birthDay)!="undefined"&&eventObj.user.birthYear!=""&&eventObj.user.birthMonth!=""&&eventObj.user.birthDay!=""){$("#sso-gigya-register").find('[name="sso_dob_year"]').val(eventObj.user.birthYear);$("#sso-gigya-register").find('[name="sso_dob_month"]').val(eventObj.user.birthMonth);$("#sso-gigya-register").find('[name="sso_dob_day"]').val(eventObj.user.birthDay).parents("li").hide();}if(typeof(eventObj.user.zip)!="undefined"&&eventObj.user.zip!=""){$("#sso-gigya-register").find('input[name="sso_zip_code"]').val(eventObj.user.zip);}var theUsername="";if(typeof(eventObj.user.nickname)!="undefined"){theUsername=eventObj.user.nickname;}if(theUsername==""&&(typeof(eventObj.user.firstName)!="undefined"||typeof(eventObj.user.lastName)!="undefined")){theUsername=typeof(eventObj.user.firstName)!="undefined"?eventObj.user.firstName:"";theUsername=(typeof(eventObj.user.lastName)!="undefined"&&theUsername.length>0)?theUsername.concat(".",eventObj.user.lastName):theUsername;}if(theUsername==""&&typeof(user_email)!="undefined"&&user_email!=""){theUsername=user_email.split("@");theUsername=theUsername[0];}$("#sso-gigya-register").find('input[name="sso_username"]').val(theUsername.toLowerCase());$.fn.ssoColorbox.resize();return true;}function fillFBAccountLinkForm(eventObj){$("#sso-link-existing-fb-user").find('input[name="uid"]').val(eventObj.UID);$("#sso-link-existing-fb-user").find('input[name="provider"]').val(eventObj.provider);if(typeof(eventObj.user.gender)!="undefined"&&eventObj.user.gender!=""){$("#sso-link-existing-fb-user").find('[name="sso_gender"]').val(eventObj.user.gender).parents("li").hide();}if(typeof(eventObj.user.birthYear)!="undefined"&&typeof(eventObj.user.birthMonth)!="undefined"&&typeof(eventObj.user.birthDay)!="undefined"&&eventObj.user.birthYear!=""&&eventObj.user.birthMonth!=""&&eventObj.user.birthDay!=""){$("#sso-link-existing-fb-user").find('[name="sso_dob_year"]').val(eventObj.user.birthYear);$("#sso-link-existing-fb-user").find('[name="sso_dob_month"]').val(eventObj.user.birthMonth);$("#sso-link-existing-fb-user").find('[name="sso_dob_day"]').val(eventObj.user.birthDay).parents("li").hide();}if(typeof(eventObj.user.zip)!="undefined"&&eventObj.user.zip!=""){$("#sso-link-existing-fb-user").find('input[name="sso_zip_code"]').val(eventObj.user.zip);}$.fn.ssoColorbox.resize();return true;}function displayHiddenFields(container,element){var need_resize=false;log("displayHiddenFields()");$(container).find(element).each(function(){if($(this).css("display")=="none"){$(this).show("fast","linear");$.fn.ssoColorbox.resize();need_resize=true;}else{if($(this).hasClass("hide")){$(this).css("display","none").removeClass("hide").show("fast","linear");$.fn.ssoColorbox.resize();need_resize=true;}}});return need_resize;}function showGigyaError(eventObj,container){var errorMessage="";if(eventObj.errorCode!=0){switch(eventObj.errorCode){case"100001":case"500001":case"500002":errorMessage="Seems like server is busy at the moment. Please try again after some time.";break;case"200001":errorMessage="Login process canceled. Please try again.";break;case"200003":errorMessage="Please try again and grant social network permission.";break;case"400001":case"400002":case"400004":case"400006":case"400008":case"400011":case"400012":case"400013":case"400014":case"400015":errorMessage="Invalid Request. Please try again.";break;case"400050":errorMessage="Invalid user data returned. Please try again after some time.";break;case"400122":case"500023":errorMessage="There is some issue with the social provider you are trying to connect to. Please try login with different provider or try again after some time.";break;case"403001":case"403002":case"403009":case"403011":case"403012":case"403030":case"500014":case"500024":errorMessage="Session Expired. Please login again.";break;case"403007":errorMessage="Permission Denied. Please try again after some time.";break;case"500026":errorMessage="Network connection issue. Please try again.";break;case"504001":errorMessage="Connection timeout. Please try again.";break;case"500032":errorMessage="Unalbe to load gigya service at the moment. Please try again after some time.";break;default:errorMessage=eventObj.errorMessage;}if($("#sso-cbox span.error").length){$("#sso-cbox span.error").remove();}$("#"+container).html('<span class="error">'+errorMessage+"</span>"+$("#"+container).html());}}function editedConnection(eventObj){$.ajax({type:"POST",url:postPaths.editedConnection,cache:false,data:eventObj,dataType:"json",error:ajaxError,success:function(data){log("editedConnection() > Returned from server.",data);}});}function updateUGCLayover(containerID){var container_object=$("#"+containerID);log("updateUGCLayover()",container_object);if(container_object.length&&typeof(ugc_data)!="undefined"){if(typeof(ugc_data.caption_upload_box)!="undefined"&&ugc_data.caption_upload_box!=""){container_object.find(".ugc_location").html(ugc_data.caption_upload_box);
}else{container_object.find(".ugc_location").html(ugc_data.media_used+" Location");}container_object.find(".upload_help_text").html(ugc_data.upload_help_text);if(typeof(ugc_data.additional_fields)!="undefined"){for(var key in ugc_data.additional_fields){$("label."+key).html(ugc_data.additional_fields[key]);$("input#"+key);$("input#"+key).parent().show();}}$(".sso_ugc_title").html(ugc_data.caption_image_title);$(".sso_ugc_description").html(ugc_data.caption_image_description);var category_select_boxes="";if(typeof(ugc_data.ugc_categories)!="undefined"){for(var key in ugc_data.ugc_categories){category_select_boxes+='<div style="float: left;"><input type="radio" id="ugc_category_'+key+'" name="ugc_categories" value="'+key+'" /> <label for="ugc_category_'+key+'">'+ugc_data.ugc_categories[key]+"</label></div>";}$(".ugc_categorization").show();$("#ugc_categorization_group").html(category_select_boxes);}if(typeof(ugc_data.terms_conditions)!="undefined"){$(".additional_optin").html('<ol><li><input type="checkbox" id="additional_optin" name="additional_optin" value="additional_optin" /> <label class="additional_option_label" for="additional_optin">'+ugc_data.terms_conditions+"</label></li></ol>");}}}function bind_uploadify_for_ugc_photo(container_id,post_path,size_limit,file_extension,file_desc){var cancel=$("#sso-submit-ugc a.btn-cancel.sso-close");$("#"+container_id+" input[type='file']").unbind().uploadify({uploader:uploadSwf,width:65,height:25,script:post_path,fileDataName:"photo",sizeLimit:size_limit,scriptData:{token:sessionToken},cancelImg:options.baseUrl+"public/sso/images/cancel.png",buttonImg:options.baseUrl+"public/sso/images/btn-browse-for-flash.png",auto:true,fileExt:file_extension,fileDesc:file_desc,onSelect:function(event,queueID,fileObj){cancel.addClass("btn-hide");$("#sso-cbox-close").hide();},onError:function(a,b,c,d){log("Uploadify error: ",[a,b,c,d]);showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please try again later.");cancel.removeClass("btn-hide");$("#sso-cbox-close").show();},onComplete:function(event,queueID,fileObj,response){log("uploadify > onComplete()",response);establishSession(function(){response=$.parseJSON(response);uploadPhotoId=response.photo_id;$("#sso_ugc_id").val(uploadPhotoId);if(flowType=="ugc-upload"){cleanUploadButtonForUploadify(container_id);}finalizePhotoUpload(response.url,event,queueID,fileObj,response);},function(data){if(typeof(data)!="undefined"&&typeof(data.message)!="undefined"){if(data.message.indexOf("Token")!=-1&&data.message.indexOf("not valid")!=-1){showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please logout and login again.");}else{showUGCUploadError("Sorry, we are unable to accept your submission at this time due to technical issues. Please try again later.");}cancel.removeClass("btn-hide");$("#sso-cbox-close").show();}});},onAllComplete:function(){log("uploadify > onAllComplete()");completeUploads=0;}});}function cleanUploadButtonForUploadify(container_id){if(!$.browser.msie){var input_box_id=$("#"+container_id+" input[type='file']").attr("id");var flash_var_to_update=$("#"+input_box_id+"Uploader param[name=flashvars]").attr("value");var dummy_param_array=flash_var_to_update.split("&");for(var count=0;count<dummy_param_array.length;count++){if(dummy_param_array[count].indexOf("scriptData")!=-1){dummy_param_array[count]="scriptData=token%3D"+sessionToken;}}$("#"+input_box_id+"Uploader param[name=flashvars]").attr("value",dummy_param_array.join("&"));var input_box_id=$("#"+container_id+" #sso-jcrop-container #sso-pic-controls").siblings().each(function(){$(this).remove();});}return;}function showUGCUploadError(ugc_error_detail){hideUGCUploadError();if(typeof(ugc_error_detail)=="undefined"){return;}$("#ugc-upload-errors").html("<p>"+ugc_error_detail+"</p>").show();$.fn.ssoColorbox.resize();}function hideUGCUploadError(){$("#ugc-upload-errors").html("").hide();$.fn.ssoColorbox.resize();}function initiateCountDown(container_id,settings,to){settings=jQuery.extend({startFontSize:"36px",endFontSize:"24px",duration:1000,startNumber:10,endNumber:0,callBack:function(){}},settings);if(!to&&to!=settings.endNumber){to=settings.startNumber;}container_id.text(to).css("fontSize",settings.startFontSize);container_id.animate({fontSize:settings.endFontSize},settings.duration,"",function(){if(container_id.parent().css("display")!="none"){if(to>settings.endNumber+1){container_id.css("fontSize",settings.startFontSize).text(to-1);initiateCountDown(container_id,settings,to-1);}else{settings.callBack();}}});}return{login:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="login";steps.login();}},gigyaLogin:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="gigyaLogin";steps.gigyaLogin();}},registerNewUser:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="gigyaRegister";steps.registerNewUser();}},askForEmail:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="emailLookup";steps.askForEmail();}},askForPassword:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="linkingAccounts";steps.askForPassword();}},linkExistingFBUser:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="linkingAccounts";steps.linkExistingFBUser();}},finalizeLinking:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();steps.finalizeLinking();}},forgotPassword:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="forgot-password";steps.forgotPassword();}},logout:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="logout";steps.logout();},register:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="register";steps.register();}},chime:function(e){e.preventDefault();origEventType=e.type;origEventTarget=$(e.target);chimeType=e.target.className.indexOf("twist")===-1?"chime":"twist";if(!isAuthenticated){flowType="chime";steps.chime();}else{triggerChimeEvent({type:"member"});}},newsletters:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="newsletters";steps.newslettersByVertical();},newsletters_nudge:function(){newsletterOverride=true;this.newsletters(jQuery.Event("click"));},avatar:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="avatar";steps.avatarOrUpload(origEventTarget);},photo:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="photo";steps.uploadPhoto(origEventTarget);},insertPhoto:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="insert-photo";steps.insertOrUploadPhoto(origEventTarget);},save:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();if(!isAuthenticated){e.preventDefault();flowType="login";steps.login();}else{flowType="save";saveURL=origEventTarget.attr("href");steps.addSave(origEventTarget);}},deleteSave:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="delete-save";saveURL=origEventTarget.attr("href");saveId=origEventTarget.attr("rel");steps.deleteSave(origEventTarget);},editSave:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="edit-save";steps.editSave(origEventTarget);saveId=origEventTarget.attr("rel");},insertSave:function(e){origEventType=e.type;origEventTarget=$(e.target);e.preventDefault();flowType="insert-save";steps.insertSave(origEventTarget);},completeRegistration:function(){},isSsoReady:function(){return ssoReady;},isLoggedIn:function(){return isAuthenticated;},getUserId:function(){return isAuthenticated?userId:0;},getAvatarId:function(){return isAuthenticated?avatarId:0;},getUsername:function(){return isAuthenticated?username:"";},loadAddConnectionUI:function(attemptCount){if(typeof attemptCount=="undefined"){attemptCount=0;}log("Attempt Count for loadAddConnectionUI: "+attemptCount);if(typeof(gigya)!="undefined"&&!options.addConnectionsUILoaded){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if($("#mod-social-connections").length>0){gigya.services.socialize.getUserInfo($.extend({APIKey:iVillage.gigya_api_key},options.gigyaConfig,{callback:function(response){var connectedProviders=response.user.identities;for(key in connectedProviders){$("#mod-social-connections .body ."+key).addClass("connected");$("#mod-social-connections .body ."+key+" .icon").empty().append($("<img />").attr("src","/public/images/icons/social/"+key+"_20_connected.png"));$("#mod-social-connections .body ."+key+" .connection").empty().html("Disconnect");}$("#mod-social-connections .body .provider-list").removeClass("processing");}}));$("#mod-social-connections .body .provider .icon").live("click",function(){var that=$(this);if(!that.parents(".provider").hasClass("connected")&&!that.parents(".provider-list").hasClass("processing")){var providerToCall=that.parents(".provider").find(".connection").attr("rel");gigya.services.socialize.addConnection({APIKey:iVillage.gigya_api_key,provider:providerToCall,callback:function(response){if(response.errorCode==0){that.parents(".provider").addClass("connected");that.empty().append($("<img />").attr("src","/public/images/icons/social/"+providerToCall+"_20_connected.png"));that.parents(".provider").find(".connection").empty().html("Disconnect");}}});}});$("#mod-social-connections .body .provider .connection").live("click",function(){var that=$(this);if(that.parents(".provider").hasClass("connected")&&!that.hasClass("processing")&&!that.parents(".provider-list").hasClass("processing")){that.addClass("processing").empty().html("Processing...");
var providerToCall=that.attr("rel");gigya.services.socialize.removeConnection({APIKey:iVillage.gigya_api_key,provider:providerToCall,callback:function(response){if(response.errorCode==0){that.parents(".provider").removeClass("connected");that.parents(".provider").find(".icon").empty();that.removeClass("processing").empty().html("Connect");}else{that.removeClass("processing").empty().html("Connect");}}});}else{var providerToCall=that.attr("rel");gigya.services.socialize.addConnection({APIKey:iVillage.gigya_api_key,provider:providerToCall,callback:function(response){if(response.errorCode==0){that.parents(".provider").addClass("connected");that.parents(".provider").find(".icon").empty().append($("<img />").attr("src","/public/images/icons/social/"+providerToCall+"_20_connected.png"));that.empty().html("Disconnect");}}});}});options.addConnectionsUILoaded=true;}else{if($("#"+options.addConnectionsUISmallParams.containerID).length>0){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onConnectionEditParams);gigya.services.socialize.showAddConnectionsUI(options.gigyaConfig,options.addConnectionsUISmallParams);options.addConnectionsUILoaded=true;$(".add_connection_edit_btn").css("display","none").removeClass("hide").show().live("click",function(){gigya.services.socialize.showEditConnectionsUI(options.gigyaConfig,{});});}else{options.addConnectionsUILoaded=true;}}options.myConfig=$.extend({callback:function(response){console.log(response);},APIKey:iVillage.gigya_api_key},options.gigyaConfig);gigya.services.socialize.getUserInfo(options.myConfig);}else{if(attemptCount<20){setTimeout(function(){iV_SSO.loadAddConnectionUI(attemptCount+1);},200);}}},loadLoginUIOnPage:function(attempts){if(typeof attempts=="undefined"){attempts=0;}if(typeof(gigya)!="undefined"&&!options.loginUILoaded){options.gigyaConfig=$.extend(options.gigyaConfig,{APIKey:iVillage.gigya_api_key});if(!options.loginParamsPassed){gigya.services.socialize.addEventHandlers(options.gigyaConfig,options.onLoginParams);options.loginParamsPassed=true;}if($("#"+options.globalLayoutLoginUIParams.containerID).length>0){gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.globalLayoutLoginUIParams));options.loginUILoaded=true;$(".gigya-login-pretext").show();}else{if($("#"+options.channelLayoutLoginUIParams.containerID).length>0){gigya.services.socialize.showLoginUI(options.gigyaConfig,$.extend({},options.basicLoginParams,options.channelLayoutLoginUIParams));options.loginUILoaded=true;$(".gigya-login-pretext").show();}else{options.loginUILoaded=true;}}}else{if(attempts<20){setTimeout(function(){iV_SSO.loadLoginUIOnPage(attempts+1);},200);}}},uploadUGC:function(e){origEventType=e.type;origEventTarget=$(e.target);if(!isAuthenticated){e.preventDefault();flowType="login";steps.login();}else{e.preventDefault();flowType="ugc-upload";steps.ugc_upload();}},compareUsername:function(){if(!$.cookie("iv_id")){$(".if-logged-out").show();$(".if-logged-in").remove();}else{$(".if-logged-in").show();$(".if-logged-out").remove();$(".username").each(function(){var HTML=$(this).text(),cookie=$.cookie("iv_id");if(HTML.toLowerCase()!=cookie){$(this).text(cookie+"!");}$(this).show();});}},init:function(custom){var path,xd_receiver_path;if(inited){return;}var ssoBox=$("#sso-cbox-loaded-content");iVillage=window.iVillage||{};if(!ssoBox.length){setTimeout(init,20);}else{$.extend(options,custom);if(options.baseUrl.length-options.baseUrl.lastIndexOf("/")>1){options.baseUrl+="/";}log("init()",options);proxyOrBase=options.proxyUrl||options.baseUrl;uploadSwf=options.baseUrl+"public/flash/uploadify.swf";htmlBase=proxyOrBase+"ajax/sso-html/";if(typeof(iVillage.inside_iframe)=="undefined"){$.getScript(options.gigyaAPIURL+"?apikey="+iVillage.gigya_api_key,function(){log("init() > Loaded Gigya API");$(document).trigger("gigya.ready");});}getPaths={login:htmlBase+"login",forgotPassword:htmlBase+"forgot-password",register:htmlBase+"register",gigyaRegister:htmlBase+"gigya-register",askForPassword:htmlBase+"ask-for-password",askForEmail:htmlBase+"ask-for-email",linkExistingFBUser:htmlBase+"link-existing-fb-user",chime:htmlBase+"chime-in",avatarOrUpload:htmlBase+"avatar-or-upload",allAvatars:htmlBase+"all-avatars",uploadAvatar:htmlBase+"upload-avatar",uploadPhoto:htmlBase+"upload-photo",thanks:htmlBase+"thanks",newsletterList:htmlBase+"newsletter-list",insertOrUploadPhoto:htmlBase+"insert-or-upload-photo",pickPhoto:htmlBase+"pick-photo",uploadUGC:htmlBase+"upload-ugc",socialGetEmail:htmlBase+"social-get-email",addSave:htmlBase+"add-save",deleteSave:htmlBase+"delete-save",insertSave:htmlBase+"insert-save",editSave:htmlBase+"edit-save"};postPaths={login:proxyOrBase+"ajax/user/sign-in",gigyaLogin:proxyOrBase+"ajax/gigya/login",gigyaRegister:proxyOrBase+"ajax/gigya/register",editedConnection:proxyOrBase+"ajax/gigya/extend-profile",userUpdateFBProfile:proxyOrBase+"ajax/gigya/update-profile",logout:proxyOrBase+"ajax/user/sign-out",register:proxyOrBase+"ajax/user/sign-up",forgotPassword:proxyOrBase+"ajax/user/forgot-password",getToken:proxyOrBase+"ajax/user/get-token",establishSession:proxyOrBase+"ajax/user/establish-session",createPhoto:proxyOrBase+"photo/create",createUGCPhoto:proxyOrBase+"photo/create-ugc-photo",deletePhoto:proxyOrBase+"ajax/photo/delete",flipPhoto:proxyOrBase+"ajax/photo/flip",rotatePhoto:proxyOrBase+"ajax/photo/rotate",setAvatar:proxyOrBase+"ajax/photo/set-avatar",cropAvatar:proxyOrBase+"ajax/photo/crop",setChildren:proxyOrBase+"ajax/user/set-children",newslettersByVert:proxyOrBase+"ajax/newsletter/get-by-vertical",newsletterSignUp:proxyOrBase+"ajax/user/set-newsletters",socialEmail:proxyOrBase+"ajax/social/email",addSave:proxyOrBase+"ajax/saves/add",deleteSave:proxyOrBase+"ajax/saves/delete",embedSave:proxyOrBase+"ajax/saves/embed",editSave:proxyOrBase+"ajax/saves/edit",createUGCSlide:proxyOrBase+"ajax/ugc/create_slide"};ssoBox.parents("#sso-cbox").after('<div id="sso-avatar-overlay"><a class="sso-avatar" href="#"></a></div>');avatarOverlay=$("#sso-avatar-overlay");getToken();ssoBox.find("a.sso-step").live("click",handleStep);ssoBox.find("a.sso-new-window").live("click",handleNewWindow);ssoBox.find("a.sso-form-submit").live("click",handleFormSubmitter);ssoBox.find("a.sso-paginate").live("click",handlePaginate);ssoBox.find("a.sso-rotate-left").live("click",rotateCounterClockwise);ssoBox.find("a.sso-rotate-right").live("click",rotateClockwise);ssoBox.find("#sso-pick-photo a").live("click",handlePickPhoto);ssoBox.find("a.sso-finish").live("click",handleFinish);ssoBox.find("a.sso-close").live("click",handleClose);ssoBox.find("#sso-children a.btn-add-another").live("click",cloneBirthdayRow);ssoBox.find("#sso-upload-photo a#sso-upload-another").live("click",handleAddAnotherPhoto);ssoBox.find("form").live("submit",formProcessor);ssoBox.find("li.avatar").live("mouseover mouseout",avatarTelescope);avatarOverlay.hover(function(){avatarOverlay.data("over",true);},function(){if(avatarOverlay.data("over")){avatarOverlayCleanup();}}).mousemove(avatarOverlayCheckPosition);ssoBox.find("a.sso-avatar").live("click",handleChooseAvatar);avatarOverlay.children("a").click(handleChooseAvatar);$(document).bind("sso_cbox_closed",fireOriginalEventOrReload);if($.browser.msie&&parseInt($.browser.version,10)<8){ssoBox.find("input:text, input:password").live("keypress",function(e){var code=e.keyCode?e.keyCode:e.which;if(code===13){form.submit();}});}log("init() > Complete.");iV_SSO.loadLoginUIOnPage();iV_SSO.loadAddConnectionUI();iV_SSO.compareUsername();}}};})(this,jQuery);