/*BID:124460-REV:140145*/var CM_SITE_NAME="ft";var CM_SERVER="engine.cmmeglobal.com";var CM_REQUEST_HTML_PATH="/h/cm_request.html";var CM_ENABLE_FIREBUG_LOGGING=false;var CM_RESPONSE_CHECK_PERIOD_MS=10;var CM_RESPONSE_TIMEOUT_MS=3500;var CM_EVENT_DELIM="|";var CM_INCLUDE_PROFILE_ID=false;var CM_INCLUDE_PROFILE_COOKIE=true;var CM_PROFILE_COOKIE_NAME="AYSC";var CM_PROFILE_ID_REGEX=CM_PROFILE_COOKIE_NAME+"=([^;]*)";var CM_QS_SITE_NAME_PARAM="sitenm";var CM_QS_CAPSULE_NAME_PARAM="capnm";var CM_QS_MATCHING_AREA_ID_PARAM="maid";var CM_QS_MATCHING_AREA_URL="murl";var CM_QS_TIME_PARAM="t";var CM_QS_TIME_ZONE_PARAM="tzo";var CM_QS_PAGE_VIEW_ID_PARAM="pgid";var CM_QS_IMPRESSION_ID="impid";var CM_QS_NAVIGATOR_PLUGINS="nplg";var CM_QS_WINDOW_HISTORY_LENGTH="hstl";var CM_QS_WINDOW_SCREEN_HEIGHT="scrh";var CM_QS_WINDOW_SCREEN_WIDTH="scrw";var CM_QS_WINDOW_PIXEL_DEPTH="scrd";var CM_QS_EXTERNAL_PARAMETERS="ep";var CM_QS_REFERRER="ref";var CM_QS_PAGE="pg";var CM_QS_ERROR="err";var CM_QS_PROFILE_ID="pfid";var CM_QS_PROFILE_ID_ERR="pfiderr";var CM_MAX_URL=1024;var CM_URI_CLICK_LOG_PATH="/v1/click";var CM_URI_REQUEST_LOG_PATH="/v1/request";var CM_URI_PAGE_VIEW_PATH="/v1/page-view";var CM_URI_VISITOR_EVENT_V1_PATH="/v1/visitor-event";var CM_URI_LOG_URL_REQUEST="/v1/log-url-request";var CM_URI_REWARD_EVENT_V1_PATH="/v1/secure-click-reward";var CM_COOKIE_NAME_CAPSULE_CLICK="click";var CM_AREA_NAME_WILDCARD="*";function cm_log(b){if(CM_ENABLE_FIREBUG_LOGGING){console.log(b)}}function cm_trim(b){if(!b){return""}if(b.length<=CM_MAX_URL){return b}return b.substr(0,CM_MAX_URL)}function cm_format_reward(c){var d=c.replace(/^\s+/,"");if(isNaN(d.charAt(0))){return d.substring(1,d.length)}return d}function cm_generate_page_view_id(){var j=[],h="0123456789ABCDEF";var f=0;var g=0;for(;f<36;f++){j[f]=Math.floor(Math.random()*16)}j[14]=4;j[19]=(j[19]&3)|8;for(;g<36;g++){j[g]=h.charAt(j[g])}j[8]=j[13]=j[18]=j[23]="-";var i=j.join("");return i}function cm_encode(b){return encodeURIComponent(b)}function cm_is_ssl(){var b=(document.location.protocol==="https");return b}function cm_defined(b){return typeof(b)!=="undefined"}function cm_read_cookie(c){var i=c+"=";var g=document.cookie.split(";");var j=0;for(;j<g.length;j++){var h=g[j];while(h.charAt(0)===" "){h=h.substring(1,h.length)}if(h.indexOf(i)===0){return h.substring(i.length,h.length)}}return null}function cm_get_window_location(){var b=window.location.hostname;if(cm_defined(window.location.port)&window.location.port!==""){b=b+":"+window.location.port}return b}function cm_set_cookie(j,i,h){var g;if(h){var f=new Date();f.setTime(f.getTime()+(h*1000));g="; expires="+f.toGMTString()}else{g=""}document.cookie=j+"="+i+g+"; path=/"}function cm_delete_cookie(b){cm_set_cookie(b,"",-1)}var CM_PAGE_VIEW_ID=cm_generate_page_view_id();function cm_build_profile_id_query_string(){var b=document.cookie.match(CM_PROFILE_ID_REGEX);if(b===null){return CM_QS_PROFILE_ID_ERR+"=cookie"}else{if(b[1]===null||b[1].length===0){return CM_QS_PROFILE_ID_ERR+"=regex"}else{return CM_QS_PROFILE_ID+"="+b[1]}}}function cm_make_page_viewid_qs(){if(!CM_PAGE_VIEW_ID){CM_PAGE_VIEW_ID=generatePageViewId()}return CM_QS_PAGE_VIEW_ID_PARAM+"="+CM_PAGE_VIEW_ID}function cm_make_time_qs(){var b=new Date();return CM_QS_TIME_PARAM+"="+b.getTime()+"&"+CM_QS_TIME_ZONE_PARAM+"="+b.getTimezoneOffset()}function cm_common_qs_params(){return CM_QS_SITE_NAME_PARAM+"="+cm_encode(CM_SITE_NAME)+"&"+cm_make_time_qs()+"&"+cm_make_page_viewid_qs()}function cm_make_production_mode_global_qs_params(){var b="";if(cm_defined(navigator.plugins)){b=b+"&"+CM_QS_NAVIGATOR_PLUGINS+"="+navigator.plugins.length}if(cm_defined(window.history)){b=b+"&"+CM_QS_WINDOW_HISTORY_LENGTH+"="+window.history.length}if(cm_defined(window.screen.height)){b=b+"&"+CM_QS_WINDOW_SCREEN_HEIGHT+"="+window.screen.height}if(cm_defined(window.screen.width)){b=b+"&"+CM_QS_WINDOW_SCREEN_WIDTH+"="+window.screen.width}if(cm_defined(window.screen.pixelDepth)){b=b+"&"+CM_QS_WINDOW_PIXEL_DEPTH+"="+window.screen.pixelDepth}if(cm_is_ssl()){b=b+"&"+CM_QS_PAGE+"="+cm_encode(cm_trim(document.location.href))}if(cm_defined(document.referrer)&&document.referrer){b=b+"&"+CM_QS_REFERRER+"="+cm_encode(document.referrer)}if(CM_INCLUDE_PROFILE_ID){visitorProfileParam=cm_build_profile_id_query_string();b=b+"&"+visitorProfileParam}return b}function cm_build_matching_area_identifiers_qs(f){var e=cm_common_qs_params();var d=0;for(;d<f.length;d++){e=e+"&=[&"+CM_QS_MATCHING_AREA_ID_PARAM+"="+cm_encode(f[d])+"&=]"}e=e+"&"+CM_QS_MATCHING_AREA_URL+"="+cm_encode(document.URL);e=e+cm_make_production_mode_global_qs_params();return e}function cm_new_xmlhttprequest(){var f=false;if(window.XMLHttpRequest&&!(window.ActiveXObject)){try{f=new XMLHttpRequest()}catch(g){f=false}}else{if(window.ActiveXObject){try{f=new ActiveXObject("Msxml2.XMLHTTP")}catch(h){try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){f=false}}}}return f}function cm_ajax_log_request(b){req=cm_new_xmlhttprequest();if(req){req.open("GET",b,false);req.send("");return true}else{return false}}function cm_ie_friendly_delay(){var f=0;var h=new Date().getTime();var e=h+150;while(new Date().getTime()<e){var g=document.getElementById(new Date().getTime());if(g!==null){f=f+1}}return f>0}function cm_image_log_click(d){cm_log("cm_image_log_click url="+d);var c=new Image();c.src=d;cm_ie_friendly_delay();return true}function cm_is_safari(){var b=navigator.userAgent.toLowerCase();if(b.indexOf("safari/")!==-1&&b.indexOf("chrome")===-1){return true}else{return false}}function cm_is_chrome(){var b=navigator.userAgent.toLowerCase();return b.indexOf("chrome")!==-1}function cm_log_click(i,k,j){var h=cm_common_qs_params();h=h+"&"+CM_QS_CAPSULE_NAME_PARAM+"="+cm_encode(i);h=h+"&"+CM_QS_IMPRESSION_ID+"="+cm_encode(k);var l=CM_URI_CLICK_LOG_PATH;if(j){h=h+"&erw="+j;l=CM_URI_REWARD_EVENT_V1_PATH}var g=document.location.protocol+"//"+CM_SERVER+l+"?"+h;if(cm_is_safari()||cm_is_chrome()){cm_ajax_log_request(g)}else{cm_image_log_click(g)}return true}function cm_log_click_check(){var d=cm_read_cookie(CM_COOKIE_NAME_CAPSULE_CLICK);if(d!==null){var c=new Image();c.src=document.location.protocol+"//"+CM_SERVER+CM_URI_CLICK_LOG_PATH+"?"+d;cm_delete_cookie(CM_COOKIE_NAME_CAPSULE_CLICK)}}function cm_get_ie_ver(){var f=-1;if(navigator.appName==="Microsoft Internet Explorer"){var e=navigator.userAgent;var d=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(d.exec(e)!==null){f=parseFloat(RegExp.$1)}}return f}function MatchingEngine(){this.areas=[]}MatchingEngine.prototype.setRequestPath=function(d){if(arguments.length===0){return}var c=arguments[0];if(c.charAt(c.length-1)==="/"){c=c.substring(0,c.length-1)}CM_REQUEST_HTML_PATH=c+CM_REQUEST_HTML_PATH};MatchingEngine.prototype.setup=function(m,l){if(cm_get_ie_ver()===5){return}var p=0;this.areaNames=m.split(",");this.serverTimeout=false;this.timestamp=new Date().getTime();for(;p<this.areaNames.length;p++){var n={};var o=this.areaNames[p];n.name=o;n.content=null;n.displayed=false;this.areas[o]=n}var j=cm_build_matching_area_identifiers_qs(this.areaNames);var i=document.location.protocol+"//"+cm_get_window_location()+CM_REQUEST_HTML_PATH+"?"+j;if(!cm_defined(l)){l=this._encodeClientParams()}if(l!==null&&l.length>0){i=i+"&"+CM_QS_EXTERNAL_PARAMETERS+"="+cm_encode(l)}var k='<iframe id="cm_server_request" style="display:none" src="'+i+'"></iframe>';document.write(k);setTimeout("MatchingEngine._responseChecker()",CM_RESPONSE_CHECK_PERIOD_MS)};MatchingEngine.prototype.logEvent=function(i){var j=1;if(arguments.length===0){return}i=arguments[0];var f=i;for(;j<arguments.length;j++){f=f+CM_EVENT_DELIM+arguments[j]}var g="event="+cm_encode(f)+"&"+cm_common_qs_params()+cm_make_production_mode_global_qs_params();var h=new Image();h.src=document.location.protocol+"//"+CM_SERVER+CM_URI_VISITOR_EVENT_V1_PATH+"?"+g};MatchingEngine.prototype.logPageView=function(){var d=cm_common_qs_params()+cm_make_production_mode_global_qs_params();var c=new Image();c.src=document.location.protocol+"//"+CM_SERVER+CM_URI_PAGE_VIEW_PATH+"?"+d};MatchingEngine.prototype.logConversion=function(){var e=cm_read_cookie("cm_impid");var g=cm_read_cookie("cm_capsulename");var f=1;cm_log_click(g,e);if(arguments.length===0){return}var h=arguments[0];for(;f<arguments.length;f++){h=h+CM_EVENT_DELIM+arguments[f]+"="+document.getElementById(arguments[f]).innerHTML}MatchingEngine.logEvent(h)};MatchingEngine.prototype.logReward=function(){var e=cm_read_cookie("cm_impid");var f=cm_read_cookie("cm_capsulename");var d=cm_format_reward(document.getElementById("reward").innerHTML);cm_log_click(f,e,d);return true};MatchingEngine.prototype.display=function(b){this._displayInternal(b,true)};MatchingEngine.prototype._displayInternal=function(g,h){if(cm_get_ie_ver()===5){this._displayAreaDefault(g);return}var e=this.areas[g];if(cm_defined(e)){if(h){document.write('<span id="'+g+'">')}if(e.content!==null){cm_log("display:responseReceived = true "+g);if(h){document.write(e.content);e.displayed=true}else{var f=document.getElementById(g);if(f!==null){MatchingEngine._replaceWithScripts(f,e.content);e.displayed=true}}}if(h){document.write("</span>")}}};MatchingEngine.prototype._displayAll=function(){var e=true;var f=0;for(;f<this.areaNames.length;f++){var g=this.areas[this.areaNames[f]];cm_log("area "+g);if(!g.displayed){if(g.content!==null){var h=document.getElementById(g.name);cm_log(g.name+" = "+h);if(h!==null){MatchingEngine._replaceWithScripts(h,g.content);g.displayed=true}else{g.displayed=false;e=false}}else{g.displayed=false;e=false}}else{cm_log("capsule.displayed capsule="+g.name)}}return e};MatchingEngine.prototype._replaceWithScripts=function(i,l){if(l.toLowerCase().indexOf("<script")>=0){i.innerHTML="&nbsp;"+l}else{i.innerHTML=l}var j=i.getElementsByTagName("script");if(j&&j.length>0){var k=j.length;var m=k-1;var n=[];for(;m>=0;m--){var p=j[m];n[m]=j[m].text;p.parentNode.removeChild(p)}for(m=0;m<k;m++){var o=document.createElement("script");o.setAttribute("type","text/javascript");o.setAttribute("language","JavaScript");o.text=n[m];i.appendChild(o)}}};MatchingEngine.prototype._responseChecker=function(){if(this.serverTimeout){return}var d=this._displayAll();var e=new Date().getTime()-this.timestamp;var f=e>=CM_RESPONSE_TIMEOUT_MS;cm_log("elapsed "+e);if(!d&&!f){setTimeout("MatchingEngine._responseChecker()",CM_RESPONSE_CHECK_PERIOD_MS)}else{if(!d&&f){cm_log("timeout allDisplayed="+d);this._handleTimeout()}}};MatchingEngine.prototype._handleTimeout=function(){var d=0;cm_log("timeout");this.serverTimeout=true;for(;d<this.areaNames.length;d++){var c=this.areaNames[d];this.areas[c].displayed=this._displayAreaDefault(c)}};MatchingEngine.prototype._displayAreaDefault=function(f){var e=document.getElementById(f+"_default");if(e!==null){var d=document.getElementById(f);if(d!==null){d.innerHTML=e.innerHTML;return true}}return false};MatchingEngine.prototype._callback=function(f,d){cm_log("_callback areaName="+f);var e=this.areas[f];if(cm_defined(e)){e.content=d;this._displayInternal(f,false)}};MatchingEngine.prototype._callback_display_default=function(c){var d=0;cm_log("_callback_display_default areaName="+c);if(c!==CM_AREA_NAME_WILDCARD){this._displayAreaDefault(c)}else{for(;d<this.areaNames.length;d++){this._displayAreaDefault(this.areaNames[d])}}};MatchingEngine.prototype._encodeClientParams=function(){var m=cm_read_cookie(CM_PROFILE_COOKIE_NAME);var j="";if(m!==null){var h=m.split("_");var n=0;for(;n<h.length;n++){var l=h[n];if(l.length>2){var i=l.substr(0,2);var k=decodeURIComponent(l.substr(2,l.length-2));if(j.length>0){j=j+"&"}j=j+i+"="+k}}}return j};var MatchingEngine=new MatchingEngine();