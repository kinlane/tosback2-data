/*BID:124460-REV:140145*/FT=window.FT||{};FT.env=FT.env||{};var FT=FT||{};FT.Properties=FT.Properties||{};FT.Properties.extend=function(a){var b;for(b in a){if(a.hasOwnProperty(b)){this[b]=a[b]}}};FT.Properties.extend({APP:"global",ENV:"local",BCReadAPIToken:"JPqBh6fm9xN8DI8Fx-r4q3UKCW2My5bxA6_zDYKIUZzODRDB3wZIFg..",CM_REQUEST_HTML_PATH:"/m/html/cm_request.htm",CORPORATE_BARRIER_BASE:"http://www.ft.com/m/registration.ft.com/corporate/ns/cb/"});FT.Properties.extend({Bitly:{login:"ftshare",baseURl:"http://api.bitly.com/v3/",apiKey:"R_2b14237f91d76519080dd5c0faf84cb7"}});FT.Properties.extend({TagContainer:{url:"//s3-eu-west-1.amazonaws.com/opentag/opentag-31604-146000.js",loaded:false}});FT.Properties.extend({ENV:"p",BCReadAPIToken:"8LjOvl7btdZiTFL3E5a3gPq9uLBIDGp7qTnXnHM0mQ5G_Tjp2GIPfQ..",SCRIPT_BASE:"http://s2.ft-static.com/m/js/",IMG_BASE:"http://im.ft-static.com/m/img/",CORPORATE_BARRIER_BASE:"http://www.ft.com/m/registration.ft.com/corporate/ns/cb/",ASSANKA_ANNOTATION_HOST:"mbanewslines.ft.com"});FT.Properties.extend({TagContainer:{url:"//s4.media.ft.com/opentag/opentag-27295-31253.js",loaded:false}});var FT=FT||{};FT.lib={type:function(d){function a(e){return(typeof e.length==="number"&&!(e.propertyIsEnumerable("length")))}function c(e){return(Object.prototype.toString.apply(e)).match(/\[object (\w+)\]/)[1].toLowerCase()}var b=c(d);return d===undefined?"undefined":d===null?"null":b==="object"&&a(d)?"arraylike":b==="arguments"?"arraylike":b},iterator:function(b,c){for(var a=0;a<b.length&&c.call(b,b[a],a)!==false;a++){}},trim:function(a){return String(a).replace(/^\s+|\s+$/g,"")},index:function(c,b){for(var a in c){if(b.call(c,a,c[a])===false){break}}},constrain:function(c,b,a){return +c<b||+c>a?Math.max(b,Math.min(c,a)):c},addCssRule:function(a,c){var b=document.styleSheets[0];if(b.addRule){b.addRule(a,c)}else{b.insertRule(a+"{"+c+"}",0)}},hash:function(d,a,b){var c={};FT.lib.iterator(d.split(a),function(e){var f=e.split(b);if(f.length>1){c[FT.lib.trim(f[0])]=Array.prototype.slice.call(f,1).join(b)}});return c},delimit:function(d,a,c){var f="";var e="";for(var b in d){if(d.hasOwnProperty(b)){e+=f+b+c+d[b];f=a}}return e},extend:function(){var b=arguments.callee,c={};function a(f,g){var e=FT.lib.type(g);if(e==="object"){c[f]=b(g)}else{if(e==="array"||e==="arraylike"){c[f]=Array.prototype.slice.call(g,0)}else{c[f]=g}}}function d(e){FT.lib.index(e,a)}FT.lib.iterator(arguments,d);return c},hashCookies:function(a){FT.cookies=FT.lib.hash(a||document.cookie,";","=");return FT.cookies},hashQueryString:function(a){FT.queryString=FT.lib.hash(a||window.location.search,/[?&]/,"=");return FT.queryString},isSecure:function(a){var b=a||document;return(b.location.protocol=="https:")},writeScript:function(a){if(document.readyState!=="complete"||typeof QUnit==="object"){document.write("<scr"+'ipt src="'+a+'"></scr'+"ipt>")}},writeScriptAsynchronous:function(a){var b=document.createElement("script");b.async="async";b.type="text/javascript";b.src=a;document.getElementsByTagName("head")[0].appendChild(b)},getElementsByClassName:function(b,f,a){var e=(f=="*"&&b.all)?b.all:b.getElementsByTagName(f);var h=[];a=a.replace(/\-/g,"\\-");var g=new RegExp("(^|\\s)"+a+"(\\s|$)");var d;for(var c=0;c<e.length;c++){d=e[c];if(g.test(d.className)){h.push(d)}}return(h)},addClassName:function(b,a){if(b){this.removeClassName(b,a);b.className+=" "+a}},removeClassName:function(b,a){if(b){b.className=b.className.replace(new RegExp(" ?"+a),"")}},clearSelection:function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var a=window.getSelection();a.removeAllRanges()}}}};FT.lib.hashCookies();FT.lib.hashQueryString();var FT=FT||{};FT.PreInit=function(){this.distributeNavItems=function(d){var p=d.childNodes;var h=[];for(var j=0;j<p.length;j++){var g=p[j];if(g.tagName=="LI"&&g.className.indexOf("dummy")<0){h.push(g)}}var m=h.length;if(m>0){var q=h[0].parentNode.offsetWidth;var k=14;for(var j=0;j<h.length;j++){var f=h[j];f.style.paddingLeft=0;f.style.paddingRight=0;f.style.marginLeft=0;f.style.marginRight=0;k+=f.offsetWidth}var c=q-k;var b=Math.floor(c/m);for(var j=0;j<h.length;j++){var f=h[j];if(j==0){f.style.paddingLeft="14px"}f.style.paddingRight=b+"px";var e=f.getElementsByTagName("A");for(var o=0;o<e.length;o++){var l=e[o];l.style.visibility="visible"}}}};this.renderWsodMarketsHome=function(d){var b=d.split("?");var e=b[0];var f="";if(b.length>1){f+="&"+b[1].replace("?","&")}if(!f.match(/&id=([^&])*/)){f="?id=wsodMarketsHomePlaceholder"+f}else{f=f.replace("&","?")}if(!f.match(/edition=([^&])*/)){if(FT.cookies.AYSC){var a=FT.cookies.AYSC.match(/.*_14([^_]*)/)?RegExp.$1:null;var h=FT.cookies.AYSC.match(/.*_28([^_]*)/)?RegExp.$1:null}var c=h?h:a?(a=="GBR"?"uk":""):"uk";f+="&edition="+c}var g=document.getElementById("wsodMarketsHomePlaceholder");if(g){g.innerHTML=""}FT.lib.writeScript(e+f)};this.removeNojsClassFromBody=function(){FT.lib.removeClassName(document.body,"nojs")};this.addOSClassToBody=function(a){if(/Mac/.test(a.platform)&&(/Chrome|Firefox/.test(a.userAgent)||/Apple/.test(a.vendor)||window.opera)){FT.lib.addClassName(document.body,"OS_Mac")}};this.addRenderingEngineClassToBody=function(a){var b="";if(/MSIE/.test(a.userAgent)){b="trident"}else{if(/Gecko\//.test(a.userAgent)){b="gecko"}else{if(/WebKit\//.test(a.userAgent)){b="webkit"}else{if(/Presto\//.test(a.userAgent)){b="presto"}}}}if(b){FT.lib.addClassName(document.body,b)}};this.setBodyClass=function(a){this.removeNojsClassFromBody();this.addOSClassToBody(a);this.addRenderingEngineClassToBody(a)},this.initialiseBrightcove=function(){if(typeof runMobileCompatibilityScript==="function"){runMobileCompatibilityScript("myExperience","anId")}FT.lib.writeScriptAsynchronous("http://admin.brightcove.com/js/BrightcoveExperiences.js")};this.hideSearchboxAd=function(){var a=document.getElementById("searchbox");if(a){a.style.display="none"}};this.attachHideSearchboxAdFunctionality=function(){var a=document.getElementById("simpleSearchField");if(a){if(a.addEventListener){a.addEventListener("focus",this.hideSearchboxAd,false)}else{if(a.attachEvent){a.attachEvent("onfocus",this.hideSearchboxAd)}}}};this._chain=function(a){return function(){for(var b=0;b<a.length;b++){a[b]()}}};this.addToChain=function(b,a){window[b]=typeof(window[b])!="function"?a:this._chain([window[b],a])}};FT.preInit=new FT.PreInit();FT.HTMLAds=function(){this.HTMLAdData={"urlStem":"http://media.ft.com/adimages/banner/","injectionParentDiv":"banlb","injectionLegacyParentDiv":"ad-placeholder-banlb","injectionDiv":"corppop_overlay","injectionClass":"corppop_single_occurence","timeOutCookieName":"FT_AM","timeOutCookieVal":"Check","timeOutCookieLife":"21600000","urlStemClassicAMO":"http://media.ft.com/m/registration.ft.com/corporate/ns/amo/"}};FT.HTMLAds.prototype.buildAdURL=function(f,a,d,c){var e="anon/",g="",b;if((a.match(c.cor))||(a.match(c.lv1))||(a.match(c.lv2))){e="subscribed/"}else{if((a.match(c.reg))){e="registered/"}}if(f===""||f.match(/PVT/)){d=d.toUpperCase();g=this.HTMLAdData.urlStem+d+".js"}else{if((typeof FT.Properties.CORPORATE_AMO_BASE==="undefined")||(FT.Properties.CORPORATE_AMO_BASE==="")){b=this.HTMLAdData.urlStemClassicAMO}else{b=FT.Properties.CORPORATE_AMO_BASE}g=b+e+d}return g};FT.HTMLAds.prototype.getHTMLAd=function(d,i,e){var b='<script src="'+e+'" type="text/javascript">'+"/* Do not remove comment */"+"<\/script>",f,c,h,g;i.style.display="block";f=document.getElementById(this.HTMLAdData.injectionDiv);c=this.HTMLAdData.injectionDiv;if(f===null){f=document.createElement("div")}f.setAttribute("id",c);f.className=this.HTMLAdData.injectionClass;g=document.createElement("script");g.type="text/javascript";g.src=e;try{i.appendChild(f);h=document.getElementById(c);h.appendChild(g)}catch(a){clientAds.log(a)}};FT.HTMLAds.prototype.isCorporateUser=function(e,d,a,c,b){if(!c){return 0}if(d===""||(d.match(/PVT/))){if((a.match(/[<>]/))||(c.match(/[<>]/))||(c.match(/RES/))||(c.match(/PVT/))){return 0}else{if((!c.match(/[0-9A-Za-z]/))||(a.match(b.cor))||(a.match(b.lv1))||(a.match(b.lv2))){return 0}}}else{if(d.match(/A/)&&!d.match(/IA/)){if((a.match(/[<>]/))||(c.match(/[<>]/))||(c.match(/RES/))||(c.match(/PVT/))){return 0}else{if((!c.match(/[0-9A-Za-z]/))){return 0}else{if(e.match(/c/)){return 0}}}}else{return 0}}return 1};FT.HTMLAds.prototype.createCorppopCookie=function(d){var c,e,b,a;if(typeof d==="undefined"){d=this.HTMLAdData.timeOutCookieLife}c=this.HTMLAdData.timeOutCookieName;e=this.HTMLAdData.timeOutCookieVal;b=new Date();b.setTime(b.getTime()+(d));a="; expires="+b.toGMTString();document.cookie=c+"="+e+a+"; domain=.ft.com; path=/"};FT.HTMLAds.prototype.timeOut=function(b,a){if(!b&&!a){return 1}return 0};FT.Advertising=function(){this.baseAdvert={};this.CONST={};this.CONST.AD_SERVERS=/^((a[lutre])|(b[rsgaye])|(c[nohazl])|(d[ke])|(e[gse])|(f[ri])|(g[rt])|(h[ukr])|(i[stlne])|(j[p])|(k[wr])|(l[uvt])|(m[yxaekd])|(n[olz])|(p[lthk])|(r[suo])|(s[gekai])|(t[rhw])|(u[kas])|(v[e])|(z[a]))$/i;this.CONST.DFPNetworkCode="/N5887";this.CONST.AdFormat={"intro":{"sz":"1x1"},"banlb":{"sz":"468x60,728x90,970x90","dcopt":"ist"},"newssubs":{"sz":"239x90"},"tlbxrib":{"sz":"336x60"},"marketingrib":{"sz":"336x60"},"lhn":{"sz":"136x64"},"tradcent":{"sz":"336x260"},"mktsdata":{"sz":"88x31,75x25"},"hlfmpu":{"sz":"300x600,336x850,300x250,336x280"},"doublet":{"sz":"342x200"},"refresh":{"sz":"1x1"},"mpu":{"sz":"300x250,336x280"},"mpusky":{"sz":"300x250,336x280,160x60"},"wdesky":{"sz":"160x600"},"video":{"sz":"592x333"},"minivid":{"sz":"400x225"},"vidbut1":{"sz":"120x29"},"vidbut2":{"sz":"100x50"},"vidbut3":{"sz":"200x50"},"searchbox":{"sz":"200x28"},"-":{}};this.CONST.KeyOrder=["sz","dcopt","07","a","06","05","27","eid","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","19","20","21","slv","02","14","cn","01","kw","u","loc","uuid","auuid","ts","cc","pos","bht","tile","ord"];this.CONST.KeyOrderVideo=["sz","dcopt","pos"];this.CONST.KeyOrderVideoExtra=["dcopt","brand","section","playlistid","playerid","07","a","06","slv","eid","05","19","21","27","20","02","14","cn","01","u"];this.CONST.KeyOrderVideoSync=["sz","dcopt"];this.CONST.uKeyOrder=["eid","ip","uuid","auuid","ts"];this.CONST.exclusions=["key=03","key=04","key=08","key=09","key=10","key=11","key=12","key=13","key=15","key=16","key=17","key=18","key=22","key=23","key=24","key=25","key=26","key=28","key=29","key=30"];this.CONST.leading_zero_key_names=["19","21"];this.CONST.remove_exes={"02":1,"05":1,"06":1,"07":1,"19":1,"20":1,"21":1};this.CONST.remove_res_pvt={"14":1,"cn":1,"27":1};this.CONST.regex_key_names=["22"];this.CONST.SubsLevelReplaceLookup={"edt":/^edit$/,"int":/^Ftemp$/,"cor":/^[PL][01][PL]*[1]*[PL][12][A-Za-z][A-Za-z]/,"lv1":/^[PL]1[A-Za-z][A-Za-z]/,"lv2":/^[PL]2[A-Za-z][A-Za-z]/,"reg":/^[PL]0[A-Za-z][A-Za-z]/};this.CONST.substr_key_names=["24=0=3=cn"];this.CONST.proxy_div_prefixes=["","ad-placeholder-","ad-container-"];this.CONST.audSciMax=20;this.CONST.audSciInitial=20;this.CONST.uParamMax=253;this.CONST.urlMax=511;this.CONST.urlThresholdMax=2000000;this.CONST.urlThreshold=10000;this.CONST.trackUrl="http://track.ft.com/track/dfp_error.gif";this.CONST.cookieConsentName="cookieconsent";this.CONST.cookieConsentAcceptanceValue="accepted";this.CONST.DFPPremiumCopy="gdfp-testing-only.g.doubleclick.net";this.CONST.DFPPremiumCopyNetworkCode="/N282450";this.CONST.DFPPremiumReadOnly=this.CONST.DFPPremiumCopy;this.CONST.DFPPremiumReadOnlyNetworkCode=this.CONST.DFPNetworkCode;this.CONST.DFPPremiumIPReplaceLookup={"0":{"replaceRegex":/0/g,"replaceValue":"a"},"1":{"replaceRegex":/1/g,"replaceValue":"b"},"2":{"replaceRegex":/2/g,"replaceValue":"c"},"3":{"replaceRegex":/3/g,"replaceValue":"d"},"4":{"replaceRegex":/4/g,"replaceValue":"e"},"5":{"replaceRegex":/5/g,"replaceValue":"f"},"6":{"replaceRegex":/6/g,"replaceValue":"g"},"7":{"replaceRegex":/7/g,"replaceValue":"h"},"8":{"replaceRegex":/8/g,"replaceValue":"i"},"9":{"replaceRegex":/9/g,"replaceValue":"j"},".":{"replaceRegex":/\./g,"replaceValue":"z"}}};if(FT.lib){FT.ads=new FT.Advertising()}if(FT.HTMLAds){FT.corppop=new FT.HTMLAds()}FT.Advertising.prototype.request=function(a){FT.env.isLegacyAPI=false;clientAds.log("FT.Advertising.prototype.request("+a+")");this.initDFP();this.requestDFP(a)};FT.Advertising.prototype.getVideoAdverts=function(){var a=[];this.foreach(this.adverts,function(b){if((this.adverts[b].callType==="video")||(this.adverts[b].callType==="minivid")){a.push(b)}});return a};FT.Advertising.prototype.getVideoSyncAdverts=function(){var a=[];this.foreach(this.adverts,function(b){if(this.adverts[b].callType==="videoSync"){a.push(b)}});return a};FT.Advertising.prototype.getNormalAdverts=function(){var a=[];this.foreach(this.adverts,function(b){if(this.adverts[b].callType==="normal"){a.push(b)}});return a};FT.Advertising.prototype.register=function(a){clientAds.log("FT.Advertising.prototype.register("+a+")");if(!FT.ads.hasCalledInitDFP){FT.env.isLegacyAPI=false;this.initDFP()}this.adverts[a]=this.adverts[a]||{};this.adverts[a].callType="videoSync";if(!this.videoAdverts){this.videoAdverts=[]}this.videoAdverts.push(a)};FT.Advertising.prototype.beginVideo=function(){this.beginNewPage()};FT.Advertising.prototype.requestDFP=function(j){var h="",c=FT.ads.CONST.cookieConsentName,e=FT.ads.CONST.cookieConsentAcceptanceValue,d=function(s){var q,p,r;q=new RegExp("("+s+")([^_]+)");p=FT.cookies.AYSC.match(q);if(p===null){return""}r=(p[2]!==null)?p[2].toString():"";return r},k=d("_97"),i=d("_98"),f=d("_22"),b=d("_27"),l,m,a,g,o,n;if(j==="corppop"){l=document.location.href;if(!l.match(/Authorised=false/)&&(FT.cookies[c]===e)){if(typeof FT.cookies.AYSC!=="string"){m=0}else{m=FT.corppop.isCorporateUser(k,i,f,b,FT.ads.CONST.SubsLevelReplaceLookup)}a=FT.corppop.timeOut(FT.cookies.FT_AM,FT.cookies.CorpPopTimeout);g=(FT.env.isLegacyAPI)?FT.corppop.HTMLAdData.injectionLegacyParentDiv:FT.corppop.HTMLAdData.injectionParentDiv;o=document.getElementById(g);if((m)&&(a)&&(o!==null)){h=FT.corppop.buildAdURL(i,f,b,FT.ads.CONST.SubsLevelReplaceLookup);FT.corppop.getHTMLAd(j,o,h)}}}else{clientAds.log("FT.Advertising.requestDFP("+j+")");this.setInitialAdState(j);h=this.buildURL(j);if(h){n=this;FT.lib.writeScript(h);if(this.adverts[j].state.alwaysHide){this.collapse(j)}else{clientAds.log("setting up anon_timeout("+j+") "+this.timeoutTolerance);this.timeouts[j]=setTimeout(function(){clientAds.log("called anon_timeout("+j+")");n.collapsePositionIfNoAd(j)},this.timeoutTolerance)}}}this.addDiagnostic(j,{"requestUrl":h})};FT.Advertising.prototype.foreach=function(f,c){var a,b,d,g,e;if(!f||typeof f==="function"){return}if(f.length){for(a=0,b=f.length;a<b;a++){d=typeof f==="string"?f.charAt(a):f[a];if(c.call(this,d,a)===false){break}}}else{for(g in f){if(f.hasOwnProperty(g)){e=FT.lib.type(f[g]);if(!e.match(/^function$/)){if(c.call(this,g,f[g])===false){break}}}}}};FT.Advertising.prototype.getAdFormat=function(c){var b,a;if(this.CONST.AdFormat[c]){b=this.CONST.AdFormat[c]}else{if(/\d+$/.test(c)){a=c.replace(/\d+$/,"");if(this.CONST.AdFormat[a]){b=this.CONST.AdFormat[a]}}}return b};FT.Advertising.prototype.getCookie=function(b){var a=FT.cookies[b];if(a){return a.replace(/%3D/g,"=")}return undefined};FT.Advertising.prototype.setInitialAdState=function(c,b){b=b||"normal";this.adverts[c]=this.adverts[c]||{};this.adverts[c].callType=b;this.adverts[c].state={"state":"init","hasDiv":false,"alwaysHide":false,"requestsInterstitial":false,"hasInterstitial":false,"isSystemDefault":false,"isEmptyAd":false,"initialHTML":""};if(c==="refresh"){this.adverts[c].state.alwaysHide=true}var a=this.getAdInnerHTML(c);if(typeof a!=="undefined"){this.adverts[c].state.hasDiv=true;this.adverts[c].state.initialHTML=a}};FT.Advertising.prototype.isAdStateEmpty=function(b){var a=false;if(b.isSystemDefault||b.isEmptyAd){if(!b.hasInterstitial){a=true}}return a};FT.Advertising.prototype.shouldAdBeZeroHeight=function(b){var a=false;if(b.isSystemDefault||b.isEmptyAd){if(b.hasInterstitial){a=true}}return a};FT.Advertising.prototype.createAdRequestFromVideoUrl=function(d,b){var a,c;this.clearBaseAdvert();this.prepareBaseAdvert(d);a=this.buildURLFromBaseAdvert("videoSync");a=a.replace(/\?$/,"");c=b.replace(/;pos=\w+/,";pos="+d);c=c.replace(/^[^\s]+;sz=\d+x\d+(,\d+x\d+) {0,3}(;dcopt=ist)?/,a);c=c.replace(/;tile=(\d{1,2})/,";tile="+this.baseAdvert.tile);return c};FT.Advertising.prototype.insertAdIntoIFrame=function(d,b){var a=this.getAdContainer(d).div,c;if(!a){return undefined}c=d+"_iframe";a.innerHTML=['<iframe id="',c,'"',' width="',a.clientWidth,'"',' height="',a.clientHeight,'"></iframe>'].join("");document.getElementById(c).src=b};FT.Advertising.prototype.requestVideoSync=function(c,a){if(!this.getAdFormat(c)){this.addDiagnostic(c,{"requestVideoSync":"ad position not valid"});return undefined}this.setInitialAdState(c);var b=this.createAdRequestFromVideoUrl(c,a);this.adverts[c].callType="videoSync";this.addDiagnostic(c,{inputUrl:a,requestUrl:b});this.insertAdIntoIFrame(c,b);return b};FT.Advertising.prototype.endVideo=function(){return};FT.Advertising.prototype.handleRefreshLogic=function(b,a){clientAds.log("FT.Advertising.prototype.handleRefreshLogic("+b.name+", "+a+")");a=a||30*60*1000;if((b.name==="refresh")&&(FT.env.asset==="page")){b.refreshTimer=a}};FT.Advertising.prototype.checkAdState=function(d){clientAds.log("FT.Advertising.prototype.checkAdState("+d+")");this.adverts[d]=this.adverts[d]||{"state":{}};var a=this.adverts[d].state,b=this.getAdInnerHTML(d),c;if(typeof b!=="undefined"){a.hasDiv=true;a.innerHTML=b;if(a.innerHTML!==a.initialHTML){a.state="changed"}if(a.state==="changed"){if(/817-grey/.test(a.innerHTML)){a.isSystemDefault=true}if(/ft-no-ad-/.test(a.innerHTML)){a.isEmptyAd=true}c=new RegExp("<!--\\s*Begin Interstitial Ad\\s*-->");if(c.test(a.innerHTML)){a.hasInterstitial=true}}}clientAds.log("FT.Advertising.prototype.checkAdState("+d+") "+[a.state,"hasDiv: "+a.hasDiv,"isSystemDefault: "+a.isSystemDefault,"isEmptyAd: "+a.isEmptyAd,"requestsInterstitial: "+a.requestsInterstitial,"hasInterstitial: "+a.hasInterstitial].join(", "))};FT.Advertising.prototype.collapsePositionIfNoAd=function(b){clientAds.log("FT.Advertising.prototype.collapsePositionIfNoAd("+b+")");this.checkAdState(b);var a=this.adverts[b].state;if(this.shouldAdBeZeroHeight(a)){this.collapse(b,true)}else{if(this.isAdStateEmpty(a)){this.collapse(b)}else{if(a.state==="init"){this.collapse(b);this.watchAdPosition(b)}else{this.expand(b)}}}};FT.Advertising.prototype.expandPositionIfAd=function(b){clientAds.log("FT.Advertising.prototype.expandPositionIfAd("+b+")");this.checkAdState(b);var a=this.adverts[b].state;if(!this.isAdStateEmpty(a)){clientAds.log("clearing anon_interval("+b+") - is interstitial or not system default");this.expand(b);clearInterval(this.intervals[b])}};FT.Advertising.prototype.watchAdPosition=function(b){clientAds.log("FT.Advertising.prototype.watchAdPosition("+b+")");var a=this,c=b;clientAds.log("setting up anon_interval("+c+") "+a.timeIntervalTolerance);a.intervals[c]=setInterval(function(){clientAds.log("called anon_interval("+c+")");a.expandPositionIfAd(c)},a.timeIntervalTolerance)};FT.Advertising.prototype.clearAllTimeouts=function(){clientAds.log("FT.Advertising.prototype.clearAllTimeouts()");this.foreach(this.timeouts,function(b,a){clearTimeout(a)})};FT.Advertising.prototype.clearAllIntervals=function(){clientAds.log("FT.Advertising.prototype.clearAllIntervals()");this.foreach(this.intervals,function(b,a){clearInterval(a)})};FT.Advertising.prototype.clearTimer=function(){clientAds.log("FT.Advertising.prototype.clearTimer()")};FT.Advertising.prototype.complete=function(){clientAds.log("FT.ads.complete() "+this.isComplete);if(!this.isComplete){if(this.adverts.refresh){this.legacyAdCollapse("refresh",false)}this.injectUnclassifiedTrackCall();this.injectUrlTrackCall()}this.isComplete=true};FT.Advertising.prototype.callback=function(a){if(!a||typeof a!=="object"||!a.name){clientAds.log("FT.Advertising.callback("+a+") - improper");return false}clientAds.log("FT.Advertising.callback("+[a.name,a.type,a.adName].join(", ")+")");this.checkAdState(a.name);this.storeResponse(a);if(a.addNewAttributes){this.extendBaseAdvert(a.addNewAttributes)}if(a.insertAdRequest){this.insertNewAd(a.insertAdRequest)}var b;if(parseInt(a.refreshTimer,b)>0){this.startRefreshTimer(a.refreshTimer)}if(a.type){switch(a.type){case"empty":if(!this.adverts[a.name].state.requestsInterstitial){clientAds.log("anon_timeout("+a.name+") is being cancelled");clearTimeout(this.timeouts[a.name])}this.collapse(a.name);this.addDiagnostic(a.name,{"collapsed":"emptyAd"});break;case"imageclick":this.renderImage(a);break;default:break}}};FT.Advertising.prototype.storeResponse=function(a){clientAds.log("FT.Advertising.storeResponse("+[a.name,a.type,a.adName].join(", ")+")");if(FT.lib.type(a)!=="object"){return false}if(FT.lib.type(this.adverts[a.name])!=="object"){this.adverts[a.name]={}}this.adverts[a.name].response=a};FT.Advertising.prototype.getKeys=function(a){var b=[];if(FT.lib.type(a)==="object"){this.foreach(a,function(c){b.push(c)})}return b.sort()};FT.Advertising.prototype.hasClassName=function(b,d){var e,c,a;e=d.constructor===RegExp?d:new RegExp("^"+d+"$");c=b.split(" ");for(a=0;a<c.length;++a){if(c[a].match(e)!==null){return true}}return false};FT.Advertising.prototype.addDiagnostic=function(b,a){if(!b){b="_anonymous"}if(FT.lib.type(b)!=="string"||FT.lib.type(a)!=="object"){return false}clientAds.log("FT.Advertising.addDiagnostic("+b+", "+this.getKeys(a).join(", ")+")");if(!this.adverts[b]){this.adverts[b]={"diagnostics":{}}}this.adverts[b].diagnostics=FT.lib.extend(this.adverts[b].diagnostics,a)};FT.Advertising.prototype.extendBaseAdvert=function(a){clientAds.log("FT.Advertising.extendBaseAdvert("+a+")");this.baseAdvert=FT.lib.extend(this.baseAdvert,a)};FT.Advertising.prototype.insertNewAd=function(a){clientAds.log("FT.Advertising.insertNewAd("+a+")");this.extraAds.unshift(a);this.addDiagnostic(a,{"inserted":true})};FT.Advertising.prototype.setDefaultSiteZone=function(){FT.env.dfp_site="ftcom.5887.unclassified";FT.env.dfp_zone="unclassified"};FT.Advertising.prototype.isUnclassified=function(){var a=false;if((FT.env.dfp_site==="ftcom.5887.unclassified"||FT.env.dfp_site==="test.5887.unclassified")&&FT.env.dfp_zone==="unclassified"){a=true}return a};FT.Advertising.prototype.checkSiteZone=function(f){var d="default",a=true,b,e=this.getAdFormat(f),c=this.getDFPSite();if(!e){b="invalid ad slot name";a=false;d="invalid"}else{if(!this.detectDFPTargeting()){b="dfp_site/zone are invalid"}else{if(c.length>31){b="DFP site name too long: "+c}else{if(FT.env.dfp_zone.length>32){b="DFP zone name too long: "+FT.env.dfp_zone}else{if(c.match(/^X+$/i)){b="DFP site name is default methode metadata"}else{if(FT.env.dfp_zone.match(/^X+$/i)){b="DFP zone name is default methode metadata"}else{if(!c.match(/^\w+\.5887\.[\-\w]+$/)){b="DFP site name is not the FT network: "+c}else{d="ok";a=false}}}}}}}if(d!=="ok"){this.addDiagnostic(f,{"checkSiteZone":b})}if(a){this.setDefaultSiteZone()}return d};FT.Advertising.prototype.clearBaseAdvert=function(){var a,b;for(a=0;a<this.CONST.KeyOrder.length;a++){b=this.CONST.KeyOrder[a];if((b!=="tile")&&(b!=="ord")){delete this.baseAdvert[b]}}};FT.Advertising.prototype.prepareAdVars=function(a){a=this.stripLeadingZeros(this.CONST.leading_zero_key_names,a);a=this.fieldRegex(this.CONST.regex_key_names,a);a=this.fieldSubstr(this.CONST.substr_key_names,a);a=this.detectERights(a);return a};FT.Advertising.prototype.erightsID=function(){var a=undefined;if((typeof FT.cookies.FT_U!=="undefined")){a=FT.cookies.FT_U.match(/_EID\=(\d+)_/i);if(a!==null&&a[1]){a=a[1].replace(/^0*/,"")}}else{if(typeof FT.cookies.FT_Remember!=="undefined"){a=FT.cookies.FT_Remember.split(":");if(a!==null&&a.length>0){a=a[0]}}}return a};FT.Advertising.prototype.getIP=function(){var d,a,c=FT.cookies.FTUserTrack;if(c){d=c;a=c.match(/^\w{1,3}\.\w{1,3}\.\w{1,3}\.\w{1,3}\.\w+$/);if(a){a=a[0];var b=a.match(/\w{1,3}/g);if(b){d=b[0]+"."+b[1]+"."+b[2]+"."+b[3]}}}return d};FT.Advertising.prototype.encodeIP=function(c){var a,b=this.CONST.DFPPremiumIPReplaceLookup;if(c){a=c;this.foreach(b,function(d){a=a.replace(new RegExp(b[d].replaceRegex),b[d].replaceValue)})}return a};FT.Advertising.prototype.prepareUParams=function(){var e="",b=this.CONST.uKeyOrder,c,d,a;this.foreach(b,function(f){var g;if(f==="ip"){g=this.getIP()}else{g=this.baseAdvert[f]}if(g){e+=!g?"":f+"="+g+","}});a=this.baseAdvert.a;if(a){c="a="+a.slice(0,this.CONST.audSciInitial).join(",a=")+",";d=a.slice(this.CONST.audSciInitial,this.CONST.audSciMax);e+=c;if(d.length){d="a="+d.join(",a=")+",";e+=d}}if(e!==""){e=e.slice(0,-1);if(e.length>this.CONST.uParamMax){this.addDiagnostic(this.baseAdvert.pos,{"uParamSizeException":"Maximum length of u ("+this.CONST.uParamMax+") exceeded. Got "+e.length});this.addDiagnostic(this.baseAdvert.pos,{"uParamDataLoss":"u parameter data loss ["+e.slice(this.CONST.uParamMax)+"]"})}return e}return undefined};FT.Advertising.prototype.duplicateEID=function(a){if(a){var b="eid="+a;if(b.length>this.CONST.uParamMax){this.addDiagnostic(this.baseAdvert.pos,{"uParamSizeException":"Maximum length of u ("+this.CONST.uParamMax+") exceeded. Got "+b.length});this.addDiagnostic(this.baseAdvert.pos,{"uParamDataLoss":"u parameter data loss ["+b.slice(this.CONST.uParamMax)+"]"})}return"eid="+a}return undefined};FT.Advertising.prototype.rsiSegs=function(){if(!this.suppressAudSci&&FT.cookies.rsi_segs){var a=[];this.foreach(FT.cookies.rsi_segs.split("|"),function(b){a.push(this.encodeAudSci(b))});return a}return undefined};FT.Advertising.prototype.getAyscVars=function(c){var a={};if(FT.cookies.AYSC!==undefined){var b=FT.cookies.AYSC.split("_");FT.lib.iterator(b,function(f){if(!!f){var d=f.match(/^(\d\d)([^_]+)/);if(d){var e=d[1];var g=d[2];a[e]=g}}})}return FT.lib.extend(c,a)};FT.Advertising.prototype.getConsentValue=function(){var b=FT.ads.CONST.cookieConsentName,a=FT.ads.CONST.cookieConsentAcceptanceValue;if(FT.cookies[b]===a){return"y"}else{return"n"}};FT.Advertising.prototype.prepareBaseAdvert=function(e){var b=this.prepareAdVars(this.getAyscVars({})),a=this.getCookie("FTQA"),d,c;this.baseAdvert.pos=e;if((a)&&(a.match(/env=(.*)premiumcopy/))){this.baseAdvert.ad_server=this.CONST.DFPPremiumCopy;this.baseAdvert.ad_network_code=this.CONST.DFPPremiumCopyNetworkCode}else{if((a)&&(a.match(/env=(.*)premiumreadonly/))){this.baseAdvert.ad_server=this.CONST.DFPPremiumReadOnly;this.baseAdvert.ad_network_code=this.CONST.DFPPremiumReadOnlyNetworkCode}else{this.baseAdvert.ad_server=this.adServerCountry(b["15"],e);this.baseAdvert.ad_network_code=this.CONST.DFPNetworkCode}}b=this.excludeFields(this.CONST.exclusions,b);this.foreach(b,function(g,f){if(!f){return true}if(this.CONST.remove_exes[g]&&/^x+$/i.test(f)){return true}if(this.CONST.remove_res_pvt[g]&&/^pvt|res$/i.test(f)){return true}this.baseAdvert[g]=f.toString().toLowerCase()});this.baseAdvert.a=this.rsiSegs();this.baseAdvert.cc=this.getConsentValue();d=this.getAdFormat(e);this.baseAdvert.sz=d.sz;if(d.dcopt){if(this.baseAdvert.hasInterstitial){this.addDiagnostic(e,{"buildURLIst":"multiple interstitials on page, ignoring "+e})}else{this.baseAdvert.hasInterstitial=true;this.baseAdvert.dcopt=d.dcopt;this.adverts[e].state.requestsInterstitial=true}}this.baseAdvert.eid=this.erightsID();this.baseAdvert.uuid=FT.env.dfp_zone;this.baseAdvert.auuid=false;this.baseAdvert.bht=this.behaviouralFlag();if(typeof pageUUID!=="undefined"){if(pageUUID!==null&&pageUUID!==""){this.baseAdvert.uuid=pageUUID}}else{if(typeof getUUIDFromString==="function"){c=getUUIDFromString(document.location.toString());if(c!==null&&c!==""){this.baseAdvert.uuid=c}}}if(typeof articleUUID!=="undefined"){if(articleUUID!==null&&articleUUID!==""){this.baseAdvert.auuid=articleUUID}}this.baseAdvert.ts=this.getTimestamp();this.baseAdvert.loc=this.encodeIP(this.getIP());this.baseAdvert.u=this.prepareUParams();this.baseAdvert.dfp_site=this.getDFPSite();FT.env.dfp_site=this.baseAdvert.dfp_site;this.baseAdvert.dfp_zone=FT.env.dfp_zone;this.baseAdvert.dfp_targeting=this.getDFPTargeting()};FT.Advertising.prototype.getDFPTargeting=function(){var c="",b,a;if(typeof FT.env.dfp_targeting!=="undefined"){b=FT.env.dfp_targeting.replace(/^;/,"").replace(/;$/,"").replace(/;;+/,";").toLowerCase();if(b!==""&&!/^x+$/.test(b)){c=b}}if(this.isArticle(document.location.toString())){if(!/^.*;pt=.*$/.test(FT.env.dfp_targeting)){c+=(c!=="")?";pt=art":"pt=art"}a=this.getReferrer();if(a!==undefined&&a!==""){c+=(c!=="")?";rf="+a:"rf="+a}}if(c!==""){return c}return undefined};FT.Advertising.prototype.getReferrer=function(){var b=null,c=document.referrer,a;if(c!==""){a=/^.*?:\/\/.*?(\/.*)$/;b=a.exec(c)[1]}if(b!==null){return b.substring(1)}return undefined};FT.Advertising.prototype.isArticle=function(a){var b=/^.*\/cms\/s\/\d\/[0-9a-fA-F]+-[0-9a-fA-F]+-[0-9a-fA-F]+-[0-9a-fA-F]+-[0-9a-fA-F]+.html.*$/,c=/^.*;pt=art.*$/;return(b.test(a)||c.test(FT.env.dfp_targeting))};FT.Advertising.prototype.getTimestamp=function(){var d=new Date(),g=d.getMonth()+1,b=d.getDate(),a=d.getHours(),c=d.getMinutes(),h=d.getSeconds(),e,f;if(g<10){g="0"+g}if(b<10){b="0"+b}if(a<10){a="0"+a}if(c<10){c="0"+c}if(h<10){h="0"+h}e=[d.getFullYear(),g,b,a,c,h];f=e.join("");return f};FT.Advertising.prototype.prepareKeywordsParam=function(){var a,b;if(FT.env.url_location){a=FT.env.url_location}b=this.getKeywordsParam(a);if(b){this.baseAdvert.kw=b}};FT.Advertising.prototype.encodeBaseAdvertProperties=function(g,b){var d="",c,e,a=this.baseAdvert.a,f;if(a){c="a="+a.slice(0,this.CONST.audSciInitial).join(";a=");e=a.slice(this.CONST.audSciInitial,this.CONST.audSciMax);if(e.length){e="a="+e.join(";a=")}}f=this.CONST.KeyOrder;if(g==="video"){f=this.CONST.KeyOrderVideo}else{if(g==="videoExtra"){f=this.CONST.KeyOrderVideoExtra}else{if(g==="videoSync"){f=this.CONST.KeyOrderVideoSync}}}this.foreach(f,function(h){var i;if(typeof this.baseAdvert[h]!=="undefined"){i=this.baseAdvert[h]}else{if(typeof b!=="undefined"&&(typeof b[h]!=="undefined")){i=b[h]}}if(h==="u"&&this.baseAdvert.dfp_targeting){d+=this.baseAdvert.dfp_targeting+";"}if(a&&h==="a"){d+=c+";"}else{d+=!i?"":h+"="+i+";";if(a&&h==="u"&&e.length){d+=e+";"}}});return d.replace(/;$/,"")};FT.Advertising.prototype.cleanKeywords=function(a){a=unescape(a).toLowerCase();a=a.replace(/[';\^\+]/g," ");a=a.replace(/\s+/g," ");a=a.replace(/^\s+/,"");a=a.replace(/\s+$/,"");a=escape(a);a=a.replace(/\./g,"%2E");return a};FT.Advertising.prototype.getKeywordsParam=function(b){var c,d,a,e;b=b||document.location.search;c="";if(b.indexOf("?")>=0){b=b.replace(/^[^\?]*\?/,"");d=b.split("&");for(a=0;c===""&&a<d.length;++a){e=d[a].match(/^(q|s|query|queryText|searchField)=(.+)$/);if(e){c=this.cleanKeywords(e[2])}}}return c};FT.Advertising.prototype.buildURLFromBaseAdvert=function(c){c=c||"normal";var b=(c==="video")?"/pfadx/":"/adj/",a;b=(c==="videoSync")?"/adi/":b;a="http://"+this.baseAdvert.ad_server+this.baseAdvert.ad_network_code+b+this.baseAdvert.dfp_site+"/"+this.baseAdvert.dfp_zone+";";a+=this.encodeBaseAdvertProperties(c);if(c!=="video"){a=a+"?";if(this.baseAdvert.tile>16){this.addDiagnostic(this.baseAdvert.pos,{"buildURLFromBaseAdvert":"too many ads, exceeds maximum tile"});a=undefined}this.baseAdvert.tile++}return a};FT.Advertising.prototype.buildURL=function(b){var a;clientAds.log("FT.Advertising.buildURL("+b+")");if(this.checkSiteZone(b)==="invalid"){return a}this.clearBaseAdvert();this.prepareBaseAdvert(b);this.prepareKeywordsParam();a=this.buildURLFromBaseAdvert();return a};FT.Advertising.prototype.buildURLForVideo=function(d,f,c){f=f||"video";c=c||{};var e="video",b,a;FT.env.dfp_zone=d;if(this.checkSiteZone(f)==="invalid"){return b}this.adverts[f]=this.adverts[f]||{};this.adverts[f].callType=e;this.clearBaseAdvert();this.prepareBaseAdvert(f);b=this.buildURLFromBaseAdvert(e);a={urlStem:b,additionalAdTargetingParams:this.encodeBaseAdvertProperties("videoExtra",c)};this.addDiagnostic(f,a);return a};FT.Advertising.prototype.requestInsertedAds=function(){clientAds.log("FT.Advertising.requestInsertedAds()");var a=this.extraAds.shift();while(a){this.request(a);a=this.extraAds.shift()}};FT.Advertising.prototype.requestNewssubs=function(){this.request("newssubs")};FT.Advertising.prototype.collapse=function(e,a){var c=a?"no ad booked but interstitial present":"no ad booked";c=this.adverts[e].state.alwaysHide?"position is always hidden":c;clientAds.log("FT.Advertising.collapse("+e+", "+a+") - "+c);var b=this.legacyAdCollapse(e,a);if(b){var d=this.getAdContainer(e);if(d.div){if(a){d.div.style.display="block"}else{d.div.style.display="none"}if(typeof(FT.lib.addClassName)!=="function"){$(document.body).addClass("no-"+d.name)}else{FT.lib.addClassName(document.body,"no-"+d.name)}}}else{c="collapse prevented by legacy handler"}this.addDiagnostic(e,{"collapsed":c})};FT.Advertising.prototype.setZeroHeight=function(c,b){var a=document.getElementById(b);if(a){a.style.height=0;a.style.padding=0}else{clientAds.log("FT.Advertising.setZeroHeight("+b+") - div not found");this.addDiagnostic(c,{"setZeroHeight":"div not found: "+b})}};FT.Advertising.prototype.legacyAdCollapse=function(g,c){var f=true,e,b,a,d;if(FT.env.isLegacyAPI){if(this.adverts[g].state.alwaysHide){clientAds.log("FT.Advertising.legacyAdCollapse("+g+", "+c+") for "+this.library+" always hide");d=document.getElementById("ad-container-"+g);if(d){d.style.display="none"}}if(g==="lhn"){f=false}if(g==="banlb"){clientAds.log("FT.Advertising.legacyAdCollapse("+g+", "+c+") for "+this.library);e=document.getElementById("leaderboard");if(e){e.style.minHeight=0}b=["ad-placeholder-banlb","page-header-ad"];for(a=0;a<b.length;++a){this.setZeroHeight(g,b[a])}}}if(!f){clientAds.log("FT.Advertising.legacyAdCollapse("+g+", "+c+") for "+this.library+" ad position collapse prevented")}return f};FT.Advertising.prototype.legacyAdFixup=function(b,a){if(this.library==="ftcombase"&&a.div.id==="ad-placeholder-hlfmpu"){clientAds.log("FT.Advertising.legacyAdFixup("+b+", "+a.div.id+") for "+this.library);a.div.style.padding="14px 0 14px 0";a.div.style.marginBottom=15+"px";a.div.style.border="solid 1px #999"}if(this.library==="phoenix"&&a.div.id==="ad-placeholder-hlfmpu"){clientAds.log("FT.Advertising.legacyAdFixup("+b+", "+a.div.id+") for "+this.library);a.div.style.padding="14px 0 14px 0";a.div.style.marginBottom=15+"px";a.div.style.marginLeft=0;a.div.style.paddingLeft=0}if(this.library==="ftcombase"&&a.div.id==="ad-placeholder-tradcent"){clientAds.log("FT.Advertising.legacyAdFixup("+b+", "+a.div.id+") for "+this.library);a.div.style.marginBottom=15+"px"}if(this.library==="ftcombase"&&a.div.id==="ad-placeholder-tlbxrib"){clientAds.log("FT.Advertising.legacyAdFixup("+b+", "+a.div.id+") for "+this.library);a.div.style.marginBottom=15+"px"}if(this.library==="ftcombase"&&a.div.id==="ad-placeholder-marketingrib"){clientAds.log("FT.Advertising.legacyAdFixup("+b+", "+a.div.id+") for "+this.library);a.div.className="";a.div.style.marginBottom=15+"px"}};FT.Advertising.prototype.expand=function(b){clientAds.log("FT.Advertising.expand("+b+")");var a=this.getAdContainer(b);if(a.div){this.legacyAdFixup(b,a);if(!a.div.className.match(/\bhidden\b/)){a.div.style.display="block"}if(typeof FT.lib.removeClassName!=="function"){$(document.body).removeClass("no-"+a.name)}else{FT.lib.removeClassName(document.body,"no-"+a.name)}}};FT.Advertising.prototype.getNamedAdContainer=function(e,g){clientAds.log("FT.Advertising.getNamedAdContainer("+e+") -- looking");var d=document.getElementById(e),f,b,c,a;clientAds.log("FT.Advertising.getNamedAdContainer("+e+") -- got -- "+d);if(d){clientAds.log("FT.Advertising.getNamedAdContainer("+e+")");f=3;b=0;c=d;a=d;while(b<=f&&typeof c.className==="string"&&this.hasAdClass(c,g)===false){c=c.parentNode;b++}d=(c.className&&this.hasAdClass(c,g)===true)?c:a}return d};FT.Advertising.prototype.getAdContainer=function(b){var a=this.getAdContainers(b);if(a.length===0){this.addDiagnostic(b,{"getAdContainer":"div not found"});a=[{"div":null,"name":null}]}return a[0]};FT.Advertising.prototype.getAdContainers=function(f){var e=[],b,a,c,d;b=FT.env.isLegacyAPI?this.CONST.proxy_div_prefixes.length:1;for(a=0;a<b;++a){c=this.CONST.proxy_div_prefixes[a]+f;if(!(FT.env.isLegacyAPI&&c==="lhn")){d=this.getNamedAdContainer(c,f);if(d){e.push({"div":d,"name":c})}}}return e};FT.Advertising.prototype.getAdInnerHTML=function(c){var a,b;b=this.getAdContainers(c);if(b.length!==0){a="";this.foreach(b,function(d){if(a.length){a=a+"\n"}a=a+"<!-- "+d.name+" -->\n"+d.div.innerHTML})}else{this.addDiagnostic(c,{"getAdInnerHTML":"div not found"})}return a};FT.Advertising.prototype.hasAdClass=function(a,b){clientAds.log("FT.Advertising.hasAdClass("+a+")");if(FT.env.isLegacyAPI){if(this.hasClassName(a.className,new RegExp("^ad-(container|placeholder)(-"+b+")?$"))){return true}}else{if(this.hasClassName(a.className,"advertising")){return true}}return false};FT.Advertising.prototype.startRefreshTimer=function(a){clientAds.log("FT.Advertising.startRefreshTimer("+a+")");this.refreshTimer=setTimeout(function(){clientAds.log("refreshTimer callback()");doTrackRefresh(a)},a)};FT.Advertising.prototype.renderImage=function(b){clientAds.log("FT.Advertising.renderImage("+b+")");if(FT.lib.type(b)!=="object"||!b.content||!b.content.clickURL||!b.content.imageURL){this.addDiagnostic(b.name,{"noImageClickContent":true});return false}var d=document.getElementById(b.name);if(!d){this.addDiagnostic(b.name,{"noTargetDiv":true});return false}var e=document.createElement("a");e.href=b.content.clickURL;e.target="_blank";var a=document.createElement("img");if(b.content.altText){a.alt=b.content.altText}if(b.content.width){a.width=b.content.width}if(b.content.height){a.height=b.content.height}a.src=b.content.imageURL;e.appendChild(a);var c=b.name+"_imageclick_placeholder";var f=document;f.write('<span style="display:none" id="'+c+'"></span>');var g=document.getElementById(c);if(g.parentNode.insertBefore(e,g)){this.addDiagnostic(b.name,{"rendered":"fromJSON"})}g.parentNode.removeChild(g);if(b.content.height&&a.height<d.offsetHeight){e.style.marginTop=((d.offsetHeight-a.height)/2)+"px";e.style.display="block";this.addDiagnostic(b.name,{"verticallyAligned":true})}this.expand(b.name)};FT.Advertising.prototype.toBase36=function(a){return parseInt(a,10).toString(36)};FT.Advertising.prototype.fromBase36=function(a){return parseInt(a,36)};FT.Advertising.prototype.encodeAudSci=function(c){var b=c.match(/^([A-L]\d{5})_(\d{5})$/i),a;if(b){a=parseInt(b[2],10)-10000;if(/^J07717$/i.test(b[1])){return"z"+a}else{return b[1].charAt(0).toLowerCase()+this.toBase36(a+b[1].substring(1))}}return c.toUpperCase()};FT.Advertising.prototype.decodeAudSci=function(d){if(d.charAt(0).toLowerCase()==="z"){return"J07717_"+(parseInt(d.substring(1),10)+10000)}else{var c=this.fromBase36(d.substring(1)).toString(),b=parseInt(c.slice(0,-5),10)+10000,a=d.charAt(0).toUpperCase()+c.substring(c.length-5);return a+"_"+b}};FT.Advertising.prototype.beginNewPage=function(b){clientAds.log("FT.Advertising.beginNewPage()");b=b||FT.env;this.baseAdvert={};this.baseAdvert.ord=Math.floor(Math.random()*10000000000000000);this.baseAdvert.tile=1;this.extraAds=[];var e=this.getVideoAdverts(),d=this.getVideoSyncAdverts(),a,c;if(e.length||d.length){this.foreach(e,function(f){delete this.adverts[f]});this.foreach(d,function(f){delete this.adverts[f]})}else{this.adverts={}}this.isComplete=false;this.timeouts={};this.intervals={};this.runinterval=undefined;this.refreshTimer=null;this.timeoutTolerance=FT.env.timeoutTolerance||25;this.timeIntervalTolerance=FT.env.timeIntervalTolerance||300;this.suppressAudSci=false;a=this.getCookie("FTQA");if(a){c=a.match(/timeout=(\d+)/);if(c){this.timeoutTolerance=c[1]}c=a.match(/interval=(\d+)/);if(c){this.timeIntervalTolerance=c[1]}c=a.match(/longest_url=(\d+)-(\d+)/);if(c){this.CONST.urlThreshold=c[1];this.CONST.urlThresholdMax=c[2]}c=a.match(/ord=(\d+)/);if(c){this.baseAdvert.ord=c[1]}c=a.match(/noaudsci/);if(c){this.suppressAudSci=true}clientAds.log("Configured from Cookies:");clientAds.log("timeoutTolerance: "+this.timeoutTolerance);clientAds.log("timeIntervalTolerance: "+this.timeIntervalTolerance);clientAds.log("urlThreshold: "+this.CONST.urlThreshold);clientAds.log("urlThresholdMax: "+this.CONST.urlThresholdMax);clientAds.log("ord: "+this.baseAdvert.ord);clientAds.log("noaudsci: "+this.suppressAudSci)}this.baseAdvert.hasInterstitial=false;this.submitToTrack=false;this.useDFP=true;this.library="ftcombase";b.useDFP=true};FT.Advertising.prototype.resetLibrary=function(){this.beginNewPage();this.adverts={}};FT.Advertising.prototype.checkAdServerCountry=function(a){return this.CONST.AD_SERVERS.test(a)};FT.Advertising.prototype.adServerCountry=function(a,c){var b="";if(a){a=a.toLowerCase();if(this.checkAdServerCountry(a)){a=a.toLowerCase();b=a+"."}else{if(a==="gb"||a==="gg"||a==="im"||a==="je"){b="uk."}else{this.addDiagnostic(c,{"adServerCountry":"Unsupported ad server: "+a})}}}return"ad."+b+"doubleclick.net"};FT.Advertising.prototype.detectERights=function(c){if(FT.cookies.FT_U!==undefined){var b=FT.cookies.FT_U.split("=");var a=b[0];var d=b[1];if((a!==undefined)&&(d===undefined)){c[a]=d;c.u=b}}return c};FT.Advertising.prototype.behaviouralFlag=function(){var a=(typeof this.rsiSegs()==="undefined")?"false":"true";return a};FT.Advertising.prototype.excludeFields=function(b,c){var a,d;this.foreach(c,function(e){for(a=0;a<b.length;a++){d=b[a].split("=");if(((d[0]==="key")&&(e===d[1]))||((d[0]==="val")&&(c[e]===d[1]))){delete c[e]}}});return c};FT.Advertising.prototype.stripLeadingZeros=function(c,d){var a,b;for(a=0,b=c.length;a<b;a++){if(d[c[a]]){d[c[a]]=d[c[a]].replace(/^0+/,"")}}return d};FT.Advertising.prototype.fieldRegex=function(a,b){this.foreach(a,function(c){var d=b[c];if(d!==undefined){this.foreach(this.CONST.SubsLevelReplaceLookup,function(e,f){if(d.match(f)){b.slv=e}})}});return b};FT.Advertising.prototype.fieldSubstr=function(a,b){this.foreach(a,function(d){var c=d.split("="),g=c[0],f=b[g],e;if(f!==undefined){e=c[3];b[e]=f.substring(c[1],c[2])}});return b};FT.Advertising.prototype.getDFPSite=function(){var a=FT.env.dfp_site;if(FT.Properties&&FT.Properties.ENV){var c=FT.Properties.ENV.toLowerCase();var b=this.getCookie("FTQA");if(b){if(b.match(/env=live/)){c="live";clientAds.log("FTQA cookie has set ads from live environment");this.addDiagnostic(this.baseAdvert.pos,{"getDFPSite":"using FTQA cookie to set ads from live environment"})}if(b.match(/env=nolive/)){c="ci";clientAds.log("using FTQA cookie has set ads from non-live environment");this.addDiagnostic(this.baseAdvert.pos,{"getDFPSite":"using FTQA cookie to set ads from non-live environment"})}}if(c!=="p"&&!c.match(/^live/)){a=a.replace(/^\w+\./,"test.")}}return a};FT.Advertising.prototype.showDiagnostics=function(c){var b=["FT.ads.showDiagnostics:\n"],a=this.getKeys(this.adverts);this.foreach(a,function(e){var d=this.adverts[e],h,f,i,g;if(typeof d==="object"&&(!c||e===c)){h=[];if(d.diagnostics){f=d.diagnostics;i=this.getKeys(f);this.foreach(i,function(j){if(typeof f[j]!=="function"){h.push("    "+j+": "+f[j])}})}g=h.join("\n");if(g.length){if(!e.match(/^_/)){e=e+" Ad Call";if(d.response&&d.response.adName){g="    "+d.response.adName+"\n"+g}}b.push(e+":\n"+g+"\n")}}});return b.join("\n")};FT.Advertising.prototype.breakout=function(rResponse){var pause=true,cookie=this.getCookie("FTQA"),break_if;if(cookie){cookie=cookie.replace(/%3D/g,"=");if(rResponse&&rResponse.name){pause=false;break_if="breakout="+rResponse.name;if(cookie&&(cookie.match(/breakout=all/)||cookie.indexOf(break_if)>=0)){pause=true}}if(pause){eval("debugger")}}};FT.Advertising.prototype.detectDFPTargeting=function(a){a=a||FT.env;return a.dfp_site&&a.dfp_zone?true:false};FT.Advertising.prototype.detectAdMode=function(a){a=a||FT.env;a.useDFP=true;return a.useDFP};FT.Advertising.prototype.initDFP=function(a){clientAds.log("FT.Advertising.initDFP() - top");a=a||FT.env;this.hasCalledInitDFP=true;if(a.useDFP!==undefined){this.beginNewPage(a)}else{a.useDFP=true;clientAds.log("FT.ads.initDFP() - setup DFP");FT.Advertising.prototype.request=FT.Advertising.prototype.requestDFP;this.beginNewPage(a)}};FT.Advertising.prototype.getLongestUrl=function(){var b=this.getKeys(this.adverts),c,a=0;this.foreach(b,function(g){var d=this.adverts[g],e,f;if(typeof d==="object"){e=d.diagnostics;if(e&&e.requestUrl){f=e.requestUrl.replace(/^http:\/\/[^\/]+\.net/,"");if(f.length>a){a=f.length;c=f}}}});return c};FT.Advertising.prototype.shouldSubmitToTrack=function(){if(!this.submitToTrack){var a=Math.floor(Math.random()*this.CONST.urlThresholdMax);if(a<this.CONST.urlThreshold){this.submitToTrack=true}}return this.submitToTrack};FT.Advertising.prototype.checkSubmitLongestUrl=function(){if(this.shouldSubmitToTrack()){return this.getLongestUrl()}else{return undefined}};FT.Advertising.prototype.injectUrlTrackCall=function(){var a=this.checkSubmitLongestUrl(),b;if(a&&document.createElement){clientAds.log("Injecting call to track long URL:"+a);b=document.createElement("img");b.src=this.CONST.trackUrl+"?long_url="+a;b.id="injectUrlTrackCall";b.setAttribute("style","display:none");document.getElementsByTagName("body")[0].appendChild(b)}return a};FT.Advertising.prototype.injectUnclassifiedTrackCall=function(){var a,b;if(this.isUnclassified()){if(this.shouldSubmitToTrack()&&document.createElement){a=document.location;clientAds.log("Injecting call to track unclassified page URL:"+a);b=document.createElement("img");b.src=this.CONST.trackUrl+"?unclassified="+a;b.id="injectUnclassifiedTrackCall";b.setAttribute("style","display:none");document.getElementsByTagName("body")[0].appendChild(b)}}return a};var AD_BANLB="banlb";var AD_NEWSSUBS="newssubs";var AD_MPU="mpu";var AD_HLFMPU="hlfmpu";var AD_MPUSKY="mpusky";var AD_OOB="oob";var AD_CORPPOP="corppop";var AD_REFRESH="refresh";var AD_TLBXRIB="tlbxrib";var AD_MARKETINGRIB="marketingrib";var AD_INTRO="intro";var AD_TRADCENT="tradcent";var AD_DOUBLET="doublet";var AD_WDESKY="wdesky";var AD_LHN="lhn";var AD_MACROAD="deadA";var AD_HMMPU="deadB";var AD_MARKETING="deadC";var AD_NRWSKY="deadD";var AD_ARTBOX="deadE";var AD_FTHBOX="deadF";var AD_TLBX="deadG";var AD_FMBUT2="deadH";var AD_MKTBX="deadI";var AD_POP="deadJ";var AD_BXBAR="deadK";var AD_DKTALRT="deadL";var AD_DSKTICK="deadM";var AD_PRNT="deadN";var AD_INV="deadO";var AD_MBATOP="deadP";var AD_MBABOT="deadQ";var AD_MBALINK="deadR";var AD_SBHEAD="deadS";var AD_FTNT="deadT";var AD_1x1="deadU";var AD_CURRCON="deadV";var AD_CURRBOX="deadW";clientAds={"debug":null,"render":function(a){if(a){this.log("clientAds.render("+a+") = NOP")}else{this.log("clientAds.render("+a+") = FT.ads.requestInsertedAds() "+(FT.env.useDFP?"[DFP]":"[DE]"));FT.ads.requestInsertedAds();FT.ads.complete()}},"fetch":function(a){this.log("clientAds.fetch("+a+") = NOP")},"log":function(a){if(this.debug===null){this.debug=false;if(FT.cookies.FTQA&&FT.cookies.FTQA.match(/debug/)){this.debug=true}}if(this.debug){if(window.console&&window.console.log){window.console.log(a)}else{if(window.opera){window.opera.postError(a)}}}},"showCookies":function(a){return"Cookies:\n"+document.cookie.split(";").sort().join(";\n")}};function Advert(b){clientAds.log("new Advert("+b+")");FT.env.isLegacyAPI=true;var a={"name":b,"init":function(){clientAds.log("Advert.init("+this.name+") = FT.ads.request("+this.name+") "+(FT.env.useDFP?"[DFP]":"[DE]"));FT.ads.request(this.name)}};if(!FT.ads.hasCalledInitDFP){FT.ads.initDFP()}return a}FT.Advertising.prototype.VERSION="Live $Rev: 126613 $";FT.Advertising.prototype.library="ftcombase";clientAds.log("DFP Ads: "+FT.Advertising.prototype.library.toUpperCase()+" "+FT.Advertising.prototype.VERSION);