
/* Comment Generated by Combres - Resource '~/js/atooltip.jquery.js' (Mode: Static) */
/*
jQuery Version:				jQuery 1.3.2
Plugin Name:				aToolTip V 1.0
Plugin by: 					Ara Abcarians: http://ara-abcarians.com
License:					aToolTip is licensed under a Creative Commons Attribution 3.0 Unported License
Read more about this license at --> http://creativecommons.org/licenses/by/3.0/			
*/
/*
Updated to remove any left over dialog elements just incase the toolTip wasnt closed before another was opened.
*/
(function ($) {
    $.fn.aToolTip = function (options) {

        // setup default settings
        var defaults = {
            clickIt: false,
            closeTipBtn: 'aToolTipCloseBtn',
            fixed: false,
            inSpeed: 400,
            outSpeed: 100,
            tipContent: '',
            toolTipClass: 'aToolTip',
            xOffset: 5,
            yOffset: 5,
            noHover: true,
            onShow: null,
            onHide: null
        },

        // This makes it so the users custom options overrides the default ones
    	settings = $.extend({}, defaults, options);

        return this.each(function () {
            var obj = $(this);

            // check for image attr as tooltip content
            if (obj.attr('x:image')) {
                // set the tooltip content an image
                var tipContent = '<img src="' + obj.attr('x:image') + '">';
            }
            // Decide weather to use a title attr as the tooltip content
            else if (obj.attr('title')) {
                // set the tooltip content/text to be the obj title attribute
                var tipContent = obj.attr('title');
            } else {
                // if no title attribute set it to the tipContent option in settings
                var tipContent = settings.tipContent;
            }

            // remove the title on hover
            if (tipContent && settings.noHover) {
                obj.hover(function (el) { $(this).attr({ title: '' }); });
            }

            // check if obj has a title attribute and if click feature is off
            if (tipContent && !settings.clickIt) {
                // Activate on hover	
                obj.hover(function (el) {
                    obj.attr({ title: '' });
                    // Cleanup any dialogs before creating a new one
                    $('.' + settings.toolTipClass).remove();
                    $('body').append("<div class='" + settings.toolTipClass + "'><p class='aToolTipContent'>" + tipContent + "</p></div>");

                    // determine how to position the tooltip in relation to the viewport offset
                    var topPos;
                    if ($('div.' + settings.toolTipClass).height() > obj.offset().top - $(window).scrollTop())
                        topPos = (el.pageY + settings.yOffset) + 'px';
                    else
                        topPos = (obj.offset().top - $('.' + settings.toolTipClass).outerHeight() - settings.yOffset) + 'px';

                    $('.' + settings.toolTipClass).css({
                        position: 'absolute',
                        display: 'none',
                        zIndex: '50000',
                        top: topPos,
                        left: (obj.offset().left + obj.outerWidth() + settings.xOffset) + 'px'
                    })
					.stop().fadeIn(settings.inSpeed, function () {
					    if ($.isFunction(settings.onShow)) {
					        settings.onShow.call(this);
					    }
					});
                },
				function () {
				    // Fade out
				    $('.' + settings.toolTipClass).stop().fadeOut(settings.outSpeed, function () {
				        $(this).remove();
				        if ($.isFunction(settings.onHide)) {
				            settings.onHide.call(this);
				        } 
				    });
				});
            }

            // Follow mouse if fixed is false and click is false
            if (!settings.fixed && !settings.clickIt) {
                obj.mousemove(function (el) {
                    $('.' + settings.toolTipClass).css({
                        top: (el.pageY - $('.' + settings.toolTipClass).outerHeight() - settings.yOffset),
                        left: (el.pageX + settings.xOffset)
                    })
                });
            }

            // check if click feature is enabled
            if (tipContent && settings.clickIt) {
                // Activate on click	
                obj.click(function (el) {
                    obj.attr({ title: '' });
                    // Cleanup any dialogs before creating a new one
                    $('.' + settings.toolTipClass).remove();
                    $('body').append("<div class='" + settings.toolTipClass + "'><p class='aToolTipContent'>" + tipContent + "</p></div>");
                    $('.' + settings.toolTipClass).css("position", "absolute").append("<a class='" + settings.closeTipBtn + "' href='#' alt='close'>close</a>");

                    // determine how to position the tooltip in relation to the viewport offset
                    var topPos;
                    if ($('div.' + settings.toolTipClass).height() > obj.offset().top - $(window).scrollTop())
                        topPos = ((el.pageY || 0) + settings.yOffset) + 'px';
                    else
                        topPos = (obj.offset().top - $('.' + settings.toolTipClass).outerHeight() - settings.yOffset) + 'px';

                    var leftPos = obj.offset().left + obj.outerWidth() + settings.xOffset - 8;
                    var toolTipWidth = $('.' + settings.toolTipClass).outerWidth();
                    var pageWidth = $('body').width();
                    if ((leftPos + toolTipWidth) > pageWidth) {
                        if (settings.xOffset > 0) {
                            leftPos = obj.offset().left - $('.' + settings.toolTipClass).outerWidth() - settings.xOffset;
                        } else {
                            leftPos = obj.offset().left - $('.' + settings.toolTipClass).outerWidth() + obj.outerWidth();
                        }
                    }

                    $('.' + settings.toolTipClass).css({
                        position: 'absolute',
                        display: 'none',
                        zIndex: '50000000',
                        top: topPos,
                        left: leftPos + 'px'
                    })
					.fadeIn(settings.inSpeed, function () {
					    if ($.isFunction(settings.onShow)) {
					        settings.onShow.call(this);
					    }
					});
                    // Click to close tooltip
                    $('.' + settings.closeTipBtn).click(function () {
                        $('.' + settings.toolTipClass).fadeOut(settings.outSpeed, function () {
                            if ($.isFunction(settings.onHide)) {
                                settings.onHide.call(this);
                            }
                            $(this).remove();
                        });
                        return false;
                    });
                    return false;
                });
            }

        }); // END: return this

        // returns the jQuery object to allow for chainability.  
        return this;
    };
})(jQuery);;


/* Comment Generated by Combres - Resource '~/js/jquery.ymm.js' (Mode: Static) */
(function ($) {
    $.fn.ymm = function (options) {
        var i = 0;
        var settings = {
            yrurl: '/jsdata/' + assemblyVersion + "_" + dataVersionId + '/_years',
            mkurl: '/jsdata/' + assemblyVersion + "_" + dataVersionId + '/_makes',
            mdurl: '/jsdata/' + assemblyVersion + "_" + dataVersionId + '/_models',
            mkmdurl: '/jsdata/' + assemblyVersion + "_" + dataVersionId + '/_makesmodels',
            yearId: 0,
            makeId: 0,
            modelId: 0,
            vehicleClass: '',
            filterByCPO: false,
            hasNCBBPrice: false,
            filter: '',
            priceMin: '',
            priceMax: '',
            categoryId: 0
        };
        if (options) {
            $.extend(settings, options);
        }

        $('#Ymm .btn-form').attr('href', '#');
        return this.each(function () {
            var $self = $(this);
            // stupid ie7 - fix caching of result, preventing jsonp callback from being fired - doesnt happen when pointing to akamai, which has max-age=1
            var rand = Math.round(new Date().getTime());
            var parentformid = $self.closest("form").attr("id").replace(new RegExp("-", 'g'), "").toLowerCase() + rand;
            var $year = $self.find('select:eq(0)');
            var $make = $self.find('select:eq(1)');
            var $model = $self.find('select:eq(2)');
            // Get years
            $year.empty().append('<option value="">Year</option>');
            $make.empty().append('<option value="">Make</option>').prop('disabled', 'disabled');
            $model.empty().append('<option value="">Model</option>').prop('disabled', 'disabled');

            KBB.cache.ajaxGet(settings.yrurl,
                { vehicleclass: settings.vehicleClass, filterbycpo: settings.filterByCPO, hasNCBBPrice: settings.hasNCBBPrice },
                function (data) {
                    $(data).each(function () {
                        $year.append($('<option value="' + this.Name + '" oid="' + this.Id + '">' + this.Name + '</option>').data('year', this));
                    });
                    var val = $year.find('option[oid="' + settings.yearId + '"]').val();
                    try {
                        $year.val(val);
                    }
                    catch (ex) {
                        setTimeout("$('" + $year + "').val('" + val + "')", 1000);
                    }
                });

            if (settings.yearId > 0) {
                $make.empty().append('<option value="">Make</option');
                KBB.cache.ajaxGet(settings.mkurl,
                    { vehicleclass: settings.vehicleClass, yearid: settings.yearId, filterbycpo: settings.filterByCPO, filter: settings.filter, priceMin: settings.priceMin, priceMax: settings.priceMax, categoryId: settings.categoryId, hasNCBBPrice: settings.hasNCBBPrice },
                    function (data) {
                        $(data).each(function () {
                            $make.append($('<option value="' + this.Name + '" oid="' + this.Id + '">' + this.Name + '</option>').data('make', this));
                        });
                        $make.prop('disabled', '');
                        var val = $make.find('option[oid="' + settings.makeId + '"]').val();
                        try {
                            $make.val(val);
                        }
                        catch (ex) {
                            setTimeout("$('" + $make + "').val('" + val + "')", 1000);
                        }
                    });

                if (settings.makeId > 0) {
                    $model.empty().append('<option value="">Model</option');
                    KBB.cache.ajaxGet(settings.mdurl,
                        { vehicleclass: settings.vehicleClass, yearid: settings.yearId, makeid: settings.makeId, filterbycpo: settings.filterByCPO, filter: settings.filter, priceMin: settings.priceMin, priceMax: settings.priceMax, categoryId: settings.categoryId, hasNCBBPrice: settings.hasNCBBPrice },
                        function (data) {
                            $(data).each(function () {
                                $model.append($('<option value="' + this.Name + '" oid="' + this.Id + '">' + this.Name + '</option>').data('model', this));
                            });
                            $model.prop('disabled', '');
                            var val = $model.find('option[oid="' + settings.modelId + '"]').val();
                            try {
                                $model.val(val);
                            }
                            catch (ex) {
                                setTimeout("$('" + $model + "').val('" + val + "')", 1000);
                            }
                        });
                }
            }
            // Get makes
            $year.unbind('change').change(function () {
                $make.empty().append('<option value="">Make</option>').prop('disabled', 'disabled');
                $model.empty().append('<option value="">Model</option>').prop('disabled', 'disabled');
                if ($year.val() == '')
                    return;

                KBB.cache.ajaxGet(settings.mkmdurl,
                    { vehicleclass: settings.vehicleClass, yearid: $year.find('option:selected').data('year').Id, filterbycpo: settings.filterByCPO, filter: settings.filter, priceMin: settings.priceMin, priceMax: settings.priceMax, categoryId: settings.categoryId, hasNCBBPrice: settings.hasNCBBPrice },
                    function (data) {
                        $(data).each(function () {
                            $make.append($('<option value="' + this.Name + '" oid="' + this.Id + '">' + this.Name + '</option>').data('make', this));
                        });
                        $make.prop('disabled', '');
                    });
            });
                // set dropdown boxes to auto-width for all IE lt 9.0
                if (IElte8) {
                    $('select', $self).each(function (e) {
                        $(this).data("orig-width", $(this).outerWidth());
                    }).on({
                        mousedown: function () {
                            var el = $(this),
                            width = el.data("orig-width") || 0;
                            /* When the drop down is not visible/rendered on the dom... then we will would have set a 5px outerWidth */
                            if (width <= 5) {
                                el.data("orig-width", el.outerWidth());
                            }
                            el.css("width", "auto");
                        },
                        blur: function () {
                            $(this).css("width", $(this).data("orig-width"));
                        },
                        change: function () {
                            $(this).blur()
                        }
                    });
                }
                // Get makes
            $make.unbind('change').change(function () {
                $model.empty().append('<option value="">Model</option>').prop('disabled', 'disabled');
                if ($make.val() == '')
                    return;
                KBB.cache.ajaxGet(settings.mkmdurl,
                    { vehicleclass: settings.vehicleClass, yearid: $year.find('option:selected').data('year').Id, filterbycpo: settings.filterByCPO, filter: settings.filter, priceMin: settings.priceMin, priceMax: settings.priceMax, categoryId: settings.categoryId, hasNCBBPrice: settings.hasNCBBPrice },
                    function (data) {
                        var makeid = $make.find('option:selected').data('make').Id;
                        $(data).each(function () {
                            if (this.Id == makeid) {
                                var modlist = this.Model;
                                $(modlist).each(function () {
                                    $model.append($('<option value="' + this.Name + '" oid="' + this.Id + '">' + this.Name + '</option>').data('model', modlist));
                                });
                                return false;
                            }
                        });
                        $model.prop('disabled', '');
                    });
            });
        });
    };
})(jQuery); 
;


/* Comment Generated by Combres - Resource '~/js/jquery.mmy.js' (Mode: Static) */
(function ($) {
    $.fn.mmy = function (options) {
        var settings = {
            mkurl: '/jsdata/' + assemblyVersion + "_" + dataVersionId + '/_makes',
            mdyrurl: '/jsdata/' + assemblyVersion + "_" + dataVersionId + '/_modelsyears',
            atcmkurl: '/cars-for-sale/services/' + assemblyVersion + '/_atcmakes/',
            atcmdurl: '/cars-for-sale/services/' + assemblyVersion + '/_atcmodels/',
            yearId: 0,
            makeId: 0,
            modelId: 0,
            vehicleId: 0,
            atcmakecode: '',
            atcmodelcode: '',
            vehicleClass: '',
            defaultFirstYear: true,
            defaultFirstTrim: true,
            filterByCPO: false,
            hasNCBBPrice: false,
            includeYear: true,
            includeTrim: false,
            makeDefault: 'Make',
            modelDefault: 'Model',
            yearDefault: 'Year',
            trimDefault: 'Style',
            useStyledDropdowns: true, /* Used for dtyled drop downs that got reverted */
            useAtcData: false, /* for classifieds dropdowns to show ATC make/models */
            filter: '',
            priceMin: '',
            priceMax: '',
            categoryId: 0,
            includeDefaultVehicleId: false
        };

        if (options) {
            $.extend(settings, options);
        }
        var onModelsLoaded;
        return this.each(function () {
            var $self = $(this);
            // stupid ie7 - fix caching of result, preventing jsonp callback from being fired - doesnt happen when pointing to akamai, which has max-age=1
            var rand = Math.round(new Date().getTime());
            var parentformid = $self.closest("form").attr("id").replace(new RegExp("-", 'g'), "").toLowerCase() + rand;

            var $make = $self.find('select:eq(0)');
            var $model = $self.find('select:eq(1)');
            if (settings.includeYear) {
                var $year = $self.find('select:eq(2)');
            }
            if (settings.includeTrim) {
                var $trim = $self.find('select:eq(3)');
            }

            var hasmake = (!settings.useAtcData && settings.makeId != 0) || (settings.useAtcData && settings.atcmakecode != '');
            var hasmodel = (!settings.useAtcData && settings.modelId != 0) || (settings.useAtcData && settings.atcmodelcode != '');
            var hasyear = settings.yearId != 0;
            var hastrim = settings.vehicleId != 0;

            clearMakes();
            clearModels();
            if (settings.includeYear) {
                clearYears();
            }
            if (settings.includeTrim) {
                clearTrims();
            }

            KBB.events.on('Mmy.onMakesPopulated', function () {
                var makeId = (settings.useAtcData ? settings.atcmakecode : settings.makeId); ;

                if (hasmake)
                    setMake(makeId);

                KBB.events.on('Mmy.onModelsPopulated', function () {
                    var modelId = (settings.useAtcData ? settings.atcmodelcode : settings.modelId);
                    if (hasmodel)
                        setModel(modelId);

                    if (!settings.includeYear) return;

                    populateYears();

                    if (!hasyear && !settings.defaultFirstYear) return;

                    if (hasyear && $year.find('option[value=' + settings.yearId + ']').length) {
                        // only set year value if the value exists in the select
                        $year.val(settings.yearId);
                    }
                    else {
                        //defaultFirstYear
                        $year.find('option:eq(1)').prop('selected', 'selected');
                    }

                    if (!settings.includeTrim) return;

                    populateTrims();

                    if (hastrim || settings.defaultFirstTrim) {
                        if (hastrim) {
                            $trim.val(settings.vehicleId);
                        }
                        else {
                            $trim.find('option:eq(1)').prop('selected', 'selected');
                        }
                    }
                });
                populateModels();
            });
            populateMakes();

            // bind to makes
            $make.off('change.mmyevents')
                 .on('change.mmyevents', function (e) {
                     clearModels();
                     if (settings.includeYear) {
                         clearYears();
                     }
                     if (settings.includeTrim) {
                         clearTrims();
                     }
                     if ($make.val() == '') {
                         return;
                     }
                     populateModels();
                 });

            if (settings.includeYear) {
                // bind to models
                $model.off('change.mmyevents')
                      .on('change.mmyevents', function (e) {
                          clearYears();
                          if (settings.includeTrim) {
                              clearTrims();
                          }
                          if ($model.val() == '') {
                              return;
                          }
                          populateYears();
                          if (settings.includeTrim && $year.val() != '') {
                              populateTrims();
                          }
                      });

                if (settings.includeTrim) {
                    $year.off('change.mmyevents')
                         .on('change.mmyevents', function (e) {
                             clearTrims();
                             if ($year.val() == '') {
                                 return;
                             }
                             populateTrims();
                         });
                }
            }


            // set dropdown boxes to auto-width for all IE lt 9.0
            if (IElte8) {
                $('select', $self).each(function (e) {
                    $(this).data("orig-width", $(this).outerWidth());
                }).on({
                    mousedown: function () {
                        var el = $(this),
                            width = el.data("orig-width") || 0;
                        /* When the drop down is not visible/rendered on the dom... then we will would have set a 5px outerWidth */
                        if (width <= 5) {
                            el.data("orig-width", el.outerWidth());
                        }
                        el.css("width", "auto");
                    },
                    blur: function () {
                        $(this).css("width", $(this).data("orig-width"));
                    },
                    change: function () {
                        $(this).blur()
                    }
                });
            }

            function clearMakes() {
                $make.empty()
                     .append($('<option />').text(settings.makeDefault).val(''));
            }

            function clearModels() {
                $model.empty()
                      .append($('<option />').text(settings.modelDefault).val(''))
                      .prop('disabled', 'disabled');
            }

            function clearYears() {
                $year.empty()
                     .append($('<option />').text(settings.yearDefault).val(''))
                     .prop('disabled', 'disabled');
            }

            function clearTrims() {
                $trim.empty()
                     .append($('<option />').text(settings.trimDefault).val(''))
                     .prop('disabled', 'disabled');
            }

            function populateMakes() {
                KBB.cache.ajaxGet(settings.useAtcData ? settings.atcmkurl : settings.mkurl,
                    { vehicleclass: settings.vehicleClass, filterbycpo: settings.filterByCPO, filter: settings.filter, priceMin: settings.priceMin, priceMax: settings.priceMax, categoryId: settings.categoryId, hasNCBBPrice: settings.hasNCBBPrice },
                    function (data) {
                        $(data).each(function () {
                            $make.append($('<option value="' + (settings.useAtcData ? this.Id : this.Name) + '" oid="' + this.Id + '">' + this.Name + '</option>').data('make', this));
                        });
                        KBB.events.fire('Mmy.onMakesPopulated', data);
                    });
            }

            function setMake(makeId) {
                $make.find('option').each(function () {
                    var $this = $(this);
                    if ($this.data('make') && $this.data('make').Id == makeId) {
                        $this.prop('selected', 'selected');
                    }
                });
            }

            function populateModels() {
                if (!$make) return;
                var makeId = $make.find('option:selected').data('make');
                if (!makeId || !makeId.Id) return;
                KBB.cache.ajaxGet(settings.useAtcData ? settings.atcmdurl : settings.mdyrurl,
                    { vehicleclass: settings.vehicleClass, makeid: makeId.Id, filterbycpo: settings.filterByCPO, filter: settings.filter, priceMin: settings.priceMin, priceMax: settings.priceMax, categoryId: settings.categoryId, includeDefaultVehicleId: settings.includeDefaultVehicleId, includeTrims: settings.includeTrim, hasNCBBPrice: settings.hasNCBBPrice },
                    function (data) {
                        clearModels();
                        $(data).each(function () {
                            $model.append($('<option />').val((settings.useAtcData ? this.Id : this.Name).replace("&", "-"))
                                                        .text(this.Name)
                                                        .data('model', this));
                        });
                        $model.prop('disabled', '');
                        KBB.events.fire('Mmy.onModelsPopulated', data);
                    }, KBB.cache.persistMethods.LocalVariable);
            }

            function setModel(modelId) {
                $model.find('option').each(function () {
                    var $this = $(this);
                    if ($this.data('model') && $this.data('model').Id == modelId) {
                        $this.prop('selected', 'selected');
                    }
                });
            }

            function populateYears() {
                if (!$model) return;
                var data = $model.find('option:selected').data('model');
                if (!data) return;
                var tydata = data.Year;
                var ids = data.DefaultIds
                var trims = data.Trims;
                clearYears();
                $.each(tydata, function (i, val) {
                    var selected = (i == 0 && settings.defaultFirstYear ? "selected" : "");
                    var opt = $('<option />', { oid: val }).val(val)
                                                           .prop('selected', selected)
                                                           .text(val)
                                                           .data('year', tydata[i]);

                    if (settings.includeDefaultVehicleId && ids && ids.length) {
                        opt.data('vehicle-id', ids[i]);
                    }
                    if (settings.includeTrim) {
                        opt.data('trims', trims[i]);
                    }

                    $year.append(opt);
                });
                $year.prop('disabled', '');
            }

            function populateTrims() {
                $.each($year.find('option:selected').data('trims'), function (i, val) {
                    var selected = (i == 0 && settings.defaultFirstTrim ? "selected" : "");
                    $trim.append($('<option />').val(this.Id)
                                                .prop('selected', selected)
                                                .text(this.Name)
                                                .data('vehicle-id', this.Id));
                });
                $trim.prop('disabled', '');
            }
        });
    };
})(jQuery); 
;


/* Comment Generated by Combres - Resource '~/js/site-bottom.js' (Mode: Static) */
///<reference path="/js/jquery.resize.js" />

// CTA image fix for IE
jQuery.fn.ctaFix = function () {
    if ($.browser.msie && $.browser.version.substr(0, 1) > 6) { // including IE9 due to lack of gradient support
        return this.each(function () {
            $(this).find('.btn-main-cta, a.btn-secondary-cta').each(function () {
                if ($(this).hasClass('btn-cta-fix')) return;
                $(this).addClass('btn-cta-fix');
                var thisText = $(this).html();
                $(this).html("<b class='btn-left'></b><b class='btn-center'>" + thisText + "</b><b class='btn-right'></b>");
            });
        });
    }
}
jQuery.fn.clickable = function (options) {
    var defaultOptions = {
        'cursor': 'pointer',
        'executeEvents': false,
        'goToUrl': true,
        'stopLinkEventPropagation': false
    };
    var opts = $.extend({}, defaultOptions, options);

    return this.each(function () {
        var el = $(this);
        // custom hover disabled as it causes problems when hovering over an element before the page loads
        var defaultCss = {
            'cursor': el.css('cursor')
            /*'background-color': el.css('backgroundColor'),
            'background-image': el.css('backgroundImage'),
            'background-position': el.css('backgroundPosition')*/
        };
        var firstLink = el.find('a').eq(0);
        if (firstLink.length) {
            if (opts.stopLinkEventPropagation)
                firstLink.click(function (event) {
                    event.stopPropagation();
            });
            el.click(function () {
                if (opts.executeEvents) {
                    firstLink.click(function (event) {
                        event.stopPropagation();
                    }).click();
                }
                if (opts.goToUrl) {
                    var url = firstLink.attr('href');
                    window.location = url;
                }
            }).hover(function () {
                el.css(opts);
            }, function () {
                el.css(defaultCss);
            });

        } else {
            return;
        }
    });
}

jQuery.fn.hvCenter = function () {
    return this.each(function (fixed) {
        var el = $(this);
        var elH = el.outerHeight(), winTop = $(window).scrollTop(), winH = $(window).height(), closeH = el.find('.close').height();
        el.css({ 'top': (elH > winH) ? winTop + 14 + 'px' : winTop + ((winH / 2) - (elH / 2)) - closeH + 'px' });
    });
}

$(document).ready(function () {
    if ($.browser.msie) { $(document).ctaFix(); }
});

// display default text for text fields
$("input.input-text-default").each(function () {
    if ($(this).val() == $(this).attr('title')) {
        $(this).addClass("input-text-default-active");
    }
}).on({
    focus: function () {
        if ($(this).val() == $(this).attr('title')) {
            $(this).removeClass("input-text-default-active");
            $(this).val("");
        }
    },
    blur: function () {
        if ($(this).val() == "") {
            $(this).addClass("input-text-default-active");
            $(this).val($(this).attr('title'));
        }
    }
}).blur();

KBB.modules.footer = (function () {
    var kbbSearchTxt = $('#KBB-search-txt'),
        kbbSearchSubmit = $('#KBB-search-submit');

    return {
        init: function () {
            /* Wire up search bar */
            kbbSearchSubmit.click(this.search);
            kbbSearchTxt.on({
                click: function () {
                    if (kbbSearchTxt.val() == 'Find car values or features') {
                        kbbSearchTxt.val('');
                    }
                },
                blur: function () {
                    if (kbbSearchTxt.val() == '') {
                        kbbSearchTxt.val('Find car values or features');
                    }
                },
                keypress: function (e) {
                    if (e.keyCode == '13') {
                        KBB.modules.footer.search();
                    }
                }
            });
        },
        search: function () {
            PartnerLink('NX', 'search_' + s.pageName, '', kbbSearchSubmit);
            if (kbbSearchTxt.val() == 'Find car values or features') {
                kbbSearchTxt.val('');
            }
            var searchTerm = encodeURIComponent(jQuery.trim(kbbSearchTxt.val()));
            if (searchTerm == "") {
                alert("Please specify a search phrase and try again.");
                return false;
            }
            window.location.href = kbbSearchSubmit.attr('url') + "?query=" + searchTerm + '&source=' + s.pageName;
            return false;
        }
    }
})();

// alignColumnHeights();



$('a.clickTip-whyads, a.clickTip-whyads-rt').aToolTip({
    clickIt: true,
    closeTipBtn: 'tooltip-close',
    toolTipClass: 'ads',
    inSpeed: 100,
    outSpeed: 100,
    xOffset: $(this).hasClass('clickTip-whyads-rt') ? -320 : -205,
    yOffset: -5
});

$('b.clickTip').aToolTip({
    clickIt: true,
    closeTipBtn: 'tooltip-close',
    toolTipClass: 'generic',
    tipContent: 'default',
    inSpeed: 100,
    outSpeed: 100,
    xOffset: -5,
    yOffset: 0
});
;


/* Comment Generated by Combres - Resource '~/js/kbbdilv3_4.js' (Mode: Static) */
if("function"!=typeof DIL)DIL=function(a,b){var d=[],c,f;a!==Object(a)&&(a={});var e,h,j,o,p,s,l,t,y,B,w;e=a.partner;h=a.containerNSID;j=a.iframeAttachmentDelay;o=!!a.disableDestinationPublishingIframe;p=a.iframeAkamaiHTTPS;s=a.mappings;l=a.uuidCookie;t=!0===a.enableErrorReporting;y=a.visitorService;B=!0===a.disableScriptAttachment;w=!0===a.removeFinishedScriptsAndCallbacks;t&&DIL.errorModule.activate();(c=b)&&d.push(c+"");if(!e||"string"!=typeof e)return c="DIL partner is invalid or not specified in initConfig",
DIL.errorModule.handleError({name:"error",message:c,filename:"dil.js"}),Error(c);c="DIL containerNSID is invalid or not specified in initConfig, setting to default of 0";if(h||"number"==typeof h)h=parseInt(h,10),!isNaN(h)&&0<=h&&(c="");c&&(h=0,d.push(c),c="");f=DIL.getDil(e,h);if(f instanceof DIL&&f.api.getPartner()==e&&f.api.getContainerNSID()==h)return f;if(this instanceof DIL)DIL.registerDil(this,e,h);else return new DIL(a,"DIL was not instantiated with the 'new' operator, returning a valid instance with partner = "+
e+" and containerNSID = "+h);var u={IS_HTTPS:"https:"==document.location.protocol,POST_MESSAGE_ENABLED:!!window.postMessage,COOKIE_MAX_EXPIRATION_DATE:"Tue, 19 Jan 2038 03:14:07 UTC"},A={stuffed:{}},i={},n={firingQueue:[],fired:[],firing:!1,sent:[],errored:[],reservedKeys:{sids:!0,pdata:!0,logdata:!0,callback:!0,postCallbackFn:!0,useImageRequest:!0},callbackPrefix:"demdexRequestCallback",firstRequestHasFired:!1,useJSONP:!0,abortRequests:!1,num_of_jsonp_responses:0,num_of_jsonp_errors:0,num_of_img_responses:0,
num_of_img_errors:0,toRemove:[],removed:[],readyToRemove:!1,adms:{TIME_TO_CATCH_ALL_REQUESTS_RELEASE:2E3,calledBack:!1,uuid:null,noADMS:!1,instanceType:null,releaseType:"no ADMS",admsProcessingStarted:!1,process:function(g){try{if(!this.admsProcessingStarted){var a=this,k,b,c,d;if("function"==typeof g&&"function"==typeof g.getDefault&&"function"==typeof g.getInstance&&(y===Object(y)&&(k=y.namespace)&&"string"==typeof k?(this.instanceType="namespace: "+k,b=g.getInstance(k)):(this.instanceType="default",
b=g.getDefault()),b===Object(b)&&"function"==typeof b.getVisitorID)){this.admsProcessingStarted=!0;c=function(g){if("ADMS"!=a.releaseType)a.uuid=g,a.releaseType="ADMS",a.releaseRequests()};d=b.getVisitorID(c);if(-1==d){this.releaseType="failed ADMS";this.releaseRequests();return}if("string"==typeof d&&d.length){c(d);return}setTimeout(function(){if("ADMS"!=a.releaseType)a.releaseType="timeout",a.releaseRequests()},this.TIME_TO_CATCH_ALL_REQUESTS_RELEASE);return}this.noADMS=!0;this.releaseRequests()}}catch(e){this.releaseRequests()}},
releaseRequests:function(){this.calledBack=!0;n.registerRequest()}},registerRequest:function(g){var a=this.firingQueue;g===Object(g)&&a.push(g);if(!this.firing&&a.length)if(this.adms.calledBack){if(g=a.shift(),x.fireRequest(g),!this.firstRequestHasFired&&"script"==g.tag)this.firstRequestHasFired=!0}else this.processADMS()},processADMS:function(){this.adms.process(window.ADMS)},requestRemoval:function(g){if(!w)return"removeFinishedScriptsAndCallbacks is not boolean true";var a=this.toRemove,k,b;if(g===
Object(g))k=g.script,b=g.callbackName,(k===Object(k)&&"SCRIPT"==k.nodeName||"no script created"==k)&&"string"==typeof b&&b.length&&a.push(g);if(this.readyToRemove&&a.length){b=a.shift();k=b.script;b=b.callbackName;"no script created"!=k?(g=k.src,k.parentNode.removeChild(k)):g=k;window[b]=null;try{delete window[b]}catch(d){}this.removed.push({scriptSrc:g,callbackName:b});DIL.variables.scriptsRemoved.push(g);DIL.variables.callbacksRemoved.push(b);return this.requestRemoval()}return"requestRemoval() processed"}};
f=function(){var g="http://fast.";u.IS_HTTPS&&(g=!0===p?"https://fast.":"https://");return g+e+".demdex.net/dest4.html?d_nsid="+h+"#"+encodeURIComponent(document.location.href)};var v={THROTTLE_START:3E4,throttleTimerSet:!1,id:"destination_publishing_iframe_"+e+"_"+h,url:f(),iframe:null,iframeHasLoaded:!1,sendingMessages:!1,messages:[],messagesPosted:[],messageSendingInterval:u.POST_MESSAGE_ENABLED?15:100,jsonProcessed:[],attachIframe:function(){var g=this,a=document.createElement("iframe");a.id=
this.id;a.style.cssText="display: none; width: 0; height: 0;";a.src=this.url;m.addListener(a,"load",function(){g.iframeHasLoaded=!0;g.requestToProcess()});document.body.appendChild(a);this.iframe=a},requestToProcess:function(g){var a=this;g&&!q.isEmptyObject(g)&&this.process(g);if(this.iframeHasLoaded&&this.messages.length&&!this.sendingMessages){if(!this.throttleTimerSet)this.throttleTimerSet=!0,setTimeout(function(){a.messageSendingInterval=u.POST_MESSAGE_ENABLED?15:150},this.THROTTLE_START);this.sendingMessages=
!0;this.sendMessages()}},process:function(g){var a=encodeURIComponent,k,b,d,c,e;if((k=g.dests)&&k instanceof Array&&(b=k.length))for(d=0;d<b;d++)c=k[d],c=[a("dests"),a(c.id||""),a(c.y||""),a(c.c||"")],this.addMessage(c.join("|"));if((k=g.ibs)&&k instanceof Array&&(b=k.length))for(d=0;d<b;d++)c=k[d],c=[a("ibs"),a(c.id||""),a(c.tag||""),m.encodeAndBuildRequest(c.url||[],","),a(c.ttl||"")],this.addMessage(c.join("|"));if((k=g.dpcalls)&&k instanceof Array&&(b=k.length))for(d=0;d<b;d++)c=k[d],e=c.callback||
{},e=[e.obj||"",e.fn||"",e.key||"",e.tag||"",e.url||""],c=[a("dpm"),a(c.id||""),a(c.tag||""),m.encodeAndBuildRequest(c.url||[],","),a(c.ttl||""),m.encodeAndBuildRequest(e,",")],this.addMessage(c.join("|"));this.jsonProcessed.push(g)},addMessage:function(g){var a=encodeURIComponent;this.messages.push((t?a("---destpub-debug---"):a("---destpub---"))+g)},sendMessages:function(){var g=this,a;this.messages.length?(a=this.messages.shift(),DIL.xd.postMessage(a,this.url,this.iframe.contentWindow),this.messagesPosted.push(a),
setTimeout(function(){g.sendMessages()},this.messageSendingInterval)):this.sendingMessages=!1}},C={traits:function(g){if(q.isValidPdata(g)){if(!(i.sids instanceof Array))i.sids=[];m.extendArray(i.sids,g)}return this},pixels:function(g){if(q.isValidPdata(g)){if(!(i.pdata instanceof Array))i.pdata=[];m.extendArray(i.pdata,g)}return this},logs:function(g){if(q.isValidLogdata(g)){if(i.logdata!==Object(i.logdata))i.logdata={};m.extendObject(i.logdata,g)}return this},customQueryParams:function(g){q.isEmptyObject(g)||
m.extendObject(i,g,n.reservedKeys);return this},signals:function(g,a){var b,c=g;if(!q.isEmptyObject(c)){if(a&&"string"==typeof a)for(b in c={},g)g.hasOwnProperty(b)&&(c[a+b]=g[b]);m.extendObject(i,c,n.reservedKeys)}return this},result:function(g){if("function"==typeof g)i.callback=g;return this},afterResult:function(g){if("function"==typeof g)i.postCallbackFn=g;return this},useImageRequest:function(){i.useImageRequest=!0;return this},clearData:function(){i={};return this},submit:function(){x.submitRequest(i);
i={};return this},getPartner:function(){return e},getContainerNSID:function(){return h},getEventLog:function(){return d},getState:function(){var g={},a={};m.extendObject(g,n,{callbackPrefix:!0,useJSONP:!0,registerRequest:!0});m.extendObject(a,v,{attachIframe:!0,requestToProcess:!0,process:!0,sendMessages:!0});return{pendingRequest:i,otherRequestInfo:g,destinationPublishingInfo:a}},idSync:function(g){if(g!==Object(g)||"string"!=typeof g.dpid||!g.dpid.length)return"Error: config or config.dpid is empty";
if("string"!=typeof g.url||!g.url.length)return"Error: config.url is empty";var a=g.url,b=g.minutesToLive,c=encodeURIComponent,a=a.replace(/^https:/,"").replace(/^http:/,"");if("undefined"==typeof b)b=20160;else if(b=parseInt(b,10),isNaN(b)||0>=b)return"Error: config.minutesToLive needs to be a positive number";g=["ibs",c(g.dpid),"img",c(a),b];v.addMessage(g.join("|"));n.firstRequestHasFired&&v.requestToProcess();return"Successfully queued"},aamIdSync:function(g){if(g!==Object(g)||"string"!=typeof g.dpuuid||
!g.dpuuid.length)return"Error: config or config.dpuuid is empty";g.url="//dpm.demdex.net/ibs:dpid="+g.dpid+"&dpuuid="+g.dpuuid;return this.idSync(g)}},x={submitRequest:function(g){n.registerRequest(x.createQueuedRequest(g));return!0},createQueuedRequest:function(g){var a=n,b,c=g.callback,d="img";if(!q.isEmptyObject(s)){var f,l,o;for(f in s)if(s.hasOwnProperty(f)&&(l=s[f],!(null==l||""===l)&&f in g&&!(l in g)&&!(l in n.reservedKeys)))o=g[f],null==o||""===o||(g[l]=o)}if(!q.isValidPdata(g.sids))g.sids=
[];if(!q.isValidPdata(g.pdata))g.pdata=[];if(!q.isValidLogdata(g.logdata))g.logdata={};g.logdataArray=m.convertObjectToKeyValuePairs(g.logdata,"=",!0);g.logdataArray.push("_ts="+(new Date).getTime());if("function"!=typeof c)c=this.defaultCallback;if(a.useJSONP=!g.useImageRequest||"boolean"!=typeof g.useImageRequest)d="script",b=a.callbackPrefix+"_"+e+"_"+h+"_"+(new Date).getTime();return{tag:d,src:x.makeRequestSrc(g,b),internalCallbackName:b,callbackFn:c,postCallbackFn:g.postCallbackFn,useImageRequest:g.useImageRequest,
requestData:g}},defaultCallback:function(g){var a,b,c,d,e,f,h,j,p;if((a=g.stuff)&&a instanceof Array&&(b=a.length))for(c=0;c<b;c++)if((d=a[c])&&d===Object(d)){e=d.cn;f=d.cv;h=d.ttl;if("undefined"==typeof h||""===h)h=Math.floor(m.getMaxCookieExpiresInMinutes()/60/24);j=d.dmn||"."+document.domain;p=d.type;if(e&&(f||"number"==typeof f))"var"!=p&&(h=parseInt(h,10))&&!isNaN(h)&&m.setCookie(e,f,1440*h,"/",j,!1),A.stuffed[e]=f}a=g.uuid;if("string"==typeof a&&a.length&&!q.isEmptyObject(l)){b=l.path;if("string"!=
typeof b||!b.length)b="/";c=parseInt(l.days,10);isNaN(c)&&(c=100);m.setCookie(l.name||"aam_did",a,1440*c,b,l.domain||"."+document.domain,!0===l.secure)}!o&&!n.abortRequests&&v.requestToProcess(g)},makeRequestSrc:function(a,b){a.sids=q.removeEmptyArrayValues(a.sids||[]);a.pdata=q.removeEmptyArrayValues(a.pdata||[]);var c=n,d=m.encodeAndBuildRequest(a.sids,","),f=m.encodeAndBuildRequest(a.pdata,","),l=(a.logdataArray||[]).join("&");delete a.logdataArray;var o=u.IS_HTTPS?"https://":"http://",j;j=[];
var p,i,s,t;for(p in a)if(!(p in c.reservedKeys)&&a.hasOwnProperty(p))if(i=a[p],p=encodeURIComponent(p),i instanceof Array)for(s=0,t=i.length;s<t;s++)j.push(p+"="+encodeURIComponent(i[s]));else j.push(p+"="+encodeURIComponent(i));j=j.length?"&"+j.join("&"):"";return o+e+".demdex.net/event?d_nsid="+h+(d.length?"&d_sid="+d:"")+(f.length?"&d_px="+f:"")+(l.length?"&d_ld="+encodeURIComponent(l):"")+j+(c.useJSONP?"&d_rtbd=json&d_jsonv="+DIL.jsonVersion+"&d_dst=1&d_cts=1&d_cb="+(b||""):"")},fireRequest:function(a){"img"==
a.tag?this.fireImage(a):"script"==a.tag&&this.fireScript(a)},fireImage:function(a){var b=n,e,f;if(!b.abortRequests)b.firing=!0,e=new Image(0,0),b.sent.push(a),e.onload=function(){b.firing=!1;b.fired.push(a);b.num_of_img_responses++;b.registerRequest()},f=function(e){c="imgAbortOrErrorHandler received the event of type "+e.type;d.push(c);b.abortRequests=!0;b.firing=!1;b.errored.push(a);b.num_of_img_errors++;b.registerRequest()},e.addEventListener?(e.addEventListener("error",f,!1),e.addEventListener("abort",
f,!1)):e.attachEvent&&(e.attachEvent("onerror",f),e.attachEvent("onabort",f)),e.src=a.src},fireScript:function(a){var b=this,f=n,h,l,j=a.src,p=a.postCallbackFn,o="function"==typeof p,i=a.internalCallbackName;if(!f.abortRequests)f.firing=!0,window[i]=function(b){try{b||(b={});var h=a.callbackFn;f.firing=!1;f.fired.push(a);f.num_of_jsonp_responses++;h(b);o&&p(b)}catch(r){r.message="DIL jsonp callback caught error with message "+r.message;c=r.message;d.push(c);r.filename=r.filename||"dil.js";r.partner=
e;DIL.errorModule.handleError(r);try{h({error:r.name+"|"+r.message}),o&&p({error:r.name+"|"+r.message})}catch(j){}}finally{f.requestRemoval({script:l,callbackName:i}),f.registerRequest()}},B?(f.firing=!1,f.requestRemoval({script:"no script created",callbackName:i})):(l=document.createElement("script"),l.addEventListener&&l.addEventListener("error",function(d){f.requestRemoval({script:l,callbackName:i});c="jsonp script tag error listener received the event of type "+d.type+" with src "+j;b.handleScriptError(c,
a)},!1),l.type="text/javascript",l.src=j,h=DIL.variables.scriptNodeList[0],h.parentNode.insertBefore(l,h)),f.sent.push(a)},handleScriptError:function(a,b){var c=n;d.push(a);c.abortRequests=!0;c.firing=!1;c.errored.push(b);c.num_of_jsonp_errors++;c.registerRequest()}},q={isValidPdata:function(a){return a instanceof Array&&this.removeEmptyArrayValues(a).length?!0:!1},isValidLogdata:function(a){return!this.isEmptyObject(a)},isEmptyObject:function(a){if(a!==Object(a))return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;
return!0},removeEmptyArrayValues:function(a){for(var b=0,c=a.length,d,e=[],b=0;b<c;b++)d=a[b],"undefined"!=typeof d&&null!=d&&e.push(d);return e},isPopulatedString:function(a){return"string"==typeof a&&a.length}},m={addListener:function(){if(document.addEventListener)return function(a,b,c){a.addEventListener(b,function(a){"function"==typeof c&&c(a)},!1)};if(document.attachEvent)return function(a,b,c){a.attachEvent("on"+b,function(a){"function"==typeof c&&c(a)})}}(),convertObjectToKeyValuePairs:function(a,
b,c){var d=[],b=b||"=",e,f;for(e in a)f=a[e],"undefined"!=typeof f&&null!=f&&d.push(e+b+(c?encodeURIComponent(f):f));return d},encodeAndBuildRequest:function(a,b){return this.map(a,function(a){return encodeURIComponent(a)}).join(b)},map:function(a,b){if(Array.prototype.map)return a.map(b);if(void 0===a||null===a)throw new TypeError;var c=Object(a),d=c.length>>>0;if("function"!==typeof b)throw new TypeError;for(var e=Array(d),f=0;f<d;f++)f in c&&(e[f]=b.call(b,c[f],f,c));return e},filter:function(a,
b){if(!Array.prototype.filter){if(void 0===a||null===a)throw new TypeError;var c=Object(a),d=c.length>>>0;if("function"!==typeof b)throw new TypeError;for(var f=[],e=0;e<d;e++)if(e in c){var h=c[e];b.call(b,h,e,c)&&f.push(h)}return f}return a.filter(b)},getCookie:function(a){var a=a+"=",b=document.cookie.split(";"),c,d,e;for(c=0,d=b.length;c<d;c++){for(e=b[c];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(a))return decodeURIComponent(e.substring(a.length,e.length))}return null},setCookie:function(a,
b,c,d,e,f){var h=new Date;c&&(c*=6E4);document.cookie=a+"="+encodeURIComponent(b)+(c?";expires="+(new Date(h.getTime()+c)).toUTCString():"")+(d?";path="+d:"")+(e?";domain="+e:"")+(f?";secure":"")},extendArray:function(a,b){return a instanceof Array&&b instanceof Array?(Array.prototype.push.apply(a,b),!0):!1},extendObject:function(a,b,c){var d;if(a===Object(a)&&b===Object(b)){for(d in b)if(b.hasOwnProperty(d)&&(q.isEmptyObject(c)||!(d in c)))a[d]=b[d];return!0}return!1},getMaxCookieExpiresInMinutes:function(){return((new Date(u.COOKIE_MAX_EXPIRATION_DATE)).getTime()-
(new Date).getTime())/1E3/60}};"error"==e&&0==h&&m.addListener(window,"load",function(){DIL.windowLoaded=!0});var z=function(){E();!o&&!n.abortRequests&&v.attachIframe();n.readyToRemove=!0;n.requestRemoval()},E=function(){o||setTimeout(function(){!n.firstRequestHasFired&&!n.adms.admsProcessingStarted&&!n.adms.calledBack&&C.submit()},DIL.constants.TIME_TO_DEFAULT_REQUEST)},D=document;"error"!=e&&(DIL.windowLoaded?z():"complete"!=D.readyState&&"loaded"!=D.readyState?m.addListener(window,"load",z):DIL.isAddedPostWindowLoadWasCalled?
m.addListener(window,"load",z):(j="number"==typeof j?parseInt(j,10):0,0>j&&(j=0),setTimeout(z,j||DIL.constants.TIME_TO_CATCH_ALL_DP_IFRAME_ATTACHMENT)));this.api=C;this.getStuffedVariable=function(a){var b=A.stuffed[a];!b&&"number"!=typeof b&&(b=m.getCookie(a),!b&&"number"!=typeof b&&(b=""));return b};this.validators=q;this.helpers=m;this.constants=u;this.log=d;if(window._dil_unit_tests)this.pendingRequest=i,this.requestController=n,this.setDestinationPublishingUrl=f,this.destinationPublishing=v,
this.requestProcs=x,this.variables=A},function(){var a=document,b;if(null==a.readyState&&a.addEventListener)a.readyState="loading",a.addEventListener("DOMContentLoaded",b=function(){a.removeEventListener("DOMContentLoaded",b,!1);a.readyState="complete"},!1)}(),DIL.extendStaticPropertiesAndMethods=function(a){var b;if(a===Object(a))for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},DIL.extendStaticPropertiesAndMethods({version:"3.4",jsonVersion:1,constants:{TIME_TO_DEFAULT_REQUEST:50,TIME_TO_CATCH_ALL_DP_IFRAME_ATTACHMENT:500},
variables:{scriptNodeList:document.getElementsByTagName("script"),scriptsRemoved:[],callbacksRemoved:[]},windowLoaded:!1,dils:{},isAddedPostWindowLoadWasCalled:!1,isAddedPostWindowLoad:function(a){this.isAddedPostWindowLoadWasCalled=!0;this.windowLoaded="function"==typeof a?!!a():"boolean"==typeof a?a:!0},create:function(a){try{return new DIL(a)}catch(b){return(new Image(0,0)).src="http://error.demdex.net/event?d_nsid=0&d_px=14137&d_ld=name%3Derror%26filename%3Ddil.js%26partner%3Dno_partner%26message%3DError%2520in%2520attempt%2520to%2520create%2520DIL%2520instance%2520with%2520DIL.create()%26_ts%3D"+
(new Date).getTime(),Error("Error in attempt to create DIL instance with DIL.create()")}},registerDil:function(a,b,d){b=b+"$"+d;b in this.dils||(this.dils[b]=a)},getDil:function(a,b){var d;"string"!=typeof a&&(a="");b||(b=0);d=a+"$"+b;return d in this.dils?this.dils[d]:Error("The DIL instance with partner = "+a+" and containerNSID = "+b+" was not found")},dexGetQSVars:function(a,b,d){b=this.getDil(b,d);return b instanceof this?b.getStuffedVariable(a):""},xd:{postMessage:function(a,b,d){var c=1;if(b)if(window.postMessage)d.postMessage(a,
b.replace(/([^:]+:\/\/[^\/]+).*/,"$1"));else if(b)d.location=b.replace(/#.*$/,"")+"#"+ +new Date+c++ +"&"+a}}}),DIL.errorModule=function(){var a=DIL.create({partner:"error",containerNSID:0,disableDestinationPublishingIframe:!0}),b={harvestererror:14138,destpuberror:14139,dpmerror:14140,generalerror:14137,error:14137,noerrortypedefined:15021,evalerror:15016,rangeerror:15017,referenceerror:15018,typeerror:15019,urierror:15020},d=!1;return{activate:function(){d=!0},handleError:function(c){if(!d)return"DIL error module has not been activated";
c!==Object(c)&&(c={});var f=c.name?(new String(c.name)).toLowerCase():"",e=[],c={name:f,filename:c.filename?c.filename+"":"",partner:c.partner?c.partner+"":"no_partner",site:c.site?c.site+"":document.location.href,message:c.message?c.message+"":""};e.push(f in b?b[f]:b.noerrortypedefined);a.api.pixels(e).logs(c).useImageRequest().submit();return"DIL error report sent"},pixelMap:b}}(),DIL.tools={},DIL.modules={};
DIL.tools.getSearchReferrer=function(a,b){var d=DIL.getDil("error"),c=DIL.tools.decomposeURI(a||document.referrer),f="",e="",h={queryParam:"q"},f=d.helpers.filter([b===Object(b)?b:{},{hostPattern:/aol\./},{hostPattern:/ask\./},{hostPattern:/bing\./},{hostPattern:/google\./},{hostPattern:/yahoo\./,queryParam:"p"}],function(a){return!(!a.hasOwnProperty("hostPattern")||!c.hostname.match(a.hostPattern))}).shift();return!f?{valid:!1,name:"",keywords:""}:{valid:!0,name:c.hostname,keywords:(d.helpers.extendObject(h,
f),e=h.queryPattern?(f=(""+c.search).match(h.queryPattern))?f[1]:"":c.uriParams[h.queryParam],decodeURIComponent(e||"").replace(/\+|%20/g," "))}};
DIL.tools.decomposeURI=function(a){var b=DIL.getDil("error"),d=document.createElement("a");d.href=a||document.referrer;return{hash:d.hash,host:d.host.split(":").shift(),hostname:d.hostname,href:d.href,pathname:d.pathname.replace(/^\//,""),protocol:d.protocol,search:d.search,uriParams:function(a,d){b.helpers.map(d.split("&"),function(b){b=b.split("=");a[b.shift()]=b.shift()});return a}({},d.search.replace(/^(\/|\?)?|\/$/g,""))}};
DIL.tools.getMetaTags=function(){var a={},b=document.getElementsByTagName("meta"),d,c,f,e,h;for(d=0,f=arguments.length;d<f;d++)if(e=arguments[d],null!==e)for(c=0;c<b.length;c++)if(h=b[c],h.name==e){a[e]=h.content;break}return a};
DIL.modules.siteCatalyst={init:function(a,b,d){try{var c=this,f={name:"DIL Site Catalyst Module Error"},e=function(a){f.message=a;DIL.errorModule.handleError(f);return a};if(!(b instanceof DIL))return e("dilInstance is not a valid instance of DIL");f.partner=b.api.getPartner();if(a!==Object(a))return e("siteCatalystReportingSuite is not an object");if("function"!=typeof a.m_i||"function"!=typeof a.loadModule)return e("s.m_i is not a function or s.loadModule is not a function");a.m_DIL=function(a){a=
a.m_i("DIL");if(a!==Object(a))return e("m is not an object");a.trackVars=c.constructTrackVars(d);a.d=0;a._t=function(){var a,b,c=","+this.trackVars+",",d=this.s,f,h=[];f=[];var j={},w=!1;if(d!==Object(d)||!(d.va_t instanceof Array))return e("Error in m._t function: s is not an object or s.va_t is not an array");if(this.d){if(d.lightProfileID)(a=d.lightTrackVars)&&(a=","+a+","+d.vl_mr+",");else if(d.pe||d.linkType){a=d.linkTrackVars;if(d.pe&&(b=d.pe.substring(0,1).toUpperCase()+d.pe.substring(1),d[b]))a=
d[b].trackVars;a&&(a=","+a+","+d.vl_l+","+d.vl_l2+",")}if(a){for(b=0,h=a.split(",");b<h.length;b++)0<=c.indexOf(","+h[b]+",")&&f.push(h[b]);f.length&&(c=","+f.join(",")+",")}for(f=0,b=d.va_t.length;f<b;f++)a=d.va_t[f],0<=c.indexOf(","+a+",")&&null!=d[a]&&""!==d[a]&&(j[a]=d[a],w=!0);w&&this.d.api.signals(j,"c_").submit()}};a.setup=function(){this.d=b}};a.loadModule("DIL");if(a.DIL!==Object(a.DIL)||"function"!=typeof a.DIL.setup)return e("s.DIL is not an object or s.DIL.setup is not a function");a.DIL.setup();
if(f.message)return f.message}catch(h){h.message="DIL Site Catalyst module caught error with message "+h.message;if(b instanceof DIL)h.partner=b.api.getPartner();DIL.errorModule.handleError(h);return h.message}},constructTrackVars:function(a){var b=[],d,c,f,e,h;if(a===Object(a)){d=a.names;if(d instanceof Array&&(f=d.length))for(c=0;c<f;c++)e=d[c],"string"==typeof e&&e.length&&b.push(e);a=a.iteratedNames;if(a instanceof Array&&(f=a.length))for(c=0;c<f;c++)if(d=a[c],d===Object(d)&&(e=d.name,h=parseInt(d.maxIndex,
10),"string"==typeof e&&e.length&&!isNaN(h)&&0<=h))for(d=0;d<=h;d++)b.push(e+d);if(b.length)return b.join(",")}return this.constructTrackVars({names:"pageName,channel,campaign,products,events,pe,pev1,pev2,pev3".split(","),iteratedNames:[{name:"prop",maxIndex:75},{name:"eVar",maxIndex:75}]})}};
DIL.modules.GA={dil:null,arr:null,tv:null,errorMessage:"",defaultTrackVars:["_setAccount","_setCustomVar","_addItem","_addTrans","_trackSocial"],defaultTrackVarsObj:null,signals:{},hasSignals:!1,init:function(a,b,d){try{this.tv=this.arr=this.dil=null;this.errorMessage="";this.signals={};this.hasSignals=!1;var c={name:"DIL GA Module Error"},f="";b instanceof DIL?(this.dil=b,c.partner=this.dil.api.getPartner()):(f="dilInstance is not a valid instance of DIL",c.message=f,DIL.errorModule.handleError(c));
!(a instanceof Array)||!a.length?(f="gaArray is not an array or is empty",c.message=f,DIL.errorModule.handleError(c)):this.arr=a;this.tv=this.constructTrackVars(d);this.errorMessage=f}catch(e){e.message="DIL GA module caught error with message "+e.message;if(b instanceof DIL)e.partner=b.api.getPartner();DIL.errorModule.handleError(e);this.errorMessage=e.message}finally{return this}},constructTrackVars:function(a){var b=[],d,c,f,e;if(this.defaultTrackVarsObj!==Object(this.defaultTrackVarsObj)){f=this.defaultTrackVars;
e={};for(d=0,c=f.length;d<c;d++)e[f[d]]=!0;this.defaultTrackVarsObj=e}else e=this.defaultTrackVarsObj;if(a===Object(a)){a=a.names;if(a instanceof Array&&(c=a.length))for(d=0;d<c;d++)f=a[d],"string"==typeof f&&f.length&&f in e&&b.push(f);if(b.length)return b}return this.defaultTrackVars},constructGAObj:function(a){var b={},a=a instanceof Array?a:this.arr,d,c,f,e;for(d=0,c=a.length;d<c;d++)f=a[d],f instanceof Array&&f.length&&(e=f.shift(),"string"==typeof e&&e.length&&(b[e]instanceof Array||(b[e]=[]),
b[e].push(f)));return b},addToSignals:function(a,b){if("string"!=typeof a||""===a||null==b||""===b)return!1;this.signals[a]instanceof Array||(this.signals[a]=[]);this.signals[a].push(b);return this.hasSignals=!0},constructSignals:function(){var a=this.constructGAObj(),b={_setAccount:function(a){this.addToSignals("c_accountId",a)},_setCustomVar:function(a,b,c){"string"==typeof b&&b.length&&this.addToSignals("c_"+b,c)},_addItem:function(a,b,c,d,f,e){this.addToSignals("c_itemOrderId",a);this.addToSignals("c_itemSku",
b);this.addToSignals("c_itemName",c);this.addToSignals("c_itemCategory",d);this.addToSignals("c_itemPrice",f);this.addToSignals("c_itemQuantity",e)},_addTrans:function(a,b,c,d,f,e,h,j){this.addToSignals("c_transOrderId",a);this.addToSignals("c_transAffiliation",b);this.addToSignals("c_transTotal",c);this.addToSignals("c_transTax",d);this.addToSignals("c_transShipping",f);this.addToSignals("c_transCity",e);this.addToSignals("c_transState",h);this.addToSignals("c_transCountry",j)},_trackSocial:function(a,
b,c,d){this.addToSignals("c_socialNetwork",a);this.addToSignals("c_socialAction",b);this.addToSignals("c_socialTarget",c);this.addToSignals("c_socialPagePath",d)}},d=this.tv,c,f,e,h,j,o;for(c=0,f=d.length;c<f;c++)if(e=d[c],a.hasOwnProperty(e)&&b.hasOwnProperty(e)&&(o=a[e],o instanceof Array))for(h=0,j=o.length;h<j;h++)b[e].apply(this,o[h])},submit:function(){try{if(""!==this.errorMessage)return this.errorMessage;this.constructSignals();return this.hasSignals?(this.dil.api.signals(this.signals).submit(),
"Signals sent: "+this.dil.helpers.convertObjectToKeyValuePairs(this.signals,"=",!0)+this.dil.log):"No signals present"}catch(a){a.message="DIL GA module caught error with message "+a.message;if(this.dil instanceof DIL)a.partner=this.dil.api.getPartner();DIL.errorModule.handleError(a);return this.errorMessage=a.message}}};
DIL.modules.Peer39={aid:"",dil:null,optionals:null,errorMessage:"",calledBack:!1,script:null,scriptsSent:[],returnedData:[],init:function(a,b,d){try{this.dil=null;this.errorMessage="";this.calledBack=!1;this.optionals=d===Object(d)?d:{};var d={name:"DIL Peer39 Module Error"},c=[],f="";if(this.isSecurePageButNotEnabled(document.location.protocol))f="Module has not been enabled for a secure page",c.push(f),d.message=f,DIL.errorModule.handleError(d);b instanceof DIL?(this.dil=b,d.partner=this.dil.api.getPartner()):
(f="dilInstance is not a valid instance of DIL",c.push(f),d.message=f,DIL.errorModule.handleError(d));"string"!=typeof a||!a.length?(f="aid is not a string or is empty",c.push(f),d.message=f,DIL.errorModule.handleError(d)):this.aid=a;this.errorMessage=c.join("\n")}catch(e){e.message="DIL Peer39 module init() caught error with message "+e.message;if(b instanceof DIL)e.partner=b.api.getPartner();DIL.errorModule.handleError(e);this.errorMessage=e.message}finally{return this}},isSecurePageButNotEnabled:function(a){return"https:"==
a&&!0!==this.optionals.enableHTTPS?!0:!1},constructSignals:function(){var a=this,b=this.constructScript(),d=DIL.variables.scriptNodeList[0];window["afterFinished_"+this.aid]=function(){try{var b=a.processData(p39_KVP_Short("c_p","|").split("|"));b.hasSignals&&a.dil.api.signals(b.signals).submit()}catch(d){}finally{a.calledBack=!0,"function"==typeof a.optionals.afterResult&&a.optionals.afterResult()}};d.parentNode.insertBefore(b,d);this.scriptsSent.push(b);return"Request sent to Peer39"},processData:function(a){var b,
d,c,f,e={},h=!1;this.returnedData.push(a);if(a instanceof Array)for(b=0,d=a.length;b<d;b++)c=a[b].split("="),f=c[0],c=c[1],f&&isFinite(c)&&!isNaN(parseInt(c,10))&&(e[f]instanceof Array||(e[f]=[]),e[f].push(c),h=!0);return{hasSignals:h,signals:e}},constructScript:function(){var a=document.createElement("script"),b=this.optionals,d=b.scriptId,c=b.scriptSrc,b=b.scriptParams;a.id="string"==typeof d&&d.length?d:"peer39ScriptLoader";a.type="text/javascript";"string"==typeof c&&c.length?a.src=c:(a.src=(this.dil.constants.IS_HTTPS?
"https:":"http:")+"//stags.peer39.net/"+this.aid+"/trg_"+this.aid+".js","string"==typeof b&&b.length&&(a.src+="?"+b));return a},submit:function(){try{return""!==this.errorMessage?this.errorMessage:this.constructSignals()}catch(a){a.message="DIL Peer39 module submit() caught error with message "+a.message;if(this.dil instanceof DIL)a.partner=this.dil.api.getPartner();DIL.errorModule.handleError(a);return this.errorMessage=a.message}}};
//Instantiate DIL v3.4 code
var _scObj = s_gi(s_account);
var kbbDil = DIL.create({
	partner: 'cam',
	containerNSID : 124,
	mappings : {
        c_zip : 'd_zc'
    },
	uuidCookie:{
		name:'aam_uuid',
		days:30
   }
});

DIL.modules.siteCatalyst.init(_scObj, kbbDil, {
        names: ['pageName', 'channel', 'campaign', 'products', 'events', 'pe', 'referrer', 'server', 'purchaseID', 'zip', 'state'],
        iteratedNames: [{
               name: 'eVar',
               maxIndex: 75
        }, {
               name: 'prop',
               maxIndex: 75
        }, {
               name: 'pev',
               maxIndex: 3
        }, {
               name: 'hier',
               maxIndex: 4
        }]
});;


/* Comment Generated by Combres - Resource '~/js/jquery.carousel.js' (Mode: Static) */
/**
* jCarouselLite - jQuery plugin to navigate images/any content in a carousel style widget.
* @requires jQuery v1.2 or above
*
* http://gmarwaha.com/jquery/jcarousellite/
*
* Copyright (c) 2007 Ganeshji Marwaha (gmarwaha.com)
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*
* Version: 1.0.1
* Note: Requires jquery 1.2 or above from version 1.0.1
*/

/**
* Creates a carousel-style navigation widget for images/any-content from a simple HTML markup.
*
* The HTML markup that is used to build the carousel can be as simple as...
*
*  <div class="carousel">
*      <ul>
*          <li><img src="image/1.jpg" alt="1"></li>
*          <li><img src="image/2.jpg" alt="2"></li>
*          <li><img src="image/3.jpg" alt="3"></li>
*      </ul>
*  </div>
*
* As you can see, this snippet is nothing but a simple div containing an unordered list of images.
* You don't need any special "class" attribute, or a special "css" file for this plugin.
* I am using a class attribute just for the sake of explanation here.
*
* To navigate the elements of the carousel, you need some kind of navigation buttons.
* For example, you will need a "previous" button to go backward, and a "next" button to go forward.
* This need not be part of the carousel "div" itself. It can be any element in your page.
* Lets assume that the following elements in your document can be used as next, and prev buttons...
*
* <button class="prev">&lt;&lt;</button>
* <button class="next">&gt;&gt;</button>
*
* Now, all you need to do is call the carousel component on the div element that represents it, and pass in the
* navigation buttons as options.
*
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev"
* });
*
* That's it, you would have now converted your raw div, into a magnificient carousel.
*
* There are quite a few other options that you can use to customize it though.
* Each will be explained with an example below.
*
* @param an options object - You can specify all the options shown below as an options object param.
*
* @option btnPrev, btnNext : string - no defaults
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev"
* });
* @desc Creates a basic carousel. Clicking "btnPrev" navigates backwards and "btnNext" navigates forward.
*
* @option btnGo - array - no defaults
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      btnGo: [".0", ".1", ".2"]
* });
* @desc If you don't want next and previous buttons for navigation, instead you prefer custom navigation based on
* the item number within the carousel, you can use this option. Just supply an array of selectors for each element
* in the carousel. The index of the array represents the index of the element. What i mean is, if the
* first element in the array is ".0", it means that when the element represented by ".0" is clicked, the carousel
* will slide to the first element and so on and so forth. This feature is very powerful. For example, i made a tabbed
* interface out of it by making my navigation elements styled like tabs in css. As the carousel is capable of holding
* any content, not just images, you can have a very simple tabbed navigation in minutes without using any other plugin.
* The best part is that, the tab will "slide" based on the provided effect. :-)
*
* @option mouseWheel : boolean - default is false
* @example
* $(".carousel").jCarouselLite({
*      mouseWheel: true
* });
* @desc The carousel can also be navigated using the mouse wheel interface of a scroll mouse instead of using buttons.
* To get this feature working, you have to do 2 things. First, you have to include the mouse-wheel plugin from brandon.
* Second, you will have to set the option "mouseWheel" to true. That's it, now you will be able to navigate your carousel
* using the mouse wheel. Using buttons and mouseWheel or not mutually exclusive. You can still have buttons for navigation
* as well. They complement each other. To use both together, just supply the options required for both as shown below.
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      mouseWheel: true
* });
*
* @option auto : number - default is null, meaning autoscroll is disabled by default
* @example
* $(".carousel").jCarouselLite({
*      auto: 800,
*      speed: 500
* });
* @desc You can make your carousel auto-navigate itself by specfying a millisecond value in this option.
* The value you specify is the amount of time between 2 slides. The default is null, and that disables auto scrolling.
* Specify this value and magically your carousel will start auto scrolling.
*
* @option speed : number - 200 is default
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      speed: 800
* });
* @desc Specifying a speed will slow-down or speed-up the sliding speed of your carousel. Try it out with
* different speeds like 800, 600, 1500 etc. Providing 0, will remove the slide effect.
*
* @option easing : string - no easing effects by default.
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      easing: "bounceout"
* });
* @desc You can specify any easing effect. Note: You need easing plugin for that. Once specified,
* the carousel will slide based on the provided easing effect.
*
* @option vertical : boolean - default is false
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      vertical: true
* });
* @desc Determines the direction of the carousel. true, means the carousel will display vertically. The next and
* prev buttons will slide the items vertically as well. The default is false, which means that the carousel will
* display horizontally. The next and prev items will slide the items from left-right in this case.
*
* @option circular : boolean - default is true
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      circular: false
* });
* @desc Setting it to true enables circular navigation. This means, if you click "next" after you reach the last
* element, you will automatically slide to the first element and vice versa. If you set circular to false, then
* if you click on the "next" button after you reach the last element, you will stay in the last element itself
* and similarly for "previous" button and first element.
*
* @option visible : number - default is 3
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      visible: 4
* });
* @desc This specifies the number of items visible at all times within the carousel. The default is 3.
* You are even free to experiment with real numbers. Eg: "3.5" will have 3 items fully visible and the
* last item half visible. This gives you the effect of showing the user that there are more images to the right.
*
* @option start : number - default is 0
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      start: 2
* });
* @desc You can specify from which item the carousel should start. Remember, the first item in the carousel
* has a start of 0, and so on.
*
* @option scrool : number - default is 1
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      scroll: 2
* });
* @desc The number of items that should scroll/slide when you click the next/prev navigation buttons. By
* default, only one item is scrolled, but you may set it to any number. Eg: setting it to "2" will scroll
* 2 items when you click the next or previous buttons.
*
* @option beforeStart, afterEnd : function - callbacks
* @example
* $(".carousel").jCarouselLite({
*      btnNext: ".next",
*      btnPrev: ".prev",
*      beforeStart: function(a) {
*          alert("Before animation starts:" + a);
*      },
*      afterEnd: function(a) {
*          alert("After animation ends:" + a);
*      }
* });
* @desc If you wanted to do some logic in your page before the slide starts and after the slide ends, you can
* register these 2 callbacks. The functions will be passed an argument that represents an array of elements that
* are visible at the time of callback.
*
*
* @cat Plugins/Image Gallery
* @author Ganeshji Marwaha/ganeshread@gmail.com
*/

(function ($) {                                          // Compliant with jquery.noConflict()
    $.fn.jCarouselLite = function (o) {
        o = $.extend({
            btnPrev: null,
            btnNext: null,
            btnGo: null,
            btnGoScroll: null,                          // Added btnGoScroll to sync btnGo with scroll values -shelby
            mouseWheel: false,
            auto: null,
            resetTimer: false,

            speed: 200,
            easing: null,

            vertical: false,
            circular: false,
            visible: 4,
            start: 0,
            scroll: 1,

            beforeStart: null,
            afterEnd: null,

            split: false // added to support side-scrolling multiple carousels 1/11/2011
        }, o || {});

        return this.each(function () {                           // Returns the element collection. Chainable.

            var running = false, animCss = o.vertical ? "top" : "left", sizeCss = o.vertical ? "height" : "width";
            var div = $(this), ul = $("ul", div), tLi = $("li", ul), tl = tLi.size(), v = o.visible;
            var autoHandle;

            if (o.circular) {
                ul.prepend(tLi.slice(tl - v - 1 + 1).clone())
              .append(tLi.slice(0, v).clone());
                o.start += v;
            }

            var li = (o.split) ? $("> li", ul.eq(0)) : $("> li", ul), itemLength = li.size(), curr = o.start;

            if (o.split) { // if split, use first carousel as anchor and show direct container
                if ($.browser.msie && $.browser.version.substr(0, 1) < 7) div.css({ position: "relative" });
                ul.parent().css({ visibility: "visible", position: "relative", "z-index": "2", left: "0px", overflow: "hidden" });
            }
            else {
                div.css({ visibility: "visible", position: "relative", "z-index": "2", left: "0px", overflow: "hidden" });
            }

            li.css({ overflow: "hidden", "float": o.vertical ? "none" : "left" });
            ul.css({ margin: "0", padding: "0", position: "relative", "list-style-type": "none", "z-index": "1" });

            var liSize = o.vertical ? height(li) : width(li);   // Full li size(incl margin)-Used for animation
            var ulSize = liSize * itemLength;                   // size of full ul(total length, not just for the visible items)
            var divSize = liSize * v;                           // size of entire div(total length for just the visible items)

            function max_height(el) {
                // Return height of the largest item. Required to fix bug where length of carousel is determined by first element.  11/28 HM
                var _height = 0;

                $.each(el, function () {
                    var _compHeight = $(this).height();
                    var marginTopStr = $(this).css('marginTop');
                    var marginTop = parseInt(marginTopStr.substr(0, marginTopStr.length - 2));
                    var marginBottomStr = $(this).css('marginBottom');
                    var marginBottom = parseInt(marginBottomStr.substr(0, marginBottomStr.length - 2));
                    _compHeight += (marginTop + marginBottom);
                    if (_compHeight > _height) {
                        _height = _compHeight;
                    }
                });

                return parseInt(_height);
            };

            //li.css({ width: li.width(), height: li.height() });
            li.css({ width: li.width(), height: max_height(li) });
            ul.css(sizeCss, ulSize + "px").css(animCss, -(curr * liSize));

            (o.split) ? ul.parent().css(sizeCss, divSize + "px") : div.css(sizeCss, divSize + "px");                     // Width of the DIV. length of visible images

            if (o.btnPrev)
                $(o.btnPrev).click(function () {
                    return go(curr - o.scroll);
                });

            if (o.btnNext)
                $(o.btnNext).click(function () {
                    return go(curr + o.scroll);
                });

            if (o.btnGo)
                $.each(o.btnGo, function (i, val) {
                    $(val).click(function () {
                        if (o.resetTimer && o.auto) {
                            clearInterval(autoHandle);
                            autoHandle = setInterval(function () {
                                go(curr + o.scroll);
                            }, o.auto + o.speed);
                        }
                        // added to check if btnGo should scroll more than 1 item.
                        if (o.btnGoScroll != null) {
                            return go(i * o.btnGoScroll);
                        } else {
                            return go(o.circular ? o.visible + i : i);
                        }

                    });
                });

            if (o.mouseWheel && div.mousewheel)
                div.mousewheel(function (e, d) {
                    return d > 0 ? go(curr - o.scroll) : go(curr + o.scroll);
                });

            if (o.auto) {
                autoHandle = setInterval(function () {
                    go(curr + o.scroll);
                }, o.auto + o.speed);
            }

            function vis() {
                return li.slice(curr).slice(0, v);
            };

            function go(to) {
                if (!running) {
                    if (o.beforeStart)
                        o.beforeStart.call(this, vis());

                    if (o.circular) {            // If circular we are in first or last, then goto the other end
                        if (to <= o.start - v - 1) {           // If first, then goto last
                            ul.css(animCss, -((itemLength - (v * 2)) * liSize) + "px");
                            // If "scroll" > 1, then the "to" might not be equal to the condition; it can be lesser depending on the number of elements.
                            curr = to == o.start - v - 1 ? itemLength - (v * 2) - 1 : itemLength - (v * 2) - o.scroll;
                        } else if (to >= itemLength - v + 1) { // If last, then goto first
                            ul.css(animCss, -((v) * liSize) + "px");
                            // If "scroll" > 1, then the "to" might not be equal to the condition; it can be greater depending on the number of elements.
                            curr = to == itemLength - v + 1 ? v + 1 : v + o.scroll;
                        } else curr = to;
                    } else {                    // If non-circular and to points to first or last, we just return.
                        if (to < 0 || to > itemLength - v) return;
                        else curr = to;
                    }                           // If neither overrides it, the curr will still be "to" and we can proceed.

                    running = true;

                    ul.animate(
                    animCss == "left" ? { left: -(curr * liSize)} : { top: -(curr * liSize) }, o.speed, o.easing,
                    function () {
                        if (o.afterEnd)
                            o.afterEnd.call(this, vis());
                        running = false;
                    }
                );
                    // Disable buttons when the carousel reaches the last/first, and enable when not
                    if (!o.circular) {
                        $(o.btnPrev + "," + o.btnNext).removeClass("btn-disabled");
                        $((curr - o.scroll < 0 && o.btnPrev)
                        ||
                       (curr + o.scroll > itemLength - v && o.btnNext)
                        ||
                       []
                     ).addClass("btn-disabled");
                    }

                }
                return false;
            };
        });
    };

    function css(el, prop) {
        return parseInt($.css(el[0], prop)) || 0;
    };
    function width(el) {
        return el[0].offsetWidth + css(el, 'marginLeft') + css(el, 'marginRight');
    };
    function height(el) {
        return el[0].offsetHeight + css(el, 'marginTop') + css(el, 'marginBottom');
    };

})(jQuery);;


/* Comment Generated by Combres - Resource '~/views/shared/controls/socialtoolbar/social-toolbar.js' (Mode: Static) */
/* Depends on KBB.cookies */
KBB.modules.socialToolbar = (function () {
    var _this,
        _help = KBB.helpers,
        tooltipSettings = {
            fixed: true,
            toolTipClass: 'aToolTip',
            xOffset: -115,
            yOffset: 0
        },
        jCarouselSettings = {
            btnNext: '#Toolbar-carousel .btn-cir-right',
            btnPrev: '#Toolbar-carousel .btn-cir-left',
            visible: 4,
            scroll: 1,
            start: 0,
            circular: false,
            vertical: false
        },
        selectors = {
            closePopups: '#Social-popup .close'
        },
        elements = {
            toggleToolbar: $('#Social-trigger, #Hide-toolbar-trigger'),
            errorContainer: $('#Toolbar-error'),
            saveVehicle: $('#Save-car-btn'),
            savedCount: $('#Saved-vehicle-count'),
            recentCount: $('#Recently-viewed-count')
        },
        errorMessages = {
            saveError: 'There was an error saving, please try again later.',
            compareTooMany: 'You may only compare up to 4 vehicles.',
            compareTooFew: 'Please select at least two vehicles to compare.'
        },
        eachPanel = function (cb) {
            var panels = KBB.modules.socialToolbar.panels;
            for (var p in panels) {
                if (cb(panels[p], p) === false) {
                    break;
                }
            }
        };

    var _togglePanel = function (p, e) {
        eachPanel(function (panel, name) {
            var isVisible = panel.element.is(':visible');
            if (!isVisible && panel === p) {
                if (panel.onShow(e) !== false) {
                    if (_this.isHidden) {
                        _this.toggleSocialToolbar();
                    }
                    panel.element.slideUp().show();
                    KBB.events.fire('KbbToolbar.{0}.OnShow'.format(name), e);
                    KBB.events.fire('KbbToolbar.OnShowPanel', e, name);
                }
            } else if (isVisible && panel !== p) {
                panel.element.stop(true, true).slideDown().hide();
                KBB.events.fire('KbbToolbar.{0}.OnHide'.format(name), e);
                KBB.events.fire('KbbToolbar.OnHidePanel', e, name);
            }
        });
    };

    var _closePanel = function (e) {
        var element = $(this).parent(),
            name = element.data('panel');

        KBB.events.fire('KbbToolbar.{0}.OnHide'.format(name), e);
        KBB.events.fire('KbbToolbar.OnHidePanel', e, name);
        element.slideToggle('fast');
    }

    return {
        panels: {},
        element: $('#Social-toolbar'),
        isHidden: KBB.cookies.get('ToolbarHidden') === 'true',
        jCarouselSettings: jCarouselSettings,
        init: function () {
            _this = this;

            $(selectors.closePopups).click(_closePanel);
            elements.saveVehicle.click(this.saveVehicleClicked);
            elements.toggleToolbar.click(this.toggleSocialToolbar);

            KBB.modules.myKbb.onSaveVehicleComplete(this.saveVehicleComplete);
            KBB.modules.myKbb.onGetPersonalizationDataComplete(this.personalizationDataReceived);
            KBB.modules.myKbb.onAuthenticationChange(this.authenticationChanged);


            KBB.events.on('MyKbb.OnRecentlyViewedAdded', function (data) { elements.recentCount.html('({0})'.format(data.count)); });

            eachPanel(this.initPanel);

            $('span.tip', $('#Social-toolbar, #Social-trigger')).aToolTip(tooltipSettings);
        },
        initPanel: function (p, name) {
            p.init();
            p.element.data('panel', name);
            p.Show = function (e) { _togglePanel(p, e); };
            p.trigger.click(p.Show);
        },
        hidePanels: function (e) {
            _togglePanel(null, e);
        },
        showError: function (message) {
            _this.hideError();
            elements.errorContainer.html(message).show().delay(5000).fadeOut(2000);
        },
        hideError: function () {
            elements.errorContainer.hide();
        },
        toggleSocialToolbar: function (e) {
            _this.isHidden = _this.element.is(':visible');

            if (_this.isHidden) {
                _this.hidePanels(e);
                $('.clickTip', '#Social-popup').hide();
            }

            _this.element.add(elements.toggleToolbar).fadeToggle('slow');

            KBB.cookies.set('ToolbarHidden', _this.isHidden, '365');

            KBB.events.fire('KbbToolbar.OnToggle', !_this.isHidden);
            KBB.events.fire('KbbToolbar.On' + (_this.isHidden ? 'Collapse' : 'Expand'));
        },
        saveVehicleClicked: function (e) {
            var me = $(this);
            if (me.hasClass('disabled')) return;
            if (!KBB.modules.myKbb.isAuthenticated) {
                KBB.modules.headerShare.signInPopUp.Show(e);
                return;
            }
            KBB.modules.myKbb.saveVehicle({
                vehicleid: me.data('vid'),
                vehicleclass: me.data('vclass'),
                mileage: me.data('mileage'),
                selectionhistory: me.data('options'),
                condition: me.data('condition'),
                intent: me.data('intent')
            });
        },
        saveVehicleComplete: function (data) {
            if (data.success) {
                $('span.saved-arrow', _this.element).fadeIn().fadeOut(2500);
                _this.hideError();
            } else {
                _this.showError(errorMessages.saveError);
            }
        },
        personalizationDataReceived: function (data) {
            if (data) {
                elements.savedCount.html('({0})'.format(data.SavedVehicleCount));
                elements.recentCount.html('({0})'.format(data.RecentlyViewedCount));
            }
        },
        authenticationChanged: function (data) {
            _this.hidePanels();

            elements.savedCount.toggle(data.IsAuthenticated);
            elements.recentCount.toggle(data.IsAuthenticated);

            if (data.IsAuthenticated) {
                var name = data.User.FirstName.length ? data.User.FirstName : data.User.DisplayName;
                $('.sign-in-message', _this.element).html('Welcome Back, {0}!'.format(name))
                                                    .show('fast').delay(2000).fadeOut(2000);
            } else {
                $('.sign-out-message', _this.element).show('fast').delay(2000).fadeOut(2000);
            }
        },
        createCompareVehiclesClickHandler: function (element) {
            return function (e) {
                e.preventDefault();
                _this.hideError();

                var list = [];

                $('.mod-compare-checkbox:checked', element).each(function () {
                    list.push($(this).val());
                });

                if (list.length > 4) {
                    _this.showError(errorMessages.compareTooMany);
                }
                else if (list.length < 2) {
                    _this.showError(errorMessages.compareTooFew);
                }
                else {
                    self.location.href = '{0}/{1}'.format($(this).attr('href'), list.join("-vs-"));
                }
            };
        },
        OnToggle: function (cb) {
            KBB.events.on('KbbToolbar.OnToggle', cb);
        },
        OnCollapse: function (cb) {
            KBB.events.on('KbbToolbar.OnCollapse', cb);
        },
        OnExpand: function (cb) {
            KBB.events.on('KbbToolbar.OnExpand', cb);
        },
        OnShowPanel: function (cb) {
            KBB.events.on('KbbToolbar.OnShowPanel', cb);
        },
        OnHidePanel: function (cb) {
            KBB.events.on('KbbToolbar.OnHidePanel', cb);
        }
    }
} ());

/* SAVED VEHICLES PANEL */
KBB.modules.socialToolbar.panels.savedVehicles = (function () {
    var _this,
        _toolbar = KBB.modules.socialToolbar,
        savedServiceUrl = $('#Saved-vehicle-service').val(),
        container = $('#Saved-vehicle-data'),
        elements = {
            removeConfirmOverlay: $('#Saved-vehicle-remove-overlay'),
            removeCancel: $('#Saved-vehicle-remove-overlay-cancel'),
            removeConfirm: $('#Saved-vehicle-remove-overlay-ok'),
            removeMessage: $('#Saved-vehicle-remove-message')
        },
        messages = {
            removeTooFew: 'Please select at least one vehicle to remove.',
            removeFailed: 'There was an error saving, please try again later.',
            confirmRemove: 'Are you sure you want to remove?',
            confirmRemoveAll: 'Are you sure you want to remove?'
        },
        isJqmCreated = false,
        checkedIdsList;

    return {
        element: $('#Saved-vehicles-panel'),
        trigger: $('#Saved-vehicles-link'),
        init: function () {
            _this = this;
            elements.removeCancel.click(this.removeVehiclesCancelClicked);
            elements.removeConfirm.click(this.removeVehiclesConfirmClicked);
        },
        initAjaxContent: function () {
            $('.compare-vehicles', _this.element).click(_toolbar.createCompareVehiclesClickHandler(_this.element));
            $('#Remove-vehicles').click(_this.removeVehiclesClicked);
            $('#Remove-all-vehicles').click(_this.removeAllVehiclesClicked);
        },
        onShow: function (e) {
            if (!KBB.modules.myKbb.isAuthenticated) {
                KBB.modules.headerShare.signInPopUp.Show(e);
                return false;
            }
            _this.loadSavedVehicles();
        },
        loadSavedVehicles: function () {
            container.html('<span class="loader"></span>');
            $.getJSON(KBB.helpers.appendUrlParameter(savedServiceUrl, 'r', KBB.helpers.randomString()), _this.onGetSavedVehiclesComplete);
        },
        onGetSavedVehiclesComplete: function (data) {
            if (!data) {
                return;
            }

            container.html(data.Html)
                     .find('#Toolbar-carousel .container')
                     .jCarouselLite(_toolbar.jCarouselSettings); ;

            _this.initAjaxContent();
        },
        removeVehiclesClicked: function (e) {
            var checked = $('.mod-compare-checkbox:checked', _this.element);

            if (!checked.length) {
                return _toolbar.showError(messages.removeTooFew);
            }

            checkedIdsList = [];
            checked.each(function () { checkedIdsList.push($(this).data('vid')); });

            elements.removeMessage.html(messages.confirmRemove);

            _this.showConfirmRemoveModal();

        },
        removeAllVehiclesClicked: function (e) {
            checkedIdsList = [];
            $('.mod-compare-checkbox', _this.element).each(function () { checkedIdsList.push($(this).data('vid')); });

            elements.removeMessage.html(messages.confirmRemoveAll);

            _this.showConfirmRemoveModal();
        },
        showConfirmRemoveModal: function () {
            if (!isJqmCreated) {
                elements.removeConfirmOverlay.jqm({ modal: false, overlay: 0, overlayClass: 'mod-modal-overlay', toTop: true });
                isJqmCreated = true;
            }

            elements.removeConfirmOverlay.css('top', $(document).scrollTop() + 170).jqmShow();
        },
        removeVehiclesCancelClicked: function (e) {
            elements.removeConfirmOverlay.jqmHide();
        },
        removeVehiclesConfirmClicked: function (e) {
            elements.removeConfirmOverlay.jqmHide();

            var cb = function (data) {
                if (!data || !data.success) {
                    _toolbar.showError(messages.removeFailed);
                } else {
                    _this.loadSavedVehicles();
                }
            };

            KBB.modules.myKbb.removeVehicles(checkedIdsList, cb);
        }
    }
} ());

/* RECENTLY VIEWED VEHICLES PANEL */
KBB.modules.socialToolbar.panels.recentlyViewed = (function () {
    var _this,
        _toolbar = KBB.modules.socialToolbar,
        errorMessages = {
            saveVehiclesError: 'Please select at least one vehicle.',
            compareTooMany: 'You may only compare up to 4 vehicles.',
            compareTooFew: 'Please select at least two vehicles to compare.'
        },
        serviceUrl = $('#Recently-viewed-service').val(),
        container = $('#Recently-viewed-data'),
        isRecentlyViewedCached = false;

    return {
        element: $('#Recently-viewed-panel'),
        trigger: $('#Recently-viewed-link'),
        init: function () {
            _this = this;
            KBB.events.on('MyKbb.OnRecentlyViewedAdded', function (data) { isRecentlyViewedCached = false });
        },
        initAjaxContent: function () {
            $('#Save-vehicles-btn').click(this.saveVehiclesClicked);
            $('.compare-vehicles', _this.element).click(_toolbar.createCompareVehiclesClickHandler(_this.element));
        },
        onShow: function (e) {
            if (!isRecentlyViewedCached) {
                _this.getRecentlyViewedVehicles(_this.onGetRecentlyViewedComplete);
            }
        },
        getRecentlyViewedVehicles: function (cb) {
            container.html('<span class="loader"></span>');
            $.getJSON(serviceUrl, cb);
        },
        onGetRecentlyViewedComplete: function (data) {
            if (!data) {
                return;
            }

            container.html(data.Html)
                     .find('#Toolbar-carousel .container')
                     .jCarouselLite(_toolbar.jCarouselSettings);

            _this.initAjaxContent();

            isRecentlyViewedCached = true;
        },
        saveVehiclesClicked: function (e) {
            _toolbar.hideError();

            if (!KBB.modules.myKbb.isAuthenticated) {
                KBB.modules.headerShare.signInPopUp.Show(e);
                return;
            }

            var list = [];
            $('.mod-compare-checkbox:checked', _this.element).each(function () {
                list.push('{0}-{1}'.format($(this).data('vid'), $(this).data('vclass')));
            });

            if (list.length > 0) {
                KBB.modules.myKbb.saveVehicles(list.join("|"));
            } else {
                _toolbar.showError(errorMessages.saveVehiclesError);
            }
        }
    }
} ());

;


/* Comment Generated by Combres - Resource '~/js/toolbaradcontent.js' (Mode: Static) */
var tbHeight = 550;
var tbWidth = 1012;
var toolbarContent = $('#ToolbarAd-Content');
var toolbarToggleDiv = $('#ToolbarAd-toggle div');

function showToolbarAdOverlay(dyn) {
    toolbarContent.show();
    toolbarToggleDiv.addClass('down').removeClass('up');
    $('#ToolbarAd-Content-Overlay').addClass('mod-modal-overlay').css({ height: '100%', width: '100%', position: 'fixed', left: 0, top: 0, 'z-index': toolbarContent.css('z-index') - 1, opacity: .5 }).fadeIn();
    toolbarContent.width(tbWidth);
    $('#ToolbarAd-Content .close').css({ 'top': '-40px', 'right': '45px' }).fadeIn('fast');
    $('#ToolbarAd-Content .content').stop(true, true).show().width(tbWidth).animate({ height: tbHeight }, 'fast');
    var src = $('#ToolbarAd-Content-src').val();
    if (dyn != undefined && src.indexOf("dyn=") < 0) {
        src = src + '&dyn=' + dyn;
    }
    $('#ToolbarAd-Content-iframe').attr('src', src);
}

function collapseToolbarAd() {
    $('#ToolbarAd-Content-Overlay').fadeOut();
    $('#ToolbarAd-Content .close').stop(true, true).fadeOut('fast', function () {
        $('#ToolbarAd-Content .content').stop(true, true).animate({ height: 0 }, 'fast', function () {
            $(this).hide();
            toolbarToggleDiv.removeClass('down').addClass('up');
        });
    });
    $('#ToolbarAd-Content-iframe').attr('src', '');
}

$('#ToolbarAd-Content .close').live('click', function () {
    collapseToolbarAd();
    toolbarToggleDiv.removeClass('down').addClass('up');
});

var dyn = "";

function ShowToolbarAdToggle(styles) {
    var styleArray = styles.split("|");
    var buttonStyle = styleArray[0];
    var barStyle = styleArray[1];
    var arrowColor = styleArray[2];
    dyn = styleArray[3];
    if (buttonStyle == undefined) buttonStyle = "background:#000";
    if (barStyle == undefined) barStyle = "background:#fff";
    if (arrowColor == undefined) arrowColor = "#fff";
    $('#ToolbarAd-toggle-container').show().attr('style', barStyle).find('#ToolbarAd-toggle').attr('style', buttonStyle).find('.arrow').css('border-top-color', arrowColor).css('border-bottom-color', arrowColor);
}

$('#ToolbarAd-toggle').live('click', function () {
    var arrowDiv = $(this).find('div');
    if (arrowDiv.hasClass('up')) {
        showToolbarAdOverlay(dyn);
        arrowDiv.removeClass('up').addClass('down');
    }
    else {
        collapseToolbarAd();
        arrowDiv.removeClass('down').addClass('up');
    }
});

$("#Social-toolbar .toggle-down").live('click', function () {
    $('#ToolbarAd-Collapsed-Content-iframe').attr('src', '');
});

$('#Social-trigger').live('click', function () {
    if ($('#ToolbarAd-Collapsed-Content-iframe').attr('src').length < 1) {
        var src = $('#ToolbarAd-Collapsed-Content-src').val();
        $('#ToolbarAd-Collapsed-Content-iframe').attr('src', src);
    }
});

$(document).ready(function () {
    $('#ToolbarAd-Content-iframe').load(function () {
        // set iframe dimensions to those of the embedded object
        var h = $(this).contents().find('object, embed').attr('height');
        if (h !== undefined && h !== $(this).attr('height')) {
            $(this).attr('height', h);
        }
        var w = $(this).contents().find('object, embed').attr('width');
        if (w !== undefined && w !== $(this).attr('width')) {
            $(this).attr('width', w);
        }
    });

    $('#ToolbarAd-Collapsed-Content-iframe').load(function () {
        // set iframe dimensions to those of the embedded object
        var h = $(this).contents().find('object, embed').attr('height');
        if (h !== undefined && h !== $(this).attr('height')) {
            $(this).attr('height', h);
        }
        var w = $(this).contents().find('object, embed').attr('width');
        if (w !== undefined && w !== $(this).attr('width')) {
            $(this).attr('width', w);
        }
    });
    
});

function toolbaronload() {
    //find the height of the internal page
    var the_height =
    document.getElementById('ToolbarAd-Content-iframe').contentWindow.
      document.body.scrollHeight;

    //change the height of the iframe
    document.getElementById('ToolbarAd-Content-iframe').height =
      the_height;
}

KBB.sockets.read(function (e) {
    try {
        var adMessage = JSON.parse(e.data);
        if (adMessage.dyn && (adMessage.type === 'OverlayAd'))
            showToolbarAdOverlay(adMessage.dyn);
    } catch(error) {
    }
}, 'http://ad.doubleclick.net');

KBB.sockets.read(function (e) {
    try {
        var adMessage = JSON.parse(e.data);
        if (adMessage.dyn && (adMessage.type === 'OverlayAd'))
            showToolbarAdOverlay(adMessage.dyn);
    } catch (error) {
    }
}, self.location.protocol + '//' + self.location.host);
;


/* Comment Generated by Combres - Resource '~/js/globaloverlayad.js' (Mode: Static) */

KBB.modules.globalOverlay = (function () {
    var _this, theHeight, theWidth, globalAdContainer, globalAd, adCss, globalAdOverlay, globalAdFrame, globalAdContent, globalAdCloseButton;

    return {
        
        init: function () {
            _this = this;
            theHeight = 300;
            theWidth = 600;
            globalAdContainer   = $('#GlobalOverlayAdCont');
            globalAd            = $('#GlobalOverlayAd');
            globalAdOverlay     = $("#GlobalOverlayAd-Overlay");
            globalAdFrame = globalAd.find('iframe[data-src]').first();
            globalAdCloseButton = globalAd.find('.close'); 
            globalAdContent = globalAd.find('.content');
            
            globalAdCloseButton.on('click', function () {
                _this.collapseGlobalAdOverlay();
            });

            _this.wireUpMessages();

        },
        
        showGlobalAdOverlay: function (dyn, width, height) {
            var indexOfHash = -1, hashValue = "", src = "", currentTime;
            //adjust the overlay size
            if (!!width)
                theWidth = width;
            if (!!height)
                theHeight = height;
            globalAd.width(theWidth);
            globalAd.height(theHeight);
            globalAdFrame.attr('width', theWidth);
            globalAdFrame.attr('height', theHeight);

            //define the ad css
            adCss = {
                zIndex: globalAdContainer.css('z-index') + 2,
                top: '50%',
                marginTop: -theHeight / 2
            };
            globalAd.css(adCss);

            //refresh the iframe source
            src = globalAdFrame.attr('data-src');

            //when the url has hash
            indexOfHash = src.lastIndexOf("#");
            if (indexOfHash > -1) {
                hashValue = src.substring(indexOfHash);
                src = src.substring(0, indexOfHash);
            }

            //add dyn Ad parameter
            if (dyn != undefined && src.indexOf("dyn=") < 0) {
                src = src + ';dyn=' + dyn;
            }

            //add current time to iframe (to avoid caching)
            currentTime = (new Date()).getTime();
            src = KBB.helpers.appendUrlParameter(src, 'curtm', currentTime);

            src = src + hashValue;

            globalAdFrame.attr('src', src);
            globalAdFrame[0].contentWindow.location = src; //fix for IE refresh

            //show overlay
            globalAdContainer.show();
            globalAd.show();
            globalAdOverlay.css({ opacity: .5 }).fadeIn();
            globalAdCloseButton.fadeIn('fast');
            globalAdContent.stop(true, true).show().width(theWidth).animate({ height: theHeight }, 'fast');

        },
        
        collapseGlobalAdOverlay: function () {
            globalAd.fadeOut();
                globalAdCloseButton.stop(true, true).fadeOut('fast', function () {
                    globalAd.stop(true, true).animate({ height: 0 }, 'fast', function () {
                        $(this).hide();
                        globalAdFrame.attr('src', '');
                    });
                });
            globalAdOverlay.fadeOut();
            globalAdContainer.hide();
        },
        
        wireUpMessages: function () {
            KBB.sockets.read(function (e) {
                try {
                    var adMessage = JSON.parse(e.data);
                    if (adMessage.dyn && (adMessage.type === 'GlobalOverlayAd'))
                        KBB.modules.globalOverlay.showGlobalAdOverlay(adMessage.dyn, adMessage.width, adMessage.height);
                } catch (error) {
                }
            }, 'http://ad.doubleclick.net');

            KBB.sockets.read(function (e) {
                try {
                    var adMessage = JSON.parse(e.data);
                    if (adMessage.dyn && (adMessage.type === 'GlobalOverlayAd'))
                        KBB.modules.globalOverlay.showGlobalAdOverlay(adMessage.dyn, adMessage.width, adMessage.height);
                } catch (error) {
                }
            }, self.location.protocol + '//' + self.location.host);

        }
        
    }
}());;


/* Comment Generated by Combres - Resource '~/Views/Vehicle/ymmt/gallery/gallerymodal.js' (Mode: Static) */
$(document).ready(function () {
    $('.photos-modal').click(PhotosModalIconClick);
});
function PhotosModalIconClick(e) {

    /* prevent default for href links */
    if (!!e)
    {
        e.preventDefault();
    }
    var currentTarget = $(e.currentTarget);
    var vehicleTitle = currentTarget.data("vehicle-title");

    if ($.browser.msie) {
        $('#Photos-modal-overlay-confirm-cancel > .btn-center').html(vehicleTitle);
    } else {
        $("#Photos-modal-overlay-confirm-cancel").html(vehicleTitle);
    }

    var originalVehicle = $("#Vehicle-info .content-title").text();
    if (originalVehicle == "") {
        // accessed from none ymm / ymmt path pages, no vehicle text available
        originalVehicle = "Go Back to Original Page";
    }
    if (originalVehicle == "New Car Pricing") {
        // temp tix for left nav a/b test
        originalVehicle = $('#Vehicle-info h1').text();
    }
    if ($('#Model-year-select').length > 0) {
        if ($(this).parents('.model-year-container').find('.model-year-name').text().length > 0)
            originalVehicle = $(this).parents('.model-year-container').find('.model-year-name').text();
    }

    var url = currentTarget.attr("data-photos-modal-url");

    // modal div already exist, just change iframe src
    $('#Photos-modal-overlay').jqm({
        modal: true, overlay: 50,
        closeClass: "close",
        overlayClass: 'mod-modal-overlay',
        toTop: true,
        onShow: function (hash) {
            $("#Photos-modal-iframe").attr("src", url);
            hash.w.show().hvCenter();
            if (hash.w.offset().top < 14) {
                hash.w.css('top', '14px');
            }
        },
        onHide: function (hash) {
            // set iframe url to empty so the iframe doesn't try to load again
            $("#Photos-modal-iframe").attr("src", "");

            hash.w.fadeOut('2000', function () {
                hash.o.remove();
            });
        }
    });

    $("#Photos-modal-overlay").jqmShow();
    $("#GalleryModalDiv").show();

    $('#Photos-modal-overlay-confirm .close').click(function () {
        $('#Photos-modal-overlay-confirm').jqmHide();
        $("#Has-modal-vehicle-changed").val("true");
        $('div.mod-modal-overlay').css('z-index', $('#Photos-modal-overlay').css('z-index') - 11);
    });
    
    if (currentTarget.attr('data-modal-vehicle-year')) {
        $("#Modal-starting-year").val(currentTarget.data('modal-vehicle-year'));
    }
    if (currentTarget.attr('data-modal-vehicle-manufacturer')) {
        $("#Modal-starting-manufacturer").val(currentTarget.data('modal-vehicle-manufacturer'));
    }
    if (currentTarget.attr('data-modal-vehicle-model')) {
        $("#Modal-starting-model").val(currentTarget.data('modal-vehicle-model'));
    }
    
}
function ToFriendlyKBBURLValue(urlValue) {
    var nonAlphaNumericRegExp = /[^a-z0-9\-\s]*/ig;
    var whiteSpaceRegExp = /\s/g;
    urlValue = urlValue.replace(nonAlphaNumericRegExp, "").replace(whiteSpaceRegExp, "-");
    return urlValue;
}
function GalleryModalConfirm() {
    if ($("#Has-modal-vehicle-changed").val() == "true") {

        var startingYear = $("#Modal-starting-year").val();
        var startingManufacturer = $("#Modal-starting-manufacturer").val();
        var startingModel = $("#Modal-starting-model").val();
        var startingUrlModel = ToFriendlyKBBURLValue(startingModel);
        var startingUrl = "/" + startingManufacturer + "/" + startingUrlModel + "/" + startingYear + "-" + startingManufacturer + "-" + startingUrlModel + "/";
        var startingTitle = startingYear + " " + startingManufacturer + " " + startingModel;

        var year = $("#Modal-year").val();
        var manufacturer = $("#Modal-manufacturer").val();
        var model = $("#Modal-model").val();
        var friendlyKBBURLModel = ToFriendlyKBBURLValue(model);
        var url = "/" + manufacturer + "/" + friendlyKBBURLModel  + "/" + year + "-" + manufacturer + "-" + friendlyKBBURLModel + "/";
        var title = year + " " + manufacturer + " " + model;

        $('#Photos-modal-overlay-confirm').jqm({
            modal: true,
            overlay: 50,
            overlayClass: 'mod-modal-overlay',
            toTop: true,
            onShow: function (hash) {
                hash.w.hvCenter().show().ctaFix();
                if (hash.w.find('p').css('margin-bottom') == '0px') {
                    hash.w.find('p').css({ 'font-family': 'tahoma, arial', 'font-size': '12px', 'margin-bottom': '12px' });
                }
            }
        }).jqmShow();
        
        $('#Photos-modal-overlay-confirm-ok').attr("href", url);
        if ($('#Photos-modal-overlay-confirm-ok').hasClass('btn-cta-fix')) {
            $('#Photos-modal-overlay-confirm-ok .btn-center').html(title);
        } else {
            $('#Photos-modal-overlay-confirm-ok').html(title);
        }

        if (startingTitle != title && startingYear != "") {
            $('#Photos-modal-overlay-starting-confirm-ok').attr("href", startingUrl).show();
            if ($('#Photos-modal-overlay-starting-confirm-ok').hasClass('btn-cta-fix')) {
                $('#Photos-modal-overlay-starting-confirm-ok .btn-center').html(startingTitle);
            } else {
                $('#Photos-modal-overlay-starting-confirm-ok').html(startingTitle);
            }    
        }

        $('#Photos-modal-overlay').css('z-index', $('#Photos-modal-overlay').css('z-index') - 10);
        $('#mod-modal-overlay').css('z-index', $('#mod-modal-overlay').css('z-index') - 9);

        $("#Has-modal-vehicle-changed").val("false");
    } else {
        $("#Photos-modal-overlay").jqmHide();
    }
}

function GotoOriginal() {
    $("#Photos-modal-overlay").jqmHide();
    $('#Photos-modal-overlay-confirm').jqmHide();
    $("#Has-modal-vehicle-changed").val("false");
};


/* Comment Generated by Combres - Resource '~/js/kbbsurvey.js' (Mode: Static) */
function SetSurveyHash() {
    if (window.location.host.indexOf("usedcars") < 0)
        window.location.hash = "survey";
}

function ScrollPopupOn() {
    window.onscroll = redrawpopup;
}

function ScrollPopupOff() {
    window.onscroll = "";
}

function redrawpopup() {
    parent.document.getElementById("InstructionIframe").style.top = document.documentElement.scrollTop;
    parent.document.getElementById("InstructionIframe").style.display = "none";
    parent.document.getElementById("InstructionIframe").style.display = "block";
}

function ResizeMe(frame, name) {
    if (document.getElementById) {
        if (navigator.userAgent.indexOf('MSIE') != -1) {
            frame.style.height = (frames[name].document.getElementById("invitationPanel").scrollHeight + 5) + "px";
        } else {
            frame.style.height = (frames[name].document.getElementById("invitationPanel").scrollHeight + 3) + "px";
        }
    }
    else if (!window.opera && document.all && document.getElementById && !document.mimeType) {
        frame.style.height = frames[name].document.body.offsetHeight + "px";
    }
}
function ShowSurvey() {
    if (typeof surveyURL != "undefined") {
        if (jQuery.trim(surveyURL) != "") {
            var SurveyIframeContent = jQuery("#SurveyIframeContent");
            SurveyIframeContent.css({ display: "block" });
            SurveyIframeContent.append('<iframe id="SurveyIframe" name="SurveyIframe" src="" frameborder="0" allowtransparency="true" scrolling="no" style="z-index:10000000;top:' + surveytoppos + ';left:' + surveyleftpos + ';border:1px;position:absolute;width:353px;height:325px !important;"></iframe>');
            setTimeout(function () {
                jQuery("#SurveyIframe").attr("src", surveyURL);
            });
        }
    }
    if (typeof surveyIFrameInstUrl != "undefined") {
        if (jQuery.trim(surveyIFrameInstUrl) != "") {
            var InstructionIframeContent = jQuery("#InstructionIframeContent");
            if (InstructionIframeContent.length) {
                InstructionIframeContent.append('<iframe id="InstructionIframe" name="InstructionIframe" src="" frameborder="0" allowtransparency="true" scrolling="no" style="top:0;z-index:10000000;border:1px;position:absolute;width:353px;height:325px !important;"></iframe>');
                setTimeout(function () {
                    jQuery("#InstructionIframe").attr("src", surveyIFrameInstUrl);
                });
            }
        }
        
    }
}

