if(window.BrightTag==undefined)window.BrightTag={module:function(a,d){return BrightTag[a]||(BrightTag[a]=d)},each:function(a,d){if(BrightTag.Types.isObject(a))for(var i in a)a.hasOwnProperty(i)&&d(i,a[i]);else if(BrightTag.Types.isArray(a)){i=0;for(var g=a.length;i<g;i++)d(a[i],i)}},pushIfDefined:function(a,d,i){if(a&&a.constructor==Array&&d!=null)a.push(i||d)},extend:function(a,d){for(var i in d)if(d.hasOwnProperty(i))a[i]=d[i];return a},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,
"")},eval:function(a,d){try{return eval.call(undefined,a)}catch(i){bt_handle_exception((d!=null?d:"")+i)}},Escaper:{javascript:function(a){if(a==undefined||a.constructor!=String)return a;return String(a).replace("\\","\\\\").replace("'","\\x27").replace('"',"\\x22").replace("\n","\\n").replace("\r","\\r")}},Random:{integer:function(a){return Math.floor(Math.random()*(a||1E8))}},Types:{isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isFunction:function(a){return Object.prototype.toString.call(a)===
"[object Function]"},isObject:function(a){if(a===null||a===undefined)return false;return Object.prototype.toString.call(a)==="[object Object]"}},defaultConfig:function(){return{loadOnly:false,window:window,document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,data:{},errorManager:new BrightTag.ErrorManager(new BrightTag.HTTP.Cookie(document))}}};BrightTag.Blab={};
BrightTag.Blab.Engine=function(a){function d(){o=true;s=p.length;b("engine:off")}function i(){o=false;t=0;(p[s++]||d)()}function g(m){return function(){var u=false,l=a.createElement("script");l.onload=l.onreadystatechange=function(){var r;if(!(r=u)){a:{switch(l.readyState){case undefined:case "loaded":case "complete":r=true;break a}r=false}r=!r}if(!r){u=true;b("block:finish");i()}};l.src=m;b("block:start",m);var n=a.getElementsByTagName("script")[0];n.parentNode.insertBefore(l,n)}}function j(m){return function(){try{b("block:start",
m);if(m.constructor==String)if(a.defaultView)a.defaultView.eval.call(undefined,m);else a.parentWindow?a.parentWindow.execScript(m):b("block:error",{type:"wait",exception:"Could not evaluate wait block ["+m+"]"});else m()}catch(u){b("block:error",{type:"wait",exception:u})}finally{b("block:finish");i()}}}function f(m){p.push(m);o&&i();return c}function e(m){p.splice(s+t++,0,m);return c}function b(m){var u=Array.prototype.slice.call(arguments,1);BrightTag.each(k,function(l){var n=[c].concat(u);(l[m]||
h).apply(null,n)})}var c=this,h=function(){},k=[],o=false,q={},p=[],s=0,t=0;c.run=function(){b("engine:on");i()};c.options=function(m){BrightTag.extend(q,m);return c};c.option=function(m){return q[m]};c.script=function(m){return f(g(m))};c.wait=function(m){return f(j(m))};c.preemptScript=function(m){return e(g(m))};c.preemptWait=function(m){return e(j(m))};c.listen=function(m){k.push(m);(m["engine:listen"]||h).apply(null,[c]);return c}};
BrightTag.Blab.Group=function(){function a(b){j.push(b)}function d(b){b.run()}function i(){var b=j[f++];b?b.listen(e).run():g.doNotQueue()}var g=this,j=[],f=0,e={"engine:off":function(){i()}};g.doNotQueue=function(){a=d};g.push=function(b){a(b);return b};g.run=function(){i()};g.applyListener=function(b){for(var c=f,h=j.length;c<h;c++)j[c].listen(b)}};
BrightTag.Blab.Manager=function(a){function d(e){var b=new g.Engine(a);i.each(f,function(c){b.listen(c)});return(j[e]||(j[e]=new g.Group)).push(b)}var i=BrightTag,g=i.Blab,j={undefined:new g.Group},f=[];j[undefined].doNotQueue();this.addGlobalListener=function(e){f.push(e);i.each(j,function(b){j[b].applyListener(e)})};this.group=function(e){return d(e)};this.listen=function(){return d().listen.apply(null,arguments)};this.script=function(){return d().script.apply(null,arguments)};this.wait=function(){return d().wait.apply(null,
arguments)};this.run=function(e){(j[e]||(j[e]=new g.Group)).run()};this.setOptions=function(){return d()}};
BrightTag.Blab.SwapwriteListener=function(){var a,d=[],i=function(g){a.push(g)};return function(g){function j(c){c.src&&e.preemptScript(c.src);c.innerHTML&&e.preemptWait(c.innerHTML)}function f(c){try{g.body.appendChild(c.cloneNode(true))}catch(h){bt_handle_exception("BrightTag: error appending content to body: "+h)}}var e,b=g.createElement("div");this["block:start"]=function(){var c=g;d.push([a,c.write,c.writeln]);a=[];c.write=c.writeln=i};this["block:finish"]=function(){try{if(a.length!=0){b.innerHTML=
"<br/>"+a.join("");for(var c=b.childNodes||[],h=1,k=c.length;h<k;h++)(c[h].tagName=="SCRIPT"?j:f)(c[h])}}finally{c=g;h=d.pop();a=h[0];c.write=h[1];c.writeln=h[2]}};this["engine:listen"]=function(c){e=c}}}();BrightTag.Blab.GlobalSwapwriteListener=function(a){var d=BrightTag.Blab;this["engine:listen"]=function(i){i.listen(new d.SwapwriteListener(a))}};
BrightTag.module("EventsManager",function(){function a(){}function d(b,c,h){e(b,c,function(){if(!h||h())BrightTag.EventListenerOverride(b,c)})}function i(b){b=b.documentElement.doScroll||function(){throw"No doScroll";};try{b("left")}catch(c){return false}return true}function g(b){var c=b.readyState;return c=="loading"?false:c=="complete"?true:b.addEventListener?c=="interactive":i(b)}function j(b,c,h){var k=this;setTimeout(function(){b()?c.call(k):j(b,c,h)},h)}var f=this,e=f.listen=function(b,c,h){if(b.addEventListener)b.addEventListener(c,
h,false);else b.attachEvent&&b.attachEvent("on"+c,h)};f.domReady=function(b,c){if(g(b))c.call(this);else b.addEventListener?e(b,"DOMContentLoaded",c):j(function(){return g(b)},c,1)};f.enablePageReadyOverrides=function(b,c){f.enablePageReadyOverrides=a;c.readyState=="complete"?BrightTag.EventListenerOverride(b,"load"):d(b,"load");if(c.addEventListener){var h=c.readyState;h=="complete"||h=="interactive"?BrightTag.EventListenerOverride(c,"DOMContentLoaded"):d(c,"DOMContentLoaded")}}});
BrightTag.module("EventListenerOverride",function(a,d){function i(f){var e=this;setTimeout(function(){try{f.call(e)}catch(b){bt_handle_exception("BrightTag error overriding "+d+" event: "+b)}},0)}var g=a.addEventListener?"addEventListener":"attachEvent",j=a[g];a[g]=function(f,e,b){if(typeof e=="function")if(f==d||f=="on"+d)i(e);else try{g=="addEventListener"?j.call(a,f,e,b):j(f,e)}catch(c){bt_handle_exception("BrightTag error proxying "+f+" event: "+c)}}});BrightTag.module("Events",new BrightTag.EventsManager);
BrightTag.module("EventBindingManager",function(a){var d={},i=[],g=BrightTag.jQueryLoader(a,"BrightTag.jQuery");d.Binder=function(e){var b=this,c=[];b.data=function(h,k){c.push({name:h,dbe:k});return b};b.bindData=function(h,k,o){BrightTag.each(c,function(q){try{BrightTag.instance.data(q.name,g.functionWithAccess(["eventObject","eventData"],"return "+q.dbe+";").call(h,k,o))}catch(p){bt_log("Error binding "+q+": "+p)}})};b.handler=function(h){var k=i[e];if(k){var o=Array.prototype.slice.call(arguments,
1);b.bindData(h.target,h,o);k.handler(h,o)}}};var j=function(){var e=this,b=[],c=[];e.execute=function(k){if(k.constructor==Function)b.push(k);else if(k.constructor==String)try{b.push(g.functionWithAccess(["eventObject","eventData"],k))}catch(o){bt_handle_exception("BrightTag could not execute action: "+o)}else bt_log("execute: bad action = "+k);return e};e.fire=function(k){k=new h(k);c.push(k);return k};e.handler=function(k,o){d.executeActions(b,k,o);d.fireTags(c)};var h=function(k){var o=this,q=
[];o.appendData=function(p){q.push(function(s){s.appendData(p)});return o};o.appendJs=function(p){q.push(function(s){s.appendJs(p)});return o};o.postProcess=function(p){BrightTag.each(q,function(s){s(p)})};o.tagId=k;o.execute=e.execute;o.fire=e.fire}},f=/^direct\//i;d.bind=function(e,b,c){var h=new d.Binder(e);g.ensureJQuery(function(){var k=g.getJQuery()(b);k.live&&b.constructor===String&&!f.test(c)?k.live(c,h.handler):k.bind(c.split(f).pop(),h.handler)});return h};d.when=function(e){return i[e]||
(i[e]=new j)};d.executeActions=function(e,b,c){BrightTag.each(e,function(h){try{h.call(b.target,b,c)}catch(k){bt_handle_exception(k)}})};d.fireTags=function(e){if(e.length>0){var b=BrightTag.instance.serverURL();BrightTag.each(e,function(c){b.cf(c.tagId);c.postProcess(b)});BrightTag.Blab.script(b.asString())}};return d});BrightTag.module("HTTP",{});
BrightTag.module("HTTP").Cookie=function(a){var d=this,i={};d.get=function(g){return i[g]};d.remove=function(g){d.set(g,"",{expires:0})};d.set=function(g,j,f){if(g){f=f||{};g=[g+"="+(j||"")];if((j=f.expires)||j===0){if(Object.prototype.toString.call(j)==="[object Number]")j=(new Date(j)).toGMTString();g.push("expires="+j)}(j=f.path)&&g.push("path="+j);(j=f.domain)&&g.push("domain="+j);f.secure===true&&g.push("Secure");f.httponly===true&&g.push("HttpOnly");a.cookie=g.join("; ")}};(function(g){for(var j,
f=g.split(/; ?/),e=0,b=f.length;e<b;e++){j=f[e];g=j.indexOf("=");i[j.slice(0,g)]=j.slice(g+1)}})(a.cookie)};
BrightTag.module("HTTP").QueryString=function(a){function d(f){if(f&&typeof f=="string"){var e=f.split("&");f={};g.each(e,function(b){b=b.split("=");b={key:decodeURIComponent(b[0]),value:b[1]&&decodeURIComponent(b[1].replace(/\+/g," "))};f[b.key]=b.value})}return f}var i=this,g=BrightTag,j={};g.extend(j,d(a));i.param=function(f){return j[f]||""};i.params=function(){return j};i.appendParam=function(f,e){if(f&&e!=undefined&&e!=="")j[f]=e;return this};i.appendParams=function(f){g.each(f,i.appendParam);
return this};i.alwaysAppendParam=function(f,e){if(f)j[f]=e!=undefined?e:"";return this};i.alwaysAppendParams=function(f){g.each(f,i.alwaysAppendParam);return this};i.appendPartialQueryString=function(f){f&&i.alwaysAppendParams(d(f));return this};i.deleteParam=function(f){delete j[f]};i.toString=function(){var f=[];for(var e in j){var b={key:encodeURIComponent(e),value:encodeURIComponent(j[e])};f.push(b.key+"="+b.value)}return f.join("&")}};
BrightTag.module("HTTP").URL=function(a){var d=this,i,g,j,f=a.indexOf("#");if(f>-1){j=a.substring(f+1);a=a.substring(0,f)}f=a.indexOf("?");if(f>-1){g=a.substring(f+1);a=a.substring(0,f)}i=a;a=new BrightTag.HTTP.QueryString(g);BrightTag.extend(d,a);d.queryString=a.toString;d.toString=function(){var e=d.queryString();return i+(e.length>0?"?"+e:"")};d.asString=d.toString;d.fragment=function(){return j}};
BrightTag.module("ServerURL",function(a){var d=this,i=a.host,g=BrightTag,j=a.window,f=a.parentReferrer,e=a.referrer,b="";if(i.length>0)b=(i.match("^[a-z0-9+.-]+://.+")?"":"//")+i+"/tag";g.HTTP.URL.call(this,b);d.appendParams({site:a.site,referrer:e,docReferrer:a.docReferrer,mode:a.mode});e!==f&&d.appendParam("parentReferrer",f);d.appendData=function(c){var h=bt_data(c),k;a:switch(Object.prototype.toString.apply(h)){case "[object Array]":case "[object Object]":k=true;break a;default:k=false;break a}h=
k?j.JSON.stringify(h):h;return d.alwaysAppendParam("_cb_"+("bt_data('"+c+"')"),h)};d.appendJs=function(c){return d.alwaysAppendParam("_cb_"+c,g.eval(c,"Invalid inline JavaScript expression: "+c+", exception = "))};d.cf=function(c){if(c.constructor!=Array)c=[c];var h=d.param("cf");if(h)c=Array(h).concat(c);d.appendParam("cf",c.join());return d};d.addCf=function(c,h){if(!g.eval(h,"Invalid conditional fire expression: "+h+", exception = "))return false;var k=d.param("cf");d.appendParam("cf",k?k+","+
c:c);return true}});
BrightTag.module("Page",function(a,d){function i(l){Object.prototype.toString.call(l)==="[object Array]"?h.each(l,function(n){p.write('<script type="text/javascript" src="'+n+'"><\/script>')}):p.write('<script type="text/javascript" src="'+l+'"><\/script>')}function g(l){var n=t.group();Object.prototype.toString.call(l)==="[object Array]"?h.each(l,function(r){n.script(r)}):n.script(l)}function j(l){p.write(l)}function f(l,n){var r={};if(n&&n.tagId)r.tagId=n.tagId;t.group(!u?"domready":undefined).options(r).wait(function(){p.write(l)})}
function e(l){c.writeScript=l?i:g;c.appendContent=l?j:f}function b(l){var n={site:a.site,referrer:a.referrer||p.location.href};if(m.hasErrors()){l.appendParam("errors",m.toJSON());if(l.toString().length>2083){l.deleteParam("errors");m.reset(n);m.push(new t.group,{exception:"Too many errors"});l.appendParam("errors",m.toJSON())}}m.reset(n)}var c=this,h=BrightTag,k=undefined,o=a.data||{},q=undefined,p=a.document,s=a.window,t=a.blab||h.Blab,m=a.errorManager,u=false;c.referrer=a.referrer;c.parentReferrer=
a.parentReferrer;c.docReferrer=a.docReferrer;m&&t.addGlobalListener(m);e(a.mode==="sync");c.domReady=function(){u=true;t.addGlobalListener(new t.GlobalSwapwriteListener(p));a.mode==="sync"&&e(false);t.run("domready")};c.parameter=function(l){if(k==undefined)k=new h.HTTP.URL(p.location.href);return k.param(l)};c.meta=function(l){if(!q){q={};h.each(p.getElementsByTagName("meta"),function(n){q[n.getAttribute("name")]=n.getAttribute("content")})}return q[l]||""};c.data=function(l,n){if(n!==undefined)return o[l]=
n;n=o[l];return n==undefined?"":n};c.dbe=function(l,n){c.data(l,h.eval(n,"BrightTag: the data binding expression for '"+l+"' is invalid: "))};c.errors=function(l){m.configure(l)};c.serverURL=function(){return new h.ServerURL(a)};c.defaultBaseUri=function(){return(p.location.protocol=="https:"?"https:":"http:")+"//s.btstatic.com/"};c.baseUri=function(){return d&&d.src&&d.src.replace(/[^/]+$/,"")||c.defaultBaseUri()};c.primary=function(){s.JSON||c.writeScript(c.baseUri()+"json2.js");var l=c.serverURL();
m&&b(l);c.writeScript(l.toString())};c.secondary=function(l){var n=c.serverURL(),r=n.toString();l(n);m&&b(n);l=n.toString();l!=r&&c.writeScript(l)}});
BrightTag.module("ErrorManager",function(a){if(!a)throw"ErrorManager requires a store";var d=this,i,g,j=true,f=[];d.configure=function(e){j=e.enabled};d.hasErrors=function(){return f.length>0};d.toArray=function(){return f};d.toJSON=function(){try{return JSON.stringify({site:i,referrer:g,errors:f})}catch(e){bt_log("BrightTag: problem serializing errors: "+e.message)}};d.reset=function(e){i=e.site;g=e.referrer;f=[];a.remove("__bterr")};d.push=d["block:error"]=function(e,b){if(j&&b){var c=b.type||"unknown",
h=b.exception||b;bt_log("BrightTag: tag error: "+c+"/"+h);f.push({type:c,message:h.toString(),tagId:e.option("tagId")||-1,timestamp:+new Date});a.set("__bterr",d.toJSON())}};(function(e){if(e)try{var b=JSON.parse(e);i=b.site;g=b.referrer;if(BrightTag.Types.isArray(b.errors))f=f.concat(b.errors)}catch(c){bt_log("BrightTag: problem reading stored errors: "+c.message)}})(a.get("__bterr"))});
BrightTag.module("CookieSyncEngine",function(a){var d={fn:function(b){b()},next:null},i=d,g=a.document,j=function(b){if(typeof b!="function")return false;b={fn:b,next:null};i=i.next=b;return true},f=function(){if(d){var b=d.fn;d=d.next;b(f)}},e=f;BrightTag.Events.listen(a,"load",e);return{sync:e,push:function(b){return j(b)},pushImage:function(b){return j(function(c){var h=new a.Image;h.onerror=h.onload=c;h.src=b})},pushIframe:function(b){return j(function(c){var h=g.createElement("iframe");h.onerror=
h.onload=c;h.width=0;h.height=0;h.style.border=0;h.src=b;g.body.appendChild(h)})}}});function bt_parameter(a){return BrightTag.instance.parameter(a)}function bt_meta(a){return BrightTag.instance.meta(a)}function bt_data(a,d){return BrightTag.instance.data(a,d)}function bt_data_escaped(a,d){return bt_data(a,d)}function bt_log(a){window.console&&console.log&&console.log(a)}var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;
function btServe(a){if(BrightTag.instance==undefined){var d=BrightTag,i=d.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},d.defaultConfig());if(_bt_url_prefix!=undefined)i.host=_bt_url_prefix;d.instance=d.Main(d.extend(i,a||{}))}}
BrightTag.module("jQueryLoader",function(a,d){return new (function(i,g){function j(k){h.wait(k)}function f(k){function o(){b=BrightTag.jQuery;j(k)}c="var $ = BrightTag.$; ";BrightTag.jQuery?o():h.script(BrightTag.instance.baseUri()+"BrightTag.jquery-1.5.1.js").wait(o)}var e={},b=i.jQuery,c="",h=BrightTag.Blab.group(g);e.getJQuery=function(){return b};e.functionWithAccess=function(k,o){return new Function(k,c+o)};e.ensureJQuery=function(k){e.ensureJQuery=j;(b?j:f)(k);BrightTag.Blab.run(g)};return e})(a,
d)});
BrightTag.module("Main",function(a){function d(b){(b=(new g.HTTP.URL(b.src)).fragment())&&g.extend(a,(new g.HTTP.QueryString(b)).params())}function i(b){b=g.trim(b.innerHTML);b.length!=0&&g.extend(a,g.eval("(\n"+b+"\n)","BrightTag configuration error: "))}var g=BrightTag,j=function(){for(var b=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/,c=a.document.getElementsByTagName("script"),h=c.length-1;h>-1;h--){var k=c[h];if(b.test(k.src))return k}}();if(j){d(j);i(j)}if(a.site!=undefined){g.Events.enablePageReadyOverrides(a.window,a.document);
try{var f=new g.Page(a,j);g.Events.domReady(a.document,function(){f.domReady()});a.loadOnly||f.primary();return f}catch(e){bt_handle_exception("BrightTag execution error: "+e)}}});(function(a){if(a.instance==undefined){a.extend(a.Blab,new a.Blab.Manager(document));a.$LAB=a.Blab;a.EventBinding=a.EventBindingManager(window);a.CookieSync=a.CookieSyncEngine(window);a.instance=a.Main(a.defaultConfig())}else bt_log("Tried to load tag.js again")})(window.BrightTag);
