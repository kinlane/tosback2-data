function Accessibility(opt)
{

    this.settings = {
		"context" : document,
		"elements" : "a,input,select,radio,checkbox",
		"instructions" : null,
		"focusedClass" : "focused",
		"toolTipWrapperId" : "accessibilityToolTip",
		"pointerWrapperId" : "toolTipPointer",
		"hasToolTipClass" : "hasToolTip",
		"imageEnabledClass" : "images_enabled",
		"imageDisabledClass" : "images_disabled",
		"pingImage": "/hsbcdotcom/images/background/ping.gif",
		"toolTipTemplate" : "<div class='tooltip'><!--text--></div>",
		"labelTemplate" : "<span class='tooltip-label'></span>",
		"pointerTemplate" : "<span class='tooltip-pointer'></span>",
		//"pointerTemplate" : "<img src='../../../images/background/point.gif' />",
		"toolTipAttr": "data-tooltip",
		"hideOnMouseMove" : true,
		"pointOnFocus" : true,
		"pointOnGaps": false,
        "handdleDynamicContent" : true,
		"gapSize" : 200,
		"navKey" : 9,
		"enterKey" : 13,
		"escKey" : 27,
		"ctrlKey" : 17,
		"directions" : [],
		"groups" : [],
		"rules" : [],
		"tooltips" : []
	};

	this.events = {
		"focus" : "customFocus",
		"enter" : "customClick",
		"blur" : "customBlur",
		"tab" : "tabPress",
		"esc" : "escape"
	};
	this.exception = null;
	this.direction = "";
	this.selectedNode = null;
	this.prevNode = null;
	this.selectedNodeNo = 0;
	this.prevNodeNo = 0;
	this.selectedInstructionNodeNo = 0;
	this.navigating = false;
	this.insideGroup = false;
	this.lastGroup = null;
	this.pointerTop = 0;
	this.pointerLeft = 0;
	this.hasToolTip = false;
	this.lastPos = 0;
    this.settings = $.extend(this.settings, opt);

}

window.showInstructions=true;Accessibility.prototype.init=function(){try{var e=this;this.detectImageEnabled();e.update();if(this.settings.handdleDynamicContent){$(this.settings.context).ajaxStop(function(){e.update()})}}catch(t){this.exception=t}};Accessibility.prototype.update=function(){try{var e=this;for(var t=0;t<e.settings.rules.length;t++){e.processRule(e.settings.rules[t])}e.processToolTips();$(e.settings.context).unbind("keydown",e.initKeyDown).bind("keydown",{obj:e},e.initKeyDown);if(e.settings.hideOnMouseMove)$(e.settings.context).unbind("mousemove",e.initMouseMove).bind("mousemove",{obj:e},e.initMouseMove);$(e.settings.elements).unbind("keyup",e.initKeyUp).bind("keyup",{obj:e},e.initKeyUp);$(e.settings.elements).unbind(e.events.tab,e.initTabPress).bind(e.events.tab,{obj:e},e.initTabPress);for(var t=0;t<e.settings.groups.length;t++)e.settings.groups[t].unbind(e.events.tab).bind(e.events.tab,{obj:e,group:e.settings.groups[t]},e.initGroupTabPress)}catch(n){this.exception=n}};Accessibility.prototype.detectImageEnabled=function(){var e=this;var t=0;var n=false;var r=function(){if($("html").hasClass(e.settings.imageDisabledClass))$("html").removeClass(e.settings.imageDisabledClass);if($("html").hasClass(e.settings.imageEnabledClass)==false)$("html").addClass(e.settings.imageEnabledClass);n=true};var i=function(){if($("html").hasClass(e.settings.imageEnabledClass))$("html").removeClass(e.settings.imageEnabledClass);if($("html").hasClass(e.settings.imageDisabledClass)==false)$("html").addClass(e.settings.imageDisabledClass)};var s=new Image;var o=(new Date).getTime();if(navigator.appName.indexOf("Microsoft Internet Explorer")!=-1){s.onload=r;s.onabort=r;s.onerror=r;s.src=e.settings.pingImage+"?t="+o;setTimeout(function(){if(n==false)i()},0)}else if(navigator.appName.indexOf("Opera")!=-1){s.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="+"?time="+(new Date).getTime();if(s.complete){r()}else{i()}}else{s.src=e.settings.pingImage+"?t="+o;if(navigator.userAgent.indexOf("BlackBerry")!=-1){if(s.complete){r()}else{i()}}else{if(s.complete){i()}else{r()}}}};Accessibility.prototype.initKeyDown=function(e){var t=e.keyCode;var n=e.shiftKey;var r=e.data.obj;var i=$(document.activeElement);if(t==r.settings.navKey){r.navigating=true;$(r.settings.elements).removeClass(r.settings.focusedClass);if(r.settings.instructions!=null&&window.showInstructions==true){if(r.settings.instructions.css("display")=="block"){e.preventDefault();var s=r.settings.instructions.find("a");if(n==true){if(r.selectedInstructionNodeNo>0&&r.selectedInstructionNodeNo<s.length&&r.insideGroup==true)r.selectedInstructionNodeNo-=1;else if(r.selectedInstructionNodeNo==s.length-1&&r.insideGroup==false){r.selectedInstructionNodeNo=s.length-1;r.insideGroup=true}else r.selectedInstructionNodeNo=s.length-1}else{if(r.selectedInstructionNodeNo>=0&&r.selectedInstructionNodeNo<s.length-1&&r.insideGroup==true)r.selectedInstructionNodeNo+=1;else if(r.selectedInstructionNodeNo==0&&r.insideGroup==false){r.selectedInstructionNodeNo=0;r.insideGroup=true}else if(r.selectedInstructionNodeNo>0&&r.selectedInstructionNodeNo<s.length-1&&r.insideGroup==false)r.selectedInstructionNodeNo+=1;else r.selectedInstructionNodeNo=0}s.removeClass(r.settings.focusedClass);s.eq(r.selectedInstructionNodeNo).focus();s.eq(r.selectedInstructionNodeNo).addClass(r.settings.focusedClass);return false}else{r.toggleInfoBox()}}if(r.settings.instructions==null||window.showInstructions==false){var o=false;for(var u=0;u<r.settings.groups.length;u++){var a=1;var f=r.settings.groups[u].length;r.settings.groups[u].each(function(){if(n==false&&a!=f||n==true&&a!=1){if($(this).is(i)){o=true;return false}}a++})}if(o==true){e.preventDefault();return false}}}else if(t==r.settings.escKey){e.preventDefault();r.initReset(e);if(r.selectedNode!=null){var l=jQuery.Event(r.events.esc);l.keyCode=t;l.shiftKey=e.shiftKey;r.selectedNode.trigger(l)}}else if(t==r.settings.enterKey){if(r.selectedNode!=null){var l=jQuery.Event(r.events.enter);l.keyCode=t;l.shiftKey=e.shiftKey;r.selectedNode.trigger(l)}}else if(t==r.settings.ctrlKey){if(r.selectedNode!=null){if(r.settings.pointOnFocus){$("html,body").animate({scrollTop:r.lastPos},300);r.pointFocused()}}}};Accessibility.prototype.initMouseMove=function(e){var t=e.data.obj;t.initReset(e)};Accessibility.prototype.initReset=function(e){var t=e!==undefined?e.data.obj:this;if(t.navigating==true){if(this.settings.instructions!=null&&this.settings.instructions.css("display")=="block"){window.showInstructions=false;this.settings.instructions.slideUp(500)}$(t.settings.elements).removeClass(t.settings.focusedClass);$("#"+t.settings.toolTipWrapperId).remove();var n=$("#"+this.settings.pointerWrapperId);if(n.length>0)n.remove();var r=jQuery.Event(t.events.blur);$(t.settings.elements).trigger(r);t.navigating=false}};Accessibility.prototype.initKeyUp=function(e){var t=e.keyCode;var n=e.data.obj;n.selectedNode=$(this);if(n.settings.instructions==null||n.settings.instructions.css("display")=="none"){if(t==n.settings.navKey){e.preventDefault();var r=jQuery.Event(n.events.tab);r.keyCode=t;r.shiftKey=e.shiftKey;n.selectedNode.trigger(r)}}};Accessibility.prototype.initTabPress=function(e){var t=e.data.obj;t.insideGroup=false;t.setFocus($(this),e)};Accessibility.prototype.initGroupTabPress=function(e){e.preventDefault();var t=e.keyCode;var n=e.shiftKey;var r=e.data.obj;var i=e.data.group;r.lastGroup=i;if(n==true){if(r.selectedNodeNo>0&&r.selectedNodeNo<i.length&&r.insideGroup==true)r.selectedNodeNo-=1;else if(r.selectedNodeNo==i.length-1&&r.insideGroup==false){r.selectedNodeNo=i.length-1;r.prevNodeNo=i.length-1;r.insideGroup=true}else{r.selectedNodeNo=i.length-1;r.prevNodeNo=i.length-1;r.insideGroup=true}}else{if(r.selectedNodeNo>=0&&r.selectedNodeNo<i.length-1&&r.insideGroup==true)r.selectedNodeNo+=1;else if(r.selectedNodeNo==0&&r.insideGroup==false){r.selectedNodeNo=0;r.prevNodeNo=0;r.insideGroup=true}else if(r.selectedNodeNo>0&&r.selectedNodeNo<i.length-1&&r.insideGroup==false)r.selectedNodeNo+=1;else{r.selectedNodeNo=0;r.prevNodeNo=0;r.insideGroup=true}}var s=i.eq(r.prevNodeNo);var o=i.eq(r.selectedNodeNo);if(o.is(s)==false){var u=jQuery.Event(r.events.blur);u.keyCode=e!==undefined?t:r.settings.navKey;u.shiftKey=e!==undefined?e.shiftKey:false;s.trigger(u)}r.prevNodeNo=r.selectedNodeNo;r.setFocus(o,e)};Accessibility.prototype.setFocus=function(e,t){if(t!==undefined){var n=t.keyCode;var r=t.data.obj}else{var r=this}r.selectedNode=e;r.selectedNode.focus();$(r.settings.elements).removeClass(r.settings.focusedClass);r.selectedNode.addClass(r.settings.focusedClass);if(r.prevNode!=null){var i=jQuery.Event(r.events.blur);i.keyCode=t!==undefined?n:r.settings.navKey;i.shiftKey=t!==undefined?t.shiftKey:false;r.prevNode.trigger(i)}var i=jQuery.Event(r.events.focus);i.keyCode=t!==undefined?n:r.settings.navKey;i.shiftKey=t!==undefined?t.shiftKey:false;r.selectedNode.trigger(i);if(t===undefined)e.focus();r.prevNode=r.selectedNode;r.updateToolTip()};Accessibility.prototype.updateToolTip=function(e){var t=this;var n="left";var e=e!==undefined?parseInt(e):0;setTimeout(function(){if($("#"+t.settings.toolTipWrapperId).length>0)$("#"+t.settings.toolTipWrapperId).remove();t.hasToolTip=false;var e=t.selectedNode.attr(t.settings.toolTipAttr);if(e!==undefined&&e!=""){var r=t.settings.toolTipTemplate.replace("<!--text-->",e);r="<div id='"+t.settings.toolTipWrapperId+"' class='"+t.settings.toolTipWrapperId+"'>"+r+"</div>";t.hasToolTip=true}else{r="<div id='"+t.settings.toolTipWrapperId+"' class='"+t.settings.toolTipWrapperId+"'>"+t.settings.labelTemplate+"</div>"}$("body").append(r);for(var i=0;i<t.settings.directions.length;i++){if(t.settings.directions[i][0].is(t.selectedNode))n=t.settings.directions[i][1]}var s=$("#"+t.settings.toolTipWrapperId);var o=t.selectedNode.offset().top;var u=t.selectedNode.offset().left;var a=s.children().eq(0).outerWidth();var f=s.outerHeight();var l=t.selectedNode.outerWidth();var c=t.selectedNode.outerHeight();t.pointerTop=o;t.pointerLeft=u;var h=0;var p=0;if(n=="right"){o=o;u=u+l}else if(n=="top"){o=o-f;u=u}else if(n=="bottom"){o=o+c+parseFloat(t.selectedNode.css("padding-top"))+parseFloat(t.selectedNode.css("padding-bottom"));u=u}else{h=e!==undefined&&e!=""?0:parseFloat(t.selectedNode.css("padding-top"));p=e!==undefined&&e!=""?0:parseFloat(t.selectedNode.css("padding-left"));o=o+h;u=u-a}t.pointerTop+=h;s.css({position:"absolute"});s.offset({top:o,left:u});var d=o-$(window).height()/2;d=o>$(window).height()/2?d:$("html,body").scrollTop();var v=Math.abs(d-t.lastPos);if(v>10)$("html,body").animate({scrollTop:d},300);if(v>t.settings.gapSize&&t.settings.pointOnGaps==true)t.pointFocused();t.lastPos=d},e)};Accessibility.prototype.pointFocused=function(){if(this.settings.instructions==null||window.showInstructions==false){var e=$("#"+this.settings.pointerWrapperId);if(e.length>0)e.remove();var t=this.hasToolTip?" "+this.settings.hasToolTipClass:"";e="<div id='"+this.settings.pointerWrapperId+"' class='"+this.settings.pointerWrapperId+t+"'>"+this.settings.pointerTemplate+"</div>";$("body").append(e);e=$("#"+this.settings.pointerWrapperId);e.css({position:"absolute"});e.offset({top:this.pointerTop,left:this.pointerLeft});setTimeout(function(){e.remove()},1e3)}};Accessibility.prototype.customTrigger=function(e){var right_event=e.data.event;var right_element=e.data.element;right_element=typeof right_element=="string"?eval("$(this)."+right_element):right_element;right_element.trigger(right_event)};Accessibility.prototype.customFunction=function(e){var obj=e.data.obj;var func=e.data.func;var node=$(this);var group=e.data.group;eval("obj."+func)};Accessibility.prototype.processRule=function(rule){try{if(rule.indexOf(" trigger ")>=0){var ruleSplits=rule.split(" trigger ");var mode="trigger"}else if(rule.indexOf(" run ")>=0){var ruleSplits=rule.split(" run ");var mode="run"}else if(rule.indexOf("group ")>=0){var ruleSplits=rule.split("group ");var mode="group"}else{throw"Invalid rule."}if(mode=="trigger"||mode=="run"){var left=ruleSplits[0];var right=ruleSplits[1];left=left.replace(/\bfocus\b/gi,this.events.focus);left=left.replace(/\benter\b/gi,this.events.enter);left=left.replace(/\bblur\b/gi,this.events.blur);left=left.replace(/\besc\b/gi,this.events.esc);var left_splits=left.split(" on ");var left_event=left_splits[0];var left_pattern=/^\$\(('|")[\w->\.# ]+('|")\)(\.[\w-]+\(((('|")[\w->\.# ]+('|"))|([\d]+))?\))*$/i;if(left_pattern.exec(left_splits[1])!=null)var left_element=eval(left_splits[1]);else var left_element=$(left_splits[1])}else if(mode=="group"){var group=typeof ruleSplits[1]=="undefined"?ruleSplits[0]:ruleSplits[1];var group=$(group);this.addGroup(group)}if(mode=="trigger"){var right_splits=right.split(" on ");var right_event=right_splits[0];var right_pattern=/(parent|children|siblings|next|prev)+/i;if(right_pattern.exec(right_splits[1])!=null)var right_element=right_splits[1];else var right_element=eval("$('"+right_splits[1]+"')");left_element.unbind(left_event,this.customTrigger).bind(left_event,{event:right_event,element:right_element},this.customTrigger)}else if(mode=="run"){left_element.unbind(left_event,this.customFunction).bind(left_event,{func:right,obj:this,group:left_element},this.customFunction)}}catch(ex){this.exception=ex}};Accessibility.prototype.processToolTips=function(){try{for(var e=0;e<this.settings.tooltips.length;e++){this.settings.tooltips[e][0].attr(this.settings.toolTipAttr,this.settings.tooltips[e][1])}}catch(t){this.exception=t}};Accessibility.prototype.toggleInfoBox=function(){if(this.settings.instructions!=null&&this.settings.instructions.css("display")=="block"){window.showInstructions=false;this.settings.instructions.slideUp(500);this.selectedNodeNo=0-1}else if(this.settings.instructions!=null&&this.settings.instructions.css("display")=="none"){this.settings.instructions.slideDown(500)}};Accessibility.prototype.addRule=function(e){this.settings.rules.push(e)};Accessibility.prototype.addGroup=function(e){this.settings.groups.push(e)};Accessibility.prototype.addToolTip=function(e,t){var n=[];n.push(e);n.push(t);this.settings.tooltips.push(n)};Accessibility.prototype.addDirection=function(e,t){var n=[];n.push(e);n.push(t);this.settings.directions.push(n)};Accessibility.prototype.setContext=function(e){this.settings.context=e};Accessibility.prototype.getContext=function(){return this.settings.context};Accessibility.prototype.setElements=function(e){this.settings.elements=e};Accessibility.prototype.getElements=function(){return this.settings.elements};Accessibility.prototype.setInstructions=function(e){this.settings.instructions=e};Accessibility.prototype.getInstructions=function(){return this.settings.instructions};Accessibility.prototype.setFocusedClass=function(e){this.settings.focusedClass=e};Accessibility.prototype.getFocusedClass=function(){return this.settings.focusedClass};Accessibility.prototype.setToolTipWrapperId=function(e){this.settings.toolTipWrapperId=e};Accessibility.prototype.getToolTipWrapperId=function(){return this.settings.toolTipWrapperId};Accessibility.prototype.setToolTipTemplate=function(e){this.settings.toolTipTemplate=e};Accessibility.prototype.getToolTipTemplate=function(){return this.settings.toolTipTemplate};Accessibility.prototype.setPointerWrapperId=function(e){this.settings.pointerWrapperId=e};Accessibility.prototype.getPointerWrapperId=function(){return this.settings.pointerWrapperId};Accessibility.prototype.setPointerTemplate=function(e){this.settings.pointerTemplate=e};Accessibility.prototype.getPointerTemplate=function(){return this.settings.pointerTemplate};Accessibility.prototype.setLabelTemplate=function(e){this.settings.labelTemplate=e};Accessibility.prototype.getLabelTemplate=function(){return this.settings.labelTemplate};Accessibility.prototype.setToolTipAttr=function(e){this.settings.toolTipAttr=e};Accessibility.prototype.getToolTipAttr=function(){return this.settings.toolTipAttr};Accessibility.prototype.setHideOnMouseMove=function(e){this.settings.hideOnMouseMove=e};Accessibility.prototype.getHideOnMouseMove=function(){return this.settings.hideOnMouseMove};Accessibility.prototype.setPointOnFocus=function(e){this.settings.pointOnFocus=e};Accessibility.prototype.getPointOnFocus=function(){return this.settings.pointOnFocus};Accessibility.prototype.setpointOnGaps=function(e){this.settings.pointOnGaps=e};Accessibility.prototype.getpointOnGaps=function(){return this.settings.pointOnGaps};Accessibility.prototype.setHanddleDynamicContent=function(e){this.settings.handdleDynamicContent=e};Accessibility.prototype.getHanddleDynamicContent=function(){return this.settings.handdleDynamicContent};Accessibility.prototype.setNavKey=function(e){this.settings.navKey=e};Accessibility.prototype.getNavKey=function(){return this.settings.navKey};Accessibility.prototype.setEnterKey=function(e){this.settings.enterKey=e};Accessibility.prototype.getEnterKey=function(){return this.settings.enterKey};Accessibility.prototype.setEscKey=function(e){this.settings.escKey=e};Accessibility.prototype.getEscKey=function(){return this.settings.escKey}

