(function(b){b.fn.extend({autocomplete:function(a,f){var e=typeof a=="string";if(e){a=a.toLowerCase();a=propertyValues.CONTENT_PATH+a+"/files/";}f=b.extend({},b.Autocompleter.defaults,{url:e?a:null,data:e?null:a,delay:e?b.Autocompleter.defaults.delay:10,max:f&&!f.scroll?10:150},f);f.highlight=f.highlight||function(c){return c;};f.formatMatch=f.formatMatch||f.formatItem;return this.each(function(){new b.Autocompleter(this,f);});},result:function(a){return this.bind("result",a);},search:function(a){return this.trigger("search",[a]);},flushCache:function(){return this.trigger("flushCache");},setOptions:function(a){return this.trigger("setOptions",[a]);},unautocomplete:function(){return this.trigger("unautocomplete");}});b.Autocompleter=function(av,ab){var P={LEFT:37,RIGHT:39,UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var X=b(av).attr("autocomplete","off");if(propertyValues.DEF_LANG_ID==2){ab.language="fr";}else{ab.language="en";}var Q;var aq="";var ag=b.Autocompleter.Cache(ab);var ae=b.Autocompleter.BrandCache(ab);var a=b.Autocompleter.DepartmentCache(ab);var aj=0;var ax;var V={mouseDownOnSelect:false};var R=b.Autocompleter.Select(ab,av,T,V);var ap=false;var al={genKeywords:null,department:null,brand:null,products:null};var ad;if(ab.url.indexOf("model")!=-1||ab.url.indexOf("cartridge")!=-1){ab.brandDepartmentResultsSwitch=false;ab.productResultsSwitch=false;ab.inkTonerSearch=true;}if(ab.brandDepartmentResultsSwitch){ab.initWidth=ab.width;ab.width="726px";}var ao;b.browser.opera&&b(av.form).bind("submit.autocomplete",function(){if(ad){ad=false;return false;}});X.bind((b.browser.opera?"keypress":"keydown")+".autocomplete",function(c){aj=1;ax=c.keyCode;switch(c.keyCode){case P.UP:c.preventDefault();if(R.visible()){R.prev();}else{ac(0,true);}break;case P.DOWN:c.preventDefault();if(R.visible()){R.next();}else{ac(0,true);}break;case P.LEFT:if(R.visible()){R.left(c);}else{ac(0,true);}break;case P.RIGHT:if(R.visible()){R.right(c);}else{ac(0,true);}break;case P.PAGEUP:c.preventDefault();if(R.visible()){R.pageUp();}else{ac(0,true);}break;case P.PAGEDOWN:c.preventDefault();if(R.visible()){R.pageDown();}else{ac(0,true);}break;case ab.multiple&&b.trim(ab.multipleSeparator)==","&&P.COMMA:case P.TAB:case P.RETURN:if(T()){c.preventDefault();ad=true;return false;}break;case P.ESC:R.hide();break;default:clearTimeout(Q);Q=setTimeout(ac,ab.delay);break;}}).focus(function(){aj++;}).blur(function(){aj=0;if(!V.mouseDownOnSelect){aw();}else{aj=1;V.mouseDownOnSelect=false;b(this).focus();}}).click(function(){if(aj++>1&&!R.visible()){ac(0,true);}R.clearActive();}).bind("search",function(){var d=(arguments.length>1)?arguments[1]:null;function c(e,f){var h;if(f&&f.length){for(var g=0;g<f.length;g++){if(f[g].result.toLowerCase()==e.toLowerCase()){h=f[g];break;}}}if(typeof d=="function"){d(h);}else{X.trigger("result",h&&[h.data,h.value]);}}b.each(Y(X.val()),function(f,e){au(e,c,c);});}).bind("flushCache",function(){ag.flush();}).bind("setOptions",function(){b.extend(ab,arguments[1]);if("data" in arguments[1]){ag.populate();}}).bind("unautocomplete",function(){R.unbind();X.unbind();b(av.form).unbind(".autocomplete");});function T(){var n="";var k=R.selected();if(!k){return false;}try{var c=b(k.value);if(c.hasClass("prodlink")){if(propertyValues.analyticsSwitch==="ON"){if(c.hasClass("dealslink")){n="AutoComplete - Weekly Deals";}else{if(c.hasClass("purchlink")){n="AutoComplete - Previously Purchased Items";}}try{s_findMethod("Search",n);}catch(l){}}if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host;}var f=window.location.origin+c.attr("href");window.location=f;return true;}}catch(j){}var e=k.result;aq=e;if(ab.multiple){var g=Y(X.val());if(g.length>1){var h=ab.multipleSeparator.length;var d=b(av).selection().start;var m,o=0;b.each(g,function(q,p){o+=p.length;if(d<=o){m=q;return false;}o+=h;});g[m]=e;e=g.join(ab.multipleSeparator);}e+=ab.multipleSeparator;}X.val(e);aa();X.trigger("result",[k.data,b(av).closest("form")]);return true;}function ac(c,d){if(ax==P.DEL){R.hide();return;}var e=X.val();if(!d&&e==aq){return;}aq=e;e=O(e);if(e.length>=ab.minChars){if(!ab.matchCase){e=e.toLowerCase();}au(e,an,aa);}else{am();R.hide();}}function Y(c){if(!c){return[""];}if(!ab.multiple){return[b.trim(c)];}return b.map(c.split(ab.multipleSeparator),function(d){return b.trim(c).length?b.trim(d):null;});}function O(e){if(!ab.multiple){return e;}var c=Y(e);if(c.length==1){return c[0];}var d=b(av).selection().start;if(d==e.length){c=Y(e);}else{c=Y(e.replace(e.substring(d),""));}return c[c.length-1];}function Z(d,c){if(ab.autoFill&&(O(X.val()).toLowerCase()==d.toLowerCase())&&ax!=P.BACKSPACE){X.val(X.val()+c.substring(O(aq).length));b(av).selection(aq.length,aq.length+c.length);}}function aw(){clearTimeout(Q);Q=setTimeout(aa,200);}function aa(){var c=R.visible();R.hide();clearTimeout(Q);am();if(ab.mustMatch){X.search(function(e){if(!e){if(ab.multiple){var d=Y(X.val()).slice(0,-1);X.val(d.join(ab.multipleSeparator)+(d.length?ab.multipleSeparator:""));}else{X.val("");X.trigger("result",null);}}});}}function an(c,d){if(aj){am();R.display(d,c);R.show();}else{aa();}}function at(){var d=ab.productURL;var c={timestamp:+new Date()};return b.ajax({dataType:ab.dataType,url:d,data:c});}function W(d,c){if(typeof ao!=="undefined"){al.products=ao;}else{at().done(function(e){ao=ab.parse&&ab.parse(e)||af(e);al.products=ao;}).always(function(){c(d,al);});}}function ar(d){var e=ab.brandDepartmentURL,c={search:O(d),lang:ab.language};return b.getJSON(e,c);}function S(c){var d=ab.url;d=d+escape(c)+".txt";return b.ajax({mode:"abort",port:"autocomplete"+av.name,dataType:ab.dataType,url:d});}function ah(e,c){var f=[],d,g;g=b.trim(e.substring(0,3));al.genKeywords=ag.load(g);if(al.genKeywords===null){f.push(S(g));}if(ab.brandDepartmentResultsSwitch&&e.length>=ab.endicaMinChars){d=b.trim(e.substring(0,ab.endicaMaxChars));al.department=a.load(d);al.brand=ae.load(d);if(al.department===null&&al.brand===null){f.push(ar(d));}}if(f.length!==0){b.when.apply(b,f).then(function(h,j){if(typeof j==="string"){if(typeof h!=="string"){ak(d,h);}else{U(g,h);}}else{U(g,h[0]);ak(d,j[0]);}}).fail(function(){b.each(f,function(j,h){if(h.isResolved()){if(h.responseText.indexOf("brandcompletions")>-1){var k=b.parseJSON(h.responseText);ak(d,k);}else{U(g,h.responseText);}}});}).always(function(){c(e,al);});}else{ap=true;}}function U(c,d){al.genKeywords=ab.parse&&ab.parse(d)||af(d);ag.add(c,al.genKeywords);}function ak(c,d){if(d.hasOwnProperty("result")){if(d.result.hasOwnProperty("brandcompletions")){al.brand=N(d.result.brandcompletions);ae.add(c,al.brand);}if(d.result.hasOwnProperty("classcompletions")){al.department=N(d.result.classcompletions);a.add(c,al.department);}}}function au(d,c,e){ap=false;if(!String.prototype.trimLeft){String.prototype.trimLeft=function(){return this.replace(/^\s+/,"");};}d=d.trimLeft();al={genKeywords:null,department:null,brand:null,products:null};if(!ab.matchCase){d=d.toLowerCase();}if(d){ai(d,c);}else{ap=true;}if(ap){c(d,al);}}function ai(d,c){if(ab.productResultsSwitch){W(d,c);}ah(d,c);}function af(d){var g=[];var e=d.split("\n");for(var f=0;f<e.length;f++){var c=b.trim(e[f]);if(c){c=c.split("|");g[g.length]={data:c,value:c[0],result:ab.formatResult&&ab.formatResult(c,c[0])||c[0]};}}return g;}function N(c){var d=[];b.each(c,function(){var e=b.trim(this.completion);e=e.replace(/<[^>]+>/ig,"");if(e){e=e.split();d[d.length]={data:e,value:e[0],result:e[0]};}});return d;}function am(){}};b.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,endicaMinChars:propertyValues.Autocomplete.endicaMinChars,endicaMaxChars:propertyValues.Autocomplete.endicaMaxChars,delay:400,matchCase:false,matchSubset:false,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(a){return a[0];},formatMatch:null,autoFill:false,width:0,initWidth:0,multiple:false,prodLinkMax:propertyValues.Autocomplete.maxProdLinks,brandDepartmentResultsSwitch:propertyValues.Autocomplete.brandDepartmentResultsSwitch,productResultsSwitch:propertyValues.Autocomplete.productResultsSwitch,brandDepartmentURL:propertyValues.Autocomplete.brandDepartmentURL,productURL:propertyValues.Autocomplete.productURL,inkTonerSearch:false,multipleSeparator:", ",highlight:function(d,a){return d.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");},scroll:false,scrollHeight:900};b.Autocompleter.Cache=function(o){var l={};var n=0;function j(c,d){if(!o.matchCase){c=c.toLowerCase();}var e=c.indexOf(d);if(o.matchContains=="word"){e=c.toLowerCase().search("\\b"+d.toLowerCase());}if(e==-1){return false;}return e>=0||o.matchContains;}function k(c,d){if(n>o.cacheLength){a();}if(!l[c]){n++;}l[c]=d;}function m(){if(!o.data){return false;}var e={},f=0;if(!o.url){o.cacheLength=1;}e[""]=[];for(var c=0,d=o.data.length;c<d;c++){var h=o.data[c];h=(typeof h=="string")?[h]:h;var r=o.formatMatch(h,c+1,o.data.length);if(r===false){continue;}var s=r.charAt(0).toLowerCase();if(!e[s]){e[s]=[];}var g={value:r,data:h,result:o.formatResult&&o.formatResult(h)||r};e[s].push(g);if(f++<o.max){e[""].push(g);}}b.each(e,function(q,p){o.cacheLength++;k(q,p);});}setTimeout(m,25);function a(){l={};n=0;}return{flush:a,add:k,populate:m,load:function(d){if(!o.cacheLength||!n){return null;}if(l[d]){return l[d];}else{if(o.matchSubset){for(var f=d.length-1;f>=o.minChars;f--){var c=l[d.substr(0,f)];if(c){var e=[];b.each(c,function(g,h){if(j(h.value.replace(/<[^>]+>/ig,"").replace(/&.+;/ig,""),d)){e[e.length]=h;}});if(e.length>0){return e;}else{return null;}}}}}return null;}};};b.Autocompleter.BrandCache=function(k){var h={};var j=0;function g(c,d){if(j>k.cacheLength){a();}if(!h[c]){j++;}h[c]=d;}function a(){h={};j=0;}return{flush:a,add:g,load:function(c){if(!k.brandDepartmentURL||!j){return null;}if(h[c]){return h[c];}return null;}};};b.Autocompleter.DepartmentCache=function(k){var h={};var j=0;function g(c,d){if(j>k.cacheLength){a();}if(!h[c]){j++;}h[c]=d;}function a(){h={};j=0;}return{flush:a,add:g,load:function(c){if(!k.brandDepartmentURL||!j){return null;}if(h[c]){return h[c];}return null;}};};b.Autocompleter.Select=function(ad,T,J,U){var V={ACTIVE:"ac_over"};var P,R,aj=0,L,ab=false,X,aa=-1,N,I="",K=true,ah,ak=false;X=new Array();R=new Array();function a(){var j="keywords";if(!K){return;}ah=b("<div/>").hide().addClass(ad.resultsClass).css("position","absolute").appendTo(document.body);if(ad.inkTonerSearch){j="ink";}var e=b("<div/>").addClass(j).attr("id","genKeywords");var k=af(b("<ul/>"),e,ah);e.appendTo(ah);X.genKeywords=k;if(ad.brandDepartmentResultsSwitch){var h=b("<div/>").addClass(j).attr("id","deptKeywords");var d=af(b("<ul/>"),h,ah);h.appendTo(ah);X.department=d;var l=b("<div/>").addClass(j).attr("id","brandKeywords");var g=af(b("<ul/>"),l,ah);l.appendTo(ah);X.brand=g;}if(!ad.inkTonerSearch){var f=b("<div/>").addClass("suggestedProducts");var c=af(b("<ul/>"),f,ah);f.appendTo(ah);X.products=c;}if(ad.width>0){ah.css("width",ad.width);}K=false;}function af(e,d,c){return e.appendTo(d).mouseover(function(h){if(O(h).nodeName&&O(h).nodeName.toUpperCase()=="LI"){b("li",c).removeClass(V.ACTIVE);var g=b(O(h));if(!g.hasClass("ac_header")){if(g.find("a").hasClass("prodlink")){P=L;ab=true;}else{var f=R.length;ab=false;for(i=0;i<f;i++){if(R[i].index(g)!==-1){P=R[i];aj=i;break;}}}if(P){aa=P.index(g);}g.not("ac_header").addClass(V.ACTIVE);}}}).click(function(f){var g=b(O(f));g.addClass(V.ACTIVE);J();try{T.focus();}catch(h){}return false;}).mousedown(function(){U.mouseDownOnSelect=true;}).mouseup(function(){U.mouseDownOnSelect=false;});}function O(c){var d=c.target;while(d&&d.tagName!="LI"){d=d.parentNode;}if(!d){return[];}return d;}function W(e){if(P&&P.size()>1){P.slice(aa,aa+1).removeClass(V.ACTIVE);Z(e);var c=P.slice(aa,aa+1).addClass(V.ACTIVE);if(ad.scroll){var d=0;P.slice(0,aa).each(function(){d+=this.offsetHeight;});if((d+c[0].offsetHeight-list.scrollTop())>list[0].clientHeight){list.scrollTop(d+c[0].offsetHeight-list.innerHeight());}else{if(d<list.scrollTop()){list.scrollTop(d);}}}}}function Y(d,c){var f;if(aa!==-1&&!ab){d.preventDefault();f=aj+c;if(f>-1&&f<=(R.length-1)){var e=R[f].length;if(e>1){P.slice(aa,aa+1).removeClass(V.ACTIVE);P=R[f];if(aa<=e){P.slice(aa,aa+1).addClass(V.ACTIVE);}else{P.slice(e-1,e).addClass(V.ACTIVE);aa=e-1;}aj=f;}}}else{return;}}function Z(c){aa+=c;if(aa<0){if(!ab&&typeof L!=="undefined"){P=L;aa=L.length-1;ab=true;}else{if(ab&&(typeof R[0]!=="undefined"&&R[0].length>1)){P=R[0];aa=R[0].length-1;ab=false;aj=0;}else{aa=P.size()-1;}}}else{if(aa>=P.size()){if(ab&&(typeof R[0]!=="undefined"&&R[0].length>1)){P=R[0];aa=0;ab=false;aj=0;}else{if(!ab&&typeof L!=="undefined"){P=L;aa=0;ab=true;}else{aa=1;}}}}if(P.eq(aa).hasClass("ac_header")){Z(c);}}function ai(c,d){return d&&d<c?d:c;}function H(k,j,h,c){var o;var e;var g=true;var n=0;var f;if(k!==null){o=k.length;e=ai(o,ad.max);}else{o=0;}b('<li class="ac_header"></li>').html("<h4>"+j+"</h4>").appendTo(h)[0];for(var l=0;l<o;l++){if(!k[l]){continue;}var m=ad.formatItem(k[l].data,l+1,e,k[l].value,I);if(m===false){continue;}m=htmlDecode(m);f=m.replace(/<[^>]+>/ig,"");f=f.replace(/&[a-z0-9]{3,5};/gi,"");f=f.length>=c?f.substr(0,c-1):f;if(f.toLowerCase().indexOf(I)>=0){if(n<e){n++;var d=b("<li/>").html(ad.highlight(f,I)).addClass(l%2==0?"ac_even ":"ac_odd ").appendTo(h)[0];b.data(d,"ac_data",k[l]);}else{return true;}}}if(n===0){return false;}else{return true;}}function ac(n,k,d){var r=n.length;var g=ai(r,ad.prodLinkMax);var j=true;var q=0;var h;var e=false;for(var o=0;o<r;o++){if(!n[o]){continue;}var p=ad.formatItem(n[o].data,o+1,g,n[o].value,I);if(p===false){continue;}h=p.replace(/<[^>]+>/ig,"");h=h.replace(/&[a-z0-9]{3,5};/gi,"");h=h.length>d?h.substr(0,d):h;if(h.toLowerCase().indexOf(I)>=0){if(isSecure&&p.indexOf("https")==-1){var l;var c=new RegExp(propertyValues.s7nonsecure,"ig");if(isKiosk){l=propertyValues.s7kiosksecure;}else{l=propertyValues.s7secure;}p=p.replace(c,l);}if(j){if(p.indexOf("dealslink")>-1){var m=propertyValues.Autocomplete.weeklyDeals;}else{if(p.indexOf("purchlink")>-1){var m=propertyValues.Autocomplete.previouslyPurchasedItems;e=true;}}}if(e&&p.indexOf("dealslink")>-1){continue;}if(q<g){q++;if(j){b('<li class="ac_header subautoheader"></li>').html("<h4>"+m+"</h4>").appendTo(k)[0];j=false;}var f=b("<li/>").html(ad.highlight(p.replace(/>[^<].*</ig,">"+h+"<"),I)).addClass(o%2==0?"ac_even suggestedlink":"ac_odd suggestedlink").appendTo(k)[0];b.data(f,"ac_data",n[o]);}else{return true;}}else{continue;}}if(q===0){return false;}else{return true;}}function ag(){var d={genKeywords:false,department:false,brand:false,product:false},c=true;R.length=0;L=undefined;if(N.genKeywords===null&&N.department===null&&N.brand===null){c=false;}for(ulElement in X){X[ulElement].empty();switch(ulElement){case"genKeywords":if(c){var e;if(ad.inkTonerSearch){e=52;}else{e=23;}d.genKeywords=H(N[ulElement],propertyValues.Autocomplete.keywordMatches,X[ulElement],e);}break;case"department":if(c){d.department=H(N[ulElement],propertyValues.Autocomplete.department,X[ulElement],58);}break;case"brand":if(c){d.brand=H(N[ulElement],propertyValues.Autocomplete.shopByBrand,X[ulElement],23);}break;case"products":if(N[ulElement]!==null){d.product=ac(N[ulElement],X[ulElement],80);}break;default:break;}}if(!d.genKeywords&&!d.department&&!d.brand&&c){Q();c=false;}if(!c&&!d.product){ae(X);}if(ak&&c){ak=false;}M(c,d);S();}function ae(d){var c;if(ad.brandDepartmentResultsSwitch){c="products";}else{c="genKeywords";}b('<li class="ac_header subautoheader"></li>').html("<h4>"+propertyValues.Autocomplete.selectSearch+"</h4>").appendTo(d[c])[0];if(c==="products"){ak=true;}}function Q(){if(typeof X.genKeywords!=="undefined"){X.genKeywords.empty();}if(typeof X.department!=="undefined"){X.department.empty();}if(typeof X.brand!=="undefined"){X.brand.empty();}}function M(c,e){if(c){var d=0;if(ad.inkTonerSearch){if(e.genKeywords){R[d]=b(ah.find(".ink")[0]).find("li");d++;}}else{if(e.genKeywords){R[d]=b(ah.find(".keywords")[0]).find("li");d++;}if(e.department){R[d]=b(ah.find(".keywords")[1]).find("li");d++;}if(e.brand){R[d]=b(ah.find(".keywords")[2]).find("li");}}}if(e.product){L=b(ah.find(".suggestedProducts")[0]).find("li");}}function S(){aa=-1;aj=0;ab=false;if(typeof R[0]!=="undefined"){P=R[0];}else{if(typeof L!=="undefined"){P=L;}}}return{display:function(c,d){a();N=c;I=d;ag();},next:function(){W(1);},prev:function(){W(-1);},left:function(c){Y(c,-1);},right:function(c){Y(c,1);},pageUp:function(){if(aa!=0&&aa-8<0){W(-aa);}else{W(-8);}},pageDown:function(){if(aa!=P.size()-1&&aa+8>P.size()){W(P.size()-1-aa);}else{W(8);}},hide:function(){ah&&ah.hide();P&&P.removeClass(V.ACTIVE);aa=-1;},visible:function(){return ah&&ah.is(":visible");},current:function(){return this.visible()&&(P.filter("."+V.ACTIVE)[0]||ad.selectFirst&&P[0]);},show:function(){var c=b(T).offset(),f;var d=0;if(typeof ad.horizontalOffset!="undefined"){d=parseInt(ad.horizontalOffset);}if(ak){if(ad.initWidth!=0){f=ad.initWidth;}else{f=b(T).width();}ah.find(".keywords").hide();}else{f=typeof ad.width=="string"||ad.width>0?ad.width:b(T).width();ah.find(".keywords").show();}ah.css({width:f,top:c.top+T.offsetHeight,left:c.left+d}).show();if(ad.scroll){list.scrollTop(0);list.css({maxHeight:ad.scrollHeight,overflow:"auto"});if(b.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var e=0;P.each(function(){e+=this.offsetHeight;});}}},selected:function(){var c=P&&P.filter("."+V.ACTIVE).removeClass(V.ACTIVE);return c&&c.length&&b.data(c[0],"ac_data");},emptyList:function(){list&&list.empty();},unbind:function(){ah&&ah.remove();},clearActive:function(){if(aa!==-1&&typeof P!=="undefined"){P.slice(aa,aa+1).removeClass(V.ACTIVE);S();}}};};b.fn.selection=function(k,a){if(k!==undefined){return this.each(function(){if(this.createTextRange){var c=this.createTextRange();if(a===undefined||k==a){c.move("character",k);c.select();}else{c.collapse(true);c.moveStart("character",k);c.moveEnd("character",a);c.select();}}else{if(this.setSelectionRange){this.setSelectionRange(k,a);}else{if(this.selectionStart){this.selectionStart=k;this.selectionEnd=a;}}}});}var m=this[0];if(m.createTextRange){var q=document.selection.createRange(),l=m.value,n="<->",p=q.text.length;q.text=n;var o=m.value.indexOf(n);m.value=l;this.selection(o,o+p);return{start:o,end:o+p};}else{if(m.selectionStart!==undefined){return{start:m.selectionStart,end:m.selectionEnd};}}};})(jQuery);