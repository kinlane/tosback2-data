(function(a){a.fn.extend({autocomplete:function(b,c){var d=typeof b=="string";c=a.extend({},a.Autocompleter.defaults,{url:d?b:null,data:d?null:b,delay:d?a.Autocompleter.defaults.delay:10,max:c&&!c.scroll?10:150},c);c.highlight=c.highlight||function(e){return e;};c.formatMatch=c.formatMatch||c.formatItem;return this.each(function(){new a.Autocompleter(this,c);});},result:function(b){return this.bind("result",b);},search:function(b){return this.trigger("search",[b]);},flushCache:function(){return this.trigger("flushCache");},setOptions:function(b){return this.trigger("setOptions",[b]);},unautocomplete:function(){return this.trigger("unautocomplete");}});a.Autocompleter=function(d,x){var J={LEFT:37,RIGHT:39,UP:38,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8};var B=a(d).attr("autocomplete","off");if(propertyValues.DEF_LANG_ID==2){x.language="fr";}else{x.language="en";}var I;var h="";var s=a.Autocompleter.Cache(x);var u=a.Autocompleter.BrandCache(x);var M=a.Autocompleter.DepartmentCache(x);var p=0;var b;var D={mouseDownOnSelect:false};var H=a.Autocompleter.Select(x,d,F,D);var j=false;var n={genKeywords:null,department:null,brand:null,products:null};var v;if(x.url.indexOf("model")!=-1||x.url.indexOf("cartridge")!=-1){x.brandDepartmentResultsSwitch=false;x.productResultsSwitch=false;x.inkTonerSearch=true;}if(x.brandDepartmentResultsSwitch){x.initWidth=x.width;x.width="726px";}var k;a.browser.opera&&a(d.form).bind("submit.autocomplete",function(){if(v){v=false;return false;}});B.bind((a.browser.opera?"keypress":"keydown")+".autocomplete",function(N){p=1;b=N.keyCode;switch(N.keyCode){case J.UP:N.preventDefault();if(H.visible()){H.prev();}else{w(0,true);}break;case J.DOWN:N.preventDefault();if(H.visible()){H.next();}else{w(0,true);}break;case J.LEFT:if(H.visible()){H.left(N);}else{w(0,true);}break;case J.RIGHT:if(H.visible()){H.right(N);}else{w(0,true);}break;case J.PAGEUP:N.preventDefault();if(H.visible()){H.pageUp();}else{w(0,true);}break;case J.PAGEDOWN:N.preventDefault();if(H.visible()){H.pageDown();}else{w(0,true);}break;case x.multiple&&a.trim(x.multipleSeparator)==","&&J.COMMA:case J.TAB:case J.RETURN:if(F()){N.preventDefault();v=true;return false;}break;case J.ESC:H.hide();break;default:clearTimeout(I);I=setTimeout(w,x.delay);break;}}).focus(function(){p++;}).blur(function(){p=0;if(!D.mouseDownOnSelect){c();}else{p=1;D.mouseDownOnSelect=false;a(this).focus();}}).click(function(){if(p++>1&&!H.visible()){w(0,true);}H.clearActive();}).bind("search",function(){var N=(arguments.length>1)?arguments[1]:null;function O(S,R){var P;if(R&&R.length){for(var Q=0;Q<R.length;Q++){if(R[Q].result.toLowerCase()==S.toLowerCase()){P=R[Q];break;}}}if(typeof N=="function"){N(P);}else{B.trigger("result",P&&[P.data,P.value]);}}a.each(A(B.val()),function(P,Q){e(Q,O,O);});}).bind("flushCache",function(){s.flush();}).bind("setOptions",function(){a.extend(x,arguments[1]);if("data" in arguments[1]){s.populate();}}).bind("unautocomplete",function(){H.unbind();B.unbind();a(d.form).unbind(".autocomplete");});function F(){var O="";var Q=H.selected();if(!Q){return false;}try{var X=a(Q.value);if(X.hasClass("prodlink")){if(propertyValues.analyticsSwitch==="ON"){if(X.hasClass("dealslink")){O="AutoComplete - Weekly Deals";}else{if(X.hasClass("purchlink")){O="AutoComplete - Previously Purchased Items";}}s_findMethod("Search",O);}if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.host;}var U=window.location.origin+X.attr("href");window.location=U;return true;}}catch(R){}var V=Q.result;h=V;if(x.multiple){var S=A(B.val());if(S.length>1){var T=x.multipleSeparator.length;var W=a(d).selection().start;var P,N=0;a.each(S,function(Y,Z){N+=Z.length;if(W<=N){P=Y;return false;}N+=T;});S[P]=V;V=S.join(x.multipleSeparator);}V+=x.multipleSeparator;}B.val(V);y();B.trigger("result",[Q.data,a(d).closest("form")]);return true;}function w(P,O){if(b==J.DEL){H.hide();return;}var N=B.val();if(!O&&N==h){return;}h=N;N=K(N);if(N.length>=x.minChars){if(!x.matchCase){N=N.toLowerCase();}e(N,l,y);}else{m();H.hide();}}function A(N){if(!N){return[""];}if(!x.multiple){return[a.trim(N)];}return a.map(N.split(x.multipleSeparator),function(O){return a.trim(N).length?a.trim(O):null;});}function K(N){if(!x.multiple){return N;}var P=A(N);if(P.length==1){return P[0];}var O=a(d).selection().start;if(O==N.length){P=A(N);}else{P=A(N.replace(N.substring(O),""));}return P[P.length-1];}function z(N,O){if(x.autoFill&&(K(B.val()).toLowerCase()==N.toLowerCase())&&b!=J.BACKSPACE){B.val(B.val()+O.substring(K(h).length));a(d).selection(h.length,h.length+O.length);}}function c(){clearTimeout(I);I=setTimeout(y,200);}function y(){var N=H.visible();H.hide();clearTimeout(I);m();if(x.mustMatch){B.search(function(O){if(!O){if(x.multiple){var P=A(B.val()).slice(0,-1);B.val(P.join(x.multipleSeparator)+(P.length?x.multipleSeparator:""));}else{B.val("");B.trigger("result",null);}}});}}function l(O,N){if(p){m();H.display(N,O);H.show();}else{y();}}function f(){var N=x.productURL;var O={timestamp:+new Date()};return a.ajax({dataType:x.dataType,url:N,data:O});}function C(N,O){if(typeof k!=="undefined"){n.products=k;}else{f().done(function(P){k=x.parse&&x.parse(P)||t(P);n.products=k;}).always(function(){O(N,n);});}}function g(O){var N=x.brandDepartmentURL,P={search:a.trim(K(O)),lang:x.language};return a.getJSON(N,P);}function G(O){var N=x.url;return a.ajax({mode:"abort",port:"autocomplete"+d.name,dataType:x.dataType,url:N,data:{q:K(O)}});}function r(P,R){var O=[],Q,N;N=P.substring(0,3);n.genKeywords=s.load(N);if(n.genKeywords===null){O.push(G(N));}if(x.brandDepartmentResultsSwitch&&P.length>=x.endicaMinChars){Q=P.substring(0,x.endicaMaxChars);n.department=M.load(Q);n.brand=u.load(Q);if(n.department===null&&n.brand===null){O.push(g(Q));}}if(O.length!==0){a.when.apply(a,O).then(function(T,S){if(typeof S==="string"){if(typeof T!=="string"){o(Q,T);}else{E(N,T);}}else{E(N,T[0]);o(Q,S[0]);}}).fail(function(){a.each(O,function(T,U){if(U.isResolved()){if(U.responseText.indexOf("brandcompletions")>-1){var S=a.parseJSON(U.responseText);o(Q,S);}else{E(N,U.responseText);}}});}).always(function(){R(P,n);});}else{j=true;}}function E(O,N){n.genKeywords=x.parse&&x.parse(N)||t(N);s.add(O,n.genKeywords);}function o(O,N){if(N.hasOwnProperty("result")){if(N.result.hasOwnProperty("brandcompletions")){n.brand=L(N.result.brandcompletions);u.add(O,n.brand);}if(N.result.hasOwnProperty("classcompletions")){n.department=L(N.result.classcompletions);M.add(O,n.department);}}}function e(O,P,N){j=false;n={genKeywords:null,department:null,brand:null,products:null};if(!x.matchCase){O=O.toLowerCase();}q(O,P);if(j){P(O,n);}}function q(N,O){if(x.productResultsSwitch){C(N,O);}r(N,O);}function t(Q){var N=[];var P=Q.split("\n");for(var O=0;O<P.length;O++){var R=a.trim(P[O]);if(R){R=R.split("|");N[N.length]={data:R,value:R[0],result:x.formatResult&&x.formatResult(R,R[0])||R[0]};}}return N;}function L(O){var N=[];a.each(O,function(){var P=a.trim(this.completion);P=P.replace(/<[^>]+>/ig,"");if(P){P=P.split();N[N.length]={data:P,value:P[0],result:P[0]};}});return N;}function m(){}};a.Autocompleter.defaults={inputClass:"ac_input",resultsClass:"ac_results",loadingClass:"ac_loading",minChars:1,endicaMinChars:propertyValues.Autocomplete.endicaMinChars,endicaMaxChars:propertyValues.Autocomplete.endicaMaxChars,delay:400,matchCase:false,matchSubset:false,matchContains:false,cacheLength:10,max:100,mustMatch:false,extraParams:{},selectFirst:true,formatItem:function(b){return b[0];},formatMatch:null,autoFill:false,width:0,initWidth:0,multiple:false,prodLinkMax:propertyValues.Autocomplete.maxProdLinks,brandDepartmentResultsSwitch:propertyValues.Autocomplete.brandDepartmentResultsSwitch,productResultsSwitch:propertyValues.Autocomplete.productResultsSwitch,brandDepartmentURL:propertyValues.Autocomplete.brandDepartmentURL,productURL:propertyValues.Autocomplete.productURL,inkTonerSearch:false,multipleSeparator:", ",highlight:function(c,b){return c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>");},scroll:false,scrollHeight:900};a.Autocompleter.Cache=function(c){var f={};var d=0;function h(l,k){if(!c.matchCase){l=l.toLowerCase();}var j=l.indexOf(k);if(c.matchContains=="word"){j=l.toLowerCase().search("\\b"+k.toLowerCase());}if(j==-1){return false;}return j>=0||c.matchContains;}function g(k,j){if(d>c.cacheLength){b();}if(!f[k]){d++;}f[k]=j;}function e(){if(!c.data){return false;}var k={},j=0;if(!c.url){c.cacheLength=1;}k[""]=[];for(var m=0,l=c.data.length;m<l;m++){var p=c.data[m];p=(typeof p=="string")?[p]:p;var o=c.formatMatch(p,m+1,c.data.length);if(o===false){continue;}var n=o.charAt(0).toLowerCase();if(!k[n]){k[n]=[];}var q={value:o,data:p,result:c.formatResult&&c.formatResult(p)||o};k[n].push(q);if(j++<c.max){k[""].push(q);}}a.each(k,function(r,s){c.cacheLength++;g(r,s);});}setTimeout(e,25);function b(){f={};d=0;}return{flush:b,add:g,populate:e,load:function(l){if(!c.cacheLength||!d){return null;}if(f[l]){return f[l];}else{if(c.matchSubset){for(var j=l.length-1;j>=c.minChars;j--){var m=f[l.substr(0,j)];if(m){var k=[];a.each(m,function(o,n){if(h(n.value.replace(/<[^>]+>/ig,"").replace(/&.+;/ig,""),l)){k[k.length]=n;}});if(k.length>0){return k;}else{return null;}}}}}return null;}};};a.Autocompleter.BrandCache=function(c){var e={};var d=0;function f(h,g){if(d>c.cacheLength){b();}if(!e[h]){d++;}e[h]=g;}function b(){e={};d=0;}return{flush:b,add:f,load:function(g){if(!c.brandDepartmentURL||!d){return null;}if(e[g]){return e[g];}return null;}};};a.Autocompleter.DepartmentCache=function(c){var e={};var d=0;function f(h,g){if(d>c.cacheLength){b();}if(!e[h]){d++;}e[h]=g;}function b(){e={};d=0;}return{flush:b,add:f,load:function(g){if(!c.brandDepartmentURL||!d){return null;}if(e[g]){return e[g];}return null;}};};a.Autocompleter.Select=function(j,r,w,B){var q={ACTIVE:"ac_over"};var t,D,c=0,v,l=false,A,m=-1,F,x="",G=true,e,b=false;A=new Array();D=new Array();function z(){var J="keywords";if(!G){return;}e=a("<div/>").hide().addClass(j.resultsClass).css("position","absolute").appendTo(document.body);if(j.inkTonerSearch){J="ink";}var N=a("<div/>").addClass(J).attr("id","genKeywords");var I=g(a("<ul/>"),N,e);N.appendTo(e);A["genKeywords"]=I;if(j.brandDepartmentResultsSwitch){var K=a("<div/>").addClass(J).attr("id","deptKeywords");var O=g(a("<ul/>"),K,e);K.appendTo(e);A["department"]=O;var H=a("<div/>").addClass(J).attr("id","brandKeywords");var L=g(a("<ul/>"),H,e);H.appendTo(e);A["brand"]=L;}if(!j.inkTonerSearch){var M=a("<div/>").addClass("suggestedProducts");var P=g(a("<ul/>"),M,e);M.appendTo(e);A["products"]=P;}if(j.width>0){e.css("width",j.width);}G=false;}function g(H,I,J){return H.appendTo(I).mouseover(function(M){if(E(M).nodeName&&E(M).nodeName.toUpperCase()=="LI"){a("li",J).removeClass(q.ACTIVE);var K=a(E(M));if(!K.hasClass("ac_header")){if(K.find("a").hasClass("prodlink")){t=v;l=true;}else{var L=D.length;l=false;for(i=0;i<L;i++){if(D[i].index(K)!==-1){t=D[i];c=i;break;}}}if(t){m=t.index(K);}K.not("ac_header").addClass(q.ACTIVE);}}}).click(function(L){var K=a(E(L));K.addClass(q.ACTIVE);w();r.focus();return false;}).mousedown(function(){B.mouseDownOnSelect=true;}).mouseup(function(){B.mouseDownOnSelect=false;});}function E(I){var H=I.target;while(H&&H.tagName!="LI"){H=H.parentNode;}if(!H){return[];}return H;}function p(H){if(t&&t.size()>1){t.slice(m,m+1).removeClass(q.ACTIVE);n(H);var J=t.slice(m,m+1).addClass(q.ACTIVE);if(j.scroll){var I=0;t.slice(0,m).each(function(){I+=this.offsetHeight;});if((I+J[0].offsetHeight-list.scrollTop())>list[0].clientHeight){list.scrollTop(I+J[0].offsetHeight-list.innerHeight());}else{if(I<list.scrollTop()){list.scrollTop(I);}}}}}function o(J,K){var H;if(m!==-1&&!l){J.preventDefault();H=c+K;if(H>-1&&H<=(D.length-1)){var I=D[H].length;if(I>1){t.slice(m,m+1).removeClass(q.ACTIVE);t=D[H];if(m<=I){t.slice(m,m+1).addClass(q.ACTIVE);}else{t.slice(I-1,I).addClass(q.ACTIVE);m=I-1;}c=H;}}}else{return;}}function n(H){m+=H;if(m<0){if(!l&&typeof v!=="undefined"){t=v;m=v.length-1;l=true;}else{if(l&&(typeof D[0]!=="undefined"&&D[0].length>1)){t=D[0];m=D[0].length-1;l=false;c=0;}else{m=t.size()-1;}}}else{if(m>=t.size()){if(l&&(typeof D[0]!=="undefined"&&D[0].length>1)){t=D[0];m=0;l=false;c=0;}else{if(!l&&typeof v!=="undefined"){t=v;m=0;l=true;}else{m=1;}}}}if(t.eq(m).hasClass("ac_header")){n(H);}}function d(I,H){return H&&H<I?H:I;}function y(L,M,N,S){var H;var Q;var O=true;var I=0;var P;if(L!==null){H=L.length;Q=d(H,j.max);}else{H=0;}a('<li class="ac_header"></li>').html("<h4>"+M+"</h4>").appendTo(N)[0];for(var K=0;K<H;K++){if(!L[K]){continue;}var J=j.formatItem(L[K].data,K+1,Q,L[K].value,x);if(J===false){continue;}P=J.replace(/<[^>]+>/ig,"");P=P.replace(/&[a-z0-9]{3,5};/gi,"");P=P.length>S?P.substr(0,S):P;if(P.toLowerCase().indexOf(x)>=0){if(I<Q){I++;var R=a("<li/>").html(j.highlight(P,x)).addClass(K%2==0?"ac_even ":"ac_odd ").appendTo(N)[0];a.data(R,"ac_data",L[K]);}else{return true;}}}if(I===0){return false;}else{return true;}}function k(L,O,U){var H=L.length;var R=d(H,j.prodLinkMax);var P=true;var I=0;var Q;var T=false;for(var K=0;K<H;K++){if(!L[K]){continue;}var J=j.formatItem(L[K].data,K+1,R,L[K].value,x);if(J===false){continue;}Q=J.replace(/<[^>]+>/ig,"");Q=Q.replace(/&[a-z0-9]{3,5};/gi,"");Q=Q.length>U?Q.substr(0,U):Q;if(Q.toLowerCase().indexOf(x)>=0){if(isSecure&&J.indexOf("https")==-1){var N;var V=new RegExp(propertyValues.s7nonsecure,"ig");if(isKiosk){N=propertyValues.s7kiosksecure;}else{N=propertyValues.s7secure;}J=J.replace(V,N);}if(P){if(J.indexOf("dealslink")>-1){var M=propertyValues.Autocomplete.weeklyDeals;}else{if(J.indexOf("purchlink")>-1){var M=propertyValues.Autocomplete.previouslyPurchasedItems;T=true;}}}if(T&&J.indexOf("dealslink")>-1){continue;}if(I<R){I++;if(P){a('<li class="ac_header subautoheader"></li>').html("<h4>"+M+"</h4>").appendTo(O)[0];P=false;}var S=a("<li/>").html(j.highlight(J.replace(/>[^<].*</ig,">"+Q+"<"),x)).addClass(K%2==0?"ac_even suggestedlink":"ac_odd suggestedlink").appendTo(O)[0];a.data(S,"ac_data",L[K]);}else{return true;}}else{continue;}}if(I===0){return false;}else{return true;}}function f(){var I={genKeywords:false,department:false,brand:false,product:false},J=true;D.length=0;v=undefined;if(F["genKeywords"]===null&&F["department"]===null&&F["brand"]===null){J=false;}for(ulElement in A){A[ulElement].empty();switch(ulElement){case"genKeywords":if(J){var H;if(j.inkTonerSearch){H=52;}else{H=23;}I.genKeywords=y(F[ulElement],propertyValues.Autocomplete.keywordMatches,A[ulElement],H);}break;case"department":if(J){I.department=y(F[ulElement],propertyValues.Autocomplete.department,A[ulElement],58);}break;case"brand":if(J){I.brand=y(F[ulElement],propertyValues.Autocomplete.shopByBrand,A[ulElement],23);}break;case"products":if(F[ulElement]!==null){I.product=k(F[ulElement],A[ulElement],80);}break;default:break;}}if(!I.genKeywords&&!I.department&&!I.brand&&J){s();J=false;}if(!J&&!I.product){h(A);}if(b&&J){b=false;}u(J,I);C();}function h(H){var I;if(j.brandDepartmentResultsSwitch){I="products";}else{I="genKeywords";}a('<li class="ac_header subautoheader"></li>').html("<h4>"+propertyValues.Autocomplete.selectSearch+"</h4>").appendTo(H[I])[0];if(I==="products"){b=true;}}function s(){if(typeof A["genKeywords"]!=="undefined"){A["genKeywords"].empty();}if(typeof A["department"]!=="undefined"){A["department"].empty();}if(typeof A["brand"]!=="undefined"){A["brand"].empty();}}function u(J,H){if(J){var I=0;if(j.inkTonerSearch){if(H.genKeywords){D[I]=a(e.find(".ink")[0]).find("li");I++;}}else{if(H.genKeywords){D[I]=a(e.find(".keywords")[0]).find("li");I++;}if(H.department){D[I]=a(e.find(".keywords")[1]).find("li");I++;}if(H.brand){D[I]=a(e.find(".keywords")[2]).find("li");}}}if(H.product){v=a(e.find(".suggestedProducts")[0]).find("li");}}function C(){m=-1;c=0;l=false;if(typeof D[0]!=="undefined"){t=D[0];}else{if(typeof v!=="undefined"){t=v;}}}return{display:function(I,H){z();F=I;x=H;f();},next:function(){p(1);},prev:function(){p(-1);},left:function(H){o(H,-1);},right:function(H){o(H,1);},pageUp:function(){if(m!=0&&m-8<0){p(-m);}else{p(-8);}},pageDown:function(){if(m!=t.size()-1&&m+8>t.size()){p(t.size()-1-m);}else{p(8);}},hide:function(){e&&e.hide();t&&t.removeClass(q.ACTIVE);m=-1;},visible:function(){return e&&e.is(":visible");},current:function(){return this.visible()&&(t.filter("."+q.ACTIVE)[0]||j.selectFirst&&t[0]);},show:function(){var K=a(r).offset(),H;var J=0;if(typeof j.horizontalOffset!="undefined"){J=parseInt(j.horizontalOffset);}if(b){if(j.initWidth!=0){H=j.initWidth;}else{H=a(r).width();}e.find(".keywords").hide();}else{H=typeof j.width=="string"||j.width>0?j.width:a(r).width();e.find(".keywords").show();}e.css({width:H,top:K.top+r.offsetHeight,left:K.left+J}).show();if(j.scroll){list.scrollTop(0);list.css({maxHeight:j.scrollHeight,overflow:"auto"});if(a.browser.msie&&typeof document.body.style.maxHeight==="undefined"){var I=0;t.each(function(){I+=this.offsetHeight;});}}},selected:function(){var H=t&&t.filter("."+q.ACTIVE).removeClass(q.ACTIVE);return H&&H.length&&a.data(H[0],"ac_data");},emptyList:function(){list&&list.empty();},unbind:function(){e&&e.remove();},clearActive:function(){if(m!==-1&&typeof t!=="undefined"){t.slice(m,m+1).removeClass(q.ACTIVE);C();}}};};a.fn.selection=function(j,b){if(j!==undefined){return this.each(function(){if(this.createTextRange){var k=this.createTextRange();if(b===undefined||j==b){k.move("character",j);k.select();}else{k.collapse(true);k.moveStart("character",j);k.moveEnd("character",b);k.select();}}else{if(this.setSelectionRange){this.setSelectionRange(j,b);}else{if(this.selectionStart){this.selectionStart=j;this.selectionEnd=b;}}}});}var g=this[0];if(g.createTextRange){var c=document.selection.createRange(),h=g.value,f="<->",d=c.text.length;c.text=f;var e=g.value.indexOf(f);g.value=h;this.selection(e,e+d);return{start:e,end:e+d};}else{if(g.selectionStart!==undefined){return{start:g.selectionStart,end:g.selectionEnd};}}};})(jQuery);