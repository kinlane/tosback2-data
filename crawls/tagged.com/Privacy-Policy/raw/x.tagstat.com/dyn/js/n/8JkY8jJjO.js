tagged.namespace("util.stringBuffer");tagged.util.stringBuffer=function(a){this.buffer=a?a:[]};tagged.util.stringBuffer.prototype={add:function(c){var b=0;var a=arguments.length;for(;b<a;++b){if(typeof(arguments[b])!="undefined"){this.buffer[this.buffer.length]=arguments[b]}}return this},append:function(a){this.buffer[this.buffer.length]=a},toString:function(){return this.buffer.join("")}};if(typeof tagged==="undefined"){tagged={}}tagged.jst=tagged.jst||{};tagged.jst.escapeHTML=function(a){if(typeof a!=="string"){return a}return a.replace(/&(?!\w+;)|["'<>\\]/g,function(b){switch(b){case"&":return"&amp;";case"\\":return"\\\\";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return b}})};tagged.jst.toEscapedJSON=function(a){return JSON.stringify(a,function(b,c){return tagged.jst.escapeHTML(c)})};tagged.jst.render=function(a,e){var d=a.split(".");var c=tagged.jst;for(var b in d){c=c[d[b]]}return c.render.apply(this,[e])};tagged.namespace("jst.modules.harmfulToMinorsTos");tagged.jst.modules.harmfulToMinorsTos.render=function(C,options){C=C||{};options=options||{};var ngettext=function(s,n){return s[(n==1?0:1)]};var s=[];var escapeHTML=TAGGED.jst.xssFilter;try{with(C){s.push("<p>");s.push(escapeHTML("Content Harmful to Minors shall mean all content or conduct, whether visual or textual, that contains, is of, or reasonably may be construed to advocate, contain, depict, encourage, promote or solicit child pornography, sexual solicitation of and/or exploitation of minors, sexually explicit material of or concerning minors, incest, pedophilia, and any other content of an illicit sexual or violent nature concerning or involving a person under the age of eighteen (18) years, regardless of the form and format of such content. "));s.push("</p><p>");s.push(escapeHTML('Reports of Content Harmful to Minors may be emailed to our Customer Service department at <a href="mailto:childsafety@tagged.com">childsafety@tagged.com</a>.'));s.push("</p>")}return s.join("")}catch(e){if(typeof window!=="undefined"&&window._jstFailuresRaise){throw e}alert('template error in "modules/harmfulToMinorsTos.jst":\n\n'+e)}return""};tagged.namespace("jst.modules.hi5_harmfulToMinorsTos");tagged.jst.modules.hi5_harmfulToMinorsTos.render=function(C,options){C=C||{};options=options||{};var ngettext=function(s,n){return s[(n==1?0:1)]};var s=[];var escapeHTML=TAGGED.jst.xssFilter;try{with(C){s.push("<p>");s.push(escapeHTML("Content Harmful to Minors shall mean all content or conduct, whether visual or textual, that contains, is of, or reasonably may be construed to advocate, contain, depict, encourage, promote or solicit child pornography, sexual solicitation of and/or exploitation of minors, sexually explicit material of or concerning minors, incest, pedophilia, and any other content of an illicit sexual or violent nature concerning or involving a person under the age of eighteen (18) years, regardless of the form and format of such content. "));s.push("</p><p>");s.push(escapeHTML('Reports of Content Harmful to Minors may be emailed to our Customer Service department at <a href="mailto:childsafety@hi5.com">childsafety@hi5.com</a>.'));s.push("</p>")}return s.join("")}catch(e){if(typeof window!=="undefined"&&window._jstFailuresRaise){throw e}alert('template error in "modules/hi5_harmfulToMinorsTos.jst":\n\n'+e)}return""};tagged.namespace("modules.harmfulToMinorsTos");tagged.modules.harmfulToMinorsTos={init:function(){if($("#harmful_to_minors1").length){E.addListener("harmful_to_minors1","click",this.explainHarmfulToMinors,"",this)}if($("#harmful_to_minors2").length){E.addListener("harmful_to_minors2","click",this.explainHarmfulToMinors2,"",this)}},explainHarmfulToMinors:function(a){E.preventDefault(a);this.infoPanel=new YAHOO.widget.Panel("info_panel",{width:"500px",fixedcenter:true,modal:true,iframe:true});this.infoPanel.setHeader(TAGGED.modules.harmfulToMinorsTos.strings.infoPanelTitleHTM);this.infoPanel.setBody(tagged.jst.modules.harmfulToMinorsTos.render({}));this.infoPanel.render(document.body)},explainHarmfulToMinors2:function(a){E.preventDefault(a);this.infoPanel=new YAHOO.widget.Panel("info_panel",{width:"500px",fixedcenter:true,modal:true,iframe:true});this.infoPanel.setHeader(TAGGED.modules.harmfulToMinorsTos.strings.infoPanelTitleHTM);this.infoPanel.setBody(tagged.jst.modules.hi5_harmfulToMinorsTos.render({}));this.infoPanel.render(document.body)}};E.onDOMReady(tagged.modules.harmfulToMinorsTos.init,"",tagged.modules.harmfulToMinorsTos);tagged.loadStringsDirect({"TAGGED.modules.harmfulToMinorsTos.strings":{infoPanelTitleHTM:"Content Harmful to Minors"}});tagged.loadStringsDirect({"tagged.strings":{genericError:"Sorry, an error occurred. Please refresh the page and try again :(",formWarning:"WARNING: You are about to send data to an unauthorized site.  Go ahead?",locales:{en_US:"English",az_AZ:"Az\u0259rbaycan",ms_MY:"Bahasa Melayu",jv_ID:"Basa Jawa",su_ID:"Basa Sunda",my_MM:"Burmese",cs_CZ:"\u010ce\u0161tina",es_CO:"Espa\u00f1ol - Am\u00e9rica Latina",es_ES:"Espa\u00f1ol - Espa\u00f1a",es_MX:"Espa\u00f1ol - M\u00e9xico",el_GR:"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",de_DE:"Deutsch",fr_FR:"Fran\u00e7ais",id_ID:"Indonesia",it_IT:"Italiano",hu_HU:"Magyar",nl_NL:"Nederlands",pl_PL:"Polski",pt_BR:"Portugu\u00eas - Brasil",pt_PT:"Portugu\u00eas",ru_RU:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439",ro_RO:"Rom\u00e2n\u0103",tl_PH:"Tagalog",tr_TR:"T\u00fcrk\u00e7e",ur_PK:"Urdu",vi_VN:"Vi\u1ec7t",ar_SA:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629",bn_IN:"\u09ac\u09be\u0982\u09b2\u09be",zh_CN:"\u4e2d\u6587 (\u7b80\u4f53)",zh_TW:"\u4e2d\u6587 (\u7e41\u8ec6)",hi_IN:"\u0939\u093f\u0928\u094d\u0926\u0940",he_IL:"\u05e2\u05d1\u05e8\u05d9\u05ea",ja_JP:"\u65e5\u672c\u8a9e",ko_KR:"\ud55c\uad6d\uc5b4",mr_IN:"\u092e\u0930\u093e\u0920\u0940",ne_NP:"\u0928\u0947\u092a\u093e\u0932\u0940",fa_IR:"\u0641\u0627\u0631\u0633\u06cc",pa_IN:"\u0a2a\u0a70\u0a1c\u0a3e\u0a2c\u0a40",ta_IN:"\u0ba4\u0bae\u0bbf\u0bb4\u0bcd",te_IN:"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41",th_TH:"\u0e44\u0e17\u0e22",uk_UA:"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430"}}});tagged.namespace("modules.taggedTips");tagged.modules.taggedTips={_panel:null,_keyListener:null,_configs:[],init:function(a){if(!(a&&a.length)){return false}this._configs=this._configs.concat(a);this._panel=this.getPanel();this.setupEventHandlers(a)},setupEventHandlers:function(a){if(!this._keyListener){this._keyListener=new YAHOO.util.KeyListener(document,{keys:27},{fn:this.hide,scope:this,correctScope:true})}for(var b=0;b<a.length;b++){var c=a[b];E.addListener(c.node,"click",this.handleClick,c,this)}},handleClick:function(b,a){this.setPanelContent(a);this.show()},getPanel:function(){if(this._panel){return this._panel}else{var b={fixedcenter:true,iframe:true,close:true,modal:true,underlay:"none",visible:false};var a=this._panel=new YAHOO.widget.Panel("tagged_tips",b);a.render(document.body);return a}},setPanelContent:function(a){this._panel.setHeader(a.header||sprintf(this.strings.header,tagged.getBrand()));this._panel.setBody(a.body);if(a.footer){this._panel.setFooter(a.footer)}},show:function(){this._panel.show();this._keyListener.enable()},hide:function(){this._panel.hide();this._keyListener.disable()},destroy:function(){for(var b=0;b<this._configs.length;b++){var a=this._configs[b];E.removeListener(a.node,"click")}this._keyListener.disable();this._panel.destroy();this._panel=null}};tagged.namespace("mvc");MVC=tagged.mvc;tagged.namespace("mvc");MVC.init=function(a){a=a||{};MVC._loadSchema=!!a.loadSchema};MVC.init();tagged.namespace("apps.facebook.core");tagged.apps.facebook.core._dfdSDK=$.Deferred();tagged.apps.facebook.core.getSDK=function(){return tagged.apps.facebook.core._dfdSDK.promise()};window.fbAsyncInit=function(){FB._https=window.location.protocol=="https:";FB.init(tagged.data.fbSDKInitData);tagged.apps.facebook.core._dfdSDK.resolve(FB)};tagged.apps.facebook.core.getSDK().then(function(a){a.Canvas.setAutoGrow();if(window.facebookInitCallback){window.facebookInitCallback();window.facebookInitCallback=null}});$(function(){var d="en";var c="US";if(tagged.data.fbSDKLocale){var f=tagged.data.fbSDKLocale.match(/([a-z]{2})[\-_]?([A-Z]{2})/);if(f){d=f[1];c=f[2]}}var b=document.createElement("script");b.async=true;b.src=document.location.protocol+"//connect.facebook.net/"+d+"_"+c+"/all.js";var a=document.getElementById("fb-root");if(a){a.appendChild(b)}});tagged.namespace("modules.connect");tagged.modules.connect={NOT_CONNECTED:0,CONNECTED:1,ALREADY_CONNECTED:2,JUST_LOGIN:3,NOT_REGISTERED:4,_connectHTML:'<form name="connect_form">%s</form>',_connectLink:'<a class="connect" service_name="%s" href="#">%s</a>',_connectCheckbox:'<input type="checkbox" service_name="%s" %s name="%s" feature="%s" callback="%s" id="%s"/><label for="%s">%s</label>',_separator:'<span class="connect_separator">&bull;</span>',services:["facebook","myspace","twitter"],connectSettings:null,feature:"",connectSuccessCallback:null,win:null,init:function(a){if(a){for(var b in a){this[b]=a[b]}}window.connect_callback=this.connectCallback},addListener:function(d){var b=document.getElementsByClassName("connect_container");for(var a=0;a<b.length;a++){var c=$(b[a]);if($.type($(c).attr("connect_action"))==="undefined"){$(c).attr("connect_action","true");$(c).on("click",this.handleConnect)}}if(d){this.connectSuccessCallback=d}},handleConnect:function(d){if(d.target){var c=d.target}else{var c=d.srcElement}var a="";var g=this.getPageLocation();if(c&&c.tagName.toUpperCase()=="INPUT"){a=c.getAttribute("service_name");this.updateSetting(a,c.getAttribute("feature"),c.checked,c.getAttribute("callback"));return}if(c&&c.tagName.toUpperCase()!="A"){c=c.parentNode}g=c.getAttribute("container")?c.getAttribute("container")+"_"+g:g;var f=this.getGeneration();if(c.getAttribute("service_name")){a=c.getAttribute("service_name");var b="/partners/connect_popup.html?service="+a+"&from="+g;b+="&generation="+f;this.win=window.open(b,"","height=620,width=840");if(d.preventDefault){d.preventDefault()}else{d.returnValue=false}}if(this.win){this.win.focus()}},handleConnectDirect:function(a){from=this.getPageLocation();var c=this.getGeneration();if(a){var b="/partners/connect_popup.html?service="+a+"&from="+from;b+="&generation="+c;this.win=window.open(b,"","height=620,width=840")}if(this.win){this.win.focus()}},getSetting:function(a,c){this.feature=a;var b={method:"tagged.connect.settings.getSettingsByFeature",feature:a,callback:c};TAGGED.api.call(b)},updateSetting:function(b,a,d,e){var c={method:"tagged.connect.settings.updateSetting",type:b,feature:a,value:d?1:0,callback:"TAGGED.api.nullResponseHandler"};TAGGED.api.queue.push(c);if(e){c={method:"tagged.connect.settings.getSettingsByFeature",feature:a,callback:e};TAGGED.api.queue.push(c)}TAGGED.api.dequeue()},connectCallback:function(a,b){if(b==1){if(this.connectSuccessCallback){this.connectSuccessCallback(a,b)}else{window.location.reload(true)}}else{if(b==2){alert(this.strings.alreadyConnected)}else{if(b==3){if(tagged.redirect_url){window.location.href=tagged.redirect_url}else{window.location.reload()}}else{if(b==4){window.location.href=tagged.reg_url}else{if($.type(b)==="undefined"){window.location.reload(true)}}}}}},handleDisconnect:function(c){if(c.preventDefault){c.preventDefault()}else{c.returnValue=false}if(c.target){var b=c.target}else{var b=c.srcElement}if(!b.id){b=b.parentNode}var d=this.strings[b.id];if(d&&confirm(d)){var a={method:"tagged.connect.disconnect",service:this._getServiceName(b.id),callback:{fn:this.disconnectResponse,scope:this}};TAGGED.api.call(a)}},disconnectResponse:function(b){if(b&&b.stat=="ok"){var a=b.result.service;$("a#"+a+"_disconnect").addClass("hide_me");$("a."+a+"_connect").removeClass("hide_me");$("div#"+a+"_connected").addClass("hide_me")}},settingsResponse:function(a){if(a.stat=="ok"){this.connectSettings=a.result;this.renderConnectContainers()}},refreshSettings:function(){this.getSetting(this.feature,"tagged.modules.connect.settingsResponse")},renderConnectContainers:function(a){if(this.connectSettings!=null){a=a||"";var d=$("div.connect_container");this.connectSettings.checkbox_callback="tagged.modules.connect.refreshSettings";var c=this.renderConnectBox(this.connectSettings);for(var b=0;b<d.length;b++){d[b].innerHTML=c}this.addListener(this.refreshSettings)}else{if(this.connectSettings==null){this.refreshSettings()}}},renderConnectBox:function(j){var c="";if(!j){return c}var h="";if(j.checkbox_callback){h=j.checkbox_callback}var g=[];if((j.feature_name=="photos"||j.feature_name=="status")&&tagged.getBrand()=="hi5"){this.services=["facebook"]}for(var d=0;d<this.services.length;++d){var f=this.services[d];if(d>0){c+=this._separator}if(j.linked[f+"Connected"]){var a=!j.settings||j.settings[f]!==0;c+=sprintf(this._connectCheckbox,f,a?'checked="checked"':"",f+"_post",j.feature_name,h,"chk_"+f,"chk_"+f,this.strings[f+"Post"])}else{c+=sprintf(this._connectLink,f,this.strings[f+"Connect"])}if(tagged.data.enable_tagged_tip){var e=f+"_tip";c+=sprintf('<span class="tagged_tip_icon" id="%s"></span>',e);g.push(e)}}c=sprintf(this._connectHTML,c);if(tagged.data.enable_tagged_tip&&g.length){var b=window.setInterval(function(){var m=$("#"+g[0]);if(m){window.clearInterval(b);var k=[];for(var l=0;l<g.length;l++){k.push({body:sprintf(tagged.modules.connect.strings.tagged_tip,tagged.getBrand(),"/account_info.html"),node:g[l]})}tagged.modules.taggedTips.init(k)}},200)}return c},renderFacebookFeed:function(d,b){if(!(d.result.facebook&&d.result.facebook.tracking_id&&b.feature&&b.from&&b.generation&&b.callback&&b.scope)){alert(this.strings.general_error);return}var c={method:"stream.publish"};var a="";if(d.result.facebook.attachment){c.attachment=d.result.facebook.attachment}if(d.result.facebook.action_links){c.action_links=d.result.facebook.action_links;a=d.result.facebook.action_links[0].href}if(d.result.facebook.message){c.message=d.result.facebook.message;a=d.result.facebook.message}var e=function(f){if(f&&f.post_id){var g={method:"tagged.connect.logPost",service:"facebook",feature:b.feature,from:b.from,generation:b.generation,trackingId:d.result.facebook.tracking_id,callback:{fn:b.callback,scope:b.scope}};TAGGED.api.call(g)}else{if($.type(b.skip_callback)==="function"){b.skip_callback()}}};tagged.apps.facebook.core.getSDK().then(function(f){f.ui(c,e)})},getPageLocation:function(){var a=window.location.pathname;if(a&&a.length>1){var b=a.indexOf(".html");b=b>0?b:a.indexOf("?");if(b>0){return a.substr(1,b-1)}}if(!a||a.length<2){a="index"}return a},getGeneration:function(){var a=TAGGED.api.getQueryStringParameter("generation");if(a&&!isNaN(a)){++a}else{a=0}return a},needConfirmation:function(b){b=b||this.connectSettings;if(!b.settings||b.settings.intent_confirmed!=1){for(var c in b.linked){var a=c.substr(0,c.indexOf("Connected"));if(a&&b.linked[c]&&(!b.settings||b.settings[a]!==0)){return true}}}return false},_getServiceName:function(b){var a=b.split("_");return a[0]}};$(document).ready(function(){tagged.modules.connect.init()});tagged.namespace("index.connect");tagged.index.connect={appealLightBox:null,init:function(){E.addListener(D.getElementsByClassName("connect_container"),"click",tagged.modules.connect.handleConnect,tagged.modules.connect,true);window.connect_callback=this.handleConnectCallback;if(tagged.hasOpenAppeal){tagged.index.connect.displayAppealsLightbox()}},handleConnectCallback:function(a,b){if(b==4){window.location.href=tagged.reg_url+"?service="+a}else{if(b>0){if(tagged.data.redirect_url){window.location.href=tagged.data.redirect_url}else{window.location.reload()}}}},displayAppealsLightbox:function(){if(tagged.index.connect.appealLightBox!=null){return}var b=tagged.index.connect.strings.appealHeader;var a=sprintf(tagged.index.connect.strings.appealBody,tagged.getBrand());a=a+"<br><br>"+sprintf(tagged.index.connect.strings.appealSig,tagged.getBrand());this.appealLightBox=new YAHOO.widget.Panel("confirmPanel",{width:"500px",fixedcenter:true,modal:true,iframe:true});this.appealLightBox.setHeader(b);this.appealLightBox.setBody(a);this.appealLightBox.render(document.body);E.addListener(this.appealLightBox.close,"click",tagged.index.connect.closePanel)},closePanel:function(){tagged.index.connect.appealLightBox.destroy();tagged.index.connect.appealLightBox=null;window.location=tagged.base_url}};E.onDOMReady(tagged.index.connect.init,"",tagged.index.connect);tagged.loadStringsDirect({"tagged.modules.taggedTips.strings":{header:"%s Tip"}});tagged.loadStringsDirect({"tagged.modules.connect.strings":{twitter_disconnect:"Are you sure you want to disconnect from Twitter?",facebook_disconnect:"Are you sure you want to disconnect from Facebook?",myspace_disconnect:"Are you sure you want to disconnect from Myspace?",windowClosed:"Failed to open the pop up window.",alreadyConnected:"This account is connected to another %s account.",facebookConnect:"Connect to Facebook",facebookPost:"Post to Facebook",twitterConnect:"Connect to Twitter",twitterPost:"Post to Twitter",myspaceConnect:"Connect to MySpace",myspacePost:"Post to MySpace",tagged_tip:'Click the checkbox next to any service to Connect and post content from your %s account. You can manage your Connected Accounts at any time on the <a href="%s" target="_blank">Account</a> page.',general_error:"Sorry, there was an error. Please reload the page and try again."}});tagged.loadStringsDirect({"tagged.index.connect.strings":{appealHeader:"Access Denied: Appeal Pending",appealBody:"%s Customer Service is in the process of evaluating your account removal appeal.<br><br> You will be informed via email when a decision is reached, until then you will not be able to access this account. Your patience is greatly appreciated",appealSig:"Thanks, <br>%s Customer Service"}});tagged.namespace("tagcom.menu");tagged.tagcom.menu={menuRegistry:{},create:function(c,h,i,j,a,g,d,b){var e=new this.Menu(c,h,i,j,a,g,d,b);switch(e.type){case"click":e.parent.click(function(k){if(e.menu.css("visibility")=="hidden"){e.open();k.stopPropagation()}else{e.close()}k.preventDefault()});break;case"hover":function f(k){if(!this.isInside(k.pageX-1,k.pageY-1)){this.close()}else{$(document).bind("mousemove.menu_"+e.id,$.proxy(function(l){if(!this.isInside(l.pageX-1,l.pageY-1)){this.close()}},this))}}e.parent.bind("mouseenter.menu_"+e.id,function(k){e.open();$(document).unbind(".menu"+e.id);k.preventDefault()}).bind("mouseleave.menu_"+e.id,$.proxy(f,e));e.menu.bind("mouseleave.menu_"+e.id,$.proxy(f,e));break;default:return null}e.menu.bind("click.menu_",function(k){tagged.tagcom.menu.onSelection(k,e)});this.menuRegistry[e.id]=e;return e},findMenuPos:function(t){var a=t.menu;var j=t.parent;var n=t.placement;var l=t.container;var b=j.offset();var f=b.top;var d=f+j.outerHeight();var g=b.left;var o=g+j.outerWidth();var p=l.offset()||{top:0,left:0};var h=p.top;var c=h+l.height();var r=p.left;var s=r+l.width();var q;var k;var i=false;var e=false;switch(n){case"down":q=f+j.outerHeight();k=g;if(q+a.outerHeight()<c){i=true;break}break;case"up":q=f-a.outerHeight();k=g;if(q>h){i=true;break}if(n=="up"){q=f+j.outerHeight();k=g;if(q+a.outerHeight()<c){i=true;break}}break;case"right":q=f;k=o;if(k+a.outerWidth()<s){e=true;break}break;case"left":q=f;k=g-a.outerWidth();if(k>r){e=true;break}q=f;k=o;if(k+a.outerWidth()<s){e=true;break}break;default:q=0;k=0;alert("Error, menu imposible to place!");break}if(i&&k+a.outerWidth()>=s){k=o-a.outerWidth()}if(e&&q+a.outerHeight()>=c){q=d-a.outerHeight()}if(e&&q<=h){q=c-a.outerHeight()}return{top:q,left:k}},onSelection:function(c,a){var b=a.callback($(c.target),a);if(!b){a.close()}},getMenu:function(a){return this.menuRegistry[a]},unregisterMenu:function(a){delete this.menuRegistry[a]},Menu:function(f,e,h,b,g,d,c,a){f=$(f);e=$(e);d=d||"click";c=c||"down";a=$(a||document);this.id=f.attr("id");this.menu=f;this.parent=e;this.callback=h;this.openCallback=b;this.closeCallback=g;this.placement=c;this.container=a;this.type=d;this.close=function(){if(this.menu.css("visibility")=="visible"){this.menu.css({visibility:"hidden",left:"",top:""});$(document).unbind(".menu_"+this.id);if(this.closeCallback){this.closeCallback(this)}}};this.closeOthers=function(){var i=tagged.tagcom.menu.menuRegistry;for(m in i){if(m!=this.id){i[m].close()}}};this.open=function(){if(this.menu.css("visibility")=="hidden"){var i=tagged.tagcom.menu.findMenuPos(this);this.menu.offset(i).offset(i).css("visibility","visible");this.closeOthers();if(this.type=="click"){$(document).bind("click.menu_"+this.id,$.proxy(function(j){this.close()},this))}if(this.openCallback){this.openCallback(this)}}};this.unbind=function(){var i=".menu_"+this.id;this.parent.unbind(i);this.menu.unbind(i);$(document).unbind(i);tagged.tagcom.menu.unregisterMenu(this.id)};this.isInside=function(i,o){var k=this.parent.offset();k.right=k.left+this.parent.outerWidth();k.bottom=k.top+this.parent.outerHeight();var l=this.menu.offset();l.right=l.left+this.menu.outerWidth();l.bottom=l.top+this.menu.outerHeight();var n=i>Math.ceil(k.left)&&i<k.right&&o>Math.ceil(k.top)&&o<=k.bottom;var j=i>Math.ceil(l.left)&&i<l.right&&o>Math.ceil(l.top)&&o<=l.bottom;return n||j}}};function formatStuff(a,f,e,b){var c=b.offset();c.right=c.left+b.outerWidth();c.bottom=c.top+b.outerHeight();var d=e.offset();d.right=d.left+e.outerWidth();d.bottom=d.top+e.outerHeight();return""+a+","+f+" \n "+c.left+"-"+c.right+","+c.top+"-"+c.bottom+" \n "+d.left+"-"+d.right+","+d.top+"-"+d.bottom};tagged.namespace("footer");tagged.footer={init:function(){tagged.tagcom.menu.create("#language_menu","#language_dropup",this.onLanguageSelect,this.onOpen,this.onClose,"click","up")},onOpen:function(a){a.parent.addClass("opened")},onClose:function(a){a.parent.removeClass("opened")},onLanguageSelect:function(b,c){var a={method:"tagged.account.setUserLanguage",langCode:b.attr("id"),callback:{fn:tagged.languageUpdated}};TAGGED.api.call(a)}};$(function(){tagged.footer.init()});tagged.loadStringsDirect({"tagged.security.password.strings":{header:"Password Required"}});tagged.loadStringsDirect({"tagged.security.captcha.strings":{header:"Verification Required",failed:"Verification Failed"}});tagged.namespace("realtime");tagged.realtime={eventsHandlerTable:{},subscribeEvents:[],subscriptionTable:{},subscriptionGroups:{},userId:null,nextEventId:null,iframe:null,nodeUrl:"",initialDeferTime:200,deferTime:20,debug:false,alive:true,connected:false,clientId:null,maxReconnectAttempts:3,reconnectTime:100,attempts:0,sendTimer:null,backstopTimer:null,backstopTime:Math.floor(Math.random()*20+120)*1000,_needsUpdateFlag:false,init:function(){var a=tagged.data.realtime_enabled;if(!a){return}this.eventsHandlerTable={};this.subscribeEvents=[];this.subscriptionTable={};this.subscriptionGroups={};this.debug=tagged.data.realtime_debug;this.nodeUrl=tagged.data.node_url;if(!this.nodeUrl){this.alive=false}this.userId=tagged.data.user_id;this.nextEventId=tagged.data.next_event_id;this.clientId=tagged.data.clientId;this.prepIframe()},prepIframe:function(){var a=$("<iframe/>",{id:"node_iframe",src:"/realtime_iframe.html",css:{position:"absolute",top:0,left:0,width:1,height:1,visibility:"hidden"}}).prependTo(document.body);this.iframe=a[0];a.load($.proxy(this.initIframe,this))},initIframe:function(){this.iframe.contentWindow.NodeFrame.init(this,this.handleResponse);this.sendTimer=setTimeout(function(){tagged.realtime.connect()},this.initialDeferTime)},iframeReady:function(a){a.init(this,this.handleResponse)},isAlive:function(){return this.alive},subscribe:function(b,a,d,e){var g=false;if($.isArray(b)){var f=b;for(var c=0;c<f.length;c++){e=f[c].group||"all";if(this._subscribeTopic(f[c].topic,f[c].prevMsgs,f[c].cbObj,e)){g=true}}}else{e=e||"all";if(this._subscribeTopic(b,a,d,e)){g=true}}if(g){this.update()}},_subscribeTopic:function(c,b,e,f,d){var a=false;if(!this.subscriptionTable[c]){this.subscriptionTable[c]=[e];if(b>0){this.subscribeEvents.push({topic:c,prevMsgs:b})}else{this.subscribeEvents.push(c)}a=true}else{if($.inArray(e,this.subscriptionTable[c])===-1){this.subscriptionTable[c].push(e)}a=false}if(!(f in this.subscriptionGroups)){this.subscriptionGroups[f]=[]}this.subscriptionGroups[f].push({topic:c,cbObj:e});return a},unsubscribe:function(d,e){var c=-1;if(!this.subscriptionTable[d]){return false}var b=this.subscriptionTable[d];if(b){var a=$.inArray(e,b);if(a!==-1){b.splice(a,1)}}if($.isEmptyObject(this.subscriptionTable[d])){$.each(this.subscribeEvents,function(g,f){var h=(typeof(f)=="string"?f:f.topic);if(h===d){c=g}});if(c>=0){this.subscribeEvents.splice(c,1)}delete this.subscriptionTable[d];this._needsUpdateFlag=true}},unsubscribeGroup:function(b){if(!(b in this.subscriptionGroups)){return}for(var a=0;a<this.subscriptionGroups[b].length;a++){this.unsubscribe(this.subscriptionGroups[b][a].topic,this.subscriptionGroups[b][a].cbObj)}delete this.subscriptionGroups[b]},register:function(b,c){var e=false;if($.isArray(b)){var d=b;for(var a=0;a<d.length;a++){if(this._registerEvent(d[a].eventType,d[a].cbObj)){e=true}}}else{if(this._registerEvent(b,c)){e=true}}if(e){this.update()}},_registerEvent:function(a,b){if(this.eventsHandlerTable[a]){if($.inArray(b,this.eventsHandlerTable[a])===-1){this.eventsHandlerTable[a].push(b)}return false}else{this.eventsHandlerTable[a]=[b];return true}},unregister:function(c,d){var b=this.eventsHandlerTable[c];if(b){var a=$.inArray(d,b);if(a!==-1){b.splice(a,1)}}if($.isEmptyObject(this.eventsHandlerTable[c])){delete this.eventsHandlerTable[c]}},update:function(){if(this.connected&&this.sendTimer===null){this.sendTimer=setTimeout(function(){tagged.realtime.sendRequest(true)},this.deferTime)}},connect:function(){this.sendRequest(true);this.connected=true},sendRequest:function(g){this.consoleLog("sendRequest()");var f={"X-T-Uid":this.userId,st:tagged.data.session_token,nid:this.nextEventId,ci:this.clientId};var e=(window.location.pathname.match(/\/apps\/(.*).html/)||[null,null])[1];if(e){var a=tagged.data.application_info[e];if(a&&a.id){f.aid=a.id}}var b={};if(g||this._needsUpdateFlag){f.se=JSON.stringify(this.subscribeEvents);var d=[];for(var c in this.eventsHandlerTable){d.push(c)}f.et=JSON.stringify(d);this._needsUpdateFlag=false}b.url=this.nodeUrl+"/poll";b.data=f;this.iframe.contentWindow.NodeFrame.sendRequest(b);if(this.sendTimer){clearTimeout(this.sendTimer);this.sendTimer=null}if(this.backstopTimer!==null){clearTimeout(this.backstopTimer)}this.backstopTimer=setTimeout(function(){tagged.realtime.consoleLog("backstopTimer()");tagged.realtime.connected=false;tagged.realtime.reconnect()},this.backstopTime)},handleResponse:function(d){this.consoleLog("handleResponse()");this.consoleLog(d);if(d){if(d.success){if(d.data){this.nextEventId=d.data.next_event_id;var n=d.data.events_data;var k={};for(var g=0;g<n.length;g++){var a=n[g].event_type;if(k[a]){k[a].push(n[g].event_data)}else{k[a]=[n[g].event_data]}}for(var m in k){var c;if(m.indexOf("pubsub_")===0){var h=m.substring(7);c=this.subscriptionTable[h]}else{c=this.eventsHandlerTable[m]}if(c){for(var f=0;f<c.length;f++){var b=c[f];try{b.cb.call(b.scope,k[m],b.args)}catch(l){this.consoleLog("Exception in realtime callback: "+l)}}}}}this.attempts=0;this.sendRequest()}else{if(d.error&&d.data&&d.data.message){if(this.connected){this.connected=false;this.consoleLog("Realtime error: "+d.data.message);this.reconnect()}}}}else{if(this.connected){this.connected=false;this.consoleLog("Realtime error: General Node API failure");this.reconnect()}}},reconnect:function(){if(this.alive&&this.attempts++<this.maxReconnectAttempts){this.consoleLog("Attempt "+this.attempts+" to reconnect to Realtime push");var a={method:"tagged.util.realtimeReconnect",callback:{fn:function(b){if((b.stat=="ok")&&b.result&&b.result.success){this.nextEventId=b.result.next_event_id;this.clientId=b.result.client_id;tagged.data.session_token=b.result.session_token;tagged.realtime.connect()}else{setTimeout(function(){tagged.realtime.reconnect()},this.reconnectTime)}},scope:this}};TAGGED.api.call(a)}else{this.consoleLog("Reconnection failed.");this.alive=false}},consoleLog:function(a){if(this.debug&&typeof(console)!="undefined"){window.console.log(a)}}};$(document).ready(function(){tagged.realtime.init()});var ClickLogger=function(a){this.conf=a||{};if(typeof a.rootEl==="string"){a.rootEl=$(a.rootEl)}this.rootEl=this.conf.rootEl||$(document.body);this.els=this.conf.els||this.rootEl.find("[data-clickLogger]");this.bindHandlers()};ClickLogger.prototype={bindHandlers:function(){var a=this;this.rootEl.on("click","[data-clickLogger]",function(c){var b={source:$(this).attr("data-clickLogger"),targetId:$(this).attr("data-uid")};a.logClick(b)})},logClick:function(a){var b={method:"tagged.log.click",source:a.source,callback:{fn:function(c){},scope:this}};if(this.conf.app){b.app=this.conf.app}if(this.conf.location){b.location=this.conf.location}if(a.targetId){b.target_id=a.targetId}tagged.api.call(b)}};tagged.namespace("messages_delta.count");tagged.messages_delta.count={total:0,init:function(a){this.nav=a.nav;if(tagged.data.reset_count){return}this.getUnreadMessageCount();if(tagged.data.realtime_enabled){tagged.realtime.register("conversation_read_inc",{cb:this.setUnreadMessageCount,scope:this})}},getUnreadMessageCount:function(){var a={method:"tagged.im.getUnreadMessageCount",timeout:5000,callback:{fn:function(b){if(b.stat!=="fail"){this.setUnreadMessageCount(b.result,"call")}},scope:this}};TAGGED.api.call(a)},resetUnreadMessageCount:function(){var a={method:"tagged.im.resetUnreadMessageCount",callback:{fn:function(b){if(b.stat!=="fail"){this.setUnreadMessageCount(b.result,"call")}},scope:this}};TAGGED.api.call(a)},setUnreadMessageCount:function(a,b){if(b==="call"){this.total=a}else{if(a[0].unread_count){a=a[0].unread_count;this.total+=a;if(this.total<0){this.total=0}}}this.nav.setBadgeValue("#message_count",this.total)}};tagged.namespace("util.string");tagged.util.string={quoteRegEx:null,highlight_span:'<span class="highlight">$1</span>',isEmpty:function(a){return(a==null||a.match(/^\s*$/)!=null)},isValidEmail:function(b){var a=/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;return a.test(b)},escapeQuotes:function(a){if(!tagged.util.string.quoteRegEx){tagged.util.string.quoteRegEx=new RegExp();tagged.util.string.quoteRegEx.compile("('|\")","g")}return a.replace(tagged.util.string.quoteRegEx,"\\$1")},breakString:function(f,c){if(!f){return""}var f=f.replace(/\n/g," ");var e=f.split(" ");if(navigator.appName=="Netscape"){var g="<wbr/>"}else{var g="&shy;"}for(var d=0;d<e.length;d++){if(e[d].length>c){var b=e[d].length;var h=b/c;var j=new Array;for(var k=0;k<h;k++){var a=e[d].substring(k*c,(k+1)*c)+g;j.push(a)}e[d]=j.join("")}}return(e.join(" "))},tinyMceIsEmpty:function(a){if(!a){return true}return !$.trim(a.replace(/<p>|<\/p>|<br>|&nbsp;/g,""))},tinyMceIsShort:function(a){if($.trim(a.replace(/<p>|<\/p>|<br>|&nbsp;/g,"")).length<2){return true}return !$.trim(a.replace(/<p>|<\/p>|<br>|&nbsp;/g,""))},subParams:function(a,b){if((typeof b!="object")||(a==null)){return""}return a.replace(/\%?\{(\w+)\}/g,function(d,c,e){if(typeof(b[c])!="undefined"&&b[c]!=null){return b[c]}})},summary:function(a,b){if(!b||a.length<=b){return a}return a.substring(0,b-3).replace(/\.+$/,"")+"..."},linkify:function(c){var b=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;var a=/(^|[^\/])(www\.[-A-Z0-9][\S]*(\b|$))/gim;c=c.replace(b,'<a href="$1" class="ext">$1</a>');c=c.replace(a,'$1<a href="http://$2" class="ext">$2</a>');return c},createSearchRegex:function(d){var e="";for(var b=0;b<d.length;b++){if(d[b]){var a=d[b].replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&");e+=a+"|"}}e=e.substr(0,e.length-1);var c=new RegExp("("+e+")","ig");return c},highlight:function(b,a){var c=tagged.util.string.createSearchRegex(a);return b.replace(c,tagged.util.string.highlight_span)},updateQueryStringParameter:function(a){var d=a.uri;var b=a.paramKey;var h=a.paramVal;var c=new RegExp("([?|&])"+b+"=.*?(&|#|$)","i");if(!d){return}if(d.match(c)){return d.replace(c,"$1"+b+"="+h+"$2")}else{var f="";var e=d.indexOf("?")!==-1?"&":"?";if(d.indexOf("#")!==-1){f=d.replace(/.*#/,"#");d=d.replace(/#.*/,"")}var g=d+e+b+"="+h+f;return(typeof String.prototype.trim!=="undefined")?g.trim():g}},isString:function(a){return(typeof a=="string")||(a instanceof String)}};tagged.namespace("jst.util.format_timespan");tagged.jst.util.format_timespan.render=function(C,options){C=C||{};options=options||{};var ngettext=function(s,n){return s[(n==1?0:1)]};var s=[];var escapeHTML=TAGGED.jst.xssFilter;try{with(C){var u=0;if(t<0&&!hide_past){t=-t;if(t<5){s.push(escapeHTML("Moments ago"))}else{if(t<30){s.push(escapeHTML("Half a minute ago"))}else{if(t<60){s.push(escapeHTML("Less than a minute ago"))}else{if(t<60*60){u=Math.ceil(t/60);s.push(escapeHTML(sprintf(ngettext(["A minute ago","%d minutes ago"],u),u)))}else{if(t<24*60*60||max=="hour"){u=parseInt(t/(60*60),10);s.push(escapeHTML(sprintf(ngettext(["An hour ago","%d hours ago"],u),u)))}else{if(t<7*24*60*60||max=="day"){u=parseInt(t/(24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["A day ago","%d days ago"],u),u)))}else{if(t<30*24*60*60||max=="week"){u=parseInt(t/(7*24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["A week ago","%d weeks ago"],u),u)))}else{if(t<2*30*24*60*60||max=="month"){u=parseInt(t/(30*24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["A month ago","%d months ago"],u),u)))}else{s.push(escapeHTML("Over 3 months ago"))}}}}}}}}}else{if(t>0){if(t<60||max=="second"){s.push(escapeHTML(sprintf(ngettext(["%d second","%d seconds"],t),t)))}else{if(t<60*60||max=="minute"){u=parseInt(t/60,10);s.push(escapeHTML(sprintf(ngettext(["%d minute","%d minutes"],u),u)))}else{if(t<24*60*60||max=="hour"){u=parseInt(t/(60*60),10);s.push(escapeHTML(sprintf(ngettext(["%d hour","%d hours"],u),u)))}else{if(t<7*24*60*60||max=="day"){u=parseInt(t/(24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["%d day","%d days"],u),u)))}else{if(t<30*24*60*60||max=="week"){u=parseInt(t/(7*24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["%d week","%d weeks"],u),u)))}else{if(t<12*30*24*60*60||max=="month"){u=parseInt(t/(30*24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["%d month","%d months"],u),u)))}else{u=parseInt(t/(12*30*24*60*60),10);s.push(escapeHTML(sprintf(ngettext(["%d year","%d years"],u),u)))}}}}}}}else{if(t==0||hide_past){s.push(escapeHTML("now"))}}}}return s.join("")}catch(e){if(typeof window!=="undefined"&&window._jstFailuresRaise){throw e}alert('template error in "util/format_timespan.jst":\n\n'+e)}return""};tagged.namespace("util.format");tagged.util.format={currency:function(b,a){if(a){return"$"+tagged.util.format.commify(b)}b=parseInt(b,10);if(typeof b==="number"&&isFinite(b)){if(b>=0){return"$"+tagged.util.format.commify(b)}else{return"-$"+tagged.util.format.commify(b).slice(1)}}else{return""}},commify:function(b){b=(b||0).toString();var a=/(\d+)(\d{3})/;while(a.test(b)){b=b.replace(a,"$1,$2")}return b},decommify:function(a){return parseInt(a.replace(/,/g,""))},ellipse:function(d,a){if(!(typeof d==="string")){return d}if(d.indexOf("&")>=0){var c=d.split(/([^&]|&[^;]+;)/g);var b=parseInt(c.length/2);return b>a?c.slice(0,a*2).join("")+"&hellip;":d}else{return d.length>a?d.substr(0,a)+"&hellip;":d}},time:function(b,d,c,a){if(typeof(a)=="undefined"){a=parseInt((new Date()).getTime()/1000)}return tagged.util.format.timespan(b-a,d,c)},timespan:function(c,b,a){return tagged.jst.util.format_timespan.render({t:c,max:b||"year",hide_past:a,cutoff:"year"})},formatTimestamp:function(g){var c=g*1000;var b=new Date(c);var a=b.getHours();var e=b.getMinutes();var d=b.getSeconds();var f="";f+=(a>12?a-12:a)+":";f+=("0"+e).slice(-2)+":";f+=("0"+d).slice(-2)+" ";f+=a>=12?"PM":"AM";return f},pad:function(b,a){var c=""+b;while(c.length<a){c="0"+c}return c}};tagged.namespace("nav");window.Nav={Views:{},Collections:{}};Nav.Collections.Alerts=Backbone.Collection.extend({fetch:function(){var a={method:"tagged.header.renderAlerts",callback:{fn:this.renderAlerts,scope:this}};TAGGED.api.call(a)},renderAlerts:function(b){if(b.stat!=="ok"){return}var a=[];if(b.result.drop_down){_.each(b.result.drop_down,function(c,d){c.id=d;a.push(c)})}else{if(b.result.lightbox){this.trigger("showLightbox",b.result.lightbox)}}this.reset(a)}});Nav.Collections.Links=Backbone.Collection.extend({initialize:function(h,d){this.baseView=d.base;this.strings=_.clone(d.base.strings);this.meetme_enabled=d.meetme_enabled;this.chat_support_url=d.chat_support_url;this.phone_support_url=d.phone_support_url;this.valid_age_for_groups=d.valid_age_for_groups;this.people=[];this.more=[];this.account=[];this.peopleLinks=["/friends.html","/meetme.html","/browse.html","search.html?source=header"];this.accountLinks=["gold","/gold.html?ll=05310","title","nav_set_available","nav_set_invisible",d.secure_url+"/account_info.html","/help.html","/contact.html","phone_support","chat_support","/logout.html"];this.moreLinks=["/photo_gallery.html","/gifts.html","/tags.html","/post_comment.html","/luv.html","/wink.html","/games.html","/find_groups.html",d.video_url,"/notifications.html","/birthdays.html"];if(!this.valid_age_for_groups){this.moreLinks.splice(7,1);this.strings.more=_.reject(this.strings.more,function(i){return(/Groups/).test(i)})}var f=_.bind(this.baseView.peopleMenu.triggerLinkClick,this.baseView);var c=_.bind(this.baseView.moreMenu.triggerLinkClick,this.baseView);var b=_.bind(this.baseView.accountMenu.triggerLinkClick,this.baseView);for(var e in this.strings.people){if(this.peopleLinks[e]==="/meetme.html"){f=this.meetme_enabled?f:this.meetmeDownAlert}this.people.push({html:'<a href="'+this.peopleLinks[e]+'">'+this.strings.people[e]+"</a>",cb:f})}for(var a in this.strings.more){this.more.push({html:'<a href="'+this.moreLinks[a]+'">'+this.strings.more[a]+"</a>",cb:c})}for(var g in this.accountLinks){switch(this.accountLinks[g]){case"gold":this.account.push({html:'<div class="icon gold_small_menu"></div><span id="header_gold_amount">'+this.baseView.gold_balance+"</span>",isTitle:true});break;case"title":this.account.push({html:this.strings.account[g],isTitle:true});break;case"nav_set_available":this.account.push({html:'<i class="tag-icon-status mrs mtxs tag-icon-status-green" id="status_icon"></i>'+this.strings.account[g],cb:$.proxy(this.baseView.visibility.setStatus,this.baseView.visibility,{status:3})});break;case"chat_support":if(!tagged.data.eligibleForChatSupport){break}this.account.push({html:'<a href="'+this.chat_support_url+'" id="nav_chat_support">Chat Support <span id="0591629f-3b15-4148-8fd1-f973d16466a3" class="chat_status float"></span></a>'});break;case"phone_support":if(!tagged.data.eligibleForPhoneSupport){break}this.account.push({html:'<a href="'+this.phone_support_url+'">Call Support</a>'});break;case"nav_set_invisible":this.account.push({html:'<i class="tag-icon-status mrs mtxs tag-icon-status-gray" id="status_icon"></i>'+this.strings.account[g],cb:$.proxy(this.baseView.visibility.setStatus,this.baseView.visibility,{status:1})});break;default:this.account.push({html:'<a href="'+this.accountLinks[g]+'">'+this.strings.account[g]+"</a>",cb:b});break}}},meetmeDownAlert:function(){alert(this.strings.util.meetme_down)}});tagged.namespace("jst.modules.dropdown");tagged.jst.modules.dropdown.render=function(C,options){C=C||{};options=options||{};var ngettext=function(s,n){return s[(n==1?0:1)]};var s=[];var escapeHTML=TAGGED.jst.xssFilter;try{with(C){s.push('<div class="menu_pane drop_shadow" style="display: none;" > <ul class="menu_list unstyled man"> ');for(var i=0;i<items.length;i++){s.push(" ");if(items[i].isSeparator||(items[i].html&&items[i].html=="separator")){s.push(' <li class="separator_item"><div></div></li> ')}else{if(items[i].isTitle){s.push(' <li class="menu_item title_item">');s.push(items[i].html);s.push("</li> ")}else{s.push(' <li class="menu_item">');s.push(items[i].html);s.push("</li> ")}}s.push(" ")}s.push(" </ul></div>")}return s.join("")}catch(e){if(typeof window!=="undefined"&&window._jstFailuresRaise){throw e}alert('template error in "modules/dropdown.jst":\n\n'+e)}return""};tagged.namespace("modules.dropDown");tagged.modules.dropDown={menus:{},createMenu:function(a){if(a&&a.menuAnchor&&a.items&&a.menuId){var b=a.menuAnchor=$(a.menuAnchor).first();if(!b.length){return}var c=this.menus[a.menuId];if(c){this.destroyMenu(a.menuId)}this.menus[a.menuId]=new this.Menu(a,this);return this.menus[a.menuId]}return false},destroyMenu:function(a){if(a in this.menus){this.menus[a].menuEl.remove();delete this.menus[a]}},closeAllMenus:function(a){for(id in this.menus){if(a&&(id==a)){continue}this.menus[id].hide()}},Menu:function(a,b){this.manager=b;this.menuId=a.menuId;this.menuClass=a.menuClass;this.menuAnchor=a.menuAnchor;this.parent=a.parent;this.offsets=$.extend({top:0,left:0},a.offsets);this.positionMethod=a.positionMethod||"position";this.toggleOnClick=(typeof(a.toggleOnClick)=="boolean")?a.toggleOnClick:false;this.menuEl=null;this.isShowing=false;this.closeTimer=false;this.justification=a.justification||"left";this.closeTime=a.closeTime||50;this.stopPropagation=a.stopPropagation||false;this.preventDefault=a.preventDefault||false;this.mockHover=a.mockHover||false;this.mockHoverTextColor=a.mockHoverTextColor||"";this.minWidth=a.minWidth||false;this.hoverColorScheme=a.hoverColorScheme||false;this.fontSize=a.fontSize||false;this.renderMenu(a.items)}};tagged.modules.dropDown.Menu.prototype={renderMenu:function(b){this.menuEl=$(tagged.jst.modules.dropdown.render({items:b}));if(this.minWidth){this.menuEl.css("width","auto");this.menuEl.css("min-width",this.minWidth+"px")}if(this.hoverColorScheme){var a=this;this.menuEl.find("li").on("mouseenter",function(){var d=$(this);if(d.attr("class")==="separator_item"){return}if(d.hasClass("title_item")){return}d.addClass("custom");d.css("background-color",a.hoverColorScheme.bg);d.children().css("color",a.hoverColorScheme.text)});this.menuEl.find("li").on("mouseleave",function(){var d=$(this);d.css("background-color","");d.children().css("color","")})}if(this.fontSize){this.menuEl.find("li").css("font-size",this.fontSize+"px")}var c=this.parent||($("#inner_container").length?$("#inner_container"):$(document.body));c.append(this.menuEl);this.attachHandlers(b)},attachHandlers:function(c){if(this.toggleOnClick){this.menuAnchor.click($.proxy(this.toggleMenu,this));$(document.body).click($.proxy(this.manager.closeAllMenus,this.manager))}else{this.menuEl.hover($.proxy(function(g){window.clearTimeout(this.closeTimer)},this),$.proxy(function(g){window.clearTimeout(this.closeTimer);this.closeTimer=window.setTimeout($.proxy(function(){this.hide()},this),this.closeTime)},this));this.menuAnchor.hover($.proxy(function(g){window.clearTimeout(this.closeTimer);if(!this.isShowing){this.show()}},this),$.proxy(function(g){window.clearTimeout(this.closeTimer);this.closeTimer=window.setTimeout($.proxy(function(){this.hide()},this),this.closeTime)},this))}var f=this;var e=function(i,g,h){i.click(function(j){f.hide();g(j,this,f.menuId,h)})};var b=$(".menu_list li",this.menuEl);if(b.length===c.length){var a=null;for(var d=0;d<c.length;d++){a=c[d].cb;args=c[d].args;if(a){e(b.eq(d),a,args)}}}},positionMenu:function(){var a=(this.positionMethod=="offset")?this.menuAnchor.offset():this.menuAnchor.position();var c=a.top+this.menuAnchor.outerHeight()+this.offsets.top;var b;if(this.justification==="left"){b=a.left+this.offsets.left}else{if(this.justification==="right"){b=a.left-(this.menuEl.outerWidth()-this.menuAnchor.outerWidth())}}this.menuEl.css({top:c+"px",left:b+"px","min-width":this.minWidth||this.menuAnchor.outerWidth()});this.menuEl.addClass(this.menuClass)},toggleMenu:function(a){if(this.stopPropagation){a.stopPropagation()}if(this.preventDefault){a.preventDefault()}this.manager.closeAllMenus(this.menuId);if(this.isShowing){this.hide()}else{this.show()}},show:function(){window.clearTimeout(this.closeTimer);this.positionMenu();this.menuEl.show();this.menuAnchor.addClass("active");this.isShowing=true;if(this.mockHover){this.menuAnchor.css({backgroundColor:this.mockHover,color:this.mockHoverTextColor})}},hide:function(){this.menuEl.hide();this.menuAnchor.removeClass("active");this.isShowing=false;if(this.mockHover){this.menuAnchor.css({backgroundColor:"",color:""})}}};Nav.Views.Menu=Backbone.View.extend({initialize:function(){this.additionalClass=this.options.additionalClass},render:function(b){var a=(this.options.id==="#nav_alerts"||this.options.id==="#nav_account")?"right":"left";var c=tagged.modules.dropDown.createMenu({menuAnchor:$(this.options.id),items:b,menuId:this.options.id,positionMethod:"offset",mockHover:"#686868",mockHoverTextColor:"#FFF",justification:a,menuClass:"dark_text large_text main_nav "+this.additionalClass,minWidth:190,fontSize:14,hoverColorScheme:{bg:"#686868",text:"#fff"}});$("."+this.options.page_id).addClass("active")},triggerLinkClick:function(a){window.location.href=$(a.target).find("a").attr("href")}});Nav.Views.Visibility=Backbone.View.extend({el:$("#status_icon")[0],setStatus:function(c){var f=c.e;var b=c.scope;var g=c.menuId;var a=c.status;var d={method:"tagged.header.changeVisibility",visible:a!=1,callback:{fn:this.setStatusIcon,scope:this,args:a}};TAGGED.api.call(d)},setStatusIcon:function(b,a){tagged.currentUserStatus=a;if(a==1){this.$el.removeClass("tag-icon-status-green").addClass("tag-icon-status-gray")}else{this.$el.removeClass("tag-icon-status-gray").addClass("tag-icon-status-green")}}});Nav.Views.Base=Backbone.View.extend({initialize:function(a){this.alerts=new Nav.Collections.Alerts();this.visibility=new Nav.Views.Visibility();this.strings=a.strings;this.data=a.data;this.gold_balance=a.commify(a.data.gold_balance);this.realtime=a.realtime;this.stringUtil=a.stringUtil;this.ClickLogger=a.ClickLogger;this.alertsPlaceholder=a.data.nav.alertsPlaceholder;this.presence_green=a.static_url+"/im/im/icon_presence_green_small2.png";this.presence_grey=a.static_url+"/im/im/icon_presence_grey_small2.png";this.petsAlertCount=a.data.petsAlertCount;this.currentUserStatus=a.currentUserStatus;var b=["people","more","account","alerts"];_.each(b,_.bind(function(c){this[c+"Menu"]=new Nav.Views.Menu({page_id:this.data.page_id,id:"#nav_"+c,additionalClass:c+"_menu"})},this));this.links=new Nav.Collections.Links([],{base:this,meetme_enabled:a.data.meetme_enabled,secure_url:a.secure_url,video_url:a.video_url,chat_support_url:a.data.chat_support_url,phone_support_url:a.data.phone_support_url,valid_age_for_groups:a.data.valid_age_for_groups});this.links.more.splice(6,0,{isSeparator:true});this.links.account.splice(2,0,{isSeparator:true});this.links.account.splice(6,0,{isSeparator:true});this.peopleMenu.render(this.links.people);this.moreMenu.render(this.links.more);this.accountMenu.render(this.links.account);this.setBadgeValue("#nav_pets .badge-container",this.petsAlertCount);if(!a.data.user_id){return}this.visibility.setStatus({status:this.currentUserStatus});tagged.messages_delta.count.init({nav:this});this.updateAlerts();this.realtime.register("alerts_update",{cb:this.updateAlerts,scope:this})},triggerLinkClick:function(a){window.location.href=$(a.target).find("a").attr("href")},updateAlerts:function(){this.alerts.on("reset",_.bind(this.renderAlerts,this));this.alerts.on("showLightbox",_.bind(this.renderLightbox,this));this.alerts.fetch()},renderAlerts:function(c){var d=0;this.alertsForMenu=[];var b=this;c.each(function(h){var f=$('<div class="menu_item"></div>');f.attr("id","alert_for_"+h.get("id"));var g='<div class="alerts_icon '+h.get("id")+'"><i class="'+h.get("iconClass")+'"></i></div>';var j={uri:h.get("link"),paramKey:"dataSource",paramVal:h.get("id")};var e=b.stringUtil.updateQueryStringParameter(j);var i={uri:e,paramKey:"ll",paramVal:"alert_dropdown"};e=b.stringUtil.updateQueryStringParameter(i);f.append(g+'<a href="'+e+'">'+h.get("label")+"</a>");b.alertsForMenu.push({html:f.html(),cb:b.alertsMenu.triggerLinkClick});if($.inArray(h.get("id"),["pets","pets_play"])>=0&&h.get("value")){d+=parseInt(h.get("value"),10)}});this.setBadgeValue("#nav_pets .badge-container",d);this.setBadgeValue("#nav_alerts .badge-container",c.length);if(c.length>0){this.setBadgeValue("#alert_count",c.length);this.alertsMenu.render(this.alertsForMenu);var a=new this.ClickLogger({rootEl:$("#nav_alerts"),app:"alerts",location:"dropdown"})}else{this.alertsMenu.render([{html:this.alertsPlaceholder,isTitle:true}])}},renderLightbox:function(a){if(name!=="promo_gold_reup"){return}tagged.require("alert_lightbox").done(function(){var b=new tagged.promotions.BuyPrompt().render(a[name]).show()})},setBadgeValue:function(b,d,a){var e=$(b);if(!d){e.hide()}else{if(typeof d==="number"){a=a||99;if(d>a){d=a+"+"}}var c=e.find(".badge-value");if(!c[0]){c=e}c.text(d);e.show()}}});$(function(){var a=new Nav.Views.Base({strings:tagged.nav.strings,data:tagged.data,realtime:tagged.realtime,stringUtil:tagged.util.string,secure_url:tagged.secure_url,video_url:tagged.video_url,static_url:tagged.static_uri,currentUserStatus:tagged.currentUserStatus,commify:tagged.util.format.commify,ClickLogger:ClickLogger})});tagged.loadStringsDirect({"tagged.nav.strings":{people:{"0":"Friends","1":"Meet Me","2":"Browse","3":"Search"},games:{"0":"Pets","1":"Cafe","2":"Mafia"},more:{"0":"Photos","1":"Gifts","2":"Tags","3":"Comments","4":"Luv","5":"Wink","6":"Games","7":"Groups","8":"Video","9":"Notifications","10":"Birthdays"},account:{"0":"gold_amount","1":"Get More Gold","2":"My Online Status","3":"Available","4":"Invisible","5":"Settings","6":"Help","7":"Contact Us","8":"Chat Support","9":"Call Support","10":"Signout"},util:{meetme_down:"Sorry Meet Me is down for maintenance. Please visit again soon."}}});