var IM=IM||function(){var version="1311.07282012.1",_xp1_o="37257",_xp1_uuid=getcookie("xp1_uid"),_xp1_random=Math.floor(Math.random()*99),_xp1_qsNameValuePairs={ssv_callback:"IM.setPlacements"},_cvp_qsNameValuePairs={cvp_callback:"IM.setCVPPlacements"},wwwHost=window.location.hostname,testSite=false,maxIMTime=1500,maxIMTimeFO=2000,turnOffIM=false,g_timeout=null,g_Displayed=false,g_fcl_uuid=getcookie("fcl_uuid"),flashMovie=null,isFlashReady=false,containerReady=false,defs={sig_svc_type:{none:0,release:1,indirect:2,direct:3,adult:4}};if(wwwHost!=="www.fedex.com"){testSite=true}function setPlacements(placements){clearTimeout(g_timeout);if(g_Displayed){return}try{for(var p in placements){var placement=document.getElementById(p);if(!placement){throw {errCode:"3",errDesc:"Placement div not found on page",xp1Received:placements[p].creativeID}}if(!_xp1_uuid){if(p==="placement_1"){_xp1_uuid=placements[p].xp1_id}}var creative=xp1_bagMapping[placements[p].creativeID];if(!creative){throw {errCode:"2",errDesc:"Mismatch - Creative not found in bm file",xp1Received:placements[p].creativeID}}if(placements[p].clickURL){placement.innerHTML="<a href='"+placements[p].clickURL+creative.url+getParamSeparator(creative.url)+"INTCMP=BAL-"+placements[p].creativeID+"'><img border='0' src='"+creative.image+"'/></a>"}else{placement.innerHTML="<a href='"+creative.url+getParamSeparator(creative.url)+"INTCMP=BAL-"+placements[p].creativeID+"'><img border='0' src='"+creative.image+"'/></a>"}try{scDsp("BAL-"+placements[p].creativeID)}catch(e){}}g_Displayed=true;if(_xp1_uuid){checkCookie(_xp1_uuid)}}catch(err){if(placements!==xp1_failoverPlacements){setPlacements(xp1_failoverPlacements)}sendFailoverDetails(err,xp1_failoverPlacements)}}function getParamSeparator(baseURL){if(baseURL.indexOf("?")>-1){return"&"}else{return"?"}}function isUsHomePage(){var spath=getMetaTagValue("wssmlc");return(spath.indexOf("US/Home")>-1)}function loadIMScript(type,tag){if(!turnOffIM){var script_url="";var script_id="";var imid="";var runme=false;var isHome=isUsHomePage();if(isHome&&amILoggedIn()){runme=true;script_url="https://"+requestCVPDomain()+"/sonarService?data="+createCVPString();imid="cvpScript"}else{if(!isHome){runme=true;script_url=getProtocol()+"://"+requestDomain()+"/meta"+createQueryString(type,tag);imid="xp1Script"}else{var sagwrap=document.getElementById("placement_1");if(sagwrap){sagwrap.parentNode.parentNode.style.display="none"}}}if(runme){script_id=imid+type;loadScript(script_id,script_url);if(type==="D"){g_timeout=setTimeout(function(event){var scripts=document.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){if(scripts[i].id===script_id){if(g_Displayed){return}var head=document.getElementsByTagName("HEAD").item(0);head.removeChild(scripts[i]);setPlacements(xp1_failoverPlacements);sendFailoverDetails({errCode:"3",errDesc:"Got response but timed out before we could display"},xp1_failoverPlacements);var imgFail=new Image();imgFail.src="/images/ascend/shared/headers/corp_logo.gif?xp1_response_failure";return}}sendFailoverDetails({errCode:"1",errDesc:"Timed out before we got a response"},xp1_failoverPlacements)},maxIMTime)}}}else{setPlacements(xp1_failoverPlacements)}}function loadChatScript(){loadScript("atgsvcsScript","//static.atgsvcs.com/js/atgsvcs.js",function(){if(ATGSvcs!==null){ATGSvcs.setUOID(200106298424)}})}function getSSVParameters(){var ssvParameters="";var ssvIndex=0;var matches=window.location.href.match(/ssv_[^\=]*\=[^\&]*/gi);if(matches){for(ssvIndex=0;ssvIndex<matches.length;ssvIndex++){ssvParameters+=matches[ssvIndex]+"&"}}return ssvParameters}function getReferrer(){var domain=document.referrer.match(/\/\/([^\/]+)\/?/);var referringDomain="";if(domain!==null&&domain.length>1){domain=domain[1].split(".");referringDomain=domain.pop();if(domain.length>0){referringDomain=domain.pop()+"."+referringDomain}}return referringDomain}function getXP1_ConversionPageName(){var sname=getMetaTagValue("wsstitle");sname=sname.toLowerCase();sname=sname.replace(/^\+/g,"");sname=sname.replace(/\+/g," ");var spath=getMetaTagValue("wssmlc");spath=spath.toLowerCase();spath=spath.substring(6);spath=spath.replace(/\/+/g," ");if(spath.indexOf("inet")>-1){sname="inet label "+sname}else{if(spath.indexOf("supplies")>-1){sname="supplies "+sname}else{if(spath.indexOf("wgrt")>-1){sname="rating "+sname}else{if(spath.indexOf("pickup")>-1){sname="pickup confirmation"}else{if(spath.indexOf("oadr")>-1){sname="oadr confirmation"}else{if(spath.indexOf("gfbo")>-1){sname="global fedex billing online"}else{if(spath.indexOf("detail tracking")>-1){sname="tracking results"}}}}}}}sname=sname.replace(/\ /g,"-");return sname}function createQueryString(type,tag){var qs="?_o="+_xp1_o+"&_t=";var _t=null;if(type==="B"){_t="behavior"}else{if(type==="T"){_t=getXP1_ConversionPageName()}else{_t=xp1_t}}qs+=_t;if(type==="B"){qs+="&ssv_013="+getXP1_ConversionPageName()}qs+="&ssv_015="+g_fcl_uuid;if(type==="D"){for(var n in _xp1_qsNameValuePairs){qs+="&"+n+"="+_xp1_qsNameValuePairs[n]}qs+="&ssv_random="+_xp1_random+"&ssv_012="+getReferrer()+"&"+getSSVParameters()}return qs}function sendFailoverDetails(details,failoverPlacements){var script_url=getProtocol()+"://"+requestDomain()+"/meta"+createFailoverQueryString(details,failoverPlacements);var imid="xp1Fail";try{loadScript(imid,script_url)}catch(err){}}function createFailoverQueryString(details,failoverPlacements){var failedPlacements="";for(var p in failoverPlacements){if(p){failedPlacements=failoverPlacements[p].creativeID}if(!failedPlacements){break}}var qs="?_o="+_xp1_o;qs+="&_t=failover";qs+="&creativeID=";qs+=(failedPlacements!==null&&failedPlacements!==undefined)?failedPlacements:"";qs+="&ssv_015=";qs+=(g_fcl_uuid!==null&&g_fcl_uuid!==undefined)?g_fcl_uuid:"";qs+="&ssv_072=";qs+=(details.xp1Received!==null&&details.xp1Received!==undefined)?details.xp1Received:"";qs+="&ssv_073=";qs+=(details.errCode!==null&&details.errCode!==undefined)?details.errCode:"3";qs+="&ssv_074=";qs+=(xp1_t!==null&&xp1_t!==undefined)?xp1_t:"";return qs}function createCVPString(){var cvpQs='{"Sonar_request":{"guestID":"'+g_fcl_uuid+'","guestType":"IM","destination":"FEDEX.COM","touchpoint":"FDXPR","location":"FHP","brand":"","style":"fdx.com-sonar","priorityOnlyFlag":"","productionFlag":"","externalData":"","_o":"37257","_t":"opCo","ssv_012":"fedex.com","ssv_011":"'+_xp1_random+'","ssv_015":"';cvpQs+=g_fcl_uuid;cvpQs+='","ssv_016":"'+getUrlParam("ssv_016")+'",';cvpQs+='"xp_uuid":"';cvpQs+=_xp1_uuid;cvpQs+='"}}';for(var n in _cvp_qsNameValuePairs){cvpQs+="&"+n+"="+_cvp_qsNameValuePairs[n]}return cvpQs}function requestCVPDomain(){if(testSite){return"mnfxuat.epsilon.com/sonar"}else{return"sonar.fedex.com"}}function setCVPPlacements(Sonar_response_obj){var bagCode=null,sagCode=null,bagClickThrURL=null,sagClickThrURL=null;clearTimeout(g_timeout);try{if(!Sonar_response_obj){throw"Got empty sonar response"}var statusCode=Sonar_response_obj.Sonar_response.status;if(!statusCode){throw"No status code in sonar response"}if(statusCode==="00"||statusCode==="01"||statusCode==="02"||statusCode==="99"){var i="";if(statusCode==="00"){bagCode=Sonar_response_obj.Sonar_response.trackingCodes.bagCode;bagClickThrURL=Sonar_response_obj.Sonar_response.trackingCodes.bagClickThrURL;if(!bagCode){throw"Bag Code Not Found in Sonar Response"}if(!bagClickThrURL){throw"Bag Click Url Not Found in Sonar Response"}}else{if(statusCode==="02"){bagCode="failover_us";bagClickThrURL=""}}if(statusCode==="00"||statusCode==="02"){var myZones=Sonar_response_obj.Sonar_response.zones;if(!myZones){throw"No Zones"}for(var zone in myZones){if(!zone){throw"Zone Not Found"}var code=myZones[zone].code;if(!code){throw"Code not found"}if(code==="RC"){var myMessages=myZones[zone].messages;if(!myMessages){throw"No Messages"}for(var msg in myMessages){if(!msg){throw"No message"}var placement=document.getElementById("placement_cvp");if(placement){placement.innerHTML=myMessages[msg].message}}}if(code==="FC"){var myMessages=myZones[zone].messages;if(!myMessages){throw"No Messages"}for(var msg in myMessages){if(!msg){throw"No message"}var placement=document.getElementById("placement_1");if(placement){placement.innerHTML=myMessages[msg].message}}}}}else{if(statusCode==="01"){bagCode=Sonar_response_obj.Sonar_response.trackingCodes.bagCode;sagCode=Sonar_response_obj.Sonar_response.trackingCodes.sagCode;bagClickThrURL=Sonar_response_obj.Sonar_response.trackingCodes.bagClickThrURL;sagClickThrURL=Sonar_response_obj.Sonar_response.trackingCodes.sagClickThrURL;if(!bagCode){throw"bag Code Not Found"}if(!sagCode){throw"sag Code Not Found"}if(!bagClickThrURL){throw"bag URL Not Found"}if(!sagClickThrURL){throw"sag URL Not Found"}var gotMatch=false;for(var p in xp1_bagMapping){if(p===sagCode){gotMatch=true;var placement1=document.getElementById("placement_1");placement1.innerHTML="<a href='"+sagClickThrURL+xp1_bagMapping[p].url+getParamSeparator(xp1_bagMapping[p].url)+"INTCMP=BAL-"+p+"'><img border='0' src='"+xp1_bagMapping[p].image+"'/></a>";try{scDsp("BAL-"+p)}catch(e){}break}}if(!gotMatch){throw {errCode:"2",errDesc:"Mismatch - Creative not found in bm file",xp1Received:sagCode}}}else{if(statusCode==="99"){throw"Error 99 in response from Epsilon - failing over"}}}}else{throw"Unknown status code - failing over"}}catch(err){setPlacements(xp1_failoverPlacements);sendFailoverDetails(err,xp1_failoverPlacements)}var bagSetInterval=setInterval(setBagPlacement,100);var bagTimeout=setTimeout(function(){clearInterval(bagSetInterval)},3000);function setBagPlacement(){try{if(isFlashReady){flashMovie=getFlashMovieObject("bagShell");flashMovie.goCVP(bagCode);flashMovie.linkCVP(bagClickThrURL);clearInterval(bagSetInterval)}}catch(e){}}}function requestDomain(){if(testSite){return"stg.xp1.ru4.com"}else{return"s.xp1.ru4.com"}}function getProtocol(){var proto=window.location.protocol;if(proto.toLowerCase().indexOf("https")>-1){return"https"}return"http"}function log(tag,view){var stype="B";try{if(view!=="P"){stype="T"}}catch(e){}loadIMScript(stype,tag)}function amILoggedIn(){return !Boolean(g_fcl_uuid===""||g_fcl_uuid===";")}function setIM_Props(obj,objName){try{if(objName){if(objName==="label_data"){logPurchase(obj)}else{if(objName==="wtrk_decisioning"){var dex=obj.dex_code;var sigsvc=obj.sig_svc_type;$("#box1").before('<div id="placement_chris"></div>');if(dex!==null&&dex!=="DL"){if(sigsvc!==null&&(sigsvc==3||sigsvc==4)){$("#placement_chris").load("/templates/components/includes/us/decision/en/trk_im_msg_sigsvc.html")}else{if(dex==="DE"){$("#placement_chris").load("/templates/components/includes/us/decision/en/trk_im_msg_exception.html")}else{if(false){$("#placement_chris").load("/templates/components/includes/us/decision/en/trk_im_msg_hal.html")}else{$("#placement_chris").load("/templates/components/includes/us/decision/en/trk_im_msg_notifications.html")}}}}}}}}catch(e){}}function checkPlacement(element,failover,tmname){tmname=setTimeout(function(event){var p=document.getElementById(element);if(!p){g_Displayed=false;clearTimeout(tmname);setPlacements(failover);var imgFail=new Image();imgFail.src="/images/ascend/shared/headers/corp_logo.gif?testtarget_response_failure"}},maxIMTimeFO)}function getMetaTagValue(metaName){var sreturn="";var m=document.getElementsByTagName("meta");for(var i in m){if(m[i].name===metaName){sreturn=m[i].content;break}}return sreturn}function getUrlParam(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(window.location.href);if(results===null){return""}else{return results[1]}}function setCookie(cookie_name,value,exdays){if(value!==null){var exdate=new Date();exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+((exdays===null)?"":"; expires="+exdate.toUTCString());document.cookie=cookie_name+"="+c_value}}function getcookie(cookiename){if(document.cookie.length>0){c_start=document.cookie.indexOf(cookiename+"=");if(c_start!==-1){c_start=c_start+cookiename.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end===-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""}function getFlashMovieObject(bagShell){if(navigator.appName.indexOf("Microsoft")!==-1){return window[bagShell]}else{return document[bagShell]}}function setIsContainerReady(){containerReady=true}function getIsContainerReady(){return true}function setflashIsReady(value){isFlashReady=value}function addWindowOnLoadEvent(func){var oldonload=window.onload;if(typeof window.onload!=="function"){window.onload=func}else{window.onload=function(){if(oldonload){oldonload()}func()}}}(function(){var wss_mlc=getMetaTagValue("wssmlc"),wss_title=getMetaTagValue("wsstitle"),jsRootPath=(testSite==true)?"/templates/components/javascript":"//images.fedex.com/templates/components/javascript",bmFilePath="";if(wss_mlc.indexOf("US/Home")>-1){loadScript("loginbm",jsRootPath+"/us/en/bagmappings/usHome_bm.js")}else{if(wss_title.indexOf("/newcustomer")>-1){if(wss_mlc.indexOf("/br/pt/fedex/")>-1){bmFilePath="/bagmappings/lac/port/welcomecenter_br_pt_bm.js"}else{if(wss_mlc.indexOf("/ar/es/fedex/")>-1){bmFilePath="/bagmappings/lac/espanol/welcomecenter_ar_es_bm.js"}else{if(wss_mlc.indexOf("/co/es/fedex/")>-1){bmFilePath="/bagmappings/lac/espanol/welcomecenter_co_es_bm.js"}else{if(wss_mlc.indexOf("/mx/es/fedex/")>-1){bmFilePath="/bagmappings/lac/espanol/welcomecenter_mx_es_bm.js"}else{if(wss_mlc.indexOf("/pr/es/fedex/")>-1){bmFilePath="/bagmappings/lac/espanol/welcomecenter_pr_es_bm.js"}}}}}if(bmFilePath!==""){loadScript("lac_welcome_bm",jsRootPath+bmFilePath)}}}})();(function isEU_Disabled(){if(!turnOffIM){try{if(typeof fdx_is_eu!=="undefined"&&typeof fdx_is_disabled!=="undefined"){if(fdx_is_eu&&fdx_is_disabled){turnOffIM=Boolean(fdx_is_eu&&fdx_is_disabled)}}}catch(err){}}})();return{defs:defs,setPlacements:setPlacements,setCVPPlacements:setCVPPlacements,setIM_Props:setIM_Props,getMetaTagValue:getMetaTagValue,loadIMScript:loadIMScript,log:log,setflashIsReady:setflashIsReady,getcookie:getcookie,setCookie:setCookie,getIsContainerReady:getIsContainerReady,setIsContainerReady:setIsContainerReady}}();function loadScript(id,url,func){var oScript=document.createElement("script");oScript.language="javascript";oScript.type="text/javascript";oScript.charset="utf-8";oScript.async="true";oScript.id=id;oScript.src=url;if(typeof func!=="undefined"&&typeof func==="function"){oScript.onloadDone=false;oScript.onload=function(){if(!oScript.onloadDone){oScript.onloadDone=true;func()}};oScript.onreadystatechange=function(){if(("loaded"===oScript.readyState||"complete"===oScript.readyState)&&!oScript.onloadDone){oScript.onloadDone=true;func()}}}var oHead=document.getElementsByTagName("HEAD").item(0);oHead.appendChild(oScript)}function isContainerReady(){return true}function flashReady(value){IM.setflashIsReady(value)}function checkCookie(value){var xp1_uuid=IM.getcookie("xp1_uid");if(!xp1_uuid){IM.setCookie("xp1_uid",value,90)}};