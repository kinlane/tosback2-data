window.BrightTag=function(b){function m(a,b){return Object.prototype.toString.call(a)==="[object "+b+"]"}if(b)return bt_log("tried to load tag.js again"),b;var b={pushIfDefined:function(a,b,d){a&&(a.constructor==Array&&null!=b)&&a.push(d||b)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},Escaper:{cookie:function(a){return!q.isString(a)?a:a.replace(/%/g,"%25").replace(/#/g,"%23").replace(/&/g,"%26").replace(/'/g,"%27").replace(/;/g,"%3B").replace(/</g,"%3C").replace(/>/g,"%3E")},
javascript:function(a){return!q.isString(a)?a:a.replace(/\\/g,"\\\\").replace(/'/g,"\\x27").replace(/"/g,"\\x22").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}},Random:{integer:function(a){return Math.floor(Math.random()*(a||1E8))}},defaultConfig:function(){return{loadOnly:!1,window:window,document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,data:{},errorManager:new b.ErrorManager(new b.HTTP.Cookie(document))}}},t=b.eval=function(a,
b){try{return eval.call(void 0,a)}catch(d){b&&b(d)}},o=b.extend=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return a},q=b.Types={isString:function(a){return m(a,"String")},isArray:function(a){return m(a,"Array")},isNumber:function(a){return m(a,"Number")},isFunction:function(a){return m(a,"Function")},isObject:function(a){return null===a||void 0===a?!1:m(a,"Object")}},p=b.each=function(a,b){if(a)if(q.isArray(a)||a.length)for(var d=0,e=a.length;d<e;d++)b(a[d],d);else if(q.isObject(a))for(d in a)a.hasOwnProperty(d)&&
b(d,a[d])};b.Blab={};b.Blab.Engine=function(a){function b(){l=!0;n=r.length;h("engine:off")}function d(){l=!1;y=0;(r[n++]||b)()}function e(){h("block:finish");d()}function c(c){return function(){var f=!1,g=a.createElement("script");g.onload=g.onreadystatechange=function(){var a;if(!(a=f)){a:{switch(g.readyState){case void 0:case "loaded":case "complete":a=!0;break a}a=!1}a=!a}a||(f=!0,e())};g.onerror=function(){h("block:error",{type:"script",exception:"Problem loading "+c});f||e()};g.src=c;h("block:start",
c);var b=a.getElementsByTagName("script")[0];b.parentNode.insertBefore(g,b)}}function f(c){return function(){try{h("block:start",c),c.constructor==String?a.defaultView?a.defaultView.eval.call(void 0,c):a.parentWindow?a.parentWindow.execScript(c):h("block:error",{type:"wait",exception:"Could not evaluate wait block ["+c+"]"}):c()}catch(f){h("block:error",{type:"wait",exception:f})}finally{e()}}}function g(a){r.push(a);l&&d();return k}function j(a){r.splice(n+y++,0,a);return k}function h(a){var c=Array.prototype.slice.call(arguments,
1);p(s,function(f){var g=[k].concat(c);(f[a]||v).apply(null,g)})}var k=this,v=function(){},s=[],l=!1,x={},r=[],n=0,y=0;k.run=function(){h("engine:on");d()};k.options=function(a){o(x,a);return k};k.option=function(a){return x[a]};k.script=function(a){return g(c(a))};k.wait=function(a){return g(f(a))};k.preemptScript=function(a){return j(c(a))};k.preemptWait=function(a){return j(f(a))};k.listen=function(a){s.push(a);(a["engine:listen"]||v).apply(null,[k]);return k}};b.Blab.Group=function(){function a(a){c.push(a)}
function b(a){a.run()}function d(){var a=c[f++];a?a.listen(g).run():e.doNotQueue()}var e=this,c=[],f=0,g={"engine:off":function(){d()}};e.doNotQueue=function(){a=b};e.push=function(c){a(c);return c};e.run=function(){d()};e.applyListener=function(a){for(var g=f,b=c.length;g<b;g++)c[g].listen(a)}};b.Blab.Manager=function(a){function i(f){var g=new d.Engine(a);p(c,function(a){g.listen(a)});return(e[f]||(e[f]=new d.Group)).push(g)}var d=b.Blab,e={undefined:new d.Group},c=[];e[void 0].doNotQueue();this.addGlobalListener=
function(a){c.push(a);p(e,function(c){e[c].applyListener(a)})};this.group=function(a){return i(a)};this.listen=function(){return i().listen.apply(null,arguments)};this.script=function(){return i().script.apply(null,arguments)};this.wait=function(){return i().wait.apply(null,arguments)};this.run=function(a){(e[a]||(e[a]=new d.Group)).run()};this.setOptions=function(){return i()}};var u,z=[],A=function(a){u.push(a)};b.Blab.SwapwriteListener=function(a){function b(a){a.src&&e.preemptScript(a.src);a.innerHTML&&
e.preemptWait(a.innerHTML)}function d(c){try{a.body.appendChild(c.cloneNode(!0))}catch(g){bt_log("error appending content to body: "+g)}}var e,c=a.createElement("div");this["block:start"]=function(){var c=a;z.push([u,c.write,c.writeln]);u=[];c.write=c.writeln=A};this["block:finish"]=function(){try{if(0!=u.length){c.innerHTML="<br/>"+u.join("");for(var f=c.childNodes||[],g=1,j=f.length;g<j;g++)("SCRIPT"==f[g].tagName?b:d)(f[g])}}finally{f=a,g=z.pop(),u=g[0],f.write=g[1],f.writeln=g[2]}};this["engine:listen"]=
function(a){e=a}};b.Blab.GlobalSwapwriteListener=function(a){var i=b.Blab;this["engine:listen"]=function(b){b.listen(new i.SwapwriteListener(a))}};b.EventsManager=function(){function a(){}function i(a,c,h){f(a,c,function(){(!h||h())&&b.EventListenerOverride(a,c)})}function d(a){var c=a.readyState;if("loading"==c)return!1;if("complete"==c)return!0;if(a.addEventListener)return"interactive"==c;a:{a=a.documentElement.doScroll||function(){throw"No doScroll";};try{a("left")}catch(b){a=!1;break a}a=!0}return a}
function e(a,c,b){var f=this;setTimeout(function(){a()?c.call(f):e(a,c,b)},b)}var c=this,f=c.listen=function(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&a.attachEvent("on"+c,b)};c.domReady=function(a,c){d(a)?c.call(this):a.addEventListener?f(a,"DOMContentLoaded",c):e(function(){return d(a)},c,1)};c.enablePageReadyOverrides=function(f,d){c.enablePageReadyOverrides=a;"complete"==d.readyState?b.EventListenerOverride(f,"load"):i(f,"load");if(d.addEventListener){var h=d.readyState;
"complete"==h||"interactive"==h?b.EventListenerOverride(d,"DOMContentLoaded"):i(d,"DOMContentLoaded")}}};b.EventListenerOverride=function(a,b){function d(a){var c=this;setTimeout(function(){try{a.call(c)}catch(d){bt_log("error overriding "+b+" event: "+d)}},0)}var e=a.addEventListener?"addEventListener":"attachEvent",c=a[e];a[e]=function(f,g,j){if("function"==typeof g)if(f==b||f=="on"+b)d(g);else try{"addEventListener"==e?c.call(a,f,g,j):c(f,g)}catch(h){bt_log("error proxying "+f+" event: "+h)}}};
b.Events=new b.EventsManager;b.EventBindingManager=function(a,i){function d(a,c){p(c,function(c,b){a[a.type+"."+c]=b});i.push(a)}function e(a){function b(a){var c=this,d=[];c.appendData=function(a){d.push(function(c){c.appendData(a)});return c};c.appendJs=function(a){d.push(function(c){c.appendJs(a)});return c};c.postProcess=function(a){p(d,function(c){c(a)})};c.tagId=a;c.execute=f.execute;c.fire=f.fire;c.evaluate=f.evaluate}var f=this,e=[],l=[],j="true";f.execute=function(c,b){var k=o({eventName:a},
b||{});if(q.isFunction(c))e.push(o(c,k));else if(q.isString(c))try{var l=g.functionWithAccess(["eventObject","eventData"],c);e.push(o(l,k))}catch(j){d({type:"evparse",message:"event handler parsing: "+j,tagId:k.tagId||-1},{eventName:a})}else bt_log("when.execute: unknown action: "+c);return f};f.evaluate=function(a){j=a;return f};f.fire=function(a){a=new b(a);l.push(a);return a};f.handler=function(a,b){var f=j;t(j,function(a){bt_log("Invalid post-event conditional fire expression: "+f+", exception = "+
a)})&&(c.executeActions(e,a,b),c.fireTags(l))}}var c={},f={},g=b.jQueryLoader(a,"BrightTag.jQuery");c.Binder=function(a,c){var e=this,j=[],l=c||{};e.data=function(a,c){j.push({name:a,dbe:c});return e};e.bindData=function(c,f,e){p(j,function(k){try{b.instance.data(k.name,g.functionWithAccess(["eventObject","eventData"],"return "+k.dbe+";").call(c,f,e))}catch(j){d({type:"evdbe",message:j.toString(),pageId:l.pageId||-1},{name:k.name,eventName:a})}})};e.handler=function(c){var b=f[a];if(b){var d=Array.prototype.slice.call(arguments,
1);e.bindData(c.target,c,d);b.handler(c,d)}}};var j=/^direct\//i;c.bind=function(a,b,f,d){var e=new c.Binder(a,d);g.ensureJQuery(function(){var a=g.getJQuery()(b);a.live&&b.constructor===String&&!j.test(f)?a.live(f,e.handler):a.bind(f.split(j).pop(),e.handler)});return e};c.when=function(a){return f[a]||(f[a]=new e(a))};c.executeActions=function(a,c,b){p(a,function(a){try{a.call(c.target,c,b)}catch(f){d({type:"evwait",message:"event handler running: "+f.toString(),tagId:a.tagId||-1},{eventName:a.eventName})}})};
c.fireTags=function(a){if(0<a.length){var c=b.instance.serverURL();p(a,function(a){c.cf(a.tagId);a.postProcess(c)});b.Blab.script(c.asString())}};return c};b.HTTP={};b.HTTP.Cookie=function(a){function i(a){for(var b,d,a=a.split(/; ?/),j=0,h=a.length;j<h;j++){d=a[j];b=d.indexOf("=");var k=e,i=d.slice(0,b);b=d.slice(b+1);b=unescape(b);k[i]=b}}var d=this,e={};d.get=function(a){return e[a]};d.remove=function(a,b){d.set(a,"",o(b||{},{expires:0}))};d.set=function(c,d,e){if(c){e=e||{};c=[c+"="+b.Escaper.cookie(d||
"")];if((d=e.expires)||0===d)q.isNumber(d)&&(d=(new Date(d)).toGMTString()),c.push("expires="+d);(d=e.path)&&c.push("path="+d);(d=e.domain)&&c.push("domain="+d);!0===e.secure&&c.push("Secure");!0===e.httponly&&c.push("HttpOnly");e=c.join(";");if(4096>e.length)a.cookie=e;else throw{name:"CookieTooLongError",message:"Cookie reached 4096 byte limit"};i(a.cookie)}};d.findEach=function(a,b){for(key in e)e.hasOwnProperty(key)&&key.match(a)&&b(key,e[key])};i(a.cookie||"")};b.HTTP.QueryString=function(a){function b(a){if(a&&
"string"==typeof a){var d=a.split("&"),a={};p(d,function(b){var d=b.split("="),b=decodeURIComponent(d[0]),d=d[1]&&decodeURIComponent(d[1].replace(/\+/g," "));a[b]=d})}return a}var d=this,e={};o(e,b(a));d.param=function(a){return e[a]||""};d.params=function(){return e};d.appendParam=function(a,b){a&&(void 0!=b&&""!==b)&&(e[a]=b);return this};d.appendParams=function(a){p(a,d.appendParam);return this};d.alwaysAppendParam=function(a,b){a&&(e[a]=void 0!=b?b:"");return this};d.alwaysAppendParams=function(a){p(a,
d.alwaysAppendParam);return this};d.appendPartialQueryString=function(a){a&&d.alwaysAppendParams(b(a));return this};d.deleteParam=function(a){delete e[a]};d.toString=function(){var a=[],b;for(b in e){var d=encodeURIComponent(b),j=encodeURIComponent(e[b]);a.push(d+"="+j)}return a.join("&")}};b.HTTP.URL=function(a){var i=this,d,e,c,f=a.indexOf("#");-1<f&&(c=a.substring(f+1),a=a.substring(0,f));f=a.indexOf("?");-1<f&&(e=a.substring(f+1),a=a.substring(0,f));d=a;a=new b.HTTP.QueryString(e);o(i,a);i.queryString=
a.toString;i.toString=function(){var a=i.queryString();return d+(a.length>0?"?"+a:"")};i.asString=i.toString;i.fragment=function(){return c}};b.ServerURL=function(a){function i(a,b){return function(c){bt_log("invalid "+a+" expression: "+b+", exception = "+c)}}var d=this,e=a.host,c=a.window,f=a.parentReferrer,g=a.referrer,j="";0<e.length&&(j=(e.match("^[a-z0-9+.-]+://.+")?"":"//")+e+"/tag");b.HTTP.URL.call(this,j);d.appendParams({site:a.site,referrer:g,docReferrer:a.docReferrer,mode:a.mode});g!==f&&
d.appendParam("parentReferrer",f);d.appendData=function(a){var b=bt_data(a),e;a:switch(Object.prototype.toString.apply(b)){case "[object Array]":case "[object Object]":e=!0;break a;default:e=!1}b=e?c.JSON.stringify(b):b;return d.alwaysAppendParam("_cb_"+("bt_data('"+a+"')"),b)};d.appendJs=function(a){var b=i("inline JavaScript",a);return d.alwaysAppendParam("_cb_"+a,t(a,b))};d.cf=function(a){a.constructor!=Array&&(a=[a]);var b=d.param("cf");b&&(a=Array(b).concat(a));d.appendParam("cf",a.join());return d};
d.addCf=function(a,b){if(!t(b,i("conditional fire",b)))return!1;var c=d.param("cf");d.appendParam("cf",c?c+","+a:a);return!0}};b.Page=function(a,i){function d(a){p(q.isArray(a)?a:[a],function(a){q.isFunction(a)?a():l.write('<script type="text/javascript" src="'+a+'"><\/script>')})}function e(a){var b=r.group().options({tagId:-2});p(q.isArray(a)?a:[a],function(a){(q.isFunction(a)?b.wait:b.script)(a)})}function c(a){l.write(a)}function f(a,b){var c={};b&&b.tagId&&(c.tagId=b.tagId);r.group(!m?"domready":
void 0).options(c).wait(function(){l.write(a)})}function g(b){n.hasErrors()&&(b.appendParam("errors",n.toJSON()),2083<b.toString().length&&(b.deleteParam("errors"),n.tooManyErrors(),b.appendParam("errors",n.toJSON())));n.reset({site:a.site,referrer:a.referrer||l.location.href})}function j(a){(new b.HTTP.Cookie(l)).findEach(/^btps\..+/,function(b,c){a.appendParam(b,c)})}var h=this,k=void 0,v=a.data||{},s=void 0,l=a.document||{},x=a.window||{},r=a.blab||b.Blab,n=a.errorManager,m=!1;h.referrer=a.referrer;
h.parentReferrer=a.parentReferrer;h.docReferrer=a.docReferrer;n&&r.addGlobalListener(n);var o="sync"===a.mode;h.writeScript=o?d:e;h.appendContent=o?c:f;h.domReady=function(){m=!0;r.addGlobalListener(new r.GlobalSwapwriteListener(l));"sync"===a.mode&&(h.writeScript=e,h.appendContent=f);r.run("domready")};h.parameter=function(a){void 0==k&&(k=new b.HTTP.URL(l.location.href));return k.param(a)};h.meta=function(a){s||(s={},p(l.getElementsByTagName("meta"),function(a){s[a.getAttribute("name")]=a.getAttribute("content")}));
return s[a]||""};h.cookie=function(a){return(new b.HTTP.Cookie(l)).get(a)||""};h.data=function(a,b){if(void 0!==b)return v[a]=b;b=v[a];return void 0==b?"":b};h.dbe=function(a,b,c){h.data(a,t(b,function(b){n&&n.push({type:"dbe",message:b.toString(),"dbe.name":a,pageId:(c||{}).pageId||-1})}))};h.errors=function(a){n.configure(a)};h.serverURL=function(){return new b.ServerURL(a)};h.defaultBaseUri=function(){return("https:"==l.location.protocol?"https:":"http:")+"//s.btstatic.com/"};h.baseUri=function(){var a=
/\btag(\.[^.]+|-n)?\.js(#.*)?$/;return i&&i.src&&i.src.replace(a,"")||h.defaultBaseUri()};h.primary=function(){var a=[];x.JSON||a.push(h.baseUri()+"json2.js");a.push(function(){var a=h.serverURL();j(a);n&&(n.processStoredErrors(),g(a));return a.toString()}());h.writeScript(a)};h.secondary=function(a){var b=h.serverURL(),c=b.toString();a(b);b.toString()!=c&&(j(b),n&&g(b),h.writeScript(b.toString()))}};b.ErrorManager=function(a,b){function d(b){h.push(e(b));a.set(k,c.toJSON(),{path:"/"})}function e(a){var b=
q.isObject(a)?o({},a):{};b.type=b.type||"unknown";b.message=b.message||a.toString();b.timestamp=m;return b}if(!a)throw"ErrorManager requires a store";var c={},f,g,j=!0,h=[],k="__bterr",m=+new Date,s=c.configure=function(a){a.hasOwnProperty("enabled")&&(j=a.enabled);a.hasOwnProperty("timestamp")&&(m=a.timestamp);a.hasOwnProperty("site")&&(f=a.site);a.hasOwnProperty("referrer")&&(g=a.referrer)};b&&s(b);c.reset=function(b){b&&s(b);h=[];a.remove(k);a.remove(k,{path:"/"})};c.hasErrors=function(){return 0<
h.length};c.toArray=function(){return h};c.toJSON=function(){try{return JSON.stringify({site:f,referrer:g,errors:h})}catch(a){bt_log("problem serializing errors: "+a.message)}};c.push=function(a){bt_log("error: "+JSON.stringify(a));if(j&&a&&!(-1>a.tagId||-1>a.pageId))try{d(a)}catch(b){if("CookieTooLongError"!=b.name)throw b;c.tooManyErrors()}};c.tooManyErrors=function(){c.reset();d({type:"runtime",message:"Too many errors"})};c["block:error"]=function(a,b){if(b){var d=b.type,e=b.exception||b,f=a.option("tagId")||
-1;c.push({type:d,message:e.toString(),tagId:f})}};c.processStoredErrors=function(){var b=a.get(k);if(b)try{var c=JSON.parse(b);f=c.site;g=c.referrer;q.isArray(c.errors)&&(h=h.concat(c.errors))}catch(d){bt_log("problem reading stored errors: "+d.message)}};return c};b.CookieSyncEngine=function(a){var i={fn:function(a){a()},next:null},d=i,e=a.document,c=function(a){if("function"!=typeof a)return!1;a={fn:a,next:null};d=d.next=a;return!0},f=function(){if(i){var a=i.fn;i=i.next;a(f)}},g=f;b.Events.listen(a,
"load",g);return{sync:g,push:function(a){return c(a)},pushImage:function(b){return c(function(c){var d=new a.Image;d.onerror=d.onload=c;d.src=b})},pushIframe:function(a){return c(function(b){var c=e.createElement("iframe");c.onerror=c.onload=b;c.width=0;c.height=0;c.style.border=0;c.src=a;e.body.appendChild(c)})}}};b.jQueryLoader=function(a,i){return new function(a,e){function c(a){k.wait(a)}function f(a){function d(){i=b.jQuery;c(a)}h="var $ = BrightTag.$; ";b.jQuery?d():k.script(b.instance.baseUri()+
"BrightTag.jquery-1.5.1.js").wait(d)}var g={},i=a.jQuery,h="",k=b.Blab.group(e);g.getJQuery=function(){return i};g.functionWithAccess=function(a,b){return new Function(a,h+b)};g.ensureJQuery=function(a){g.ensureJQuery=c;(i?c:f)(a);b.Blab.run(e)};return g}(a,i)};b.Main=function(a){var i=b.Events,d;a:{d=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/;for(var e=a.document.getElementsByTagName("script"),c=e.length-1;-1<c;c--){var f=e[c];if(d.test(f.src)){d=f;break a}}d=void 0}d&&((e=(new b.HTTP.URL(d.src)).fragment())&&
o(a,(new b.HTTP.QueryString(e)).params()),e=function(a){bt_log("configuration error: "+a)},c=b.trim(d.innerHTML),0!==c.length&&o(a,t("(\n"+c+"\n)",e)));if(void 0!=a.site){i.enablePageReadyOverrides(a.window,a.document);try{var g=new b.Page(a,d);i.domReady(a.document,function(){g.domReady()});a.loadOnly||g.primary();return g}catch(j){bt_log("execution error: "+j)}}};var w=b.defaultConfig();o(b.Blab,new b.Blab.Manager(w.document));b.$LAB=b.Blab;b.EventBinding=b.EventBindingManager(w.window,w.errorManager);
b.CookieSync=b.CookieSyncEngine(w.window);b.instance=b.Main(w);return b}(window.BrightTag);function bt_parameter(b){return BrightTag.instance.parameter(b)}function bt_meta(b){return BrightTag.instance.meta(b)}function bt_cookie(b){return BrightTag.instance.cookie(b)}function bt_data(b,m){return BrightTag.instance.data(b,m)}window.bt_data_escaped=bt_data;function bt_log(b){window.console&&console.log&&console.log("BrightTag: "+b)}
var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;function btServe(b){if(void 0==BrightTag.instance){var m=BrightTag,t=m.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},m.defaultConfig());void 0!=_bt_url_prefix&&(t.host=_bt_url_prefix);m.instance=m.Main(m.extend(t,b||{}))}};
