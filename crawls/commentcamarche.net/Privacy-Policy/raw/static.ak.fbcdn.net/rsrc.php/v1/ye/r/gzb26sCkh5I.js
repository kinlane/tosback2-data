/*1336409837,169776068*/

if (window.CavalryLogger) { CavalryLogger.start_js(["CDPK3"]); }

function fbpage_set_fan_status(a,b,c,d,e,f,g){e=e?e:function(j){_fbpage_show_change_status_feedback(a,j.getPayload());};var h={fbpage_id:b,add:c,reload:d};if(g!=null)copy_properties(h,g);var i=new AsyncRequest().setURI('/ajax/pages/fan_status.php').setData(h).setNectarModuleDataSafe(a).setHandler(e);if(f)i.setErrorHandler(f);i.send();return false;}function fbpage_set_favorite_status(a,b,c){var d=function(){_fbpage_show_change_status_feedback(a,this.getUserData());},e={fbpage_id:b,add:c},f=new AsyncRequest().setMethod('POST').setURI('/ajax/pages/favorite_status.php').setData(e);new Dialog().setAsync(f).setCloseHandler(d).show();return false;}function _fbpage_show_change_status_feedback(a,b){if(!b||!a)return;if(b.reload){fbpage_reload_on_fan_status_changed(b.preserve_tab);}else fbpage_redraw_on_fan_status_changed(a,b.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a){var c=FutureSideNav.getInstance().selected.textKey;if(!b.getQueryData().sk&&c)b.addQueryData({sk:c});}window.location.href=b;}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;if(Parent.byClass(a,'fbTimelineEscapeSectionItem'))a=Parent.byClass(a,'fan_status_inactive')||a;var c=DOM.create('span',{className:'fan_status_inactive'},b);a.parentNode.replaceChild(c,a);var d=function(){if(data.can_repeat_action)c.parentNode.replaceChild(a,c);};animation(c).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(d).go();}function fbpage_toggle_like_on_fan_status_changed(a,b){var c=$('liked_pages_like_action_'+a),d=$('liked_pages_undo_action_'+a);CSS.conditionClass(c,'hidden_elem',b);CSS.conditionClass(d,'hidden_elem',!b);}
__d("DragDropFileUpload",[],function(a,b,c,d,e,f){f.isSupported=function(){return typeof(FileList)!=="undefined";};});
__d("ArbiterDragDrop",["Arbiter","DragDropFileUpload"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DragDropFileUpload'),i='dnd/drag/in',j='dnd/drag/out',k='dnd/drag/drop',l=false,m=function(){if(l)return;l=true;if(!h.isSupported())return;if(!document.addEventListener)return;var o=0;document.addEventListener('dragenter',function(r){if(o===0)g.inform(i,r,g.BEHAVIOR_EVENT);o++;},false);document.addEventListener('dragleave',function(r){o--;if(o===0)g.inform(j,r,g.BEHAVIOR_EVENT);},false);document.addEventListener('drop',function(r){g.inform(k,r,g.BEHAVIOR_EVENT);r.preventDefault();},false);document.addEventListener('dragover',function(r){r.preventDefault();},false);var p=null,q=function(){o=0;g.inform(j,null,g.BEHAVIOR_EVENT);};document.addEventListener('dragover',function(r){p&&window.clearTimeout(p);p=window.setTimeout(q,839);},true);},n=function(o){m();return o;};e.exports={dragEnter:n.bind(null,i),dragLeave:n.bind(null,j),dragDrop:n.bind(null,k)};});
__d("css_on_global_drag",["ArbiterDragDrop","Arbiter","CSS"],function(a,b,c,d,e,f){var g=b('ArbiterDragDrop'),h=b('Arbiter'),i=b('CSS');e.exports=function(j,k){var l=h.subscribe(g.dragEnter(),i.addClass.bind(i,j,k),h.SUBSCRIBE_NEW),m=h.subscribe(g.dragLeave(),i.removeClass.bind(i,j,k),h.SUBSCRIBE_NEW);return function(){l.unsubscribe();m.unsubscribe();};};});
__d("DragDropTarget",["CSS","DragDropFileUpload","copyProperties","css_on_global_drag"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DragDropFileUpload'),i=b('copyProperties'),j=b('css_on_global_drag');function k(l,m){this.element=l;this.preprocess=function(n){return n;};this.onDrop=m;}i(k.prototype,{setPreprocessor:function(l){this.preprocess=l;return this;},activate:function(){if(!h.isSupported())return;if(!document.addEventListener)return;var l=j(this.element,'fbWantsDragDrop'),m=0;this.element.addEventListener('dragenter',(function(){if(m===0)g.addClass(this.element,'fbDropReady');m++;}).bind(this),false);var n=g.removeClass.bind(g,this.element,'fbDropReady');this.element.addEventListener('dragleave',(function(){m=Math.max(m-1,0);if(m===0)n();}).bind(this),false);this.element.addEventListener('dragover',function(o){o.preventDefault();o.stopPropagation();},false);this.element.addEventListener('drop',(function(o){o.preventDefault();o.stopPropagation();var p=this.preprocess(o.dataTransfer.files);m=0;n();if(p.length)this.onDrop(p);}).bind(this),false);}});e.exports=k;});
__d("FileUpload",["Arbiter","CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('copyProperties'),j=function(k){this.file=k;this.failureCode=null;this.failureSummary=null;this.failureDescription=null;this.serverPayload=null;};i(j.prototype,{getFile:function(){return this.file;},isComplete:function(){return !!this.serverPayload;},complete:function(k){this.serverPayload=k;return this;},isSuccess:function(){return this.isComplete()&&!this.failureCode;},getResponsePayload:function(){return this.serverPayload;},fail:function(k,l,m){this.failureCode=k;this.failureSummary=l;this.failureDescription=m;return this;},getFailureCode:function(){return this.failureCode;},getFailureSummary:function(){return this.failureSummary;},getFailureDescription:function(){return this.failureDescription;}});e.exports=j;});
__d("AJAXFileUploader",["AsyncRequest","FileUpload","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('FileUpload'),i=b('copyProperties');function j(k,l,m){this.files=k;this.uploadURI=l;this.uploads=[];this.finishedCount=0;this.succeeded=[];this.failed=[];this.onComplete=m;this.relativeElem=null;for(var n=0;n<k.length;n++)this.uploads.push(new h(k[n]));}i(j.prototype,{startUpload:function(){for(var k=0;k<this.uploads.length;k++)new g().setURI(this.uploadURI).setRawData(this.files[k]).setRelativeTo(this.relativeElem).setStatusElement(this.relativeElem).setHandler(this.handler.bind(this,k)).setErrorHandler(this.errorHandler.bind(this,k)).send();},setRelativeTo:function(k){this.relativeElem=k;return this;},handler:function(k,l){this.uploads[k].complete(l.getPayload());this.succeeded.push(this.uploads[k]);this.onResponse();},errorHandler:function(k,l){this.uploads[k].fail(l.getError(),l.getErrorSummary(),l.getErrorDescription());if(l.getPayload())this.uploads[k].complete(l.getPayload());this.failed.push(this.uploads[k]);this.onResponse();},onResponse:function(){this.finishedCount++;if(this.finishedCount===this.uploads.length)this.onComplete(this.succeeded,this.failed);}});e.exports=j;});
__d("FileUploadTarget",["AJAXFileUploader","DragDropFileUpload","DragDropTarget","copyProperties"],function(a,b,c,d,e,f){var g=b('AJAXFileUploader'),h=b('DragDropFileUpload'),i=b('DragDropTarget'),j=b('copyProperties');function k(l,m){var n=(function(o){new g(o,m,this.onCompleteCallback).setRelativeTo(l).startUpload();}).bind(this);this.dragDropTarget=new i(l,(function(o){o.length&&this.asyncProcess(o,function(p){p.length&&n(p);});}).bind(this));this.asyncProcess=function(o,p){p(o);};this.preprocess=function(o){return o;};this.onCompleteCallback=bagofholding;}j(k.prototype,{setPreprocessor:function(l){this.preprocess=l;return this;},setAsyncProcessor:function(l){this.asyncProcess=l;return this;},onComplete:function(l){this.onCompleteCallback=l;return this;},activate:function(){if(!h.isSupported())return;this.dragDropTarget.setPreprocessor(this.preprocess).activate();}});e.exports=k;});
__d("SinglePictureUploadTarget",["Bootloader","Dialog","ErrorDialog","FileUploadTarget","StringEscape","tx","copyProperties"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('Dialog'),i=b('ErrorDialog'),j=b('FileUploadTarget'),k=b('StringEscape'),l=b('tx'),m=b('copyProperties');function n(o,p){this.fileUploadTarget=new j(o,p);this.preprocessCallback=bagofholding;this.oncompleteCallback=bagofholding;this.afterSuccessCallback=bagofholding;this.maxWidth=null;this.maxHeight=null;}m(n.prototype,{setPreprocessCallback:function(o){this.preprocessCallback=o;return this;},setOncompleteCallback:function(o){this.oncompleteCallback=o;return this;},setAfterSuccessCallback:function(o){this.afterSuccessCallback=o;return this;},setMaximumDimensions:function(o,p){this.maxWidth=o;this.maxHeight=p;return this;},activate:function(){var o=function(s){return k.htmlSpecialChars(s.name);},p=(function(s){if(s.length>1){i.show("Upload Error",l._("You can only select {max-photos} photos to upload to this album.  Only the first {max-photos} photo you selected will be uploaded.",{'max-photos':1}));s=[s[0]];}var t=s[0];if(!t.type.match(/^image\//)){i.show("Upload Error",l._("We could not understand the contents of {filename}.  Make sure it is a jpg, gif, or png formatted image.",{filename:o(t)}));return [];}this.preprocessCallback(s);return s;}).bind(this),q=(function(s,t){var u=1024*1024*16,v=1024*1024*1,w=function(y){if(y.size>u){i.show("Upload Error",l._("{filename} is too large. Please resize your photo to under\n                     8000x8000 pixels and try again.",{filename:o(s[0])}));t([]);}else t([y]);},x=s[0];if((x.size<v)||(!this.maxWidth&&!this.maxHeight)){w(x);}else g.loadModules(['ImageExif','ImageResizer'],function(y,z){if(!z.isSupported()){w(x);return;}var aa=new z(x,this.maxWidth,this.maxHeight);aa.subscribe('resized',function(ba,ca){if(ca.size>x.size){w(x);}else w(ca);}.bind(this));aa.subscribe('error',function(){w(x);}.bind(this));y.readFromFile(x,function(ba){ba&&aa.setOrientation(ba.Orientation);aa.resize();});});}).bind(this),r=(function(s,t){this.oncompleteCallback(s,t);if(s.length){var u=s[0].getResponsePayload();this.afterSuccessCallback(u);}else{var v=t[0];if(v.serverPayload&&v.serverPayload.__dialog){var w=new h();w._setFromModel(v.serverPayload.__dialog);w.setButtons(h.OK).show();}else i.show(v.failureSummary,v.failureDescription);}}).bind(this);return this.fileUploadTarget.onComplete(r).setPreprocessor(p).setAsyncProcessor(q).activate();}});e.exports=n;});
__d("TimelineProfilePic",["Arbiter","CSS","Dialog","DOM","HTML","Run","$","ge","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('Dialog'),j=b('DOM'),k=b('HTML'),l=b('Run'),m=b('$'),n=b('ge'),o=b('copyProperties');function p(q,r,s,t){p.destroyInstance();p._instance=this;this.leavingMessage=r;this.elemID=s||'fbProfileCover';this.elemClass=t||'.profilePicThumb';this._arbiterTokens=[g.subscribe(q.LOADING,this.startLoading.bind(this)),g.subscribe(q.SUCCESS,this.onUploadSuccess.bind(this))];l.onBeforeUnload(this.onBeforeUnload.bind(this));l.onLeave(this.destroy.bind(this));}o(p,{_instance:null,destroyInstance:function(){this._instance&&this._instance.destroy();}});o(p.prototype,{_setLoadingIndicator:function(q){this._loading=q;h.conditionClass(j.find(m(this.elemID),this.elemClass),'profilePicLoading',q);},destroy:function(){this._arbiterTokens.each(function(q){q.unsubscribe();});this._arbiterTokens=[];p._instance=null;},startLoading:function(q,r){this._setLoadingIndicator(r.isLoading);if(n('fbProfilePicSelector'))h.removeClass(m('fbProfilePicSelector'),'fbTimelineNullProfilePicSelector');},onUploadSuccess:function(q,r){this._setLoadingIndicator(false);var s=i.getCurrent();if(s)s.hide();j.replace(j.find(m(this.elemID),this.elemClass),k(r.newPic));},onBeforeUnload:function(){if(p._instance===this&&this._loading)return this.leavingMessage;}});e.exports=p;});
var TimelineStar={STAR_CSS_ONLY:1,STAR_ASYNC_REQUIRED:2,ACTION_STAR:7,ACTION_UNSTAR:8,starClicked:false,starUnit:function(a,b,c){var d=a.parentNode;if(!c)DOM.setContent(d,b);CSS.removeClass(d,'fbTimelineTwoColumn');CSS.addClass(d,'fbTimelineOneColumn');d.removeAttribute('data-side');d.setAttribute('data-size','2');Tooltip.hide();TimelineCapsule.balanceCapsule.curry(d.parentNode).defer();},unstarUnit:function(a,b,c){var d=a.parentNode;if(!c)DOM.setContent(d,b);CSS.removeClass(d,'fbTimelineOneColumn');CSS.addClass(d,'fbTimelineTwoColumn');d.setAttribute('data-side','l');d.setAttribute('data-size','1');Tooltip.hide();TimelineCapsule.balanceCapsule.curry(d.parentNode).defer();},listenToButton:function(a,b){var c=ge(a);if(!c)return;switch(b){case TimelineStar.STAR_CSS_ONLY:Event.listen(c,'click',function(event){Button.setEnabled(c,false);var e=Parent.byClass(c,'timelineUnitContainer'),f=TimelineStar.unstarUnit;CSS.toggleClass(c,'fbTimelineStarButtonSelected');CSS.toggleClass(c,'selected');if(e.parentNode.getAttribute('data-size')=='1')f=TimelineStar.starUnit;f(Parent.byClass(c,'timelineUnitContainer'),null,true);var g=new URI(c.getAttribute('ajaxify')),h=g.getQueryData().customize_action==TimelineStar.ACTION_STAR?TimelineStar.ACTION_UNSTAR:TimelineStar.ACTION_STAR;g.addQueryData({customize_action:h});c.setAttribute.bind(c,'ajaxify',g).defer();});var d=Parent.byClass(c,'stat_elem');d&&CSS.removeClass(d,'stat_elem');break;case TimelineStar.STAR_ASYNC_REQUIRED:break;}}};
__d("timeline-cover-dragdrop-edit",["SinglePictureUploadTarget","TimelineCover"],function(a,b,c,d,e,f){var g=b('SinglePictureUploadTarget'),h=b('TimelineCover'),i=function(m,n){var o=h.getInstance();o.hideLoadingIndicator();},j=function(m){var n=h.getInstance(),o=m.id,p=m.photo_html;n.updateCoverImage(o,p);},k=function(m){h.getInstance().showLoadingIndicator();},l=function(m,n,o,p){new g(m,n).setMaximumDimensions(o,p).setPreprocessCallback(k).setOncompleteCallback(i).setAfterSuccessCallback(j).activate();};f.initialize_timeline_cover_drop_target=l;});
__d("TimelineAudienceSelector",["Arbiter","CSS","DOM","Parent","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Parent'),k=b('PrivacyConst'),l=b('Selector');function m(){var p='timelineOnlyMeBorder';return [i.create('div',{className:p}),i.create('div',{className:p+' timelineOnlyMeBorderBottom'})];}function n(){return i.create('img',{alt:' ',className:'timelinePrivacyCorner',height:34,src:'/images/profile/timeline/privacy_corner.png',width:34});}function o(p){var q=i.scry(p,'.photoUnit a.photo');return q.filter(function(r){return !i.scry(r,'.timelinePrivacyCorner').length;});}g.subscribe('AudienceSelector/changed',function(p,q){var r=l.getOptionValue(q.option),s=j.byClass(q.selector,'timelineUnitContainer')||j.byClass(q.clone,'fbTimelineTwoColumn');if(!s)return;if(r==k.BaseValue.SELF){h.addClass(s,'timelineOnlyMeUnit');var t=o(s);for(var u=0,v=t.length;u<v;++u)i.appendContent(t[u],n());if(!i.scry(s,'div.timelineOnlyMeBorder').length){var w=m();i.prependContent(s,w[0]);i.appendContent(s,w[1]);}}else h.removeClass(s,'timelineOnlyMeUnit');});});
__d("profile-pic-dragdrop-edit",["Arbiter","SinglePictureUploadTarget","TimelineProfilePic"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('SinglePictureUploadTarget'),i=b('TimelineProfilePic');f.initialize_profile_pic_drop_target=function(j,k,l,m){new i(l,m);new h(j,k).setPreprocessCallback(function(n){g.inform(l.LOADING,{isLoading:1},g.BEHAVIOR_STATE);}).setOncompleteCallback(function(n,o){g.inform(l.LOADING,{isLoading:0},g.BEHAVIOR_STATE);}).setAfterSuccessCallback(function(n){g.inform(l.SUCCESS,{newPic:n.photo_html},g.BEHAVIOR_STATE);}).activate();};});
function FutureProfileSideNav(){this.parent.construct(this);}Class.extend(FutureProfileSideNav,'FutureSideNav');copy_properties(FutureProfileSideNav.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.altKeyParam='v';this.sidecol=false;},_constructItem:function(a,b){return new FutureProfileSideNavItem(a,b);},_doPageTransition:function(a,b){if(!this._profileChanged(b)&&!this._scopeChanged(a))return this.parent._doPageTransition(a,b);},_profileChanged:function(a){var b=a.getQueryData(),c=this.uri.getQueryData();return (b.id!==c.id||b.viewas!==c.viewas||b.and!==c.and);},_scopeChanged:function(a){return (!this.selected||a.layoutType!==this.selected.layoutType);},_getKey:function(a){return this.parent._getKey(a)||a[this.altKeyParam];}});function FutureProfileSideNavItem(a,b){this.parent.construct(this,a,b);this.layoutType=a.layouttype;}Class.extend(FutureProfileSideNavItem,'FutureSideNavItem');
__d("SubscriptionLevels",[],function(a,b,c,d,e,f){var g={ALL:'162318810514679',DEFAULT:'271670892858696',TOP:'266156873403755'};e.exports=g;});
__d("EditSubscriptions",["event-extensions","function-extensions","Arbiter","AsyncRequest","CSS","DOM","ge","Menu","Parent","SubscriptionLevels"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('ge'),l=b('Menu'),m=b('Parent'),n=b('SubscriptionLevels'),o=13,p=45,q=[n.ALL,n.DEFAULT,n.TOP],r={},s={},t={},u={},v={},w={},x={},y={},z={},aa="/ajax/follow/follow_profile.php",ba="/ajax/follow/unfollow_profile.php";function ca(ua){return q.contains(ua);}function da(ua,va,wa,xa){var ya=m.byClass(xa,'uiMenuItem')||m.byClass(xa,'uiMenuXItem');if(!ya||!j.contains(ua,ya)){return;}else if(i.hasClass(ya,'SubscribeMenuSubscribeCheckbox')){if(t[va]){ga(ua,va);}else fa(ua,va);return false;}else if(i.hasClass(ya,'SubscribeMenuUnsubscribe')){ga(ua,va);return false;}else if(i.hasClass(ya,'SubscribeMenuSettingsItem')){sa(ua,true);return false;}else if(i.hasClass(ya,'SubscriptionMenuGoBack')){sa(ua,false);return false;}else if(i.hasClass(ya,'SubscriptionMenuItem')){ea(ua,va,wa,ya);return false;}}function ea(ua,va,wa,xa){if(i.hasClass(xa,'SubscriptionMenuLevel')){if(l.isItemChecked(xa))return;qa(ua,va,ka(xa),true,wa);}else if(i.hasClass(xa,'SubscriptionMenuCategory'))oa(va,xa,!l.isItemChecked(xa),true,wa);}function fa(ua,va){var wa={profile_id:va};g.inform('FollowingUser',wa);new h().setURI(aa).setMethod('POST').setData({profile_id:va,location:ha(ua)}).setErrorHandler(g.inform.curry('FollowUserFail',wa)).send();}function ga(ua,va){var wa={profile_id:va};g.inform('UnfollowingUser',wa);new h().setURI(ba).setMethod('POST').setData({profile_id:va,location:ha(ua)}).setErrorHandler(g.inform.curry('UnfollowUserFail',wa)).send();}function ha(ua){if(i.hasClass(ua,'followButtonFlyout')){return o;}else return p;}function ia(ua,va,wa){var xa={profile_id:ua,level:w[ua],custom_categories:x[ua],location:wa};new h().setURI('/ajax/follow/manage_subscriptions.php').setData(xa).send();}function ja(ua,va){var wa=x[va]||[],xa=l.getItems(ua);xa.forEach(function(ya){if(i.hasClass(ya,'SubscriptionMenuCategory')){var za=ka(ya);if(wa.contains(za)){ma(ya);}else na(ya);}});qa(ua,va,w[va],false);}function ka(ua){var va=j.scry(ua,'input')[0];return va&&va.value;}function la(ua){return j.find(ua,'a.itemAnchor');}function ma(ua){i.addClass(ua,'checked');la(ua).setAttribute('aria-checked',true);}function na(ua){i.removeClass(ua,'checked');la(ua).setAttribute('aria-checked',false);}function oa(ua,va,wa,xa,ya){if(wa){ma(va);}else na(va);var za=ka(va);if(ca(za)){wa&&pa(ua,za);}else if(wa){if(!x[ua].contains(za))x[ua].push(za);}else{var ab=x[ua].indexOf(za);if(ab!==-1)x[ua].splice(ab,1);}if(xa)ia(ua,za,ya);}function pa(ua,va){w[ua]=va;g.inform('SubscriptionLevelUpdated',{profile_id:ua,level:va});}function qa(ua,va,wa,xa,ya){var za=j.scry(ua,'.SubscriptionMenuLevel'),ab=null;za.forEach(function(bb){if(ka(bb)==wa){ab=bb;}else if(l.isItemChecked(bb))oa(va,bb,false,false);});ab&&oa(va,ab,true,xa,ya);}function ra(ua,va,wa){t[va]=wa;i.conditionClass(ua,'isUnsubscribed',!wa);var xa=j.scry(ua,'li.SubscribeMenuSubscribeCheckbox');if(xa.length!==0){var ya=xa[0];if(wa){ma(ya);}else na(ya);}}function sa(ua,va){i.conditionClass(ua,'subscriptionMenuOpen',va);}g.subscribe('UnfollowUser',function(ua,va){if(y[va.profile_id]){pa(va.profile_id,y[va.profile_id]);x[va.profile_id]=z[va.profile_id].slice();}});g.subscribe('UpdateSubscriptionLevel',function(ua,va){var wa=va.profile_id+'',xa=va.level+'';pa(wa,xa);var ya;for(ya in r)if(r[ya]===wa){var za=k(ya);za&&qa(za,wa,xa,false);}});var ta={init:function(ua,va,wa){var xa=j.getID(ua);if(!r[xa])Event.listen(ua,'click',function(ya){return da(ua,r[xa],wa,ya.getTarget());});if(w[va])ja(ua,va);r[xa]=va;i.conditionClass(ua,'NonFriendSubscriptionMenu',!s[va]);i.conditionClass(ua,'cannotSubscribe',!u[va]);i.conditionClass(ua,'noSubscriptionLevels',v[va]);i.conditionClass(ua,'noSubscribeCheckbox',!s[va]&&!v[va]);ra(ua,va,t[va]);g.subscribe(['FollowUser','FollowingUser','UnfollowUserFail'],function(ya,za){ra(ua,va,true);}.bind(this));g.subscribe(['UnfollowUser','UnfollowingUser','FollowUserFail'],function(ya,za){g.inform('SubMenu/Reset');ra(ua,va,false);}.bind(this));sa(ua,false);},getSubscriptions:function(ua){return {level:w[ua],custom_categories:x[ua]};},setSubscriptions:function(ua,va,wa,xa,ya,za,ab,bb,cb){pa(ua,za+'');s[ua]=va;t[ua]=wa;u[ua]=xa;v[ua]=ya;y[ua]=bb+'';x[ua]=ab.map(String);z[ua]=cb.map(String);}};e.exports=a.EditSubscriptions||ta;});
__d("legacy:EditSubscriptions",["SubscriptionLevels","EditSubscriptions"],function(a,b,c,d){a.SubscriptionLevels=b('SubscriptionLevels');a.EditSubscriptions=b('EditSubscriptions');},3);
FriendRequestMessage={STATUS:'FriendRequest/change',UNFRIEND:'FriendRequest/unfriend',CANCEL:'FriendRequest/cancel',CANCELLING:'FriendRequest/cancelling',CANCEL_FAIL:'FriendRequest/cancelFail',SENT:'FriendRequest/sent',SENDING:'FriendRequest/sending',SEND_FAIL:'FriendRequest/sendFail',CONFIRM:'FriendRequest/confirm',CONFIRMING:'FriendRequest/confirming',CONFIRM_FAIL:'FriendRequest/confirmFail'};function FriendStatus(a,b,c){this.id=a;this.update(b,c);}copy_properties(FriendStatus.prototype,{update:function(a,b){a&&(this.status=a);if(b){this.lists=$A(b).map(String);this._informListChange();}},isComplete:function(){return !!this.lists;},addToList:function(a){if(this.lists&&!this.lists.contains(a))this.lists.push(a);this._informListChange();},removeFromList:function(a){if(this.lists){var b=this.lists.indexOf(a);b!==-1&&this.lists.splice(b,1);}this._informListChange();},updateList:function(a,b){b?this.addToList(a):this.removeFromList(a);},_informListChange:function(){Arbiter.inform('FriendListMembershipChange',{uid:this.id,lists:this.lists});}});copy_properties(FriendStatus,{ARE_FRIENDS:1,INCOMING_REQUEST:2,OUTGOING_REQUEST:3,CAN_REQUEST:4});(function(){var a={},b={};function c(d,e,f){if(!a[f.uid]){a[f.uid]=new FriendStatus(f.uid,d);}else a[f.uid].update(d);Arbiter.inform(FriendRequestMessage.STATUS,{uid:f.uid,status:d});}onloadRegister_DEPRECATED(function(){Arbiter.subscribe([FriendRequestMessage.CANCEL,FriendRequestMessage.UNFRIEND,FriendRequestMessage.SEND_FAIL],c.curry(FriendStatus.CAN_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM_FAIL],c.curry(FriendStatus.INCOMING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CANCEL_FAIL,FriendRequestMessage.SENT,FriendRequestMessage.SENDING],c.curry(FriendStatus.OUTGOING_REQUEST));Arbiter.subscribe([FriendRequestMessage.CONFIRM,FriendRequestMessage.CONFIRMING],c.curry(FriendStatus.ARE_FRIENDS));});copy_properties(FriendStatus,{CLOSE_FRIENDS:null,ACQUAINTANCES:null,getFriend:function(d,e){if(a[d]&&a[d].isComplete()){e(a[d]);}else if(b[d]){b[d].push(e);}else{b[d]=[e];new AsyncRequest().setURI("/ajax/friends/status.php").setData({friend:d}).setHandler(function(f){var g=f.getPayload();FriendStatus.initFriend.bind(FriendStatus,d,g.status,g.lists).defer();}).send();}},initFriend:function(d,e,f){var g=a[d]||new FriendStatus(d);g.update(g.status||e,g.lists||f);a[d]=g;b[d]&&b[d].forEach(function(h){h(g);});b[d]=null;},setSpecialLists:function(d){FriendStatus.CLOSE_FRIENDS=d.close+'';FriendStatus.ACQUAINTANCES=d.acq+'';}});})();
__d("DynamicFriendListEducation",["event-extensions","Arbiter","ArrayUtils","AsyncRequest","Dialog","PageTransitions"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArrayUtils'),i=b('AsyncRequest'),j=b('Dialog'),k=b('PageTransitions'),l,m,n,o,p,q;function r(){n&&n.hide();o&&o.hide();}function s(v){m.remove(v);r();p({accept_tag_education:true});}function t(){r();p({nux_cancel:true});}var u={init:function(v,w){l=v;m=h.createFrom(w).map(String);k.registerHandler(function(){r();l=false;p=undefined;m=[];});},showDialog:function(v,w,x){if(l&&m.contains(v)){r();g.inform('DynamicFriendListEducation/dialogOpen',{uid:w,flid:v});p=x;n=new j().setAsync(new i('/ajax/friends/lists/smart_list_education.php').setMethod('GET').setData({flid:v,uid:w}).setReadOnly(true)).setHandler(s.bind(this,v)).setCloseHandler(function(){g.inform('DynamicFriendListEducation/dialogClosed',{uid:w,flid:v});}).setCancelHandler(function(){g.inform('DynamicFriendListEducation/dialogCancel',{uid:w,flid:v});}).show();}else x();},showContextualDialog:function(v,w,x,y){if(l&&m.contains(v)){r();q=x;p=y;new i('/ajax/friends/lists/smart_list_contextual_education.php').setMethod('GET').setData({flid:v,uid:w}).setReadOnly(true).send();}else y();},setContextualDialog:function(v,w,x,y){o=v;o.setContext(q);o.show();Event.listen(w,'click',s.bind(this,y));Event.listen(x,'click',t);}};e.exports=u;});
__d("legacy:DynamicFriendListEducation",["DynamicFriendListEducation"],function(a,b,c,d){a.DynamicFriendListEducation=b('DynamicFriendListEducation');},3);
var FriendEditLists=(function(){var a=5,b={},c="/ajax/profile/removefriendconfirm.php",d='/ajax/friends/requests/cancel.php',e;function f(o,p,q){var r=b[o.id],s=function(t){var u={action:q?'add_list':'del_list',to_friend:r.id,friendlists:[p],source:e};if(t)copy_properties(u,t);r.updateList(p,q);var v;if(q&&p==FriendStatus.CLOSE_FRIENDS){v=i(o,FriendStatus.ACQUAINTANCES);if(Menu.isItemChecked(v)){Menu.toggleItem(v);f(o,FriendStatus.ACQUAINTANCES,false);}}else if(q&&p==FriendStatus.ACQUAINTANCES){v=i(o,FriendStatus.CLOSE_FRIENDS);if(Menu.isItemChecked(v)){Menu.toggleItem(v);f(o,FriendStatus.CLOSE_FRIENDS,false);}}var w={flid:p,uid:r.id},x=q?'FriendListHovercard/add':'FriendListHovercard/remove';Arbiter.inform(x,w);new AsyncRequest().setURI('/ajax/add_friend/action.php').setData(u).send();};if(q){DynamicFriendListEducation.showDialog(p,r.id,s);}else s();}function g(o){var p=DOM.scry(o,'input')[0];return p&&p.value;}function h(o,p,q){var r={uid:p.id};new AsyncRequest().setURI(d).setMethod('POST').setData({friend:p.id}).setHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL,r)).setErrorHandler(Arbiter.inform.bind(Arbiter,FriendRequestMessage.CANCEL_FAIL,r)).setStatusElement(q).send();}function i(o,p){var q=Menu.getItems(o);for(var r=0;r<q.length;r++)if(g(q[r])==p)return q[r];return null;}function j(o,p){var q=Menu.getItems(o);q.forEach(function(r){var s=g(r),t=p.lists.contains(s);if(Menu.isItemChecked(r)!==t)Menu.toggleItem(r);});}function k(o){var p=Menu.getItems(o),q=!CSS.hasClass(o,'followButtonFlyout')&&!CSS.hasClass(o,'likeButtonFlyout'),r=[],s=[],t=0,u=0;p.forEach(function(z){if(CSS.hasClass(z,'neverHide')){CSS.removeClass(z,'underShowMore');t++;}else if(Menu.isItemChecked(z)){r.push(z);}else if(CSS.hasClass(z,'neverShow')||CSS.hasClass(z,'FriendListCreateTrigger')||(!q&&CSS.hasClass(z,'friendOptionsOnly'))){CSS.addClass(z,'underShowMore');u++;}else s.push(z);});var v=a-t,w=r.concat(s),x=u;w.forEach(function(z){if(CSS.hasClass(z,'ShowMoreItem')){v--;return;}if(v){CSS.removeClass(z,'underShowMore');v--;}else{CSS.addClass(z,'underShowMore');x=true;}});CSS.conditionClass(o,'hasMoreFriendListItems',x);var y=DOM.scry(o,'.FriendListMenuShowMore');y.forEach(function(z){CSS.removeClass(z,'FriendListMenuShowMore');});}function l(o,p){var q=DOM.scry(o,'.FriendListUnfriend')[0],r=DOM.scry(o,'.FriendListCancel')[0];if(r)CSS.conditionShow(r,p.status==FriendStatus.OUTGOING_REQUEST);if(q){CSS.conditionShow(q,p.status==FriendStatus.ARE_FRIENDS);DOM.find(q,'a').setAttribute('ajaxify',URI(c).addQueryData({uid:p.id}).toString());}}function m(o,p){if(DOM.scry(o,'div.FriendListSubscriptionsMenu').length!==0)EditSubscriptions.init(o,p,45);}var n=function(){n=bagofholding;Arbiter.subscribe(FriendRequestMessage.STATUS,function(o,p){for(var q in b){var r=ge(q),s=b[q];if(r&&s&&s.id==p.uid){j(r,s);l(r,s);k(r);}}});Menu.subscribe('select',function(o,p){if(CSS.hasClass(p.item,'ShowMoreItem')&&CSS.hasClass(p.menu,'FriendListMenu')){CSS.addClass(p.menu,'FriendListMenuShowMore');ScrollableArea.poke(p.item);}});};return {init:function(o,p,q){o=$(o);e=q;n();if(!b[o.id])Menu.subscribe('select',function(r,s){if(DOM.contains(o,s.item))if(Parent.byClass(s.item,'FriendListItem')){Menu.toggleItem(s.item);var t=g(s.item);f(o,t,Menu.isItemChecked(s.item));}else if(Parent.byClass(s.item,'FriendListCancel')){h(o,b[o.id],s.item);}else if(Parent.byClass(s.item,'FriendListUnfriend'))FriendListFlyoutController.hide(false);});CSS.addClass(o,'async_saving');FriendStatus.getFriend(p,function(r){j(o,r);l(o,r);b[o.id]=r;k(o);m(o,p);CSS.removeClass(o,'async_saving');}.bind(this));}};})();
var FriendListFlyoutController=(function(){var a,b,c=null,d=null,e,f,g,h,i,j,k=1500;function l(){clearTimeout(h);}function m(){if(e){CSS.removeClass(e,'selected');CSS.removeClass(e,'uiButtonHover');if(DataStore.get(e,'flfcloselistener')){var x=e;DataStore.set(e,'flfcloselistenertimeout',w.curry(x).defer(k));}}b=false;o();e=null;}function n(x){if(DOM.isNodeOfType(x,'label')&&CSS.hasClass(x,'uiButton'))x=Button.getInputElement(x);return DataStore.get(x,'profileid');}function o(){f&&f.remove();f=null;i&&Layer.unsubscribe(i);i=null;h&&clearTimeout(h);h=null;}function p(x){var y=n(x),z=DataStore.get(x,'flloc');FriendEditLists.init(c,y,z);CSS.conditionClass(c,'followButtonFlyout',CSS.hasClass(x,'profileFollowButton'));CSS.conditionClass(c,'friendButtonFlyout',CSS.hasClass(x,'FriendRequestFriends')||CSS.hasClass(x,'FriendRequestIncoming')||CSS.hasClass(x,'FriendRequestOutgoing'));CSS.conditionClass(c,'likeButtonFlyout',CSS.hasClass(x,'profileLikeButton'));var aa=DOM.scry(c,'div.uiScrollableArea')[0];aa&&ScrollableArea.poke(aa);}function q(x){if(!a||b)return;a.setContext(x);CSS.addClass(x,'selected');CSS.addClass(x,'uiButtonHover');a.setFixed(CSS.isFixed(x)).show();e=x;b=true;if(c){p(x);}else new AsyncRequest().setURI('/ajax/friends/lists/flyout_content.php').setStatusElement(a.getContent()).send();o();f=Event.listen(x,'mouseleave',s);i=Layer.subscribe('show',u);if(DataStore.get(x,'flfcloselistener'))clearTimeout(DataStore.remove(x,'flfcloselistenertimeout'));var y=n(x);FriendStatus.getFriend(y,function(z){if(!d)return;if(z.status==FriendStatus.OUTGOING_REQUEST){CSS.show(d);AsyncRequest.bootstrap('/ajax/friends/lists/nux_flyout.php',null,true);}else CSS.hide(d);});}function r(x){e=x;g=q.curry(x).defer(350);f=Event.listen(x,'mouseleave',function(){clearTimeout(g);e=null;f&&f.remove();});}function s(){h=u.defer(150);}function t(){var x=Dialog.getCurrent(),y=x&&x.getBody();return !!(y&&DOM.scry(y,'.friendListDialogTourCarousel')[0]);}function u(){if(j||t())return;ua.ie()<8&&document.documentElement.focus();a&&a.hide();}function v(event){var x=Parent.byTag(event.getTarget(),'a');if(x&&CSS.hasClass(x,'FriendListActionItem'))s();}function w(x){var y=DataStore.remove(x,'flfcloselistener');y&&y();}return {init:function(x){FriendListFlyoutController.init=bagofholding;a=x;a.subscribe('mouseenter',l);a.subscribe('mouseleave',s);a.subscribe('hide',m);if(c)DOM.setContent(a.getContent(),[c,d]);Event.listen(document.documentElement,'mouseover',function(y){var z=Parent.byClass(y.getTarget(),'enableFriendListFlyout');if(z)if(e===z){clearTimeout(h);}else{b&&u();r(z);}});Arbiter.subscribe('DynamicFriendListEducation/dialogOpen',function(){j=true;});Arbiter.subscribe('DynamicFriendListEducation/dialogClosed',function(){j=false;s();});},initContent:function(x){var y=x.getRootNode();DOM.appendContent(document.body,y);(function(){if(!c){c=y;a&&DOM.setContent(a.getContent(),[c,d]);CSS.show(c);Event.listen(c,'click',v);b&&p(e);}else{DOM.remove(y);y=null;}}).defer();},initNux:function(x){if(d)return;d=x.getRootNode();a&&DOM.setContent(a.getContent(),[c,d]);},show:function(x){q(x);},hide:function(x){x===false?u():s();},setActiveNode:function(x){b&&u();e=x;f=Event.listen(x,'mouseleave',function(){e=null;f&&f.remove();});},setCloseListener:function(x,y){DataStore.set(x,'flfcloselistener',y);if(e!=x)DataStore.set(x,'flfcloselistenertimeout',w.curry(x).defer(k));},setCloseListenerTimeout:function(x){k=x;}};})();
var AddFriendButton={ERROR_ALREADY_ADDED:1431005,init:function(a,b,c,d,e,f,g,h,i,j,k){var l=null,m=DOM.scry(a,'.addButton')[0],n=DOM.scry(a,'.outgoingButton')[0],o=DOM.scry(a,'.incomingButton')[0],p=DOM.scry(a,'.friendButton')[0];function q(v,w,x){var y=new URI(m.getAttribute('ajaxify'));link_data=collect_data_attribs(a,['ft','gt']);new AsyncRequest().setURI(f).setData({to_friend:b,action:v,how_found:d,ref_param:e,link_data:link_data,outgoing_id:n.id,xids:y.getQueryData().xids,logging_location:g,no_flyout_on_click:h,ego_log_data:i,http_referer:k}).setErrorHandler(w).setServerDialogCancelHandler(x).setRelativeTo(n).send();}function r(v,w){m&&CSS.hide(m);n&&CSS.hide(n);o&&CSS.hide(o);p&&CSS.hide(p);if(v)CSS.show(v);if('Outgoing'==w&&l!=w&&j)animation(v).from('backgroundColor','#FFF8CC').to('backgroundColor','#FFFFFF').from('borderColor','#FFE222').to('borderColor','#FFFFFF').duration(2000).go();l&&CSS.removeClass(a,'fStatus'+l);l=w;CSS.addClass(a,'fStatus'+w);}function s(v){if(CSS.hasClass(v,'enableFriendListFlyout')){FriendListFlyoutController.show(v);}else FriendListFlyoutController.hide();}var t=Arbiter.subscribe(FriendRequestMessage.STATUS,function(v,w){if(w.uid!=b)return;switch(w.status){case FriendStatus.ARE_FRIENDS:return r(p,'Friends');case FriendStatus.INCOMING_REQUEST:return r(o,'Incoming');case FriendStatus.OUTGOING_REQUEST:return r(n,'Outgoing');case FriendStatus.CAN_REQUEST:return r(m,'Requestable');}}),u;if(c)u=Arbiter.subscribe(FriendRequestMessage.CONFIRM,function(v,w){w.uid==b&&goURI(c);});m&&Event.listen(m,'click',function(){Arbiter.inform(FriendRequestMessage.SENDING,{uid:b});if(h){FriendListFlyoutController.setActiveNode(n);}else s(n);q("add_friend",function(v){var w=v.error==AddFriendButton.ERROR_ALREADY_ADDED?FriendRequestMessage.SENT:FriendRequestMessage.SEND_FAIL;Arbiter.inform(w,{uid:b});FriendListFlyoutController.hide();AsyncResponse.defaultErrorHandler(v);},function(v){Arbiter.inform(FriendRequestMessage.SEND_FAIL,{uid:b});FriendListFlyoutController.hide();});});PageTransitions.registerHandler(function(){t.unsubscribe();u&&u.unsubscribe();});}};
var FriendButtonIcon={init:function(a,b,c){var d=DOM.find(b,'.defaultIcon'),e=DOM.find(b,'.closeIcon'),f=DOM.find(b,'.acqIcon');Arbiter.subscribe('FriendListMembershipChange',function(g,h){if(h.uid==c){var i=h.lists.contains(FriendStatus.CLOSE_FRIENDS),j=h.lists.contains(FriendStatus.ACQUAINTANCES);if(i&&!j){Button.setIcon(a,e);}else if(j&&!i){Button.setIcon(a,f);}else Button.setIcon(a,d);}});}};
function StreamProfileComposer(){}copy_properties(StreamProfileComposer.prototype,{init:function(a){var b=$(a);Arbiter.subscribe('composer/publish',function(event,c){if(c.streamStory)animation.prependInsert(b,c.streamStory);});}});
__d("RespondToRequestButton",["event-extensions","CSS","Menu"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('Menu'),i={init:function(j,k,l,m){Event.listen(k,'click',function(){g.addClass(k,'uiButtonConfirm');g.addClass(k,'selected');l.show();});l.subscribe('hide',function(){g.removeClass(k,'uiButtonConfirm');g.removeClass(k,'selected');});h.subscribe('select',function(n,o){if(!g.hasClass(o.menu,'requestResponseMenu'))return;if(o.item.firstChild.getAttribute('data-profileid')!=j)return;if(g.hasClass(o.item,'reject')){g.hide(k);g.show(m);}l.hide();});}};e.exports=i;});
__d("legacy:RespondToRequestButton",["RespondToRequestButton"],function(a,b,c,d){a.RespondToRequestButton=b('RespondToRequestButton');},3);
__d("legacy:menu-legacy",["Menu"],function(a,b,c,d){a.Menu=b('Menu');},3);
var PageLikeButton=window.PageLikeButton||(function(){function a(b,c,d,e,f){fbpage_set_fan_status(b,c,d,false,function(){Arbiter.inform(PageLikeButton.LIKED_SUCCESS,{profile_id:c});},e,{fan_origin:f});}return {LIKED:'liked',UNLIKED:'unliked',LIKED_SUCCESS:'liked_success',init:function(b,c,d,e,f,g){Arbiter.subscribe(PageLikeButton.LIKED,function(h,i){if(e===i.profile_id)b.swap();});Arbiter.subscribe(PageLikeButton.UNLIKED,function(h,i){if(e===i.profile_id){b.unswap();d.hideFlyout();}});Event.listen(c,'click',function(event){a(event.getTarget(),e,true,function(){Arbiter.inform(PageLikeButton.UNLIKED,{profile_id:e});},f);Arbiter.inform(PageLikeButton.LIKED,{profile_id:e});if(g)Arbiter.subscribe(PageLikeButton.LIKED_SUCCESS,function(h,i){app_data=URI.getRequestURI().getQueryData().app_data;if(i.profile_id==e)new AsyncRequest().setURI('/ajax/pages/fetch_app_column.php').setData({profile_id:e,tab_key:g,app_data:app_data}).send();});});},initUnlike:function(b,c,d){Event.listen(b,'click',function(event){a(event.getTarget(),c,false,function(){Arbiter.inform(PageLikeButton.LIKED,{profile_id:c});},d);Arbiter.inform.bind(Arbiter,PageLikeButton.UNLIKED,{profile_id:c}).defer();});}};})();
var TimelineAggregatePost={init:function(a){Event.listen(a,'click',function(b){var c=b.getModifiers();if(b.isMiddleClick()||c.access||c.meta)return true;var d=Parent.byTag(b.getTarget(),'li');if(!CSS.hasClass(d,'wallPostMorePager'))new AsyncRequest().setURI(DataStore.get(d,'url')).send();});},initPage:function(a){Event.listen(a,'click',function(b){var c=Parent.byClass(b.getTarget(),'uiCloseButton');if(c)return;var d=Parent.byTag(b.getTarget(),'li');new AsyncRequest().setURI(DataStore.get(d,'url')).send();});},poke:function(a){ScrollableArea.poke(a);},setScrollHeight:function(a){var b=DOM.find(a,'.sArea');CSS.setStyle(b,'height',a.offsetHeight+'px');}};
__d("SwapButton",["event-extensions","copyProperties","CSS"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('CSS');function i(j,k){if(j&&k){this._swapperButton=j;this._swappeeButton=k;Event.listen(j,'click',this.swap.bind(this));}}g(i.prototype,{_swapperButton:null,_swappeeButton:null,swap:function(){h.hide(this._swapperButton);h.show(this._swappeeButton);},unswap:function(){h.show(this._swapperButton);h.hide(this._swappeeButton);},init:function(j,k){this._swapperButton=j;this._swappeeButton=k;Event.listen(j,'click',this.swap.bind(this));}});e.exports=i;});
__d("HoverButton",["AsyncRequest","CSS","DOM","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('URI'),k=b('copyProperties');function l(m,n,o,p){if(m&&n){this._button=m;this._flyout=n;this._flyoutAjaxify=p;this._flyoutContent=o;n.subscribe('show',this._onShow.bind(this));n.subscribe('hide',this._onHide.bind(this));}}k(l.prototype,{_button:null,_flyout:null,_flyoutAjaxify:null,_flyoutContent:null,init:function(m,n,o,p){this._button=m;this._flyout=n;this._flyoutAjaxify=p;this._flyoutContent=o;n.subscribe('show',this._onShow.bind(this));n.subscribe('hide',this._onHide.bind(this));},showFlyoutBriefly:function(){this.showFlyout();this._flyout.hideFlyoutDelayed(5000);},showFlyout:function(){this._flyout.showFlyout(this._button,true);this._flyout.inform('show',this._button);},hideFlyout:function(){this._flyout.hideFlyout(true);this._flyout.inform('hide',this._button);},_onShow:function(m,n){h.addClass(n,'uiHoverButtonSelected');h.addClass(n,'selected');if(this._flyoutAjaxify){h.addClass(this._flyoutContent,'async_saving');new g().setURI(new j(this._flyoutAjaxify)).setHandler(function(o){h.removeClass(this._flyoutContent,'async_saving');i.setContent(this._flyoutContent,o.payload);}.bind(this)).send();this._flyoutAjaxify=null;}},_onHide:function(m,n){h.removeClass(n,'uiHoverButtonSelected');h.removeClass(n,'selected');},destroy:function(){this.hideFlyout();this._flyout.destroy();}});e.exports=l;});
__d("TooltipLink",["Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Parent'),h=b('Tooltip'),i={setTooltipText:function(j,k){j=g.byTag(j,'a');j&&h.set(j,k);}};e.exports=i;});
__d("legacy:TooltipLink",["TooltipLink"],function(a,b,c,d){a.TooltipLink=b('TooltipLink');},3);
__d("StickyController",["event-extensions","CSS","Vector","FunctionUtils","Style","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('Vector'),i=b('FunctionUtils'),j=b('Style'),k=b('copyProperties');function l(m,n,o,p){this._element=m;this._marginTop=n;this._onchange=o;this._proxy=p||m.parentNode;}k(l.prototype,{handleScroll:function(){var m=h.getElementPosition(this._proxy,'viewport').y<=this._marginTop;if(this.isFixed()!==m){j.set(this._element,'top',m?this._marginTop+'px':'');g.conditionClass(this._element,'fixed_elem',m);this._onchange&&this._onchange(m);}},start:function(){if(this._event)return;this._event=Event.listen(window,'scroll',i.throttle(this.handleScroll.bind(this),100));this.handleScroll.bind(this).defer();},stop:function(){this._event&&this._event.remove();this._event=null;},isFixed:function(){return g.hasClass(this._element,'fixed_elem');}});a.StickyController=e.exports=l;},3);
__d("TimelineConstants",[],function(a,b,c,d,e,f){var g={DS_HEIGHT:'timeline-unit-height',DS_LOADED:'timeline-capsule-loaded',DS_SIDEORG:'timeline-unit-sideorg',DS_TAILBALANCE:'timeline-capsule-tailbalance',DS_COLUMN_HEIGHT_DIFFERENTIAL:'timeline-column-diff-height',FIXED_SIDE_LEFT:'left',FIXED_SIDE_RIGHT:'right',FIXED_SIDE_BOTH:'both',SCROLL_TO_OFFSET:30,SUBSECTION_SCROLL_TO_OFFSET:90};e.exports=g;});
__d("TimelineURI",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={TIMELINE_KEY:'timeline',WALL_KEY:'wall',parseURI:function(i){i=g(i);var j=i.getQueryData(),k=i.getPath(),l=k.split('/').slice(1);if(l[0]=='people'||l[0]=='pages')l=l.slice(2);var m=j.sk||l[1]||h.TIMELINE_KEY;if(m==h.WALL_KEY)m=h.TIMELINE_KEY;var n=null,o=null;if(m==h.TIMELINE_KEY){o=parseInt(l[2],10)||null;n=parseInt(l[3],10)||null;}return {path:k,id:j.id||l[0],key:m,viewas:j.viewas?j.viewas:0,filter:j.filter?j.filter:null,year:o,month:n,friendship:!!j.and};}};e.exports=h;});
__d("TimelineController",["event-extensions","Arbiter","CSS","DataStore","DOM","FunctionUtils","Run","ScrollingPager","TimelineConstants","TimelineURI","Vector","$"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('FunctionUtils'),l=b('Run'),m=b('ScrollingPager'),n=b('TimelineConstants'),o=b('TimelineURI'),p=b('Vector'),q=b('$'),r=484,s=48,t=740,u=1285,v=1150,w=null,x=false,y,z,aa={},ba={},ca=[],da=null,ea=0,fa=false,ga=false,ha=false,ia={allactivity:true,approve:true,games:true,map:true,music:true,video:true};ia[o.TIMELINE_KEY]=true;var ja=[],ka=false;function la(ua,va,wa){wa=wa||[];if(aa[ua])return aa[ua][va].apply(aa[ua],wa);ba[ua]=ba[ua]||{};ba[ua][va]=wa;return false;}function ma(){if(!(fa||ha||ga)){da.remove();da=null;return;}var ua=p.getScrollPosition();fa=fa&&oa(q('rightCol'),ua,'paddingTop',true);ga=ga&&oa(q('pagelet_above_header_timeline'),ua,'top');ha=ha&&oa(q('blueBar'),ua,'paddingTop');}function na(){var ua=p.getScrollPosition(),va=ea===0||ua.y>=ea;la(ta.STICKY_HEADER,'toggle',[va]);la(ta.CONTENT,'checkCurrentSectionChange');}function oa(ua,va,wa,xa){if(va.y<=0){pa(ua,wa);return false;}else{var ya=xa&&ta.getCurrentScrubber();if(ya&&h.hasClass(ya.getRoot(),'fixed_elem')){pa(ua,wa);return false;}else{var za=parseInt(ua.style[wa],10)||0;if(va.y<za){h.addClass(ua,'timeline_fixed');ua.style[wa]=va.y+'px';}else h.removeClass(ua,'timeline_fixed');}}return true;}function pa(ua,va){ua.style[va]='0px';h.removeClass(ua,'timeline_fixed');}function qa(){la(ta.ADS,'adjustAdsType',[ta.shouldShowWideAds()]);la(ta.ADS,'adjustAdsToFit');la(ta.CONTENT,'adjustContentPadding');la(ta.STICKY_HEADER_NAV,'adjustMenuHeights');}function ra(ua,va){if(ua=='sidebar/initialized')ka=true;la(ta.ADS,'adjustAdsType',[ta.shouldShowWideAds()]);}function sa(){while(ca.length)ca.pop().remove();for(var ua in aa)aa[ua].reset&&aa[ua].reset();da&&da.remove();da=null;z.unsubscribe();z=null;w=null;y=null;aa={};ba={};ea=0;ga=false;if(fa){q('rightCol').style.paddingTop='';h.removeClass(q('rightCol'),'timeline_fixed');}fa=false;if(ha){q('blueBar').style.paddingTop='';h.removeClass(q('blueBar'),'timeline_fixed');}ha=false;ja=[];ka=false;x=false;i.purge(n.DS_HEIGHT);i.purge(n.DS_LOADED);i.purge(n.DS_SIDEORG);i.purge(n.DS_TAILBALANCE);}var ta={NAV:'nav',STICKY_HEADER:'sticky_header',STICKY_HEADER_NAV:'sticky_header_nav',SCRUBBER:'scrubber',CONTENT:'content',ADS:'ads',COVER:'cover',LOGGING:'logging',SECTION_LOADING:'TimelineController/sectionLoading',SECTION_LOADED:'TimelineController/sectionLoaded',SECTION_FULLY_LOADED:'TimelineController/sectionFullyLoaded',SECTION_REGISTERED:'TimelineController/sectionRegistered',SCRUBBER_DEFAULT_OFFSET:38,init:function(ua,va){if(x)return;if(va==o.WALL_KEY)va=o.TIMELINE_KEY;x=true;y=ua;la(ta.CONTENT,'adjustContentPadding');ca.push(Event.listen(window,'scroll',k.throttle(na,100)),Event.listen(window,'resize',k.throttle(qa,100)));z=g.subscribe(['sidebar/initialized','sidebar/show','sidebar/hide'],ra);l.onLeave(sa);ta.registerCurrentKey(va);},setAdsTracking:function(ua){la(ta.ADS,'start',[ua]);},coverHasExpanded:function(ua){q('rightCol').style.paddingTop=ua+'px';fa=true;var va=q('pagelet_above_header_timeline');if(va.firstChild){q('above_header_timeline_placeholder').style.height=va.offsetHeight+'px';va.style.top=ua+'px';ga=true;}var wa=document.documentElement;ha=wa.clientHeight<400||wa.clientWidth<wa.scrollWidth;if(ha)q('blueBar').style.paddingTop=ua+'px';da=Event.listen(window,'scroll',ma);},pageHasScrubber:function(ua){return !ua||ua.match(/^(og_)?app_/)||(ua in ia);},registerCurrentKey:function(ua){w=ua;var va=p.getViewportDimensions().y<t;la(ta.ADS,'setShortMode',[va,ua]);la(ta.ADS,'updateCurrentKey',[ua]);ea=ua==o.TIMELINE_KEY?r-s:0;},getCurrentKey:function(){return w;},getCurrentScrubber:function(){return aa[ta.SCRUBBER];},getCurrentStickyHeaderNav:function(){return aa[ta.STICKY_HEADER_NAV];},getSection:function(ua){return la(ta.CONTENT,'getSection',[ua]);},scrubberHasLoaded:function(ua){la(ta.STICKY_HEADER_NAV,'addTimePeriods',[ja]);la(ta.ADS,'registerScrubber',[ua]);},registerSectionKey:function(ua,va){if(ta.getCurrentScrubber()&&aa[ta.STICKY_HEADER_NAV]){la(ta.STICKY_HEADER_NAV,'addTimePeriod',[ua]);}else ja[va]=ua;},scrubberHasChangedState:function(){la(ta.ADS,'adjustAdsToFit');},scrubberWasClicked:function(ua){la(ta.LOGGING,'logScrubberClick',[ua]);},sectionHasChanged:function(ua,va){la(ta.STICKY_HEADER_NAV,'updateSection',[ua,va]);la(ta.SCRUBBER,'updateSection',[ua,va]);la(ta.ADS,'loadAdsFromUserActivity');la(ta.LOGGING,'logSectionChange',[ua,va]);},navigateToSection:function(ua){la(ta.CONTENT,'navigateToSection',[ua]);},shouldShowWideAds:function(){if(!ka)return false;var ua=h.hasClass(a.document.documentElement,'widePage')?v:u;if(a.ChatSidebar&&a.ChatSidebar.isVisible())ua+=a.ChatSidebar.getVisibleWidth();return p.getViewportDimensions().x>=ua;},sidebarInitialized:function(){return ka;},adjustStickyHeaderWidth:function(){la(ta.STICKY_HEADER,'adjustWidth');},register:function(ua,va){aa[ua]=va;if(ba[ua]){for(var wa in ba[ua])la(ua,wa,ba[ua][wa]);delete ba[ua];}},adjustScrollingPagerBuffer:function(ua,va){var wa=i.get(n.DS_COLUMN_HEIGHT_DIFFERENTIAL,va);if(!wa)return;var xa=m.getInstance(ua);xa&&xa.setBuffer(xa.getBuffer()+Math.abs(wa));},runOnceWhenSectionFullyLoaded:function(ua,va,wa){if(la(ta.CONTENT,'getSection',[va])){var xa=false;j.scry(aa[ta.CONTENT].getSection(va).node,'ol.fbTimelineCapsule').each(function(za){if(!xa&&i.get(n.DS_LOADED,za.id)===wa){ua();xa=true;}});if(xa)return;}var ya=g.subscribe(ta.SECTION_FULLY_LOADED,function(za,ab){if(ab.scrubberKey===va&&ab.pageIndex===wa){ua();ya.unsubscribe();}});}};e.exports=ta;});
__d("legacy:TimelineController",["TimelineController"],function(a,b,c,d){a.TimelineController=b('TimelineController');},3);
__d("TimelineDrag",["event-extensions","ArbiterMixin","Class","Locale","Style","Vector"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Locale'),j=b('Style'),k=b('Vector');function l(m,n,o){o=o||{};this._listenOn=o.listenOn;this._offsetInput=n;this._defaultOffset=o.default_offset;this._killClicks=o.killClicks;this._vertical=true;this._RTLXSwitch=false;this.setPicture(m,o);}h.mixin(l,g,{setPicture:function(m,n){if(!m)return false;n=n||{};this._picture=m;this._defaultOffset=n.default_offset;if(n.vertical!==undefined)this._vertical=n.vertical;if(this._vertical){if(n.height)this._containerHeight=n.height;this._offsetType='top';this._eventCoord='y';}else{if(n.width)this._containerWidth=n.width;this._RTLXSwitch=i.isRTL();this._offsetType='left';this._eventCoord='x';}if(this._picture.complete){this._initialLoad();}else this._loadListener=Event.listen(this._picture,'load',function(){this._loadListener.remove();this._initialLoad();}.bind(this));},destroy:function(){this._stopDrag();this._saveOffset();this._mousedown&&this._mousedown.remove();this._onclick&&this._onclick.remove();this._loadListener&&this._loadListener.remove();},_initialLoad:function(){var m=this._listenOn?this._listenOn:this._picture;this._mousedown&&this._mousedown.remove();this._mousedown=Event.listen(m,'mousedown',this._onMouseDown.bind(this));if(this._vertical){this._maxOffset=this._containerHeight-this._picture.offsetHeight;}else this._maxOffset=this._containerWidth-this._picture.width;if(this._defaultOffset!==undefined)this._setOffset(this._defaultOffset);this._onclick&&this._onclick.remove();if(this._killClicks)this._onclick=Event.listen(m,'click',this._onClick.bind(this));this._saveOffset();},_onClick:function(event){event.kill();},_onMouseDown:function(event){var m=parseInt(j.get(this._picture,this._offsetType),10)||0;this._pictureStartDragOffset=m-k.getEventPosition(event)[this._eventCoord];this._startDrag();event.kill();},_startDrag:function(){if(!this._dragStarted){this.inform('startdrag',this);this._dragTokens=[Event.listen(document.documentElement,'mouseup',this._onMouseUp.bind(this)),Event.listen(document.documentElement,'mousemove',this._onMouseMove.bind(this))];this._dragStarted=true;}},_saveOffset:function(){var m=parseInt(j.get(this._picture,this._offsetType),10);if(this._RTLXSwitch){this._offsetInput.value=m+this._containerWidth-this._picture.offsetWidth;}else this._offsetInput.value=m;},_stopDrag:function(){if(this._dragStarted){this.inform('stopdrag',this);this._dragStarted=false;this._dragTokens.each(function(m){m.remove();});this._saveOffset();}},_onMouseUp:function(event){this._stopDrag();event.kill();},_setOffset:function(m){if(this._RTLXSwitch){m=Math.max(0,Math.min(m,-this._maxOffset));}else m=Math.min(0,Math.max(m,this._maxOffset));j.set(this._picture,this._offsetType,m+'px');},_onMouseMove:function(event){this._setOffset(this._pictureStartDragOffset+k.getEventPosition(event)[this._eventCoord]);event.kill();}});e.exports=l;});
__d("TimelineCover",["Button","CSS","DOM","HTML","Parent","DOMScroll","Vector","TimelineController","TimelineDrag","Style","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('HTML'),k=b('Parent'),l=b('DOMScroll'),m=b('Vector'),n=b('TimelineController'),o=b('TimelineDrag'),p=b('Style'),q=b('copyProperties'),r=b('ge');function s(){}s.instance=null;s.getInstance=function(){return s.instance;};q(s.prototype,{init:function(t,u,v){this.root=t;this._parentSection=k.byClass(this.root,'fbTimelineSection');this._coverHeight=u;this.cover=i.find(this.root,'.cover');s.instance=this;this.previewing=v;this.editing=false;if(v){this.updateCoverImage(v);}else if(this.cover.getAttribute('data-collapse'))this._expandCover(parseInt(this.cover.getAttribute('data-collapse'),10));if(this.previewing)this.editMode();n.register(n.COVER,this);},showLoadingIndicator:function(){var t=r('fbCoverImageContainer');if(t)h.addClass(t,'opaquedLoading');},hideLoadingIndicator:function(){var t=r('fbCoverImageContainer');if(t)h.removeClass(t,'opaquedLoading');},editMode:function(){g.setEnabled(i.find(this.root,'label.cancelButton'),true);g.setEnabled(i.find(this.root,'label.saveButton'),true);this.hideLoadingIndicator();this._coverImage=i.scry(this.root,'.coverImage')[0];var t=i.scry(this._coverImage,'.coverWrap')[0];if(t)this._originalOffset=p.get(i.find(t,'.coverPhotoImg'),'top');h.addClass(this._parentSection,'fbEditCover');l.scrollTo(i.getDocumentBodyElement());if(this.previewing){i.remove(this._coverImage);h.show(this._coverImage);}var u=i.scry(this._coverImage,'.coverPhotoImg')[0];if(u)this._createDragger();this.editing=true;},_expandCover:function(t){this.cover.style.marginTop='0px';if(t!=m.getScrollPosition().y){window.scrollBy(0,t);n.coverHasExpanded(t);}},_exitEditMode:function(){if(this._timelineDrag){this._timelineDrag.destroy();this._timelineDrag=null;}i.find(this.root,'input.hiddenPhotoID').value=null;g.setEnabled(i.find(this.root,'label.cancelButton'),false);g.setEnabled(i.find(this.root,'label.saveButton'),false);h.removeClass(this._parentSection,'fbEditCover');this.hideLoadingIndicator();},_createDragger:function(){this._timelineDrag=new o(i.find(this.root,'.coverImage .coverPhotoImg'),i.find(this.root,'input.photoOffsetInput'),{height:this._coverHeight,listenOn:this.cover,vertical:true,killClicks:true});},updateCoverImage:function(t,u){if(u)this.editMode();i.find(this.root,'input.hiddenPhotoID').value=t;g.setEnabled(i.find(this.root,'label.saveButton'),true);if(u)i.replace(i.find(this.root,'.coverImage'),j(u));if(this._timelineDrag){this._timelineDrag.setPicture(i.find(i.find(this.root,'.coverImage'),'.coverPhotoImg'));}else this._createDragger();},cancelUpdate:function(){i.remove(i.scry(this.root,'.coverImage')[0]);this.cover.appendChild(this._coverImage);if(this._originalOffset!==undefined)p.set(i.find(this._coverImage,'.coverPhotoImg'),'top',this._originalOffset);this._exitEditMode();},saveComplete:function(){this._coverImage=i.scry(this.root,'.coverImage')[0];this._exitEditMode();},isInEditMode:function(){return this.editing;}});a.TimelineCover=e.exports=s;},3);
var TimelineLogging=(function(){var a=false,b=0,c=null;return {init:function(d){if(a)return;b=d;TimelineController.register(TimelineController.LOGGING,this);},reset:function(){a=false;b=0;c=null;},log:function(d,e){e.profile_id=b;report_data(d,{gt:e});},logSectionChange:function(d,e){var f={timeline_section_change:1,key:d};if(c&&d==c){f.timeline_scrubber=1;c=null;}TimelineLogging.log('timeline',f);},logScrubberClick:function(d){c=d;}};})();
__d("legacy:TimelineURI",["TimelineURI"],function(a,b,c,d){a.TimelineURI=b('TimelineURI');},3);
var TimelineNavigation=(function(){var a=4,b=110,c=20,d=119,e=328,f=10,g=3,h=false,i=21,j,k,l,m=[],n=[],o,p=0,q,r=0,s=0,t,u=a,v=false,w=false,x,y=false,z,aa,ba=false;function ca(pa,qa,ra){if(!qa.firstChild){DOM.remove(qa);return;}n.push(qa);fa(ra.recent);CSS.removeClass(Parent.byTag(qa,'li'),'empty');if(o&&(r>a||s>0))CSS.removeClass(o,'notready');ea();if(ra.async){ja();la();}}function da(pa,qa,ra){DOM.remove(Parent.byTag(qa,'li'));if(!ra.async){t++;}else{r--;ja();la();}ea();}function ea(){var pa=o?0:i;if(r<=a){var qa=e+d*Math.max(0,a-r)+pa;q.style.width=qa+'px';u=r;ga();}}function fa(pa){if(pa){s++;}else r++;ga();}function ga(){if(!z)return;var pa=Math.max(0,r-a)+s;if(p&&o){DOM.setContent(p,pa===0?" ":pa);CSS.conditionClass(o,'fbTimelineMoreButtonZero',pa===0);if(!v)CSS.conditionShow(o,pa>0);}}function ha(){var pa=DOM.scry($('fbTimelineNavTopRow'),'li.tile'),qa=0,ra=0,sa=Math.max(0,a-u),ta=false;for(var ua=0;ua<pa.length;ua++){if(pa[ua]==q||pa[ua]==o)continue;ta=((qa+sa)%a===0);CSS.conditionClass(pa[ua],'leftMost',(qa!==0&&ta));if(!CSS.hasClass(pa[ua],'empty'))ra=qa;qa++;}ta=((ra+1+sa)%a===0);var va=pa.length-1-sa;if(ta){if(v&&(ra+1+sa)/a<g){va=Math.min(va,ra+a);w=true;}else va=ra;}else{var wa=((ra+1+sa)%a);va=ra+(a-wa);w=false;}ua=0;for(ua=0;ua<=va;ua++)if(pa[ua]&&(pa[ua]==q||pa[ua]==o)){va++;}else pa[ua]&&CSS.hasClass(pa[ua],'empty')&&CSS.removeClass(pa[ua],'hidden_elem');}function ia(pa,qa,ra){var sa=DOM.scry(pa,'li.tile');if(!qa)qa=0;var ta=false;for(var ua=qa;ua<sa.length;ua++){ta=((ua-ra)%a===0);var va=sa[ua];CSS.conditionClass(va,'leftMost',ta);if(CSS.hasClass(va,'empty'))CSS.removeClass(va,'hidden_elem');}}function ja(){ha();var pa=ge('fbTimelineNavSecondaryRow');pa&&ia(pa,0,0);}function ka(){if(!o)return;if(CSS.hasClass(o,'notready'))return;CSS.toggleClass(o,'fbTimelineMoreButtonOpen');var pa=ge('fbRecentAppTitle');pa&&CSS.conditionClass(pa,'hidden_elem',s===0);if(CSS.hasClass(o,'fbTimelineMoreButtonOpen')){ja();}else ga();la();}function la(){if(o&&!CSS.hasClass(o,'fbTimelineMoreButtonOpen')){j.style.height='';CSS.removeClass(j,'expanded');}else{var pa=r+(a-u),qa=((s>0)?f:0)+b*(Math.ceil(s/a))+b*(Math.ceil(pa/a))+b*(w?1:0)+c;CSS.addClass(j,'expanded');j.style.height=qa+'px';}}function ma(pa){var qa=pa==TimelineURI.TIMELINE_KEY||pa==TimelineURI.WALL_KEY,ra=Parent.byClass(j,'fbTimelineTopSectionBase'),sa=ge('timeline_tour_toolbar');if(o){CSS.removeClass(o,'fbTimelineMoreButtonOpen');la();}sa&&CSS.conditionShow(sa,qa);if(ra)CSS.conditionClass(ra,'collapsedHead',!qa);}function na(event){if(ba)return true;if(!Parent.byTag(event.getTarget(),'a')){var pa=DOM.find(q,'a.title');PageTransitions.go(pa.href);}}function oa(){if(o)(function(){o.removeAttribute('ajaxify');o.removeAttribute('rel');}).defer();_removeAjaxifyRef.remove();}return {UPDATE_PAGE:'TimelineNavigation/updatePage',init:function(pa,qa,ra,sa){if(h)return;h=true;j=pa;o=qa;k=URI.getRequestURI();q=DOM.find(j,'li.about');ma(TimelineController.getCurrentKey());v=sa;Arbiter.inform(TimelineNavigation.UPDATE_PAGE);if(o){p=DOM.find(o,'div.text');_removeAjaxifyRef=Event.listen(o,'click',oa);}x=$('fbTimelineNavigationLoadContainer');DOM.appendContent($('content'),x);aa=Event.listen(q,'click',na);m.each(function(ua){if(!ua[2].remove){ca.apply(this,ua);}else da.apply(this,ua);});m=[];var ta=Parent.byClass(pa,'fbTimelineSection');if(ta)DOM.scry(ta,'ul.uiButtonGroup').each(function(ua){$A(ua.childNodes).each(function(va){va.childNodes.length||DOM.remove(va);});if(ua.firstChild){CSS.addClass(ua.firstChild,'firstItem');}else DOM.remove(ua);});TimelineController.register(TimelineController.NAV,TimelineNavigation);},reset:function(){aa&&aa.remove();aa=null;z&&z.remove();z=null;h=false;j=null;l=null;n=[];o=null;p=null;q=null;r=0;s=0;t=0;u=a;v=false;w=false;x=null;y=false;ba=false;},initializeMorePager:function(){if(z)return;if(o)z=Event.listen(o,'click',ka);},registerNav:function(pa,qa,ra){h?(ra.remove?da.apply(this,arguments):ca.apply(this,arguments)):m.push(arguments);},redraw:function(){ja();la();},setEditMode:function(pa){ba=pa;}};})();
var TimelineSideAds=(function(){var a=2,b=3,c=75,d='data-height',e=30000,f=false,g,h,i,j=[],k,l=false,m,n=Infinity,o=5,p=false,q,r,s,t,u=false;function v(la,ma,na){var oa=ma.getHeight();if(!oa)return;la-=oa;var pa=0;for(var qa=0;qa<na;qa++)pa+=ea(qa);if(la<pa){la+=ma.fold(pa-la);}else if(la>pa)la-=ma.unfold(la-pa);return la;}function w(){var la=g.cloneNode(true);la.id='';var ma=true;DOM.scry(la,'div.ego_unit').each(function(na){if(ma){ma=false;}else DOM.remove(na);});CSS.addClass(la,'fixed_elem');return la;}function x(){if(!TimelineController.pageHasScrubber(k)){aa(o);ca();}else if(r){ba(g,false);var la=s;s&&DOM.remove(s);s=w();if(la)ja();aa(TimelineController.sidebarInitialized()&&l?b:a);ca();if(!m){var ma=TimelineController.getCurrentScrubber();ma&&ia(ma);}m&&m.start();}else TimelineSideAds.adjustAdsToFit();}function y(){if(s){DOM.remove(s);s=null;}if(m){m.stop();m=null;}CSS.conditionClass(g,'fixed_elem',!r&&TimelineController.pageHasScrubber(k));}function z(la){var ma=Vector2.getViewportDimensions().y,na=TimelineController.getCurrentScrubber(),oa=na?na.getOffset():TimelineController.SCRUBBER_DEFAULT_OFFSET,pa=ma-oa-c;if(na)return v(pa,na,la);}function aa(la){i=Math.min(la,j.length);for(var ma=0;ma<j.length;ma++)ba(j[ma],ma>=i);ba(g,i===0);}function ba(la,ma){CSS.conditionClass(la,'fbTimelineSideAdsOffScreen',ma);la.setAttribute('aria-hidden',ma?'true':'false');}function ca(){for(var la=i-1;la>=0;--la){if(m&&m.isFixed()&&((la!==0)||(s&&!CSS.shown(s))))continue;var ma=DOM.find(j[la],'div.fbAdUnit'),na=ma.getAttribute('data-ad'),oa=JSON.parse(na).adid;if(!t[oa])return;var pa=$N('iframe',{src:URI('/ai.php').addQueryData({aed:t[oa]}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});pa.setAttribute('aria-hidden','true');DOM.appendContent(g,pa);delete t[oa];}}function da(la){var ma=0;while(la>0&&ma<o){la-=ea(ma);if(la>=0)ma++;}return ma;}function ea(la){var ma=j[la];if(!ma)return 0;if(!ma.getAttribute(d))fa(ma);return parseInt(ma.getAttribute(d),10);}function fa(la){la.setAttribute(d,la.offsetHeight);}function ga(){for(var la=0;la<j.length;la++){var ma=j[la];if(!ma)continue;fa(ma);}}function ha(){j=DOM.scry(g,'div.ego_unit');var la=j.length;if(!la)return;p=la;x();var ma=function(na){fa(na);p=--la;TimelineSideAds.adjustAdsToFit();if(!p)n=Date.now();};j.each(function(na){function oa(){ma.curry(na).defer();}var pa=DOM.scry(na,'img.img')[0];if(pa.complete){oa();}else Event.listen(pa,{load:oa,error:oa,abort:oa});});}function ia(la){m=new StickyController(la.getRoot(),la.getOffset(),function(ma){if(ma){ja();}else{DOM.remove(s);ca();}});if(s)m.start();}function ja(){DOM.insertAfter(g,s);ka();}function ka(){CSS.conditionShow(s,ea(0)<=z(1)&&!CSS.hasClass(document.documentElement,'tinyViewport'));}return {init:function(la,ma,na){if(f)return;o=na;f=true;h=ma;g=la;TimelineSideAds.adjustAdsType(TimelineController.shouldShowWideAds());TimelineController.register(TimelineController.ADS,TimelineSideAds);},setShortMode:function(la,ma){r=ma!=='map'&&la&&TimelineController.pageHasScrubber(ma);},start:function(la){t=la;q=null;ha();},updateCurrentKey:function(la){if(la==k)return;k=la;y();},loadAds:function(la){if(p||q)return;n=Infinity;q=UIPagelet.loadFromEndpoint('WebEgoPane',g.id,{pid:33,data:[h,false,'timeline_'+la,r?b:o]},{crossPage:true});},registerScrubber:function(la){CSS.conditionClass(la.getRoot(),'fixed_elem',!r);if(r)ia(la);!q&&TimelineSideAds.adjustAdsToFit();},loadAdsFromUserActivity:function(){if((Date.now()-n>=e)&&!CSS.hasClass(document.documentElement,'tinyViewport')&&(!m||m.isFixed())&&(!t||!t[j[0]]))TimelineSideAds.loadAds(k+'_refresh');TimelineSideAds.adjustAdsToFit();},adjustAdsType:function(la){if(la!=l){CSS.conditionClass(g,'fbTimelineVerticalAds',!la);s&&CSS.conditionClass(s,'fbTimelineVerticalAds',!la);l=la;ga();TimelineSideAds.adjustAdsToFit();}},adjustAdsToFit:function(){if(!g||u)return;u=true;var la=l?b:a;if(r){if(m&&s){m.handleScroll();if(m.isFixed()){CSS.conditionShow(s,ea(0)<=z(1)&&!CSS.hasClass(document.documentElement,'tinyViewport'));}else aa(la);ca();}}else{var ma=z(la);if(typeof ma!=='undefined'){aa(da(ma));if(!p)ca();}}u=false;},reset:function(){m&&m.stop();q&&q.cancel();j=[];l=false;m=null;q=null;p=null;r=null;s=null;k=null;f=false;}};})();
__d("TimelineStickyHeader",["Arbiter","CSS","DOM","TimelineController"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('TimelineController'),k=false,l=false,m,n,o,p={VISIBLE:'TimelineStickyHeader/visible',ADJUST_WIDTH:'TimelineStickyHeader/adjustWidth',init:function(q){if(k)return;k=true;m=q;n=i.find(q,'div.name');o=i.find(q,'div.actions');j.register(j.STICKY_HEADER,p);},reset:function(){k=false;l=false;},toggle:function(q){h.conditionClass(m,'fbTimelineStickyHeaderHidden',!q);if(q!==l){l=q;g.inform(p.VISIBLE,q);}},adjustWidth:function(){g.inform(p.ADJUST_WIDTH,n,g.BEHAVIOR_STATE);},getRoot:function(){return m;},setActions:function(q){if(k&&q){i.replace(o,q);o=q;}}};e.exports=a.TimelineStickyHeader||p;});
__d("legacy:TimelineStickyHeader",["TimelineStickyHeader"],function(a,b,c,d){a.TimelineStickyHeader=b('TimelineStickyHeader');},3);
__d("TimelineStickyHeaderNav",["array-extensions","event-extensions","function-extensions","Arbiter","ButtonGroup","CSS","DOM","Parent","Selector","Style","TimelineController","URI","UserAgent","Vector","ge"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ButtonGroup'),i=b('CSS'),j=b('DOM'),k=b('Parent'),l=b('Selector'),m=b('Style'),n=b('TimelineController'),o=b('URI'),p=b('UserAgent'),q=b('Vector'),r=b('ge'),s=false,t,u,v,w,x,y,z,aa,ba,ca,da,ea={},fa={},ga=[],ha=false,ia=[],ja=[],ka=[],la=[];function ma(event){var ab=k.byTag(event.getTarget(),'a'),bb=ab&&k.byAttribute(ab,'data-key');if(bb){n.navigateToSection(bb.getAttribute('data-key'));event.prevent();}}function na(ab,bb){var cb=l.getValue(bb);if(cb==='allStories')n.getSection(ab).expandSubSections();if(cb!=='activityLog')oa(bb);}function oa(ab){xa(ab,'highlights');xa(ab,'allStories');var bb=j.find(ab,'li.separator');i.conditionShow(bb,bb.previousSibling);}function pa(ab){if(ba[ab]&&!u.custom_subsection_menu){ua(ab);}else sa();n.adjustStickyHeaderWidth();}function qa(ab,bb){var cb=bb.key;if(ca[cb]){va(cb);pa(cb);}}function ra(ab,bb){var cb=bb.scrubberKey;va(cb);if(v===cb)pa(cb);}function sa(){w.hideItem(z);}function ta(ab){var bb=aa[ab],cb=ba[ab];if(!bb&&cb){bb=aa[ab]=z.cloneNode(true);var db=j.scry(bb,'li.activityLog a')[0];if(db)db.href=o(db.href).addQueryData({key:ab});var eb=n.getCurrentScrubber();if(cb.length)i.show(j.find(bb,'li.separator'));for(var fb=0;fb<cb.length;fb++){var gb=cb[fb].scrubberKey,hb=eb.getLabelForSubnav(cb[fb].parentKey,gb);if(hb)wa(bb,{key:gb,label:hb});}if(ya()){oa(bb);l.setSelected(bb,j.scry(bb,'option')[1].value,true);}la.push(l.listen(bb,'change',na.curry(ab,bb)));ja.push(Event.listen(bb,'click',ma));}return bb;}function ua(ab){var bb=ta(ab);j.insertAfter(z,bb);i.hide(z);for(var cb in aa){var db=aa[cb];i.conditionShow(db,db===bb);}w.showItem(z);}function va(ab){ba[ab]=n.getSection(ab).subSections;}function wa(ab,bb){var cb=j.create('a',{href:'#',rel:'ignore',className:'itemAnchor',tabIndex:0},j.create('span',{className:'itemLabel fsm'},bb.label));cb.setAttribute('aria-checked',false);var db=j.create('li',{className:'uiMenuItem uiMenuItemRadio uiSelectorOption'},cb);db.setAttribute('data-key',bb.key);db.setAttribute('data-label',bb.label);var eb=j.find(ab,'ul.uiMenuInner'),fb=j.create('option',{value:bb.key},bb.label),gb=j.find(ab,'select');if(bb.key==='recent'){j.prependContent(eb,db);j.insertAfter(gb.options[0],fb);}else{j.appendContent(eb,db);j.appendContent(gb,fb);}}function xa(ab,bb){var cb=j.scry(ab,'li.uiMenuItem');if(!cb)return;for(var db=0;db<cb.length;db++){var eb=cb[db];if(i.hasClass(eb,bb)||eb.getAttribute('data-key')==bb)j.remove(eb);}var fb=j.find(ab,'select'),gb=j.scry(fb,'option');for(db=0;db<gb.length;db++)if(gb[db].value===bb){j.remove(gb[db]);return;}}function ya(){return n.getCurrentKey()==='allactivity'||n.getCurrentKey()==='approve';}var za={init:function(ab,bb){if(s)return;s=true;t=ab;u=bb||{};x=j.find(t,'div.pageMenu');y=j.find(t,'div.sectionMenu');z=j.find(t,'div.subsectionMenu');da=j.find(x,'li.uiMenuSeparator');w=h.getInstance(x);aa={};ba={};ca={};za.adjustMenuHeights();n.register(n.STICKY_HEADER_NAV,za);},reset:function(){s=false;u={};ga=[];ea={};fa={};ha=false;ia=[];x=null;y=null;z=null;da=null;aa={};ba={};ca={};while(ja.length)ja.pop().remove();ka.each(g.unsubscribe);la.each(l.unsubscribe.bind(l));},addTimePeriods:function(ab){if(!ab.length)return;j.setContent(j.find(y,'ul.uiMenuInner'),'');j.remove(j.find(y,'select').children[1]);while(ab.length){var bb=ab.shift();bb&&za.addTimePeriod(bb);}w.showItem(y);var cb=l.getSelectorMenu(y);ja.push(Event.listen(cb,'click',ma));var db=ya()?n.SECTION_REGISTERED:n.SECTION_LOADED,eb=ya()?ra:qa;ka.push(g.subscribe(db,eb));},addTimePeriod:function(ab){var bb=n.getCurrentScrubber().getLabelForNav(ab);if(!bb)return;wa(y,{key:ab,label:bb});var cb=j.find(y,'ul.uiMenuInner');if(ab==='recent'||cb.children.length<2)l.setSelected(y,ab,true);},updateSection:function(ab,bb){if(bb){var cb=ta(ab);if(cb){l.setSelected(cb,bb);oa(cb);}else v=ab;}else{ca[ab]=true;va(ab);}l.setSelected(y,ab,true);pa(ab);},adjustMenuHeights:function(){if(p.ie()<=7)return;[x,y].each(function(ab){var bb='';if(!i.hasClass(document.documentElement,'tinyViewport')){bb=q.getViewportDimensions().y-q.getElementDimensions(r('blueBar')).y-80;bb+='px';}m.set(j.find(ab,'ul.uiMenuInner'),'maxHeight',bb);});},initPageMenu:function(ab,bb){function cb(db,eb){db.each(function(fb){var gb=fa[fb]=j.create('li');i.hide(gb);eb?j.insertBefore(da,gb):j.appendContent(j.find(x,'ul.uiMenuInner'),gb);});}cb(ab,true);cb(bb,false);ea.info=j.scry(x,'li')[0];ga=bb;ha=true;if(ia.length)ia.each(function(db){za.registerPageMenuItem(db.key,db.item);});},registerPageMenuItem:function(ab,bb){if(!ha){ia.push({key:ab,item:bb});return;}if(fa[ab]){j.replace(fa[ab],bb);ea[ab]=bb.getNodes()[0];delete fa[ab];if(ga.indexOf(ab)>=0)i.show(da);}},removeTimePeriod:function(ab){xa(y,ab);}};e.exports=za;});
__d("legacy:TimelineStickyHeaderNav",["TimelineStickyHeaderNav"],function(a,b,c,d){a.TimelineStickyHeaderNav=b('TimelineStickyHeaderNav');},3);
__d("legacy:TimelineThrottler",["TimelineThrottler"],function(a,b,c,d){a.TimelineThrottler=b('TimelineThrottler');},3);
__d("legacy:TimelineCover",["TimelineCover"],function(a,b,c,d){a.TimelineCover=b('TimelineCover');},3);
__d("HubsTypeaheadView",["Class","ContextualTypeaheadView","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('copyProperties');function j(k,l){this.parent.construct(this,k,l);}g.extend(j,h);i(j.prototype,{render:function(k,l,m){if(this.alwaysRender&&k!==''){var n=k.toLowerCase().trim(),o=false;for(var p=0;p<l.length;p++)if(n==l[p].text.toLowerCase()){o=true;break;}if(!o)l.push({text:k,type:'calltoaction'});}return this.parent.render(k,l,m);}});e.exports=j;});
__d("legacy:HubsTypeaheadView",["HubsTypeaheadView"],function(a,b,c,d){a.HubsTypeaheadView=b('HubsTypeaheadView');},3);
__d("TypeaheadSetPhotoOnSelect",["event-extensions","function-extensions","CSS","DOM","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('copyProperties');function j(k){this._typeahead=k;}i(j.prototype,{_eventListener:null,_subscription:null,enable:function(){var k=h.scry(this._typeahead.getElement(),'.photo')[0];if(k){if(!h.isNodeOfType(k,'img')){var l=h.create('img',{className:k.className});h.replace(k,l);k=l;}var m=g.hide.curry(k),n=g.show.curry(k);this._eventListener=Event.listen(k,{load:n,error:m,abort:m});this._subscription=this._typeahead.subscribe('select',function(o,p){var q=p.selected.photo||this._typeahead.view.fallbackPhoto;q?k.setAttribute('src',q):m();}.bind(this));}},disable:function(){this._eventListener.remove();this._eventListener=null;this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=j;});
__d("legacy:SetPhotoOnSelectTypeaheadBehavior",["TypeaheadSetPhotoOnSelect"],function(a,b,c,d){var e=b('TypeaheadSetPhotoOnSelect');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.setPhotoOnSelect=function(f){f.enableBehavior(e);};},3);
__d("legacy:LayerHideOnBlur",["LayerHideOnBlur"],function(a,b,c,d){a.LayerHideOnBlur=b('LayerHideOnBlur');},3);
__d("TimelinePerfConfig",["Util"],function(a,b,c,d,e,f){var g=b('Util'),h=null,i=function(){if(h===null)return false;return true;},j={init:function(k){h=k;},getDisablePageletThrottle:function(){return i()&&(h.disablePageletThrottle||h.disableAllThrottle);},getDisableAllThrottle:function(){return i()&&h.disableAllThrottle;},getDisableSpineHeight:function(){return i()&&h.disableSpineHeight;}};e.exports=j;});
__d("TimelineSmartInsert",["CSS","DOM","Run","UserAgent","Vector"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Run'),j=b('UserAgent'),k=b('Vector'),l=false,m=false;function n(){if(m)return;i.onLeave(o);m=true;}function o(){l=false;m=false;}var p={BUFFER:100,run:function(q,r){n();if(!l||j.ie()<=8){r();return;}var s=q.offsetHeight;r();var t=q.offsetHeight;if(t-s!==0&&k.getElementPosition(q).y+s<k.getScrollPosition().y+p.BUFFER)window.scrollBy(0,t-s);},enable:function(){l=true;}};e.exports=p;});
__d("TimelineThrottler",["event-extensions","Arbiter","FunctionUtils","TimelinePerfConfig","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('FunctionUtils'),i=b('TimelinePerfConfig'),j=b('copyProperties');function k(l){this.id=l;this.idle=true;this.keys={};this.queue=[];this.config={};this.configure();k.instances[l]=this;}k.getInstance=function(l){return k.instances[l]||new k(l);};k.instances={};k.config={};k.REQUEUE='requeue';g.subscribe("Timeline/throttle",function(l,m){k.config=m;for(var n in k.instances)k.instances[n].configure();});j(k.prototype,{configure:function(){if(this._handle)this._handle.remove();var l=h.debounce(function(){this.idle=true;this._process();}.bind(this),k.config.scrollDelay||400),m=h.throttle(function(){this.idle=false;l();}.bind(this),k.config.scrollThrottle||100);this._handle=Event.listen(window,'scroll',m);j(this.config,k.config[this.id]);},cancel:function(){this.idle=true;this.keys={};this.queue=[];this.config={};this._handle&&this._handle.remove();},_limit:function(l,m,n){if(i.getDisableAllThrottle()){l();return;}var o=l;if(m){if(this.keys[m])if(n){this.queue.splice(this.queue.indexOf(this.keys[m]),1);}else return;this.keys[m]=l;o=function(){delete this.keys[m];l();}.bind(this);}this.queue.push(o);this._process();},throttle:function(l,m){this._limit(l,m,false);},debounce:function(l,m){this._limit(l,m,true);},_process:function(){if(this.idle&&this.queue.length){var l=this.queue.shift(),m=l();if(m===k.REQUEUE)this.queue.push(l);setTimeout(this._process.bind(this),this.config.delay||0);}}});e.exports=k;});
__d("TimelineContentLoader",["Arbiter","ArrayUtils","CSS","DOM","DOMScroll","FunctionUtils","ObjectUtils","OnVisible","ScrollingPager","TimelineConstants","TimelineController","TimelinePerfConfig","TimelineSmartInsert","TimelineThrottler","TimelineURI","UIPagelet","UserAgent","Vector","$","copyProperties","ge","tx","userAction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArrayUtils'),i=b('CSS'),j=b('DOM'),k=b('DOMScroll'),l=b('FunctionUtils'),m=b('ObjectUtils'),n=b('OnVisible'),o=b('ScrollingPager'),p=b('TimelineConstants'),q=b('TimelineController'),r=b('TimelinePerfConfig'),s=b('TimelineSmartInsert'),t=b('TimelineThrottler'),u=b('TimelineURI'),v=b('UIPagelet'),w=b('UserAgent'),x=b('Vector'),y=b('$'),z=b('copyProperties'),aa=b('ge'),ba=b('tx'),ca=b('userAction'),da=false,ea=false,fa,ga={},ha=null,ia={},ja=[],ka=[],la={},ma={},na={},oa=null,pa=null,qa=null,ra=false,sa=null;function ta(eb,fb,gb,hb,ib){this.node=eb;this.loaded=hb;this.canScrollLoad=true;this.canUnload=fb!=db.RECENT;this.scrubberKey=fb;this.historicUnitCount=ib;this._pageletLoadData=gb;this._expandPageletLoadData={};}z(ta.prototype,{load:function(eb){if(this.loaded)return;var fb=this._pageletLoadData;g.inform(q.SECTION_LOADING,{data:fb,scrubberKey:this.scrubberKey});this.loaded=true;i.removeClass(this.node,'fbTimelineTimePeriodUnexpanded');i.removeClass(this.node,'fbTimelineTimePeriodSuppressed');var gb='ProfileTimelineSectionPagelet';if(this.scrubberKey==db.WAY_BACK)gb='ProfileTimelineRemainingYearsPagelet';fb.time_cutoff=db.getTimeCutoff();fb.highlight_unit_data=eb;fb.parent_key=this.parentKey;fb.force_no_friend_activity=ra;i.addClass(this.node,'fbTimelineSectionLoading');var hb=null;if(!eb&&!r.getDisablePageletThrottle())hb=xa.curry(this.node);if(this.canUnload&&ea){var ib=this.node.firstChild.cloneNode(true);i.hide(ib);j.insertAfter(this.node,ib);}else this.canScrollLoad=false;na[this.scrubberKey]=v.loadFromEndpoint(gb,this.node.id,fb,{usePipe:true,jsNonblock:true,constHeight:true,displayCallback:hb});cb(this.scrubberKey);},preload:function(){i.addClass(this.node,'fbTimelineTimePeriodSuppressed');i.removeClass(this.node,'fbTimelineTimePeriodUnexpanded');var eb=j.find(this.node,'span.sectionLabel');if(eb.getAttribute('data-original-label')){j.setContent(eb,eb.getAttribute('data-original-label'));eb.removeAttribute('data-original-label');}},unload:function(){if(!this.loaded||!this.canUnload)return;this.loaded=false;na[this.scrubberKey]&&na[this.scrubberKey].cancel();i.addClass(this.node,'fbTimelineTimePeriodUnexpanded');i.removeClass(this.node,'fbTimelineTimePeriodSuppressed');if(this.node.nextSibling&&i.hasClass(this.node.nextSibling,'fbTimelineSection')){j.setContent(this.node,this.node.nextSibling);i.show(this.node.firstChild);}else j.empty(this.node);this.deactivateScrollLoad();},activateScrollLoad:function(){this.canScrollLoad=true;i.removeClass(this.node,'fbTimelineTimePeriodSuppressed');i.addClass(this.node,'fbTimelineTimePeriodUnexpanded');ma[this.scrubberKey]&&ma[this.scrubberKey].reset();},deactivateScrollLoad:function(){if(!this.loaded){this.canScrollLoad=false;i.removeClass(this.node,'fbTimelineTimePeriodUnexpanded');i.addClass(this.node,'fbTimelineTimePeriodSuppressed');ma[this.scrubberKey]&&ma[this.scrubberKey].remove();}},setExpandLoadData:function(eb){this._expandPageletLoadData=eb;return this;},expandSubSections:function(){if(this.subSections.length)db.navigateToSection(this.subSections[0].scrubberKey);},expand:function(eb){if(!this.loaded)return;qa.add_event('expand_'+this.scrubberKey);var fb=j.find(this.node,'.fbTimelineSectionExpander');i.addClass(fb.firstChild,'async_saving');eb&&i.addClass(eb,'async_saving');this._expandPageletLoadData.time_cutoff=db.getTimeCutoff();na[this.scrubberKey]&&na[this.scrubberKey].cancel();na[this.scrubberKey]=v.loadFromEndpoint('ProfileTimelineSectionPagelet',fb.id,this._expandPageletLoadData,{usePipe:true,jsNonblock:true,constHeight:true});},isPermalinkPeriod:function(){return this._pageletLoadData.is_permalink_period;}});function ua(){if(da)return;q.register(q.CONTENT,db);qa=ca('scrubber').set_namespace('timeline').set_ua_id('scrubber');da=true;if(w.ie()<=7)ea=true;}var va=l.debounce(function(eb,fb,gb){var hb=db.getSection(eb).historicUnitCount;fb-=hb;gb-=1;if(hb==-1||gb<=0||fb<0)return;var ib=db.getNextSectionKey(eb);if(ib){db.getSection(ib).load();va(ib,fb,gb);}},500),wa={};function xa(eb,fb){oa=t.getInstance('displayPagelet');oa.throttle(function(){var gb=x.getViewportDimensions().y,hb=x.getScrollPosition().y,ib=hb+gb,jb=hb+gb*(oa.config.fociRatio||.5),kb=x.getElementPosition(eb).y;if(kb>jb)if(kb<ib){wa[eb.id]=(wa[eb.id]||0)+1;if(wa[eb.id]<(oa.config.fociPenalty||3))return t.REQUEUE;}else{delete wa[eb.id];return t.REQUEUE;}delete wa[eb.id];fb();});}function ya(eb,fb,gb){var hb=db.getNextSectionKey(fb);if(hb)ma[hb]=new n(eb,za.curry(hb),false,gb||1000);}function za(eb){if(ga[eb].canScrollLoad){qa.add_event("scroll_load_"+eb);if(ea){db.getSection(eb).preload();}else{db.getSection(eb).load();if(sa)va(eb,sa.required_units,sa.max_parallelism);}}}function ab(){var eb,fb,gb=false;for(var hb=0;hb<ja.length;hb++){var ib=ja[hb];if(!ib)continue;var jb=db.getSection(ib);if(jb.canScrollLoad||jb.loaded){if(!jb.loaded){i.removeClass(jb.node,'fbTimelineTimePeriodSuppressed');i.addClass(jb.node,'fbTimelineTimePeriodUnexpanded');}if(eb&&fb){bb(eb,fb);if(gb)eb.deactivateScrollLoad();gb=true;}eb=null;fb=null;continue;}else if(eb){fb=jb;jb.deactivateScrollLoad();}else{eb=jb;if(gb)jb.activateScrollLoad();}i.removeClass(jb.node,'fbTimelineTimePeriodSuppressed');i.addClass(jb.node,'fbTimelineTimePeriodUnexpanded');}}function bb(eb,fb){i.removeClass(fb.node,'fbTimelineTimePeriodUnexpanded');i.addClass(fb.node,'fbTimelineTimePeriodSuppressed');var gb=j.find(eb.node,'span.sectionLabel'),hb=j.find(fb.node,'span.sectionLabel');if(!hb.getAttribute('data-original-label'))hb.setAttribute('data-original-label',j.getText(hb));if(gb.getAttribute('data-month')&&hb.getAttribute('data-month')&&gb.getAttribute('data-year')==hb.getAttribute('data-year')){j.setContent(hb,ba._("Show {month1} - {month2} {year}",{month1:hb.getAttribute('data-month'),month2:gb.getAttribute('data-month'),year:gb.getAttribute('data-year')}));}else if(gb.getAttribute('data-year')!==hb.getAttribute('data-year')){j.setContent(hb,ba._("Show {year1} - {year2}",{year1:hb.getAttribute('data-year'),year2:gb.getAttribute('data-year')}));}else j.setContent(hb,ba._("Show {year}",{year:hb.getAttribute('data-year')}));}function cb(eb){if(ea)for(var fb=0;fb<ja.length-1;fb++){var gb=ja[fb];if(!gb)continue;if(gb!=eb){var hb=ga[gb];if(hb.loaded&&hb.canUnload)hb.unload();}}ab();}var db={WAY_BACK:'way_back',RECENT:'recent',HEADER_SCROLL_CUTOFF:80,CURRENT_SECTION_OFFSET:150,registerTimePeriod:function(eb,fb,gb,hb,ib,jb,kb){ua();if(ka.contains(fb))return;var lb=new ta(eb,fb,gb,hb,kb);if(!ib){ja[jb]=fb;ia[fb]=true;}else{lb.parentKey=ib;ga[ib].subSections=ga[ib].subSections||[];ga[ib].subSections[jb]=lb;}ga[fb]=lb;g.inform(q.SECTION_REGISTERED,{scrubberKey:fb});q.registerSectionKey(fb,jb);},reset:function(){for(var eb in ma)ma[eb].remove();for(var fb in na)na[fb].cancel();fa&&fa.unsubscribe();fa=null;oa&&oa.cancel();oa=null;ga={};ha=null;ia={};ja=[];ka=[];la={};ma={};na={};pa=null;qa=null;ra=false;da=false;},checkCurrentSectionChange:function(){var eb=db.getCurrentSection(),fb=ha&&ha.scrubberKey;if(eb&&eb.scrubberKey!==fb&&!eb.isPermalinkPeriod()){ha=eb;var gb=eb.scrubberKey,hb=eb.parentKey;if(!hb){hb=gb;gb=null;}q.sectionHasChanged(hb,gb);}},setTimeCutoff:function(eb){pa=eb;},getTimeCutoff:function(){return pa;},setParallelLoadConfig:function(eb){sa=eb;},getCurrentSection:function(){var eb={};for(var fb in ga){var gb=ga[fb];if(!gb.loaded||la[gb.scrubberKey])continue;var hb=x.getElementPosition(gb.node,'viewport').y;if(gb.scrubberKey=='recent')hb--;if(hb<db.CURRENT_SECTION_OFFSET)eb[hb]=gb;}var ib=Math.max.apply(null,m.getKeys(eb)),jb=ib==-Infinity;if(!jb){return eb[ib];}else if(ja[0])return ga[ja[0]];return null;},capsuleForCurrentSection:function(){var eb=db.getCurrentSection();return eb&&j.scry(eb.node,'ol.fbTimelineCapsule')[0];},enableScrollLoad:function(eb,fb,gb){var hb=j.scry(eb.parentNode,'ol.fbTimelineCapsule')[0];if(!hb)return;ya(eb,fb,gb);},getSection:function(eb){return ga[eb];},getNextSectionKey:function(eb){for(var fb=0;fb<ja.length-1;fb++)if(ja[fb]==eb){while(fb<ja.length-1&&!ja[fb+1])fb++;return ja[fb+1];}var gb=db.getSection(eb);if(!gb||!gb.parentKey)return;var hb=db.getSection(gb.parentKey);if(!hb)return;for(var ib=0;ib<hb.subSections.length-1;ib++)if(hb.subSections[ib].scrubberKey==eb)return hb.subSections[ib+1].scrubberKey;},hideSection:function(eb){var fb=db.getSection(eb);fb&&i.hide(fb.node);var gb=q.getCurrentScrubber();if(gb){var hb=q.getCurrentScrubber().getNav(eb);hb&&i.hide(hb);}var ib=q.getCurrentStickyHeaderNav();ib&&ib.removeTimePeriod(eb);la[eb]=true;},removeSection:function(eb){for(var fb in ja)if(ja[fb]==eb){ja[fb]=null;break;}delete ga[eb];delete ia[eb];if(eb in ma){ma[eb].remove();delete ma[eb];}ka.push(eb);},navigateToSection:function(eb,fb,gb){qa.add_event("nav_"+eb);fb=!!fb;var hb=eb,ib=db.getSection(eb);if(!ib)return;if(!ib.loaded)s.enable();if(!ia[eb]){ib.node.style.minHeight=x.getViewportDimensions().y+'px';var jb=g.subscribe(q.SECTION_FULLY_LOADED,function(qb,rb){if(rb.scrubberKey===eb){ib.node.style.minHeight='';jb.unsubscribe();}});hb=ib.parentKey;var kb=db.getSection(hb).node;if(!i.hasClass(kb,'fbTimelineSectionExpanded')){k.scrollTo(kb,0);i.addClass(kb,'fbTimelineSectionExpanded');j.scry(kb,'ol.fbTimelineCapsule').each(j.remove);j.scry(kb,'div.fbTimelineSectionExpandPager').each(j.remove);j.scry(kb,'div.fbTimelineContentHeader').each(j.remove);}}for(var lb=0;lb<ja.length;lb++){var mb=ja[lb];if(!mb)continue;if(mb==hb)break;db.getSection(mb).deactivateScrollLoad();j.scry(y('timeline_tab_content'),'.fbTimelineSectionExpandPager').each(function(qb){var rb=o.getInstance(qb.id);rb&&rb.removeOnVisible();});}db.adjustContentPadding();ib.load(gb);ab();var nb=x.getScrollPosition().x,ob=x.getElementPosition(ib.node).y;if(!fb){var pb=ia[eb]?p.SCROLL_TO_OFFSET:p.SUBSECTION_SCROLL_TO_OFFSET;k.scrollTo(new x(nb,ob-pb,'document'),true,false,false,function(){var qb=x.getElementPosition(ib.node).y;k.scrollTo(new x(nb,qb-pb,'document'),false);var rb=j.scry(ib.node,'h3.uiHeaderTitle')[0];rb&&rb.focus();});}},adjustContentPadding:function(){var eb=aa('timeline_tab_content');if(!eb)return;var fb=q.getCurrentKey()||u.TIMELINE_KEY;if(fb!==u.TIMELINE_KEY)return;var gb=db.getSection(db.WAY_BACK);eb.style.paddingBottom=gb&&gb.loaded?null:x.getViewportDimensions().y-db.CURRENT_SECTION_OFFSET-db.HEADER_SCROLL_CUTOFF+'px';},suppressSectionsAbove:function(eb){var fb,gb;for(var hb=0;hb<ja.length;hb++){var ib=ja[hb];if(!ib)continue;fb=db.getSection(ib).node;gb=null;if(h.createFrom(eb.parentNode.children).indexOf(eb)<=h.createFrom(fb.parentNode.children).indexOf(fb)){gb=ib;break;}db.getSection(ib).deactivateScrollLoad();}if(gb)db.navigateToSection(gb,true);},forceNoFriendActivity:function(){ra=true;},removeDupes:function(eb){var fb=aa(eb);if(!fb)return;var gb=j.scry(fb,'li.fbTimelineUnit'),hb={};for(var ib=0;ib<gb.length;ib++){var jb=gb[ib];if(jb.id&&jb.id.startsWith('tl_unit_')){var kb=jb.id.substring(8,jb.id.length),lb=(jb.getAttribute('data-unit')=='ExperienceSummaryUnit'?jb.getAttribute('data-time'):1);if(hb.hasOwnProperty(kb)&&hb[kb]==lb){j.remove(jb);}else hb[kb]=lb;}}}};e.exports=a.TimelineContentLoader||db;});
__d("TimelineCapsule",["$","Arbiter","ArrayUtils","CSS","DataStore","DOM","DOMScroll","ge","Hovercard","ObjectUtils","Parent","TimelineConstants","TimelineContentLoader","TimelineController","TimelineSmartInsert","TimelineThrottler","UserAgent","Util","Vector","isEmpty"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('ArrayUtils'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('DOMScroll'),n=b('ge'),o=b('Hovercard'),p=b('ObjectUtils'),q=b('Parent'),r=b('TimelineConstants'),s=b('TimelineContentLoader'),t=b('TimelineController'),u=b('TimelineSmartInsert'),v=b('TimelineThrottler'),w=b('UserAgent'),x=b('Util'),y=b('Vector'),z=b('isEmpty'),aa=(function(){var ba=45,ca=15,da={},ea={},fa={},ga={};function ha(za){return j.hasClass(za,'fbTimelineBalancer');}function ia(za){return za.getAttribute('data-spine');}function ja(za){return j.hasClass(za,'placeholderUnit');}function ka(za){return za.getAttribute('data-fixed');}function la(za,ab){if(ab)return p.coalesce(k.get(r.DS_SIDEORG,za.id),za.getAttribute('data-side'));return za.getAttribute('data-side');}var ma=function(za,ab){if(w.ie()<=6){ma=function(bb,cb){k.set(r.DS_SIDEORG,bb.id,la(bb,true));bb.setAttribute('data-side',cb);j.removeClass(bb,'leftColumn');j.removeClass(bb,'rightColumn');j.addClass(bb,cb=='l'?'leftColumn':'rightColumn');};}else ma=function(bb,cb){k.set(r.DS_SIDEORG,bb.id,la(bb,true));bb.setAttribute('data-side',cb);};ma(za,ab);};function na(za){return za.getAttribute('data-size');}var oa=function(za,ab){if(ha(za))return;if(ab){j.addClass(za,'balancingCapsule');}else j.removeClass(za,'balancingCapsule');};function pa(za){if(j.hasClass(za,'fbTimelineIndeterminateContent'))return 0;return ca;}function qa(za){var ab=0;if(j.shown(za)&&!j.hasClass(za,'placeholderUnit'))ab=za.offsetHeight+pa(za);k.set(r.DS_HEIGHT,za.id,ab);}function ra(za){var ab=k.get(r.DS_HEIGHT,za.id,null);return ab;}function sa(za,ab){if(na(ab)=='2'){return 0;}else if(la(ab)=='r'){return za+ra(ab);}else return za-ra(ab);}function ta(za){var ab=za.parentNode;if(!ab)return;var bb=document.createDocumentFragment(),cb=za.firstChild;while(cb.firstChild)bb.appendChild(cb.firstChild);u.run(ab,l.replace.curry(za,bb));h.inform('TimelineCapsule/balanced',{capsule:ab});}function ua(za){for(var ab=0;ab<za.children.length;ab++){var bb=za.children[ab];if(!bb.getAttribute('data-endmarker'))continue;var cb=bb.getAttribute('data-endmarker'),db=bb.getAttribute('data-pageindex'),eb=function(){k.set(r.DS_LOADED,za.id,db);l.remove(bb);h.inform(t.SECTION_FULLY_LOADED,{scrubberKey:cb,pageIndex:db,capsuleID:za.id,childCount:za.children.length});};if(s.getSection(cb)){eb();}else var fb=h.subscribe(t.SECTION_REGISTERED,function(gb,hb){if(hb.scrubberKey===cb){eb();fb.unsubscribe();}});break;}}function va(za,ab,bb){while(ab[0])ma(ab.pop(),'l');while(bb[0])ma(bb.pop(),'r');if(ha(za))ta(za);ua(za);}function wa(za){var ab=ha(za)?za.firstChild:za,bb=ab.childNodes.length,cb=[],db;if(da[za.id]){if(z(da[za.id]))return;var eb={},fb,gb,hb,ib;for(fb=0;fb<bb;fb++){gb=ab.childNodes[fb];if(!ia(gb))eb[gb.id]=gb.offsetTop;}for(fb=0;fb<bb;++fb){gb=ab.childNodes[fb];if(ia(gb)){continue;}else if(da[za.id][gb.id]){cb.push(gb);continue;}else if(db&&cb.length&&na(db)!='2'){hb=eb[db.id]+ba;ib=eb[gb.id];if(na(gb)=='2')ib-=ba;var jb;while(hb<=ib){jb=cb.shift();if(!jb)break;j.show(jb);jb.style.top=hb+"px";hb+=ba;}while(cb[0])j.hide(cb.pop());}db=gb;}while(cb[0])j.hide(cb.pop());}oa(za,false);}function xa(za,ab){var bb=q.byAttribute(za,'data-size');if(bb){if(j.hasClass(za.parentNode,'timelineReportContent')){ab(za);}else ab(bb);aa.balanceCapsule(q.byClass(bb,'fbTimelineCapsule'));}}function ya(za){var ab=0;for(var bb=0;bb<za.childNodes.length;bb++)if(j.hasClass(za.childNodes[bb],'fbTimelineUnit'))ab++;return ab;}return {getUnitsWithTime:function(za){return l.scry(za,'.timelineUnitContainer').filter(function(ab){return (ab.parentNode.parentNode===za&&ab.getAttribute('data-time'));});},removeUnit:function(za){xa(za,function(ab){l.remove(ab);});},hideUnit:function(za){xa(za,function(ab){j.addClass(ab,'fbTimelineColumnHidden');});},undoHideUnit:function(za,ab){l.remove(q.byClass(ab,'hiddenText'));xa(za,function(bb){j.removeClass(bb,'fbTimelineColumnHidden');});},unplacehold:function(za){var ab=g(za);ab.style.top=null;j.removeClass(ab,'visiblePlaceholder');j.removeClass(ab,'placeholder');var bb=q.byClass(ab,'fbTimelineCapsule');delete da[bb.id][za];aa.balanceCapsule(bb);},insertInline:function(za,ab){var bb;for(var cb=0;cb<za.length;cb++){var db=n('placeholder_'+za[cb]);if(!db)continue;if(!bb)bb=q.byClass(db,'fbTimelineCapsule');j.removeClass(db,'visiblePlaceholder');l.replace(db,g(za[cb]));if(bb)delete da[bb.id][za[cb]];}window.Hovercard&&o.hide();if(!bb)return;if(ab)l.scry(bb,'div.fbTimelinePlaceholderUnit').each(function(eb){l.remove(eb.parentNode);});aa.balanceCapsule(bb);aa.scrollToCapsule(bb);},scrollToCapsule:function(za){if(!ga.hasOwnProperty(za.id)){var ab=y.getElementPosition(za.parentNode);m.scrollTo(new y(y.getScrollPosition().x,ab.y-r.SUBSECTION_SCROLL_TO_OFFSET,'document'));ga[za.id]=true;}},setFirstUnit:function(za){var ab=true,bb=za.childNodes.length;for(var cb=0;cb<bb;cb++){var db=za.childNodes[cb];if(db.id.indexOf('tl_unit_')===0)if(ab){ab=false;j.addClass(db,'firstUnit');}else{j.removeClass(db,'firstUnit');break;}}},balanceCapsule:function(za,ab){if(!za)return;if(za.getAttribute('data-layout')=='fixed'){v.getInstance('balanceCapsuleFixed').debounce(aa.balanceFixed.curry(za,ab),za.id);}else v.getInstance('balanceCapsule').throttle(aa.balance.curry(za,0),za.id);},balanceFixed:function(za,ab){if(!za)return;if(w.chrome()||w.safari())j.toggleClass(za,'webkitFix');var bb=0,cb,db=document.createDocumentFragment(),eb=[],fb=[],gb=[],hb=false;for(var ib=0;ib<za.childNodes.length;ib++){cb=za.childNodes[ib];if(ia(cb)){continue;}else if(ha(cb)){i.createFrom(cb.firstChild.childNodes).each(qa);continue;}qa(cb);if(la(cb,true)=='r'){fb.push(cb);}else eb.push(cb);gb.push(cb);if(na(cb)!='2')if((bb>0&&la(cb)=='r')||(bb<0&&la(cb)=='l'))hb=true;bb=sa(bb,cb);}var jb=[],kb=[],lb=[];l.scry(za,'li.fbTimelineBalancer').each(function(ob){var pb=i.createFrom(ob.firstChild.childNodes);if(ob.getAttribute('data-nonunits')){lb=lb.concat(pb);}else if(la(ob)=='left'){jb=jb.concat(pb);}else if(la(ob)=='right')kb=kb.concat(pb);});if(hb){za.style.minHeight=za.offsetHeight;eb.each(function(ob){if(na(ob)!='2')ma(ob,'l');});fb.each(function(ob){if(na(ob)!='2')ma(ob,'r');});var mb=l.create('li',{className:'fbTimelineBalancer'},l.create('ol',null,eb));mb.setAttribute('data-side','left');l.prependContent(za,mb);jb=eb.concat(jb);var nb=l.create('li',{className:'fbTimelineBalancer'},l.create('ol',null,fb));nb.setAttribute('data-side','right');l.prependContent(za,nb);kb=fb.concat(kb);bb=0;}while((bb>=0&&jb.length)||(bb<0&&kb.length)){if(bb>=0){cb=jb.shift();}else cb=kb.shift();db.appendChild(cb);bb=sa(bb,cb);}while(lb.length)db.appendChild(lb.shift());za.appendChild(db);l.scry(za,'li.fbTimelineBalancer').each(function(ob){if(!ob.firstChild.childNodes.length)l.remove(ob);});if(ab&&ab.tail_balance){bb=aa.tailBalance(za,bb,ab.tail_balance);}else if(k.get(r.DS_TAILBALANCE,za.id))bb=aa.tailBalance(za,bb,r.FIXED_SIDE_BOTH);if(hb){gb.each(function(ob){if(ob.parentNode!==za){za.appendChild(ob);bb=sa(bb,ob);}});za.style.minHeight=null;}k.set(r.DS_COLUMN_HEIGHT_DIFFERENTIAL,q.byClass(za,'fbTimelineSection').id,bb);da[za.id]={};l.scry(za,'li.placeholderUnit').each(function(ob){da[za.id][ob.id]=ob;});wa(za);ua(za);h.inform('TimelineCapsule/balanced',{capsule:za});},tailBalance:function(za,ab,bb){if(!za)return ab;var cb=[],db=[],eb=[],fb=[];l.scry(za,'li.fbTimelineBalancer').each(function(hb){var ib=i.createFrom(hb.firstChild.childNodes);if(hb.getAttribute('data-nonunits')){fb=fb.concat(ib);}else if(la(hb)=='left'){db=db.concat(ib);}else if(la(hb)=='right')eb=eb.concat(ib);cb=cb.concat(ib);});if((bb==r.FIXED_SIDE_RIGHT&&db.length)||(bb==r.FIXED_SIDE_LEFT&&eb.length))return ab;var gb=document.createDocumentFragment();if(cb)while(cb.length){if(na(cb[0])!='2')if(ab>=0){ma(cb[0],'l');}else ma(cb[0],'r');ab=sa(ab,cb[0]);gb.appendChild(cb.shift());}za.appendChild(gb);l.scry(za,'li.fbTimelineBalancer').each(function(hb){if(!hb.firstChild.childNodes.length)l.remove(hb);});k.set(r.DS_TAILBALANCE,za.id,true);return ab;},balance:function(za,ab,bb){if(!za)return;if(!da[za.id])da[za.id]={};var cb=ha(za)?za.firstChild:za,db=cb.childNodes.length,eb=[],fb=[];if(w.chrome()||w.safari())j.toggleClass(za,'webkitFix');for(var gb=0;gb<db;gb++)qa(cb.childNodes[gb]);var hb=false;for(gb=0;gb<db;gb++){var ib=cb.childNodes[gb];if(ia(ib))continue;var jb=(ab>=0),kb=ib.nextSibling;if(ka(ib)){if(la(ib)=='r'){if(ab>0)if(kb&&na(kb)!='2'){var lb=[ib];while(kb&&ka(kb)&&la(kb)=='r'){lb.push(kb);kb=kb.nextSibling;}if(kb){if(ha(kb)){var mb=kb.firstChild;l.prependContent(mb,lb);qa(mb);db-=lb.length;}else l.insertBefore(ib,kb);gb--;}continue;}ab+=ra(ib);}else ab-=ra(ib);}else if(ib.id&&(da[za.id][ib.id]||ja(ib))){da[za.id][ib.id]=ib;continue;}else if(ha(ib)){ab=aa.balance(ib,ab);}else if(na(ib)=='2'){if(kb&&ka(kb)&&la(kb)=='r'&&ab<=0){l.insertBefore(ib,kb);gb--;}else{jb=true;ab=0;}}else if(jb){eb.push(ib);ab-=ra(ib);}else{var nb=false;if(!hb){while(kb&&(!ka(kb)||la(kb)!='r'))kb=kb.nextSibling;if(kb){l.insertBefore(ib,kb);gb--;nb=true;}else hb=true;}if(!nb){fb.push(ib);ab+=ra(ib);}}}oa(za,true);if(bb&&bb.nothrottle){va(za,eb,fb);wa(za);}else{clearTimeout(fa[za.id]);fa[za.id]=setTimeout(function(){v.getInstance('positionUnits').debounce(va.curry(za,eb,fb),za.id);delete fa[za.id];},50);clearTimeout(ea[za.id]);ea[za.id]=setTimeout(function(){v.getInstance('adjustPlaceholders').debounce(wa.curry(za),za.id);delete ea[za.id];},150);}return ab;}};})();e.exports=a.TimelineCapsule||aa;});
__d("legacy:TimelineCapsule",["TimelineCapsule"],function(a,b,c,d){a.TimelineCapsule=b('TimelineCapsule');},3);
var TimelineComposerUtilities=(function(){var a=86400*31,b=86400000;return {listenToSetEstimatedDate:function(c,d){return Arbiter.subscribe('TimelineBackdatedComposerTagger/initialized',function(event,e){if(e.composer===c)Bootloader.loadComponents('TimelineContentLoader',function(){e.date_picker.subscribe('initialized',function(f,g){TimelineComposerUtilities.setEstimatedDate(g,d());});});});},listenToPublish:function(c,d){return Arbiter.subscribe('composer/publish',function(event,e){if(e.composer===c)Bootloader.loadComponents('TimelineStoryPublisher',function(){TimelineStoryPublisher.publish(e);d&&d();});});},listenToAnotherComposerOpen:function(c,d){return Arbiter.subscribe('composer/mutate',function(e,f){if(f!==c)d();});},listenToCancel:function(c,d){return Event.listen(c,'click',function(event){Parent.byClass(event.getTarget(),'cancelBtn')&&d();});},hidePlaceIfAttachmentsTooTall:function(c){var d=DOM.find(c,'ul.fbTimelineComposerAttachments'),e=Vector2.getElementDimensions(d).y;if(e>50){var f=Parent.byTag(DOM.scry(d,'span.placeAttachment')[0],'li');f&&CSS.hide(f);}},setEstimatedDate:function(c,d){var e,f;if(d&&CSS.hasClass(d,'fbTimelineCapsule')){e=d.getAttribute('data-start');f=d.getAttribute('data-end');if(e&&f){var g=new Date(f*1000);if(f-e>2*a){c.setDate(g.getFullYear());}else c.setDate(g.getFullYear(),g.getMonth()+1);}return;}var h=Parent.byClass(d,'fbTimelineCapsule');if(h){e=h.getAttribute('data-start');f=h.getAttribute('data-end');var i=Vector2.getElementPosition(d).y,j=[f,null],k=[e,null],l=TimelineCapsule.getUnitsWithTime(h);for(var m=0;m<l.length;m++){var n=l[m],o=DOM.scry(n.parentNode,'.spinePointer')[0];if(!o)continue;var p=Vector2.getElementPosition(o).y;if(p<=i){if(!j[1]||p>j[1])j=[n.getAttribute('data-time'),p];}else if(!k[1]||p<k[1])k=[n.getAttribute('data-time'),p];}if(j[0]!==null&&k[0]!==null){var q=Math.round((parseInt(j[0],10)+parseInt(k[0],10))/2)*1000;q=Math.min(new Date()-b,q);c.setDateWithTimestamp(q);}}}};})();
var TimelineBackdatedComposer=(function(){var a;function b(){c();d();}function c(){a.hide();}function d(){Bootloader.loadComponents('TimelineMLE',function(){var e=TimelineMLE.getFlyout();if(e&&CSS.hasClass(e.getContext(),'backdatedDot'))TimelineMLE.hideFlyout();});}return {init:function(e,f){a=f;var g=[TimelineComposerUtilities.listenToPublish(e,b),TimelineComposerUtilities.listenToAnotherComposerOpen(e,b),TimelineComposerUtilities.listenToSetEstimatedDate(e,a.getContext.bind(a)),e.subscribeToMutate(function(){var i=!DOM.scry(e.root,'.cancelBtn')[0]||DOM.scry(e.root,'.attachmentLifeEvents')[0];if(i){a.enableBehavior(LayerHideOnBlur);}else a.disableBehavior(LayerHideOnBlur);}),Arbiter.subscribe('TimelineMLE/mleFlyoutShown',function(i,j){if(CSS.hasClass(j.getContext(),'backdatedDot')){c();}else b();}),Arbiter.subscribe(TimelineNavigation.UPDATE_PAGE,b)],h=TimelineComposerUtilities.listenToCancel(a.getContent(),b);onleaveRegister(function(){g.forEach(Arbiter.unsubscribe.bind(Arbiter));g=[];h.remove();h=null;});Arbiter.inform('TimelineBackdatedComposer/initialized');},getFlyout:function(){return a;}};})();
var TimelineComposer=(function(){var a;function b(f){if(f.isScheduledPost)return;if(!f.streamStory){window.location.reload();return;}if(f.backdatedTime){Bootloader.loadComponents('TimelineStoryPublisher',function(){TimelineStoryPublisher.publish(f);});return;}var g=Parent.byClass(a,'fbTimelineCapsule');if(!g)return;var h=Parent.byClass(a,'timelineUnitContainer').parentNode;if(h.nextSibling.getAttribute('data-spine'))h=h.nextSibling;unit_node=DOM.insertAfter(h,f.streamStory)[0];Bootloader.loadComponents('animation',function(){animation(unit_node.firstChild).from('backgroundColor','#fff8dd').to('backgroundColor','#fff').duration(2000).ease(animation.ease.both).go();});TimelineCapsule.setFirstUnit(g);TimelineCapsule.balanceCapsule(g);}function c(){var f=Parent.byClass(a,'fbTimelineTwoColumn');return DOM.find(f,'.spinePointer');}function d(f){var g=e();CSS.show(g);var h=f.subscribe('hide',function(){CSS.hide(g);f.unsubscribe(h);});}function e(){var f=Parent.byClass(a,'fbTimelineTwoColumn'),g=DOM.scry(f,'div.composerVeil');if(g.length!==1)g=DOM.appendContent(f,$N('div',{className:'composerVeil hidden_elem'}));return g[0];}return {init:function(f){a=$(f);var g=Arbiter.subscribe('composer/publish',function(event,h){if(h.composer.root===a)b(h);});onleaveRegister(function(){g.unsubscribe();});TimelineComposerUtilities.hidePlaceIfAttachmentsTooTall(a);},showMLEFlyout:function(f){f.setContext(c()).show();d(f);}};})();
__d("legacy:TimelineContentLoader",["TimelineContentLoader"],function(a,b,c,d){a.TimelineContentLoader=b('TimelineContentLoader');},3);
function TimelineCoverDisclaimer(a,b,c){if(TimelineCoverDisclaimer.displayed===undefined){TimelineCoverDisclaimer.displayed=true;}else return;new Dialog().setModal(true).setTitle(a).setBody(b).setButtonsMessage(c).setButtons(Dialog.OK).show();}
requireLazy(['Selector'],function(a){add_properties('__behaviors',{});if(__behaviors.TimelineCurationControl)return;__behaviors.TimelineCurationControl=true;a.subscribe('open',function(b,c){var d=c.selector,e=c.clone||d,f=Parent.byClass(e,'fbTimelineCurationControl');if(f){CSS.addClass(f,'editControlsMenuOpen');var g=a.subscribe('close',function(h,i){if(i.selector==d){a.unsubscribe(g);CSS.removeClass.curry(f,'editControlsMenuOpen').defer();}});}});});
__d("legacy:TimelinePerfConfig",["TimelinePerfConfig"],function(a,b,c,d){a.TimelinePerfConfig=b('TimelinePerfConfig');},3);
function TimelineSpine(){}copy_properties(TimelineSpine,{OFFSET_Y:12,composerFlyout:null,mleFlyout:null,dot:null,loadComposerFlyoutCalled:false,showComposerFlyout:function(a){var b=TimelineSpine.composerFlyout;if(!b){TimelineSpine.loadComposerFlyout(a);TimelineSpine.showComposerFlyoutOnLoad=true;return;}var c=DOM.find(b.getContent(),'div.fbTimelineBackdatedComposer'),d=Composer.getInstance(c);if(d){d.reset();CSS.removeClass(d.root,'uiComposerOpen');}b.enableBehavior(LayerHideOnBlur).setContext(TimelineSpine.dot).updatePosition();b.show();TimelineComposerUtilities.hidePlaceIfAttachmentsTooTall(c);},loadComposerFlyout:function(a){if(TimelineSpine.loadComposerFlyoutCalled||TimelineSpine.composerFlyout)return;TimelineSpine.loadComposerFlyoutCalled=true;onleaveRegister(function(){TimelineSpine.loadComposerFlyoutCalled=false;TimelineSpine.composerFlyout=null;}.bind(this));new AsyncRequest().setURI('/ajax/timeline/backdated_composer.php').setData({targetid:a}).setRelativeTo(TimelineSpine.dot||document.body).send();var b=Arbiter.subscribe('TimelineBackdatedComposer/initialized',function(){TimelineSpine.composerFlyout=TimelineBackdatedComposer.getFlyout();if(TimelineSpine.showComposerFlyoutOnLoad)TimelineSpine.showComposerFlyout(a);TimelineSpine._handleComposerFlyoutDismissed();b.unsubscribe();});},showMLEFlyout:function(a){TimelineSpine.mleFlyout=a;a.setContext(TimelineSpine.dot).show();TimelineSpine.composerFlyout.hide();},_handleComposerFlyoutDismissed:function(){var a=Layer.subscribe('hide',function(b,c){if(TimelineSpine.dot&&c.getContext)if(c.getContext()===TimelineSpine.dot&&!TimelineSpine.mleFlyout){TimelineSpine._hideDot();}else if(c===TimelineSpine.mleFlyout){TimelineSpine.mleFlyout=null;TimelineSpine._hideDot();}});onleaveRegister(function(){Layer.unsubscribe(a);}.bind(this));},_hideDot:function(){DOM.remove(TimelineSpine.dot);TimelineSpine.dot=null;}});copy_properties(TimelineSpine.prototype,{init:function(a,b){this._spine=a;if(!TimelinePerfConfig.getDisableSpineHeight())this._spineHeight=a.offsetHeight;this._plus=DOM.find(a,'.spineHoverPlus');this._capsule=Parent.byClass(a,'fbTimelineCapsule');this._targetid=b;var c=[Event.listen(a,'mouseenter',function(event){TimelineSpine.loadComposerFlyout(this._targetid);this._spineHeight=a.offsetHeight;}.bind(this)),Event.listen(a,'mousemove',this._mouseMoved.bind(this)),Event.listen(a,'click',this._spineClicked.bind(this))];CSS.addClass(this._plus,'spineHoverPlusActive');onleaveRegister(function(){while(c.length)c.pop().remove();}.bind(this));},_mouseMoved:function(event){var a=event.offsetY||event.layerY,b=event.getTarget();if(b!==this._spine)a=b.offsetTop+a;a=Math.min(Math.max(a-TimelineSpine.OFFSET_Y,0),this._spineHeight);this._plus.style.top=a+'px';},_spineClicked:function(event){if(TimelineSpine.mleFlyout){Bootloader.loadComponents('TimelineMLE',TimelineMLE.hideFlyout);return;}TimelineSpine.dot&&DOM.remove(TimelineSpine.dot);TimelineSpine.dot=$N('i',{className:'backdatedDot'});TimelineSpine.dot.style.top=(this._plus.offsetTop-1)+'px';DOM.appendContent(this._spine,TimelineSpine.dot);event.stop();TimelineSpine.showComposerFlyout(this._targetid);}});
function TimelineScrubber(a){this._root=a;this._navKeys={};this._subNavKeys={};this._rollups={};this._rolledup={};var b=a.childNodes;this._currentNav=b[0];for(var c=0;c<b.length;c++){var d=b[c].getAttribute('data-key');this._navKeys[d]=b[c];var e=DOM.scry(b[c],'ul');this._subNavKeys[d]={};if(e.length){var f=e[0].childNodes;for(var g=0;g<f.length;g++)this._subNavKeys[d][f[g].getAttribute('data-key')]=f[g];}var h=b[c].getAttribute('data-rollup');if(h){this._rollups[h]=this._rollups[h]||[];this._rollups[h].push(b[c]);}}this._clickListener=Event.listen(this._root,'click',this._handleScrub.bind(this));CSS.show(this._root);var i=Vector2.getViewportDimensions().y-this.SCRUBBER_NO_ADS_VERTICAL_BUFFER,j=this.getHeight();if(j>i)this.fold(j-i);TimelineController.register(TimelineController.SCRUBBER,this);TimelineController.scrubberHasLoaded(this);}copy_properties(TimelineScrubber.prototype,{KEY_HEIGHT:23,SUBKEY_HEIGHT:16,OFFSET:38,SCRUBBER_NO_ADS_VERTICAL_BUFFER:125,getRoot:function(){return this._root;},getNav:function(a){return this._navKeys[a];},getSubnav:function(a,b){return this._subNavKeys[a][b];},getHeight:function(){return this._root.offsetHeight;},getLabelForNav:function(a){var b=this.getNav(a);return b&&DOM.getText(DOM.scry(b,'a')[0]);},getLabelForSubnav:function(a,b){var c=this.getSubnav(a,b);return c&&DOM.getText(DOM.scry(c,'a')[0]);},fold:function(a){return this._adjustFolding(a,true);},unfold:function(a){return this._adjustFolding(a,false);},getOffset:function(){return this.OFFSET;},updateSection:function(a,b){var c=this._navKeys[a].getAttribute('data-rollup');if(this._currentRollup&&this._currentRollup!=c){CSS.removeClass(this._currentRollup,'selected');CSS.removeClass(DOM.scry(this._currentRollup,'ul')[0],'loaded');delete this._currentRollup;}if(c&&this._rolledup[c]){var d=this._rolledup[c];if(d.getAttribute('data-rollup')){this._currentRollup=d;CSS.addClass(this._currentRollup,'selected');CSS.addClass(DOM.scry(this._currentRollup,'ul')[0],'loaded');}}this._currentNav&&CSS.removeClass(this._currentNav,'selected');this._currentSubNav&&CSS.removeClass(this._currentSubNav,'selected');this._currentNav=null;this._currentSubNav=null;if(this._navKeys[a]){this._currentNav=this._navKeys[a];CSS.addClass(this._currentNav,'selected');if(this.decadesAreSelectable&&this._navKeys[b]){this._currentSubNav=this._navKeys[b];CSS.addClass(this._currentSubNav,'selected');}else if(b&&this._subNavKeys[a][b]){this._currentSubNav=this._subNavKeys[a][b];CSS.addClass(this._currentSubNav,'selected');}}},_getRollupSize:function(a){var b=this._currentNav,c=b&&b.getAttribute('data-rollup'),d=this.KEY_HEIGHT*(this._rollups[a].length-1);if(a==c){d+=this.SUBKEY_HEIGHT*DOM.scry(b,'li').length;d-=this.SUBKEY_HEIGHT*(this._rollups[a].length-1);}return d;},_adjustFolding:function(a,b){var c=a,d=keys(this._rollups);while(a>0&&d.length){var e=d[b?'pop':'shift']();if(!b==!this._rolledup[e])continue;var f=this._getRollupSize(e);if(f<=0)continue;if(!b&&f>a)break;this[b?'_collapseRollup':'_expandRollup'](e);a-=f;}return c-a;},_collapseRollup:function(a){var b=this._rollups[a];if(!b||b.length<2||this._rolledup[a])return;var c=b[0].previousSibling,d=b[0],e=$N('a',{href:d.firstChild.href,rel:'ignore'},[a]),f=$N('ul',{className:'clearfix'});for(var g=0;g<b.length;g++)f.appendChild(b[g]);var h=$N('li',{},[e,f]);if(this.decadesAreSelectable){var i=b[b.length-1],j=d.getAttribute('data-key')+i.getAttribute('data-key');h.setAttribute('data-start',i.getAttribute('data-start'));h.setAttribute('data-end',d.getAttribute('data-end'));h.setAttribute('data-key',j);this._navKeys[j]=h;}else h.setAttribute('data-key',d.getAttribute('data-key'));h.setAttribute('data-rollup',a);if(c){DOM.insertAfter(c,h);}else DOM.prependContent(this._root,h);this._rolledup[a]=h;this._checkSelection();},_expandRollup:function(a){if(!this._rolledup[a])return;var b=this._rolledup[a],c=DOM.scry(b,'ul')[0],d=document.createDocumentFragment();while(c.childNodes.length)d.appendChild(c.firstChild);DOM.replace(b,d);this._rolledup[a]=false;this._checkSelection();},_checkSelection:function(){if(this._currentNav){var a=this._currentSubNav&&this._currentSubNav.getAttribute('data-key');this.updateSection(this._currentNav.getAttribute('data-key'),a);}},_handleScrub:function(event){var a=event.getModifiers();if(event.isMiddleClick()||a.access||a.meta)return true;var b=Parent.byTag(event.getTarget(),'a'),c=b&&Parent.byAttribute(b,'data-key');if(c){TimelineController.scrubberWasClicked(c.getAttribute('data-key'));TimelineController.navigateToSection(c.getAttribute('data-key'));return event.prevent();}}});
function TimelineMainScrubber(a){this.parent.construct(this,a);this._subscribe=Arbiter.subscribe(TimelineController.SECTION_LOADED,function(b,c){var d=this._navKeys[c.key],e=d&&DOM.scry(d,'ul')[0];if(e){CSS.addClass(e,'loaded');TimelineController.scrubberHasChangedState();if(c.hideSubSections)CSS.hide(e);}}.bind(this));}Class.extend(TimelineMainScrubber,'TimelineScrubber');copy_properties(TimelineMainScrubber.prototype,{reset:function(){this._subscribe&&this._subscribe.unsubscribe();}});
var SubscribeButton=window.SubscribeButton||(function(){return {init:function(a,b,c,d){Event.listen(b,'click',function(){Arbiter.inform('FollowingUser',{profile_id:d});});Arbiter.subscribe('FollowingUser',function(e,f){if(d===f.profile_id)a.swap();});Arbiter.subscribe('UnfollowingUser',function(e,f){if(d===f.profile_id){a.unswap();c.hideFlyout();Arbiter.inform('SubMenu/Reset');}});},initUnsubscribe:function(a,b){Event.listen(a,'click',function(){Arbiter.inform.bind(Arbiter,'UnfollowingUser',{profile_id:b}).defer();});}};})();