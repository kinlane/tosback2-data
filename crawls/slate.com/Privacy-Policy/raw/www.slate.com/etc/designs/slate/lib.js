/*!
 * jQuery UI 1.8
 *
 * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://docs.jquery.com/UI
 */
jQuery.ui||(function(b){b.ui={version:"1.8",plugin:{add:function(j,i,g){var h=b.ui[j].prototype;for(var a in g){h.plugins[a]=h.plugins[a]||[];h.plugins[a].push([i,g[a]]);}},call:function(a,i,j){var g=a.plugins[i];if(!g||!a.element[0].parentNode){return;}for(var h=0;h<g.length;h++){if(a.options[g[h][0]]){g[h][1].apply(a.element,j);}}}},contains:function(a,e){return document.compareDocumentPosition?a.compareDocumentPosition(e)&16:a!==e&&a.contains(e);},hasScroll:function(f,h){if(b(f).css("overflow")=="hidden"){return false;}var a=(h&&h=="left")?"scrollLeft":"scrollTop",g=false;if(f[a]>0){return true;}f[a]=1;g=(f[a]>0);f[a]=0;return g;},isOverAxis:function(f,a,e){return(f>a)&&(f<(a+e));},isOver:function(h,l,i,j,a,k){return b.ui.isOverAxis(h,i,a)&&b.ui.isOverAxis(l,j,k);},keyCode:{BACKSPACE:8,CAPS_LOCK:20,COMMA:188,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38}};b.fn.extend({_focus:b.fn.focus,focus:function(a,d){return typeof a==="number"?this.each(function(){var c=this;setTimeout(function(){b(c).focus();(d&&d.call(c));},a);}):this._focus.apply(this,arguments);},enableSelection:function(){return this.attr("unselectable","off").css("MozUserSelect","").unbind("selectstart.ui");},disableSelection:function(){return this.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false;});},scrollParent:function(){var a;if((b.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){a=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(b.curCSS(this,"position",1))&&(/(auto|scroll)/).test(b.curCSS(this,"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1));}).eq(0);}else{a=this.parents().filter(function(){return(/(auto|scroll)/).test(b.curCSS(this,"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1));}).eq(0);}return(/fixed/).test(this.css("position"))||!a.length?b(document):a;},zIndex:function(f){if(f!==undefined){return this.css("zIndex",f);}if(this.length){var h=b(this[0]),a,g;while(h.length&&h[0]!==document){a=h.css("position");if(a=="absolute"||a=="relative"||a=="fixed"){g=parseInt(h.css("zIndex"));if(!isNaN(g)&&g!=0){return g;}}h=h.parent();}}return 0;}});b.extend(b.expr[":"],{data:function(e,f,a){return !!b.data(e,a[3]);},focusable:function(f){var e=f.nodeName.toLowerCase(),a=b.attr(f,"tabindex");return(/input|select|textarea|button|object/.test(e)?!f.disabled:"a"==e||"area"==e?f.href||!isNaN(a):!isNaN(a))&&!b(f)["area"==e?"parents":"closest"](":hidden").length;},tabbable:function(d){var a=b.attr(d,"tabindex");return(isNaN(a)||a>=0)&&b(d).is(":focusable");}});})(jQuery);jQuery.effects||(function(n){n.effects={};n.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(a,b){n.fx.step[b]=function(c){if(!c.colorInit){c.start=k(c.elem,b);c.end=l(c.end);c.colorInit=true;}c.elem.style[b]="rgb("+Math.max(Math.min(parseInt((c.pos*(c.end[0]-c.start[0]))+c.start[0],10),255),0)+","+Math.max(Math.min(parseInt((c.pos*(c.end[1]-c.start[1]))+c.start[1],10),255),0)+","+Math.max(Math.min(parseInt((c.pos*(c.end[2]-c.start[2]))+c.start[2],10),255),0)+")";};});function l(a){var b;if(a&&a.constructor==Array&&a.length==3){return a;}if(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a)){return[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10)];}if(b=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(a)){return[parseFloat(b[1])*2.55,parseFloat(b[2])*2.55,parseFloat(b[3])*2.55];}if(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(a)){return[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16)];}if(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(a)){return[parseInt(b[1]+b[1],16),parseInt(b[2]+b[2],16),parseInt(b[3]+b[3],16)];}if(b=/rgba\(0, 0, 0, 0\)/.exec(a)){return u.transparent;}return u[n.trim(a).toLowerCase()];}function k(a,c){var b;do{b=n.curCSS(a,c);if(b!=""&&b!="transparent"||n.nodeName(a,"body")){break;}c="backgroundColor";}while(a=a.parentNode);return l(b);}var u={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};var p=["add","remove","toggle"],r={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};function o(){var e=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,d={},b,a;if(e&&e.length&&e[0]&&e[e[0]]){var c=e.length;while(c--){b=e[c];if(typeof e[b]=="string"){a=b.replace(/\-(\w)/g,function(g,f){return f.toUpperCase();});d[a]=e[b];}}}else{for(b in e){if(typeof e[b]==="string"){d[b]=e[b];}}}return d;}function s(b){var c,a;for(c in b){a=b[c];if(a==null||n.isFunction(a)||c in r||(/scrollbar/).test(c)||(!(/color/i).test(c)&&isNaN(parseFloat(a)))){delete b[c];}}return b;}function m(c,a){var d={_:0},b;for(b in a){if(c[b]!=a[b]){d[b]=a[b];}}return d;}n.effects.animateClass=function(c,b,d,a){if(n.isFunction(d)){a=d;d=null;}return this.each(function(){var f=n(this),i=f.attr("style")||" ",e=s(o.call(this)),g,h=f.attr("className");n.each(p,function(v,j){if(c[j]){f[j+"Class"](c[j]);}});g=s(o.call(this));f.attr("className",h);f.animate(m(e,g),b,d,function(){n.each(p,function(v,j){if(c[j]){f[j+"Class"](c[j]);}});if(typeof f.attr("style")=="object"){f.attr("style").cssText="";f.attr("style").cssText=i;}else{f.attr("style",i);}if(a){a.apply(this,arguments);}});});};n.fn.extend({_addClass:n.fn.addClass,addClass:function(b,c,d,a){return c?n.effects.animateClass.apply(this,[{add:b},c,d,a]):this._addClass(b);},_removeClass:n.fn.removeClass,removeClass:function(b,c,d,a){return c?n.effects.animateClass.apply(this,[{remove:b},c,d,a]):this._removeClass(b);},_toggleClass:n.fn.toggleClass,toggleClass:function(a,b,c,d,e){if(typeof b=="boolean"||b===undefined){if(!c){return this._toggleClass(a,b);}else{return n.effects.animateClass.apply(this,[(b?{add:a}:{remove:a}),c,d,e]);}}else{return n.effects.animateClass.apply(this,[{toggle:a},b,c,d]);}},switchClass:function(c,a,b,d,e){return n.effects.animateClass.apply(this,[{add:a,remove:c},b,d,e]);}});n.extend(n.effects,{version:"1.8",save:function(b,a){for(var c=0;c<a.length;c++){if(a[c]!==null){b.data("ec.storage."+a[c],b[0].style[a[c]]);}}},restore:function(b,a){for(var c=0;c<a.length;c++){if(a[c]!==null){b.css(a[c],b.data("ec.storage."+a[c]));}}},setMode:function(b,a){if(a=="toggle"){a=b.is(":hidden")?"show":"hide";}return a;},getBaseline:function(b,a){var d,c;switch(b[0]){case"top":d=0;break;case"middle":d=0.5;break;case"bottom":d=1;break;default:d=b[0]/a.height;}switch(b[1]){case"left":c=0;break;case"center":c=0.5;break;case"right":c=1;break;default:c=b[1]/a.width;}return{x:c,y:d};},createWrapper:function(c){if(c.parent().is(".ui-effects-wrapper")){return c.parent();}var b={width:c.outerWidth(true),height:c.outerHeight(true),"float":c.css("float")},a=n("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0});c.wrap(a);a=c.parent();if(c.css("position")=="static"){a.css({position:"relative"});c.css({position:"relative"});}else{n.extend(b,{position:c.css("position"),zIndex:c.css("z-index")});n.each(["top","left","bottom","right"],function(e,d){b[d]=c.css(d);if(isNaN(parseInt(b[d],10))){b[d]="auto";}});c.css({position:"relative",top:0,left:0});}return a.css(b).show();},removeWrapper:function(a){if(a.parent().is(".ui-effects-wrapper")){return a.parent().replaceWith(a);}return a;},setTransition:function(b,d,c,a){a=a||{};n.each(d,function(e,f){unit=b.cssUnit(f);if(unit[0]>0){a[f]=unit[0]*c+unit[1];}});return a;}});function q(b,c,a,d){if(typeof b=="object"){d=c;a=null;c=b;b=c.effect;}if(n.isFunction(c)){d=c;a=null;c={};}if(n.isFunction(a)){d=a;a=null;}if(typeof c=="number"||n.fx.speeds[c]){d=a;a=c;c={};}c=c||{};a=a||c.duration;a=n.fx.off?0:typeof a=="number"?a:n.fx.speeds[a]||n.fx.speeds._default;d=d||c.complete;return[b,c,a,d];}n.fn.extend({effect:function(g,a,e,d){var b=q.apply(this,arguments),f={options:b[1],duration:b[2],callback:b[3]},c=n.effects[g];return c&&!n.fx.off?c.call(this,f):this;},_show:n.fn.show,show:function(a){if(!a||typeof a=="number"||n.fx.speeds[a]){return this._show.apply(this,arguments);}else{var b=q.apply(this,arguments);b[1].mode="show";return this.effect.apply(this,b);}},_hide:n.fn.hide,hide:function(a){if(!a||typeof a=="number"||n.fx.speeds[a]){return this._hide.apply(this,arguments);}else{var b=q.apply(this,arguments);b[1].mode="hide";return this.effect.apply(this,b);}},__toggle:n.fn.toggle,toggle:function(a){if(!a||typeof a=="number"||n.fx.speeds[a]||typeof a=="boolean"||n.isFunction(a)){return this.__toggle.apply(this,arguments);}else{var b=q.apply(this,arguments);b[1].mode="toggle";return this.effect.apply(this,b);}},cssUnit:function(c){var b=this.css(c),a=[];n.each(["em","px","%","pt"],function(e,d){if(b.indexOf(d)>0){a=[parseFloat(b),d];}});return a;}});n.easing.jswing=n.easing.swing;n.extend(n.easing,{def:"easeOutQuad",swing:function(b,a,c,d,e){return n.easing[n.easing.def](b,a,c,d,e);},easeInQuad:function(b,a,c,d,e){return d*(a/=e)*a+c;},easeOutQuad:function(b,a,c,d,e){return -d*(a/=e)*(a-2)+c;},easeInOutQuad:function(b,a,c,d,e){if((a/=e/2)<1){return d/2*a*a+c;}return -d/2*((--a)*(a-2)-1)+c;},easeInCubic:function(b,a,c,d,e){return d*(a/=e)*a*a+c;},easeOutCubic:function(b,a,c,d,e){return d*((a=a/e-1)*a*a+1)+c;},easeInOutCubic:function(b,a,c,d,e){if((a/=e/2)<1){return d/2*a*a*a+c;}return d/2*((a-=2)*a*a+2)+c;},easeInQuart:function(b,a,c,d,e){return d*(a/=e)*a*a*a+c;},easeOutQuart:function(b,a,c,d,e){return -d*((a=a/e-1)*a*a*a-1)+c;},easeInOutQuart:function(b,a,c,d,e){if((a/=e/2)<1){return d/2*a*a*a*a+c;}return -d/2*((a-=2)*a*a*a-2)+c;},easeInQuint:function(b,a,c,d,e){return d*(a/=e)*a*a*a*a+c;},easeOutQuint:function(b,a,c,d,e){return d*((a=a/e-1)*a*a*a*a+1)+c;},easeInOutQuint:function(b,a,c,d,e){if((a/=e/2)<1){return d/2*a*a*a*a*a+c;}return d/2*((a-=2)*a*a*a*a+2)+c;},easeInSine:function(b,a,c,d,e){return -d*Math.cos(a/e*(Math.PI/2))+d+c;},easeOutSine:function(b,a,c,d,e){return d*Math.sin(a/e*(Math.PI/2))+c;},easeInOutSine:function(b,a,c,d,e){return -d/2*(Math.cos(Math.PI*a/e)-1)+c;},easeInExpo:function(b,a,c,d,e){return(a==0)?c:d*Math.pow(2,10*(a/e-1))+c;},easeOutExpo:function(b,a,c,d,e){return(a==e)?c+d:d*(-Math.pow(2,-10*a/e)+1)+c;},easeInOutExpo:function(b,a,c,d,e){if(a==0){return c;}if(a==e){return c+d;}if((a/=e/2)<1){return d/2*Math.pow(2,10*(a-1))+c;}return d/2*(-Math.pow(2,-10*--a)+2)+c;},easeInCirc:function(b,a,c,d,e){return -d*(Math.sqrt(1-(a/=e)*a)-1)+c;},easeOutCirc:function(b,a,c,d,e){return d*Math.sqrt(1-(a=a/e-1)*a)+c;},easeInOutCirc:function(b,a,c,d,e){if((a/=e/2)<1){return -d/2*(Math.sqrt(1-a*a)-1)+c;}return d/2*(Math.sqrt(1-(a-=2)*a)+1)+c;},easeInElastic:function(b,h,c,d,e){var g=1.70158;var f=0;var a=d;if(h==0){return c;}if((h/=e)==1){return c+d;}if(!f){f=e*0.3;}if(a<Math.abs(d)){a=d;var g=f/4;}else{var g=f/(2*Math.PI)*Math.asin(d/a);}return -(a*Math.pow(2,10*(h-=1))*Math.sin((h*e-g)*(2*Math.PI)/f))+c;},easeOutElastic:function(b,h,c,d,e){var g=1.70158;var f=0;var a=d;if(h==0){return c;}if((h/=e)==1){return c+d;}if(!f){f=e*0.3;}if(a<Math.abs(d)){a=d;var g=f/4;}else{var g=f/(2*Math.PI)*Math.asin(d/a);}return a*Math.pow(2,-10*h)*Math.sin((h*e-g)*(2*Math.PI)/f)+d+c;},easeInOutElastic:function(b,h,c,d,e){var g=1.70158;var f=0;var a=d;if(h==0){return c;}if((h/=e/2)==2){return c+d;}if(!f){f=e*(0.3*1.5);}if(a<Math.abs(d)){a=d;var g=f/4;}else{var g=f/(2*Math.PI)*Math.asin(d/a);}if(h<1){return -0.5*(a*Math.pow(2,10*(h-=1))*Math.sin((h*e-g)*(2*Math.PI)/f))+c;}return a*Math.pow(2,-10*(h-=1))*Math.sin((h*e-g)*(2*Math.PI)/f)*0.5+d+c;},easeInBack:function(b,a,c,d,e,f){if(f==undefined){f=1.70158;}return d*(a/=e)*a*((f+1)*a-f)+c;},easeOutBack:function(b,a,c,d,e,f){if(f==undefined){f=1.70158;}return d*((a=a/e-1)*a*((f+1)*a+f)+1)+c;},easeInOutBack:function(b,a,c,d,e,f){if(f==undefined){f=1.70158;}if((a/=e/2)<1){return d/2*(a*a*(((f*=(1.525))+1)*a-f))+c;}return d/2*((a-=2)*a*(((f*=(1.525))+1)*a+f)+2)+c;},easeInBounce:function(b,a,c,d,e){return d-n.easing.easeOutBounce(b,e-a,0,d,e)+c;},easeOutBounce:function(b,a,c,d,e){if((a/=e)<(1/2.75)){return d*(7.5625*a*a)+c;}else{if(a<(2/2.75)){return d*(7.5625*(a-=(1.5/2.75))*a+0.75)+c;}else{if(a<(2.5/2.75)){return d*(7.5625*(a-=(2.25/2.75))*a+0.9375)+c;}else{return d*(7.5625*(a-=(2.625/2.75))*a+0.984375)+c;}}}},easeInOutBounce:function(b,a,c,d,e){if(a<e/2){return n.easing.easeInBounce(b,a*2,0,d,e)*0.5+c;}return n.easing.easeOutBounce(b,a*2-e,0,d,e)*0.5+d*0.5+c;}});})(jQuery);
/*!
 * jQuery UI Widget 1.8.1
 *
 * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(a){var c=a.fn.remove;a.fn.remove=function(b,d){return this.each(function(){if(!d){if(!b||a.filter(b,[this]).length){a("*",this).add(this).each(function(){a(this).triggerHandler("remove");});}}return c.call(a(this),b,d);});};a.widget=function(b,j,i){var h=b.split(".")[0],g;b=b.split(".")[1];g=h+"-"+b;if(!i){i=j;j=a.Widget;}a.expr[":"][g]=function(d){return !!a.data(d,b);};a[h]=a[h]||{};a[h][b]=function(d,e){arguments.length&&this._createWidget(d,e);};j=new j;j.options=a.extend({},j.options);a[h][b].prototype=a.extend(true,j,{namespace:h,widgetName:b,widgetEventPrefix:a[h][b].prototype.widgetEventPrefix||b,widgetBaseClass:g},i);a.widget.bridge(b,a[h][b]);};a.widget.bridge=function(b,d){a.fn[b]=function(k){var j=typeof k==="string",i=Array.prototype.slice.call(arguments,1),g=this;k=!j&&i.length?a.extend.apply(null,[true,k].concat(i)):k;if(j&&k.substring(0,1)==="_"){return g;}j?this.each(function(){var f=a.data(this,b),e=f&&a.isFunction(f[k])?f[k].apply(f,i):f;if(e!==f&&e!==undefined){g=e;return false;}}):this.each(function(){var e=a.data(this,b);if(e){k&&e.option(k);e._init();}else{a.data(this,b,new d(k,this));}});return g;};};a.Widget=function(b,d){arguments.length&&this._createWidget(b,d);};a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(b,f){this.element=a(f).data(this.widgetName,this);this.options=a.extend(true,{},this.options,a.metadata&&a.metadata.get(f)[this.widgetName],b);var e=this;this.element.bind("remove."+this.widgetName,function(){e.destroy();});this._create();this._init();},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");},widget:function(){return this.element;},option:function(b,h){var g=b,f=this;if(arguments.length===0){return a.extend({},f.options);}if(typeof b==="string"){if(h===undefined){return this.options[b];}g={};g[b]=h;}a.each(g,function(e,d){f._setOption(e,d);});return f;},_setOption:function(b,d){this.options[b]=d;if(b==="disabled"){this.widget()[d?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",d);}return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_trigger:function(b,j,i){var h=this.options[b];j=a.Event(j);j.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();i=i||{};if(j.originalEvent){b=a.event.props.length;for(var g;b;){g=a.event.props[--b];j[g]=j.originalEvent[g];}}this.element.trigger(j,i);return !(a.isFunction(h)&&h.call(this.element[0],j,i)===false||j.isDefaultPrevented());}};})(jQuery);
/*!
 * jQuery UI Mouse 1.8.1
 *
 * Copyright (c) 2010 AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://docs.jquery.com/UI/Mouse
 *
 * Depends:
 *      jquery.ui.widget.js
 */
(function(a){a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(c){return b._mouseDown(c);}).bind("click."+this.widgetName,function(c){if(b._preventClickEvent){b._preventClickEvent=false;c.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);},_mouseDown:function(d){d.originalEvent=d.originalEvent||{};if(!d.originalEvent.mouseHandled){this._mouseStarted&&this._mouseUp(d);this._mouseDownEvent=d;var c=this,h=d.which==1,g=typeof this.options.cancel=="string"?a(d.target).parents().add(d.target).filter(this.options.cancel).length:false;if(!h||g||!this._mouseCapture(d)){return true;}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true;},this.options.delay);}if(this._mouseDistanceMet(d)&&this._mouseDelayMet(d)){this._mouseStarted=this._mouseStart(d)!==false;if(!this._mouseStarted){d.preventDefault();return true;}}this._mouseMoveDelegate=function(b){return c._mouseMove(b);};this._mouseUpDelegate=function(b){return c._mouseUp(b);};a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);a.browser.safari||d.preventDefault();return d.originalEvent.mouseHandled=true;}},_mouseMove:function(b){if(a.browser.msie&&!b.button){return this._mouseUp(b);}if(this._mouseStarted){this._mouseDrag(b);return b.preventDefault();}if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==false)?this._mouseDrag(b):this._mouseUp(b);}return !this._mouseStarted;},_mouseUp:function(b){a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;this._preventClickEvent=b.target==this._mouseDownEvent.target;this._mouseStop(b);}return false;},_mouseDistanceMet:function(b){return Math.max(Math.abs(this._mouseDownEvent.pageX-b.pageX),Math.abs(this._mouseDownEvent.pageY-b.pageY))>=this.options.distance;},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});})(jQuery);(function(f){f.ui=f.ui||{};var a=/left|center|right/,e=/top|center|bottom/,d=f.fn.position,b=f.fn.offset;f.fn.position=function(j){if(!j||!j.of){return d.apply(this,arguments);}j=f.extend({},j);var c=f(j.of),o=(j.collision||"flip").split(" "),n=j.offset?j.offset.split(" "):[0,0],m,l,k;if(j.of.nodeType===9){m=c.width();l=c.height();k={top:0,left:0};}else{if(j.of.scrollTo&&j.of.document){m=c.width();l=c.height();k={top:c.scrollTop(),left:c.scrollLeft()};}else{if(j.of.preventDefault){j.at="left top";m=l=0;k={top:j.of.pageY,left:j.of.pageX};}else{m=c.outerWidth();l=c.outerHeight();k=c.offset();}}}f.each(["my","at"],function(){var g=(j[this]||"").split(" ");if(g.length===1){g=a.test(g[0])?g.concat(["center"]):e.test(g[0])?["center"].concat(g):["center","center"];}g[0]=a.test(g[0])?g[0]:"center";g[1]=e.test(g[1])?g[1]:"center";j[this]=g;});if(o.length===1){o[1]=o[0];}n[0]=parseInt(n[0],10)||0;if(n.length===1){n[1]=n[0];}n[1]=parseInt(n[1],10)||0;if(j.at[0]==="right"){k.left+=m;}else{if(j.at[0]==="center"){k.left+=m/2;}}if(j.at[1]==="bottom"){k.top+=l;}else{if(j.at[1]==="center"){k.top+=l/2;}}k.left+=n[0];k.top+=n[1];return this.each(function(){var p=f(this),h=p.outerWidth(),g=p.outerHeight(),i=f.extend({},k);if(j.my[0]==="right"){i.left-=h;}else{if(j.my[0]==="center"){i.left-=h/2;}}if(j.my[1]==="bottom"){i.top-=g;}else{if(j.my[1]==="center"){i.top-=g/2;}}i.left=parseInt(i.left);i.top=parseInt(i.top);f.each(["left","top"],function(s,q){f.ui.position[o[s]]&&f.ui.position[o[s]][q](i,{targetWidth:m,targetHeight:l,elemWidth:h,elemHeight:g,offset:n,my:j.my,at:j.at});});f.fn.bgiframe&&p.bgiframe();p.offset(f.extend(i,{using:j.using}));});};f.ui.position={fit:{left:function(g,c){var h=f(window);c=g.left+c.elemWidth-h.width()-h.scrollLeft();g.left=c>0?g.left-c:Math.max(0,g.left);},top:function(g,c){var h=f(window);c=g.top+c.elemHeight-h.height()-h.scrollTop();g.top=c>0?g.top-c:Math.max(0,g.top);}},flip:{left:function(h,c){if(c.at[0]!=="center"){var k=f(window);k=h.left+c.elemWidth-k.width()-k.scrollLeft();var j=c.my[0]==="left"?-c.elemWidth:c.my[0]==="right"?c.elemWidth:0,i=-2*c.offset[0];h.left+=h.left<0?j+c.targetWidth+i:k>0?j-c.targetWidth+i:0;}},top:function(i,c){if(c.at[1]!=="center"){var m=f(window);m=i.top+c.elemHeight-m.height()-m.scrollTop();var l=c.my[1]==="top"?-c.elemHeight:c.my[1]==="bottom"?c.elemHeight:0,k=c.at[1]==="top"?c.targetHeight:-c.targetHeight,j=-2*c.offset[1];i.top+=i.top<0?l+c.targetHeight+j:m>0?l+k+j:0;}}}};if(!f.offset.setOffset){f.offset.setOffset=function(i,c){if(/static/.test(f.curCSS(i,"position"))){i.style.position="relative";}var m=f(i),l=m.offset(),k=parseInt(f.curCSS(i,"top",true),10)||0,j=parseInt(f.curCSS(i,"left",true),10)||0;l={top:c.top-l.top+k,left:c.left-l.left+j};"using" in c?c.using.call(i,l):m.css(l);};f.fn.offset=function(g){var c=this[0];if(!c||!c.ownerDocument){return null;}if(g){return this.each(function(){f.offset.setOffset(this,g);});}return b.call(this);};}})(jQuery);(function(a){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:true,appendTo:"parent",axis:false,connectToSortable:false,containment:false,cursor:"auto",cursorAt:false,grid:false,handle:false,helper:"original",iframeFix:false,opacity:false,refreshPositions:false,revert:false,revertDuration:500,scope:"default",scroll:true,scrollSensitivity:20,scrollSpeed:20,snap:false,snapMode:"both",snapTolerance:20,stack:false,zIndex:false},_create:function(){if(this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))){this.element[0].style.position="relative";}this.options.addClasses&&this.element.addClass("ui-draggable");this.options.disabled&&this.element.addClass("ui-draggable-disabled");this._mouseInit();},destroy:function(){if(this.element.data("draggable")){this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled");this._mouseDestroy();return this;}},_mouseCapture:function(d){var c=this.options;if(this.helper||c.disabled||a(d.target).is(".ui-resizable-handle")){return false;}this.handle=this._getHandle(d);if(!this.handle){return false;}return true;},_mouseStart:function(d){var c=this.options;this.helper=this._createHelper(d);this._cacheHelperProportions();if(a.ui.ddmanager){a.ui.ddmanager.current=this;}this._cacheMargins();this.cssPosition=this.helper.css("position");this.scrollParent=this.helper.scrollParent();this.offset=this.positionAbs=this.element.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:d.pageX-this.offset.left,top:d.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.originalPosition=this.position=this._generatePosition(d);this.originalPageX=d.pageX;this.originalPageY=d.pageY;c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt);c.containment&&this._setContainment();if(this._trigger("start",d)===false){this._clear();return false;}this._cacheHelperProportions();a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,d);this.helper.addClass("ui-draggable-dragging");this._mouseDrag(d,true);return true;},_mouseDrag:function(d,c){this.position=this._generatePosition(d);this.positionAbs=this._convertPositionTo("absolute");if(!c){c=this._uiHash();if(this._trigger("drag",d,c)===false){this._mouseUp({});return false;}this.position=c.position;}if(!this.options.axis||this.options.axis!="y"){this.helper[0].style.left=this.position.left+"px";}if(!this.options.axis||this.options.axis!="x"){this.helper[0].style.top=this.position.top+"px";}a.ui.ddmanager&&a.ui.ddmanager.drag(this,d);return false;},_mouseStop:function(e){var d=false;if(a.ui.ddmanager&&!this.options.dropBehaviour){d=a.ui.ddmanager.drop(this,e);}if(this.dropped){d=this.dropped;this.dropped=false;}if(!this.element[0]||!this.element[0].parentNode){return false;}if(this.options.revert=="invalid"&&!d||this.options.revert=="valid"&&d||this.options.revert===true||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)){var f=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){f._trigger("stop",e)!==false&&f._clear();});}else{this._trigger("stop",e)!==false&&this._clear();}return false;},cancel:function(){this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear();return this;},_getHandle:function(d){var c=!this.options.handle||!a(this.options.handle,this.element).length?true:false;a(this.options.handle,this.element).find("*").andSelf().each(function(){if(this==d.target){c=true;}});return c;},_createHelper:function(d){var c=this.options;d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[d])):c.helper=="clone"?this.element.clone():this.element;d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo);d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute");return d;},_adjustOffsetFromHelper:function(b){if(typeof b=="string"){b=b.split(" ");}if(a.isArray(b)){b={left:+b[0],top:+b[1]||0};}if("left" in b){this.offset.click.left=b.left+this.margins.left;}if("right" in b){this.offset.click.left=this.helperProportions.width-b.right+this.margins.left;}if("top" in b){this.offset.click.top=b.top+this.margins.top;}if("bottom" in b){this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top;}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();if(this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])){b.left+=this.scrollParent.scrollLeft();b.top+=this.scrollParent.scrollTop();}if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie){b={top:0,left:0};}return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)};},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var b=this.element.position();return{top:b.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()};}else{return{top:0,left:0};}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0};},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()};},_setContainment:function(){var e=this.options;if(e.containment=="parent"){e.containment=this.helper[0].parentNode;}if(e.containment=="document"||e.containment=="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(e.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(e.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];}if(!/^(document|window|parent)$/.test(e.containment)&&e.containment.constructor!=Array){var d=a(e.containment)[0];if(d){e=a(e.containment).offset();var f=a(d).css("overflow")!="hidden";this.containment=[e.left+(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0)-this.margins.left,e.top+(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0)-this.margins.top,e.left+(f?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,e.top+(f?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top];}}else{if(e.containment.constructor==Array){this.containment=e.containment;}}},_convertPositionTo:function(e,d){if(!d){d=this.position;}e=e=="absolute"?1:-1;var h=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(h[0].tagName);return{top:d.top+this.offset.relative.top*e+this.offset.parent.top*e-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:h.scrollTop())*e),left:d.left+this.offset.relative.left*e+this.offset.parent.left*e-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:h.scrollLeft())*e)};},_generatePosition:function(h){var d=this.options,l=this.cssPosition=="absolute"&&!(this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,j=/(html|body)/i.test(l[0].tagName),k=h.pageX,i=h.pageY;if(this.originalPosition){if(this.containment){if(h.pageX-this.offset.click.left<this.containment[0]){k=this.containment[0]+this.offset.click.left;}if(h.pageY-this.offset.click.top<this.containment[1]){i=this.containment[1]+this.offset.click.top;}if(h.pageX-this.offset.click.left>this.containment[2]){k=this.containment[2]+this.offset.click.left;}if(h.pageY-this.offset.click.top>this.containment[3]){i=this.containment[3]+this.offset.click.top;}}if(d.grid){i=this.originalPageY+Math.round((i-this.originalPageY)/d.grid[1])*d.grid[1];i=this.containment?!(i-this.offset.click.top<this.containment[1]||i-this.offset.click.top>this.containment[3])?i:!(i-this.offset.click.top<this.containment[1])?i-d.grid[1]:i+d.grid[1]:i;k=this.originalPageX+Math.round((k-this.originalPageX)/d.grid[0])*d.grid[0];k=this.containment?!(k-this.offset.click.left<this.containment[0]||k-this.offset.click.left>this.containment[2])?k:!(k-this.offset.click.left<this.containment[0])?k-d.grid[0]:k+d.grid[0]:k;}}return{top:i-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():j?0:l.scrollTop()),left:k-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():j?0:l.scrollLeft())};},_clear:function(){this.helper.removeClass("ui-draggable-dragging");this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove();this.helper=null;this.cancelHelperRemoval=false;},_trigger:function(e,d,f){f=f||this._uiHash();a.ui.plugin.call(this,e,[d,f]);if(e=="drag"){this.positionAbs=this._convertPositionTo("absolute");}return a.Widget.prototype._trigger.call(this,e,d,f);},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs};}});a.extend(a.ui.draggable,{version:"1.8.1"});a.ui.plugin.add("draggable","connectToSortable",{start:function(g,d){var j=a(this).data("draggable"),h=j.options,i=a.extend({},d,{item:j.element});j.sortables=[];a(h.connectToSortable).each(function(){var b=a.data(this,"sortable");if(b&&!b.options.disabled){j.sortables.push({instance:b,shouldRevert:b.options.revert});b._refreshItems();b._trigger("activate",g,i);}});},stop:function(e,d){var h=a(this).data("draggable"),g=a.extend({},d,{item:h.element});a.each(h.sortables,function(){if(this.instance.isOver){this.instance.isOver=0;h.cancelHelperRemoval=true;this.instance.cancelHelperRemoval=false;if(this.shouldRevert){this.instance.options.revert=true;}this.instance._mouseStop(e);this.instance.options.helper=this.instance.options._helper;h.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"});}else{this.instance.cancelHelperRemoval=false;this.instance._trigger("deactivate",e,g);}});},drag:function(e,d){var h=a(this).data("draggable"),g=this;a.each(h.sortables,function(){this.instance.positionAbs=h.positionAbs;this.instance.helperProportions=h.helperProportions;this.instance.offset.click=h.offset.click;if(this.instance._intersectsWith(this.instance.containerCache)){if(!this.instance.isOver){this.instance.isOver=1;this.instance.currentItem=a(g).clone().appendTo(this.instance.element).data("sortable-item",true);this.instance.options._helper=this.instance.options.helper;this.instance.options.helper=function(){return d.helper[0];};e.target=this.instance.currentItem[0];this.instance._mouseCapture(e,true);this.instance._mouseStart(e,true,true);this.instance.offset.click.top=h.offset.click.top;this.instance.offset.click.left=h.offset.click.left;this.instance.offset.parent.left-=h.offset.parent.left-this.instance.offset.parent.left;this.instance.offset.parent.top-=h.offset.parent.top-this.instance.offset.parent.top;h._trigger("toSortable",e);h.dropped=this.instance.element;h.currentItem=h.element;this.instance.fromOutside=h;}this.instance.currentItem&&this.instance._mouseDrag(e);}else{if(this.instance.isOver){this.instance.isOver=0;this.instance.cancelHelperRemoval=true;this.instance.options.revert=false;this.instance._trigger("out",e,this.instance._uiHash(this.instance));this.instance._mouseStop(e,true);this.instance.options.helper=this.instance.options._helper;this.instance.currentItem.remove();this.instance.placeholder&&this.instance.placeholder.remove();h._trigger("fromSortable",e);h.dropped=false;}}});}});a.ui.plugin.add("draggable","cursor",{start:function(){var d=a("body"),c=a(this).data("draggable").options;if(d.css("cursor")){c._cursor=d.css("cursor");}d.css("cursor",c.cursor);},stop:function(){var b=a(this).data("draggable").options;b._cursor&&a("body").css("cursor",b._cursor);}});a.ui.plugin.add("draggable","iframeFix",{start:function(){var b=a(this).data("draggable").options;a(b.iframeFix===true?"iframe":b.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1000}).css(a(this).offset()).appendTo("body");});},stop:function(){a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this);});}});a.ui.plugin.add("draggable","opacity",{start:function(d,c){d=a(c.helper);c=a(this).data("draggable").options;if(d.css("opacity")){c._opacity=d.css("opacity");}d.css("opacity",c.opacity);},stop:function(d,c){d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity);}});a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("draggable");if(b.scrollParent[0]!=document&&b.scrollParent[0].tagName!="HTML"){b.overflowOffset=b.scrollParent.offset();}},drag:function(e){var d=a(this).data("draggable"),h=d.options,g=false;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!h.axis||h.axis!="x"){if(d.overflowOffset.top+d.scrollParent[0].offsetHeight-e.pageY<h.scrollSensitivity){d.scrollParent[0].scrollTop=g=d.scrollParent[0].scrollTop+h.scrollSpeed;}else{if(e.pageY-d.overflowOffset.top<h.scrollSensitivity){d.scrollParent[0].scrollTop=g=d.scrollParent[0].scrollTop-h.scrollSpeed;}}}if(!h.axis||h.axis!="y"){if(d.overflowOffset.left+d.scrollParent[0].offsetWidth-e.pageX<h.scrollSensitivity){d.scrollParent[0].scrollLeft=g=d.scrollParent[0].scrollLeft+h.scrollSpeed;}else{if(e.pageX-d.overflowOffset.left<h.scrollSensitivity){d.scrollParent[0].scrollLeft=g=d.scrollParent[0].scrollLeft-h.scrollSpeed;}}}}else{if(!h.axis||h.axis!="x"){if(e.pageY-a(document).scrollTop()<h.scrollSensitivity){g=a(document).scrollTop(a(document).scrollTop()-h.scrollSpeed);}else{if(a(window).height()-(e.pageY-a(document).scrollTop())<h.scrollSensitivity){g=a(document).scrollTop(a(document).scrollTop()+h.scrollSpeed);}}}if(!h.axis||h.axis!="y"){if(e.pageX-a(document).scrollLeft()<h.scrollSensitivity){g=a(document).scrollLeft(a(document).scrollLeft()-h.scrollSpeed);}else{if(a(window).width()-(e.pageX-a(document).scrollLeft())<h.scrollSensitivity){g=a(document).scrollLeft(a(document).scrollLeft()+h.scrollSpeed);}}}}g!==false&&a.ui.ddmanager&&!h.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,e);}});a.ui.plugin.add("draggable","snap",{start:function(){var d=a(this).data("draggable"),c=d.options;d.snapElements=[];a(c.snap.constructor!=String?c.snap.items||":data(draggable)":c.snap).each(function(){var e=a(this),b=e.offset();this!=d.element[0]&&d.snapElements.push({item:this,width:e.outerWidth(),height:e.outerHeight(),top:b.top,left:b.left});});},drag:function(L,K){for(var J=a(this).data("draggable"),H=J.options,I=H.snapTolerance,G=K.offset.left,z=G+J.helperProportions.width,A=K.offset.top,y=A+J.helperProportions.height,F=J.snapElements.length-1;F>=0;F--){var E=J.snapElements[F].left,C=E+J.snapElements[F].width,D=J.snapElements[F].top,B=D+J.snapElements[F].height;if(E-I<G&&G<C+I&&D-I<A&&A<B+I||E-I<G&&G<C+I&&D-I<y&&y<B+I||E-I<z&&z<C+I&&D-I<A&&A<B+I||E-I<z&&z<C+I&&D-I<y&&y<B+I){if(H.snapMode!="inner"){var x=Math.abs(D-y)<=I,w=Math.abs(B-A)<=I,v=Math.abs(E-z)<=I,u=Math.abs(C-G)<=I;if(x){K.position.top=J._convertPositionTo("relative",{top:D-J.helperProportions.height,left:0}).top-J.margins.top;}if(w){K.position.top=J._convertPositionTo("relative",{top:B,left:0}).top-J.margins.top;}if(v){K.position.left=J._convertPositionTo("relative",{top:0,left:E-J.helperProportions.width}).left-J.margins.left;}if(u){K.position.left=J._convertPositionTo("relative",{top:0,left:C}).left-J.margins.left;}}var d=x||w||v||u;if(H.snapMode!="outer"){x=Math.abs(D-A)<=I;w=Math.abs(B-y)<=I;v=Math.abs(E-G)<=I;u=Math.abs(C-z)<=I;if(x){K.position.top=J._convertPositionTo("relative",{top:D,left:0}).top-J.margins.top;}if(w){K.position.top=J._convertPositionTo("relative",{top:B-J.helperProportions.height,left:0}).top-J.margins.top;}if(v){K.position.left=J._convertPositionTo("relative",{top:0,left:E}).left-J.margins.left;}if(u){K.position.left=J._convertPositionTo("relative",{top:0,left:C-J.helperProportions.width}).left-J.margins.left;}}if(!J.snapElements[F].snapping&&(x||w||v||u||d)){J.options.snap.snap&&J.options.snap.snap.call(J.element,L,a.extend(J._uiHash(),{snapItem:J.snapElements[F].item}));}J.snapElements[F].snapping=x||w||v||u||d;}else{J.snapElements[F].snapping&&J.options.snap.release&&J.options.snap.release.call(J.element,L,a.extend(J._uiHash(),{snapItem:J.snapElements[F].item}));J.snapElements[F].snapping=false;}}}});a.ui.plugin.add("draggable","stack",{start:function(){var d=a(this).data("draggable").options;d=a.makeArray(a(d.stack)).sort(function(e,b){return(parseInt(a(e).css("zIndex"),10)||0)-(parseInt(a(b).css("zIndex"),10)||0);});if(d.length){var c=parseInt(d[0].style.zIndex)||0;a(d).each(function(b){this.style.zIndex=c+b;});this[0].style.zIndex=c+d.length;}}});a.ui.plugin.add("draggable","zIndex",{start:function(d,c){d=a(c.helper);c=a(this).data("draggable").options;if(d.css("zIndex")){c._zIndex=d.css("zIndex");}d.css("zIndex",c.zIndex);},stop:function(d,c){d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex);}});})(jQuery);(function(c){c.widget("ui.resizable",c.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1000},_create:function(){var d=this,h=this.options;this.element.addClass("ui-resizable");c.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){/relative/.test(this.element.css("position"))&&c.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"});this.element.wrap(c('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize();}this.handles=h.handles||(!c(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all"){this.handles="n,e,s,w,se,sw,ne,nw";}var l=this.handles.split(",");this.handles={};for(var k=0;k<l.length;k++){var i=c.trim(l[k]),j=c('<div class="ui-resizable-handle '+("ui-resizable-"+i)+'"></div>');/sw|se|ne|nw/.test(i)&&j.css({zIndex:++h.zIndex});"se"==i&&j.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[i]=".ui-resizable-"+i;this.element.append(j);}}this._renderAxis=function(m){m=m||this.element;for(var g in this.handles){if(this.handles[g].constructor==String){this.handles[g]=c(this.handles[g],this.element).show();}if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var f=c(this.handles[g],this.element),e=0;e=/sw|ne|nw|se|n|s/.test(g)?f.outerHeight():f.outerWidth();f=["padding",/ne|nw|n/.test(g)?"Top":/se|sw|s/.test(g)?"Bottom":/^e$/.test(g)?"Right":"Left"].join("");m.css(f,e);this._proportionallyResize();}c(this.handles[g]);}};this._renderAxis(this.element);this._handles=c(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!d.resizing){if(this.className){var e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);}d.axis=e&&e[1]?e[1]:"se";}});if(h.autoHide){this._handles.hide();c(this.element).addClass("ui-resizable-autohide").hover(function(){c(this).removeClass("ui-resizable-autohide");d._handles.show();},function(){if(!d.resizing){c(this).addClass("ui-resizable-autohide");d._handles.hide();}});}this._mouseInit();},destroy:function(){this._mouseDestroy();var d=function(f){c(f).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove();};if(this.elementIsWrapper){d(this.element);var e=this.element;e.after(this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")})).remove();}this.originalElement.css("resize",this.originalResizeStyle);d(this.originalElement);return this;},_mouseCapture:function(d){var e=false;for(var f in this.handles){if(c(this.handles[f])[0]==d.target){e=true;}}return !this.options.disabled&&e;},_mouseStart:function(d){var f=this.options,j=this.element.position(),i=this.element;this.resizing=true;this.documentScroll={top:c(document).scrollTop(),left:c(document).scrollLeft()};if(i.is(".ui-draggable")||/absolute/.test(i.css("position"))){i.css({position:"absolute",top:j.top,left:j.left});}c.browser.opera&&/relative/.test(i.css("position"))&&i.css({position:"relative",top:"auto",left:"auto"});this._renderProxy();j=a(this.helper.css("left"));var h=a(this.helper.css("top"));if(f.containment){j+=c(f.containment).scrollLeft()||0;h+=c(f.containment).scrollTop()||0;}this.offset=this.helper.offset();this.position={left:j,top:h};this.size=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()};this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()};this.originalPosition={left:j,top:h};this.sizeDiff={width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()};this.originalMousePosition={left:d.pageX,top:d.pageY};this.aspectRatio=typeof f.aspectRatio=="number"?f.aspectRatio:this.originalSize.width/this.originalSize.height||1;f=c(".ui-resizable-"+this.axis).css("cursor");c("body").css("cursor",f=="auto"?this.axis+"-resize":f);i.addClass("ui-resizable-resizing");this._propagate("start",d);return true;},_mouseDrag:function(d){var f=this.helper,h=this.originalMousePosition,g=this._change[this.axis];if(!g){return false;}h=g.apply(this,[d,d.pageX-h.left||0,d.pageY-h.top||0]);if(this._aspectRatio||d.shiftKey){h=this._updateRatio(h,d);}h=this._respectSize(h,d);this._propagate("resize",d);f.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(h);this._trigger("resize",d,this.ui());return false;},_mouseStop:function(d){this.resizing=false;var h=this.options,l=this;if(this._helper){var k=this._proportionallyResizeElements,i=k.length&&/textarea/i.test(k[0].nodeName);k=i&&c.ui.hasScroll(k[0],"left")?0:l.sizeDiff.height;i={width:l.size.width-(i?0:l.sizeDiff.width),height:l.size.height-k};k=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null;var j=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null;h.animate||this.element.css(c.extend(i,{top:j,left:k}));l.helper.height(l.size.height);l.helper.width(l.size.width);this._helper&&!h.animate&&this._proportionallyResize();}c("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",d);this._helper&&this.helper.remove();return false;},_updateCache:function(d){this.offset=this.helper.offset();if(b(d.left)){this.position.left=d.left;}if(b(d.top)){this.position.top=d.top;}if(b(d.height)){this.size.height=d.height;}if(b(d.width)){this.size.width=d.width;}},_updateRatio:function(d){var f=this.position,h=this.size,g=this.axis;if(d.height){d.width=h.height*this.aspectRatio;}else{if(d.width){d.height=h.width/this.aspectRatio;}}if(g=="sw"){d.left=f.left+(h.width-d.width);d.top=null;}if(g=="nw"){d.top=f.top+(h.height-d.height);d.left=f.left+(h.width-d.width);}return d;},_respectSize:function(s){var u=this.options,r=this.axis,q=b(s.width)&&u.maxWidth&&u.maxWidth<s.width,o=b(s.height)&&u.maxHeight&&u.maxHeight<s.height,p=b(s.width)&&u.minWidth&&u.minWidth>s.width,n=b(s.height)&&u.minHeight&&u.minHeight>s.height;if(p){s.width=u.minWidth;}if(n){s.height=u.minHeight;}if(q){s.width=u.maxWidth;}if(o){s.height=u.maxHeight;}var m=this.originalPosition.left+this.originalSize.width,k=this.position.top+this.size.height,d=/sw|nw|w/.test(r);r=/nw|ne|n/.test(r);if(p&&d){s.left=m-u.minWidth;}if(q&&d){s.left=m-u.maxWidth;}if(n&&r){s.top=k-u.minHeight;}if(o&&r){s.top=k-u.maxHeight;}if((u=!s.width&&!s.height)&&!s.left&&s.top){s.top=null;}else{if(u&&!s.top&&s.left){s.left=null;}}return s;},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){for(var d=this.helper||this.element,f=0;f<this._proportionallyResizeElements.length;f++){var j=this._proportionallyResizeElements[f];if(!this.borderDif){var i=[j.css("borderTopWidth"),j.css("borderRightWidth"),j.css("borderBottomWidth"),j.css("borderLeftWidth")],h=[j.css("paddingTop"),j.css("paddingRight"),j.css("paddingBottom"),j.css("paddingLeft")];this.borderDif=c.map(i,function(g,e){g=parseInt(g,10)||0;e=parseInt(h[e],10)||0;return g+e;});}c.browser.msie&&(c(d).is(":hidden")||c(d).parents(":hidden").length)||j.css({height:d.height()-this.borderDif[0]-this.borderDif[2]||0,width:d.width()-this.borderDif[1]-this.borderDif[3]||0});}}},_renderProxy:function(){var d=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||c('<div style="overflow:hidden;"></div>');var e=c.browser.msie&&c.browser.version<7,f=e?1:0;e=e?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+e,height:this.element.outerHeight()+e,position:"absolute",left:this.elementOffset.left-f+"px",top:this.elementOffset.top-f+"px",zIndex:++d.zIndex});this.helper.appendTo("body").disableSelection();}else{this.helper=this.element;}},_change:{e:function(d,e){return{width:this.originalSize.width+e};},w:function(d,e){return{left:this.originalPosition.left+e,width:this.originalSize.width-e};},n:function(d,e,f){return{top:this.originalPosition.top+f,height:this.originalSize.height-f};},s:function(d,e,f){return{height:this.originalSize.height+f};},se:function(d,e,f){return c.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[d,e,f]));},sw:function(d,e,f){return c.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[d,e,f]));},ne:function(d,e,f){return c.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[d,e,f]));},nw:function(d,e,f){return c.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[d,e,f]));}},_propagate:function(d,e){c.ui.plugin.call(this,d,[e,this.ui()]);d!="resize"&&this._trigger(d,e,this.ui());},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition};}});c.extend(c.ui.resizable,{version:"1.8.1"});c.ui.plugin.add("resizable","alsoResize",{start:function(){var d=c(this).data("resizable").options,e=function(f){c(f).each(function(){c(this).data("resizable-alsoresize",{width:parseInt(c(this).width(),10),height:parseInt(c(this).height(),10),left:parseInt(c(this).css("left"),10),top:parseInt(c(this).css("top"),10)});});};if(typeof d.alsoResize=="object"&&!d.alsoResize.parentNode){if(d.alsoResize.length){d.alsoResize=d.alsoResize[0];e(d.alsoResize);}else{c.each(d.alsoResize,function(f){e(f);});}}else{e(d.alsoResize);}},resize:function(){var d=c(this).data("resizable"),h=d.options,l=d.originalSize,k=d.originalPosition,i={height:d.size.height-l.height||0,width:d.size.width-l.width||0,top:d.position.top-k.top||0,left:d.position.left-k.left||0},j=function(f,e){c(f).each(function(){var m=c(this),g=c(this).data("resizable-alsoresize"),n={};c.each((e&&e.length?e:["width","height","top","left"])||["width","height","top","left"],function(q,p){if((q=(g[p]||0)+(i[p]||0))&&q>=0){n[p]=q||null;}});if(/relative/.test(m.css("position"))&&c.browser.opera){d._revertToRelativePosition=true;m.css({position:"absolute",top:"auto",left:"auto"});}m.css(n);});};typeof h.alsoResize=="object"&&!h.alsoResize.nodeType?c.each(h.alsoResize,function(f,e){j(f,e);}):j(h.alsoResize);},stop:function(){var d=c(this).data("resizable");if(d._revertToRelativePosition&&c.browser.opera){d._revertToRelativePosition=false;el.css({position:"relative"});}c(this).removeData("resizable-alsoresize-start");}});c.ui.plugin.add("resizable","animate",{stop:function(d){var i=c(this).data("resizable"),n=i.options,m=i._proportionallyResizeElements,k=m.length&&/textarea/i.test(m[0].nodeName),l=k&&c.ui.hasScroll(m[0],"left")?0:i.sizeDiff.height;k={width:i.size.width-(k?0:i.sizeDiff.width),height:i.size.height-l};l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null;var j=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(c.extend(k,j&&l?{top:j,left:l}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var e={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};m&&m.length&&c(m[0]).css({width:e.width,height:e.height});i._updateCache(e);i._propagate("resize",d);}});}});c.ui.plugin.add("resizable","containment",{start:function(){var d=c(this).data("resizable"),i=d.element,n=d.options.containment;if(i=n instanceof c?n.get(0):/parent/.test(n)?i.parent().get(0):n){d.containerElement=c(i);if(/document/.test(n)||n==document){d.containerOffset={left:0,top:0};d.containerPosition={left:0,top:0};d.parentData={element:c(document),left:0,top:0,width:c(document).width(),height:c(document).height()||document.body.parentNode.scrollHeight};}else{var m=c(i),k=[];c(["Top","Right","Left","Bottom"]).each(function(f,e){k[f]=a(m.css("padding"+e));});d.containerOffset=m.offset();d.containerPosition=m.position();d.containerSize={height:m.innerHeight()-k[3],width:m.innerWidth()-k[1]};n=d.containerOffset;var l=d.containerSize.height,j=d.containerSize.width;j=c.ui.hasScroll(i,"left")?i.scrollWidth:j;l=c.ui.hasScroll(i)?i.scrollHeight:l;d.parentData={element:i,left:n.left,top:n.top,width:j,height:l};}}},resize:function(d){var i=c(this).data("resizable"),n=i.options,m=i.containerOffset,k=i.position;d=i._aspectRatio||d.shiftKey;var l={top:0,left:0},j=i.containerElement;if(j[0]!=document&&/static/.test(j.css("position"))){l=m;}if(k.left<(i._helper?m.left:0)){i.size.width+=i._helper?i.position.left-m.left:i.position.left-l.left;if(d){i.size.height=i.size.width/n.aspectRatio;}i.position.left=n.helper?m.left:0;}if(k.top<(i._helper?m.top:0)){i.size.height+=i._helper?i.position.top-m.top:i.position.top;if(d){i.size.width=i.size.height*n.aspectRatio;}i.position.top=i._helper?m.top:0;}i.offset.left=i.parentData.left+i.position.left;i.offset.top=i.parentData.top+i.position.top;n=Math.abs((i._helper?i.offset.left-l.left:i.offset.left-l.left)+i.sizeDiff.width);m=Math.abs((i._helper?i.offset.top-l.top:i.offset.top-m.top)+i.sizeDiff.height);k=i.containerElement.get(0)==i.element.parent().get(0);l=/relative|absolute/.test(i.containerElement.css("position"));if(k&&l){n-=i.parentData.left;}if(n+i.size.width>=i.parentData.width){i.size.width=i.parentData.width-n;if(d){i.size.height=i.size.width/i.aspectRatio;}}if(m+i.size.height>=i.parentData.height){i.size.height=i.parentData.height-m;if(d){i.size.width=i.size.height*i.aspectRatio;}}},stop:function(){var d=c(this).data("resizable"),j=d.options,p=d.containerOffset,o=d.containerPosition,m=d.containerElement,n=c(d.helper),l=n.offset(),k=n.outerWidth()-d.sizeDiff.width;n=n.outerHeight()-d.sizeDiff.height;d._helper&&!j.animate&&/relative/.test(m.css("position"))&&c(this).css({left:l.left-o.left-p.left,width:k,height:n});d._helper&&!j.animate&&/static/.test(m.css("position"))&&c(this).css({left:l.left-o.left-p.left,width:k,height:n});}});c.ui.plugin.add("resizable","ghost",{start:function(){var d=c(this).data("resizable"),e=d.options,f=d.size;d.ghost=d.originalElement.clone();d.ghost.css({opacity:0.25,display:"block",position:"relative",height:f.height,width:f.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof e.ghost=="string"?e.ghost:"");d.ghost.appendTo(d.helper);},resize:function(){var d=c(this).data("resizable");d.ghost&&d.ghost.css({position:"relative",height:d.size.height,width:d.size.width});},stop:function(){var d=c(this).data("resizable");d.ghost&&d.helper&&d.helper.get(0).removeChild(d.ghost.get(0));}});c.ui.plugin.add("resizable","grid",{resize:function(){var d=c(this).data("resizable"),i=d.options,n=d.size,m=d.originalSize,k=d.originalPosition,l=d.axis;i.grid=typeof i.grid=="number"?[i.grid,i.grid]:i.grid;var j=Math.round((n.width-m.width)/(i.grid[0]||1))*(i.grid[0]||1);i=Math.round((n.height-m.height)/(i.grid[1]||1))*(i.grid[1]||1);if(/^(se|s|e)$/.test(l)){d.size.width=m.width+j;d.size.height=m.height+i;}else{if(/^(ne)$/.test(l)){d.size.width=m.width+j;d.size.height=m.height+i;d.position.top=k.top-i;}else{if(/^(sw)$/.test(l)){d.size.width=m.width+j;d.size.height=m.height+i;}else{d.size.width=m.width+j;d.size.height=m.height+i;d.position.top=k.top-i;}d.position.left=k.left-j;}}}});var a=function(d){return parseInt(d,10)||0;},b=function(d){return !isNaN(parseInt(d,10));};})(jQuery);(function(b){var e,c=function(a){b(":ui-button",a.target.form).each(function(){var f=b(this).data("button");setTimeout(function(){f.refresh();},1);});},d=function(a){var h=a.name,g=a.form,f=b([]);if(h){f=g?b(g).find("[name='"+h+"']"):b("[name='"+h+"']",a.ownerDocument).filter(function(){return !this.form;});}return f;};b.widget("ui.button",{options:{text:true,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",c);this._determineButtonType();this.hasTitle=!!this.buttonElement.attr("title");var a=this,h=this.options,g=this.type==="checkbox"||this.type==="radio",f="ui-state-hover"+(!g?" ui-state-active":"");if(h.label===null){h.label=this.buttonElement.html();}if(this.element.is(":disabled")){h.disabled=true;}this.buttonElement.addClass("ui-button ui-widget ui-state-default ui-corner-all").attr("role","button").bind("mouseenter.button",function(){if(!h.disabled){b(this).addClass("ui-state-hover");this===e&&b(this).addClass("ui-state-active");}}).bind("mouseleave.button",function(){h.disabled||b(this).removeClass(f);}).bind("focus.button",function(){b(this).addClass("ui-state-focus");}).bind("blur.button",function(){b(this).removeClass("ui-state-focus");});g&&this.element.bind("change.button",function(){a.refresh();});if(this.type==="checkbox"){this.buttonElement.bind("click.button",function(){if(h.disabled){return false;}b(this).toggleClass("ui-state-active");a.buttonElement.attr("aria-pressed",a.element[0].checked);});}else{if(this.type==="radio"){this.buttonElement.bind("click.button",function(){if(h.disabled){return false;}b(this).addClass("ui-state-active");a.buttonElement.attr("aria-pressed",true);var i=a.element[0];d(i).not(i).map(function(){return b(this).button("widget")[0];}).removeClass("ui-state-active").attr("aria-pressed",false);});}else{this.buttonElement.bind("mousedown.button",function(){if(h.disabled){return false;}b(this).addClass("ui-state-active");e=this;b(document).one("mouseup",function(){e=null;});}).bind("mouseup.button",function(){if(h.disabled){return false;}b(this).removeClass("ui-state-active");}).bind("keydown.button",function(i){if(h.disabled){return false;}if(i.keyCode==b.ui.keyCode.SPACE||i.keyCode==b.ui.keyCode.ENTER){b(this).addClass("ui-state-active");}}).bind("keyup.button",function(){b(this).removeClass("ui-state-active");});this.buttonElement.is("a")&&this.buttonElement.keyup(function(i){i.keyCode===b.ui.keyCode.SPACE&&b(this).click();});}}this._setOption("disabled",h.disabled);},_determineButtonType:function(){this.type=this.element.is(":checkbox")?"checkbox":this.element.is(":radio")?"radio":this.element.is("input")?"input":"button";if(this.type==="checkbox"||this.type==="radio"){this.buttonElement=this.element.parents().last().find("[for="+this.element.attr("id")+"]");this.element.addClass("ui-helper-hidden-accessible");var a=this.element.is(":checked");a&&this.buttonElement.addClass("ui-state-active");this.buttonElement.attr("aria-pressed",a);}else{this.buttonElement=this.element;}},widget:function(){return this.buttonElement;},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible");this.buttonElement.removeClass("ui-button ui-widget ui-state-default ui-corner-all ui-state-hover ui-state-active ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon ui-button-text-only").removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html());this.hasTitle||this.buttonElement.removeAttr("title");b.Widget.prototype.destroy.call(this);},_setOption:function(a,f){b.Widget.prototype._setOption.apply(this,arguments);if(a==="disabled"){f?this.element.attr("disabled",true):this.element.removeAttr("disabled");}this._resetButton();},refresh:function(){var a=this.element.is(":disabled");a!==this.options.disabled&&this._setOption("disabled",a);if(this.type==="radio"){d(this.element[0]).each(function(){b(this).is(":checked")?b(this).button("widget").addClass("ui-state-active").attr("aria-pressed",true):b(this).button("widget").removeClass("ui-state-active").attr("aria-pressed",false);});}else{if(this.type==="checkbox"){this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed",true):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed",false);}}},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);}else{var a=this.buttonElement,h=b("<span></span>").addClass("ui-button-text").html(this.options.label).appendTo(a.empty()).text(),g=this.options.icons,f=g.primary&&g.secondary;if(g.primary||g.secondary){a.addClass("ui-button-text-icon"+(f?"s":""));g.primary&&a.prepend("<span class='ui-button-icon-primary ui-icon "+g.primary+"'></span>");g.secondary&&a.append("<span class='ui-button-icon-secondary ui-icon "+g.secondary+"'></span>");if(!this.options.text){a.addClass(f?"ui-button-icons-only":"ui-button-icon-only").removeClass("ui-button-text-icons ui-button-text-icon");this.hasTitle||a.attr("title",h);}}else{a.addClass("ui-button-text-only");}}}});b.widget("ui.buttonset",{_create:function(){this.element.addClass("ui-buttonset");this._init();},_init:function(){this.refresh();},_setOption:function(a,f){a==="disabled"&&this.buttons.button("option",a,f);b.Widget.prototype._setOption.apply(this,arguments);},refresh:function(){this.buttons=this.element.find(":button, :submit, :reset, :checkbox, :radio, a, :data(button)").filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return b(this).button("widget")[0];}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass("ui-corner-left").end().filter(":last").addClass("ui-corner-right").end().end();},destroy:function(){this.element.removeClass("ui-buttonset");this.buttons.map(function(){return b(this).button("widget")[0];}).removeClass("ui-corner-left ui-corner-right").end().button("destroy");b.Widget.prototype.destroy.call(this);}});})(jQuery);(function(c){var b=0,a=0;c.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:false,cookie:null,collapsible:false,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:'<li><a href="#{href}"><span>#{label}</span></a></li>'},_create:function(){this._tabify(true);},_setOption:function(f,d){if(f=="selected"){this.options.collapsible&&d==this.options.selected||this.select(d);}else{this.options[f]=d;this._tabify();}},_tabId:function(d){return d.title&&d.title.replace(/\s/g,"_").replace(/[^A-Za-z0-9\-_:\.]/g,"")||this.options.idPrefix+ ++b;},_sanitizeSelector:function(d){return d.replace(/:/g,"\\:");},_cookie:function(){var d=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+ ++a);return c.cookie.apply(null,[d].concat(c.makeArray(arguments)));},_ui:function(f,d){return{tab:f,panel:d,index:this.anchors.index(f)};},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var d=c(this);d.html(d.data("label.tabs")).removeData("label.tabs");});},_tabify:function(w){function v(e,h){e.css({display:""});!c.support.opacity&&h.opacity&&e[0].style.removeAttribute("filter");}this.list=this.element.find("ol,ul").eq(0);this.lis=c("li:has(a[href])",this.list);this.anchors=this.lis.map(function(){return c("a",this)[0];});this.panels=c([]);var y=this,x=this.options,u=/^#.+/;this.anchors.each(function(i,k){var h=c(k).attr("href"),e=h.split("#")[0],m;if(e&&(e===location.toString().split("#")[0]||(m=c("base")[0])&&e===m.href)){h=k.hash;k.href=h;}if(u.test(h)){y.panels=y.panels.add(y._sanitizeSelector(h));}else{if(h!="#"){c.data(k,"href.tabs",h);c.data(k,"load.tabs",h.replace(/#.*$/,""));h=y._tabId(k);k.href="#"+h;k=c("#"+h);if(!k.length){k=c(x.panelTemplate).attr("id",h).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(y.panels[i-1]||y.list);k.data("destroy.tabs",true);}y.panels=y.panels.add(k);}else{x.disabled.push(i);}}});if(w){this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.lis.addClass("ui-state-default ui-corner-top");this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom");if(x.selected===undefined){location.hash&&this.anchors.each(function(e,h){if(h.hash==location.hash){x.selected=e;return false;}});if(typeof x.selected!="number"&&x.cookie){x.selected=parseInt(y._cookie(),10);}if(typeof x.selected!="number"&&this.lis.filter(".ui-tabs-selected").length){x.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));}x.selected=x.selected||(this.lis.length?0:-1);}else{if(x.selected===null){x.selected=-1;}}x.selected=x.selected>=0&&this.anchors[x.selected]||x.selected<0?x.selected:0;x.disabled=c.unique(x.disabled.concat(c.map(this.lis.filter(".ui-state-disabled"),function(e){return y.lis.index(e);}))).sort();c.inArray(x.selected,x.disabled)!=-1&&x.disabled.splice(c.inArray(x.selected,x.disabled),1);this.panels.addClass("ui-tabs-hide");this.lis.removeClass("ui-tabs-selected ui-state-active");if(x.selected>=0&&this.anchors.length){this.panels.eq(x.selected).removeClass("ui-tabs-hide");this.lis.eq(x.selected).addClass("ui-tabs-selected ui-state-active");y.element.queue("tabs",function(){y._trigger("show",null,y._ui(y.anchors[x.selected],y.panels[x.selected]));});this.load(x.selected);}c(window).bind("unload",function(){y.lis.add(y.anchors).unbind(".tabs");y.lis=y.anchors=y.panels=null;});}else{x.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"));}this.element[x.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible");x.cookie&&this._cookie(x.selected,x.cookie);w=0;for(var s;s=this.lis[w];w++){c(s)[c.inArray(w,x.disabled)!=-1&&!c(s).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");}x.cache===false&&this.anchors.removeData("cache.tabs");this.lis.add(this.anchors).unbind(".tabs");if(x.event!="mouseover"){var p=function(e,h){h.is(":not(.ui-state-disabled)")&&h.addClass("ui-state-"+e);},j=function(e,h){h.removeClass("ui-state-"+e);};this.lis.bind("mouseover.tabs",function(){p("hover",c(this));});this.lis.bind("mouseout.tabs",function(){j("hover",c(this));});this.anchors.bind("focus.tabs",function(){p("focus",c(this).closest("li"));});this.anchors.bind("blur.tabs",function(){j("focus",c(this).closest("li"));});}var l,g;if(x.fx){if(c.isArray(x.fx)){l=x.fx[0];g=x.fx[1];}else{l=g=x.fx;}}var f=g?function(e,h){c(e).closest("li").addClass("ui-tabs-selected ui-state-active");h.hide().removeClass("ui-tabs-hide").animate(g,g.duration||"normal",function(){v(h,g);y._trigger("show",null,y._ui(e,h[0]));});}:function(e,h){c(e).closest("li").addClass("ui-tabs-selected ui-state-active");h.removeClass("ui-tabs-hide");y._trigger("show",null,y._ui(e,h[0]));},d=l?function(e,h){h.animate(l,l.duration||"normal",function(){y.lis.removeClass("ui-tabs-selected ui-state-active");h.addClass("ui-tabs-hide");v(h,l);y.element.dequeue("tabs");});}:function(e,h){y.lis.removeClass("ui-tabs-selected ui-state-active");h.addClass("ui-tabs-hide");y.element.dequeue("tabs");};this.anchors.bind(x.event+".tabs",function(){var i=this,k=c(this).closest("li"),h=y.panels.filter(":not(.ui-tabs-hide)"),e=c(y._sanitizeSelector(this.hash));if(k.hasClass("ui-tabs-selected")&&!x.collapsible||k.hasClass("ui-state-disabled")||k.hasClass("ui-state-processing")||y._trigger("select",null,y._ui(this,e[0]))===false){this.blur();return false;}x.selected=y.anchors.index(this);y.abort();if(x.collapsible){if(k.hasClass("ui-tabs-selected")){x.selected=-1;x.cookie&&y._cookie(x.selected,x.cookie);y.element.queue("tabs",function(){d(i,h);}).dequeue("tabs");this.blur();return false;}else{if(!h.length){x.cookie&&y._cookie(x.selected,x.cookie);y.element.queue("tabs",function(){f(i,e);});y.load(y.anchors.index(this));this.blur();return false;}}}x.cookie&&y._cookie(x.selected,x.cookie);if(e.length){h.length&&y.element.queue("tabs",function(){d(i,h);});y.element.queue("tabs",function(){f(i,e);});y.load(y.anchors.index(this));}else{throw"jQuery UI Tabs: Mismatching fragment identifier.";}c.browser.msie&&this.blur();});this.anchors.bind("click.tabs",function(){return false;});},destroy:function(){var d=this.options;this.abort();this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs");this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all");this.anchors.each(function(){var g=c.data(this,"href.tabs");if(g){this.href=g;}var f=c(this).unbind(".tabs");c.each(["href","load","cache"],function(e,i){f.removeData(i+".tabs");});});this.lis.unbind(".tabs").add(this.panels).each(function(){c.data(this,"destroy.tabs")?c(this).remove():c(this).removeClass("ui-state-default ui-corner-top ui-tabs-selected ui-state-active ui-state-hover ui-state-focus ui-state-disabled ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");});d.cookie&&this._cookie(null,d.cookie);return this;},add:function(l,k,f){if(f===undefined){f=this.anchors.length;}var d=this,j=this.options;k=c(j.tabTemplate.replace(/#\{href\}/g,l).replace(/#\{label\}/g,k));l=!l.indexOf("#")?l.replace("#",""):this._tabId(c("a",k)[0]);k.addClass("ui-state-default ui-corner-top").data("destroy.tabs",true);var g=c("#"+l);g.length||(g=c(j.panelTemplate).attr("id",l).data("destroy.tabs",true));g.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide");if(f>=this.lis.length){k.appendTo(this.list);g.appendTo(this.list[0].parentNode);}else{k.insertBefore(this.lis[f]);g.insertBefore(this.panels[f]);}j.disabled=c.map(j.disabled,function(e){return e>=f?++e:e;});this._tabify();if(this.anchors.length==1){j.selected=0;k.addClass("ui-tabs-selected ui-state-active");g.removeClass("ui-tabs-hide");this.element.queue("tabs",function(){d._trigger("show",null,d._ui(d.anchors[0],d.panels[0]));});this.load(0);}this._trigger("add",null,this._ui(this.anchors[f],this.panels[f]));return this;},remove:function(h){var g=this.options,f=this.lis.eq(h).remove(),d=this.panels.eq(h).remove();if(f.hasClass("ui-tabs-selected")&&this.anchors.length>1){this.select(h+(h+1<this.anchors.length?1:-1));}g.disabled=c.map(c.grep(g.disabled,function(e){return e!=h;}),function(e){return e>=h?--e:e;});this._tabify();this._trigger("remove",null,this._ui(f.find("a")[0],d[0]));return this;},enable:function(f){var d=this.options;if(c.inArray(f,d.disabled)!=-1){this.lis.eq(f).removeClass("ui-state-disabled");d.disabled=c.grep(d.disabled,function(e){return e!=f;});this._trigger("enable",null,this._ui(this.anchors[f],this.panels[f]));return this;}},disable:function(f){var d=this.options;if(f!=d.selected){this.lis.eq(f).addClass("ui-state-disabled");d.disabled.push(f);d.disabled.sort();this._trigger("disable",null,this._ui(this.anchors[f],this.panels[f]));}return this;},select:function(d){if(typeof d=="string"){d=this.anchors.index(this.anchors.filter("[href$="+d+"]"));}else{if(d===null){d=-1;}}if(d==-1&&this.options.collapsible){d=this.options.selected;}this.anchors.eq(d).trigger(this.options.event+".tabs");return this;},load:function(l){var k=this,f=this.options,d=this.anchors.eq(l)[0],j=c.data(d,"load.tabs");this.abort();if(!j||this.element.queue("tabs").length!==0&&c.data(d,"cache.tabs")){this.element.dequeue("tabs");}else{this.lis.eq(l).addClass("ui-state-processing");if(f.spinner){var g=c("span",d);g.data("label.tabs",g.html()).html(f.spinner);}this.xhr=c.ajax(c.extend({},f.ajaxOptions,{url:j,success:function(h,i){c(k._sanitizeSelector(d.hash)).html(h);k._cleanup();f.cache&&c.data(d,"cache.tabs",true);k._trigger("load",null,k._ui(k.anchors[l],k.panels[l]));try{f.ajaxOptions.success(h,i);}catch(e){}},error:function(h,i){k._cleanup();k._trigger("load",null,k._ui(k.anchors[l],k.panels[l]));try{f.ajaxOptions.error(h,i,l,d);}catch(e){}}}));k.element.dequeue("tabs");return this;}},abort:function(){this.element.queue([]);this.panels.stop(false,true);this.element.queue("tabs",this.element.queue("tabs").splice(-2,2));if(this.xhr){this.xhr.abort();delete this.xhr;}this._cleanup();return this;},url:function(f,d){this.anchors.eq(f).removeData("cache.tabs").data("load.tabs",d);return this;},length:function(){return this.anchors.length;}});c.extend(c.ui.tabs,{version:"1.8.1"});c.extend(c.ui.tabs.prototype,{rotation:null,rotate:function(j,i){var f=this,d=this.options,g=f._rotate||(f._rotate=function(e){clearTimeout(f.rotation);f.rotation=setTimeout(function(){var h=d.selected;f.select(++h<f.anchors.length?h:0);},j);e&&e.stopPropagation();});i=f._unrotate||(f._unrotate=!i?function(e){e.clientX&&f.rotate(null);}:function(){t=d.selected;g();});if(j){this.element.bind("tabsshow",g);this.anchors.bind(d.event+".tabs",i);g();}else{clearTimeout(f.rotation);this.element.unbind("tabsshow",g);this.anchors.unbind(d.event+".tabs",i);delete this._rotate;delete this._unrotate;}return this;}});})(jQuery);(function(a){a.widget("ui.dialog",{options:{autoOpen:true,buttons:{},closeOnEscape:true,closeText:"close",dialogClass:"",draggable:true,hide:null,height:"auto",maxHeight:false,maxWidth:false,minHeight:150,minWidth:150,modal:false,position:"center",resizable:true,show:null,stack:true,title:"",width:300,zIndex:1000},_create:function(){this.originalTitle=this.element.attr("title");var i=this,c=i.options,n=c.title||i.originalTitle||"&#160;",m=a.ui.dialog.getTitleId(i.element),k=(i.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c.dialogClass).css({zIndex:c.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(b){if(c.closeOnEscape&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE){i.close(b);b.preventDefault();}}).attr({role:"dialog","aria-labelledby":m}).mousedown(function(b){i.moveToTop(false,b);});i.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(k);var l=(i.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(k),j=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){j.addClass("ui-state-hover");},function(){j.removeClass("ui-state-hover");}).focus(function(){j.addClass("ui-state-focus");}).blur(function(){j.removeClass("ui-state-focus");}).click(function(b){i.close(b);return false;}).appendTo(l);(i.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(c.closeText).appendTo(j);a("<span></span>").addClass("ui-dialog-title").attr("id",m).html(n).prependTo(l);if(a.isFunction(c.beforeclose)&&!a.isFunction(c.beforeClose)){c.beforeClose=c.beforeclose;}l.find("*").add(l).disableSelection();c.draggable&&a.fn.draggable&&i._makeDraggable();c.resizable&&a.fn.resizable&&i._makeResizable();i._createButtons(c.buttons);i._isOpen=false;a.fn.bgiframe&&k.bgiframe();},_init:function(){this.options.autoOpen&&this.open();},destroy:function(){var b=this;b.overlay&&b.overlay.destroy();b.uiDialog.hide();b.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body");b.uiDialog.remove();b.originalTitle&&b.element.attr("title",b.originalTitle);return b;},widget:function(){return this.uiDialog;},close:function(e){var c=this,f;if(false!==c._trigger("beforeClose",e)){c.overlay&&c.overlay.destroy();c.uiDialog.unbind("keypress.ui-dialog");c._isOpen=false;if(c.options.hide){c.uiDialog.hide(c.options.hide,function(){c._trigger("close",e);});}else{c.uiDialog.hide();c._trigger("close",e);}a.ui.dialog.overlay.resize();if(c.options.modal){f=0;a(".ui-dialog").each(function(){if(this!==c.uiDialog[0]){f=Math.max(f,a(this).css("z-index"));}});a.ui.dialog.maxZ=f;}return c;}},isOpen:function(){return this._isOpen;},moveToTop:function(f,c){var h=this,g=h.options;if(g.modal&&!f||!g.stack&&!g.modal){return h._trigger("focus",c);}if(g.zIndex>a.ui.dialog.maxZ){a.ui.dialog.maxZ=g.zIndex;}if(h.overlay){a.ui.dialog.maxZ+=1;h.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ);}f={scrollTop:h.element.attr("scrollTop"),scrollLeft:h.element.attr("scrollLeft")};a.ui.dialog.maxZ+=1;h.uiDialog.css("z-index",a.ui.dialog.maxZ);h.element.attr(f);h._trigger("focus",c);return h;},open:function(){if(!this._isOpen){var e=this,c=e.options,f=e.uiDialog;e.overlay=c.modal?new a.ui.dialog.overlay(e):null;f.next().length&&f.appendTo("body");e._size();e._position(c.position);f.show(c.show);e.moveToTop(true);c.modal&&f.bind("keypress.ui-dialog",function(h){if(h.keyCode===a.ui.keyCode.TAB){var b=a(":tabbable",this),d=b.filter(":first");b=b.filter(":last");if(h.target===b[0]&&!h.shiftKey){d.focus(1);return false;}else{if(h.target===d[0]&&h.shiftKey){b.focus(1);return false;}}}});a([]).add(f.find(".ui-dialog-content :tabbable:first")).add(f.find(".ui-dialog-buttonpane :tabbable:first")).add(f).filter(":first").focus();e._trigger("open");e._isOpen=true;return e;}},_createButtons:function(f){var c=this,h=false,g=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix");c.uiDialog.find(".ui-dialog-buttonpane").remove();typeof f==="object"&&f!==null&&a.each(f,function(){return !(h=true);});if(h){a.each(f,function(b,d){b=a('<button type="button"></button>').text(b).click(function(){d.apply(c.element[0],arguments);}).appendTo(g);a.fn.button&&b.button();});g.appendTo(c.uiDialog);}},_makeDraggable:function(){function f(b){return{position:b.position,offset:b.offset};}var c=this,j=c.options,i=a(document),h;c.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,b){h=j.height==="auto"?"auto":a(this).height();a(this).height(a(this).height()).addClass("ui-dialog-dragging");c._trigger("dragStart",d,f(b));},drag:function(d,b){c._trigger("drag",d,f(b));},stop:function(d,b){j.position=[b.position.left-i.scrollLeft(),b.position.top-i.scrollTop()];a(this).removeClass("ui-dialog-dragging").height(h);c._trigger("dragStop",d,f(b));a.ui.dialog.overlay.resize();}});},_makeResizable:function(f){function c(b){return{originalPosition:b.originalPosition,originalSize:b.originalSize,position:b.position,size:b.size};}f=f===undefined?this.options.resizable:f;var j=this,i=j.options,h=j.uiDialog.css("position");f=typeof f==="string"?f:"n,e,s,w,se,sw,ne,nw";j.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:j.element,maxWidth:i.maxWidth,maxHeight:i.maxHeight,minWidth:i.minWidth,minHeight:j._minHeight(),handles:f,start:function(d,b){a(this).addClass("ui-dialog-resizing");j._trigger("resizeStart",d,c(b));},resize:function(d,b){j._trigger("resize",d,c(b));},stop:function(d,b){a(this).removeClass("ui-dialog-resizing");i.height=a(this).height();i.width=a(this).width();j._trigger("resizeStop",d,c(b));a.ui.dialog.overlay.resize();}}).css("position",h).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se");},_minHeight:function(){var b=this.options;return b.height==="auto"?b.minHeight:Math.min(b.minHeight,b.height);},_position:function(e){var c=[],f=[0,0];e=e||a.ui.dialog.prototype.options.position;if(typeof e==="string"||typeof e==="object"&&"0" in e){c=e.split?e.split(" "):[e[0],e[1]];if(c.length===1){c[1]=c[0];}a.each(["left","top"],function(d,b){if(+c[d]===c[d]){f[d]=c[d];c[d]=b;}});}else{if(typeof e==="object"){if("left" in e){c[0]="left";f[0]=e.left;}else{if("right" in e){c[0]="right";f[0]=-e.right;}}if("top" in e){c[1]="top";f[1]=e.top;}else{if("bottom" in e){c[1]="bottom";f[1]=-e.bottom;}}}}(e=this.uiDialog.is(":visible"))||this.uiDialog.show();this.uiDialog.css({top:0,left:0}).position({my:c.join(" "),at:c.join(" "),offset:f.join(" "),of:window,collision:"fit",using:function(d){var b=a(this).css(d).offset().top;b<0&&a(this).css("top",d.top-b);}});e||this.uiDialog.hide();},_setOption:function(h,c){var l=this,k=l.uiDialog,i=k.is(":data(resizable)"),j=false;switch(h){case"beforeclose":h="beforeClose";break;case"buttons":l._createButtons(c);break;case"closeText":l.uiDialogTitlebarCloseText.text(""+c);break;case"dialogClass":k.removeClass(l.options.dialogClass).addClass("ui-dialog ui-widget ui-widget-content ui-corner-all "+c);break;case"disabled":c?k.addClass("ui-dialog-disabled"):k.removeClass("ui-dialog-disabled");break;case"draggable":c?l._makeDraggable():k.draggable("destroy");break;case"height":j=true;break;case"maxHeight":i&&k.resizable("option","maxHeight",c);j=true;break;case"maxWidth":i&&k.resizable("option","maxWidth",c);j=true;break;case"minHeight":i&&k.resizable("option","minHeight",c);j=true;break;case"minWidth":i&&k.resizable("option","minWidth",c);j=true;break;case"position":l._position(c);break;case"resizable":i&&!c&&k.resizable("destroy");i&&typeof c==="string"&&k.resizable("option","handles",c);!i&&c!==false&&l._makeResizable(c);break;case"title":a(".ui-dialog-title",l.uiDialogTitlebar).html(""+(c||"&#160;"));break;case"width":j=true;break;}a.Widget.prototype._setOption.apply(l,arguments);j&&l._size();},_size:function(){var d=this.options,c;this.element.css({width:"auto",minHeight:0,height:0});c=this.uiDialog.css({height:"auto",width:d.width}).height();this.element.css(d.height==="auto"?{minHeight:Math.max(d.minHeight-c,0),height:"auto"}:{minHeight:0,height:Math.max(d.height-c,0)}).show();this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight());}});a.extend(a.ui.dialog,{version:"1.8.1",uuid:0,maxZ:0,getTitleId:function(b){b=b.attr("id");if(!b){this.uuid+=1;b=this.uuid;}return"ui-dialog-title-"+b;},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b);}});a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(b){return b+".dialog-overlay";}).join(" "),create:function(d){if(this.instances.length===0){setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){return a(b.target).zIndex()>=a.ui.dialog.overlay.maxZ;});},1);a(document).bind("keydown.dialog-overlay",function(b){if(d.options.closeOnEscape&&b.keyCode&&b.keyCode===a.ui.keyCode.ESCAPE){d.close(b);b.preventDefault();}});a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize);}var c=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});a.fn.bgiframe&&c.bgiframe();this.instances.push(c);return c;},destroy:function(d){this.oldInstances.push(this.instances.splice(a.inArray(d,this.instances),1)[0]);this.instances.length===0&&a([document,window]).unbind(".dialog-overlay");d.remove();var c=0;a.each(this.instances,function(){c=Math.max(c,this.css("z-index"));});this.maxZ=c;},height:function(){var d,c;if(a.browser.msie&&a.browser.version<7){d=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight);c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight);return d<c?a(window).height()+"px":d+"px";}else{return a(document).height()+"px";}},width:function(){var d,c;if(a.browser.msie&&a.browser.version<7){d=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth);c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth);return d<c?a(window).width()+"px":d+"px";}else{return a(document).width()+"px";}},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this);});b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()});}});a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el);}});})(jQuery);(function(a){var b=a.fn.val;a.iHint=function(e,c){var d=a(e);e.iHint={text:"iHint Text",className:"iHint-default"};a.extend(e.iHint,c);d.blur(function(){if(!b.call(d)){d.addClass(e.iHint.className);b.call(d,e.iHint.text);}}).focus(function(){if(b.call(d)==e.iHint.text){d.removeClass(e.iHint.className);b.call(d,"");}}).trigger("blur");};a.fn.iHint=function(c){return this.each(function(){new a.iHint(this,c);});};a.fn.val=function(c){if(this[0]&&this[0].iHint){if(typeof(c)=="undefined"){if(b.apply(this,arguments)==this[0].iHint.text){return"";}}else{this.removeClass(this[0].iHint.className);return b.apply(this,arguments);}}return b.apply(this,arguments);};})(jQuery);(function(aO){var aF,aA,ay,aL,ap,aJ,aw,at,ar,aD=0,aM={},aC=[],aE=0,aN={},aI=[],ao=null,aB=new Image,am=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,ab=/[^\.]\.(swf)\s*$/i,al,ak=1,aH,aG,aK=false,ax=aO.extend(aO("<div/>")[0],{prop:0}),az=0,ae=!aO.support.opacity&&!window.XMLHttpRequest,aj=function(){aA.hide();aB.onerror=aB.onload=null;ao&&ao.abort();aF.empty();},ad=function(){aO.fancybox('<p id="fancybox_error">The requested content cannot be loaded.<br />Please try again later.</p>',{scrolling:"no",padding:20,transitionIn:"none",transitionOut:"none"});},ai=function(){return[aO(window).width(),aO(window).height(),aO(document).scrollLeft(),aO(document).scrollTop()];},R=function(){var c=ai(),j={},h=aN.margin,i=aN.autoScale,e=(20+h)*2,b=(20+h)*2,g=aN.padding*2;if(aN.width.toString().indexOf("%")>-1){j.width=c[0]*parseFloat(aN.width)/100-40;i=false;}else{j.width=aN.width+g;}if(aN.height.toString().indexOf("%")>-1){j.height=c[1]*parseFloat(aN.height)/100-40;i=false;}else{j.height=aN.height+g;}if(i&&(j.width>c[0]-e||j.height>c[1]-b)){if(aM.type=="image"||aM.type=="swf"){e+=g;b+=g;i=Math.min(Math.min(c[0]-e,aN.width)/aN.width,Math.min(c[1]-b,aN.height)/aN.height);j.width=Math.round(i*(j.width-g))+g;j.height=Math.round(i*(j.height-g))+g;}else{j.width=Math.min(j.width,c[0]-e);j.height=Math.min(j.height,c[1]-b);}}j.top=c[3]+(c[1]-(j.height+40))*0.5;j.left=c[2]+(c[0]-(j.width+40))*0.5;if(aN.autoScale===false){j.top=Math.max(c[3]+h,j.top);j.left=Math.max(c[2]+h,j.left);}return j;},w=function(b){if(b&&b.length){switch(aN.titlePosition){case"inside":return b;case"over":return'<span id="fancybox-title-over">'+b+"</span>";default:return'<span id="fancybox-title-wrap"><span id="fancybox-title-left"></span><span id="fancybox-title-main">'+b+'</span><span id="fancybox-title-right"></span></span>';}}return false;},r=function(){var b=aN.title,e=aG.width-aN.padding*2,c="fancybox-title-"+aN.titlePosition;aO("#fancybox-title").remove();az=0;if(aN.titleShow!==false){b=aO.isFunction(aN.titleFormat)?aN.titleFormat(b,aI,aE,aN):w(b);if(!(!b||b==="")){aO('<div id="fancybox-title" class="'+c+'" />').css({width:e,paddingLeft:aN.padding,paddingRight:aN.padding}).html(b).appendTo("body");switch(aN.titlePosition){case"inside":az=aO("#fancybox-title").outerHeight(true)-aN.padding;aG.height+=az;break;case"over":aO("#fancybox-title").css("bottom",aN.padding);break;default:aO("#fancybox-title").css("bottom",aO("#fancybox-title").outerHeight(true)*-1);break;}aO("#fancybox-title").appendTo(ap).hide();}}},o=function(){aO(document).unbind("keydown.fb").bind("keydown.fb",function(b){if(b.keyCode==27&&aN.enableEscapeButton){b.preventDefault();aO.fancybox.close();}else{if(b.keyCode==37){b.preventDefault();aO.fancybox.prev();}else{if(b.keyCode==39){b.preventDefault();aO.fancybox.next();}}}});if(aO.fn.mousewheel){aL.unbind("mousewheel.fb");aI.length>1&&aL.bind("mousewheel.fb",function(b,c){b.preventDefault();aK||c===0||(c>0?aO.fancybox.prev():aO.fancybox.next());});}if(aN.showNavArrows){if(aN.cyclic&&aI.length>1||aE!==0){at.show();}if(aN.cyclic&&aI.length>1||aE!=aI.length-1){ar.show();}}},f=function(){var b,c;if(aI.length-1>aE){b=aI[aE+1].href;if(typeof b!=="undefined"&&b.match(am)){c=new Image;c.src=b;}}if(aE>0){b=aI[aE-1].href;if(typeof b!=="undefined"&&b.match(am)){c=new Image;c.src=b;}}},ah=function(){aJ.css("overflow",aN.scrolling=="auto"?aN.type=="image"||aN.type=="iframe"||aN.type=="swf"?"hidden":"auto":aN.scrolling=="yes"?"auto":"visible");if(!aO.support.opacity){aJ.get(0).style.removeAttribute("filter");aL.get(0).style.removeAttribute("filter");}aO("#fancybox-title").show();aN.hideOnContentClick&&aJ.one("click",aO.fancybox.close);aN.hideOnOverlayClick&&ay.one("click",aO.fancybox.close);aN.showCloseButton&&aw.show();o();aO(window).bind("resize.fb",aO.fancybox.center);aN.centerOnScroll?aO(window).bind("scroll.fb",aO.fancybox.center):aO(window).unbind("scroll.fb");aO.isFunction(aN.onComplete)&&aN.onComplete(aI,aE,aN);aK=false;f();},ag=function(b){var h=Math.round(aH.width+(aG.width-aH.width)*b),e=Math.round(aH.height+(aG.height-aH.height)*b),g=Math.round(aH.top+(aG.top-aH.top)*b),c=Math.round(aH.left+(aG.left-aH.left)*b);aL.css({width:h+"px",height:e+"px",top:g+"px",left:c+"px"});h=Math.max(h-aN.padding*2,0);e=Math.max(e-(aN.padding*2+az*b),0);aJ.css({width:h+"px",height:e+"px"});if(typeof aG.opacity!=="undefined"){aL.css("opacity",b<0.5?0.5:b);}},d=function(b){var c=b.offset();c.top+=parseFloat(b.css("paddingTop"))||0;c.left+=parseFloat(b.css("paddingLeft"))||0;c.top+=parseFloat(b.css("border-top-width"))||0;c.left+=parseFloat(b.css("border-left-width"))||0;c.width=b.width();c.height=b.height();return c;},ac=function(){var b=aM.orig?aO(aM.orig):false,c={};if(b&&b.length){b=d(b);c={width:b.width+aN.padding*2,height:b.height+aN.padding*2,top:b.top-aN.padding-20,left:b.left-aN.padding-20};}else{b=ai();c={width:1,height:1,top:b[3]+b[1]*0.5,left:b[2]+b[0]*0.5};}return c;},af=function(){aA.hide();if(aL.is(":visible")&&aO.isFunction(aN.onCleanup)){if(aN.onCleanup(aI,aE,aN)===false){aO.event.trigger("fancybox-cancel");aK=false;return;}}aI=aC;aE=aD;aN=aM;aJ.get(0).scrollTop=0;aJ.get(0).scrollLeft=0;if(aN.overlayShow){ae&&aO("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden";}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit";});ay.css({"background-color":aN.overlayColor,opacity:aN.overlayOpacity}).unbind().show();}aG=R();r();if(aL.is(":visible")){aO(aw.add(at).add(ar)).hide();var b=aL.position(),c;aH={top:b.top,left:b.left,width:aL.width(),height:aL.height()};c=aH.width==aG.width&&aH.height==aG.height;aJ.fadeOut(aN.changeFade,function(){var e=function(){aJ.html(aF.contents()).fadeIn(aN.changeFade,ah);};aO.event.trigger("fancybox-change");aJ.empty().css("overflow","hidden");if(c){aJ.css({top:aN.padding,left:aN.padding,width:Math.max(aG.width-aN.padding*2,1),height:Math.max(aG.height-aN.padding*2-az,1)});e();}else{aJ.css({top:aN.padding,left:aN.padding,width:Math.max(aH.width-aN.padding*2,1),height:Math.max(aH.height-aN.padding*2,1)});ax.prop=0;aO(ax).animate({prop:1},{duration:aN.changeSpeed,easing:aN.easingChange,step:ag,complete:e});}});}else{aL.css("opacity",1);if(aN.transitionIn=="elastic"){aH=ac();aJ.css({top:aN.padding,left:aN.padding,width:Math.max(aH.width-aN.padding*2,1),height:Math.max(aH.height-aN.padding*2,1)}).html(aF.contents());aL.css(aH).show();if(aN.opacity){aG.opacity=0;}ax.prop=0;aO(ax).animate({prop:1},{duration:aN.speedIn,easing:aN.easingIn,step:ag,complete:ah});}else{aJ.css({top:aN.padding,left:aN.padding,width:Math.max(aG.width-aN.padding*2,1),height:Math.max(aG.height-aN.padding*2-az,1)}).html(aF.contents());aL.css(aG).fadeIn(aN.transitionIn=="none"?0:aN.speedIn,ah);}}},an=function(){aF.width(aM.width);aF.height(aM.height);if(aM.width=="auto"){aM.width=aF.width();}if(aM.height=="auto"){aM.height=aF.height();}af();},a=function(){aK=true;aM.width=aB.width;aM.height=aB.height;aO("<img />").attr({id:"fancybox-img",src:aB.src,alt:aM.title}).appendTo(aF);af();},aq=function(){aj();var c=aC[aD],i,g,h,e,b;aM=aO.extend({},aO.fn.fancybox.defaults,typeof aO(c).data("fancybox")=="undefined"?aM:aO(c).data("fancybox"));h=c.title||aO(c).title||aM.title||"";if(c.nodeName&&!aM.orig){aM.orig=aO(c).children("img:first").length?aO(c).children("img:first"):aO(c);}if(h===""&&aM.orig){h=aM.orig.attr("alt");}i=c.nodeName&&/^(?:javascript|#)/i.test(c.href)?aM.href||null:aM.href||c.href||null;if(aM.type){g=aM.type;if(!i){i=aM.content;}}else{if(aM.content){g="html";}else{if(i){if(i.match(am)){g="image";}else{if(i.match(ab)){g="swf";}else{if(aO(c).hasClass("iframe")){g="iframe";}else{if(i.match(/#/)){c=i.substr(i.indexOf("#"));g=aO(c).length>0?"inline":"ajax";}else{g="ajax";}}}}}else{g="inline";}}}aM.type=g;aM.href=i;aM.title=h;if(aM.autoDimensions&&aM.type!=="iframe"&&aM.type!=="swf"){aM.width="auto";aM.height="auto";}if(aM.modal){aM.overlayShow=true;aM.hideOnOverlayClick=false;aM.hideOnContentClick=false;aM.enableEscapeButton=false;aM.showCloseButton=false;}if(aO.isFunction(aM.onStart)){if(aM.onStart(aC,aD,aM)===false){aK=false;return;}}aF.css("padding",20+aM.padding+aM.margin);aO(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){aO(this).replaceWith(aJ.children());});switch(g){case"html":aF.html(aM.content);an();break;case"inline":aO('<div class="fancybox-inline-tmp" />').hide().insertBefore(aO(c)).bind("fancybox-cleanup",function(){aO(this).replaceWith(aJ.children());}).bind("fancybox-cancel",function(){aO(this).replaceWith(aF.children());});aO(c).appendTo(aF);an();break;case"image":aK=false;aO.fancybox.showActivity();aB=new Image;aB.onerror=function(){ad();};aB.onload=function(){aB.onerror=null;aB.onload=null;a();};aB.src=i;break;case"swf":e='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+aM.width+'" height="'+aM.height+'"><param name="movie" value="'+i+'"></param>';b="";aO.each(aM.swf,function(k,j){e+='<param name="'+k+'" value="'+j+'"></param>';b+=" "+k+'="'+j+'"';});e+='<embed src="'+i+'" type="application/x-shockwave-flash" width="'+aM.width+'" height="'+aM.height+'"'+b+"></embed></object>";aF.html(e);an();break;case"ajax":c=i.split("#",2);g=aM.ajax.data||{};if(c.length>1){i=c[0];if(typeof g=="string"){g+="&selector="+c[1];}else{g.selector=c[1];}}aK=false;aO.fancybox.showActivity();ao=aO.ajax(aO.extend(aM.ajax,{url:i,data:g,error:ad,success:function(j){if(ao.status==200){aF.html(j);an();}}}));break;case"iframe":aO('<iframe id="fancybox-frame" name="fancybox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" scrolling="'+aM.scrolling+'" src="'+aM.href+'"></iframe>').appendTo(aF);af();break;}},av=function(){if(aA.is(":visible")){aO("div",aA).css("top",ak*-40+"px");ak=(ak+1)%12;}else{clearInterval(al);}},au=function(){if(!aO("#fancybox-wrap").length){aO("body").append(aF=aO('<div id="fancybox-tmp"></div>'),aA=aO('<div id="fancybox-loading"><div></div></div>'),ay=aO('<div id="fancybox-overlay"></div>'),aL=aO('<div id="fancybox-wrap"></div>'));if(!aO.support.opacity){aL.addClass("fancybox-ie");aA.addClass("fancybox-ie");}ap=aO('<div id="fancybox-outer"></div>').append('<div class="fancy-bg" id="fancy-bg-n"></div><div class="fancy-bg" id="fancy-bg-ne"></div><div class="fancy-bg" id="fancy-bg-e"></div><div class="fancy-bg" id="fancy-bg-se"></div><div class="fancy-bg" id="fancy-bg-s"></div><div class="fancy-bg" id="fancy-bg-sw"></div><div class="fancy-bg" id="fancy-bg-w"></div><div class="fancy-bg" id="fancy-bg-nw"></div>').appendTo(aL);ap.append(aJ=aO('<div id="fancybox-inner"></div>'),aw=aO('<a id="fancybox-close"></a>'),at=aO('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),ar=aO('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));aw.click(aO.fancybox.close);aA.click(aO.fancybox.cancel);at.click(function(b){b.preventDefault();aO.fancybox.prev();});ar.click(function(b){b.preventDefault();aO.fancybox.next();});if(ae){ay.get(0).style.setExpression("height","document.body.scrollHeight > document.body.offsetHeight ? document.body.scrollHeight : document.body.offsetHeight + 'px'");aA.get(0).style.setExpression("top","(-20 + (document.documentElement.clientHeight ? document.documentElement.clientHeight/2 : document.body.clientHeight/2 ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop )) + 'px'");ap.prepend('<iframe id="fancybox-hide-sel-frame" src="javascript:\'\';" scrolling="no" frameborder="0" ></iframe>');}}};aO.fn.fancybox=function(b){aO(this).data("fancybox",aO.extend({},b,aO.metadata?aO(this).metadata():{})).unbind("click.fb").bind("click.fb",function(c){c.preventDefault();if(!aK){aK=true;aO(this).blur();aC=[];aD=0;c=aO(this).attr("rel")||"";if(!c||c==""||c==="nofollow"){aC.push(this);}else{aC=aO("a[rel="+c+"], area[rel="+c+"]");aD=aC.index(this);}aq();return false;}});return this;};aO.fancybox=function(b,g){if(!aK){aK=true;g=typeof g!=="undefined"?g:{};aC=[];aD=g.index||0;if(aO.isArray(b)){for(var c=0,e=b.length;c<e;c++){if(typeof b[c]=="object"){aO(b[c]).data("fancybox",aO.extend({},g,b[c]));}else{b[c]=aO({}).data("fancybox",aO.extend({content:b[c]},g));}}aC=jQuery.merge(aC,b);}else{if(typeof b=="object"){aO(b).data("fancybox",aO.extend({},g,b));}else{b=aO({}).data("fancybox",aO.extend({content:b},g));}aC.push(b);}if(aD>aC.length||aD<0){aD=0;}aq();}};aO.fancybox.showActivity=function(){clearInterval(al);aA.show();al=setInterval(av,66);};aO.fancybox.hideActivity=function(){aA.hide();};aO.fancybox.next=function(){return aO.fancybox.pos(aE+1);};aO.fancybox.prev=function(){return aO.fancybox.pos(aE-1);};aO.fancybox.pos=function(b){if(!aK){b=parseInt(b,10);if(b>-1&&aI.length>b){aD=b;aq();}if(aN.cyclic&&aI.length>1&&b<0){aD=aI.length-1;aq();}if(aN.cyclic&&aI.length>1&&b>=aI.length){aD=0;aq();}}};aO.fancybox.cancel=function(){if(!aK){aK=true;aO.event.trigger("fancybox-cancel");aj();aM&&aO.isFunction(aM.onCancel)&&aM.onCancel(aC,aD,aM);aK=false;}};aO.fancybox.close=function(){function b(){ay.fadeOut("fast");aL.hide();aO.event.trigger("fancybox-cleanup");aJ.empty();aO.isFunction(aN.onClosed)&&aN.onClosed(aI,aE,aN);aI=aM=[];aE=aD=0;aN=aM={};aK=false;}if(!(aK||aL.is(":hidden"))){aK=true;if(aN&&aO.isFunction(aN.onCleanup)){if(aN.onCleanup(aI,aE,aN)===false){aK=false;return;}}aj();aO(aw.add(at).add(ar)).hide();aO("#fancybox-title").remove();aL.add(aJ).add(ay).unbind();aO(window).unbind("resize.fb scroll.fb");aO(document).unbind("keydown.fb");aJ.css("overflow","hidden");if(aN.transitionOut=="elastic"){aH=ac();var c=aL.position();aG={top:c.top,left:c.left,width:aL.width(),height:aL.height()};if(aN.opacity){aG.opacity=1;}ax.prop=1;aO(ax).animate({prop:0},{duration:aN.speedOut,easing:aN.easingOut,step:ag,complete:b});}else{aL.fadeOut(aN.transitionOut=="none"?0:aN.speedOut,b);}}};aO.fancybox.resize=function(){var b,c;if(!(aK||aL.is(":hidden"))){aK=true;b=aJ.wrapInner("<div style='overflow:auto'></div>").children();c=b.height();aL.css({height:c+aN.padding*2+az});aJ.css({height:c});b.replaceWith(b.children());aO.fancybox.center();}};aO.fancybox.center=function(){aK=true;var b=ai(),e=aN.margin,c={};c.top=b[3]+(b[1]-(aL.height()-az+40))*0.5;c.left=b[2]+(b[0]-(aL.width()+40))*0.5;c.top=Math.max(b[3]+e,c.top);c.left=Math.max(b[2]+e,c.left);aL.css(c);aK=false;};aO.fn.fancybox.defaults={padding:10,margin:20,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.3,overlayColor:"#666",titleShow:true,titlePosition:"outside",titleFormat:null,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,onStart:null,onCancel:null,onComplete:null,onCleanup:null,onClosed:null};aO(document).ready(function(){au();});})(jQuery);(function(jQuery){eval(function(p,a,c,k,e,r){e=function(c){return(c<a?"":e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36));};if(!"".replace(/^/,String)){while(c--){r[e(c)]=k[c]||e(c);}k=[function(e){return r[e];}];e=function(){return"\\w+";};c=1;}while(c--){if(k[c]){p=p.replace(new RegExp("\\b"+e(c)+"\\b","g"),k[c]);}}return p;}("h.i['1a']=h.i['z'];h.O(h.i,{y:'D',z:9(x,t,b,c,d){6 h.i[h.i.y](x,t,b,c,d)},17:9(x,t,b,c,d){6 c*(t/=d)*t+b},D:9(x,t,b,c,d){6-c*(t/=d)*(t-2)+b},13:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t+b;6-c/2*((--t)*(t-2)-1)+b},X:9(x,t,b,c,d){6 c*(t/=d)*t*t+b},U:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t+1)+b},R:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t+b;6 c/2*((t-=2)*t*t+2)+b},N:9(x,t,b,c,d){6 c*(t/=d)*t*t*t+b},M:9(x,t,b,c,d){6-c*((t=t/d-1)*t*t*t-1)+b},L:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t+b;6-c/2*((t-=2)*t*t*t-2)+b},K:9(x,t,b,c,d){6 c*(t/=d)*t*t*t*t+b},J:9(x,t,b,c,d){6 c*((t=t/d-1)*t*t*t*t+1)+b},I:9(x,t,b,c,d){e((t/=d/2)<1)6 c/2*t*t*t*t*t+b;6 c/2*((t-=2)*t*t*t*t+2)+b},G:9(x,t,b,c,d){6-c*8.C(t/d*(8.g/2))+c+b},15:9(x,t,b,c,d){6 c*8.n(t/d*(8.g/2))+b},12:9(x,t,b,c,d){6-c/2*(8.C(8.g*t/d)-1)+b},Z:9(x,t,b,c,d){6(t==0)?b:c*8.j(2,10*(t/d-1))+b},Y:9(x,t,b,c,d){6(t==d)?b+c:c*(-8.j(2,-10*t/d)+1)+b},W:9(x,t,b,c,d){e(t==0)6 b;e(t==d)6 b+c;e((t/=d/2)<1)6 c/2*8.j(2,10*(t-1))+b;6 c/2*(-8.j(2,-10*--t)+2)+b},V:9(x,t,b,c,d){6-c*(8.o(1-(t/=d)*t)-1)+b},S:9(x,t,b,c,d){6 c*8.o(1-(t=t/d-1)*t)+b},Q:9(x,t,b,c,d){e((t/=d/2)<1)6-c/2*(8.o(1-t*t)-1)+b;6 c/2*(8.o(1-(t-=2)*t)+1)+b},P:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6-(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b},H:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d)==1)6 b+c;e(!p)p=d*.3;e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);6 a*8.j(2,-10*t)*8.n((t*d-s)*(2*8.g)/p)+c+b},T:9(x,t,b,c,d){f s=1.l;f p=0;f a=c;e(t==0)6 b;e((t/=d/2)==2)6 b+c;e(!p)p=d*(.3*1.5);e(a<8.w(c)){a=c;f s=p/4}m f s=p/(2*8.g)*8.r(c/a);e(t<1)6-.5*(a*8.j(2,10*(t-=1))*8.n((t*d-s)*(2*8.g)/p))+b;6 a*8.j(2,-10*(t-=1))*8.n((t*d-s)*(2*8.g)/p)*.5+c+b},F:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*(t/=d)*t*((s+1)*t-s)+b},E:9(x,t,b,c,d,s){e(s==u)s=1.l;6 c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},16:9(x,t,b,c,d,s){e(s==u)s=1.l;e((t/=d/2)<1)6 c/2*(t*t*(((s*=(1.B))+1)*t-s))+b;6 c/2*((t-=2)*t*(((s*=(1.B))+1)*t+s)+2)+b},A:9(x,t,b,c,d){6 c-h.i.v(x,d-t,0,c,d)+b},v:9(x,t,b,c,d){e((t/=d)<(1/2.k)){6 c*(7.q*t*t)+b}m e(t<(2/2.k)){6 c*(7.q*(t-=(1.5/2.k))*t+.k)+b}m e(t<(2.5/2.k)){6 c*(7.q*(t-=(2.14/2.k))*t+.11)+b}m{6 c*(7.q*(t-=(2.18/2.k))*t+.19)+b}},1b:9(x,t,b,c,d){e(t<d/2)6 h.i.A(x,t*2,0,c,d)*.5+b;6 h.i.v(x,t*2-d,0,c,d)*.5+c*.5+b}});",62,74,"||||||return||Math|function|||||if|var|PI|jQuery|easing|pow|75|70158|else|sin|sqrt||5625|asin|||undefined|easeOutBounce|abs||def|swing|easeInBounce|525|cos|easeOutQuad|easeOutBack|easeInBack|easeInSine|easeOutElastic|easeInOutQuint|easeOutQuint|easeInQuint|easeInOutQuart|easeOutQuart|easeInQuart|extend|easeInElastic|easeInOutCirc|easeInOutCubic|easeOutCirc|easeInOutElastic|easeOutCubic|easeInCirc|easeInOutExpo|easeInCubic|easeOutExpo|easeInExpo||9375|easeInOutSine|easeInOutQuad|25|easeOutSine|easeInOutBack|easeInQuad|625|984375|jswing|easeInOutBounce".split("|"),0,{}));})(jQuery);
(function(a){if(typeof(a._$)!="undefined"){a.noConflict();}if(!window.Echo){window.Echo={};}if(!Echo.Global){Echo.Global={};}if(!Echo.Vars){Echo.Vars={regexps:{matchLabel:/{Label:([^:}]+[^}]*)}/g,matchData:/{Data:(([a-z]+\.)*[a-z]+)}/ig,mobileUA:/mobile|midp-|opera mini|iphone|ipad|blackberry|nokia|samsung|docomo|symbian|windows ce|windows phone|android|up\.browser|ipod|netfront|skyfire|palm|webos|audiovox/i,parseUrl:/^((([^:\/\?#]+):)?\/\/)?([^\/\?#]*)?([^\?#]*)(\?([^#]*))?(#(.*))?/,w3cdtf:/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z$/}};}a.extend({addCss:function(d,f){Echo.Vars.css=Echo.Vars.css||{index:1,processed:{}};if(f){if(Echo.Vars.css.processed[f]){return;}Echo.Vars.css.processed[f]=true;}var c="";var b=Echo.Vars.css.anchor;if(b&&b.length){c=b.html();}if(c.length+d.length>100000){Echo.Vars.css.index++;b=null;c="";}var e=a('<style id="echo-css-'+Echo.Vars.css.index+'" type="text/css">'+c+d+"</style>");if(b&&b.length){b.replaceWith(e);}else{if(Echo.Vars.css.anchor){Echo.Vars.css.anchor.after(e);}else{a(document.getElementsByTagName("head")[0]||document.documentElement).prepend(e);}}Echo.Vars.css.anchor=e;},foldl:function(c,b,d){a.each(b,function(e,f){result=d(f,c,e);if(result!==undefined){c=result;}});return c;},intersperse:function(b,c){return a.foldl([],b,function(e,f,d){if(f.length){f.push(c);}f.push(e);});},getNestedValue:function(b,f,g,h){if(typeof b=="string"){b=b.split(/\./);}if(!b.length){return f;}var e=true;var c=function(j,i){if(h){h(i,j);}if(typeof i[j]=="undefined"){e=false;}else{return i[j];}};var d=b.length==1?c(b.pop(),f):a.foldl(f,b,c);return e?d:g;},setNestedValue:function(g,b,e){var c=b.split(/\./);var f=c.pop();var d=a.getNestedValue(c,g,undefined,function(i,h){if(typeof i[h]=="undefined"){i[h]={};}});d[f]=e;},htmlize:function(b){if(!b){return"";}return a("<div>").text(b).html();},object2JSON:function(f){var d=function(g){var h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return g.replace(/[\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff\\]/g,function(i){return(h.hasOwnProperty(i))?h[i]:"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4);});};var c;switch(typeof f){case"number":c=isFinite(f)?f:"null";break;case"string":c='"'+d(f)+'"';break;case"boolean":c='"'+f.toString()+'"';break;default:if(f instanceof Array){var b=a.map(f,function(g){return a.object2JSON(g);});c="["+b.join(",")+"]";}else{if(f instanceof Object){var e=f.exportProperties||f;var b=a.foldl([],e,function(i,h,g){if(e instanceof Array){g=i;i=f[g];}h.push('"'+g+'":'+a.object2JSON(i));});c="{"+b.join(",")+"}";}else{c="null";}}}return c;},htmlTextTruncate:function(o,e,n,g){if(!e||o.length<e){return o;}var q=[],j=0,h=0;var m="br hr input img area param base link meta option".split(" ");var c=a.foldl({},m,function(s,r,i){r[s]=true;});for(var f=0;f<o.length;f++){var d=o.charAt(f);if(d=="<"){var l=o.indexOf(">",f);if(l<0){return o;}var b=o.substring(f+1,l);var p={name:"",closing:false};if(b.charAt(0)=="/"){p.closing=true;b=b.substring(1);}p.name=b.match(/(\w)+/)[0];if(p.closing){var k=q.pop();if(!k||k.name!=p.name){return o;}}else{if(!c[p.name]){q.push(p);}}f=l;}else{if(d=="&"&&o.substring(f).match(/^(\S)+;/)){f=o.indexOf(";",f);}else{if(j==e){h=f;break;}j++;}}}if(h||g){if(h){o=o.substring(0,h)+(n||"");}for(var f=q.length-1;f>=0;f--){o+="</"+q[f].name+">";}}return o;},mapClass2Object:function(c,b){b=b||{};c.find("*").andSelf().each(function(e,f){if(f.className){var d=f.className.split(/[ ]+/);a.each(d,function(g,h){b[h]=f;});}});return b;},stripTags:function(b){return a("<div>").html(b).text();},parseUrl:function(b){var c=b.match(Echo.Vars.regexps.parseUrl);return c?{scheme:c[3],domain:c[4],path:c[5],query:c[7],fragment:c[9]}:undefined;},toDOM:function(c,g,f){var d=a(c);var e=a.mapClass2Object(d);var h={set:function(i,j){e[g+i]=j;},get:function(i,k){var j=e[(k?"":g)+i];return j&&a(j);},remove:function(j){var i;if(typeof j=="string"){i=g+j;}else{i=j.echo.name;}a(e[i]).remove();delete e[i];},content:d};var b;if(typeof f=="object"){b=function(i,j,k){if(!f[i]){return;}return f[i](j,k);};}else{b=f;}a.each(e,function(m,j){var l=m.match(g+"(.*)");var i=l?l[1]:undefined;if(i&&b){j=a(j);j.echo=j.echo||{};j.echo.name=m;var k=b(i,j,h);if(typeof k!="undefined"){j.empty().append(k);}}});return h;},loadScriptContent:function(d,f){Echo.Vars.scriptState=Echo.Vars.scriptState||{};if(Echo.Vars.scriptState[d]=="loaded"){f();return;}var e=Echo.Broadcast.subscribe("internal.scriptLoaded",function(g,h){if(d!=h){return;}Echo.Broadcast.unsubscribe("internal.scriptLoaded",e);f();});if(Echo.Vars.scriptState[d]=="loading"){return;}Echo.Vars.scriptState[d]="loading";var c=document.createElement("script");c.type="text/javascript";c.charset="utf-8";c.src=d;var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(c,b.firstChild);c.onload=c.onreadystatechange=function(){var g=c.readyState;if(!g||g=="loaded"||g=="complete"){Echo.Vars.scriptState[d]="loaded";Echo.Broadcast.publish("internal.scriptLoaded",d);c.onload=c.onreadystatechange=null;}};},sendPostRequest:function(c,e,g){var f="echo-post-"+Math.random();var b=a("#echo-post-request").length?a("#echo-post-request").empty():a('<div id="echo-post-request"/>').css({height:0}).prependTo("body");a('<iframe id="'+f+'" name="'+f+'" width="0" height="0" frameborder="0" border="0"></iframe>').appendTo(b);var d=a("<form/>",{target:f,method:"POST",enctype:"application/x-www-form-urlencoded",acceptCharset:"UTF-8",action:c}).appendTo(b);a.each(e,function(h,i){a("<input/>",{type:"hidden",name:h,value:i}).appendTo(d);});d.submit();g();},getVisibleColor:function(c){var b;do{b=c.css("backgroundColor");if(b!=""&&b!="transparent"&&!/rgba\(0, 0, 0, 0\)/.test(b)||a.nodeName(c.get(0),"body")){break;}}while(c=c.parent());return b||"transparent";},timestampFromW3CDTF:function(b){var e=["year","month","day","hours","minutes","seconds"];var c={};var d=b.match(Echo.Vars.regexps.w3cdtf);a.each(e,function(f,g){c[g]=d[f+1];});return Date.UTC(c.year,c.month-1,c.day,c.hours,c.minutes,c.seconds)/1000;},isMobileDevice:function(){return Echo.Vars.regexps.mobileUA.test(navigator.userAgent);}});if(!Echo.Plugins){Echo.Plugins={};}Echo.isExtended=function(b,d,c){if(!b){return false;}c=c||true;var e=[b].concat(d).join(".");Echo.Vars.extensions=Echo.Vars.extensions||{};if(Echo.Vars.extensions[e]==c){return true;}Echo.Vars.extensions[e]=c;return false;};Echo.extendRenderer=function(b,f,d,c){if(!b||!Echo[b]||!f||!d||!a.isFunction(d)||Echo.isExtended(c,[b,"renderer",f])){return;}var e=Echo[b].prototype.renderers[f]||function(){};Echo[b].prototype.renderers[f]=function(){var h=c&&this.config.get("plugins."+c);if(!h||!h.enabled){return e.apply(this,arguments);}var g=this;if(!this.parentRenderer){this.parentRenderer=function(j,i){return g.parentRenderers[j].apply(g,i);};}this.parentRenderers=this.parentRenderers||{};this.parentRenderers[f]=e;return d.apply(this,arguments);};};Echo.extendTemplate=function(c,e,i,b,h){if(!c||!Echo[c]||!i||!b||!e||Echo.isExtended(h,[c,"template",b,i],e)){return;}var g=Echo[c].prototype.template;var f=a.isFunction(g)?g:function(){return g;};var d={insertBefore:"before",insertAfter:"after",insertAsFirstChild:"prepend",insertAsLastChild:"append",replace:"replaceWith"};Echo[c].prototype.template=function(){var j=h&&this.config.get("plugins."+h);if(!j||!j.enabled){return f.call(this);}var k=a("<div/>").html(f.call(this));a("."+b,k)[d[i]](e);return k.html();};};Echo.include=function(b,d){if(!b.length){return d();}var c=b.pop();Echo.include(b,function(){if(typeof c.loaded=="undefined"){if(c.application){c.loaded=function(){return !!Echo[c.application];};}else{d();}}if(a.isFunction(c.loaded)&&!c.loaded()){a.loadScriptContent(c.url,d);}else{d();}});};Echo.createPlugin=function(c){if(!c||!c.name||!c.init||!c.applications){return{};}var b=c.name;var e=function(){var f=function(g){return"plugins."+b+(g?"."+g:"");};f.get=function(g,h,i,j){return g.config.get(f(h),j?g.config.get(h,i):i);};f.set=function(g,h,i){g.config.set(f(h),i);};f.remove=function(g,h){g.config.remove(f(h));};return f;};var d=c.init||function(){};Echo.Plugins[b]=Echo.Plugins[b]||a.extend(c,{init:function(h,g){var f=h.config.get(g,"enabled");if(typeof f=="undefined"){h.config.set(g,"enabled",true);}d(h,g);},set:function(f,g,h){f.vars=f.vars||{};f.vars[b]=f.vars[b]||{};a.setNestedValue(f.vars[b],g,h);},get:function(f,g){var h=(f.vars||{})[b]||{};if(!g){return h;}return a.getNestedValue(g,h);},addCss:function(f){a.addCss(f,"plugins-"+b);},label:function(f,g){return Echo.Localization.label(f,"Plugins."+b,g);},addLabels:function(f){Echo.Localization.extend(f,"Plugins."+b);},topic:function(h,g){var f=typeof h=="string"?h:h.namespace;return f+".Plugins."+b+"."+g;},config:e(),subscribe:function(h,g,i){var f=this;return h.subscribe(g,function(){if(!h.isPluginEnabled(f.name)){return;}i.apply(this,arguments);});},publish:function(g,f,h){g.publish(f,h);},unsubscribe:function(g,f,h){g.unsubscribe(f,h);},extendRenderer:function(f,h,g){Echo.extendRenderer(f,h,g,b);},extendTemplate:function(g,h,i,f){Echo.extendTemplate(g,h,i,f,b);},addItemControl:function(g,h){var f=g.config.get("itemControls."+b,[]);g.config.set("itemControls."+b,f.concat(h));},assembleConfig:function(f,g){g.user=f.user;g.appkey=f.config.get("appkey","");g.plugins=this.config.get(f,"nestedPlugins",[]);g.contextId=f.config.get("contextId");g.apiBaseURL=f.config.get("apiBaseURL");return(new Echo.Config(g,this.config.get(f))).getAsHash();}});return Echo.Plugins[b];};if(!Echo.Broadcast){Echo.Broadcast={};}Echo.Broadcast.initContext=function(c,b){b=b||"empty";Echo.Vars.subscriptions=Echo.Vars.subscriptions||{};Echo.Vars.subscriptions[b]=Echo.Vars.subscriptions[b]||{};Echo.Vars.subscriptions[b][c]=Echo.Vars.subscriptions[b][c]||{};return b;};Echo.Broadcast.subscribe=function(c,d,b){var e=(new Date()).valueOf()+Math.random();b=Echo.Broadcast.initContext(c,b);Echo.Vars.subscriptions[b][c][e]=d;return e;};Echo.Broadcast.unsubscribe=function(c,d,b){b=Echo.Broadcast.initContext(c,b);if(c&&d){delete Echo.Vars.subscriptions[b][c][d];}else{if(c){delete Echo.Vars.subscriptions[b][c];}}};Echo.Broadcast.publish=function(c,d,b){b=Echo.Broadcast.initContext(c,b);if(b=="*"){a.each(Echo.Vars.subscriptions,function(e){a.each(Echo.Vars.subscriptions[e][c]||{},function(g,f){f.apply(this,[c,d]);});});}else{if(Echo.Vars.subscriptions[b][c]){a.each(Echo.Vars.subscriptions[b][c],function(f,e){e.apply(this,[c,d]);});}if(b!="empty"){Echo.Broadcast.publish(c,d,"empty");}}};if(!Echo.Object){Echo.Object=function(){};}Echo.Object.prototype.init=function(b){a.extend(this,b||{});};Echo.Object.prototype.template="";Echo.Object.prototype.namespace="";Echo.Object.prototype.cssPrefix="echo-";Echo.Object.prototype.substitute=function(c,d){var b=this;c=c.replace(Echo.Vars.regexps.matchLabel,function(f,e){return b.label(e);});c=c.replace(Echo.Vars.regexps.matchData,function(f,e){return a.getNestedValue(e,d,"");});return c;};Echo.Object.prototype.renderers={};Echo.Object.prototype.label=function(c,d){var b=Echo.Localization.label(c,this.namespace,d);return b!=c?b:Echo.Localization.label(c,"",d);};Echo.Object.prototype.render=function(d,e,g,b){var c=this;if(d){if(a.isFunction(this.renderers[d])){return this.renderers[d].call(this,e,g,b);}}else{var f=a.isFunction(this.template)?this.template():this.template;this.dom=a.toDOM(this.substitute(f,this.data||{}),this.cssPrefix,function(){return c.render.apply(c,arguments);});return this.dom.content;}};Echo.Object.prototype.rerender=function(b,d){var j=this;if(!b){if(this.dom){this.dom.content.replaceWith(this.render());}return;}if(!this.dom){return;}if(typeof b!="string"){a.map(b,function(k){j.rerender(k,d);});return;}else{if(!this.dom.get(b)){return;}}if(d){var i=a.isFunction(this.template)?this.template():this.template;var g=this.substitute(i,this.data||{});var e=this.dom.get(b);var h=a("."+this.cssPrefix+b,a(g));h=a.toDOM(h,this.cssPrefix,function(k,l,m){j.dom.set(k,l);return j.render.apply(j,arguments);}).content;e.replaceWith(h);}else{var f=this.dom.get(b);var c=this.renderers[b].call(this,f,this.dom);if(typeof c!="undefined"){f.empty().append(c);}}};Echo.Object.prototype.hyperlink=function(e,d){d=d||{};if(d.openInNewWindow&&!e.target){e.target="_blank";}var c=e.caption||"";delete e.caption;if(!d.skipEscaping){e.href=a.htmlize(e.href);}e.href=e.href||"javascript:void(0)";var b=a.foldl([],e,function(h,g,f){g.push(f+'="'+h+'"');});return"<a "+b.join(" ")+">"+c+"</a>";};Echo.Object.prototype.newContextId=function(){return(new Date()).valueOf()+Math.random();};Echo.Object.prototype.getContextId=function(){return this.config&&this.config.get("contextId");};Echo.Object.prototype.subscribe=function(b,c){return Echo.Broadcast.subscribe(b,c,this.getContextId());};Echo.Object.prototype.unsubscribe=function(b,c){Echo.Broadcast.unsubscribe(b,c,this.getContextId());};Echo.Object.prototype.publish=function(b,c){Echo.Broadcast.publish(b,c,this.getContextId());};Echo.Object.prototype.clearCache=function(){if(this.vars&&this.vars.cache){this.vars.cache={};}};Echo.Application=function(){this.addCss();};Echo.Application.prototype=new Echo.Object();Echo.Application.prototype.errorMessages={error_busy:"Loading. Please wait...",error_timeout:"Loading. Please wait...",error_waiting:"Loading. Please wait...",error_result_too_large:"(result_too_large) The search result is too large.",error_wrong_query:"(wrong_query) Incorrect or missing query parameter.",error_incorrect_appkey:"(incorrect_appkey) Incorrect or missing appkey.",error_internal_error:"(internal_error) Unknown server error.",error_quota_exceeded:"(quota_exceeded) Required more quota than is available.",error_incorrect_user_id:"(incorrect_user_id) Incorrect user specified in User ID predicate.",error_unknown:"(unknown) Unknown error."};Echo.Application.prototype.initApplication=function(d){var b=this;var c=this.config.get("appkey");if(!c){this.showMessage({type:"error",message:"Incorrect or missing mandatory parameter appkey"});return;}this.config.get("target").addClass("echo-ui");this.user=this.config.get("user")||new Echo.User({appkey:c,apiBaseURL:this.config.get("apiBaseURL"),contextId:this.config.get("contextId")});this.user.init(function(){b.initPlugins(d);});Echo.Localization.extend(this.errorMessages);};Echo.Application.prototype.messageTemplates={compact:'<span class="echo-application-message-icon echo-application-message-{Data:type}" title="{Data:message}"></span>',"default":'<div class="echo-application-message"><span class="echo-application-message-icon echo-application-message-{Data:type} echo-primaryFont">{Data:message}</span></div>'};Echo.Application.prototype.showMessage=function(c,d){if(!this.config.get("debug")&&c.type=="error"){return;}var b=this.messageTemplates[c.layout||this.messageLayout||"default"];(d||this.config.get("target")).empty().append(this.substitute(b,c));};Echo.Application.prototype.isWaitingForData=function(b){return b&&(b.errorCode=="waiting"||b.errorCode=="timeout"||b.errorCode=="busy");};Echo.Application.prototype.handleErrorResponse=function(g,d){var b=this;d=d||{};var h=this.config.get("target");var e=function(){if(b.waitingTimeoutStep>0){if(b.waitingTimeoutStep<4){b.waitingTimeoutStep++;}}else{b.waitingTimeoutStep=1;}return Math.round(Math.exp(b.waitingTimeoutStep))*1000;};if(this.error!=g){if(!this.config.get("debug")){h.hide();}else{var c=this.label("error_"+g.errorCode);var f=c=="error_"+g.errorCode?"("+g.errorCode+") "+(g.errorMessage||""):c;h.show();this.showMessage({type:this.isWaitingForData(g)?"loading":"error",message:f},d.messageTarget);}}this.error=g;if(this.isWaitingForData(g)){this.waitingTimer=setTimeout(function(){b.cleanupErrorHandlers();if(d.waitingHandler){d.waitingHandler();}else{b.refresh();}},e());}else{this.waitingTimeoutStep=0;}if(d.callback){d.callback(g);}};Echo.Application.prototype.cleanupErrorHandlers=function(b){if(b){this.waitingTimeoutStep=0;delete this.error;}if(this.waitingTimer){clearTimeout(this.waitingTimer);}};Echo.Application.prototype.initPlugins=function(e){var d=this;var c=this.config.get("pluginsOrder");var b=a.foldl([],c,function(f,h){var g=Echo.Plugins[f];if(g&&g.dependencies&&g.dependencies.length){return h.concat(g.dependencies);}});Echo.include(b,function(){a.map(c,function(f){var g=Echo.Plugins[f];if(g&&g.init&&d.isPluginApplicable(g)){g.init(g,d);}});if(e){e();}});};Echo.Application.prototype.enablePlugin=function(b){this.config.set("plugins."+b+".enabled",true);};Echo.Application.prototype.disablePlugin=function(b){this.config.set("plugins."+b+".enabled",false);};Echo.Application.prototype.isPluginEnabled=function(b){return this.config.get("plugins."+b+".enabled",true);};Echo.Application.prototype.isPluginApplicable=function(d){var c=this,b=false;a.each(d.applications,function(f,e){if(Echo[e]&&c instanceof Echo[e]){b=true;return false;}});return b;};Echo.Application.prototype.initConfig=function(d,e,c){var b={};b.target=function(f){return a(f);};b.plugins=function(g){var f=a.foldl({hash:{},order:[]},g||[],function(h,i){var j=a.inArray(h.name,i.order);if(j>=0){i.order.splice(j,1);}i.order.push(h.name);i.hash[h.name]=h;});this.set("pluginsOrder",f.order);return f.hash;};d=a.extend({plugins:[]},d||{});e=a.extend({appkey:"",apiBaseURL:"http://api.echoenabled.com",liveUpdates:true,liveUpdatesTimeout:10,liveUpdatesTimeoutMin:3,debug:true,contextId:this.newContextId()},e||{});this.config=new Echo.Config(d,e,function(f,h){var g=c&&c[f]||b&&b[f];return g?g.call(this,h):h;});};Echo.Application.prototype.sendAPIRequest=function(b,c){b.query.appkey=this.config.get("appkey");a.get(this.config.get("apiBaseURL")+"/v1/"+b.endpoint,b.query,c,"jsonp");};Echo.Application.prototype.initLiveUpdates=function(d,b){var c=this;this.liveUpdates={originalTimeout:this.config.get("liveUpdatesTimeout"),timers:{},timeouts:[],responseHandler:function(e){if(c.liveUpdates.timers.watchdog){clearTimeout(c.liveUpdates.timers.watchdog);}c.changeLiveUpdatesTimeout(e);b(e);},requestParamsGetter:d};};Echo.Application.prototype.changeLiveUpdatesTimeout=function(h){var d=this;if(typeof h=="string"){h={liveUpdatesTimeout:h};}h.liveUpdatesTimeout=parseInt(h.liveUpdatesTimeout);var c=function(j){if(!j&&d.liveUpdates.originalTimeout!=d.config.get("liveUpdatesTimeout")){d.config.set("liveUpdatesTimeout",d.liveUpdates.originalTimeout);}else{if(j&&j>d.config.get("liveUpdatesTimeout")){d.config.set("liveUpdatesTimeout",j);}}};var b=function(j){return !!(j.entries&&j.entries.length);};if(!this.nextSince){c(h.liveUpdatesTimeout);return;}var f=this.config.get("liveUpdatesTimeout");var i=parseInt(this.nextSince);var e=Math.floor((new Date()).getTime()/1000);var g=b(h)?e-i>f?this.config.get("liveUpdatesTimeoutMin",3):f+1:f+2;if(g>this.liveUpdates.originalTimeout){g=this.liveUpdates.originalTimeout;}this.config.set("liveUpdatesTimeout",g);if(g==this.liveUpdates.originalTimeout){c(h.liveUpdatesTimeout);}};Echo.Application.prototype.stopLiveUpdates=function(){if(this.liveUpdates.timers.regular){clearTimeout(this.liveUpdates.timers.regular);}if(this.liveUpdates.timers.watchdog){clearTimeout(this.liveUpdates.timers.watchdog);}};Echo.Application.prototype.startLiveUpdates=function(d){var b=this;if(!this.liveUpdates||!d&&!this.config.get("liveUpdates")&&!this.liveUpdates.timeouts.length){return;}this.stopLiveUpdates();if(d){this.liveUpdates.timeouts=[0,1,3];}var c=this.liveUpdates.timeouts.length?this.liveUpdates.timeouts.shift():this.config.get("liveUpdatesTimeout");this.liveUpdates.timers.regular=setTimeout(function(){b.liveUpdates.timers.watchdog=setTimeout(function(){b.startLiveUpdates();},5000);b.sendAPIRequest(b.liveUpdates.requestParamsGetter(),b.liveUpdates.responseHandler);},c*1000);};Echo.Application.prototype.addCss=function(){var c="echo-css-fancybox";if(a("#"+c).length){return;}var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(a("<link>",{rel:"stylesheet",id:c,type:"text/css",href:"//c0.echoenabled.com/css/fancybox.css"}).get(0),a(b).children().get(0));a.addCss(".echo-application-message { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }.echo-application-message-icon { display: inline-block; height: 16px; padding-left: 16px; background: no-repeat left center; }.echo-application-message .echo-application-message-icon { padding-left: 21px; height: auto; }.echo-application-message-empty { background-image: url(//c0.echoenabled.com/images/information.png); }.echo-application-message-loading { background-image: url(//c0.echoenabled.com/images/loading.gif); }.echo-application-message-error { background-image: url(//c0.echoenabled.com/images/warning.gif); }","application");};Echo.User=function(b){this.data={};this.config=new Echo.Config(b,{appkey:"",apiBaseURL:"http://api.echoenabled.com",contextId:undefined});};Echo.User.prototype.init=function(e){var b=this;this.callback=e||function(){};if(!this.config.get("appkey")||!window.Backplane||!Backplane.getChannelID()){this.set({});this.callback();return;}this.listenEvents();var d=this._global("get","state");if(d=="ready"){this.set(a.extend({},this._global("get","data")));this.callback();}else{var c=Echo.Broadcast.subscribe("User.onInit",function(f,g){if(g.appkey!=b.config.get("appkey")){return;}Echo.Broadcast.unsubscribe("User.onInit",c);b.set(a.extend({},b._global("get","data")));b.callback();});if(d=="init"){this.request();}}};Echo.User.prototype.listenEvents=function(){var b=this;if(this.backplaneSubscriptionID){return;}var c=function(f){var e=(f?"":"internal.")+"User.onInvalidate";var g={data:b.data,appkey:b.config.get("appkey")};var d=f?undefined:b.config.get("contextId");Echo.Broadcast.publish(e,g,d);};this.backplaneSubscriptionID=Backplane.subscribe(function(e){if(e.type=="identity/ack"){var d=false;if(b._global("get","state")=="ready"){d=true;b._global("set","state","init");}b.init(function(){c();if(d){c(true);}});}});};Echo.User.prototype._global=function(e,c,d){var b=this.config.get("appkey");Echo.Vars.users=Echo.Vars.users||{};Echo.Vars.users[b]=Echo.Vars.users[b]||{state:"init",data:{}};if(e=="get"){return Echo.Vars.users[b][c];}Echo.Vars.users[b][c]=d;};Echo.User.prototype.set=function(){if(!arguments.length){return;}if(arguments.length==1&&typeof arguments[0]=="object"){this._global("set","data",arguments[0]);this.data=this.normalize(arguments[0]);this.account=this.assemble();}else{if(arguments.length==2&&typeof arguments[0]=="string"){this.account[arguments[0]]=arguments[1];}}};Echo.User.prototype.get=function(b,c){return(this.account.hasOwnProperty(b)&&typeof this.account[b]!="undefined")?this.account[b]:c;};Echo.User.prototype.logout=function(c){var b=this;a.get(window.location.protocol+"//apps.echoenabled.com/v2/logout",{sessionID:Backplane.getChannelID()},function(d){Backplane.expectMessages("identity/ack");},"jsonp");};Echo.User.prototype.request=function(d){var b=this,c=this.config.get("appkey");this._global("set","state","waiting");a.get(this.config.get("apiBaseURL")+"/v1/users/whoami",{appkey:c,sessionID:Backplane.getChannelID()},function(e){if(e.result&&e.result=="session_not_found"){e={};}b._global("set","state","ready");b.set(a.extend({},e));Echo.Broadcast.publish("User.onInit",{data:e,appkey:c});if(d){d();}},"jsonp");};Echo.User.prototype.normalize=function(c){var b=function(d){return a.foldl({},d||[],function(e,f){f[e]=true;});};c=c||{};c.echo=c.echo||{};a.extend(c,c.echo);c.poco=c.poco||{entry:{}};c.roles=b(c.echo.roles);c.markers=b(c.echo.markers);c.sessionID=window.Backplane&&Backplane.getChannelID()||undefined;c.accounts=c.poco.entry.accounts||[];return c;};Echo.User.prototype.getActiveAccounts=function(){return a.map(this.data.accounts,function(b){if(b.loggedIn=="true"){return b;}});};Echo.User.prototype.assemble=function(){var b=this.getActiveAccounts();var c=b[0]||{};return a.extend(this.data,{id:c.identityUrl||this.data.poco.entry.id||c.userid,name:this.data.poco.entry.displayName||c.username,avatar:a.foldl(undefined,c.photos||[],function(d){if(d.type=="avatar"){return d.value;}}),state:this.data.echo.state||"Untouched",domain:c.domain,logged:!!b.length,defaultAvatar:"//c0.echoenabled.com/images/avatar-default.png",fakeIdentityURL:"http://js-kit.com/ECHO/user/fake_user"});};Echo.User.prototype.hasIdentity=function(c){var b=false;a.each(this.data.accounts,function(d,e){if(e.identityUrl&&e.identityUrl==c){b=true;return false;}});return b;};Echo.User.prototype.hasAny=function(e,c){if(!this.account){return false;}var b=this,d=false;a.each(c,function(f,h){var g=b.get(e,{});if((typeof g=="string"&&g==h)||g[h]){d=true;return false;}});return d;};Echo.User.prototype.hasAnyRole=function(b){return this.hasAny("roles",b);};Echo.User.prototype.isAdmin=function(){return this.hasAny("roles",["administrator","moderator"]);};Echo.User.prototype.logged=function(){return !!(this.account&&this.account.logged);};Echo.Config=function(e,c,d){var b=this;this.normalize=d||function(f,g){return g;};this.data={};this.cache={};if(!c&&!d){this.data=e;}else{a.each(this.combine(e,a.extend({},c)),function(f,g){b.set(f,g);});}};Echo.Config.prototype.get=function(c,d){var b=c;if(typeof b!="string"){b=b.join(".");}if(!this.cache.hasOwnProperty(b)){this.cache[b]=a.getNestedValue(c,this.data);}return typeof this.cache[b]=="undefined"?d:this.cache[b];};Echo.Config.prototype.set=function(b,d){var c=b.split(/\./);delete this.cache[b];if(typeof d=="object"){this.clearCacheByPrefix(b);}return a.setNestedValue(this.data,b,this.normalize(c.pop(),d));};Echo.Config.prototype.remove=function(b){var c=b.split(/\./);var e=c.pop();var d=a.getNestedValue(c,this.data);delete d[e];};Echo.Config.prototype.combine=function(d,c){var b=this;return a.foldl(c,d,function(g,f,e){f[e]=a.isPlainObject(g)&&c.hasOwnProperty(e)?b.combine(g,c[e]):g;});};Echo.Config.prototype.extend=function(b){var c=this;a.each(b,function(d,e){c.set(d,e);});};Echo.Config.prototype.getAsHash=function(){return this.data;};Echo.Config.prototype.clearCacheByPrefix=function(c){var b=this;c+=".";a.each(this.cache,function(d,e){if(!d.indexOf(c)){delete b.cache[d];}});};if(!Echo.UI){Echo.UI={cornersCss:function(b,c){return("{scope}.ui-corner-tl { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; }{scope}.ui-corner-tr { -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }{scope}.ui-corner-bl { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }{scope}.ui-corner-br { -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}-bottom-right-radius: {radius}; }{scope}.ui-corner-top { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }{scope}.ui-corner-bottom { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }{scope}.ui-corner-right {  -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }{scope}.ui-corner-left { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }{scope}.ui-corner-all { -moz-border-radius: {radius}; -webkit-border-radius: {radius}; border-radius: {radius}; }").replace(/{scope}/g,c||"").replace(/{radius}/g,b);}};}(function(){a.addCss('.echo-ui { text-align: left; }.echo-ui .ui-helper-hidden { display: none; }.echo-ui .ui-helper-hidden-accessible { position: absolute; left: -99999999px; }.echo-ui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }.echo-ui .ui-helper-clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }.echo-ui .ui-helper-clearfix { display: inline-block; }/* required comment for clearfix to work in Opera \\*/* html .echo-ui .ui-helper-clearfix { height:1%; }.echo-ui .ui-helper-clearfix { display:block; }/* end clearfix */.echo-ui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }.echo-ui .ui-resizable-handle { position: absolute;font-size: 0.1px;z-index: 99999; display: block;}.echo-ui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }.echo-ui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }.echo-ui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }.echo-ui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }.echo-ui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }.echo-ui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }.echo-ui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }.echo-ui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }.echo-ui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}.echo-ui .ui-state-disabled { cursor: default !important; }.echo-ui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; width: 16px; height: 16px; }.echo-ui .ui-widget-header { font-weight: bold; border: 0px; }.echo-ui, .echo-ui .ui-widget :active { outline: none; }.echo-ui .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }.echo-ui .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-ui .ui-state-default a:visited { color: #555555; text-decoration: none; }.echo-ui .ui-state-hover, .echo-ui .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }.echo-ui .ui-state-hover a, .echo-ui .ui-state-hover a:hover { color: #212121; text-decoration: none; }.echo-ui .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }.echo-ui .ui-state-active a, .echo-ui .ui-state-active a:link, .echo-ui .ui-state-active a:visited { color: #212121; text-decoration: none; }.echo-primaryBackgroundColor {  }.echo-secondaryBackgroundColor { background-color: #F4F4F4; }.echo-trinaryBackgroundColor { background-color: #ECEFF5; }.echo-primaryColor { color: #3A3A3A; }.echo-secondaryColor { color: #C6C6C6; }.echo-primaryFont { font-family: Arial, sans-serif; font-size: 12px; font-weight: normal; line-height: 16px; }.echo-secondaryFont { font-family: Arial, sans-serif; font-size: 11px; }.echo-linkColor, .echo-linkColor a { color: #476CB8; }.echo-clickable { cursor: pointer; }.echo-relative { position: relative; }.echo-clear { clear: both; }',"ui-general");})();Echo.UI.Dialog=function(b){b.config=b.config||{};this.init(b);this.config.dialogClass="echo-ui echo-dialog "+(this.config.dialogClass||"");this.addCss();this.contentElement=this.render().dialog(this.config).addClass("ui-corner-all");if(this.content){if(a.isFunction(this.content)){this.content(this.contentElement);}else{this.contentElement.append(this.content);}}this.widget=this.contentElement.dialog("widget");if(this.hasTabs){a(".ui-dialog-titlebar",this.widget).after(a(".echo-tabs-header",this.widget));}};Echo.UI.Dialog.prototype=new Echo.Object();Echo.UI.Dialog.prototype.cssPrefix="echo-dialog-";Echo.UI.Dialog.prototype.template="<div></div>";Echo.UI.Dialog.prototype.open=function(){this.contentElement.hide();this.contentElement.dialog("open");this.contentElement.show();};Echo.UI.Dialog.prototype.close=function(){this.contentElement.dialog("close");};Echo.UI.Dialog.prototype.addCss=function(){a.addCss(".echo-dialog { position: absolute; padding: 0px 7px 20px 7px; width: 300px; border: 1px solid #aaaaaa; background: #dfebf2; -moz-border-radius: 7px; -webkit-border-radius: 7px; border-radius: 7px;"+(!a.browser.msie?" overflow: hidden;":"")+" }.echo-dialog .ui-dialog-titlebar { background: #dfebf2; cursor: move; padding: 7px 0px 10px 5px; position: relative; color: #4a4a4a; font: 18px Helvetica,sans-serif; }.echo-dialog .ui-dialog-titlebar .ui-state-default, .echo-dialog .ui-dialog-titlebar .ui-state-active, .echo-dialog .ui-dialog-titlebar .ui-state-hover, .echo-dialog .ui-dialog-titlebar .ui-state-focus { border: 0px; background: none; }.echo-dialog .ui-dialog-title { float: left; margin: .1em 16px .2em 0; } .echo-dialog .ui-dialog-titlebar-close { position: absolute; right: 0px; top: 50%; width: 19px; margin: -10px 0 0 0; padding: 0px; height: 18px; }.echo-dialog .ui-dialog-titlebar-close span { display: block; margin: 1px; }.echo-dialog .ui-dialog-titlebar-close:hover, .ui-dialog .ui-dialog-titlebar-close:focus { padding: 0px; }.echo-dialog .ui-dialog-content { border: 0; padding: 0px; margin: 0px; background: #ffffff; overflow: auto; }.echo-dialog .ui-resizable-se { width: 14px; height: 14px; right: 3px; bottom: 3px; }.echo-dialog .ui-icon-closethick { background: no-repeat top right url(//c0.echoenabled.com/images/container/closeWindow.png); }.echo-dialog .ui-icon-grip-diagonal-se { background: no-repeat bottom right url(//c0.echoenabled.com/images/container/resizeHandle.png); }"+Echo.UI.cornersCss("7px",".echo-dialog "),"ui-dialog");if(a.browser.msie){a.addCss(".echo-dialog .ui-dialog-content { zoom: 1; position: relative; }","ui-dialog-ie");}};Echo.UI.Tabs=function(d){var c=this;d.config=d.config||{};this.init(d);if(!this.tabs){return;}var b=this.idPrefix;this.idPrefix=this.idPrefix+Math.ceil(Math.random()*999999999)+"-";this.addCss();var e=a.foldl([],this.tabs,function(g,h,f){g.classPrefix=b;g.idPrefix=c.idPrefix;if(g.icon){g.label="<span>"+g.label+"</span>";}if(g.disabled){h.push(f);}});this.target.append(this.render());this.tabIndexById={};a.each(this.tabs,function(f,g){c.tabIndexById[g.id]=f;if(g.content){var h=a("#"+g.idPrefix+g.id);if(a.isFunction(g.content)){g.content(h);}else{h.append(g.content);}}});if(this.addUIClass!==false){this.target.addClass("echo-ui");}a.extend(this.config,{disabled:e.concat(c.config.disabled||[]),select:function(f,g){c.content[g.index?"addClass":"removeClass"]("ui-corner-tl");}});this.headerElement=a(".echo-tabs-header",this.target).tabs(this.config);this.panelsElement=a(".echo-tabs-panels",this.target).tabs(this.config);a(".echo-tabs-header, .echo-tabs-header .ui-tabs-nav",this.target).removeClass("ui-corner-all");this.content=a(this.content||".echo-tabs-panels",this.target);this.content.removeClass("ui-corner-all").addClass("ui-corner-tr ui-corner-bottom");};Echo.UI.Tabs.prototype=new Echo.Object();Echo.UI.Tabs.prototype.cssPrefix="echo-tabs-";Echo.UI.Tabs.prototype.template=function(){var b=this;return'<div class="echo-tabs"><div class="echo-tabs echo-tabs-header"><ul>'+a.map(this.tabs,function(c){return b.substitute('<li><a class="echo-{Data:classPrefix}{Data:id}" href="#{Data:idPrefix}{Data:id}">{Data:label}</a></li>',c);}).join("\n")+'</ul></div><div class="echo-tabs echo-tabs-panels"></div></div>';};Echo.UI.Tabs.prototype.renderers={};Echo.UI.Tabs.prototype.renderers.panels=function(c){var b=this;a.each(this.tabs,function(d,e){var f=a.toDOM(b.substitute('<div id="{Data:idPrefix}{Data:id}" class="{Data:idPrefix}{Data:id}"></div>',e));c.append(f.content);});};Echo.UI.Tabs.prototype.select=function(b){this.headerElement.tabs("select",this.tabIndexById[b]);};Echo.UI.Tabs.prototype.addCss=function(){a.addCss(".echo-ui .ui-tabs { position: relative; padding: 0px; border: 0px; }.echo-tabs .echo-tabs-panels { background: #ffffff; }.echo-ui .ui-tabs .ui-tabs-nav { margin: 0; padding: 0px; }.echo-ui .ui-tabs .ui-tabs-nav li { list-style: none; float: left; position: relative; top: 1px; margin: 0 .2em 1px 0; border-bottom: 0 !important; padding: 0; white-space: nowrap; }.echo-ui .ui-tabs .ui-tabs-nav li a { float: left; padding: .3em .7em; text-decoration: none; font-size: 12px; font-family: Helvetica,sans-serif; }.echo-ui .ui-tabs .ui-tabs-nav li.ui-tabs-selected { margin-bottom: 0; padding-bottom: 1px; }.echo-ui .ui-tabs .ui-tabs-nav li.ui-tabs-selected a, .echo-ui .ui-tabs .ui-tabs-nav li.ui-state-disabled a, .echo-ui .ui-tabs .ui-tabs-nav li.ui-state-processing a { cursor: text; color: #4a4a4a; }.echo-ui .ui-tabs .ui-tabs-nav li a, .echo-ui .ui-tabs.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-selected a { cursor: pointer; color: #393939; }.echo-ui .ui-tabs .ui-tabs-panel { display: block; border-width: 0; padding: 1em 1.4em; background: none; }.echo-ui .ui-tabs .ui-tabs-hide { display: none !important; }.echo-ui .echo-tabs-header .ui-state-hover, .echo-ui .echo-tabs-header .ui-state-focus { border: 0px; background: none; color: #212121; }.echo-ui .echo-tabs-header .ui-state-default { border: 0px; background: none; font-weight: normal; }.echo-ui .echo-tabs-header .ui-state-active { border: 0px; background: #ffffff; font-weight: bold; }.echo-ui .ui-tabs .ui-tabs-nav li a span { display: inline-block; padding-left: 22px; }"+(a.browser.opera?".echo-ui .ui-tabs-nav { height: 25px; overflow: hidden; }":"")+Echo.UI.cornersCss("7px",".echo-tabs "),"ui-tabs");if(a.browser.msie){a.addCss(".echo-ui .ui-tabs { zoom:  1; position: static; }","ui-tabs-ie");}};if(!Echo.Localization){Echo.Localization={labels:{}};}Echo.Localization.key=function(b,c){return(c?c+".":"")+b;};Echo.Localization.extend=function(c,b){a.each(c,function(d,e){Echo.Localization.labels[Echo.Localization.key(d,b)]=e;});};Echo.Localization.label=function(c,d,e){var b=Echo.Localization.labels[Echo.Localization.key(c,d)]||c;a.each(e||{},function(f,g){b=b.replace(new RegExp("{"+f+"}","g"),g);});return b;};})(jQuery);(function(a){Echo.Localization.extend({defaultModeSwitchTitle:"Switch to metadata view",guest:"Guest",today:"Today",yesterday:"Yesterday",lastWeek:"Last Week",lastMonth:"Last Month",secondAgo:"Second Ago",secondsAgo:"Seconds Ago",minuteAgo:"Minute Ago",minutesAgo:"Minutes Ago",hourAgo:"Hour Ago",hoursAgo:"Hours Ago",dayAgo:"Day Ago",daysAgo:"Days Ago",weekAgo:"Week Ago",weeksAgo:"Weeks Ago",metadataModeSwitchTitle:"Return to default view",monthAgo:"Month Ago",monthsAgo:"Months Ago",sharedThisOn:"I shared this on {service}...",userID:"User ID:",textToggleTruncatedMore:"more",textToggleTruncatedLess:"less",fromLabel:"from",viaLabel:"via",loading:"Loading...",childrenMoreItems:"View more items"},"Item");Echo.Item=function(b){this.vars={};this.textExpanded=false;this.blocked=false;this.controlsOrder=[];this.controls={};this.init(b);};Echo.Item.prototype=new Echo.Object();Echo.Item.prototype.cssPrefix="echo-item-";Echo.Item.prototype.namespace="Item";Echo.Item.prototype.template=function(){var b=this.isChildrenPaginationEnabled()?this.config.get("children.sortOrder")=="chronological"?'<div class="echo-item-children"></div><div class="echo-item-expandChildren echo-item-container-child echo-trinaryBackgroundColor echo-clickable"><span class="echo-item-expandChildrenLabel echo-message-icon"></span></div><div class="echo-item-childrenByCurrentActorLive"></div>':'<div class="echo-item-expandChildren echo-item-container-child echo-trinaryBackgroundColor echo-clickable"><span class="echo-item-expandChildrenLabel echo-message-icon"></span></div><div class="echo-item-children"></div><div class="echo-item-childrenByCurrentActorLive"></div>':'<div class="echo-item-children"></div>';return'<div class="echo-item-content"><div class="echo-item-container"><div class="echo-item-avatar-wrapper"><div class="echo-item-avatar"></div></div><div class="echo-item-wrapper"><div class="echo-item-subwrapper"><div class="echo-item-subcontainer"><div class="echo-item-frame"><div class="echo-item-modeSwitch echo-clickable"></div><div class="echo-item-authorName echo-linkColor"></div><div class="echo-clear"></div><div class="echo-item-data"><div class="echo-item-re"></div><div class="echo-item-body echo-primaryColor"> <span class="echo-item-text"></span><span class="echo-item-textEllipses">...</span><span class="echo-item-textToggleTruncated echo-linkColor echo-clickable"></span></div><div class="echo-item-markers echo-secondaryFont echo-secondaryColor"></div><div class="echo-item-tags echo-secondaryFont echo-secondaryColor"></div></div><div class="echo-item-metadata"><div class="echo-item-metadata-userID"><span class="echo-item-metadata-title echo-item-metadata-icon echo-item-metadata-userID">{Label:userID}</span><span class="echo-item-metadata-value">{Data:actor.id}</span></div></div><div class="echo-item-footer echo-secondaryColor echo-secondaryFont"><img class="echo-item-sourceIcon echo-clickable"><div class="echo-item-date"></div><div class="echo-item-from"></div><div class="echo-item-via"></div><div class="echo-item-controls"></div><div class="echo-clear"></div></div></div></div><div class="echo-clear"></div></div></div><div class="echo-clear"></div><div class="echo-item-childrenMarker"></div></div>'+b+"</div>";};Echo.Item.prototype.renderers={};Echo.Item.prototype.renderers.authorName=function(b){return this.data.actor.title||this.label("guest");};Echo.Item.prototype.renderers.markers=function(b,c){this.render("extraField",b,c,{type:"markers"});};Echo.Item.prototype.renderers.tags=function(b,c){this.render("extraField",b,c,{type:"tags"});};Echo.Item.prototype.renderers.extraField=function(f,h,b){var e=this;var g=(b||{}).type;if(!this.data.object[g]||!this.user.isAdmin()){h.remove(f);return;}var c=this.config.get("limits."+g);var d=a.foldl([],this.data.object[g],function(k,l){var j=(k.length>c)?'<span title="{Data:item}">{Data:truncatedItem}</span>':"<span>{Data:item}</span>";var i=a.htmlTextTruncate(k,c,"...");l.push(e.substitute(j,{item:k,truncatedItem:i}));});f.prepend(d.sort().join(", "));};Echo.Item.prototype.renderers.container=function(d,f){var c=this;d.removeClass(a.map(["child","root","child-thread","root-thread"],function(g){return"echo-item-container-"+g;}).join(" "));var b=this.threading?"-thread":"";if(this.depth){d.addClass("echo-item-container-child"+b);d.addClass("echo-trinaryBackgroundColor");}else{d.addClass("echo-item-container-root"+b);}d.addClass("echo-item-depth-"+this.depth);var e=function(g){a.map(c.controlsOrder,function(h){if(!c.controls[h].element){return;}c.controls[h].clickableElements[g+"Class"]("echo-linkColor");});};if(!a.isMobileDevice()){d.unbind(["mouseleave","mouseenter"]).hover(function(){if(c.user.isAdmin()){f.get("modeSwitch").show();}e("add");},function(){if(c.user.isAdmin()){f.get("modeSwitch").hide();}e("remove");});}};Echo.Item.prototype.renderers.modeSwitch=function(d){var c=this;d.hide();if(!this.user.isAdmin()){return;}var e="default";var b=function(f){f.attr("title",c.label(e+"ModeSwitchTitle"));};b(d);d.click(function(){e=(e=="default"?"metadata":"default");b(d);c.dom.get("data").toggle();c.dom.get("metadata").toggle();});if(a.isMobileDevice()){d.show();}};Echo.Item.prototype.renderers.wrapper=function(b){b.addClass("echo-item-wrapper"+(this.depth?"-child":"-root"));};Echo.Item.prototype.renderers.avatar=function(){var b=this;var d=(!this.depth?48:24);var c=this.data.actor.avatar||this.user.get("defaultAvatar");return a("<img>",{src:c}).bind({error:function(){a(this).attr("src",b.user.get("defaultAvatar"));}}).css({width:d,height:d});};Echo.Item.prototype.renderers.childrenContainer=function(d,e,c){var b=this;a.each(d.children(),function(f,g){a(g).detach();});a.map(this.children,function(g){if(c&&c.filter&&!c.filter(g)){return;}var f=!g.dom;d.append(f?g.render():g.dom.content);if(g.deleted){b.publish("internal.Item.onDelete",{item:g,config:c});}else{if(g.added){b.publish("internal.Item.onAdd",{item:g});}else{if(f&&g instanceof Echo.Item){b.publish("internal.Item.onRender",{item:g});}}}});};Echo.Item.prototype.renderers.children=function(c,d,b){this.render("childrenContainer",c,d,{filter:function(e){return !e.byCurrentUser;},keepChildren:b&&b.keepChildren});};Echo.Item.prototype.renderers.childrenByCurrentActorLive=function(c,d,b){this.render("childrenContainer",c,d,{filter:function(e){return e.byCurrentUser;},keepChildren:b&&b.keepChildren});};Echo.Item.prototype.renderers.control=function(c,h,b){if(!b||!b.name){return;}var d=b.template||'<a class="echo-item-control echo-item-control-{Data:name}">{Data:label}</a>';var f={label:b.label||"",name:b.name};var g=a(this.substitute(d,f));var e=a(".echo-clickable",g);if(!e.length){e=g;g.addClass("echo-clickable");}e[b.onetime?"one":"bind"]({click:function(i){i.stopPropagation();if(b.callback){b.callback();}}});if(a.isMobileDevice()){e.addClass("echo-linkColor");}return g;};Echo.Item.prototype.renderers.controlsDelimiter=function(){return a('<span class="echo-item-control-delim"> \u00b7 </span>');};Echo.Item.prototype.renderers.controls=function(e){var d=this;this.assembleControls();this.sortControls();var b=e.empty();var c=this.render("controlsDelimiter");a.map(this.controlsOrder,function(f){var g=d.controls[f];if(!g||!g.visible()){return;}var h=g.dom||d.render("control",undefined,undefined,g);if(h){d.controls[f].element=h;d.controls[f].clickableElements=a(".echo-clickable",h);if(!d.controls[f].clickableElements.length){d.controls[f].clickableElements=h;}b.append(c.clone(true)).append(h);}});};Echo.Item.prototype.renderers.re=function(){if(!this.config.get("reTag")){return;}var m=this;var d=this.data.object.context;var k="";var j=this.data.object.permalink;var b=this.config.get("limits");var i=this.config.get("openLinksInNewWindow");var l=function(n){var o=a.parseUrl(n);return(o&&o.domain)?o.domain:n;};var e=function(o){var n=b.reTitle;if(!o.title){n=b.reLink;o.title=o.uri.replace(/^https?:\/\/(.*)/ig,"$1");}if(o.title.length>n){o.title=o.title.substring(0,n)+"...";}return"<div>"+m.hyperlink({"class":"echo-primaryColor",href:o.uri,caption:"Re: "+a.stripTags(o.title)},{openInNewWindow:i})+"</div>";};var g=document.location.href;var h=l(g);if(j==g||this.depth||!d||!d.length){return;}var c=false;a.each(d,function(n,o){if(o.uri==g){c=true;return false;}});if(c){return;}if(this.config.get("optimizedContext")){var f=d[0];a.each(d,function(n,o){if(l(o.uri)==h){f=o;return false;}});if(f){k=e(f);}}else{a.each(d,function(n,o){k+=e(o);});}return a(k);};Echo.Item.prototype.renderers.sourceIcon=function(b,c){if(!this.config.get("viaLabel.icon")||this.data.source.name=="jskit"||this.data.source.name=="echo"){c.remove(b);}b.hide().attr("src",a.htmlize(this.data.source.icon||this.config.get("providerIcon"))).show().one("error",function(){c.remove(b);}).wrap(this.hyperlink({href:this.data.source.uri||this.data.object.permalink},{openInNewWindow:this.config.get("openLinksInNewWindow")}));};Echo.Item.prototype.renderers.via=function(d,e){var b=this;var c=function(f){return(b.data[f].name||"").toLowerCase();};if(c("source")==c("provider")){return;}this.render("viaText",d,e,{label:"via",field:"provider"});};Echo.Item.prototype.renderers.from=function(b,c){this.render("viaText",b,c,{label:"from",field:"source"});};Echo.Item.prototype.renderers.viaText=function(d,f,b){b=b||{};var e=this.data[b.field];if(!this.config.get("viaLabel.text")||!e.name||e.name=="jskit"||e.name=="echo"){return;}var c=this.hyperlink({"class":"echo-secondaryColor",href:e.uri||this.data.object.permalink,caption:e.name},{openInNewWindow:this.config.get("openLinksInNewWindow")});d.html("&nbsp;"+this.label(b.label+"Label")+"&nbsp;").append(c);};Echo.Item.prototype.renderers.textToggleTruncated=function(c){var b=this;c.unbind("click").click(function(){b.textExpanded=!b.textExpanded;b.rerender(["body","textToggleTruncated"]);});return this.label("textToggleTruncated"+(this.textExpanded?"Less":"More"));};Echo.Item.prototype.renderers.body=function(d,v){var q=this;var j=function(B,A){v.get("text").empty().append(B);v.get("textEllipses")[!A||q.textExpanded?"hide":"show"]();v.get("textToggleTruncated")[A||q.textExpanded?"show":"hide"]();};var o=this.data.object.content.replace(/<!\[CDATA\[(.*?)\]\]>/g,"$1");var s=this.data.source.name;var t=this.config.get("openLinksInNewWindow");var m=this.config.get("contentTransformations."+this.data.object.content_type,{});if(s&&s=="Twitter"&&this.config.get("aggressiveSanitization")){j(this.label("sharedThisOn",{service:s}));return;}var h=this.config.get("limits");var k=function(A){var C=(A.length>h.tags)?'<span class="echo-item-tag" title="{Data:tag}">{Data:truncatedTag}</span>':'<span class="echo-item-tag">{Data:tag}</span>';var B=A.substring(0,h.tags)+"...";return(q.substitute(C,{tag:A,truncatedTag:B}));};if(m.hashtags){o=o.replace(/(#|\uff03)(<a[^>]*>[^<]*<\/a>)/ig,function(B,A,C){return k(C);});}var e=function(A){if(!m.hashtags){return A;}return A.replace(/(^|[^\w&\/])(?:#|\uff03)([^\s\.,;:'"#@\$%<>!\?\(\)\[\]]+)/ig,function(C,B,D){return B+k(D);});};var p=function(B){var A=[];B=B.replace(/((<a\s+[^>]*>)(.*?)(<\/a>))|<.*?>/ig,function(D,C,H,G,F){if(C){var E=p(G);E.text=e(E.text);D=H+r(E)+F;}A.push(D);return" %%HTML_TAG%% ";});return{text:B,tags:A};};var r=function(A){a.each(A.tags,function(C,B){A.text=A.text.replace(" %%HTML_TAG%% ",B);});return A.text;};var x="((?:http|ftp|https):\\/\\/(?:[a-z0-9#:\\/\\;\\?\\-\\.\\+,@&=%!\\*\\'(){}\\[\\]$_|^~`](?!gt;|lt;))+)";var w=function(A){return A.replace(/(<a\s+[^>]*>)(.*?)(<\/a>)/ig,function(C,B,E,D){if(new RegExp("^"+x+"$").test(E)){E=E.length>h.bodyLink?E.substring(0,h.bodyLink)+"...":E;}if(t&&!/\s+target=("[^<>"]*"|'[^<>']*'|\w+)/.test(B)){B=B.replace(/(^<a\s+[^>]*)(>$)/,'$1 target="_blank"$2');}return B+E+D;});};var u=p(o);if(s&&s!="jskit"&&s!="echo"){var g=this.depth?this.data.target.id:this.config.get("reTag")?this.data.object.permalink||this.data.target.id:undefined;if(g){u.text=u.text.replace(new RegExp(g,"g"),"");if(!/\S/.test(u.text)){j(this.label("sharedThisOn",{service:s}));return;}}}var b=u.text=e(u.text);if(m.urls){u.text=u.text.replace(new RegExp(x,"ig"),function(B,A){return q.hyperlink({href:A,caption:A},{skipEscaping:true,openInNewWindow:t});});}if(m.smileys){if(u.text!=b){u=p(r(u));}var i=this.initSmileysConfig();if(u.text.match(i.regexps.test)){a.each(i.codes,function(A,B){u.text=u.text.replace(i.regexps[B],i.tag(i.hash[B]));});}}if(m.newlines){u.text=u.text.replace(/\n\n+/g,"\n\n");u.text=u.text.replace(/\n/g,"&nbsp;<br>");}var l=w(r(u));var f=false;if((h.body||h.lines)&&!q.textExpanded){if(h.lines){var c=m.newlines?"<br>":"\n";var n=l.split(c);if(n.length>h.lines){l=n.splice(0,h.lines).join(c);f=true;}}var y=h.body&&l.length>h.body?h.body:f?l.length:undefined;var z=a.htmlTextTruncate(l,y,"",true);if(z.length!=l.length){f=true;}l=z;}j(l,f);};Echo.Item.prototype.renderers.date=function(c){var b=c||this.dom&&this.dom.get("date");this.calcAge();if(b){b.html(this.age);}};Echo.Item.prototype.renderers.expandChildrenLabel=function(d,e,b){if(!this.children.length||!this.hasMoreChildren()){return;}b=b||{};b.state=b.state||"regular";var c={loading:{css:"echo-item-message-loading",label:"loading"},regular:{css:"echo-linkColor echo-message-icon",label:"childrenMoreItems"}};d.removeClass(c[b.state=="loading"?"regular":"loading"].css).addClass(c[b.state].css).html(this.label(c[b.state].label));};Echo.Item.prototype.renderers.expandChildren=function(d,e,b){if(!this.children.length){return;}if(!this.hasMoreChildren()){if(a.browser.msie&&document.compatMode!="CSS1Compat"){d.animate({height:"1px",marginTop:"hide",marginBottom:"hide",paddingTop:"hide",paddingBottom:"hide"},{duration:this.config.get("children.moreButtonSlideTimeout"),complete:function(){d.hide();}});}else{d.slideUp(this.config.get("children.moreButtonSlideTimeout"));}return;}var c=this;b=b||{};d.css("display","block");d.addClass("echo-item-depth-"+(this.depth+1));d.unbind("click").one("click",function(){c.render("expandChildrenLabel",e.get("expandChildrenLabel"),e,{state:"loading"});c.publish("internal.Item.onChildrenExpand",{data:c.data});});};Echo.Item.prototype.isChildrenPaginationEnabled=function(){return !!this.config.get("children.itemsPerPage");};Echo.Item.prototype.hasMoreChildren=function(){return this.data.hasMoreChildren=="true";};Echo.Item.prototype.getNextPageAfter=function(){var c=a.grep(this.children,function(d){return !d.live;});var b=this.config.get("children.sortOrder")=="chronological"?c.length-1:0;return c.length?c[b].data.pageAfter:undefined;};Echo.Item.prototype.initSmileysConfig=function(){if(Echo.Vars.smileys){return Echo.Vars.smileys;}var b=function(e){return e.replace(/([\W])/g,"\\$1");};var c=Echo.Vars.smileys={codes:[],regexps:[]};c.hash={":)":{file:"smile.png",title:"Smile"},":-)":{file:"smile.png",title:"Smile"},";)":{file:"wink.png",title:"Wink"},";-)":{file:"wink.png",title:"Wink"},":(":{file:"unhappy.png",title:"Frown"},":-(":{file:"unhappy.png",title:"Frown"},"=-O":{file:"surprised.png",title:"Surprised"},":-D":{file:"grin.png",title:"Laughing"},":-P":{file:"tongue.png",title:"Tongue out"},"=)":{file:"happy.png",title:"Happy"},"B-)":{file:"evilgrin.png",title:"Evil grin"}};var d=[];a.each(c.hash,function(e){var f=b(e);d.push(f);c.codes.push(e);c.regexps[e]=new RegExp(f,"g");});c.regexps.test=new RegExp(d.join("|"));c.tag=function(e){return'<img class="echo-item-smiley-icon" src="//c0.echoenabled.com/images/smileys/emoticon_'+e.file+'" title="'+e.title+'" alt="'+e.title+'" />';};return c;};Echo.Item.prototype.assembleControls=function(){var c=this;var b=[];a.each(this.config.get("itemControls",{}),function(e,d){a.map(d,function(h){var g=a.isFunction(h)?h.call(c):a.extend({},h);if(!g.name){return;}var j=g.callback||function(){};g.callback=function(){j.call(c);c.publish("internal.Item.onControlClick",{name:g.name,plugin:e,item:{data:c.data,target:c.dom.content}});};g.label=g.label||g.name;g.plugin=e;if(typeof g.visible=="undefined"){g.visible=true;}var i=g.visible;g.visible=function(){return i&&c.config.get("plugins."+e+".enabled");};var f=e+"."+g.name;c.controls[f]=g;if(a.inArray(f,c.controlsOrder)<0){b.push(f);}});});c.controlsOrder=b.concat(c.controlsOrder);};Echo.Item.prototype.sortControls=function(){var c=this;var e=this.controlsOrder;var f=this.config.get("itemControlsOrder");if(!f){this.config.set("itemControlsOrder",e);}else{if(f!=e){var d=function(g,h,i){if(!c.controls[g]){return;}h.push(g);i=i||a.inArray(g,e);if(i>=0){delete e[i];}};var b=a.foldl([],f,function(g,i){if(/^(.*)\./.test(g)){d(g,i);}else{var h=new RegExp("^"+g+".");a.map(e,function(k,j){if(k&&k.match(h)){d(k,i,j);}});}});this.controlsOrder=b;this.config.set("itemControlsOrder",b);}else{if(!f.length){this.controlsOrder=[];}}}};Echo.Item.prototype.traverse=function(b,e,d){var c=this;a.each(b||[],function(f,g){d=c.traverse(g.children,e,e(g,d));});return d;};Echo.Item.prototype.refreshDate=function(){this.rerender("date");a.map(this.children||[],function(b){b.refreshDate();});};Echo.Item.prototype.calcAge=function(){if(!this.timestamp){return;}var e=this;var i=new Date(this.timestamp*1000);var f=(new Date()).getTime();var b;var h=Math.floor((f-i.getTime())/1000);var g=Math.floor(h/86400);var c=function(d,j){return d+" "+e.label(j+(d==1?"":"s")+"Ago");};if(isNaN(g)||g<0||g>=365){b=i.toLocaleDateString()+", "+i.toLocaleTimeString();}else{if(h<60){b=c(h,"second");}else{if(h<60*60){h=Math.floor(h/60);b=c(h,"minute");}else{if(h<60*60*24){h=Math.floor(h/(60*60));b=c(h,"hour");}else{if(h<60*60*48){b=this.label("yesterday");}else{if(g<7){b=c(g,"day");}else{if(g<14){b=this.label("lastWeek");}else{if(g<30){h=Math.floor(g/7);b=c(h,"week");}else{if(g<60){b=this.label("lastMonth");}else{if(g<365){h=Math.floor(g/31);b=c(h,"month");}}}}}}}}}}if(this.age!=b){this.age=b;}};Echo.Item.prototype.block=function(c){if(this.blocked){return;}this.blocked=true;var e=this.dom.get("container");var d=e.width();var b=e.outerHeight();this.blockers={backdrop:a('<div class="echo-item-blocker-backdrop"></div>').css({width:d,height:b}),message:a(this.substitute('<div class="echo-item-blocker-message">{Data:label}</div>',{label:c})).css({left:((parseInt(d)-200)/2)+"px",top:((parseInt(b)-20)/2)+"px"})};e.addClass("echo-relative").prepend(this.blockers.backdrop).prepend(this.blockers.message);};Echo.Item.prototype.unblock=function(){if(!this.blocked){return;}this.blocked=false;this.blockers.backdrop.remove();this.blockers.message.remove();this.dom.get("container").removeClass("echo-relative");};Echo.Item.prototype.getAccumulator=function(b){return this.data.object.accumulators[b];};Echo.Localization.extend({guest:"Guest",live:"Live",paused:"Paused",more:"More",loading:"Loading...",emptyStream:"No items at this time...","new":"new"},"Stream");Echo.Stream=function(c){if(!c||!c.target){return;}var b=this;this.vars={cache:{}};this.initConfig(c,{aggressiveSanitization:false,contentTransformations:{text:["smileys","hashtags","urls","newlines"],html:["smileys","hashtags","urls","newlines"],xhtml:["smileys","hashtags","urls"]},children:{additionalItemsPerPage:2,displaySortOrder:"chronological",sortOrder:"chronological",moreButtonSlideTimeout:600,itemsSlideTimeout:600},fadeTimeout:2800,flashColor:"#ffff99",itemControlsOrder:undefined,itemsPerPage:15,maxBodyLinkLength:50,maxBodyCharacters:undefined,maxBodyLines:undefined,maxReLinkLength:30,maxReTitleLength:143,maxTagLength:16,maxMarkerLength:16,openLinksInNewWindow:false,optimizedContext:true,providerIcon:"http://c0.echoenabled.com/images/favicons/comments.png",reTag:true,slideTimeout:700,sortOrder:"reverseChronological",streamStateLabel:{icon:true,text:true},submissionProxyURL:window.location.protocol+"//apps.echoenabled.com/v2/esp/activity",streamStateToggleBy:"mouseover",viaLabel:{icon:false,text:false}},this.assembleConfigNormalizer());this.initVars();this.initApplication(function(){b.addCss();b.config.get("target").empty().append(b.render());b.recalcEffectsTimeouts();b.initLiveUpdates(function(){return{endpoint:"search",query:{q:b.constructSearchQuery(),since:b.nextSince||0}};},function(d){b.handleLiveUpdatesResponse(d);});if(b.config.get("data")){b.handleInitialResponse(b.config.get("data"),function(d){b.lastRequest={initial:true,data:d};b.render("body");});}else{b.initialItemsRequest();}b.listenEvents();b.publish("Stream.onRender",b.prepareBroadcastParams());});};Echo.Stream.prototype=new Echo.Application();Echo.Stream.prototype.namespace="Stream";Echo.Stream.prototype.cssPrefix="echo-stream-";Echo.Stream.prototype.template='<div class="echo-stream-container echo-primaryFont echo-primaryBackgroundColor"><div class="echo-stream-header"><div class="echo-stream-state echo-secondaryColor"></div><div class="echo-clear"></div></div><div class="echo-stream-body"></div><div class="echo-stream-more"></div><div class="echo-stream-brand"><a class="echo-stream-brand-link" href="http://aboutecho.com" target="_blank"><div class="echo-stream-brand-message">social networking by</div></a></div></div>';Echo.Stream.prototype.renderers={};Echo.Stream.prototype.renderers.body=function(c){var b=this;c=c||this.dom.get("body");if(!this.lastRequest){this.showMessage({type:"loading",message:this.label(this.isWaitingForData(this.error)?"error_"+this.error.errorCode:"loading")},c);return;}if(this.lastRequest.data.length){if(this.lastRequest.initial){c.empty();}this.appendRootItems(this.lastRequest.data,c);}else{this.showMessage({type:"empty",message:this.label("emptyStream")},c);}if(this.lastRequest.initial&&this.config.get("streamStateToggleBy")=="mouseover"&&this.config.get("liveUpdates")){c.bind({mouseleave:function(){b.setStreamState("live");},mouseenter:function(){b.setStreamState("paused");}});}this.publish("Stream.onReady",this.prepareBroadcastParams({initial:this.lastRequest.initial}));};Echo.Stream.prototype.renderers.state=function(e){var b=this;var c=this.config.get("streamStateLabel");if((!c.icon&&!c.text)||!this.config.get("liveUpdates")){return;}var g=0;if(this.activities.state=="paused"){g=a.foldl(0,b.activities.queue,function(h,i){if(h.affectCounter){return ++i;}});}var f=this.activities.state+g;if(f==this.activities.lastState){return;}e=(e||this.dom.get("state")).empty();if(!this.activities.lastState&&this.config.get("streamStateToggleBy")=="button"){e.addClass("echo-linkColor echo-clickable").click(function(h){b.setStreamState(b.activities.state=="paused"?"live":"paused");});}var d={picture:'<span class="echo-stream-state-picture echo-stream-state-picture-'+this.activities.state+'"></span>',message:this.config.get("streamStateToggleBy")=="button"?'<a href="javascript:void(0)" class="echo-stream-state-message">{Label:'+this.activities.state+"}</a>":'<span class="echo-stream-state-message">{Label:'+this.activities.state+"}</span>",count:' <span class="echo-stream-state-count">({Data:count} {Label:new})</span>'};if(c.icon){e.append(d.picture);}if(c.text){e.append(this.substitute(d.message));if(g&&this.activities.state=="paused"){e.append(this.substitute(d.count,{count:g}));}}this.activities.lastState=f;};Echo.Stream.prototype.renderers.more=function(c,d){var b=this;if(this.isViewComplete||!this.threads.length){c.empty().hide();return;}c.empty().append(this.label("more")).bind({mouseenter:function(){c.addClass("echo-stream-more-hover");},mouseleave:function(){c.removeClass("echo-stream-more-hover");}}).show().unbind("click").one("click",function(){b.publish("Stream.onMoreButtonPress",b.prepareBroadcastParams());c.html(b.label("loading"));b.moreRequestItems(c);});};Echo.Stream.prototype.initVars=function(){this.activities={queue:[],state:this.config.get("liveUpdates")?"live":"paused",lastState:"",animations:0};this.hasInitialData=false;this.items={};this.threads=[];this.cleanupErrorHandlers();};Echo.Stream.prototype.actualizeChildrenList=function(d,b){var c=this;return a.map(b,function(f){f.targets=a.map(f.targets,function(g){g.conversationID=d.conversation;return g;});f=c.normalizeEntry(f);var e=c.items[f.unique];if(e&&e.byCurrentUser){c.applyStructureUpdates("delete",e);}return f;});};Echo.Stream.prototype.createChildrenItemsDomWrapper=function(c,d){var b=this;var f=a("<div class='echo-item-children-wrapper'></div>");var e=function(g){return b.getItemListIndex(g,d.children);};a.each(c,function(g,h){h.render();var j=g>0&&e(c[g-1])<e(h)?"append":"prepend";f[j](h.dom.content);});return f;};Echo.Stream.prototype.listenEvents=function(){var b=this;this.subscribe("internal.User.onInvalidate",function(){b.refresh();});this.subscribe("internal.Item.onAdd",function(c,d){d.item.dom.content.hide();b.queueActivity({action:"animation",actorID:d.item.data.actor.id,itemUnique:d.item.data.unique,handler:function(){delete d.item.added;b.addItemSpotUpdate(d.item);}});});this.subscribe("internal.Item.onDelete",function(c,d){b.queueActivity({action:"animation",itemUnique:d.item.data.unique,actorID:d.item.data.actor.id,handler:function(){delete d.item.deleted;b.deleteItemSpotUpdate(d.item,d.config);}});});this.subscribe("internal.Item.onRender",function(c,d){b.publish("Stream.Item.onRender",b.prepareBroadcastParams({item:{data:d.item.data,target:d.item.dom.content}}));});this.subscribe("internal.Item.onControlClick",function(c,d){var c=b.namespace+".Item.onControlClick";b.publish(c,b.prepareBroadcastParams(d));});this.subscribe("internal.Item.onChildrenExpand",function(d,c){b.childrenRequestItems(c.data.unique);});a.map(["Submit.onPostComplete","Submit.onEditComplete"],function(c){Echo.Broadcast.subscribe(c,function(){b.startLiveUpdates(true);});});};Echo.Stream.prototype.childrenRequestItems=function(d){var b=this;var c=this.items[d];this.sendAPIRequest({endpoint:"search",query:{q:this.constructChildrenSearchQuery(c)}},function(g){var f=c.dom.get("expandChildren");if(g.result=="error"){b.handleErrorResponse(g,{messageTarget:f,waitingHandler:function(){b.childrenRequestItems(d);}});if(!b.isWaitingForData(g)){f.removeClass("echo-clickable").delay(3000).slideUp(b.config.get("children.moreButtonSlideTimeout"));}return;}if(!g.hasMoreChildren||g.hasMoreChildren=="false"){c.data.hasMoreChildren=false;}c.data.nextPageAfter=g.nextPageAfter;g.entries=b.actualizeChildrenList(c,g.entries);b.publish("Stream.onDataReceive",b.prepareBroadcastParams({entries:g.entries,initial:false}));var e=[];a.each(g.entries,function(j,k){var h=b.initItem(k);b.applyStructureUpdates("add",h);if(k.parentUnique==c.data.unique){e.push(h);}});b.placeChildrenItems(c,e,g.entries);});};Echo.Stream.prototype.initialItemsRequest=function(){var b=this;this.requestItems({},function(c){b.lastRequest={initial:true,data:c};b.render("body");});};Echo.Stream.prototype.moreRequestItems=function(c){var b=this;c=c||this.dom.get("more");this.lastRequest={initial:false};this.requestItems({pageAfter:'"'+(b.nextPageAfter||"0")+'"'},function(d){if(d.length){b.lastRequest.data=d;b.render("body");}else{c.html(b.label("emptyStream")).delay(1000).fadeOut(1000);}});};Echo.Stream.prototype.setStreamState=function(b){this.activities.state=b;if(b=="live"){this.executeNextActivity();}this.rerender("state");};Echo.Stream.prototype.refresh=function(){this.stopLiveUpdates();this.initVars();delete this.lastRequest;this.clearCache();this.rerender();this.initialItemsRequest();this.publish("Stream.onRerender",this.prepareBroadcastParams());};Echo.Stream.prototype.extractPresentationConfig=function(b){return a.foldl({},["sortOrder","itemsPerPage","safeHTML"],function(c,d){if(typeof b[c]!="undefined"){d[c]=b[c];}});};Echo.Stream.prototype.extractTimeframeConfig=function(d){var c=function(j){var e=j.match(/^(<|>)(.*)$/);var k=e[1];var h=e[2].match(/^'([0-9]+) seconds ago'$/);var g=h?function(){return Math.floor((new Date()).getTime()/1000)-h[1];}:function(){return e[2];};var i;if(k=="<"){i=function(f){return f<g();};}else{if(k==">"){i=function(f){return f>g();};}}return i;};var b=a.foldl([],["before","after"],function(e,g){if(!d[e]){return;}var f=c(d[e]);if(f){g.push(f);}});return{timeframe:b};};Echo.Stream.prototype.assembleConfigNormalizer=function(){var b=this;var e=function(f){return f<0?0:f;};var d={contentTransformations:function(f){a.each(f,function(h,g){f[h]=a.foldl({},g||[],function(i,j){j[i]=true;});});return f;},safeHTML:function(f){return"off"!=f;},streamStateToggleBy:function(f){if(f=="mouseover"&&a.isMobileDevice()){return"button";}return f;},fadeTimeout:e,slideTimeout:e};var c={body:"maxBodyCharacters",lines:"maxBodyLines",reLink:"maxReLinkLength",reTitle:"maxReTitleLength",bodyLink:"maxBodyLinkLength",tags:"maxTagLength",markers:"maxMarkerLength"};a.each(c,function(g,f){d[f]=function(h){this.set("limits."+g,h);return h;};});return d;};Echo.Stream.prototype.getRespectiveAccumulator=function(d,c){var b={likesDescending:"likesCount",flagsDescending:"flagsCount",repliesDescending:"repliesCount"};return d.getAccumulator(b[c]);};Echo.Stream.prototype.appendRootItems=function(d,b){var c=this;var e=document.createDocumentFragment();a.each(d||[],function(f,g){e.appendChild(g.render().get(0));c.publish("Stream.Item.onRender",c.prepareBroadcastParams({item:{data:g.data,target:g.dom.content}}));});b.append(e);this.rerender("more");};Echo.Stream.prototype.prepareBroadcastParams=function(b){b=b||{};b.target=this.config.get("target").get(0);b.query=this.config.get("query");if(b.item&&b.item.target){b.item.target=b.item.target.get(0);}return b;};Echo.Stream.prototype.constructSearchQuery=function(b){var c=b&&b.pageAfter&&"pageAfter:"+b.pageAfter||"";return[this.config.get("query",""),c].join(" ");};Echo.Stream.prototype.constructChildrenSearchQuery=function(d){var f=this.config.get("children.maxDepth")-d.depth-1;var e=parseInt(this.config.get("children.additionalItemsPerPage"));var c=d.getNextPageAfter();var b=this.config.get("children.filter");var g=!b||b=="()"?"":b+" ";return g+a.foldl("",{childrenof:d.data.object.id,children:f,childrenItemsPerPage:f?parseInt(this.config.get("children.itemsPerPage")):0,itemsPerPage:e,sortOrder:this.config.get("children.sortOrder"),childrenSortOrder:this.config.get("children.sortOrder"),pageAfter:c?'"'+(c||0)+'"':undefined},function(j,i,h){return i+=(typeof j!="undefined"?h+":"+j+" ":"");})+g;};Echo.Stream.prototype.requestItems=function(b,d){var c=this;this.sendAPIRequest({endpoint:"search",query:{q:this.constructSearchQuery(b)}},function(e){c.handleInitialResponse(e,d);});};Echo.Stream.prototype.handleInitialResponse=function(h,f){var d=this,c=[],b=[];var g=this.lastRequest&&!this.lastRequest.initial;h=h||{};if(h.result=="error"){this.handleErrorResponse(h,{messageTarget:g?d.dom.get("more"):d.dom.get("body"),waitingHandler:function(){if(g){d.moreRequestItems();}else{d.refresh();}}});return;}this.cleanupErrorHandlers(true);this.config.get("target").show();this.changeLiveUpdatesTimeout(h);this.nextSince=h.nextSince||0;this.nextPageAfter=h.nextPageAfter;this.config.extend(this.extractPresentationConfig(h));h.children.itemsPerPage=+h.children.itemsPerPage;this.config.combine(h.children,this.config.get("children"));this.config.extend(this.extractTimeframeConfig(h));var e=this.config.get("sortOrder");h.entries=h.entries||[];this.publish("Stream.onDataReceive",d.prepareBroadcastParams({entries:h.entries,initial:!this.hasInitialData}));a.each(h.entries,function(j,l){l=d.normalizeEntry(l);var k=d.initItem(l);d.applyStructureUpdates("add",k);if(d.isRootItem(k)){d.addItemToList(b,k,e);}});this.hasInitialData=true;this.isViewComplete=b.length!=this.config.get("itemsPerPage");f(b);this.startLiveUpdates();};Echo.Stream.prototype.checkTimeframeSatisfy=function(){var c=this;var b=this.config.get("timeframe");var d=a.foldl([],this.threads,function(e,g){var f=a.foldl(true,b,function(i,h){return h?i(e.timestamp):false;});if(!f){g.push(e);}});a.map(d,function(e){c.applySpotUpdates("delete",e);});};Echo.Stream.prototype.handleLiveUpdatesResponse=function(c){var b=this;c=c||{};if(c.result=="error"){this.startLiveUpdates();return;}this.nextSince=c.nextSince||0;this.refreshItemsDate();this.checkTimeframeSatisfy();this.applyLiveUpdates(c.entries);this.render("state");this.executeNextActivity();this.startLiveUpdates();};Echo.Stream.prototype.applyLiveUpdates=function(b){var c=this;a.each(b||[],function(d,g){g=c.normalizeEntry(g);var f=c.items[g.unique];var h=c.classifyAction(g);if(!f&&h!="post"){return;}switch(h){case"post":if(f){c.applySpotUpdates("replace",c.updateItem(g));}else{f=c.initItem(g,true);var e=c.isRootItem(f)?c.withinVisibleFrame(f):c.withinVisibleChildrenFrame(f);if(!e&&!c.isRootItem(f)&&c.user.hasIdentity(f.data.actor.id)){f.byCurrentUser=true;}if(e||f.byCurrentUser){c.publish("Stream.Item.onReceive",c.prepareBroadcastParams({item:{data:f.data}}));c.applySpotUpdates("add",f);}else{delete c.items[g.unique];}}break;case"delete":c.applySpotUpdates("delete",f);break;}});this.recalcEffectsTimeouts();};Echo.Stream.prototype.recalcEffectsTimeouts=function(){var d=this;var f={fade:d.config.get("fadeTimeout"),slide:d.config.get("slideTimeout")};d.timeouts=d.timeouts||{fade:f.fade,slide:f.slide};if(f.fade==0&&f.slide==0){return;}d.timeouts.coeff=d.timeouts.coeff||{fade:d.timeouts.fade/(f.fade+f.slide),slide:d.timeouts.slide/(f.fade+f.slide)};var b=function(h,g){g=Math.round(g*d.timeouts.coeff[h]);if(g<100){return 0;}if(g>f[h]){return f[h];}return g;};var e=d.config.get("liveUpdatesTimeout")*1000*0.8;var c=d.activities.queue.length?e/d.activities.queue.length:e;d.timeouts.fade=b("fade",c);d.timeouts.slide=b("slide",c);};Echo.Stream.prototype.refreshItemsDate=function(){a.map(this.threads,function(b){b.refreshDate();});};Echo.Stream.prototype.executeNextActivity=function(){var b=this.activities;if(b.animations>0||!b.queue.length||this.config.get("liveUpdates")&&b.state=="paused"&&b.queue[0].action!="replace"&&!b.queue[0].byCurrentUser){return;}b.queue.shift().handler();};Echo.Stream.prototype.applySpotUpdates=function(f,e,c){var b=this;c=c||{};var d=function(i){switch(i){case"add":b.applyStructureUpdates(i,e);e.added=true;if(b.isRootItem(e)){b.placeRootItem(e);}else{var m=b.getParentItem(e);if(m&&m.dom){m.rerender(["container","children","childrenByCurrentActorLive"]);}}b.executeNextActivity();break;case"replace":e.unblock();if(b.maybeMoveItem(e)){var m=b.getParentItem(e);var k=b.config.get(m?"children.sortOrder":"sortOrder");var h=m?m.children:b.threads;var j=b.getItemListIndex(e,h);var g=a.extend([],h);g.splice(j,1);var l=b.getItemProjectedIndex(e,g,k);if(j!=l){b.applySpotUpdates("delete",e,{keepChildren:true});b.applySpotUpdates("add",e);}}if(e&&e.dom){e.rerender("container",true);}b.executeNextActivity();break;case"delete":e.deleted=true;if(b.isRootItem(e)){b.publish("internal.Item.onDelete",{item:e,config:c});b.applyStructureUpdates(i,e,c);}else{var m=b.getParentItem(e);if(m){m.render("children",m.dom.get("children"),m.dom,c);if(b.isChildrenPaginationEnabled()){m.render("childrenByCurrentActorLive",m.dom.get("childrenByCurrentActorLive"),m.dom,c);}b.applyStructureUpdates(i,e,c);m.rerender("container");}}b.executeNextActivity();break;}};this.queueActivity({action:f,itemUnique:e.data.unique,actorID:e.data.actor.id,handler:function(){d(f);}});};Echo.Stream.prototype.queueActivity=function(f){var c=this.items[f.itemUnique];if(!c){return;}var b=c.blocked||f.actorID&&this.user.hasIdentity(f.actorID);var e=this.getActivityDependency(a.extend(f,{byCurrentUser:b}));var d={action:f.action,type:f.type||"",affectCounter:f.action=="add",itemUnique:f.itemUnique,byCurrentUser:b,handler:function(){f.handler();}};if(e.dependent||typeof e.index=="undefined"){this.activities.queue.push(d);}else{this.activities.queue.splice(e.index,0,d);}};Echo.Stream.prototype.getActivityDependency=function(d){var b;var c=d.action!="replace"&&d.action!="animation";a.each(this.activities.queue,function(e,f){if(c){if(typeof b=="undefined"&&d.byCurrentUser&&!f.byCurrentUser){c=false;b=e;return false;}}else{if(typeof b=="undefined"&&(d.action=="replace"&&f.action!="replace"||d.action=="animation"&&f.action!="animation"||d.byCurrentUser&&!f.byCurrentUser)){b=e;}if(d.action=="replace"&&f.action=="add"&&f.itemUnique==d.itemUnique){c=true;return false;}}});return{dependent:c,index:b};};Echo.Stream.prototype.addItemSpotUpdate=function(f){var d=this;this.activities.animations++;if(this.timeouts.slide){var g=f.dom.content.show().css("height");f.dom.content.css("height",g).hide().animate({height:"show",marginTop:"show",marginBottom:"show",paddingTop:"show",paddingBottom:"show"},this.timeouts.slide,function(){if(!f.dom||!f.dom.content){return;}f.dom.content.css("height","");});}else{f.dom.content.show();}var e=function(){if(!f.dom||!f.dom.content){return;}d.publish("Stream.Item.onRender",d.prepareBroadcastParams({item:{data:f.data,target:f.dom.content}}));};if(this.timeouts.fade){var b=f.dom.get("container");var c=a.getVisibleColor(b);b.delay(this.timeouts.slide).css({backgroundColor:this.config.get("flashColor")}).animate({backgroundColor:c},this.timeouts.fade,"linear",function(){b.css("backgroundColor","");e();d.activities.animations--;d.executeNextActivity();});}else{e();this.activities.animations--;this.executeNextActivity();}};Echo.Stream.prototype.deleteItemSpotUpdate=function(d,c){var b=this;this.activities.animations++;c=c||{};var e=a.isFunction(c)?c:c.callback||function(){if(!d.dom||!d.dom.content){return;}c.keepChildren?d.dom.content.detach():d.dom.remove("content");delete d.dom;d.vars={};var f=a.foldl(0,b.items,function(g,h){return h+1;});if(!f){b.showMessage({type:"empty",message:b.label("emptyStream")},b.dom.get("body"));}b.activities.animations--;b.executeNextActivity();};if(this.timeouts.slide){d.dom.content.slideUp(this.timeouts.slide,e);}else{e();}};Echo.Stream.prototype.classifyAction=function(b){return(b.verbs[0]=="http://activitystrea.ms/schema/1.0/delete")?"delete":"post";};Echo.Stream.prototype.isRootItem=function(b){return !this.config.get("children.maxDepth")||b.id==b.conversation;};Echo.Stream.prototype.hasParentItem=function(b){return !!this.getParentItem(b);};Echo.Stream.prototype.maybeMoveItem=function(b){return b.forceInject;};Echo.Stream.prototype.withinVisibleFrame=function(f,c,b,d){c=c||this.threads;b=typeof b=="undefined"?this.isViewComplete:b;d=d||this.config.get("sortOrder");var e=c.length?c[c.length-1]:undefined;if(b||e==undefined){return true;}return this.compareItems(e,f,d);};Echo.Stream.prototype.withinVisibleChildrenFrame=function(c){var b=this.getParentItem(c);if(!this.isChildrenPaginationEnabled()||!b){return this.hasParentItem(c);}return this.withinVisibleFrame(c,b.children,!b.hasMoreChildren(),this.config.get("children.sortOrder"));};Echo.Stream.prototype.getParentItem=function(b){return this.isRootItem(b)?undefined:this.items[b.data.parentUnique];};Echo.Stream.prototype.compareItems=function(e,c,g){var f=this;switch(g){case"chronological":return e.timestamp>c.timestamp;case"reverseChronological":return e.timestamp<=c.timestamp;case"likesDescending":case"repliesDescending":case"flagsDescending":var d=function(b){return f.getRespectiveAccumulator(b,g);};return(d(e)<d(c)||(d(e)==d(c)&&this.compareItems(e,c,"reverseChronological")));}};Echo.Stream.prototype.placeRootItem=function(e){var d=e.render();if(this.threads.length>1){var f=this.getItemListIndex(e,this.threads);var b=this.threads[f+1],c=this.threads[f-1];if(b){b.dom.content.before(d);}else{c.dom.content.after(d);}}else{this.dom.get("body").empty().append(d);}this.publish("internal.Item.onAdd",{item:e});};Echo.Stream.prototype.placeChildrenItems=function(g,e,c){var d=this;var b=this.createChildrenItemsDomWrapper(e,g);var i=-1;a.each(g.children,function(k,j){if(d.isItemInList(j.data,c)){i=k-1;return false;}});var f=i>=0?g.children[i].dom.content:g.dom.get("children");var h=i>=0?"insertAfter":this.config.get("children.sortOrder")!="chronological"?"prependTo":"appendTo";b[h](a(f));g.rerender("childrenByCurrentActorLive");b.css("height",b.show().css("height")).hide().animate({height:"show",marginTop:"show",marginBottom:"show",paddingTop:"show",paddingBottom:"show"},{duration:this.config.get("children.itemsSlideTimeout"),complete:function(){b.css("height","");g.rerender(["expandChildren","expandChildrenLabel"]);b.children().unwrap();}});};Echo.Stream.prototype.getItemListIndex=function(d,c){var b=-1;a.each(c||[],function(e,f){if(f==d||(f.unique&&d.unique&&f.unique==d.unique)){b=e;return false;}});return b;};Echo.Stream.prototype.isItemInList=function(c,b){return this.getItemListIndex(c,b)>=0;};Echo.Stream.prototype.isChildrenPaginationEnabled=function(){return !!this.config.get("children.itemsPerPage");};Echo.Stream.prototype.initItem=function(e,f){var b=this;var d=new Echo.Item({children:[],config:new Echo.Config(this.config.getAsHash()),conversation:e.target.conversationID,data:e,depth:0,id:e.object.id,live:f,threading:false,timestamp:a.timestampFromW3CDTF(e.object.published),user:this.user});var c=d.template;d.template=function(){if(!b.vars.cache.itemTemplate){b.vars.cache.itemTemplate=a.isFunction(c)?c.apply(this,arguments):c;}return b.vars.cache.itemTemplate;};this.items[d.data.unique]=d;return d;};Echo.Stream.prototype.updateItem=function(e){var d=this.items[e.unique];var b=this.config.get(this.isRootItem(d)?"sortOrder":"children.sortOrder");var c=b.match(/replies|likes|flags/);var f=c&&this.getRespectiveAccumulator(d,b);if(d.data.object.published!=e.object.published){d.timestamp=a.timestampFromW3CDTF(e.object.published);d.forceInject=true;}a.extend(d.data,e);if(c){if(this.getRespectiveAccumulator(d,b)!=f){d.forceInject=true;}}return d;};Echo.Stream.prototype.getItemProjectedIndex=function(f,c,e){var b=this;var d;if(f.live||f.forceInject){a.each(c||[],function(g,h){if(b.compareItems(h,f,e)){d=g;return false;}});}return typeof d!="undefined"?d:c.length;};Echo.Stream.prototype.addItemToList=function(b,d,c){b.splice(this.getItemProjectedIndex(d,b,c),0,d);delete d.forceInject;this.items[d.data.unique]=d;};Echo.Stream.prototype.applyStructureUpdates=function(g,f,d){var c=this;d=d||{};switch(g){case"add":if(!this.isRootItem(f)){var e=this.getParentItem(f);if(!e){delete this.items[f.data.unique];return;}f.depth=e.depth+1;if(!this.isChildrenPaginationEnabled()&&f.depth>1){f.depth=1;f.data.parentUnique=e.data.parentUnique;f.data.target.id=e.data.target.id;f.forceInject=true;this.applyStructureUpdates("add",f);return;}e.threading=true;f.forceInject=true;this.addItemToList(e.children,f,this.isChildrenPaginationEnabled()?this.config.get("children.displaySortOrder"):this.config.get("children.sortOrder"));}else{this.addItemToList(this.threads,f,this.config.get("sortOrder"));}break;case"delete":var b=null;if(this.isRootItem(f)){b=this.threads;}else{b=this.items[f.data.parentUnique].children;if(b.length==1){var e=this.getParentItem(f);if(e){e.threading=false;}}}b.splice(this.getItemListIndex(f,b),1);if(!d.keepChildren){f.traverse(f.children,function(h){delete c.items[h.data.unique];});delete f.children;}delete this.items[f.data.unique];break;}};Echo.Stream.prototype.normalizeEntry=function(c){if(c.normalized){return c;}var b=this;c.normalized=true;a.each(c.targets||[],function(d,e){if((e.id==e.conversationID)||(e.id==c.object.id)||(b.items[e.id+e.conversationID])){c.target=e;}});c.object.content_type=c.object.content_type||"text";c.object.accumulators=c.object.accumulators||{};c.object.accumulators.repliesCount=parseInt(c.object.accumulators.repliesCount||"0");c.object.accumulators.flagsCount=parseInt(c.object.accumulators.flagsCount||"0");c.object.accumulators.likesCount=parseInt(c.object.accumulators.likesCount||"0");c.object.context=c.object.context||[];c.object.flags=c.object.flags||[];c.object.likes=c.object.likes||[];c.target=c.target||c.targets[0]||{};c.target.conversationID=c.target.conversationID||c.object.id;c.source=c.source||{};c.provider=c.provider||{};c.unique=c.object.id+c.target.conversationID;c.parentUnique=c.target.id+c.target.conversationID;return c;};Echo.Stream.prototype.addCss=function(){var c=this;a.addCss('.echo-stream-message-wrapper { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }.echo-stream-message-empty, .echo-stream-message-loading, .echo-stream-message-error { display: inline-block; height: 16px; padding-left: 21px; background: no-repeat left center; }.echo-stream-message-empty { background-image: url(//c0.echoenabled.com/images/information.png); }.echo-stream-message-loading { background-image: url(//c0.echoenabled.com/images/loading.gif); }.echo-stream-message-error { background-image: url(//c0.echoenabled.com/images/warning.gif); }.echo-stream-header { margin: 10px 0px 10px 20px; }.echo-stream-state { float: right; }.echo-stream-state-picture { display: inline-block; height: 9px; width: 8px; }.echo-stream-state-picture-paused { background: url("//c0.echoenabled.com/images/control_pause.png") no-repeat center center; }.echo-stream-state-picture-live { background: url("//c0.echoenabled.com/images/control_play.png") no-repeat center center; }.echo-stream-state-message { margin-left: 5px; text-decoration: none; }.echo-clickable a.echo-stream-state-message:hover { text-decoration: underline; }.echo-stream-brand { text-align: right; display: none; }.echo-stream-brand-message { display: inline-block; height: 17px; line-height: 17px; border: none; padding-right: 48px; background: url(//c0.echoenabled.com/images/echo-brand.png) no-repeat right; font-size: 10px; font-family: Arial; }.echo-stream-container a.echo-stream-brand-link { text-decoration: none; color: #666666; } .echo-stream-more-hover { background-color: #E4E4E4; }.echo-stream-more { text-align: center; border: solid 1px #E4E4E4; margin-top: 10px; padding: 10px; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; cursor: pointer; font-weight: bold; }.echo-stream-more .echo-application-message { padding: 0; border: none; border-radius: 0; }',"stream");a.addCss('.echo-item-content { word-wrap: break-word; }.echo-item-container-root { padding: 10px 0px; }.echo-item-container-root-thread { padding: 10px 0px 0px 0px; }.echo-item-container-child { padding: 10px; margin: 0px 20px 2px 0px; }.echo-item-container-child-thread { padding: 10px; margin: 0px 20px 2px 0px; }.echo-item-avatar-wrapper { margin-right: -58px; float: left; position: relative; }.echo-item-children .echo-item-avatar-wrapper, .echo-item-childrenByCurrentActorLive .echo-item-avatar-wrapper { margin-right: -34px; }.echo-item-children .echo-item-subwrapper, .echo-item-childrenByCurrentActorLive .echo-item-subwrapper { margin-left: 34px; }.echo-item-wrapper { float: left; width: 100%; }.echo-item-subwrapper { margin-left: 58px; }.echo-item-subcontainer { float: left; width: 100%; }.echo-item-markers { line-height: 16px; background: url(//c0.echoenabled.com/images/curation/metadata/marker.png) no-repeat; padding: 0px 0px 4px 21px; margin-top: 7px; }.echo-item-tags { line-height: 16px; background: url(//c0.echoenabled.com/images/tag_blue.png) no-repeat; padding: 0px 0px 4px 21px; }.echo-item-metadata { display: none; }.echo-item-metadata-title { font-weight: bold; line-height: 25px; height: 25px; margin-right: 5px; }.echo-item-metadata-icon { display: inline-block; padding-left: 26px; }div.echo-item-metadata-userID { border-bottom: 1px solid #e1e1e1; border-top: 1px solid #e1e1e1;}span.echo-item-metadata-userID { background: url("//c0.echoenabled.com/images/curation/metadata/user.png") no-repeat left center; }.echo-item-modeSwitch { float: right; width: 16px; height: 16px; background:url("//c0.echoenabled.com/images/curation/metadata/flip.png") no-repeat 0px 3px; }.echo-item-childrenMarker { border-color: transparent transparent #ECEFF5; border-width: 0px 11px 11px; border-style: solid; margin: 3px 0px 0px 77px; height: 1px; width: 0px; display: none; }.echo-item-container-root-thread .echo-item-childrenMarker { display: block; }.echo-item-avatar { width: 48px; height: 48px; }.echo-item-children .echo-item-avatar, .echo-item-childrenByCurrentActorLive .echo-item-avatar { width: 24px; height: 24px; }.echo-item-authorName { float: left; font-size: 15px; font-family: Arial, sans-serif; font-weight: bold; }.echo-item-re { font-weight: bold; }.echo-item-re a:link, .echo-item-re a:visited, .echo-item-re a:active { text-decoration: none; }.echo-item-re a:hover { text-decoration: underline; }.echo-item-body { padding-top: 4px; }.echo-item-controls { float: left; margin-left: 3px; }.echo-item-sourceIcon { float: left; height: 16px; width: 16px; margin-right: 5px; border: 0px; }.echo-item-date, .echo-item-from, .echo-item-via { float: left; }.echo-item-from a, .echo-item-via a { text-decoration: none; color: #C6C6C6; }.echo-item-from a:hover, .echo-item-via a:hover { color: #476CB8; }.echo-item-tag { display: inline-block; height: 16px; background: url("//c0.echoenabled.com/images/tag_blue.png") no-repeat; padding-left: 18px; }.echo-item-smiley-icon { border: 0px; }.echo-item-textToggleTruncated { margin-left: 5px; }.echo-item-blocker-backdrop { position: absolute; left: 0px; top: 0px; background: #FFFFFF; opacity: 0.7; z-index: 100; }.echo-item-blocker-message { position: absolute; z-index: 200; width: 200px; height: 20px; line-height: 20px; text-align: center; background-color: #FFFF99; border: 1px solid #C6C677; opacity: 0.7; -moz-border-radius: 0.5em 0.5em 0.5em 0.5em; }.echo-item-expandChildren { display:none; text-align: center; padding:4px; }.echo-item-expandChildren .echo-item-expandChildrenLabel { display: inline-block; padding-left: 22px; }.echo-item-expandChildren .echo-message-icon { background: url("//c0.echoenabled.com/images/whirlpool.png") no-repeat 5px 4px; }.echo-item-expandChildren .echo-item-message-loading { background: no-repeat left top url(//c0.echoenabled.com/images/loading.gif); }.echo-item-expandChildren .echo-application-message { padding: 0; border:none; border-radius: 0; }',"item");var b=[];for(var d=0;d<=20;d++){b.push(".echo-item-depth-"+d+" { margin-left: "+(d?68+(d-1)*44:0)+"px; }");}a.addCss(b.join("\n"),"item-depths");if(a.browser.msie){a.addCss(".echo-item-childrenMarker { font-size: 1px; line-height: 1px; filter: chroma(color=black); }.echo-item-blocker-backdrop, .echo-item-blocker-message { filter:Alpha(Opacity=70); }.echo-stream-container { zoom: 1; }.echo-item-content { zoom: 1; }.echo-item-container { zoom: 1; }.echo-item-subwrapper { zoom: 1; }.echo-item-avatar-wrapper { position: static; }.echo-stream-state-picture { vertical-align: middle; }","stream-ie");}};})(jQuery);
(function(a){if(typeof(a._$)!="undefined"){a.noConflict();}if(!window.Echo){window.Echo={};}if(!Echo.Global){Echo.Global={};}if(!Echo.Vars){Echo.Vars={regexps:{matchLabel:/{Label:([^:}]+[^}]*)}/g,matchData:/{Data:(([a-z]+\.)*[a-z]+)}/ig,mobileUA:/mobile|midp-|opera mini|iphone|ipad|blackberry|nokia|samsung|docomo|symbian|windows ce|windows phone|android|up\.browser|ipod|netfront|skyfire|palm|webos|audiovox/i,parseUrl:/^((([^:\/\?#]+):)?\/\/)?([^\/\?#]*)?([^\?#]*)(\?([^#]*))?(#(.*))?/,w3cdtf:/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z$/}};}a.extend({addCss:function(d,f){Echo.Vars.css=Echo.Vars.css||{index:1,processed:{}};if(f){if(Echo.Vars.css.processed[f]){return;}Echo.Vars.css.processed[f]=true;}var c="";var b=Echo.Vars.css.anchor;if(b&&b.length){c=b.html();}if(c.length+d.length>100000){Echo.Vars.css.index++;b=null;c="";}var e=a('<style id="echo-css-'+Echo.Vars.css.index+'" type="text/css">'+c+d+"</style>");if(b&&b.length){b.replaceWith(e);}else{if(Echo.Vars.css.anchor){Echo.Vars.css.anchor.after(e);}else{a(document.getElementsByTagName("head")[0]||document.documentElement).prepend(e);}}Echo.Vars.css.anchor=e;},foldl:function(c,b,d){a.each(b,function(e,f){result=d(f,c,e);if(result!==undefined){c=result;}});return c;},intersperse:function(b,c){return a.foldl([],b,function(e,f,d){if(f.length){f.push(c);}f.push(e);});},getNestedValue:function(b,f,g,h){if(typeof b=="string"){b=b.split(/\./);}if(!b.length){return f;}var e=true;var c=function(j,i){if(h){h(i,j);}if(typeof i[j]=="undefined"){e=false;}else{return i[j];}};var d=b.length==1?c(b.pop(),f):a.foldl(f,b,c);return e?d:g;},setNestedValue:function(g,b,e){var c=b.split(/\./);var f=c.pop();var d=a.getNestedValue(c,g,undefined,function(i,h){if(typeof i[h]=="undefined"){i[h]={};}});d[f]=e;},htmlize:function(b){if(!b){return"";}return a("<div>").text(b).html();},object2JSON:function(f){var d=function(g){var h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return g.replace(/[\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff\\]/g,function(i){return(h.hasOwnProperty(i))?h[i]:"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4);});};var c;switch(typeof f){case"number":c=isFinite(f)?f:"null";break;case"string":c='"'+d(f)+'"';break;case"boolean":c='"'+f.toString()+'"';break;default:if(f instanceof Array){var b=a.map(f,function(g){return a.object2JSON(g);});c="["+b.join(",")+"]";}else{if(f instanceof Object){var e=f.exportProperties||f;var b=a.foldl([],e,function(i,h,g){if(e instanceof Array){g=i;i=f[g];}h.push('"'+g+'":'+a.object2JSON(i));});c="{"+b.join(",")+"}";}else{c="null";}}}return c;},htmlTextTruncate:function(o,e,n,g){if(!e||o.length<e){return o;}var q=[],j=0,h=0;var m="br hr input img area param base link meta option".split(" ");var c=a.foldl({},m,function(s,r,i){r[s]=true;});for(var f=0;f<o.length;f++){var d=o.charAt(f);if(d=="<"){var l=o.indexOf(">",f);if(l<0){return o;}var b=o.substring(f+1,l);var p={name:"",closing:false};if(b.charAt(0)=="/"){p.closing=true;b=b.substring(1);}p.name=b.match(/(\w)+/)[0];if(p.closing){var k=q.pop();if(!k||k.name!=p.name){return o;}}else{if(!c[p.name]){q.push(p);}}f=l;}else{if(d=="&"&&o.substring(f).match(/^(\S)+;/)){f=o.indexOf(";",f);}else{if(j==e){h=f;break;}j++;}}}if(h||g){if(h){o=o.substring(0,h)+(n||"");}for(var f=q.length-1;f>=0;f--){o+="</"+q[f].name+">";}}return o;},mapClass2Object:function(c,b){b=b||{};c.find("*").andSelf().each(function(e,f){if(f.className){var d=f.className.split(/[ ]+/);a.each(d,function(g,h){b[h]=f;});}});return b;},stripTags:function(b){return a("<div>").html(b).text();},parseUrl:function(b){var c=b.match(Echo.Vars.regexps.parseUrl);return c?{scheme:c[3],domain:c[4],path:c[5],query:c[7],fragment:c[9]}:undefined;},toDOM:function(c,g,f){var d=a(c);var e=a.mapClass2Object(d);var h={set:function(i,j){e[g+i]=j;},get:function(i,k){var j=e[(k?"":g)+i];return j&&a(j);},remove:function(j){var i;if(typeof j=="string"){i=g+j;}else{i=j.echo.name;}a(e[i]).remove();delete e[i];},content:d};var b;if(typeof f=="object"){b=function(i,j,k){if(!f[i]){return;}return f[i](j,k);};}else{b=f;}a.each(e,function(m,j){var l=m.match(g+"(.*)");var i=l?l[1]:undefined;if(i&&b){j=a(j);j.echo=j.echo||{};j.echo.name=m;var k=b(i,j,h);if(typeof k!="undefined"){j.empty().append(k);}}});return h;},loadScriptContent:function(d,f){Echo.Vars.scriptState=Echo.Vars.scriptState||{};if(Echo.Vars.scriptState[d]=="loaded"){f();return;}var e=Echo.Broadcast.subscribe("internal.scriptLoaded",function(g,h){if(d!=h){return;}Echo.Broadcast.unsubscribe("internal.scriptLoaded",e);f();});if(Echo.Vars.scriptState[d]=="loading"){return;}Echo.Vars.scriptState[d]="loading";var c=document.createElement("script");c.type="text/javascript";c.charset="utf-8";c.src=d;var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(c,b.firstChild);c.onload=c.onreadystatechange=function(){var g=c.readyState;if(!g||g=="loaded"||g=="complete"){Echo.Vars.scriptState[d]="loaded";Echo.Broadcast.publish("internal.scriptLoaded",d);c.onload=c.onreadystatechange=null;}};},sendPostRequest:function(c,e,g){var f="echo-post-"+Math.random();var b=a("#echo-post-request").length?a("#echo-post-request").empty():a('<div id="echo-post-request"/>').css({height:0}).prependTo("body");a('<iframe id="'+f+'" name="'+f+'" width="0" height="0" frameborder="0" border="0"></iframe>').appendTo(b);var d=a("<form/>",{target:f,method:"POST",enctype:"application/x-www-form-urlencoded",acceptCharset:"UTF-8",action:c}).appendTo(b);a.each(e,function(h,i){a("<input/>",{type:"hidden",name:h,value:i}).appendTo(d);});d.submit();g();},getVisibleColor:function(c){var b;do{b=c.css("backgroundColor");if(b!=""&&b!="transparent"&&!/rgba\(0, 0, 0, 0\)/.test(b)||a.nodeName(c.get(0),"body")){break;}}while(c=c.parent());return b||"transparent";},timestampFromW3CDTF:function(b){var e=["year","month","day","hours","minutes","seconds"];var c={};var d=b.match(Echo.Vars.regexps.w3cdtf);a.each(e,function(f,g){c[g]=d[f+1];});return Date.UTC(c.year,c.month-1,c.day,c.hours,c.minutes,c.seconds)/1000;},isMobileDevice:function(){return Echo.Vars.regexps.mobileUA.test(navigator.userAgent);}});if(!Echo.Plugins){Echo.Plugins={};}Echo.isExtended=function(b,d,c){if(!b){return false;}c=c||true;var e=[b].concat(d).join(".");Echo.Vars.extensions=Echo.Vars.extensions||{};if(Echo.Vars.extensions[e]==c){return true;}Echo.Vars.extensions[e]=c;return false;};Echo.extendRenderer=function(b,f,d,c){if(!b||!Echo[b]||!f||!d||!a.isFunction(d)||Echo.isExtended(c,[b,"renderer",f])){return;}var e=Echo[b].prototype.renderers[f]||function(){};Echo[b].prototype.renderers[f]=function(){var h=c&&this.config.get("plugins."+c);if(!h||!h.enabled){return e.apply(this,arguments);}var g=this;if(!this.parentRenderer){this.parentRenderer=function(j,i){return g.parentRenderers[j].apply(g,i);};}this.parentRenderers=this.parentRenderers||{};this.parentRenderers[f]=e;return d.apply(this,arguments);};};Echo.extendTemplate=function(c,e,i,b,h){if(!c||!Echo[c]||!i||!b||!e||Echo.isExtended(h,[c,"template",b,i],e)){return;}var g=Echo[c].prototype.template;var f=a.isFunction(g)?g:function(){return g;};var d={insertBefore:"before",insertAfter:"after",insertAsFirstChild:"prepend",insertAsLastChild:"append",replace:"replaceWith"};Echo[c].prototype.template=function(){var j=h&&this.config.get("plugins."+h);if(!j||!j.enabled){return f.call(this);}var k=a("<div/>").html(f.call(this));a("."+b,k)[d[i]](e);return k.html();};};Echo.include=function(b,d){if(!b.length){return d();}var c=b.pop();Echo.include(b,function(){if(typeof c.loaded=="undefined"){if(c.application){c.loaded=function(){return !!Echo[c.application];};}else{d();}}if(a.isFunction(c.loaded)&&!c.loaded()){a.loadScriptContent(c.url,d);}else{d();}});};Echo.createPlugin=function(c){if(!c||!c.name||!c.init||!c.applications){return{};}var b=c.name;var e=function(){var f=function(g){return"plugins."+b+(g?"."+g:"");};f.get=function(g,h,i,j){return g.config.get(f(h),j?g.config.get(h,i):i);};f.set=function(g,h,i){g.config.set(f(h),i);};f.remove=function(g,h){g.config.remove(f(h));};return f;};var d=c.init||function(){};Echo.Plugins[b]=Echo.Plugins[b]||a.extend(c,{init:function(h,g){var f=h.config.get(g,"enabled");if(typeof f=="undefined"){h.config.set(g,"enabled",true);}d(h,g);},set:function(f,g,h){f.vars=f.vars||{};f.vars[b]=f.vars[b]||{};a.setNestedValue(f.vars[b],g,h);},get:function(f,g){var h=(f.vars||{})[b]||{};if(!g){return h;}return a.getNestedValue(g,h);},addCss:function(f){a.addCss(f,"plugins-"+b);},label:function(f,g){return Echo.Localization.label(f,"Plugins."+b,g);},addLabels:function(f){Echo.Localization.extend(f,"Plugins."+b);},topic:function(h,g){var f=typeof h=="string"?h:h.namespace;return f+".Plugins."+b+"."+g;},config:e(),subscribe:function(h,g,i){var f=this;return h.subscribe(g,function(){if(!h.isPluginEnabled(f.name)){return;}i.apply(this,arguments);});},publish:function(g,f,h){g.publish(f,h);},unsubscribe:function(g,f,h){g.unsubscribe(f,h);},extendRenderer:function(f,h,g){Echo.extendRenderer(f,h,g,b);},extendTemplate:function(g,h,i,f){Echo.extendTemplate(g,h,i,f,b);},addItemControl:function(g,h){var f=g.config.get("itemControls."+b,[]);g.config.set("itemControls."+b,f.concat(h));},assembleConfig:function(f,g){g.user=f.user;g.appkey=f.config.get("appkey","");g.plugins=this.config.get(f,"nestedPlugins",[]);g.contextId=f.config.get("contextId");g.apiBaseURL=f.config.get("apiBaseURL");return(new Echo.Config(g,this.config.get(f))).getAsHash();}});return Echo.Plugins[b];};if(!Echo.Broadcast){Echo.Broadcast={};}Echo.Broadcast.initContext=function(c,b){b=b||"empty";Echo.Vars.subscriptions=Echo.Vars.subscriptions||{};Echo.Vars.subscriptions[b]=Echo.Vars.subscriptions[b]||{};Echo.Vars.subscriptions[b][c]=Echo.Vars.subscriptions[b][c]||{};return b;};Echo.Broadcast.subscribe=function(c,d,b){var e=(new Date()).valueOf()+Math.random();b=Echo.Broadcast.initContext(c,b);Echo.Vars.subscriptions[b][c][e]=d;return e;};Echo.Broadcast.unsubscribe=function(c,d,b){b=Echo.Broadcast.initContext(c,b);if(c&&d){delete Echo.Vars.subscriptions[b][c][d];}else{if(c){delete Echo.Vars.subscriptions[b][c];}}};Echo.Broadcast.publish=function(c,d,b){b=Echo.Broadcast.initContext(c,b);if(b=="*"){a.each(Echo.Vars.subscriptions,function(e){a.each(Echo.Vars.subscriptions[e][c]||{},function(g,f){f.apply(this,[c,d]);});});}else{if(Echo.Vars.subscriptions[b][c]){a.each(Echo.Vars.subscriptions[b][c],function(f,e){e.apply(this,[c,d]);});}if(b!="empty"){Echo.Broadcast.publish(c,d,"empty");}}};if(!Echo.Object){Echo.Object=function(){};}Echo.Object.prototype.init=function(b){a.extend(this,b||{});};Echo.Object.prototype.template="";Echo.Object.prototype.namespace="";Echo.Object.prototype.cssPrefix="echo-";Echo.Object.prototype.substitute=function(c,d){var b=this;c=c.replace(Echo.Vars.regexps.matchLabel,function(f,e){return b.label(e);});c=c.replace(Echo.Vars.regexps.matchData,function(f,e){return a.getNestedValue(e,d,"");});return c;};Echo.Object.prototype.renderers={};Echo.Object.prototype.label=function(c,d){var b=Echo.Localization.label(c,this.namespace,d);return b!=c?b:Echo.Localization.label(c,"",d);};Echo.Object.prototype.render=function(d,e,g,b){var c=this;if(d){if(a.isFunction(this.renderers[d])){return this.renderers[d].call(this,e,g,b);}}else{var f=a.isFunction(this.template)?this.template():this.template;this.dom=a.toDOM(this.substitute(f,this.data||{}),this.cssPrefix,function(){return c.render.apply(c,arguments);});return this.dom.content;}};Echo.Object.prototype.rerender=function(b,d){var j=this;if(!b){if(this.dom){this.dom.content.replaceWith(this.render());}return;}if(!this.dom){return;}if(typeof b!="string"){a.map(b,function(k){j.rerender(k,d);});return;}else{if(!this.dom.get(b)){return;}}if(d){var i=a.isFunction(this.template)?this.template():this.template;var g=this.substitute(i,this.data||{});var e=this.dom.get(b);var h=a("."+this.cssPrefix+b,a(g));h=a.toDOM(h,this.cssPrefix,function(k,l,m){j.dom.set(k,l);return j.render.apply(j,arguments);}).content;e.replaceWith(h);}else{var f=this.dom.get(b);var c=this.renderers[b].call(this,f,this.dom);if(typeof c!="undefined"){f.empty().append(c);}}};Echo.Object.prototype.hyperlink=function(e,d){d=d||{};if(d.openInNewWindow&&!e.target){e.target="_blank";}var c=e.caption||"";delete e.caption;if(!d.skipEscaping){e.href=a.htmlize(e.href);}e.href=e.href||"javascript:void(0)";var b=a.foldl([],e,function(h,g,f){g.push(f+'="'+h+'"');});return"<a "+b.join(" ")+">"+c+"</a>";};Echo.Object.prototype.newContextId=function(){return(new Date()).valueOf()+Math.random();};Echo.Object.prototype.getContextId=function(){return this.config&&this.config.get("contextId");};Echo.Object.prototype.subscribe=function(b,c){return Echo.Broadcast.subscribe(b,c,this.getContextId());};Echo.Object.prototype.unsubscribe=function(b,c){Echo.Broadcast.unsubscribe(b,c,this.getContextId());};Echo.Object.prototype.publish=function(b,c){Echo.Broadcast.publish(b,c,this.getContextId());};Echo.Object.prototype.clearCache=function(){if(this.vars&&this.vars.cache){this.vars.cache={};}};Echo.Application=function(){this.addCss();};Echo.Application.prototype=new Echo.Object();Echo.Application.prototype.errorMessages={error_busy:"Loading. Please wait...",error_timeout:"Loading. Please wait...",error_waiting:"Loading. Please wait...",error_result_too_large:"(result_too_large) The search result is too large.",error_wrong_query:"(wrong_query) Incorrect or missing query parameter.",error_incorrect_appkey:"(incorrect_appkey) Incorrect or missing appkey.",error_internal_error:"(internal_error) Unknown server error.",error_quota_exceeded:"(quota_exceeded) Required more quota than is available.",error_incorrect_user_id:"(incorrect_user_id) Incorrect user specified in User ID predicate.",error_unknown:"(unknown) Unknown error."};Echo.Application.prototype.initApplication=function(d){var b=this;var c=this.config.get("appkey");if(!c){this.showMessage({type:"error",message:"Incorrect or missing mandatory parameter appkey"});return;}this.config.get("target").addClass("echo-ui");this.user=this.config.get("user")||new Echo.User({appkey:c,apiBaseURL:this.config.get("apiBaseURL"),contextId:this.config.get("contextId")});this.user.init(function(){b.initPlugins(d);});Echo.Localization.extend(this.errorMessages);};Echo.Application.prototype.messageTemplates={compact:'<span class="echo-application-message-icon echo-application-message-{Data:type}" title="{Data:message}"></span>',"default":'<div class="echo-application-message"><span class="echo-application-message-icon echo-application-message-{Data:type} echo-primaryFont">{Data:message}</span></div>'};Echo.Application.prototype.showMessage=function(c,d){if(!this.config.get("debug")&&c.type=="error"){return;}var b=this.messageTemplates[c.layout||this.messageLayout||"default"];(d||this.config.get("target")).empty().append(this.substitute(b,c));};Echo.Application.prototype.isWaitingForData=function(b){return b&&(b.errorCode=="waiting"||b.errorCode=="timeout"||b.errorCode=="busy");};Echo.Application.prototype.handleErrorResponse=function(g,d){var b=this;d=d||{};var h=this.config.get("target");var e=function(){if(b.waitingTimeoutStep>0){if(b.waitingTimeoutStep<4){b.waitingTimeoutStep++;}}else{b.waitingTimeoutStep=1;}return Math.round(Math.exp(b.waitingTimeoutStep))*1000;};if(this.error!=g){if(!this.config.get("debug")){h.hide();}else{var c=this.label("error_"+g.errorCode);var f=c=="error_"+g.errorCode?"("+g.errorCode+") "+(g.errorMessage||""):c;h.show();this.showMessage({type:this.isWaitingForData(g)?"loading":"error",message:f},d.messageTarget);}}this.error=g;if(this.isWaitingForData(g)){this.waitingTimer=setTimeout(function(){b.cleanupErrorHandlers();if(d.waitingHandler){d.waitingHandler();}else{b.refresh();}},e());}else{this.waitingTimeoutStep=0;}if(d.callback){d.callback(g);}};Echo.Application.prototype.cleanupErrorHandlers=function(b){if(b){this.waitingTimeoutStep=0;delete this.error;}if(this.waitingTimer){clearTimeout(this.waitingTimer);}};Echo.Application.prototype.initPlugins=function(e){var d=this;var c=this.config.get("pluginsOrder");var b=a.foldl([],c,function(f,h){var g=Echo.Plugins[f];if(g&&g.dependencies&&g.dependencies.length){return h.concat(g.dependencies);}});Echo.include(b,function(){a.map(c,function(f){var g=Echo.Plugins[f];if(g&&g.init&&d.isPluginApplicable(g)){g.init(g,d);}});if(e){e();}});};Echo.Application.prototype.enablePlugin=function(b){this.config.set("plugins."+b+".enabled",true);};Echo.Application.prototype.disablePlugin=function(b){this.config.set("plugins."+b+".enabled",false);};Echo.Application.prototype.isPluginEnabled=function(b){return this.config.get("plugins."+b+".enabled",true);};Echo.Application.prototype.isPluginApplicable=function(d){var c=this,b=false;a.each(d.applications,function(f,e){if(Echo[e]&&c instanceof Echo[e]){b=true;return false;}});return b;};Echo.Application.prototype.initConfig=function(d,e,c){var b={};b.target=function(f){return a(f);};b.plugins=function(g){var f=a.foldl({hash:{},order:[]},g||[],function(h,i){var j=a.inArray(h.name,i.order);if(j>=0){i.order.splice(j,1);}i.order.push(h.name);i.hash[h.name]=h;});this.set("pluginsOrder",f.order);return f.hash;};d=a.extend({plugins:[]},d||{});e=a.extend({appkey:"",apiBaseURL:"http://api.echoenabled.com",liveUpdates:true,liveUpdatesTimeout:10,liveUpdatesTimeoutMin:3,debug:true,contextId:this.newContextId()},e||{});this.config=new Echo.Config(d,e,function(f,h){var g=c&&c[f]||b&&b[f];return g?g.call(this,h):h;});};Echo.Application.prototype.sendAPIRequest=function(b,c){b.query.appkey=this.config.get("appkey");a.get(this.config.get("apiBaseURL")+"/v1/"+b.endpoint,b.query,c,"jsonp");};Echo.Application.prototype.initLiveUpdates=function(d,b){var c=this;this.liveUpdates={originalTimeout:this.config.get("liveUpdatesTimeout"),timers:{},timeouts:[],responseHandler:function(e){if(c.liveUpdates.timers.watchdog){clearTimeout(c.liveUpdates.timers.watchdog);}c.changeLiveUpdatesTimeout(e);b(e);},requestParamsGetter:d};};Echo.Application.prototype.changeLiveUpdatesTimeout=function(h){var d=this;if(typeof h=="string"){h={liveUpdatesTimeout:h};}h.liveUpdatesTimeout=parseInt(h.liveUpdatesTimeout);var c=function(j){if(!j&&d.liveUpdates.originalTimeout!=d.config.get("liveUpdatesTimeout")){d.config.set("liveUpdatesTimeout",d.liveUpdates.originalTimeout);}else{if(j&&j>d.config.get("liveUpdatesTimeout")){d.config.set("liveUpdatesTimeout",j);}}};var b=function(j){return !!(j.entries&&j.entries.length);};if(!this.nextSince){c(h.liveUpdatesTimeout);return;}var f=this.config.get("liveUpdatesTimeout");var i=parseInt(this.nextSince);var e=Math.floor((new Date()).getTime()/1000);var g=b(h)?e-i>f?this.config.get("liveUpdatesTimeoutMin",3):f+1:f+2;if(g>this.liveUpdates.originalTimeout){g=this.liveUpdates.originalTimeout;}this.config.set("liveUpdatesTimeout",g);if(g==this.liveUpdates.originalTimeout){c(h.liveUpdatesTimeout);}};Echo.Application.prototype.stopLiveUpdates=function(){if(this.liveUpdates.timers.regular){clearTimeout(this.liveUpdates.timers.regular);}if(this.liveUpdates.timers.watchdog){clearTimeout(this.liveUpdates.timers.watchdog);}};Echo.Application.prototype.startLiveUpdates=function(d){var b=this;if(!this.liveUpdates||!d&&!this.config.get("liveUpdates")&&!this.liveUpdates.timeouts.length){return;}this.stopLiveUpdates();if(d){this.liveUpdates.timeouts=[0,1,3];}var c=this.liveUpdates.timeouts.length?this.liveUpdates.timeouts.shift():this.config.get("liveUpdatesTimeout");this.liveUpdates.timers.regular=setTimeout(function(){b.liveUpdates.timers.watchdog=setTimeout(function(){b.startLiveUpdates();},5000);b.sendAPIRequest(b.liveUpdates.requestParamsGetter(),b.liveUpdates.responseHandler);},c*1000);};Echo.Application.prototype.addCss=function(){var c="echo-css-fancybox";if(a("#"+c).length){return;}var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(a("<link>",{rel:"stylesheet",id:c,type:"text/css",href:"//c0.echoenabled.com/css/fancybox.css"}).get(0),a(b).children().get(0));a.addCss(".echo-application-message { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }.echo-application-message-icon { display: inline-block; height: 16px; padding-left: 16px; background: no-repeat left center; }.echo-application-message .echo-application-message-icon { padding-left: 21px; height: auto; }.echo-application-message-empty { background-image: url(//c0.echoenabled.com/images/information.png); }.echo-application-message-loading { background-image: url(//c0.echoenabled.com/images/loading.gif); }.echo-application-message-error { background-image: url(//c0.echoenabled.com/images/warning.gif); }","application");};Echo.User=function(b){this.data={};this.config=new Echo.Config(b,{appkey:"",apiBaseURL:"http://api.echoenabled.com",contextId:undefined});};Echo.User.prototype.init=function(e){var b=this;this.callback=e||function(){};if(!this.config.get("appkey")||!window.Backplane||!Backplane.getChannelID()){this.set({});this.callback();return;}this.listenEvents();var d=this._global("get","state");if(d=="ready"){this.set(a.extend({},this._global("get","data")));this.callback();}else{var c=Echo.Broadcast.subscribe("User.onInit",function(f,g){if(g.appkey!=b.config.get("appkey")){return;}Echo.Broadcast.unsubscribe("User.onInit",c);b.set(a.extend({},b._global("get","data")));b.callback();});if(d=="init"){this.request();}}};Echo.User.prototype.listenEvents=function(){var b=this;if(this.backplaneSubscriptionID){return;}var c=function(f){var e=(f?"":"internal.")+"User.onInvalidate";var g={data:b.data,appkey:b.config.get("appkey")};var d=f?undefined:b.config.get("contextId");Echo.Broadcast.publish(e,g,d);};this.backplaneSubscriptionID=Backplane.subscribe(function(e){if(e.type=="identity/ack"){var d=false;if(b._global("get","state")=="ready"){d=true;b._global("set","state","init");}b.init(function(){c();if(d){c(true);}});}});};Echo.User.prototype._global=function(e,c,d){var b=this.config.get("appkey");Echo.Vars.users=Echo.Vars.users||{};Echo.Vars.users[b]=Echo.Vars.users[b]||{state:"init",data:{}};if(e=="get"){return Echo.Vars.users[b][c];}Echo.Vars.users[b][c]=d;};Echo.User.prototype.set=function(){if(!arguments.length){return;}if(arguments.length==1&&typeof arguments[0]=="object"){this._global("set","data",arguments[0]);this.data=this.normalize(arguments[0]);this.account=this.assemble();}else{if(arguments.length==2&&typeof arguments[0]=="string"){this.account[arguments[0]]=arguments[1];}}};Echo.User.prototype.get=function(b,c){return(this.account.hasOwnProperty(b)&&typeof this.account[b]!="undefined")?this.account[b]:c;};Echo.User.prototype.logout=function(c){var b=this;a.get(window.location.protocol+"//apps.echoenabled.com/v2/logout",{sessionID:Backplane.getChannelID()},function(d){Backplane.expectMessages("identity/ack");},"jsonp");};Echo.User.prototype.request=function(d){var b=this,c=this.config.get("appkey");this._global("set","state","waiting");a.get(this.config.get("apiBaseURL")+"/v1/users/whoami",{appkey:c,sessionID:Backplane.getChannelID()},function(e){if(e.result&&e.result=="session_not_found"){e={};}b._global("set","state","ready");b.set(a.extend({},e));Echo.Broadcast.publish("User.onInit",{data:e,appkey:c});if(d){d();}},"jsonp");};Echo.User.prototype.normalize=function(c){var b=function(d){return a.foldl({},d||[],function(e,f){f[e]=true;});};c=c||{};c.echo=c.echo||{};a.extend(c,c.echo);c.poco=c.poco||{entry:{}};c.roles=b(c.echo.roles);c.markers=b(c.echo.markers);c.sessionID=window.Backplane&&Backplane.getChannelID()||undefined;c.accounts=c.poco.entry.accounts||[];return c;};Echo.User.prototype.getActiveAccounts=function(){return a.map(this.data.accounts,function(b){if(b.loggedIn=="true"){return b;}});};Echo.User.prototype.assemble=function(){var b=this.getActiveAccounts();var c=b[0]||{};return a.extend(this.data,{id:c.identityUrl||this.data.poco.entry.id||c.userid,name:this.data.poco.entry.displayName||c.username,avatar:a.foldl(undefined,c.photos||[],function(d){if(d.type=="avatar"){return d.value;}}),state:this.data.echo.state||"Untouched",domain:c.domain,logged:!!b.length,defaultAvatar:"//c0.echoenabled.com/images/avatar-default.png",fakeIdentityURL:"http://js-kit.com/ECHO/user/fake_user"});};Echo.User.prototype.hasIdentity=function(c){var b=false;a.each(this.data.accounts,function(d,e){if(e.identityUrl&&e.identityUrl==c){b=true;return false;}});return b;};Echo.User.prototype.hasAny=function(e,c){if(!this.account){return false;}var b=this,d=false;a.each(c,function(f,h){var g=b.get(e,{});if((typeof g=="string"&&g==h)||g[h]){d=true;return false;}});return d;};Echo.User.prototype.hasAnyRole=function(b){return this.hasAny("roles",b);};Echo.User.prototype.isAdmin=function(){return this.hasAny("roles",["administrator","moderator"]);};Echo.User.prototype.logged=function(){return !!(this.account&&this.account.logged);};Echo.Config=function(e,c,d){var b=this;this.normalize=d||function(f,g){return g;};this.data={};this.cache={};if(!c&&!d){this.data=e;}else{a.each(this.combine(e,a.extend({},c)),function(f,g){b.set(f,g);});}};Echo.Config.prototype.get=function(c,d){var b=c;if(typeof b!="string"){b=b.join(".");}if(!this.cache.hasOwnProperty(b)){this.cache[b]=a.getNestedValue(c,this.data);}return typeof this.cache[b]=="undefined"?d:this.cache[b];};Echo.Config.prototype.set=function(b,d){var c=b.split(/\./);delete this.cache[b];if(typeof d=="object"){this.clearCacheByPrefix(b);}return a.setNestedValue(this.data,b,this.normalize(c.pop(),d));};Echo.Config.prototype.remove=function(b){var c=b.split(/\./);var e=c.pop();var d=a.getNestedValue(c,this.data);delete d[e];};Echo.Config.prototype.combine=function(d,c){var b=this;return a.foldl(c,d,function(g,f,e){f[e]=a.isPlainObject(g)&&c.hasOwnProperty(e)?b.combine(g,c[e]):g;});};Echo.Config.prototype.extend=function(b){var c=this;a.each(b,function(d,e){c.set(d,e);});};Echo.Config.prototype.getAsHash=function(){return this.data;};Echo.Config.prototype.clearCacheByPrefix=function(c){var b=this;c+=".";a.each(this.cache,function(d,e){if(!d.indexOf(c)){delete b.cache[d];}});};if(!Echo.Localization){Echo.Localization={labels:{}};}Echo.Localization.key=function(b,c){return(c?c+".":"")+b;};Echo.Localization.extend=function(c,b){a.each(c,function(d,e){Echo.Localization.labels[Echo.Localization.key(d,b)]=e;});};Echo.Localization.label=function(c,d,e){var b=Echo.Localization.labels[Echo.Localization.key(c,d)]||c;a.each(e||{},function(f,g){b=b.replace(new RegExp("{"+f+"}","g"),g);});return b;};if(!Echo.UI){Echo.UI={cornersCss:function(b,c){return("{scope}.ui-corner-tl { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; }{scope}.ui-corner-tr { -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }{scope}.ui-corner-bl { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }{scope}.ui-corner-br { -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}-bottom-right-radius: {radius}; }{scope}.ui-corner-top { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }{scope}.ui-corner-bottom { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }{scope}.ui-corner-right {  -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }{scope}.ui-corner-left { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }{scope}.ui-corner-all { -moz-border-radius: {radius}; -webkit-border-radius: {radius}; border-radius: {radius}; }").replace(/{scope}/g,c||"").replace(/{radius}/g,b);}};}(function(){a.addCss('.echo-ui { text-align: left; }.echo-ui .ui-helper-hidden { display: none; }.echo-ui .ui-helper-hidden-accessible { position: absolute; left: -99999999px; }.echo-ui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }.echo-ui .ui-helper-clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }.echo-ui .ui-helper-clearfix { display: inline-block; }/* required comment for clearfix to work in Opera \\*/* html .echo-ui .ui-helper-clearfix { height:1%; }.echo-ui .ui-helper-clearfix { display:block; }/* end clearfix */.echo-ui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }.echo-ui .ui-resizable-handle { position: absolute;font-size: 0.1px;z-index: 99999; display: block;}.echo-ui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }.echo-ui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }.echo-ui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }.echo-ui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }.echo-ui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }.echo-ui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }.echo-ui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }.echo-ui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }.echo-ui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}.echo-ui .ui-state-disabled { cursor: default !important; }.echo-ui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; width: 16px; height: 16px; }.echo-ui .ui-widget-header { font-weight: bold; border: 0px; }.echo-ui, .echo-ui .ui-widget :active { outline: none; }.echo-ui .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }.echo-ui .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-ui .ui-state-default a:visited { color: #555555; text-decoration: none; }.echo-ui .ui-state-hover, .echo-ui .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }.echo-ui .ui-state-hover a, .echo-ui .ui-state-hover a:hover { color: #212121; text-decoration: none; }.echo-ui .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }.echo-ui .ui-state-active a, .echo-ui .ui-state-active a:link, .echo-ui .ui-state-active a:visited { color: #212121; text-decoration: none; }.echo-primaryBackgroundColor {  }.echo-secondaryBackgroundColor { background-color: #F4F4F4; }.echo-trinaryBackgroundColor { background-color: #ECEFF5; }.echo-primaryColor { color: #3A3A3A; }.echo-secondaryColor { color: #C6C6C6; }.echo-primaryFont { font-family: Arial, sans-serif; font-size: 12px; font-weight: normal; line-height: 16px; }.echo-secondaryFont { font-family: Arial, sans-serif; font-size: 11px; }.echo-linkColor, .echo-linkColor a { color: #476CB8; }.echo-clickable { cursor: pointer; }.echo-relative { position: relative; }.echo-clear { clear: both; }',"ui-general");})();Echo.UI.Button=function(c,b){this.states=b||{};this.element=a(c);this.addCss();if(this.states.normal&&!this.states.normal.label){this.states.normal.label=a(c).html();}a(c).button(this.states.normal).wrap('<span class="echo-button"></span>');this.wrapper=a(c).parent();};Echo.UI.Button.prototype=new Echo.Object();Echo.UI.Button.prototype.setState=function(b){this.element.removeClass("ui-button-text-only ui-button-text-icons ui-button-text-icon");this.element.button("option",this.states[b]);};Echo.UI.Button.prototype.addCss=function(){a.addCss(".echo-button .ui-button { display: inline-block; position: relative; padding: 0; margin-right: .1em; text-decoration: none !important; cursor: pointer; text-align: center; overflow: visible; }.echo-button .ui-button-icon-only { width: 1.8em; }.echo-button button.ui-button-icon-only { width: 2em; }.echo-button .ui-button-icons-only { width: 3em; }.echo-button button.ui-button-icons-only { width: 3.3em; }.echo-button .ui-button .ui-button-text { display: block; }.echo-button .ui-button-text-only .ui-button-text { padding: .4em .8em; }.echo-button .ui-button-icon-only .ui-button-text, .echo-button .ui-button-icons-only .ui-button-text { padding: .4em; text-indent: -9999999px; }.echo-button .ui-button-text-icon .ui-button-text, .echo-button .ui-button-text-icons .ui-button-text { padding: .4em .8em .4em 2.1em; }.echo-button .ui-button-text-icons .ui-button-text { padding-left: 1.9em; padding-right: 1.9em; }.echo-button input.ui-button { padding: .4em .8em; }.echo-button .ui-button-icon-only .ui-icon, .echo-button .ui-button-text-icon .ui-icon, .echo-button .ui-button-text-icons .ui-icon, .echo-button .ui-button-icons-only .ui-icon { position: absolute; top: 50%; margin-top: -8px; }.echo-button .ui-button-icon-only .ui-icon { left: 50%; margin-left: -8px; }.echo-button .ui-button-text-icon .ui-button-icon-primary, .echo-button .ui-button-text-icons .ui-button-icon-primary, .echo-button .ui-button-icons-only .ui-button-icon-primary { left: .3em; }.echo-button .ui-button-text-icons .ui-button-icon-secondary, .echo-button .ui-button-icons-only .ui-button-icon-secondary { right: .3em; }.echo-button button.ui-button::-moz-focus-inner { border: 0; padding: 0; }.echo-button .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }.echo-button .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-button .ui-state-default a:visited { color: #555555; text-decoration: none; }.echo-button .ui-state-hover, .echo-button .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }.echo-button .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }"+Echo.UI.cornersCss("4px",".echo-button button"),"ui-buttons");if(a.browser.msie){a.addCss(".echo-button .ui-button { zoom: 1; }","ui-buttons-ie");}a.addCss(".echo-button .ui-icon-arrow-right { background: no-repeat center url(//c0.echoenabled.com/images/curation/button/apply_normal.png); }.echo-button .ui-icon-save { margin-right: 5px; background: no-repeat center url(//c0.echoenabled.com/images/curation/button/save_normal.png); }.echo-button .ui-icon-waiting { margin-right: 5px; background: no-repeat center url(//c0.echoenabled.com/images/loading.gif); }","ui-buttons-icons");};})(jQuery);(function(a){Echo.Localization.extend({createdBy:"Created by",loading:"Loading...",markers:"Markers:",markersHint:"Marker1, marker2, marker3, ...",on:"on",post:"Post",posting:"Posting...",postingFailed:'There was a server error while trying to submit your item. Please try again in a few minutes. <b>Error: "{error}"</b>.',postingTimeout:"There was a network issue while trying to submit your item. Please try again in a few minutes.",tagsHint:"Tag1, tag2, tag3, ...",tags:"Tags:",update:"Update",updating:"Updating...",yourName:"Your Name (required)",yourWebsiteOptional:"Your website (optional)"},"Submit");Echo.Submit=function(c){if(!c||!c.target){return;}var b=this;this.vars={};this.initConfig(c,{targetURL:document.location.href,submissionProxyURL:window.location.protocol+"//apps.echoenabled.com/v2/esp/activity",markers:[],source:{},tags:[],mode:"standard",data:{},inReplyTo:{},actionString:"Type your comment here...",postingTimeout:30});this.initialMode=this.config.get("mode");this.initApplication(function(){b.contextId=b.config.get("contextId",b.newContextId());b.addCss();b.config.get("target").empty().append(b.render());b.listenEvents();b.publish("Submit.onRender",b.prepareBroadcastParams());});};Echo.Submit.prototype=new Echo.Application();Echo.Submit.prototype.namespace="Submit";Echo.Submit.prototype.cssPrefix="echo-submit-";Echo.Submit.prototype.template=function(){return this.templates[this.config.get("mode")];};Echo.Submit.prototype.templates={};Echo.Submit.prototype.templates.standard='<div class="echo-submit-container"><div class="echo-submit-header"></div><div class="echo-submit-body"><div class="echo-submit-content echo-submit-border"><textarea class="echo-submit-text echo-submit-text-area echo-primaryFont echo-primaryColor"></textarea></div><div class="echo-submit-markersContainer echo-submit-metadata-container echo-primaryFont echo-primaryColor"><div class="echo-submit-metadata-label">{Label:markers}</div><div class="echo-submit-metadata-wrapper"><div class="echo-submit-metadata-subwrapper echo-submit-border "><input class="echo-submit-markers echo-primaryFont"></div></div><div class="echo-clear"></div></div><div class="echo-submit-tagsContainer echo-submit-metadata-container echo-primaryFont echo-primaryColor"><div class="echo-submit-metadata-label">{Label:tags}</div><div class="echo-submit-metadata-wrapper"><div class="echo-submit-metadata-subwrapper echo-submit-border "><input class="echo-submit-tags echo-submit-border echo-primaryFont"></div></div><div class="echo-clear"></div></div></div><div class="echo-submit-controls"><div class="echo-submit-post-container echo-ui"><button type="button" class="echo-submit-postButton echo-primaryFont"></button></div><div class="echo-clear"></div></div></div>';Echo.Submit.prototype.templates.edit=Echo.Submit.prototype.templates.standard;Echo.Submit.prototype.templates.compact='<div class="echo-submit-container"><div class="echo-submit-content echo-submit-border"><input class="echo-submit-text echo-submit-text-input echo-primaryFont echo-primaryColor"></div></div>';Echo.Submit.prototype.renderers={};Echo.Submit.prototype.renderers.container=function(b){if(this.initialMode=="compact"){b.click(function(c){c.stopPropagation();});}};Echo.Submit.prototype.renderers.tagsContainer=Echo.Submit.prototype.renderers.markersContainer=function(b,c){if(this.user.isAdmin()){b.show();}else{b.hide();}};Echo.Submit.prototype.renderers.metaFields=function(c,f,b){var d=b.type;var e=this.config.get("data.object."+d,this.config.get(d,[]));f.get(d).iHint({text:this.label(d+"Hint"),className:"echo-secondaryColor"}).val(a.trim(a.stripTags(e.join(", ")))).blur();};Echo.Submit.prototype.renderers.markers=function(b,c){this.render("metaFields",b,c,{type:"markers"});};Echo.Submit.prototype.renderers.tags=function(b,c){this.render("metaFields",b,c,{type:"tags"});};Echo.Submit.prototype.renderers.editModeUserInfo=function(c,g){var e='<div class="echo-submit-userInfoWrapper echo-primaryFont echo-primaryFont echo-primaryColor">{Label:createdBy} <span class="echo-submit-author">{Data:author}</span> {Label:on} {Data:date}</div>';var d={};var f=this.config.get("data.object.published");var b=new Date(a.timestampFromW3CDTF(f)*1000);return a.toDOM(this.substitute(e,{date:b.toLocaleDateString()+", "+b.toLocaleTimeString(),author:this.config.get("data.actor.title",this.label("guest"))}),this.cssPrefix,{}).content;};Echo.Submit.prototype.renderers.anonymousModeUserInfo=function(c,g){var b=this;var f="echo-submit-anonymousUserInfo";var e='<div class="echo-submit-userInfoWrapper"><div class="{Data:prefix}Avatar"></div><div class="{Data:prefix}Fields"><div class="{Data:prefix}FieldsWrapper"><div class="{Data:prefix}NameContainer echo-submit-border"><input class="{Data:prefix}Name echo-primaryFont echo-primaryColor"></div><div class="{Data:prefix}UrlContainer echo-submit-border"><input class="{Data:prefix}Url echo-primaryFont echo-primaryColor"></div></div></div><div class="echo-clear"></div></div>';var d={Avatar:function(i){var h=b.user.get("avatar",b.user.get("defaultAvatar"));i.append('<img src="'+h+'">');},Name:function(h){g.set("anonymousUserInfoName",h);h.val(b.user.get("name","")).iHint({text:b.label("yourName"),className:"echo-secondaryColor"});},Url:function(h){g.set("anonymousUserInfoUrl",h);h.val(b.user.get("domain","")).iHint({text:b.label("yourWebsiteOptional"),className:"echo-secondaryColor"});}};var e=this.substitute(e,{prefix:f});return a.toDOM(e,f,d).content;};Echo.Submit.prototype.renderers.header=function(b,d){var c=this.config.get("mode")=="edit"?"edit":"anonymous";return this.render(c+"ModeUserInfo",b,d);};Echo.Submit.prototype.renderers.text=function(c){var b=this,d=this.config.get("data.object.content");if(d){c.val(d);}c.iHint({text:b.config.get("actionString"),className:"echo-secondaryColor"});if(this.config.get("mode")=="compact"){c.focus(function(){b.config.set("mode","standard");b.rerender();setTimeout(function(){b.dom.get("text").focus();},0);b.publish("Submit.onExpand",b.prepareBroadcastParams());});}};Echo.Submit.prototype.renderers.postButton=function(e){var c=this,f=this.config.get("mode")=="edit";var d=new Echo.UI.Button(e,{normal:{icons:false,disabled:false,label:c.label(f?"update":"post")},posting:{icons:{primary:"ui-icon-waiting"},disabled:true,label:c.label(f?"updating":"posting")}});c.posting=c.posting||{};c.posting.subscriptions=c.posting.subscriptions||[];var b=function(g,i,h){a.each(["Post","Edit"],function(l,j){var k="Submit.on"+j+g;var m=c.posting.subscriptions;if(m[k]){c.unsubscribe(k,m[k]);}m[k]=c.subscribe(k,function(n,o){if(c.config.get("target").get(0)!=o.target){return;}d.setState(i);if(h){h();}});});};b("Init","posting");b("Complete","normal",function(){c.dom.get("text").val("").trigger("blur");c.rerender(["tagsContainer","markersContainer"]);});b("Error","normal");this.posting.action=this.posting.action||function(){var g=false;a.each(["anonymousUserInfoName","text"],function(j,h){g=c.highlightMandatory(c.dom.get(h));return !g;});if(g){return;}c.post();};e.unbind("click",this.posting.action).bind("click",this.posting.action);};Echo.Submit.prototype.post=function(){var k=this,f=this.config.get("mode")=="edit";var d=function(l){return k.dom.get(l);};var c=function(l,m){var n=f?"Edit":"Post";k.publish("Submit.on"+n+l,k.prepareBroadcastParams({postData:m}));};var e;if(f){e=[].concat(k.getContentUpdate(d("text").val()),k.getMetaDataUpdates("tag","tags",d("tags").val()),k.getMetaDataUpdates("mark","markers",d("markers").val()));if(!e.length){c("Complete",[]);return;}}else{e={avatar:k.user.get("avatar",""),content:d("text").val(),markers:a.trim(d("markers").val()),name:k.user.get("name",(k.user.logged()?"":d("anonymousUserInfoName").val())),source:k.config.get("source"),tags:a.trim(d("tags").val()),target:k.config.get("targetURL"),url:k.user.get("domain",(k.user.logged()?"":d("anonymousUserInfoUrl").val())),verb:"post"};}var b;var j=false;var i=function(n){if(b){clearTimeout(b);}if(n.result=="error"){if(j){return;}var l=j=(n.errorCode=="timeout");var m=l?k.label("postingTimeout"):k.label("postingFailed",{error:n.errorMessage||n.errorCode});a.fancybox({content:'<div class="echo-submit-error">'+m+"</div>",height:70,width:l?320:390,padding:15,orig:d("text"),autoDimensions:false,transitionIn:"elastic",transitionOut:"elastic",onComplete:function(){if(a.browser.msie&&document.compatMode!="CSS1Compat"){var o=arguments[2];var p=2*o.padding+40;a("#fancybox-wrap").css({width:o.width+p,height:o.height+p});}}});c("Error",n);}else{c("Complete",e);}};c("Init",e);var h={appkey:k.config.get("appkey"),content:a.object2JSON(e),sessionID:k.user.get("sessionID","")};a.ajax({type:"GET",url:k.config.get("submissionProxyURL"),data:h,success:i,error:function(){i({result:"error",errorCode:"internal_error"});},dataType:"jsonp"});var g=this.config.get("postingTimeout");if(g){b=setTimeout(function(){i({result:"error",errorCode:"timeout"});},g*1000);}};Echo.Submit.prototype.highlightMandatory=function(b){if(b&&!a.trim(b.val())){b.parent().addClass("echo-submit-mandatory");b.focus(function(){a(this).parent().removeClass("echo-submit-mandatory");});return true;}return false;};Echo.Submit.prototype.prepareBroadcastParams=function(b){b=b||{};b.data=this.config.get("data");b.target=this.config.get("target").get(0);b.targetURL=this.config.get("targetURL");b.inReplyTo=this.config.get("inReplyTo");return b;};Echo.Submit.prototype.getContentUpdate=function(b){if(this.config.get("data.object.content","")==b){return[];}return[{verb:"update",field:"content",value:b,target:this.config.get("data.object.id")}];};Echo.Submit.prototype.getMetaDataUpdates=function(i,d,f){var c=this;var e=function(j){return a.map(j||[],function(k){return a.trim(k);});};var b={modified:e(f.split(",")),current:e(this.config.get("data.object."+d,""))};var h=[];var g=function(k,j,l){a.map(k,function(m){if(m&&a.inArray(m,j)==-1){var n={verb:l,target:c.config.get("data.object.id")};n[d]=m;h.push(n);}});};g(b.current,b.modified,"un"+i);g(b.modified,b.current,i);return h;};Echo.Submit.prototype.switchMode=function(c){if(!c){c=(this.config.get("mode")=="standard"?"compact":"standard");}if(this.config.get("mode")!=c){this.config.set("mode",c);this.rerender();var b="Submit.on"+(c=="compact"?"Collapse":"Expand");this.publish(b,this.prepareBroadcastParams());}};Echo.Submit.prototype.refresh=function(){this.rerender(["container","header","markersContainer","tagsContainer","postButton"]);this.publish("Submit.onRerender",this.prepareBroadcastParams());};Echo.Submit.prototype.listenEvents=function(){var b=this;this.subscribe("internal.User.onInvalidate",function(){b.refresh();});if(this.initialMode=="compact"){Echo.Broadcast.subscribe("document.onclick",function(){if(b.dom&&b.dom.get("text").val()){return;}b.switchMode("compact");});if(!Echo.Vars.onClickRegistered){a(document).click(function(){Echo.Broadcast.publish("document.onclick");});Echo.Vars.onClickRegistered=true;}}};Echo.Submit.prototype.addCss=function(){a.addCss(".echo-submit-header { margin-bottom: 3px; }.echo-submit-anonymousUserInfoAvatar { float: left; margin-right: -48px; }.echo-submit-anonymousUserInfoAvatar img { width: 48px; height: 48px; }.echo-submit-anonymousUserInfoFields { width: 100%; float: left; }.echo-submit-anonymousUserInfoFields input { width: 100%; }.echo-submit-anonymousUserInfoFieldsWrapper { margin-left: 53px; }.echo-submit-anonymousUserInfoNameContainer { margin: 1px 0px 4px 0px; padding: 0px 2px 1px 3px; background-color: #fff; }.echo-submit-anonymousUserInfoName { font-size: 14px; font-weight: bold; border: none; }.echo-submit-anonymousUserInfoUrlContainer { padding: 0px 2px 1px 3px; background-color: #fff; }.echo-submit-anonymousUserInfoUrl { height: 19px; border: none; }.echo-submit-author { font-weight: bold; }.echo-submit-content { padding: 5px 5px 5px 6px; background-color: #fff; }.echo-submit-text-area { width: 100%; height: 102px; padding: 0px; margin: 0px; border: none; resize:none ; }.echo-submit-text-input { width: 100%; border: none; }.echo-submit-metadata-container { margin-top: 6px; }.echo-submit-metadata-label { float: left; width: 50px; margin-right: -50px; text-align: right; line-height: 22px; }.echo-submit-metadata-wrapper { float: left; width: 100%; }.echo-submit-metadata-subwrapper { margin-left: 55px; padding: 2px 2px 2px 3px; background-color: #fff; }.echo-submit-metadata-subwrapper input { width: 100%; border: none; }.echo-submit-controls { margin-top: 5px; }.echo-submit-post-container { float: right; }.echo-submit-border { border: 1px solid #d2d2d2; }.echo-submit-mandatory { border: 1px solid red; }.echo-submit-queries-view-option { padding-right: 5px; }.echo-submit-error { color: #444444; font: 14px Arial; line-height: 150%; padding-left: 85px; background: no-repeat url(http://c0.echoenabled.com/images/info70.png); height: 70px; }","submit");if(a.browser.msie){a.addCss(".echo-submit-container { zoom: 1; }.echo-submit-body { zoom: 1; }.echo-submit-header { zoom: 1; }.echo-submit-content { zoom: 1; }.echo-submit-markersContainer { zoom: 1; }.echo-submit-tagsContainer { zoom: 1; }","submit-ie");}if(a.browser.webkit){a.addCss(".echo-submit-container input, .echo-submit-container textarea { background-position: 0px; }.echo-submit-text-area { outline: none; }.echo-submit-anonymousUserInfoName { outline: none; }.echo-submit-anonymousUserInfoUrl { outline: none; }.echo-submit-metadata-subwrapper input { outline: none; }","submit-webkit");}};})(jQuery);
window.Backplane=window.Backplane||{channelByBus:{},config:{},initialized:false,subscribers:{},awaiting:{since:0,until:0,queue:[]},intervals:{min:1,frequent:5,regular:60,slowdown:120}};Backplane.init=function(a){a=a||{};if(this.initialized||!a.serverBaseURL||!a.busName){return false;}this.initialized=true;this.timers={};this.config=a;this.channelByBus=this.getCookieChannels();this.config.customChannelName=a.channelName;this.config.channelName=this.getChannelName();this.config.serverBaseURL=this.normalizeURL(a.serverBaseURL);this.config.channelID=this.generateChannelID();this.request();return true;};Backplane.subscribe=function(b){if(!this.initialized){return false;}var a=(new Date()).valueOf()+Math.random();this.subscribers[a]=b;return a;};Backplane.unsubscribe=function(a){if(!this.initialized||!a){return false;}delete this.subscribers[a];};Backplane.getChannelID=function(){if(!this.initialized){return false;}return this.config.channelID;};Backplane.expectMessages=function(a){this.expectMessagesWithin(60,a);};Backplane.expectMessagesWithin=function(a,b){if(!this.initialized||!a){return false;}this.awaiting.since=this.getTS();this.awaiting.interval=a;this.awaiting.nonstop=!b;if(b){b=typeof b=="string"?[b]:b;this.awaiting.queue.push(b);}var c=this.awaiting.since+a;if(c>this.awaiting.until){this.awaiting.until=c;}this.request();};Backplane.generateChannelID=function(){return this.config.serverBaseURL+"/bus/"+this.config.busName+"/channel/"+this.config.channelName;};Backplane.getChannelName=function(){if(!this.initialized){return false;}if(this.config.customChannelName){return this.config.customChannelName;}if(!this.channelByBus[this.config.busName]){this.channelByBus[this.config.busName]=(new Date()).valueOf().toString()+Math.random().toString().substr(2,5);this.setCookieChannels();}return this.channelByBus[this.config.busName];};Backplane.getTS=function(){return Math.round((new Date()).valueOf()/1000);};Backplane.getCookieChannels=function(){var c=(document.cookie||"").match(/backplane-channel=(.*?)(?:$|;)/);if(!c||!c[1]){return{};}var b={};var e=c[1].split("|");for(var d=0;d<e.length;d++){var a=e[d].split(":");b[decodeURIComponent(a[0])]=decodeURIComponent(a[1]);}return b;};Backplane.setCookieChannels=function(){var b=[];for(var a in this.channelByBus){if(this.channelByBus.hasOwnProperty(a)){b.push(encodeURIComponent(a)+":"+encodeURIComponent(this.channelByBus[a]));}}var c=new Date();c.setFullYear(c.getFullYear()+5);document.cookie="backplane-channel="+b.join("|")+";expires="+c.toGMTString()+";path=/";};Backplane.resetCookieChannel=function(){delete this.channelByBus[this.config.busName];this.setCookieChannels();this.config.channelName=this.getChannelName();this.config.channelID=this.generateChannelID();};Backplane.normalizeURL=function(a){return a.replace(/^\s*(https?:\/\/)?(.*?)[\s\/]*$/,function(b,d,c){return(d||window.location.protocol+"//")+c;});};Backplane.calcTimeout=function(){var d,b=this.getTS();if(b<this.awaiting.until){if(!this.awaiting.nonstop&&!this.awaiting.queue.length){this.awaiting.until=b;return this.calcTimeout();}var c=b-this.awaiting.since;var a=this.intervals.frequent-this.intervals.min;d=this.intervals.min+Math.round(a*c/this.awaiting.interval);}else{if(b<this.awaiting.until+this.intervals.slowdown){var c=b-this.awaiting.until;var a=this.intervals.regular-this.intervals.frequent;d=this.intervals.frequent+Math.round(a*c/this.intervals.slowdown);}else{d=typeof this.since=="undefined"?0:this.intervals.regular;this.awaiting.nonstop=false;}}return d*1000;};Backplane.request=function(){var a=this;if(!this.initialized){return false;}this.stopTimer("regular");this.stopTimer("watchdog");this.timers.regular=setTimeout(function(){a.timers.watchdog=setTimeout(function(){a.request();},5000);var c=document.createElement("script");c.type="text/javascript";c.charset="utf-8";c.src=a.config.channelID+"?callback=Backplane.response"+(a.since?"&since="+encodeURIComponent(a.since):"")+"&rnd="+Math.random();var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(c,b.firstChild);c.onload=c.onreadystatechange=function(){var d=c.readyState;if(!d||d==="loaded"||d==="complete"){c.onload=c.onreadystatechange=null;if(c.parentNode){c.parentNode.removeChild(c);}}};},this.calcTimeout());};Backplane.response=function(d){var m=this;this.stopTimer("watchdog");d=d||[];var h=d.length?d[d.length-1].id:this.since;if(typeof this.since=="undefined"){d=[];}this.since=h||"";for(var f=0;f<d.length;f++){for(var e in this.subscribers){if(this.subscribers.hasOwnProperty(e)){this.subscribers[e](d[f].message);}}var g=[];for(var c=0;c<this.awaiting.queue.length;c++){var a=false;for(var b=0;b<this.awaiting.queue[c].length;b++){if(this.awaiting.queue[c][b]==d[f].message.type){a=true;}}if(!a){g.push(this.awaiting.queue[c]);}}this.awaiting.queue=g;}this.request();};Backplane.stopTimer=function(a){var b=this.timers[a];if(b){clearTimeout(b);}};
(function(b){var a=Echo.createPlugin({name:"Curation",applications:["Stream"],dependencies:[{application:"QueryPalette",url:"//cdn.echoenabled.com/clientapps/v2.6.4/curation.js"}],init:function(d,c){d.set(c,"queue",[]);d.addCss(d.assembleCss());d.extendRenderer("Item","status",d.renderers.Item.status);d.extendRenderer("Item","statusIcon",d.renderers.Item.statusIcon);d.extendRenderer("Item","statusCheckbox",d.renderers.Item.statusCheckbox);d.extendTemplate("Item",d.statusItemTemplate,"insertAfter","echo-item-avatar");d.extendRenderer("Stream","curate",d.renderers.Stream.curate);d.extendTemplate("Stream",d.curateStreamTemplate,"insertAsFirstChild","echo-stream-header");d.listenEvents(c);d.addItemControl(c,d.assembleControl("Approve",c));d.addItemControl(c,d.assembleControl("Spam",c));d.addItemControl(c,d.assembleControl("Delete",c));}});a.statusItemTemplate='<div class="echo-item-status"><input type="checkbox" class="echo-item-statusCheckbox"><div class="echo-item-statusIcon"></div><div class="echo-clear"></div></div>';a.curateStreamTemplate='<div class="echo-stream-curate echo-linkColor"></div>',a.addLabels({approveControl:"Approve",deleteControl:"Delete",spamControl:"Spam",changingStatusToCommunityFlagged:"Flagging...",changingStatusToModeratorApproved:"Approving...",changingStatusToModeratorDeleted:"Deleting...",changingStatusToModeratorFlagged:"Marking as spam...",queries:"Queries",actions:"Actions",curate:"Curate",curation:"Curation",statusCommunityFlagged:"Flagged by Community",statusModeratorApproved:"Approved by Moderator",statusModeratorDeleted:"Deleted by Moderator",statusModeratorFlagged:"Flagged by Moderator",statusSystemFlagged:"Flagged by System",statusUntouched:"New"});a.statuses=["Untouched","ModeratorApproved","ModeratorDeleted","CommunityFlagged","ModeratorFlagged","SystemFlagged"];a.control2status={Spam:"ModeratorFlagged",Delete:"ModeratorDeleted",Approve:"ModeratorApproved"};a.renderers={Item:{},Stream:{}};a.renderers.Item.status=function(d){var e=this;if(!e.user.isAdmin()){d.hide();return;}if(e.depth){d.addClass("echo-item-status-child");}var c=e.data.object.status||"Untouched";d.addClass("echo-item-status-"+c);};a.renderers.Item.statusIcon=function(d){var e=this;if(!e.user.isAdmin()){return;}var c=e.data.object.status||"Untouched";var f=a.label("status"+c);d.addClass("echo-item-status-icon-"+c).attr("title",f);};a.renderers.Item.statusCheckbox=function(c){var d=this;if(!d.user.isAdmin()){return;}c.click(function(){a.set(d,"selected",!a.get(d,"selected"));d.publish(a.topic("internal.Item","onSelect"),{item:d});}).attr("checked",a.get(d,"selected"));};a.renderers.Stream.curate=function(c,e){var d=this;if(!d.user.isAdmin()||!Echo.QueryPalette){c.hide();return;}c.empty().append('<span class="echo-stream-curate-label">'+a.label("curate")+"</span>").show().click(function(){a.assembleDialog(d);a.get(d,"dialog").open();});};a.extractURI=function(c){var d=c.match(/(?:url|scope|childrenof):(\S+)(?: |$)/);return d?d[1]:window.location.protocol+"//"+window.location.host+"/*";};a.assembleDialog=function(e){if(a.get(e,"dialog")){return;}var d=function(h){var g=a.assembleConfig(e,{target:h,query:{path:a.extractURI(e.config.get("query")),states:["Untouched","SystemFlagged","CommunityFlagged","ModeratorFlagged"],itemsPerPage:e.config.get("itemsPerPage"),sortOrder:e.config.get("sortOrder")}});a.set(e,"palette",new Echo.QueryPalette(g));a.subscribe(e,"QueryPalette.onApply",function(i,j){e.config.set("query",j.query);e.refresh();});};var c=function(h){var g=a.assembleConfig(e,{target:h,data:{items:a.get(e,"queue")}});a.set(e,"bulk",new Echo.BulkActions(g));};var f=function(g){a.set(e,"tabs",new Echo.UI.Tabs({target:b(g),content:b(g),addUIClass:false,idPrefix:"curation-tabs-",tabs:[{id:"queries",label:a.label("queries"),icon:true,content:d},{id:"actions",label:a.label("actions"),icon:true,content:c}]}));};a.set(e,"dialog",new Echo.UI.Dialog({content:f,hasTabs:true,config:{autoOpen:false,open:function(){a.get(e,"palette").refresh();},title:a.label("curation"),width:500,height:550,minWidth:450,minHeight:415,maxHeight:600}}));};a.listenEvents=function(c){a.subscribe(c,c.namespace+".onRerender",function(){c.rerender("curate");});a.subscribe(c,a.topic("internal.Item","onSelect"),function(f,h){var e=h.item;if(a.get(e,"selected")){a.get(c,"queue").push(e);a.assembleDialog(c);a.get(c,"dialog").open();a.get(c,"tabs").select("actions");}else{var d=a.get(c,"queue");a.set(c,"queue",b.foldl([],d,function(i,j){if(i.data.unique!=e.data.unique){j.push(i);}}));}if(a.get(c,"bulk")){a.get(c,"bulk").refresh(a.get(c,"queue"));}var g=a.get(e,"selected")?"Select":"Unselect";a.publish(c,a.topic(c.namespace+".Item","on"+g),c.prepareBroadcastParams({item:{data:e.data,target:e.dom.content}}));});a.subscribe(c,"BulkActions.onStatusChange",function(e,f){var d=[];b.each(a.get(c,"queue"),function(h,j){j.block(a.label("changingStatusTo"+f.state));a.set(j,"selected",false);d.push(j);});a.set(c,"queue",[]);if(a.get(c,"bulk")){a.get(c,"bulk").refresh([]);}if(!d.length){return;}var g=b.map(d,function(h){return{verb:"update",target:h.id,author:h.data.actor.id,field:"state",value:f.state};});b.sendPostRequest(a.config.get(c,"submissionProxyURL","",true),{appkey:c.config.get("appkey"),content:b.object2JSON(g),sessionID:c.user.get("sessionID","")},function(){c.startLiveUpdates(true);});});};a.changeItemStatus=function(d,c){a.set(d,"selected",false);d.data.object.status=c;d.rerender("controls");d.rerender("status",true);};a.assembleControl=function(d,c){var e=function(){var g=this;var f=a.control2status[d];g.block(a.label("changingStatusTo"+f));b.get(a.config.get(c,"submissionProxyURL","",true),{appkey:c.config.get("appkey"),content:b.object2JSON({verb:"update",target:g.id,author:g.data.actor.id,field:"state",value:f}),sessionID:g.user.get("sessionID","")},function(h){if(h.result=="error"){g.unblock();}else{a.changeItemStatus(g,f);c.startLiveUpdates(true);}},"jsonp");};return function(){var f=this;return{name:d,label:a.label(d.toLowerCase()+"Control"),visible:f.user.isAdmin()&&f.data.object.status!=a.control2status[d],callback:e};};};a.assembleCss=function(){var c="";if(b.browser.msie){c=".echo-item-status { zoom: 1; }.echo-item-statusCheckbox { margin: 1px; }";}return'.echo-item-status { width: 48px; height: 24px; }.echo-item-status-child { width: 24px; height: 48px; }.echo-item-statusCheckbox { float: left; margin: 4px; }.echo-item-status-child .echo-item-statusCheckbox { display: block; }.echo-item-statusIcon { float: right; margin: 4px; width: 16px; height: 16px; }.echo-item-status-Untouched { background: #00aaff; }.echo-item-status-ModeratorApproved { background: #bdfb6d; }.echo-item-status-ModeratorDeleted { background: #f20202; }.echo-item-status-SystemFlagged, .echo-item-status-CommunityFlagged, .echo-item-status-ModeratorFlagged { background: #ff9e00; }.echo-stream-curate { float: right; margin-left: 15px; cursor: pointer; font-family: Arial; font-size: 11px; }.echo-curation-tabs-queries span { background: no-repeat center left url("//c0.echoenabled.com/images/curation/tabs/queries.png"); }.echo-curation-tabs-actions span { background: no-repeat center left url("//c0.echoenabled.com/images/curation/tabs/actions.png"); }'+b.map(a.statuses,function(d){return".echo-item-status-icon-"+d+'{ background: url("//c0.echoenabled.com/images/curation/status/'+d.toLowerCase()+'.png") no-repeat; }';}).join("")+c;};})(jQuery);
(function(b){var a=Echo.createPlugin({name:"UserBan",applications:["Stream"],init:function(d,c){d.addItemControl(c,d.assembleControl("Ban",c));d.addItemControl(c,d.assembleControl("Unban",c));d.addCss(d.css);}});a.addLabels({banUser:"Ban User",unbanUser:"Unban",userBanned:"Banned User",processingAction:"Setting up '{state}' user state..."});a.controlLabels={banned:'<span class="echo-item-control-state echo-item-control-state-banned">'+a.label("userBanned")+'</span>(<span class="echo-clickable">'+a.label("unbanUser")+"</span>)",unbanned:'<span class="echo-clickable">'+a.label("banUser")+"</span>"};a.assembleControl=function(d,c){var e=function(){var f=this;var g=d=="Ban"?"ModeratorBanned":"Untouched";f.controls[a.name+"."+d].element.empty().append(a.label("processingAction",{state:g}));b.get(a.config.get(c,"submissionProxyURL","",true),{appkey:c.config.get("appkey"),content:b.object2JSON({endpoint:"users/update",field:"state",value:g,identityURL:f.data.actor.id,username:f.data.actor.title}),sessionID:c.user.get("sessionID","")},function(h){if(!h||h.result=="error"){f.rerender();return;}b.map(c.threads,function(i){i.traverse(i.children,function(j){a.applyUserStateUpdate(j,f,g);});a.applyUserStateUpdate(i,f,g);});},"jsonp");};return function(){var g=this;var f=a.isUserBanned(g);var h=g.data.actor.id!=g.user.get("fakeIdentityURL")&&f^(d=="Ban");return{name:d,label:a.controlLabels[f?"banned":"unbanned"],visible:h&&g.user.isAdmin(),callback:e,onetime:true};};};a.applyUserStateUpdate=function(e,d,c){if(e.data.actor.id!=d.data.actor.id){return;}e.data.actor.status=c;e.rerender();};a.isUserBanned=function(c){return c.data.actor.status=="ModeratorBanned";};a.css=".echo-item-control-state { margin-right: 3px; }.echo-item-control-state-banned { color: #FF0000; }";})(jQuery);
(function(a){if(typeof(a._$)!="undefined"){a.noConflict();}if(!window.Echo){window.Echo={};}if(!Echo.Global){Echo.Global={};}if(!Echo.Vars){Echo.Vars={regexps:{matchLabel:/{Label:([^:}]+[^}]*)}/g,matchData:/{Data:(([a-z]+\.)*[a-z]+)}/ig,mobileUA:/mobile|midp-|opera mini|iphone|ipad|blackberry|nokia|samsung|docomo|symbian|windows ce|windows phone|android|up\.browser|ipod|netfront|skyfire|palm|webos|audiovox/i,parseUrl:/^((([^:\/\?#]+):)?\/\/)?([^\/\?#]*)?([^\?#]*)(\?([^#]*))?(#(.*))?/,w3cdtf:/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z$/}};}a.extend({addCss:function(d,f){Echo.Vars.css=Echo.Vars.css||{index:1,processed:{}};if(f){if(Echo.Vars.css.processed[f]){return;}Echo.Vars.css.processed[f]=true;}var c="";var b=Echo.Vars.css.anchor;if(b&&b.length){c=b.html();}if(c.length+d.length>100000){Echo.Vars.css.index++;b=null;c="";}var e=a('<style id="echo-css-'+Echo.Vars.css.index+'" type="text/css">'+c+d+"</style>");if(b&&b.length){b.replaceWith(e);}else{if(Echo.Vars.css.anchor){Echo.Vars.css.anchor.after(e);}else{a(document.getElementsByTagName("head")[0]||document.documentElement).prepend(e);}}Echo.Vars.css.anchor=e;},foldl:function(c,b,d){a.each(b,function(e,f){result=d(f,c,e);if(result!==undefined){c=result;}});return c;},intersperse:function(b,c){return a.foldl([],b,function(e,f,d){if(f.length){f.push(c);}f.push(e);});},getNestedValue:function(b,f,g,h){if(typeof b=="string"){b=b.split(/\./);}if(!b.length){return f;}var e=true;var c=function(j,i){if(h){h(i,j);}if(typeof i[j]=="undefined"){e=false;}else{return i[j];}};var d=b.length==1?c(b.pop(),f):a.foldl(f,b,c);return e?d:g;},setNestedValue:function(g,b,e){var c=b.split(/\./);var f=c.pop();var d=a.getNestedValue(c,g,undefined,function(i,h){if(typeof i[h]=="undefined"){i[h]={};}});d[f]=e;},htmlize:function(b){if(!b){return"";}return a("<div>").text(b).html();},object2JSON:function(f){var d=function(g){var h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return g.replace(/[\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff\\]/g,function(i){return(h.hasOwnProperty(i))?h[i]:"\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4);});};var c;switch(typeof f){case"number":c=isFinite(f)?f:"null";break;case"string":c='"'+d(f)+'"';break;case"boolean":c='"'+f.toString()+'"';break;default:if(f instanceof Array){var b=a.map(f,function(g){return a.object2JSON(g);});c="["+b.join(",")+"]";}else{if(f instanceof Object){var e=f.exportProperties||f;var b=a.foldl([],e,function(i,h,g){if(e instanceof Array){g=i;i=f[g];}h.push('"'+g+'":'+a.object2JSON(i));});c="{"+b.join(",")+"}";}else{c="null";}}}return c;},htmlTextTruncate:function(o,e,n,g){if(!e||o.length<e){return o;}var q=[],j=0,h=0;var m="br hr input img area param base link meta option".split(" ");var c=a.foldl({},m,function(s,r,i){r[s]=true;});for(var f=0;f<o.length;f++){var d=o.charAt(f);if(d=="<"){var l=o.indexOf(">",f);if(l<0){return o;}var b=o.substring(f+1,l);var p={name:"",closing:false};if(b.charAt(0)=="/"){p.closing=true;b=b.substring(1);}p.name=b.match(/(\w)+/)[0];if(p.closing){var k=q.pop();if(!k||k.name!=p.name){return o;}}else{if(!c[p.name]){q.push(p);}}f=l;}else{if(d=="&"&&o.substring(f).match(/^(\S)+;/)){f=o.indexOf(";",f);}else{if(j==e){h=f;break;}j++;}}}if(h||g){if(h){o=o.substring(0,h)+(n||"");}for(var f=q.length-1;f>=0;f--){o+="</"+q[f].name+">";}}return o;},mapClass2Object:function(c,b){b=b||{};c.find("*").andSelf().each(function(e,f){if(f.className){var d=f.className.split(/[ ]+/);a.each(d,function(g,h){b[h]=f;});}});return b;},stripTags:function(b){return a("<div>").html(b).text();},parseUrl:function(b){var c=b.match(Echo.Vars.regexps.parseUrl);return c?{scheme:c[3],domain:c[4],path:c[5],query:c[7],fragment:c[9]}:undefined;},toDOM:function(c,g,f){var d=a(c);var e=a.mapClass2Object(d);var h={set:function(i,j){e[g+i]=j;},get:function(i,k){var j=e[(k?"":g)+i];return j&&a(j);},remove:function(j){var i;if(typeof j=="string"){i=g+j;}else{i=j.echo.name;}a(e[i]).remove();delete e[i];},content:d};var b;if(typeof f=="object"){b=function(i,j,k){if(!f[i]){return;}return f[i](j,k);};}else{b=f;}a.each(e,function(m,j){var l=m.match(g+"(.*)");var i=l?l[1]:undefined;if(i&&b){j=a(j);j.echo=j.echo||{};j.echo.name=m;var k=b(i,j,h);if(typeof k!="undefined"){j.empty().append(k);}}});return h;},loadScriptContent:function(d,f){Echo.Vars.scriptState=Echo.Vars.scriptState||{};if(Echo.Vars.scriptState[d]=="loaded"){f();return;}var e=Echo.Broadcast.subscribe("internal.scriptLoaded",function(g,h){if(d!=h){return;}Echo.Broadcast.unsubscribe("internal.scriptLoaded",e);f();});if(Echo.Vars.scriptState[d]=="loading"){return;}Echo.Vars.scriptState[d]="loading";var c=document.createElement("script");c.type="text/javascript";c.charset="utf-8";c.src=d;var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(c,b.firstChild);c.onload=c.onreadystatechange=function(){var g=c.readyState;if(!g||g=="loaded"||g=="complete"){Echo.Vars.scriptState[d]="loaded";Echo.Broadcast.publish("internal.scriptLoaded",d);c.onload=c.onreadystatechange=null;}};},sendPostRequest:function(c,e,g){var f="echo-post-"+Math.random();var b=a("#echo-post-request").length?a("#echo-post-request").empty():a('<div id="echo-post-request"/>').css({height:0}).prependTo("body");a('<iframe id="'+f+'" name="'+f+'" width="0" height="0" frameborder="0" border="0"></iframe>').appendTo(b);var d=a("<form/>",{target:f,method:"POST",enctype:"application/x-www-form-urlencoded",acceptCharset:"UTF-8",action:c}).appendTo(b);a.each(e,function(h,i){a("<input/>",{type:"hidden",name:h,value:i}).appendTo(d);});d.submit();g();},getVisibleColor:function(c){var b;do{b=c.css("backgroundColor");if(b!=""&&b!="transparent"&&!/rgba\(0, 0, 0, 0\)/.test(b)||a.nodeName(c.get(0),"body")){break;}}while(c=c.parent());return b||"transparent";},timestampFromW3CDTF:function(b){var e=["year","month","day","hours","minutes","seconds"];var c={};var d=b.match(Echo.Vars.regexps.w3cdtf);a.each(e,function(f,g){c[g]=d[f+1];});return Date.UTC(c.year,c.month-1,c.day,c.hours,c.minutes,c.seconds)/1000;},isMobileDevice:function(){return Echo.Vars.regexps.mobileUA.test(navigator.userAgent);}});if(!Echo.Plugins){Echo.Plugins={};}Echo.isExtended=function(b,d,c){if(!b){return false;}c=c||true;var e=[b].concat(d).join(".");Echo.Vars.extensions=Echo.Vars.extensions||{};if(Echo.Vars.extensions[e]==c){return true;}Echo.Vars.extensions[e]=c;return false;};Echo.extendRenderer=function(b,f,d,c){if(!b||!Echo[b]||!f||!d||!a.isFunction(d)||Echo.isExtended(c,[b,"renderer",f])){return;}var e=Echo[b].prototype.renderers[f]||function(){};Echo[b].prototype.renderers[f]=function(){var h=c&&this.config.get("plugins."+c);if(!h||!h.enabled){return e.apply(this,arguments);}var g=this;if(!this.parentRenderer){this.parentRenderer=function(j,i){return g.parentRenderers[j].apply(g,i);};}this.parentRenderers=this.parentRenderers||{};this.parentRenderers[f]=e;return d.apply(this,arguments);};};Echo.extendTemplate=function(c,e,i,b,h){if(!c||!Echo[c]||!i||!b||!e||Echo.isExtended(h,[c,"template",b,i],e)){return;}var g=Echo[c].prototype.template;var f=a.isFunction(g)?g:function(){return g;};var d={insertBefore:"before",insertAfter:"after",insertAsFirstChild:"prepend",insertAsLastChild:"append",replace:"replaceWith"};Echo[c].prototype.template=function(){var j=h&&this.config.get("plugins."+h);if(!j||!j.enabled){return f.call(this);}var k=a("<div/>").html(f.call(this));a("."+b,k)[d[i]](e);return k.html();};};Echo.include=function(b,d){if(!b.length){return d();}var c=b.pop();Echo.include(b,function(){if(typeof c.loaded=="undefined"){if(c.application){c.loaded=function(){return !!Echo[c.application];};}else{d();}}if(a.isFunction(c.loaded)&&!c.loaded()){a.loadScriptContent(c.url,d);}else{d();}});};Echo.createPlugin=function(c){if(!c||!c.name||!c.init||!c.applications){return{};}var b=c.name;var e=function(){var f=function(g){return"plugins."+b+(g?"."+g:"");};f.get=function(g,h,i,j){return g.config.get(f(h),j?g.config.get(h,i):i);};f.set=function(g,h,i){g.config.set(f(h),i);};f.remove=function(g,h){g.config.remove(f(h));};return f;};var d=c.init||function(){};Echo.Plugins[b]=Echo.Plugins[b]||a.extend(c,{init:function(h,g){var f=h.config.get(g,"enabled");if(typeof f=="undefined"){h.config.set(g,"enabled",true);}d(h,g);},set:function(f,g,h){f.vars=f.vars||{};f.vars[b]=f.vars[b]||{};a.setNestedValue(f.vars[b],g,h);},get:function(f,g){var h=(f.vars||{})[b]||{};if(!g){return h;}return a.getNestedValue(g,h);},addCss:function(f){a.addCss(f,"plugins-"+b);},label:function(f,g){return Echo.Localization.label(f,"Plugins."+b,g);},addLabels:function(f){Echo.Localization.extend(f,"Plugins."+b);},topic:function(h,g){var f=typeof h=="string"?h:h.namespace;return f+".Plugins."+b+"."+g;},config:e(),subscribe:function(h,g,i){var f=this;return h.subscribe(g,function(){if(!h.isPluginEnabled(f.name)){return;}i.apply(this,arguments);});},publish:function(g,f,h){g.publish(f,h);},unsubscribe:function(g,f,h){g.unsubscribe(f,h);},extendRenderer:function(f,h,g){Echo.extendRenderer(f,h,g,b);},extendTemplate:function(g,h,i,f){Echo.extendTemplate(g,h,i,f,b);},addItemControl:function(g,h){var f=g.config.get("itemControls."+b,[]);g.config.set("itemControls."+b,f.concat(h));},assembleConfig:function(f,g){g.user=f.user;g.appkey=f.config.get("appkey","");g.plugins=this.config.get(f,"nestedPlugins",[]);g.contextId=f.config.get("contextId");g.apiBaseURL=f.config.get("apiBaseURL");return(new Echo.Config(g,this.config.get(f))).getAsHash();}});return Echo.Plugins[b];};if(!Echo.Broadcast){Echo.Broadcast={};}Echo.Broadcast.initContext=function(c,b){b=b||"empty";Echo.Vars.subscriptions=Echo.Vars.subscriptions||{};Echo.Vars.subscriptions[b]=Echo.Vars.subscriptions[b]||{};Echo.Vars.subscriptions[b][c]=Echo.Vars.subscriptions[b][c]||{};return b;};Echo.Broadcast.subscribe=function(c,d,b){var e=(new Date()).valueOf()+Math.random();b=Echo.Broadcast.initContext(c,b);Echo.Vars.subscriptions[b][c][e]=d;return e;};Echo.Broadcast.unsubscribe=function(c,d,b){b=Echo.Broadcast.initContext(c,b);if(c&&d){delete Echo.Vars.subscriptions[b][c][d];}else{if(c){delete Echo.Vars.subscriptions[b][c];}}};Echo.Broadcast.publish=function(c,d,b){b=Echo.Broadcast.initContext(c,b);if(b=="*"){a.each(Echo.Vars.subscriptions,function(e){a.each(Echo.Vars.subscriptions[e][c]||{},function(g,f){f.apply(this,[c,d]);});});}else{if(Echo.Vars.subscriptions[b][c]){a.each(Echo.Vars.subscriptions[b][c],function(f,e){e.apply(this,[c,d]);});}if(b!="empty"){Echo.Broadcast.publish(c,d,"empty");}}};if(!Echo.Object){Echo.Object=function(){};}Echo.Object.prototype.init=function(b){a.extend(this,b||{});};Echo.Object.prototype.template="";Echo.Object.prototype.namespace="";Echo.Object.prototype.cssPrefix="echo-";Echo.Object.prototype.substitute=function(c,d){var b=this;c=c.replace(Echo.Vars.regexps.matchLabel,function(f,e){return b.label(e);});c=c.replace(Echo.Vars.regexps.matchData,function(f,e){return a.getNestedValue(e,d,"");});return c;};Echo.Object.prototype.renderers={};Echo.Object.prototype.label=function(c,d){var b=Echo.Localization.label(c,this.namespace,d);return b!=c?b:Echo.Localization.label(c,"",d);};Echo.Object.prototype.render=function(d,e,g,b){var c=this;if(d){if(a.isFunction(this.renderers[d])){return this.renderers[d].call(this,e,g,b);}}else{var f=a.isFunction(this.template)?this.template():this.template;this.dom=a.toDOM(this.substitute(f,this.data||{}),this.cssPrefix,function(){return c.render.apply(c,arguments);});return this.dom.content;}};Echo.Object.prototype.rerender=function(b,d){var j=this;if(!b){if(this.dom){this.dom.content.replaceWith(this.render());}return;}if(!this.dom){return;}if(typeof b!="string"){a.map(b,function(k){j.rerender(k,d);});return;}else{if(!this.dom.get(b)){return;}}if(d){var i=a.isFunction(this.template)?this.template():this.template;var g=this.substitute(i,this.data||{});var e=this.dom.get(b);var h=a("."+this.cssPrefix+b,a(g));h=a.toDOM(h,this.cssPrefix,function(k,l,m){j.dom.set(k,l);return j.render.apply(j,arguments);}).content;e.replaceWith(h);}else{var f=this.dom.get(b);var c=this.renderers[b].call(this,f,this.dom);if(typeof c!="undefined"){f.empty().append(c);}}};Echo.Object.prototype.hyperlink=function(e,d){d=d||{};if(d.openInNewWindow&&!e.target){e.target="_blank";}var c=e.caption||"";delete e.caption;if(!d.skipEscaping){e.href=a.htmlize(e.href);}e.href=e.href||"javascript:void(0)";var b=a.foldl([],e,function(h,g,f){g.push(f+'="'+h+'"');});return"<a "+b.join(" ")+">"+c+"</a>";};Echo.Object.prototype.newContextId=function(){return(new Date()).valueOf()+Math.random();};Echo.Object.prototype.getContextId=function(){return this.config&&this.config.get("contextId");};Echo.Object.prototype.subscribe=function(b,c){return Echo.Broadcast.subscribe(b,c,this.getContextId());};Echo.Object.prototype.unsubscribe=function(b,c){Echo.Broadcast.unsubscribe(b,c,this.getContextId());};Echo.Object.prototype.publish=function(b,c){Echo.Broadcast.publish(b,c,this.getContextId());};Echo.Object.prototype.clearCache=function(){if(this.vars&&this.vars.cache){this.vars.cache={};}};Echo.Application=function(){this.addCss();};Echo.Application.prototype=new Echo.Object();Echo.Application.prototype.errorMessages={error_busy:"Loading. Please wait...",error_timeout:"Loading. Please wait...",error_waiting:"Loading. Please wait...",error_result_too_large:"(result_too_large) The search result is too large.",error_wrong_query:"(wrong_query) Incorrect or missing query parameter.",error_incorrect_appkey:"(incorrect_appkey) Incorrect or missing appkey.",error_internal_error:"(internal_error) Unknown server error.",error_quota_exceeded:"(quota_exceeded) Required more quota than is available.",error_incorrect_user_id:"(incorrect_user_id) Incorrect user specified in User ID predicate.",error_unknown:"(unknown) Unknown error."};Echo.Application.prototype.initApplication=function(d){var b=this;var c=this.config.get("appkey");if(!c){this.showMessage({type:"error",message:"Incorrect or missing mandatory parameter appkey"});return;}this.config.get("target").addClass("echo-ui");this.user=this.config.get("user")||new Echo.User({appkey:c,apiBaseURL:this.config.get("apiBaseURL"),contextId:this.config.get("contextId")});this.user.init(function(){b.initPlugins(d);});Echo.Localization.extend(this.errorMessages);};Echo.Application.prototype.messageTemplates={compact:'<span class="echo-application-message-icon echo-application-message-{Data:type}" title="{Data:message}"></span>',"default":'<div class="echo-application-message"><span class="echo-application-message-icon echo-application-message-{Data:type} echo-primaryFont">{Data:message}</span></div>'};Echo.Application.prototype.showMessage=function(c,d){if(!this.config.get("debug")&&c.type=="error"){return;}var b=this.messageTemplates[c.layout||this.messageLayout||"default"];(d||this.config.get("target")).empty().append(this.substitute(b,c));};Echo.Application.prototype.isWaitingForData=function(b){return b&&(b.errorCode=="waiting"||b.errorCode=="timeout"||b.errorCode=="busy");};Echo.Application.prototype.handleErrorResponse=function(g,d){var b=this;d=d||{};var h=this.config.get("target");var e=function(){if(b.waitingTimeoutStep>0){if(b.waitingTimeoutStep<4){b.waitingTimeoutStep++;}}else{b.waitingTimeoutStep=1;}return Math.round(Math.exp(b.waitingTimeoutStep))*1000;};if(this.error!=g){if(!this.config.get("debug")){h.hide();}else{var c=this.label("error_"+g.errorCode);var f=c=="error_"+g.errorCode?"("+g.errorCode+") "+(g.errorMessage||""):c;h.show();this.showMessage({type:this.isWaitingForData(g)?"loading":"error",message:f},d.messageTarget);}}this.error=g;if(this.isWaitingForData(g)){this.waitingTimer=setTimeout(function(){b.cleanupErrorHandlers();if(d.waitingHandler){d.waitingHandler();}else{b.refresh();}},e());}else{this.waitingTimeoutStep=0;}if(d.callback){d.callback(g);}};Echo.Application.prototype.cleanupErrorHandlers=function(b){if(b){this.waitingTimeoutStep=0;delete this.error;}if(this.waitingTimer){clearTimeout(this.waitingTimer);}};Echo.Application.prototype.initPlugins=function(e){var d=this;var c=this.config.get("pluginsOrder");var b=a.foldl([],c,function(f,h){var g=Echo.Plugins[f];if(g&&g.dependencies&&g.dependencies.length){return h.concat(g.dependencies);}});Echo.include(b,function(){a.map(c,function(f){var g=Echo.Plugins[f];if(g&&g.init&&d.isPluginApplicable(g)){g.init(g,d);}});if(e){e();}});};Echo.Application.prototype.enablePlugin=function(b){this.config.set("plugins."+b+".enabled",true);};Echo.Application.prototype.disablePlugin=function(b){this.config.set("plugins."+b+".enabled",false);};Echo.Application.prototype.isPluginEnabled=function(b){return this.config.get("plugins."+b+".enabled",true);};Echo.Application.prototype.isPluginApplicable=function(d){var c=this,b=false;a.each(d.applications,function(f,e){if(Echo[e]&&c instanceof Echo[e]){b=true;return false;}});return b;};Echo.Application.prototype.initConfig=function(d,e,c){var b={};b.target=function(f){return a(f);};b.plugins=function(g){var f=a.foldl({hash:{},order:[]},g||[],function(h,i){var j=a.inArray(h.name,i.order);if(j>=0){i.order.splice(j,1);}i.order.push(h.name);i.hash[h.name]=h;});this.set("pluginsOrder",f.order);return f.hash;};d=a.extend({plugins:[]},d||{});e=a.extend({appkey:"",apiBaseURL:"http://api.echoenabled.com",liveUpdates:true,liveUpdatesTimeout:10,liveUpdatesTimeoutMin:3,debug:true,contextId:this.newContextId()},e||{});this.config=new Echo.Config(d,e,function(f,h){var g=c&&c[f]||b&&b[f];return g?g.call(this,h):h;});};Echo.Application.prototype.sendAPIRequest=function(b,c){b.query.appkey=this.config.get("appkey");a.get(this.config.get("apiBaseURL")+"/v1/"+b.endpoint,b.query,c,"jsonp");};Echo.Application.prototype.initLiveUpdates=function(d,b){var c=this;this.liveUpdates={originalTimeout:this.config.get("liveUpdatesTimeout"),timers:{},timeouts:[],responseHandler:function(e){if(c.liveUpdates.timers.watchdog){clearTimeout(c.liveUpdates.timers.watchdog);}c.changeLiveUpdatesTimeout(e);b(e);},requestParamsGetter:d};};Echo.Application.prototype.changeLiveUpdatesTimeout=function(h){var d=this;if(typeof h=="string"){h={liveUpdatesTimeout:h};}h.liveUpdatesTimeout=parseInt(h.liveUpdatesTimeout);var c=function(j){if(!j&&d.liveUpdates.originalTimeout!=d.config.get("liveUpdatesTimeout")){d.config.set("liveUpdatesTimeout",d.liveUpdates.originalTimeout);}else{if(j&&j>d.config.get("liveUpdatesTimeout")){d.config.set("liveUpdatesTimeout",j);}}};var b=function(j){return !!(j.entries&&j.entries.length);};if(!this.nextSince){c(h.liveUpdatesTimeout);return;}var f=this.config.get("liveUpdatesTimeout");var i=parseInt(this.nextSince);var e=Math.floor((new Date()).getTime()/1000);var g=b(h)?e-i>f?this.config.get("liveUpdatesTimeoutMin",3):f+1:f+2;if(g>this.liveUpdates.originalTimeout){g=this.liveUpdates.originalTimeout;}this.config.set("liveUpdatesTimeout",g);if(g==this.liveUpdates.originalTimeout){c(h.liveUpdatesTimeout);}};Echo.Application.prototype.stopLiveUpdates=function(){if(this.liveUpdates.timers.regular){clearTimeout(this.liveUpdates.timers.regular);}if(this.liveUpdates.timers.watchdog){clearTimeout(this.liveUpdates.timers.watchdog);}};Echo.Application.prototype.startLiveUpdates=function(d){var b=this;if(!this.liveUpdates||!d&&!this.config.get("liveUpdates")&&!this.liveUpdates.timeouts.length){return;}this.stopLiveUpdates();if(d){this.liveUpdates.timeouts=[0,1,3];}var c=this.liveUpdates.timeouts.length?this.liveUpdates.timeouts.shift():this.config.get("liveUpdatesTimeout");this.liveUpdates.timers.regular=setTimeout(function(){b.liveUpdates.timers.watchdog=setTimeout(function(){b.startLiveUpdates();},5000);b.sendAPIRequest(b.liveUpdates.requestParamsGetter(),b.liveUpdates.responseHandler);},c*1000);};Echo.Application.prototype.addCss=function(){var c="echo-css-fancybox";if(a("#"+c).length){return;}var b=document.getElementsByTagName("head")[0]||document.documentElement;b.insertBefore(a("<link>",{rel:"stylesheet",id:c,type:"text/css",href:"//c0.echoenabled.com/css/fancybox.css"}).get(0),a(b).children().get(0));a.addCss(".echo-application-message { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }.echo-application-message-icon { display: inline-block; height: 16px; padding-left: 16px; background: no-repeat left center; }.echo-application-message .echo-application-message-icon { padding-left: 21px; height: auto; }.echo-application-message-empty { background-image: url(//c0.echoenabled.com/images/information.png); }.echo-application-message-loading { background-image: url(//c0.echoenabled.com/images/loading.gif); }.echo-application-message-error { background-image: url(//c0.echoenabled.com/images/warning.gif); }","application");};Echo.User=function(b){this.data={};this.config=new Echo.Config(b,{appkey:"",apiBaseURL:"http://api.echoenabled.com",contextId:undefined});};Echo.User.prototype.init=function(e){var b=this;this.callback=e||function(){};if(!this.config.get("appkey")||!window.Backplane||!Backplane.getChannelID()){this.set({});this.callback();return;}this.listenEvents();var d=this._global("get","state");if(d=="ready"){this.set(a.extend({},this._global("get","data")));this.callback();}else{var c=Echo.Broadcast.subscribe("User.onInit",function(f,g){if(g.appkey!=b.config.get("appkey")){return;}Echo.Broadcast.unsubscribe("User.onInit",c);b.set(a.extend({},b._global("get","data")));b.callback();});if(d=="init"){this.request();}}};Echo.User.prototype.listenEvents=function(){var b=this;if(this.backplaneSubscriptionID){return;}var c=function(f){var e=(f?"":"internal.")+"User.onInvalidate";var g={data:b.data,appkey:b.config.get("appkey")};var d=f?undefined:b.config.get("contextId");Echo.Broadcast.publish(e,g,d);};this.backplaneSubscriptionID=Backplane.subscribe(function(e){if(e.type=="identity/ack"){var d=false;if(b._global("get","state")=="ready"){d=true;b._global("set","state","init");}b.init(function(){c();if(d){c(true);}});}});};Echo.User.prototype._global=function(e,c,d){var b=this.config.get("appkey");Echo.Vars.users=Echo.Vars.users||{};Echo.Vars.users[b]=Echo.Vars.users[b]||{state:"init",data:{}};if(e=="get"){return Echo.Vars.users[b][c];}Echo.Vars.users[b][c]=d;};Echo.User.prototype.set=function(){if(!arguments.length){return;}if(arguments.length==1&&typeof arguments[0]=="object"){this._global("set","data",arguments[0]);this.data=this.normalize(arguments[0]);this.account=this.assemble();}else{if(arguments.length==2&&typeof arguments[0]=="string"){this.account[arguments[0]]=arguments[1];}}};Echo.User.prototype.get=function(b,c){return(this.account.hasOwnProperty(b)&&typeof this.account[b]!="undefined")?this.account[b]:c;};Echo.User.prototype.logout=function(c){var b=this;a.get(window.location.protocol+"//apps.echoenabled.com/v2/logout",{sessionID:Backplane.getChannelID()},function(d){Backplane.expectMessages("identity/ack");},"jsonp");};Echo.User.prototype.request=function(d){var b=this,c=this.config.get("appkey");this._global("set","state","waiting");a.get(this.config.get("apiBaseURL")+"/v1/users/whoami",{appkey:c,sessionID:Backplane.getChannelID()},function(e){if(e.result&&e.result=="session_not_found"){e={};}b._global("set","state","ready");b.set(a.extend({},e));Echo.Broadcast.publish("User.onInit",{data:e,appkey:c});if(d){d();}},"jsonp");};Echo.User.prototype.normalize=function(c){var b=function(d){return a.foldl({},d||[],function(e,f){f[e]=true;});};c=c||{};c.echo=c.echo||{};a.extend(c,c.echo);c.poco=c.poco||{entry:{}};c.roles=b(c.echo.roles);c.markers=b(c.echo.markers);c.sessionID=window.Backplane&&Backplane.getChannelID()||undefined;c.accounts=c.poco.entry.accounts||[];return c;};Echo.User.prototype.getActiveAccounts=function(){return a.map(this.data.accounts,function(b){if(b.loggedIn=="true"){return b;}});};Echo.User.prototype.assemble=function(){var b=this.getActiveAccounts();var c=b[0]||{};return a.extend(this.data,{id:c.identityUrl||this.data.poco.entry.id||c.userid,name:this.data.poco.entry.displayName||c.username,avatar:a.foldl(undefined,c.photos||[],function(d){if(d.type=="avatar"){return d.value;}}),state:this.data.echo.state||"Untouched",domain:c.domain,logged:!!b.length,defaultAvatar:"//c0.echoenabled.com/images/avatar-default.png",fakeIdentityURL:"http://js-kit.com/ECHO/user/fake_user"});};Echo.User.prototype.hasIdentity=function(c){var b=false;a.each(this.data.accounts,function(d,e){if(e.identityUrl&&e.identityUrl==c){b=true;return false;}});return b;};Echo.User.prototype.hasAny=function(e,c){if(!this.account){return false;}var b=this,d=false;a.each(c,function(f,h){var g=b.get(e,{});if((typeof g=="string"&&g==h)||g[h]){d=true;return false;}});return d;};Echo.User.prototype.hasAnyRole=function(b){return this.hasAny("roles",b);};Echo.User.prototype.isAdmin=function(){return this.hasAny("roles",["administrator","moderator"]);};Echo.User.prototype.logged=function(){return !!(this.account&&this.account.logged);};Echo.Config=function(e,c,d){var b=this;this.normalize=d||function(f,g){return g;};this.data={};this.cache={};if(!c&&!d){this.data=e;}else{a.each(this.combine(e,a.extend({},c)),function(f,g){b.set(f,g);});}};Echo.Config.prototype.get=function(c,d){var b=c;if(typeof b!="string"){b=b.join(".");}if(!this.cache.hasOwnProperty(b)){this.cache[b]=a.getNestedValue(c,this.data);}return typeof this.cache[b]=="undefined"?d:this.cache[b];};Echo.Config.prototype.set=function(b,d){var c=b.split(/\./);delete this.cache[b];if(typeof d=="object"){this.clearCacheByPrefix(b);}return a.setNestedValue(this.data,b,this.normalize(c.pop(),d));};Echo.Config.prototype.remove=function(b){var c=b.split(/\./);var e=c.pop();var d=a.getNestedValue(c,this.data);delete d[e];};Echo.Config.prototype.combine=function(d,c){var b=this;return a.foldl(c,d,function(g,f,e){f[e]=a.isPlainObject(g)&&c.hasOwnProperty(e)?b.combine(g,c[e]):g;});};Echo.Config.prototype.extend=function(b){var c=this;a.each(b,function(d,e){c.set(d,e);});};Echo.Config.prototype.getAsHash=function(){return this.data;};Echo.Config.prototype.clearCacheByPrefix=function(c){var b=this;c+=".";a.each(this.cache,function(d,e){if(!d.indexOf(c)){delete b.cache[d];}});};if(!Echo.UI){Echo.UI={cornersCss:function(b,c){return("{scope}.ui-corner-tl { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; }{scope}.ui-corner-tr { -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }{scope}.ui-corner-bl { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }{scope}.ui-corner-br { -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}-bottom-right-radius: {radius}; }{scope}.ui-corner-top { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }{scope}.ui-corner-bottom { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }{scope}.ui-corner-right {  -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }{scope}.ui-corner-left { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }{scope}.ui-corner-all { -moz-border-radius: {radius}; -webkit-border-radius: {radius}; border-radius: {radius}; }").replace(/{scope}/g,c||"").replace(/{radius}/g,b);}};}(function(){a.addCss('.echo-ui { text-align: left; }.echo-ui .ui-helper-hidden { display: none; }.echo-ui .ui-helper-hidden-accessible { position: absolute; left: -99999999px; }.echo-ui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }.echo-ui .ui-helper-clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }.echo-ui .ui-helper-clearfix { display: inline-block; }/* required comment for clearfix to work in Opera \\*/* html .echo-ui .ui-helper-clearfix { height:1%; }.echo-ui .ui-helper-clearfix { display:block; }/* end clearfix */.echo-ui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }.echo-ui .ui-resizable-handle { position: absolute;font-size: 0.1px;z-index: 99999; display: block;}.echo-ui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }.echo-ui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }.echo-ui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }.echo-ui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }.echo-ui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }.echo-ui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }.echo-ui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }.echo-ui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }.echo-ui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}.echo-ui .ui-state-disabled { cursor: default !important; }.echo-ui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; width: 16px; height: 16px; }.echo-ui .ui-widget-header { font-weight: bold; border: 0px; }.echo-ui, .echo-ui .ui-widget :active { outline: none; }.echo-ui .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }.echo-ui .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-ui .ui-state-default a:visited { color: #555555; text-decoration: none; }.echo-ui .ui-state-hover, .echo-ui .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }.echo-ui .ui-state-hover a, .echo-ui .ui-state-hover a:hover { color: #212121; text-decoration: none; }.echo-ui .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }.echo-ui .ui-state-active a, .echo-ui .ui-state-active a:link, .echo-ui .ui-state-active a:visited { color: #212121; text-decoration: none; }.echo-primaryBackgroundColor {  }.echo-secondaryBackgroundColor { background-color: #F4F4F4; }.echo-trinaryBackgroundColor { background-color: #ECEFF5; }.echo-primaryColor { color: #3A3A3A; }.echo-secondaryColor { color: #C6C6C6; }.echo-primaryFont { font-family: Arial, sans-serif; font-size: 12px; font-weight: normal; line-height: 16px; }.echo-secondaryFont { font-family: Arial, sans-serif; font-size: 11px; }.echo-linkColor, .echo-linkColor a { color: #476CB8; }.echo-clickable { cursor: pointer; }.echo-relative { position: relative; }.echo-clear { clear: both; }',"ui-general");})();if(!Echo.Localization){Echo.Localization={labels:{}};}Echo.Localization.key=function(b,c){return(c?c+".":"")+b;};Echo.Localization.extend=function(c,b){a.each(c,function(d,e){Echo.Localization.labels[Echo.Localization.key(d,b)]=e;});};Echo.Localization.label=function(c,d,e){var b=Echo.Localization.labels[Echo.Localization.key(c,d)]||c;a.each(e||{},function(f,g){b=b.replace(new RegExp("{"+f+"}","g"),g);});return b;};})(jQuery);(function(a){Echo.Localization.extend({edit:"Edit",loading:"Loading...",login:"Login",logout:"Logout",loggingOut:"Logging out...",or:"or",signup:"signup"},"Auth");Echo.Auth=function(c){if(!c||!c.target){return;}var b=this;this.vars={};this.initConfig(c);this.initApplication(function(){b.addCss();b.listenEvents();b.config.get("target").empty().append(b.render());});};Echo.Auth.prototype=new Echo.Application();Echo.Auth.prototype.namespace="Auth";Echo.Auth.prototype.cssPrefix="echo-auth-";Echo.Auth.prototype.renderers={};Echo.Auth.prototype.template=function(){return this.templates[this.user.logged()?"logged":"anonymous"];};Echo.Auth.prototype.templates={};Echo.Auth.prototype.templates.anonymous='<div class="echo-auth-anonymous echo-primaryFont"><span class="echo-auth-login echo-linkColor echo-clickable">{Label:login}</span><span class="echo-auth-or echo-secondaryColor"> {Label:or} </span><span class="echo-auth-signup echo-linkColor echo-clickable">{Label:signup}</span></div>';Echo.Auth.prototype.templates.logged='<div class="echo-auth-logged echo-primaryFont echo-primaryColor"><div class="echo-auth-avatar"></div><div class="echo-auth-name"></div><div class="echo-auth-edit echo-linkColor echo-clickable">{Label:edit}</div><div class="echo-auth-logout echo-linkColor echo-clickable">{Label:logout}</div><div class="echo-clear"></div></div>';Echo.Auth.prototype.renderers.logout=function(c){var b=this;c.click(function(){c.empty().append(b.label("loggingOut"));b.user.logout();});};Echo.Auth.prototype.renderers.login=function(b){this.assembleIdentityControl("login",b);};Echo.Auth.prototype.renderers.edit=function(b){this.assembleIdentityControl("edit",b);};Echo.Auth.prototype.renderers.signup=function(b){this.assembleIdentityControl("signup",b);};Echo.Auth.prototype.renderers.or=function(b){if(!this.config.get("identityManager.login")||!this.config.get("identityManager.signup")||!this.user.get("sessionID")){b.hide();}};Echo.Auth.prototype.renderers.avatar=function(d){var b=this;var c=this.user.get("avatar",this.user.get("defaultAvatar"));d.append(a("<img>",{src:c}).bind({error:function(){a(this).attr("src",b.user.get("defaultAvatar"));}}));};Echo.Auth.prototype.renderers.name=function(b){b.append(this.user.get("name",""));};Echo.Auth.prototype.assembleIdentityControl=function(e,d){var c=this;var f=this.config.get("identityManager."+e);if(!f||!this.user.get("sessionID")){return d.hide();}var b=function(g){var j=encodeURIComponent(c.user.get("sessionID",""));var i=a.parseUrl(g);var h=i.query?i.query.match(/=$/)?j:"&sessionID="+j:"sessionID="+j;return c.substitute("{Data:scheme}://{Data:domain}{Data:path}?{Data:query}{Data:fragment}",{scheme:i.scheme||"http",domain:i.domain,path:i.path,query:(i.query||"")+h,fragment:i.fragment?("#"+i.fragment):""});};if(f.type=="script"){d.click(function(){a.getScript(b(f.url));});}else{d.fancybox({autoScale:false,height:f.height,href:b(f.url),onClosed:function(){if(a.browser.msie&&document.compatMode!="CSS1Compat"){var g=a("#fancybox-overlay").get(0).style;g.removeExpression("height");g.removeExpression("width");}},onComplete:function(){var g=(a.browser.msie&&document.compatMode!="CSS1Compat"?40:0);a("#fancybox-frame").css({width:f.width-g,height:f.height-g});},onStart:function(){Backplane.expectMessages("identity/ack");if(a.browser.msie&&document.compatMode!="CSS1Compat"){var g=a("#fancybox-overlay").get(0).style;g.setExpression("height","Math.max(document.body.clientHeight, document.body.scrollHeight)");g.setExpression("width","Math.max(document.body.clientWidth, document.body.scrollWidth)");}},padding:0,scrolling:"no",transitionIn:"elastic",transitionOut:"elastic",type:"iframe",width:f.width});}};Echo.Auth.prototype.listenEvents=function(){var b=this;this.subscribe("internal.User.onInvalidate",function(){a.fancybox.close();b.rerender();});};Echo.Auth.prototype.addCss=function(){a.addCss(".echo-auth-logout { float: right; }.echo-auth-anonymous { text-align: right; }.echo-auth-avatar { float: left; }.echo-auth-avatar img { width: 24px; height: 24px; }.echo-auth-name { float: left; font-size: 18px; line-height: 24px; margin-left: 5px; font-weight: bold; }.echo-auth-edit { float: left; margin: 6px 0px 0px 12px; }","auth");};})(jQuery);
(function(b){var a=Echo.createPlugin({name:"Like",applications:["Stream","UserList"],dependencies:[{application:"UserList",url:"//cdn.echoenabled.com/clientapps/v2.6.4/user-list.js"}],init:function(d,c){if(c instanceof Echo.Stream){d.extendRenderer("Item","likes",d.renderers.Item.likes);d.extendTemplate("Item",d.templates.likeList,"insertAsLastChild","echo-item-data");d.addItemControl(c,d.assembleControl("Like",c));d.addItemControl(c,d.assembleControl("Unlike",c));d.subscribe(c,d.topic("internal.Item","onUnlike"),function(e,f){d.sendRequest(c,{verb:"unlike",target:f.item.object.id,author:f.actor.id},function(){c.startLiveUpdates(true);});});}else{if(c instanceof Echo.UserList){d.extendRenderer("UserList","container",d.renderers.UserList.container);d.extendRenderer("UserListItem","adminUnlike",d.renderers.UserListItem.adminUnlike);d.extendTemplate("UserListItem",d.templates.adminUnlike,"insertAsLastChild","echo-user-list-item-container");}}d.addCss(d.css);}});a.addLabels({likeThis:" like this.",likesThis:" likes this.",likeControl:"Like",unlikeControl:"Unlike",unlikeOnBehalf:"Unlike on behalf of this user",likeProcessing:"Liking...",unlikeProcessing:"Unliking..."});a.templates={likeList:'<div class="echo-item-likes"></div>',adminUnlike:'<img class="echo-user-list-item-adminUnlike" src="//cdn.echoenabled.com/images/container/closeWindow.png" title="'+a.label("unlikeOnBehalf")+'" width="10" height="9">'};a.sendRequest=function(c,d,e){b.get(a.config.get(c,"submissionProxyURL","",true),{appkey:c.config.get("appkey"),content:b.object2JSON(d),sessionID:c.user.get("sessionID","")},e,"jsonp");};a.assembleControl=function(d,c){var e=function(){var f=this;f.controls[a.name+"."+d].element.empty().append(a.label(d.toLowerCase()+"Processing"));a.sendRequest(c,{verb:d.toLowerCase(),target:f.id},function(){var g=a.topic(c,"on"+d+"Complete");a.publish(c,g,c.prepareBroadcastParams({item:{data:f.data,target:f.dom.content}}));c.startLiveUpdates(true);});};return function(){var f=this;var g=(b.map(f.data.object.likes,function(h){if(f.user.hasIdentity(h.actor.id)){return h;}})).length>0?"Unlike":"Like";return{name:d,label:a.label(d.toLowerCase()+"Control"),visible:f.user.logged()&&g==d,onetime:true,callback:e};};};a.renderers={Item:{},UserList:{},UserListItem:{}};a.renderers.Item.likes=function(f){var k=this;if(!k.data.object.likes.length){f.hide();return;}var h=5;var j=a.get(k,"userList")?a.get(k,"userList").getVisibleUsersCount():h;var i=false;var g=k.user.get("id");var c=k.data.object.likes;b.each(c,function(l,m){if(m.actor.id==g){i=true;return false;}});var d=a.assembleConfig(k,{target:f.get(0),data:{itemsPerPage:h,entries:c},initialUsersCount:j,totalUsersCount:k.data.object.accumulators.likesCount,suffixText:a.label(c.length>1||i?"likeThis":"likesThis")});d.plugins.push({name:"Like"});var e=new Echo.UserList(d);a.set(k,"userList",e);f.show();k.subscribe(a.topic("internal.UserListItem","onUnlike"),function(l,m){if(m.target!=f.get(0)){return;}k.publish(a.topic("internal.Item","onUnlike"),{actor:m.actor,item:k.data});});};a.renderers.UserList.container=function(c){var d=this;d.parentRenderer("container",arguments);if(!d.user.isAdmin()){return;}c.addClass("echo-user-list-highlight");};a.renderers.UserListItem.adminUnlike=function(c){var d=this;if(!d.user.isAdmin()){c.remove();return;}c.one("click",function(){d.dom.get("container").css("opacity",0.3);a.publish(d,a.topic("internal.UserListItem","onUnlike"),{actor:d.data,target:d.config.get("target").get(0)});});};a.css=".echo-item-likes { background: url(//c0.echoenabled.com/images/likes.png) no-repeat 0px 4px; padding: 0px 0px 4px 21px; }.echo-item-likes .echo-user-list-highlight { line-height: 23px; }.echo-item-likes .echo-user-list-highlight .echo-user-list-item-container { display: inline-block; line-height: 16px; background-color: #EEEEEE; padding: 1px 3px; border: 1px solid #D2D2D2; border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px; margin: 0px 2px; }.echo-item-likes .echo-user-list-highlight .echo-user-list-delimiter { display: none; }.echo-item-likes .echo-user-list-item-adminUnlike { cursor: pointer; margin-left: 3px; }"+(b.browser.msie?".echo-item-likes .echo-user-list-highlight span { vertical-align: middle; }.echo-item-likes { background-position: 0px 2px; }":"");})(jQuery);
(function(b){var a=Echo.createPlugin({name:"Reply",applications:["Stream"],dependencies:[{application:"Submit",url:"//cdn.echoenabled.com/clientapps/v2.6.4/submit.js"}],init:function(d,c){if(!Echo.Global){Echo.Global={};}d.extendRenderer("Item","children",d.renderers.Item.children);d.extendRenderer("Item","replyForm",d.renderers.Item.replyForm);d.extendRenderer("Item","container",d.renderers.Item.container);d.extendTemplate("Item",d.template,"insertAsLastChild","echo-item-content");d.listenEvents(c);d.addItemControl(c,d.assembleControl("Reply",c));}});a.template='<div class="echo-item-replyForm"></div>';a.addLabels({replyControl:"Reply"});a.assembleControl=function(d,c){var e=function(){var g=this;var h=g.dom.get("replyForm");if(!a.get(g,"form")){a.createForm(g,h);}if(a.get(g,"form.initialized")){if(g.depth||!g.children.length){a.view(g,"toggle");g.rerender("container");}}else{g.rerender("replyForm");}var f=a.get(g,"form");f.instance.switchMode();if(f.visible){if(f.instance.dom){text=f.instance.dom.get("text");if(text&&text.is(":visible")){text.focus();return;}}h.get(0).scrollIntoView(false);}};return function(){var f=this;return{name:"Reply",label:a.label("replyControl"),visible:f.depth<f.config.get("children.maxDepth"),callback:e};};};a.renderers={Item:{}};a.renderers.Item.children=function(e){var g=this;if(g.children.length==1){var f=a.get(g,"form");var h=g.children[0];var d=h.added&&!(f&&f.visible);var c=h.deleted&&!(f&&f.instance&&f.instance.config.get("mode")!="compact");if(c||d&&!g.depth){g.rerender("replyForm");}}g.parentRenderer("children",arguments);};a.renderers.Item.replyForm=function(d){var e=this;if(e.depth==e.config.get("children.maxDepth")){return;}var c=!!e.children.length;if(!e.depth&&c&&!a.get(e,"form")||a.get(Echo.Global,a.getFormKey(e))){a.createForm(e,d);}else{if(!a.get(e,"form")){return;}}if(!a.get(e,"form.initialized")){a.set(e,"form.initialized",true);d.addClass("echo-item-container echo-item-container-child echo-trinaryBackgroundColor echo-item-depth-"+(e.depth+1));if(!c){e.rerender("container");}else{if(e.children.length==1&&e.children[0].deleted){a.view(e,"hide");}else{if(a.get(e,"form.visible")){a.view(e,"show");}}}}else{if(a.get(e,"form.visible")&&(!c||e.children.length==1&&e.children[0].deleted)){a.view(e,"hide");}else{if(c){a.view(e,"show");}}}};a.renderers.Item.container=function(c){var e=this;var d=e.threading;if(a.get(e,"form.visible")){e.threading=true;}e.parentRenderer("container",arguments);e.threading=d;};a.prepareParams=function(c,d){return c.prepareBroadcastParams({plugin:a.name,form:a.get(d,"form"),item:{data:d.data,target:d.dom.content}});};a.listenEvents=function(c){b.map(["Expand","Collapse"],function(d){a.subscribe(c,"Submit.on"+d,function(h,f){var g=c.items[f.data.unique];if(!g||!a.get(g,"form")){return;}if(d=="Collapse"&&(g.depth||!g.children.length)){a.view(g,"hide");g.rerender("container");}var e=a.topic(c,"onForm"+d);a.publish(c,e,a.prepareParams(c,g));});});a.subscribe(c,"Submit.onPostComplete",function(e,d){var f=c.items[d.data.unique];if(!f){return;}a.get(f,"form.instance").switchMode("compact");});};a.createForm=function(f,h){var c=a.assembleConfig(f,{target:h.get(0),inReplyTo:f.data,data:{unique:f.data.unique},mode:"compact",targetURL:f.id});var d=a.getFormKey(f);var e=(a.get(Echo.Global,d)||{}).instance;if(e){var i=e.dom.get("text").val();e.config.set("target",h);h.empty().append(e.render());if(i){e.dom.get("text").val(i);}}else{e=new Echo.Submit(c);}var g={instance:e,initialized:false,visible:true};a.set(Echo.Global,d,g);a.set(f,"form",g);};a.view=function(d,e){var c=e=="toggle"?!a.get(d,"form.visible"):e=="show";a.set(d,"form.visible",c);a.get(d,"form.instance").config.get("target")[e]();};a.getFormKey=function(c){return"forms."+c.data.unique+"-"+c.getContextId();};})(jQuery);
(function(b){var a=Echo.createPlugin({name:"CommunityFlag",applications:["Stream"],dependencies:[{application:"UserList",url:"//cdn.echoenabled.com/clientapps/v2.6.4/user-list.js"}],init:function(d,c){if(typeof d.config.get(c,"showUserList")=="undefined"){d.config.set(c,"showUserList",true);}d.extendRenderer("Item","flags",d.renderers.Item.users);d.extendTemplate("Item",d.template,"insertAsLastChild","echo-item-data");d.addItemControl(c,d.assembleControl("Flag",c));d.addItemControl(c,d.assembleControl("Unflag",c));d.addCss(d.css);}});a.template='<div class="echo-item-flags"></div>';a.addLabels({flaggedThis:" flagged this.",flagControl:"Flag",unflagControl:"Unflag",flagProcessing:"Flagging...",unflagProcessing:"Unflagging..."});a.assembleControl=function(d,c){var e=function(){var f=this;f.controls[a.name+"."+d].element.empty().append(a.label(d.toLowerCase()+"Processing"));b.get(a.config.get(c,"submissionProxyURL","",true),{appkey:c.config.get("appkey"),content:b.object2JSON({verb:d.toLowerCase(),target:f.id}),sessionID:f.user.get("sessionID","")},function(){var g=a.topic(c,"on"+d+"Complete");a.publish(c,g,c.prepareBroadcastParams({item:{data:f.data,target:f.dom.content}}));c.startLiveUpdates(true);},"jsonp");};return function(){var g=this;var f=g.data.object.flags.length;var h=(b.map(g.data.object.flags,function(i){if(g.user.hasIdentity(i.actor.id)){return i;}})).length>0?"Unflag":"Flag";return{name:d,label:'<span class="echo-clickable">'+a.label(d.toLowerCase()+"Control")+"</span>"+(g.user.isAdmin()&&f?" ("+f+")":""),visible:g.user.logged()&&h==d,onetime:true,callback:e};};};a.renderers={Item:{}};a.renderers.Item.users=function(e,h){var f=this;if(!f.data.object.flags.length||!f.user.isAdmin()||!a.config.get(f,"showUserList")){e.hide();return;}var g=5;var c=a.get(f,"userList")?a.get(f,"userList").getVisibleUsersCount():g;var d=a.assembleConfig(f,{target:e.get(0),data:{itemsPerPage:g,entries:f.data.object.flags},initialUsersCount:c,suffixText:a.label("flaggedThis")});a.set(f,"userList",new Echo.UserList(d));e.show();};a.css=".echo-item-flags { background: url(//c0.echoenabled.com/images/curation/status/communityflagged.png) no-repeat 0px 4px; padding: 0px 0px 4px 21px; }";})(jQuery);
/**
 * jQuery Cookie plugin
 *
 * Copyright (c) 2010 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */
jQuery.cookie = function (key, value, options) {

    // key and at least value given, set cookie...
    if (arguments.length > 1 && String(value) !== "[object Object]") {
        options = jQuery.extend({}, options);

        if (value === null || value === undefined) {
            options.expires = -1;
        }

        if (typeof options.expires === 'number') {
            var days = options.expires, t = options.expires = new Date();
            t.setDate(t.getDate() + days);
        }

        value = String(value);

        return (document.cookie = [
            encodeURIComponent(key), '=',
            options.raw ? value : encodeURIComponent(value),
            options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
            options.path ? '; path=' + options.path : '',
            options.domain ? '; domain=' + options.domain : '',
            options.secure ? '; secure' : ''
        ].join(''));
    }

    // key and possibly options given, get cookie...
    options = value || {};
    var result, decode = options.raw ? function (s) { return s; } : decodeURIComponent;
    return (result = new RegExp('(?:^|; )' + encodeURIComponent(key) + '=([^;]*)').exec(document.cookie)) ? decode(result[1]) : null;
};
  /*
  jQuery.Roadblocked (0.1)
  Rapidly implement device-targeted, landing interstitials for mobile + tablet visitors to your site.
  Source: http://github.com/bsheldon/jquery.roadblocked by @ojogringo
  Built from coffee-plate: http://github.com/pthrasher/coffee-plate by @philipthrasher
  Requires: jquery, jquery-cookie
  */
  (function($) {
    $.roadblocked = function(el, options) {
      var buildDismissUI, killBody, scanDevice, setBody, setCookie,
        _this = this;
      this.el = el;
      this.$el = $(el);
      this.$el.data("roadblocked", this);
      this.init = function() {
        var content, cookiesEnabled, detectedDevice, dismiss, interstitial, link;
        _this.options = $.extend({}, $.roadblocked.defaults, options);
        jQuery.cookie('probe', 'landed');
        if (jQuery.cookie('probe') != null) cookiesEnabled = true;
        detectedDevice = scanDevice(_this.options.devices);
        if ((interstitial = _this.options.devices[detectedDevice]) && cookiesEnabled && (jQuery.cookie("" + _this.options.campaignName) !== 'done')) {
          dismiss = buildDismissUI();
          content = _this.setContent(interstitial);
          link = interstitial['link'];
          _this.placeInterstitial(dismiss, content, link, detectedDevice);
          setBody(true);
          setCookie(_this.options.lifetime, _this.options.campaignName, _this.options.path);
        }
        return _this;
      };
      scanDevice = function(devices) {
        var d, device, device_agent, featured_list, present, _fn, _i, _len;
        present = '';
        featured_list = [];
        for (d in devices) {
          featured_list.push(d);
        }
        device_agent = navigator.userAgent.toLowerCase();
        _fn = function(device) {
          if (device_agent.indexOf(device) > -1) {
            if (device === 'android') {
              if (device_agent.indexOf('mobile') > -1) return present = device;
            } else {
              return present = device;
            }
          }
        };
        for (_i = 0, _len = featured_list.length; _i < _len; _i++) {
          device = featured_list[_i];
          _fn(device);
        }
        return present;
      };
      this.placeInterstitial = function(dismiss, content, link, device) {
        var container;
        container = $('<div\>', {
          id: 'roadblocked-container',
          "class": device
        });
        container.html('');
        container.css({
          'background-color': _this.options.overlayBackgroundColor,
          'top': '0',
          'left': '0',
          'height': '100%',
          'width': '100%',
          'position': 'fixed',
          'z-index': '100',
          'margin': '0',
          'display': 'block'
        });
        $('body').prepend(container);
        $('#roadblocked-container').prepend(dismiss);
        if (_this.options.dismissPlacement === 'top') {
          $('#dismiss-bar').after(content);
        } else if (_this.options.dismissPlacement === 'bottom') {
          $('#dismiss-bar').before(content);
        } else {
          $('#dismiss-bar').after(content);
        }
        $('#dismiss-bar').click(function() {
          $('#roadblocked-container').hide();
          return killBody();
        });
        return $('#inter-content').click(function() {
          if (link != null) {
            window.location = "" + link;
            $('#roadblocked-container').hide();
            return killBody();
          }
        });
      };
      buildDismissUI = function() {
        var dismissLabel, height, self;
        dismissLabel = _this.options.dismissLabel;
        if (typeof dismissLabel === 'string') {
          height = (parseFloat(_this.options.dismissLabelHeight) / 100) * $(window).height();
          self = $('<div\>', {
            id: 'dismiss-bar'
          });
          self.css({
            'height': height,
            'width': '90%',
            'margin': '0 auto',
            'background-color': "" + _this.options.overlayBackgroundColor,
            'text-align': "" + _this.options.dismissLabelAlign,
            'background-image': "url('" + _this.options.imgPath + "/" + _this.options.dismissLabel + "')",
            'background-position': "" + _this.options.dismissLabelAlign,
            'background-repeat': 'no-repeat',
            'background-size': 'contain'
          });
          return self;
        } else if (typeof dismissLabel === 'object') {
          dismissLabel.attr('id', 'dismiss-bar');
          dismissLabel.show();
          return dismissLabel;
        }
      };
      this.setContent = function(interstitial) {
        var height, self;
        if (interstitial['img'] != null) {
          self = $('<div\>', {
            id: 'inter-content'
          });
          if (typeof _this.options.dismissLabel === 'string') {
            height = (100 - parseFloat(_this.options.dismissLabelHeight)).toString() + '%';
          } else {
            height = '100%';
          }
          self.css({
            'height': height,
            'width': '100%',
            'background-image': "url('" + _this.options.imgPath + "/" + interstitial['img'] + "')",
            'background-position': 'top',
            'background-repeat': 'no-repeat',
            'background-size': 'contain'
          });
          return self;
        } else if (interstitial['selector'] != null) {
          interstitial['selector'].attr('id', 'inter-content');
          interstitial['selector'].show();
          return interstitial['selector'];
        }
      };
      setBody = function(state, device) {
        if (state === true) return $('body').css('position', 'fixed');
      };
      killBody = function() {
        return $('body').css('position', 'static');
      };
      setCookie = function(lifetime, campaign, path_dir) {
        return jQuery.cookie("" + campaign, 'done', {
          expires: lifetime,
          path: path_dir
        });
      };
      this.isRetna = function() {
        var _ref;
        return (_ref = window.devicePixelRatio > 1) != null ? _ref : {
          "true": false
        };
      };
      return this.init();
    };
    $.roadblocked.defaults = {
      imgPath: 'images',
      retnaPath: 'images/retna',
      overlayBackgroundColor: '#000',
      dismissLabelHeight: '7.5%',
      dismissLabelAlign: 'center',
      dismissPlacement: 'top',
      lifetime: 0,
      path: '/',
      campaignName: 'jqueryRoadblocked'
    };
    $.fn.roadblocked = function(options) {
      return $.each(this, function(i, el) {
        var $el;
        $el = $(el);
        if (!$el.data('roadblocked')) {
          return $el.data('roadblocked', new $.roadblocked(el, options));
        }
      });
    };
    return;
  })(jQuery);
SG_Debug.pagedebug && window.console && console.log && console.log('[' + (new Date()-SG_Debug.initialTime)/1000 + ']' + ' Top of slatenav.js');
var SlateNav = {};
// NOTE: initialized in a doc.ready call at end of file
SlateNav.MYSLATE_TRACKING_PIXEL_URL = 'http://ad.doubleclick.net/clk;252663412;73738151;f;pc=[TPAS_ID];ord=' + Math.floor(Math.random()*10000000000) + '?';
SlateNav.FLYOUT_COLUMN_SIZE = 3;
SlateNav.sects = $('.sl-nav-sect-link[class!="sl-nav-lock"][class!="sl-nav-sl-nav-99"]');
// SlateNav.sectionMap maps identifying component of the nav section links'
// classes to static vals.
// The second class name in each link contains an identifier we'll ultimately
// use to fetch each
// section's most recent stories, e.g. the 'np' in 'sl-nav-np-link' maps that
// element to
// 'News and Politics'.
SlateNav.sectionMap = {
	'np' : {
		path : 'news_and_politics',
		name : 'News and Politics',
		list : ''
	},
	'tech' : {
		path : 'technology',
		name : 'Technology',
		list : ''
	},
	'bus' : {
		path : 'business',
		name : 'Business',
		list : ''
	},
	'arts' : {
		path : 'arts',
		name : 'Arts',
		list : ''
	},
	'life' : {
		path : 'life',
		name : 'Life',
		list : ''
	},
	'hs' : {
		path : 'health_and_science',
		name : 'Health and Science',
		list : ''
	},
	'spo' : {
		path : 'sports',
		name : 'Sports',
		list : ''
	},
	'dx' : {
		path : 'double_x',
		name : 'Double X',
		list : ''
	},
	'pod' : {
		path : 'podcasts',
		name : 'Podcasts',
		list : ''
	},
	'gal' : {
		path : 'galleries',
		name : 'Galleries',
		list : '',
		link : false
	},
	'vid' : {
		path : 'video',
		name : 'Video',
		list : false,
		link : 'http://www.slatev.com/'
	},
	'slst' : {
		path : 'slatest',
		name : 'Slatest',
		list : '',
		link : 'http://slatest.slate.com/'
	},
	'blogs' : {
		path : 'blogs',
		name : 'Blogs',
		list : '',
		link : false
	},
	'mys' : {
		path : 'my_slate',
		name : 'MySlate',
		list : '',
		link : '/myslate.html'
	}
}
// flyout data parsed into this object. keys are the section names, vals are
// arrays of that section's
// stories.
SlateNav.flyoutMap = {};
SlateNav.init = function() {
	// var slateFlyoutData decalred in separate script:
	// http://www.slate.com/content.flyout.json
	$(slateFlyoutData)
			.each(
					function(i) {
						SlateNav.flyoutMap[slateFlyoutData[i].name] = slateFlyoutData[i].stories;
					});
	SlateNav.initHandlers();
	setInterval(function() {
		$('.mys-stream-list').animate({
			top : '0px'
		}, 'slow', 'swing', function() {
			$('.mys-stream-list').css('top', '-70px');
		});
	}, 5000);
}

SlateNav.initHandlers = function() {
	var tout;
    var navpanel = $('.sl-nav-panel'); // Doesn't change, so cache here to avoid some jquery searches on mousemove
	// for each section link, assign event handlers
	for ( var i = 0; i < SlateNav.sects.length; i++) {
		// add ref to flyout element to be used in the handlers
		SlateNav.sects[i].sectId = $(SlateNav.sects[i]).attr('class')
				.split(' ')[1].split('-')[2];
		// SlateNav.sects[i].flyout = $('.sl-nav-' + SlateNav.sects[i].sectId +
		// '-flo');
		$(SlateNav.sects[i])
				.hoverIntent(
					function() {
						var sect = this;
						// mouseouts have a 500ms delay before flyouts get
						// hidden.
						clearTimeout(tout);
						// If flyout list is empty, populate it
						if (!SlateNav.sectionMap[sect.sectId].list) {
							var stories = SlateNav.flyoutMap[SlateNav.sectionMap[sect.sectId].name] || [];
							SlateNav.createFlyout(stories, sect.sectId);
						}
						$('.sl-nav-panel .sl-nav-panel-inner').html(
							SlateNav.sectionMap[sect.sectId].list);
						navpanel.slideDown('fast');
                        
                        // Orient nav indicator in flyout
                        var indicator = $('.sl-nav-indica');
                        var secNavWidth = $(this).width();
                        var secNavPos = $(this).position().left + (secNavWidth/1.5) + indicator.width();
                        indicator.css('left',secNavPos);
                        
                        // Is this the MySlate section?
                        if ($(sect).attr('href').indexOf(SlateNav.sectionMap.mys.link) != -1) {
                            if ($("#myslate-tracking-pixel").size() == 0) {
                                navpanel.prepend('<img src="' + SlateNav.MYSLATE_TRACKING_PIXEL_URL +'" width="1" height="1" alt="" border="0" id="myslate-tracking-pixel" style="display:none"/>');
                            }
                            
                            if (!MySlateData.isActiveUser) {
                                SlateNav.newUserMessage(true);
                            }  else {
                                //show sponsored by to user
                                $(".sl-nav-menu:last").append('<div class="sl-nav-myslate-sponsored-logged-in"><div class="sl-nav-myslate-caption">Sponsored Link</div><div class="sl-nav-myslate-sp-link-text"><a href="/myslate.html">MySlate: Personalized news for Slate readers. Presented by Toyota</a></div></div>')
                            }
                        } else {
                            SlateNav.newUserMessage(false);
                        }
                        //console.log("hi fired");
					}, function() { 
                        //console.log("hi out fired");
                    }
                );
	}
	$('.sl-nav-sect-link, .sl-nav-panel, .sl-header-plink, .sl-nav-cntr').mouseout(
			function() {
                //console.log("out fired");
				clearTimeout(tout);
				tout = setTimeout(function() {
                    SlateNav.newUserMessage(false);
					navpanel.slideUp('fast');
				}, 50)
			});
	navpanel.mousemove(function() {
        //console.log("mm fired");
		clearTimeout(tout);
	});
    $('.sl-nav-cntr').mousemove(function() {
        if (navpanel.css('display') == 'block') {
            clearTimeout(tout);
        }
    });
        
}

SlateNav.createFlyout = function(stories, sectId) {
	var div, indicator, ul, li, p, h5, a, span, authors;
	// sectId is used to select elements from the dom
	div = $(document.createElement('div'));
	// flyout = $('.sl-nav-' + sectId + '-flo');
	// create ul element using createElement (it's faster)
	ul = $(document.createElement('ul'));
	ul.addClass('sl-nav-menu');
    
    // Add in nav section indicator
    if ($('.sl-nav-indica').length == 0){
        indicator = $(document.createElement('div'));
        indicator.addClass('sl-nav-indica');
        $('.sl-nav-panel').append(indicator);
    }
    
	segmentSize = Math.ceil(stories.length / SlateNav.FLYOUT_COLUMN_SIZE);
	// loop thru stories, adding <li>s for each
	// console.log(segmentSize);
	$.each(stories, function(i, entry) {
		if ((i > 0) && ((i % segmentSize) == 0)) {
			div.append(ul);
			ul = $(document.createElement('ul'));
			ul.addClass('sl-nav-menu');
		}
		// handling different author cases
		if (entry.authors.length > 0) {
			if (entry.authors.length >= 3) {
				authors = " | " + entry.authors[0] + ' et al.';
			} else if (entry.authors.length == 2) {
				authors = " | " + entry.authors[0] + ' & ' + entry.authors[1];
			} else {
				authors = " | " + entry.authors[0];
			}
		} else {
			authors = '';
		}
		li = $(document.createElement('li'));
		li.addClass('sl-nav-menu-item');
		// if(i==0){
		// $(li).addClass('sl-nav-menu-item-first');
		// }
		ul.append(li);
		p = $(document.createElement('p'));
		p.addClass('sl-nav-byline');
		li.append(p);
		// Add rubric and author data
		span = $(document.createElement('span'));
        span.addClass('sl-to-uppercase');
		span.html(entry.rubric);
		p.append(span);
		p.append(authors);

		h5 = $(document.createElement('h5'));
		h5.addClass('sl-nav-hed');
		li.append(h5);
		// add menuline and link data
		a = $(document.createElement('a'));
		a.addClass('sl-nav-link');
		a.attr('href', entry.link);
		a.html(entry.menuline);
		h5.append(a);
		li = p = span = h5 = a = null;
	});
	li = $(document.createElement('li'));
	li.addClass('sl-nav-menu-item');
	ul.append(li);
	h5 = $(document.createElement('h5'));
	h5.addClass('sl-nav-hed');
	li.append(h5);
	// big "SEE ALL..." link at the end of each flyout
	if (!("link" in SlateNav.sectionMap[sectId]) || SlateNav.sectionMap[sectId].link != false) {
		var seeAllLink = ("link" in SlateNav.sectionMap[sectId]) ? SlateNav.sectionMap[sectId].link : 'http://' + SlateNav.getLinkHost() + '/articles/'
				+ SlateNav.sectionMap[sectId].path + '.html';
		a = $(document.createElement('a'));
		a.addClass('sl-nav-link');
		a.addClass('sl-to-uppercase');
		a.attr('href', seeAllLink);
		a.append('See all ' + SlateNav.sectionMap[sectId].name);
		h5.append(a);
	}
	div.append(ul);
	SlateNav.sectionMap[sectId].list = div.html();
	li = h5 = a = ul = authors = null;
}
SlateNav.getLinkHost = function() {
	var host;
	var regex = /(cq5)|(pub\d+)|(author)(.\w+)*|(www)+|(slatest)+.slate.com/;
	if (regex.test(window.location.hostname)) {
		host = window.location.hostname;
	} else {
		host = "www.slate.com";
	}
	if (window.location.port) {
		host += ':' + window.location.port;
	}
	return host;
}
SlateNav.newUserMessage = function(on) {
    if (on) {
        $(".sl-nav-panel").css('min-height', '150px').append('<div class="sl-nav-myslate-new-user"><div class="sl-nav-myslate-welcome-header">Welcome to MySlate!</div><div class="sl-nav-myslate-welcome-text">MySlate is a new tool that lets you track your favorite parts of <em>Slate</em>. Already a member? <a href="/myslate.html">Sign in</a>. Or <a href="/myslate.html">get started now</a>!</div><div class="sl-nav-myslate-sponsored"><div class="sl-nav-myslate-caption">Sponsored Link</div><div class="sl-nav-myslate-sp-link-text"><a href="/myslate.html">MySlate: Personalized news for Slate readers. Presented by Toyota</a></div></div></div>');
    } else {
        $(".sl-nav-panel .sl-nav-myslate-new-user").remove();
        $(".sl-nav-panel").css('min-height', '0');
    }
};

$(document).ready(function() {
	SlateNav.init();
	var lockObj = $("li.sl-nav-lock");
	lockObj.click(function() {
		var bgUrl = lockObj.css("background-image");
		if (bgUrl.indexOf("/images/unlocked.png") > 0) {
			//Lock it;
			lockObj.css('background-image', bgUrl.replace("unlocked.png", "locked.png"));
			if ($(".sl-nav-panel").css('display') == 'block') {$(".sl-nav-panel").slideUp('fast');}
			for ( var i = 0; i < SlateNav.sects.length; i++) {
				$(SlateNav.sects[i]).hoverIntent(function(){},function(){});
			}
		} else {
			//UnLock it;
			lockObj.css('background-image', bgUrl.replace("locked.png", "unlocked.png"));
			SlateNav.initHandlers();
		}
	});
});
SG_Debug.pagedebug && window.console && console.log && console.log('[' + (new Date()-SG_Debug.initialTime)/1000 + ']' + ' Bottom of slatenav.js');
(function(b){var a=Echo.createPlugin({name:"SubmitTextCounter",applications:["Submit"],init:function(d,c){d.extendRenderer("Submit","text",d.renderers.Submit.text);d.extendRenderer("Submit","counterLabel",d.renderers.Submit.counterLabel);d.extendTemplate("Submit",d.counterTemplate,"insertAfter","echo-submit-content");d.listenEvents(c);}});a.addLabels({limited:"{typed}/{left} characters",unlimited:"{typed} characters"});a.counterTemplate='<div class="echo-submit-counterLabel echo-primaryFont echo-primaryColor"></div>';a.renderers={Submit:{}};a.renderers.Submit.text=function(e,g){var d=this;d.parentRenderer("text",arguments);var c=a.config.get(d,"limit",0);var f=a.get(d,"keyPressHandler");if(!f){f=function(){if(c){var h=e.val();if(h.length<=c){a.set(d,"text",h);}else{if(h.length>c){e.val(a.get(d,"text"));return;}}}d.rerender("counterLabel");};a.set(d,"keyPressHandler",f);}e.unbind("blur focus keyup keypress",f).bind("blur focus keyup keypress",f);};a.renderers.Submit.counterLabel=function(f,h){var e=this;if(e.config.get("mode")=="compact"){f.hide();return;}var g=h.get("text").val().length;var c=a.config.get(e,"limit",0);var d=a.label(a.config.get(e,"label",c?"limited":"unlimited"),{typed:g,left:Math.max(c-g,0),limit:c});f.text(d);};a.listenEvents=function(c){a.subscribe(c,"Submit.onPostComplete",function(){c.rerender("counterLabel");});};})(jQuery);
(function(b){var a=Echo.createPlugin({name:"slateStreamer",applications:["Stream"],init:function(d,c){Echo.Item.prototype.template='<div class="echo-item-content"><div class="echo-item-container"><div class="echo-item-wrapper"><div class="echo-item-subwrapper"><div class="echo-item-subcontainer"><div class="echo-item-frame"><div class="echo-item-modeSwitch echo-clickable"></div><div class="echo-item-data"><div class="echo-item-body echo-primaryColor {Data:source.name}"><span class="echo-item-text"></span><span class="echo-item-textEllipses">...</span><span class="echo-item-textToggleTruncated echo-linkColor echo-clickable"></span></div><div class="echo-item-markers echo-secondaryFont echo-secondaryColor"></div><div class="echo-item-tags echo-secondaryFont echo-secondaryColor"></div></div><div class="echo-item-metadata"><div class="echo-item-metadata-userID"><span class="echo-item-metadata-title echo-item-metadata-icon echo-item-metadata-userID">{Label:userID}</span><span class="echo-item-metadata-value">{Data:actor.id}</span></div></div></div></div><div class="echo-clear"></div></div></div><div class="echo-clear"></div><div class="echo-item-childrenMarker"></div></div><div class="echo-item-children"></div></div>';d.extendTemplate("Item",'<div class="stream_icon"></div>',"insertAsFirstChild","echo-item-body");d.listenEvents(c);}});a.listenEvents=function(c){streamerCount=0;var d="#c9e8ee";a.subscribe(c,"Stream.onReady",function(i,h){var f=b(".echo-item-content:eq(0)").find(".obj_copy");var j=b(f).find("a:last");var g=b(f).find("span");var l=g.height()+j.height();var m=Math.ceil((b("#slatestream-viewport").height()-l)/2);g.animate({"padding-top":m},200);var k=setInterval(e,6000);function e(){var o=b(".echo-item-content:eq(1)").find(".obj_copy");var n=b(o).find("a:last");var r=b(o).find("span");var q=r.height()+n.height();var p=Math.ceil((b("#slatestream-viewport").height()-q)/2);r.animate({"padding-top":p},200);b(".echo-item-content:first").slideUp(400,function(){b(".echo-item-body").effect("highlight",{color:d},3000);b(".echo-item-content:last").after(b(this)).fadeIn(200);});}});a.subscribe(c,"Stream.Item.onRender",function(i,h){var e=h.item.data.source.name;var f=b(h.item.target).find(".echo-item-body > span").first("span");f.addClass("obj_copy");var l=b(h.item.target).find(".obj_copy > div").width()+b(".stream_icon").width();b(".echo-item-content").find("a").attr("target","_blank");b(h.item.target).addClass(e+"-item-"+(streamerCount+1));var j=b(f).find("a:last");var g=b(h.item.target).find(".echo-item-body > span span").first("span");if(b(f).find("img").length>=1){j.css("margin-left",l);}else{b(h.item.target).find(".obj_copy > div").css("width","5px");}var k=g.height()+j.height();var m=Math.ceil((b("#slatestream-viewport").height()-k)/2);g.css("padding-top",m);streamerCount+=1;});a.subscribe(c,"Stream.Item.onReceive",function(f,i){var h=i.item.data.source.name;var j=[];var e=h+"-item-";b('div[class*="'+e+'"]').each(function(l){var m=/\d+/;var k=m.exec('"'+this.className+'"');j.push(k);});function g(l,k){return l-k;}j.sort(g);oldest_item="."+e+j[0];if(j.length>=2){b(oldest_item).slideUp("slow").removeClass();}});};})(jQuery);
var SG_Async = {
	facebook_queue: [],
	plusone_queue: [],
	facebook_polling: false,
	plusone_polling: false
};


SG_Async._enqueueFacebook = function(el) {
	SG_Async.facebook_queue.push(el);
	if (!SG_Async.facebook_polling) {
		SG_Async.facebook_polling = true;
		SG_Async._pollFacebook();
	}
}

SG_Async._enqueuePlusOne = function(el) {
	SG_Async.plusone_queue.push(el);
	if (!SG_Async.plusone_polling) {
		SG_Async.plusone_polling = true;
		SG_Async._pollPlusOne();
	}
}

SG_Async._pollFacebook = function() {
	if (typeof(FB) !== "undefined" && typeof(FB.XFBML) !== "undefined") {
		for (var i = 0; i < SG_Async.facebook_queue.length; i++) {
			SG_Async.loadFacebook.call(SG_Async.facebook_queue[i]);
		}
		SG_Async.facebook_queue = [];
	} else {
		setTimeout('SG_Async._pollFacebook()', 250);
	}
	
}

SG_Async._pollPlusOne = function() {
	if (typeof(gapi) !== "undefined" && typeof(gapi.plusone) !== "undefined") {
		for (var i = 0; i < SG_Async.plusone_queue.length; i++) {
			SG_Async.loadPlusOne.call(SG_Async.plusone_queue[i]);
		}
		SG_Async.plusone_queue = [];
	} else {
		setTimeout('SG_Async._pollPlusOne()', 250);
	}
}

SG_Async.loadPlusOne = function() {
	if (typeof(gapi) !== "undefined" && typeof(gapi.plusone) !== "undefined") {
		gapi.plusone.go($(this).get(0));  
	} else {
		SG_Async._enqueuePlusOne(this);
	}
};

SG_Async.loadFacebook = function() {
	if (typeof(FB) !== "undefined" && typeof(FB.XFBML) !== "undefined") {
		FB.XFBML.parse($(this).get(0));
	} else {
		SG_Async._enqueueFacebook(this);
	}
};

SG_Async.loadSocial = function() {
	SG_Async.loadFacebook.call(this);
	SG_Async.loadPlusOne.call(this);
};

$(document).ready(function() {
	$('.social-onscroll').each(function(idx, el) {
		$(el).lazyload({appear: SG_Async.loadSocial, delay: 500 });
	});
	$('.fb-onscroll').each(function(idx, el) {
		$(el).lazyload({appear: SG_Async.loadFacebook, delay: 500 });
	});
	$('.p1-onscroll').each(function(idx, el) {
		$(el).lazyload({appear: SG_Async.loadPlusOne, delay: 500 });
	}); 
	$('.social-onload').each(function(idx, el) {
		SG_Async.loadSocial.call(el);
	});
	$('.fb-onload').each(function(idx, el) {
		SG_Async.loadFacebook.call(el);
	});
	$('.p1-onload').each(function(idx, el) {
		SG_Async.loadPlusOne.call(el);
	});
});
SG_Debug.pagedebug && window.console && console.log && console.log('[' + (new Date()-SG_Debug.initialTime)/1000 + ']' + ' top of slate_toolbar.js');
$(document).ready(function() {

	// skip if there's no share box
	if ($('#share-box-flank').size() == 0) {
		return false;
	}
	
	var frame, shareBoxPos, shareEdgeElem, shareEdgePos, shareEdge, leftBound;

	// Assign toolbar
	var shareBox = $('#share-box-flank');
	// Assign horiz toolbar
	var shareBoxHoriz = $('.sl-tbar');
	// Assign the template wrapper that floating toolbar should juxapose
	var wrapper = $('.sl-content-wrapper');
	// Set desired margin spacing above share toolbar to browser frame
	var topBuffer = 20;
	
	// Set floating coordinate range of sticky bar
	setBounds();

	// Define initial range of vertical scroll bounds
	var shareBoxTopInit = shareBox.css('top');
	var topBound = shareBoxPos.top;
	var bottomBound = shareEdgePos.top - shareEdgeElem.height();
	
	var floating = null;
	var floating_position = null;
	
	// On scroll, updates toolbar state
	$(window).scroll(function(event) {
		follow();
	});
	// On window resize, repositions toolbar + checks state
	$(window).resize(function() {
		setBounds();
		follow();
	});
	
	function setBounds() {
		frame = wrapper.offset();
		shareBoxPos = shareBox.offset();
		// Adjust these selectors to anchor the scroll limit
		shareEdgeElem = $('#bottom-bound-div')
		shareEdgePos = shareEdgeElem.offset();
		leftBound = frame.left - shareBox.width();
	}

	function follow() {
		// If side toolbar will fit on screen, render it
		if ($(window).width() >= (wrapper.width() + (2 * shareBox.width()))) {
			// Display floating toolox + hide inline version
			if (floating !== true) {
				SG_Async.loadSocial.call(shareBox.get(0));
				floating = true;
				shareBox.show();
				shareBoxHoriz.hide();
			}
			// Set toolbar to fixed position when scrolling within bounds		
			var currPos = jQuery(this).scrollTop();
	
			if(currPos >= ( topBound - topBuffer) && currPos <= (bottomBound)) {
				if (floating_position !== "fixed") {
					shareBox.css({
						'position' : 'fixed',
						'top' : topBuffer,
						'left' : leftBound
					});
					floating_position = "fixed";
				}
			} else if(currPos > bottomBound) {
				shareBox.css({
					'position' : 'absolute',
					'left' : '-' + shareBox.width() + 'px'
				});
				shareBox.offset({
					top : bottomBound + topBuffer
				});
	
			} else if(currPos < topBound) {
				if (floating_position !== "relative") {
					shareBox.css({
						'position' : 'relative',
						'top' : shareBoxTopInit,
						'left' : '-' + shareBox.width() + 'px'
					});
					floating_position = "relative";
				}
			}
		} else { 
			snapInline();
			}		
	}
	
	function snapInline(){
		if (floating !== false) {
			SG_Async.loadSocial.call(shareBoxHoriz.get(0));
			floating = false;
			floating_position = null;
			// Hide left floating toolbar
			shareBox.hide();
			// Insert logic to display inline version of toolbar
			//
			shareBoxHoriz.show();
		}
	}
	follow();
});
SG_Debug.pagedebug && window.console && console.log && console.log('[' + (new Date()-SG_Debug.initialTime)/1000 + ']' + ' bottom of slate_toolbar.js');
function slate_insert_comment_count(url, element, fullText, showAdd) {
    //console.log(url);
    if (url.substring(0,1) == '/') {
        url = slate_public_url + url;
    }
    url = escape(url);
    var request = 'http://api.echoenabled.com/v1/count?q=childrenof%3A' + url + '*+type%3Acomment+-source%3ATwitter+sortOrder%3AreverseChronological+(state%3AModeratorApproved%20OR%20(state%3AUntouched%20-user.state%3AModeratorBanned%2CModeratorDeleted))+children%3A3&appkey=dev.slate.com&callback=?';
    $.getJSON(request, function(data, status, xhr) {
        var count = (data.count) ? data.count : 0;
        if (fullText) {
            if (count > 0) {
                if (count == 1) {
                    $(element).html("<span>1</span> Comment");
                } else {
                    $(element).html("<span>" + count + "</span> Comments");
                }
            } else {
            	if (showAdd) {
            		$(element).html("Add Comment");
            	} else {
            		$(element).html("<br/> Comment");
            	}
            }
        } else {
            if (count > 0) {
                $(element).text(count);
            } else {
                $(element).text('0');
            }
        }
    });
}

function slatest_insert_twitter_count(url, element, fullText) {
    if (url.substring(0,1) == '/') {
        url = slate_public_url + url;
    }
    url = escape(url);
    var request = 'http://api.echoenabled.com/v1/count?q=childrenof%3A' + url + ' source%3ATwitter&appkey=dev.slate.com&callback=?';
    //console.log(request);
    $.getJSON(request, function(data, status, xhr) {
        var count = (data.count) ? data.count : 0;
        if (fullText) {
            if (count > 0) {
                if (count == 1) {
                    $(element).html("<span>1</span> Tweet");
                } else {
                    $(element).html("<span>" + count + "</span> Tweets");
                }
            } else {
                $(element).html("<br/> Tweet");
            }
        } else {
            $(element).text(count);
        }
    }); 
}

function slatest_insert_facebook_count(url, element, fullText) {
    if (url.substring(0,1) == '/') {
        url = slate_public_url + url;
    }
    url = escape(url);
    var request = 'http://graph.facebook.com/' + url + '?callback=?';
    //console.log(request);
    $.getJSON(request, function(data, status, xhr) {
        /*console.log(data);*/
        var count = (data.shares) ? data.shares : 0;
        if (fullText) {
            if (count > 0) {
                if (count == 1) {
                    $(element).html("<span>1</span> Like");
                } else {
                    $(element).html("<span>" + count + "</span> Likes"); 
                }
            } else {
                $(element).html("<br/> Like"); 
            }
        } else {
            $(element).text(count);
        }
    }); 
}

function fbs_click(url, t) {
    if (url.substring(0,1) == '/') {
        url = slate_public_url + url;
    }
    url = escape(url);
    t = escape(t);
    window.open('http://www.facebook.com/sharer.php?u='+encodeURIComponent(url)+'&t='+encodeURIComponent(t),'sharer','toolbar=0,status=0,width=626,height=436');
    return false;
}

function twt_click(url, t) {
    if (url.substring(0,1) == '/') {
        url = slate_public_url + url;
    }
    url = escape(url);      
    t = escape(t);
    
    // Jsonp calls cannot use window.open, so we open an empty window first as a workaround.
    twindow = window.open("", "twitter", 'toolbar=0,status=0,width=626,height=436');
    $.getJSON('http://api.bitly.com/v3/shorten?longurl=' + url + '&login=slate&apiKey=R_595d1e9a24a47c4615283fd74d9d8fda&callback=?', function(data) {      
        if (data.data.url != undefined) {
            url = escape(data.data.url);
        }
        twindow.location = 'http://twitter.com/intent/tweet?text=' + t + '&url=' + url + '&via=Slatest';
    });
     
    return false;
}

var MySlateData = {};
MySlateData.isActiveUser=true;
MySlateData.host;
MySlateData.articleId;
MySlateData.subscriptionData;
MySlateData.inManualQueue=false;
MySlateData.author;
MySlateData.section;
MySlateData.rubric;
MySlateData.sectionType;
MySlateData.inPopup=false;
MySlateData.storyPath = '';

MySlateData.init = function(host, articleId, author, section, sectionType, rubric) {

    MySlateData.isActiveUser = ($.cookie('wapo_login_id')!==null && $.cookie('myslate_login_inactive')===null);
    //console.log("WaPo Cookie: " + $.cookie('wapo_login_id'));
    //console.log("MySlateData Cookie: " + $.cookie('myslate_login_inactive'));
    //console.log("Active user? " + MySlateData.isActiveUser);
    //console.log(MySlateData.isActiveUser);
    MySlateData.host=host;
    MySlateData.articleId = articleId;
    MySlateData.author = author;
    MySlateData.section = section;
    MySlateData.rubric = rubric;
    MySlateData.sectionType = sectionType;

    if (MySlateData.isActiveUser) {
        MySlateData.getAllData();
    } else {
        MySlateData.populateControls();
    }

    if (typeof(window.MySlate) === "function") {
        window.MySlate = new window.MySlate();
    }
}

MySlateData.createMySlateDataNoUserCookie = function() {
    var date = new Date();
    date.setTime(date.getTime() + (10 * 60 * 1000));
    $.cookie("myslate_login_inactive", "true", { expires: date, path: '/', domain: 'slate.com' });
    MySlateData.isActiveUser = false;
}

MySlateData.getAllData = function() {
    var data = {};
    if(MySlateData.articleId!=null) {
        data.articleId=MySlateData.articleId;
    }
    $.ajax({
        'url': MySlateData.host + '/users/slate_page_info/',
        'data': data,
        'dataType':"jsonp",
        'timeout': 15000,
        success: function(data, textStatus, jqXHR) {
            //console.log('getAllData');
            //console.log(data);
            if(data.success==false) {
                // an error occurred, trigger event but don't set user to inactive
                MySlateData.queue = null;
                MySlateData.subscriptions = null;
                MySlateData.inManualQueue = false;
                MySlateData.isActiveUser = false;
                $(window).trigger("MySlateData.Fetch", false);
                return;
            }
            if (data.status==202) {
                // user is inactive
                MySlateData.createMySlateDataNoUserCookie();
                MySlateData.queue = null;
                MySlateData.subscriptions = null;
                MySlateData.inManualQueue = false;
                $(window).trigger("MySlateData.Fetch", false);
                return;
            }
            if (data.user && data.user.queue) {
                MySlateData.queue = data.user.queue;
            } else {
                MySlateData.queue = null;
            }
            if (data.user && data.user.subscriptions) {
                MySlateData.subscriptions = data.user.subscriptions;
            } else {
                MySlateData.subscriptions = null;
            }
            if(data.in_manual_queue) {
                MySlateData.inManualQueue = data.in_manual_queue;
            }

            // wapo_login_id error should cause the user to be logged out
            // Other failure cases should not
            if (data.message && (data.message.indexOf("wapo_login_id") != -1 || data.message.indexOf("User matching query does not exist.") != -1)) {
                //console.log('not a user');
                MySlateData.createMySlateDataNoUserCookie();
                $(window).trigger("MySlateData.Fetch", false);
            } else {
                $(window).trigger("MySlateData.Fetch", data);
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            MySlateData.queue = null;
            MySlateData.subscriptions = null;
            MySlateData.inManualQueue = false;
            $(window).trigger("MySlateData.Fetch", false);
        }
    });
}

MySlateData.didWireup=false;
MySlateData.wireUpControls = function() {

    if(!MySlateData.didWireup) {
        $('.mys-myslate-logged-in').hide();
        $('.mys-myslate-not-logged-in').hide();

        $('#sl_article_tools_myslate').unbind('mouseenter');
        $('#sl_article_tools_myslate').unbind('mouseleave');

        $('#mys_message_settings_icon_float').unbind('mouseenter');
        $('#mys_message_settings_icon_float').unbind('mouseleave');

        $('#mys_message_settings_bottom_icon').unbind('mouseenter');
        $('#mys_message_settings_bottom_icon').unbind('mouseleave');

        $('.mys-myslate-logged-in').unbind('mouseleave');
        $('.mys-myslate-logged-in').unbind('mouseenter');

        $('.mys-myslate-not-logged-in').unbind('mouseleave');
        $('.mys-myslate-not-logged-in').unbind('mouseenter');

        $('#mys_myslatelogo_close_img').unbind('click');
        $('#mys_myslate_close_img').unbind('click');

        $('.mys-box2-button').unbind('click');

        $wpjQ(document).unbind('wapoLogout.myslate');
        $wpjQ(document).unbind('wapoLogin.myslate');

        MySlateData.didWireup=true;

        $wpjQ(document).bind('wapoLogout.myslate', function(){
            //console.log("in logout event bind");
            // remove cookie saying they are inactive if it exists, and retry to fetch data and wire up dialogs
            MySlateData.isActiveUser=false;
            MySlateData.didWireup=false;
            $.cookie("myslate_login_inactive", null);
            MySlateData.wireUpControls();
        });

        $wpjQ(document).bind('wapoLogin.myslate', function(){
            //console.log("in logout event bind");
            // remove cookie saying they are inactive if it exists, and retry to fetch data and wire up dialogs
            MySlateData.isActiveUser=true;
            MySlateData.didWireup=false;
            $.cookie("myslate_login_inactive", null);
            MySlateData.getAllData();
        });

        if(MySlateData.isActiveUser) {

            $('.mys-box2-button').click(function() {
                MySlateData.saveUserPrefs();
            });

            // wire up three locations logged in popup can appear
            $('#sl_article_tools_myslate').mouseenter(function(){
                var pos=$('#sl_article_tools_myslate').offset();
                var h=$('#sl_article_tools_myslate').height();
                var w=$('#sl_article_tools_myslate').width();
                $('.mys-myslate-logged-in').css("background-image", "url(/etc/designs/slate/images/topPointingPopupBackground.png)");
                $('.mys-myslate-logged-in').css({ left: pos.left - 158 + w/2, top: pos.top + h - 5, position:'absolute' });
                MySlateData.getAllData();
                $('.mys-myslate-logged-in').show();
            });

            // set timeout for if mouse leaves button, so we close window if they don't then move the mouse to the popup
            $('#sl_article_tools_myslate').mouseleave(function(){
                setTimeout(function() {
                    MySlateData.checkCloseDialog($('.mys-myslate-logged-in'));
                }, 300)
            });

            $('.mys-myslate-logged-in').mouseenter(function(){
                MySlateData.inPopup=true;
            });

            $('#mys_message_settings_icon_float').mouseenter(function(){
                var pos=$('#share-box-flank').offset();
                var h=$('#share-box-flank').height();
                var w=$('#share-box-flank').width();
                $('.mys-myslate-logged-in').css("background-image", "url(/etc/designs/slate/images/leftPointingPopupBackground.png)");
                $('.mys-myslate-logged-in').css({ left: pos.left + 70, top: 250, position:'fixed' });
                MySlateData.getAllData();
                $('.mys-myslate-logged-in').show();
            });

            // set timeout for if mouse leaves button, so we close window if they don't then move the mouse to the popup
            $('#mys_message_settings_icon_float').mouseleave(function(){
                setTimeout(function() {
                    MySlateData.checkCloseDialog($('.mys-myslate-logged-in'));
                }, 300)
            });

            $('#mys_message_settings_bottom_icon').mouseenter(function(){
                var pos=$('#sl_article_tools_myslate_bottom').offset();
                var h=$('#sl_article_tools_myslate_bottom').height();
                var w=$('#sl_article_tools_myslate_bottom').width();
                $('.mys-myslate-logged-in').css("background-image", "url(/etc/designs/slate/images/topPointingPopupBackground.png)");
                $('.mys-myslate-logged-in').css({ left: pos.left - 148 + w/2, top: pos.top + h - 5, position:'absolute' });
                MySlateData.getAllData();
                $('.mys-myslate-logged-in').show();
            });

            // set timeout for if mouse leaves button, so we close window if they don't then move the mouse to the popup
            $('#mys_message_settings_bottom_icon').mouseleave(function(){
                setTimeout(function() {
                    MySlateData.checkCloseDialog($('.mys-myslate-logged-in'));
                }, 300)
            });

            //wire up events to close dialog
            $('.mys-myslate-logged-in').mouseleave(function(){
                if(MySlateData.inPopup) {
                    MySlateData.inPopup=false;
                    $('.mys-myslate-logged-in').hide();
                }
            });

            $('#mys_myslate_close_img').click(function(){
                MySlateData.inPopup=false;
                $('.mys-myslate-logged-in').hide();
            });

        } else {
            //wire up events for not registered
            $('#sl_article_tools_myslate').mouseenter(function(){
                var pos=$('#sl_article_tools_myslate').offset();
                var h=$('#sl_article_tools_myslate').height();
                var w=$('#sl_article_tools_myslate').width();
                $('.mys-myslate-not-logged-in').css("background-image", "url(/etc/designs/slate/images/topPointingPopupBackground.png)");
                $('.mys-myslate-not-logged-in').css({ left: pos.left - 158 + w/2, top: pos.top + h -5, position:'absolute' });
                $('.mys-myslate-not-logged-in').show();
            });

            // set timeout for if mouse leaves button, so we close window if they don't then move the mouse to the popup
            $('#sl_article_tools_myslate').mouseleave(function(){
                setTimeout(function() {
                    MySlateData.checkCloseDialog($('.mys-myslate-not-logged-in'));
                }, 300)
            });

            $('.mys-myslate-not-logged-in').mouseenter(function(){
                MySlateData.inPopup=true;
            });

            $('#mys_message_settings_icon_float').mouseenter(function(){
                var pos=$('#share-box-flank').offset();
                var h=$('#share-box-flank').height();
                var w=$('#share-box-flank').width();
                $('.mys-myslate-not-logged-in').css("background-image", "url(/etc/designs/slate/images/leftPointingPopupBackground.png)");
                $('.mys-myslate-not-logged-in').css({ left: pos.left + 70, top: 250, position:'fixed' });
                $('.mys-myslate-not-logged-in').show();
            });

            // set timeout for if mouse leaves button, so we close window if they don't then move the mouse to the popup
            $('#mys_message_settings_icon_float').mouseleave(function(){
                setTimeout(function() {
                    MySlateData.checkCloseDialog($('.mys-myslate-not-logged-in'));
                }, 300)
            });

            $('#mys_message_settings_bottom_icon').mouseenter(function(){
                var pos=$('#sl_article_tools_myslate_bottom').offset();
                var h=$('#sl_article_tools_myslate_bottom').height();
                var w=$('#sl_article_tools_myslate_bottom').width();
                $('.mys-myslate-not-logged-in').css("background-image", "url(/etc/designs/slate/images/topPointingPopupBackground.png)");
                $('.mys-myslate-not-logged-in').css({ left: pos.left - 148 + w/2, top: pos.top + h -5, position:'absolute' });
                $('.mys-myslate-not-logged-in').show();
            });

            // set timeout for if mouse leaves button, so we close window if they don't then move the mouse to the popup
            $('#mys_message_settings_bottom_icon').mouseleave(function(){
                setTimeout(function() {
                    MySlateData.checkCloseDialog($('.mys-myslate-not-logged-in'));
                }, 300)
            });

            // wire up close events
            $('.mys-myslate-not-logged-in').mouseleave(function(){
                if(MySlateData.inPopup) {
                    MySlateData.inPopup=false;
                    $('.mys-myslate-not-logged-in').hide();
                }
            });

            $('#mys_myslatelogo_close_img').click(function(){
                MySlateData.inPopup=false;
                $('.mys-myslate-not-logged-in').hide();
            });


        }
    }
}

MySlateData.checkCloseDialog =function(element) {
    if(!MySlateData.inPopup) {
        element.hide();
    }
}

MySlateData.populateControls = function() {

    if(MySlateData.author!=null) {
        var checked=false;
        if(MySlateData.subscriptions!=null) {
            $.each(MySlateData.subscriptions, function(index,value) {
                if(this.type=='author' && this.display_name==MySlateData.author) {
                    $('#myslate-is-subscribed-author').prop("checked", true);
                    checked=true;
                    return false;
                }
            })
            if(!checked) {
                $('#myslate-is-subscribed-author').prop("checked", false);
            }
        } else {
            $('#myslate-is-subscribed-author').prop("checked", false);
        }
    } else {
        $('#myslate-subscribe-author').hide();
    }
    if(MySlateData.section!=null) {
        var checked=false;
        if(MySlateData.subscriptions!=null) {
            $.each(MySlateData.subscriptions, function(index,value) {
                if(this.type==MySlateData.sectionType && this.display_name==MySlateData.section) {
                    $('#myslate-is-subscribed-section').prop("checked", true);
                    checked=true;
                    return false;
                }
            })
            if(!checked) {
                $('#myslate-is-subscribed-section').prop("checked", false);
            }
        } else {
            $('#myslate-is-subscribed-section').prop("checked", false);
        }
    } else {
        $('#myslate-subscribe-section').hide();
    }


    if(MySlateData.rubric!=null) {
        var checked=false;
        if(MySlateData.subscriptions!=null) {
            $.each(MySlateData.subscriptions, function(index,value) {
                if(this.type=='rubric' && this.display_name==MySlateData.rubric) {
                    $('#myslate-is-subscribed-rubric').prop("checked", true);
                    checked=true;
                    return false;
                }
            })
            if(!checked) {
                $('#myslate-is-subscribed-rubric').prop("checked", false);
            }
        } else {
            $('#myslate-is-subscribed-rubric').prop("checked", false);
        }
    } else {
        $('#myslate-subscribe-rubric').hide();
    }

    if(MySlateData.inManualQueue) {
        $('#myslate-is-subscribed-story').prop("checked", true);
    } else {
        $('#myslate-is-subscribed-story').prop("checked", false);
    }
    MySlateData.wireUpControls();

}



MySlateData.saveUserPrefs = function() {
    // if the checkbox isn't in it's intial state, sent add/remove to endpoint
    if($('#myslate-is-subscribed-story').is(":checked") && MySlateData.articleId!=null) {
        MySlateData.saveManualRead()
    } else if(MySlateData.articleId!=null) {
        MySlateData.removeManualRead()
    }
    if($('#myslate-is-subscribed-author').is(":checked") && MySlateData.author!=null) {
        MySlateData.saveSubscription('author',MySlateData.author);
    } else if(MySlateData.author!=null) {
        MySlateData.removeSubscription('author',MySlateData.author);
    }
    if($('#myslate-is-subscribed-rubric').is(":checked") && MySlateData.rubric!=null) {
        MySlateData.saveSubscription('rubric',MySlateData.rubric);
    } else if(MySlateData.rubric!=null) {
        MySlateData.removeSubscription('rubric',MySlateData.rubric);
    }
    if($('#myslate-is-subscribed-section').is(":checked") && MySlateData.section!=null) {
        MySlateData.saveSubscription(MySlateData.sectionType,MySlateData.section);
    } else if(MySlateData.section!=null) {
        MySlateData.removeSubscription(MySlateData.sectionType,MySlateData.section);
    }
    $('.mys-myslate-logged-in').hide();
}


MySlateData.saveSubscription = function(type,displayName,callback) {
    var data = {type:type,display_name:displayName};
    $.ajax({
        url :  MySlateData.host + '/users/subscribe/',
        dataType : "jsonp",
        timeout : 15000,
        data: data,
        success: function(data, textStatus, jqXHR) {
            if(data.status==202) {
                MySlateData.createMySlateDataNoUserCookie();
                if (callback) { callback(false); }
                return false;
            }
            if (callback) { callback(true); }
            return true;
        },
        error: function(jqXHR, textStatus, errorThrown) {
            if (callback) { callback(true); }
            return false;
        }
    });
}

MySlateData.removeSubscription = function(type,displayName,callback) {
    var data = {type:type,display_name:displayName};
    $.ajax({
        url :  MySlateData.host + '/users/unsubscribe/',
        dataType : "jsonp",
        timeout : 15000,
        data: data,
        success: function(data, textStatus, jqXHR) {
            if(data.status==202) {
                MySlateData.createMySlateDataNoUserCookie();
                if (callback) { callback(false); }
                return false;
            }
            if (callback) { callback(true); }
            return true;
        },
        error: function(jqXHR, textStatus, errorThrown) {
            //console.log("in error of unsubscribe");
            if (callback) { callback(false); }
            return false;
        }
    });
}

MySlateData.saveManualRead = function() {
    var data = {articleId:MySlateData.articleId};
    $.ajax({
        url :  MySlateData.host + '/users/add_to_queue/',
        dataType : "jsonp",
        timeout : 15000,
        data: data,
        success: function(data, textStatus, jqXHR) {
            if(data.status==202) {
                MySlateData.createMySlateDataNoUserCookie();
                return false;
            }
            return true;
        },
        error: function(jqXHR, textStatus, errorThrown) {
            return false;
        }
    });
}

MySlateData.removeManualRead = function() {
    var data = {articleId:MySlateData.articleId};
    $.ajax({
        url :  MySlateData.host + '/users/remove_from_queue/',
        dataType : "jsonp",
        timeout : 15000,
        data: data,
        success: function(data, textStatus, jqXHR) {
            if(data.status==202) {
                MySlateData.createMySlateDataNoUserCookie();
                return false;
            }
            return true;
        },
        error: function(jqXHR, textStatus, errorThrown) {
            return false;
        }
    });
}

/**
 * Clear notifications for active users.
 */
MySlateData.clearNotifications = function() {
	if (MySlateData.isActiveUser) {
		$.ajax({
			url : MySlateData.host + '/users/update/',
			dataType : "jsonp",
			timeout : 5000,
			success: function(data, textStatus, jqXHR) {
				$(window).trigger("MySlateData.Notifications", { count: 0 });
			},
			error: function(jqXHR, textStatus, errorThrown) {
				if (console && console.log) {
					console.log(errorThrown);
				}
			}
		});
	}
}

/**
 * Listener to bubble up a MySlateData.Notifications
 */
$(window).bind("MySlateData.Fetch", function(ev, data) {
    if(MySlateData.isActiveUser) {
        var updated_date = Date.parse(data.user.updated_date);
        var new_articles = 0;
		for (var i = 0; i < data.user.queue.articles.length; i++) {
	        var article = data.user.queue.articles[i];
            var article_pub_date = Date.parse(article.fields.pub_date.replace(/-/g,'/'));
            if (article_pub_date > updated_date) {
                ++new_articles;
            }
        }
        $(window).trigger("MySlateData.Notifications", { count: new_articles, since: updated_date });
    }
});


/**
 * Listener to populate the flyout
 */
$(window).bind("MySlateData.Fetch", function(ev, data) {
	var articles = [];
    if(MySlateData.isActiveUser) {
        for (var i = 0; i < data.user.queue.articles.length; i++) {
            var article = data.user.queue.articles[i].fields;
            if (article.blogs.length > 0) {
                article.rubric = article.blogs[0];
            } else if (article.rubrics.length > 0) {
                article.rubric = article.rubrics[0];
            } else if (article.sections.length > 0) {
                article.rubric = article.sections[0];
            }
            article.link = article.url;
            articles.push(article);
        }
    }
	SlateNav.createFlyout(articles, "mys");
});

$(window).bind("MySlateData.Notifications", function(ev, data) {
	var sl_nav = $(".sl-nav-99");
	if (sl_nav) {
		if (!data.count) {
            sl_nav.text("0");
            sl_nav.show();
		} else if (data.count >= 8) {
			sl_nav.text("8+");
			sl_nav.show();
		} else {
			sl_nav.text(data.count);
			sl_nav.show();
		}
	}
});


$(window).bind('MySlateData.Fetch', MySlateData.populateControls);





if (!SlateNextbox) {
    var SlateNextbox = {};
}

SlateNextbox.offset = 95;
SlateNextbox.element_selector = '#nextbox_trigger';
SlateNextbox.element_offset = 0;
SlateNextbox.animation = "flyout";
SlateNextbox.init_finished = false;
SlateNextbox.prompt = "signup";
SlateNextbox.mySlateDataChecked = false;
SlateNextbox.subscribe_type = null;
SlateNextbox.subscribe_id = null;
SlateNextbox.subscribe_checked = false;
SlateNextbox.shown = false;

SlateNextbox.getScrollY = function () {
    scrOfY = 0;
    if( typeof( window.pageYOffset ) == "number" ) {
        scrOfY = window.pageYOffset;
    } else if( document.body && ( document.body.scrollLeft || document.body.scrollTop ) ) {
        scrOfY = document.body.scrollTop;
    } else if( document.documentElement && ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
        scrOfY = document.documentElement.scrollTop;
    }
    return scrOfY;
}


SlateNextbox.checkMySlate = function() {
    //console.log("checkMySlate called");
    if (SlateNextbox.mySlateDataChecked) {
        return;
    }
    SlateNextbox.mySlateDataChecked = true;

    if (!MySlateData || !MySlateData.isActiveUser || $("#nextbox_trigger").size() == 0) {
        return false;
    }

    if (typeof SlateNextbox.data != "undefined") {
        SlateNextbox.subscribe_type = SlateNextbox.data.subscribe_type;
        SlateNextbox.subscribe_id = SlateNextbox.data.section;
        SlateNextbox.subscribe_checked = false;
        SlateNextbox.prompt = "subscribe";
    } else {
        SlateNextbox.prompt = "none";
    }

    //console.log("Adjusting MySlate Data");

    if (MySlateData.queue && MySlateData.queue.articles && MySlateData.queue.articles.length > 0) {
        ////console.log("Replacing default Nextbox data with MySlateData Queue");
        var article = MySlateData.queue.articles[0];
        SlateNextbox.data.section = "Your MySlate Queue";
        SlateNextbox.data.headline = article.fields.hed;
        SlateNextbox.data.subhead = article.fields.dek;
        SlateNextbox.data.article_id = article.fields.article_id;
        SlateNextbox.data.url = article.fields.url.replace("mobile.slate.com", "www.slate.com");
        SlateNextbox.data.image = article.fields.thumbnail.replace("thumbnail-small", "rectangle-small");
    }

    ////console.log("CheckDupes running...");
    ////console.log(MySlateData.subscriptionData);
    if (typeof MySlateData.subscriptions != "undefined" && typeof SlateNextbox.data != "undefined") {
        SlateNextbox.prompt = "subscribe";
        // Check if already subscribed
        for (var i = 0; i < MySlateData.subscriptions.length; i++) {
            var item = MySlateData.subscriptions[i];
            //console.log("Comparing " + SlateNextbox.subscribe_id + " to " + item.display_name);
            //console.log("Types: " + item.type + " and " + SlateNextbox.subscribe_type);
            if (item.type == SlateNextbox.subscribe_type &&
                item.display_name.toLowerCase() == SlateNextbox.subscribe_id.toLowerCase()) {
                //FFFFFFOUND!
                //console.log("FFFFFFOUND");
                //SlateNextbox.prompt = "none";
                SlateNextbox.subscribe_checked = true;
            }
        }
    }

    SlateNextbox.createNextbox();
}


SlateNextbox.createNextbox = function() {
    if ($("#nextbox_trigger").size() == 0 || !SlateNextbox.data) {
        //log("Pre-emptive exit. " + $("#nextbox_trigger").size() + " " + SlateNextbox.data);
        return;
    }

    var html = SlateNextbox.html();
    $("#nextbox").remove();
    $("#nextbox_trigger").append(html);
    if (SlateNextbox.animation == "flyout") {
        $("#nextbox").hide();
    }
    SlateNextbox.upprev_closed = false;
    SlateNextbox.upprev_hidden = true;

    // Set up event listeners
    $(window).scroll(function() {
        var lastScreen;
        lastScreen = SlateNextbox.getScrollY() + $(window).height() < ($(SlateNextbox.element_selector).offset().top + SlateNextbox.element_offset) * (SlateNextbox.offset / 100) ? false : true;

        if (lastScreen && !SlateNextbox.upprev_closed) {
            if (SlateNextbox.animation == "fade") {
                $("#nextbox").fadeIn("slow", function() {
                    if (!SlateNextbox.shown) {
                        $("#nextbox").parent().track();
                        SlateNextbox.shown = true;
                    }
                });
            } else {
                $("#nextbox").show();
                $("#nextbox").stop().animate({right:"30px"}, function() {
                    if (!SlateNextbox.shown) {
                        $("#nextbox").parent().track();
                        SlateNextbox.shown = true;
                    }
                });
            }
            SlateNextbox.upprev_hidden = false;
        }
        else if (SlateNextbox.upprev_closed && SlateNextbox.getScrollY() == 0) {
            SlateNextbox.upprev_closed = false;
        }
        else if (!SlateNextbox.upprev_hidden) {
            SlateNextbox.upprev_hidden = true;

            if (SlateNextbox.animation == "fade")
                $("#nextbox").fadeOut("slow");
            else
                $("#nextbox").stop().animate({right:"-450px"});
        }
    });



    $("#nextbox_close").click(function() {
        if (SlateNextbox.animation == "fade")
            $("#nextbox").fadeOut("slow");
        else
            $("#nextbox").stop().animate({right:"-450px"});

        SlateNextbox.upprev_closed = true;
        SlateNextbox.upprev_hidden = true;
    });

    $("#nextbox-prompt-checkbox").change(function() {
        $(this).css('visibility','hidden');
        $("#nextbox .article-prompt").prepend('<img src="/etc/designs/slate/images/ajax-loader.gif" id="nextbox-ajax-loader"/>');

        if (!SlateNextbox.subscribe_checked) {
            MySlateData.saveSubscription(
                SlateNextbox.subscribe_type,
                SlateNextbox.subscribe_id,
                function (success) {
                    $("#nextbox-ajax-loader").remove();
                    var prompt = $("#nextbox .article-prompt-text")
                    prompt.animate({'opacity':0}, {'speed': 'slow', 'complete': function() {
                        if (success) {
                            prompt.html("You are subscribed to " +
                                        SlateNextbox.subscribe_id)
                            $("#nextbox-prompt-checkbox").css('visibility', 'visible').css("margin-right", "3px");
                            $("#nextbox-ajax-loader").remove();
                            SlateNextbox.subscribe_checked = true;
                        } else {
                            prompt.html("You could not be subscribed to that section.")
                        }
                        prompt.animate({'opacity':100}, 'slow');
                    }});
            });
        } else {
            MySlateData.removeSubscription(
                SlateNextbox.subscribe_type,
                SlateNextbox.subscribe_id,
                function (success) {
                    $("#nextbox-ajax-loader").remove();
                    var prompt = $("#nextbox .article-prompt-text")
                    prompt.animate({'opacity':0}, {'speed': 'slow', 'complete': function() {
                        if (success) {
                            prompt.html('Follow all ' + SlateNextbox.subscribe_id + ' stories on MySlate.');
                            $("#nextbox-prompt-checkbox").css('visibility', 'visible').css("margin-right", "3px");
                            $("#nextbox-ajax-loader").remove();
                            SlateNextbox.subscribe_checked = false;

                        } else {
                            prompt.html("You could not be unsubscribed from that section.")
                        }
                        prompt.animate({'opacity':100}, 'slow');
                    }});
            });

        }
    });
}

SlateNextbox.html = function() {
    var html = '<div track-module="nextbox" id="nextbox" ' + (SlateNextbox.data.hasImage ? '' : 'class="nextbox-no-image"') + '><iframe id="nextbox-iframe"></iframe><div id="nextbox-inner"><div class="meta-data"><div id="nextbox_close">&nbsp;</div>Next item in <span class="category">' + SlateNextbox.data.section +'</span>: </div><div class="nextbox-body" track-data=\'{"id": ' + SlateNextbox.data.article_id + ', "module":"nextbox" }\'>';

    if (SlateNextbox.data.hasImage) {
        html += '<div class="article-image"><a href="' + SlateNextbox.data.url + '?wpisrc=nextbox"><img src="' +  SlateNextbox.data.image +'" height="78" width="128" /></a></div>'
    }

    html += '<div class="article-text ' + (SlateNextbox.data.hasImage ? '' : 'article-text-no-image') + '"><div class="article-link"><a href="' + SlateNextbox.data.url +'?wpisrc=nextbox">' + SlateNextbox.data.headline + '</a></div><div class="article-other"><span class="article-dek">' + SlateNextbox.data.subhead + '</span><div class="article-prompt">';

    if (SlateNextbox.prompt == "signup") {
        html += '<a href="http://www.slate.com/myslate.html">Sign up for MySlate</a> to follow all ' + SlateNextbox.data.section + ' stories.';
    }
    else if (SlateNextbox.prompt == "subscribe") {
        if (SlateNextbox.subscribe_checked) {
            html += '<input type="checkbox" id="nextbox-prompt-checkbox" checked="checked" /><span class="article-prompt-text">You are subscribed to ' + SlateNextbox.subscribe_id + '</span>';
        } else {
            html += '<input type="checkbox" id="nextbox-prompt-checkbox" /><span class="article-prompt-text"> Follow all ' + SlateNextbox.subscribe_id + ' stories on MySlate.</span>';
        }
    }

    html += '</div></div></div><br style="clear: both;" /></div></div></div>';
    return html;
}


$(document).ready(function() {
    SlateNextbox.createNextbox();
});

$(window).bind('MySlateData.Fetch', SlateNextbox.checkMySlate);
(function($) {
  $.fn.track = function() {
	var urls = [];
	if (typeof(wapoEvent) === "undefined") {
		return;
	}
	this.find('[track-module]').each(function(idx, container) {
		container = $(container);
		if (container.is(":visible")) {
			container.find('[track-data]').each(function(idx2, link) {
				var link_data;
				link = $(link);
				try {
					link_data = $.parseJSON(link.attr('track-data'));
					urls.push(link_data)
				} catch (e) {
					return;
				}
				link.bind('click', function() {
					wapoEvent.logEvent('Click', 'SGCTR', $.parseJSON($(this).attr('track-data')));
				});
			});
		}
	});
	if (urls.length > 0) {
		wapoEvent.logEvent( 'View', 'SGCTR', urls);
	}

  };
})(jQuery);

// track on initialization
$(document).ready(function() {
	$(document).track();
});

/**
* hoverIntent r6 // 2011.02.26 // jQuery 1.5.1+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne brian(at)cherne(dot)net
*/
(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind('mouseenter',handleHover).bind('mouseleave',handleHover)}})(jQuery);
(function(a){a.fn.example=function(e,c){var d=a.isFunction(e);var b=a.extend({},c,{example:e});return this.each(function(){var f=a(this);if(a.metadata){var g=a.extend({},a.fn.example.defaults,f.metadata(),b)}else{var g=a.extend({},a.fn.example.defaults,b)}if(!a.fn.example.boundClassNames[g.className]){a(window).unload(function(){a("."+g.className).val("")});a("form").submit(function(){a(this).find("."+g.className).val("")});a.fn.example.boundClassNames[g.className]=true}if(!f.attr("defaultValue")&&(d||f.val()==g.example)){f.val("")}if(f.val()==""&&this!=document.activeElement){f.addClass(g.className);f.val(d?g.example.call(this):g.example)}f.focus(function(){if(a(this).is("."+g.className)){a(this).val("");a(this).removeClass(g.className)}});f.change(function(){if(a(this).is("."+g.className)){a(this).removeClass(g.className)}});f.blur(function(){if(a(this).val()==""){a(this).addClass(g.className);a(this).val(d?g.example.call(this):g.example)}})})};a.fn.example.defaults={className:"example"};a.fn.example.boundClassNames=[]})(jQuery);/*
* jQuery Form Plugin
* version: 2.52 (07-DEC-2010)
* @requires jQuery v1.3.2 or later
*
* Examples and documentation at: http://malsup.com/jquery/form/
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*/
(function(b){b.fn.ajaxSubmit=function(t){if(!this.length){a("ajaxSubmit: skipping submit process - no element selected");return this}if(typeof t=="function"){t={success:t}}var h=this.attr("action");var d=(typeof h==="string")?b.trim(h):"";if(d){d=(d.match(/^([^#]+)/)||[])[1]}d=d||window.location.href||"";t=b.extend(true,{url:d,type:this.attr("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var u={};this.trigger("form-pre-serialize",[this,t,u]);if(u.veto){a("ajaxSubmit: submit vetoed via form-pre-serialize trigger");return this}if(t.beforeSerialize&&t.beforeSerialize(this,t)===false){a("ajaxSubmit: submit aborted via beforeSerialize callback");return this}var f,p,m=this.formToArray(t.semantic);if(t.data){t.extraData=t.data;for(f in t.data){if(t.data[f] instanceof Array){for(var i in t.data[f]){m.push({name:f,value:t.data[f][i]})}}else{p=t.data[f];p=b.isFunction(p)?p():p;m.push({name:f,value:p})}}}if(t.beforeSubmit&&t.beforeSubmit(m,this,t)===false){a("ajaxSubmit: submit aborted via beforeSubmit callback");return this}this.trigger("form-submit-validate",[m,this,t,u]);if(u.veto){a("ajaxSubmit: submit vetoed via form-submit-validate trigger");return this}var c=b.param(m);if(t.type.toUpperCase()=="GET"){t.url+=(t.url.indexOf("?")>=0?"&":"?")+c;t.data=null}else{t.data=c}var s=this,l=[];if(t.resetForm){l.push(function(){s.resetForm()})}if(t.clearForm){l.push(function(){s.clearForm()})}if(!t.dataType&&t.target){var r=t.success||function(){};l.push(function(n){var k=t.replaceTarget?"replaceWith":"html";b(t.target)[k](n).each(r,arguments)})}else{if(t.success){l.push(t.success)}}t.success=function(w,n,x){var v=t.context||t;for(var q=0,k=l.length;q<k;q++){l[q].apply(v,[w,n,x||s,s])}};var g=b("input:file",this).length>0;var e="multipart/form-data";var j=(s.attr("enctype")==e||s.attr("encoding")==e);if(t.iframe!==false&&(g||t.iframe||j)){if(t.closeKeepAlive){b.get(t.closeKeepAlive,o)}else{o()}}else{b.ajax(t)}this.trigger("form-submit-notify",[this,t]);return this;function o(){var k=s[0];if(b(":input[name=submit],:input[id=submit]",k).length){alert('Error: Form elements must not have name or id of "submit".');return}var z=b.extend(true,{},b.ajaxSettings,t);z.context=z.context||z;var C="jqFormIO"+(new Date().getTime()),x="_"+C;window[x]=function(){var n=q.data("form-plugin-onload");if(n){n();window[x]=undefined;try{delete window[x]}catch(L){}}};var q=b('<iframe id="'+C+'" name="'+C+'" src="'+z.iframeSrc+'" onload="window[\'_\'+this.id]()" />');var y=q[0];q.css({position:"absolute",top:"-1000px",left:"-1000px"});var v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1;q.attr("src",z.iframeSrc)}};var H=z.global;if(H&&!b.active++){b.event.trigger("ajaxStart")}if(H){b.event.trigger("ajaxSend",[v,z])}if(z.beforeSend&&z.beforeSend.call(z.context,v,z)===false){if(z.global){b.active--}return}if(v.aborted){return}var D=false;var G=0;var w=k.clk;if(w){var E=w.name;if(E&&!w.disabled){z.extraData=z.extraData||{};z.extraData[E]=w.value;if(w.type=="image"){z.extraData[E+".x"]=k.clk_x;z.extraData[E+".y"]=k.clk_y}}}function F(){var N=s.attr("target"),L=s.attr("action");k.setAttribute("target",C);if(k.getAttribute("method")!="POST"){k.setAttribute("method","POST")}if(k.getAttribute("action")!=z.url){k.setAttribute("action",z.url)}if(!z.skipEncodingOverride){s.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"})}if(z.timeout){setTimeout(function(){G=true;B()},z.timeout)}var M=[];try{if(z.extraData){for(var O in z.extraData){M.push(b('<input type="hidden" name="'+O+'" value="'+z.extraData[O]+'" />').appendTo(k)[0])}}q.appendTo("body");q.data("form-plugin-onload",B);k.submit()}finally{k.setAttribute("action",L);if(N){k.setAttribute("target",N)}else{s.removeAttr("target")}b(M).remove()}}if(z.forceSync){F()}else{setTimeout(F,10)}var J,K,I=50;function B(){if(D){return}q.removeData("form-plugin-onload");var M=true;try{if(G){throw"timeout"}K=y.contentWindow?y.contentWindow.document:y.contentDocument?y.contentDocument:y.document;var Q=z.dataType=="xml"||K.XMLDocument||b.isXMLDoc(K);a("isXml="+Q);if(!Q&&window.opera&&(K.body==null||K.body.innerHTML=="")){if(--I){a("requeing onLoad callback, DOM not available");setTimeout(B,250);return}}D=true;v.responseText=K.documentElement?K.documentElement.innerHTML:null;v.responseXML=K.XMLDocument?K.XMLDocument:K;v.getResponseHeader=function(S){var R={"content-type":z.dataType};return R[S]};var P=/(json|script)/.test(z.dataType);if(P||z.textarea){var L=K.getElementsByTagName("textarea")[0];if(L){v.responseText=L.value}else{if(P){var O=K.getElementsByTagName("pre")[0];var n=K.getElementsByTagName("body")[0];if(O){v.responseText=O.textContent}else{if(n){v.responseText=n.innerHTML}}}}}else{if(z.dataType=="xml"&&!v.responseXML&&v.responseText!=null){v.responseXML=A(v.responseText)}}J=b.httpData(v,z.dataType)}catch(N){a("error caught:",N);M=false;v.error=N;b.handleError(z,v,"error",N)}if(v.aborted){a("upload aborted");M=false}if(M){z.success.call(z.context,J,"success",v);if(H){b.event.trigger("ajaxSuccess",[v,z])}}if(H){b.event.trigger("ajaxComplete",[v,z])}if(H&&!--b.active){b.event.trigger("ajaxStop")}if(z.complete){z.complete.call(z.context,v,M?"success":"error")}setTimeout(function(){q.removeData("form-plugin-onload");q.remove();v.responseXML=null},100)}function A(n,L){if(window.ActiveXObject){L=new ActiveXObject("Microsoft.XMLDOM");L.async="false";L.loadXML(n)}else{L=(new DOMParser()).parseFromString(n,"text/xml")}return(L&&L.documentElement&&L.documentElement.tagName!="parsererror")?L:null}}};b.fn.ajaxForm=function(c){if(this.length===0){var d={s:this.selector,c:this.context};if(!b.isReady&&d.s){a("DOM not ready, queuing ajaxForm");b(function(){b(d.s,d.c).ajaxForm(c)});return this}a("terminating; zero elements found by selector"+(b.isReady?"":" (DOM not ready)"));return this}return this.ajaxFormUnbind().bind("submit.form-plugin",function(f){if(!f.isDefaultPrevented()){f.preventDefault();b(this).ajaxSubmit(c)}}).bind("click.form-plugin",function(j){var i=j.target;var g=b(i);if(!(g.is(":submit,input:image"))){var f=g.closest(":submit");if(f.length==0){return}i=f[0]}var h=this;h.clk=i;if(i.type=="image"){if(j.offsetX!=undefined){h.clk_x=j.offsetX;h.clk_y=j.offsetY}else{if(typeof b.fn.offset=="function"){var k=g.offset();h.clk_x=j.pageX-k.left;h.clk_y=j.pageY-k.top}else{h.clk_x=j.pageX-i.offsetLeft;h.clk_y=j.pageY-i.offsetTop}}}setTimeout(function(){h.clk=h.clk_x=h.clk_y=null},100)})};b.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")};b.fn.formToArray=function(q){var p=[];if(this.length===0){return p}var d=this[0];var g=q?d.getElementsByTagName("*"):d.elements;if(!g){return p}var k,h,f,r,e,m,c;for(k=0,m=g.length;k<m;k++){e=g[k];f=e.name;if(!f){continue}if(q&&d.clk&&e.type=="image"){if(!e.disabled&&d.clk==e){p.push({name:f,value:b(e).val()});p.push({name:f+".x",value:d.clk_x},{name:f+".y",value:d.clk_y})}continue}r=b.fieldValue(e,true);if(r&&r.constructor==Array){for(h=0,c=r.length;h<c;h++){p.push({name:f,value:r[h]})}}else{if(r!==null&&typeof r!="undefined"){p.push({name:f,value:r})}}}if(!q&&d.clk){var l=b(d.clk),o=l[0];f=o.name;if(f&&!o.disabled&&o.type=="image"){p.push({name:f,value:l.val()});p.push({name:f+".x",value:d.clk_x},{name:f+".y",value:d.clk_y})}}return p};b.fn.formSerialize=function(c){return b.param(this.formToArray(c))};b.fn.fieldSerialize=function(d){var c=[];this.each(function(){var h=this.name;if(!h){return}var f=b.fieldValue(this,d);if(f&&f.constructor==Array){for(var g=0,e=f.length;g<e;g++){c.push({name:h,value:f[g]})}}else{if(f!==null&&typeof f!="undefined"){c.push({name:this.name,value:f})}}});return b.param(c)};b.fn.fieldValue=function(h){for(var g=[],e=0,c=this.length;e<c;e++){var f=this[e];var d=b.fieldValue(f,h);if(d===null||typeof d=="undefined"||(d.constructor==Array&&!d.length)){continue}d.constructor==Array?b.merge(g,d):g.push(d)}return g};b.fieldValue=function(c,j){var e=c.name,p=c.type,q=c.tagName.toLowerCase();if(j===undefined){j=true}if(j&&(!e||c.disabled||p=="reset"||p=="button"||(p=="checkbox"||p=="radio")&&!c.checked||(p=="submit"||p=="image")&&c.form&&c.form.clk!=c||q=="select"&&c.selectedIndex==-1)){return null}if(q=="select"){var k=c.selectedIndex;if(k<0){return null}var m=[],d=c.options;var g=(p=="select-one");var l=(g?k+1:d.length);for(var f=(g?k:0);f<l;f++){var h=d[f];if(h.selected){var o=h.value;if(!o){o=(h.attributes&&h.attributes.value&&!(h.attributes.value.specified))?h.text:h.value}if(g){return o}m.push(o)}}return m}return b(c).val()};b.fn.clearForm=function(){return this.each(function(){b("input,select,textarea",this).clearFields()})};b.fn.clearFields=b.fn.clearInputs=function(){return this.each(function(){var d=this.type,c=this.tagName.toLowerCase();if(d=="text"||d=="password"||c=="textarea"){this.value=""}else{if(d=="checkbox"||d=="radio"){this.checked=false}else{if(c=="select"){this.selectedIndex=-1}}}})};b.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};b.fn.enable=function(c){if(c===undefined){c=true}return this.each(function(){this.disabled=!c})};b.fn.selected=function(c){if(c===undefined){c=true}return this.each(function(){var d=this.type;if(d=="checkbox"||d=="radio"){this.checked=c}else{if(this.tagName.toLowerCase()=="option"){var e=b(this).parent("select");if(c&&e[0]&&e[0].type=="select-one"){e.find("option").selected(false)}this.selected=c}}})};function a(){if(b.fn.ajaxSubmit.debug){var c="[jquery.form] "+Array.prototype.join.call(arguments,"");if(window.console&&window.console.log){window.console.log(c)}else{if(window.opera&&window.opera.postError){window.opera.postError(c)}}}}})(jQuery);

/**
 * jQuery Validation Plugin 1.8.1
 *
 * http://bassistance.de/jquery-plugins/jquery-plugin-validation/
 * http://docs.jquery.com/Plugins/Validation
 *
 * Copyright (c) 2006 - 2011 J????rn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function(c){c.extend(c.fn,{validate:function(a){if(this.length){var b=c.data(this[0],"validator");if(b)return b;b=new c.validator(a,this[0]);c.data(this[0],"validator",b);if(b.settings.onsubmit){this.find("input, button").filter(".cancel").click(function(){b.cancelSubmit=true});b.settings.submitHandler&&this.find("input, button").filter(":submit").click(function(){b.submitButton=this});this.submit(function(d){function e(){if(b.settings.submitHandler){if(b.submitButton)var f=c("<input type='hidden'/>").attr("name",
b.submitButton.name).val(b.submitButton.value).appendTo(b.currentForm);b.settings.submitHandler.call(b,b.currentForm);b.submitButton&&f.remove();return false}return true}b.settings.debug&&d.preventDefault();if(b.cancelSubmit){b.cancelSubmit=false;return e()}if(b.form()){if(b.pendingRequest){b.formSubmitted=true;return false}return e()}else{b.focusInvalid();return false}})}return b}else a&&a.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing")},valid:function(){if(c(this[0]).is("form"))return this.validate().form();
else{var a=true,b=c(this[0].form).validate();this.each(function(){a&=b.element(this)});return a}},removeAttrs:function(a){var b={},d=this;c.each(a.split(/\s/),function(e,f){b[f]=d.attr(f);d.removeAttr(f)});return b},rules:function(a,b){var d=this[0];if(a){var e=c.data(d.form,"validator").settings,f=e.rules,g=c.validator.staticRules(d);switch(a){case "add":c.extend(g,c.validator.normalizeRule(b));f[d.name]=g;if(b.messages)e.messages[d.name]=c.extend(e.messages[d.name],b.messages);break;case "remove":if(!b){delete f[d.name];
return g}var h={};c.each(b.split(/\s/),function(j,i){h[i]=g[i];delete g[i]});return h}}d=c.validator.normalizeRules(c.extend({},c.validator.metadataRules(d),c.validator.classRules(d),c.validator.attributeRules(d),c.validator.staticRules(d)),d);if(d.required){e=d.required;delete d.required;d=c.extend({required:e},d)}return d}});c.extend(c.expr[":"],{blank:function(a){return!c.trim(""+a.value)},filled:function(a){return!!c.trim(""+a.value)},unchecked:function(a){return!a.checked}});c.validator=function(a,
b){this.settings=c.extend(true,{},c.validator.defaults,a);this.currentForm=b;this.init()};c.validator.format=function(a,b){if(arguments.length==1)return function(){var d=c.makeArray(arguments);d.unshift(a);return c.validator.format.apply(this,d)};if(arguments.length>2&&b.constructor!=Array)b=c.makeArray(arguments).slice(1);if(b.constructor!=Array)b=[b];c.each(b,function(d,e){a=a.replace(RegExp("\\{"+d+"\\}","g"),e)});return a};c.extend(c.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",
validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:c([]),errorLabelContainer:c([]),onsubmit:true,ignore:[],ignoreTitle:false,onfocusin:function(a){this.lastActive=a;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(a)).hide()}},onfocusout:function(a){if(!this.checkable(a)&&(a.name in this.submitted||!this.optional(a)))this.element(a)},
onkeyup:function(a){if(a.name in this.submitted||a==this.lastElement)this.element(a)},onclick:function(a){if(a.name in this.submitted)this.element(a);else a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(a,b,d){a.type==="radio"?this.findByName(a.name).addClass(b).removeClass(d):c(a).addClass(b).removeClass(d)},unhighlight:function(a,b,d){a.type==="radio"?this.findByName(a.name).removeClass(b).addClass(d):c(a).removeClass(b).addClass(d)}},setDefaults:function(a){c.extend(c.validator.defaults,
a)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:c.validator.format("Please enter no more than {0} characters."),
minlength:c.validator.format("Please enter at least {0} characters."),rangelength:c.validator.format("Please enter a value between {0} and {1} characters long."),range:c.validator.format("Please enter a value between {0} and {1}."),max:c.validator.format("Please enter a value less than or equal to {0}."),min:c.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){function a(e){var f=c.data(this[0].form,"validator");e="on"+e.type.replace(/^validate/,
"");f.settings[e]&&f.settings[e].call(f,this[0])}this.labelContainer=c(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||c(this.currentForm);this.containers=c(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var b=this.groups={};c.each(this.settings.groups,function(e,f){c.each(f.split(/\s/),function(g,h){b[h]=e})});var d=this.settings.rules;
c.each(d,function(e,f){d[e]=c.validator.normalizeRule(f)});c(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",a).validateDelegate(":radio, :checkbox, select, option","click",a);this.settings.invalidHandler&&c(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){this.checkForm();c.extend(this.submitted,this.errorMap);this.invalid=c.extend({},this.errorMap);this.valid()||c(this.currentForm).triggerHandler("invalid-form",
[this]);this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(a){this.lastElement=a=this.clean(a);this.prepareElement(a);this.currentElements=c(a);var b=this.check(a);if(b)delete this.invalid[a.name];else this.invalid[a.name]=true;if(!this.numberOfInvalids())this.toHide=this.toHide.add(this.containers);this.showErrors();return b},showErrors:function(a){if(a){c.extend(this.errorMap,
a);this.errorList=[];for(var b in a)this.errorList.push({message:a[b],element:this.findByName(b)[0]});this.successList=c.grep(this.successList,function(d){return!(d.name in a)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){c.fn.resetForm&&c(this.currentForm).resetForm();this.submitted={};this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},
objectLength:function(a){var b=0,d;for(d in a)b++;return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{c(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(a){}},findLastActive:function(){var a=this.lastActive;return a&&c.grep(this.errorList,function(b){return b.element.name==
a.name}).length==1&&a},elements:function(){var a=this,b={};return c(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&a.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!a.objectLength(c(this).rules()))return false;return b[this.name]=true})},clean:function(a){return c(a)[0]},errors:function(){return c(this.settings.errorElement+"."+this.settings.errorClass,
this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=c([]);this.toHide=c([]);this.currentElements=c([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset();this.toHide=this.errorsFor(a)},check:function(a){a=this.clean(a);if(this.checkable(a))a=this.findByName(a.name).not(this.settings.ignore)[0];var b=c(a).rules(),d=false,e;for(e in b){var f={method:e,parameters:b[e]};try{var g=
c.validator.methods[e].call(this,a.value.replace(/\r/g,""),a,f.parameters);if(g=="dependency-mismatch")d=true;else{d=false;if(g=="pending"){this.toHide=this.toHide.not(this.errorsFor(a));return}if(!g){this.formatAndAdd(a,f);return false}}}catch(h){this.settings.debug&&window.console&&console.log("exception occured when checking element "+a.id+", check the '"+f.method+"' method",h);throw h;}}if(!d){this.objectLength(b)&&this.successList.push(a);return true}},customMetaMessage:function(a,b){if(c.metadata){var d=
this.settings.meta?c(a).metadata()[this.settings.meta]:c(a).metadata();return d&&d.messages&&d.messages[b]}},customMessage:function(a,b){var d=this.settings.messages[a];return d&&(d.constructor==String?d:d[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(arguments[a]!==undefined)return arguments[a]},defaultMessage:function(a,b){return this.findDefined(this.customMessage(a.name,b),this.customMetaMessage(a,b),!this.settings.ignoreTitle&&a.title||undefined,c.validator.messages[b],"<strong>Warning: No message defined for "+
a.name+"</strong>")},formatAndAdd:function(a,b){var d=this.defaultMessage(a,b.method),e=/\$?\{(\d+)\}/g;if(typeof d=="function")d=d.call(this,b.parameters,a);else if(e.test(d))d=jQuery.format(d.replace(e,"{$1}"),b.parameters);this.errorList.push({message:d,element:a});this.errorMap[a.name]=d;this.submitted[a.name]=d},addWrapper:function(a){if(this.settings.wrapper)a=a.add(a.parent(this.settings.wrapper));return a},defaultShowErrors:function(){for(var a=0;this.errorList[a];a++){var b=this.errorList[a];
this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass);this.showLabel(b.element,b.message)}if(this.errorList.length)this.toShow=this.toShow.add(this.containers);if(this.settings.success)for(a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight){a=0;for(b=this.validElements();b[a];a++)this.settings.unhighlight.call(this,b[a],this.settings.errorClass,this.settings.validClass)}this.toHide=this.toHide.not(this.toShow);
this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return c(this.errorList).map(function(){return this.element})},showLabel:function(a,b){var d=this.errorsFor(a);if(d.length){d.removeClass().addClass(this.settings.errorClass);d.attr("generated")&&d.html(b)}else{d=c("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(a),generated:true}).addClass(this.settings.errorClass).html(b||
"");if(this.settings.wrapper)d=d.hide().show().wrap("<"+this.settings.wrapper+"/>").parent();this.labelContainer.append(d).length||(this.settings.errorPlacement?this.settings.errorPlacement(d,c(a)):d.insertAfter(a))}if(!b&&this.settings.success){d.text("");typeof this.settings.success=="string"?d.addClass(this.settings.success):this.settings.success(d)}this.toShow=this.toShow.add(d)},errorsFor:function(a){var b=this.idOrName(a);return this.errors().filter(function(){return c(this).attr("for")==b})},
idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(a){var b=this.currentForm;return c(document.getElementsByName(a)).map(function(d,e){return e.form==b&&e.name==a&&e||null})},getLength:function(a,b){switch(b.nodeName.toLowerCase()){case "select":return c("option:selected",b).length;case "input":if(this.checkable(b))return this.findByName(b.name).filter(":checked").length}return a.length},
depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):true},dependTypes:{"boolean":function(a){return a},string:function(a,b){return!!c(a,b.form).length},"function":function(a,b){return a(b)}},optional:function(a){return!c.validator.methods.required.call(this,c.trim(a.value),a)&&"dependency-mismatch"},startRequest:function(a){if(!this.pending[a.name]){this.pendingRequest++;this.pending[a.name]=true}},stopRequest:function(a,b){this.pendingRequest--;if(this.pendingRequest<
0)this.pendingRequest=0;delete this.pending[a.name];if(b&&this.pendingRequest==0&&this.formSubmitted&&this.form()){c(this.currentForm).submit();this.formSubmitted=false}else if(!b&&this.pendingRequest==0&&this.formSubmitted){c(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}},previousValue:function(a){return c.data(a,"previousValue")||c.data(a,"previousValue",{old:null,valid:true,message:this.defaultMessage(a,"remote")})}},classRuleSettings:{required:{required:true},
email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(a,b){a.constructor==String?this.classRuleSettings[a]=b:c.extend(this.classRuleSettings,a)},classRules:function(a){var b={};(a=c(a).attr("class"))&&c.each(a.split(" "),function(){this in c.validator.classRuleSettings&&c.extend(b,c.validator.classRuleSettings[this])});return b},attributeRules:function(a){var b=
{};a=c(a);for(var d in c.validator.methods){var e=a.attr(d);if(e)b[d]=e}b.maxlength&&/-1|2147483647|524288/.test(b.maxlength)&&delete b.maxlength;return b},metadataRules:function(a){if(!c.metadata)return{};var b=c.data(a.form,"validator").settings.meta;return b?c(a).metadata()[b]:c(a).metadata()},staticRules:function(a){var b={},d=c.data(a.form,"validator");if(d.settings.rules)b=c.validator.normalizeRule(d.settings.rules[a.name])||{};return b},normalizeRules:function(a,b){c.each(a,function(d,e){if(e===
false)delete a[d];else if(e.param||e.depends){var f=true;switch(typeof e.depends){case "string":f=!!c(e.depends,b.form).length;break;case "function":f=e.depends.call(b,b)}if(f)a[d]=e.param!==undefined?e.param:true;else delete a[d]}});c.each(a,function(d,e){a[d]=c.isFunction(e)?e(b):e});c.each(["minlength","maxlength","min","max"],function(){if(a[this])a[this]=Number(a[this])});c.each(["rangelength","range"],function(){if(a[this])a[this]=[Number(a[this][0]),Number(a[this][1])]});if(c.validator.autoCreateRanges){if(a.min&&
a.max){a.range=[a.min,a.max];delete a.min;delete a.max}if(a.minlength&&a.maxlength){a.rangelength=[a.minlength,a.maxlength];delete a.minlength;delete a.maxlength}}a.messages&&delete a.messages;return a},normalizeRule:function(a){if(typeof a=="string"){var b={};c.each(a.split(/\s/),function(){b[this]=true});a=b}return a},addMethod:function(a,b,d){c.validator.methods[a]=b;c.validator.messages[a]=d!=undefined?d:c.validator.messages[a];b.length<3&&c.validator.addClassRules(a,c.validator.normalizeRule(a))},
methods:{required:function(a,b,d){if(!this.depend(d,b))return"dependency-mismatch";switch(b.nodeName.toLowerCase()){case "select":return(a=c(b).val())&&a.length>0;case "input":if(this.checkable(b))return this.getLength(a,b)>0;default:return c.trim(a).length>0}},remote:function(a,b,d){if(this.optional(b))return"dependency-mismatch";var e=this.previousValue(b);this.settings.messages[b.name]||(this.settings.messages[b.name]={});e.originalMessage=this.settings.messages[b.name].remote;this.settings.messages[b.name].remote=
e.message;d=typeof d=="string"&&{url:d}||d;if(this.pending[b.name])return"pending";if(e.old===a)return e.valid;e.old=a;var f=this;this.startRequest(b);var g={};g[b.name]=a;c.ajax(c.extend(true,{url:d,mode:"abort",port:"validate"+b.name,dataType:"json",data:g,success:function(h){f.settings.messages[b.name].remote=e.originalMessage;var j=h===true;if(j){var i=f.formSubmitted;f.prepareElement(b);f.formSubmitted=i;f.successList.push(b);f.showErrors()}else{i={};h=h||f.defaultMessage(b,"remote");i[b.name]=
e.message=c.isFunction(h)?h(a):h;f.showErrors(i)}e.valid=j;f.stopRequest(b,j)}},d));return"pending"},minlength:function(a,b,d){return this.optional(b)||this.getLength(c.trim(a),b)>=d},maxlength:function(a,b,d){return this.optional(b)||this.getLength(c.trim(a),b)<=d},rangelength:function(a,b,d){a=this.getLength(c.trim(a),b);return this.optional(b)||a>=d[0]&&a<=d[1]},min:function(a,b,d){return this.optional(b)||a>=d},max:function(a,b,d){return this.optional(b)||a<=d},range:function(a,b,d){return this.optional(b)||
a>=d[0]&&a<=d[1]},email:function(a,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},
url:function(a,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a))},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9-]+/.test(a))return false;var d=0,e=0,f=false;a=a.replace(/\D/g,"");for(var g=a.length-1;g>=
0;g--){e=a.charAt(g);e=parseInt(e,10);if(f)if((e*=2)>9)e-=9;d+=e;f=!f}return d%10==0},accept:function(a,b,d){d=typeof d=="string"?d.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||a.match(RegExp(".("+d+")$","i"))},equalTo:function(a,b,d){d=c(d).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){c(b).valid()});return a==d.val()}}});c.format=c.validator.format})(jQuery);
(function(c){var a={};if(c.ajaxPrefilter)c.ajaxPrefilter(function(d,e,f){e=d.port;if(d.mode=="abort"){a[e]&&a[e].abort();a[e]=f}});else{var b=c.ajax;c.ajax=function(d){var e=("port"in d?d:c.ajaxSettings).port;if(("mode"in d?d:c.ajaxSettings).mode=="abort"){a[e]&&a[e].abort();return a[e]=b.apply(this,arguments)}return b.apply(this,arguments)}}})(jQuery);
(function(c){!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(e){e=c.event.fix(e);e.type=b;return c.event.handle.call(this,e)}c.event.special[b]={setup:function(){this.addEventListener(a,d,true)},teardown:function(){this.removeEventListener(a,d,true)},handler:function(e){arguments[0]=c.event.fix(e);arguments[0].type=b;return c.event.handle.apply(this,arguments)}}});c.extend(c.fn,{validateDelegate:function(a,
b,d){return this.bind(b,function(e){var f=c(e.target);if(f.is(a))return d.apply(f,arguments)})}})})(jQuery);


// BEGIN MC SIGNUP CODE
var fnames = new Array();var ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';var err_style = '';
try{
    err_style = mc_custom_error_style;
} catch(e){
    err_style = 'margin: 1em 0 0 0; padding: 1em 0.5em 0.5em 0.5em; background: ERROR_BGCOLOR none repeat scroll 0% 0%; font-weight: bold; float: left; z-index: 1; width: 80%; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial; color: ERROR_COLOR;';
}
var mce_jQuery = $;
$(document).ready( function($) {
  var options = { errorClass: 'mce_inline_error', errorElement: 'div', errorStyle: err_style, onkeyup: function(){}, onfocusout:function(){}, onblur:function(){}  };
  var mce_validator = mce_jQuery("#mc-embedded-subscribe-form").validate(options);
  options = { url: 'http://slate.us2.list-manage.com/subscribe/post-json?u=c05b76ecf68cd5e5448448316&id=d7cd644ea3&c=?', type: 'GET', dataType: 'json', contentType: "application/json; charset=utf-8",
                beforeSubmit: function(){
                    mce_jQuery('#mce_tmp_error_msg').remove();
                    mce_jQuery('.datefield','#mc_embed_signup').each(
                        function(){
                            var txt = 'filled';
                            var fields = new Array();
                            var i = 0;
                            mce_jQuery(':text', this).each(
                                function(){
                                    fields[i] = this;
                                    i++;
                                });
                            mce_jQuery(':hidden', this).each(
                                function(){
                                	if ( fields[0].value=='MM' && fields[1].value=='DD' && fields[2].value=='YYYY' ){
                                		this.value = '';
									} else if ( fields[0].value=='' && fields[1].value=='' && fields[2].value=='' ){
                                		this.value = '';
									} else {
	                                    this.value = fields[0].value+'/'+fields[1].value+'/'+fields[2].value;
	                                }
                                });
                        });
                    return mce_validator.form();
                }, 
                success: mce_success_cb
            };
  mce_jQuery('#mc-embedded-subscribe-form').ajaxForm(options);
  mce_jQuery('#mce-EMAIL').example('Enter your e-mail address.');

});
function mce_success_cb(resp){
    mce_jQuery('#mce-success-response').hide();
    mce_jQuery('#mce-error-response').hide();
    if (resp.result=="success"){
        mce_jQuery('#mce-'+resp.result+'-response').show();
        mce_jQuery('#mce-'+resp.result+'-response').html(resp.msg + " <a href='#' onclick='jQuery(\"#mce-"+resp.result+"-response\").hide(); return false;'>OK</a>");
        mce_jQuery('#mc-embedded-subscribe-form').each(function(){
            this.reset();
    	});
    } else {
        var index = -1;
        var msg;
        try {
            var parts = resp.msg.split(' - ',2);
            if (parts[1]==undefined){
                msg = resp.msg;
            } else {
                i = parseInt(parts[0]);
                if (i.toString() == parts[0]){
                    index = parts[0];
                    msg = parts[1];
                } else {
                    index = -1;
                    msg = resp.msg;
                }
            }
        } catch(e){
            index = -1;
            msg = resp.msg;
        }
        try{
            if (index== -1){
                mce_jQuery('#mce-'+resp.result+'-response').show();
				mce_jQuery('#mce-'+resp.result+'-response').html(msg + " <a href='#' onclick='jQuery(\"#mce-"+resp.result+"-response\").hide(); return false;'>OK</a>");
            } else {
                err_id = 'mce_tmp_error_msg';
                html = '<div id="'+err_id+'" style="'+err_style+'"> '+msg+'</div>';
                
                var input_id = '#mc_embed_signup';
                var f = mce_jQuery(input_id);
                if (ftypes[index]=='address'){
                    input_id = '#mce-'+fnames[index]+'-addr1';
                    f = mce_jQuery(input_id).parent().parent().get(0);
                } else if (ftypes[index]=='date'){
                    input_id = '#mce-'+fnames[index]+'-month';
                    f = mce_jQuery(input_id).parent().parent().get(0);
                } else {
                    input_id = '#mce-'+fnames[index];
                    f = mce_jQuery().parent(input_id).get(0);
                }
                if (f){
                    mce_jQuery(f).append(html);
                    mce_jQuery(input_id).focus();
                } else {
                    mce_jQuery('#mce-'+resp.result+'-response').show();
 					mce_jQuery('#mce-'+resp.result+'-response').html(msg + " <a href='#' onclick='jQuery(\"#mce-"+resp.result+"-response\").hide(); return false;'>OK</a>");
                }
            }
        } catch(e){
            mce_jQuery('#mce-'+resp.result+'-response').show();
 			mce_jQuery('#mce-'+resp.result+'-response').html(msg + " <a href='#' onclick='jQuery(\"#mce-"+resp.result+"-response\").hide(); return false;'>OK</a>");
        }
    }
}
// END MC SIGNUP CODE
