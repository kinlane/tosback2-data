(function( $ ){
    $.fn.lazyloader = function(img_selector,callback) {
        var imgs = (img_selector) ? img_selector : 'img';
 
            this.find( imgs +'[data-src]' ).each(function(){
                var lazyloaded = $(this);
                var image = new Image();
                var src = lazyloaded.attr('data-src');
                $(image).load(function() {
                	lazyloaded.attr('src', image.src );
                	if (lazyloaded.hasClass('removeonerror'))
                		lazyloaded.closest('div.img').removeClass('hidden').addClass('clearfix');
                	if(callback)
                		callback('loaded',lazyloaded);
                });
                
            	$(image).error(function() {
                    if (lazyloaded.hasClass('removeonerror'))
                    	lazyloaded.closest('div.item').remove();
                	if(callback)
                		callback('error',lazyloaded);
                });
                lazyloaded.removeAttr('data-src');
                image.src = src;
            });
    };
})( jQuery );