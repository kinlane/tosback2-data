(function(a,c){var b={};a.autocomplete=function(d){this.options=c.extend({input:null,select:null,minLength:1,includeRecents:true,includePWS:false,autosubmit:false,isMainSearchBox:false,zipCodeOnly:false,captureFormSubmit:false,onSelect:c.noop,onOpen:c.noop,suffix:c.noop,exclude:[],className:"",url:"",autoFocus:false,submitButton:null,data:{},search:""},d?d:{});this.input=c(this.options.input);this.select=c(this.options.select);this.hasSelect=(this.select&&this.select.length>0);this.initialize()};a.autocomplete.prototype.initialize=function(){var e=this.input;var g=this.hasSelect;var f=this.options;if(!e[0]){return}this.input.autocomplete({source:function(j,i){var k=/^\d+$/.test(j.term.substr(0,5));if(f.zipCodeOnly&&!k){i(function(){return false})}else{if(j.term.length==0){var h=d(j);i(h)}else{c.ajax({url:f.url||a.autocomplete._config.url,dataType:"jsonp",jsonp:"cb",data:c.extend(true,{},{query:j.term,h:"1"},f.data),success:function(m){if(!m||!m.RESULTS){var l=d(j)}else{var l=d(j,m.RESULTS)}i(l)},error:function(){var l="Could not search for your location. Please check your internet connection and try again.";a.log(l)}})}}},search:function(i,j){var h=c(this).autocomplete("option","disabled");if(h){return false}},select:function(h,i){if(i.item){this.value=i.item.zip||i.item.value;if(g){this._updateSelectMenu(i.item.type)}if(f.submitButton){c(f.submitButton).click(function(){if(f.autosubmit==="localclimate"){window.location="/climate/local.html?query="+this.value}else{if(f.autosubmit==="extremes"){window.location="/climate/local_extremes.asp?query="+this.value}else{if(f.autosubmit==="form"){this.form.submit()}else{if(i.item.type=="pws"){window.location="/weatherstation/WXDailyHistory.asp?ID="+this.value.toUpperCase()}else{if(i.item.l){window.location=i.item.l}else{if(f.isMainSearchBox&&i.item.wmo){window.location="/global/stations/"+i.item.wmo+".html"}else{if(f.isMainSearchBox&&window.SubmitFastForecastSearch){window.SubmitFastForecastSearch()}else{this.form.submit()}}}}}}}})}if(f.autosubmit){if(f.autosubmit==="localclimate"){window.location="/climate/local.html?query="+this.value}else{if(f.autosubmit==="extremes"){window.location="/climate/local_extremes.asp?query="+this.value}else{if(f.autosubmit==="form"){this.form.submit()}else{if(f.autosubmit==="formzmw"){e.val("zmw:"+i.item.zmw);this.form.submit()}else{if(i.item.type=="pws"){window.location="/weatherstation/WXDailyHistory.asp?ID="+this.value.toUpperCase()}else{if(i.item.l){window.location=i.item.l}else{if(f.isMainSearchBox&&i.item.wmo){window.location="/global/stations/"+i.item.wmo+".html"}else{if(f.isMainSearchBox&&window.SubmitFastForecastSearch){window.SubmitFastForecastSearch()}else{this.form.submit()}}}}}}}}}f.onSelect(this.value,i.item)}},open:f.onOpen,minLength:f.minLength,autoFocus:f.autoFocus});this.input.data("autocomplete")._renderMenu=function(j,i){var h=this;var k="";c.each(i,function(m,n){if(n.type!=k){var l=a.autocomplete._config.groupTitles[n.type]||n.type;j.append("<li class='ui-autocomplete-group'>"+l+"</li>");k=n.type}h._renderItem(j,n)})};this.input.data("autocomplete")._renderItem=function(h,i){return c("<li></li>").data("item.autocomplete",i).append(c("<a></a>").html(i.label)).appendTo(h)};function d(k,j){var h=[];if(f.includeRecents){var i=a.autocomplete._config.items;var m=new RegExp("^"+c.ui.autocomplete.escapeRegex(k.term),"i");i=c.grep(i,function(n){return m.test(n.name)});h=h.concat(i)}if(j&&j.length){h=h.concat(j)}var l=c.map(h,function(q){var n=k.term.length;var o=q.name;var p=q.type;var s;if(!f.includePWS&&p=="pws"){return null}if(c.inArray(p,f.exclude)>=0){return null}if(f.zipCodeOnly){s=o.substr(0,5)}else{if(p=="pws"){s=o.split(",",1)[0]}else{if(p=="recent"){s=o}else{s=o}}}var t=f.suffix(s,q)||"";var r=c.extend(true,{},q,{label:'<span class="ui-autocomplete-term">'+o.substr(0,n)+"</span>"+o.substr(n)+t,value:s});return r});return l}this.input.autocomplete("widget").addClass(f.className);if(g){this.select.change(this._updateEnabledState);this._updateEnabledState()}if(f.captureFormSubmit){this.captureFormSubmit()}if(f.search){this.input.autocomplete("search",f.search)}};a.autocomplete.prototype.captureFormSubmit=function(){var d=this.input;if(!this.input[0]){return}var e=c(this.input[0].form);e.submit(function(f){d.autocomplete("search",d.val());f.preventDefault()})};a.autocomplete.prototype._updateEnabledState=function(){var d=this.select.val().toLowerCase();if(d=="weather"||d=="pws"){this.input.autocomplete("option","disabled",false);a.autocomplete.setNative(this.input,false)}else{this.input.autocomplete("option","disabled",true);a.autocomplete.setNative(this.input,true)}};a.autocomplete.prototype._updateSelectMenu=function(d){if(d=="city"){this.select.val("WEATHER")}else{if(d=="pws"){this.select.val("PWS")}}};a.autocomplete.setNative=function(d,e){if(e===false){d.addClass("ui-autocomplete-input").attr({autocomplete:"off",role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"})}else{if(e===true){d.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup")}}};a.autocomplete._config={items:[],groupTitles:{},url:"http://autocomplete.wunderground.com/aq"};a.autocomplete.addItems=function(d){a.autocomplete._config.items=a.autocomplete._config.items.concat(d)};a.autocomplete.setGroupTitles=function(d){a.autocomplete._config.groupTitles=d};a.autocomplete.setUrl=function(d){a.autocomplete._config.url=d};c(document).ready(function(){var d=new a.autocomplete({input:"#wuSearch",select:"#wuSelect",autosubmit:true,isMainSearchBox:true,includePWS:true,data:{ski:1,features:1}})})})(wui,jQuery);