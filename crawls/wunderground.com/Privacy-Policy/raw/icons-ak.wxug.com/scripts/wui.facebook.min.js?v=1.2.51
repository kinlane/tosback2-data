(function(c,g){var e='<a href="/members/signup.asp" title="Create an account with wunderground">Join wunderground through Facebook</a>.',d="Facebook email not accessible.",f="Unable to sign in with Facebook.";c.member={};c.member.logged_in=function(){return jQuery("meta[name=wui-member-logged-in]").attr("content")==="true"};c.facebook={};c.facebook.initialized=false;c.facebook.load_handlers=[];c.facebook.app_id=g("meta[name=fb-app-id]").attr("content");c.facebook.channel_url=g("meta[name=fb-channel-url]").attr("content");c.facebook.permissions={scope:"email"};c.facebook.on_load=function(i){if(c.facebook.initialized){i.apply()}else{c.facebook.load_handlers.push(i)}};c.facebook.on_load_trigger=function(){FB.getLoginStatus(function(i){c.facebook.initialized=true;h(i.status);g.each(c.facebook.load_handlers,function(j,k){k.apply()});c.facebook.load_handlers=[]})};c.facebook.wui_login=function(i){return g.post("/php/c/user_session/create.php",{signed_request:FB.getAuthResponse().signedRequest}).error(function(j){var k=g.parseJSON(j.responseText).error_code,l=f;if(k==="pending_payment"){document.location.href="http://payment.wunderground.com/NoAdsPayment.php?mode=noads&return="}if(i){if(k==="email_missing"){l=d;c.facebook.revoke_permissions()}else{if(k==="email_mismatch"){l=e}}i({code:k,message:l})}})};c.facebook.login=function(i){return FB.login(i,c.facebook.permissions)};c.facebook.revoke_permissions=function(i){return FB.api("me/permissions","DELETE",{},function(j){setTimeout(function(){FB.getLoginStatus(function(k){},true)},1);if(jQuery.isFunction(i)){i.apply()}})};var b="unknown";c.facebook.status=function(){return b};c.facebook.is_status_unknown=function(){return c.facebook.status()=="unknown"};c.facebook.is_status_connected=function(){return c.facebook.status()=="connected"};c.facebook.is_status_not_connected=function(){return c.facebook.status()=="not_authorized"};var h=function(j){b=j;var i={connected:"fb-connected",not_authorized:"fb-not-connected",unknown:"fb-unknown"},k=i[j]||i.unknown;g.each(i,function(l,m){if(k!=m){g("body").removeClass(m)}});g("body").addClass(k)};c.facebook.on_load(function(){FB.Event.subscribe("auth.authResponseChange",function(i){h(i.status)})});var a=function(i){if(c.member.logged_in()){g.post("/php/c/facebook_connection/create.php",{fb_uid:i.authResponse.userID})}};c.facebook.on_load(function(){FB.Event.subscribe("auth.login",a)});c.facebook.logout=function(i){FB.logout(i)};c.facebook.is_member=function(i,j){if(j){return g.get("/php/c/member/get.php",{signed_request:i.signedRequest}).success(function(k){j(k.email)}).error(function(){j(null)})}}})(wui,jQuery);
