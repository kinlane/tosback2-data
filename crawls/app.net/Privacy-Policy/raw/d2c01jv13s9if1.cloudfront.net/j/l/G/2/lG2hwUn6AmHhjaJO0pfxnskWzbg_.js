function get_img_url(e){return window.image_map[e]?page_context.autochrome_img_url_base+window.image_map[e]:(console.log("get_img_url failed for",e),!1)}if(window.image_map=window.image_map||{},$.extend(window.image_map,{}),window.console===void 0&&(window.console={log:function(){return!0}}),window.TAPP===void 0&&(window.TAPP={}),TAPP.jQuery=jQuery,$._ajax=$.ajax,$.ajax=function(e){var t=e.success;return e.success=function(e,i,n){var a=e&&e.result?e.result:null,o=e&&e.value?e.value:"ajax failed",s=e&&e.text?e.text:"ajax failed";return a&&"ok"!==a?(this.error&&this.error(n,o,s),void 0):(t&&t.apply(this,[e,i,n]),void 0)},$._ajax(e)},function(){var e="",t=($.browser.mozilla?e+=" mozilla":0,$.browser.msie?e+=" ie":0,$.browser.opera?e+=" opera":0,$.browser.chrome?e+=" chrome":0,$.browser.webkit?e+=" webkit":0,$.browser.version.replace(/\./g,"_"));e+=" v"+t,$("html").addClass(e)}(),window.refresh_page_context=function(){var e,t;e=document.getElementById("adn-page-context"),e&&(t=e.getAttribute("data-adn-page-context"),window.page_context=JSON.parse(t),e.parentNode.removeChild(e))},window.refresh_page_context(),function(e){e.authedAjax=function(t){var i,n,a,o,s,r,c,l;return i={no_login_required:!1,user_action:!0},t=e.extend({},i,t),n=t.event_tracking,a=t.success||e.noop,o=t.error||e.noop,s=t.complete||e.noop,t.user_action&&(page_context.user_actions_complete=!1),r=function(e,i,n){e&&(a(i),t.user_action&&(page_context.user_actions_complete=!0)),e||o(i,n),s(i,n)},(c=!page_context.is_authenticated&&!t.no_login_required)?(l=function(i){var a,o,s;a=i?n.name_for_success:n.name_for_failure,o=function(){i?e.authedAjax(t):r(!1,null,"authentication failed")},n?(s=_.map(e.makeArray(a),function(e){return[e,n.properties]}),e.waitForFuncs(s,TAPP.event_tracking.fire_off_event,o)):o()},TAPP.auth.start_login_process(l),void 0):(page_context&&(page_context.auth_use_xdm?TAPP.wakea.send_to_provider("ajax",[t],r):e.ajax(t)),void 0)}}(jQuery),function(){var e,t;e=$(window),t=function(){return 480>=e.width()},TAPP.is_narrow=t(),e.on("resize",function(){TAPP.is_narrow=t()})}(),function(){TAPP.in_iframe=!1;try{top.location.href!==window.location.href&&(TAPP.in_iframe=!0)}catch(e){TAPP.in_iframe=!0}}(),function(){var e,t,i;e=[],t=[],i=[],$.fn.tapp_on=function(t,i,n,a){return e.push([this,t,i]),this.on(t,i,n,a)},$.tapp_subscribe=function(e,i){var n=$.subscribe(e,i);return t.push(n),n},TAPP.setInterval=function(e,t){var n=setInterval(e,t);return i.push(n),n},TAPP.clearInterval=function(e){$.map(i,function(t){return e===t?null:t})},TAPP.clear_event_handles=function(){$.each(e,function(e,t){$(t[0]).off(t[1],t[2])})},TAPP.clear_subscribe_handles=function(){$.each(t,function(e,t){$.unsubscribe(t)})},TAPP.clear_intervals=function(){$.each(i,function(){clearInterval(this)})},TAPP.unload=function(){TAPP.clear_event_handles(),TAPP.clear_subscribe_handles(),TAPP.clear_intervals()},TAPP.lock_up=function(e,t){t=t||"click";var i=function(e){e.preventDefault(),e.stopImmediatePropagation()};return e.on(t,i),function(){setTimeout(function(){e.off(t,i)},0)}}}(),function(){$.waitForFuncs=function(e,t,i){var n=[];$.each(e,function(e,i){var a=$.Deferred();n.push(a),i.push(function(){a.resolve()}),t.apply(this,i)}),$.when.apply(this,n).done(i)}}(),page_context&&page_context.br_page_name&&(window.BOOMR.init({beacon_url:"/s/boomerang",BW:{enabled:!1}}),window.BOOMR.addVar("page_name",page_context.br_page_name)),function(){TAPP.initialize_widget_code=function(){("dev"===page_context.environment||"sandbox"===page_context.environment)&&(window.APP_NET_SETTINGS=page_context.widget_overrides);var e={post_load_scripts:window.TAPP_CDN_JS_ASSETS,wakea_remote_url:"https://app.net/wakea/widget/",widget_base_url:"https://app.net/w/el/",data_attr_prefix:"data-an-"};TAPP.settings||(TAPP.settings=TAPP.jQuery.extend({},e,window.APP_NET_SETTINGS)),$.each(page_context.widget_post_load_urls,function(){$("<script />").attr({type:"text/javascript",src:this}).appendTo("body")})}}(),$(document).ajaxSend(function(e,t,i){"POST"===i.type&&t.setRequestHeader("Cache-Control","no-cache")}),function(e){e.Jcrop=function(t,i){var n,a,o,s,r,c,l,d,u,h,p,f,g,m,v,_,b,w,y,x,P,C,k,T,S,$,A,j,E,z,D,O,F,M,H;function I(e){return Math.round(e)+"px"}function L(e){return a.baseClass+"-"+e}function R(){return e.fx.step.hasOwnProperty("backgroundColor")}function N(t){var i=e(t).offset();return[i.left,i.top]}function q(e){return[e.pageX-n[0],e.pageY-n[1]]}function B(t){"object"!=typeof t&&(t={}),a=e.extend(a,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof a[t]&&(a[t]=function(){})})}function U(e,t){var i,a,o;return n=N(d),F.setCursor("move"===e?e:e+"-resize"),"move"===e?F.activateHandlers(W(t),G):(i=z.getFixed(),a=V(e),o=z.getCorner(V(a)),z.setPressed(z.getCorner(a)),z.setCurrent(o),F.activateHandlers(X(e,i),G),void 0)}function X(e,t){return function(i){if(a.aspectRatio)switch(e){case"e":i[1]=t.y+1;break;case"w":i[1]=t.y+1;break;case"n":i[0]=t.x+1;break;case"s":i[0]=t.x+1}else switch(e){case"e":i[1]=t.y2;break;case"w":i[1]=t.y2;break;case"n":i[0]=t.x2;break;case"s":i[0]=t.x2}z.setCurrent(i),O.update()}}function W(e){var t=e;return M.watchKeys(),function(e){z.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,O.update()}}function V(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function J(e){return function(t){return a.disabled?!1:"move"!==e||a.allowMove?(n=N(d),T=!0,U(e,q(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function K(e,t,i){var n=e.width(),a=e.height();n>t&&t>0&&(n=t,a=t/e.width()*e.height()),a>i&&i>0&&(a=i,n=i/e.height()*e.width()),C=e.width()/n,k=e.height()/a,e.width(n).height(a)}function Y(e){return{x:e.x*C,y:e.y*k,x2:e.x2*C,y2:e.y2*k,w:e.w*C,h:e.h*k}}function G(){var e=z.getFixed();e.w>a.minSelect[0]&&e.h>a.minSelect[1]?(O.enableHandles(),O.done()):O.release(),F.setCursor(a.allowSelect?"crosshair":"default")}function Q(e){if(a.disabled)return!1;if(!a.allowSelect)return!1;T=!0,n=N(d),O.disableHandles(),F.setCursor("crosshair");var t=q(e);return z.setPressed(t),O.update(),F.activateHandlers(Z,G),M.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function Z(e){z.setCurrent(e),O.update()}function et(){var t=e("<div></div>").addClass(L("tracker"));return e.browser.msie&&t.css({opacity:0,backgroundColor:"white"}),t}function tt(e){p.removeClass().addClass(L("holder")).addClass(e)}function it(e,t){var i,n,o,s,r,c,l,d,u,h,p,f,g,m,v,_;function b(){window.setTimeout(_,u)}i=e[0]/C,n=e[1]/k,o=e[2]/C,s=e[3]/k,S||(r=z.flipCoords(i,n,o,s),c=z.getFixed(),l=[c.x,c.y,c.x2,c.y2],d=l,u=a.animationDelay,h=r[0]-l[0],p=r[1]-l[1],f=r[2]-l[2],g=r[3]-l[3],m=0,v=a.swingSpeed,i=d[0],n=d[1],o=d[2],s=d[3],O.animMode(!0),_=function(){return function(){m+=(100-m)/v,d[0]=Math.round(i+m/100*h),d[1]=Math.round(n+m/100*p),d[2]=Math.round(o+m/100*f),d[3]=Math.round(s+m/100*g),m>=99.8&&(m=100),100>m?(at(d),b()):(O.done(),O.animMode(!1),"function"==typeof t&&t.call(H))}}(),b())}function nt(e){at([e[0]/C,e[1]/k,e[2]/C,e[3]/k]),a.onSelect.call(H,Y(z.getFixed())),O.enableHandles()}function at(e){z.setPressed([e[0],e[1]]),z.setCurrent([e[2],e[3]]),O.update()}function ot(){return Y(z.getFixed())}function st(){return z.getFixed()}function rt(e){B(e),ft()}function ct(){a.disabled=!0,O.disableHandles(),O.setCursor("default"),F.setCursor("default")}function lt(){a.disabled=!1,ft()}function dt(){O.done(),F.activateHandlers(null,null)}function ut(){p.remove(),r.show(),r.css("visibility","visible"),e(t).removeData("Jcrop")}function ht(e,t){O.release(),ct();var i=new Image;i.onload=function(){var n,o,s,r;n=i.width,o=i.height,s=a.boxWidth,r=a.boxHeight,d.width(n).height(o),d.attr("src",e),f.attr("src",e),K(d,s,r),u=d.width(),h=d.height(),f.width(u).height(h),b.width(u+2*_).height(h+2*_),p.width(u).height(h),D.resize(u,h),lt(),"function"==typeof t&&t.call(H)},i.src=e}function pt(e,t,i){var n=t||a.bgColor;a.bgFade&&R()&&a.fadeTime&&!i?e.animate({backgroundColor:n},{queue:!1,duration:a.fadeTime}):e.css("backgroundColor",n)}function ft(e){a.allowResize?e?O.enableOnly():O.enableHandles():O.disableHandles(),F.setCursor(a.allowSelect?"crosshair":"default"),O.setCursor(a.allowMove?"move":"default"),a.hasOwnProperty("trueSize")&&(C=a.trueSize[0]/u,k=a.trueSize[1]/h),a.hasOwnProperty("setSelect")&&(nt(a.setSelect),O.done(),delete a.setSelect),D.refresh(),a.bgColor!=A&&(pt(a.shade?D.getShades():p,a.shade?a.shadeColor||a.bgColor:a.bgColor),A=a.bgColor),j!=a.bgOpacity&&(j=a.bgOpacity,a.shade?D.refresh():O.setBgOpacity(j)),w=a.maxSize[0]||0,y=a.maxSize[1]||0,x=a.minSize[0]||0,P=a.minSize[1]||0,a.hasOwnProperty("outerImage")&&(d.attr("src",a.outerImage),delete a.outerImage),O.refresh()}return a=e.extend({},e.Jcrop.defaults),o=!1,e.browser.msie&&"6"===e.browser.version.split(".")[0]&&(o=!0),"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof i&&(i={}),B(i),s={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},r=e(t),c=!0,"IMG"==t.tagName?(0!=r[0].width&&0!=r[0].height?(r.width(r[0].width),r.height(r[0].height)):(l=new Image,l.src=r[0].src,r.width(l.width),r.height(l.height)),d=r.clone().removeAttr("id").css(s).show(),d.width(r.width()),d.height(r.height()),r.after(d).hide()):(d=r.css(s).show(),c=!1,null===a.shade&&(a.shade=!0)),K(d,a.boxWidth,a.boxHeight),u=d.width(),h=d.height(),p=e("<div />").width(u).height(h).addClass(L("holder")).css({position:"relative",backgroundColor:a.bgColor}).insertAfter(r).append(d),a.addClass&&p.addClass(a.addClass),f=e("<div />"),g=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),m=e("<div />").width("100%").height("100%").css("zIndex",320),v=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=z.getFixed();a.onDblClick.call(H,e)}).insertBefore(d).append(g,m),c&&(f=e("<img />").attr("src",d.attr("src")).css(s).width(u).height(h),g.append(f)),o&&v.css({overflowY:"hidden"}),_=a.boundary,b=et().width(u+2*_).height(h+2*_).css({position:"absolute",top:I(-_),left:I(-_),zIndex:290}).mousedown(Q),A=a.bgColor,j=a.bgOpacity,n=N(d),E=function(){function e(){var e,t,i,n,a,o;t={},i=["touchstart","touchmove","touchend"],n=document.createElement("div");try{for(e=0;i.length>e;e++)a=i[e],a="on"+a,o=a in n,o||(n.setAttribute(a,"return;"),o="function"==typeof n[a]),t[i[e]]=o;return t.touchstart&&t.touchend&&t.touchmove}catch(s){return!1}}function t(){return a.touchSupport===!0||a.touchSupport===!1?a.touchSupport:e()}return{createDragger:function(e){return function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,a.disabled?!1:"move"!==e||a.allowMove?(T=!0,U(e,q(t)),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,Q(e)},isSupported:e,support:t()}}(),z=function(){function e(e){e=r(e),v=g=e[0],_=m=e[1]}function t(e){e=r(e),p=e[0]-v,f=e[1]-_,v=e[0],_=e[1]}function i(){return[p,f]}function n(e){var t=e[0],i=e[1];0>g+t&&(t-=t+g),0>m+i&&(i-=i+m),_+i>h&&(i+=h-(_+i)),v+t>u&&(t+=u-(v+t)),g+=t,v+=t,m+=i,_+=i}function o(e){var t=s();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function s(){if(!a.aspectRatio)return l();var e,t,i,n,o=a.aspectRatio,s=a.minSize[0]/C,r=a.maxSize[0]/C,p=a.maxSize[1]/k,f=v-g,b=_-m,w=Math.abs(f),y=Math.abs(b),x=w/y;return 0===r&&(r=10*u),0===p&&(p=10*h),o>x?(t=_,i=y*o,e=0>f?g-i:i+g,0>e?(e=0,n=Math.abs((e-g)/o),t=0>b?m-n:n+m):e>u&&(e=u,n=Math.abs((e-g)/o),t=0>b?m-n:n+m)):(e=v,n=w/o,t=0>b?m-n:m+n,0>t?(t=0,i=Math.abs((t-m)*o),e=0>f?g-i:i+g):t>h&&(t=h,i=Math.abs(t-m)*o,e=0>f?g-i:i+g)),e>g?(s>e-g?e=g+s:e-g>r&&(e=g+r),t=t>m?m+(e-g)/o:m-(e-g)/o):g>e&&(s>g-e?e=g-s:g-e>r&&(e=g-r),t=t>m?m+(g-e)/o:m-(g-e)/o),0>e?(g-=e,e=0):e>u&&(g-=e-u,e=u),0>t?(m-=t,t=0):t>h&&(m-=t-h,t=h),d(c(g,m,e,t))}function r(e){return 0>e[0]&&(e[0]=0),0>e[1]&&(e[1]=0),e[0]>u&&(e[0]=u),e[1]>h&&(e[1]=h),[e[0],e[1]]}function c(e,t,i,n){var a=e,o=i,s=t,r=n;return e>i&&(a=i,o=e),t>n&&(s=n,r=t),[a,s,o,r]}function l(){var e,t=v-g,i=_-m;return w&&Math.abs(t)>w&&(v=t>0?g+w:g-w),y&&Math.abs(i)>y&&(_=i>0?m+y:m-y),P/k&&P/k>Math.abs(i)&&(_=i>0?m+P/k:m-P/k),x/C&&x/C>Math.abs(t)&&(v=t>0?g+x/C:g-x/C),0>g&&(v-=g,g-=g),0>m&&(_-=m,m-=m),0>v&&(g-=v,v-=v),0>_&&(m-=_,_-=_),v>u&&(e=v-u,g-=e,v-=e),_>h&&(e=_-h,m-=e,_-=e),g>u&&(e=g-h,_-=e,m-=e),m>h&&(e=m-h,_-=e,m-=e),d(c(g,m,v,_))}function d(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var p,f,g=0,m=0,v=0,_=0;return{flipCoords:c,setPressed:e,setCurrent:t,getOffset:i,moveOffset:n,getCorner:o,getFixed:s}}(),D=function(){function t(e,t){b.left.css({height:I(t)}),b.right.css({height:I(t)})}function i(){return n(z.getFixed())}function n(e){b.top.css({left:I(e.x),width:I(e.w),height:I(e.y)}),b.bottom.css({top:I(e.y2),left:I(e.x),width:I(e.w),height:I(h-e.y2)}),b.right.css({left:I(e.x2),width:I(u-e.x2)}),b.left.css({width:I(e.x)})}function o(){return e("<div />").css({position:"absolute",backgroundColor:a.shadeColor||a.bgColor}).appendTo(_)}function s(){v||(v=!0,_.insertBefore(d),i(),O.setBgOpacity(1,0,1),f.hide(),r(a.shadeColor||a.bgColor,1),O.isAwake()?l(a.bgOpacity,1):l(1,1))}function r(e,t){pt(m(),e,t)}function c(){v&&(_.remove(),f.show(),v=!1,O.isAwake()?O.setBgOpacity(a.bgOpacity,1,1):(O.setBgOpacity(1,1,1),O.disableHandles()),pt(p,0,1))}function l(e,t){v&&(a.bgFade&&!t?_.animate({opacity:1-e},{queue:!1,duration:a.fadeTime}):_.css({opacity:1-e}))}function g(){a.shade?s():c(),O.isAwake()&&l(a.bgOpacity)}function m(){return _.children()}var v=!1,_=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),b={top:o(),left:o().height(h),right:o().height(h),bottom:o()};return{update:i,updateRaw:n,getShades:m,setBgColor:r,enable:s,disable:c,resize:t,refresh:g,opacity:l}}(),O=function(){var t,i,n,o,s,r,c;function l(t){var i=e("<div />").css({position:"absolute",opacity:a.borderOpacity}).addClass(L(t));return g.append(i),i}function u(t,i){var n=e("<div />").mousedown(J(t)).css({cursor:t+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+t);return E.support&&n.bind("touchstart.jcrop",E.createDragger(t)),m.append(n),n}function h(e){var t=a.handleSize;return u(e,i++).css({opacity:a.handleOpacity}).width(t).height(t).addClass(L("handle"))}function p(e){return u(e,i++).addClass("jcrop-dragbar")}function _(e){var t;for(t=0;e.length>t;t++)s[e[t]]=p(e[t])}function b(e){var t,i;for(i=0;e.length>i;i++){switch(e[i]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}n[e[i]]=l(t)}}function w(e){var t;for(t=0;e.length>t;t++)o[e[t]]=h(e[t])}function y(e,t){a.shade||f.css({top:I(-t),left:I(-e)}),v.css({top:I(t),left:I(e)})}function x(e,t){v.width(Math.round(e)).height(Math.round(t))}function P(){var e=z.getFixed();z.setPressed([e.x,e.y]),z.setCurrent([e.x2,e.y2]),C()}function C(e){return t?k(e):void 0}function k(e){var i=z.getFixed();x(i.w,i.h),y(i.x,i.y),a.shade&&D.updateRaw(i),t||$(),e?a.onSelect.call(H,Y(i)):a.onChange.call(H,Y(i))}function T(e,i,n){(t||i)&&(a.bgFade&&!n?d.animate({opacity:e},{queue:!1,duration:a.fadeTime}):d.css("opacity",e))}function $(){v.show(),a.shade?D.opacity(j):T(j,!0),t=!0}function A(){M(),v.hide(),a.shade?D.opacity(1):T(1),t=!1,a.onRelease.call(H)}function O(){r&&m.show()}function F(){return r=!0,a.allowResize?(m.show(),!0):void 0}function M(){r=!1,m.hide()}function R(e){e?(S=!0,M()):(S=!1,F())}function N(){R(!1),P()}return i=370,n={},o={},s={},r=!1,a.dragEdges&&e.isArray(a.createDragbars)&&_(a.createDragbars),e.isArray(a.createHandles)&&w(a.createHandles),a.drawBorders&&e.isArray(a.createBorders)&&b(a.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()}),c=et().mousedown(J("move")).css({cursor:"move",position:"absolute",zIndex:360}),E.support&&c.bind("touchstart.jcrop",E.createDragger("move")),g.append(c),M(),{updateVisible:C,update:k,release:A,refresh:P,isAwake:function(){return t},setCursor:function(e){c.css("cursor",e)},enableHandles:F,enableOnly:function(){r=!0},showHandles:O,disableHandles:M,animMode:R,setBgOpacity:T,done:N}}(),F=function(){function t(){b.css({zIndex:450}),E.support&&e(document).bind("touchmove.jcrop",r).bind("touchend.jcrop",c),p&&e(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",o)}function i(){b.css({zIndex:290}),e(document).unbind(".jcrop")}function n(e){return u(q(e)),!1}function o(e){return e.preventDefault(),e.stopPropagation(),T&&(T=!1,h(q(e)),O.isAwake()&&a.onSelect.call(H,Y(z.getFixed())),i(),u=function(){},h=function(){}),!1}function s(e,i){return T=!0,u=e,h=i,t(),!1}function r(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,n(e)}function c(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,o(e)}function l(e){b.css("cursor",e)}var u=function(){},h=function(){},p=a.trackDocument;return p||b.mousemove(n).mouseup(o).mouseout(o),d.before(b),{activateHandlers:s,setCursor:l}}(),M=function(){function t(){a.keySupport&&(r.show(),r.focus())}function i(){r.hide()}function n(e,t,i){a.allowMove&&(z.moveOffset([t,i]),O.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function s(e){if(e.ctrlKey||e.metaKey)return!0;$=e.shiftKey?!0:!1;var t=$?10:1;switch(e.keyCode){case 37:n(e,-t,0);break;case 39:n(e,t,0);break;case 38:n(e,0,-t);break;case 40:n(e,0,t);break;case 27:a.allowSelect&&O.release();break;case 9:return!0}return!1}var r=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),c=e("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return a.keySupport&&(r.keydown(s).blur(i),o||!a.fixedSupport?(r.css({position:"absolute",left:"-20px"}),c.append(r).insertBefore(d)):r.insertBefore(d)),{watchKeys:t}}(),E.support&&b.bind("touchstart.jcrop",E.newSelection),m.hide(),ft(!0),H={setImage:ht,animateTo:it,setSelect:nt,setOptions:rt,tellSelect:ot,tellScaled:st,setClass:tt,disable:ct,enable:lt,cancel:dt,release:O.release,destroy:ut,focus:M.watchKeys,getBounds:function(){return[u*C,h*k]},getWidgetSize:function(){return[u,h]},getScaleFactor:function(){return[C,k]},getOptions:function(){return a},ui:{holder:p,selection:v}},e.browser.msie&&p.bind("selectstart",function(){return!1}),r.data("Jcrop",H),H},e.fn.Jcrop=function(t,i){var n;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),n=e.Jcrop(this,t),e.isFunction(i)&&i.call(n)}):(e(this).css({display:"block",visibility:"hidden"}),n=e.Jcrop(this,t),e.isFunction(i)&&i.call(n))}),this},e.Jcrop.Loader=function(t,i,n){function a(){s.complete?(o.unbind(".jcloader"),e.isFunction(i)&&i.call(s)):window.setTimeout(a,50)}var o=e(t),s=o[0];o.bind("load.jcloader",a).bind("error.jcloader",function(){o.unbind(".jcloader"),e.isFunction(n)&&n.call(s)}),s.complete&&e.isFunction(i)&&(o.unbind(".jcloader"),i.call(s))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),void 0===Sentry)var Sentry={};(function(){Sentry.client={};var e=Sentry.client;Sentry.client.loaded=!1,Sentry.client.options={site:page_context&&page_context.environment?page_context.environment:"prod"},Sentry.client.parseUrl=function(e){var t=e.split("?");return t[1],{url:t[0],querystring:t[1]}},Sentry.client.process=function(t){var i,n,a,o;if(t.project=e.options.projectId,t.logger=e.options.logger,t.site=e.options.site,i=["authenticated_user_id","build_info","canvas_mode"],n={},window.page_context)for(a in i)o=i[a],window.page_context[o]&&(n[o]=page_context[o]);t.extra=n,t.extra.user_agent=navigator.userAgent,t.extra.referrer=document.referrer?document.referrer:"n/a",console.log("window error",t),$.ajax({type:"POST",url:"/_jserror/",data:{message:JSON.stringify(t)}})},Sentry.client.parseTraceback=function(e){var t,i,n,a,o,s,r;for(t=[],i=e.split("\n"),a=1;n=i[a];a++)o=n.split(":"),s=o.slice(-2)[0],r=o.slice(0,-2).join(":").split(" at ")[1],t.push({lineno:s,filename:r,module:"unknown","function":"unknown"});return t},Sentry.client.captureException=function(t){var i,n,a,o,s,r,c,l;if(n=window.location.href,t.line?i=t.line:t.lineNumber&&(i=t.lineNumber),t.sourceURL?s=t.sourceURL:t.fileName&&(s=t.fileName),t.stack)try{a=e.parseTraceback(t.stack)}catch(d){}r=e.parseUrl(n),c=""+t,i&&(c=c+" at "+i),a?(o={frames:a},s=a[0].filename):s&&(o={frames:[{filename:s,lineno:i,module:"unknown","function":"unknown"}]}),l={message:c,culprit:s||void 0,"sentry.interfaces.Stacktrace":o||void 0,"sentry.interfaces.Exception":{type:t.name,value:t.message},"sentry.interfaces.Http":{url:r.url,querystring:r.querystring}},e.process(l)},Sentry.client.registerGlobalHandler=function(){Sentry.client.handled_global_error=!1,window.onerror=function(t,i,n,a){var o,s,r,c,l,d,u,h,p;if(Sentry.client.handled_global_error)return!0;for(r=window.location.href,c=e.parseUrl(r),"object"==typeof t&&(s=t.name,t=t.message),l=["script error","The first argument must be a beforeLoad event object.","atomicFindClose","Error loading script"],d=l.length;d--;)if(u=l[d],-1!==t.toLowerCase().indexOf(u))return!1;Sentry.client.handled_global_error=!0,h=n?t+" at "+n:t,a?(o={frames:a},i=i||a[0].filename):i&&(o={frames:[{filename:i,lineno:n}]}),p={message:h,culprit:i,"sentry.interfaces.Stacktrace":o,"sentry.interfaces.Exception":{type:s,value:t},"sentry.interfaces.Http":{url:c.url,querystring:c.querystring}},e.process(p)}},Sentry.client.registerGlobalHandler()})(),function(e){function t(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}e.fn.ajaxSubmit=function(i){var n,a,o,s,r,c,l,d,u,h,p,f,g,m;function v(){var n,a,o,s,r,c,l,d,h,p,f,g,m,v,_,b,w;function y(){var t,i,c,l;t=u.attr("target"),i=u.attr("action"),n.setAttribute("target",o),"POST"!=n.getAttribute("method")&&n.setAttribute("method","POST"),n.getAttribute("action")!=a.url&&n.setAttribute("action",a.url),a.skipEncodingOverride||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),a.timeout&&(d=setTimeout(function(){h=!0,x(!0)},a.timeout)),c=[];try{if(a.extraData)for(l in a.extraData)c.push(e('<input type="hidden" name="'+l+'" value="'+a.extraData[l]+'" />').appendTo(n)[0]);s.appendTo("body"),r.attachEvent?r.attachEvent("onload",x):r.addEventListener("load",x,!1),n.submit()}finally{n.setAttribute("action",i),t?n.setAttribute("target",t):u.removeAttr("target"),e(c).remove()}}function x(i){var n,o,u,p,f,b,y;if(!c.aborted&&!m){if(i===!0&&c)return c.abort("timeout"),void 0;if(n=r.contentWindow?r.contentWindow.document:r.contentDocument?r.contentDocument:r.document,n&&n.location.href!=a.iframeSrc||h){r.detachEvent?r.detachEvent("onload",x):r.removeEventListener("load",x,!1),o=!0;try{if(h)throw"timeout";if(u="xml"==a.dataType||n.XMLDocument||e.isXMLDoc(n),t("isXml="+u),!u&&window.opera&&(null==n.body||""==n.body.innerHTML)&&--v)return t("requeing onLoad callback, DOM not available"),setTimeout(x,250),void 0;c.responseText=n.body?n.body.innerHTML:n.documentElement?n.documentElement.innerHTML:null,c.responseXML=n.XMLDocument?n.XMLDocument:n,u&&(a.dataType="xml"),c.getResponseHeader=function(e){var t={"content-type":a.dataType};return t[e]},p=/(json|script|text)/.test(a.dataType),p||a.textarea?(f=n.getElementsByTagName("textarea")[0],f?c.responseText=f.value:p&&(b=n.getElementsByTagName("pre")[0],y=n.getElementsByTagName("body")[0],b?c.responseText=b.textContent:y&&(c.responseText=y.innerHTML))):"xml"!=a.dataType||c.responseXML||null==c.responseText||(c.responseXML=_(c.responseText)),g=w(c,a.dataType,a)}catch(i){t("error caught:",i),o=!1,c.error=i,a.error&&a.error.call(a.context,c,"error",i),l&&e.event.trigger("ajaxError",[c,a,i])}c.aborted&&(t("upload aborted"),o=!1),o&&(a.success&&a.success.call(a.context,g,"success",c),l&&e.event.trigger("ajaxSuccess",[c,a])),l&&e.event.trigger("ajaxComplete",[c,a]),l&&!--e.active&&e.event.trigger("ajaxStop"),a.complete&&a.complete.call(a.context,c,o?"success":"error"),m=!0,a.timeout&&clearTimeout(d),setTimeout(function(){s.removeData("form-plugin-onload"),s.remove(),c.responseXML=null},100)}}}return n=u[0],e(":input[name=submit],:input[id=submit]",n).length?(alert('Error: Form elements must not have name or id of "submit".'),void 0):(a=e.extend(!0,{},e.ajaxSettings,i),a.context=a.context||a,o="jqFormIO"+(new Date).getTime(),s=e('<iframe id="'+o+'" name="'+o+'" src="'+a.iframeSrc+'" />'),r=s[0],s.css({position:"absolute",top:"-1000px",left:"-1000px"}),c={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(i){var n="timeout"===i?"timeout":"aborted";t("aborting upload... "+n),this.aborted=1,s.attr("src",a.iframeSrc),c.error=n,a.error&&a.error.call(a.context,c,n,n),l&&e.event.trigger("ajaxError",[c,a,n]),a.complete&&a.complete.call(a.context,c,n)}},l=a.global,l&&!e.active++&&e.event.trigger("ajaxStart"),l&&e.event.trigger("ajaxSend",[c,a]),a.beforeSend&&a.beforeSend.call(a.context,c,a)===!1?(a.global&&e.active--,void 0):(c.aborted||(h=0,p=n.clk,p&&(f=p.name,f&&!p.disabled&&(a.extraData=a.extraData||{},a.extraData[f]=p.value,"image"==p.type&&(a.extraData[f+".x"]=n.clk_x,a.extraData[f+".y"]=n.clk_y))),a.forceSync?y():setTimeout(y,10),v=50,_=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},b=e.parseJSON||function(e){return window.eval("("+e+")")},w=function(t,i,n){var a=t.getResponseHeader("content-type")||"",o="xml"===i||!i&&a.indexOf("xml")>=0,s=o?t.responseXML:t.responseText;return o&&"parsererror"===s.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(s=n.dataFilter(s,i)),"string"==typeof s&&("json"===i||!i&&a.indexOf("json")>=0?s=b(s):("script"===i||!i&&a.indexOf("javascript")>=0)&&e.globalEval(s)),s}),void 0))}if(!this.length)return t("ajaxSubmit: skipping submit process - no element selected"),this;if("function"==typeof i&&(i={success:i}),n=this.attr("action"),a="string"==typeof n?e.trim(n):"",a&&(a=(a.match(/^([^#]+)/)||[])[1]),a=a||window.location.href||"",i=e.extend(!0,{url:a,success:e.ajaxSettings.success,type:this[0].getAttribute("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},i),o={},this.trigger("form-pre-serialize",[this,i,o]),o.veto)return t("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(i.beforeSerialize&&i.beforeSerialize(this,i)===!1)return t("ajaxSubmit: submit aborted via beforeSerialize callback"),this;if(c=this.formToArray(i.semantic),i.data){i.extraData=i.data;for(s in i.data)if(i.data[s]instanceof Array)for(l in i.data[s])c.push({name:s,value:i.data[s][l]});else r=i.data[s],r=e.isFunction(r)?r():r,c.push({name:s,value:r})}return i.beforeSubmit&&i.beforeSubmit(c,this,i)===!1?(t("ajaxSubmit: submit aborted via beforeSubmit callback"),this):(this.trigger("form-submit-validate",[c,this,i,o]),o.veto?(t("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this):(d=e.param(c),"GET"==i.type.toUpperCase()?(i.url+=(i.url.indexOf("?")>=0?"&":"?")+d,i.data=null):i.data=d,u=this,h=[],i.resetForm&&h.push(function(){u.resetForm()}),i.clearForm&&h.push(function(){u.clearForm()}),!i.dataType&&i.target?(p=i.success||function(){},h.push(function(t){var n=i.replaceTarget?"replaceWith":"html";e(i.target)[n](t).each(p,arguments)})):i.success&&h.push(i.success),i.success=function(e,t,n){var a,o,s;for(a=i.context||i,o=0,s=h.length;s>o;o++)h[o].apply(a,[e,t,n||u,u])},f=e("input:file",this).length>0,g="multipart/form-data",m=u.attr("enctype")==g||u.attr("encoding")==g,i.iframe!==!1&&(f||i.iframe||m)?i.closeKeepAlive?e.get(i.closeKeepAlive,v):v():e.ajax(i),this.trigger("form-submit-notify",[this,i]),this))},e.fn.ajaxForm=function(i){if(0===this.length){var n={s:this.selector,c:this.context};return!e.isReady&&n.s?(t("DOM not ready, queuing ajaxForm"),e(function(){e(n.s,n.c).ajaxForm(i)}),this):(t("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return this.ajaxFormUnbind().bind("submit.form-plugin",function(t){t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(i))}).bind("click.form-plugin",function(t){var i,n,a,o,s;if(i=t.target,n=e(i),!n.is(":submit,input:image")){if(a=n.closest(":submit"),0==a.length)return;i=a[0]}o=this,o.clk=i,"image"==i.type&&(void 0!=t.offsetX?(o.clk_x=t.offsetX,o.clk_y=t.offsetY):"function"==typeof e.fn.offset?(s=n.offset(),o.clk_x=t.pageX-s.left,o.clk_y=t.pageY-s.top):(o.clk_x=t.pageX-i.offsetLeft,o.clk_y=t.pageY-i.offsetTop)),setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)})},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t){var i,n,a,o,s,r,c,l,d,u,h,p;if(i=[],0===this.length)return i;if(n=this[0],a=t?n.getElementsByTagName("*"):n.elements,!a)return i;for(o=0,d=a.length;d>o;o++)if(l=a[o],r=l.name)if(t&&n.clk&&"image"==l.type)l.disabled||n.clk!=l||(i.push({name:r,value:e(l).val()}),i.push({name:r+".x",value:n.clk_x},{name:r+".y",value:n.clk_y}));else if(c=e.fieldValue(l,!0),c&&c.constructor==Array)for(s=0,u=c.length;u>s;s++)i.push({name:r,value:c[s]});else null!==c&&c!==void 0&&i.push({name:r,value:c});return!t&&n.clk&&(h=e(n.clk),p=h[0],r=p.name,r&&!p.disabled&&"image"==p.type&&(i.push({name:r,value:h.val()}),i.push({name:r+".x",value:n.clk_x},{name:r+".y",value:n.clk_y}))),i},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n,a,o,s;if(n=this.name)if(a=e.fieldValue(this,t),a&&a.constructor==Array)for(o=0,s=a.length;s>o;o++)i.push({name:n,value:a[o]});else null!==a&&a!==void 0&&i.push({name:this.name,value:a})}),e.param(i)},e.fn.fieldValue=function(t){var i,n,a,o,s;for(i=[],n=0,a=this.length;a>n;n++)o=this[n],s=e.fieldValue(o,t),null===s||void 0===s||s.constructor==Array&&!s.length||(s.constructor==Array?e.merge(i,s):i.push(s));return i},e.fieldValue=function(t,i){var n,a,o,s,r,c,l,d,u,h,p;if(n=t.name,a=t.type,o=t.tagName.toLowerCase(),void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==a||"button"==a||("checkbox"==a||"radio"==a)&&!t.checked||("submit"==a||"image"==a)&&t.form&&t.form.clk!=t||"select"==o&&-1==t.selectedIndex))return null;if("select"==o){if(s=t.selectedIndex,0>s)return null;for(r=[],c=t.options,l="select-one"==a,d=l?s+1:c.length,u=l?s:0;d>u;u++)if(h=c[u],h.selected){if(p=h.value,p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),l)return p;r.push(p)}return r}return e(t).val()},e.fn.clearForm=function(){return this.each(function(){e("input,select,textarea",this).clearFields()})},e.fn.clearFields=e.fn.clearInputs=function(){return this.each(function(){var e=this.type,t=this.tagName.toLowerCase();"text"==e||"password"==e||"textarea"==t?this.value="":"checkbox"==e||"radio"==e?this.checked=!1:"select"==t&&(this.selectedIndex=-1)
})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i,n;i=this.type,"checkbox"==i||"radio"==i?this.checked=t:"option"==this.tagName.toLowerCase()&&(n=e(this).parent("select"),t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t)})}}(jQuery),function(e){function t(t){var i={},n=/^jQuery\d+$/;return e.each(t.attributes,function(e,t){t.specified&&!n.test(t.name)&&(i[t.name]=t.value)}),i}function i(){var t=e(this);t.val()===t.attr("placeholder")&&t.hasClass("placeholder")&&(t.data("placeholder-password")?t.hide().next().attr("id",t.removeAttr("id").data("placeholder-id")).show().focus():t.val("").removeClass("placeholder"))}function n(){var n,a=e(this),o=this.id;if(""===a.val()){if(a.is(":password")){if(!a.data("placeholder-textinput")){try{n=a.clone().attr({type:"text"})}catch(s){n=e("<input>").attr(e.extend(t(this),{type:"text"}))}n.removeAttr("name").data("placeholder-password",!0).data("placeholder-id",o).bind("focus.placeholder",i),a.data("placeholder-textinput",n).data("placeholder-id",o).before(n)}a=a.removeAttr("id").hide().prev().attr("id",o).show()}a.addClass("placeholder").val(a.attr("placeholder"))}else a.removeClass("placeholder")}var a="placeholder"in document.createElement("input"),o="placeholder"in document.createElement("textarea");a&&o?(e.fn.placeholder=function(){return this},e.fn.placeholder.input=e.fn.placeholder.textarea=!0):(e.fn.placeholder=function(){return this.filter((a?"textarea":":input")+"[placeholder]").bind("focus.placeholder",i).bind("blur.placeholder",n).trigger("blur.placeholder").end()},e.fn.placeholder.input=a,e.fn.placeholder.textarea=o),e(function(){e("form").bind("submit.placeholder",function(){var t=e(".placeholder",this).each(i);setTimeout(function(){t.each(n)},10)})}),e(window).bind("unload.placeholder",function(){e(".placeholder").val("")})}(jQuery),function(e){e.fn.each2===void 0&&e.fn.extend({each2:function(t){for(var i=e([0]),n=-1,a=this.length;a>++n&&(i.context=i[0]=this[n])&&t.call(i[0],n,i)!==!1;);return this}})}(jQuery),function(e,t){"use strict";function i(e,i){var n,a=0,o=i.length;if(e===t)return-1;if(e.constructor===String){for(;o>a;a+=1)if(0===e.localeCompare(i[a]))return a}else for(;o>a;a+=1)if(n=i[a],n.constructor===String){if(0===n.localeCompare(e))return a}else if(n===e)return a;return-1}function n(e,i){return e===i?!0:e===t||i===t?!1:null===e||null===i?!1:e.constructor===String?0===e.localeCompare(i):i.constructor===String?0===i.localeCompare(e):!1}function a(t,i){var n,a,o;if(null===t||1>t.length)return[];for(n=t.split(i),a=0,o=n.length;o>a;a+=1)n[a]=e.trim(n[a]);return n}function o(e){return e.outerWidth()-e.width()}function s(e){e.bind("keydown",function(){e.data("keyup-change-value",e.val())}),e.bind("keyup",function(){e.val()!==e.data("keyup-change-value")&&e.trigger("keyup-change")})}function r(i){i.bind("mousemove",function(i){var n=e(document).data("select2-lastpos");(n===t||n.x!==i.pageX||n.y!==i.pageY)&&e(i.target).trigger("mousemove-filtered",i)})}function c(e,t){var i;return function(){window.clearTimeout(i),i=window.setTimeout(t,e)}}function l(e,t){var n=c(e,function(e){t.trigger("scroll-debounced",e)});t.bind("scroll",function(e){i(e.target,t.get())>=0&&n(e)})}function d(e){e.preventDefault(),e.stopPropagation()}function u(t){if(!P){var i=t[0].currentStyle||window.getComputedStyle(t[0],null);P=e("<div></div>").css({position:"absolute",left:"-1000px",top:"-1000px",display:"none",fontSize:i.fontSize,fontFamily:i.fontFamily,fontStyle:i.fontStyle,fontWeight:i.fontWeight,letterSpacing:i.letterSpacing,textTransform:i.textTransform,whiteSpace:"nowrap"}),e("body").append(P)}return P.text(t.val()),P.width()}function h(e,i,n){var a=e.toUpperCase().indexOf(i.toUpperCase()),o=i.length;return 0>a?(n.push(e),t):(n.push(e.substring(0,a)),n.push("<span class='select2-match'>"),n.push(e.substring(a,a+o)),n.push("</span>"),n.push(e.substring(a+o,e.length)),t)}function p(t){var i,n=0,a=null,o=t.quietMillis||100;return function(s){window.clearTimeout(i),i=window.setTimeout(function(){n+=1;var i=n,o=t.data,r=t.transport||e.ajax,c=t.type||"GET";o=o.call(this,s.term,s.page,s.context),null!==a&&a.abort(),a=r.call(null,{url:t.url,dataType:t.dataType,data:o,type:c,success:function(e){if(!(n>i)){var a=t.results(e,s.page);s.callback(a)}}})},o)}}function f(i){var n,a=i,o=function(e){return""+e.text};return e.isArray(a)||(o=a.text,e.isFunction(o)||(n=a.text,o=function(e){return e[n]}),a=a.results),function(i){var n=i.term,s={};return""===n?(i.callback({results:a}),t):(s.results=e(a).filter(function(){return i.matcher(n,o(this))}).get(),i.callback(s),t)}}function g(i){return e.isFunction(i)?i:function(n){var a=n.term,o={results:[]};e(i).each(function(){var e=this.text!==t,i=e?this.text:this;(""===a||n.matcher(a,i))&&o.results.push(e?this:{id:this,text:this})}),n.callback(o)}}function m(t){return e.isFunction(t)?t():t}function v(t,i){var n=function(){};return n.prototype=new t,n.prototype.constructor=n,n.prototype.parent=t.prototype,n.prototype=e.extend(n.prototype,i),n}if(window.Select2===t){var _,b,w,y,x,P;_={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case _.LEFT:case _.RIGHT:case _.UP:case _.DOWN:return!0}return!1},isControl:function(e){switch(e=e.which?e.which:e){case _.SHIFT:case _.CTRL:case _.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},x=function(){var e=1;return function(){return e++}}(),e(document).delegate("*","mousemove",function(t){e(document).data("select2-lastpos",{x:t.pageX,y:t.pageY})}),e(document).ready(function(){e(document).delegate("*","mousedown focusin touchend",function(t){var i=e(t.target).closest("div.select2-container").get(0);i?e(document).find("div.select2-container-active").each(function(){this!==i&&e(this).data("select2").blur()}):(i=e(t.target).closest("div.select2-drop").get(0),e(document).find("div.select2-drop-active").each(function(){this!==i&&e(this).data("select2").blur()}))})}),b=v(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(i){var n,a,o=".select2-results";this.opts=i=this.prepareOpts(i),this.id=i.id,i.element.data("select2")!==t&&null!==i.element.data("select2")&&this.destroy(),this.enabled=!0,this.container=this.createContainer(),this.body=i.element.closest("body"),i.element.attr("class")!==t&&this.container.addClass(i.element.attr("class")),this.container.css(m(i.containerCss)),this.container.addClass(m(i.containerCssClass)),this.opts.element.data("select2",this).hide().after(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.css(m(i.dropdownCss)),this.dropdown.addClass(m(i.dropdownCssClass)),this.dropdown.data("select2",this),this.results=n=this.container.find(o),this.search=a=this.container.find("input.select2-input"),this.resultsPage=0,this.context=null,this.initContainer(),r(this.results),this.dropdown.delegate(o,"mousemove-filtered",this.bind(this.highlightUnderEvent)),l(80,this.results),this.dropdown.delegate(o,"scroll-debounced",this.bind(this.loadMoreIfNeeded)),e.fn.mousewheel&&n.mousewheel(function(e,t,i,a){var o=n.scrollTop();a>0&&0>=o-a?(n.scrollTop(0),d(e)):0>a&&n.height()>=n.get(0).scrollHeight-n.scrollTop()+a&&(n.scrollTop(n.get(0).scrollHeight-n.height()),d(e))}),s(a),a.bind("keyup-change",this.bind(this.updateResults)),a.bind("focus",function(){a.addClass("select2-focused")," "===a.val()&&a.val("")}),a.bind("blur",function(){a.removeClass("select2-focused")}),this.dropdown.delegate(o,"click",this.bind(function(t){e(t.target).closest(".select2-result-selectable:not(.select2-disabled)").length>0?(this.highlightUnderEvent(t),this.selectHighlighted(t)):(d(t),this.focusSearch())})),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),i.element.is(":disabled")&&this.disable()},destroy:function(){var e=this.opts.element.data("select2");e!==t&&(e.container.remove(),e.dropdown.remove(),e.opts.element.removeData("select2").unbind(".select2").show())},prepareOpts:function(i){var n,o,s;if(n=i.element,"select"===n.get(0).tagName.toLowerCase()&&(this.select=o=i.element),o&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in i)throw Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),i=e.extend({},{containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",populateResults:function(n,a,o){var s,r,c,l={},d=[],u=this.opts.id;s=function(e,n){var a,r,h,p,f,g;for(a=0,r=e.length;r>a;a+=1)p=e[a],f=u(p)!==t,g="children"in p&&p.children.length>0,d.push("<li class='select2-result-depth-"+n),d.push(" select2-result"),d.push(f?" select2-result-selectable":" select2-result-unselectable"),g&&d.push(" select2-result-with-children"),d.push("'"),h=x(),d.push(" id='select2-result-"+h+"'"),l[h]=p,d.push("><div class='select2-result-label'>"),c=i.formatResult(p,o,d),c!==t&&d.push(c),d.push("</div>"),g&&(d.push("<ul class='select2-result-sub'>"),s(p.children,n+1),d.push("</ul>")),d.push("</li>")},s(a,0),n.append(d.join(""));for(r in l)e("#select2-result-"+r,n).data("select2-data",l[r])},formatResult:function(e,t,i){h(e.text,t.term,i)},formatSelection:function(e){return e.fullText||e.text},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){return"Please enter "+(t-e.length)+" more characters"},formatLoadMore:function(){return"Loading more results..."},minimumResultsForSearch:0,minimumInputLength:0,id:function(e){return e.id},matcher:function(e,t){return t.toUpperCase().indexOf(e.toUpperCase())>=0}},i),"function"!=typeof i.id&&(s=i.id,i.id=function(e){return e[s]}),o?(i.query=this.bind(function(i){var a,o,s,r={results:[],more:!1},c=i.term;s=function(e,t){var n;e.is("option")?i.matcher(c,e.text())&&t.push({id:e.attr("value"),text:e.text(),element:e.get()}):e.is("optgroup")&&(n={text:e.attr("label"),children:[],element:e.get()},e.children().each2(function(e,t){s(t,n.children)}),n.children.length>0&&t.push(n))},a=n.children(),this.getPlaceholder()!==t&&a.length>0&&(o=a[0],""===e(o).text()&&(a=a.not(o))),a.each2(function(e,t){s(t,r.results)}),i.callback(r)}),i.id=function(e){return e.id}):"query"in i||("ajax"in i?i.query=p(i.ajax):"data"in i?i.query=f(i.data):"tags"in i&&(i.query=g(i.tags),i.createSearchChoice=function(e){return{id:e,text:e}},i.initSelection=function(t,i){var n=[];e(a(t.val(),",")).each(function(){n.push({id:this,text:this})}),i(n)})),"function"!=typeof i.query)throw"query function not defined for Select2 "+i.element.attr("id");return i},monitorSource:function(){this.opts.element.bind("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()}))},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1)},enable:function(){this.enabled||(this.enabled=!0,this.container.removeClass("select2-container-disabled"))},disable:function(){this.enabled&&(this.close(),this.enabled=!1,this.container.addClass("select2-container-disabled"))},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var e,t,i=this.container.offset(),n=this.container.outerHeight(),a=this.container.outerWidth(),o=this.dropdown.outerHeight(),s=document.body.scrollTop+document.documentElement.clientHeight,r=i.top+n,c=s>=r+o,l=i.top-o>=document.body.scrollTop,d=this.dropdown.hasClass("select2-drop-above");d?(e=!0,!l&&c&&(e=!1)):(e=!1,!c&&l&&(e=!0)),e?(r=i.top-o,this.container.addClass("select2-drop-above"),this.dropdown.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")),t={top:r,left:i.left,width:a},this.dropdown.css(t)},shouldOpen:function(){var e;return this.opened()?!1:(e=jQuery.Event("open"),this.opts.element.trigger(e),!e.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.clearDropdownAlignmentPreference()," "===this.search.val()&&this.search.val(""),this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),this.dropdown.addClass("select2-drop-active"),this.positionDropdown(),this.updateResults(!0),this.dropdown.show(),this.ensureHighlightVisible(),this.focusSearch(),!0):!1},close:function(){this.opened()&&(this.clearDropdownAlignmentPreference(),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open"),this.results.empty(),this.clearSearch())},clearSearch:function(){},ensureHighlightVisible:function(){var i,n,a,o,s,r,c,l=this.results;if(n=this.highlight(),!(0>n)){if(0==n)return l.scrollTop(0),t;i=l.find(".select2-result-selectable"),a=e(i[n]),o=a.offset().top+a.outerHeight(),n===i.length-1&&(c=l.find("li.select2-more-results"),c.length>0&&(o=c.offset().top+c.outerHeight())),s=l.offset().top+l.outerHeight(),o>s&&l.scrollTop(l.scrollTop()+(o-s)),r=a.offset().top-l.offset().top,0>r&&l.scrollTop(l.scrollTop()+r)}},moveHighlight:function(t){var i,n,a;for(i=this.results.find(".select2-result-selectable"),n=this.highlight();n>-1&&i.length>n;)if(n+=t,a=e(i[n]),a.hasClass("select2-result-selectable")&&!a.hasClass("select2-disabled")){this.highlight(n);break}},highlight:function(n){var a=this.results.find(".select2-result-selectable");return 0===arguments.length?i(a.filter(".select2-highlighted")[0],a.get()):(n>=a.length&&(n=a.length-1),0>n&&(n=0),a.removeClass("select2-highlighted"),e(a[n]).addClass("select2-highlighted"),this.ensureHighlightVisible(),t)},highlightUnderEvent:function(t){var i,n;i=e(t.target).closest(".select2-result-selectable"),i.length>0&&!i.is(".select2-highlighted")?(n=this.results.find(".select2-result-selectable"),this.highlight(n.index(i))):0==i.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e,t=this.results,i=t.find("li.select2-more-results"),n=this.resultsPage+1,a=this,o=this.search.val(),s=this.context;0!==i.length&&(e=i.offset().top-t.offset().top-t.height(),0>=e&&(i.addClass("select2-active"),this.opts.query({term:o,page:n,context:s,matcher:this.opts.matcher,callback:this.bind(function(e){a.opts.populateResults.call(this,t,e.results,{term:o,page:n,context:s}),e.more===!0?(i.detach().appendTo(t.children(":last")).text(a.opts.formatLoadMore(n+1)),window.setTimeout(function(){a.loadMoreIfNeeded()},10)):i.remove(),a.positionDropdown(),a.resultsPage=n})})))},updateResults:function(i){function a(){r.scrollTop(0),s.removeClass("select2-active"),l.positionDropdown()}function o(e){r.html(e),a()}var s=this.search,r=this.results,c=this.opts,l=this;if(i===!0||this.showSearchInput!==!1){if(s.addClass("select2-active"),c.minimumInputLength>s.val().length)return o("<li class='select2-no-results'>"+c.formatInputTooShort(s.val(),c.minimumInputLength)+"</li>"),t;this.resultsPage=1,c.query({term:s.val(),page:this.resultsPage,context:null,matcher:c.matcher,callback:this.bind(function(d){var u;return this.context=d.context===t?null:d.context,this.opts.createSearchChoice&&""!==s.val()&&(u=this.opts.createSearchChoice.call(null,s.val(),d.results),u!==t&&null!==u&&l.id(u)!==t&&null!==l.id(u)&&0===e(d.results).filter(function(){return n(l.id(this),l.id(u))}).length&&d.results.unshift(u)),0===d.results.length?(o("<li class='select2-no-results'>"+c.formatNoMatches(s.val())+"</li>"),t):(r.empty(),l.opts.populateResults.call(this,r,d.results,{term:s.val(),page:this.resultsPage,context:null}),a(),d.more===!0&&(r.children().filter(":last").append("<li class='select2-more-results'>"+c.formatLoadMore(this.resultsPage)+"</li>"),window.setTimeout(function(){l.loadMoreIfNeeded()},10)),this.postprocessResults(d,i),t)})})}},cancel:function(){this.close()},blur:function(){this.close(),this.container.removeClass("select2-container-active"),this.dropdown.removeClass("select2-drop-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){window.setTimeout(this.bind(function(){this.search.focus()}),10)},selectHighlighted:function(){var e=this.results.find(".select2-highlighted").not(".select2-disabled").closest(".select2-result-selectable").data("select2-data");e&&this.onSelect(e)},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},getContainerWidth:function(){var e,i,n,a,o;if(this.opts.width!==t)return this.opts.width;if(e=this.opts.element.attr("style"),e!==t)for(i=e.split(";"),a=0,o=i.length;o>a;a+=1)if(n=i[a].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/),null!==n&&n.length>=1)return n[1];return e=this.opts.element.css("width"),e.indexOf("%")>0?e:0===this.opts.element.width()?"auto":this.opts.element.outerWidth()+"px"}}),w=v(b,{createContainer:function(){return e("<div></div>",{"class":"select2-container",style:"width: "+this.getContainerWidth()}).html(["    <a href='javascript:void(0)' class='select2-choice'><input type='text' class='select2-offscreen select2-focusser'/>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","    <div class='select2-drop' style='display:none;'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.selection.focus()},isFocused:function(){return this.selection[0]===document.activeElement},cancel:function(){this.parent.cancel.apply(this,arguments),this.selection.focus()},initContainer:function(){var i,n=this.container,a=this.dropdown,o=e([this.container.get(0),this.dropdown.get(0)]),s=!1,r=".select2-choice",c=n.find("input.select2-focusser");this.selection=i=n.find(r),this.search.bind("keydown",this.bind(function(e){switch(e.which){case _.UP:case _.DOWN:return this.moveHighlight(e.which===_.UP?-1:1),d(e),t;case _.TAB:case _.ENTER:return this.selectHighlighted(),d(e),t;case _.ESC:return this.cancel(e),d(e),t}})),o.delegate(r,"click",this.bind(function(e){s=!0,this.opened()?(this.close(),i.focus()):this.enabled&&this.open(),e.preventDefault(),s=!1})),o.delegate(r,"keydown",this.bind(function(e){!this.enabled||e.which===_.TAB||_.isControl(e)||_.isFunctionKey(e)||e.which===_.ESC||(this.open(),(e.which===_.PAGE_UP||e.which===_.PAGE_DOWN||e.which===_.SPACE)&&d(e),e.which===_.ENTER&&d(e))})),o.delegate(r,"focus",function(){this.enabled&&(o.addClass("select2-container-active"),a.addClass("select2-drop-active"))}),o.delegate(r,"blur",this.bind(function(e){s||e.target!==c.get(0)&&(this.opened()||this.blur())})),i.delegate("abbr","click",this.bind(function(e){this.enabled&&(this.clear(),d(e),this.close(),this.triggerChange(),i.focus())})),this.setPlaceholder(),c.bind("focus",function(){i.focus()}),i.bind("focus",this.bind(function(){c.hide(),this.container.addClass("select2-container-active")})),i.bind("blur",function(){c.show()}),this.opts.element.bind("open",function(){c.hide()})},clear:function(){this.opts.element.val(""),this.selection.find("span").empty(),this.selection.removeData("select2-data"),this.setPlaceholder()},initSelection:function(){if(""===this.opts.element.val())this.updateSelection({id:"",text:""}),this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(i){i!==t&&null!==i&&(e.updateSelection(i),e.close(),e.setPlaceholder())})}},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return"select"===t.element.get(0).tagName.toLowerCase()&&(t.initSelection=function(t,i){var n=t.find(":selected");e.isFunction(i)&&i({id:n.attr("value"),text:n.text()})}),t},setPlaceholder:function(){var e=this.getPlaceholder();if(""===this.opts.element.val()&&e!==t){if(this.select&&""!==this.select.find("option:first").text())return;"object"==typeof e?this.updateSelection(e):this.selection.find("span").html(e),this.selection.addClass("select2-default"),this.selection.find("abbr").hide()}},postprocessResults:function(i,a){var o=0,s=this,r=!0;this.results.find(".select2-result-selectable").each2(function(e,i){return n(s.id(i.data("select2-data")),s.opts.element.val())?(o=e,!1):t}),this.highlight(o),a===!0&&(r=this.showSearchInput=i.results.length>=this.opts.minimumResultsForSearch,this.dropdown.find(".select2-search")[r?"removeClass":"addClass"]("select2-search-hidden"),e(this.dropdown,this.container)[r?"addClass":"removeClass"]("select2-with-searchbox"))},onSelect:function(e){var t=this.opts.element.val();this.opts.element.val(this.id(e)),this.updateSelection(e),this.close(),this.selection.focus(),n(t,this.id(e))||this.triggerChange()},updateSelection:function(e){this.selection.data("select2-data",e),this.selection.find("span").html(this.opts.formatSelection(e)),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.selection.find("abbr").show()},val:function(){var e,i=null;return 0===arguments.length?this.opts.element.val():(e=arguments[0],this.select?(this.select.val(e).find(":selected").each2(function(e,t){return i={id:t.attr("value"),text:t.text()},!1}),this.updateSelection(i)):(this.opts.element.val(e?this.id(e):""),this.updateSelection(e)),this.setPlaceholder(),t)},clearSearch:function(){this.search.val("")},data:function(e){return 0===arguments.length?this.selection.data("select2-data"):(e&&""!==e?(this.opts.element.val(e?this.id(e):""),this.updateSelection(e)):this.clear(),t)}}),y=v(b,{createContainer:function(){return e("<div></div>",{"class":"select2-container select2-container-multi",style:"width: "+this.getContainerWidth()}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' style='width: 25px;' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments);return t=e.extend({},{closeOnSelect:!0},t),"select"===t.element.get(0).tagName.toLowerCase()&&(t.initSelection=function(t,i){var n=[];t.find(":selected").each2(function(e,t){n.push({id:t.attr("value"),text:t.text()})}),e.isFunction(i)&&i(n)}),t},initContainer:function(){var e,i=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=e=this.container.find(i),this.search.bind("keydown",this.bind(function(i){if(this.enabled){if(i.which===_.BACKSPACE&&""===this.search.val()){this.close();var n,a=e.find(".select2-search-choice-focus");if(a.length>0)return this.unselect(a.first()),this.search.width(10),d(i),t;n=e.find(".select2-search-choice"),n.length>0&&n.last().addClass("select2-search-choice-focus")}else e.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");if(this.opened())switch(i.which){case _.UP:case _.DOWN:return this.moveHighlight(i.which===_.UP?-1:1),d(i),t;case _.ENTER:case _.TAB:return this.selectHighlighted(),d(i),t;case _.ESC:return this.cancel(i),d(i),t}i.which===_.TAB||_.isControl(i)||_.isFunctionKey(i)||i.which===_.BACKSPACE||i.which===_.ESC||(this.open(),(i.which===_.PAGE_UP||i.which===_.PAGE_DOWN)&&d(i))}})),this.search.bind("keyup",this.bind(this.resizeSearch)),this.container.delegate(i,"click",this.bind(function(e){this.enabled&&(this.clearPlaceholder(),this.open(),this.focusSearch(),e.preventDefault())})),this.container.delegate(i,"focus",this.bind(function(){this.enabled&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.clearSearch()},enable:function(){this.enabled||(this.parent.enable.apply(this,arguments),this.search.show())},disable:function(){this.enabled&&(this.parent.disable.apply(this,arguments),this.search.hide())},initSelection:function(){if(""===this.opts.element.val()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(i){i!==t&&null!==i&&(e.updateSelection(i),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder();e!==t&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.search.width("auto")):this.search.val(" ").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")?this.search.val("").removeClass("select2-default"):" "===this.search.val()&&this.search.val("")},open:function(){return this.parent.open.apply(this,arguments)===!1?!1:(this.clearPlaceholder(),this.resizeSearch(),this.focusSearch(),!0)},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var n=[],a=[],o=this;e(t).each(function(){0>i(o.id(this),n)&&(n.push(o.id(this)),a.push(this))}),t=a,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){o.addSelectedChoice(this)}),o.postprocessResults()},onSelect:function(e){this.addSelectedChoice(e),this.select&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):(this.search.width(10),this.resizeSearch()),this.triggerChange({added:e}),this.focusSearch()},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(t){var i,n,a=this.id(t),o=this.getVal();n=["<li class='select2-search-choice'>",this.opts.formatSelection(t),"<a href='javascript:void(0)' class='select2-search-choice-close' tabindex='-1'></a>","</li>"],i=e(n.join("")),i.find("a").bind("click dblclick",this.bind(function(t){this.enabled&&(this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),d(t),this.close(),this.focusSearch())})).bind("focus",this.bind(function(){this.enabled&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),i.data("select2-data",t),i.insertBefore(this.searchContainer),o.push(a),this.setVal(o)},unselect:function(e){var t,n,a=this.getVal();if(e=e.closest(".select2-search-choice"),0===e.length)throw"Invalid argument: "+e+". Must be .select2-search-choice";t=e.data("select2-data"),n=i(this.id(t),a),n>=0&&(a.splice(n,1),this.setVal(a),this.select&&this.postprocessResults()),e.remove(),this.triggerChange({removed:t})},postprocessResults:function(){var e=this.getVal(),n=this.results.find(".select2-result-selectable"),a=this;n.each2(function(t,n){var o=a.id(n.data("select2-data"));i(o,e)>=0?n.addClass("select2-disabled"):n.removeClass("select2-disabled")}),n.each2(function(e,i){return i.hasClass("select2-disabled")?t:(a.highlight(e),!1)})},resizeSearch:function(){var e,t,i,n,a,s=o(this.search);e=u(this.search)+10,t=this.search.offset().left,i=this.selection.width(),n=this.selection.offset().left,a=i-(t-n)-s,e>a&&(a=i-s),40>a&&(a=i-s),this.search.width(a)},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),a(e,","))},setVal:function(t){var n;this.select?this.select.val(t):(n=[],e(t).each(function(){0>i(this,n)&&n.push(this)}),this.opts.element.val(0===n.length?"":n.join(",")))},val:function(){var i,n=[],a=this;return 0===arguments.length?this.getVal():(i=arguments[0],this.select?(this.setVal(i),this.select.find(":selected").each(function(){n.push({id:e(this).attr("value"),text:e(this).text()})}),this.updateSelection(n)):(i=null===i?[]:i,e(i).each(function(){n.push(a.id(this))}),this.setVal(n),this.updateSelection(i)),this.clearSearch(),t)},onSortStart:function(){if(this.select)throw Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],i=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(i.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(i){var n,a=this;return 0===arguments.length?this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get():(n=e.map(i,function(e){return a.opts.id(e)}),this.setVal(n),this.updateSelection(i),this.clearSearch(),t)}}),e.fn.select2=function(){var n,a,o,s,r=Array.prototype.slice.call(arguments,0),c=["val","destroy","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];return this.each(function(){if(0===r.length||"object"==typeof r[0])n=0===r.length?{}:e.extend({},r[0]),n.element=e(this),"select"===n.element.get(0).tagName.toLowerCase()?s=n.element.attr("multiple"):(s=n.multiple||!1,"tags"in n&&(n.multiple=s=!0)),a=s?new y:new w,a.init(n);else{if("string"!=typeof r[0])throw"Invalid arguments to select2 plugin: "+r;if(0>i(r[0],c))throw"Unknown method: "+r[0];if(o=t,a=e(this).data("select2"),a===t)return;if(o="container"===r[0]?a.container:a[r[0]].apply(a,r.slice(1)),o!==t)return!1}}),o===t?this:o},window.Select2={query:{ajax:p,local:f,tags:g},util:{debounce:c,markMatch:h},"class":{"abstract":b,single:w,multi:y}}}}(jQuery),function(){var e=Array.prototype,t=(Object.prototype,Function.prototype,e.slice),i=function(){},n=function(e){return $.each(t.call(arguments,1),function(t,i){var n;for(n in i)void 0!==i[n]&&(e[n]=i[n])}),e},a=function(e,t,a){var o;return o=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return e.apply(this,arguments)},n(o,e),i.prototype=e.prototype,o.prototype=new i,t&&n(o.prototype,t),a&&n(o,a),o.prototype.constructor=o,o.__super__=e.prototype,o},o=function(e,t){var i=a(this,e,t);return i.extend=this.extend,i},s=function(){};s.extend=o,TAPP.Klass=s,TAPP.Module=s.extend({register_for_event:function(e,t){$.subscribe(e,$.proxy(t,this))},register_post_load_hooks:function(e){var t=this;$.each(e,function(e,i){t.register_for_event(e,i)})},register_app_hooks:function(e){var t=this;$.each(e,function(e,i){t.register_for_event(e,i)})},publish_app_event:function(e,t){$.publish(e,t)},unload_functions:[],unload:function(){$.each(this.unload_functions,function(){this()}),this.unload_functions=[]}})}(TAPP),function(){var e=$.Deferred();$(window).on("load",function(){e.resolve()}),$.fn.serializeObject=function(e){var t,i;return t={},i=this.serializeArray(),$.each(i,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||"",e&&("on"===t[this.name]&&(t[this.name]=1),"off"===t[this.name]&&(t[this.name]=0))}),t},TAPP.utils={intcomma:function(e){return e=""+e,e.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")},show_form_errors:function(e,t){$.each(t,function(t,i){var n,a,o,s;n=e.find(".field-"+t),n.addClass("bad"),a=n.find("input,textarea"),a.addClass("bad"),o="",$.each(i,function(e,t){o+="<li>"+t+"</li>"
}),s=n.find("ul.error"),s.length||(a.after('<ul class="error"></ul>'),s=n.find("ul.error")),s.html(o)})},is_touch:function(){return $("html").hasClass("touch")},is_widescreen:function(){return $("html").hasClass("breakpoint-widescreen")},handle_resize:function(){$(window).on("resize",_.debounce(Modernizr.test_media_queries,50))},on_window_load:function(t){e.done(t)},fit_to_box:function(e,t,i,n,a){var o,s,r;return a=a||!1,i>e&&n>t&&!a?[e,t]:(o=Math.max(e/i,t/n),s=parseInt(t/o,10),r=parseInt(e/o,10),[r,s])}}}(TAPP),function(){var e,t,i,n,a;e={backdrop:!1,zIndex:1e4,buttons:{Close:function(){$(this).modal("close")}}},t=function(e,t,i){e=$("<div/>").addClass("modal-header").html(e),t=$("<div/>").addClass("modal-body").html(t),i=$("<div/>").addClass("modal-footer btn-group-spaced").html(i);var n=$("<div/>").addClass("modal").append(e).append(t).append(i);return n.addClass("hide").appendTo($("body")),$(n)},i=function(e){if(!e)return null;var t=$("<div/>");return $.each(e,function(e,i){var n,a,o;n=i.text||e,a=i["class"]||"mgt-btn",o=i.click||$.noop(),t.append($("<button/>").text(n).addClass(a).on("click",o))}),t},n=function(n,a){var o,s,r,c;return"string"!=typeof n&&(n=n.html()),o=a.title||"",s=a.buttons?i(a.buttons):a.footer||"",r=$.extend({},e,a),c=t(o,n,s),c.addClass(r.modal_classes),c.modal(r),c},a=TAPP.Module.extend({markup_dialog:function(e,t){return n(e,t)},error_dialog:function(e,t,i){var a,o;e=e||"Something is wrong with the server. Please wait a moment and try again.",o=$.extend({},{title:"<h3>An error occurred<h3>",dialogClass:"error-dialog",buttons:{Ok:{click:function(){a.modal("hide"),t&&t()}}}},i),a=n(e,o),a.modal("show")},confirm_dialog:function(e,t,i,a,o,s){var r,c;a=a||"<h3>Are you sure?</h3>",o=(o||"")+" confirmation-dialog",r=$(e),c=function(e){var r,c,l,d;return e.preventDefault(),e.stopImmediatePropagation(),c=$(this),l=s||{Cancel:{click:function(){r.modal("hide")}},Continue:{click:function(){c.unbind(e),c.trigger($.Event(t)),r.modal("hide")},text:"Continue","class":"mgt-btn mgt-btn-primary"}},c.data("dialog-init")?r=c.data("dialog-init"):(d={title:a,dialogClass:o,buttons:l},r=n(i,d),c.data("dialog-init",r)),r.modal("show"),!1},r.bind(t,c)}}),TAPP.dialogs=new a,TAPP.dialogs.register_post_load_hooks({confirm_dialog:TAPP.dialogs.confirm_dialog,error_dialog:TAPP.dialogs.error_dialog})}(TAPP),function(){var e=TAPP.Module.extend({get_cc_data:function(){return{number:$("#card-number").val(),cvc:$("#card-cvc").val(),exp_month:$("#card-exp-month").val(),exp_year:$("#card-exp-year").val(),name:$("#card-name").val(),address_country:$("#id_country_code").val()}},handle_form_submit:function(e){var t,i,n;return t=$("#card-exp-year").val(),2===t.length&&$("#card-exp-year").val("20"+t),i=$("[data-cc-submit]",e),i.attr("disabled","disabled"),n=$.Deferred(),Stripe.createToken(this.get_cc_data(),function(e,t){var a,o,s;t.error?(t.error.param&&(a=$("#card-"+t.error.param.replace("_","-")),o=a.closest(".control-group"),o.addClass("error"),$("body").on("change",a,function(){o.removeClass("error")})),s=t.error.message,window._kmq=window._kmq||[],window._kmq.push(["record","Stripe Error",{"Error Message":s}]),s[0].toUpperCase()!==s[0]&&(s="We couldn't process your order. Please fix the following information:"),$(".payment-errors").text(s),i.removeAttr("disabled"),n.reject(t)):($("#stripe_token").val(t.id),n.resolve(t))}),n},init:function(){Stripe.setPublishableKey(page_context.stripe_publishable_key)}});TAPP.stripe=new e}(TAPP),function(){var e,t;e=[],t=TAPP.Module.extend({fire_off_event:function(e,t,i){var n,a;page_context.disable_mixpanel||(a=function(){clearTimeout(n),i&&i()},$.extend(t,{distinct_id:page_context.cookie_value}),t.user_id&&mixpanel.name_tag(t.user_id),mixpanel.track(e,t,function(){a()}),i&&(n=setTimeout(i,300)),page_context.console_log_mixpanel&&console.log(e+", "+JSON.stringify(t)))},mixpanel_process_event_queue:function(t){var i=function(){e=[],t()};$.waitForFuncs(e,TAPP.event_tracking.fire_off_event,i)},mixpanel_empty_event_queue:function(){e=[]},mixpanel_event_delegate:function(){$("body").delegate("[data-mixpanel-event]","click",function(t){var i,n,a,o;i=$(this).data("mixpanel-event"),n=TAPP.event_tracking.mixpanel_global_metadata(),$.extend(n,$(this).data("mixpanel-info")),$(this).data("mixpanel-deferred")?e.push([i,n]):$(this).attr("data-mixpanel-navigate-wait")&&!page_context.is_pjax?(a=$(this).attr("href"),o=function(){window.top.location=a},t.stopImmediatePropagation(),t.preventDefault(),TAPP.event_tracking.fire_off_event(i,n,o)):TAPP.event_tracking.fire_off_event(i,n)})},mixpanel_global_metadata:function(){var e,t;return e={app_display_name:page_context.fb_app_display_name,page_id:page_context.fb_page_id,user_id:page_context.authenticated_user_id,device:$(".app-platform-carousel a.selected").data("mixpanel-device"),href:window.location.href},page_context.mixpanel_data&&$.extend(e,page_context.mixpanel_data),t={},_.each(e,function(e,i){e!==void 0&&(t[i]=e)}),t},track_event:function(e,t,i){var n=this.mixpanel_global_metadata();return t&&$.extend(n,t),this.fire_off_event(e,n,i)},track_event_server_side:function(e,t){var i={action:"receive_event",event_name:e};return t&&$.extend(i,t),$.ajax({type:"POST",url:""+window.location,data:i})}}),TAPP.event_tracking=new t,TAPP.event_tracking.register_app_hooks({track_event:TAPP.event_tracking.track_event,process_event_tracking_queue:TAPP.event_tracking.mixpanel_process_event_queue,empty_event_tracking_queue:TAPP.event_tracking.mixpanel_empty_event_queue})}(TAPP),TAPP.event_tracking.mixpanel_event_delegate(),function(){(function(e){var t=e.ajaxSettings.xhr;e.ajaxSetup({progress:e.noop,xhr:function(){var e=t(),i=this;return e&&"function"==typeof e.upload.addEventListener&&e.upload.addEventListener("progress",function(e){i.progress(e)},!1),e}})})(jQuery);var e=function(e){this.activator=e.activator,this.file_input=e.file_input,this.onfile=e.onfile||$.noop,this.onresetfile=e.onresetfile||$.noop,this.onuploadstart=e.onuploadstart||$.noop,this.onprogress=e.onprogress||$.noop,this.onuploaddone=e.onuploaddone||$.noop,this.allow=e.allow||!1,this.ondisallow=e.ondisallow||$.noop,this.max_file_size=e.max_file_size||!1,this.upload_to=e.upload_to,this.extra_data=e.extra_data||[],this.upload_on_change=e.upload_on_change||!1,this.upload_state=$.Deferred()};$.extend(e.prototype,{handle_change:function(e){var t,i,n,a,o;if(t=e.target.files&&e.target.files.length?e.target.files[0]:!1,!e.target.files&&!t)return i=$(e.target),n=i.closest("form"),n.get(0).submit(),void 0;if(t){if(this.allow&&!this.allow.test(t.type))return this.ondisallow(t),void 0;if(this.max_file_size&&t.size>this.max_file_size)return a=this.max_file_size/1024/1024,o=Math.round(100*(t.size/1024/1024))/100,TAPP.dialogs.error_dialog("The max file size is "+a+"MB. The file you tried to attach was "+o+"MB"),void 0;this.file=t,this.onfile(t,function(){var e,i;return e=new FileReader,i=$.Deferred(),e.onload=function(e){i.resolve(e)},e.readAsDataURL(t),i}),this.upload_on_change&&this.upload_file()}},handle_activator_click:function(){return this.file_input.trigger("click"),!1},bind_events:function(){this.activator.tapp_on("click.uploader",$.proxy(this.handle_activator_click,this)),this.bind_file_events()},bind_file_events:function(){this.file_input.tapp_on("change.uploader",$.proxy(this.handle_change,this))},reset_file_upload:function(){this.upload_state=$.Deferred(),this.file_input.off("change.uploader"),this.file_input.replaceWith(this.file_input.val("").clone(!0)),this.bind_file_events(),this.onresetfile()},upload_file:function(){this.onuploadstart();var e=new FormData;e.append("content",this.file),_.map(this.extra_data,function(t){e.append(t[0],t[1])}),this.current_upload=this.upload_to(e,$.proxy(function(e){if(e.lengthComputable){var t=parseInt(100*(e.loaded/e.total),10);this.onprogress(t)}},this)),this.current_upload.fail($.proxy(function(){TAPP.dialogs.error_dialog(),this.upload_state.reject(),this.reset_file_upload()},this)),this.current_upload.done($.proxy(function(e){this.upload_state.resolve(e),this.onuploaddone(e)},this))},update_progress:function(e){this.onprogress(e)}}),window.TAPP.FileUploader=e}(),function(){var e,t;e=function(e){this.button=$(e),this.upload_type=this.button.data("upload"),this.pre_select_aspect_ratio=parseFloat(this.button.data("pre-select-aspect-ratio")),this.restrict_aspect_ratio=parseFloat(this.button.data("restrict-aspect-ratio")),this.max_file_size=parseInt(this.button.data("max-file-size"),10),this.min_width=parseInt(this.button.data("min-width"),10),this.preview=$("[data-"+this.upload_type+"-preview]"),this.use_background_image=1===parseInt(this.preview.data("background-image"),10),this.use_server_side_resize=1===parseInt(this.preview.data("server-side-resize"),10),this.file_input=$("input[type=file][name="+this.upload_type+"]"),this.is_touch=TAPP.utils.is_touch();var t={activator:this.button,file_input:this.file_input,onresetfile:$.proxy(this.onresetfile,this),onuploadstart:$.proxy(this.onuploadstart,this),onuploaddone:$.proxy(this.onuploaddone,this),ondisallow:function(){TAPP.dialogs.error_dialog("You can only upload images. The file you tried to upload was not an image.")},upload_on_change:!0,upload_to:$.proxy(this.uploadto,this),extra_data:[["upload_type",this.upload_type],["action",this.is_touch?"upload_asset":"upload_intermediate_asset"]],allow:/image\/(gif|png|jpeg)/,max_file_size:this.max_file_size};this.uploader=new TAPP.FileUploader(t),this.uploader.bind_events()},$.extend(e.prototype,{pre_selection:function(e,t,i){var n,a,o,s,r,c,l,d,u;return n=e.image,a=t/2,o=i/2,s=n.width/2,r=n.height/2,c=s-a,0>c&&(c=0),l=c+t,l>n.width&&(l=n.width),d=r-o,0>d&&(d=0),u=d+i,u>n.height&&(u=n.height),[c,d,l,u]},load_new_image:function(e){this.use_background_image?this.preview.css("background-image","url("+e+")"):this.preview.attr("src",e)},finish_file_upload:function(e){var t,i,n;t=this.crop.w,this.min_width&&this.min_width>this.crop.w&&(t=this.min_width),i=$.map([this.crop.x,this.crop.y,t,this.crop.h],function(e){return Math.floor(e)}),n=this,$.post(window.location.href,{action:"finish_asset",upload_type:this.upload_type,asset_id:this.file_data.image.id,crop_x:i[0],crop_y:i[1],crop_w:i[2],crop_h:i[3]}).done($.proxy(function(t){return t.error?this.handle_error(t):(this.load_new_image(t.image.url),e(),void 0)},this)).fail(function(){n.handle_error()})},resize_modal:function(){var e,t,i,n,a,o;e=630,t=this.crop_dialog.find(".modal-body"),i=t.height(),n=$(window).height(),a=this.crop_dialog.height()+100,o=i-(a-n+60),o>e&&(o=e),o!==i&&t.css("max-height",o)},close_crop_dialog:function(){this.crop_dialog&&($(window).off("resize.crop"),this.crop_dialog.modal("hide"),this.crop_dialog.find("img").Jcrop("destroy"),this.crop_dialog.remove())},close_loading_dialog:function(){this.loading_dialog.modal("hide"),this.loading_dialog.remove()},crop_image:function(){var e,t;return this.min_width&&this.min_width>this.file_data.image.width?(TAPP.dialogs.error_dialog("This image must be at least "+this.min_width+"px wide."),this.uploader.reset_file_upload(),!1):(this.crop_dialog=TAPP.dialogs.markup_dialog("<div data-crop-dialog><div class='crop-dialog'><img></div></div>",{title:"Crop your image",modal_classes:"image-crop",buttons:{Close:{click:$.proxy(this.close_crop_dialog,this),"class":"btn btn-danger pull-left btn-small"},Crop:{click:$.proxy(function(e){var t,i;t=$(e.target),i=TAPP.lock_up(t),t.addClass("loading"),this.finish_file_upload($.proxy(function(){t.removeClass("loading"),i(),this.close_crop_dialog(),this.uploader.reset_file_upload()},this))},this),"class":"btn btn-success btn-small"}}}),this.crop_dialog.find("img").attr({src:this.file_data.image.url,width:this.file_data.image.preview_width+"px",height:this.file_data.image.preview_height+"px"}).css({margin:"0 auto"}),e=TAPP.utils.fit_to_box(this.pre_select_aspect_ratio,1,this.file_data.image.width,this.file_data.image.height,!0),t={trueSize:[this.file_data.image.width,this.file_data.image.height],setSelect:this.pre_selection(this.file_data,e[0],e[1]),onSelect:$.proxy(function(e){this.crop=e;var t=this;_.each(_.keys(e),function(i){t.crop[i]=Math.round(e[i])})},this)},this.restrict_aspect_ratio&&(t.aspectRatio=this.pre_select_aspect_ratio),this.min_width&&(t.minSize=[this.min_width,0]),this.crop_dialog.find("img").Jcrop(t),$(window).on("resize.crop",_.debounce($.proxy(this.resize_modal,this),50)),this.resize_modal(),void 0)},uploadto:function(e,t){var i={type:"POST",url:window.location.href,data:e,cache:!1,contentType:!1,processData:!1,progress:t};return $.ajax(i)},onuploadstart:function(){this.loading_dialog=TAPP.dialogs.markup_dialog("<div class='loading-dialog'><div class='spinner'></div></div>",{title:"Loading your image...",modal_classes:"loading-image-dialog"})},onuploaddone:function(e){return this.close_loading_dialog(),e.error?(this.handle_error(e),!1):(this.file_data=e,TAPP.utils.is_touch()?this.load_new_image(e.image.url):this.crop_image(),void 0)},onresetfile:function(){this.close_crop_dialog(),this.close_loading_dialog()},handle_error:function(e){var t=e&&e.error||void 0;TAPP.dialogs.error_dialog(t),this.uploader.reset_file_upload()}}),t=TAPP.Module.extend({settings_view_init:function(){this.file_uploads(),this.confirm_deauthorize(),this.my_stream_settings_form(),this.hash_expand(),this.settings_accordion(),this.authorized_apps_accordion(),this.confirm_username(),this.confirm_account_upgrade(),this.discounted_user_creator(),this.cancel_flow(),TAPP.utils.handle_resize(),$("[data-error-form]").click()},select2_init:function(){$("#id_language,#id_timezone").select2({width:"250px"})},file_uploads:function(){$("[data-upload]").each(function(){new e(this)})},confirm_deauthorize:function(){$("body").tapp_on("click","[data-deauthorize]",function(){var e,t,i,n,a,o,s;return e=$(this),t=TAPP.lock_up(e),i=e.closest("form"),n=e.data("app-name"),o={Cancel:{click:function(){return a.remove(),t(),!1},"class":"btn btn-gray"},Deauthorize:{click:function(){return a.remove(),t(),i.submit(),!1},text:"Deauthorize","class":"btn btn-danger"}},s={title:"<strong>Deauthorize "+n+"</strong>",buttons:o},a=TAPP.dialogs.markup_dialog("Are you sure you want to deauthorize this app?",s),a.show(),!1})},confirm_username:function(){$("body").tapp_on("click","[data-change-username]",function(){var e,t,i,n;return e=$(this).closest("form"),i={Cancel:{click:function(){t.remove()},"class":"btn btn-gray"},Confirm:{click:function(){return e.submit(),t.remove(),!1},text:"Change Username","class":"btn btn-danger"}},n={title:"<strong>Change Username</strong>",buttons:i},t=TAPP.dialogs.markup_dialog("Are you sure you want to change your username? You will not be able to change it ever again after this.",n),t.show(),!1})},confirm_account_upgrade:function(){$("body").tapp_on("click","[data-upgrade-account]",function(){var e,t,i,n,a,o,s;return e=$(this).attr("data-payment-source-name"),t=$(this).attr("data-upgrade-amount"),i=$(this).attr("data-upgrade-date"),n=$(this).closest("form"),o={Cancel:{click:function(){a.remove()},"class":"btn btn-gray"},Confirm:{click:function(){return n.submit(),a.remove(),!1},text:"Upgrade Account","class":"btn btn-gray"}},s={title:"<strong>Upgrade Account</strong>",buttons:o},a=TAPP.dialogs.markup_dialog("Are you sure you want to upgrade your account? Your "+e+" will be billed $"+t+(i?" on "+i:"")+".",s),a.show(),!1})},my_stream_settings_form:function(){$("body").tapp_on("change","[data-my-stream-settings] input",function(){var e=$(this).closest("form");e.submit()})},hash_expand:function(){var e,t;e=window.location.hash,t=e.substr(1,e.length),t&&($("[data-expandable-setting]").each(function(e,t){$(t).removeClass("expanded")}),$("[name="+t+"]").addClass("expanded"))},settings_accordion:function(){$("body").on("click","[data-expandable-setting]",function(){var e=$(this);e.hasClass("expanded")||($("[data-expandable-setting].expanded").removeClass("expanded"),e.addClass("expanded"))})},authorized_apps_accordion:function(){$("body").on("click","[data-expand-authorized-app]",function(){var e=$(this).closest(".authorized-app");return e.hasClass("expanded")||($(".authorized-apps-list .authorized-app").removeClass("expanded"),e.addClass("expanded")),!1})},payment_details_init:function(){var e,t,i,n;$("#id_country_code,#id_plan_choice").select2({width:"250px"}),e=$("[data-card-details]"),t=$("[data-card-details-form]"),i=t.data("local-action"),$("body").on("click","[data-edit-card-details]",function(){return e.addClass("hide"),t.removeClass("hide"),!1}),TAPP.stripe.init(),n=$("#payment-form"),n.on("submit",function(e){var t=$("[data-spinner]");return t.removeClass("hide"),e.preventDefault(),TAPP.stripe.handle_form_submit(n).done(function(){var e={stripe_token:$("#stripe_token").val(),country_code:$("#id_country_code").val(),payment_method:$("#id_payment_method").val(),plan_choice:$("#id_plan_choice").val(),action:i};$(".payment-errors").text(""),$.post(window.location.href,e).done(function(e){if("error"===e.status)if($(".payment-errors").text(e.message),$(".hide-on-payment-error").addClass("hide"),"card"===e.error_type){var t=$("#card-number");t.closest(".control-group").addClass("error"),$("body").on("change",t,function(){t.closest(".control-group").removeClass("error"),$("body").off("change",t)})}else"user_details"===e.error_type&&TAPP.utils.show_form_errors(n,e.form_errors);else $("[data-card-update-complete]").submit()}).fail(function(){$(".payment-errors").text("Something is wrong with the server. Please wait a moment and try again.")}).always(function(){$("[data-cc-submit]").removeAttr("disabled"),t.addClass("hide")})}).fail(function(){t.addClass("hide")}),!1})},developer_enrollment_init:function(){$("#id_country").select2({width:"250px"})},discounted_user_creator:function(){$("body").on("click","[data-create-discounted-user]",function(){return $.ajax({url:window.location.href,type:"POST",data:{action:"add_discounted_code"},success:function(){window.location.reload()}}),!1})},submission_lockup:function(){$("body").on("click","[data-submit-for-approval]",function(){TAPP.lock_up($(this))})},init_app_feedback:function(){fdSlider.rescanDocument(),$(".feedback-widget").each(function(){var e=$(this);e.find(".notch").css({width:e.find(".fd-slider-range").css("width")})})},init_star_app_feedback:function(){var e=function(e){$.ajax({url:window.location.href,type:"POST",data:{action:"star_rating",rating:e}})};$("[data-star-rating]").each(function(){var t,i,n;t=$(this),i=t.data("target"),n=$.map([1,2,3,4,5,6,7,8,9,10],function(e){return e+" stars"}),t.raty({cancel:!0,target:i,targetKeep:!0,targetType:"number",number:10,size:74,hintList:n,path:"/static/palama/images/",click:e})})},cancel_flow:function(){$("body").tapp_on("click","[data-cancel-account-begin], [data-resubscribe-btn]",function(){$(".user-settings .non-standalone").addClass("hide"),$(".user-settings .standalone").removeClass("hide"),$(this).is("[data-cancel-account-begin]")?$(".user-settings .standalone .are-you-sure-cancel").removeClass("hide"):$(".user-settings .standalone .resubscribe").removeClass("hide")}),$("body").tapp_on("click","[data-goto-cancel-survey]",function(){$(".user-settings .standalone .are-you-sure-cancel").addClass("hide"),$(".user-settings .standalone .cancel-survey").removeClass("hide")}),$("body").tapp_on("click","[data-cancel-account-begin]",function(){TAPP.event_tracking.track_event_server_side("cancel-begin"),TAPP.event_tracking.track_event_server_side("Begin Cancellation Flow",{kissmetrics:!0})}),$("body").tapp_on("click","[data-goto-cancel-survey]",function(){TAPP.event_tracking.track_event_server_side("cancel-benefits-btn-proceed"),TAPP.event_tracking.track_event_server_side("Advance Cancellation Flow",{kissmetrics:!0})})}}),TAPP.settings_view=new t,TAPP.settings_view.register_post_load_hooks({settings_view_init:TAPP.settings_view.settings_view_init,payment_details_init:TAPP.settings_view.payment_details_init,developer_enrollment_init:TAPP.settings_view.developer_enrollment_init,submission_lockup:TAPP.settings_view.submission_lockup,init_app_feedback:TAPP.settings_view.init_app_feedback,init_star_app_feedback:TAPP.settings_view.init_star_app_feedback,select2_init:TAPP.settings_view.select2_init})}(),function(){var e=TAPP.Module.extend({init_developer:function(){this.edit_redirect_uris(),this.file_uploads()},edit_redirect_uris:function(){var e,t,i,n;$("body").on("click","[data-remove-redirect-uri]",function(){var e,t,i;return e=$(this),t=e.data("remove-redirect-uri"),i=e.closest("li"),i.addClass("hide"),$.post(window.location.href,{action:"modify_redirect_uris",redirect_uri:t,app_id:page_context.app_id}).fail(function(){i.removeClass("hide"),TAPP.dialogs.error_dialog("Sorry we couldn't remove that Callback URL. Please wait a moment and try again.")}).done(function(){i.remove()}),!1}),e=$("[data-add-redirect-uri-input]"),t=$("[data-redirect-uris]"),i=function(e,t,i){e.remove(),t.val(i)},n=function(e){TAPP.dialogs.error_dialog(e+" is a duplicate Callback URL.")},$("body").on("click","[data-add-redirect-uri-button]",function(){var a,o,s,r,c;return a=$(this),o=TAPP.lock_up(a),s=$.trim(e.val()),""===s?(o(),!1):(r=!1,t.find("li a").each(function(){var e=$(this).data("remove-redirect-uri");e===s&&(r=!0,n(s))}),r?(o(),!1):(c=$('<li><a href="#remove" data-remove-redirect-uri="'+s+'">&times;</a> '+s+"</li>"),t.append(c),e.val(""),$.post(window.location.href,{action:"modify_redirect_uris",redirect_uri:s,app_id:page_context.app_id,add:"1"}).always(o).fail(function(){i(c,e,s),TAPP.dialogs.error_dialog("Sorry we couldn't add that Callback URL. Please wait a moment and try again.")}).done(function(t){"error"===t.status&&(i(c,e,s),t.form_errors&&t.form_errors.redirect_uri&&n(s))}),!1))})},file_uploads:function(){$("body").on("change","[data-tax-upload]",function(){$(this).closest(".salesforce-upload-block").find(".spinner").removeClass("hide"),$(this).closest(".dip-upload-form").addClass("hide"),$(this).closest(".dip-upload-form").submit()}),$("body").on("click","[data-e-sign]",function(){var e=$("input:text[name=signature]");e.val().length>0&&($(this).closest(".salesforce-control-group").find(".spinner").removeClass("hide"),$(this).closest(".btn-primary").addClass("hide"))})},init_screenshots:function(){$("body").tapp_on("change","[data-image-upload] input[type=file]",function(){$(this).closest("form").submit()}),$("[data-image-upload]").tapp_on("submit",function(){var e,t,i;return e=$(this),t=e.data("replace"),i=$(e.data("asset-output")),e.ajaxSubmit({iframe:!0,resetForm:!0,url:""+window.location,dataType:"json",success:function(e){i.data("has-assets")||(t=!0),"ok"===e.status?(t?i.html(e.html):i.append(e.html),i.data("has-assets",!0)):TAPP.dialogs.error_dialog(e.msg)},error:function(){TAPP.dialogs.error_dialog(),e.resetForm()}}),!1}),$("body").tapp_on("click","[data-delete-asset]",function(){var e,t,i,n,a,o,s;return e=$(this),t=TAPP.lock_up(e),i=e.data("asset-id"),n=function(){var n=e.closest(".screenshot-container");n.hide(),$.ajax({type:"POST",url:""+window.location,data:{asset_id:i,action:"delete_image"}}).fail(function(){TAPP.dialogs.error_dialog(),n.show()}).done(function(){n.remove()}).always(function(){t()})},o={Cancel:{click:function(){a.remove(),t()}},Delete:{click:function(){return n(),a.remove(),!1},text:"Delete","class":"btn btn-danger"}},s={title:"<strong>Delete Screenshot</strong>",buttons:o},a=TAPP.dialogs.markup_dialog("Are you sure you want to delete this screenshot?",s),a.show(),!1})},init_markdown_preview:function(){var e,t,i,n,a;e=$("[data-markdown-widget]"),t=e.find("[data-markdown-widget-body]"),i=t.find("[data-markdown-preview]"),n=t.find("textarea"),a=function(){var e=n.val();i.html('<div class="loader"></div>'),$.post(window.location.href,{markdown:e,action:"markdown_preview"}).done(function(e){i.html(e)}).fail(function(){i.html(""),TAPP.dialogs.error()})},$("body").tapp_on("click","[data-markdown-toggle]",function(){return e.toggleClass("previewing").toggleClass("editing"),e.hasClass("previewing")&&a(),!1})},init_delete_page:function(){$("body").tapp_on("click","[data-delete-page]",function(){var e,t,i,n,a,o;return e=$(this),t=TAPP.lock_up(e),i=function(){$.ajax({type:"POST",url:window.location.href,data:{action:"delete_page"}}).fail(function(){TAPP.dialogs.error_dialog()}).done(function(e){window.location=e}).always(function(){t()})},a={Cancel:{click:function(){n.remove(),t()},"class":"btn btn-gray float-left"},Delete:{click:function(){return i(),n.remove(),!1},text:"Delete","class":"btn btn-danger"}},o={title:"<strong>Delete This Page</strong>",buttons:a},n=TAPP.dialogs.markup_dialog("Are you sure you want to delete this page?",o),n.show(),!1})}});TAPP.developer=new e,TAPP.developer.register_post_load_hooks({init_developer:TAPP.developer.init_developer,init_screenshots:TAPP.developer.init_screenshots,init_markdown_preview:TAPP.developer.init_markdown_preview,init_delete_page:TAPP.developer.init_delete_page})}(),$(document).ready(function(){var e=function(){var e=page_context.page_load_hooks;e&&($.isArray(page_context.page_load_hooks)||(e=[e]),$.each(page_context.page_load_hooks,function(e,t){var i,n,a;-1!==t.indexOf(".")?(i=t.split("."),n=TAPP,$.each(i,function(e,t){a=n,n=n[t]}),$.isFunction(n)&&n.call(a)):$.publish(t)})),$.publish("js_init_done")};e(),$.subscribe("pjax.end",function(){TAPP.unload(),$.each(TAPP,function(){this&&this.unload&&this.unload()}),e()})});