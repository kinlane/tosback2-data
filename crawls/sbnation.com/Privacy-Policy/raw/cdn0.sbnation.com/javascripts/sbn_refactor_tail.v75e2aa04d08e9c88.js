(function(b){function a(d,f,g){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},c=e[Modernizr.prefixed("transition")];d.each(function(i,j){function h(l){j.removeEventListener(c,h);g(j)}j.addEventListener(c,h)})}b.fn.addClassWithAnimationCallback=function(c,d){if(typeof Modernizr=="undefined"||!Modernizr.csstransitions){this.addClass(c);this.each(function(e,f){d(f)});return this}a(this,c,d);this.addClass(c);return this};b.fn.removeClassWithAnimationCallback=function(c,d){if(typeof Modernizr=="undefined"||!Modernizr.csstransitions){this.removeClass(c);this.each(function(e,f){d(f)});return this}a(this,c,d);this.removeClass(c);return this}})(jQuery);(function(b,a){var c=b(a);b.fn.lazyload=function(d){var f=this;var g;var e={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:a,data_attribute:"original",skip_invisible:true,appear:null,load:null};function h(){var i=0;f.each(function(){var j=b(this);if(e.skip_invisible&&!j.is(":visible")){return}if(b.abovethetop(this,e)||b.leftofbegin(this,e)){}else{if(!b.belowthefold(this,e)&&!b.rightoffold(this,e)){j.trigger("lazyload:appear")}else{if(++i>e.failure_limit){return false}}}})}if(d){if(undefined!==d.failurelimit){d.failure_limit=d.failurelimit;delete d.failurelimit}if(undefined!==d.effectspeed){d.effect_speed=d.effectspeed;delete d.effectspeed}b.extend(e,d)}g=(e.container===undefined||e.container===a)?c:b(e.container);if(0===e.event.indexOf("scroll")){g.bind(e.event,function(i){return h()})}this.each(function(){var i=this;var j=b(i);i.loaded=false;j.one("lazyload:appear",function(){if(!this.loaded){if(e.appear){var m=f.length;e.appear.call(i,m,e)}if(this.tagName==="IMG"){b("<img />").bind("load",function(){j.hide().attr("src",j.data(e.data_attribute))[e.effect](e.effect_speed);i.loaded=true;var n=b.grep(f,function(p){return !p.loaded});f=b(n);if(e.load){var o=f.length;e.load.call(i,o,e)}}).attr("src",j.data(e.data_attribute))}else{j.css("background-image","url("+j.data(e.data_attribute)+")")[e.effect](e.effect_speed);i.loaded=true;var l=b.grep(f,function(n){return !n.loaded});f=b(l);if(e.load){var m=f.length;e.load.call(i,m,e)}}}});if(0!==e.event.indexOf("scroll")){j.bind(e.event,function(l){if(!i.loaded){j.trigger("lazyload:appear")}})}});c.bind("resize",function(i){h()});h();return this};b.belowthefold=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.height()+c.scrollTop()}else{d=b(f.container).offset().top+b(f.container).height()}return d<=b(e).offset().top-f.threshold};b.rightoffold=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.width()+c.scrollLeft()}else{d=b(f.container).offset().left+b(f.container).width()}return d<=b(e).offset().left-f.threshold};b.abovethetop=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.scrollTop()}else{d=b(f.container).offset().top}return d>=b(e).offset().top+f.threshold+b(e).height()};b.leftofbegin=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.scrollLeft()}else{d=b(f.container).offset().left}return d>=b(e).offset().left+f.threshold+b(e).width()};b.inviewport=function(d,e){return !b.rightofscreen(d,e)&&!b.leftofscreen(d,e)&&!b.belowthefold(d,e)&&!b.abovethetop(d,e)};b.extend(b.expr[":"],{"below-the-fold":function(d){return b.belowthefold(d,{threshold:0})},"above-the-top":function(d){return !b.belowthefold(d,{threshold:0})},"right-of-screen":function(d){return b.rightoffold(d,{threshold:0})},"left-of-screen":function(d){return !b.rightoffold(d,{threshold:0})},"in-viewport":function(d){return !b.inviewport(d,{threshold:0})},"above-the-fold":function(d){return !b.belowthefold(d,{threshold:0})},"right-of-fold":function(d){return b.rightoffold(d,{threshold:0})},"left-of-fold":function(d){return !b.rightoffold(d,{threshold:0})}})})(jQuery,window);(function(D){function d(g){if(g&&void 0===g.allowPageScroll&&(void 0!==g.swipe||void 0!==g.swipeStatus)){g.allowPageScroll=l}g||(g={});g=D.extend({},D.fn.swipe.defaults,g);return this.each(function(){var m=D(this),n=m.data(j);n||(n=new a(this,g),m.data(j,n))})}function a(ag,ah){var ad,X,W,R;function C(E){var E=E.originalEvent,H,F=u?E.touches[0]:E;af=c;u?ac=E.touches.length:E.preventDefault();ab=0;aa=null;Z=0;!u||ac===ah.fingers||ah.fingers===i?(W=ad=F.pageX,R=X=F.pageY,z=(new Date).getTime(),ah.swipeStatus&&(H=Y(E,af))):Q(E);if(!1===H){return af=y,Y(E,af),H}ae.bind(B,A);ae.bind(x,w)}function A(E){E=E.originalEvent;if(!(af===s||af===y)){var J,H=u?E.touches[0]:E;ad=H.pageX;X=H.pageY;G=(new Date).getTime();aa=n();u&&(ac=E.touches.length);af=h;var H=E,F=aa;if(ah.allowPageScroll===l){H.preventDefault()}else{var I=ah.allowPageScroll===b;switch(F){case o:(ah.swipeLeft&&I||!I&&ah.allowPageScroll!=f)&&H.preventDefault();break;case t:(ah.swipeRight&&I||!I&&ah.allowPageScroll!=f)&&H.preventDefault();break;case r:(ah.swipeUp&&I||!I&&ah.allowPageScroll!=e)&&H.preventDefault();break;case p:(ah.swipeDown&&I||!I&&ah.allowPageScroll!=e)&&H.preventDefault()}}ac===ah.fingers||ah.fingers===i||!u?(ab=m(),Z=G-z,ah.swipeStatus&&(J=Y(E,af,aa,ab,Z)),ah.triggerOnTouchEnd||(H=!(ah.maxTimeThreshold?!(Z>=ah.maxTimeThreshold):1),!0===T()?(af=s,J=Y(E,af)):H&&(af=y,Y(E,af)))):(af=y,Y(E,af));!1===J&&(af=y,Y(E,af))}}function w(E){E=E.originalEvent;E.preventDefault();G=(new Date).getTime();ab=m();aa=n();Z=G-z;if(ah.triggerOnTouchEnd||!1===ah.triggerOnTouchEnd&&af===h){if(af=s,(ac===ah.fingers||ah.fingers===i||!u)&&0!==ad){var F=!(ah.maxTimeThreshold?!(Z>=ah.maxTimeThreshold):1);if((!0===T()||null===T())&&!F){Y(E,af)}else{if(F||!1===T()){af=y,Y(E,af)}}}else{af=y,Y(E,af)}}else{af===h&&(af=y,Y(E,af))}ae.unbind(B,A,!1);ae.unbind(x,w,!1)}function Q(){z=G=X=ad=R=W=ac=0}function Y(E,H){var F=void 0;ah.swipeStatus&&(F=ah.swipeStatus.call(ae,E,H,aa||null,ab||0,Z||0,ac));if(H===y&&ah.click&&(1===ac||!u)&&(isNaN(ab)||0===ab)){F=ah.click.call(ae,E,E.target)}if(H==s){switch(ah.swipe&&(F=ah.swipe.call(ae,E,aa,ab,Z,ac)),aa){case o:ah.swipeLeft&&(F=ah.swipeLeft.call(ae,E,aa,ab,Z,ac));break;case t:ah.swipeRight&&(F=ah.swipeRight.call(ae,E,aa,ab,Z,ac));break;case r:ah.swipeUp&&(F=ah.swipeUp.call(ae,E,aa,ab,Z,ac));break;case p:ah.swipeDown&&(F=ah.swipeDown.call(ae,E,aa,ab,Z,ac))}}(H===y||H===s)&&Q(E);return F}function T(){return null!==ah.threshold?ab>=ah.threshold:null}function m(){return Math.round(Math.sqrt(Math.pow(ad-W,2)+Math.pow(X-R,2)))}function n(){var E;E=Math.atan2(X-R,W-ad);E=Math.round(180*E/Math.PI);0>E&&(E=360-Math.abs(E));return 45>=E&&0<=E?o:360>=E&&315<=E?o:135<=E&&225>=E?t:45<E&&135>E?p:r}function g(){ae.unbind(N,C);ae.unbind(M,Q);ae.unbind(B,A);ae.unbind(x,w)}var v=u||!ah.fallbackToMouseEvents,N=v?"touchstart":"mousedown",B=v?"touchmove":"mousemove",x=v?"touchend":"mouseup",M="touchcancel",ab=0,aa=null,Z=0,ae=D(ag),af="start",ac=0,z=X=ad=R=W=0,G=0;try{ae.bind(N,C),ae.bind(M,Q)}catch(q){D.error("events not supported "+N+","+M+" on jQuery.swipe")}this.enable=function(){ae.bind(N,C);ae.bind(M,Q);return ae};this.disable=function(){g();return ae};this.destroy=function(){g();ae.data(j,null);return ae}}var o="left",t="right",r="up",p="down",l="none",b="auto",f="horizontal",e="vertical",i="all",c="start",h="move",s="end",y="cancel",u="ontouchstart" in window,j="TouchSwipe";D.fn.swipe=function(n){var g=D(this),m=g.data(j);if(m&&"string"===typeof n){if(m[n]){return m[n].apply(this,Array.prototype.slice.call(arguments,1))}D.error("Method "+n+" does not exist on jQuery.swipe")}else{if(!m&&("object"===typeof n||!n)){return d.apply(this,arguments)}}return g};D.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,click:null,triggerOnTouchEnd:!0,allowPageScroll:"auto",fallbackToMouseEvents:!0};D.fn.swipe.phases={PHASE_START:c,PHASE_MOVE:h,PHASE_END:s,PHASE_CANCEL:y};D.fn.swipe.directions={LEFT:o,RIGHT:t,UP:r,DOWN:p};D.fn.swipe.pageScroll={NONE:l,HORIZONTAL:f,VERTICAL:e,AUTO:b};D.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:i}})(jQuery);
/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function(a){a.cookie=function(g,f,l){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(f))||f===null||f===undefined)){l=a.extend({},l);if(f===null||f===undefined){l.expires=-1}if(typeof l.expires==="number"){var h=l.expires,j=l.expires=new Date();j.setDate(j.getDate()+h)}f=String(f);return(document.cookie=[encodeURIComponent(g),"=",l.raw?f:encodeURIComponent(f),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join(""))}l=f||{};var b=l.raw?function(i){return i}:decodeURIComponent;var c=document.cookie.split("; ");for(var e=0,d;d=c[e]&&c[e].split("=");e++){if(b(d[0])===g){return b(d[1]||"")}}return null}})(jQuery);(function(d){function c(h){h.preventDefault();var g=h.data;var i=g.attr("href");var f=g.data("rec-url")===i;d.ajax({type:"POST",url:i,dataType:"text",success:function(){b(f,g)}})}function a(f){var e=f.data("rec-count");f.find(".recommend-link-count").remove();if(e>0){f.append('<b class="recommend-link-count">('+e+")</b>")}}function b(f,g){var e=parseInt(g.data("rec-count"));if(f){g.attr("href",g.data("unrec-url"));g.data("rec-count",e+1);g.text("Unrec");a(g)}else{g.attr("href",g.data("rec-url"));g.data("rec-count",e-1);g.text("Rec");a(g)}}d.fn.sbnRecommendLink=function(){return this.each(function(){var e=d(this);e.on("click",e,c);a(e)})}})(jQuery);(function(a){a("*[data-recommend-entry-id]").sbnRecommendLink()})(jQuery);var Vox=Vox||{};Vox.Modules={};jQuery(document).ready(function(g){Vox.Module.prototype.instrumentation=Util.Instrumentation;Vox.Module.prototype.eventDispatcher=Vox.EventDispatcher;var e=Vox.Modules,b=Vox.ModulesUtil,f=[],a=0;for(var d in e){f[f.length]=d}function c(){for(var i=f.length;a<i;a++){e[f[a]]._init()}if(window.removeEventListener){window.removeEventListener("error",h)}else{if(window.detachEvent){window.detachEvent("error",h)}}}function h(l,j,i){a+=1;c()}if(window.addEventListener){window.addEventListener("error",h,false)}else{if(window.attachEvent){window.attachEvent("error",h)}}c()});Vox.Module=function(){};Vox.Module.prototype.util=Vox.ModuleUtil;Vox.Module.prototype.templates=["default"];Vox.Module.prototype.name=null;Vox.Module.prototype.view=null;Vox.Module.prototype.views=[];Vox.Module.prototype.bindings={};Vox.Module.prototype.isInit=false;Vox.Module.prototype.env=Vox.Environment;Vox.Module.prototype.instrumentation=null;Vox.Module.prototype.eventDispatcher=null;Vox.Module.prototype.construct=function(){this.util.construct.apply(this,arguments)};Vox.Module.prototype.init=function(a){throw"You must provide an init method for "+this.name};Vox.Module.prototype.initUI=function(){throw"You must provide an initUI method for "+this.name};Vox.Module.prototype.detachUI=function(){throw"You must provide an detachUI method for "+this.name};Vox.Module.prototype._init=function(){this.init();this.isInit=true};var Vox=Vox||{};Vox.EventDispatcher=function(){var f={};var h={};var a=Util.getUrlVars()["debugEventDispatcher"]==true;var c=Util.getUrlVars()["debugVerbose"]==true;function g(l,i,j){if(!l[i]){l[i]=[]}l[i].push(j)}function e(m,p,l){var p=p||{};var o=f[m];if(a){console.log("Vox.EventDispatcher is publishing the following event",m,p)}if(l){if(a){console.log("Vox.EventDispatcher event "+m+" should be applied to all subsequent events",m,p)}g(h,m,p)}if(!f[m]){return}p.eventType=m;for(var n=0,j=o.length;n<j;n++){o[n](p)}}function d(l,n){g(f,l,n);if(a&&!c){console.log("Vox.EventDispatcher is subscribing to the following event",l)}if(a&&c){console.log("Vox.EventDispatcher is subscribing to the following event",l,n)}var o=h[l];if(o){for(var m=0,j=o.length;m<j;m++){if(a){console.log("Vox.EventDispatcher has found an event of the type "+l+" that should be applied to any subsequent subscriber",l,o[m])}n(o[m])}}}function b(j,n){if(!f[j]){return}var l=f[j];for(var m=l.length-1;m>-1;m--){if(l[m]==n){l.splice(m,0)}}}return{publish:function(j,l,i){var i=i||false;e(j,l,i)},subscribe:function(i,j){d(i,j)},unsubscribe:function(i,j){b(i,j)}}}();var Vox=Vox||{};Vox.Environment=function(h){var c=h(window);var g=h("body");var o=null,i=null,n=null,m=null;var j=(("ontouchstart" in window)||window.navigator.msMaxTouchPoints||(window.DocumentTouch&&document instanceof DocumentTouch)==true)?true:false,f=!!window.devicePixelRatio?window.devicePixelRatio:1,e,b=false;function d(){var p=p||null;if(p){if(p==0||p==180){e="landscape"}if(p==90||p==-90){e="portrait"}}else{e=null}}function l(p){if(i!=null){m=p;return}if(m==null){m=p}i=setTimeout(function(){clearTimeout(i);i=null;c.trigger("throttledScroll",n);m=null;d()},50)}function a(p){if(o!=null){n=p;return}if(n==null){n=p}o=setTimeout(function(){clearTimeout(o);o=null;c.trigger("throttledResize",n);n=null;d()},50)}(function(){var p=document.createElement("div");p.innerHTML='<div style="-webkit-transition:color 1s linear;-moz-transition:color 1s linear;"></div>';cssTransitionsSupported=(p.firstChild.style.webkitTransition!==undefined)||(p.firstChild.style.MozTransition!==undefined);delete p})();c.bind("resize",a);c.bind("scroll",l);d();g.addClass("jsAvailable");if(j){g.addClass("touchAvailable")}else{g.addClass("touchUnavailable")}if(f>1){g.addClass("retina")}if(f>=2){g.addClass("retina-2x")}if(Util.UserAgentProfiler.isAndroidLt3()){g.addClass("android-lt-3")}if(Util.UserAgentProfiler.isMobile()){g.addClass("mobile-context")}if(h.browser.msie&&h.browser.version>=10){h("html").addClass("ie gte-ie10")}return{breakpoints:function(){return Proxy.Breakpoints.breakpoints()},currentBreakpoint:function(){return Proxy.Breakpoints.getCurrentBreakpoint()},touch:function(){return j},clickEvent:function(){return !!j?(window.navigator.msPointerEnabled?"MSPointerDown":"touchstart"):"click"},pixelRatio:function(){return f},orientation:function(){return e},cssTransitions:function(){return b},addEnvVar:function(p,q){this[p]=q}}}(jQuery);var SBN=SBN||{};SBN.Nav=(function(a){return{init:function(){var b=a(window);this.config(function(){SBN.Nav.mobileSiteMenuTriggers.on("click",SBN.Nav.toggleMobileMenu);SBN.Nav.siteMenuToggler.on("click",SBN.Nav.toggleMobileMenuSubMenu);SBN.Nav.mobileGlobalMenu.on("click",SBN.Nav.toggleMobileGlobalMenu);b.on("resize",SBN.Nav.resize);SBN.Nav.globalNavTrigger.on("click",SBN.Nav.toggleGlobalMenu);_.delay(function(){b.trigger("resize")},500)})},config:function(b){this.mobileSiteMenuTriggers=a("#mobile-menu-open, #mobile-menu-close");this.mobileSiteMenuOpen=a("#mobile-menu-open");this.mobileSiteMenuClose=a("#mobile-menu-close");this.openSiteMenuClass="has-open-nav";this.siteMenuToggler=a(".m-site-nav nav > ul > li");this.desktopGlobalMenu=a("#desktop-global-menu-open, #desktop-global-menu-dropdown");this.mobileGlobalMenu=a("#mobile-global-menu-open");this.openGlobalMenuClass="has-open-global-nav";this.siteNavContainer=a(".m-site-nav nav");this.rightSideNav=a("#site-nav-right");this.isDotcom=a(".m-site-nav").hasClass("is-dotcom");this.siteNav=a("#site-nav");this.openSiteNavClass="site-nav";this.openGlobalNavClass="global-nav";this.globalNav=a("#global-nav");this.globalNavTrigger=a("#global-nav-trigger");this.moreLink="m-site-nav__more-link";this.navBufferMargin=20;this.resizeDebounce=100;b()},resize:_.debounce(function(){if(Vox.Environment.currentBreakpoint().index>1){var b=parseInt(SBN.Nav.siteNav.css("padding-left"));var e=SBN.Nav.rightSideNav.width();var c=SBN.Nav.siteNavContainer.width();SBN.Nav.viewableWidth=c-e-b;if(SBN.Nav.isDotcom){SBN.Nav.rearrange(SBN.Nav.globalNav)}else{SBN.Nav.rearrange(SBN.Nav.siteNav);SBN.Nav.rearrange(SBN.Nav.globalNav)}}else{var d=(SBN.Nav.isDotcom)?SBN.Nav.globalNav:SBN.Nav.siteNav;if(SBN.Nav.siteNav.is(":hidden")&&!SBN.Nav.isDotcom){SBN.Nav.toggleGlobalMenu()}d.children("li").css({visibility:"visible",display:"inherit"});d.find("."+SBN.Nav.moreLink).hide()}},this.resizeDebounce),rearrange:function(f){f.children("li").css({display:"inline-block",visibility:"hidden"});var g=f.find("."+SBN.Nav.moreLink);var e=g.find("ul").empty();var b=SBN.Nav.viewableWidth-g.width();var c=0;var d=0;f.children("li").show().each(function(){if(!a(this).is(g)){c+=a(this).width();if(c<b){a(this).css("visibility","visible")}else{d++;var h=a(this).children("a");if(h.length>0){e.append("<li>"+h[0].outerHTML+"</li>")}a(this).hide()}}if(d){g.css("visibility","visible")}})},toggleMobileMenu:function(b){var c=a("body");var d=a(this);if(d.is(SBN.Nav.mobileSiteMenuOpen)){SBN.Nav.mobileSiteMenuClose.height(c.height())}if(c.hasClass(SBN.Nav.openGlobalMenuClass)){c.removeClass(SBN.Nav.openGlobalMenuClass)}else{c.toggleClass(SBN.Nav.openSiteMenuClass)}b.preventDefault()},toggleMobileMenuSubMenu:function(){if(!SBN.Nav.isDotcom){a(this).toggleClass("is-active")}},toggleGlobalMenu:function(b){if(SBN.Nav.siteNavContainer.parent().hasClass(SBN.Nav.openSiteNavClass)){SBN.Nav.siteNavContainer.parent().removeClass(SBN.Nav.openSiteNavClass);SBN.Nav.siteNavContainer.parent().addClass(SBN.Nav.openGlobalNavClass);SBN.Nav.rearrange(SBN.Nav.globalNav)}else{SBN.Nav.siteNavContainer.parent().removeClass(SBN.Nav.openGlobalNavClass);SBN.Nav.siteNavContainer.parent().addClass(SBN.Nav.openSiteNavClass)}if(!_.isUndefined(b)){b.preventDefault()}},toggleMobileGlobalMenu:function(b){a("body").toggleClass(SBN.Nav.openGlobalMenuClass);b.preventDefault()}}})(jQuery);jQuery(function(){SBN.Nav.init()});var SBN=SBN||{};SBN.Modal=(function(a){return{$modal:null,holder:a("#modal-holder"),emptyModalSrc:"/modal/empty",bodyId:"#modal-body",closeTrigger:"#modal-close",fetchRemote:function(e,b,c){var d=(_.isUndefined(c))?SBN.Modal.emptyModalSrc:"/modal/"+c;SBN.Modal.holder.show();a.get(d,function(f){SBN.Modal.$modal=a(f);SBN.Modal.$modal.find(SBN.Modal.bodyId).load(e+" "+b,SBN.Modal.showModal)})},open:function(b,c){SBN.Modal.holder.show();a.get("/modal/"+b,function(d){SBN.Modal.$modal=a(d);SBN.Modal.showModal(c)})},showModal:function(b){SBN.Modal.$modal.insertAfter(SBN.Modal.holder).show();SBN.Modal.holder.hide();a(window).on("resize",SBN.Modal.resize).trigger("resize");a(window).on("recalculate_modal",SBN.Modal.recalculate);SBN.Modal.$modal.on("click",SBN.Modal.closeModal);a(SBN.Modal.closeTrigger).on("click",SBN.Modal.closeModal);SBN.Modal.container=SBN.Modal.$modal.children();SBN.Modal.header=SBN.Modal.$modal.find("header");SBN.Modal.body=a(SBN.Modal.bodyId);SBN.Modal.defaultBodyHeight=SBN.Modal.body.height();SBN.Modal.maxHeight=parseInt(SBN.Modal.container.css("max-height"))/100;if(!_.isUndefined(b)&&_.isFunction(b)){b()}},closeModal:function(b){if(b.target==this){SBN.Modal.$modal.remove();a(window).off("resize",SBN.Modal.resize);a(window).off("recalculate_modal",SBN.Modal.recalculate);b.preventDefault()}},recalculate:function(){var b=SBN.Modal.body.clone().css("height","auto").appendTo(SBN.Modal.container);SBN.Modal.defaultBodyHeight=b.height();b.remove();a(window).trigger("resize")},resize:_.debounce(function(){var b=Math.round(SBN.Modal.$modal.height()*SBN.Modal.maxHeight);var c=SBN.Modal.header.height()+SBN.Modal.defaultBodyHeight;var e=SBN.Modal.container.height();if(c==e&&b>c){return}else{var d=b-SBN.Modal.header.height();if(d>=SBN.Modal.defaultBodyHeight){SBN.Modal.body.css("height","auto")}else{SBN.Modal.body.height(d)}}},200)}})(jQuery);var SBN=SBN||{};SBN.UserNav=(function(a){return{init:function(b){this.config(function(){SBN.UserNav.loginOpenIdTrigger.on("click",SBN.UserNav.toggleLoginUserID);SBN.UserNav.loginToggle.on("click",SBN.UserNav.showLoginModal);SBN.UserNav.mySbnToggle.on("click",SBN.UserNav.showMySbnModal)})},config:function(b){this.loginOpenIdTrigger=a("#openid-trigger");this.loginOpenIdForm=a("#openid-form");this.loginToggle=a("#user-nav-login");this.mySbnToggle=a("#user-nav-my-sbn");b()},showLoginModal:function(b){SBN.Modal.open("login",function(){SBN.UserNav.init()});b.preventDefault()},showMySbnModal:function(b){SBN.Modal.open("mysbn");b.preventDefault()},toggleLoginUserID:function(b){SBN.UserNav.loginOpenIdForm.toggle();SBN.Modal.recalculate();b.preventDefault()}}})(jQuery);jQuery(function(){SBN.UserNav.init()});var filterPane=(function(a){return{init:function(){this.config(function(){filterPane.cloneToggleEvents();filterPane.mobileDropdown.on("change",filterPane.triggerMobileChange)})},config:function(b){this.contentToggle=a("#filter-pane-toggle");this.mobileDropdown=a("#filter-pane-toggle-mobile");b()},cloneToggleEvents:function(){this.contentToggle.find("li").each(function(b,d){var c=a('<option data-index="'+b+'">'+a(this).find("a").text()+"</option>").appendTo(filterPane.mobileDropdown);if(a(this).data("count")==0){c.attr("disabled",true)}})},triggerMobileChange:function(c){var b=filterPane.mobileDropdown.find(":selected").data("index");filterPane.contentToggle.find("li").eq(b).find("a").trigger("click")}}})(jQuery);var userProfile=(function(a){return{init:function(){this.config(function(){userProfile.activityToggle.on("click","a",userProfile.toggleActivity);userProfile.blogMembershipToggle.on("click","a",userProfile.toggleBlogMembership);userProfile.favoriteToggle.on("click",userProfile.toggleFavoriteBlog);userProfile.adminLinkToggle.on("change",userProfile.gotoAdminLink);userProfile.coloredRows(userProfile.activityTableClass,"tr");userProfile.activityToggle.find("a:first").trigger("click")})},config:function(b){this.activityToggle=a("#filter-pane-toggle");this.blogMembershipToggle=a("#blog-membership-toggle");this.blogMembershipList=a(".m-profile__memberships");this.profileRail=a(".m-filter-pane__rail");this.profileRiver=a(".m-filter-pane__content");this.activityTable=a(".m-profile__activity-table");this.activityTableClass=".m-profile__activity-table";this.favoriteToggle=a(".m-profile__blog__favorite");this.adminLinkToggle=a("#profile-meta-link-toggle");this.selectedClass="is-selected";this.disabledClass="is-disabled";this.favoriteClass="is-favorite";this.oddClass="odd";b()},gotoAdminLink:function(c){var b=a(this).val();if(b!==""){window.location=b}},toggleFavoriteBlog:function(d){var b=a(this);var c=b.parent().hasClass(userProfile.favoriteClass)?b.data("unfavorite-url"):b.data("favorite-url");a.post(c,function(e){console.log(e);b.parent().toggleClass(userProfile.favoriteClass)});d.preventDefault()},toggleActivity:function(){if(!a(this).parent().hasClass(userProfile.disabledClass)){var d=a(this).data("type");var b=userProfile.activityTable.length;var e=b?userProfile.activityTable.find("tr"):userProfile.profileRiver.find(".m-block");var c=a(this).parents(userProfile.activityToggle.selector).find("li");c.removeClass(userProfile.selectedClass);a(this).parent().addClass(userProfile.selectedClass);if(b){e.removeClass(userProfile.oddClass)}e.hide();if(d==="all"){e.show()}else{e.filter("."+d+", ."+d.toLowerCase()).show()}if(b){userProfile.coloredRows(userProfile.activityTableClass,"tr")}}else{a(this).parent().next().find("a").trigger("click")}return false},toggleBlogMembership:function(){userProfile.blogMembershipToggle.find("li").removeClass(userProfile.selectedClass);a(this).parent().addClass(userProfile.selectedClass);if(a(this).data("show")==="all"){userProfile.blogMembershipList.addClass("show-all")}else{userProfile.blogMembershipList.removeClass("show-all")}return false},coloredRows:function(b,c){a(b).find(c).filter(":visible").each(function(d,f){if(d%2){a(this).addClass("odd")}})}}})(jQuery);var Vox=Vox||{};Vox.Debug={countCSSRules:function(){var c=log="";if(!document.styleSheets){return}for(var b=0;b<document.styleSheets.length;b++){a(document.styleSheets[b])}function a(f){var g=0;if(f&&f.cssRules){for(var e=0,d=f.cssRules.length;e<d;e++){if(f.cssRules[e].selectorText){g+=f.cssRules[e].selectorText.split(",").length}}log+="\nFile: "+(f.href?f.href:"inline <style> tag");log+="\nRules: "+f.cssRules.length;log+="\nSelectors: "+g;log+="\n--------------------------";if(g>=4096){c+="\n********************************\nWARNING:\n There are "+g+" CSS rules in the stylesheet "+f.href+" - IE will ignore the last "+(g-4096)+" rules!\n"}}}console.log(log);if(c){console.log(c)}}};var SBN=SBN||{};SBN.SocialBar=(function(a){return{init:function(){a(".entry-social-bar a.close").bind("click",{params:["Social Bar","close",location.href]},function(b){a.cookie("closed_follow_bar","true",{expires:365,path:"/"});a(".entry-social-bar").hide();a("body").removeClass("ui-state-has-social-bar");Util.gaTrackEvent(b);return false})}}})(jQuery);jQuery(function(){SBN.SocialBar.init()});var SBN=SBN||{};SBN.DelayedLoadGlobalNav=(function(a){return{init:function(){var b=a("#delayedLoadGlobalNavSubItems");b.find(".m-site-nav__dropdown").each(function(c,e){var d=a(e);a("#"+d.data("nav-id")).append(d)});b.remove()}}})(jQuery);shortcut={all_shortcuts:{},add:function(b,h,d){var g={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!d){d=g}else{for(var a in g){if(typeof d[a]=="undefined"){d[a]=g[a]}}}var f=d.target;if(typeof d.target=="string"){f=document.getElementById(d.target)}var c=this;b=b.toLowerCase();var e=function(o){o=o||window.event;if(d.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var s=b.split("+");var r=0;var p={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var q={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){q.ctrl.pressed=true}if(o.shiftKey){q.shift.pressed=true}if(o.altKey){q.alt.pressed=true}if(o.metaKey){q.meta.pressed=true}for(var j=0;k=s[j],j<s.length;j++){if(k=="ctrl"||k=="control"){r++;q.ctrl.wanted=true}else{if(k=="shift"){r++;q.shift.wanted=true}else{if(k=="alt"){r++;q.alt.wanted=true}else{if(k=="meta"){r++;q.meta.wanted=true}else{if(k.length>1){if(m[k]==code){r++}}else{if(d.keycode){if(d.keycode==code){r++}}else{if(n==k){r++}else{if(p[n]&&o.shiftKey){n=p[n];if(n==k){r++}}}}}}}}}}if(r==s.length&&q.ctrl.pressed==q.ctrl.wanted&&q.shift.pressed==q.shift.wanted&&q.alt.pressed==q.alt.wanted&&q.meta.pressed==q.meta.wanted){h(o);if(!d.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[b]={callback:e,target:f,event:d.type};if(f.addEventListener){f.addEventListener(d.type,e,false)}else{if(f.attachEvent){f.attachEvent("on"+d.type,e)}else{f["on"+d.type]=e}}},remove:function(a){a=a.toLowerCase();var d=this.all_shortcuts[a];delete (this.all_shortcuts[a]);if(!d){return}var b=d.event;var c=d.target;var e=d.callback;if(c.detachEvent){c.detachEvent("on"+b,e)}else{if(c.removeEventListener){c.removeEventListener(b,e,false)}else{c["on"+b]=false}}}};(function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;if(typeof settings=="string"){method=settings;params=extraSettings}options={id:"",nameSpace:"",root:"",previewHandler:false,previewInWindow:"",previewInElement:"",previewAutoRefresh:true,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:false,previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);if(!options.root){$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1]}})}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);if(method){switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}return}function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root)}return data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id){id='id="'+options.id+'"'}else{if($$.attr("id")){id='id="markItUp'+($$.attr("id").substr(0,1).toUpperCase())+($$.attr("id").substr(1))+'"'}}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"'}$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true&&$.browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(e){$("html").unbind("mousemove.markItUp",mouseMove).unbind("mouseup.markItUp",mouseUp);return false};$("html").bind("mousemove.markItUp",mouseMove).bind("mouseup.markItUp",mouseUp)});footer.append(resizeHandle)}$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed);$$.bind("insertion.markItUp",function(e,settings){if(settings.target!==false){get()}if(textarea===$.markItUp.focused){markup(settings)}});$$.bind("focus.markItUp",function(){$.markItUp.focused=this});if(options.previewInElement){refreshPreview()}}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=(button.key)?(button.name||"")+" [Ctrl+"+button.key+"]":(button.name||"");key=(button.key)?'accesskey="'+button.key+'"':"";if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul)}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-"}li=$('<li class="markItUpButton markItUpButton'+t+(i)+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return false}).bind("click.markItUp",function(){return false}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){if(button.call){eval(button.call)()}markup(button);return false}).bind("mouseenter.markItUp",function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");if(altKey===true){return(b[1]!==undefined)?b[1]:b[0]}else{return(b[1]===undefined)?"":b[0]}});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true){return false}value=prompt(b[0],(b[1])?b[1]:"");if(value===null){abort=true}return value});return string}return""}function prepare(action){if($.isFunction(action)){action=action(hash)}return magicMarkups(action)}function build(string){var openWith=prepare(clicked.openWith);var placeHolder=prepare(clicked.placeHolder);var replaceWith=prepare(clicked.replaceWith);var closeWith=prepare(clicked.closeWith);var openBlockWith=prepare(clicked.openBlockWith);var closeBlockWith=prepare(clicked.closeBlockWith);var multiline=clicked.multiline;if(replaceWith!==""){block=openWith+replaceWith+closeWith}else{if(selection===""&&placeHolder!==""){block=openWith+placeHolder+closeWith}else{string=string||selection;var lines=[string],blocks=[];if(multiline===true){lines=string.split(/\r?\n/)}for(var l=0;l<lines.length;l++){line=lines[l];var trailingSpaces;if(trailingSpaces=line.match(/ *$/)){blocks.push(openWith+line.replace(/ *$/g,"")+closeWith+trailingSpaces)}else{blocks.push(openWith+line+closeWith)}}block=blocks.join("\n")}}block=openBlockWith+block+closeBlockWith;return{block:block,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:(selection||""),caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.beforeMultiInsert)}$.extend(hash,{line:1});if((ctrlKey===true&&shiftKey===true)){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else{lines[i]=""}}string={block:lines.join("\n")};start=caretPosition;len=string.block.length+(($.browser.opera)?n-1:0)}else{if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len=len-(string.block.match(/ $/)?1:0);len-=fixIeBug(string.block)}else{if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}}}if((selection===""&&string.replaceWith==="")){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else{caretOffset=-1}get();$.extend(hash,{line:"",selection:selection});if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.afterMultiInsert)}prepare(clicked.afterInsert);prepare(options.afterInsert);if(previewWindow&&options.previewAutoRefresh){refreshPreview()}shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){if($.browser.opera){return string.length-string.replace(/\n*/g,"").length}return 0}function fixIeBug(string){if($.browser.msie){return string.length-string.replace(/\r*/g,"").length}return 0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else{textarea.value=textarea.value.substring(0,caretPosition)+block+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}}function set(start,len){if(textarea.createTextRange){if($.browser.opera&&$.browser.version>=9.5&&len==0){return false}range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else{if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len)}}textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if($.browser.msie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else{caretPosition=textarea.selectionStart}}else{caretPosition=textarea.selectionStart;selection=textarea.value.substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){if(typeof options.previewHandler==="function"){previewWindow=true}else{if(options.previewInElement){previewWindow=$(options.previewInElement)}else{if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open("","preview",options.previewInWindow);$(window).unload(function(){previewWindow.close()})}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=="after"){iFrame.insertAfter(footer)}else{iFrame.insertBefore(header)}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}}else{if(altKey===true){if(iFrame){iFrame.remove()}else{previewWindow.close()}previewWindow=iFrame=false}}}}if(!options.previewAutoRefresh){refreshPreview()}if(options.previewInWindow){previewWindow.focus()}}function refreshPreview(){renderPreview()}function renderPreview(){var phtml;if(options.previewHandler&&typeof options.previewHandler==="function"){options.previewHandler($$.val())}else{if(options.previewParser&&typeof options.previewParser==="function"){var data=options.previewParser($$.val());writeInPreview(localize(data,1))}else{if(options.previewParserPath!==""){$.ajax({type:"POST",dataType:"text",global:false,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(data){writeInPreview(localize(data,1))}})}else{if(!template){$.ajax({url:options.previewTemplatePath,dataType:"text",global:false,success:function(data){writeInPreview(localize(data,1).replace(/<!-- content -->/g,$$.val()))}})}}}}return false}function writeInPreview(data){if(options.previewInElement){$(options.previewInElement).html(data)}else{if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open();previewWindow.document.write(data);previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp}}}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=(!(e.altKey&&e.ctrlKey))?(e.ctrlKey||e.metaKey):false;if(e.type==="keydown"){if(ctrlKey===true){li=$('a[accesskey="'+((e.keyCode==13)?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li");if(li.length!==0){ctrlKey=false;li.triggerHandler("mouseup");return false}}if(e.keyCode===13||e.keyCode===10){if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else{if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}}}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true){return false}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$);$$.data("markItUp",null)}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])})}else{$("textarea").trigger("insertion",[options])}}})(jQuery);(function(u){var Z,B="2.0.0",ad=Math.round,af,Q={},P=(typeof module!=="undefined"&&module.exports),y=/^\/?Date\((\-?\d+)/i,m=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,s=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,ai=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,g=/\d\d?/,R=/\d{1,3}/,T=/\d{3}/,J=/\d{1,4}/,r=/[+\-]?\d{1,6}/,K=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,b=/Z|[\+\-]\d\d:?\d\d/i,v=/T/i,q=/[\+\-]?\d+(\.\d{1,3})?/,L=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,d="YYYY-MM-DDTHH:mm:ssZ",j=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],D=/([\+\-]|\d\d)/gi,o="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),aa={Milliseconds:1,Seconds:1000,Minutes:60000,Hours:3600000,Days:86400000,Months:2592000000,Years:31536000000},n={},G="DDD w W M D d".split(" "),x="M D H h m s w W".split(" "),h={M:function(){return this.month()+1},MMM:function(i){return this.lang().monthsShort(this,i)},MMMM:function(i){return this.lang().months(this,i)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(i){return this.lang().weekdaysMin(this,i)},ddd:function(i){return this.lang().weekdaysShort(this,i)},dddd:function(i){return this.lang().weekdays(this,i)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return ac(this.year()%100,2)},YYYY:function(){return ac(this.year(),4)},YYYYY:function(){return ac(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return ~~(this.milliseconds()/100)},SS:function(){return ac(~~(this.milliseconds()/10),2)},SSS:function(){return ac(this.milliseconds(),3)},Z:function(){var ak=-this.zone(),i="+";if(ak<0){ak=-ak;i="-"}return i+ac(~~(ak/60),2)+":"+ac(~~ak%60,2)},ZZ:function(){var ak=-this.zone(),i="+";if(ak<0){ak=-ak;i="-"}return i+ac(~~(10*ak/6),4)},X:function(){return this.unix()}};function N(ak,i){return function(al){return ac(ak.call(this,al),i)}}function H(i){return function(ak){return this.lang().ordinal(i.call(this,ak))}}while(G.length){af=G.pop();h[af+"o"]=H(h[af])}while(x.length){af=x.pop();h[af+af]=N(h[af],2)}h.DDDD=N(h.DDD,3);function ah(){}function w(i){t(this,i)}function aj(am){var ao=this._data={},ap=am.years||am.year||am.y||0,ak=am.months||am.month||am.M||0,i=am.weeks||am.week||am.w||0,at=am.days||am.day||am.d||0,aq=am.hours||am.hour||am.h||0,an=am.minutes||am.minute||am.m||0,ar=am.seconds||am.second||am.s||0,al=am.milliseconds||am.millisecond||am.ms||0;this._milliseconds=al+ar*1000+an*60000+aq*3600000;this._days=at+i*7;this._months=ak+ap*12;ao.milliseconds=al%1000;ar+=Y(al/1000);ao.seconds=ar%60;an+=Y(ar/60);ao.minutes=an%60;aq+=Y(an/60);ao.hours=aq%24;at+=Y(aq/24);at+=i*7;ao.days=at%30;ak+=Y(at/30);ao.months=ak%12;ap+=Y(ak/12);ao.years=ap}function t(al,ak){for(var am in ak){if(ak.hasOwnProperty(am)){al[am]=ak[am]}}return al}function Y(i){if(i<0){return Math.ceil(i)}else{return Math.floor(i)}}function ac(al,ak){var i=al+"";while(i.length<ak){i="0"+i}return i}function V(al,an,am){var ak=an._milliseconds,ao=an._days,ap=an._months,i;if(ak){al._d.setTime(+al+ak*am)}if(ao){al.date(al.date()+ao*am)}if(ap){i=al.date();al.date(1).month(al.month()+ap*am).date(Math.min(i,al.daysInMonth()))}}function E(i){return Object.prototype.toString.call(i)==="[object Array]"}function U(ao,an){var ak=Math.min(ao.length,an.length),al=Math.abs(ao.length-an.length),ap=0,am;for(am=0;am<ak;am++){if(~~ao[am]!==~~an[am]){ap++}}return ap+al}ah.prototype={set:function(ak){var am,al;for(al in ak){am=ak[al];if(typeof am==="function"){this[al]=am}else{this["_"+al]=am}}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(i){return this._months[i.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(i){return this._monthsShort[i.month()]},monthsParse:function(ak){var am,ao,an,al;if(!this._monthsParse){this._monthsParse=[]}for(am=0;am<12;am++){if(!this._monthsParse[am]){ao=Z([2000,am]);an="^"+this.months(ao,"")+"|^"+this.monthsShort(ao,"");this._monthsParse[am]=new RegExp(an.replace(".",""),"i")}if(this._monthsParse[am].test(ak)){return am}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(i){return this._weekdays[i.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(i){return this._weekdaysShort[i.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(i){return this._weekdaysMin[i.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(ak){var i=this._longDateFormat[ak];if(!i&&this._longDateFormat[ak.toUpperCase()]){i=this._longDateFormat[ak.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(al){return al.slice(1)});this._longDateFormat[ak]=i}return i},meridiem:function(i,ak,al){if(i>11){return al?"pm":"PM"}else{return al?"am":"AM"}},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(ak,al){var i=this._calendar[ak];return typeof i==="function"?i.apply(al):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(am,al,ak,an){var i=this._relativeTime[ak];return(typeof i==="function")?i(am,al,ak,an):i.replace(/%d/i,am)},pastFuture:function(al,i){var ak=this._relativeTime[al>0?"future":"past"];return typeof ak==="function"?ak(i):ak.replace(/%s/i,i)},ordinal:function(i){return this._ordinal.replace("%d",i)},_ordinal:"%d",preparse:function(i){return i},postformat:function(i){return i},week:function(i){return S(i,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}};function A(ak,i){i.abbr=ak;if(!Q[ak]){Q[ak]=new ah()}Q[ak].set(i);return Q[ak]}function z(i){if(!i){return Z.fn._lang}if(!Q[i]&&P){require("./lang/"+i)}return Q[i]}function I(i){if(i.match(/\[.*\]/)){return i.replace(/^\[|\]$/g,"")}return i.replace(/\\/g,"")}function X(am){var an=am.match(m),ak,al;for(ak=0,al=an.length;ak<al;ak++){if(h[an[ak]]){an[ak]=h[an[ak]]}else{an[ak]=I(an[ak])}}return function(ao){var i="";for(ak=0;ak<al;ak++){i+=typeof an[ak].call==="function"?an[ak].call(ao,am):an[ak]}return i}}function O(ak,an){var al=5;function am(i){return ak.lang().longDateFormat(i)||i}while(al--&&s.test(an)){an=an.replace(s,am)}if(!n[an]){n[an]=X(an)}return n[an](ak)}function f(i){switch(i){case"DDDD":return T;case"YYYY":return J;case"YYYYY":return r;case"S":case"SS":case"SSS":case"DDD":return R;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return K;case"X":return q;case"Z":case"ZZ":return b;case"T":return v;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return g;default:return new RegExp(i.replace("\\",""))}}function e(ao,am,an){var al,i,ak=an._a;switch(ao){case"M":case"MM":ak[1]=(am==null)?0:~~am-1;break;case"MMM":case"MMMM":al=z(an._l).monthsParse(am);if(al!=null){ak[1]=al}else{an._isValid=false}break;case"D":case"DD":case"DDD":case"DDDD":if(am!=null){ak[2]=~~am}break;case"YY":ak[0]=~~am+(~~am>68?1900:2000);break;case"YYYY":case"YYYYY":ak[0]=~~am;break;case"a":case"A":an._isPm=((am+"").toLowerCase()==="pm");break;case"H":case"HH":case"h":case"hh":ak[3]=~~am;break;case"m":case"mm":ak[4]=~~am;break;case"s":case"ss":ak[5]=~~am;break;case"S":case"SS":case"SSS":ak[6]=~~(("0."+am)*1000);break;case"X":an._d=new Date(parseFloat(am)*1000);break;case"Z":case"ZZ":an._useUTC=true;al=(am+"").match(D);if(al&&al[1]){an._tzh=~~al[1]}if(al&&al[2]){an._tzm=~~al[2]}if(al&&al[0]==="+"){an._tzh=-an._tzh;an._tzm=-an._tzm}break}if(am==null){an._isValid=false}}function l(am){var an,al,ak=[];if(am._d){return}for(an=0;an<7;an++){am._a[an]=ak[an]=(am._a[an]==null)?(an===2?1:0):am._a[an]}ak[3]+=am._tzh||0;ak[4]+=am._tzm||0;al=new Date(0);if(am._useUTC){al.setUTCFullYear(ak[0],ak[1],ak[2]);al.setUTCHours(ak[3],ak[4],ak[5],ak[6])}else{al.setFullYear(ak[0],ak[1],ak[2]);al.setHours(ak[3],ak[4],ak[5],ak[6])}am._d=al}function M(al){var ao=al._f.match(m),ak=al._i,am,an;al._a=[];for(am=0;am<ao.length;am++){an=(f(ao[am]).exec(ak)||[])[0];if(an){ak=ak.slice(ak.indexOf(an)+an.length)}if(h[ao[am]]){e(ao[am],an,al)}}if(al._isPm&&al._a[3]<12){al._a[3]+=12}if(al._isPm===false&&al._a[3]===12){al._a[3]=0}l(al)}function C(am){var aq,ak,ao,ap=99,an,al,ar;while(am._f.length){aq=t({},am);aq._f=am._f.pop();M(aq);ak=new w(aq);if(ak.isValid()){ao=ak;break}ar=U(aq._a,ak.toArray());if(ar<ap){ap=ar;ao=ak}}t(am,ao)}function ab(al){var am,ak=al._i;if(L.exec(ak)){al._f="YYYY-MM-DDT";for(am=0;am<4;am++){if(j[am][1].exec(ak)){al._f+=j[am][0];break}}if(b.exec(ak)){al._f+=" Z"}M(al)}else{al._d=new Date(ak)}}function ag(al){var ak=al._i,i=y.exec(ak);if(ak===u){al._d=new Date()}else{if(i){al._d=new Date(+i[1])}else{if(typeof ak==="string"){ab(al)}else{if(E(ak)){al._a=ak.slice(0);l(al)}else{al._d=ak instanceof Date?new Date(+ak):new Date(ak)}}}}}function W(i,al,ak,am,an){return an.relativeTime(al||1,!!ak,i,am)}function F(al,i,ak){var aq=ad(Math.abs(al)/1000),am=ad(aq/60),ap=ad(am/60),ar=ad(ap/24),an=ad(ar/365),ao=aq<45&&["s",aq]||am===1&&["m"]||am<45&&["mm",am]||ap===1&&["h"]||ap<22&&["hh",ap]||ar===1&&["d"]||ar<=25&&["dd",ar]||ar<=45&&["M"]||ar<345&&["MM",ad(ar/30)]||an===1&&["y"]||["yy",an];ao[2]=i;ao[3]=al>0;ao[4]=ak;return W.apply({},ao)}function S(am,al,an){var ak=an-al,i=an-am.day();if(i>ak){i-=7}if(i<ak-7){i+=7}return Math.ceil(Z(am).add("d",i).dayOfYear()/7)}function ae(ak){var i=ak._i,al=ak._f;if(i===null||i===""){return null}if(typeof i==="string"){ak._i=i=z().preparse(i)}if(Z.isMoment(i)){ak=t({},i);ak._d=new Date(+i._d)}else{if(al){if(E(al)){C(ak)}else{M(ak)}}else{ag(ak)}}return new w(ak)}Z=function(i,ak,al){return ae({_i:i,_f:ak,_l:al,_isUTC:false})};Z.utc=function(i,ak,al){return ae({_useUTC:true,_isUTC:true,_l:al,_i:i,_f:ak})};Z.unix=function(i){return Z(i*1000)};Z.duration=function(i,an){var am=Z.isDuration(i),al=(typeof i==="number"),ao=(am?i._data:(al?{}:i)),ak;if(al){if(an){ao[an]=i}else{ao.milliseconds=i}}ak=new aj(ao);if(am&&i.hasOwnProperty("_lang")){ak._lang=i._lang}return ak};Z.version=B;Z.defaultFormat=d;Z.lang=function(am,ak){var al;if(!am){return Z.fn._lang._abbr}if(ak){A(am,ak)}else{if(!Q[am]){z(am)}}Z.duration.fn._lang=Z.fn._lang=z(am)};Z.langData=function(i){if(i&&i._lang&&i._lang._abbr){i=i._lang._abbr}return z(i)};Z.isMoment=function(i){return i instanceof w};Z.isDuration=function(i){return i instanceof aj};Z.fn=w.prototype={clone:function(){return Z(this)},valueOf:function(){return +this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return Z.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var i=this;return[i.year(),i.month(),i.date(),i.hours(),i.minutes(),i.seconds(),i.milliseconds()]},isValid:function(){if(this._isValid==null){if(this._a){this._isValid=!U(this._a,(this._isUTC?Z.utc(this._a):Z(this._a)).toArray())}else{this._isValid=!isNaN(this._d.getTime())}}return !!this._isValid},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(ak){var i=O(this,ak||Z.defaultFormat);return this.lang().postformat(i)},add:function(i,al){var ak;if(typeof i==="string"){ak=Z.duration(+al,i)}else{ak=Z.duration(i,al)}V(this,ak,1);return this},subtract:function(i,al){var ak;if(typeof i==="string"){ak=Z.duration(+al,i)}else{ak=Z.duration(i,al)}V(this,ak,-1);return this},diff:function(an,am,i){var ao=this._isUTC?Z(an).utc():Z(an).local(),ak=(this.zone()-ao.zone())*60000,ap,al;if(am){am=am.replace(/s$/,"")}if(am==="year"||am==="month"){ap=(this.daysInMonth()+ao.daysInMonth())*43200000;al=((this.year()-ao.year())*12)+(this.month()-ao.month());al+=((this-Z(this).startOf("month"))-(ao-Z(ao).startOf("month")))/ap;if(am==="year"){al=al/12}}else{ap=(this-ao)-ak;al=am==="second"?ap/1000:am==="minute"?ap/60000:am==="hour"?ap/3600000:am==="day"?ap/86400000:am==="week"?ap/604800000:ap}return i?al:Y(al)},from:function(ak,i){return Z.duration(this.diff(ak)).lang(this.lang()._abbr).humanize(!i)},fromNow:function(i){return this.from(Z(),i)},calendar:function(){var ak=this.diff(Z().startOf("day"),"days",true),i=ak<-6?"sameElse":ak<-1?"lastWeek":ak<0?"lastDay":ak<1?"sameDay":ak<2?"nextDay":ak<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(i,this))},isLeapYear:function(){var i=this.year();return(i%4===0&&i%100!==0)||i%400===0},isDST:function(){return(this.zone()<Z([this.year()]).zone()||this.zone()<Z([this.year(),5]).zone())},day:function(ak){var i=this._isUTC?this._d.getUTCDay():this._d.getDay();return ak==null?i:this.add({d:ak-i})},startOf:function(i){i=i.replace(/s$/,"");switch(i){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(i==="week"){this.day(0)}return this},endOf:function(i){return this.startOf(i).add(i.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(ak,i){i=typeof i!=="undefined"?i:"millisecond";return +this.clone().startOf(i)>+Z(ak).startOf(i)},isBefore:function(ak,i){i=typeof i!=="undefined"?i:"millisecond";return +this.clone().startOf(i)<+Z(ak).startOf(i)},isSame:function(ak,i){i=typeof i!=="undefined"?i:"millisecond";return +this.clone().startOf(i)===+Z(ak).startOf(i)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return Z.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(i){var ak=ad((Z(this).startOf("day")-Z(this).startOf("year"))/86400000)+1;return i==null?ak:this.add("d",(i-ak))},isoWeek:function(i){var ak=S(this,1,4);return i==null?ak:this.add("d",(i-ak)*7)},week:function(i){var ak=this.lang().week(this);return i==null?ak:this.add("d",(i-ak)*7)},lang:function(i){if(i===u){return this._lang}else{this._lang=z(i);return this}}};function p(i,ak){Z.fn[i]=Z.fn[i+"s"]=function(al){var am=this._isUTC?"UTC":"";if(al!=null){this._d["set"+am+ak](al);return this}else{return this._d["get"+am+ak]()}}}for(af=0;af<o.length;af++){p(o[af].toLowerCase().replace(/s$/,""),o[af])}p("year","FullYear");Z.fn.days=Z.fn.day;Z.fn.weeks=Z.fn.week;Z.fn.isoWeeks=Z.fn.isoWeek;Z.duration.fn=aj.prototype={weeks:function(){return Y(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+this._months*2592000000},humanize:function(ak){var al=+this,i=F(al,!ak,this.lang());if(ak){i=this.lang().pastFuture(al,i)}return this.lang().postformat(i)},lang:Z.fn.lang};function a(i){Z.duration.fn[i]=function(){return this._data[i]}}function c(i,ak){Z.duration.fn["as"+i]=function(){return +this/ak}}for(af in aa){if(aa.hasOwnProperty(af)){c(af,aa[af]);a(af.toLowerCase())}}c("Weeks",604800000);Z.lang("en",{ordinal:function(al){var i=al%10,ak=(~~(al%100/10)===1)?"th":(i===1)?"st":(i===2)?"nd":(i===3)?"rd":"th";return al+ak}});if(P){module.exports=Z}else{this["moment"]=Z}if(typeof define==="function"&&define.amd){define("moment",[],function(){return Z})}}).call(this);(function(d){window.Chorus=window.Chorus||{};window.Chorus.Comments=Chorus.Comments||{};var c={onShiftEnter:{keepDefault:false,replaceWith:"<br />\n"},onCtrlEnter:{keepDefault:false,openWith:"\n<p>",closeWith:"</p>"},onTab:{keepDefault:false,replaceWith:"    "},markupSet:[{name:"Bold",key:"B",openWith:"(!(<strong>|!|<b>)!)",closeWith:"(!(</strong>|!|</b>)!)"},{name:"Italic",key:"I",openWith:"(!(<em>|!|<i>)!)",closeWith:"(!(</em>|!|</i>)!)"},{name:"Strike through",key:"S",openWith:"<del>",closeWith:"</del>"},{name:"Spoilers",key:"F",openWith:'<p class="spoiler">',closeWith:"</p>"},{separator:"---------------"},{name:"Bulleted List",openWith:"    <li>",closeWith:"</li>",multiline:true,openBlockWith:"<ul>\n",closeBlockWith:"\n</ul>"},{name:"Numeric List",openWith:"    <li>",closeWith:"</li>",multiline:true,openBlockWith:"<ol>\n",closeBlockWith:"\n</ol>"},{separator:"---------------"},{name:"Picture",key:"P",replaceWith:'<img src="[![Source:!:http://]!]" alt="[![Alternative text]!]" />'},{name:"Link",key:"L",openWith:'<a rel="nofollow" target="_blank" href="[![Link:!:http://]!]"(!( title="[![Title]!]")!)>',closeWith:"</a>",placeHolder:"Your text to link..."},{separator:"---------------"},{name:"Clean",className:"clean",replaceWith:function(f){return f.selection.replace(/<(.*?)>/g,"")}}]};var b={previewParserPath:"",onShiftEnter:{keepDefault:false,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:true},{name:"Numeric list",openWith:"# ",multiline:true},{separator:"---------------"},{name:"Picture",replaceWith:"![![Source:!:http://]!]([![Alternative text (Shown on hover)]!])!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}]};var a={previewParserPath:"",onShiftEnter:{keepDefault:false,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"</strong>",openWith:"<strong>"},{name:"Italic",key:"I",closeWith:"</em>",openWith:"<em>"},{name:"Strike through",key:"S",closeWith:"</strike>",openWith:"<strike>"},{name:"Quote",openWith:"<blockquote>",closeWith:"</blockquote>",multiline:true},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:true},{name:"Numeric list",openWith:"# ",multiline:true},{separator:"---------------"},{name:"Picture",replaceWith:"![![Source:!:http://]!]([![Alternative text (Shown on hover)]!])!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%",placeHolder:"Spoiler text here"},]};var e={};Chorus.Comments={UPDATE_INTERVAL:20000,SLOW_UPDATE_INTERVAL:60000,current_update_interval:20000,auto_updater:null,scrollOffset:-200,comments_per_page:5,current_page:0,previewDisabled:{},empty_count:0,lastRequestId:0,busy:false,loaded:false,edit_timer:90,comments_container:"comments_list",collapsed_class:"collapsed",expanded_class:"expanded",hidden_class:"hidden",hidden_mobile_class:"hidden-for-mobile",touch_enabled_class:"touch_enabled",new_comment_class:"new",touchTools:{control:"#touch-tools",toggle:"#touch-tools-toggle",bar:"#touch-bar",newCommentsClass:"new-comments"},UIAdapter:{openModal:function(f){if(Chorus.Modal){Chorus.Modal.open(f)}if(Vox&&Vox.EventDispatcher){Vox.EventDispatcher.publish("requestOpenModalWithContents",{contents:f})}},closeModal:function(){if(Chorus.Modal){Chorus.Modal.close()}if(Vox&&Vox.EventDispatcher){Vox.EventDispatcher.publish("requestCloseModal")}}},Options:{able_to_comment:false,able_to_moderate:false,show_new_comment_alert:true,comments_closed:false,auto_update:false,depth_to_start_contextualizing:10,click_event:"click",fixed_header_height:60,toggle_children_with_collapse:true,include_preview_controls:false,button_options:b,animate_scroll_to:true,scroll_animation_duration:300,display_replies_count:false},initialize:function(g){this.Options=d.extend({},this.Options,g);var f={reply_link:"reply",edit_link:"edit",post_edit_comment:"edit_comment",cancel_edit_comment:"cancel_edit_form",recommend_link:"recommend_comment",flag_link:"flag_comment_dialog",delete_link:"delete_comment",hide_link:"hide_comment"};_.each(f,function(i,h){d(document).on(Chorus.Comments.Options.click_event,"."+h,function(l){l.preventDefault();var j=d(this).closest(".citem");var m=Chorus.Comments[i];if(j.length>0&&m){m(j.data("comment-id"))}})});d(document).on(Chorus.Comments.Options.click_event,".go_to_comment",function(h){h.preventDefault();Chorus.Comments.Cycle.goToComment(d(this).data("target-comment-id"))});d(document).on(Chorus.Comments.Options.click_event,".close_autoupdate",function(h){h.preventDefault();Chorus.Comments.hide_auto_update_info()});d(document).on(Chorus.Comments.Options.click_event,".post_comment_button",function(i){i.preventDefault();var h=d(this).closest("form").get(0);if(h.length>0){Chorus.Comments.post_comment(h)}});d(document).on(Chorus.Comments.Options.click_event,".preview_comment_button",function(i){i.preventDefault();var h=d(this).closest("form").get(0);if(h.length>0){Chorus.Comments.preview_comment(h)}});d(document).on(Chorus.Comments.Options.click_event,".cancel_comment_button",function(i){i.preventDefault();var h=d(this).closest(".citem").data("comment-id");Chorus.Comments.cancel_comment_form(h)});d(document).on("change",".post_form :input, .reply_form :input",function(){d(this.form).data("previewing",false)});d("#formatting_guide_links").on(Chorus.Comments.Options.click_event,Chorus.Comments.toggle_formatting_guide);d(document).on(Chorus.Comments.Options.click_event,".link_to_parent",function(h){h.preventDefault();Chorus.Comments.scroll_to(d(this).data("parent-id"))});this.Json.initialize();d(document).on(Chorus.Comments.Options.click_event,".collapse_toggle",Chorus.Comments.Collapse.toggle);d(".comments_wrapper").addClass("ui-state-unloaded");if(Vox.Environment.touch()){Chorus.Comments.TouchControls.init()}Chorus.Comments.loading_indicator=d("#comment_loader_gif");Chorus.Comments.initializeKeyboardShortcuts()},Collapse:{toggle:function(){var h=d(this).closest(".citem");var g=h.data("comment-id");var f=(Chorus.Comments.Options.toggle_children_with_collapse)?Chorus.Comments.Json.getChildrenOfComment(g):d();if(h.hasClass(Chorus.Comments.collapsed_class)||h.hasClass(Chorus.Comments.collapsed_class+"-child")){Chorus.Comments.Collapse.expand_it(h,f)}else{Chorus.Comments.Collapse.collapse_it(h,f)}return false},collapse_it:function(g,f){f.addClass(Chorus.Comments.collapsed_class+"-child");g.addClass(Chorus.Comments.collapsed_class);Chorus.Comments.Replies.updateCollapsedReplyCounts()},expand_it:function(g,f){f.removeClass(Chorus.Comments.collapsed_class+"-child");g.removeClass(Chorus.Comments.collapsed_class);g.removeClass(Chorus.Comments.collapsed_class+"-child");f.filter("."+Chorus.Comments.collapsed_class).each(function(h,i){var j=d(i);Chorus.Comments.Collapse.collapse_it(j,Chorus.Comments.Json.getChildrenOfComment(j.data("comment-id")))})}},Replies:{updateCollapsedReplyCounts:function(){if(Chorus.Comments.Options.display_replies_count===false){return}d(".citem."+Chorus.Comments.collapsed_class).each(function(f,g){$collapsed=d(g);Chorus.Comments.Replies.updateReplies($collapsed);Chorus.Comments.Replies.updateRepliesUI($collapsed)})},updateReplies:function(f){var g=(Chorus.Comments.Options.toggle_children_with_collapse)?Chorus.Comments.Json.getChildrenOfComment(f.data("comment-id")):d();f.data("hidden-replies",g.length);f.data("hidden-replies-new",g.filter(".new").length)},updateRepliesUI:function(g){var h=g.data("hidden-replies");var f=g.data("hidden-replies-new");var i=(h==1)?h+" reply":"";if(h>1){i=h+" replies"}if(f>0){i=i+", "+f+" new"}g.find(".replies-count").html(i)}},TouchControls:{init:function(){d(Chorus.Comments.touchTools.control).show();d(Chorus.Comments.touchTools.control).on(Chorus.Comments.Options.click_event,Chorus.Comments.TouchControls.toggle);d(Chorus.Comments.touchTools.bar).find("a").on(Chorus.Comments.Options.click_event,Chorus.Comments.TouchControls.fire);Chorus.Comments.TouchControls.positionBar()},positionBar:function(){var f=d(Chorus.Comments.touchTools.bar);f.data("height",f.outerHeight(true));f.appendTo("body").css("bottom",f.data("height")*-1)},toggle:function(){var h=d(Chorus.Comments.touchTools.bar);var f=parseInt(h.css("bottom"),10);var g=(f<0)?0:h.data().height*-1;h.css("visibility","visible").animate({bottom:g},300);return false},fire:function(f){switch(d(this).data().keypress){case"next":Chorus.Comments.Cycle.remove();Chorus.Comments.Cycle.next();break;case"unmark":Chorus.Comments.Cycle.removeAll();break;case"refresh":d("."+Chorus.Comments.hidden_mobile_class).removeClass(Chorus.Comments.hidden_mobile_class).addClass(Chorus.Comments.new_comment_class);d(Chorus.Comments.touchTools.bar).removeClass(Chorus.Comments.touchTools.newCommentsClass);Chorus.Comments.Cycle.refresh();Chorus.Comments.Json.check_for_updates();break;case"close":Chorus.Comments.TouchControls.toggle();break;case"z":Chorus.Comments.Cycle.remove();Chorus.Comments.Cycle.next();break;case"j":Chorus.Comments.Cycle.next();break;case"k":Chorus.Comments.Cycle.previous();break;case"A":Chorus.Comments.Cycle.removeAll();break;case"C":Chorus.Comments.Cycle.previous();break;case"c":Chorus.Comments.Cycle.next();break;case"x":Chorus.Comments.Cycle.remove();break;case"r":Chorus.Comments.Cycle.reply();break}return false}},supportsTransitions:function(){var f=document.body||document.documentElement;var j=f.style;var l="transition";var g=["Moz","Webkit","Khtml","O","ms"];if(typeof j[l]==="string"){return true}l=l.charAt(0).toUpperCase()+l.substr(1);for(var h=0;h<g.length;h++){if(typeof j[g[h]+l]==="string"){return true}}return false},load_comments_success:function(){Chorus.Comments.busy=false;Chorus.Comments.loaded=true;d("#main-comment-form").css("display","block");this.Cycle.refresh();var i=d(".comments_wrapper");i.removeClass("ui-state-unloaded");i.removeClass("ui-state-loading");i.addClass("ui-state-loaded");var g=window.location.hash.replace("#","");if(/[0-9]+/.test(g)){var h=parseInt(g,10);if(d("#"+h).length>0){window.location.hash="";Chorus.Comments.scroll_to(h)}}if(this.Options.auto_update){var f=Vox.Environment.currentBreakpoint();if(!!f&&_.indexOf(["xsmall","small"],f.name)===-1){this.start_auto_update()}}},load_comments_failure:function(){var g=d(".comments_wrapper");g.removeClass("ui-state-unloaded");g.removeClass("ui-state-loading");g.removeClass("ui-state-loaded");g.addClass("ui-state-load-error");var f=d("#"+Chorus.Comments.comments_container);f.html('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later.</h2>')},contextualize_flat_comments:function(g,h){var j="";var f=Chorus.Comments.Options.depth_to_start_contextualizing;for(f;f<h&&j.length<8;f++){j+="> "}g.find(".by").prepend('<span class="context">'+j+"</span>")},submit_comment:function(f){if(d(f).data("previewing")){Chorus.Comments.post_comment(f)}else{Chorus.Comments.preview_comment(f)}},preview_comment:function(g){var j=d(g).find(".preview");j.val("Previewing...").prop("disabled",true);var i="/comments/preview_comment";var h=function(n){if(n.success){var p=n.comments[0];j.val("Preview").prop("disabled",false);if(p){Chorus.Comments.Json.Users.add(n.users);Chorus.Comments.Json.initialize_comment(p);var m=d("#"+p.preview_element);m.html(p.html);if(Chorus.Comments.Options.include_preview_controls){var l=Chorus.Comments.Json.Templates["comment-preview-controls-template"];var o=l({comment:p});m.append(o)}}d(g).data("previewing",true)}else{alert(n.message)}};var f=function(n,l,m){alert("Unable to preview comment: "+m)};d.ajax({url:i,dataType:"json",data:d(g).serialize(),method:"post",timeout:15000,success:h,error:f});return false},flag_comment:function(h,g){var l=Chorus.Comments.Json.get(g);var j="/comments/flag_comment";var i=function(m){if(!m.success){alert(m.message);l.is_flagged_by_user=false;l.bad_flags_count-=1;Chorus.Comments.Json.update_comment_actions(l)}};var f=function(o,m,n){alert("Unable to flag comment: "+n)};l.is_flagged_by_user=true;l.bad_flags_count+=1;Chorus.Comments.Json.update_comment_actions(l);Chorus.Comments.UIAdapter.closeModal();d.ajax({url:j,dataType:"json",data:d(h).serialize(),method:"post",timeout:15000,success:i,error:f});return false},flag_comment_dialog:function(h){var i=Chorus.Comments.Json.get(h);if(i.is_flagged_by_user){Chorus.Comments.unflag_comment(h)}else{var g=Chorus.Comments.Json.Templates["comment-flag-template"];var f=g({comment:i});Chorus.Comments.UIAdapter.openModal(f)}},unflag_comment:function(g){var j=Chorus.Comments.Json.get(g);var i="/comments/unflag_comment";var h=function(l){if(!l.success){alert(l.message);j.is_flagged_by_user=true;j.bad_flags_count+=1;Chorus.Comments.Json.update_comment_actions(j)}};var f=function(n,l,m){alert("Unable to unflag comment: "+m)};j.is_flagged_by_user=false;j.bad_flags_count-=1;Chorus.Comments.Json.update_comment_actions(j);d.ajax({url:i,dataType:"json",data:{id:g},method:"post",timeout:15000,success:h,error:f});return false},recommend_comment:function(g){var j=Chorus.Comments.Json.get(g);if(j.is_recommended_by_user){return Chorus.Comments.unrecommend_comment(g)}var i="/comments/recommend_comment";var h=function(l){if(!l.success){alert(l.message);j.is_recommended_by_user=false;j.recommended_flags_count-=1;Chorus.Comments.Json.update_comment_actions(j)}};var f=function(n,l,m){alert("Unable to recommend comment: "+m)};j.is_recommended_by_user=true;j.recommended_flags_count+=1;Chorus.Comments.Json.update_comment_actions(j);d.ajax({url:i,dataType:"json",data:{id:g},method:"post",timeout:15000,success:h,error:f});return false},unrecommend_comment:function(h){var l=Chorus.Comments.Json.get(h);var j="/comments/unflag_comment";var f=d("#"+l.element);var i=function(m){if(!m.success){alert(m.message);l.is_recommended_by_user=true;l.recommended_flags_count+=1;Chorus.Comments.Json.update_comment_actions(l)}};var g=function(o,m,n){alert("Unable to unflag comment: "+n)};f.removeClass("recommended");l.is_recommended_by_user=false;l.recommended_flags_count-=1;Chorus.Comments.Json.update_comment_actions(l);d.ajax({url:j,dataType:"json",data:{id:h},method:"post",timeout:15000,success:i,error:g});return false},hide_comment:function(h){var n=d("#comment_item_"+h);var i=n.is(".hidden");var m=Chorus.Comments.Json.get(h);if(!!m.parent_id&&Chorus.Comments.Json.has_hidden_parent(m.parent_id)){var l="You can't "+(i?"unhide":"hide")+" this comment because its parents are already hidden.";alert(l);return false}if(i){if(!confirm("Are you sure you want to unhide this comment?")){return false}}else{if(!confirm("Are you sure you want to hide this comment and all of its replies?")){return false}}var f=d("#comment_mod_tools_"+h).find(".hide");f.text(i?"Unhiding...":"Hiding...");var j=function(o){if(o.success){if(!i){n.addClass("hidden");f.text("Unhide");Chorus.Comments.Json.get(n.data("comment-id")).hidden=true;Chorus.Comments.Json.getChildrenOfComment(h).each(function(){Chorus.Comments.Json.get(d(this).data("comment-id")).hidden=true;d(this).addClass("hidden");d(this).find(".mod_tools").find(".hide").text("Unhide")})}else{Chorus.Comments.Json.get(n.data("comment-id")).hidden=false;n.removeClass("hidden");f.text("Hide")}}else{alert(o.message)}};var g=function(q,o,p){alert("Unable to hide comment: "+p)};d.ajax({url:"/comments/hide_comment",dataType:"json",data:{id:h},method:"post",timeout:15000,success:j,error:g});return false},delete_comment:function(g){if(confirm("Are you sure you want to delete this comment and all of its replies?")){d("#comment_mod_tools_"+g).find(".delete").text("Deleting...");var i="/comments/destroy_comment";var h=function(j){if(j.success){Chorus.Comments.Json.getChildrenOfComment(g).remove();d("#comment_item_"+g).remove()}else{alert(j.message)}};var f=function(m,j,l){alert("Unable to delete comment: "+l);d("#comment_mod_tools_"+g).find(".ss-delete").text("Delete")};d.ajax({url:i,dataType:"json",data:{id:g},method:"post",timeout:15000,success:h,error:f})}return false},edit_comment:function(h){var l="/comments/edit_comment";var g=d("#comment_edit_body_"+h).val();var i=d("#comment_edit_title_"+h).val();var m=Chorus.Comments.Json.get(h);var j=function(o){if(o.success){var n=o.comments[0];m.submitted_body=g;m.body=n.body;m.title=n.title;d("#"+m.element).find(".cbody, .body").html(m.body);d("#"+m.element).find(".ctitle, .title").html(m.title);Chorus.Comments.cancel_edit_form(m.id)}else{alert(o.message);Chorus.Comments.cancel_edit_form(h)}};var f=function(p,n,o){e["_"+h]=false;alert("Unable to edit comment: "+o)};d("#comment_edit_save_button_"+h).val("Saving...");d.ajax({url:l,dataType:"json",data:{entry_id:m.entry_id,comment_id:h,new_body:g,new_title:i},method:"post",timeout:15000,success:j,error:f});return false},post_comment:function(h){if(Chorus.Comments.busy){return true}Chorus.Comments.busy=true;var f=d(h);f.data("previewing",false);if(f.hasClass("reply_form")){f.find(".submit_action").prop("disabled",true).val("Replying...");d(".preview-controls .post").prop("disabled",true).val("Replying...")}else{if(f.hasClass("post_form")){f.find(".submit_action").prop("disabled",true).val("Posting...");d(".preview-controls .post").prop("disabled",true).val("Posting...")}}var j="/comments/post_comment";var i=function(l){if(l.success){var m=l.comments[0];if(f.hasClass("post_form")){f.find(".submit_action").val("Post");f.find(".submit_action").prop("disabled",false)}m.submitted_body=f[0]["comment[body]"].value;h.reset();Chorus.Comments.busy=false;Chorus.Comments.Json.Users.add(l.users);Chorus.Comments.Json.initialize_comment(m);Chorus.Comments.Json.add(m);Chorus.Comments.Json.insert_comment(m.id,true);Chorus.Comments.cancel_comment_form(m.parent_id);Chorus.Comments.scroll_to(m.id)}else{alert(l.message);Chorus.Comments.busy=false;if(f.hasClass("reply_form")){f.find(".submit_action").prop("disabled",false);f.find(".submit_action").val("Reply")}else{if(f.hasClass("post_form")){f.find(".submit_action").prop("disabled",false);f.find(".submit_action").val("Post")}}}};var g=function(n,l,m){alert("Unable to post comment: "+m);Chorus.Comments.busy=false;if(f.hasClass("reply_form")){f.find(".submit_action").prop("disabled",false);f.find(".submit_action").val("Reply")}else{if(f.hasClass("post_form")){f.find(".submit_action").prop("disabled",false);f.find(".submit_action").val("Post")}}};d.ajax({url:j,dataType:"json",data:f.serialize(),method:"post",timeout:15000,success:i,error:g});return false},mark_all_as_new:function(){this.mark_new_comments(Chorus.Comments.Json._comments)},mark_new_comments:function(g){for(var f=0;f<g.length;f++){d("#comment_item_"+g[f].id).removeClass("not-new").addClass("new")}},scroll_to:function(f,g){var i=d("#comment_item_"+f);if(i.hasClass(Chorus.Comments.collapsed_class+"-child")&&i.data("parent-comment-id")){Chorus.Comments.scroll_to(i.data("parent-comment-id"),g);return}var h=(Chorus.Comments.Options.animate_scroll_to)?Chorus.Comments.Options.scroll_animation_duration:0;if(_.isUndefined(g)){g=Chorus.Comments.Options.fixed_header_height}if(i.length>0){d("html, body").stop(true).animate({scrollTop:i.offset().top-g},{duration:h,complete:function(){}})}},start_auto_update:function(){Chorus.Comments.stop_auto_update();Chorus.Comments.auto_updater=setTimeout(Chorus.Comments.Json.check_for_updates,Chorus.Comments.current_update_interval)},stop_auto_update:function(){if(Chorus.Comments.auto_updater!==undefined){clearTimeout(Chorus.Comments.auto_updater);Chorus.Comments.auto_updater=undefined}},check_empty_count:function(f){Chorus.Comments.empty_count=f;var g=false;if(f===0&&(Chorus.Comments.current_update_interval!==Chorus.Comments.UPDATE_INTERVAL)){Chorus.Comments.current_update_interval=Chorus.Comments.UPDATE_INTERVAL;g=true}else{if(Chorus.Comments.empty_count===5){Chorus.Comments.current_update_interval=Chorus.Comments.SLOW_UPDATE_INTERVAL;g=true}}if(g){Chorus.Comments.start_auto_update()}},is_editable:function(f){var g=moment().unix();return(g-f)<Chorus.Comments.edit_timer},edit_countdown:function(g){var h=moment().unix();var p=d("#comment_item_"+g).data("timestamp");var o=h-p;var l=Chorus.Comments.edit_timer-o;var j=d("#countdown_timer_"+g);var m=d("#countdown_bar_"+g);var i=d("#comment_edit_"+g);var n,q;j.text(l);m.show();var f=function(){h=moment().unix();o=h-p;l=Chorus.Comments.edit_timer-o;q=(l/Chorus.Comments.edit_timer)*100;if(l<1){m.width(0);i.hide()}else{m.width(q+"%");j.text(l);setTimeout(f,1000)}};setTimeout(f,1000)},cancel_edit_form:function(f){e["_"+f]=false;d("#comment_edit_"+f).remove();d("#comment_body_"+f+", #comment_title_"+f+", #comment_avatar_"+f).show()},cancel_comment_form:function(f){if(f){d("#comment_form_container_"+f).html("")}else{d("#main_comment_form form").data("previewing",false).get(0).reset();d("#main_comment_preview").html("")}},edit:function(m){if(e["_"+m]){return}e["_"+m]=true;var n=Chorus.Comments.Json.get(m);var f=d("#comment_body_"+m);var j=d("#comment_title_"+m);var i=d("#comment_avatar_"+m);f.hide();j.hide();i.hide();var l=Chorus.Comments.Json.Templates["comment-edit-template"];if(n.submitted_body){n.body=n.submitted_body}var h=l({comment:n});var g=d('<div id="comment_edit_'+m+'"></div>');g.html(h);f.after(g);d("#comment_edit_body_"+m).markItUp(Chorus.Comments.Options.button_options);d("#comment_edit_form_"+m+" .text-input").focus()},reply:function(i){if(Chorus.Comments.user_id&&!Chorus.Comments.Options.able_to_comment){var j=d("#comment_tease").offset();if(j){d(window).scrollTop(j.top-Chorus.Comments.Options.fixed_header_height)}return false}else{if(!Chorus.Comments.user_id){var g=Chorus.Comments.Json.Templates["comment-modal-login-template"];Chorus.Comments.UIAdapter.openModal(g());return false}}var l=Chorus.Comments.Json.get(i);var f=d("#comment_form_container_"+i);var h=Chorus.Comments.Json.Templates["comment-reply-template"];f.html(h({comment:l}));d("#comment_reply_body_"+i).markItUp(Chorus.Comments.Options.button_options);d("#comment_reply_form_"+i+" .text-input").focus()},hide_autoupdate_info:function(){d("#autoupdate_info").hide();return false},show_new_comment_alert:function(){this.Options.show_new_comment_alert=true;return this.Options.show_new_comment_alert},hide_new_comment_alert:function(){this.Options.show_new_comment_alert=false;return this.Options.show_new_comment_alert},toggle_formatting_guide:function(){d("#formatting_guide_links a").toggle();d("#comment_formatting_guide").slideToggle();return false},inspect_flags:function(f){Chorus.Comments.Json.load_flags(f)},Json:{initialize:function(){Chorus.Comments.loaded=false;this._comments={};this.Users.initialize();this.Templates={};var h=d("script.template");for(var g=0;g<h.length;g++){var j=h[g];var l=d(j).html();var f=d(j).attr("id");this.Templates[f]=_.template(l)}d(".speed-read-link").on(Chorus.Comments.Options.click_event,function(i){i.preventDefault();d(".comments_wrapper").toggleClass("ui-state-speed-read-tips-active")})},reload_comments:function(){this.initialize();this.load_comments()},load_comments:function(g){if(Chorus.Comments.busy||Chorus.Comments.loaded){return}Chorus.Comments.busy=true;Chorus.Comments.loading_indicator.show();if(g===undefined){g=false}var h="/comments/load_comments/"+Chorus.Comments.entry_id;if(g){h+="?t="+(new Date()).getTime()}var f=d("#show_comments_link");d("#load_more button").text("Loading...");Chorus.Comments.current_page++;var i=d(".comments_wrapper");i.removeClass("ui-state-unloaded");i.addClass("ui-state-loading");i.removeClass("ui-state-loaded");d.ajax({url:h,dataType:"json",success:function(j){Chorus.Comments.Json.comment_template=Chorus.Comments.Json.Templates["comment-template"];Chorus.Comments.Json.load(j);Chorus.Comments.Json.Users.load(j.users);Chorus.Comments.Json.renderPage(j.comments);Chorus.Comments.lastId=j.last_comment_id;d("#load_more button").text("Load More");d("#load_more").show();d(Chorus.Comments).trigger("comments_loaded");Chorus.Comments.loading_indicator.hide();if(f.length>0){f.hide()}},error:function(j){Chorus.Comments.busy=false;Chorus.Comments.loading_indicator.hide();Chorus.Comments.load_comments_failure()}})},load_flags:function(g){var f=Chorus.Comments.Json._comments[g];if(f){var h="/comments/ajax_comment_flags/"+g;d.ajax({url:h,dataType:"json",success:function(l){Chorus.Comments.Json.Users.load(l.users);var j=Chorus.Comments.Json.Templates["comment-flags-modal-template"];var i=j({comment:f,flaggings:l.flaggings});Chorus.Comments.UIAdapter.openModal(i)},error:function(i){alert("Couldn't load flags for "+g)}})}},initialize_comment:function(h){if(!!h.parent_id){h.parent_element="comment_item_"+h.parent_id;h.preview_element="comment_preview_"+h.parent_id;h.parent=Chorus.Comments.Json.get(h.parent_id);if(!h.parent){h.parent_id=null}}else{h.preview_element="main_comment_preview";h.parent_element=Chorus.Comments.comments_container}h.element="comment_item_"+h.id;if(!h.ancestry){var g=h.id||"preview";if(h.parent){h.ancestry=h.parent.ancestry+"/"+g}else{h.ancestry=g.toString()}h.depth=h.ancestry.split("/").length}h.user=Chorus.Comments.Json.Users.find(h.user_id);if(h.user===undefined){h.user={display_name:"anonymous"}}var f=(!!h.created_on)?moment(h.created_on):moment();h.created_on_date=f.format("MMM D, YYYY | h:mm A");h.created_on_date_mobile=f.format("MM.DD.YY h:mma").slice(0,-1);h.created_timestamp=f.unix();h.bad_flags_count=h.troll_flags_count+h.spam_flags_count+h.inappropriate_flags_count;if(h.user.author_profile){h.user.profile_image=h.user.author_profile.image_url;h.user.profile_url=h.user.author_profile.url}else{if(h.user.network_membership){h.user.profile_image=h.user.network_membership.image_url;h.user.profile_url=h.user.network_membership.url}}h.html=Chorus.Comments.Json.comment_template({comment:h})},exists:function(f){return this._comments[parseInt(f.id,10)]!==undefined},add:function(g,f){if(!f&&this.exists(g)){return false}else{this._comments[parseInt(g.id,10)]=g;return true}},get:function(f){return this._comments[parseInt(f,10)]},has_hidden_parent:function(f){if(!f){return false}var g=Chorus.Comments.Json.get(f);if(!!g.parent_id){return !!g.hidden||Chorus.Comments.Json.has_hidden_parent(g.parent_id)}else{return !!g.hidden}},insert_comment:function(j,h){var n=Chorus.Comments.Json.get(j);if(!n){return}var g=d("#"+n.parent_element);if(!n.parent_id){g.append(n.html)}else{var f=g.next();var m=g.data("commentDepth");var i=f.data("commentDepth");var l=null;while(f&&f.length>0){if(i<=m){l=f.prev();f=null}else{f=f.next();i=f.data("commentDepth")}}if(l==null){l=g.parent().children().last()}l.after(n.html);if(n.depth>Chorus.Comments.Options.depth_to_start_contextualizing){Chorus.Comments.contextualize_flat_comments(d("#"+n.element),n.depth)}if(g.hasClass(Chorus.Comments.collapsed_class)||g.hasClass(Chorus.Comments.collapsed_class+"-child")){d("#"+n.element).addClass(Chorus.Comments.collapsed_class+"-child")}}if(Chorus.Comments.user_id===n.user_id&&Chorus.Comments.is_editable(n.created_timestamp)){Chorus.Comments.edit_countdown(j)}if(Vox.Environment.touch()){d("#"+n.element).addClass(Chorus.Comments.touch_enabled_class)}if(Util.UserAgentProfiler.isMobile()&&!h){d("#"+n.element).removeClass(Chorus.Comments.new_comment_class).addClass(Chorus.Comments.hidden_mobile_class)}},load:function(j){var l=j.comments;var h=j.new_comment_ids;var f,m;for(f=0;f<l.length;f++){this.add(l[f])}for(f=0;f<h.length;f++){var g=parseInt(h[f],10);m=this._comments[g];if(m!==undefined){m.is_new=true}}},update_comment_actions:function(i){var f=d("#comment_item_"+i.id);var h=d(".cactions",f).first();var g=this.render_comment_actions(i);h.html(g)},render_comment_actions:function(h){var g=Chorus.Comments.Json.Templates["comment-actions-template"];var f=g({comment:h});return f},getChildrenOfComment:function(i){var j=d("#comment_item_"+i);var h=j.data("commentDepth");var g=j.next(".citem");var f=d();while(g.data("commentDepth")>h){f=f.add(g);g=g.next(".citem")}return f},renderPage:function(p){var g=d("#"+Chorus.Comments.comments_container);var n,m,l=[],h=200;for(n=0,m=p.length;n<m;n+=h){l.push(p.slice(n,n+h))}var f=0;var o=function(){var i="";_.each(l[f],function(j){Chorus.Comments.Json.initialize_comment(j);i+=j.html});g.append(i);g.find(".citem").each(function(){var j=d(this).data();if(j.commentDepth>Chorus.Comments.Options.depth_to_start_contextualizing){Chorus.Comments.contextualize_flat_comments(d(this),j.commentDepth)}if(j.userId===Chorus.Comments.user_id&&Chorus.Comments.is_editable(j.timestamp)){Chorus.Comments.edit_countdown(j.commentId)}if(Vox.Environment.touch()){d(this).addClass(Chorus.Comments.touch_enabled_class)}});f++;if(f<l.length){setTimeout(o,Math.min(f*50,300))}else{Chorus.Comments.load_comments_success()}};setTimeout(o,0)},check_for_updates:function(){if(Chorus.Comments.auto_updating){return false}else{Chorus.Comments.auto_updating=true}var f="/comments/ajax_comments_update/"+Chorus.Comments.entry_id+"?last_version="+Chorus.Comments.entry_version+"&last_id="+Chorus.Comments.lastId+"&request_id="+(++Chorus.Comments.lastRequestId);d.ajax({url:f,dataType:"json",timeout:15000,error:function(){Chorus.Comments.auto_updating=false;Chorus.Comments.check_empty_count(Chorus.Comments.empty_count+1);Chorus.Comments.auto_updater=setTimeout(Chorus.Comments.Json.check_for_updates,Chorus.Comments.current_update_interval)},success:function(h){try{Chorus.Comments.Json.check_for_updates_success(h)}catch(g){console.warn("Failed to update comments: "+g)}Chorus.Comments.auto_updating=false;Chorus.Comments.auto_updater=setTimeout(Chorus.Comments.Json.check_for_updates,Chorus.Comments.current_update_interval)}})},check_for_updates_success:function(j){if(Chorus.Comments.lastRequestId!==parseInt(j.last_request_id,10)){console.warn("Failed to update comments: updates arrived out of order");return}Chorus.Comments.lastId=j.last_id;Chorus.Comments.entry_version=j.last_version;Chorus.Comments.Json.Users.add(j.users);for(var g=0,f=j.deleted_comment_ids.length;g<f;g++){var h=j.deleted_comment_ids[g];Chorus.Comments.Json.getChildrenOfComment(h).remove();d("#comment_item_"+h).remove()}var l=[];for(var g=0,m;g<j.comments.length;g++){var m=j.comments[g];if(Chorus.Comments.Json.add(m)){l.push(m);m.is_new=true;Chorus.Comments.Json.initialize_comment(m);Chorus.Comments.Json.insert_comment(m.id,true)}}if(l.length>0){Chorus.Comments.check_empty_count(0);Chorus.Comments.Cycle.refresh();Chorus.Comments.Replies.updateCollapsedReplyCounts();if(Util.UserAgentProfiler.isMobile()){d(Chorus.Comments.touchTools.bar).addClass(Chorus.Comments.touchTools.newCommentsClass)}else{Chorus.Comments.Json.render_autoupdate_info(l)}}else{Chorus.Comments.check_empty_count(Chorus.Comments.empty_count+1)}},render_autoupdate_info:function(l){if(!Chorus.Comments.Options.show_new_comment_alert){return false}var n=l;var f=5;var m=(n.length-f);var j=Chorus.Comments.Json.Templates["comment-alert-template"];var g=j({max_comments:f,comments:n,additional_comments:m});var i=d("#autoupdate_info_list");var h=d("#autoupdate_info");h.show();i.html(g);h.fadeIn(1000);setTimeout(function(){h.fadeOut(500)},6500)},Users:{initialize:function(){this.users={}},find:function(f){return this._users[f]},add:function(h){if((h instanceof Array)===false){h=[h]}var f;for(var g=0;g<h.length;g++){f=h[g];this._users[f.id]=f}},load:function(f){this._users={};this.add(f)}}}};Chorus.Comments.Cycle={};Chorus.Comments.Cycle.list=[];Chorus.Comments.Cycle.action_queue=[];Chorus.Comments.Cycle.index=-1;Chorus.Comments.Cycle.lookingAtComment=true;Chorus.Comments.Cycle.inAction=false;Chorus.Comments.Cycle.inRefresh=false;Chorus.Comments.Cycle.previous=function(){if(!Chorus.Comments.Cycle.lookingAtComment){++Chorus.Comments.Cycle.index}var f=(Chorus.Comments.Cycle.index<=0)?Chorus.Comments.Cycle.list.length-1:Chorus.Comments.Cycle.index-1;Chorus.Comments.Cycle.goToIndex(f)};Chorus.Comments.Cycle.next=function(){var f=(Chorus.Comments.Cycle.index>=Chorus.Comments.Cycle.list.length-1)?0:Chorus.Comments.Cycle.index+1;Chorus.Comments.Cycle.goToIndex(f)};Chorus.Comments.Cycle.remove=function(){if(!Chorus.Comments.Cycle.lookingAtComment){return}else{var f=Chorus.Comments.Cycle.currentComment();if(f===null){return}else{f.find(".comment").removeClass("new");f.removeClass("new");Chorus.Comments.Cycle.notCurrent(f);Chorus.Comments.Cycle.list.splice(Chorus.Comments.Cycle.index,1);Chorus.Comments.Cycle.lookingAtComment=false;--Chorus.Comments.Cycle.index;Chorus.Comments.Replies.updateCollapsedReplyCounts()}}};Chorus.Comments.Cycle.removeAll=function(){if(false&&Chorus.Comments.Cycle.list.length>=50){Chorus.openModalWithContents("Unmarking "+Chorus.Comments.Cycle.list.length+" comments.",{overlayDisplay:false,fade:true,fadeDuration:0});setTimeout(Chorus.Comments.doRemoveAll,100)}else{Chorus.Comments.doRemoveAll()}};Chorus.Comments.doRemoveAll=function(){var g=Chorus.Comments.Cycle.currentComment();var f=Chorus.Comments.Cycle.list;Chorus.Comments.Cycle.list=[];if(g!==null){Chorus.Comments.Cycle.notCurrent(g)}_.each(f,function(i){var h=d("#"+i);h.find(".comment").removeClass("new");h.removeClass("new")})};Chorus.Comments.Cycle.currentComment=function(){if(Chorus.Comments.Cycle.index<0||Chorus.Comments.Cycle.index>=Chorus.Comments.Cycle.list.length){return null}else{return d("#"+Chorus.Comments.Cycle.list[Chorus.Comments.Cycle.index])}};Chorus.Comments.Cycle.goToComment=function(f){Chorus.Comments.Cycle.goToIndex(_.indexOf(Chorus.Comments.Cycle.list,f))};Chorus.Comments.Cycle.goToIndex=function(f){if(Chorus.Comments.Cycle.list.length===0){return}else{var i=Chorus.Comments.Cycle.currentComment();if(i!==null){Chorus.Comments.Cycle.notCurrent(i)}Chorus.Comments.Cycle.index=f;var g=Chorus.Comments.Cycle.currentComment();var h=g.attr("data-comment-id");Chorus.Comments.Cycle.current(g);Chorus.Comments.scroll_to(h);Chorus.Comments.Cycle.lookingAtComment=true}};Chorus.Comments.Cycle.current=function(f){f.addClass("active_comment")};Chorus.Comments.Cycle.notCurrent=function(f){f.removeClass("active_comment")};Chorus.Comments.Cycle.reply=function(){var f=d(Chorus.Comments.Cycle.currentComment());var g=d(".reply_link",f);if(g){g.trigger(Chorus.Comments.Options.click_event)}};Chorus.Comments.Cycle.safeAction=function(f){return function(){Chorus.Comments.Cycle.queued_action=f;if(!Chorus.Comments.loaded){d(window).scrollTop(d("#comments").offset().top-Chorus.Comments.Options.fixed_header_height);Chorus.Comments.Json.load_comments(true);return}if(Chorus.Comments.Cycle.inRefresh){return}Chorus.Comments.Cycle.performQueuedAction()}};Chorus.Comments.Cycle.performQueuedAction=function(){if(Chorus.Comments.Cycle.queued_action){Chorus.Comments.Cycle.inAction=true;Chorus.Comments.Cycle.queued_action();Chorus.Comments.Cycle.queued_action=null;Chorus.Comments.Cycle.inAction=false}};Chorus.Comments.Cycle.refresh=function(){if(Chorus.Comments.Cycle.inAction){setTimeout(Chorus.Comments.Cycle.refresh,50);return}Chorus.Comments.Cycle.inRefresh=true;var f=Chorus.Comments.Cycle.currentComment();Chorus.Comments.Cycle.list=_.map(d("#"+Chorus.Comments.comments_container+" .citem.new"),function(g){return g.id});if(!!f){Chorus.Comments.Cycle.index=_.indexOf(Chorus.Comments.Cycle.list,f[0].id)}Chorus.Comments.Cycle.inRefresh=false;Chorus.Comments.Cycle.performQueuedAction()};Chorus.Comments.toggleActions=function(f){d(".sbn-comment[data-comment-id="+f+"]").toggleClass("ui-state-tools-active")};Chorus.Comments.initializeKeyboardShortcuts=function(){shortcut.add("Shift+a",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.removeAll()}),{disable_in_input:true});shortcut.add("Shift+c",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.previous()}),{disable_in_input:true});shortcut.add("c",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.next()}),{disable_in_input:true});shortcut.add("j",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.next()}),{disable_in_input:true});shortcut.add("k",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.previous()}),{disable_in_input:true});shortcut.add("x",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.remove()}),{disable_in_input:true});shortcut.add("z",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.remove();Chorus.Comments.Cycle.next()}),{disable_in_input:true});shortcut.add("r",Chorus.Comments.Cycle.safeAction(function(){Chorus.Comments.Cycle.reply()}),{disable_in_input:true})}})(jQuery);var Vox=Vox||{};Vox.Modules=Vox.Modules||{};Vox.Modules.DynamicSizedImages=function(e){var b={};if(Vox.Module){var b=new Vox.Module()}else{e(document).ready(function(){Vox.Modules.DynamicSizedImages.init()})}function g(l){var m=l.data("ratio"),j=l.outerWidth(),h=l.outerHeight(),i=m*h;if(i>j){if(m!==1&&h!==j){j=i}}return j}function d(i){var n=i.data("sizes");if(typeof n==="undefined"){return}var l=g(i),m;if(typeof window.devicePixelRatio!=="undefined"){l*=window.devicePixelRatio}for(var j in n){if(!n.hasOwnProperty(j)){continue}j=+j;if(typeof m==="undefined"){m=j}if(Math.abs(l-j)<Math.abs(m-l)){m=j}}if(Util.UserAgentProfiler.profile()==="desktop"&&typeof m!=="undefined"&&l<=350){var h;for(var j in n){if(!n.hasOwnProperty(j)||+j<=+m){continue}if(typeof h==="undefined"){h=j}if(Math.abs(m-j)<Math.abs(h-l)){h=j}}m=h}return n[m]}var f=".vox-lazy-load";function c(h,i){var h=h||e("body");var j=h.find(f);j.each(function(){var o=e(this);var m=d(o);if(o.is("img")){var n=o.data("ratio"),l=Math.ceil(o.outerWidth()/n);o.css("height",l)}if(typeof m!=="undefined"&&o.data("original")!==m){o.data("original",m)}});i=jQuery.extend({failure_limit:20,load:function(){var n=e(this);if(n.is("img")){n.css("height","auto")}n.addClass("lazy-loaded");if(e.fn.playGIF){var m={circleColor:Vox.Config.get("mainLinkColor")};if(typeof PLAYGIF_DISABLE_FLAG==="undefined"){var l=e('.sbn-entry-body-text img[src*=".gif"], .fanshot-body img[src*=".gif"]');var o=e('#sbnu-article-main-row img[data-original*=".gif"]');if((l.length+o.length)===1){PLAYGIF_DISABLE_FLAG=true}else{PLAYGIF_DISABLE_FLAG=false;l.playGIF(m)}}n.playGIF(m)}},threshold:a()},i);j.lazyload(i)}function a(){var i;if(Util.UserAgentProfiler.profile()==="desktop"){i=0.25}else{i=0.1}var j=e(document).height(),h=Math.floor(j*i);return h}b.calculateThreshold=function(){a()};b.init=function(){this.initUI();jQuery(window).bind("breakpointchange",function(h){c()});if(this.eventDispatcher){this.eventDispatcher.subscribe("moduleInserted",function(h){c(h.modules)})}};b.initUI=function(h,i){c(h,i)};return b}(jQuery);Vox.Modules.ModuleLoader=(function(c){var a=new Vox.Module();a.loadStoryMetadata=function(e){e=e||c(document);if(!Chorus.Context.logged_in){return}var d=[];e.find("[data-delayed-load-storybox]").each(function(){var f=c(this);if(typeof f.data("has-loaded")==="undefined"){d.push(f.data("delayed-load-storybox"));f.data("has-loaded",true)}});if(d.length==0){return}c.post("/sbn_entries/delayed_load_storyboxes",{entryIds:d},function(f){c.each(f,function(i,h){var g=c(i);g.each(function(j,o){var m=c(o);m.html(h);var n=m.data("comments-unread-token");if(typeof n!=="undefined"){var l=m.find("a");if(l.length>0){m.prepend(", ");l.append(" "+n)}}})})})};var b=function(d){d=d||c(document);var e=[];d.find("div[data-delayed-load-cell-class]").each(function(){var g=c(this),f={};if(g.data("unless-profile-is")!==Util.UserAgentProfiler.profile()){f={klass:g.data("delayed-load-cell-class")};if(g.data("state")){f.state=g.data("state")}e.push(f)}});if(e.length>0){if(e.length==1){e=e[0]}c.ajax({type:"GET",url:"/chorus_page/delayed_load_cells",dataType:"json",contentType:"application/json",data:{cells:JSON.stringify(e),serializedContext:Chorus.Context.serializedContext},success:function(g){if(g===null){return}var f,h;c.each(g,function(o,l){var j=c(l);var n=c("#"+o).replaceWith(j);var m=j.data("vox-module-name");var i=j.data("sbn-module-name");a.eventDispatcher.publish("moduleInserted",{modules:j});if(m&&Vox.Modules[m]){Vox.Modules[m].init()}if(i&&SBN[i]){SBN[i].init()}});Vox.Modules.ModuleLoader.loadStoryMetadata()}})}};a.init=function(){this.initUI()};a.initUI=function(){b();this.loadStoryMetadata()};return a})(jQuery);Vox.Modules.SocialCount=(function(f){var d=new Vox.Module();function g(){e()}function e(){f("[data-facebook-share-count-url]").each(function(){var i=f(this);b(i.data("facebook-share-count-url"),function(j){if(j>0){if(i.data("use-parens")===false){i.text(j).redraw()}else{i.text("("+j+")").redraw()}}})});f("[data-twitter-share-count-url]").each(function(){var i=f(this);a(i.data("twitter-share-count-url"),function(j){if(j>0){if(i.data("use-parens")===false){i.text(j).redraw()}else{i.text("("+j+")").redraw()}}})})}var c={};function b(i,j){if(c[i]){j(c[i]);return}d.eventDispatcher.subscribe("facebookSdkAvailable",function(){FB.api({method:"fql.query",query:"SELECT total_count FROM link_stat WHERE url = '"+i+"'"},function(l){c[i]=l[0].total_count;j(l[0].total_count)})})}var h={};function a(i,j){if(h[i]){j(h[i]);return}f.ajax({url:"http://cdn.api.twitter.com/1/urls/count.json",dataType:"jsonp",data:{url:i},success:function(l){h[i]=l.count;j(l.count)}})}f.extend(d,{init:g,initUI:e});return d})(jQuery);Vox.Modules.lookitCarousel=(function(f){var j=new Vox.Module();var b=f(window);function d(m){var n=m.width();m.removeClass("display-3-up display-4-up display-5-up, lookit-size-sm, lookit-size-md, lookit-size-lg");if(n<600){m.addClass("display-2-up lookit-size-sm");m.data("carousel-boxes-per-pane",2);return}if(n<900){m.addClass("display-3-up lookit-size-md");m.data("carousel-boxes-per-pane",3);return}m.addClass("display-4-up lookit-size-lg");m.data("carousel-boxes-per-pane",4)}function c(n){var m=n.width();var o=n.data("carousel-boxes-per-pane");var q=m/o;var p=n.find(".lookit-box");n.data("carousel-pane-width",m);n.data("carousel-box-width",q);n.data("carousel-full-panes",Math.floor(p.length/o));n.data("carousel-boxes-per-last-pane",p.length%o);p.css({height:q+"px"});n.find(".lookit-box-micro-inner").css({width:q+"px",height:q+"px"})}function l(p,u){var n=p.data("carousel-full-panes");var t=(p.data("carousel-boxes-per-last-pane")>0)?1:0;var m=n+t;var r=p.data("carousel-box-width");var s=p.data("carousel-pane-width");var q;if(u+1>m){u=0}if(u<0){u=m-1}if(u+1>n){q=(n*s)-(r*(p.data("carousel-boxes-per-pane")-p.data("carousel-boxes-per-last-pane")))}else{q=u*s}var o=p.find(".lookit-carousel-entries").css("left","-"+q+"px");p.data("carousel-current-pane",u);Vox.Modules.DynamicSizedImages.initUI(f(".lookit-carousel-entries"))}function e(m){var n=m.data("carousel-current-pane")+1;l(m,n)}function a(m){var n=m.data("carousel-current-pane")-1;l(m,n)}function g(n){n.preventDefault();var m=n.data.main;a(m)}function i(n){n.preventDefault();var m=n.data.main;e(m)}function h(n){var m=n.data.main;var o=m.data("carousel-current-pane")||0;d(m);c(m);l(m,o)}j.init=function(){this.view=f(".lookit-carousel");if(this.view.length<1){return}this.initUI()};j.initUI=function(){this.view.each(function(m,o){var n=f(o);n.find(".lookit-carousel-prev").bind("click",{main:n},g);n.find(".lookit-carousel-next").bind("click",{main:n},i);var p=n.data("carousel-current-pane")||0;b.bind("resizeStop",{main:n},h);h({data:{main:n}})})};return j})(jQuery);Vox.Modules.lookitTagBrowser=(function(b){var a=new Vox.Module();a.init=function(){this.view=b(".lookit-tag-browser");if(this.view.length<1){return}this.initUI()};a.initUI=function(){this.view.each(function(c,f){var d=b(f);var e=d.find("ul").width();d.find("li").each(function(g,i){var h=b(i);if((h.position().left+h.width())>e){h.addClass("is-hidden")}})})};return a})(jQuery);