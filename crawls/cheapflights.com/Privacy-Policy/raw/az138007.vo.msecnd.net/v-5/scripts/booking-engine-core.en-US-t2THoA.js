(function(k,r,b){var s=k.Sys,d=k.$addHandler,c=k.$removeHandler;var o=k.Function.createDelegate,g=s.UI.DomElement,n=k.$create;k.Type.registerNamespace("CF");var i=CF.BookingEngineType=function(){};i.prototype={EconomyFlight:0,BusinessFlight:1,BusinessAndEconomyFlight:2,CarRental:3,Hotel:4,FlightHotel:5,FlightCarRental:6,FlightCarRentalHotel:7,Holiday:8};b(i,"CF.BookingEngineType");var j=CF.BETripType=function(){};j.prototype={OneWay:0,RoundTrip:1,MultipleDestination:2};b(j,"CF.BETripType");var l=CF.BookingEngineFieldType=function(){};l.prototype={BookingEngineType:0,TripType:1,TicketClass:2,DepartureRegion:3,DestinationRegion:4,DepartureDateTime:5,ReturnDateTime:6,NumberOfAdults:7,NumberOfChildren:8,NumberOfInfants:9,NumberOfRooms:10,StarRating:11,DriverAge:12,EmailSignup:13,SearchType:14,Count:15};b(l,"CF.BookingEngineFieldType");var m=CF.BookingEngineTime=function(){};m.prototype={UseDate:0,Morning:1,Afternoon:2,Evening:3,Anytime:4};b(m,"CF.BookingEngineTime");var f=CF.BookingEngineStepBehavior=function(u){f.initializeBase(this,[u]);this._previousStep=null;this._nextStep=null;this._resources=null};f.prototype={initialize:function(){f.callBaseMethod(this,"initialize")},dispose:function(){f.callBaseMethod(this,"dispose")},get_active:function(){return g.containsCssClass(this.get_CssContainer(),this.get_activeClassName())},set_active:function(v){if(this.get_active()!=v){var u=this;while(u=u.get_previousStep()){u._set_active_impl(false)}u=this;this._set_active_impl(false);while(u=u.get_nextStep()){u._set_active_impl(false)}u=v?this:this.get_previousStep();if(u){u._set_active_impl(true)}}},get_previousStep:function(){return this._previousStep},set_previousStep:function(u){if(this._previousStep!=u){this._previousStep=u;if(u){u.set_nextStep(this)}}},get_nextStep:function(){return this._nextStep},set_nextStep:function(u){if(this._nextStep!=u){this._nextStep=u;if(u){u.set_previousStep(this)}}},get_CssContainer:function(){return this.get_element().parentNode},get_activeClassName:function(){return"cf-be-active"},get_inactiveClassName:function(){return"cf-be-inactive"},getChildElement:function(u){return k.$get(this.getChildElementId(u))},getChildElementId:function(u){return this.get_element().id+"_"+u},get_resources:function(){if(!this._resources){this._resources=this.createResources()}return this._resources},set_active_impl:function(u){var x=this.get_CssContainer(),v=this.get_activeClassName(),w=this.get_inactiveClassName();g.removeCssClass(x,u?w:v);g.addCssClass(x,u?v:w)},_set_active_impl:function(u){if(this.get_active()!=u){this.set_active_impl(u)}},createResources:function(){return CF.BookingEngineCoreResources}};r(f,"CF.BookingEngineStepBehavior",s.UI.Behavior);var t=CF.BookingEngineStepOneBehaviorBase=function(u){t.initializeBase(this,[u]);this._bookingEngineType=null;this._tripType=null;this._fieldBehaviors=[];this._defaultFieldBehaviorsCreated=false;this._fieldRules=null;this._defaultTripDays=7;this._targetPageTypeCode="";this._searchButton=null;this._onSearchButtonClick$=o(this,this._onSearchButtonClick);this._onPrincipalFieldPropertyChanged$=o(this,this._onPrincipalFieldPropertyChanged);this._postBackUrl=null;this._onKeyPress$=o(this,this._onKeyPress)};t.prototype={initialize:function(){var u=this._fieldBehaviors,v=this.createBehaviorInfos(this._onPrincipalFieldPropertyChanged$);this.foreachFieldType(function(x){if(v[x]){u[x]=this._createFieldBehavior(this.getFieldElement(x),v[x])}});var w=this._searchButton=this.getChildElement("SearchButton");if(w){w.onclick=null;d(w,"click",this._onSearchButtonClick$);(new CF.HoverCssClassBehavior(w)).initialize()}d(this.get_element(),"keypress",this._onKeyPress$);this.doStartupCheck();t.callBaseMethod(this,"initialize")},dispose:function(){if(this._searchButton){c(this._searchButton,"click",this._onSearchButtonClick$)}c(this.get_element(),"keypress",this._onKeyPress$);t.callBaseMethod(this,"dispose")},get_bookingEngineType:function(){var u=this._fieldBehaviors[l.BookingEngineType];return(u?u.get_value():this._bookingEngineType)},set_bookingEngineType:function(u){this._bookingEngineType=u},get_tripType:function(){var u=this._fieldBehaviors[l.TripType];return(u?u.get_value():this._tripType)},set_tripType:function(u){this._tripType=u},get_originRegion:function(){var u=this._fieldBehaviors[l.DepartureRegion];return u.get_value()},get_destinationRegion:function(){var u=this._fieldBehaviors[l.DestinationRegion];return u.get_value()},get_departureDateTime:function(){var u=this._fieldBehaviors[l.DepartureDateTime];return u.get_date()},get_returnDateTime:function(){var u=this._fieldBehaviors[l.ReturnDateTime];return u.get_date()},get_searchType:function(){var u=this._fieldBehaviors[l.SearchType];return u.get_value()},get_adults:function(){var u=this._fieldBehaviors[l.NumberOfAdults];return u.get_value()},get_children:function(){var u=this._fieldBehaviors[l.NumberOfChildren];return u?u.get_value():0},get_infants:function(){var u=this._fieldBehaviors[l.NumberOfInfants];return u?u.get_value():0},get_fieldRules:function(){if(!this._fieldRules){this._fieldRules=this.createFieldRules()}return this._fieldRules},get_postBackUrl:function(){return this._postBackUrl},set_postBackUrl:function(u){this._postBackUrl=u},get_defaultTripDays:function(){return this._defaultTripDays},set_defaultTripDays:function(u){this._defaultTripDays=u},get_targetPageTypeCode:function(){return this._targetPageTypeCode},set_targetPageTypeCode:function(u){this._targetPageTypeCode=u},get_errors:function(){var w=this.get_resources(),u=new p(w),v=this.createRuleTester();this.foreachField(function(z,x,y){if(y&&v(x)){if(x&&x.mandatory&&(y.get_hasValue?!y.get_hasValue():(y.get_value&&y.get_value()==null))){u.add(z)}if(y.validate){y.validate(z,u)}}});return u},get_value:function(){var u={};u[l.toString(l.BookingEngineType)]=this.get_bookingEngineType();this.foreachField(function(x,v,w){if(w&&(!w.get_visible||w.get_visible())&&w.get_value){u[l.toString(x)]=w.get_value()}});return u},get_fieldBehaviors:function(){if(!this._defaultFieldBehaviorsCreated){this.foreachFieldType(function(u){if(!this._fieldBehaviors[u]){this._fieldBehaviors[u]=this._createFieldBehavior(this.getFieldElement(u),null)}});this._defaultFieldBehaviorsCreated=true}return this._fieldBehaviors},get_searchButton:function(){return this._searchButton},getFieldElementId:function(u){return this.getChildElementId(l.toString(u))},getFieldElement:function(u){return document.getElementById(this.getFieldElementId(u))},foreachFieldType:function(v){for(var u=0;u<l.Count;u++){v.call(this,u)}},foreachField:function(u){var v=this.get_fieldRules(),w=this.get_fieldBehaviors();this.foreachFieldType(function(x){u.call(this,x,v[x],w[x])})},createBehaviorInfos:function(v){var u=[];u[l.BookingEngineType]={type:h,events:{propertyChanged:v}};u[l.TripType]={type:h,events:{propertyChanged:v}};u[l.TicketClass]={type:e,events:{propertyChanged:v}};u[l.DepartureRegion]={type:CF.RegionTextBoxBehavior,properties:{productType:"be",originsOnly:true}};u[l.DestinationRegion]={type:CF.RegionTextBoxBehavior,properties:{productType:"be",originsOnly:false}};u[l.DepartureDateTime]={type:a,properties:{defaultTripDays:this.get_defaultTripDays()},references:{returnDateTimeSelector:this.getFieldElementId(CF.BookingEngineFieldType.ReturnDateTime)+"$BookingEngineDateSelectorBehavior"},events:{propertyChanged:v}};u[l.ReturnDateTime]={type:a,events:{propertyChanged:v}};return u},createFieldRules:function(){var u=[],v=function(x,y,w){return{includeBookingEngineTypes:x,excludeBookingEngineTypes:y,mandatory:w}};u[l.TripType]=v([i.EconomyFlight,i.BusinessFlight,i.BusinessAndEconomyFlight]);u[l.TicketClass]=v([i.EconomyFlight,i.BusinessFlight,i.BusinessAndEconomyFlight]);u[l.DepartureRegion]=v(null,[i.Hotel,i.CarRental],true);u[l.DestinationRegion]=v(null,null,true);u[l.DepartureDateTime]=v(null,null,true);u[l.ReturnDateTime]={excludeTripTypes:[j.OneWay],mandatory:true};u[l.NumberOfAdults]=v(null,[i.CarRental]);u[l.NumberOfChildren]=v(null,[i.CarRental]);u[l.NumberOfInfants]=v(null,[i.CarRental]);u[l.NumberOfRooms]=v([i.Hotel,i.FlightHotel]);u[l.StarRating]=v([i.Hotel,i.FlightHotel]);u[l.DriverAge]=v([i.CarRental]);return u},validate:function(x){var w=this.get_errors();if(w){this.displayErrors(w)}var z=!w||w.get_errorCount()===0;if(z){var v=this.get_originRegion();if(v.RegionCode==""){var u=this.get_destinationRegion();var H=this.get_searchType();var D=(H==1)?1:this.get_tripType();var F,C,y;var y={origin:{Code:v.RegionCode,Text:v.Text},destination:{Code:u.RegionCode,Text:u.Text},adultsCount:this.get_adults(),childrenCount:this.get_children(),infantsCount:this.get_infants(),departingOn:null,returningOn:null,tripType:D};var G=jQuery.noConflict();if(H==1){F="/mvc/search/deals-ajax/";C={originRegionCode:v.RegionCode,originRegionText:v.Text,destinationRegionCode:u.RegionCode,destinationRegionText:u.Text}}else{F="/mvc/search/partners-ajax/";y.departingOn=this.get_departureDateTime();y.returningOn=this.get_returnDateTime();var B=y.departingOn?G.datepicker.formatDate("yy-mm-dd",y.departingOn):null;var E=y.returningOn?G.datepicker.formatDate("yy-mm-dd",y.returningOn):null;C={originRegionCode:v.RegionCode,originRegionText:v.Text,destinationRegionCode:u.RegionCode,destinationRegionText:u.Text,departureDate:B,returnDate:E}}G.ajax({type:"POST",url:F,dataType:"json",data:C,async:false,success:function(I){if(I.alternativeSiteLinks){z=false;var J=CF.Util.datepicker[CF.localeCode];G.datepicker.setDefaults(J);var L=I.alternativeSiteLinks[0];var K=new CF.SearchErrors();K.show(L,y)}}})}}if(z){if(typeof CF.Event=="object"){var A=this.get_value();CF.Event.Fire("bookingengine:validated",A)}}return z},displayErrors:function(u){this.highlightFieldsWithErrors(u)},highlightFieldsWithErrors:function(u){this.foreachField(function(y,v,x){if(x){var w=(x.get_container?x.get_container():x.get_element());(u&&u.hasError(y)?g.addCssClass:g.removeCssClass)(w,"cf-be-error")}})},onPrincipalFieldValueChanged:function(w){if(w==l.BookingEngineType||w==l.TripType){var v=this.get_bookingEngineType(),u=this.get_active();this.updateFieldVisibility();if(w==l.BookingEngineType){this.get_CssContainer().className=(u?this.get_activeClassName():this.get_inactiveClassName())+" cf-be-"+i.toString(v);this._updateLabelText(v)}}},doStartupCheck:function(){this.checkStartUpChange(this._bookingEngineType,l.BookingEngineType);this.checkStartUpChange(this._tripType,l.TripType)},checkStartUpChange:function(u,v){var w=this._fieldBehaviors[v];if(u!=null&&w&&w.get_value()!=u){this.onPrincipalFieldValueChanged(v)}},doSearch:function(u){},updateFieldVisibility:function(){var u=this.createRuleTester();this.foreachField(function(x,v,w){if(w){this.setFieldVisibilty(x,w,u(v))}})},createRuleTester:function(){var x=this.get_bookingEngineType(),v=function(y,z,A){return(z?k.Array.contains(z,y):true)&&(A?!k.Array.contains(A,y):true)},w=function(y,z,A){return y?v(z,y.includeBookingEngineTypes,y.excludeBookingEngineTypes)&&(A==null||v(A,y.includeTripTypes,y.excludeTripTypes)):true},u=w(this.get_fieldRules()[l.TripType],x)?this.get_tripType():null;return function(y){return w(y,x,u)}},setFieldVisibilty:function(w,v,u){if(v.set_visible){v.set_visible(u)}},_updateLabelText:function(w){var x=i.toString(w),v=this.get_resources(),u="LabelText";this.foreachField(function(C,z,B){if(B&&B.set_labelText){var A=l.toString(C),y=v[A+x+u]||v[A+u];if(y){B.set_labelText(y)}}})},_createFieldBehavior:function(u,v){if(u){return v?n(v.type,v.properties,v.events,v.references,u):n(e,null,null,null,u)}return null},_onPrincipalFieldPropertyChanged:function(v,w){if(w.get_propertyName()=="value"){var u;this.foreachField(function(z,x,y){if(y==v){u=z}});this.onPrincipalFieldValueChanged(u)}},_onSearchButtonClick:function(u){if(!(this.validate(true)&&!this.doSearch(this.get_value()))){u.preventDefault()}},_onKeyPress:function(u){if(this._searchButton&&u.charCode==s.UI.Key.enter&&u.target.tagName=="INPUT"){this._onSearchButtonClick(u)}}};r(t,"CF.BookingEngineStepOneBehaviorBase",f);var e=CF.BookingEngineDropDownFieldBehavior=function(u){e.initializeBase(this,[u]);this._formElementChanged$=null;this._formElements=null};e.prototype={initialize:function(){e.callBaseMethod(this,"initialize")},dispose:function(){if(this._formElementChanged$){this._addOrRemoveFormElementChangedEvent(false)}e.callBaseMethod(this,"dispose")},get_container:function(){return this.get_element()},get_value:function(){var x=this.get_formElements(),u=null,v,w;if(x&&x.length>0){v=x[0];if(v.selectedIndex>=0&&v.options.length>0){w=v.options[v.selectedIndex];u=parseInt(w.value||w.text,10)}}return u},get_tagName:function(){return"select"},get_changeEvent:function(){return"change"},get_formElements:function(){if(!this._formElements){this._formElements=this.get_container().getElementsByTagName(this.get_tagName())}return this._formElements},add_propertyChanged:function(u){if(!this._elementFormChanged$){this._elementFormChanged$=o(this,this._formElementChanged);this._addOrRemoveFormElementChangedEvent(true)}e.callBaseMethod(this,"add_propertyChanged",[u])},foreachFormElement:function(w){var u=this.get_formElements(),v;if(u){for(v=0;v<u.length;v++){w.call(this,u[v])}}},_addOrRemoveFormElementChangedEvent:function(u){this.foreachFormElement(function(v){(u?d:c)(v,this.get_changeEvent(),this._elementFormChanged$)})},_formElementChanged:function(u){if(u.target.id.indexOf("BookingEngineType_list")>0){trackUnicaEvent("BEProductCategory")}this.raisePropertyChanged("value")}};r(e,"CF.BookingEngineDropDownFieldBehavior",CF.StandardBehavior);var h=CF.BookingEngineRadioButtonListFieldBehavior=function(u){h.initializeBase(this,[u])};h.prototype={initialize:function(){h.callBaseMethod(this,"initialize")},dispose:function(){h.callBaseMethod(this,"dispose")},get_value:function(){var u=null;this.foreachFormElement(function(v){if(v.checked){u=parseInt(v.value,10)}});return u},get_tagName:function(){return"input"},get_changeEvent:function(){return"click"}};r(h,"CF.BookingEngineRadioButtonListFieldBehavior",e);var a=CF.BookingEngineDateSelectorBehavior=function(u){a.initializeBase(this,[u]);this._dateBehavior=null;this._dateTimePropertyChanged$=o(this,this._dateTimePropertyChanged);this._returnDateTimeSelector=null;this._defaultTripDays=null};a.prototype={initialize:function(){this._ensureDateBehavior();this._syncReturnDateTimeSelector(true);a.callBaseMethod(this,"initialize")},dispose:function(){a.callBaseMethod(this,"dispose")},get_container:function(){return this.get_element()},get_labelText:function(){return this._getDateBehavior().get_labelText()},set_labelText:function(u){this._getDateBehavior().set_labelText(u)},get_date:function(){return this._getDateBehavior().get_value()},set_date:function(u){this._getDateBehavior().set_value(u)},get_value:function(){var u=this.get_date();return{DateTime:u,TimeType:m.Anytime,TimezoneOffset:(u?u.getTimezoneOffset():0)}},set_value:function(u){if(u){this.set_date(u.DateTime)}},set_minDate:function(u){this._getDateBehavior().set_minValue(u)},get_returnDateTimeSelector:function(){return this._returnDateTimeSelector},set_returnDateTimeSelector:function(u){this._returnDateTimeSelector=u},get_defaultTripDays:function(){return this._defaultTripDays},set_defaultTripDays:function(u){this._defaultTripDays=u},get_hasValue:function(){return this.get_date()!=null},_getDateBehavior:function(){this._ensureDateBehavior();return this._dateBehavior},validate:function(y,v){var u=this.get_date(),w=this.get_returnDateTimeSelector();if(u){if(u<this._makeDay(new Date())){v.add(y,v.get_resources().ErrorMessagePastDate)}else{if(w&&w.get_visible()){var x=w.get_date();if(x&&u.setHours(0)>x.setHours(23)){v.add(y);v.add(l.ReturnDateTime,v.get_resources().ErrorMessageDateSequence)}}}}},_dateTimePropertyChanged:function(v,u){if(u.get_propertyName()=="value"){this._syncReturnDateTimeSelector(false);this.raisePropertyChanged("value")}},_syncReturnDateTimeSelector:function(x){var w=this.get_returnDateTimeSelector();if(w){var u=this.get_date(),v=this._makeDay(new Date());if(u){w.set_minDate(u>v?u:v)}}},_ensureDateBehavior:function(){if(!this._dateBehavior){var u=this._dateBehavior=new CF.DateTextBoxBehavior(this.get_element().getElementsByTagName("input")[0]);u.initialize();u.add_propertyChanged(this._dateTimePropertyChanged$)}},_makeDay:function(u,v){return new Date(u.getFullYear(),u.getMonth(),u.getDate()+(v||0))}};r(a,"CF.BookingEngineDateSelectorBehavior",CF.StandardBehavior);var p=CF.BookingEngineFieldErrors=function(u){this._messages=[];this._errorCount=0;this._linkedFields=[];this._resources=u;this._linkedFields[l.DestinationRegion]=l.DepartureRegion;this._linkedFields[l.ReturnDateTime]=l.DepartureDateTime};p.prototype={add:function(x,z){var w=this._resources,v=this._linkedFields[x],u="ErrorMessage",y=l.toString(x);if(v&&this.hasError(v)){this._messages[v]=z||w[u+l.toString(v)+y];this._messages[x]=""}else{this._messages[x]=z||w[u+y]}this._errorCount++},get_errorCount:function(){return this._errorCount},get_resources:function(){return this._resources},hasError:function(u){return typeof this._messages[u]=="string"},getMessage:function(u){return this._messages[u]},getMessages:function(){return this._messages}};var q=CF.ResourceCombiner=function(){};q.prototype={add:function(v){for(var u in v){if(typeof v[u]=="string"){this[u]=v[u]}}}}}).apply(window,typeof CF=="object"&&CF.Sys?[CF,CF.Type.registerClass,CF.Type.registerEnum]:[window,function(b,c,a){b.registerClass(c,a)},function(b,c,a){b.registerEnum(c,a||false)}]);CF.BookingEngineCoreResources={DestinationRegionHotelLabelText:"Staying in",ReturnDateTimeLabelText:"Return",DepartureDateTimeCarRentalLabelText:"Pick up",HourlyMidnight:"12:00 Midnight",DepartureDateTimeLabelText:"Depart",DestinationRegionLabelText:"To",HourlyMidday:"12:00 Midday",TimeTypeEvening:"Evening",DestinationRegionCarRentalLabelText:"Pick up from",TimeTypeAfternoon:"Afternoon",DepartureRegionLabelText:"From",DriverAgeLabelText:"Driver\u0027s age",ReturnDateTimeCarRentalLabelText:"Drop off",DepartureDateTimeHotelLabelText:"Check in",TimeTypeMorning:"Morning",TimeTypeAnytime:"Anytime",ReturnDateTimeHotelLabelText:"Check out"};