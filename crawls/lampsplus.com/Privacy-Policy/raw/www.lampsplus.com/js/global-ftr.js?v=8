//Customer Service only. Sergey - found that there is a dependecy even if it is not a customer service on arrSkus
// ** StockCheck ** //
// OBJECTIVE: Opens stock check window for customer service
function StockCheck(SKU) { var StockCheckWindow = null; StockCheckWindow = window.open("http://Host/cgi/ONHAND20?ShortSKU=" + SKU + "", "StockCheck", "toolbar=0,location=0,directories=0,status=0,menubar=0,scrollbars=1,resizable=0,width=1015,height=743,left=0,top=0") };

//json2.js - used for parsing through json - utilized by portfolio and cart counts
if (!this.JSON) {
    this.JSON = {};
}(function () {
    function f(n) {
        return n < 10 ? '0' + n : n;
    }
    if (typeof Date.prototype.toJSON !== 'function') {
        Date.prototype.toJSON = function (key) {
            return isFinite(this.valueOf()) ? this.getUTCFullYear() + '-' + f(this.getUTCMonth() + 1) + '-' + f(this.getUTCDate()) + 'T' + f(this.getUTCHours()) + ':' + f(this.getUTCMinutes()) + ':' + f(this.getUTCSeconds()) + 'Z' : null;
        };
        String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function (key) {
            return this.valueOf();
        };
    }
    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
        gap, indent, meta = {
            '\b': '\\b',
            '\t': '\\t',
            '\n': '\\n',
            '\f': '\\f',
            '\r': '\\r',
            '"': '\\"',
            '\\': '\\\\'
        },
        rep;
    function quote(string) {
        escapable.lastIndex = 0;
        return escapable.test(string) ? '"' + string.replace(escapable, function (a) {
            var c = meta[a];
            return typeof c === 'string' ? c : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
        }) + '"' : '"' + string + '"';
    }
    function str(key, holder) {
        var i, k, v, length, mind = gap,
            partial, value = holder[key];
        if (value && typeof value === 'object' && typeof value.toJSON === 'function') {
            value = value.toJSON(key);
        }
        if (typeof rep === 'function') {
            value = rep.call(holder, key, value);
        }
        switch (typeof value) {
        case 'string':
            return quote(value);
        case 'number':
            return isFinite(value) ? String(value) : 'null';
        case 'boolean':
        case 'null':
            return String(value);
        case 'object':
            if (!value) {
                return 'null';
            }
            gap += indent;
            partial = [];
            if (Object.prototype.toString.apply(value) === '[object Array]') {
                length = value.length;
                for (i = 0; i < length; i += 1) {
                    partial[i] = str(i, value) || 'null';
                }
                v = partial.length === 0 ? '[]' : gap ? '[\n' + gap + partial.join(',\n' + gap) + '\n' + mind + ']' : '[' + partial.join(',') + ']';
                gap = mind;
                return v;
            }
            if (rep && typeof rep === 'object') {
                length = rep.length;
                for (i = 0; i < length; i += 1) {
                    k = rep[i];
                    if (typeof k === 'string') {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            } else {
                for (k in value) {
                    if (Object.hasOwnProperty.call(value, k)) {
                        v = str(k, value);
                        if (v) {
                            partial.push(quote(k) + (gap ? ': ' : ':') + v);
                        }
                    }
                }
            }
            v = partial.length === 0 ? '{}' : gap ? '{\n' + gap + partial.join(',\n' + gap) + '\n' + mind + '}' : '{' + partial.join(',') + '}';
            gap = mind;
            return v;
        }
    }
    if (typeof JSON.stringify !== 'function') {
        JSON.stringify = function (value, replacer, space) {
            var i;
            gap = '';
            indent = '';
            if (typeof space === 'number') {
                for (i = 0; i < space; i += 1) {
                    indent += ' ';
                }
            } else if (typeof space === 'string') {
                indent = space;
            }
            rep = replacer;
            if (replacer && typeof replacer !== 'function' && (typeof replacer !== 'object' || typeof replacer.length !== 'number')) {
                throw new Error('JSON.stringify');
            }
            return str('', {
                '': value
            });
        };
    }
    if (typeof JSON.parse !== 'function') {
        JSON.parse = function (text, reviver) {
            var j;
            function walk(holder, key) {
                var k, v, value = holder[key];
                if (value && typeof value === 'object') {
                    for (k in value) {
                        if (Object.hasOwnProperty.call(value, k)) {
                            v = walk(value, k);
                            if (v !== undefined) {
                                value[k] = v;
                            } else {
                                delete value[k];
                            }
                        }
                    }
                }
                return reviver.call(holder, key, value);
            }
            cx.lastIndex = 0;
            if (cx.test(text)) {
                text = text.replace(cx, function (a) {
                    return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
                });
            }
            if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {
                j = eval('(' + text + ')');
                return typeof reviver === 'function' ? walk({
                    '': j
                }, '') : j;
            }
            throw new SyntaxError('JSON.parse');
        };
    }
}());
//end json2.js

//counts - gets portfolio and cart counts to display in header
var Portfolio;
var PortfolioCount = 0;
var PortfolioItemCount = 0;
var Cart;
var CartCount = 0;
var strBaseURL = "";

function cartHasItems() {
    if (parseInt($("#spnCartCount").text()) > 0) {
        $("#yourCart, #cartIcon").addClass("cartHasItems");
    }
}

function portfolioHasItems() {
    if (parseInt($("#portfolioItemCount").text()) > 0)
        $("#yourPortfolio").addClass("portfolioHasItems");
    else
        $("#yourPortfolio").removeClass("portfolioHasItems");
}

function GetPortfolioItemCount() {
    $.ajax({
        type: "GET",
        url: "/Portfolio/json/PortfolioItemCount.aspx",
        data: { ms: new Date().getTime() },
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (msg) {
            ShowPortfolioItemCount(msg.portfolioCount);
            PortfolioItemCount = parseInt(msg.portfolioCount);
        }
    });
}

function GetPortfolioCount() {
    $.get("/Portfolio/json/CurrentPortfolioJson.aspx?ms=" + new Date().getTime(), function (data) {
        if (data != '' && data !== null) {
            try {
                Portfolio = JSON.parse(data);
                ShowPortfolioCount(Portfolio);
            } catch (Error) { }
        }
    });
}

function GetCartCount() {
    $.get("/Orders/json/CartQuantitiesJson.aspx?ms=" + new Date().getTime(), function (data) {
        if (data != '' && data !== null) {
            try {
                Cart = JSON.parse(data);
                ShowCartCount(Cart);
            } catch (Error) {}
        }
    });
}
function ShowPortfolioCount(Portfolio)
{
    var PortfolioCountDisplay = document.getElementById("portfolioItemCount");

    if(PortfolioCountDisplay !== null && Portfolio !== null)
    {
        var iTotalQuantity = 0;

        for(var i = 0; i < Portfolio.Items.length; i++)
        {
            iTotalQuantity += parseInt(Portfolio.Items[i].Quantity);
        }

        if(PortfolioCountDisplay.childNodes.length > 0)
            PortfolioCountDisplay.removeChild(PortfolioCountDisplay.childNodes[0]);

        var tnPortfolioCount = document.createTextNode(iTotalQuantity);
        PortfolioCountDisplay.appendChild(tnPortfolioCount);

        //Apply active class to portfolio text if item(s) exist
        portfolioHasItems();
    }
}

function ShowPortfolioItemCount(count) {
    var PortfolioCountDisplay = document.getElementById("portfolioItemCount");
    if(PortfolioCountDisplay!=null)
    {
        if (count > 0) {
            if (PortfolioCountDisplay.childNodes.length > 0)
                PortfolioCountDisplay.removeChild(PortfolioCountDisplay.childNodes[0]);

            var tnPortfolioCount = document.createTextNode(count);
            PortfolioCountDisplay.appendChild(tnPortfolioCount);

            //Apply active class to portfolio text if item(s) exist
            portfolioHasItems();
        }
        else { PortfolioCountDisplay.innerHTML = '0'; }
    }

}

function ShowCartCount(Cart) {
    var CartCountDisplay = document.getElementById("spnCartCount");
    if (CartCountDisplay !== null && Cart !== null) {
        if (Cart.Items.length > 0) {
            CartCount = Cart.TotalItems;
            if (CartCountDisplay.childNodes.length > 0) {
                CartCountDisplay.removeChild(CartCountDisplay.childNodes[0]);
            }
            var tnCartCount = document.createTextNode(CartCount);
            CartCountDisplay.appendChild(tnCartCount);

            //Apply active class to cart text if item(s) exist
            cartHasItems();
        }
        else { CartCountDisplay.innerHTML = '0'; }
    }
}

function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

GetPortfolioItemCount();

/*
 * jQuery Tools 1.2.7
 * [tabs, tooltip, scrollable]
 */
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};function b(a,b){var c=parseInt(a.css(b),10);if(c)return c;var d=a[0].currentStyle;return d&&d.width&&parseInt(d.width,10)}function c(b,c){var d=a(c);return d.length<2?d:b.parent().find(c)}var d;function e(b,e){var f=this,g=b.add(f),h=b.children(),i=0,j=e.vertical;d||(d=f),h.length>1&&(h=a(e.items,b)),e.size>1&&(e.circular=!1),a.extend(f,{getConf:function(){return e},getIndex:function(){return i},getSize:function(){return f.getItems().size()},getNaviButtons:function(){return n.add(o)},getRoot:function(){return b},getItemWrap:function(){return h},getItems:function(){return h.find(e.item).not("."+e.clonedClass)},move:function(a,b){return f.seekTo(i+a,b)},next:function(a){return f.move(e.size,a)},prev:function(a){return f.move(-e.size,a)},begin:function(a){return f.seekTo(0,a)},end:function(a){return f.seekTo(f.getSize()-1,a)},focus:function(){d=f;return f},addItem:function(b){b=a(b),e.circular?(h.children().last().before(b),h.children().first().replaceWith(b.clone().addClass(e.clonedClass))):(h.append(b),o.removeClass("disabled")),g.trigger("onAddItem",[b]);return f},seekTo:function(b,c,k){b.jquery||(b*=1);if(e.circular&&b===0&&i==-1&&c!==0)return f;if(!e.circular&&b<0||b>f.getSize()||b<-1)return f;var l=b;b.jquery?b=f.getItems().index(b):l=f.getItems().eq(b);var m=a.Event("onBeforeSeek");if(!k){g.trigger(m,[b,c]);if(m.isDefaultPrevented()||!l.length)return f}var n=j?{top:-l.position().top}:{left:-l.position().left};i=b,d=f,c===undefined&&(c=e.speed),h.animate(n,c,e.easing,k||function(){g.trigger("onSeek",[b])});return f}}),a.each(["onBeforeSeek","onSeek","onAddItem"],function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}});if(e.circular){var k=f.getItems().slice(-1).clone().prependTo(h),l=f.getItems().eq(1).clone().appendTo(h);k.add(l).addClass(e.clonedClass),f.onBeforeSeek(function(a,b,c){if(!a.isDefaultPrevented()){if(b==-1){f.seekTo(k,c,function(){f.end(0)});return a.preventDefault()}b==f.getSize()&&f.seekTo(l,c,function(){f.begin(0)})}});var m=b.parents().add(b).filter(function(){if(a(this).css("display")==="none")return!0});m.length?(m.show(),f.seekTo(0,0,function(){}),m.hide()):f.seekTo(0,0,function(){})}var n=c(b,e.prev).click(function(a){a.stopPropagation(),f.prev()}),o=c(b,e.next).click(function(a){a.stopPropagation(),f.next()});e.circular||(f.onBeforeSeek(function(a,b){setTimeout(function(){a.isDefaultPrevented()||(n.toggleClass(e.disabledClass,b<=0),o.toggleClass(e.disabledClass,b>=f.getSize()-1))},1)}),e.initialIndex||n.addClass(e.disabledClass)),f.getSize()<2&&n.add(o).addClass(e.disabledClass),e.mousewheel&&a.fn.mousewheel&&b.mousewheel(function(a,b){if(e.mousewheel){f.move(b<0?1:-1,e.wheelSpeed||50);return!1}});if(e.touch){var p={};h[0].ontouchstart=function(a){var b=a.touches[0];p.x=b.clientX,p.y=b.clientY},h[0].ontouchmove=function(a){if(a.touches.length==1&&!h.is(":animated")){var b=a.touches[0],c=p.x-b.clientX,d=p.y-b.clientY;f[j&&d>0||!j&&c>0?"next":"prev"](),a.preventDefault()}}}e.keyboard&&a(document).on("keydown.scrollable",function(b){if(!(!e.keyboard||b.altKey||b.ctrlKey||b.metaKey||a(b.target).is(":input"))){if(e.keyboard!="static"&&d!=f)return;var c=b.keyCode;if(j&&(c==38||c==40)){f.move(c==38?-1:1);return b.preventDefault()}if(!j&&(c==37||c==39)){f.move(c==37?-1:1);return b.preventDefault()}}}),e.initialIndex&&f.seekTo(e.initialIndex,0,function(){})}a.fn.scrollable=function(b){var c=this.data("scrollable");if(c)return c;b=a.extend({},a.tools.scrollable.conf,b),this.each(function(){c=new e(a(this),b),a(this).data("scrollable",c)});return b.api?c:this}})(jQuery);
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialEffect:!1,initialIndex:0,event:"click",rotate:!1,slideUpSpeed:400,slideDownSpeed:400,history:!1},addEffect:function(a,c){b[a]=c}};var b={"default":function(a,b){this.getPanes().hide().eq(a).show(),b.call()},fade:function(a,b){var c=this.getConf(),d=c.fadeOutSpeed,e=this.getPanes();d?e.fadeOut(d):e.hide(),e.eq(a).fadeIn(c.fadeInSpeed,b)},slide:function(a,b){var c=this.getConf();this.getPanes().slideUp(c.slideUpSpeed),this.getPanes().eq(a).slideDown(c.slideDownSpeed,b)},ajax:function(a,b){this.getPanes().eq(0).load(this.getTabs().eq(a).attr("href"),b)}},c,d;a.tools.tabs.addEffect("horizontal",function(b,e){if(!c){var f=this.getPanes().eq(b),g=this.getCurrentPane();d||(d=this.getPanes().eq(0).width()),c=!0,f.show(),g.animate({width:0},{step:function(a){f.css("width",d-a)},complete:function(){a(this).hide(),e.call(),c=!1}}),g.length||(e.call(),c=!1)}});function e(c,d,e){var f=this,g=c.add(this),h=c.find(e.tabs),i=d.jquery?d:c.children(d),j;h.length||(h=c.children()),i.length||(i=c.parent().find(d)),i.length||(i=a(d)),a.extend(this,{click:function(d,i){var k=h.eq(d),l=!c.data("tabs");typeof d=="string"&&d.replace("#","")&&(k=h.filter("[href*=\""+d.replace("#","")+"\"]"),d=Math.max(h.index(k),0));if(e.rotate){var m=h.length-1;if(d<0)return f.click(m,i);if(d>m)return f.click(0,i)}if(!k.length){if(j>=0)return f;d=e.initialIndex,k=h.eq(d)}if(d===j)return f;i=i||a.Event(),i.type="onBeforeClick",g.trigger(i,[d]);if(!i.isDefaultPrevented()){var n=l?e.initialEffect&&e.effect||"default":e.effect;b[n].call(f,d,function(){j=d,i.type="onClick",g.trigger(i,[d])}),h.removeClass(e.current),k.addClass(e.current);return f}},getConf:function(){return e},getTabs:function(){return h},getPanes:function(){return i},getCurrentPane:function(){return i.eq(j)},getCurrentTab:function(){return h.eq(j)},getIndex:function(){return j},next:function(){return f.click(j+1)},prev:function(){return f.click(j-1)},destroy:function(){h.off(e.event).removeClass(e.current),i.find("a[href^=\"#\"]").off("click.T");return f}}),a.each("onBeforeClick,onClick".split(","),function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}}),e.history&&a.fn.history&&(a.tools.history.init(h),e.event="history"),h.each(function(b){a(this).on(e.event,function(a){f.click(b,a);return a.preventDefault()})}),i.find("a[href^=\"#\"]").on("click.T",function(b){f.click(a(this).attr("href"),b)}),location.hash&&e.tabs=="a"&&c.find("[href=\""+location.hash+"\"]").length?f.click(location.hash):(e.initialIndex===0||e.initialIndex>0)&&f.click(e.initialIndex)}a.fn.tabs=function(b,c){var d=this.data("tabs");d&&(d.destroy(),this.removeData("tabs")),a.isFunction(c)&&(c={onBeforeClick:c}),c=a.extend({},a.tools.tabs.conf,c),this.each(function(){d=new e(a(this),b,c),a(this).data("tabs",d)});return c.api?d:this}})(jQuery);
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(a,c,d){b[a]=[c,d]}};var b={toggle:[function(a){var b=this.getConf(),c=this.getTip(),d=b.opacity;d<1&&c.css({opacity:d}),c.show(),a.call()},function(a){this.getTip().hide(),a.call()}],fade:[function(b){var c=this.getConf();!a.browser.msie||c.fadeIE?this.getTip().fadeTo(c.fadeInSpeed,c.opacity,b):(this.getTip().show(),b())},function(b){var c=this.getConf();!a.browser.msie||c.fadeIE?this.getTip().fadeOut(c.fadeOutSpeed,b):(this.getTip().hide(),b())}]};function c(b,c,d){var e=d.relative?b.position().top:b.offset().top,f=d.relative?b.position().left:b.offset().left,g=d.position[0];e-=c.outerHeight()-d.offset[0],f+=b.outerWidth()+d.offset[1],/iPad/i.test(navigator.userAgent)&&(e-=a(window).scrollTop());var h=c.outerHeight()+b.outerHeight();g=="center"&&(e+=h/2),g=="bottom"&&(e+=h),g=d.position[1];var i=c.outerWidth()+b.outerWidth();g=="center"&&(f-=i/2),g=="left"&&(f-=i);return{top:e,left:f}}function d(d,e){var f=this,g=d.add(f),h,i=0,j=0,k=d.attr("title"),l=d.attr("data-tooltip"),m=b[e.effect],n,o=d.is(":input"),p=o&&d.is(":checkbox, :radio, select, :button, :submit"),q=d.attr("type"),r=e.events[q]||e.events[o?p?"widget":"input":"def"];if(!m)throw"Nonexistent effect \""+e.effect+"\"";r=r.split(/,\s*/);if(r.length!=2)throw"Tooltip: bad events configuration for "+q;d.on(r[0],function(a){clearTimeout(i),e.predelay?j=setTimeout(function(){f.show(a)},e.predelay):f.show(a)}).on(r[1],function(a){clearTimeout(j),e.delay?i=setTimeout(function(){f.hide(a)},e.delay):f.hide(a)}),k&&e.cancelDefault&&(d.removeAttr("title"),d.data("title",k)),a.extend(f,{show:function(b){if(!h){l?h=a(l):e.tip?h=a(e.tip).eq(0):k?h=a(e.layout).addClass(e.tipClass).appendTo(document.body).hide().append(k):(h=d.next(),h.length||(h=d.parent().next()));if(!h.length)throw"Cannot find tooltip for "+d}if(f.isShown())return f;h.stop(!0,!0);var o=c(d,h,e);e.tip&&h.html(d.data("title")),b=a.Event(),b.type="onBeforeShow",g.trigger(b,[o]);if(b.isDefaultPrevented())return f;o=c(d,h,e),h.css({position:"absolute",top:o.top,left:o.left}),n=!0,m[0].call(f,function(){b.type="onShow",n="full",g.trigger(b)});var p=e.events.tooltip.split(/,\s*/);h.data("__set")||(h.off(p[0]).on(p[0],function(){clearTimeout(i),clearTimeout(j)}),p[1]&&!d.is("input:not(:checkbox, :radio), textarea")&&h.off(p[1]).on(p[1],function(a){a.relatedTarget!=d[0]&&d.trigger(r[1].split(" ")[0])}),e.tip||h.data("__set",!0));return f},hide:function(c){if(!h||!f.isShown())return f;c=a.Event(),c.type="onBeforeHide",g.trigger(c);if(!c.isDefaultPrevented()){n=!1,b[e.effect][1].call(f,function(){c.type="onHide",g.trigger(c)});return f}},isShown:function(a){return a?n=="full":n},getConf:function(){return e},getTip:function(){return h},getTrigger:function(){return d}}),a.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}})}a.fn.tooltip=function(b){var c=this.data("tooltip");if(c)return c;b=a.extend(!0,{},a.tools.tooltip.conf,b),typeof b.position=="string"&&(b.position=b.position.split(/,?\s/)),this.each(function(){c=new d(a(this),b),a(this).data("tooltip",c)});return b.api?c:this}})(jQuery);

//lp modal plugin
(function($){
    $.fn.lpModal = function(options) {

        //default options
        var defaults = {
            onInit: false,              //should modal open when code is initialized?
            fullScreen: false,          //should we fill the whole screen?
            width: 560,                 //width of modal popup
            height: 470,                //height for modal popup
            content: $("#content"),     //html element that contains content on page
            bgColor: "#fff",            //background color of modal
            src: "",                    //url source of iframe to be embedded
            openEvt: function(){},      //function to be run when modal opens
            closeEvt: function(){}      //function to be ran after close has been run
        }

        //combine defaults and passed in options
        var o = $.extend(defaults, options);

        this.each(function() {

            function initiateModal(){

                var modalTemplate = "<div id='lpModal'><a href='#' id='lpModalClose'></a><div id='lpModalContent'></div></div><div id='lpModalBackdrop'></div>";

                //if we're using content on the page
                if(o.src.length == 0){
                    //if there is a form tag on the page
                    if($('form').length > 0){
                        //append template to form
                        $('form').append(modalTemplate);
                    //if there is no form on the page
                    } else {
                        //append template to body
                        $('body').append(modalTemplate);
                    }
                //if we're using an iframe
                } else {
                    //append template to body
                    $('body').append(modalTemplate);
                }

                //cache selectors used
                var modal            = $("#lpModal"),
                    modalContent     = $("#lpModalContent"),
                    closeBtn         = $("#lpModalClose"),
                    backdrop         = $("#lpModalBackdrop"),
                    htmlBody         = $("html, body"),
                    modalOuterWidth  = Math.floor(modal.outerWidth(true)),
                    modalOuterHeight = Math.floor(modal.outerHeight(true)),
                    windowWidth      = Math.floor($(window).width()),
                    windowHeight     = Math.floor($(window).height());

                //if modal is not fullscreen
                if(!o.fullScreen){

                    //check if width and height are larger than window
                    //if width is more than window width
                    if(o.width+modalOuterWidth > windowWidth){
                        //change width to fit window
                        o.width = windowWidth-modalOuterWidth;
                    }
                    //if height is more than window height
                    if(o.height+modalOuterHeight > windowHeight){
                        //change height to fit window
                        o.height = windowHeight-modalOuterHeight;
                        //add 25 to accomodate vertical scrollbar
                        o.width += 25;
                    }

                //if modal is supposed to be fullscreen
                } else {
                    o.width = windowWidth-modalOuterWidth;
                    o.height = windowHeight-modalOuterHeight;
                }

                //if modal is using on page content
                if(o.src.length == 0){
                    var a = o.content.clone().empty();
                    modalContent.append(a).children().append(o.content.html()).show();

                //if modal is embedding an iframe
                } else {
                    $("<iframe width='100%' height='100%' src='"+o.src+"' scrolling='auto' horizontalscrolling='no' verticalscrolling='no' frameborder='0'></iframe>").appendTo(modalContent);
                }

                //set width, height, and background color values for #lpModal
                modal.css({
                    "width": o.width+"px",
                    "height": o.height+"px",
                    "background-color": o.bgColor
                });

                //calculate and set offset margin values for #lpModal
                var offsetX = modal.outerWidth() / 2,
                    offsetY = modal.outerHeight() / 2;
                modal.css({
                    "margin": "-"+offsetY+"px 0 0 -"+offsetX+"px"
                });

                //set height value for #lpModalContent
                modalContent.css({"height": o.height+"px"});

                //hide scrollbar
                htmlBody.css("overflow", "hidden");

                //fade in backdrop and modal popup
                backdrop.fadeTo(500, 0.6, function(){
                    modal.fadeIn(700, function(){
                        //ugly bug in ie8 requires any iframe with flash in it to be reloaded after fading in
                        if($('body').hasClass('ie8') || $('html').hasClass('ie8')){
                            var refreshSrc = modalContent.children('iframe').attr('src');
                            modalContent.children('iframe').attr('src', refreshSrc);
                        }
                    });
                });

                //run openEvt function if there is one
                o.openEvt();

                //close modal functionality
                function closeModal(){

                    //fade out backdrop and modal popup
                    modal.fadeOut(300, function(){
                        backdrop.fadeOut(200, function(){
                            //remove overlay hidden from body
                            htmlBody.css("overflow", "auto");
                        });
                    });

                    //using setTimeout so div removal happens AFTER popup fades out
                    setTimeout(function() {
                        modal.remove();
                        backdrop.remove();
                        o.closeEvt();
                    }, 500);

                }

                //close button and backdrop click
                var closeSelectors = [closeBtn.selector,backdrop.selector].join(", ");
                $(closeSelectors).on("click", function(){
                    closeModal();
                    return false;
                });

                //escape key press
                $(document).keyup(function(e) {
                    if (e.keyCode == 27) { closeModal(); }
                });

            }

            //if modal should open on code run
            if(o.onInit){
                initiateModal();

            //if not then make it run on click
            } else {
                $(this).click(function(){
                    initiateModal();
                    return false;
                });
            }

        });

    };

    //close function available to outside world
    $.fn.lpModalClose = function(closeOptions){

        var closeDefaults = {
            onInit: true    //should close happen when called?
        }

        //combine defaults and passed in options
        var cO = $.extend(closeDefaults, closeOptions);

        //if onInit is true run closeModal now
        if(cO.onInit){
            $("#lpModalClose").click();

        //else tie click event to element passed in
        } else {
            $(this).click(function(){
                $("#lpModalClose").click();
                return false;
            })
        }

    }
})(jQuery);

//jQuery plugin for retrieving url parameters and values
$.extend({
    getUrlVars: function(){
        var vars = [], hash;
        var url = window.location.href;
        url = decodeURIComponent(url.replace(/\+/g,  " "));
        var hashes = url.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++){
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
        }
        return vars;
    },
    getUrlVar: function(name){
        return $.getUrlVars()[name];
    }
});

//jQuery Templates Plugin 1.0.0pre http://github.com/jquery/jquery-tmpl
(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},i=0,c=0,l=[];function g(g,d,h,e){var c={data:e||(e===0||e===false)?e:d?d.data:{},_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};g&&a.extend(c,g,{nodes:[],parent:d});if(h){c.tmpl=h;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++i;(l.length?f:b)[i]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a(i[h])[d](k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,m,k){if(d[0]&&a.isArray(d[0])){var g=a.makeArray(arguments),h=d[0],j=h.length,i=0,f;while(i<j&&!(f=a.data(h[i++],"tmplItem")));if(f&&c)g[2]=function(b){a.tmpl.afterManip(this,b,k)};r.apply(this,g)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var i,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(j(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h==="function")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);i=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(j(c,null,i)):i},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b==="string")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function j(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:j(a,e,a._ctnt)}):e;if(g)return c;c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=k(c).concat(b);if(d)b=b.concat(k(d))});return b?b:k(c)}function k(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,k,g,b,c,d){var j=a.tmpl.tag[k],i,e,f;if(!j)throw"Unknown template tag: "+k;i=j._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=h(b);d=d?","+h(d)+")":c?")":"";e=c?b.indexOf(".")>-1?b+h(c):"("+b+").call($item"+d:b;f=c?e:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else f=e=i.$1||"null";g=h(g);return"');"+j[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(f).split("$1").join(e).split("$2").join(g||i.$2||"")+"__.push('"})+"');}return __;")}function n(c,b){c._wrap=j(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function h(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,h;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName("*");for(h=j.length-1;h>=0;h--)m(j[h]);m(k)}function m(j){var p,h=j,k,e,m;if(m=j.getAttribute(d)){while(h.parentNode&&(h=h.parentNode).nodeType===1&&!(p=h.getAttribute(d)));if(p!==m){h=h.parentNode?h.nodeType===11?0:h.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[h]||f[h]);e.key=++i;b[i]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;h=a.data(j.parentNode,"tmplItem");h=h?h.key:0}if(e){k=e;while(k&&k.key!=h){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);

//jQuery Nivo Slider v2.6
(function(a){var b=function(b,c){var d=a.extend({},a.fn.nivoSlider.defaults,c);var e={currentSlide:0,currentImage:"",totalSlides:0,randAnim:"",running:false,paused:false,stop:false};var f=a(b);f.data("nivo:vars",e);f.css("position","relative");f.addClass("nivoSlider");var g=f.children();g.each(function(){var b=a(this);var c="";if(!b.is("img")){if(b.is("a")){b.addClass("nivo-imageLink");c=b}b=b.find("img:first")}var d=b.width();if(d==0)d=b.attr("width");var g=b.height();if(g==0)g=b.attr("height");if(d>f.width()){f.width(d)}if(g>f.height()){f.height(g)}if(c!=""){c.css("display","none")}b.css("display","none");e.totalSlides++});if(d.startSlide>0){if(d.startSlide>=e.totalSlides)d.startSlide=e.totalSlides-1;e.currentSlide=d.startSlide}if(a(g[e.currentSlide]).is("img")){e.currentImage=a(g[e.currentSlide])}else{e.currentImage=a(g[e.currentSlide]).find("img:first")}if(a(g[e.currentSlide]).is("a")){a(g[e.currentSlide]).css("display","block")}f.css("background",'url("'+e.currentImage.attr("src")+'") no-repeat');f.append(a('<div class="nivo-caption"><p></p></div>').css({display:"none",opacity:d.captionOpacity}));var h=function(b){var c=a(".nivo-caption",f);if(e.currentImage.attr("title")!=""&&e.currentImage.attr("title")!=undefined){var d=e.currentImage.attr("title");if(d.substr(0,1)=="#")d=a(d).html();if(c.css("display")=="block"){c.find("p").fadeOut(b.animSpeed,function(){a(this).html(d);a(this).fadeIn(b.animSpeed)})}else{c.find("p").html(d)}c.fadeIn(b.animSpeed)}else{c.fadeOut(b.animSpeed)}};h(d);var i=0;if(!d.manualAdvance&&g.length>1){i=setInterval(function(){o(f,g,d,false)},d.pauseTime)}if(d.directionNav){f.append('<div class="nivo-directionNav"><a class="nivo-prevNav">'+d.prevText+'</a><a class="nivo-nextNav">'+d.nextText+"</a></div>");if(d.directionNavHide){a(".nivo-directionNav",f).hide();f.hover(function(){a(".nivo-directionNav",f).show()},function(){a(".nivo-directionNav",f).hide()})}a("a.nivo-prevNav",f).live("click",function(){if(e.running)return false;clearInterval(i);i="";e.currentSlide-=2;o(f,g,d,"prev")});a("a.nivo-nextNav",f).live("click",function(){if(e.running)return false;clearInterval(i);i="";o(f,g,d,"next")})}if(d.controlNav){var j=a('<div class="nivo-controlNav"></div>');f.append(j);for(var k=0;k<g.length;k++){if(d.controlNavThumbs){var l=g.eq(k);if(!l.is("img")){l=l.find("img:first")}if(d.controlNavThumbsFromRel){j.append('<a class="nivo-control" rel="'+k+'"><img src="'+l.attr("rel")+'" alt="" /></a>')}else{j.append('<a class="nivo-control" rel="'+k+'"><img src="'+l.attr("src").replace(d.controlNavThumbsSearch,d.controlNavThumbsReplace)+'" alt="" /></a>')}}else{j.append('<a class="nivo-control" rel="'+k+'">'+(k+1)+"</a>")}}a(".nivo-controlNav a:eq("+e.currentSlide+")",f).addClass("active");a(".nivo-controlNav a",f).live("click",function(){if(e.running)return false;if(a(this).hasClass("active"))return false;clearInterval(i);i="";f.css("background",'url("'+e.currentImage.attr("src")+'") no-repeat');e.currentSlide=a(this).attr("rel")-1;o(f,g,d,"control")})}if(d.keyboardNav){a(window).keypress(function(a){if(a.keyCode=="37"){if(e.running)return false;clearInterval(i);i="";e.currentSlide-=2;o(f,g,d,"prev")}if(a.keyCode=="39"){if(e.running)return false;clearInterval(i);i="";o(f,g,d,"next")}})}if(d.pauseOnHover){f.hover(function(){e.paused=true;clearInterval(i);i=""},function(){e.paused=false;if(i==""&&!d.manualAdvance){i=setInterval(function(){o(f,g,d,false)},d.pauseTime)}})}f.bind("nivo:animFinished",function(){e.running=false;a(g).each(function(){if(a(this).is("a")){a(this).css("display","none")}});if(a(g[e.currentSlide]).is("a")){a(g[e.currentSlide]).css("display","block")}if(i==""&&!e.paused&&!d.manualAdvance){i=setInterval(function(){o(f,g,d,false)},d.pauseTime)}d.afterChange.call(this)});var m=function(b,c,d){for(var e=0;e<c.slices;e++){var f=Math.round(b.width()/c.slices);if(e==c.slices-1){b.append(a('<div class="nivo-slice"></div>').css({left:f*e+"px",width:b.width()-f*e+"px",height:"0px",opacity:"0",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(f+e*f-f)+"px 0%"}))}else{b.append(a('<div class="nivo-slice"></div>').css({left:f*e+"px",width:f+"px",height:"0px",opacity:"0",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(f+e*f-f)+"px 0%"}))}}};var n=function(b,c,d){var e=Math.round(b.width()/c.boxCols);var f=Math.round(b.height()/c.boxRows);for(var g=0;g<c.boxRows;g++){for(var h=0;h<c.boxCols;h++){if(h==c.boxCols-1){b.append(a('<div class="nivo-box"></div>').css({opacity:0,left:e*h+"px",top:f*g+"px",width:b.width()-e*h+"px",height:f+"px",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(e+h*e-e)+"px -"+(f+g*f-f)+"px"}))}else{b.append(a('<div class="nivo-box"></div>').css({opacity:0,left:e*h+"px",top:f*g+"px",width:e+"px",height:f+"px",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(e+h*e-e)+"px -"+(f+g*f-f)+"px"}))}}}};var o=function(b,c,d,e){var f=b.data("nivo:vars");if(f&&f.currentSlide==f.totalSlides-1){d.lastSlide.call(this)}if((!f||f.stop)&&!e)return false;d.beforeChange.call(this);if(!e){b.css("background",'url("'+f.currentImage.attr("src")+'") no-repeat')}else{if(e=="prev"){b.css("background",'url("'+f.currentImage.attr("src")+'") no-repeat')}if(e=="next"){b.css("background",'url("'+f.currentImage.attr("src")+'") no-repeat')}}f.currentSlide++;if(f.currentSlide==f.totalSlides){f.currentSlide=0;d.slideshowEnd.call(this)}if(f.currentSlide<0)f.currentSlide=f.totalSlides-1;if(a(c[f.currentSlide]).is("img")){f.currentImage=a(c[f.currentSlide])}else{f.currentImage=a(c[f.currentSlide]).find("img:first")}if(d.controlNav){a(".nivo-controlNav a",b).removeClass("active");a(".nivo-controlNav a:eq("+f.currentSlide+")",b).addClass("active")}h(d);a(".nivo-slice",b).remove();a(".nivo-box",b).remove();if(d.effect=="random"){var g=new Array("sliceDownRight","sliceDownLeft","sliceUpRight","sliceUpLeft","sliceUpDown","sliceUpDownLeft","fold","fade","boxRandom","boxRain","boxRainReverse","boxRainGrow","boxRainGrowReverse");f.randAnim=g[Math.floor(Math.random()*(g.length+1))];if(f.randAnim==undefined)f.randAnim="fade"}if(d.effect.indexOf(",")!=-1){var g=d.effect.split(",");f.randAnim=g[Math.floor(Math.random()*g.length)];if(f.randAnim==undefined)f.randAnim="fade"}f.running=true;if(d.effect=="sliceDown"||d.effect=="sliceDownRight"||f.randAnim=="sliceDownRight"||d.effect=="sliceDownLeft"||f.randAnim=="sliceDownLeft"){m(b,d,f);var i=0;var j=0;var k=a(".nivo-slice",b);if(d.effect=="sliceDownLeft"||f.randAnim=="sliceDownLeft")k=a(".nivo-slice",b)._reverse();k.each(function(){var c=a(this);c.css({top:"0px"});if(j==d.slices-1){setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed)},100+i)}i+=50;j++})}else if(d.effect=="sliceUp"||d.effect=="sliceUpRight"||f.randAnim=="sliceUpRight"||d.effect=="sliceUpLeft"||f.randAnim=="sliceUpLeft"){m(b,d,f);var i=0;var j=0;var k=a(".nivo-slice",b);if(d.effect=="sliceUpLeft"||f.randAnim=="sliceUpLeft")k=a(".nivo-slice",b)._reverse();k.each(function(){var c=a(this);c.css({bottom:"0px"});if(j==d.slices-1){setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed)},100+i)}i+=50;j++})}else if(d.effect=="sliceUpDown"||d.effect=="sliceUpDownRight"||f.randAnim=="sliceUpDown"||d.effect=="sliceUpDownLeft"||f.randAnim=="sliceUpDownLeft"){m(b,d,f);var i=0;var j=0;var l=0;var k=a(".nivo-slice",b);if(d.effect=="sliceUpDownLeft"||f.randAnim=="sliceUpDownLeft")k=a(".nivo-slice",b)._reverse();k.each(function(){var c=a(this);if(j==0){c.css("top","0px");j++}else{c.css("bottom","0px");j=0}if(l==d.slices-1){setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed)},100+i)}i+=50;l++})}else if(d.effect=="fold"||f.randAnim=="fold"){m(b,d,f);var i=0;var j=0;a(".nivo-slice",b).each(function(){var c=a(this);var e=c.width();c.css({top:"0px",height:"100%",width:"0px"});if(j==d.slices-1){setTimeout(function(){c.animate({width:e,opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({width:e,opacity:"1.0"},d.animSpeed)},100+i)}i+=50;j++})}else if(d.effect=="fade"||f.randAnim=="fade"){m(b,d,f);var o=a(".nivo-slice:first",b);o.css({height:"100%",width:b.width()+"px"});o.animate({opacity:"1.0"},d.animSpeed*2,"",function(){b.trigger("nivo:animFinished")})}else if(d.effect=="slideInRight"||f.randAnim=="slideInRight"){m(b,d,f);var o=a(".nivo-slice:first",b);o.css({height:"100%",width:"0px",opacity:"1"});o.animate({width:b.width()+"px"},d.animSpeed*2,"",function(){b.trigger("nivo:animFinished")})}else if(d.effect=="slideInLeft"||f.randAnim=="slideInLeft"){m(b,d,f);var o=a(".nivo-slice:first",b);o.css({height:"100%",width:"0px",opacity:"1",left:"",right:"0px"});o.animate({width:b.width()+"px"},d.animSpeed*2,"",function(){o.css({left:"0px",right:""});b.trigger("nivo:animFinished")})}else if(d.effect=="boxRandom"||f.randAnim=="boxRandom"){n(b,d,f);var q=d.boxCols*d.boxRows;var j=0;var i=0;var r=p(a(".nivo-box",b));r.each(function(){var c=a(this);if(j==q-1){setTimeout(function(){c.animate({opacity:"1"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({opacity:"1"},d.animSpeed)},100+i)}i+=20;j++})}else if(d.effect=="boxRain"||f.randAnim=="boxRain"||d.effect=="boxRainReverse"||f.randAnim=="boxRainReverse"||d.effect=="boxRainGrow"||f.randAnim=="boxRainGrow"||d.effect=="boxRainGrowReverse"||f.randAnim=="boxRainGrowReverse"){n(b,d,f);var q=d.boxCols*d.boxRows;var j=0;var i=0;var s=0;var t=0;var u=new Array;u[s]=new Array;var r=a(".nivo-box",b);if(d.effect=="boxRainReverse"||f.randAnim=="boxRainReverse"||d.effect=="boxRainGrowReverse"||f.randAnim=="boxRainGrowReverse"){r=a(".nivo-box",b)._reverse()}r.each(function(){u[s][t]=a(this);t++;if(t==d.boxCols){s++;t=0;u[s]=new Array}});for(var v=0;v<d.boxCols*2;v++){var w=v;for(var x=0;x<d.boxRows;x++){if(w>=0&&w<d.boxCols){(function(c,e,g,h,i){var j=a(u[c][e]);var k=j.width();var l=j.height();if(d.effect=="boxRainGrow"||f.randAnim=="boxRainGrow"||d.effect=="boxRainGrowReverse"||f.randAnim=="boxRainGrowReverse"){j.width(0).height(0)}if(h==i-1){setTimeout(function(){j.animate({opacity:"1",width:k,height:l},d.animSpeed/1.3,"",function(){b.trigger("nivo:animFinished")})},100+g)}else{setTimeout(function(){j.animate({opacity:"1",width:k,height:l},d.animSpeed/1.3)},100+g)}})(x,w,i,j,q);j++}w--}i+=100}}};var p=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a};var q=function(a){if(this.console&&typeof console.log!="undefined")console.log(a)};this.stop=function(){if(!a(b).data("nivo:vars").stop){a(b).data("nivo:vars").stop=true;q("Stop Slider")}};this.start=function(){if(a(b).data("nivo:vars").stop){a(b).data("nivo:vars").stop=false;q("Start Slider")}};d.afterLoad.call(this);return this};a.fn.nivoSlider=function(c){return this.each(function(d,e){var f=a(this);if(f.data("nivoslider"))return f.data("nivoslider");var g=new b(this,c);f.data("nivoslider",g)})};a.fn.nivoSlider.defaults={effect:"random",slices:15,boxCols:8,boxRows:4,animSpeed:500,pauseTime:3e3,startSlide:0,directionNav:true,directionNavHide:true,controlNav:true,controlNavThumbs:false,controlNavThumbsFromRel:false,controlNavThumbsSearch:".jpg",controlNavThumbsReplace:"_thumb.jpg",keyboardNav:true,pauseOnHover:true,manualAdvance:false,captionOpacity:.8,prevText:"Prev",nextText:"Next",beforeChange:function(){},afterChange:function(){},slideshowEnd:function(){},lastSlide:function(){},afterLoad:function(){}};a.fn._reverse=[].reverse})(jQuery)

//give feedback
function ReviewUs(strServiceUrl, strFunctionCall, strParams) {
    var strRetVal = '';
    var httpRequest;
    if (window.XMLHttpRequest) {
        httpRequest = new XMLHttpRequest();
        if (httpRequest.overrideMimeType) {
            httpRequest.overrideMimeType("text/xml");
        }
    } else if (window.ActiveXObject) {
        try {
            httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    }
    if (!httpRequest) {
        return false;
    }
    httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState == 4) {
            var xmldoc = httpRequest.responseXML;
            var root_node = xmldoc.getElementsByTagName("int")[0];
            if (root_node.firstChild) {
                $(this).lpModal({
                    onInit:true,
                    width:600,
                    height:500,
                    src:"/secure/RateThisPage/default.aspx?Location="+root_node.firstChild.nodeValue
                });
            } else {
                theForm.btnSendEmail.disabled = "false";
                alert("There was a problem sending your email. Please make sure the email address is valid.");
            }
        }
    };
    httpRequest.open('GET', strServiceUrl + '/' + strFunctionCall + strParams, true);
    httpRequest.send(null);
}
function popupRateThisPage() {
    var strValues = "?url=" + encodeURIComponent(window.location);
    ReviewUs(window.location.href.substr(0, 5).replace(":", "") + "://" + document.domain + "/WebServices/EmailToFriend.asmx", "getLocationId", strValues)
    return false;
}

//javascript that's performed on document ready
$(function () {

    //sign in link click
    $("#hdrSignIn").click(function(){
        //get link's href
        var href = $(this).attr("href"),
        //get return url from link
        returnUrl = href.slice(href.indexOf('?') + 1).replace("ReturnUrl=","");
        //if page is secure use secure sign in tooltip
        if("https:" == location.protocol) {
            $("#hdrWrapper").append("<iframe id=\"signInToolTip\" width=\"310\" height=\"350\" src=\"/secure/account/popups/sign-in-small.aspx?ReturnUrl=" + returnUrl + "\" scrolling=\"no\" horizontalscrolling=\"no\" verticalscrolling=\"no\" frameborder=\"0\"></iframe>");
        //if page is unsecure use unsecure sign in tooltip
        } else {
            $("#hdrWrapper").append("<iframe id=\"signInToolTip\" width=\"310\" height=\"350\" src=\"/popups/sign-in.aspx?ReturnUrl=" + returnUrl + "\" scrolling=\"no\" horizontalscrolling=\"no\" verticalscrolling=\"no\" frameborder=\"0\"></iframe>");
        }
        //fade in tooltip
        $("#signInToolTip").fadeIn(500, function(){
            //hide tooltip if click outside tooltip
            $("html").click(function() {
                $("#signInToolTip").fadeOut(300, function(){
                    $(this).remove();
                });
            });
            $("#signInToolTip").click(function(event){
                event.stopPropagation();
            });
        });
        return false;
    });

    //add side column to sort page/landing pages/any page needing it
    if($(".siteSideCol").length){
        $.ajax({
            url: "/includes/site-side-col.html",
            success: function(data){
                //append info
                $(".siteSideCol").prepend(data);

                //side column email subscription
                $("#siteSideEmailUpdatesRequest").usableLabelField({
                    labelID: "siteSideEmailUpdatesRequestLabel",
                    btnID: "siteSideSubscribeBtn"
                });

                //side column email sign up
                $("#siteSideSubscribeBtn").click(function () {
                    var objEmail = $("#siteSideEmailUpdatesRequest").val();
                    if (objEmail != null) {
                        var email = objEmail.replace(/</g, '').replace(/>/g, '');
                        if (email.length > 0) {
                            var URL = 'https://' + ((document.domain == 'www.lampsplus.com') ? 'secure.lampsplus.com' : document.domain) + '/secure/email/index.aspx';
                            window.location = (URL + '?txtGetEmailUpdates=' + email);
                        } else {
                            return;
                        }
                    } else {
                        return;
                    }
                });
            }
        });
    }

    // Email Subscription - Footer
    $("#txtEmailUpdatesRequest").usableLabelField({
        labelID: "emailUpdatesRequestLabel",
        btnID: "ftrSubscribeBtn"
    });

    //footer email sign up functionality
    $("#ftrSubscribeBtn").click(function () {
        var objEmail = $("#txtEmailUpdatesRequest").val();
        if (objEmail != null) {
            var email = objEmail.replace(/</g, '').replace(/>/g, '');
            if (email.length > 0) {
                var URL = 'https://' + ((document.domain == 'www.lampsplus.com') ? 'secure.lampsplus.com' : document.domain) + '/secure/email/index.aspx';
                window.location = (URL + '?txtGetEmailUpdates=' + email);
            } else {
                return;
            }
        } else {
            return;
        }
    });

    //get full year for footer copyright
    $("#ftrFullYear").append(new Date().getFullYear());

    //feedback tab
    //if statement prevents feedback tag from appending in iframes
    if (parent.location == window.location) {
        $("body").append("<a href=\"#\" id=\"feedbackTab\" class=\"globalSprite\"></a>");
        $("#feedbackTab, .rateThisPage").click(popupRateThisPage);
    }

    GetCartCount();
});

//shows and hides select boxes
function ShowHideSelects(Show) {
    if (Show) {
        $("select").hide();
    } else {
        $("select").show()
    }
}

//core metrics impression tagging
function ThrowCMImpressionTag(divId) {
    if (typeof cmCreateManualImpressionTag == 'function') {
        switch (divId) {
        case 'divCeilingLights':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Lights-_-DYO-Art-Shade-Lighting-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Lights-_-Lighting-Collections-sm', null);
            break;
        case 'divLamps':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Lamps-_-Art-Shade', null);
            break;
        case 'divWallLights':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Wall-Lights-_-Free-Shipping-Bath-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Wall-Lights-_-Free-Shipping-Wall-sm', null);
            break;
        case 'divOutdoorLights':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Outdoor-Lights-_-Free-Shipping-Outdoor-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Outdoor-Lights-_-Deal-of-the-Day-sm', null);
            break;
        case 'divCeilingFans':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Fans-_-DYO-Ceiling-Fan-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Fans-_-Free-Shipping-Casa-Vieja-sm', null);
            break;
        case 'divFurniture':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Furniture-_-Seating', null);
            break;
        case 'divDecor':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Decor-_-DYO-Artwork', null);
            break;
        case 'divFloorLamps':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Floor-Lamps-_-DYO-Art-Shade-Lighting', null);
            break;
        case 'divMore':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-More-_-Light-Bulbs-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-More-_-Dimmers-sm', null);
            break;
        }
    }
}

//cookies disabled functionality
var cookieEnabled = (navigator.cookieEnabled)? true : false
if(cookieEnabled == false){
    $("#noCookiesContainerBkg").show();
    $("#noCookiesContainer").append("<p>Your Cookies setting is not enabled! You have either disabled it or are using an older browser that does not support it. Because of this, you will not be able to view our web pages or use our site features. In order to browse our site, please turn on Cookies in your browser settings.</p>");
    $("#noCookiesContainer").show();
}

function numericOnly(oTextbox, evt) {
    k = evt.which;
    if (k == 13 || k == 0) {
        return true;
    }
    if (((k < 48 || k > 57) && (k < 96 || k > 105) && k != 8 && k != 9 && k != 13 && k != 37 && k != 39 && k != 46) || evt.shiftKey == 1) {
        return false;
    } else {
        return true;
    }
}