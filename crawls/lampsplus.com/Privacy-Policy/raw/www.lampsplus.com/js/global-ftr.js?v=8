//json2.js - used for parsing through json - utilized by portfolio and cart counts
if(!this.JSON){this.JSON={}}(function(){function f(a){return a<10?"0"+a:a}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b==="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];if(i&&typeof i==="object"&&typeof i.toJSON==="function"){i=i.toJSON(a)}if(typeof rep==="function"){i=rep.call(b,a,i)}switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i){return"null"}gap+=indent;h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1){h[c]=str(c,i)||"null"}e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]";gap=g;return e}if(rep&&typeof rep==="object"){f=rep.length;for(c=0;c<f;c+=1){d=rep[c];if(typeof d==="string"){e=str(d,i);if(e){h.push(quote(d)+(gap?": ":":")+e)}}}}else{for(d in i){if(Object.hasOwnProperty.call(i,d)){e=str(d,i);if(e){h.push(quote(d)+(gap?": ":":")+e)}}}}e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}";gap=g;return e}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","  ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;if(typeof JSON.stringify!=="function"){JSON.stringify=function(a,b,c){var d;gap="";indent="";if(typeof c==="number"){for(d=0;d<c;d+=1){indent+=" "}}else if(typeof c==="string"){indent=c}rep=b;if(b&&typeof b!=="function"&&(typeof b!=="object"||typeof b.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":a})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e==="object"){for(c in e){if(Object.hasOwnProperty.call(e,c)){d=walk(e,c);if(d!==undefined){e[c]=d}else{delete e[c]}}}}return reviver.call(a,b,e)}var j;cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})()

//counts - gets portfolio and cart counts to display in header
var Portfolio;
var PortfolioCount = 0;
var PortfolioItemCount = 0;
var Cart;
var CartCount = 0;
var strBaseURL = "";

function cartHasItems() {
    if (parseInt($("#spnCartCount").text()) > 0) {
        $("#yourCart, #cartIcon").addClass("cartHasItems");
    }
}

function portfolioHasItems() {
    if (parseInt($("#portfolioItemCount").text()) > 0)
        $("#yourPortfolio").addClass("portfolioHasItems");
    else
        $("#yourPortfolio").removeClass("portfolioHasItems");
}

function GetPortfolioItemCount() {
    $.ajax({
        type: "GET",
        url: "/Portfolio/json/PortfolioItemCount.aspx",
        data: { ms: new Date().getTime() },
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (msg) {
            ShowPortfolioItemCount(msg.portfolioCount);
            PortfolioItemCount = parseInt(msg.portfolioCount);
        }
    });
}

function GetPortfolioCount() {
    $.get("/Portfolio/json/CurrentPortfolioJson.aspx?ms=" + new Date().getTime(), function (data) {
        if (data != '' && data !== null) {
            try {
                Portfolio = JSON.parse(data);
                ShowPortfolioCount(Portfolio);
            } catch (Error) { }
        }
    });
}

function GetCartCount() {
    $.get("/Orders/json/CartQuantitiesJson.aspx?ms=" + new Date().getTime(), function (data) {
        if (data != '' && data !== null) {
            try {
                Cart = JSON.parse(data);
                ShowCartCount(Cart);
            } catch (Error) {}
        }
    });
}
function ShowPortfolioCount(Portfolio)
{
    var PortfolioCountDisplay = document.getElementById("portfolioItemCount");

    if(PortfolioCountDisplay !== null && Portfolio !== null)
    {
        var iTotalQuantity = 0;

        for(var i = 0; i < Portfolio.Items.length; i++)
        {
            iTotalQuantity += parseInt(Portfolio.Items[i].Quantity);
        }

        if(PortfolioCountDisplay.childNodes.length > 0)
            PortfolioCountDisplay.removeChild(PortfolioCountDisplay.childNodes[0]);

        var tnPortfolioCount = document.createTextNode(iTotalQuantity);
        PortfolioCountDisplay.appendChild(tnPortfolioCount);

        //Apply active class to portfolio text if item(s) exist
        portfolioHasItems();
    }
}

function ShowPortfolioItemCount(count) {
    var PortfolioCountDisplay = document.getElementById("portfolioItemCount");
    if(PortfolioCountDisplay!=null)
    {
        if (count > 0) {
            if (PortfolioCountDisplay.childNodes.length > 0)
                PortfolioCountDisplay.removeChild(PortfolioCountDisplay.childNodes[0]);

            var tnPortfolioCount = document.createTextNode(count);
            PortfolioCountDisplay.appendChild(tnPortfolioCount);

            //Apply active class to portfolio text if item(s) exist
            portfolioHasItems();
        }
        else { PortfolioCountDisplay.innerHTML = '0'; }
    }

}

function ShowCartCount(Cart) {

    var CartCountDisplay = document.getElementById("spnCartCount");

    if (CartCountDisplay !== null && Cart !== null) {

        if (Cart.Items.length > 0) {

            CartCount = Cart.TotalItems;

            if (CartCountDisplay.childNodes.length > 0) {
                CartCountDisplay.removeChild(CartCountDisplay.childNodes[0]);
            }

            var tnCartCount = document.createTextNode(CartCount);

            CartCountDisplay.appendChild(tnCartCount);

            //Apply active class to cart text if item(s) exist
            cartHasItems();

        } else { CartCountDisplay.innerHTML = '0'; }

    }

}

// global function to aid in reading cookie vals
function readCookie(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}

GetPortfolioItemCount();

// function parentWindowSameDomain(currentWin) {

//     var sameOrigin;
//     try
//     {
//         sameOrigin = currentWin.parent.location.host == currentWin.location.host;
//     }
//     catch (e)
//     {
//         sameOrigin = false;
//     }
//     return sameOrigin;
// }


// jQuery Tools 1.2.7
// [tabs, tooltip, scrollable]
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};function b(a,b){var c=parseInt(a.css(b),10);if(c)return c;var d=a[0].currentStyle;return d&&d.width&&parseInt(d.width,10)}function c(b,c){var d=a(c);return d.length<2?d:b.parent().find(c)}var d;function e(b,e){var f=this,g=b.add(f),h=b.children(),i=0,j=e.vertical;d||(d=f),h.length>1&&(h=a(e.items,b)),e.size>1&&(e.circular=!1),a.extend(f,{getConf:function(){return e},getIndex:function(){return i},getSize:function(){return f.getItems().size()},getNaviButtons:function(){return n.add(o)},getRoot:function(){return b},getItemWrap:function(){return h},getItems:function(){return h.find(e.item).not("."+e.clonedClass)},move:function(a,b){return f.seekTo(i+a,b)},next:function(a){return f.move(e.size,a)},prev:function(a){return f.move(-e.size,a)},begin:function(a){return f.seekTo(0,a)},end:function(a){return f.seekTo(f.getSize()-1,a)},focus:function(){d=f;return f},addItem:function(b){b=a(b),e.circular?(h.children().last().before(b),h.children().first().replaceWith(b.clone().addClass(e.clonedClass))):(h.append(b),o.removeClass("disabled")),g.trigger("onAddItem",[b]);return f},seekTo:function(b,c,k){b.jquery||(b*=1);if(e.circular&&b===0&&i==-1&&c!==0)return f;if(!e.circular&&b<0||b>f.getSize()||b<-1)return f;var l=b;b.jquery?b=f.getItems().index(b):l=f.getItems().eq(b);var m=a.Event("onBeforeSeek");if(!k){g.trigger(m,[b,c]);if(m.isDefaultPrevented()||!l.length)return f}var n=j?{top:-l.position().top}:{left:-l.position().left};i=b,d=f,c===undefined&&(c=e.speed),h.animate(n,c,e.easing,k||function(){g.trigger("onSeek",[b])});return f}}),a.each(["onBeforeSeek","onSeek","onAddItem"],function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}});if(e.circular){var k=f.getItems().slice(-1).clone().prependTo(h),l=f.getItems().eq(1).clone().appendTo(h);k.add(l).addClass(e.clonedClass),f.onBeforeSeek(function(a,b,c){if(!a.isDefaultPrevented()){if(b==-1){f.seekTo(k,c,function(){f.end(0)});return a.preventDefault()}b==f.getSize()&&f.seekTo(l,c,function(){f.begin(0)})}});var m=b.parents().add(b).filter(function(){if(a(this).css("display")==="none")return!0});m.length?(m.show(),f.seekTo(0,0,function(){}),m.hide()):f.seekTo(0,0,function(){})}var n=c(b,e.prev).click(function(a){a.stopPropagation(),f.prev()}),o=c(b,e.next).click(function(a){a.stopPropagation(),f.next()});e.circular||(f.onBeforeSeek(function(a,b){setTimeout(function(){a.isDefaultPrevented()||(n.toggleClass(e.disabledClass,b<=0),o.toggleClass(e.disabledClass,b>=f.getSize()-1))},1)}),e.initialIndex||n.addClass(e.disabledClass)),f.getSize()<2&&n.add(o).addClass(e.disabledClass),e.mousewheel&&a.fn.mousewheel&&b.mousewheel(function(a,b){if(e.mousewheel){f.move(b<0?1:-1,e.wheelSpeed||50);return!1}});if(e.touch){var p={};h[0].ontouchstart=function(a){var b=a.touches[0];p.x=b.clientX,p.y=b.clientY},h[0].ontouchmove=function(a){if(a.touches.length==1&&!h.is(":animated")){var b=a.touches[0],c=p.x-b.clientX,d=p.y-b.clientY;f[j&&d>0||!j&&c>0?"next":"prev"](),a.preventDefault()}}}e.keyboard&&a(document).on("keydown.scrollable",function(b){if(!(!e.keyboard||b.altKey||b.ctrlKey||b.metaKey||a(b.target).is(":input"))){if(e.keyboard!="static"&&d!=f)return;var c=b.keyCode;if(j&&(c==38||c==40)){f.move(c==38?-1:1);return b.preventDefault()}if(!j&&(c==37||c==39)){f.move(c==37?-1:1);return b.preventDefault()}}}),e.initialIndex&&f.seekTo(e.initialIndex,0,function(){})}a.fn.scrollable=function(b){var c=this.data("scrollable");if(c)return c;b=a.extend({},a.tools.scrollable.conf,b),this.each(function(){c=new e(a(this),b),a(this).data("scrollable",c)});return b.api?c:this}})(jQuery);
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialEffect:!1,initialIndex:0,event:"click",rotate:!1,slideUpSpeed:400,slideDownSpeed:400,history:!1},addEffect:function(a,c){b[a]=c}};var b={"default":function(a,b){this.getPanes().hide().eq(a).show(),b.call()},fade:function(a,b){var c=this.getConf(),d=c.fadeOutSpeed,e=this.getPanes();d?e.fadeOut(d):e.hide(),e.eq(a).fadeIn(c.fadeInSpeed,b)},slide:function(a,b){var c=this.getConf();this.getPanes().slideUp(c.slideUpSpeed),this.getPanes().eq(a).slideDown(c.slideDownSpeed,b)},ajax:function(a,b){this.getPanes().eq(0).load(this.getTabs().eq(a).attr("href"),b)}},c,d;a.tools.tabs.addEffect("horizontal",function(b,e){if(!c){var f=this.getPanes().eq(b),g=this.getCurrentPane();d||(d=this.getPanes().eq(0).width()),c=!0,f.show(),g.animate({width:0},{step:function(a){f.css("width",d-a)},complete:function(){a(this).hide(),e.call(),c=!1}}),g.length||(e.call(),c=!1)}});function e(c,d,e){var f=this,g=c.add(this),h=c.find(e.tabs),i=d.jquery?d:c.children(d),j;h.length||(h=c.children()),i.length||(i=c.parent().find(d)),i.length||(i=a(d)),a.extend(this,{click:function(d,i){var k=h.eq(d),l=!c.data("tabs");typeof d=="string"&&d.replace("#","")&&(k=h.filter("[href*=\""+d.replace("#","")+"\"]"),d=Math.max(h.index(k),0));if(e.rotate){var m=h.length-1;if(d<0)return f.click(m,i);if(d>m)return f.click(0,i)}if(!k.length){if(j>=0)return f;d=e.initialIndex,k=h.eq(d)}if(d===j)return f;i=i||a.Event(),i.type="onBeforeClick",g.trigger(i,[d]);if(!i.isDefaultPrevented()){var n=l?e.initialEffect&&e.effect||"default":e.effect;b[n].call(f,d,function(){j=d,i.type="onClick",g.trigger(i,[d])}),h.removeClass(e.current),k.addClass(e.current);return f}},getConf:function(){return e},getTabs:function(){return h},getPanes:function(){return i},getCurrentPane:function(){return i.eq(j)},getCurrentTab:function(){return h.eq(j)},getIndex:function(){return j},next:function(){return f.click(j+1)},prev:function(){return f.click(j-1)},destroy:function(){h.off(e.event).removeClass(e.current),i.find("a[href^=\"#\"]").off("click.T");return f}}),a.each("onBeforeClick,onClick".split(","),function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}}),e.history&&a.fn.history&&(a.tools.history.init(h),e.event="history"),h.each(function(b){a(this).on(e.event,function(a){f.click(b,a);return a.preventDefault()})}),i.find("a[href^=\"#\"]").on("click.T",function(b){f.click(a(this).attr("href"),b)}),location.hash&&e.tabs=="a"&&c.find("[href=\""+location.hash+"\"]").length?f.click(location.hash):(e.initialIndex===0||e.initialIndex>0)&&f.click(e.initialIndex)}a.fn.tabs=function(b,c){var d=this.data("tabs");d&&(d.destroy(),this.removeData("tabs")),a.isFunction(c)&&(c={onBeforeClick:c}),c=a.extend({},a.tools.tabs.conf,c),this.each(function(){d=new e(a(this),b,c),a(this).data("tabs",d)});return c.api?d:this}})(jQuery);
(function(a){a.tools=a.tools||{version:"v1.2.7"},a.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(a,c,d){b[a]=[c,d]}};var b={toggle:[function(a){var b=this.getConf(),c=this.getTip(),d=b.opacity;d<1&&c.css({opacity:d}),c.show(),a.call()},function(a){this.getTip().hide(),a.call()}],fade:[function(b){var c=this.getConf();!a.browser.msie||c.fadeIE?this.getTip().fadeTo(c.fadeInSpeed,c.opacity,b):(this.getTip().show(),b())},function(b){var c=this.getConf();!a.browser.msie||c.fadeIE?this.getTip().fadeOut(c.fadeOutSpeed,b):(this.getTip().hide(),b())}]};function c(b,c,d){var e=d.relative?b.position().top:b.offset().top,f=d.relative?b.position().left:b.offset().left,g=d.position[0];e-=c.outerHeight()-d.offset[0],f+=b.outerWidth()+d.offset[1],/iPad/i.test(navigator.userAgent)&&(e-=a(window).scrollTop());var h=c.outerHeight()+b.outerHeight();g=="center"&&(e+=h/2),g=="bottom"&&(e+=h),g=d.position[1];var i=c.outerWidth()+b.outerWidth();g=="center"&&(f-=i/2),g=="left"&&(f-=i);return{top:e,left:f}}function d(d,e){var f=this,g=d.add(f),h,i=0,j=0,k=d.attr("title"),l=d.attr("data-tooltip"),m=b[e.effect],n,o=d.is(":input"),p=o&&d.is(":checkbox, :radio, select, :button, :submit"),q=d.attr("type"),r=e.events[q]||e.events[o?p?"widget":"input":"def"];if(!m)throw"Nonexistent effect \""+e.effect+"\"";r=r.split(/,\s*/);if(r.length!=2)throw"Tooltip: bad events configuration for "+q;d.on(r[0],function(a){clearTimeout(i),e.predelay?j=setTimeout(function(){f.show(a)},e.predelay):f.show(a)}).on(r[1],function(a){clearTimeout(j),e.delay?i=setTimeout(function(){f.hide(a)},e.delay):f.hide(a)}),k&&e.cancelDefault&&(d.removeAttr("title"),d.data("title",k)),a.extend(f,{show:function(b){if(!h){l?h=a(l):e.tip?h=a(e.tip).eq(0):k?h=a(e.layout).addClass(e.tipClass).appendTo(document.body).hide().append(k):(h=d.next(),h.length||(h=d.parent().next()));if(!h.length)throw"Cannot find tooltip for "+d}if(f.isShown())return f;h.stop(!0,!0);var o=c(d,h,e);e.tip&&h.html(d.data("title")),b=a.Event(),b.type="onBeforeShow",g.trigger(b,[o]);if(b.isDefaultPrevented())return f;o=c(d,h,e),h.css({position:"absolute",top:o.top,left:o.left}),n=!0,m[0].call(f,function(){b.type="onShow",n="full",g.trigger(b)});var p=e.events.tooltip.split(/,\s*/);h.data("__set")||(h.off(p[0]).on(p[0],function(){clearTimeout(i),clearTimeout(j)}),p[1]&&!d.is("input:not(:checkbox, :radio), textarea")&&h.off(p[1]).on(p[1],function(a){a.relatedTarget!=d[0]&&d.trigger(r[1].split(" ")[0])}),e.tip||h.data("__set",!0));return f},hide:function(c){if(!h||!f.isShown())return f;c=a.Event(),c.type="onBeforeHide",g.trigger(c);if(!c.isDefaultPrevented()){n=!1,b[e.effect][1].call(f,function(){c.type="onHide",g.trigger(c)});return f}},isShown:function(a){return a?n=="full":n},getConf:function(){return e},getTip:function(){return h},getTrigger:function(){return d}}),a.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(b,c){a.isFunction(e[c])&&a(f).on(c,e[c]),f[c]=function(b){b&&a(f).on(c,b);return f}})}a.fn.tooltip=function(b){var c=this.data("tooltip");if(c)return c;b=a.extend(!0,{},a.tools.tooltip.conf,b),typeof b.position=="string"&&(b.position=b.position.split(/,?\s/)),this.each(function(){c=new d(a(this),b),a(this).data("tooltip",c)});return b.api?c:this}})(jQuery);

// lp modal plugin
(function ($) {
    $.fn.lpModal = function (options) {

        //default options
        var defaults = {
            onInit: false,              //should modal open when code is initialized?
            fullScreen: false,          //should we fill the whole screen?
            width: 560,                 //width of modal popup
            height: 470,                //height for modal popup
            content: $("#content"),     //html element that contains content on page
            bgColor: "#fff",            //background color of modal
            src: "",                    //url source of iframe to be embedded
            openEvt: function(){},      //function to be run when modal opens
            closeEvt: function(){}      //function to be ran after close has been run
        }

        //combine defaults and passed in options
        var o = $.extend(defaults, options);

        this.each(function () {

            function initiateModal() {

                var modalTemplate = "<div id='lpModal'><a href='#' id='lpModalClose'></a><div id='lpModalContent'></div></div><div id='lpModalBackdrop'></div>";

                //if we're using content on the page
                if (o.src.length == 0) {
                    //if there is a form tag on the page
                    if ($('form').length > 0) {
                        //append template to form
                        $('form').append(modalTemplate);
                        //if there is no form on the page
                    } else {
                        //append template to body
                        $('body').append(modalTemplate);
                    }
                    //if we're using an iframe
                } else {
                    //append template to body
                    $('body').append(modalTemplate);
                }

                //cache selectors used
                var modal            = $("#lpModal"),
                    modalContent     = $("#lpModalContent"),
                    closeBtn         = $("#lpModalClose"),
                    backdrop         = $("#lpModalBackdrop"),
                    htmlBody         = $("html, body"),
                    modalOuterWidth  = Math.floor(modal.outerWidth(true)),
                    modalOuterHeight = Math.floor(modal.outerHeight(true)),
                    windowWidth      = Math.floor($(window).width()),
                    windowHeight     = Math.floor($(window).height());

                //if modal is not fullscreen
                if (!o.fullScreen) {

                    //check if width and height are larger than window
                    //if width is more than window width
                    if (o.width + modalOuterWidth > windowWidth) {
                        //change width to fit window
                        o.width = windowWidth - modalOuterWidth;
                    }
                    //if height is more than window height
                    if (o.height + modalOuterHeight > windowHeight) {
                        //change height to fit window
                        o.height = windowHeight - modalOuterHeight;
                        //add 25 to accomodate vertical scrollbar
                        o.width += 25;
                    }

                    //if modal is supposed to be fullscreen
                } else {
                    o.width = windowWidth - modalOuterWidth;
                    o.height = windowHeight - modalOuterHeight;
                }

                //if modal is using on page content
                if(o.src.length == 0){
                    modalContent.append(o.content.show());

                    //if modal is embedding an iframe
                } else {
                    //enable scrolling an iFrame in a modal on a touch device
                    $("<iframe width='100%' height='100%' src='" + o.src + "' scrolling='auto' horizontalscrolling='no' verticalscrolling='no' frameborder='0'></iframe>").appendTo(modalContent);
                    if(isIpad()){
                        modalContent.find('iframe').load(function(){
                            modalContent.css({
                                'overflow': 'auto',
                                '-webkit-overflow-scrolling': 'touch'
                            });
                        });
                    }
                }

                //set width, height, and background color values for #lpModal
                modal.css({
                    "width": o.width + "px",
                    "height": o.height + "px",
                    "background-color": o.bgColor
                });

                //calculate and set offset margin values for #lpModal
                var offsetX = modal.outerWidth() / 2,
                    offsetY = modal.outerHeight() / 2;
                modal.css({
                    "margin": "-" + offsetY + "px 0 0 -" + offsetX + "px"
                });

                //set height value for #lpModalContent
                modalContent.css({ "height": o.height + "px" });

                //fade in backdrop and modal popup
                backdrop.fadeTo(500, 0.6, function () {
                    // iframe needs reload after fade in - IE8 for Flash and Firefox for full screen
                    if ($('body').hasClass('ie8') || $('html').hasClass('ie8') || $.browser.mozilla) {
                        var modalIframe = modalContent.children('iframe'),
                        refreshSrc = modalIframe.attr('src');

                        modalIframe.attr('src','');
                        modal.fadeIn(700, function () {
                           modalIframe.attr('src', refreshSrc);
                        });
                    } else {
                        modal.fadeIn(700);
                    }
                });

                //run openEvt function if there is one
                o.openEvt();

                //close modal functionality
                function closeModal() {

                    //fade out backdrop and modal popup
                    modal.fadeOut(300, function () {
                        backdrop.fadeOut(200);
                    });

                    //using setTimeout so div removal happens AFTER popup fades out
                    setTimeout(function () {
                        modal.remove();
                        backdrop.remove();
                        o.closeEvt();
                    }, 500);

                }

                //close button and backdrop click
                var closeSelectors = [closeBtn.selector, backdrop.selector].join(", ");
                $(closeSelectors).on("click", function () {
                    closeModal();
                    return false;
                });

                //escape key press
                $(document).keyup(function (e) {
                    if (e.keyCode == 27) { closeModal(); }
                });

            }

            //if modal should open on code run
            if (o.onInit) {
                initiateModal();

                //if not then make it run on click
            } else {
                $(this).click(function () {
                    initiateModal();
                    return false;
                });
            }

        });

    };

    //close function available to outside world
    $.fn.lpModalClose = function (closeOptions) {

        var closeDefaults = {
            onInit: true    //should close happen when called?
        }

        //combine defaults and passed in options
        var cO = $.extend(closeDefaults, closeOptions);

        //if onInit is true run closeModal now
        if (cO.onInit) {
            $("#lpModalClose").click();

            //else tie click event to element passed in
        } else {
            $(this).click(function () {
                $("#lpModalClose").click();
                return false;
            })
        }

    }

    // resize function available to the whole universe
    $.fn.lpModalResize = function (resizeOptions) {

        var resizeDefaults = {
            url: null,
            action: 'resize'
        }

        // combine defaults and passed in options
        var rO = $.extend(resizeDefaults, resizeOptions);

        if (rO.action == "childSecure") {
            window.location = "/controls/ResizeModalNonSecure.aspx?width=" + rO.width + "&height=" + rO.height + "&url=" + rO.url;
        }

        if (rO.action == "childNonSecure") {
            window.location = "/secure/controls/ResizeModalSecure.aspx?width=" + rO.width + "&height=" + rO.height + "&url=" + rO.url;
        }

        if (rO.action == "resize") {

            var modal = window.parent.$("#lpModal");

            var offsetX = (rO.width + parseInt(modal.css("padding-left")) + parseInt(modal.css("padding-right")) + parseInt(modal.css("border-left-width")) + parseInt(modal.css("border-right-width"))) / 2,
                offsetY = (rO.height + parseInt(modal.css("padding-top")) + parseInt(modal.css("padding-bottom")) + parseInt(modal.css("border-top-width")) + parseInt(modal.css("border-bottom-width"))) / 2;

            window.parent.$("#lpModalContent").animate({
                width: rO.width,
                height: rO.height
            }, 200);

            window.parent.$("#lpModal").animate({
                width: rO.width,
                height: rO.height,
                'margin-left': "-" + offsetX + "px",
                'margin-top': "-" + offsetY + "px"
            }, 200);

            setTimeout(function() {
                if (rO.url != null) {
                    if (rO.url.indexOf('?') >= 0) {
                        window.location = rO.url + "&resized=true";
                    } else {
                        window.location = rO.url + "?resized=true";
                    }
                }
            }, 400);
        }

    }

})(jQuery);

// lp tooltip plugin - relies on jquery and hoverintent plugin
(function($) {

    $.fn.lpTooltip = function(options) {
        if (!this.length) { return this; }

        //default options
        var defaults  = {
                            tooltip: $('#tooltip'),    // tooltip element to be used
                            horzAlign: 'center',       // horizontal position of tooltip - options are left, center, and right
                            vertAlign: 'top',          // vertical position of tooltip - options are top, middle, and bottom
                            arrow: false,              // want an arrow on the tooltip?
                            arrowSize: 10,             // px size of arrow
                            arrowColor: '#fff',        // color of arrow - can accept any css border-color property value (hex, rgb, rgba, gradient) - can't accept more than one value though so no vendor prefixes or fallbacks
                            screenEdgePadding: 10,     // padding from side of screen to be used when tooltip needs to be moved
                            offsetX: 0,                // offset the position of the tooltip on the x axis - use positive or negative integers
                            offsetY: 0,                // offset the position of the tooltip on the y axis - use positive or negative integers
                            evtType: 'hover',          // event to fire tooltip - options are hover and click
                            hoverDelay: 400,           // delay for tooltip to be shown after hovering over trigger element
                            tooltipFadeIn: 200,        // how long fade in animation takes
                            tooltipFadeOut: 100,       // how long fade out animation takes
                            openEvt: function(){},     // function to be run when tooltip opens
                            closeEvt: function(){}     // function to be run when tooltip closes
                        },
            o         = $.extend(defaults, options),   //combine defaults and passed in options
            tooltipOn = { val: false };

        this.each(function(ttNum) {
            var $this        = $(this);

            if (o.tooltip.length > 1){
                var $thisTooltip = $(o.tooltip[ttNum]);
            } else {
                var $thisTooltip = o.tooltip;
            }

            function tooltipGetMeasurements() {
                var $window            = $(window),
                    m                  = {};
                    m.elPos            = $this.offset();
                    m.elWidth          = $this.outerWidth();
                    m.elHeight         = $this.outerHeight();
                    m.tooltipWidth     = $thisTooltip.outerWidth();
                    m.tooltipHeight    = $thisTooltip.outerHeight();
                    m.elToolDiffWidth  = Math.abs(m.elWidth - m.tooltipWidth);
                    m.elToolDiffHeight = Math.abs(m.elHeight - m.tooltipHeight);
                    m.winSizeWidth     = $window.width();
                    m.winSizeHeight    = $window.height();

                return m;
            }

            function addArrow(side){
                if (!$('#lpTooltipArrow').is('*')){
                    $thisTooltip.prepend('<div id="lpTooltipArrow" style=""></div>');
                }

                var $lpTooltipArrow = $('#lpTooltipArrow');

                if(side === 'top'){
                    $lpTooltipArrow.css({
                        borderLeft: o.arrowSize + 'px solid transparent',
                        borderRight: o.arrowSize + 'px solid transparent',
                        borderBottom: o.arrowSize + 'px solid ' + o.arrowColor,
                        borderTop: '0',
                        position: 'absolute'
                    });
                } else if (side === 'bottom'){
                    $lpTooltipArrow.css({
                        borderLeft: o.arrowSize + 'px solid transparent',
                        borderRight: o.arrowSize + 'px solid transparent',
                        borderTop: o.arrowSize + 'px solid ' + o.arrowColor,
                        borderBottom: '0',
                        position: 'absolute'
                    });
                } else if (side === 'left'){
                    $lpTooltipArrow.css({
                        borderBottom: o.arrowSize + 'px solid transparent',
                        borderTop: o.arrowSize + 'px solid transparent',
                        borderRight: o.arrowSize + 'px solid ' + o.arrowColor,
                        borderLeft: '0',
                        position: 'absolute'
                    });
                } else if (side === 'right'){
                    $lpTooltipArrow.css({
                        borderBottom: o.arrowSize + 'px solid transparent',
                        borderTop: o.arrowSize + 'px solid transparent',
                        borderLeft: o.arrowSize + 'px solid ' + o.arrowColor,
                        borderRight: '0',
                        position: 'absolute'
                    });
                }
            }

            function arrowPosition(axis, pos){
                var $lpTooltipArrow = $('#lpTooltipArrow');

                if (axis === 'x'){
                    $lpTooltipArrow.css('left', pos);
                } else if (axis === 'y'){
                    $lpTooltipArrow.css('top', pos);
                }
            }

            function isOutOfViewportYTop(y){
                var $winScrollTop = $(window).scrollTop(),
                    viewResults   = {};

                if (y < $winScrollTop){
                    viewResults.fits = false;
                    viewResults.distToMoveDown = $winScrollTop - y + o.screenEdgePadding;
                    return viewResults;
                } else {
                    viewResults.fits = true;
                    return viewResults;
                }
            }

            function isOutOfViewportYBottom(y){
                var $winScrollTop = $(window).scrollTop(),
                    $winHeight    = $(window).height(),
                    viewResults   = {};

                if (y > $winScrollTop + $winHeight){
                    viewResults.fits = false;
                    viewResults.distToMoveUp = y - ($winScrollTop + $winHeight) + o.screenEdgePadding;
                    return viewResults;
                } else {
                    viewResults.fits = true;
                    return viewResults;
                }
            }

            function isOutOfViewportXLeft(x){
                var $winScrollLeft = $(window).scrollLeft(),
                    viewResults    = {};

                if (x < $winScrollLeft){
                    viewResults.fits = false;
                    viewResults.distToMoveRight = $winScrollLeft - x + o.screenEdgePadding;
                    return viewResults;
                } else {
                    viewResults.fits = true;
                    return viewResults;
                }
            }

            function isOutOfViewportXRight(x){
                var $winScrollLeft = $(window).scrollLeft(),
                    $winWidth      = $(window).width(),
                    viewResults    = {};

                if (x > ($winScrollLeft + $winWidth)){
                    viewResults.fits = false;
                    viewResults.distToMoveLeft = x - ($winScrollLeft + $winWidth) + o.screenEdgePadding;
                    return viewResults;
                } else {
                    viewResults.fits = true;
                    return viewResults;
                }
            }

            function toolTipPosition() {
                var m = tooltipGetMeasurements();

                if (o.arrow){
                    if (o.vertAlign === 'top' && o.horzAlign === 'center'){
                        addArrow('bottom');
                    } else if (o.vertAlign === 'bottom' && o.horzAlign === 'center'){
                        addArrow('top');
                    } else if (o.vertAlign === 'middle' && o.horzAlign === 'left'){
                        addArrow('right');
                    } else if (o.vertAlign === 'middle' && o.horzAlign === 'right'){
                        addArrow('left');
                    }
                }

                if (o.vertAlign === 'top'){
                    var yTop       = m.elPos.top - (m.tooltipHeight + o.offsetY),
                        inViewYTop = isOutOfViewportYTop(yTop);

                    // if the tooltip can fit or if the space above the element is larger than or equal to the space below it
                    if (inViewYTop.fits || m.elPos.top - $(window).scrollTop() >= Math.abs( Math.abs( m.elPos.top + m.elHeight - $(window).scrollTop() ) - m.winSizeHeight )){
                        $thisTooltip.css({
                            top: yTop + 'px'
                        });
                        if (o.arrow){
                            var borderTopWid       = $thisTooltip.css('border-top-width'),
                                borderBottomWid    = $thisTooltip.css('border-bottom-width'),
                                intBorderTopWid    = parseInt(borderTopWid.replace('px', '')),
                                intBorderBottomWid = parseInt(borderBottomWid.replace('px', ''));

                            arrowPosition('y', m.tooltipHeight - intBorderTopWid - intBorderBottomWid);
                        }
                    } else {
                        o.vertAlign = 'bottom';
                        toolTipPosition();
                        o.vertAlign = 'top';
                    }
                }

                if (o.vertAlign === 'bottom'){
                    var yBottom       = m.elPos.top + m.elHeight + m.tooltipHeight + o.offsetY,
                        inViewYBottom = isOutOfViewportYBottom(yBottom);

                    // if the tooltip can fit or if the space below the element is larger than or equal to the space above it
                    if (inViewYBottom.fits || m.elPos.top - $(window).scrollTop() <= Math.abs( m.winSizeHeight - Math.abs( m.elPos.top + m.elHeight - $(window).scrollTop() ) )){
                        $thisTooltip.css({
                            top: m.elPos.top + (m.elHeight + o.offsetY) + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('y', 0 - o.arrowSize);
                        }
                    } else {
                        o.vertAlign = 'top';
                        toolTipPosition();
                        o.vertAlign = 'bottom';
                    }
                }

                if (o.vertAlign === 'middle'){
                    var yTop          = m.elPos.top + (m.elHeight / 2) - (m.tooltipHeight / 2) + o.offsetY,
                        inViewYTop    = isOutOfViewportYTop(yTop),
                        yBottom       = m.elPos.top + (m.elHeight / 2) + (m.tooltipHeight / 2) + o.offsetY,
                        inViewYBottom = isOutOfViewportYBottom(yBottom);

                    if ((inViewYTop.fits && inViewYBottom.fits) || (!inViewYTop.fits && !inViewYBottom.fits)){
                        $thisTooltip.css({
                            top: m.elPos.top - (m.elToolDiffHeight / 2) + o.offsetY + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('y', (m.tooltipHeight / 2) - o.arrowSize);
                        }
                    } else if (inViewYTop.fits && !inViewYBottom.fits){
                        $thisTooltip.css({
                            top: m.elPos.top - (m.elToolDiffHeight / 2) - inViewYBottom.distToMoveUp + o.offsetY + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('y', (m.tooltipHeight / 2) + inViewYBottom.distToMoveUp - o.arrowSize);
                        }
                    } else if (!inViewYTop.fits && inViewYBottom.fits){
                        $thisTooltip.css({
                            top: m.elPos.top - (m.elToolDiffHeight / 2) + inViewYTop.distToMoveDown + o.offsetY + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('y', (m.tooltipHeight / 2) - inViewYTop.distToMoveDown - o.arrowSize);
                        }
                    }
                }

                if (o.horzAlign === 'left'){
                    var xLeft       = m.elPos.left - m.tooltipWidth + o.offsetX,
                        inViewXLeft = isOutOfViewportXLeft(xLeft);

                    // if the tooltip can fit or if the space to the left of the element is larger than or equal to the space to the right of the element
                    if (inViewXLeft.fits || m.elPos.left - $(window).scrollLeft() >= Math.abs( m.winSizeWidth - Math.abs(m.elPos.left + m.elWidth - $(window).scrollLeft()) )){
                        $thisTooltip.css({
                            left: m.elPos.left - (m.tooltipWidth + o.offsetX) + 'px'
                        });
                        if (o.arrow){
                            var borderLeftWid     = $thisTooltip.css('border-left-width'),
                                borderRightWid    = $thisTooltip.css('border-right-width'),
                                intBorderLeftWid  = parseInt(borderLeftWid.replace('px', '')),
                                intBorderRightWid = parseInt(borderRightWid.replace('px', ''));

                            arrowPosition('x', m.tooltipWidth - intBorderLeftWid - intBorderRightWid);
                        }
                    } else {
                        o.horzAlign = 'right';
                        toolTipPosition();
                        o.horzAlign = 'left';
                    }
                }

                if (o.horzAlign === 'right'){
                    var xRight       = m.elPos.left + m.elWidth + m.tooltipWidth + o.offsetX,
                        inViewXRight = isOutOfViewportXRight(xRight);

                    // if the tooltip can fit or if the space to the left of the element is larger than or equal to the space to the right of the element
                    if (inViewXRight.fits || m.elPos.left - $(window).scrollLeft() <= Math.abs( Math.abs( m.elPos.left + m.elWidth - $(window).scrollLeft() ) - m.winSizeWidth )){
                        $thisTooltip.css({
                            left: m.elPos.left + (m.elWidth + o.offsetX) + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('x', 0 - o.arrowSize);
                        }
                    } else {
                        o.horzAlign = 'left';
                        toolTipPosition();
                        o.horzAlign = 'right';
                    }
                }

                if (o.horzAlign === 'center'){
                    var xLeft        = m.elPos.left + (m.elWidth / 2) - (m.tooltipWidth / 2) + o.offsetX,
                        inViewXLeft  = isOutOfViewportXLeft(xLeft),
                        xRight       = m.elPos.left + (m.elWidth / 2) + (m.tooltipWidth / 2) + o.offsetX,
                        inViewXRight = isOutOfViewportXRight(xRight);

                    if ((inViewXLeft.fits && inViewXRight.fits) || (!inViewXLeft.fits && !inViewXRight.fits)){
                        $thisTooltip.css({
                            left: m.elPos.left - (m.elToolDiffWidth / 2) + o.offsetX + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('x', (m.tooltipWidth / 2) - o.arrowSize);
                        }
                    } else if (inViewXLeft.fits && !inViewXRight.fits){
                        $thisTooltip.css({
                            left: m.elPos.left - (m.elToolDiffWidth / 2) + o.offsetX - inViewXRight.distToMoveLeft + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('x', (m.tooltipWidth / 2) + inViewXRight.distToMoveLeft - o.arrowSize);
                        }
                    } else if (!inViewXLeft.fits && inViewXRight.fits){
                        $thisTooltip.css({
                            left: m.elPos.left - (m.elToolDiffWidth / 2) + o.offsetX + inViewXLeft.distToMoveRight + 'px'
                        });
                        if (o.arrow){
                            arrowPosition('x', (m.tooltipWidth / 2) - inViewXLeft.distToMoveRight - o.arrowSize);
                        }
                    }
                }
            }

            function over() {
                $thisTooltip.css({
                    position: 'absolute',
                    zIndex: '99'
                });

                toolTipPosition();

                $thisTooltip.fadeIn(o.tooltipFadeIn, function() {
                    o.openEvt($this);
                });

                $thisTooltip.on('mousedown', function(e) {
                    e.stopPropagation();
                });
                $('html').on('mousedown', function(){
                    out();
                });

                $(window).resize(function() {
                    toolTipPosition();
                });
            }

            function out(callback){
                if(!tooltipOn.val){
                    o.tooltip.fadeOut(o.tooltipFadeOut, function(){
                        $('#lpTooltipArrow').remove();

                        o.closeEvt($this);

                        if (typeof(callback) === 'function'){
                            callback();
                        }
                    });
                }
            }

            if (o.evtType === 'click') {

                $this.click(function(e) {
                    e.preventDefault();
                    setTimeout(function(){
                        over();
                    }, 100);
                });

                $('a.close').on('click', function(e) {
                    e.preventDefault();
                    out();
                });

            } else if (o.evtType === 'hover') {

                $this.hoverIntent({
                    interval: o.tooltipFadeIn + 50,
                    over: over,
                    timeout: o.hoverDelay,
                    out: out
                });

                var timeout;
                $thisTooltip.mouseenter(function() {
                    tooltipOn.val = true;
                    clearTimeout(timeout);
                });

                $thisTooltip.mouseleave(function() {
                    timeout = setTimeout(function(){
                        tooltipOn.val = false;
                        out();
                    }, o.hoverDelay);
                });

            }
        });

        return this;
    };

})(jQuery);


//jQuery plugin for retrieving url parameters and values
$.extend({
    getUrlVars: function(){
        var vars = [], hash;
        var url = window.location.href;
        url = decodeURIComponent(url.replace(/\+/g,  " "));
        var hashes = url.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++){
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
        }
        return vars;
    },
    getUrlVar: function(name){
        return $.getUrlVars()[name];
    }
});


// handlebars v1.0.beta.6
var Handlebars={};Handlebars.VERSION="1.0.beta.6";Handlebars.helpers={};Handlebars.partials={};Handlebars.registerHelper=function(b,c,a){if(a){c.not=a}this.helpers[b]=c};Handlebars.registerPartial=function(a,b){this.partials[a]=b};Handlebars.registerHelper("helperMissing",function(a){if(arguments.length===2){return undefined}else{throw new Error("Could not find property '"+a+"'")}});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(f,d){var a=d.inverse||function(){},h=d.fn;var c="";var g=toString.call(f);if(g===functionType){f=f.call(this)}if(f===true){return h(this)}else{if(f===false||f==null){return a(this)}else{if(g==="[object Array]"){if(f.length>0){for(var e=0,b=f.length;e<b;e++){c=c+h(f[e])}}else{c=a(this)}return c}else{return h(f)}}}});Handlebars.registerHelper("each",function(f,d){var g=d.fn,a=d.inverse;var c="";if(f&&f.length>0){for(var e=0,b=f.length;e<b;e++){c=c+g(f[e])}}else{c=a(this)}return c});Handlebars.registerHelper("if",function(b,a){var c=toString.call(b);if(c===functionType){b=b.call(this)}if(!b||Handlebars.Utils.isEmpty(b)){return a.inverse(this)}else{return a.fn(this)}});Handlebars.registerHelper("unless",function(c,b){var d=b.fn,a=b.inverse;b.fn=a;b.inverse=d;return Handlebars.helpers["if"].call(this,c,b)});Handlebars.registerHelper("with",function(b,a){return a.fn(b)});Handlebars.registerHelper("log",function(a){Handlebars.log(a)});var handlebars=(function(){var f={trace:function c(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,"$accept":0,"$end":1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function b(g,j,k,n,m,i,l){var h=i.length-1;switch(m){case 1:return i[h-1];break;case 2:this.$=new n.ProgramNode(i[h-2],i[h]);break;case 3:this.$=new n.ProgramNode(i[h]);break;case 4:this.$=new n.ProgramNode([]);break;case 5:this.$=[i[h]];break;case 6:i[h-1].push(i[h]);this.$=i[h-1];break;case 7:this.$=new n.InverseNode(i[h-2],i[h-1],i[h]);break;case 8:this.$=new n.BlockNode(i[h-2],i[h-1],i[h]);break;case 9:this.$=i[h];break;case 10:this.$=i[h];break;case 11:this.$=new n.ContentNode(i[h]);break;case 12:this.$=new n.CommentNode(i[h]);break;case 13:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1]);break;case 14:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1]);break;case 15:this.$=i[h-1];break;case 16:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1]);break;case 17:this.$=new n.MustacheNode(i[h-1][0],i[h-1][1],true);break;case 18:this.$=new n.PartialNode(i[h-1]);break;case 19:this.$=new n.PartialNode(i[h-2],i[h-1]);break;case 20:break;case 21:this.$=[[i[h-2]].concat(i[h-1]),i[h]];break;case 22:this.$=[[i[h-1]].concat(i[h]),null];break;case 23:this.$=[[i[h-1]],i[h]];break;case 24:this.$=[[i[h]],null];break;case 25:i[h-1].push(i[h]);this.$=i[h-1];break;case 26:this.$=[i[h]];break;case 27:this.$=i[h];break;case 28:this.$=new n.StringNode(i[h]);break;case 29:this.$=new n.IntegerNode(i[h]);break;case 30:this.$=new n.BooleanNode(i[h]);break;case 31:this.$=new n.HashNode(i[h]);break;case 32:i[h-1].push(i[h]);this.$=i[h-1];break;case 33:this.$=[i[h]];break;case 34:this.$=[i[h-2],i[h]];break;case 35:this.$=[i[h-2],new n.StringNode(i[h])];break;case 36:this.$=[i[h-2],new n.IntegerNode(i[h])];break;case 37:this.$=[i[h-2],new n.BooleanNode(i[h])];break;case 38:this.$=new n.IdNode(i[h]);break;case 39:i[h-2].push(i[h]);this.$=i[h-2];break;case 40:this.$=[i[h]];break}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function d(h,g){throw new Error(h)},parse:function e(o){var x=this,l=[0],G=[null],s=[],H=this.table,h="",q=0,E=0,j=0,n=2,u=1;this.lexer.setInput(o);this.lexer.yy=this.yy;this.yy.lexer=this.lexer;if(typeof this.lexer.yylloc=="undefined"){this.lexer.yylloc={}}var i=this.lexer.yylloc;s.push(i);if(typeof this.yy.parseError==="function"){this.parseError=this.yy.parseError}function w(p){l.length=l.length-2*p;G.length=G.length-p;s.length=s.length-p}function v(){var p;p=x.lexer.lex()||1;if(typeof p!=="number"){p=x.symbols_[p]||p}return p}var D,z,k,C,I,t,B={},y,F,g,m;while(true){k=l[l.length-1];if(this.defaultActions[k]){C=this.defaultActions[k]}else{if(D==null){D=v()}C=H[k]&&H[k][D]}if(typeof C==="undefined"||!C.length||!C[0]){if(!j){m=[];for(y in H[k]){if(this.terminals_[y]&&y>2){m.push("'"+this.terminals_[y]+"'")}}var A="";if(this.lexer.showPosition){A="Parse error on line "+(q+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+m.join(", ")+", got '"+this.terminals_[D]+"'"}else{A="Parse error on line "+(q+1)+": Unexpected "+(D==1?"end of input":"'"+(this.terminals_[D]||D)+"'")}this.parseError(A,{text:this.lexer.match,token:this.terminals_[D]||D,line:this.lexer.yylineno,loc:i,expected:m})}}if(C[0] instanceof Array&&C.length>1){throw new Error("Parse Error: multiple actions possible at state: "+k+", token: "+D)}switch(C[0]){case 1:l.push(D);G.push(this.lexer.yytext);s.push(this.lexer.yylloc);l.push(C[1]);D=null;if(!z){E=this.lexer.yyleng;h=this.lexer.yytext;q=this.lexer.yylineno;i=this.lexer.yylloc;if(j>0){j--}}else{D=z;z=null}break;case 2:F=this.productions_[C[1]][1];B.$=G[G.length-F];B._$={first_line:s[s.length-(F||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(F||1)].first_column,last_column:s[s.length-1].last_column};t=this.performAction.call(B,h,E,q,this.yy,C[1],G,s);if(typeof t!=="undefined"){return t}if(F){l=l.slice(0,-1*F*2);G=G.slice(0,-1*F);s=s.slice(0,-1*F)}l.push(this.productions_[C[1]][0]);G.push(B.$);s.push(B._$);g=H[l[l.length-2]][l[l.length-1]];l.push(g);break;case 3:return true}}return true}};var a=(function(){var j=({EOF:1,parseError:function l(o,n){if(this.yy.parseError){this.yy.parseError(o,n)}else{throw new Error(o)}},setInput:function(n){this._input=n;this._more=this._less=this.done=false;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};return this},input:function(){var o=this._input[0];this.yytext+=o;this.yyleng++;this.match+=o;this.matched+=o;var n=o.match(/\n/);if(n){this.yylineno++}this._input=this._input.slice(1);return o},unput:function(n){this._input=n+this._input;return this},more:function(){this._more=true;return this},pastInput:function(){var n=this.matched.substr(0,this.matched.length-this.match.length);return(n.length>20?"...":"")+n.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var n=this.match;if(n.length<20){n+=this._input.substr(0,20-n.length)}return(n.substr(0,20)+(n.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var n=this.pastInput();var o=new Array(n.length+1).join("-");return n+this.upcomingInput()+"\n"+o+"^"},next:function(){if(this.done){return this.EOF}if(!this._input){this.done=true}var r,p,o,n;if(!this._more){this.yytext="";this.match=""}var s=this._currentRules();for(var q=0;q<s.length;q++){p=this._input.match(this.rules[s[q]]);if(p){n=p[0].match(/\n.*/g);if(n){this.yylineno+=n.length}this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-1:this.yylloc.last_column+p[0].length};this.yytext+=p[0];this.match+=p[0];this.matches=p;this.yyleng=this.yytext.length;this._more=false;this._input=this._input.slice(p[0].length);this.matched+=p[0];r=this.performAction.call(this,this.yy,this,s[q],this.conditionStack[this.conditionStack.length-1]);if(r){return r}else{return}}}if(this._input===""){return this.EOF}else{this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})}},lex:function g(){var n=this.next();if(typeof n!=="undefined"){return n}else{return this.lex()}},begin:function h(n){this.conditionStack.push(n)},popState:function m(){return this.conditionStack.pop()},_currentRules:function k(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function h(n){this.begin(n)}});j.performAction=function i(r,o,q,n){var p=n;switch(q){case 0:if(o.yytext.slice(-1)!=="\\"){this.begin("mu")}if(o.yytext.slice(-1)==="\\"){o.yytext=o.yytext.substr(0,o.yyleng-1),this.begin("emu")}if(o.yytext){return 14}break;case 1:return 14;break;case 2:this.popState();return 14;break;case 3:return 24;break;case 4:return 16;break;case 5:return 20;break;case 6:return 19;break;case 7:return 19;break;case 8:return 23;break;case 9:return 23;break;case 10:o.yytext=o.yytext.substr(3,o.yyleng-5);this.popState();return 15;break;case 11:return 22;break;case 12:return 34;break;case 13:return 33;break;case 14:return 33;break;case 15:return 36;break;case 16:break;case 17:this.popState();return 18;break;case 18:this.popState();return 18;break;case 19:o.yytext=o.yytext.substr(1,o.yyleng-2).replace(/\\"/g,'"');return 28;break;case 20:return 30;break;case 21:return 30;break;case 22:return 29;break;case 23:return 33;break;case 24:o.yytext=o.yytext.substr(1,o.yyleng-2);return 33;break;case 25:return"INVALID";break;case 26:return 5;break}};j.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/];j.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:false},emu:{rules:[2],inclusive:false},INITIAL:{rules:[0,1,26],inclusive:true}};return j})();f.lexer=a;return f})();if(typeof require!=="undefined"&&typeof exports!=="undefined"){exports.parser=handlebars;exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)};exports.main=function commonjsMain(a){if(!a[1]){throw new Error("Usage: "+a[0]+" FILE")}if(typeof process!=="undefined"){var c=require("fs").readFileSync(require("path").join(process.cwd(),a[1]),"utf8")}else{var b=require("file").path(require("file").cwd());var c=b.join(a[1]).read({charset:"utf-8"})}return exports.parser.parse(c)};if(typeof module!=="undefined"&&require.main===module){exports.main(typeof process!=="undefined"?process.argv.slice(1):require("system").args)}}Handlebars.Parser=handlebars;Handlebars.parse=function(a){Handlebars.Parser.yy=Handlebars.AST;return Handlebars.Parser.parse(a)};Handlebars.print=function(a){return new Handlebars.PrintVisitor().accept(a)};Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(b,a){}};Handlebars.log=function(b,a){Handlebars.logger.log(b,a)};(function(){Handlebars.AST={};Handlebars.AST.ProgramNode=function(c,b){this.type="program";this.statements=c;if(b){this.inverse=new Handlebars.AST.ProgramNode(b)}};Handlebars.AST.MustacheNode=function(d,c,b){this.type="mustache";this.id=d[0];this.params=d.slice(1);this.hash=c;this.escaped=!b};Handlebars.AST.PartialNode=function(c,b){this.type="partial";this.id=c;this.context=b};var a=function(b,c){if(b.original!==c.original){throw new Handlebars.Exception(b.original+" doesn't match "+c.original)}};Handlebars.AST.BlockNode=function(c,b,d){a(c.id,d);this.type="block";this.mustache=c;this.program=b};Handlebars.AST.InverseNode=function(c,b,d){a(c.id,d);this.type="inverse";this.mustache=c;this.program=b};Handlebars.AST.ContentNode=function(b){this.type="content";this.string=b};Handlebars.AST.HashNode=function(b){this.type="hash";this.pairs=b};Handlebars.AST.IdNode=function(f){this.type="ID";this.original=f.join(".");var d=[],g=0;for(var e=0,b=f.length;e<b;e++){var c=f[e];if(c===".."){g++}else{if(c==="."||c==="this"){this.isScoped=true}else{d.push(c)}}}this.parts=d;this.string=d.join(".");this.depth=g;this.isSimple=(d.length===1)&&(g===0)};Handlebars.AST.StringNode=function(b){this.type="STRING";this.string=b};Handlebars.AST.IntegerNode=function(b){this.type="INTEGER";this.integer=b};Handlebars.AST.BooleanNode=function(b){this.type="BOOLEAN";this.bool=b};Handlebars.AST.CommentNode=function(b){this.type="comment";this.comment=b}})();Handlebars.Exception=function(b){var a=Error.prototype.constructor.apply(this,arguments);for(var c in a){if(a.hasOwnProperty(c)){this[c]=a[c]}}this.message=a.message};Handlebars.Exception.prototype=new Error;Handlebars.SafeString=function(a){this.string=a};Handlebars.SafeString.prototype.toString=function(){return this.string.toString()};(function(){var c={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var d=/&(?!\w+;)|[<>"'`]/g;var b=/[&<>"'`]/;var a=function(e){return c[e]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){if(e instanceof Handlebars.SafeString){return e.toString()}else{if(e==null||e===false){return""}}if(!b.test(e)){return e}return e.replace(d,a)},isEmpty:function(e){if(typeof e==="undefined"){return true}else{if(e===null){return true}else{if(e===false){return true}else{if(Object.prototype.toString.call(e)==="[object Array]"&&e.length===0){return true}else{return false}}}}}}})();Handlebars.Compiler=function(){};Handlebars.JavaScriptCompiler=function(){};(function(f,e){f.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16};f.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1};f.DISASSEMBLE_MAP={};for(var h in f.OPCODE_MAP){var g=f.OPCODE_MAP[h];f.DISASSEMBLE_MAP[g]=h}f.multiParamSize=function(i){return f.MULTI_PARAM_OPCODES[f.DISASSEMBLE_MAP[i]]};f.prototype={compiler:f,disassemble:function(){var t=this.opcodes,r,n;var q=[],v,m,w;for(var s=0,o=t.length;s<o;s++){r=t[s];if(r==="DECLARE"){m=t[++s];w=t[++s];q.push("DECLARE "+m+" = "+w)}else{v=f.DISASSEMBLE_MAP[r];var u=f.multiParamSize(r);var k=[];for(var p=0;p<u;p++){n=t[++s];if(typeof n==="string"){n='"'+n.replace("\n","\\n")+'"'}k.push(n)}v=v+" "+k.join(" ");q.push(v)}}return q.join("\n")},guid:0,compile:function(i,k){this.children=[];this.depths={list:[]};this.options=k;var l=this.options.knownHelpers;this.options.knownHelpers={helperMissing:true,blockHelperMissing:true,each:true,"if":true,unless:true,"with":true,log:true};if(l){for(var j in l){this.options.knownHelpers[j]=l[j]}}return this.program(i)},accept:function(i){return this[i.type](i)},program:function(m){var k=m.statements,o;this.opcodes=[];for(var n=0,j=k.length;n<j;n++){o=k[n];this[o.type](o)}this.isSimple=j===1;this.depths.list=this.depths.list.sort(function(l,i){return l-i});return this},compileProgram:function(m){var j=new this.compiler().compile(m,this.options);var n=this.guid++;this.usePartial=this.usePartial||j.usePartial;this.children[n]=j;for(var o=0,k=j.depths.list.length;o<k;o++){depth=j.depths.list[o];if(depth<2){continue}else{this.addDepth(depth-1)}}return n},block:function(o){var l=o.mustache;var n,p,j,k;var m=this.setupStackForMustache(l);var i=this.compileProgram(o.program);if(o.program.inverse){k=this.compileProgram(o.program.inverse);this.declare("inverse",k)}this.opcode("invokeProgram",i,m.length,!!l.hash);this.declare("inverse",null);this.opcode("append")},inverse:function(k){var j=this.setupStackForMustache(k.mustache);var i=this.compileProgram(k.program);this.declare("inverse",i);this.opcode("invokeProgram",null,j.length,!!k.mustache.hash);this.declare("inverse",null);this.opcode("append")},hash:function(n){var m=n.pairs,p,o;this.opcode("push","{}");for(var k=0,j=m.length;k<j;k++){p=m[k];o=p[1];this.accept(o);this.opcode("assignToHash",p[0])}},partial:function(i){var j=i.id;this.usePartial=true;if(i.context){this.ID(i.context)}else{this.opcode("push","depth0")}this.opcode("invokePartial",j.original);this.opcode("append")},content:function(i){this.opcode("appendContent",i.string)},mustache:function(i){var j=this.setupStackForMustache(i);this.opcode("invokeMustache",j.length,i.id.original,!!i.hash);if(i.escaped&&!this.options.noEscape){this.opcode("appendEscaped")}else{this.opcode("append")}},ID:function(m){this.addDepth(m.depth);this.opcode("getContext",m.depth);this.opcode("lookupWithHelpers",m.parts[0]||null,m.isScoped||false);for(var k=1,j=m.parts.length;k<j;k++){this.opcode("lookup",m.parts[k])}},STRING:function(i){this.opcode("pushString",i.string)},INTEGER:function(i){this.opcode("push",i.integer)},BOOLEAN:function(i){this.opcode("push",i.bool)},comment:function(){},pushParams:function(l){var j=l.length,k;while(j--){k=l[j];if(this.options.stringParams){if(k.depth){this.addDepth(k.depth)}this.opcode("getContext",k.depth||0);this.opcode("pushStringParam",k.string)}else{this[k.type](k)}}},opcode:function(i,l,k,j){this.opcodes.push(f.OPCODE_MAP[i]);if(l!==undefined){this.opcodes.push(l)}if(k!==undefined){this.opcodes.push(k)}if(j!==undefined){this.opcodes.push(j)}},declare:function(i,j){this.opcodes.push("DECLARE");this.opcodes.push(i);this.opcodes.push(j)},addDepth:function(i){if(i===0){return}if(!this.depths[i]){this.depths[i]=true;this.depths.list.push(i)}},setupStackForMustache:function(i){var j=i.params;this.pushParams(j);if(i.hash){this.hash(i.hash)}this.ID(i.id);return j}};e.prototype={nameLookup:function(k,i,j){if(/^[0-9]+$/.test(i)){return k+"["+i+"]"}else{if(e.isValidJavaScriptVariableName(i)){return k+"."+i}else{return k+"['"+i+"']"}}},appendToBuffer:function(i){if(this.environment.isSimple){return"return "+i+";"}else{return"buffer += "+i+";"}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(i,j,l,k){this.environment=i;this.options=j||{};this.name=this.environment.name;this.isChild=!!l;this.context=l||{programs:[],aliases:{self:"this"},registers:{list:[]}};this.preamble();this.stackSlot=0;this.stackVars=[];this.compileChildren(i,j);var n=i.opcodes,m;this.i=0;for(b=n.length;this.i<b;this.i++){m=this.nextOpcode(0);if(m[0]==="DECLARE"){this.i=this.i+2;this[m[1]]=m[2]}else{this.i=this.i+m[1].length;this[m[0]].apply(this,m[1])}}return this.createFunctionContext(k)},nextOpcode:function(r){var o=this.environment.opcodes,m=o[this.i+r],l,p;var q,i;if(m==="DECLARE"){l=o[this.i+1];p=o[this.i+2];return["DECLARE",l,p]}else{l=f.DISASSEMBLE_MAP[m];q=f.multiParamSize(m);i=[];for(var k=0;k<q;k++){i.push(o[this.i+k+1+r])}return[l,i]}},eat:function(i){this.i=this.i+i.length},preamble:function(){var i=[];this.useRegister("foundHelper");if(!this.isChild){var j=this.namespace;var k="helpers = helpers || "+j+".helpers;";if(this.environment.usePartial){k=k+" partials = partials || "+j+".partials;"}i.push(k)}else{i.push("")}if(!this.environment.isSimple){i.push(", buffer = "+this.initializeBuffer())}else{i.push("")}this.lastContext=0;this.source=i},createFunctionContext:function(p){var q=this.stackVars;if(!this.isChild){q=q.concat(this.context.registers.list)}if(q.length>0){this.source[1]=this.source[1]+", "+q.join(", ")}if(!this.isChild){var k=[];for(var o in this.context.aliases){this.source[1]=this.source[1]+", "+o+"="+this.context.aliases[o]}}if(this.source[1]){this.source[1]="var "+this.source[1].substring(2)+";"}if(!this.isChild){this.source[1]+="\n"+this.context.programs.join("\n")+"\n"}if(!this.environment.isSimple){this.source.push("return buffer;")}var r=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var n=0,j=this.environment.depths.list.length;n<j;n++){r.push("depth"+this.environment.depths.list[n])}if(p){r.push(this.source.join("\n  "));return Function.apply(this,r)}else{var m="function "+(this.name||"")+"("+r.join(",")+") {\n  "+this.source.join("\n  ")+"}";Handlebars.log(Handlebars.logger.DEBUG,m+"\n\n");return m}},appendContent:function(i){this.source.push(this.appendToBuffer(this.quotedString(i)))},append:function(){var i=this.popStack();this.source.push("if("+i+" || "+i+" === 0) { "+this.appendToBuffer(i)+" }");if(this.environment.isSimple){this.source.push("else { "+this.appendToBuffer("''")+" }")}},appendEscaped:function(){var j=this.nextOpcode(1),i="";this.context.aliases.escapeExpression="this.escapeExpression";if(j[0]==="appendContent"){i=" + "+this.quotedString(j[1][0]);this.eat(j)}this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+i))},getContext:function(i){if(this.lastContext!==i){this.lastContext=i}},lookupWithHelpers:function(k,l){if(k){var i=this.nextStack();this.usingKnownHelper=false;var j;if(!l&&this.options.knownHelpers[k]){j=i+" = "+this.nameLookup("helpers",k,"helper");this.usingKnownHelper=true}else{if(l||this.options.knownHelpersOnly){j=i+" = "+this.nameLookup("depth"+this.lastContext,k,"context")}else{this.register("foundHelper",this.nameLookup("helpers",k,"helper"));j=i+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,k,"context")}}j+=";";this.source.push(j)}else{this.pushStack("depth"+this.lastContext)}},lookup:function(j){var i=this.topStack();this.source.push(i+" = ("+i+" === null || "+i+" === undefined || "+i+" === false ? "+i+" : "+this.nameLookup(i,j,"context")+");")},pushStringParam:function(i){this.pushStack("depth"+this.lastContext);this.pushString(i)},pushString:function(i){this.pushStack(this.quotedString(i))},push:function(i){this.pushStack(i)},invokeMustache:function(k,j,i){this.populateParams(k,this.quotedString(j),"{}",null,i,function(l,n,m){if(!this.usingKnownHelper){this.context.aliases.helperMissing="helpers.helperMissing";this.context.aliases.undef="void 0";this.source.push("else if("+m+"=== undef) { "+l+" = helperMissing.call("+n+"); }");if(l!==m){this.source.push("else { "+l+" = "+m+"; }")}}})},invokeProgram:function(k,l,j){var i=this.programExpression(this.inverse);var m=this.programExpression(k);this.populateParams(l,null,m,i,j,function(n,p,o){if(!this.usingKnownHelper){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";this.source.push("else { "+n+" = blockHelperMissing.call("+p+"); }")}})},populateParams:function(p,k,t,q,x,w){var l=x||this.options.stringParams||q||this.options.data;var j=this.popStack(),v;var n=[],m,o,u;if(l){this.register("tmp1",t);u="tmp1"}else{u="{ hash: {} }"}if(l){var s=(x?this.popStack():"{}");this.source.push("tmp1.hash = "+s+";")}if(this.options.stringParams){this.source.push("tmp1.contexts = [];")}for(var r=0;r<p;r++){m=this.popStack();n.push(m);if(this.options.stringParams){this.source.push("tmp1.contexts.push("+this.popStack()+");")}}if(q){this.source.push("tmp1.fn = tmp1;");this.source.push("tmp1.inverse = "+q+";")}if(this.options.data){this.source.push("tmp1.data = data;")}n.push(u);this.populateCall(n,j,k||j,w,t!=="{}")},populateCall:function(n,j,k,q,o){var m=["depth0"].concat(n).join(", ");var i=["depth0"].concat(k).concat(n).join(", ");var p=this.nextStack();if(this.usingKnownHelper){this.source.push(p+" = "+j+".call("+m+");")}else{this.context.aliases.functionType='"function"';var l=o?"foundHelper && ":"";this.source.push("if("+l+"typeof "+j+" === functionType) { "+p+" = "+j+".call("+m+"); }")}q.call(this,p,i,j);this.usingKnownHelper=false},invokePartial:function(i){params=[this.nameLookup("partials",i,"partial"),"'"+i+"'",this.popStack(),"helpers","partials"];if(this.options.data){params.push("data")}this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(i){var j=this.popStack();var k=this.topStack();this.source.push(k+"['"+i+"'] = "+j+";")},compiler:e,compileChildren:function(j,n){var p=j.children,r,q;for(var o=0,k=p.length;o<k;o++){r=p[o];q=new this.compiler();this.context.programs.push("");var m=this.context.programs.length;r.index=m;r.name="program"+m;this.context.programs[m]=q.compile(r,n,this.context)}},programExpression:function(k){if(k==null){return"self.noop"}var p=this.environment.children[k],o=p.depths.list;var n=[p.index,p.name,"data"];for(var m=0,j=o.length;m<j;m++){depth=o[m];if(depth===1){n.push("depth0")}else{n.push("depth"+(depth-1))}}if(o.length===0){return"self.program("+n.join(", ")+")"}else{n.shift();return"self.programWithDepth("+n.join(", ")+")"}},register:function(i,j){this.useRegister(i);this.source.push(i+" = "+j+";")},useRegister:function(i){if(!this.context.registers[i]){this.context.registers[i]=true;this.context.registers.list.push(i)}},pushStack:function(i){this.source.push(this.nextStack()+" = "+i+";");return"stack"+this.stackSlot},nextStack:function(){this.stackSlot++;if(this.stackSlot>this.stackVars.length){this.stackVars.push("stack"+this.stackSlot)}return"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(i){return'"'+i.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var a=("break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield").split(" ");var d=e.RESERVED_WORDS={};for(var c=0,b=a.length;c<b;c++){d[a[c]]=true}e.isValidJavaScriptVariableName=function(i){if(!e.RESERVED_WORDS[i]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(i)){return true}return false}})(Handlebars.Compiler,Handlebars.JavaScriptCompiler);Handlebars.precompile=function(d,c){c=c||{};var b=Handlebars.parse(d);var a=new Handlebars.Compiler().compile(b,c);return new Handlebars.JavaScriptCompiler().compile(a,c)};Handlebars.compile=function(b,a){a=a||{};var d;function c(){var g=Handlebars.parse(b);var f=new Handlebars.Compiler().compile(g,a);var e=new Handlebars.JavaScriptCompiler().compile(f,a,undefined,true);return Handlebars.template(e)}return function(f,e){if(!d){d=c()}return d.call(this,f,e)}};Handlebars.VM={template:function(a){var b={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(d,e,f){var c=this.programs[d];if(f){return Handlebars.VM.program(e,f)}else{if(c){return c}else{c=this.programs[d]=Handlebars.VM.program(e);return c}}},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(d,c){c=c||{};return a.call(b,Handlebars,d,c.helpers,c.partials,c.data)}},programWithDepth:function(b,d,c){var a=Array.prototype.slice.call(arguments,2);return function(f,e){e=e||{};return b.apply(this,[f,e.data||d].concat(a))}},program:function(a,b){return function(d,c){c=c||{};return a(d,c.data||b)}},noop:function(){return""},invokePartial:function(a,b,d,e,c,f){options={helpers:e,partials:c,data:f};if(a===undefined){throw new Handlebars.Exception("The partial "+b+" could not be found")}else{if(a instanceof Function){return a(d,options)}else{if(!Handlebars.compile){throw new Handlebars.Exception("The partial "+b+" could not be compiled when running in runtime-only mode")}else{c[b]=Handlebars.compile(a);return c[b](d,options)}}}}};Handlebars.template=Handlebars.VM.template;

//jQuery Nivo Slider v2.6
(function(a){var b=function(b,c){var d=a.extend({},a.fn.nivoSlider.defaults,c);var e={currentSlide:0,currentImage:"",totalSlides:0,randAnim:"",running:false,paused:false,stop:false};var f=a(b);f.data("nivo:vars",e);f.css("position","relative");f.addClass("nivoSlider");var g=f.children();g.each(function(){var b=a(this);var c="";if(!b.is("img")){if(b.is("a")){b.addClass("nivo-imageLink");c=b}b=b.find("img:first")}var d=b.width();if(d==0)d=b.attr("width");var g=b.height();if(g==0)g=b.attr("height");if(d>f.width()){f.width(d)}if(g>f.height()){f.height(g)}if(c!=""){c.css("display","none")}b.css("display","none");e.totalSlides++});if(d.startSlide>0){if(d.startSlide>=e.totalSlides)d.startSlide=e.totalSlides-1;e.currentSlide=d.startSlide}if(a(g[e.currentSlide]).is("img")){e.currentImage=a(g[e.currentSlide])}else{e.currentImage=a(g[e.currentSlide]).find("img:first")}if(a(g[e.currentSlide]).is("a")){a(g[e.currentSlide]).css("display","block")}f.css("background",'url("'+e.currentImage.attr("src")+'") no-repeat');f.append(a('<div class="nivo-caption"><p></p></div>').css({display:"none",opacity:d.captionOpacity}));var h=function(b){var c=a(".nivo-caption",f);if(e.currentImage.attr("title")!=""&&e.currentImage.attr("title")!=undefined){var d=e.currentImage.attr("title");if(d.substr(0,1)=="#")d=a(d).html();if(c.css("display")=="block"){c.find("p").fadeOut(b.animSpeed,function(){a(this).html(d);a(this).fadeIn(b.animSpeed)})}else{c.find("p").html(d)}c.fadeIn(b.animSpeed)}else{c.fadeOut(b.animSpeed)}};h(d);var i=0;if(!d.manualAdvance&&g.length>1){i=setInterval(function(){o(f,g,d,false)},d.pauseTime)}if(d.directionNav){f.append('<div class="nivo-directionNav"><a class="nivo-prevNav">'+d.prevText+'</a><a class="nivo-nextNav">'+d.nextText+"</a></div>");if(d.directionNavHide){a(".nivo-directionNav",f).hide();f.hover(function(){a(".nivo-directionNav",f).show()},function(){a(".nivo-directionNav",f).hide()})}a("a.nivo-prevNav",f).live("click",function(){if(e.running)return false;clearInterval(i);i="";e.currentSlide-=2;o(f,g,d,"prev")});a("a.nivo-nextNav",f).live("click",function(){if(e.running)return false;clearInterval(i);i="";o(f,g,d,"next")})}if(d.controlNav){var j=a('<div class="nivo-controlNav"></div>');f.append(j);for(var k=0;k<g.length;k++){if(d.controlNavThumbs){var l=g.eq(k);if(!l.is("img")){l=l.find("img:first")}if(d.controlNavThumbsFromRel){j.append('<a class="nivo-control" rel="'+k+'"><img src="'+l.attr("rel")+'" alt="" /></a>')}else{j.append('<a class="nivo-control" rel="'+k+'"><img src="'+l.attr("src").replace(d.controlNavThumbsSearch,d.controlNavThumbsReplace)+'" alt="" /></a>')}}else{j.append('<a class="nivo-control" rel="'+k+'">'+(k+1)+"</a>")}}a(".nivo-controlNav a:eq("+e.currentSlide+")",f).addClass("active");a(".nivo-controlNav a",f).live("click",function(){if(e.running)return false;if(a(this).hasClass("active"))return false;clearInterval(i);i="";f.css("background",'url("'+e.currentImage.attr("src")+'") no-repeat');e.currentSlide=a(this).attr("rel")-1;o(f,g,d,"control")})}if(d.keyboardNav){a(window).keypress(function(a){if(a.keyCode=="37"){if(e.running)return false;clearInterval(i);i="";e.currentSlide-=2;o(f,g,d,"prev")}if(a.keyCode=="39"){if(e.running)return false;clearInterval(i);i="";o(f,g,d,"next")}})}if(d.pauseOnHover){f.hover(function(){e.paused=true;clearInterval(i);i=""},function(){e.paused=false;if(i==""&&!d.manualAdvance){i=setInterval(function(){o(f,g,d,false)},d.pauseTime)}})}f.bind("nivo:animFinished",function(){e.running=false;a(g).each(function(){if(a(this).is("a")){a(this).css("display","none")}});if(a(g[e.currentSlide]).is("a")){a(g[e.currentSlide]).css("display","block")}if(i==""&&!e.paused&&!d.manualAdvance){i=setInterval(function(){o(f,g,d,false)},d.pauseTime)}d.afterChange.call(this)});var m=function(b,c,d){for(var e=0;e<c.slices;e++){var f=Math.round(b.width()/c.slices);if(e==c.slices-1){b.append(a('<div class="nivo-slice"></div>').css({left:f*e+"px",width:b.width()-f*e+"px",height:"0px",opacity:"0",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(f+e*f-f)+"px 0%"}))}else{b.append(a('<div class="nivo-slice"></div>').css({left:f*e+"px",width:f+"px",height:"0px",opacity:"0",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(f+e*f-f)+"px 0%"}))}}};var n=function(b,c,d){var e=Math.round(b.width()/c.boxCols);var f=Math.round(b.height()/c.boxRows);for(var g=0;g<c.boxRows;g++){for(var h=0;h<c.boxCols;h++){if(h==c.boxCols-1){b.append(a('<div class="nivo-box"></div>').css({opacity:0,left:e*h+"px",top:f*g+"px",width:b.width()-e*h+"px",height:f+"px",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(e+h*e-e)+"px -"+(f+g*f-f)+"px"}))}else{b.append(a('<div class="nivo-box"></div>').css({opacity:0,left:e*h+"px",top:f*g+"px",width:e+"px",height:f+"px",background:'url("'+d.currentImage.attr("src")+'") no-repeat -'+(e+h*e-e)+"px -"+(f+g*f-f)+"px"}))}}}};var o=function(b,c,d,e){var f=b.data("nivo:vars");if(f&&f.currentSlide==f.totalSlides-1){d.lastSlide.call(this)}if((!f||f.stop)&&!e)return false;d.beforeChange.call(this);if(!e){b.css("background",'url("'+f.currentImage.attr("src")+'") no-repeat')}else{if(e=="prev"){b.css("background",'url("'+f.currentImage.attr("src")+'") no-repeat')}if(e=="next"){b.css("background",'url("'+f.currentImage.attr("src")+'") no-repeat')}}f.currentSlide++;if(f.currentSlide==f.totalSlides){f.currentSlide=0;d.slideshowEnd.call(this)}if(f.currentSlide<0)f.currentSlide=f.totalSlides-1;if(a(c[f.currentSlide]).is("img")){f.currentImage=a(c[f.currentSlide])}else{f.currentImage=a(c[f.currentSlide]).find("img:first")}if(d.controlNav){a(".nivo-controlNav a",b).removeClass("active");a(".nivo-controlNav a:eq("+f.currentSlide+")",b).addClass("active")}h(d);a(".nivo-slice",b).remove();a(".nivo-box",b).remove();if(d.effect=="random"){var g=new Array("sliceDownRight","sliceDownLeft","sliceUpRight","sliceUpLeft","sliceUpDown","sliceUpDownLeft","fold","fade","boxRandom","boxRain","boxRainReverse","boxRainGrow","boxRainGrowReverse");f.randAnim=g[Math.floor(Math.random()*(g.length+1))];if(f.randAnim==undefined)f.randAnim="fade"}if(d.effect.indexOf(",")!=-1){var g=d.effect.split(",");f.randAnim=g[Math.floor(Math.random()*g.length)];if(f.randAnim==undefined)f.randAnim="fade"}f.running=true;if(d.effect=="sliceDown"||d.effect=="sliceDownRight"||f.randAnim=="sliceDownRight"||d.effect=="sliceDownLeft"||f.randAnim=="sliceDownLeft"){m(b,d,f);var i=0;var j=0;var k=a(".nivo-slice",b);if(d.effect=="sliceDownLeft"||f.randAnim=="sliceDownLeft")k=a(".nivo-slice",b)._reverse();k.each(function(){var c=a(this);c.css({top:"0px"});if(j==d.slices-1){setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed)},100+i)}i+=50;j++})}else if(d.effect=="sliceUp"||d.effect=="sliceUpRight"||f.randAnim=="sliceUpRight"||d.effect=="sliceUpLeft"||f.randAnim=="sliceUpLeft"){m(b,d,f);var i=0;var j=0;var k=a(".nivo-slice",b);if(d.effect=="sliceUpLeft"||f.randAnim=="sliceUpLeft")k=a(".nivo-slice",b)._reverse();k.each(function(){var c=a(this);c.css({bottom:"0px"});if(j==d.slices-1){setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed)},100+i)}i+=50;j++})}else if(d.effect=="sliceUpDown"||d.effect=="sliceUpDownRight"||f.randAnim=="sliceUpDown"||d.effect=="sliceUpDownLeft"||f.randAnim=="sliceUpDownLeft"){m(b,d,f);var i=0;var j=0;var l=0;var k=a(".nivo-slice",b);if(d.effect=="sliceUpDownLeft"||f.randAnim=="sliceUpDownLeft")k=a(".nivo-slice",b)._reverse();k.each(function(){var c=a(this);if(j==0){c.css("top","0px");j++}else{c.css("bottom","0px");j=0}if(l==d.slices-1){setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({height:"100%",opacity:"1.0"},d.animSpeed)},100+i)}i+=50;l++})}else if(d.effect=="fold"||f.randAnim=="fold"){m(b,d,f);var i=0;var j=0;a(".nivo-slice",b).each(function(){var c=a(this);var e=c.width();c.css({top:"0px",height:"100%",width:"0px"});if(j==d.slices-1){setTimeout(function(){c.animate({width:e,opacity:"1.0"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({width:e,opacity:"1.0"},d.animSpeed)},100+i)}i+=50;j++})}else if(d.effect=="fade"||f.randAnim=="fade"){m(b,d,f);var o=a(".nivo-slice:first",b);o.css({height:"100%",width:b.width()+"px"});o.animate({opacity:"1.0"},d.animSpeed*2,"",function(){b.trigger("nivo:animFinished")})}else if(d.effect=="slideInRight"||f.randAnim=="slideInRight"){m(b,d,f);var o=a(".nivo-slice:first",b);o.css({height:"100%",width:"0px",opacity:"1"});o.animate({width:b.width()+"px"},d.animSpeed*2,"",function(){b.trigger("nivo:animFinished")})}else if(d.effect=="slideInLeft"||f.randAnim=="slideInLeft"){m(b,d,f);var o=a(".nivo-slice:first",b);o.css({height:"100%",width:"0px",opacity:"1",left:"",right:"0px"});o.animate({width:b.width()+"px"},d.animSpeed*2,"",function(){o.css({left:"0px",right:""});b.trigger("nivo:animFinished")})}else if(d.effect=="boxRandom"||f.randAnim=="boxRandom"){n(b,d,f);var q=d.boxCols*d.boxRows;var j=0;var i=0;var r=p(a(".nivo-box",b));r.each(function(){var c=a(this);if(j==q-1){setTimeout(function(){c.animate({opacity:"1"},d.animSpeed,"",function(){b.trigger("nivo:animFinished")})},100+i)}else{setTimeout(function(){c.animate({opacity:"1"},d.animSpeed)},100+i)}i+=20;j++})}else if(d.effect=="boxRain"||f.randAnim=="boxRain"||d.effect=="boxRainReverse"||f.randAnim=="boxRainReverse"||d.effect=="boxRainGrow"||f.randAnim=="boxRainGrow"||d.effect=="boxRainGrowReverse"||f.randAnim=="boxRainGrowReverse"){n(b,d,f);var q=d.boxCols*d.boxRows;var j=0;var i=0;var s=0;var t=0;var u=new Array;u[s]=new Array;var r=a(".nivo-box",b);if(d.effect=="boxRainReverse"||f.randAnim=="boxRainReverse"||d.effect=="boxRainGrowReverse"||f.randAnim=="boxRainGrowReverse"){r=a(".nivo-box",b)._reverse()}r.each(function(){u[s][t]=a(this);t++;if(t==d.boxCols){s++;t=0;u[s]=new Array}});for(var v=0;v<d.boxCols*2;v++){var w=v;for(var x=0;x<d.boxRows;x++){if(w>=0&&w<d.boxCols){(function(c,e,g,h,i){var j=a(u[c][e]);var k=j.width();var l=j.height();if(d.effect=="boxRainGrow"||f.randAnim=="boxRainGrow"||d.effect=="boxRainGrowReverse"||f.randAnim=="boxRainGrowReverse"){j.width(0).height(0)}if(h==i-1){setTimeout(function(){j.animate({opacity:"1",width:k,height:l},d.animSpeed/1.3,"",function(){b.trigger("nivo:animFinished")})},100+g)}else{setTimeout(function(){j.animate({opacity:"1",width:k,height:l},d.animSpeed/1.3)},100+g)}})(x,w,i,j,q);j++}w--}i+=100}}};var p=function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a};var q=function(a){if(this.console&&typeof console.log!="undefined")console.log(a)};this.stop=function(){if(!a(b).data("nivo:vars").stop){a(b).data("nivo:vars").stop=true;q("Stop Slider")}};this.start=function(){if(a(b).data("nivo:vars").stop){a(b).data("nivo:vars").stop=false;q("Start Slider")}};d.afterLoad.call(this);return this};a.fn.nivoSlider=function(c){return this.each(function(d,e){var f=a(this);if(f.data("nivoslider"))return f.data("nivoslider");var g=new b(this,c);f.data("nivoslider",g)})};a.fn.nivoSlider.defaults={effect:"random",slices:15,boxCols:8,boxRows:4,animSpeed:500,pauseTime:3e3,startSlide:0,directionNav:true,directionNavHide:true,controlNav:true,controlNavThumbs:false,controlNavThumbsFromRel:false,controlNavThumbsSearch:".jpg",controlNavThumbsReplace:"_thumb.jpg",keyboardNav:true,pauseOnHover:true,manualAdvance:false,captionOpacity:.8,prevText:"Prev",nextText:"Next",beforeChange:function(){},afterChange:function(){},slideshowEnd:function(){},lastSlide:function(){},afterLoad:function(){}};a.fn._reverse=[].reverse})(jQuery)

//give feedback
function ReviewUs(strServiceUrl, strFunctionCall, strParams) {
    var strRetVal = '';
    var httpRequest;
    if (window.XMLHttpRequest) {
        httpRequest = new XMLHttpRequest();
        if (httpRequest.overrideMimeType) {
            httpRequest.overrideMimeType("text/xml");
        }
    } else if (window.ActiveXObject) {
        try {
            httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
        } catch (e) {
            try {
                httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
            } catch (e) {}
        }
    }
    if (!httpRequest) {
        return false;
    }
    httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState == 4) {
            var xmldoc = httpRequest.responseXML;
            var root_node = xmldoc.getElementsByTagName("int")[0];
            if (root_node.firstChild) {
                $(this).lpModal({
                    onInit:true,
                    width:600,
                    height:500,
                    src:"/secure/RateThisPage/default.aspx?Location="+root_node.firstChild.nodeValue
                });
            } else {
                theForm.btnSendEmail.disabled = "false";
                alert("There was a problem sending your email. Please make sure the email address is valid.");
            }
        }
    };
    httpRequest.open('GET', strServiceUrl + '/' + strFunctionCall + strParams, true);
    httpRequest.send(null);
}
function popupRateThisPage() {
    var strValues = "?url=" + encodeURIComponent(window.location);
    ReviewUs(window.location.href.substr(0, 5).replace(":", "") + "://" + document.domain + "/WebServices/EmailToFriend.asmx", "getLocationId", strValues)
    return false;
}

// on doc ready
$(function () {

    //sign in link click
    $("#hdrSignIn").click(function(){
        //get link's href
        var href = $(this).attr("href"),
        //get return url from link
        returnUrl = href.slice(href.indexOf('?') + 1).replace("ReturnUrl=","");
        //if page is secure use secure sign in tooltip
        if("https:" == location.protocol) {
            $("#hdrWrapper").append("<iframe id=\"signInToolTip\" width=\"310\" height=\"350\" src=\"/secure/account/popups/sign-in-small.aspx?ReturnUrl=" + returnUrl + "\" scrolling=\"no\" horizontalscrolling=\"no\" verticalscrolling=\"no\" frameborder=\"0\"></iframe>");
        //if page is unsecure use unsecure sign in tooltip
        } else {
            $("#hdrWrapper").append("<iframe id=\"signInToolTip\" width=\"310\" height=\"350\" src=\"/popups/sign-in.aspx?ReturnUrl=" + returnUrl + "\" scrolling=\"no\" horizontalscrolling=\"no\" verticalscrolling=\"no\" frameborder=\"0\"></iframe>");
        }
        //fade in tooltip
        $("#signInToolTip").fadeIn(500, function(){
            //hide tooltip if click outside tooltip
            $("html").click(function() {
                $("#signInToolTip").fadeOut(300, function(){
                    $(this).remove();
                });
            });
            $("#signInToolTip").click(function(event){
                event.stopPropagation();
            });
        });
        return false;
    });

    //on Enter, submit the Kiosk Employee Store Number Update
    if($('.storeNum').is('*')) {
        $('.storeNum').first().keydown(function(e){
            if(e.which == 13){
                e.preventDefault();
                $('.storeUpdate').first().click();
                return false;
            }
        });
    }

    //add side column to sort page/landing pages/any page needing it
    if($(".siteSideCol").length){
        $.ajax({
            url: "/includes/site-side-col.html",
            success: function(data){
                //append info
                $(".siteSideCol").prepend(data);

                //side column email subscription
                $("#siteSideEmailUpdatesRequest").usableLabelField({
                    labelID: "siteSideEmailUpdatesRequestLabel",
                    btnID: "siteSideSubscribeBtn"
                });

                //side column email sign up
                $("#siteSideSubscribeBtn").click(function () {
                    var objEmail = $("#siteSideEmailUpdatesRequest").val();
                    if (objEmail != null) {
                        var email = objEmail.replace(/</g, '').replace(/>/g, '');
                        if (email.length > 0) {
                            var URL = 'https://' + ((document.domain == 'www.lampsplus.com') ? 'secure.lampsplus.com' : document.domain) + '/secure/email/index.aspx';
                            window.location = (URL + '?txtGetEmailUpdates=' + email);
                        } else {
                            return;
                        }
                    } else {
                        return;
                    }
                });
            }
        });
    }

    // Email Subscription - Footer
    $("#txtEmailUpdatesRequest").usableLabelField({
        labelID: "emailUpdatesRequestLabel",
        btnID: "ftrSubscribeBtn"
    });

    //footer email sign up functionality
    $("#ftrSubscribeBtn").click(function () {
        var objEmail = $("#txtEmailUpdatesRequest").val();
        if (objEmail != null) {
            var email = objEmail.replace(/</g, '').replace(/>/g, '');
            if (email.length > 0) {
                var URL = 'https://' + ((document.domain == 'www.lampsplus.com') ? 'secure.lampsplus.com' : document.domain) + '/secure/email/index.aspx';
                window.location = (URL + '?txtGetEmailUpdates=' + email);
            } else {
                return;
            }
        } else {
            return;
        }
    });

    //get full year for footer copyright
    $("#ftrFullYear").append(new Date().getFullYear());

    //rate us
    $("#rateUs a, .rateThisPage").click(popupRateThisPage);

    GetCartCount();

});

//core metrics impression tagging
function ThrowCMImpressionTag(divId) {
    if (typeof cmCreateManualImpressionTag == 'function') {
        switch (divId) {
        case 'divCeilingLights':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Lights-_-DYO-Art-Shade-Lighting-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Lights-_-Lighting-Collections-sm', null);
            break;
        case 'divLamps':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Lamps-_-Art-Shade', null);
            break;
        case 'divWallLights':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Wall-Lights-_-Free-Shipping-Bath-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Wall-Lights-_-Free-Shipping-Wall-sm', null);
            break;
        case 'divOutdoorLights':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Outdoor-Lights-_-Free-Shipping-Outdoor-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Outdoor-Lights-_-Deal-of-the-Day-sm', null);
            break;
        case 'divCeilingFans':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Fans-_-DYO-Ceiling-Fan-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Ceiling-Fans-_-Free-Shipping-Casa-Vieja-sm', null);
            break;
        case 'divFurniture':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Furniture-_-Seating', null);
            break;
        case 'divDecor':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Decor-_-DYO-Artwork', null);
            break;
        case 'divFloorLamps':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-Floor-Lamps-_-DYO-Art-Shade-Lighting', null);
            break;
        case 'divMore':
            cmCreateManualImpressionTag('', 'Nav-Banner-_-More-_-Light-Bulbs-sm', null);
            cmCreateManualImpressionTag('', 'Nav-Banner-_-More-_-Dimmers-sm', null);
            break;
        }
    }
}

//cookies disabled functionality
var cookieEnabled = (navigator.cookieEnabled)? true : false
if(cookieEnabled == false){
    $("#noCookiesContainerBkg").show();
    $("#noCookiesContainer").append("<p>Your Cookies setting is not enabled! You have either disabled it or are using an older browser that does not support it. Because of this, you will not be able to view our web pages or use our site features. In order to browse our site, please turn on Cookies in your browser settings.</p>");
    $("#noCookiesContainer").show();
}

function numericOnly(oTextbox, evt) {
    k = evt.which;
    if (k == 13 || k == 0) {
        return true;
    }
    if (((k < 48 || k > 57) && (k < 96 || k > 105) && k != 8 && k != 9 && k != 13 && k != 37 && k != 39 && k != 46) || evt.shiftKey == 1) {
        return false;
    } else {
        return true;
    }
}