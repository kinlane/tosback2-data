if(window.BrightTag==undefined){window.BrightTag={};BrightTag.module=function(a,h){for(var d=BrightTag,k=a.split("."),j=k.pop(),f=undefined,g=0,b=k.length;g<b;g++){f=k[g];d[f]||(d[f]={});d=d[f]}return d[j]||(d[j]=h)};BrightTag.each=function(a,h){if(a)if(BrightTag.Types.isArray(a)||a.length)for(var d=0,k=a.length;d<k;d++)h(a[d],d);else if(BrightTag.Types.isObject(a))for(d in a)a.hasOwnProperty(d)&&h(d,a[d])};BrightTag.pushIfDefined=function(a,h,d){if(a&&a.constructor==Array&&h!=null)a.push(d||h)};
BrightTag.extend=function(a,h){for(var d in h)if(h.hasOwnProperty(d))a[d]=h[d];return a};BrightTag.trim=function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};BrightTag.eval=function(a,h){try{return eval.call(undefined,a)}catch(d){h&&h(d)}};BrightTag.Types={isString:function(a){return Object.prototype.toString.call(a)==="[object String]"},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isNumber:function(a){return Object.prototype.toString.call(a)==="[object Number]"},
isFunction:function(a){return Object.prototype.toString.call(a)==="[object Function]"},isObject:function(a){if(a===null||a===undefined)return false;return Object.prototype.toString.call(a)==="[object Object]"}};BrightTag.Escaper={cookie:function(a){if(!BrightTag.Types.isString(a))return a;return a.replace(/%/g,"%25").replace(/#/g,"%23").replace(/&/g,"%26").replace(/'/g,"%27").replace(/;/g,"%3B").replace(/</g,"%3C").replace(/>/g,"%3E")},javascript:function(a){if(!BrightTag.Types.isString(a))return a;
return a.replace(/\\/g,"\\\\").replace(/'/g,"\\x27").replace(/"/g,"\\x22").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}};BrightTag.Random={integer:function(a){return Math.floor(Math.random()*(a||1E8))}};BrightTag.defaultConfig=function(){return{loadOnly:false,window:window,document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,data:{},errorManager:new BrightTag.ErrorManager(new BrightTag.HTTP.Cookie(document))}}}
BrightTag.module("Blab",{});
BrightTag.module("Blab.Engine",function(a){function h(){p=true;u=r.length;e("engine:off")}function d(){p=false;t=0;(r[u++]||h)()}function k(){e("block:finish");d()}function j(m){return function(){var v=false,l=a.createElement("script");l.onload=l.onreadystatechange=function(){var s;if(!(s=v)){a:{switch(l.readyState){case undefined:case "loaded":case "complete":s=true;break a}s=false}s=!s}if(!s){v=true;k()}};l.onerror=function(){e("block:error",{type:"script",exception:"Problem loading "+m});v||k()};
l.src=m;e("block:start",m);var o=a.getElementsByTagName("script")[0];o.parentNode.insertBefore(l,o)}}function f(m){return function(){try{e("block:start",m);if(m.constructor==String)if(a.defaultView)a.defaultView.eval.call(undefined,m);else a.parentWindow?a.parentWindow.execScript(m):e("block:error",{type:"wait",exception:"Could not evaluate wait block ["+m+"]"});else m()}catch(v){e("block:error",{type:"wait",exception:v})}finally{k()}}}function g(m){r.push(m);p&&d();return c}function b(m){r.splice(u+
t++,0,m);return c}function e(m){var v=Array.prototype.slice.call(arguments,1);BrightTag.each(n,function(l){var o=[c].concat(v);(l[m]||i).apply(null,o)})}var c=this,i=function(){},n=[],p=false,q={},r=[],u=0,t=0;c.run=function(){e("engine:on");d()};c.options=function(m){BrightTag.extend(q,m);return c};c.option=function(m){return q[m]};c.script=function(m){return g(j(m))};c.wait=function(m){return g(f(m))};c.preemptScript=function(m){return b(j(m))};c.preemptWait=function(m){return b(f(m))};c.listen=
function(m){n.push(m);(m["engine:listen"]||i).apply(null,[c]);return c}});BrightTag.module("Blab.Group",function(){function a(b){j.push(b)}function h(b){b.run()}function d(){var b=j[f++];b?b.listen(g).run():k.doNotQueue()}var k=this,j=[],f=0,g={"engine:off":function(){d()}};k.doNotQueue=function(){a=h};k.push=function(b){a(b);return b};k.run=function(){d()};k.applyListener=function(b){for(var e=f,c=j.length;e<c;e++)j[e].listen(b)}});
BrightTag.module("Blab.Manager",function(a){function h(g){var b=new k.Engine(a);d.each(f,function(e){b.listen(e)});return(j[g]||(j[g]=new k.Group)).push(b)}var d=BrightTag,k=d.Blab,j={undefined:new k.Group},f=[];j[undefined].doNotQueue();this.addGlobalListener=function(g){f.push(g);d.each(j,function(b){j[b].applyListener(g)})};this.group=function(g){return h(g)};this.listen=function(){return h().listen.apply(null,arguments)};this.script=function(){return h().script.apply(null,arguments)};this.wait=
function(){return h().wait.apply(null,arguments)};this.run=function(g){(j[g]||(j[g]=new k.Group)).run()};this.setOptions=function(){return h()}});
BrightTag.module("Blab.SwapwriteListener",function(){var a,h=[],d=function(k){a.push(k)};return function(k){function j(e){e.src&&g.preemptScript(e.src);e.innerHTML&&g.preemptWait(e.innerHTML)}function f(e){try{k.body.appendChild(e.cloneNode(true))}catch(c){bt_handle_exception("BrightTag: error appending content to body: "+c)}}var g,b=k.createElement("div");this["block:start"]=function(){var e=k;h.push([a,e.write,e.writeln]);a=[];e.write=e.writeln=d};this["block:finish"]=function(){try{if(a.length!=
0){b.innerHTML="<br/>"+a.join("");for(var e=b.childNodes||[],c=1,i=e.length;c<i;c++)(e[c].tagName=="SCRIPT"?j:f)(e[c])}}finally{e=k;c=h.pop();a=c[0];e.write=c[1];e.writeln=c[2]}};this["engine:listen"]=function(e){g=e}}}());BrightTag.module("Blab.GlobalSwapwriteListener",function(a){var h=BrightTag.Blab;this["engine:listen"]=function(d){d.listen(new h.SwapwriteListener(a))}});
BrightTag.module("EventsManager",function(){function a(){}function h(b,e,c){g(b,e,function(){if(!c||c())BrightTag.EventListenerOverride(b,e)})}function d(b){b=b.documentElement.doScroll||function(){throw"No doScroll";};try{b("left")}catch(e){return false}return true}function k(b){var e=b.readyState;return e=="loading"?false:e=="complete"?true:b.addEventListener?e=="interactive":d(b)}function j(b,e,c){var i=this;setTimeout(function(){b()?e.call(i):j(b,e,c)},c)}var f=this,g=f.listen=function(b,e,c){if(b.addEventListener)b.addEventListener(e,
c,false);else b.attachEvent&&b.attachEvent("on"+e,c)};f.domReady=function(b,e){if(k(b))e.call(this);else b.addEventListener?g(b,"DOMContentLoaded",e):j(function(){return k(b)},e,1)};f.enablePageReadyOverrides=function(b,e){f.enablePageReadyOverrides=a;e.readyState=="complete"?BrightTag.EventListenerOverride(b,"load"):h(b,"load");if(e.addEventListener){var c=e.readyState;c=="complete"||c=="interactive"?BrightTag.EventListenerOverride(e,"DOMContentLoaded"):h(e,"DOMContentLoaded")}}});
BrightTag.module("EventListenerOverride",function(a,h){function d(f){var g=this;setTimeout(function(){try{f.call(g)}catch(b){bt_handle_exception("BrightTag error overriding "+h+" event: "+b)}},0)}var k=a.addEventListener?"addEventListener":"attachEvent",j=a[k];a[k]=function(f,g,b){if(typeof g=="function")if(f==h||f=="on"+h)d(g);else try{k=="addEventListener"?j.call(a,f,g,b):j(f,g)}catch(e){bt_handle_exception("BrightTag error proxying "+f+" event: "+e)}}});BrightTag.module("Events",new BrightTag.EventsManager);
BrightTag.module("EventBindingManager",function(a){var h={},d=[],k=BrightTag.jQueryLoader(a,"BrightTag.jQuery");h.Binder=function(g){var b=this,e=[];b.data=function(c,i){e.push({name:c,dbe:i});return b};b.bindData=function(c,i,n){BrightTag.each(e,function(p){try{BrightTag.instance.data(p.name,k.functionWithAccess(["eventObject","eventData"],"return "+p.dbe+";").call(c,i,n))}catch(q){bt_log("Error binding "+p+": "+q)}})};b.handler=function(c){var i=d[g];if(i){var n=Array.prototype.slice.call(arguments,
1);b.bindData(c.target,c,n);i.handler(c,n)}}};var j=function(){function g(p,q){return function(r){bt_handle_exception("Invalid "+p+" expression: "+q+", exception = "+r)}}var b=this,e=[],c=[],i="true";b.evaluate=function(p){i=p;return b};b.execute=function(p){if(p.constructor==Function)e.push(p);else if(p.constructor==String)try{e.push(k.functionWithAccess(["eventObject","eventData"],p))}catch(q){bt_handle_exception("BrightTag could not execute action: "+q)}else bt_log("execute: bad action = "+p);
return b};b.fire=function(p){p=new n(p);c.push(p);return p};b.handler=function(p,q){var r=g("post-event conditional fire",i);if(BrightTag.eval(i,r)){h.executeActions(e,p,q);h.fireTags(c)}};var n=function(p){var q=this,r=[];q.appendData=function(u){r.push(function(t){t.appendData(u)});return q};q.appendJs=function(u){r.push(function(t){t.appendJs(u)});return q};q.postProcess=function(u){BrightTag.each(r,function(t){t(u)})};q.tagId=p;q.execute=b.execute;q.fire=b.fire;q.evaluate=b.evaluate}},f=/^direct\//i;
h.bind=function(g,b,e){var c=new h.Binder(g);k.ensureJQuery(function(){var i=k.getJQuery()(b);i.live&&b.constructor===String&&!f.test(e)?i.live(e,c.handler):i.bind(e.split(f).pop(),c.handler)});return c};h.when=function(g){return d[g]||(d[g]=new j)};h.executeActions=function(g,b,e){BrightTag.each(g,function(c){try{c.call(b.target,b,e)}catch(i){bt_handle_exception(i)}})};h.fireTags=function(g){if(g.length>0){var b=BrightTag.instance.serverURL();BrightTag.each(g,function(e){b.cf(e.tagId);e.postProcess(b)});
BrightTag.Blab.script(b.asString())}};return h});BrightTag.module("HTTP",{});
BrightTag.module("HTTP").Cookie=function(a){function h(j){var f,g;j=j.split(/; ?/);for(var b=0,e=j.length;b<e;b++){g=j[b];f=g.indexOf("=");var c=k,i=g.slice(0,f);f=g.slice(f+1);f=unescape(f);c[i]=f}}var d=this,k={};d.get=function(j){return k[j]};d.remove=function(j){d.set(j,"",{expires:0})};d.set=function(j,f,g){if(j){g=g||{};j=[j+"="+BrightTag.Escaper.cookie(f||"")];if((f=g.expires)||f===0){if(BrightTag.Types.isNumber(f))f=(new Date(f)).toGMTString();j.push("expires="+f)}(f=g.path)&&j.push("path="+
f);(f=g.domain)&&j.push("domain="+f);g.secure===true&&j.push("Secure");g.httponly===true&&j.push("HttpOnly");a.cookie=j.join("; ");h(a.cookie)}};d.findEach=function(j,f){for(key in k)k.hasOwnProperty(key)&&key.match(j)&&f(key,k[key])};h(a.cookie||"")};
BrightTag.module("HTTP").QueryString=function(a){function h(f){if(f&&typeof f=="string"){var g=f.split("&");f={};k.each(g,function(b){b=b.split("=");b={key:decodeURIComponent(b[0]),value:b[1]&&decodeURIComponent(b[1].replace(/\+/g," "))};f[b.key]=b.value})}return f}var d=this,k=BrightTag,j={};k.extend(j,h(a));d.param=function(f){return j[f]||""};d.params=function(){return j};d.appendParam=function(f,g){if(f&&g!=undefined&&g!=="")j[f]=g;return this};d.appendParams=function(f){k.each(f,d.appendParam);
return this};d.alwaysAppendParam=function(f,g){if(f)j[f]=g!=undefined?g:"";return this};d.alwaysAppendParams=function(f){k.each(f,d.alwaysAppendParam);return this};d.appendPartialQueryString=function(f){f&&d.alwaysAppendParams(h(f));return this};d.deleteParam=function(f){delete j[f]};d.toString=function(){var f=[];for(var g in j){var b={key:encodeURIComponent(g),value:encodeURIComponent(j[g])};f.push(b.key+"="+b.value)}return f.join("&")}};
BrightTag.module("HTTP").URL=function(a){var h=this,d,k,j,f=a.indexOf("#");if(f>-1){j=a.substring(f+1);a=a.substring(0,f)}f=a.indexOf("?");if(f>-1){k=a.substring(f+1);a=a.substring(0,f)}d=a;a=new BrightTag.HTTP.QueryString(k);BrightTag.extend(h,a);h.queryString=a.toString;h.toString=function(){var g=h.queryString();return d+(g.length>0?"?"+g:"")};h.asString=h.toString;h.fragment=function(){return j}};
BrightTag.module("ServerURL",function(a){function h(c,i){return function(n){bt_handle_exception("Invalid "+c+" expression: "+i+", exception = "+n)}}var d=this,k=a.host,j=BrightTag,f=a.window,g=a.parentReferrer,b=a.referrer,e="";if(k.length>0)e=(k.match("^[a-z0-9+.-]+://.+")?"":"//")+k+"/tag";j.HTTP.URL.call(this,e);d.appendParams({site:a.site,referrer:b,docReferrer:a.docReferrer,mode:a.mode});b!==g&&d.appendParam("parentReferrer",g);d.appendData=function(c){var i=bt_data(c),n;a:switch(Object.prototype.toString.apply(i)){case "[object Array]":case "[object Object]":n=
true;break a;default:n=false;break a}i=n?f.JSON.stringify(i):i;return d.alwaysAppendParam("_cb_"+("bt_data('"+c+"')"),i)};d.appendJs=function(c){var i=h("inline JavaScript",c);return d.alwaysAppendParam("_cb_"+c,j.eval(c,i))};d.cf=function(c){if(c.constructor!=Array)c=[c];var i=d.param("cf");if(i)c=Array(i).concat(c);d.appendParam("cf",c.join());return d};d.addCf=function(c,i){if(!j.eval(i,h("conditional fire",i)))return false;var n=d.param("cf");d.appendParam("cf",n?n+","+c:c);return true}});
BrightTag.module("Page",function(a,h){function d(l){i.each(i.Types.isArray(l)?l:[l],function(o){i.Types.isFunction(o)?o():r.write('<script type="text/javascript" src="'+o+'"><\/script>')})}function k(l){var o=t.group();i.each(i.Types.isArray(l)?l:[l],function(s){(i.Types.isFunction(s)?o.wait:o.script)(s)})}function j(l){r.write(l)}function f(l,o){var s={};if(o&&o.tagId)s.tagId=o.tagId;t.group(!v?"domready":undefined).options(s).wait(function(){r.write(l)})}function g(l){c.writeScript=l?d:k;c.appendContent=
l?j:f}function b(l){var o={site:a.site,referrer:a.referrer||r.location.href};if(m.hasErrors()){l.appendParam("errors",m.toJSON());if(l.toString().length>2083){l.deleteParam("errors");m.reset(o);m.push({type:"runtime",message:"Too many errors"});l.appendParam("errors",m.toJSON())}}m.reset(o)}function e(l){(new i.HTTP.Cookie(r)).findEach(/^btps\..+/,function(o,s){l.appendParam(o,s)})}var c=this,i=BrightTag,n=undefined,p=a.data||{},q=undefined,r=a.document||{},u=a.window||{},t=a.blab||i.Blab,m=a.errorManager,
v=false;c.referrer=a.referrer;c.parentReferrer=a.parentReferrer;c.docReferrer=a.docReferrer;m&&t.addGlobalListener(m);g(a.mode==="sync");c.domReady=function(){v=true;t.addGlobalListener(new t.GlobalSwapwriteListener(r));a.mode==="sync"&&g(false);t.run("domready")};c.parameter=function(l){if(n==undefined)n=new i.HTTP.URL(r.location.href);return n.param(l)};c.meta=function(l){if(!q){q={};i.each(r.getElementsByTagName("meta"),function(o){q[o.getAttribute("name")]=o.getAttribute("content")})}return q[l]||
""};c.data=function(l,o){if(o!==undefined)return p[l]=o;o=p[l];return o==undefined?"":o};c.dbe=function(l,o,s){c.data(l,i.eval(o,function(w){if(m){var x=s||{};m.push({type:"dbe",message:w.toString(),"dbe.name":l,pageId:x.pageId||-1})}}))};c.errors=function(l){m.configure(l)};c.serverURL=function(){return new i.ServerURL(a)};c.defaultBaseUri=function(){return(r.location.protocol=="https:"?"https:":"http:")+"//s.btstatic.com/"};c.baseUri=function(){var l=/\btag(\.[^.]+|-n)?\.js(#.*)?$/;return h&&h.src&&
h.src.replace(l,"")||c.defaultBaseUri()};c.primary=function(){function l(){var o=c.serverURL();e(o);if(m){m.processStoredErrors();b(o)}c.writeScript(o.toString())}u.JSON?l():c.writeScript([c.baseUri()+"json2.js",l])};c.secondary=function(l){var o=c.serverURL(),s=o.toString();l(o);if(o.toString()!=s){e(o);m&&b(o);c.writeScript(o.toString())}}});
BrightTag.module("ErrorManager",function(a){function h(i){var n=g.isObject(i)?f.extend({},i):{};n.type=n.type||"unknown";n.message=n.message||i.toString();n.timestamp=c;return n}if(!a)throw"ErrorManager requires a store";var d=this,k,j,f=BrightTag,g=f.Types,b=true,e=[],c=+new Date;d.configure=function(i){if(i.hasOwnProperty("enabled"))b=i.enabled;if(i.hasOwnProperty("timestamp"))c=i.timestamp};d.hasErrors=function(){return e.length>0};d.toArray=function(){return e};d.toJSON=function(){try{return JSON.stringify({site:k,
referrer:j,errors:e})}catch(i){bt_log("BrightTag: problem serializing errors: "+i.message)}};d.reset=function(i){k=i.site;j=i.referrer;e=[];a.remove("__bterr")};d.push=function(i){bt_log("BrightTag: error: "+JSON.stringify(i));if(b&&i){e.push(h(i));a.set("__bterr",d.toJSON())}};d["block:error"]=function(i,n){if(n){var p=n.type,q=n.exception||n,r=i.option("tagId")||-1;d.push({type:p,message:q.toString(),tagId:r})}};d.processStoredErrors=function(){var i=a.get("__bterr");if(i)try{var n=JSON.parse(i);
k=n.site;j=n.referrer;if(g.isArray(n.errors))e=e.concat(n.errors)}catch(p){bt_log("BrightTag: problem reading stored errors: "+p.message)}}});
BrightTag.module("CookieSyncEngine",function(a){var h={fn:function(b){b()},next:null},d=h,k=a.document,j=function(b){if(typeof b!="function")return false;b={fn:b,next:null};d=d.next=b;return true},f=function(){if(h){var b=h.fn;h=h.next;b(f)}},g=f;BrightTag.Events.listen(a,"load",g);return{sync:g,push:function(b){return j(b)},pushImage:function(b){return j(function(e){var c=new a.Image;c.onerror=c.onload=e;c.src=b})},pushIframe:function(b){return j(function(e){var c=k.createElement("iframe");c.onerror=
c.onload=e;c.width=0;c.height=0;c.style.border=0;c.src=b;k.body.appendChild(c)})}}});function bt_parameter(a){return BrightTag.instance.parameter(a)}function bt_meta(a){return BrightTag.instance.meta(a)}function bt_data(a,h){return BrightTag.instance.data(a,h)}function bt_data_escaped(a,h){return bt_data(a,h)}function bt_log(a){window.console&&console.log&&console.log(a)}var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;
function btServe(a){if(BrightTag.instance==undefined){var h=BrightTag,d=h.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},h.defaultConfig());if(_bt_url_prefix!=undefined)d.host=_bt_url_prefix;h.instance=h.Main(h.extend(d,a||{}))}}
BrightTag.module("jQueryLoader",function(a,h){return new (function(d,k){function j(i){c.wait(i)}function f(i){function n(){b=BrightTag.jQuery;j(i)}e="var $ = BrightTag.$; ";BrightTag.jQuery?n():c.script(BrightTag.instance.baseUri()+"BrightTag.jquery-1.5.1.js").wait(n)}var g={},b=d.jQuery,e="",c=BrightTag.Blab.group(k);g.getJQuery=function(){return b};g.functionWithAccess=function(i,n){return new Function(i,e+n)};g.ensureJQuery=function(i){g.ensureJQuery=j;(b?j:f)(i);BrightTag.Blab.run(k)};return g})(a,
h)});
BrightTag.module("Main",function(a){function h(b){(b=(new k.HTTP.URL(b.src)).fragment())&&k.extend(a,(new k.HTTP.QueryString(b)).params())}function d(b){b=k.trim(b.innerHTML);b.length!=0&&k.extend(a,k.eval("(\n"+b+"\n)",function(e){bt_handle_exception("BrightTag configuration error: "+e)}))}var k=BrightTag,j=function(){for(var b=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/,e=a.document.getElementsByTagName("script"),c=e.length-1;c>-1;c--){var i=e[c];if(b.test(i.src))return i}}();if(j){h(j);d(j)}if(a.site!=undefined){k.Events.enablePageReadyOverrides(a.window,
a.document);try{var f=new k.Page(a,j);k.Events.domReady(a.document,function(){f.domReady()});a.loadOnly||f.primary();return f}catch(g){bt_handle_exception("BrightTag execution error: "+g)}}});(function(a){if(a.instance==undefined){a.extend(a.Blab,new a.Blab.Manager(document));a.$LAB=a.Blab;a.EventBinding=a.EventBindingManager(window);a.CookieSync=a.CookieSyncEngine(window);a.instance=a.Main(a.defaultConfig())}else bt_log("Tried to load tag.js again")})(window.BrightTag);
