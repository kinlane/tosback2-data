 Groupon.Finch={};Groupon.Finch={init:function(){this.trigger('init');},onReady:function(f){this.onReadyFunctions=this.onReadyFunctions||[];this.onReadyFunctions.push(f);},execute:function(){if(!this.onReadyFunctions)return;for(i=0;i<this.onReadyFunctions.length;i++){this.onReadyFunctions[i].call();}},trigger:function(key){if(!this._events||!this._events[key])return false;for(var i=0;i<this._events[key].length;i++)
this._events[key][i].apply(this);return true;},bind:function(key,func){this._events=this._events||{};this._events[key]=this._events[key]||[];this._events[key].push(func);return this;}};Groupon.Finch.bind('init',function(){if(!(/finch_init/).test(document.documentElement.className))
document.documentElement.className+=' finch_init';});Groupon.Finch.bind('run',function(){document.documentElement.className=document.documentElement.className.replace('finch_init','');});Groupon.Finch.init();Groupon.Finch.GrouponAnalyticsTracker={track:function(experimentSets){_(experimentSets).each(function(experimentSet){layerName=experimentSet.layer.name;experimentId=experimentSet.experiment.id;variantName=experimentSet.variant;if(!window._gaq)
Groupon.Analytics.Google.initialize();Groupon.Analytics.Google.setExperimentCustomVar(layerName,experimentId,variantName);});}};Groupon.Finch.TrackingHubTracker={track:function(experimentSets){_(experimentSets).each(function(experimentSet){layerName=experimentSet.layer.name;experimentId=experimentSet.experiment.id;variantName=experimentSet.variant;error=experimentSet.error;Groupon.TrackingHub.add("finch-experiment",{layer:layerName,experiment:experimentId,variant:variantName,error:error});});}};(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){return new wrapper(obj);};if(typeof module!=='undefined'&&module.exports){module.exports=_;_._=_;}else{root['_']=_;}
_.VERSION='1.2.0';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(hasOwnProperty.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=memo!==void 0;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return memo!==void 0?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var reversed=(_.isArray(obj)?obj.slice():_.toArray(obj)).reverse();return _.reduce(reversed,iterator,memo,context);};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return result;};var any=_.some=_.any=function(obj,iterator,context){iterator=iterator||_.identity;var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result|=iterator.call(context,value,index,list))return breaker;});return!!result;};_.include=_.contains=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;any(obj,function(value){if(found=value===target)return true;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(method.call?method||value:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var shuffled=[],rand;each(obj,function(value,index,list){if(index==0){shuffled[0]=value;}else{rand=Math.floor(Math.random()*(index+1));shuffled[index]=shuffled[rand];shuffled[rand]=value;}});return shuffled;};_.sortBy=function(obj,iterator,context){return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}),'value');};_.groupBy=function(obj,iterator){var result={};each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value);});return result;};_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=(low+high)>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid;}
return low;};_.toArray=function(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();if(_.isArray(iterable))return slice.call(iterable);if(_.isArguments(iterable))return slice.call(iterable);return _.values(iterable);};_.size=function(obj){return _.toArray(obj).length;};_.first=_.head=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,array.length-n):array[array.length-1];};_.rest=_.tail=function(array,index,guard){return slice.call(array,(index==null)||guard?1:index);};_.compact=function(array){return _.filter(array,function(value){return!!value;});};_.flatten=function(array){return _.reduce(array,function(memo,value){if(_.isArray(value))return memo.concat(_.flatten(value));memo[memo.length]=value;return memo;},[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array;var result=[];window.stuff=initial;_.reduce(initial,function(memo,el,i){if(0==i||(isSorted===true?_.last(memo)!=el:!_.include(memo,el))){memo[memo.length]=el;result[result.length]=array[i];}
return memo;},[]);return result;};_.union=function(){return _.uniq(_.flatten(arguments));};_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array,other){return _.filter(array,function(value){return!_.include(other,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted){i=_.sortedIndex(array,item);return array[i]===item?i:-1;}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};_.bind=function(func,obj){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)));};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return hasOwnProperty.call(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(func,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};var limit=function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;var throttler=function(){timeout=null;func.apply(context,args);};if(debounce)clearTimeout(timeout);if(debounce||!timeout)timeout=setTimeout(throttler,wait);};};_.throttle=function(func,wait){return limit(func,wait,false);};_.debounce=function(func,wait){return limit(func,wait,true);};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;return memo=func.apply(this,arguments);};};_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments));return wrapper.apply(this,args);};};_.compose=function(){var funcs=slice.call(arguments);return function(){var args=slice.call(arguments);for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(hasOwnProperty.call(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){return _.map(obj,_.identity);};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(source[prop]!==void 0)obj[prop]=source[prop];}});return obj;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}});return obj;};_.clone=function(obj){return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null)return a===b;var typeA=typeof a;if(typeA!=typeof b)return false;if(!a!=!b)return false;if(_.isNaN(a))return _.isNaN(b);var isStringA=_.isString(a),isStringB=_.isString(b);if(isStringA||isStringB)return isStringA&&isStringB&&String(a)==String(b);var isNumberA=_.isNumber(a),isNumberB=_.isNumber(b);if(isNumberA||isNumberB)return isNumberA&&isNumberB&&+a==+b;var isBooleanA=_.isBoolean(a),isBooleanB=_.isBoolean(b);if(isBooleanA||isBooleanB)return isBooleanA&&isBooleanB&&+a==+b;var isDateA=_.isDate(a),isDateB=_.isDate(b);if(isDateA||isDateB)return isDateA&&isDateB&&a.getTime()==b.getTime();var isRegExpA=_.isRegExp(a),isRegExpB=_.isRegExp(b);if(isRegExpA||isRegExpB){return isRegExpA&&isRegExpB&&a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeA!='object')return false;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(_.isFunction(a.isEqual))return a.isEqual(b);var length=stack.length;while(length--){if(stack[length]==a)return true;}
stack.push(a);var size=0,result=true;if(a.length===+a.length||b.length===+b.length){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break;}}}else{for(var key in a){if(hasOwnProperty.call(a,key)){size++;if(!(result=hasOwnProperty.call(b,key)&&eq(a[key],b[key],stack)))break;}}
if(result){for(key in b){if(hasOwnProperty.call(b,key)&&!size--)break;}
result=!size;}}
stack.pop();return result;}
_.isEqual=function(a,b){return eq(a,b,[]);};_.isEmpty=function(obj){if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(hasOwnProperty.call(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType==1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};_.isArguments=function(obj){return!!(obj&&hasOwnProperty.call(obj,'callee'));};_.isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply);};_.isString=function(obj){return!!(obj===''||(obj&&obj.charCodeAt&&obj.substr));};_.isNumber=function(obj){return!!(obj===0||(obj&&obj.toExponential&&obj.toFixed));};_.isNaN=function(obj){return obj!==obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isDate=function(obj){return!!(obj&&obj.getTimezoneOffset&&obj.setUTCFullYear);};_.isRegExp=function(obj){return!!(obj&&obj.test&&obj.exec&&(obj.ignoreCase||obj.ignoreCase===false));};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.escape=function(string){return(''+string).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;');};_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name]);});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};_.template=function(str,data){var c=_.templateSettings;var tmpl='var __p=[],print=function(){__p.push.apply(__p,arguments);};'+'with(obj||{}){__p.push(\''+
str.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(c.escape,function(match,code){return"',_.escape("+code.replace(/\\'/g,"'")+"),'";}).replace(c.interpolate,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'";}).replace(c.evaluate||null,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g,' ')+"__p.push('";}).replace(/\r/g,'\\r').replace(/\n/g,'\\n').replace(/\t/g,'\\t')
+"');}return __p.join('');";var func=new Function('obj',tmpl);return data?func(data):func;};var wrapper=function(obj){this._wrapped=obj;};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj;};var addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);unshift.call(args,this._wrapped);return result(func.apply(_,args),this._chain);};};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){method.apply(this._wrapped,arguments);return result(this._wrapped,this._chain);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain);};});wrapper.prototype.chain=function(){this._chain=true;return this;};wrapper.prototype.value=function(){return this._wrapped;};})();Groupon.Analytics={MEMBERSHIP_GOAL_PREFIX:"new_membership",UNDEFINED_LABEL:"undefined",Trackers:{},initialize:function(){_.each(this.Trackers,function(tracker){tracker.initialize();});},trackLoad:function(category,action,label){this.trackEvent('trackLoad',[category,action,label]);},trackClick:function(category,action,label){this.trackEvent('trackClick',[category,action,label]);},trackPageView:function(path){_.each(this.Trackers,function(tracker){tracker.trackPageView(path);});},trackEvent:function(eventType,params,optional){var category=this.UNDEFINED_LABEL,action=this.UNDEFINED_LABEL,label=this.UNDEFINED_LABEL;if(typeof params==='string'){category=params;if(params.match(this.MEMBERSHIP_GOAL_PREFIX)){category=this.MEMBERSHIP_GOAL_PREFIX;action=params.replace(this.MEMBERSHIP_GOAL_PREFIX,'');}}else{category=params[0];action=params[1];label=params[2];}
var opts={type:eventType,category:category,action:action,label:label};opts=_.extend(opts,optional);_.each(this.Trackers,function(tracker){tracker.trackEvent(opts);});}};Groupon.Analytics.Logger={debug:false,initialize:function(){if(typeof console!=="undefined"){this.logger=console;}else{this.logger=undefined;}},trackPageView:function(path){if(this.debug&&this.logger){this.logger.log("trackPageView",path);}},trackEvent:function(opts){if(this.debug&&this.logger){this.logger.log("trackEvent",opts);}}};Groupon.Analytics.Google={DEFAULT_PROFILE_ID:'UA-1250257-1',VISITOR_SCOPE:1,SESSION_SCOPE:2,PAGE_SCOPE:3,LAYER_TO_SLOT_MAP:{'deal-page-081811':1,'places-080311':2,'getaways-deal-081811':4,'checkout-page-081811':5},DEFAULT_DIVISION_SLOT:3,initialize:function(){var accountId;if(Groupon.Attributes){accountId=Groupon.Attributes.google_analytics_profile_id;}
accountId=accountId||this.DEFAULT_PROFILE_ID;_gaq=window._gaq||[];_gaq.push(['_setAccount',accountId]);_gaq.push(['_setDomainName','.groupon.com']);this.loadExternalLibrary();if(window.google_division_changed){this.setDivisionCustomVar(window.google_division_changed);}
this._trackGoal();},loadExternalLibrary:function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;var protocol='https:'===document.location.protocol?'https://ssl':'http://www';ga.src=protocol+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);},trackPageView:function(path){_gaq.push(['_trackPageview',path]);},trackEvent:function(opts){_gaq.push(['_trackEvent',opts.category,opts.action,opts.label]);},setExperimentCustomVar:function(layerId,experimentId,variantId){var slotId=this._slotForExperimentLayer(layerId);layerId=this._scrubWhitespace(layerId);experimentId=this._scrubWhitespace(experimentId);variantId=this._scrubWhitespace(variantId);var name="Exp-"+layerId;var safeExperimentId=experimentId+"/"+variantId;this.setCustomVar(name,safeExperimentId,slotId,this.VISITOR_SCOPE);},setDivisionCustomVar:function(newDivision){this.setCustomVar("Division",newDivision,this.DEFAULT_DIVISION_SLOT,this.SESSION_SCOPE);},setCustomVar:function(label,value,slot,scope){_gaq.push(['_setCustomVar',slot,label,value,scope]);},_scrubWhitespace:function(val){return val.replace(/[\s]/g,'').replace(/[^\w]/g,'-');},_slotForExperimentLayer:function(layerId){if(this.LAYER_TO_SLOT_MAP[layerId]==null){return;}
return this.LAYER_TO_SLOT_MAP[layerId];},_trackGoal:function(){if(window.google_goal){_gaq.push(['_trackPageview',google_goal],['_addTrans',google_order_id,"",google_amount,"","","","",""],['_addItem',google_order_id,google_sku,google_product_name,"Uncategorized",google_unit_price,google_quantity],['_trackTrans']);}else{_gaq.push(['_trackPageview']);}}};Groupon.Analytics.PixelTracker={PIXEL_URL:"/analytic/view.gif",TRACKING_COOKIE:'pixel_tracking',initialize:function(){},trackPageView:function(path){if(typeof(path)==='string'){path={'path':path};}
this.injectTrackingPixel('trackPageView',path);},trackEvent:function(opts){this.injectTrackingPixel('trackEvent',opts);},injectTrackingPixel:function(type,options){options=options||{};_(options).extend({sd:(!!Groupon.Dale)});if(options.runOnLoad){delete options.runOnLoad;this.stashTrackingPixel(type,options);}else{$('body').append($("<img />",{'src':this.__trackingPixelSource(type,options),'class':'tracking-pixel','height':1,'width':1}));}},stashTrackingPixel:function(type,options){var cookie=$.parseJSON(Cookie.get(this.TRACKING_COOKIE))||[];cookie.push(this.__trackingPixelParams(type,options));Cookie.set(this.TRACKING_COOKIE,$.toJSON(cookie));},injectTrackingPixelFromCookie:function(){_($.parseJSON(Cookie.get(this.TRACKING_COOKIE))).each(_(function(data,i){var type=data.t;delete data.t;this.injectTrackingPixel(type,data);}).bind(this));Cookie.unset(this.TRACKING_COOKIE);},__trackingPixelSource:function(type,options){return this.PIXEL_URL+'?'+$.param(this.__trackingPixelParams(type,options));},__trackingPixelParams:function(type,options){_(options).extend({t:type,cb:this.__cacheBuster()});return options;},__cacheBuster:function(){return(new Date()).getTime();}};Groupon.Analytics.Trackers=[Groupon.Analytics.Google,Groupon.Analytics.Logger,Groupon.Analytics.PixelTracker];Groupon.Analytics.initialize();(function(){function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3]);}
function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32((a<<s)|(a>>>(32-s)),b);}
function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t);}
function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t);}
function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t);}
function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t);}
function md51(s){if(/[\x80-\xFF]/.test(s)){s=unescape(encodeURI(s));}
txt='';var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;for(i=64;i<=s.length;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)));}
s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<s.length;i++)
tail[i>>2]|=s.charCodeAt(i)<<((i%4)<<3);tail[i>>2]|=0x80<<((i%4)<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0;}
tail[14]=n*8;md5cycle(state,tail);return state;}
function md5blk(s){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+
(s.charCodeAt(i+1)<<8)+
(s.charCodeAt(i+2)<<16)+
(s.charCodeAt(i+3)<<24);}
return md5blks;}
var hex_chr='0123456789abcdef'.split('');function rhex(n){var s='',j=0;for(;j<4;j++)
s+=hex_chr[(n>>(j*8+4))&0x0F]+
hex_chr[(n>>(j*8))&0x0F];return s;}
function hex(x){for(var i=0;i<x.length;i++)
x[i]=rhex(x[i]);return x.join('');}
md5=function(s){return hex(md51(s));}
function add32(a,b){return(a+b)&0xFFFFFFFF;}
if(md5('hello')!='5d41402abc4b2a76b9719d911017c592'){function add32(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF),msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);}}})();var Cookie={build:function(){var parts=Array.prototype.slice.apply(arguments);for(var i=0;i<parts.length;i++){if(!parts[i])
parts.splice(i,1);}
return parts.join("; ");},secondsFromNow:function(seconds){var d=new Date();d.setTime(d.getTime()+(seconds*1000));return d.toGMTString();},set:function(name,value,seconds,domain){var cookieExpiry=this._getExpiry(seconds),cookieDomain=this._getDomain(domain);if(typeof value==="string"){value=value.replace(/\s/g,'+');}
document.cookie=Cookie.build(name+"="+encodeURIComponent(value),cookieExpiry,"path=/",cookieDomain);},get:function(name){var valueMatch=new RegExp("(?:^|;(?:\\s*))"+name+"=([^;]+)").exec(document.cookie);var value=valueMatch?valueMatch[1]:null;return value!==null?decodeURIComponent(value).replace(/\+/g,' '):null;},unset:function(name,domain){Cookie.set(name,'',-1,domain);},_getExpiry:function(seconds,domain){return seconds?'expires='+Cookie.secondsFromNow(seconds):null;},_getDomain:function(domain){return domain?'domain='+domain:null;}};(function(){var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;var dataProp=data[i].prop;this.versionSearchString=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)
return data[i].identity;}
else if(dataProp)
return data[i].identity;}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1)return;return parseFloat(dataString.substring(index+this.versionSearchString.length+1));},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};BrowserDetect.init();(function(){var Exception,bind,emit,exceptionKey,global,init,listeners,__slice=[].slice;global=this;Exception=function(name,msg,file,line){this.name=name;this.message=msg;this.fileName=file;this.lineNumber=line;this.timestamp=new Date();this.host=window.location.host;return this.userAgent=window.navigator.userAgent;};Exception.prototype=new Error();Exception.constructor=Exception();Exception.prototype.toString=function(){return this.stack;};listeners={error:[]};init=function(){var errorCounts,origOnError;errorCounts={};if(window&&!(typeof window.onerror==='undefined')){origOnError=window.onerror||false;return window.onerror=function(msg,file,line){var exception,key,_ref;if(msg==null){msg=arguments[0];}
if(file==null){file=arguments[1];}
if(line==null){line=arguments[2];}
exception=new Exception("Uncaught Error",msg,file,line);key=exceptionKey(exception);if((_ref=errorCounts[key])==null){errorCounts[key]=0;}
errorCounts[key]+=1;if(errorCounts[key]<=3){emit("error",exception);}
if(typeof origOnError==="function"){return origOnError(msg,file,line);}else{return origOnError;}};}};exceptionKey=function(e){return""+e.message+"_"+e.fileName+"_"+e.lineNumber;};bind=function(eventName,cb){return listeners[eventName].push(cb);};emit=function(){var args,eventName,listener,_i,_len,_ref,_results;eventName=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];_ref=listeners[eventName];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){listener=_ref[_i];_results.push(listener.apply(null,args));}
return _results;};global.ErrorCatcher={init:init,on:bind};}).call(this);(function(){var __slice=[].slice;(function(){var Beagle,CookieAdapter,LocalStorageAdapter,createPersistence,global,isArray,isObject,jsonSafe,postParse;global=this;Beagle=global.Beagle=function(){this.listeners={add:[],flush:[],log:[]};this.buffer=[];return this;};Beagle.listeners={log:[]};Beagle.on=function(event,cb){return this.listeners[event].push(cb);};Beagle.off=function(event,listenerToRemove){var listener,safeListeners,_i,_len,_ref;safeListeners=[];_ref=this.listeners[event];for(_i=0,_len=_ref.length;_i<_len;_i++){listener=_ref[_i];if(listener!==listenerToRemove){safeListeners.push(listener);}}
return this.listeners[event]=safeListeners;};Beagle.trigger=function(){var args,event,func,_i,_len,_ref,_results;event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];_ref=this.listeners[event];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){func=_ref[_i];_results.push(func.apply(null,args));}
return _results;};Beagle.nextTick=function(func){return setTimeout(func);};Beagle.prototype.on=Beagle.on;Beagle.prototype.off=Beagle.off;Beagle.prototype.trigger=Beagle.trigger;Beagle.prototype.add=function(name,data){var obj;if(data==null){data={};}
obj={name:name,data:data,timestamp:new Date()};this.buffer.push(obj);return this.trigger("add",obj);};Beagle.prototype.flush=function(){var messages;messages=this.buffer;this.buffer=[];if(messages.length>0){this.trigger("flush",messages);}
return messages;};Beagle.prototype.log=function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];this.trigger.apply(this,["log"].concat(__slice.call(args)));return Beagle.trigger.apply(Beagle,["log"].concat(__slice.call(args)));};Beagle.prototype.use=function(middleware){return middleware(this);};Beagle.Timer=function(millis){var middleware,running;running=true;middleware=function(beagle){var func;func=function(){if(running){beagle.flush();return beagle.log("Flushed by Beagle.Timer("+millis+")");}};setTimeout((function(){}),0);return setInterval(func,millis);};middleware.cancel=function(){return running=false;};middleware.resume=function(){return running=true;};return middleware;};Beagle.SizeThreshold=function(threshold){return function(beagle){var dataSize;dataSize=0;beagle.on("add",function(data){dataSize+=JSON.stringify(data).length;if(dataSize>threshold){beagle.flush();return beagle.log("Flushed by Beagle.SizeThreshold("+threshold+"), size is "+dataSize+".");}});return beagle.on("flush",function(data){return dataSize=0;});};};Beagle.ExternalLinks=function(delay){if(delay==null){delay=500;}
return function(beagle){return $("body").delegate("a[href^='http']","click",function(e){var origE,redirect,url;origE=e.originalEvent;if(!(e.isDefaultPrevented()||origE.defaultPrevented||origE.returnValue===false)){e.preventDefault();url=$(e.currentTarget).attr("href");redirect=function(){return window.location.href=url;};setTimeout(redirect,delay);beagle.flush();return beagle.log("Flushed by Beagle.ExternalLinks("+delay+"), redirecting to "+url+".");}});};};Beagle.LocalStoragePersistence=function(key){return createPersistence(LocalStorageAdapter,key,"LocalStoragePersistence");};Beagle.CookiePersistence=function(key){return createPersistence(CookieAdapter,key,"CookiePersistence");};Beagle.Console=function(){return function(beagle){beagle.on("add",function(message){return console.log("Beagle::add",message);});beagle.on("flush",function(messages){return console.log("Beagle::flush",messages);});return beagle.on("log",function(){var args;args=1<=arguments.length?__slice.call(arguments,0):[];return console.log.apply(console,["Beagle::log"].concat(__slice.call(args)));});};};createPersistence=function(store,key,name){return function(beagle){var json,messages;if(json=store.get(key)){messages=postParse(JSON.parse(json));store.unset(key);Beagle.nextTick(function(){beagle.buffer=beagle.buffer.concat(messages);beagle.flush();return beagle.log("Flushed by Beagle."+name+" on load.");});}
beagle.on("add",function(data){json=store.get(key)||"[]";json=json.slice(0,json.length-1);if(json.length>1){json+=",";}
json+=JSON.stringify(jsonSafe(data));json+="]";try{return store.set(key,json);}catch(e){beagle.flush();return beagle.log("Flushed by Beagle."+name+" due to storage error.",e);}});return beagle.on("flush",function(){return store.unset(key);});};};jsonSafe=function(val){var item,k,out,v,_i,_len,_results;if(val instanceof Error){return{name:val.name,stack:val.stack,message:val.message};}else if(val instanceof Date){return"date-"+(val.getTime());}else if(isObject(val)){out={};for(k in val){v=val[k];out[k]=jsonSafe(v);}
return out;}else if(isArray(val)){_results=[];for(_i=0,_len=val.length;_i<_len;_i++){item=val[_i];_results.push(jsonSafe(item));}
return _results;}else{return val;}};isArray=function(arr){if(Array.isArray){return Array.isArray(arr);}else{return Object.prototype.toString.call(arr)==="[object Array]";}};isObject=function(obj){return typeof obj==="object"&&!isArray(obj);};postParse=function(val){var date,item,k,millis,out,v,_i,_len,_results;if(typeof val==="string"&&/^date-\d+$/.test(val)){millis=val.substr(5,val.length-5);date=new Date();date.setTime(millis);return date;}else if(isObject(val)){out={};for(k in val){v=val[k];out[k]=postParse(v);}
return out;}else if(isArray(val)){_results=[];for(_i=0,_len=val.length;_i<_len;_i++){item=val[_i];_results.push(postParse(item));}
return _results;}else{return val;}};LocalStorageAdapter={get:function(key){return localStorage.getItem(key);},set:function(key,val){return localStorage.setItem(key,val);},unset:function(key){return localStorage.removeItem(key);}};return CookieAdapter={charLimit:4000,build:function(){var compacted,part,parts,_i,_len;parts=1<=arguments.length?__slice.call(arguments,0):[];compacted=[];for(_i=0,_len=parts.length;_i<_len;_i++){part=parts[_i];if(part){compacted.push(part);}}
return compacted.join("; ");},secondsFromNow:function(seconds){var d;d=new Date();d.setTime(d.getTime()+(seconds*1000));return d.toGMTString();},set:function(name,value,seconds,domain){var cookie,cookieDomain,expiry,oneYear;oneYear=60*60*24*365;expiry='expires='+this.secondsFromNow(seconds||oneYear);if(domain){cookieDomain='domain='+domain;}
cookie=this.build(name+"="+value,expiry,"path=/",cookieDomain);if(cookie.length>this.charLimit){throw"Cookie size exceeded "+this.charLimit+" bytes";}
return document.cookie=cookie;},get:function(name){var valueMatch;valueMatch=new RegExp("(?:^|;(?:\\s*))"+name+"=([^;]+)").exec(document.cookie);if(valueMatch){return valueMatch[1];}},unset:function(name,domain){return this.set(name,'',-1,domain);}};}).call(this);}).call(this);(function(){var global=this;var Tracky=global.Tracky=function(endpoint){this.endpoint=endpoint;};var S4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};function pad(number){var r=String(number);if(r.length===1){r='0'+r;}
return r;}
function encodedSeed(){if(Tracky.seed){return encodeURI(Tracky.seed);}}
Tracky.prototype.log=function(eventName,data){var requiredData={"event_name":eventName.toString().toLowerCase(),"event_client_timestamp":Tracky.currentISODateString(),"event_id":Tracky.generateUUID()};var ajaxData=Tracky.merge({},(data||{}),true);ajaxData=Tracky.merge(ajaxData,requiredData);var endpoint=this.endpoint||Tracky.endpoint;if(!endpoint){Tracky.whenDebugging(function(){throw"Tracky.log error: No endpoint defined";});return;}
Tracky.whenDebugging(function(){console.log(endpoint+" => %s",JSON.stringify(ajaxData));});jQuery.ajax(endpoint,{type:"POST",data:JSON.stringify(ajaxData)});};Tracky.currentISODateString=function(){var now=new Date();return formatTimestamp(now);};Tracky.whenDebugging=function(callback){if(Tracky.debug){callback.call();}};Tracky.merge=function(source,data,checkKey){var output={};for(key in source){output[key]=source[key];}
for(key in data){if(key.match(/^\w+$/)||!checkKey){output[key]=data[key];}else{Tracky.whenDebugging(function(){console.warn("Tracky.log - Invalid key '"+key+"' ignored");});}}
return output;};Tracky.generateUUID=function(){var seed=encodedSeed(),id=(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());if(seed){id=id+"-"+seed;}
return id;};function postRequest(data){if(data===undefined||(data instanceof Array&&data.length===0)){Tracky.whenDebugging(function(){throw"Tracky.log error: No data to send";});return;}
if(!Tracky.endpoint){Tracky.whenDebugging(function(){throw"Tracky.log error: No endpoint defined";});return;}
Tracky.whenDebugging(function(){console.log(Tracky.endpoint+" => %s",JSON.stringify(data));});jQuery.ajax(Tracky.endpoint,{type:"POST",data:JSON.stringify(data)});}
function ensureTrackyRulesForMessage(message){var outMessage=Tracky.merge({},message,true);outMessage.event_id=Tracky.generateUUID();if(outMessage.event_name){var originalEventName=outMessage.event_name;outMessage.event_name=outMessage.event_name.toString().toLowerCase();if(originalEventName!=outMessage.event_name){Tracky.whenDebugging(function(){console.warn("Tracky.log: event_name being changed from %s to %s to conform with Tracky spec",originalEventName.toString(),outMessage.event_name);});}}
if(!outMessage.event_client_timestamp){outMessage.event_client_timestamp=Tracky.currentISODateString();}
if(typeof outMessage.event_client_timestamp!=="string"){outMessage.event_client_timestamp=formatTimestamp(outMessage.event_client_timestamp);}
return outMessage;}
function formatTimestamp(now){if(typeof now.toISOString==="function"){return now.toISOString();}else{return now.getUTCFullYear()+'-'+pad(now.getUTCMonth()+1)+'-'+pad(now.getUTCDate())+'T'+pad(now.getUTCHours())+':'+pad(now.getUTCMinutes())+':'+pad(now.getUTCSeconds())+'.'+String((now.getUTCMilliseconds()/1000).toFixed(3)).slice(2,5)+'Z';}}
Tracky.log=function(){var dataForRequest,bulkRequest,bulkInputData,trackyifiedData;if((arguments.length===1&&arguments[0]instanceof Array)||arguments.length>1){bulkRequest=true;}else{bulkRequest=false;}
if(bulkRequest){dataForRequest=[];bulkInputData=((arguments.length===1&&arguments[0]instanceof Array)?arguments[0]:arguments);for(var i=0;i<bulkInputData.length;i++){trackyifiedData=ensureTrackyRulesForMessage(bulkInputData[i]);if(trackyifiedData.event_name){dataForRequest.push(trackyifiedData);}}
if(dataForRequest.length===1){dataForRequest=dataForRequest[0];}}else{trackyifiedData=ensureTrackyRulesForMessage(arguments[0]);if(trackyifiedData.event_name){dataForRequest=trackyifiedData;}}
return postRequest(dataForRequest);};}).call(this);(function(){var Bloodhound,__bind=function(fn,me){return function(){return fn.apply(me,arguments);};},__slice=Array.prototype.slice;this.Bloodhound=Bloodhound=(function(){function Bloodhound(atts){var key,updateInterval,_i,_len,_ref,_this=this;if(atts==null)atts={};this._onEvent=__bind(this._onEvent,this);try{this.eventListeners={};this.widgets=[];this.widgetKey=atts.widgetKey||"bhw";this.contentKey=atts.contentKey||"bhc";this.widgetContainer=atts.widgetContainer||$("body");updateInterval=atts.updateInterval||1000;_ref=["widgetKey","contentKey","widgetContainer"];for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];delete atts[key];}
this.metadata=atts;this.events=new Bloodhound.Events();this.events.listenToAll(this.widgetKey,this.contentKey,this.widgetContainer);this.events.bind(this._onEvent);Bloodhound.Helpers.nextTick(function(){return _this.updateWidgets();});Bloodhound.Helpers.eachInterval(updateInterval,this.updateWidgets,this);}catch(e){Bloodhound.Helpers.nextTick(function(){return _this.trigger("error",e);});}}
Bloodhound.prototype.data=function(){var key,out,val,widget,_ref;out={};_ref=this.metadata;for(key in _ref){val=_ref[key];out[key]=val;}
out.widgets=(function(){var _i,_len,_ref2,_results;_ref2=this.widgets;_results=[];for(_i=0,_len=_ref2.length;_i<_len;_i++){widget=_ref2[_i];_results.push(widget.data());}
return _results;}).call(this);return out;};Bloodhound.prototype.updateWidgets=function(){var newWidgets;try{newWidgets=Bloodhound.Widget.findNew(this.widgetKey,this.contentKey,this.widgetContainer);if(newWidgets.length>0){this.widgets=this.widgets.concat(newWidgets);return this.trigger("impression",newWidgets);}}catch(e){return this.trigger("error",e);}};Bloodhound.prototype.trigger=function(){var args,event,func,_base,_i,_len,_ref,_results;event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[];if((_base=this.eventListeners)[event]==null)_base[event]=[];_ref=this.eventListeners[event];_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){func=_ref[_i];_results.push(func.apply(null,args));}
return _results;};Bloodhound.prototype.bind=function(event,func){var _base;if((_base=this.eventListeners)[event]==null)_base[event]=[];return this.eventListeners[event].push(func);};Bloodhound.prototype.unbind=function(event,funcToRemove){var func,newListeners,_i,_len,_ref;newListeners=[];_ref=this.eventListeners[event];for(_i=0,_len=_ref.length;_i<_len;_i++){func=_ref[_i];if(func!==funcToRemove)newListeners.push(func);}
return this.eventListeners[event]=newListeners;};Bloodhound.prototype._onEvent=function(event){return this.trigger("event",event);};return Bloodhound;})();Bloodhound.prototype.on=Bloodhound.prototype.bind;Bloodhound.prototype.off=Bloodhound.prototype.unbind;Bloodhound.prototype.emit=Bloodhound.prototype.trigger;}).call(this);(function(){Bloodhound.Events=(function(){function Events(){this.events=[];this.emitters=[];this.eventListeners=[];this._updateLength();}
Events.prototype.listenToAll=function(widgetKey,contentKey,container){var all,doEvent,events,selects;events=this;if(container==null)container=$("body");doEvent=function(e){var content,el,widget;el=$(this);if(content=el.data(""+contentKey+"-object")){events._onEvent(e,content);}
if(widget=el.data(""+widgetKey+"-object")){return events._onEvent(e,widget);}};all="[data-"+widgetKey+"], [data-"+contentKey+"]";selects="select[data-"+widgetKey+"], select[data-"+contentKey+"]";container.delegate(all,"click",doEvent);return container.delegate(selects,"change",doEvent);};Events.prototype.pushEvent=function(event){this.events.push(event);this[this.length]=event;return this._updateLength();};Events.prototype.trigger=function(event){var func,_i,_len,_ref,_results;_ref=this.eventListeners;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){func=_ref[_i];_results.push(func(event));}
return _results;};Events.prototype.bind=function(func){return this.eventListeners.push(func);};Events.prototype.unbind=function(funcToRemove){var func,newListeners,_i,_len,_ref;newListeners=[];_ref=this.eventListeners;for(_i=0,_len=_ref.length;_i<_len;_i++){func=_ref[_i];if(func!==funcToRemove)newListeners.push(func);}
this.eventListeners=newListeners;return this._updateLength();};Events.prototype._onEvent=function(e,widget){var event,_this=this;event=this._lookupEvent(e);if(event){return event.widgets.push(widget);}else{event={id:Bloodhound.Helpers.randomId(),jQueryEvent:e,type:e.type,widgets:[widget]};if(e.type==="change")event.value=widget.value();this.pushEvent(event);return Bloodhound.Helpers.nextTick(function(){_this.trigger(event);return _this._removeEvent(event);});}};Events.prototype._lookupEvent=function(e){var event,_i,_len,_ref;_ref=this.events;for(_i=0,_len=_ref.length;_i<_len;_i++){event=_ref[_i];if(event.jQueryEvent.originalEvent===e.originalEvent)return event;}
return null;};Events.prototype._updateLength=function(){return this.length=this.events.length;};Events.prototype._removeEvent=function(event){var e,i,_len,_ref;_ref=this.events;for(i=0,_len=_ref.length;i<_len;i++){e=_ref[i];if(e===event){this.events.splice(i,1);this._updateLength();return;}}};return Events;})();}).call(this);(function(){var S4,counter;counter=0;Bloodhound.Helpers={seed:null,randomId:function(){var id;id=""+this.seed+"-"+(new Date().getTime())+"-"+counter;counter+=1;return id;},nextTick:function(func){return setTimeout(func);},eachInterval:function(millis,func,context){var f;f=function(){return func.call(context);};return setInterval(f,millis);},reset:function(){return counter=0;}};S4=function(){var rand;return rand=(((1+Math.random())*0x10000)|0).toString(16);};}).call(this);(function(){Bloodhound.WidgetContent=(function(){function WidgetContent(atts){var _ref;_ref=atts.name.split(":"),this.type=_ref[0],this.name=_ref[1];this.element=atts.element;this.position=atts.position;}
WidgetContent.prototype.data=function(){return{type:this.type,name:this.name,position:this.position};};return WidgetContent;})();}).call(this);(function(){Bloodhound.Widget=(function(){Widget.findNew=function(widgetKey,contentKey,container){var extraContentElements,out,widgetElements,_this=this;widgetElements=container.find("[data-"+widgetKey+"]:visible:not(.bhtracked)");out=[];widgetElements.each(function(i,el){return out.push(_this._widgetFromElement(el,widgetKey,contentKey));});extraContentElements=container.find("[data-"+contentKey+"]:visible:not(.bhtracked)");extraContentElements.each(function(i,el){var $el,alreadyPassedContent,pos,widget;$el=$(el);widget=$el.parents("[data-"+widgetKey+"]").eq(0);if(widget[0]){alreadyPassedContent=false;pos=0;widget.find("[data-"+contentKey+"]:visible").each(function(i,contentEl){if(alreadyPassedContent)return;if(el===contentEl){return alreadyPassedContent=true;}else{return pos++;}});}else{pos=$(el).prevAll("[data-"+contentKey+"]:visible").length;}
return out.push(_this._contentFromElement(el,contentKey,pos));});return out;};Widget._widgetFromElement=function(element,widgetKey,contentKey){var content,contentElements,el,widget,_this=this;content=[];el=$(element);contentElements=el.find("[data-"+contentKey+"]:visible:not(.bhtracked)");if(el.is("[data-"+contentKey+"]")){contentElements=contentElements.add(el);}
contentElements.each(function(i,el){return content.push(_this._contentFromElement(el,contentKey,i));});widget=new Bloodhound.Widget({element:element,name:$(element).data(widgetKey),content:content});$(element).addClass("bhtracked").data(""+widgetKey+"-object",widget);return widget;};Widget._contentFromElement=function(element,contentKey,position){var c;c=new Bloodhound.WidgetContent({element:element,name:$(element).data(contentKey),position:position});$(element).addClass("bhtracked").data(""+contentKey+"-object",c);return c;};function Widget(atts){this.name=atts.name;this.element=atts.element;this.content=atts.content||[];}
Widget.prototype.data=function(){var item,out;out={name:this.name};if(this.content.length>0){out.content=(function(){var _i,_len,_ref,_results;_ref=this.content;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];_results.push(item.data());}
return _results;}).call(this);}
return out;};Widget.prototype.value=function(){return $(this.element).val();};return Widget;})();}).call(this);(function(){var Page,Session,TrackingHub,buildBeagle,buildTimer,debugOnAdd,debugOnFlush,localStorageEnabled;localStorageEnabled=(function(){try{localStorage.setItem("beagle-local-storage-test","true");localStorage.removeItem("beagle-local-storage-test");return true;}catch(e){return false;}})();buildBeagle=function(ms){var beagle;beagle=new Beagle();beagle.use(buildTimer(ms));if(localStorageEnabled){beagle.use(Beagle.LocalStoragePersistence("tracking-hub"));}else{beagle.use(Beagle.CookiePersistence("tracking-hub"));}
return beagle;};buildTimer=function(ms){var timer;timer=Beagle.Timer(ms);$(function(){return $("body").delegate("a","click",function(e){var origE;origE=e.originalEvent;timer.cancel();return setTimeout(function(){var shouldResume;if(e.isDefaultPrevented()){timer.resume();}
shouldResume=(function(){try{return origE.returnValue===false;}catch(err){return false;}})();if(shouldResume){return timer.resume();}});});});return timer;};debugOnAdd=function(message){return TrackingHub.debuggingQueuedMessages.push(message);};debugOnFlush=function(messages){return TrackingHub.debuggingDeliveredMessages=TrackingHub.debuggingDeliveredMessages.concat(messages);};TrackingHub=window.TrackingHub={init:function(config){this.counter=0;this.seed=config.seed;this.session=new Session(config.session);this.page=new Page(config.page);this.user=config.user;this.beagle=buildBeagle(config.flushInterval||3000);this.startDebugging();return this.beagle.add("tracking-init",{session:this.session.data(),page:this.page.data(),user:this.user});},add:function(name,data){var extraData;extraData={session:{id:this.session.id},page:{id:this.page.id},user:this.user};_.extend(data,extraData);return this.beagle.add.call(this.beagle,name,data);},on:function(){return this.beagle.on.apply(this.beagle,arguments);},off:function(){return this.beagle.off.apply(this.beagle,arguments);},use:function(){return this.beagle.use.apply(this.beagle,arguments);},randomId:function(){var id;id=""+this.seed+"-"+(new Date().getTime())+"-TH"+this.counter;this.counter+=1;return id;},startDebugging:function(){TrackingHub.debuggingQueuedMessages=[];TrackingHub.debuggingDeliveredMessages=[];if(!!Cookie.get("debug-tracking-hub")){TrackingHub.on("add",debugOnAdd);return TrackingHub.on("flush",debugOnFlush);}},stopDebugging:function(){TrackingHub.off("add",debugOnAdd);TrackingHub.off("flush",debugOnFlush);TrackingHub.debuggingQueuedMessages=[];return TrackingHub.debuggingDeliveredMessages=[];}};Session=(function(){function Session(config){var key,_i,_len,_ref;if(config==null){config={};}
this.expiry=config.expiry||30*60;this.cookieKey=config.cookieKey;this.cookieDomain=config.cookieDomain;_ref=["expiry","cookieKey","cookieDomain"];for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];delete config[key];}
this.metadata=config;this._buildId();}
Session.prototype.data=function(){var key,out,val,_ref;out={};_ref=this.metadata;for(key in _ref){val=_ref[key];out[key]=val;}
out.id=this.id;return out;};Session.prototype.save=function(){return Cookie.set(this.cookieKey,this.id,this.expiry,this.cookieDomain);};Session.prototype._buildId=function(){var _ref;this.id=this._idFromCookie();return(_ref=this.id)!=null?_ref:this.id=TrackingHub.randomId();};Session.prototype._idFromCookie=function(){return Cookie.get(this.cookieKey);};return Session;})();Page=(function(){function Page(attributes){var key,_i,_len,_ref;if(attributes==null){attributes={};}
this.id=attributes.id||TrackingHub.randomId();_ref=["id","widgets"];for(_i=0,_len=_ref.length;_i<_len;_i++){key=_ref[_i];delete attributes[key];}
this.metadata=attributes;}
Page.prototype.data=function(){var d,key,val,_ref;d={};_ref=this.metadata;for(key in _ref){val=_ref[key];d[key]=val;}
d.id=this.id;return d;};return Page;})();}).call(this);(function(){var Finch,debug,__hasProp={}.hasOwnProperty,__bind=function(fn,me){return function(){return fn.apply(me,arguments);};},__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor();child.__super__=parent.prototype;return child;},__slice=[].slice;(typeof exports!=="undefined"&&exports!==null?exports:this).Finch=Finch=(function(){var Utility;return{initialize:function(window,config){var layerConfig,layerName;this.window=window;this.reset();this.layers=(function(){var _results;_results=[];for(layerName in config){if(!__hasProp.call(config,layerName))continue;layerConfig=config[layerName];_results.push(new Finch.Layer(layerName,layerConfig));}
return _results;})();debug('initialized');this.runPreferredExperiments();return this;},run:function(){var layer,_i,_len,_ref;if(this.layers==null){return;}
_ref=this.layers;for(_i=0,_len=_ref.length;_i<_len;_i++){layer=_ref[_i];layer.run();}
return Finch.Tracking.deliver();},reset:function(){return this.layers=[];},isInExperiment:function(experimentName){return _.any(this.layers,function(layer){var _ref;return((_ref=layer.experiment())!=null?_ref.name:void 0)===experimentName;});},runPreferredExperiments:function(){var layer,_i,_len,_ref;_ref=this.layers;for(_i=0,_len=_ref.length;_i<_len;_i++){layer=_ref[_i];layer.preferredRun();}
return Finch.Tracking.deliver();},Utility:Utility=(function(){function Utility(){}
Utility.parseQueryString=function(queryString){var name,parameter,params,value,_i,_len,_ref,_ref1;params={};if(queryString===''||queryString==='?'){return params;}
_ref=queryString.substr(1).split('&');for(_i=0,_len=_ref.length;_i<_len;_i++){parameter=_ref[_i];_ref1=parameter.split("="),name=_ref1[0],value=_ref1[1];params[name]=value;}
return params;};Utility.md5=function(string){return md5(string);};return Utility;})()};})();Finch.Tracking={deliver:function(){var tracker,_i,_len,_ref;_ref=Finch.Trackers;for(_i=0,_len=_ref.length;_i<_len;_i++){tracker=_ref[_i];try{tracker.track(this._translatedExperiments(),Finch.window);}catch(e){}}
return this.reset();},trackExperiment:function(experiment){return this.experiments.push(experiment);},trackExperimentError:function(experiment,error){this.trackExperiment(experiment);return this.experimentErrors[experiment.id]=error;},reset:function(){this.experiments=[];return this.experimentErrors={};},_translatedExperiments:function(){var data,error,experiment,_i,_len,_ref,_results;_ref=this.experiments;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){experiment=_ref[_i];data={layer:experiment.layer,experiment:experiment,variant:experiment.variantName()};error=this.experimentErrors[experiment.id];if(error){data.error=error;}
_results.push(data);}
return _results;}};Finch.Tracking.reset();Finch.Experiments={};Finch.Experiments.Global={};Finch.Diversions={};Finch.Trackers=[];Finch.NUMBER_OF_BUCKETS_PER_LAYER=1000;Finch.VERSION='0.6.7';debug=function(message){if(Finch.debug&&((typeof console!=="undefined"&&console!==null?console.log:void 0)!=null)){return console.log("::: finch.js : "+message);}};Finch.Layer=(function(){Layer.all=function(){return Finch.layers||[];};function Layer(name,config){var experimentConfig,experimentIdentifier,_ref;this.name=name;this.preferredRun=__bind(this.preferredRun,this);this.run=__bind(this.run,this);this.bucket=__bind(this.bucket,this);if(config!=null){debug("loading layer "+this.name);this.experiments=(function(){var _ref,_results;_ref=config.experiments;_results=[];for(experimentIdentifier in _ref){if(!__hasProp.call(_ref,experimentIdentifier))continue;experimentConfig=_ref[experimentIdentifier];_results.push(new Finch.Experiment(experimentIdentifier,this,experimentConfig));}
return _results;}).call(this);if(config.diversion_type!=null){this.diversion=Finch.Diversions[config.diversion_type];}}
if((_ref=this.diversion)==null){this.diversion=Finch.Diversions.RandomDiversion;}}
Layer.prototype.findExperiments=function(selector){var experiment,_i,_len,_ref,_results;if(selector==null){return[];}
_ref=this.experiments;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){experiment=_ref[_i];if(selector(experiment)){_results.push(experiment);}}
return _results;};Layer.prototype.experimentsForBucket=function(bucket){return this.findExperiments(function(exp){return(exp.status==='running')&&((exp.buckets.min<=bucket&&bucket<=exp.buckets.max));});};Layer.prototype.experiment=function(){return this._getExperimentByQueryString()||this._getExperimentByCookie()||this._getSingleMatchingExperiment();};Layer.prototype.bucket=function(){var _ref;return(_ref=this.bucketCache)!=null?_ref:this.bucketCache=this.diversion.bucket(this);};Layer.prototype.run=function(){var experiment;experiment=this.experiment();if(experiment&&!experiment.isPreferred()){return experiment.run();}};Layer.prototype.preferredRun=function(){var experiment;experiment=this.experiment();if(experiment&&experiment.isPreferred()){return experiment.run();}};Layer.prototype._getExperimentByQueryString=function(){var experimentName,layerName,params;if(this.forcedExperimentCache!=null){return this.forcedExperimentCache;}
params=Finch.Utility.parseQueryString(Finch.window.location.search);layerName=params.finch_layer;experimentName=params.finch_experiment;if(!(layerName&&experimentName&&layerName===this.name)){return null;}
return this.forcedExperimentCache=_.detect(this.experiments,function(ex){return ex.name===experimentName;});};Layer.prototype._getExperimentByCookie=function(){var experimentName;experimentName=Cookie.get(""+this.name+":Experiment");return _.detect(this.experiments,function(ex){return ex.name===experimentName;});};Layer.prototype._getSingleMatchingExperiment=function(){var results,_this=this;if(this.bucket()==null){return null;}
results=this.findExperiments(function(exp){var _ref;return(exp.status==='running')&&((exp.buckets.min<=(_ref=_this.bucket())&&_ref<=exp.buckets.max));});if(results.length===1){return results[0];}else{return null;}};return Layer;})();Finch.Diversion=(function(){function Diversion(diversionCallback){this.diversionCallback=diversionCallback;}
Diversion.prototype.bucket=function(layer){var bucket;if(layer==null){throw'layer is not defined';}
if(this.diversionCallback==null){throw'no bucketing function defined';}
bucket=this.diversionCallback(layer);if(bucket==null){return null;}
if(!this._validBucket(bucket)){throw"bucket "+bucket+" out of range";}
debug("diversion bucket "+bucket+" for "+(layer!=null?layer.name:void 0));return bucket;};Diversion.prototype._validBucket=function(bucket){return(0<=bucket&&bucket<=Finch.NUMBER_OF_BUCKETS_PER_LAYER);};return Diversion;})();Finch.HashCookieDiversion=(function(_super){__extends(HashCookieDiversion,_super);function HashCookieDiversion(){var cookies;cookies=1<=arguments.length?__slice.call(arguments,0):[];this.cookies=cookies;HashCookieDiversion.__super__.constructor.call(this,function(layer){var cookie,cookieName,cookieValue,_i,_len,_ref,_ref1,_ref2;if(this.cookies instanceof Array){_ref=this.cookies;for(_i=0,_len=_ref.length;_i<_len;_i++){cookie=_ref[_i];if(!(typeof cookieValue!=="undefined"&&cookieValue!==null)){_ref1=[cookie,Cookie.get(cookie)],cookieName=_ref1[0],cookieValue=_ref1[1];}}}else{_ref2=[this.cookies,Cookie.get(this.cookies)],cookieName=_ref2[0],cookieValue=_ref2[1];}
if(cookieValue==null){debug("no valid cookies");return null;}
debug("bucketing with cookie: "+cookieName+"="+cookieValue);return this._hash(""+cookieValue+","+layer.name);});}
HashCookieDiversion.prototype._hash=function(input){var md5;md5=Finch.Utility.md5(input);debug(md5);return parseInt(md5.slice(24,32),16)%Finch.NUMBER_OF_BUCKETS_PER_LAYER;};return HashCookieDiversion;})(Finch.Diversion);Finch.Diversions.RandomDiversion=new Finch.Diversion(function(layer){return Math.floor(Math.random()*Finch.NUMBER_OF_BUCKETS_PER_LAYER);});Finch.Diversions.CookieDiversion=new Finch.HashCookieDiversion('b');Finch.Experiment=(function(){function Experiment(id,layer,config){var _ref,_ref1,_ref2,_ref3,_ref4;this.id=id;this.layer=layer;if(config==null){config={};}
this.name=(_ref=config.name)!=null?_ref:'';this.status=(_ref1=config.status)!=null?_ref1:'inactive';this.variants=(_ref2=config.variants)!=null?_ref2:[];this.guards=(_ref3=config.guards)!=null?_ref3:[];this.params=(_ref4=config.params)!=null?_ref4:{};this.buckets=this._parseBucketRange(config.buckets);this.pathPatterns=this._parsePathPatterns(config.path_patterns);debug("loading experiment "+this.name);}
Experiment.prototype.run=function(){var window,_ref;window=Finch.window;if(this.isDeferred()){debug("matching experiment "+this.id+" deferred with variant "+(this.variantName()));return(_ref=this._deferCallback())!=null?_ref.call(this):void 0;}else{if(this.testMatches()){return this._execute();}else{return debug("GuardFailed on experiment "+this.id);}}};Experiment.prototype.deferredRun=function(){var variantName;variantName=this.variantName();debug("running deferred experiment "+this.id+" with bucket "+variantName);if(this.testMatches()){this._execute(variantName,Finch.window);}else{debug("GuardFailed on experiment "+this.id);}
return Finch.Tracking.deliver();};Experiment.prototype.isPreferred=function(){return!!this.experimentDefinition().runOnInit;};Experiment.prototype.isDeferred=function(){return!!this.experimentDefinition().defer;};Experiment.prototype.testMatches=function(){var window;window=Finch.window;return this.pathMatches(window.location)&&this.paramsMatches(window.location)&&this.guardMatches(window);};Experiment.prototype.pathMatches=function(location){var path;path=location.pathname;if((path!=null)&&this.pathPatterns.length===0){return true;}
return _.any(this.pathPatterns,function(pattern){return pattern.test(path);});};Experiment.prototype.paramsMatches=function(location){var queryParams;queryParams=Finch.Utility.parseQueryString(location.search);if(_.isEmpty(this.params)){return true;}
return _.all(this.params,function(paramValues,paramName){if(queryParams[paramName]==null){return false;}
return _.any(paramValues,function(value){return queryParams[paramName]===value;});});};Experiment.prototype.guardMatches=function(window){var _this=this;if(this.guards.length===0){return true;}
return _.all(this.guards,function(guard){var _ref,_ref1,_ref2,_ref3;return((_ref=_this.experimentDefinition().guards)!=null?(_ref1=_ref[guard])!=null?_ref1.call(window):void 0:void 0)||((_ref2=Finch.Experiments.Global.guards)!=null?(_ref3=_ref2[guard])!=null?_ref3.call(window):void 0:void 0);});};Experiment.prototype.currentVariant=function(bucket){return this.experimentDefinition().variants[this.variantNameForBucket(bucket)];};Experiment.prototype.randomVariant=function(){var variantName;variantName=this.variants[Math.floor(Math.random()*this.variants.length)];return this.experimentDefinition().variants[variantName];};Experiment.prototype.variant=function(){var _ref;return(_ref=this.variantCache)!=null?_ref:this.variantCache=this.experimentDefinition().variants[this.variantName()];};Experiment.prototype.variantName=function(){var _ref;return(_ref=this.variantNameCache)!=null?_ref:this.variantNameCache=this.variantNameForBucket(this.bucket());};Experiment.prototype.variantNameForBucket=function(bucket){return this._variantNameByQuerystring()||this._variantNameByCookie()||this._variantNameByRoundRobin(bucket);};Experiment.prototype._variantNameByQuerystring=function(){var experimentName,layerName,params,variantName;params=Finch.Utility.parseQueryString(Finch.window.location.search);layerName=params.finch_layer;experimentName=params.finch_experiment;variantName=params.finch_variant;if(layerName===this.layer.name&&experimentName===this.name&&(variantName!=null)){return variantName;}};Experiment.prototype._variantNameByCookie=function(){var key;key=""+this.layer.name+":"+this.id+":Variant";return Cookie.get(key);};Experiment.prototype._variantNameByRoundRobin=function(bucket){var variantIndex;if(!((this.buckets.min<=bucket&&bucket<=this.buckets.max))){return null;}
variantIndex=(bucket-this.buckets.min)%this.variants.length;return this.variants[variantIndex];};Experiment.prototype.bucket=function(){return this.layer.bucket();};Experiment.prototype.experimentDefinition=function(){var _base,_name,_ref;return(_ref=(_base=Finch.Experiments)[_name=this.id])!=null?_ref:_base[_name]={variants:{}};};Experiment.prototype._execute=function(){var variant,window,_ref,_ref1;window=Finch.window;try{if((_ref=this._beforeCallback())!=null){_ref.call(window);}
variant=this.variant();if(variant!=null){debug("rendering variant "+(this.variantName()));debug(variant);if(this.isPreferred()){Finch.Tracking.trackExperiment(this);Finch.Tracking.deliver();}
variant.call(window);}
if((_ref1=this._afterCallback())!=null){_ref1.call(window);}
if(!this.isPreferred()){return Finch.Tracking.trackExperiment(this);}}catch(e){return Finch.Tracking.trackExperimentError(this,e);}};Experiment.prototype._deferCallback=function(){debug("initializing deferred experiment "+this.name);return this.experimentDefinition().defer;};Experiment.prototype._beforeCallback=function(){var self,_ref;self=this;return _.wrap((_ref=this.experimentDefinition().before)!=null?_ref:function(){},function(callback){var _base;debug("starting experiment "+self.name);if(typeof(_base=Finch.Experiments.Global).before==="function"){_base.before();}
return callback();});};Experiment.prototype._afterCallback=function(){var self,_ref;self=this;return _.wrap((_ref=this.experimentDefinition().after)!=null?_ref:function(){},function(callback){var _base;if(typeof(_base=Finch.Experiments.Global).after==="function"){_base.after();}
callback();return debug("completed experiment "+self.name);});};Experiment.prototype._parseBucketRange=function(range){var buckets;if(range==null){range='0..999';}
buckets=range.split('..');return{min:parseInt(buckets[0],10),max:parseInt(buckets[1],10)};};Experiment.prototype._parsePathPatterns=function(patterns){var patternSource,_i,_len,_results;if(!((patterns!=null)&&patterns.length>0)){return[];}
_results=[];for(_i=0,_len=patterns.length;_i<_len;_i++){patternSource=patterns[_i];_results.push(new RegExp("^"+patternSource+"$"));}
return _results;};return Experiment;})();Finch.ConsoleLoggingTracker={track:function(expSets,window){console.log(expSets);return _(expSets).each(function(expSet){var _ref,_ref1;console.log("*****************************");console.log("*** ConsoleLoggingTracker ***");console.log("*****************************");console.log("*** layer: "+((_ref=expSet.layer)!=null?_ref.name:void 0));console.log("*** experiment: "+((_ref1=expSet.experiment)!=null?_ref1.name:void 0));console.log("*** variant: "+expSet.variant);if(expSet.error!=null){console.log("*** error: "+expSet.error);}
return console.log("*****************************");});}};Finch.PixelTracker={track:function(expSets,window){var e,experimentSets,trackerData;if(Finch.alwaysFirePixel||!_.isEmpty(expSets)){experimentSets=_.map(expSets,function(expSet){return{layer:expSet.layer.name,experiment:expSet.experiment.id,variant:expSet.variant,error:expSet.error};});trackerData=Finch.externalData?{experiments:experimentSets,externalData:Finch.externalData}:experimentSets;e=encodeURIComponent(JSON.stringify(trackerData));return this.sendData(e);}},sendData:function(e){var cacheBuster,trackerPath;cacheBuster=(new Date).getTime();trackerPath="/analytic/experiment.gif?e="+e+"&src=img&_="+cacheBuster;return $("<img />",{"class":'finch-tracking',src:trackerPath,height:1,width:1}).appendTo($('body'));}};Finch.AjaxPixelTracker={track:Finch.PixelTracker.track,sendData:function(e){var trackerPath;trackerPath="/analytic/experiment.gif?e="+e+"&src=ajax";return $.ajax(trackerPath,{cache:false});}};}).call(this);(function(){var OptimizeSuite,clearLastEventId,getLastEventId,initBloodhound,initErrorCatcher,initFinch,initReferral,initTrackingHub,initTracky,setLastEventId,withConfigDefaults;OptimizeSuite=window.OptimizeSuite={};OptimizeSuite.init=function(c){var config;config=withConfigDefaults(c);initErrorCatcher();initTracky(config);initTrackingHub(config);initFinch(config.finch);return OptimizeSuite.initBloodhound=function(){return initBloodhound(config);};};getLastEventId=function(){return Cookie.get("bh-last-event-id");};clearLastEventId=function(){return Cookie.unset("bh-last-event-id");};setLastEventId=function(id){return Cookie.set("bh-last-event-id",id,15);};withConfigDefaults=function(config){var group,k,obj,out,v;out={tracking:{interval:3000,endpoint:"/tracky",seed:null},referralMap:{},session:{cookieKey:null,cookieDomain:null,expiry:30*60},page:{parentEventId:getLastEventId(),url:encodeURIComponent(window.location.href)},user:{userAgent:navigator.userAgent,browser:BrowserDetect.browser||"unknown",browserVersion:BrowserDetect.version||"unknown",os:BrowserDetect.OS||"unknown"},finch:{trackers:null,debug:false,alwaysFirePixel:true,config:null},bloodhound:{}};for(group in config){obj=config[group];for(k in obj){v=obj[k];out[group][k]=v;}}
return out;};initFinch=function(config){Finch.debug=config.debug;Finch.alwaysFirePixel=config.alwaysFirePixel;if(config.trackers){Finch.Trackers=config.trackers;}
return Finch.initialize(window,config.config);};initErrorCatcher=function(){ErrorCatcher.init();return ErrorCatcher.on("error",function(e){var errorData;errorData=_.clone(e);delete errorData.timestamp;delete errorData.userAgent;return OptimizeSuite.TrackingHub.add("uncaught-error",errorData);});};initTracky=function(config){Tracky.endpoint=config.tracking.endpoint;return Tracky.seed=config.tracking.seed;};initReferral=function(referralMap){var getQueryValue,key,q,querystring,referral,referrerHost,searchTerm,val;if(referralMap==null){referralMap={};}
referral=void 0;querystring=window.location.search;getQueryValue=function(str,key){var m;if(m=str.match(new RegExp("[\?&]"+key+"=([^&]+)"))){return m[1];}};for(key in referralMap){val=referralMap[key];if(q=getQueryValue(querystring,key)){if(referral==null){referral={};}
referral[val]=q;}}
if(document.referrer){referrerHost=document.referrer.match(/^https?:\/\/([^/]+)/)[1];if(window.location.host!==referrerHost){if(referral==null){referral={};}
referral.url=document.referrer;searchTerm=(function(){switch(referrerHost){case"www.google.com":return getQueryValue(document.referrer,"q");case"search.yahoo.com":return getQueryValue(document.referrer,"p");case"www.bing.com":return getQueryValue(document.referrer,"q");}})();if(searchTerm){referral.searchTerm=searchTerm;}}}
return referral;};initTrackingHub=function(config){var hubData;hubData={seed:config.tracking.seed,flushInterval:config.tracking.interval,session:config.session,page:config.page,user:config.user};hubData.session.referral=initReferral(config.referralMap);TrackingHub.init(hubData);OptimizeSuite.TrackingHub=TrackingHub;TrackingHub.on("flush",function(messages){var trackyData;trackyData=_(messages).map(function(message){var data;data=_.clone(message.data);data.event_name=message.name;data.event_client_timestamp=new Date(message.timestamp);return data;});return Tracky.log(trackyData);});return clearLastEventId();};initBloodhound=function(config){var bloodhound;Bloodhound.Helpers.seed=config.tracking.seed;bloodhound=OptimizeSuite.bloodhound=new Bloodhound(config.bloodhound);bloodhound.on("event",function(event){var d,data,w,_i,_len,_ref;data={type:"event",event:{id:event.id,type:event.type,widgets:[]}};_ref=event.widgets;for(_i=0,_len=_ref.length;_i<_len;_i++){w=_ref[_i];d=w.data();delete d.content;data.event.widgets.push(d);}
setLastEventId(event.id);return OptimizeSuite.TrackingHub.add("bloodhound",data);});bloodhound.on("impression",function(widgets){var data,w,_i,_len;data={type:"impression",widgets:[]};for(_i=0,_len=widgets.length;_i<_len;_i++){w=widgets[_i];data.widgets.push(w.data());}
return OptimizeSuite.TrackingHub.add("bloodhound",data);});return bloodhound.on("error",function(e){var data;data={type:"error",error:e};return OptimizeSuite.TrackingHub.add("bloodhound",data);});};}).call(this);})();if(typeof $!='undefined')
$(function(){if(Groupon.Attributes.optimizer_config){Finch.initialize(window,Groupon.Attributes.optimizer_config);Finch.Trackers=[Groupon.Finch.GrouponAnalyticsTracker,Finch.PixelTracker,Finch.AjaxPixelTracker];}
Finch.run();Groupon.Finch.trigger('run');});Finch.Diversions.SubscriberCookieDiversion=new Finch.HashCookieDiversion('scid');Finch.Experiments.Global={guards:{on_deal_or_division_page:function(){return Groupon.onDealPage||Groupon.onDivisionPage;},on_all_deals_page:function(){return Groupon.onAllDealsPage;},on_getaways_gallery_page:function(){return Groupon.onChannelGalleryPage&&Groupon.currentChannel&&Groupon.currentChannel.permalink==="getaways";},url_params_match:function(params){var queryParams;queryParams=Finch.Utility.parseQueryString(location.search);return _.all(params,function(paramValue,paramName){return(queryParams[paramName]!=null&&queryParams[paramName]===paramValue);});},path_matches:function(pathPatterns){var path;path=location.pathname;if((path!=null)&&pathPatterns.length===0){return true;}
return _.any(pathPatterns,function(pattern){return pattern.test(path);});},user_is_on_rewards:function(){return Groupon.currentUser&&Groupon.currentUser.isAuthenticated&&Groupon.currentUser.onRewards;},user_is_not_on_rewards:function(){return!Finch.Experiments.Global.guards.user_is_on_rewards();},on_rewards_page:function(){return Groupon.onRewardsPage;},division_is_enabled_for_now:function(){return Groupon.division&&Groupon.division.now_customer_enabled;},on_now_page:function(){return Groupon.onNowPage;},on_page_with_sub:function(){var sub_new=Finch.Experiments.Global.guards.path_matches([(/\/subscriptions\/new/)]);return Finch.Experiments.Global.guards.on_deal_or_division_page||sub_new;},on_sub_flow:function(){return Finch.Experiments.Global.guards.path_matches([(/\/subscriptions\/new/)]);},on_checkout_page:function(){return(/^\/deals\/[^\/]+\/confirmation$/).test(window.location.pathname);},on_receipt_page:function(){return Finch.Experiments.Global.guards.path_matches([(/\/thank_you/)]);},now_deal:function(){return Groupon.currentDeal&&!!Groupon.currentDeal.nowDeal;},not_now_deal:function(){return!Groupon.currentDeal||!Groupon.currentDeal.nowDeal;},scheduler_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.bookable;},not_scheduler_deal:function(){return!Groupon.currentDeal||!Groupon.currentDeal.bookable;},on_goods_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.goodsDeal;},not_goods_deal:function(){return!Finch.Experiments.Global.guards.on_goods_deal();},on_travel_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.travelDeal;},not_travel_deal:function(){return!Finch.Experiments.Global.guards.on_travel_deal();},not_has_forced_template:function(){return!Groupon.currentDeal||!Groupon.currentDeal.hasForcedTemplate;},not_subscription_page:function(){var regex=/\/subscriptions\/new/;return!Finch.Experiments.Global.guards.path_matches([regex]);},on_support_page:function(){var support_page_regex=/^(?:\/[a-zA-Z]{2}|\/[a-zA-Z]{2}_[a-zA-Z]{2})?\/support/;return Finch.Experiments.Global.guards.path_matches([support_page_regex]);},supported_browser:function(){return!($.browser.msie&&parseInt($.browser.version,10)<9);},not_on_ie8:function(){return!($.browser.msie&&parseInt($.browser.version,10)==8);},not_on_ie7:function(){return!($.browser.msie&&parseInt($.browser.version,10)==7);},not_on_ie6:function(){return!($.browser.msie&&parseInt($.browser.version,10)<=6);},supports_localstorage:function(){return typeof localStorage!=="undefined"&&localStorage!=null;},not_on_touch_site:function(){var userAgentsRegex=new RegExp("iphone|webos|android|ipad|blackberry .+ applewebkit");return!userAgentsRegex.test(navigator.userAgent.toLowerCase());},not_dale:function(){return location.search.indexOf('dl=d47388')===-1;},on_multi_option_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.multiDeal;},on_dale:function(){return Finch.Experiments.Global.guards.url_params_match({dl:'d47388'});},on_scottsdale:function(){return!!(Groupon.Dale.experiment==="Scottsdale");},on_davesdale:function(){return!!(Groupon.Dale.experiment==="Davesdale");},not_post_purchase:function(){return!Finch.Experiments.Global.guards.url_params_match({post_purchase:'true'});},cookies_enabled:function(){var cookieName='_finch-cookie-test';Cookie.set(cookieName,"enabled");if(Cookie.get(cookieName)==="enabled"){Cookie.unset(cookieName);return true;}else{return false;}},on_sub_center_with_division:function(){var regex=/\/subscription_center\/.*unsubscribed_division/;return regex.test(location.href);},on_page_with_rail_list:function(){return $("#rail_list").length>0;},not_admin:function(){var user=$.parseJSON(unescape(Cookie.get('user_info')));if(user){return!user.aos;}else{return true;}},not_post_subscribe:function(){return Finch.Experiments.Global.guards.url_params_match({post_subscribe:'true'});},not_dale_merchant:function(){var user=$.parseJSON(unescape(Cookie.get('user_info')));if(user){if(user.has_merchants&&Finch.Experiments.Global.guards.url_params_match({dl:'d47388'})){window.location.replace(window.location.toString().replace(/(&)?dl=d47388(&)?/,''));}
return!user.has_merchants;}else{return true;}}}};Finch.Experiments.DaleDivisionTitleVariations={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Original:function(){},Replay:function(){var oneLine=false;var showDescription=false;Groupon.Dale.Behaviors.HyperlocalTitle(Groupon.currentUser.places,Groupon.currentDivisionName,'#location a .title strong',oneLine,showDescription);}},guards:{has_places:function(){return Groupon.currentUser.places&&(Groupon.currentUser.places.length>0);}}};Finch.Experiments.AllDealsDiscount={variants:{Original:function(){},Discounted:function(){$('#deal_container').addClass('all_deals_discounted_group');Groupon.Personalization.AllDeals.Discount=true;}}};Finch.Experiments.PersonalizeWizardCta={Treatments:{CallToAction:{renderInSideNavigation:function(){var renderCallback=function(callToAction){var template='dale/application/callouts/_personalize_wizard_call_to_action_side_navigation',keyBase='js.app.shared.personalize_wizard.callouts.dale.call_to_action_side_navigation';callToAction.data('cta-source','sideNavigation');callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{title:I18n.translate(keyBase+'.title'),instructions:I18n.translate(keyBase+'.instructions'),button_text:I18n.translate(keyBase+'.button_text')}));};Groupon.Dale.Behaviors.PersonalizeWizardCallToAction($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);},renderAtTop:function(){var renderCallback=function(callToAction){var template='dale/application/callouts/_personalize_wizard_call_to_action_top',keyBase='js.app.shared.personalize_wizard.callouts.dale.call_to_action_top';callToAction.data('cta-source','top');callToAction.addClass('top');callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{title:I18n.translate(keyBase+'.title'),link:I18n.translate(keyBase+'.link'),close:I18n.translate(keyBase+'.close')}));var li=$('<li class="personalize_wizard_cta_top">');$(li).append(callToAction);$('#user_menu > ul').append(li);};Groupon.Dale.Behaviors.PersonalizeWizardCallToAction($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);}}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{control:function(){},sideNavigation:function(){Finch.Experiments.PersonalizeWizardCta.Treatments.CallToAction.renderInSideNavigation();},top:function(){Finch.Experiments.PersonalizeWizardCta.Treatments.CallToAction.renderAtTop();}},after:function(){Groupon.Dale.Behaviors.PersonalizeWizardModal($("#personalize_wizard"));Groupon.PersonalizeWizard=Groupon.PersonalizeWizard||{};Groupon.PersonalizeWizard.WizardView=new App.Views.PersonalizeWizard.WizardView({model:new App.Models.PersonalizeWizard.Wizard(),collection:new App.Collections.PersonalizeWizard.Steps([],{currentUser:Groupon.currentUser}),currentUser:Groupon.currentUser});},guards:{wizard_enabled:function(){return $('#personalize_wizard_call_to_action').length===1;},wizard_activated:function(){return App.Helpers.PersonalizeWizard.shouldShow(Groupon.currentUser);}}};Finch.Experiments.PersonalizeWizardCtaG1={Treatments:{PostSubscribe:{defaultBehavior:function(){if(Groupon.Subscription&&Groupon.Subscription.Tracker){Groupon.Subscription.Tracker.get().trackZipGenderPostSubModal();}},showPWModal:function(){Control.Modal.close();$(document).trigger('personalizeWizard.open',$('#personalize_wizard_call_to_action').data('cta-source'));Groupon.Subscription.Tracker.get().trackPersonalizeWizardPostSubModal();}},CallToAction:{renderTop:function(){var renderCallback=function(user){var template='groupon/application/callouts/_personalize_wizard_call_to_action_top',keyBase='js.app.shared.personalize_wizard.callouts.call_to_action_top';this.callToAction.addClass('top');this.callToAction.data('cta-source','TopCTA');this.callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{closeButtonText:I18n.translate(keyBase+'.close_button_text'),startButtonText:I18n.translate(keyBase+'.start_button_text'),prompt:I18n.translate(keyBase+'.prompt')}));};Groupon.PersonalizeWizardCallToAction.init($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);}}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Original:function(){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.defaultBehavior();},TopCTAPWModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderTop();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.showPWModal();}});}},after:function(){Groupon.PersonalizeWizardModal.init($('#personalize_wizard'),Groupon.currentUser);Groupon.PersonalizeWizard=Groupon.PersonalizeWizard||{};Groupon.PersonalizeWizard.WizardView=new App.Views.PersonalizeWizard.WizardView({model:new App.Models.PersonalizeWizard.Wizard(),collection:new App.Collections.PersonalizeWizard.Steps([],{currentUser:Groupon.currentUser}),currentUser:Groupon.currentUser});},guards:{wizard_enabled:function(){return $('#personalize_wizard_call_to_action').length===1;},wizard_activated:function(){return App.Helpers.PersonalizeWizard.shouldShow(Groupon.currentUser);}}};Finch.Experiments.TireKickerVideos={variants:{"Original":function(){if(!Cookie.get('tire_kickers_callout')&&$($.ui.modal.instances).length==0){animateTKCallout();}},"NoVideo":function(){$('.tire_kickers').hide();}},guards:{on_a_tirekicker_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.tirekicker;}}};(function(){function initThumbs(useReasons){Groupon.thumbsOn=true;if(Groupon.onAllDealsPage){_($('.thumbs')).each(function(el){var $overlapped=$(el).closest('.info');if($overlapped){$overlapped.find('.descriptor').addClass('thumbs_on');$overlapped.find('.subtitle').addClass('thumbs_on');}
createThumbs(el,useReasons);});var $carouselFeature=$('.deal_carousel .featured_deal');if($carouselFeature){$carouselFeature.find('.extra_info .btn').addClass('thumbs_on');$carouselFeature.find('.details').addClass('thumbs_on');}}else{var $thumbs=$('.thumbs');if($thumbs.length>0){_($thumbs).each(function(el){createThumbs(el,useReasons);});}else{}}}
function createThumbs(el,useReasons){var view=new App.Views.Thumbs.Thumbs({el:el,collection:new App.Collections.Thumbs.Thumbs([],{deal:$(el).data(),useReasons:useReasons})});view.render();}
Finch.Experiments.ThumbsMVP={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{OnlyThumbs:function(){initThumbs(false);}},guards:{on_thumb_page:function(){return(Groupon.onDealPage||Groupon.onDivisionPage||Groupon.onAllDealsPage);},thumbs_feature_enabled:function(){return!!Groupon.thumbsEnabled;},is_internal_user:function(){return!!(typeof Groupon.currentUser.emailAddress!=="undefined"&&Groupon.currentUser.emailAddress.match(/@groupon.com$/i));}}};Finch.Experiments.ThumbsInternal={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Original:function(){},OnlyThumbs:function(){initThumbs(false);},ThumbsWithReasons:function(){initThumbs(true);}},guards:{on_thumb_page:function(){return(Groupon.onDealPage||Groupon.onDivisionPage||Groupon.onAllDealsPage);},thumbs_feature_enabled:function(){return!!Groupon.thumbsEnabled;},is_internal_user:function(){return!!(typeof Groupon.currentUser.emailAddress!=="undefined"&&Groupon.currentUser.emailAddress.match(/@groupon.com$/i));}}};Finch.Experiments.ThumbsExternal={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Control:function(){},OnlyThumbs:function(){initThumbs(false);},ThumbsWithReasons:function(){initThumbs(true);}},guards:{on_thumb_page:function(){return(Groupon.onDealPage||Groupon.onDivisionPage||Groupon.onAllDealsPage);},thumbs_feature_enabled:function(){return!!Groupon.thumbsEnabled;},is_logged_in_user:function(){return!!Groupon.currentUser.isAuthenticated;}}};})();Finch.Experiments.Scottsdale={runOnInit:true,variants:{Original:function(){},Dale:function(){Groupon.Dale=_.extend(Groupon.Dale||{},{experiment:"Scottsdale"});if(location.search.indexOf('dl=d47388')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')
+'dl='+'d47388';window.location.replace(param);}}},guards:{not_post_subscribe:function(){return Finch.Experiments.Global.guards.url_params_match({post_subscribe:'true'});},not_merchant:function(){var user=$.parseJSON(unescape(Cookie.get('user_info')));if(user){if(user.has_merchants&&Finch.Experiments.Global.guards.url_params_match({dl:'d47388'})){window.location.replace(window.location.toString().replace(/(&)?dl=d47388(&)?/,''));}
return!user.has_merchants;}
else
return true;},not_admin:function(){var user=$.parseJSON(unescape(Cookie.get('user_info')));if(user){return!user.aos;}
else
return true;},not_opted_out_of_dale:function(){return!Cookie.get("daleOptOut");}}};Finch.Experiments.Davesdale={runOnInit:true,variants:{Original:function(){},Dale:function(){Groupon.Dale=_.extend(Groupon.Dale||{},{experiment:"Davesdale"});if(location.search.indexOf('dl=d47388')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')
+'dl='+'d47388';window.location.replace(param);}}},guards:Finch.Experiments.Scottsdale.guards};Finch.Experiments.DaleRedirect={runOnInit:true,variants:{Original:function(){},Redirect:function(){if(!Cookie.get("redirected")&&location.search.indexOf('dl=')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')
+'dl='+'t31337';Cookie.set("redirected",true,7200);window.location.replace(param);}}}};Finch.Experiments.DaleFullyDesigned={variants:{Dale:function(){Finch.Experiments.Scottsdale.variants.Dale();$(function(){var removePurchaseCluster=function(){$('.purchase_cluster_2').remove();};removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});},PurchaseCluster:function(){$(function(){$('body').addClass('worf');var removePurchaseCluster=function(){if(!($('.purchase_cluster').hasClass('purchase_cluster_2')))$('.purchase_cluster').remove();$('.purchase_cluster_2').addClass('purchase_cluster');};removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});},NoOp:function(){Finch.Experiments.Scottsdale.variants.Dale();$(function(){var removePurchaseCluster=function(){$('.purchase_cluster_2').remove();};removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});},FullyDesigned:function(){$(function(){$('body').addClass('picard worf');var removePurchaseCluster=function(){if(!($('.purchase_cluster').hasClass('purchase_cluster_2')))$('.purchase_cluster').remove();$('.purchase_cluster_2').addClass('purchase_cluster');};removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});}},guards:Finch.Experiments.Scottsdale.guards};Finch.Experiments.DaleBuyButton={runOnInit:true,variants:{Original:function(){},Flipped:function(){var timer=setInterval(function(){if(typeof document.body!="undefined"){clearInterval(timer);$(document.body).addClass('geordi');}},10);},Responsive:function(){var timer=setInterval(function(){if(typeof document.body!="undefined"){clearInterval(timer);$(document.body).addClass('crusher');}},10);}},guards:Finch.Experiments.Scottsdale.guards};Finch.Experiments.DaleResponsiveDealPage={runOnInit:true,variants:{Original:function(){},Responsive:function(){var timer=setInterval(function(){if(typeof document!="undefined"&&typeof document.body!="undefined"){clearInterval(timer);$(document.body).addClass('yar tribble');$(function(){$(document.body).addClass('yar tribble');});}},10);},MGD:function(){var timer=setInterval(function(){if(typeof document!="undefined"&&typeof document.body!="undefined"){clearInterval(timer);$(document.body).addClass('yar tribble mgd-enabled');$(function(){$(document.body).addClass('yar tribble mgd-enabled');});}},10);}},guards:Finch.Experiments.Scottsdale.guards};(function(){function redirectToDaleParam(){Groupon.Dale=_.extend(Groupon.Dale||{},{experiment:"Scottsdale"});if(location.search.indexOf('dl=d47388')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')+'dl='+'d47388';window.location.replace(param);}}
function ogControl(){}
function redirectToOGParam(){if(location.search.indexOf('dl=t31337')<0){$(document.body).hide();var param=location.search+(location.search==''?'?':'&')+'dl='+'t31337';window.location.replace(param);}}
function addResponsiveBodyClasses(){var timer=setInterval(function(){if(typeof document!="undefined"&&typeof document.body!="undefined"){clearInterval(timer);$(document.body).addClass('yar tribble');$(function(){$(document.body).addClass('yar tribble');});if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(function(){$('.deal_frame > .image_wrapper > img').removeAttr('width').removeAttr('height');new Groupon.Views.ThumbnailScroll(".deal_main_col");});}else{$(function(){$('.deal_frame > .image_wrapper > img').removeAttr('width').removeAttr('height');new Groupon.Views.ThumbnailScroll(".deal_main_col");});}}},10);}
function moreGreatDeals(){var timer=setInterval(function(){if(typeof document!="undefined"&&typeof document.body!="undefined"){clearInterval(timer);$(document.body).addClass('yar tribble mgd-enabled');$(function(){$(document.body).addClass('yar tribble mgd-enabled');});}},10);}
function daleResponsiveDealPage(){redirectToDaleParam();addResponsiveBodyClasses();}
function daleResponsiveMoreGreatDeals(){redirectToDaleParam();moreGreatDeals();}
Finch.Experiments.ScottsdaleRedirect={runOnInit:true,variants:{OGControl:ogControl,DaleRedirect:redirectToDaleParam,ResponsiveDealPage:daleResponsiveDealPage,OGRedirect:redirectToOGParam,ResponsiveMoreGreatDeals:daleResponsiveMoreGreatDeals}};Finch.Experiments.Scottsdale1=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale2=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale3=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale4=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale5=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale6=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale7=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale8=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale9=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale10=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale11=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale12=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale13=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale14=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale15=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale16=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale17=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale18=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale19=Finch.Experiments.ScottsdaleRedirect;Finch.Experiments.Scottsdale20=Finch.Experiments.ScottsdaleRedirect;})();Finch.Experiments.OGCurrentUserReady={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{variant_1:function(){},variant_2:function(){}}};Finch.Experiments.NoTippingPt={variants:{Original:function(){},HideTippingPoint:function(){Groupon.onCurrentUserReady(function(){$('#number_sold_container').addClass('finch_hidden_tipping_point');});}},guards:{deal_is_not_sold_out:function(){return!Groupon.currentDeal.sold_out;}}};Finch.Experiments.ClickyBannerHoldout={variants:{Original:function(){},HideClickyBanner:function(){$('#rail_list .clicky_badge').hide();}}};Finch.Experiments.ClickyBanner={variants:{Original:function(){},ShowClickyBanner:function(){$('#rail_list .clicky_badge').show();}},guards:{is_division_in_list:function()
{disabledDivisions={"Nashville":true,"Salt Lake City":true,"San Francisco":true,"Hampton Roads":true,"Jacksonville":true,"New Orleans":true,"Hartford":true,"Inland Empire":true,"Calgary":true,"Louisville":true,"Oklahoma City":true,"Richmond":true,"Central Jersey":true,"Ottawa":true,"Edmonton":true,"Honolulu":true,"Providence":true,"Birmingham":true,"Grand Rapids":true,"Buffalo":true,"Rochester":true,"Memphis":true,"Omaha":true,"Wichita":true,"Knoxville":true,"Raleigh":true,"Baltimore":true,"Austin":true,"Indianapolis":true,"Kansas City":true,"Charlotte":true,"Sacramento":true,"Pittsburgh":true,"San Jose":true,"San Antonio":true,"Columbus":true,"Cincinnati":true,"Fort Lauderdale":true,"Cleveland":true,"Milwaukee":true,"Fort Worth":true,"Long Island":true,"Palm Beach":true,"Tucson":true,"Madison":true,"Akron":true,"Greenville":true,"Westchester County":true,"Dayton":true,"Colorado Springs":true,"Fairfield County":true,"Ann Arbor":true,"Napa / Sonoma":true,"Santa Cruz":true,"Salem":true,"Lakeland":true,"Athens":true,"Stockton":true,"Youngstown":true,"Topeka":true};return!disabledDivisions[Groupon.division.name];}}};Finch.Experiments.StaySignedIn={variants:{Control:function(){},HideUnchecked:function(){$("#brief_form_remember_me").hide();$("input#user_remember_me").prop('checked',false);}}};Finch.Experiments.PromoCodePosition={variants:{Control:function(){},RightRail:function(){var module;function setup(){var orig=Groupon.ui.reloadSubtotalMustachePartial;Groupon.ui.reloadSubtotalMustachePartial=function(event){orig(event);moveToSidebar();};moveToSidebar();}
function moveToSidebar(){if(module){module.remove();}
var content=$("<div>",{"class":"module_content"});module=$("<div>",{"class":"module"}).append($("<div>",{"class":"module_top"}).append($("<h3>",{"text":"Have a Gift Card?"}))).append(content);var oldContainer=$("#subtotal .promo_item td");oldContainer.find("> *").each(function(){content.append(this);});oldContainer.remove();$("#rail").prepend(module);}
setup();}}};Finch.Experiments.DisableDealBankPostSubscribe={variants:{control:function(){},disabled:function(){var newSubForm=$("#new_subscription");if(newSubForm.length>0){var url=newSubForm.attr("action");var seperator=url.indexOf('?')>=0?'&':'?';newSubForm.attr("action",url+seperator+"ddb=true");}}}};Finch.Experiments.CachedConfirmationPageTwo={variants:{uncached:function(){Groupon.Personalization.cachedCheckout=false;},cached:function(){Groupon.Personalization.cachedCheckout=true;}}};Finch.Experiments.CachedConfirmationPage={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!='undefined'){Groupon.onCurrentUserReady(function(){experiment.deferredRun(Finch.window);});}},variants:{uncached:function(){},cached:function(){Groupon.Personalization.modifyBuyButtonForCachedCheckout();}},guards:{eligable_for_cached_checkout:function(){if(typeof Groupon.Personalization!='undefined'){return Groupon.Personalization.eligableForCachedCheckout(Groupon.currentUser,Groupon.currentDeal);}else{return false;}}}};(function(){function replaceNumInElement(elem){var original=elem.html();var num=original.match(/[\d,]+/);if(num){elem.html(original.replace(/[\d,]+/,depreciateNumber(num.first())));}}
function depreciateNumber(num){if(num<2){return addCommas(num);}
num=parseInt(num.replace(/,/,'')*0.70,10);num=roundDown(num);return addCommas(num);}
function roundDown(num){if(num>100){var exp=parseInt(Math.log(num)/Math.log(10),10)-1;num=num-(num%Math.pow(10,exp));}
return num;}
function addCommas(num){var nStr=''+num;var rgx=/(\d+)(\d{3})/;while(rgx.test(nStr)){nStr=nStr.replace(rgx,'$1'+','+'$2');}
return nStr;}
Finch.Experiments.DepreciateFaultyCounter={variants:{control:function(){},depreciation:function(){$(".number, .status div").each(function(){replaceNumInElement($(this));});$('.cdn_cached #rail .integrated_side_deals, #number_sold_container').live('updated',function(){$(this).find('.number').each(function(){replaceNumInElement($(this));});});}}};})();Finch.Experiments.Relevance={variants:{Original:function(){if(App){App.ExperimentVersions.Relevance="Original";}},SearchService:function(){if(App){App.ExperimentVersions.Relevance="SearchService";}}}};Finch.Experiments.NowRelevanceSwitch={variants:{Original:function(){if(App){App.ExperimentVersions.NowRelevanceSwitch="Original";}},RelevanceService:function(){if(App){App.ExperimentVersions.NowRelevanceSwitch="RelevanceService";}}}};Finch.Experiments.ShowLogin={variants:{Control:function(){},Visible:function(){$("#login_form").show();$("#login_banner").hide();}}};Finch.Experiments.Occurrences={variants:{Original:function(){if(window.App){App.ExperimentVersions.Occurrences='Original';}},Stylized:function(){if(window.App){App.ExperimentVersions.Occurrences='Stylized';}},Standard:function(){if(window.App){App.ExperimentVersions.Occurrences='Standard';}}}};Finch.Experiments.LocalFavorites={variants:{Original:function(){if(window.App){App.ExperimentVersions.LocalFavorites='Original';}},FavoritesV1:function(){if(window.App){App.ExperimentVersions.LocalFavorites='FavoritesV1';}},FavoritesV2:function(){if(window.App){App.ExperimentVersions.LocalFavorites='FavoritesV2';}},FavoritesV3:function(){if(window.App){App.ExperimentVersions.LocalFavorites='FavoritesV3';}}},guards:{division_enabled_for_local_favorites:function(){return!!(Groupon.enabledFeatures&&Groupon.enabledFeatures.localFavorites);}}};Finch.Experiments.RewardsMCVariation={runOnInit:true,variants:{Control:function(){Groupon.showNewRewardsText=false;},MC:function(){Groupon.showNewRewardsText=true;}}};Finch.Experiments.PersonalizeWizard={Treatments:{PostSubscribe:{defaultBehavior:function(){if(Groupon.Subscription&&Groupon.Subscription.Tracker){Groupon.Subscription.Tracker.get().trackZipGenderPostSubModal();}},showPWModal:function(){Control.Modal.close();$(document).trigger('personalizeWizard.open',$('#personalize_wizard_call_to_action').data('cta-source'));Groupon.Subscription.Tracker.get().trackPersonalizeWizardPostSubModal();},suppressZGModal:function(){Control.Modal.close();}},CallToAction:{renderTop:function(){var renderCallback=function(user){var template='groupon/application/callouts/_personalize_wizard_call_to_action_top',keyBase='js.app.shared.personalize_wizard.callouts.call_to_action_top';this.callToAction.addClass('top');this.callToAction.data('cta-source','TopCTA');this.callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{closeButtonText:I18n.translate(keyBase+'.close_button_text'),startButtonText:I18n.translate(keyBase+'.start_button_text'),prompt:I18n.translate(keyBase+'.prompt')}));};Groupon.PersonalizeWizardCallToAction.init($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);},renderBottom:function(){var renderCallback=function(user){var template='groupon/application/callouts/_personalize_wizard_call_to_action_bottom',keyBase='js.app.shared.personalize_wizard.callouts.call_to_action_bottom';this.callToAction.addClass('bottom');this.callToAction.data('cta-source','BottomCTA');this.callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{closeButtonText:I18n.translate(keyBase+'.close_button_text'),title:I18n.translate(keyBase+'.title',{first_name:user.firstName}),instructions:I18n.translate(keyBase+(user.firstName?'.instructions_with_name':'.instructions_without_name'),{strong_open:'<strong>',strong_close:'</strong>',first_name:user.firstName}),startButtonText:I18n.translate(keyBase+'.start_button_text'),progressBarLabel:I18n.translate(keyBase+'.progress_bar_label')}));};Groupon.PersonalizeWizardCallToAction.init($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);}}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Original:function(){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.defaultBehavior();},TopCTAPWModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderTop();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.showPWModal();}});},BottomCTANoModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderBottom();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.suppressZGModal();}});},BottomCTAZGModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderBottom();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.defaultBehavior();}});}},after:function(){Groupon.PersonalizeWizardModal.init($('#personalize_wizard'),Groupon.currentUser);Groupon.PersonalizeWizard=Groupon.PersonalizeWizard||{};Groupon.PersonalizeWizard.WizardView=new App.Views.PersonalizeWizard.WizardView({model:new App.Models.PersonalizeWizard.Wizard(),collection:new App.Collections.PersonalizeWizard.Steps([],{currentUser:Groupon.currentUser}),currentUser:Groupon.currentUser});},guards:{wizard_enabled:function(){return $('#personalize_wizard_call_to_action').length===1;},wizard_activated:function(){return App.Helpers.PersonalizeWizard.shouldShow(Groupon.currentUser);}}};Finch.Experiments.ReceiptPage={variants:{Original:function(){},ReceiptPage:function(){}}};var PlacesTreatments={subs:{disabled_featured:function(){},disabled_alldeals:function(){}},users:{disabled:function(){},enabled:function(){}}};var placesExperiment=function(options){return{variants:{group1:function(){PlacesTreatments["subs"][options["group1"]["subs"]]();PlacesTreatments["users"][options["group1"]["users"]]();},group2:function(){PlacesTreatments["subs"][options["group2"]["subs"]]();PlacesTreatments["users"][options["group2"]["users"]]();}}};};Finch.Experiments.Places0=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places1=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places2=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places3=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places4=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places5=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places6=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places7=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places8=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places9=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Bumpdown={variants:{Original:function(){},Bumpdown:function(){},BumpdownImages:function(){}},guards:{show_personalize_callout:function(){return false;},not_post_subscribe:function(){return false;},on_bumpdownable_page:function(){return false;}}};Finch.Experiments.NowRemoveMap={variants:{Original:function(){if(window.App){App.ExperimentVersions.NowRemoveMap=1;}},RemoveMap:function(){if(window.App){App.ExperimentVersions.NowRemoveMap=2;}}}};Finch.Experiments.NowRemoveMerchantWriteup={variants:{Original:function(){if(window.App){App.ExperimentVersions.NowRemoveMerchantWriteup=1;}},RemoveMerchantWriteup:function(){if(window.App){App.ExperimentVersions.NowRemoveMerchantWriteup=2;}}}};Finch.Experiments.AdPlacement={variants:{Original:function(){if(window.App){App.ExperimentVersions.NowAdChiclets='Original';}},Top:function(){if(window.App){App.ExperimentVersions.NowAdChiclets='Top';}}}};Finch.Experiments.ShowBookOnlineText={variants:{Control:function(){},Display:function(){if(Groupon.currentDeal&&Groupon.currentDeal.bookable){if(Finch.Experiments.Global.guards.url_params_match({dl:'d47388'})){$('.bookable_section').show();}
else{$('#price_tag').addClass('bookable');$('#scheduler_tooltip').show();}}}}};Finch.Experiments.TabbedDescription={variants:{Control:function(){},Tabs:function(){$('#tabs').tabs();$("#content .deal .secondary .tabbed").show();$("#write_up .article .tabbed").show();$("#content .deal .secondary .control").hide();$("#write_up .article .control").hide();}}};Finch.Experiments.SideDealsShortDescriptor={variants:{Control:function(){},ShortDescriptor:function(){$('.finch_short_descriptor_hide').hide();$('.finch_short_descriptor_gray').css('color','#949494');$('.finch_short_descriptor_show').show();}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}};Finch.Experiments.ShowMoreNowDeals={variants:{Control:function(){},Show20:function(){}}};Finch.Experiments.ReceiptPage={variants:{Original:function(){},ReceiptPage:function(){}}};Finch.Experiments.Bumpdown={variants:{Original:function(){},Bumpdown:function(){},BumpdownImages:function(){}},guards:{show_personalize_callout:function(){return false;},not_post_subscribe:function(){return false;},on_bumpdownable_page:function(){return false;}}};Finch.Experiments.TrackingTest={variants:{variant_1:function(){},variant_2:function(){}}};Finch.Experiments.TrackingTestDeferred={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{variant_1:function(){},variant_2:function(){}}};Finch.Experiments.TrackingTestLearn={variants:{variant_1:function(){},variant_2:function(){}},guards:{on_learn_page:function(){return Finch.Experiments.Global.guards.path_matches([(/^.*\/learn\/?$/)]);}}};Finch.Experiments.ClarifyCopy={variants:{control:function(){},added_copy:function(){$(".skip_notification").show();}}};Finch.Experiments.RedirectToAllDeals={runOnInit:true,variants:{Control:function(){},Redirect:function(){if(document.referrer.indexOf(window.location.host)===-1){window.location.pathname=window.location.pathname.replace(/\/$/,"")+"/all";}}},guards:{not_sem:function(){return location.search.indexOf('utm_')===-1;},on_division_page:function(){return Groupon.onDivisionPage;}}};Finch.Experiments.HelpfulTip={variants:{control:function(){Groupon.SupportTesting.control();},optional_answer:function(){Groupon.SupportTesting.optionalAnswer();},force_answer:function(){Groupon.SupportTesting.forceAnswer();}}};Finch.Experiments.TorbitMonitoring={runOnInit:true,variants:{Control:function(){},Torbit:function(){Groupon.torbitBeaconEnabled=true;}}};Finch.Experiments.SitcomMonitoring={runOnInit:true,variants:{Control:function(){},Sitcom:function(){Groupon.useSitcom=true;}}};Finch.Experiments.Clicktale={variants:{Control:function(){},Clicktale:function(){Groupon.clicktaleEnabled=true;}}};Finch.Experiments.HyperLocal={runOnInit:true,variants:{Control:function(){},HyperLocal:function(){if(location.pathname.indexOf('/nearby/subscriptions/new')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/','/nearby/subscriptions/');window.location=new_url;}}}};Finch.Experiments.HyperLocalZip={runOnInit:true,variants:{Control:function(){},HyperLocalZip:function(){if(location.pathname.indexOf('/nearby/subscriptions/new_zip')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/new','/nearby/subscriptions/new_zip');window.location=new_url;}}}};Finch.Experiments.HyperLocalZipEarlySubscribe={runOnInit:true,variants:{Control:function(){},HyperLocalZipEarlySubscribe:function(){if(location.pathname.indexOf('/nearby/subscriptions/new_zip')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/new','/nearby/subscriptions/new_zip');window.location=new_url;}}}};Finch.Experiments.HyperLocalKitchenSinkLocation={runOnInit:true,variants:{Control:function(){},HyperLocalKitchenSinkLocation:function(){if(location.pathname.indexOf('/nearby/subscriptions/new_kitchen_sink_location')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/new','/nearby/subscriptions/new_kitchen_sink_location');window.location=new_url;}else{Groupon.subscriptionWizard=true;$(function(){new App.Views.Subscription.SubscriptionView({url:'new_kitchen_sink_location',el:'#article',model:new App.Models.Subscription.Subscription(),collection:new App.Collections.Subscription.Steps([new App.Models.Subscription.EmailStep(),new App.Models.Subscription.KitchenSinkLocationStep()])}).render();});}}}};Finch.Experiments.HyperLocalZipEmail={runOnInit:true,variants:{Control:function(){},HyperLocalZipEmail:function(){if(location.pathname.indexOf('/nearby/subscriptions/new')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/new','/nearby/subscriptions/new');window.location=new_url;}else{Groupon.subscriptionWizard=true;$(function(){new App.Views.Subscription.SubscriptionView({url:'new_zip',el:'#article',model:new App.Models.Subscription.Subscription(),collection:new App.Collections.Subscription.Steps([new App.Models.Subscription.ZipStep(),new App.Models.Subscription.EmailStep()])}).render();});}}}};Finch.Experiments.HyperLocalEmailZip={runOnInit:true,variants:{Control:function(){},HyperLocalEmailZip:function(){if(location.pathname.indexOf('/nearby/subscriptions/new')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/new','/nearby/subscriptions/new');window.location=new_url;}else{Groupon.subscriptionWizard=true;$(function(){new App.Views.Subscription.SubscriptionView({url:'new_zip',el:'#article',model:new App.Models.Subscription.Subscription(),collection:new App.Collections.Subscription.Steps([new App.Models.Subscription.EmailStep(),new App.Models.Subscription.ZipStep()])}).render();});}}}};Finch.Experiments.BestOfWidget={variants:{Control:function(){},BestOfWidget:function(){var bestOf=new App.Collections.Widgets.BestOfDeals([],{sideDeals:Groupon.sideDeals,currentDealPermalink:Groupon.currentDeal?Groupon.currentDeal.permalink:null});bestOf.fetch().then(function(){(new App.Views.Widgets.BestOfDeals({collection:bestOf})).render();});}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}};Finch.Experiments.SimilarDealsWidget={variants:{Control:function(){},ThreeDeals:function(){if(Groupon.currentDeal){var similarDeals=new App.Collections.Widgets.SimilarDeals([],{currentDealPermalink:Groupon.currentDeal.permalink,limit:3});similarDeals.fetch().then(function(){(new App.Views.Widgets.SideRailDeals({collection:similarDeals,title:I18n.translate("js.views.widgets.similar_deals.title")})).render();});}},FiveDeals:function(){if(Groupon.currentDeal){var similarDeals=new App.Collections.Widgets.SimilarDeals([],{currentDealPermalink:Groupon.currentDeal.permalink,limit:5});similarDeals.fetch().then(function(){(new App.Views.Widgets.SideRailDeals({collection:similarDeals,title:I18n.translate("js.views.widgets.similar_deals.title")})).render();});}}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}};Finch.Experiments.BestDealTypeWidget={variants:{Control:function(){},FiveDeals:function(){if(Groupon.currentUser&&Groupon.currentUser.personas&&Groupon.currentUser.personas.length>0){var personaIDs=_.map(Groupon.currentUser.personas,function(persona){if(persona.status==="active")
return persona.persona_id;}).compact();var bestTypeDeals=new App.Collections.Widgets.BestTypeDeals([],{dealTypeIDs:personaIDs,limit:5,sideDeals:Groupon.sideDeals,currentDealPermalink:Groupon.currentDeal?Groupon.currentDeal.permalink:null});bestTypeDeals.fetch().then(function(){var title=I18n.translate("js.views.widgets.best_type_deals.title",{deal_type_name:bestTypeDeals.dealTypeName});(new App.Views.Widgets.SideRailDeals({collection:bestTypeDeals,title:title})).render();});}}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}};Finch.Experiments.DaleSimilarDealsWidget={run:function(title){if(Groupon.currentDeal){var similarDeals=new App.Collections.Widgets.SimilarDeals([],{currentDealPermalink:Groupon.currentDeal.permalink,limit:4,loadVortexAttributes:true});similarDeals.fetch().then(function(){$("#main").after($("<div class='deal-vortex-wrap vortex_widget'></div>"));(new App.Views.Widgets.Vortex({collection:similarDeals,title:title})).render();});}},variants:{Control:function(){},TitleA:function(){Finch.Experiments.DaleSimilarDealsWidget.run("More Deals for You to Love");},TitleB:function(){Finch.Experiments.DaleSimilarDealsWidget.run("You Might Also Dig");}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}}
Finch.Experiments.RedirectToLUP1={runOnInit:true,variants:{Control:function(){},RedirectControl:function(){var param;if(Cookie.get("lup1")!=="control"){Cookie.set("lup1","control",60*60*24*7);param=window.location.search+(window.location.search==''?'?':'&')+'lup=0';window.location.replace(param);}},LUP1:function(){var param;if(Cookie.get("lup1")!=="redirect"){Cookie.set("lup1","redirect",60*60*24*7);param=window.location.search+(window.location.search==''?'?':'&')+'lup=1';window.location.replace(param);}}}};Finch.Experiments.ReorderSidebar={variants:{Original:function(){},Reordered:function(){var callout=$("li#channel_callout").remove();var sideDeals=$("li.integrated_side_deals").remove();var nowWidget=$("li#now_widget").remove();var clicky=$("li.clicky_badge").remove();var railList=$("#rail_list");railList.prepend(sideDeals).prepend(nowWidget).prepend(clicky).prepend(callout);}}};Finch.Experiments.NewModals={variants:{Original:function(){},Feedback:function(){subscription_center_key=$('#subscription_center_key').val();Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.load',{subscription_center_key:subscription_center_key});if($("body .surrogate_success").length>0){$("#alerts .success").hide();}
$('#finch_feedback').show();$('#finch_base').hide();$('#back_to_sub_center').click(function(e){$('#finch_base').show();$('#finch_feedback').hide();Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.reason',{subscription_center_key:subscription_center_key,feedback:'back_to_manage'});});$('#download_mobile_app').click(function(e){Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.reason',{subscription_center_key:subscription_center_key,feedback:'download_mobile_app'});});$('input.feedback').click(function(e){Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.reason',{subscription_center_key:subscription_center_key,feedback:e.target.name});});}}};Finch.Experiments.NewModals2=Finch.Experiments.NewModals;Finch.Experiments.DisableGetawaysStickyBar={variants:{Original:function(){},StickyBarDisabled:function(){$(function(){Groupon.Getaways.StickyBar.disable();});}}};Finch.Experiments.RecentlyViewedDeals={variants:{Control:function(){},ThreeDeals:function(){var rvd=new App.Collections.Widgets.RecentlyViewedDeals({userPermalink:Groupon.currentUser.permalink});rvd.fetch().then(function(){(new App.Views.Widgets.SideRailDeals({collection:rvd,currentDealPermalink:Groupon.currentDeal.permalink,title:I18n.translate("js.views.widgets.recently_viewed_deals.title"),maxDeals:3,reverse:true})).render();});},FiveDeals:function(){var rvd=new App.Collections.Widgets.RecentlyViewedDeals({userPermalink:Groupon.currentUser.permalink});rvd.fetch().then(function(){(new App.Views.Widgets.SideRailDeals({collection:rvd,currentDealPermalink:Groupon.currentDeal.permalink,title:I18n.translate("js.views.widgets.recently_viewed_deals.title"),maxDeals:5,reverse:true})).render();});}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}};Finch.Experiments.DaleRecentlyViewedDeals={variants:{Control:function(){},ThreeDeals:function(){var rvd=new App.Collections.Widgets.RecentlyViewedDeals({userPermalink:Groupon.currentUser.permalink});rvd.fetch().then(function(){(new App.Views.Widgets.DaleSideRailDeals({collection:rvd,currentDealPermalink:Groupon.currentDeal.permalink,title:I18n.translate("js.views.widgets.recently_viewed_deals.title"),maxDeals:3})).render();});},FiveDeals:function(){var rvd=new App.Collections.Widgets.RecentlyViewedDeals({userPermalink:Groupon.currentUser.permalink});rvd.fetch().then(function(){(new App.Views.Widgets.DaleSideRailDeals({collection:rvd,currentDealPermalink:Groupon.currentDeal.permalink,title:I18n.translate("js.views.widgets.recently_viewed_deals.title"),maxDeals:5})).render();});}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;}};Finch.Experiments.RewardsNewBadge={variants:{Control:function(){},HideBadge:function(){$('.Rewards .new_badge').hide();}},guards:{on_page_with_rewards_new_badge:function(){return $('.Rewards .new_badge').length>0;}}};Finch.Experiments.RedirectEffect={runOnInit:true,variants:{Control:function(){},ControlB:function(){},Redirect:function(){Cookie.set("fre","1");var divider=(window.location.href.indexOf("?")>-1)?"&":"?";window.location.href=window.location.href+divider+"fre=1";}},guards:{should_redirect:function(){return!(Cookie.get("fre"));}}};Finch.Experiments.HideCheckoutHeaderFooter={runOnInit:true,variants:{Control:function(){},Hide:function(){$("head").append($("<style>#header_nav, #header .account_links, #footer { display: none; }</style>"));}}};Finch.Experiments.DisplayExtraInfo={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{ExtraStuff:function(){$(".extended_info .title").hide();$(".tile_summary").show();$(".descriptor").show();},Control:function(){}}};Finch.Experiments.ConfirmationPageSignIn={variants:{ShowButton:function(){$("#show_login_subform.sign_in").hide();$("#show_login_subform.alt_sign_in").show();},Control:function(){}}};(function(){var config;config={tracking:{seed:Cookie.get("s")||"nocookie"+Math.floor(Math.random()*1000000)},referralMap:{utm_source:"source",utm_campaign:"campaign",utm_medium:"medium",utm_content:"content",utm_term:"term"},session:{cookieKey:"s",cookieDomain:Groupon.optimizeSuiteData.cookieDomain},page:{type:Groupon.optimizeSuiteData.pageType,division:Groupon.optimizeSuiteData.division,country:Groupon.optimizeSuiteData.country,channel:Groupon.optimizeSuiteData.channel},user:{browserId:Cookie.get("b"),scid:Cookie.get("scid")},finch:{trackers:[Groupon.Finch.GrouponAnalyticsTracker,Finch.PixelTracker,Finch.AjaxPixelTracker,Groupon.Finch.TrackingHubTracker],debug:Groupon.optimizeSuiteData.debugFinch,alwaysFirePixel:Groupon.optimizeSuiteData.alwaysFireFinchPixel,config:Groupon.optimizeSuiteData.finchConfig}};OptimizeSuite.init(config);Groupon.TrackingHub=OptimizeSuite.TrackingHub;$(function(){var onReady;onReady=Groupon.onCurrentUserReady||function(f){return f();};return onReady(function(){OptimizeSuite.initBloodhound();return Groupon.bloodhound=OptimizeSuite.bloodhound;});});}).call(this);$(document).bind('currentUserReady',function(){Sitcom.mark("currentUserReady");Sitcom.measure("personalization","_starttime","currentUserReady");});$(window).load(function(){Sitcom.done(Sitcom.sendBeacon);});var WRInitTime=(new Date()).getTime();(function(exports){exports.namespace=function(nsName,func){var current=exports,names=nsName.split('.'),moduleName=names.pop(),name;while(name=names.shift()){current[name]=current[name]||{};current=current[name];}
current[moduleName]=func();};})(this);