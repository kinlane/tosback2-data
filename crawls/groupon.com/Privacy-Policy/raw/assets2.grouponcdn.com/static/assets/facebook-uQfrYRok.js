
(function(name,global,definition){"use strict";if(typeof module!=='undefined'){module.exports=definition(name,global);}else if(typeof define==='function'&&typeof define.amd==='object'){define(definition);}else{global[name]=definition(name,global);}}('PubSub',(typeof window!=='undefined'&&window)||this,function definition(name,global){"use strict";var PubSub={name:'PubSubJS',version:'1.3.1-dev'},messages={},lastUid=-1;function throwException(ex){return function reThrowException(){throw ex;};}
function callSubscriber(subscriber,message,data){try{subscriber(message,data);}catch(ex){setTimeout(throwException(ex),0);}}
function deliverMessage(originalMessage,matchedMessage,data){var subscribers=messages[matchedMessage],i,j;if(!messages.hasOwnProperty(matchedMessage)){return;}
for(i=0,j=subscribers.length;i<j;i++){callSubscriber(subscribers[i].func,originalMessage,data);}}
function createDeliveryFunction(message,data){return function deliverNamespaced(){var topic=String(message),position=topic.lastIndexOf('.');deliverMessage(message,message,data);while(position!==-1){topic=topic.substr(0,position);position=topic.lastIndexOf('.');deliverMessage(message,topic,data);}};}
function messageHasSubscribers(message){var topic=String(message),found=messages.hasOwnProperty(topic),position=topic.lastIndexOf('.');while(!found&&position!==-1){topic=topic.substr(0,position);position=topic.lastIndexOf('.');found=messages.hasOwnProperty(topic);}
return found;}
function publish(message,data,sync){var deliver=createDeliveryFunction(message,data),hasSubscribers=messageHasSubscribers(message);if(!hasSubscribers){return false;}
if(sync===true){deliver();}else{setTimeout(deliver,0);}
return true;}
PubSub.publish=function(message,data){return publish(message,data,false);};PubSub.publishSync=function(message,data){return publish(message,data,true);};PubSub.subscribe=function(message,func){if(!messages.hasOwnProperty(message)){messages[message]=[];}
var token=String(++lastUid);messages[message].push({token:token,func:func});return token;};PubSub.unsubscribe=function(tokenOrFunction){var isToken=typeof tokenOrFunction==='string',key=isToken?'token':'func',succesfulReturnValue=isToken?tokenOrFunction:true,result=false,m,i,j;for(m in messages){if(messages.hasOwnProperty(m)){for(i=messages[m].length-1;i>=0;i--){if(messages[m][i][key]===tokenOrFunction){messages[m].splice(i,1);result=succesfulReturnValue;if(isToken){return result;}}}}}
return result;};return PubSub;}));(function(){var Facebook,fadeOutFadeIn,postActionDeal,postActionMerchant,_errorCallback,_fbAsyncInit,_fbAsyncInitCallbacks,_fbAsyncInitCalled,_fbReady,_fbReadyCallbacks,_fbReadyCalled;_errorCallback=function(code,message,callback){var err;err={error:{code:code,message:message}};Groupon.Facebook.errors.push(err);return callback(err);};_fbAsyncInitCalled=false;_fbAsyncInitCallbacks=[];_fbAsyncInit=function(){var cb,_i,_len,_results;_fbAsyncInitCalled=true;_results=[];for(_i=0,_len=_fbAsyncInitCallbacks.length;_i<_len;_i++){cb=_fbAsyncInitCallbacks[_i];_results.push(cb());}
return _results;};_fbReadyCalled=false;_fbReadyCallbacks=[];_fbReady=function(){var cb,_i,_len;_fbReadyCalled=true;for(_i=0,_len=_fbReadyCallbacks.length;_i<_len;_i++){cb=_fbReadyCallbacks[_i];cb();}
$('#fb-root').fire('facebook:loaded');Groupon.facebookReady=true;return $.event.trigger('facebookReady');};Facebook={config:{},responses:[],errors:[],init:function(){var _this=this;$(function(){if($("html").hasClass("ie7")){$(".facebook_like").remove();return $(".facebook_send").remove();}});Groupon.Facebook.onFbAsyncInit(function(){FB.init({appId:Groupon.Facebook.config.app_id,status:true,cookie:true,xfbml:true,channelUrl:""+window.location.protocol+"//"+window.location.host+"/facebook/xd_receiver.html"});FB.getLoginStatus(function(res){Groupon.Facebook.responses.push(res);return _fbReady();});Groupon.Facebook.getLoginStatus(function(res){if(!res.error){return $('#rail_list .facebook_widget').slideUp();}});_this.extendAccessToken();return _this.trackLikes();});this.loadSDK();return this.onReady(function(){return _this.bindEventListeners();});},bindEventListeners:function(){var throttledLogin;throttledLogin=_.throttle(Groupon.Facebook.loginToGroupon,2000);return $('.facebook_login_button').bind('click',function(){var $el;$el=$(this);return throttledLogin({permissions:$el.attr('data-permissions'),redirect:$el.attr('data-redirect')});});},trackLikes:function(){return FB.Event.subscribe('edge.create',function(href,widget){var _ref,_ref1,_ref2;return Groupon.Analytics.trackClick('Share',widget!=null?(_ref=widget.dom)!=null?_ref.nodeName:void 0:void 0,widget!=null?(_ref1=widget.dom)!=null?(_ref2=_ref1.attributes['grp'])!=null?_ref2.value:void 0:void 0:void 0);});},onFbAsyncInit:function(cb){if(_fbAsyncInitCalled){return cb();}
return _fbAsyncInitCallbacks.push(cb);},isReady:function(){return _fbReadyCalled;},onReady:function(cb){if(_fbReadyCalled){return cb();}
return _fbReadyCallbacks.push(cb);},setConfig:function(config){this.config.app_id=config.app_id||this.config.app_id;this.config.perms=config.perms||this.config.perms;this.config.og_namespace=config.og_namespace||this.config.og_namespace;this.config.auto_logout=config.auto_logout||this.config.auto_logout;return this.config.locale=config.locale||this.config.locale||'en_US';},loadSDK:function(){window.fbAsyncInit=_fbAsyncInit;return(function(d){var id,js,ref;id='facebook-jssdk';ref=d.getElementsByTagName('script')[0];if(d.getElementById(id)){return;}
js=d.createElement('script');js.id=id;js.async=true;js.src='//connect.facebook.net/'+Groupon.Facebook.config.locale+'/all.js';return ref.parentNode.insertBefore(js,ref);})(document);},isComingFromAppCenterOrAuthenticatedReferrals:function(){return(window.location.search.match(new RegExp('medium=app_center'))!=null)||(window.location.href.match(new RegExp('access_token='))!=null);},attemptAutoLogin:function(){var _this=this;if(Groupon.Facebook.config.auto_logout===true){return FB.getLoginStatus(function(res){var _ref;Groupon.Facebook.responses.push(res);if((res!=null?res.status:void 0)==='connected'){FB.logout();return Groupon.Analytics.trackEvent('facebook','fb_auto_logout',{uid:(_ref=res.authResponse)!=null?_ref.userID:void 0});}});}else{return Groupon.onCurrentUserReady(function(){var _ref,_this=this;if(!((_ref=Groupon.currentUser)!=null?_ref.facebookUid:void 0)){if(Groupon.Facebook.isComingFromAppCenterOrAuthenticatedReferrals()){return FB.getLoginStatus(function(res){var _ref1;Groupon.Facebook.responses.push(res);if((res!=null?res.status:void 0)==='connected'){Groupon.Analytics.trackEvent('facebook','fb_auto_login',{uid:(_ref1=res.authResponse)!=null?_ref1.userID:void 0,p:'groupon'});return Groupon.FacebookConnect.onConnect();}});}}});}},attemptAutoLoginFromNewSubscriptionPage:function(){var $body,$message,$modal;if(!Groupon.Facebook.isComingFromAppCenterOrAuthenticatedReferrals()){return;}
$modal=$('<div class="fb_auto_login_message"><div class="spinner"></div><div class="message"></div></div>');$message=$modal.find('.message');$body=$('body');return this.onReady(function(){return FB.getLoginStatus(function(res){Groupon.Facebook.responses.push(res);if((res!=null?res.status:void 0)!=='connected'){return;}
return FB.api('me',function(me_res){var _ref;Groupon.Facebook.responses.push(me_res);if((me_res!=null?me_res.first_name:void 0)==null){return;}
$message.html("Welcome <strong>"+me_res.first_name+"</strong>! Please wait while we log you in...");$body.append($modal);$modal.fadeIn();Groupon.Analytics.trackEvent('facebook','fb_auto_login',{uid:(_ref=res.authResponse)!=null?_ref.userID:void 0,p:'subscription'});return Groupon.FacebookConnect.onConnect('/');});});});},extendAccessToken:function(cb){var _ref;if((_ref=Groupon.currentUser)!=null?_ref.facebookUid:void 0){return Groupon.Facebook.getLoginStatus(function(res){var req,_ref1;if(res.status==='connected'&&((_ref1=res.authResponse)!=null?_ref1.expiresIn:void 0)<30*24*60*60){if(Groupon.currentUser.facebookUid===res.authResponse.userID){req=$.post('/open_graph/extend_access_token',res.authResponse,function(res){Groupon.Facebook.responses.push(res);if(res.result==='ok'){return typeof cb==="function"?cb(null,res):void 0;}
return typeof cb==="function"?cb((res.error!=null?res.error:'error'),res):void 0;});return req.error(function(err){Facebook.errors.push(err);return typeof cb==="function"?cb(err):void 0;});}}});}},loginToGroupon:function(options){var permissions;permissions=(options!=null?options.permissions:void 0)||Groupon.Facebook.config.perms;return Groupon.Facebook.login(permissions,function(res){if((res!=null?res.status:void 0)==='connected'){if(!(options!=null?options.onSuccess:void 0)){$('.facebook_login_button').addClass('loading');}
return Groupon.FacebookConnect.onConnect(options!=null?options.redirect:void 0,options!=null?options.onSuccess:void 0);}});},login:function(permissions,callback){if(typeof permissions==='function'){callback=permissions;permissions=null;}
permissions||(permissions=Groupon.Facebook.config.perms);return FB.login(callback,{scope:permissions});},getLoginStatus:function(callback){var _this=this;if(!Groupon.onCurrentUserReady){return _errorCallback('groupon:undefined-function','Groupon.onCurrentUserReady is not defined.',callback);}
return Groupon.onCurrentUserReady(function(){var _ref,_ref1;if(!((_ref=Groupon.currentUser)!=null?_ref.isAuthenticated:void 0)){return _errorCallback('groupon:logged-out','The user is not logged in to Groupon.',callback);}else if(!((_ref1=Groupon.currentUser)!=null?_ref1.facebookUid:void 0)){return _errorCallback('groupon:fb-not-linked','The user has not linked a Facebook account to this Groupon account.',callback);}
return FB.getLoginStatus(function(res){var _ref2;Groupon.Facebook.responses.push(res);if((res!=null?res.status:void 0)==='connected'){if(((_ref2=res.authResponse)!=null?_ref2.userID:void 0)!==Groupon.currentUser.facebookUid){return _errorCallback('groupon:user-mismatch','The logged in Facebook user does not match the Facebook account connected to the logged in Groupon user.',callback);}else{return callback(res);}}else{return _errorCallback('groupon:unauthorized','The user is not logged in to Facebook.',callback);}});});},api:function(path,callback,timeout){var cbCalled;if(timeout==null){timeout=30000;}
cbCalled=false;if(typeof callback!=='function'){callback=function(){};}
Groupon.Facebook.getLoginStatus(function(res){Groupon.Facebook.responses.push(res);if(cbCalled){return;}
if(res.error){cbCalled=true;return callback(res);}
return FB.api(path,function(res){Groupon.Facebook.responses.push(res);if(cbCalled){return;}
cbCalled=true;return callback(res);});});return setTimeout(function(){if(cbCalled){return;}
cbCalled=true;return _errorCallback('groupon:timeout',"There was a "+timeout+" milliseconds timeout while contacting Facebook servers.",callback);},timeout);},prefillLandingPage:function(){return Groupon.Facebook.onReady(function(){return FB.getLoginStatus(function(res){Facebook.responses.push(res);if((res!=null?res.status:void 0)==='connected'){return FB.api({method:'fql.query',query:'SELECT email FROM user where uid=me()'},function(res){var email,_ref;Facebook.responses.push(res);email=res!=null?(_ref=res[0])!=null?_ref.email:void 0:void 0;if(email){return $('#subscription_email_address').val(email);}});}});});},fetchEmailForCurrentSession:function(cb){return Groupon.Facebook.onReady(function(){return FB.getLoginStatus(function(res){Facebook.responses.push(res);if((res!=null?res.status:void 0)==='connected'){return FB.api({method:'fql.query',query:'SELECT email FROM user where uid=me()'},function(res){var email,_ref;Facebook.responses.push(res);email=res!=null?(_ref=res[0])!=null?_ref.email:void 0:void 0;if(email){return cb(email);}});}});});},userId:function(){try{return FB.getAuthResponse().userID;}catch(err){return null;}},getMyPages:function(callback){return FB.api('/me/accounts',callback);}};postActionDeal=function(action,deal,cb){var req;req=$.post('/open_graph',{verb:action,deal:deal},function(res){Facebook.responses.push(res);if(res.result==='ok'){return cb(null,res);}
return cb((res.error!=null?res.error:'error'),res);});return req.error(function(err){Facebook.errors.push(err);return cb(err);});};postActionMerchant=function(action,merchant,cb){var req;req=$.post('/open_graph',{verb:action,merchant:merchant},function(res){Facebook.responses.push(res);if(res.result==='ok'){return cb(null,res);}
return cb((res.error!=null?res.error:'error'),res);});return req.error(function(err){Facebook.errors.push(err);return cb(err);});};fadeOutFadeIn=function($el1,$el2){return $el1.fadeOut((function(){return $el2.fadeIn();}));};Facebook.OpenGraph={buyDeal:function(permalink,cb){return postActionDeal('buy',permalink,function(err,res){var payload,success_or_error;if(cb){cb(err,res);}
success_or_error=err||(res!=null?res.result:void 0)==='error'?'error':'success';payload={action:'buy',deal:permalink,user:Groupon.currentUser.trackingCode,response:res};return Groupon.Analytics.trackEvent('fb_open_graph',success_or_error,payload);});},recommendMerchant:function(permalink,cb){return postActionMerchant('recommend',permalink,function(err,res){var payload,success_or_error;if(cb){cb(err,res);}
success_or_error=err||(res!=null?res.result:void 0)==='error'?'error':'success';payload={action:'recommend',merchant:permalink,user:Groupon.currentUser.trackingCode,response:res};return Groupon.Analytics.trackEvent('fb_open_graph',success_or_error,payload);});},"delete":function(id,cb){return $.ajax({type:'DELETE',url:"/open_graph/"+id,success:function(data,text_status,jqXHR){Facebook.responses.push(data);if(data.result==='ok'){return cb(null,data);}
return cb('error',data);},error:function(err){Facebook.errors.push(err);return cb(err);},dataType:'json'});},postPurchaseInit:function(deal,is_fb_connected,shared){var $connect,$el,$loading,$share;$el=$('#publish_to_open_graph');$el.find('> div').hide();$connect=$el.find('.connect');$loading=$el.find('.loading');$share=$el.find('.share');if(is_fb_connected&&shared){Groupon.Facebook.OpenGraph.postPurchaseShare(deal);}else if(is_fb_connected){$share.fadeIn();}else{$connect.fadeIn();}
$share.find('.share_this').click(function(){return Groupon.Facebook.OpenGraph.postPurchaseShare(deal);});return $connect.find('.login').click(function(){fadeOutFadeIn($connect,$loading);Groupon.FacebookConnect.bindOnFacebookSessionCreateFailure(function(){return fadeOutFadeIn($loading,$connect);});return Groupon.Facebook.loginToGroupon({onSuccess:function(callback){return Groupon.Facebook.OpenGraph.postPurchaseShare(deal);}});});},postPurchaseShare:function(deal,cb){var $connect,$el,$loading,$posted,$posted_error,$posting,$redo,$share,$undo,$undo_error,$undo_success;$el=$('#publish_to_open_graph');$posting=$el.find('.posting');$connect=$el.find('.connect');$posted=$el.find('.posted');$posted_error=$el.find('.posted_error');$share=$el.find('.share');$loading=$el.find('.loading');$undo=$posted.find('.undo');$undo_error=$el.find('.undo_error');$undo_success=$el.find('.undo_success');$redo=$el.find('.redo');$redo.attr('data-deal',deal);$el.find('> div').hide();$posting.show();Groupon.Facebook.OpenGraph.buyDeal(deal,function(err,res){var id,_ref,_ref1;if(err||!res){fadeOutFadeIn($posting,$posted_error);if(cb){return cb(err);}}else{id=(_ref=res.facebook)!=null?(_ref1=_ref.response)!=null?_ref1.id:void 0:void 0;$posted.find('.undo').attr('data-id',id);fadeOutFadeIn($posting,$posted);if(cb){return cb();}}});$undo.click(function(){var id;$undo.unbind();fadeOutFadeIn($posted,$loading);id=$undo.attr('data-id');return Groupon.Facebook.OpenGraph["delete"](id,function(err,res){if(err||!res){return fadeOutFadeIn($loading,$undo_error);}else{return fadeOutFadeIn($loading,$undo_success);}});});return $redo.click(function(){$redo.unbind();deal=$redo.attr('data-deal');return Groupon.Facebook.OpenGraph.postPurchaseShare(deal);});}};window.Groupon||(window.Groupon={});window.Groupon.Facebook=Facebook;}).call(this);Groupon.FacebookConnect=(function(){var _request_url=null;var _onConnectCallback=null;function getSessionCreationUrl(){var protocol;if(Groupon.sslEnabled){protocol="https://";}else{protocol="http://";}
return protocol+window.location.host+"/facebook_session";}
var sessionCreationUrl=getSessionCreationUrl();function submitFormData(url,params){var form=$("<form class='form_submitter'></form>").attr({method:'POST',action:url});$.each(params,function(key,value){$("<input type='hidden'>").attr({name:key,value:value}).appendTo(form);});form.appendTo($('body'));form.submit();}
function submitSessionCreationRequestViaHttpPost(params){params=params||{};if(_request_url){params.request_url=_request_url;}
params.facebook_login=true;Groupon.FacebookConnect.submitFormData(sessionCreationUrl,params);}
function submitSessionCreationRequestViaAjax(params){params=params||{};if(_request_url){params.request_url=_request_url;}
params.facebook_login=true;$.ajax({url:sessionCreationUrl,type:'POST',data:params,dataType:'json',success:function(response){Groupon.FacebookConnect.onFacebookSessionCreateSuccess(response);},error:function(response){Groupon.FacebookConnect.onFacebookSessionCreateFailure();}});}
function postToFacebookConnect(){if(Groupon.Application&&Groupon.Application.isSSL&&Groupon.Application.isSSL()){submitSessionCreationRequestViaAjax();}else{submitSessionCreationRequestViaHttpPost();}}
function onFacebookSessionCreateSuccess(sessionCreationResponse){PubSub.publish('facebook_connect.events.on_facebook_session_create_success',sessionCreationResponse);if(sessionCreationResponse.confirmEmail){this.Modals.Ajax.confirmEmailAddress(sessionCreationResponse.confirmEmail);}else if(sessionCreationResponse.specifyAccount){this.Modals.Ajax.linkToExistingAccount();}
else if(sessionCreationResponse.passwordFailure){PubSub.publish('facebook_connect.errors.invalid_password','Incorrect email/password combination.');}
else if(sessionCreationResponse.facebookUserIsDeleted){addAlert("error",sessionCreationResponse.errorMessage);}
else if(sessionCreationResponse.location){var loc=sessionCreationResponse.location.split('#')[0];if(typeof _onConnectCallback==='function'){_onConnectCallback(function(){Groupon.Application.redirectTo(loc);});}else{Groupon.Application.redirectTo(loc);}}else{if(typeof _onConnectCallback==='function'){_onConnectCallback(function(){Groupon.Application.reloadPage();});}else{Groupon.Application.reloadPage();}}}
function onFacebookSessionCreateFailure(){addAlert('error','There was a problem with Facebook login. Please try again later.');for(var i=0;i<_onFacebookSessionCreateFailure.length;++i){_onFacebookSessionCreateFailure[i]();}}
var _onFacebookSessionCreateFailure=[];function bindOnFacebookSessionCreateFailure(func){_onFacebookSessionCreateFailure.push(func);}
function onConnect(request_url,callback){_request_url=request_url||Groupon.FacebookConnect.locationHref();_onConnectCallback=callback;postToFacebookConnect();}
function loginWithOnlyFacebookCredentialsViaAjax(){this.submitSessionCreationRequestViaAjax({no_groupon_credentials:true});}
function loginWithOnlyFacebookCredentialsViaHttpPost(){this.submitSessionCreationRequestViaHttpPost({no_groupon_credentials:true});}
var locationHref=function(){return window.location.href;};return{getSessionCreationUrl:getSessionCreationUrl,onConnect:onConnect,submitFormData:submitFormData,postToFacebookConnect:postToFacebookConnect,loginWithOnlyFacebookCredentialsViaAjax:loginWithOnlyFacebookCredentialsViaAjax,loginWithOnlyFacebookCredentialsViaHttpPost:loginWithOnlyFacebookCredentialsViaHttpPost,submitSessionCreationRequestViaAjax:submitSessionCreationRequestViaAjax,submitSessionCreationRequestViaHttpPost:submitSessionCreationRequestViaHttpPost,onFacebookSessionCreateSuccess:onFacebookSessionCreateSuccess,onFacebookSessionCreateFailure:onFacebookSessionCreateFailure,bindOnFacebookSessionCreateFailure:bindOnFacebookSessionCreateFailure,locationHref:locationHref};})();Groupon.FacebookConnect.LinkToGrouponAccount=(function(modal){function bindSubmitButton(onSuccess){$("#modal_window_confirm input[type='submit']").click(function(e){e.preventDefault();$(this).attr("disabled","true");if(typeof(onSuccess)!=="undefined"){var data={facebook_login:true};var $email=$("#modal_window_confirm input[name='email']");var $password=$("#modal_window_confirm input[name='password']");var $confirm_linking=$("#modal_window_confirm input[name='confirm_linking']");if($email){data.email=$email.val();}
if($password){data.password=$password.val();}
if($confirm_linking){data.confirm_linking=$confirm_linking.val();}
onSuccess(data);}});PubSub.subscribe('facebook_connect.events.on_facebook_session_create_success',function(){$("#modal_window_confirm input[type='submit']").removeAttr("disabled");});}
function bindCancelButton(onCancel){$('#cancel').click(function(){if(typeof(onCancel)!=='undefined'){onCancel();}
Control.Modal.close();});}
function showDialog(){$(".facebook_login_button").removeClass('loading');Control.Modal.close();Control.Modal.open('#modal_window_confirm',{fade:true,afterClose:function(){this.destroy();}});}
function retrieveDialog(responseText,settings){$(document.body).insert(responseText);bindSubmitButton(settings['success']);bindCancelButton(settings['cancel']);showDialog();}
function displayModal(url,settings){if(typeof(settings)==='undefined'){settings={};}
Control.Modal.close();if($('#modal_window_confirm').length===0){$.ajax({url:url,data:settings['data']||{},dataType:'html',success:function(responseText){retrieveDialog(responseText,settings);}});}else{showDialog();}}
return{display:displayModal};})();Groupon.FacebookConnect.Modals=(function(){function retrySubmissionHttpPost(form_fields){Groupon.FacebookConnect.submitSessionCreationRequestViaHttpPost(form_fields);}
function linkToExistingAccount(settings){Groupon.FacebookConnect.LinkToGrouponAccount.display('/users/link_to_groupon_account_modal',settings);}
function confirmEmailAddress(email,settings){var fullSettings=$.extend(settings,{data:{email_address:email}});Groupon.FacebookConnect.LinkToGrouponAccount.display('/users/confirm_password_modal',fullSettings);}
function linkToExistingAccountHttpPost(){linkToExistingAccount({success:_.bind(retrySubmissionHttpPost,this),cancel:_.bind(Groupon.FacebookConnect.loginWithOnlyFacebookCredentialsViaHttpPost,Groupon.FacebookConnect)});}
function confirmEmailAddressHttpPost(email){confirmEmailAddress(email,{success:_.bind(retrySubmissionHttpPost,this)});}
function linkToExistingAccountAjax(){linkToExistingAccount({success:_.bind(Groupon.FacebookConnect.submitSessionCreationRequestViaAjax,Groupon.FacebookConnect),cancel:_.bind(Groupon.FacebookConnect.loginWithOnlyFacebookCredentialsViaAjax,Groupon.FacebookConnect)});}
function confirmEmailAddressAjax(email){confirmEmailAddress(email,{success:function(form_fields){Groupon.FacebookConnect.submitSessionCreationRequestViaAjax(form_fields);}});}
return{HttpPost:{linkToExistingAccount:linkToExistingAccountHttpPost,confirmEmailAddress:confirmEmailAddressHttpPost},Ajax:{linkToExistingAccount:linkToExistingAccountAjax,confirmEmailAddress:confirmEmailAddressAjax}};})();(function(){var _Tracker,__bind=function(fn,me){return function(){return fn.apply(me,arguments);};},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child;};if(window.Groupon==null){window.Groupon={};}
if(Groupon.Facebook==null){Groupon.Facebook={};}
Groupon.Facebook.Tracker=(function(){var _instance;Tracker.name='Tracker';function Tracker(){}
_instance=void 0;Tracker.get=function(){return _instance!=null?_instance:_instance=new _Tracker();};return Tracker;})();_Tracker=(function(_super){__extends(_Tracker,_super);_Tracker.name='_Tracker';function _Tracker(){this.trackDollarOffOnReceiptDollarOffSuccess=__bind(this.trackDollarOffOnReceiptDollarOffSuccess,this);this.trackDollarOffOnReceiptDollarOffError=__bind(this.trackDollarOffOnReceiptDollarOffError,this);this.trackDollarOffOnReceiptDollarOffClick=__bind(this.trackDollarOffOnReceiptDollarOffClick,this);this.trackDollarOffOnReceiptModalClose=__bind(this.trackDollarOffOnReceiptModalClose,this);this.trackDollarOffOnReceiptModalRender=__bind(this.trackDollarOffOnReceiptModalRender,this);this.trackFbShareOnReceiptShareClick=__bind(this.trackFbShareOnReceiptShareClick,this);this.trackFbShareOnReceiptModalClose=__bind(this.trackFbShareOnReceiptModalClose,this);this.trackFbShareOnReceiptModalRender=__bind(this.trackFbShareOnReceiptModalRender,this);this.trackFbShareCheckoutPurchaseChange=__bind(this.trackFbShareCheckoutPurchaseChange,this);this.trackFbShareCheckoutPurchaseInit=__bind(this.trackFbShareCheckoutPurchaseInit,this);this.trackFbLinkNewAccountModalClose=__bind(this.trackFbLinkNewAccountModalClose,this);this.trackFbLinkSameEmailsModalClose=__bind(this.trackFbLinkSameEmailsModalClose,this);this.trackFbLinkDifferentEmailsModalClose=__bind(this.trackFbLinkDifferentEmailsModalClose,this);return _Tracker.__super__.constructor.apply(this,arguments);}
_Tracker.prototype._addToHub=function(name,properties){return Groupon.TrackingHub.add(name,properties);};_Tracker.prototype._addToPixelTrackerAndTrackingHub=function(name,properties){this._injectTrackingPixel(name,properties||{});return this._addToHub(name,properties||{});};_Tracker.prototype.E_FB_LINK_DIFFERENT_EMAILS_MODAL_CLOSE="fb_link_different_emails_modal_close";_Tracker.prototype.E_FB_LINK_SAME_EMAILS_MODAL_CLOSE="fb_link_same_emails_modal_close";_Tracker.prototype.E_FB_LINK_NEW_ACCOUNT_MODAL_CLOSE="fb_link_new_account_modal_close";_Tracker.prototype.E_FB_SHARE_CHECKOUT_PURCHASE_INIT="fb_share_checkout_purchase_init";_Tracker.prototype.E_FB_SHARE_CHECKOUT_PURCHASE_CHANGE="fb_share_checkout_purchase_change";_Tracker.prototype.E_FB_SHARE_ON_RECEIPT_MODAL_RENDER="fb_share_on_receipt_modal_render";_Tracker.prototype.E_FB_SHARE_ON_RECEIPT_MODAL_CLOSE="fb_share_on_receipt_modal_close";_Tracker.prototype.E_FB_SHARE_ON_RECEIPT_SHARE_CLICK="fb_share_on_receipt_share_click";_Tracker.prototype.E_DOLLAR_OFF_ON_RECEIPT_MODAL_RENDER="dollar_off_on_receipt_modal_render";_Tracker.prototype.E_DOLLAR_OFF_ON_RECEIPT_MODAL_CLOSE="dollar_off_on_receipt_modal_close";_Tracker.prototype.E_DOLLAR_OFF_ON_RECEIPT_DOLLAR_OFF_CLICK="dollar_off_on_receipt_dollar_off_click";_Tracker.prototype.E_DOLLAR_OFF_ON_RECEIPT_DOLLAR_OFF_SUCCESS="dollar_off_on_receipt_dollar_off_success";_Tracker.prototype.E_DOLLAR_OFF_ON_RECEIPT_DOLLAR_OFF_ERROR="dollar_off_on_receipt_dollar_off_error";_Tracker.prototype.trackFbLinkDifferentEmailsModalClose=function(){return this._addToPixelTrackerAndTrackingHub(this.E_FB_LINK_DIFFERENT_EMAILS_MODAL_CLOSE);};_Tracker.prototype.trackFbLinkSameEmailsModalClose=function(){return this._addToPixelTrackerAndTrackingHub(this.E_FB_LINK_SAME_EMAILS_MODAL_CLOSE);};_Tracker.prototype.trackFbLinkNewAccountModalClose=function(){return this._addToPixelTrackerAndTrackingHub(this.E_FB_LINK_NEW_ACCOUNT_MODAL_CLOSE);};_Tracker.prototype.trackFbShareCheckoutPurchaseInit=function(state){return this._addToPixelTrackerAndTrackingHub(this.E_FB_SHARE_CHECKOUT_PURCHASE_INIT);};_Tracker.prototype.trackFbShareCheckoutPurchaseChange=function(attributes){return this._addToPixelTrackerAndTrackingHub(this.E_FB_SHARE_CHECKOUT_PURCHASE_CHANGE,{initialState:attributes.initialState,toState:attributes.toState});};_Tracker.prototype.trackFbShareOnReceiptModalRender=function(){return this._addToPixelTrackerAndTrackingHub(this.E_FB_SHARE_ON_RECEIPT_MODAL_RENDER);};_Tracker.prototype.trackFbShareOnReceiptModalClose=function(){return this._addToPixelTrackerAndTrackingHub(this.E_FB_SHARE_ON_RECEIPT_MODAL_CLOSE);};_Tracker.prototype.trackFbShareOnReceiptShareClick=function(){return this._addToPixelTrackerAndTrackingHub(this.E_FB_SHARE_ON_RECEIPT_SHARE_CLICK);};_Tracker.prototype.trackDollarOffOnReceiptModalRender=function(){return this._addToPixelTrackerAndTrackingHub(this.E_DOLLAR_OFF_ON_RECEIPT_MODAL_RENDER);};_Tracker.prototype.trackDollarOffOnReceiptModalClose=function(){return this._addToPixelTrackerAndTrackingHub(this.E_DOLLAR_OFF_ON_RECEIPT_MODAL_CLOSE);};_Tracker.prototype.trackDollarOffOnReceiptDollarOffClick=function(){return this._addToPixelTrackerAndTrackingHub(this.E_DOLLAR_OFF_ON_RECEIPT_DOLLAR_OFF_CLICK);};_Tracker.prototype.trackDollarOffOnReceiptDollarOffError=function(error){return this._addToPixelTrackerAndTrackingHub(this.E_DOLLAR_OFF_ON_RECEIPT_DOLLAR_OFF_ERROR,{error:error});};_Tracker.prototype.trackDollarOffOnReceiptDollarOffSuccess=function(){return this._addToPixelTrackerAndTrackingHub(this.E_DOLLAR_OFF_ON_RECEIPT_DOLLAR_OFF_SUCCESS);};return _Tracker;})(Groupon.Tracker);}).call(this);