 Groupon.Finch={};Groupon.Finch={init:function(){this.trigger('init');},onReady:function(f){this.onReadyFunctions=this.onReadyFunctions||[];this.onReadyFunctions.push(f);},execute:function(){if(!this.onReadyFunctions)return;for(i=0;i<this.onReadyFunctions.length;i++){this.onReadyFunctions[i].call();}},trigger:function(key){if(!this._events||!this._events[key])return false;for(var i=0;i<this._events[key].length;i++)
this._events[key][i].apply(this);return true;},bind:function(key,func){this._events=this._events||{};this._events[key]=this._events[key]||[];this._events[key].push(func);return this;}};Groupon.Finch.bind('init',function(){if(!(/finch_init/).test(document.documentElement.className))
document.documentElement.className+=' finch_init';});Groupon.Finch.bind('run',function(){document.documentElement.className=document.documentElement.className.replace('finch_init','');});Groupon.Finch.init();Groupon.Finch.GrouponAnalyticsTracker={track:function(experimentSets){_(experimentSets).each(function(experimentSet){layerName=experimentSet.layer.name;experimentId=experimentSet.experiment.id;variantName=experimentSet.variant;if(!window._gaq)
Groupon.Analytics.Google.initialize();Groupon.Analytics.Google.setExperimentCustomVar(layerName,experimentId,variantName);});}};(function(){var root=this;var previousUnderscore=root._;var breaker={};var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var slice=ArrayProto.slice,unshift=ArrayProto.unshift,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var
nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){return new wrapper(obj);};if(typeof module!=='undefined'&&module.exports){module.exports=_;_._=_;}else{root['_']=_;}
_.VERSION='1.2.0';var each=_.each=_.forEach=function(obj,iterator,context){if(obj==null)return;if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context);}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker)return;}}else{for(var key in obj){if(hasOwnProperty.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker)return;}}}};_.map=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeMap&&obj.map===nativeMap)return obj.map(iterator,context);each(obj,function(value,index,list){results[results.length]=iterator.call(context,value,index,list);});return results;};_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=memo!==void 0;if(obj==null)obj=[];if(nativeReduce&&obj.reduce===nativeReduce){if(context)iterator=_.bind(iterator,context);return initial?obj.reduce(iterator,memo):obj.reduce(iterator);}
each(obj,function(value,index,list){if(!initial){memo=value;initial=true;}else{memo=iterator.call(context,memo,value,index,list);}});if(!initial)throw new TypeError("Reduce of empty array with no initial value");return memo;};_.reduceRight=_.foldr=function(obj,iterator,memo,context){if(obj==null)obj=[];if(nativeReduceRight&&obj.reduceRight===nativeReduceRight){if(context)iterator=_.bind(iterator,context);return memo!==void 0?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);}
var reversed=(_.isArray(obj)?obj.slice():_.toArray(obj)).reverse();return _.reduce(reversed,iterator,memo,context);};_.find=_.detect=function(obj,iterator,context){var result;any(obj,function(value,index,list){if(iterator.call(context,value,index,list)){result=value;return true;}});return result;};_.filter=_.select=function(obj,iterator,context){var results=[];if(obj==null)return results;if(nativeFilter&&obj.filter===nativeFilter)return obj.filter(iterator,context);each(obj,function(value,index,list){if(iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.reject=function(obj,iterator,context){var results=[];if(obj==null)return results;each(obj,function(value,index,list){if(!iterator.call(context,value,index,list))results[results.length]=value;});return results;};_.every=_.all=function(obj,iterator,context){var result=true;if(obj==null)return result;if(nativeEvery&&obj.every===nativeEvery)return obj.every(iterator,context);each(obj,function(value,index,list){if(!(result=result&&iterator.call(context,value,index,list)))return breaker;});return result;};var any=_.some=_.any=function(obj,iterator,context){iterator=iterator||_.identity;var result=false;if(obj==null)return result;if(nativeSome&&obj.some===nativeSome)return obj.some(iterator,context);each(obj,function(value,index,list){if(result|=iterator.call(context,value,index,list))return breaker;});return!!result;};_.include=_.contains=function(obj,target){var found=false;if(obj==null)return found;if(nativeIndexOf&&obj.indexOf===nativeIndexOf)return obj.indexOf(target)!=-1;any(obj,function(value){if(found=value===target)return true;});return found;};_.invoke=function(obj,method){var args=slice.call(arguments,2);return _.map(obj,function(value){return(method.call?method||value:value[method]).apply(value,args);});};_.pluck=function(obj,key){return _.map(obj,function(value){return value[key];});};_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.max.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return-Infinity;var result={computed:-Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>=result.computed&&(result={value:value,computed:computed});});return result.value;};_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj))return Math.min.apply(Math,obj);if(!iterator&&_.isEmpty(obj))return Infinity;var result={computed:Infinity};each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed<result.computed&&(result={value:value,computed:computed});});return result.value;};_.shuffle=function(obj){var shuffled=[],rand;each(obj,function(value,index,list){if(index==0){shuffled[0]=value;}else{rand=Math.floor(Math.random()*(index+1));shuffled[index]=shuffled[rand];shuffled[rand]=value;}});return shuffled;};_.sortBy=function(obj,iterator,context){return _.pluck(_.map(obj,function(value,index,list){return{value:value,criteria:iterator.call(context,value,index,list)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}),'value');};_.groupBy=function(obj,iterator){var result={};each(obj,function(value,index){var key=iterator(value,index);(result[key]||(result[key]=[])).push(value);});return result;};_.sortedIndex=function(array,obj,iterator){iterator||(iterator=_.identity);var low=0,high=array.length;while(low<high){var mid=(low+high)>>1;iterator(array[mid])<iterator(obj)?low=mid+1:high=mid;}
return low;};_.toArray=function(iterable){if(!iterable)return[];if(iterable.toArray)return iterable.toArray();if(_.isArray(iterable))return slice.call(iterable);if(_.isArguments(iterable))return slice.call(iterable);return _.values(iterable);};_.size=function(obj){return _.toArray(obj).length;};_.first=_.head=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,0,n):array[0];};_.initial=function(array,n,guard){return slice.call(array,0,array.length-((n==null)||guard?1:n));};_.last=function(array,n,guard){return(n!=null)&&!guard?slice.call(array,array.length-n):array[array.length-1];};_.rest=_.tail=function(array,index,guard){return slice.call(array,(index==null)||guard?1:index);};_.compact=function(array){return _.filter(array,function(value){return!!value;});};_.flatten=function(array){return _.reduce(array,function(memo,value){if(_.isArray(value))return memo.concat(_.flatten(value));memo[memo.length]=value;return memo;},[]);};_.without=function(array){return _.difference(array,slice.call(arguments,1));};_.uniq=_.unique=function(array,isSorted,iterator){var initial=iterator?_.map(array,iterator):array;var result=[];window.stuff=initial;_.reduce(initial,function(memo,el,i){if(0==i||(isSorted===true?_.last(memo)!=el:!_.include(memo,el))){memo[memo.length]=el;result[result.length]=array[i];}
return memo;},[]);return result;};_.union=function(){return _.uniq(_.flatten(arguments));};_.intersection=_.intersect=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.indexOf(other,item)>=0;});});};_.difference=function(array,other){return _.filter(array,function(value){return!_.include(other,value);});};_.zip=function(){var args=slice.call(arguments);var length=_.max(_.pluck(args,'length'));var results=new Array(length);for(var i=0;i<length;i++)results[i]=_.pluck(args,""+i);return results;};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i,l;if(isSorted){i=_.sortedIndex(array,item);return array[i]===item?i:-1;}
if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item);for(i=0,l=array.length;i<l;i++)if(array[i]===item)return i;return-1;};_.lastIndexOf=function(array,item){if(array==null)return-1;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return array.lastIndexOf(item);var i=array.length;while(i--)if(array[i]===item)return i;return-1;};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0;}
step=arguments[2]||1;var len=Math.max(Math.ceil((stop-start)/step),0);var idx=0;var range=new Array(len);while(idx<len){range[idx++]=start;start+=step;}
return range;};_.bind=function(func,obj){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(obj,args.concat(slice.call(arguments)));};};_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(funcs.length==0)funcs=_.functions(obj);each(funcs,function(f){obj[f]=_.bind(obj[f],obj);});return obj;};_.memoize=function(func,hasher){var memo={};hasher||(hasher=_.identity);return function(){var key=hasher.apply(this,arguments);return hasOwnProperty.call(memo,key)?memo[key]:(memo[key]=func.apply(this,arguments));};};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(func,args);},wait);};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)));};var limit=function(func,wait,debounce){var timeout;return function(){var context=this,args=arguments;var throttler=function(){timeout=null;func.apply(context,args);};if(debounce)clearTimeout(timeout);if(debounce||!timeout)timeout=setTimeout(throttler,wait);};};_.throttle=function(func,wait){return limit(func,wait,false);};_.debounce=function(func,wait){return limit(func,wait,true);};_.once=function(func){var ran=false,memo;return function(){if(ran)return memo;ran=true;return memo=func.apply(this,arguments);};};_.wrap=function(func,wrapper){return function(){var args=[func].concat(slice.call(arguments));return wrapper.apply(this,args);};};_.compose=function(){var funcs=slice.call(arguments);return function(){var args=slice.call(arguments);for(var i=funcs.length-1;i>=0;i--){args=[funcs[i].apply(this,args)];}
return args[0];};};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments);}};};_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError('Invalid object');var keys=[];for(var key in obj)if(hasOwnProperty.call(obj,key))keys[keys.length]=key;return keys;};_.values=function(obj){return _.map(obj,_.identity);};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key);}
return names.sort();};_.extend=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(source[prop]!==void 0)obj[prop]=source[prop];}});return obj;};_.defaults=function(obj){each(slice.call(arguments,1),function(source){for(var prop in source){if(obj[prop]==null)obj[prop]=source[prop];}});return obj;};_.clone=function(obj){return _.isArray(obj)?obj.slice():_.extend({},obj);};_.tap=function(obj,interceptor){interceptor(obj);return obj;};function eq(a,b,stack){if(a===b)return a!==0||1/a==1/b;if(a==null)return a===b;var typeA=typeof a;if(typeA!=typeof b)return false;if(!a!=!b)return false;if(_.isNaN(a))return _.isNaN(b);var isStringA=_.isString(a),isStringB=_.isString(b);if(isStringA||isStringB)return isStringA&&isStringB&&String(a)==String(b);var isNumberA=_.isNumber(a),isNumberB=_.isNumber(b);if(isNumberA||isNumberB)return isNumberA&&isNumberB&&+a==+b;var isBooleanA=_.isBoolean(a),isBooleanB=_.isBoolean(b);if(isBooleanA||isBooleanB)return isBooleanA&&isBooleanB&&+a==+b;var isDateA=_.isDate(a),isDateB=_.isDate(b);if(isDateA||isDateB)return isDateA&&isDateB&&a.getTime()==b.getTime();var isRegExpA=_.isRegExp(a),isRegExpB=_.isRegExp(b);if(isRegExpA||isRegExpB){return isRegExpA&&isRegExpB&&a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase;}
if(typeA!='object')return false;if(a._chain)a=a._wrapped;if(b._chain)b=b._wrapped;if(_.isFunction(a.isEqual))return a.isEqual(b);var length=stack.length;while(length--){if(stack[length]==a)return true;}
stack.push(a);var size=0,result=true;if(a.length===+a.length||b.length===+b.length){size=a.length;result=size==b.length;if(result){while(size--){if(!(result=size in a==size in b&&eq(a[size],b[size],stack)))break;}}}else{for(var key in a){if(hasOwnProperty.call(a,key)){size++;if(!(result=hasOwnProperty.call(b,key)&&eq(a[key],b[key],stack)))break;}}
if(result){for(key in b){if(hasOwnProperty.call(b,key)&&!size--)break;}
result=!size;}}
stack.pop();return result;}
_.isEqual=function(a,b){return eq(a,b,[]);};_.isEmpty=function(obj){if(_.isArray(obj)||_.isString(obj))return obj.length===0;for(var key in obj)if(hasOwnProperty.call(obj,key))return false;return true;};_.isElement=function(obj){return!!(obj&&obj.nodeType==1);};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==='[object Array]';};_.isObject=function(obj){return obj===Object(obj);};_.isArguments=function(obj){return!!(obj&&hasOwnProperty.call(obj,'callee'));};_.isFunction=function(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply);};_.isString=function(obj){return!!(obj===''||(obj&&obj.charCodeAt&&obj.substr));};_.isNumber=function(obj){return!!(obj===0||(obj&&obj.toExponential&&obj.toFixed));};_.isNaN=function(obj){return obj!==obj;};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)=='[object Boolean]';};_.isDate=function(obj){return!!(obj&&obj.getTimezoneOffset&&obj.setUTCFullYear);};_.isRegExp=function(obj){return!!(obj&&obj.test&&obj.exec&&(obj.ignoreCase||obj.ignoreCase===false));};_.isNull=function(obj){return obj===null;};_.isUndefined=function(obj){return obj===void 0;};_.noConflict=function(){root._=previousUnderscore;return this;};_.identity=function(value){return value;};_.times=function(n,iterator,context){for(var i=0;i<n;i++)iterator.call(context,i);};_.escape=function(string){return(''+string).replace(/&(?!\w+;|#\d+;|#x[\da-f]+;)/gi,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#x27;').replace(/\//g,'&#x2F;');};_.mixin=function(obj){each(_.functions(obj),function(name){addToWrapper(name,_[name]=obj[name]);});};var idCounter=0;_.uniqueId=function(prefix){var id=idCounter++;return prefix?prefix+id:id;};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};_.template=function(str,data){var c=_.templateSettings;var tmpl='var __p=[],print=function(){__p.push.apply(__p,arguments);};'+'with(obj||{}){__p.push(\''+
str.replace(/\\/g,'\\\\').replace(/'/g,"\\'").replace(c.escape,function(match,code){return"',_.escape("+code.replace(/\\'/g,"'")+"),'";}).replace(c.interpolate,function(match,code){return"',"+code.replace(/\\'/g,"'")+",'";}).replace(c.evaluate||null,function(match,code){return"');"+code.replace(/\\'/g,"'").replace(/[\r\n\t]/g,' ')+"__p.push('";}).replace(/\r/g,'\\r').replace(/\n/g,'\\n').replace(/\t/g,'\\t')
+"');}return __p.join('');";var func=new Function('obj',tmpl);return data?func(data):func;};var wrapper=function(obj){this._wrapped=obj;};_.prototype=wrapper.prototype;var result=function(obj,chain){return chain?_(obj).chain():obj;};var addToWrapper=function(name,func){wrapper.prototype[name]=function(){var args=slice.call(arguments);unshift.call(args,this._wrapped);return result(func.apply(_,args),this._chain);};};_.mixin(_);each(['pop','push','reverse','shift','sort','splice','unshift'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){method.apply(this._wrapped,arguments);return result(this._wrapped,this._chain);};});each(['concat','join','slice'],function(name){var method=ArrayProto[name];wrapper.prototype[name]=function(){return result(method.apply(this._wrapped,arguments),this._chain);};});wrapper.prototype.chain=function(){this._chain=true;return this;};wrapper.prototype.value=function(){return this._wrapped;};})();Groupon.Analytics={MEMBERSHIP_GOAL_PREFIX:"new_membership",UNDEFINED_LABEL:"undefined",Trackers:{},initialize:function(){_.each(this.Trackers,function(tracker){tracker.initialize();});},trackLoad:function(category,action,label){this.trackEvent('trackLoad',[category,action,label]);},trackClick:function(category,action,label){this.trackEvent('trackClick',[category,action,label]);},trackPageView:function(path){_.each(this.Trackers,function(tracker){tracker.trackPageView(path);});},trackEvent:function(eventType,params,optional){var category=this.UNDEFINED_LABEL,action=this.UNDEFINED_LABEL,label=this.UNDEFINED_LABEL;if(typeof params==='string'){category=params;if(params.match(this.MEMBERSHIP_GOAL_PREFIX)){category=this.MEMBERSHIP_GOAL_PREFIX;action=params.replace(this.MEMBERSHIP_GOAL_PREFIX,'');}}else{category=params[0];action=params[1];label=params[2];}
var opts={type:eventType,category:category,action:action,label:label};opts=_.extend(opts,optional);_.each(this.Trackers,function(tracker){tracker.trackEvent(opts);});}};Groupon.Analytics.Logger={debug:false,initialize:function(){if(typeof console!=="undefined"){this.logger=console;}else{this.logger=undefined;}},trackPageView:function(path){if(this.debug&&this.logger){this.logger.log("trackPageView",path);}},trackEvent:function(opts){if(this.debug&&this.logger){this.logger.log("trackEvent",opts);}}};Groupon.Analytics.Google={DEFAULT_PROFILE_ID:'UA-1250257-1',VISITOR_SCOPE:1,SESSION_SCOPE:2,PAGE_SCOPE:3,LAYER_TO_SLOT_MAP:{'deal-page-081811':1,'places-080311':2,'getaways-deal-081811':4,'checkout-page-081811':5},DEFAULT_DIVISION_SLOT:3,initialize:function(){var accountId;if(Groupon.Attributes){accountId=Groupon.Attributes.google_analytics_profile_id;}
accountId=accountId||this.DEFAULT_PROFILE_ID;_gaq=window._gaq||[];_gaq.push(['_setAccount',accountId]);_gaq.push(['_setDomainName','.groupon.com']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s);})();if(window.google_division_changed){this.setDivisionCustomVar(window.google_division_changed);}
this._trackGoal();},trackPageView:function(path){_gaq.push(['_trackPageview',path]);},trackEvent:function(opts){_gaq.push(['_trackEvent',opts.category,opts.action,opts.label]);},setExperimentCustomVar:function(layerId,experimentId,variantId){var slotId=this._slotForExperimentLayer(layerId);layerId=this._scrubWhitespace(layerId);experimentId=this._scrubWhitespace(experimentId);variantId=this._scrubWhitespace(variantId);var name="Exp-"+layerId;var safeExperimentId=experimentId+"/"+variantId;this.setCustomVar(name,safeExperimentId,slotId,this.VISITOR_SCOPE);},setDivisionCustomVar:function(newDivision){this.setCustomVar("Division",newDivision,this.DEFAULT_DIVISION_SLOT,this.SESSION_SCOPE);},setCustomVar:function(label,value,slot,scope){_gaq.push(['_setCustomVar',slot,label,value,scope]);},_scrubWhitespace:function(val){return val.replace(/[\s]/g,'').replace(/[^\w]/g,'-');},_slotForExperimentLayer:function(layerId){if(this.LAYER_TO_SLOT_MAP[layerId]==null){return;}
return this.LAYER_TO_SLOT_MAP[layerId];},_trackGoal:function(){if(window.google_goal){_gaq.push(['_trackPageview',google_goal],['_addTrans',google_order_id,"",google_amount,"","","","",""],['_addItem',google_order_id,google_sku,google_product_name,"Uncategorized",google_unit_price,google_quantity],['_trackTrans']);}else{_gaq.push(['_trackPageview']);}}};Groupon.Analytics.PixelTracker={PIXEL_URL:"/analytic/view.gif",TRACKING_COOKIE:'pixel_tracking',initialize:function(){},trackPageView:function(path){if(typeof(path)==='string'){path={'path':path};}
this.injectTrackingPixel('trackPageView',path);},trackEvent:function(opts){this.injectTrackingPixel('trackEvent',opts);},injectTrackingPixel:function(type,options){options=options||{};_(options).extend({sd:(!!Groupon.Dale)});if(options.runOnLoad){delete options.runOnLoad;this.stashTrackingPixel(type,options);}else{$('body').append($("<img />",{'src':this.__trackingPixelSource(type,options),'class':'tracking-pixel','height':1,'width':1}));}},stashTrackingPixel:function(type,options){var cookie=$.parseJSON(Cookie.get(this.TRACKING_COOKIE))||[];cookie.push(this.__trackingPixelParams(type,options));Cookie.set(this.TRACKING_COOKIE,$.toJSON(cookie));},injectTrackingPixelFromCookie:function(){_($.parseJSON(Cookie.get(this.TRACKING_COOKIE))).each(_(function(data,i){var type=data.t;delete data.t;this.injectTrackingPixel(type,data);}).bind(this));Cookie.unset(this.TRACKING_COOKIE);},__trackingPixelSource:function(type,options){return this.PIXEL_URL+'?'+$.param(this.__trackingPixelParams(type,options));},__trackingPixelParams:function(type,options){_(options).extend({t:type,cb:this.__cacheBuster()});return options;},__cacheBuster:function(){return(new Date()).getTime();}};Groupon.Analytics.Trackers=[Groupon.Analytics.Google,Groupon.Analytics.Logger,Groupon.Analytics.PixelTracker];Groupon.Analytics.initialize();(function(){function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3]);}
function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32((a<<s)|(a>>>(32-s)),b);}
function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t);}
function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t);}
function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t);}
function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t);}
function md51(s){if(/[\x80-\xFF]/.test(s)){s=unescape(encodeURI(s));}
txt='';var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;for(i=64;i<=s.length;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)));}
s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<s.length;i++)
tail[i>>2]|=s.charCodeAt(i)<<((i%4)<<3);tail[i>>2]|=0x80<<((i%4)<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0;}
tail[14]=n*8;md5cycle(state,tail);return state;}
function md5blk(s){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+
(s.charCodeAt(i+1)<<8)+
(s.charCodeAt(i+2)<<16)+
(s.charCodeAt(i+3)<<24);}
return md5blks;}
var hex_chr='0123456789abcdef'.split('');function rhex(n){var s='',j=0;for(;j<4;j++)
s+=hex_chr[(n>>(j*8+4))&0x0F]+
hex_chr[(n>>(j*8))&0x0F];return s;}
function hex(x){for(var i=0;i<x.length;i++)
x[i]=rhex(x[i]);return x.join('');}
md5=function(s){return hex(md51(s));}
function add32(a,b){return(a+b)&0xFFFFFFFF;}
if(md5('hello')!='5d41402abc4b2a76b9719d911017c592'){function add32(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF),msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF);}}})();var Cookie={build:function(){var parts=Array.prototype.slice.apply(arguments);for(var i=0;i<parts.length;i++){if(!parts[i])
parts.splice(i,1);}
return parts.join("; ");},secondsFromNow:function(seconds){var d=new Date();d.setTime(d.getTime()+(seconds*1000));return d.toGMTString();},set:function(name,value,seconds,domain){var cookieExpiry=this._getExpiry(seconds),cookieDomain=this._getDomain(domain);if(typeof value==="string"){value=value.replace(/\s/g,'+');}
document.cookie=Cookie.build(name+"="+encodeURIComponent(value),cookieExpiry,"path=/",cookieDomain);},get:function(name){var valueMatch=new RegExp("(?:^|;(?:\\s*))"+name+"=([^;]+)").exec(document.cookie);var value=valueMatch?valueMatch[1]:null;return value!==null?decodeURIComponent(value).replace(/\+/g,' '):null;},unset:function(name,domain){Cookie.set(name,'',-1,domain);},_getExpiry:function(seconds,domain){return seconds?'expires='+Cookie.secondsFromNow(seconds):null;},_getDomain:function(domain){return domain?'domain='+domain:null;}};(function(){var Finch,debug,__hasProp=Object.prototype.hasOwnProperty,__bind=function(fn,me){return function(){return fn.apply(me,arguments);};},__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key];}function ctor(){this.constructor=child;}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child;},__slice=Array.prototype.slice;(typeof exports!=="undefined"&&exports!==null?exports:this).Finch=Finch=(function(){var Utility;return{initialize:function(window,config){var layerConfig,layerName;this.window=window;this.reset();this.layers=(function(){var _results;_results=[];for(layerName in config){if(!__hasProp.call(config,layerName))continue;layerConfig=config[layerName];_results.push(new Finch.Layer(layerName,layerConfig));}
return _results;})();debug('initialized');this.runPreferredExperiments();return this;},run:function(){var layer,_i,_len,_ref;if(this.layers==null)return;_ref=this.layers;for(_i=0,_len=_ref.length;_i<_len;_i++){layer=_ref[_i];layer.run();}
return Finch.Tracking.deliver();},reset:function(){return this.layers=[];},isInExperiment:function(experimentName){return _.any(this.layers,function(layer){var _ref;return((_ref=layer.experiment())!=null?_ref.name:void 0)===experimentName;});},runPreferredExperiments:function(){var layer,_i,_len,_ref;_ref=this.layers;for(_i=0,_len=_ref.length;_i<_len;_i++){layer=_ref[_i];layer.preferredRun();}
return Finch.Tracking.deliver();},Utility:Utility=(function(){function Utility(){}
Utility.parseQueryString=function(queryString){var name,parameter,params,value,_i,_len,_ref,_ref2;params={};if(queryString===''||queryString==='?')return params;_ref=queryString.substr(1).split('&');for(_i=0,_len=_ref.length;_i<_len;_i++){parameter=_ref[_i];_ref2=parameter.split("="),name=_ref2[0],value=_ref2[1];params[name]=value;}
return params;};Utility.md5=function(string){return md5(string);};return Utility;})()};})();Finch.Tracking={deliver:function(){var tracker,_i,_len,_ref;_ref=Finch.Trackers;for(_i=0,_len=_ref.length;_i<_len;_i++){tracker=_ref[_i];try{tracker.track(this._translatedExperiments(),Finch.window);}catch(e){}}
return this.reset();},trackExperiment:function(experiment){return this.experiments.push(experiment);},trackExperimentError:function(experiment,error){this.trackExperiment(experiment);return this.experimentErrors[experiment.id]=error;},reset:function(){this.experiments=[];return this.experimentErrors={};},_translatedExperiments:function(){var data,error,experiment,_i,_len,_ref,_results;_ref=this.experiments;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){experiment=_ref[_i];data={layer:experiment.layer,experiment:experiment,variant:experiment.variantName()};error=this.experimentErrors[experiment.id];if(error)data.error=error;_results.push(data);}
return _results;}};Finch.Tracking.reset();Finch.Experiments={};Finch.Experiments.Global={};Finch.Diversions={};Finch.Trackers=[];Finch.NUMBER_OF_BUCKETS_PER_LAYER=1000;Finch.VERSION='0.6.7';debug=function(message){if(Finch.debug&&((typeof console!=="undefined"&&console!==null?console.log:void 0)!=null)){return console.log("::: finch.js : "+message);}};Finch.Layer=(function(){Layer.all=function(){return Finch.layers||[];};function Layer(name,config){var experimentConfig,experimentIdentifier;this.name=name;this.preferredRun=__bind(this.preferredRun,this);this.run=__bind(this.run,this);this.bucket=__bind(this.bucket,this);if(config!=null){debug("loading layer "+this.name);this.experiments=(function(){var _ref,_results;_ref=config.experiments;_results=[];for(experimentIdentifier in _ref){if(!__hasProp.call(_ref,experimentIdentifier))continue;experimentConfig=_ref[experimentIdentifier];_results.push(new Finch.Experiment(experimentIdentifier,this,experimentConfig));}
return _results;}).call(this);if(config.diversion_type!=null){this.diversion=Finch.Diversions[config.diversion_type];}}
if(this.diversion==null){this.diversion=Finch.Diversions.RandomDiversion;}}
Layer.prototype.findExperiments=function(selector){var experiment,_i,_len,_ref,_results;if(selector==null)return[];_ref=this.experiments;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){experiment=_ref[_i];if(selector(experiment))_results.push(experiment);}
return _results;};Layer.prototype.experimentsForBucket=function(bucket){return this.findExperiments(function(exp){return(exp.status==='running')&&((exp.buckets.min<=bucket&&bucket<=exp.buckets.max));});};Layer.prototype.experiment=function(){return this._getExperimentByQueryString()||this._getExperimentByCookie()||this._getSingleMatchingExperiment();};Layer.prototype.bucket=function(){var _ref;return(_ref=this.bucketCache)!=null?_ref:this.bucketCache=this.diversion.bucket(this);};Layer.prototype.run=function(){var experiment;experiment=this.experiment();if(experiment&&!experiment.isPreferred())return experiment.run();};Layer.prototype.preferredRun=function(){var experiment;experiment=this.experiment();if(experiment&&experiment.isPreferred())return experiment.run();};Layer.prototype._getExperimentByQueryString=function(){var experimentName,layerName,params;if(this.forcedExperimentCache!=null)return this.forcedExperimentCache;params=Finch.Utility.parseQueryString(Finch.window.location.search);layerName=params.finch_layer;experimentName=params.finch_experiment;if(!(layerName&&experimentName&&layerName===this.name))return null;return this.forcedExperimentCache=_.detect(this.experiments,function(ex){return ex.name===experimentName;});};Layer.prototype._getExperimentByCookie=function(){var experimentName;experimentName=Cookie.get(""+this.name+":Experiment");return _.detect(this.experiments,function(ex){return ex.name===experimentName;});};Layer.prototype._getSingleMatchingExperiment=function(){var results,_this=this;if(this.bucket()==null)return null;results=this.findExperiments(function(exp){var _ref;return(exp.status==='running')&&((exp.buckets.min<=(_ref=_this.bucket())&&_ref<=exp.buckets.max));});if(results.length===1){return results[0];}else{return null;}};return Layer;})();Finch.Diversion=(function(){function Diversion(diversionCallback){this.diversionCallback=diversionCallback;}
Diversion.prototype.bucket=function(layer){var bucket;if(layer==null)throw'layer is not defined';if(this.diversionCallback==null)throw'no bucketing function defined';bucket=this.diversionCallback(layer);if(bucket==null)return null;if(!this._validBucket(bucket))throw"bucket "+bucket+" out of range";debug("diversion bucket "+bucket+" for "+(layer!=null?layer.name:void 0));return bucket;};Diversion.prototype._validBucket=function(bucket){return(0<=bucket&&bucket<=Finch.NUMBER_OF_BUCKETS_PER_LAYER);};return Diversion;})();Finch.HashCookieDiversion=(function(_super){__extends(HashCookieDiversion,_super);function HashCookieDiversion(){var cookies;cookies=1<=arguments.length?__slice.call(arguments,0):[];this.cookies=cookies;HashCookieDiversion.__super__.constructor.call(this,function(layer){var cookie,cookieName,cookieValue,_i,_len,_ref,_ref2,_ref3;if(this.cookies instanceof Array){_ref=this.cookies;for(_i=0,_len=_ref.length;_i<_len;_i++){cookie=_ref[_i];if(!(typeof cookieValue!=="undefined"&&cookieValue!==null)){_ref2=[cookie,Cookie.get(cookie)],cookieName=_ref2[0],cookieValue=_ref2[1];}}}else{_ref3=[this.cookies,Cookie.get(this.cookies)],cookieName=_ref3[0],cookieValue=_ref3[1];}
if(cookieValue==null){debug("no valid cookies");return null;}
debug("bucketing with cookie: "+cookieName+"="+cookieValue);return this._hash(""+cookieValue+","+layer.name);});}
HashCookieDiversion.prototype._hash=function(input){var md5;md5=Finch.Utility.md5(input);debug(md5);return parseInt(md5.slice(24,32),16)%Finch.NUMBER_OF_BUCKETS_PER_LAYER;};return HashCookieDiversion;})(Finch.Diversion);Finch.Diversions.RandomDiversion=new Finch.Diversion(function(layer){return Math.floor(Math.random()*Finch.NUMBER_OF_BUCKETS_PER_LAYER);});Finch.Diversions.CookieDiversion=new Finch.HashCookieDiversion('b');Finch.Experiment=(function(){function Experiment(id,layer,config){var _ref,_ref2,_ref3,_ref4,_ref5;this.id=id;this.layer=layer;if(config==null)config={};this.name=(_ref=config.name)!=null?_ref:'';this.status=(_ref2=config.status)!=null?_ref2:'inactive';this.variants=(_ref3=config.variants)!=null?_ref3:[];this.guards=(_ref4=config.guards)!=null?_ref4:[];this.params=(_ref5=config.params)!=null?_ref5:{};this.buckets=this._parseBucketRange(config.buckets);this.pathPatterns=this._parsePathPatterns(config.path_patterns);debug("loading experiment "+this.name);}
Experiment.prototype.run=function(){var window,_ref;window=Finch.window;if(this.isDeferred()){debug("matching experiment "+this.id+" deferred with variant "+(this.variantName()));return(_ref=this._deferCallback())!=null?_ref.call(this):void 0;}else{if(this.testMatches()){return this._execute();}else{return debug("GuardFailed on experiment "+this.id);}}};Experiment.prototype.deferredRun=function(){var variantName;variantName=this.variantName();debug("running deferred experiment "+this.id+" with bucket "+variantName);if(this.testMatches()){this._execute(variantName,Finch.window);}else{debug("GuardFailed on experiment "+this.id);}
return Finch.Tracking.deliver();};Experiment.prototype.isPreferred=function(){return!!this.experimentDefinition().runOnInit;};Experiment.prototype.isDeferred=function(){return!!this.experimentDefinition().defer;};Experiment.prototype.testMatches=function(){var window;window=Finch.window;return this.pathMatches(window.location)&&this.paramsMatches(window.location)&&this.guardMatches(window);};Experiment.prototype.pathMatches=function(location){var path;path=location.pathname;if((path!=null)&&this.pathPatterns.length===0)return true;return _.any(this.pathPatterns,function(pattern){return pattern.test(path);});};Experiment.prototype.paramsMatches=function(location){var queryParams;queryParams=Finch.Utility.parseQueryString(location.search);if(_.isEmpty(this.params))return true;return _.all(this.params,function(paramValues,paramName){if(queryParams[paramName]==null)return false;return _.any(paramValues,function(value){return queryParams[paramName]===value;});});};Experiment.prototype.guardMatches=function(window){var _this=this;if(this.guards.length===0)return true;return _.all(this.guards,function(guard){var _ref,_ref2,_ref3,_ref4;return((_ref=_this.experimentDefinition().guards)!=null?(_ref2=_ref[guard])!=null?_ref2.call(window):void 0:void 0)||((_ref3=Finch.Experiments.Global.guards)!=null?(_ref4=_ref3[guard])!=null?_ref4.call(window):void 0:void 0);});};Experiment.prototype.currentVariant=function(bucket){return this.experimentDefinition().variants[this.variantNameForBucket(bucket)];};Experiment.prototype.randomVariant=function(){var variantName;variantName=this.variants[Math.floor(Math.random()*this.variants.length)];return this.experimentDefinition().variants[variantName];};Experiment.prototype.variant=function(){var _ref;return(_ref=this.variantCache)!=null?_ref:this.variantCache=this.experimentDefinition().variants[this.variantName()];};Experiment.prototype.variantName=function(){var _ref;return(_ref=this.variantNameCache)!=null?_ref:this.variantNameCache=this.variantNameForBucket(this.bucket());};Experiment.prototype.variantNameForBucket=function(bucket){return this._variantNameByQuerystring()||this._variantNameByCookie()||this._variantNameByRoundRobin(bucket);};Experiment.prototype._variantNameByQuerystring=function(){var experimentName,layerName,params,variantName;params=Finch.Utility.parseQueryString(Finch.window.location.search);layerName=params.finch_layer;experimentName=params.finch_experiment;variantName=params.finch_variant;if(layerName===this.layer.name&&experimentName===this.name&&(variantName!=null)){return variantName;}};Experiment.prototype._variantNameByCookie=function(){var key;key=""+this.layer.name+":"+this.id+":Variant";return Cookie.get(key);};Experiment.prototype._variantNameByRoundRobin=function(bucket){var variantIndex;if(!((this.buckets.min<=bucket&&bucket<=this.buckets.max))){return null;}
variantIndex=(bucket-this.buckets.min)%this.variants.length;return this.variants[variantIndex];};Experiment.prototype.bucket=function(){return this.layer.bucket();};Experiment.prototype.experimentDefinition=function(){var _base,_name,_ref;return(_ref=(_base=Finch.Experiments)[_name=this.id])!=null?_ref:_base[_name]={variants:{}};};Experiment.prototype._execute=function(){var variant,window,_ref,_ref2;window=Finch.window;try{if((_ref=this._beforeCallback())!=null)_ref.call(window);variant=this.variant();if(variant!=null){debug("rendering variant "+(this.variantName()));debug(variant);if(this.isPreferred()){Finch.Tracking.trackExperiment(this);Finch.Tracking.deliver();}
variant.call(window);}
if((_ref2=this._afterCallback())!=null)_ref2.call(window);if(!this.isPreferred())return Finch.Tracking.trackExperiment(this);}catch(e){return Finch.Tracking.trackExperimentError(this,e);}};Experiment.prototype._deferCallback=function(){debug("initializing deferred experiment "+this.name);return this.experimentDefinition().defer;};Experiment.prototype._beforeCallback=function(){var self,_ref;self=this;return _.wrap((_ref=this.experimentDefinition().before)!=null?_ref:function(){},function(callback){var _base;debug("starting experiment "+self.name);if(typeof(_base=Finch.Experiments.Global).before==="function"){_base.before();}
return callback();});};Experiment.prototype._afterCallback=function(){var self,_ref;self=this;return _.wrap((_ref=this.experimentDefinition().after)!=null?_ref:function(){},function(callback){var _base;if(typeof(_base=Finch.Experiments.Global).after==="function"){_base.after();}
callback();return debug("completed experiment "+self.name);});};Experiment.prototype._parseBucketRange=function(range){var buckets;if(range==null)range='0..999';buckets=range.split('..');return{min:parseInt(buckets[0],10),max:parseInt(buckets[1],10)};};Experiment.prototype._parsePathPatterns=function(patterns){var patternSource,_i,_len,_results;if(!((patterns!=null)&&patterns.length>0))return[];_results=[];for(_i=0,_len=patterns.length;_i<_len;_i++){patternSource=patterns[_i];_results.push(new RegExp("^"+patternSource+"$"));}
return _results;};return Experiment;})();Finch.ConsoleLoggingTracker={track:function(expSets,window){console.log(expSets);return _(expSets).each(function(expSet){var _ref,_ref2;console.log("*****************************");console.log("*** ConsoleLoggingTracker ***");console.log("*****************************");console.log("*** layer: "+((_ref=expSet.layer)!=null?_ref.name:void 0));console.log("*** experiment: "+((_ref2=expSet.experiment)!=null?_ref2.name:void 0));console.log("*** variant: "+expSet.variant);if(expSet.error!=null)console.log("*** error: "+expSet.error);return console.log("*****************************");});}};Finch.PixelTracker={track:function(expSets,window){var e,experimentSets,trackerData;if(Finch.alwaysFirePixel||!_.isEmpty(expSets)){experimentSets=_.map(expSets,function(expSet){return{layer:expSet.layer.name,experiment:expSet.experiment.id,variant:expSet.variant,error:expSet.error};});trackerData=Finch.externalData?{experiments:experimentSets,externalData:Finch.externalData}:experimentSets;e=encodeURIComponent(JSON.stringify(trackerData));return this.sendData(e);}},sendData:function(e){var cacheBuster,trackerPath;cacheBuster=(new Date).getTime();trackerPath="/analytic/experiment.gif?e="+e+"&src=img&_="+cacheBuster;return $("<img />",{"class":'finch-tracking',src:trackerPath,height:1,width:1}).appendTo($('body'));}};Finch.AjaxPixelTracker={track:Finch.PixelTracker.track,sendData:function(e){var trackerPath;trackerPath="/analytic/experiment.gif?e="+e+"&src=ajax";return $.ajax(trackerPath,{cache:false});}};}).call(this);if(typeof $!='undefined')
$(function(){if(Groupon.Attributes.optimizer_config){Finch.initialize(window,Groupon.Attributes.optimizer_config);Finch.Trackers=[Groupon.Finch.GrouponAnalyticsTracker,Finch.PixelTracker,Finch.AjaxPixelTracker];}
Finch.run();Groupon.Finch.trigger('run');});Finch.Diversions.SubscriberCookieDiversion=new Finch.HashCookieDiversion('scid');Finch.Experiments.Global={guards:{on_deal_or_division_page:function(){return Groupon.onDealPage||Groupon.onDivisionPage;},on_all_deals_page:function(){return Groupon.onAllDealsPage;},on_getaways_gallery_page:function(){return Groupon.onChannelGalleryPage&&Groupon.currentChannel&&Groupon.currentChannel.permalink==="getaways";},url_params_match:function(params){var queryParams;queryParams=Finch.Utility.parseQueryString(location.search);return _.all(params,function(paramValue,paramName){return(queryParams[paramName]!=null&&queryParams[paramName]===paramValue);});},path_matches:function(pathPatterns){var path;path=location.pathname;if((path!=null)&&pathPatterns.length===0){return true;}
return _.any(pathPatterns,function(pattern){return pattern.test(path);});},division_is_enabled_for_now_right_rail_v2:function(){return Groupon.division&&Groupon.division.now_customer_enabled;},division_is_enabled_for_now:function(){return Groupon.division&&Groupon.division.now_customer_enabled;},on_now_page:function(){return Groupon.onNowPage;},on_page_with_sub:function(){var sub_new=Finch.Experiments.Global.guards.path_matches([(/\/subscriptions\/new/)]);return Finch.Experiments.Global.guards.on_deal_or_division_page||sub_new;},on_sub_flow:function(){return Finch.Experiments.Global.guards.path_matches([(/\/subscriptions\/new/)]);},on_checkout_page:function(){return(/^\/deals\/[^\/]+\/confirmation$/).test(window.location.pathname);},now_deal:function(){return Groupon.currentDeal&&!!Groupon.currentDeal.nowDeal;},not_now_deal:function(){return!Groupon.currentDeal||!Groupon.currentDeal.nowDeal;},scheduler_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.bookable;},not_scheduler_deal:function(){return!Groupon.currentDeal||!Groupon.currentDeal.bookable;},on_travel_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.travelDeal;},not_travel_deal:function(){return!Finch.Experiments.Global.guards.on_travel_deal();},not_has_forced_template:function(){return!Groupon.currentDeal||!Groupon.currentDeal.hasForcedTemplate;},not_subscription_page:function(){var regex=/\/subscriptions\/new/;return!Finch.Experiments.Global.guards.path_matches([regex]);},on_support_page:function(){var support_page_regex=/^(?:\/[a-zA-Z]{2}|\/[a-zA-Z]{2}_[a-zA-Z]{2})?\/support/;return Finch.Experiments.Global.guards.path_matches([support_page_regex]);},supported_browser:function(){return!($.browser.msie&&parseInt($.browser.version,10)<9);},not_on_ie8:function(){return!($.browser.msie&&parseInt($.browser.version,10)==8);},not_on_ie7:function(){return!($.browser.msie&&parseInt($.browser.version,10)==7);},not_on_ie6:function(){return!($.browser.msie&&parseInt($.browser.version,10)<=6);},not_on_touch_site:function(){var userAgentsRegex=new RegExp("iphone|webos|android|ipad|blackberry .+ applewebkit");return!userAgentsRegex.test(navigator.userAgent.toLowerCase());},not_dale:function(){return location.search.indexOf('dl=d47388')===-1;},on_multi_option_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.multiDeal;},on_dale:function(){return Finch.Experiments.Global.guards.url_params_match({dl:'d47388'});},on_scottsdale:function(){return!!(Groupon.Dale.experiment==="Scottsdale");},on_davesdale:function(){return!!(Groupon.Dale.experiment==="Davesdale");},not_post_purchase:function(){return!Finch.Experiments.Global.guards.url_params_match({post_purchase:'true'});},cookies_enabled:function(){var cookieName='_finch-cookie-test';Cookie.set(cookieName,"enabled");if(Cookie.get(cookieName)==="enabled"){Cookie.unset(cookieName);return true;}else{return false;}},on_sub_center_with_division:function(){var regex=/\/subscription_center\/.*unsubscribed_division/;return regex.test(location.href);}}};Finch.Experiments.AllDealsDiscount={variants:{Original:function(){},Discounted:function(){$('#deal_container').addClass('all_deals_discounted_group');Groupon.Personalization.AllDeals.Discount=true;}}};Finch.Experiments.PersonalizeWizard={Treatments:{PostSubscribe:{defaultBehavior:function(){if(Groupon.Subscription&&Groupon.Subscription.Tracker){Groupon.Subscription.Tracker.get().trackZipGenderPostSubModal();}},showPWModal:function(){Control.Modal.close();$(document).trigger('personalizeWizard.open',$('#personalize_wizard_call_to_action').data('cta-source'));Groupon.Subscription.Tracker.get().trackPersonalizeWizardPostSubModal();},suppressZGModal:function(){Control.Modal.close();}},CallToAction:{renderTop:function(){var renderCallback=function(user){var template='groupon/application/callouts/_personalize_wizard_call_to_action_top',keyBase='js.app.shared.personalize_wizard.callouts.call_to_action_top';this.callToAction.addClass('top');this.callToAction.data('cta-source','TopCTA');this.callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{closeButtonText:I18n.translate(keyBase+'.close_button_text'),startButtonText:I18n.translate(keyBase+'.start_button_text'),prompt:I18n.translate(keyBase+'.prompt')}));};Groupon.PersonalizeWizardCallToAction.init($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);},renderBottom:function(){var renderCallback=function(user){var template='groupon/application/callouts/_personalize_wizard_call_to_action_bottom',keyBase='js.app.shared.personalize_wizard.callouts.call_to_action_bottom';this.callToAction.addClass('bottom');this.callToAction.data('cta-source','BottomCTA');this.callToAction.html(Mustache.to_html(Groupon.MustacheTemplates[template],{closeButtonText:I18n.translate(keyBase+'.close_button_text'),title:I18n.translate(keyBase+'.title',{first_name:user.firstName}),instructions:I18n.translate(keyBase+(user.firstName?'.instructions_with_name':'.instructions_without_name'),{strong_open:'<strong>',strong_close:'</strong>',first_name:user.firstName}),startButtonText:I18n.translate(keyBase+'.start_button_text'),progressBarLabel:I18n.translate(keyBase+'.progress_bar_label')}));};Groupon.PersonalizeWizardCallToAction.init($('#personalize_wizard_call_to_action'),Groupon.currentUser,renderCallback);}}},defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Original:function(){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.defaultBehavior();},TopCTAPWModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderTop();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.showPWModal();}});},BottomCTANoModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderBottom();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.suppressZGModal();}});},BottomCTAZGModal:function(){Finch.Experiments.PersonalizeWizard.Treatments.CallToAction.renderBottom();$(function(){if($('#zip_gender').is(':visible')){Finch.Experiments.PersonalizeWizard.Treatments.PostSubscribe.defaultBehavior();}});}},after:function(){Groupon.PersonalizeWizardModal.init($('#personalize_wizard'),Groupon.currentUser);Groupon.PersonalizeWizard=Groupon.PersonalizeWizard||{};Groupon.PersonalizeWizard.WizardView=new App.Views.PersonalizeWizard.WizardView({model:new App.Models.PersonalizeWizard.Wizard(),collection:new App.Collections.PersonalizeWizard.Steps([],{currentUser:Groupon.currentUser}),currentUser:Groupon.currentUser});},guards:{wizard_enabled:function(){return $('#personalize_wizard_call_to_action').length===1;},wizard_activated:function(){return App.Helpers.PersonalizeWizard.shouldShow(Groupon.currentUser);}}};var PlacesTreatments={subs:{disabled_featured:function(){try{if(MultiSteps.forward){window.location="/"+Groupon.currentDivision+"?post_subscribe=true"+MultiSteps.getFormParam();MultiSteps.finch_finished=true;}}catch(e){}},disabled_alldeals:function(){try{if(MultiSteps.forward){window.location="/"+Groupon.currentDivision+"/all?post_subscribe=true"+MultiSteps.getFormParam();MultiSteps.finch_finished=true;}}catch(e){}}},users:{disabled:function(){},enabled:function(){$('.finch_places_enabled_show').css({"display":"inline-block"});$('.finch_places_enabled_hide').hide();$('.places_nav').show();$('.locations_exist').hide();if($.browser.msie&&$.browser.version<8){$('.deal').css("display","none").css("display","block");}}}};var placesExperiment=function(options){return{variants:{group1:function(){PlacesTreatments["subs"][options["group1"]["subs"]]();PlacesTreatments["users"][options["group1"]["users"]]();},group2:function(){PlacesTreatments["subs"][options["group2"]["subs"]]();PlacesTreatments["users"][options["group2"]["users"]]();}}};};Finch.Experiments.Places0=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places1=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places2=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places3=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places4=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places5=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places6=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places7=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places8=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.Places9=placesExperiment({group1:{subs:"disabled_alldeals",users:"enabled"},group2:{subs:"disabled_alldeals",users:"enabled"}});Finch.Experiments.TireKickerVideos={variants:{"Original":function(){if(!Cookie.get('tire_kickers_callout')&&$($.ui.modal.instances).length==0){animateTKCallout();}},"NoVideo":function(){$('.tire_kickers').hide();}},guards:{on_a_tirekicker_deal:function(){return Groupon.currentDeal&&Groupon.currentDeal.tirekicker;}}};Finch.Experiments.Thumbs={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{Original:function(){},OnlyThumbs:function(){$(".deal_tags").hide();_($('.thumbs')).each(function(el){view=new App.Views.Thumbs({el:el,collection:new App.Collections.Thumbs([],{deal:$(el).data('deal-id')})});view.render();})}},guards:{on_thumb_page:function(){return(Groupon.onDealPage||Groupon.onDivisionPage||Groupon.onAllDealsPage);},thumbs_feature_enabled:function(){return!!Groupon.thumbsEnabled;},is_internal_user:function(){return!!(typeof Groupon.currentUser.emailAddress!=="undefined"&&Groupon.currentUser.emailAddress.match(/@groupon.com$/i));}}};Finch.Experiments.Scottsdale={runOnInit:true,variants:{Original:function(){if(App){App.ExperimentVersions.Scottsdale=1;}},Dale:function(){Groupon.Dale=_.extend(Groupon.Dale||{},{experiment:"Scottsdale"});if(location.search.indexOf('dl=d47388')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')
+'dl='+'d47388';window.location.replace(param);}
if(App){App.ExperimentVersions.Scottsdale=2;}}},guards:{not_post_subscribe:function(){return Finch.Experiments.Global.guards.url_params_match({post_subscribe:'true'});},not_merchant:function(){var user=$.parseJSON(unescape(Cookie.get('user_info')));if(user){if(user.has_merchants&&Finch.Experiments.Global.guards.url_params_match({dl:'d47388'})){window.location.replace(window.location.toString().replace(/(&)?dl=d47388(&)?/,''));}
return!user.has_merchants;}
else
return true;},not_admin:function(){var user=$.parseJSON(unescape(Cookie.get('user_info')));if(user){return!user.aos;}
else
return true;},not_opted_out_of_dale:function(){return!Cookie.get("daleOptOut");}}};Finch.Experiments.Davesdale={runOnInit:true,variants:{Original:function(){if(App){App.ExperimentVersions.Scottsdale=1;}},Dale:function(){Groupon.Dale=_.extend(Groupon.Dale||{},{experiment:"Davesdale"});if(location.search.indexOf('dl=d47388')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')
+'dl='+'d47388';window.location.replace(param);}
if(App){App.ExperimentVersions.Scottsdale=2;}}},guards:Finch.Experiments.Scottsdale.guards};Finch.Experiments.DaleRedirect={runOnInit:true,variants:{Original:function(){},Redirect:function(){if(!Cookie.get("redirected")&&location.search.indexOf('tl=')<0){$('body').hide();var param=location.search+(location.search==''?'?':'&')
+'tl='+'31337';Cookie.set("redirected",true,7200);window.location.replace(param);}}}};Finch.Experiments.DaleFullyDesigned={variants:{Dale:function(){Finch.Experiments.Scottsdale.variants.Dale();$(function(){var removePurchaseCluster=function(){$('.purchase_cluster_2').remove();}
removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});},PurchaseCluster:function(){$(function(){$('body').addClass('worf');var removePurchaseCluster=function(){if(!($('.purchase_cluster').hasClass('purchase_cluster_2')))$('.purchase_cluster').remove();$('.purchase_cluster_2').addClass('purchase_cluster');}
removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});},NoOp:function(){Finch.Experiments.Scottsdale.variants.Dale();$(function(){var removePurchaseCluster=function(){$('.purchase_cluster_2').remove();}
removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});},FullyDesigned:function(){$(function(){$('body').addClass('picard worf');var removePurchaseCluster=function(){if(!($('.purchase_cluster').hasClass('purchase_cluster_2')))$('.purchase_cluster').remove();$('.purchase_cluster_2').addClass('purchase_cluster');}
removePurchaseCluster();if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(removePurchaseCluster);}});}},guards:Finch.Experiments.Scottsdale.guards};Finch.Experiments.DaleNavigation={defer:function(){$("body").addClass('finch_init_nav_experiment');var experiment=this;var runExperiment=function(){experiment.deferredRun(Finch.window);$("body").removeClass('finch_init_nav_experiment');};if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(runExperiment);}else{$("#navigation_items_json").bind("attributes:ready",runExperiment);}},variants:{Original:function(){if(App){App.ExperimentVersions.DaleNavigation='Original';}},ChannelNavLikeOG:function(){$("#goods_nav").remove().insertAfter("#all_deals_nav");$("#getaways_nav").remove().insertAfter("#goods_nav");$("#vip_deals_nav").remove().insertAfter("#now_deals_nav");},Categorized:function(){if(!_(Groupon.Attributes.navigation_items_json).isEmpty()&&App){var navItems=new App.Collections.NavigationItems(Groupon.Attributes.navigation_items_json);var nav=new App.Views.Navigation({collection:navItems});App.ExperimentVersions.DaleNavigation='Categorized';}}},guards:{hasNavigationData:function(){return!_(Groupon.Attributes.navigation_items_json).isEmpty();}}};Finch.Experiments.DealVortex={defer:function(){var experiment=this;$(function(){experiment.deferredRun(Finch.window);});},variants:{Original:function(){if(App){App.ExperimentVersions.DealVortex='Original';}},TwoUp:function(){if(App){App.ExperimentVersions.DealVortex='TwoUp';Groupon.onCurrentUserReady(function(){$('section.deal_vortex').hide();$('#deal-vortex-wrap').show();});}}}};Finch.Experiments.MoreGreatDealsLeftRail={defer:function(){var experiment=this;$(function(){experiment.deferredRun(Finch.window);});},variants:{Original:function(){if(App){App.ExperimentVersions.MoreGreatDealsLeftRail='Original';}},MoreGreatDeals:function(){if(App){new Groupon.Views.TopDeals();App.ExperimentVersions.MoreGreatDealsLeftRail='MoreGreatDeals';}},MoreGreatDealsNoPhoto:function(){if(App){new Groupon.Views.TopDealsVariant();App.ExperimentVersions.MoreGreatDealsLeftRail='MoreGreatDealsNoPhoto';}}}};Finch.Experiments.NoTippingPt={variants:{Original:function(){},HideTippingPoint:function(){Groupon.onCurrentUserReady(function(){$('#number_sold_container').addClass('finch_hidden_tipping_point');});}},guards:{deal_is_not_sold_out:function(){return!Groupon.currentDeal.sold_out;}}};Finch.Experiments.ClickyBannerHoldout={variants:{Original:function(){},HideClickyBanner:function(){$('#rail_list .clicky_badge').hide();}}};Finch.Experiments.ClickyBanner={variants:{Original:function(){},ShowClickyBanner:function(){$('#rail_list .clicky_badge').show();}},guards:{is_division_in_list:function()
{disabledDivisions={"Nashville":true,"Salt Lake City":true,"San Francisco":true,"Hampton Roads":true,"Jacksonville":true,"New Orleans":true,"Hartford":true,"Inland Empire":true,"Calgary":true,"Louisville":true,"Oklahoma City":true,"Richmond":true,"Central Jersey":true,"Ottawa":true,"Edmonton":true,"Honolulu":true,"Providence":true,"Birmingham":true,"Grand Rapids":true,"Buffalo":true,"Rochester":true,"Memphis":true,"Omaha":true,"Wichita":true,"Knoxville":true,"Raleigh":true,"Baltimore":true,"Austin":true,"Indianapolis":true,"Kansas City":true,"Charlotte":true,"Sacramento":true,"Pittsburgh":true,"San Jose":true,"San Antonio":true,"Columbus":true,"Cincinnati":true,"Fort Lauderdale":true,"Cleveland":true,"Milwaukee":true,"Fort Worth":true,"Long Island":true,"Palm Beach":true,"Tucson":true,"Madison":true,"Akron":true,"Greenville":true,"Westchester County":true,"Dayton":true,"Colorado Springs":true,"Fairfield County":true,"Ann Arbor":true,"Napa / Sonoma":true,"Santa Cruz":true,"Salem":true,"Lakeland":true,"Athens":true,"Stockton":true,"Youngstown":true,"Topeka":true};return!disabledDivisions[Groupon.division.name];}}};Finch.Experiments.StaySignedIn={variants:{Control:function(){},HideUnchecked:function(){$("#brief_form_remember_me").hide();$("input#user_remember_me").prop('checked',false);}}};Finch.Experiments.PromoCodePosition={variants:{Control:function(){},RightRail:function(){var module;function setup(){var orig=Groupon.ui.reloadSubtotalMustachePartial;Groupon.ui.reloadSubtotalMustachePartial=function(event){orig(event);moveToSidebar();};moveToSidebar();}
function moveToSidebar(){if(module){module.remove();}
var content=$("<div>",{"class":"module_content"});module=$("<div>",{"class":"module"}).append($("<div>",{"class":"module_top"}).append($("<h3>",{"text":"Have a Gift Card?"}))).append(content);var oldContainer=$("#subtotal .promo_item td");oldContainer.find("> *").each(function(){content.append(this);});oldContainer.remove();$("#rail").prepend(module);}
setup();}}};Finch.Experiments.DisableDealBankPostSubscribe={variants:{control:function(){},disabled:function(){var newSubForm=$("#new_subscription");if(newSubForm.length>0){var url=newSubForm.attr("action");var seperator=url.indexOf('?')>=0?'&':'?';newSubForm.attr("action",url+seperator+"ddb=true");}}}};Finch.Experiments.CachedConfirmationPageTwo={variants:{uncached:function(){Groupon.Personalization.cachedCheckout=false;},cached:function(){Groupon.Personalization.cachedCheckout=true;}}};Finch.Experiments.CachedConfirmationPage={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!='undefined'){Groupon.onCurrentUserReady(function(){experiment.deferredRun(Finch.window);});}},variants:{uncached:function(){},cached:function(){Groupon.Personalization.modifyBuyButtonForCachedCheckout();}},guards:{eligable_for_cached_checkout:function(){if(typeof Groupon.Personalization!='undefined'){return Groupon.Personalization.eligableForCachedCheckout(Groupon.currentUser,Groupon.currentDeal);}else{return false;}}}};(function(){function replaceNumInElement(elem){var original=elem.html();var num=original.match(/[\d,]+/);if(num){elem.html(original.replace(/[\d,]+/,depreciateNumber(num.first())));}}
function depreciateNumber(num){if(num<2){return addCommas(num);}
num=parseInt(num.replace(/,/,'')*0.70,10);num=roundDown(num);return addCommas(num);}
function roundDown(num){if(num>100){var exp=parseInt(Math.log(num)/Math.log(10),10)-1;num=num-(num%Math.pow(10,exp));}
return num;}
function addCommas(num){var nStr=''+num;var rgx=/(\d+)(\d{3})/;while(rgx.test(nStr)){nStr=nStr.replace(rgx,'$1'+','+'$2');}
return nStr;}
Finch.Experiments.DepreciateFaultyCounter={variants:{control:function(){},depreciation:function(){$(".number, .status div").each(function(){replaceNumInElement($(this));});$('.cdn_cached #rail .integrated_side_deals, #number_sold_container').live('updated',function(){$(this).find('.number').each(function(){replaceNumInElement($(this));});});}}};})();Finch.Experiments.Relevance={variants:{Original:function(){if(App){App.ExperimentVersions.Relevance="Original";}},SearchService:function(){if(App){App.ExperimentVersions.Relevance="SearchService";}}}};Finch.Experiments.ShowLogin={variants:{Control:function(){},Visible:function(){$("#login_form").show();$("#login_banner").hide();}}};Finch.Experiments.ShowMoreNowDeals={variants:{Control:function(){if(App){App.ExperimentVersions.ShowMoreNowDeals='Control';}},Show20:function(){if(App){App.ExperimentVersions.ShowMoreNowDeals='Show20';}}}};Finch.Experiments.ShowBookOnlineText={variants:{Control:function(){},Display:function(){if(Groupon.currentDeal&&Groupon.currentDeal.bookable){if(Finch.Experiments.Global.guards.url_params_match({dl:'d47388'})){$('.bookable_section').show();}
else{$('#price_tag').addClass('bookable');$('#scheduler_tooltip').show();}}}}};Finch.Experiments.Occurrences={variants:{Occurrences:function(){if(App){App.ExperimentVersions.Occurrences='ShowOccurrences';}}}};Finch.Experiments.ReceiptPage={variants:{Original:function(){},ReceiptPage:function(){}}};Finch.Experiments.Bumpdown={variants:{Original:function(){},Bumpdown:function(){},BumpdownImages:function(){}},guards:{show_personalize_callout:function(){return false;},not_post_subscribe:function(){return false;},on_bumpdownable_page:function(){return false;}}};Finch.Experiments.NowRemoveMap={variants:{Original:function(){if(App){App.ExperimentVersions.NowRemoveMap=1;}},RemoveMap:function(){if(App){App.ExperimentVersions.NowRemoveMap=2;}}}};Finch.Experiments.NowRemoveMerchantWriteup={variants:{Original:function(){if(App){App.ExperimentVersions.NowRemoveMerchantWriteup=1;}},RemoveMerchantWriteup:function(){if(App){App.ExperimentVersions.NowRemoveMerchantWriteup=2;}}}};Finch.Experiments.NowAutoSearch={variants:{'Original':function(){},'AutoSearch':function(){}}};Finch.Experiments.LocationDetermination={variants:{Original:function(){},UsePlaces:function(){},UseRandomization:function(){},UsePlacesAndRandomization:function(){}}};Finch.Experiments.TrackingTest={variants:{variant_1:function(){},variant_2:function(){}}};Finch.Experiments.TrackingTestDeferred={defer:function(){var experiment=this;if(typeof Groupon.onCurrentUserReady!="undefined"){return Groupon.onCurrentUserReady(function(){return experiment.deferredRun(window);});}
return null;},variants:{variant_1:function(){},variant_2:function(){}}};Finch.Experiments.TrackingTestLearn={variants:{variant_1:function(){},variant_2:function(){}},guards:{on_learn_page:function(){return Finch.Experiments.Global.guards.path_matches([(/^.*\/learn\/?$/)]);}}};Finch.Experiments.ClarifyCopy={variants:{control:function(){},added_copy:function(){$(".skip_notification").show();}}};Finch.Experiments.CrossSellingDeals={variants:{control:function(){},variant:function(){}}};Finch.Experiments.Luckdragon={variants:{'Original':function(){},'Luckdragon':function(){}}};Finch.Experiments.NowRightRail2={variants:{'Show':function(){},'Hide':function(){}}};Finch.Experiments.NowSkipCategory={variants:{'Original':function(){},'SkipCategory':function(){}}};Finch.Experiments.DefaultTimeWindow={variants:{Control:function(){},DefaultToNow:function(){}}};Finch.Experiments.AdPlacement={variants:{Original:function(){if(App){App.ExperimentVersions.NowAdChiclets='Original';}},Top:function(){if(App){App.ExperimentVersions.NowAdChiclets='Top';}}}};Finch.Experiments.RedirectToAllDeals={runOnInit:true,variants:{Control:function(){},Redirect:function(){if(document.referrer.indexOf(window.location.host)===-1){window.location.pathname=window.location.pathname.replace(/\/$/,"")+"/all";}}},guards:{not_sem:function(){return location.search.indexOf('utm_')===-1;},on_division_page:function(){return Groupon.onDivisionPage;}}};Finch.Experiments.HelpfulTip={variants:{control:function(){Groupon.SupportTesting.control();},optional_answer:function(){Groupon.SupportTesting.optionalAnswer();},force_answer:function(){Groupon.SupportTesting.forceAnswer();}}};Finch.Experiments.GetawaysMultiOptionBuyButton={variants:{Original:function(){},NoArrow:function(){$("#content .multideal.buy_btn").removeClass("multideal");},Options:function(){var buyButton=$("#content .multideal.buy_btn");buyButton.text(I18n.translate("js.common.groupon_finch.buy_btn_experiment.options"));buyButton.addClass("options");}}};Finch.Experiments.Bloodhound={runOnInit:true,variants:{Control:function(){},Bloodhound:function(){Groupon.useBloodhound=true;}}};Finch.Experiments.TorbitMonitoring={runOnInit:true,variants:{Control:function(){},Torbit:function(){Groupon.torbitBeaconEnabled=true;}}};Finch.Experiments.SitcomMonitoring={runOnInit:true,variants:{Control:function(){},Sitcom:function(){Groupon.useSitcom=true;}}};Finch.Experiments.Clicktale={variants:{Control:function(){},Clicktale:function(){Groupon.clicktaleEnabled=true;}}};Finch.Experiments.HyperLocal={runOnInit:true,variants:{Control:function(){},HyperLocal:function(){if(location.pathname.indexOf('/local/subscriptions/new')<0){$('body').hide();var new_url=window.location.href.replace('/subscriptions/','/local/subscriptions/');window.location=new_url;}}}};Finch.Experiments.BestOfWidget={variants:{Control:function(){},BestOfWidget:function(){Groupon.shouldDisplayBestOfWidget=true;}}};Finch.Experiments.RedirectToLUP1={runOnInit:true,variants:{Control:function(){},RedirectControl:function(){var param;if(Cookie.get("lup1")!=="control"){Cookie.set("lup1","control",60*60*24*7);param=window.location.search+(window.location.search==''?'?':'&')+'lup=0';window.location.replace(param);}},LUP1:function(){var param;if(Cookie.get("lup1")!=="redirect"){Cookie.set("lup1","redirect",60*60*24*7);param=window.location.search+(window.location.search==''?'?':'&')+'lup=1';window.location.replace(param);}}}};Finch.Experiments.OccasionsModal={variants:{Original:function(){},Modal:function(){$(".subscribe_cta").hide();Groupon.OccasionsModal.init();}},guards:{on_occasions_gallery:function(){return Finch.Experiments.Global.guards.path_matches([(/\/occasions/)]);},occasions_modal_eligible:function(){return Groupon.OccasionsModal&&!Groupon.OccasionsModal.previouslyClosed()&&Groupon.OccasionsModal.fromPaidVisitor();}}};Finch.Experiments.ReorderSidebar={variants:{Original:function(){},Reordered:function(){var callout=$("li#channel_callout").remove();var sideDeals=$("li.integrated_side_deals").remove();var nowWidget=$("li#now_widget").remove();var clicky=$("li.clicky_badge").remove();var railList=$("#rail_list");railList.prepend(sideDeals).prepend(nowWidget).prepend(clicky).prepend(callout);}}};Finch.Experiments.NewModals={variants:{Original:function(){},Feedback:function(){subscription_center_key=$('#subscription_center_key').val();Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.load',{subscription_center_key:subscription_center_key});if($("body .surrogate_success").length>0){$("#alerts .success").hide();}
$('#finch_feedback').show();$('#finch_base').hide();$('#back_to_sub_center').click(function(e){$('#finch_base').show();$('#finch_feedback').hide();Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.reason',{subscription_center_key:subscription_center_key,feedback:'back_to_manage'});});$('#download_mobile_app').click(function(e){Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.reason',{subscription_center_key:subscription_center_key,feedback:'download_mobile_app'});});$('input.feedback').click(function(e){Groupon.Analytics.PixelTracker.injectTrackingPixel('unsubscribe.reason',{subscription_center_key:subscription_center_key,feedback:e.target.name});});}}};Finch.Experiments.DisableGetawaysStickyBar={variants:{Original:function(){},StickyBarDisabled:function(){$(function(){Groupon.Getaways.StickyBar.disable();});}}}
$(function(){(function replicateDaleNavExperiment(){if(Cookie.get("now_ui_v")=='navigation'){$("body").addClass('finch_init_nav_experiment_replica');var executeExperiment=function(){if(Finch.Experiments.DaleNavigation.guards.hasNavigationData()){Finch.Experiments.DaleNavigation.variants.Categorized();}
$("body").removeClass('finch_init_nav_experiment_replica');}
if(Groupon.cdnCacheable){Groupon.onCurrentUserReady(executeExperiment);}else{$("#navigation_items_json").bind("attributes:ready",executeExperiment);}}})();});$(document).bind('currentUserReady',function(){Sitcom.mark("currentUserReady");Sitcom.measure("personalization","_starttime","currentUserReady");});$(window).load(function(){Sitcom.done(Sitcom.sendBeacon);});var WRInitTime=(new Date()).getTime();