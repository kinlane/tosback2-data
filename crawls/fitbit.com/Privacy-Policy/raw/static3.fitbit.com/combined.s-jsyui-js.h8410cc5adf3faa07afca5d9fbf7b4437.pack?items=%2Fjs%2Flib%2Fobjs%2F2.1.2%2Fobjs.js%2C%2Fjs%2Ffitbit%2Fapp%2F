var Objs;new function(){Objs=function(m,l,r){var n,v,u,q,s,p,o,t;if(typeof m!=d){throw Error(e+m);}v=c+m;if(l==null){if(l===null){n=b[v];delete b[v];return n;}if(n=b[v]){return n;}throw Error(g+m);}if((q=typeof l)==d){u=b[c+l];o=1;}else{if(q=="function"){u=l;o=1;}else{s=l;}}if(o){if(!u){throw Error(j+l);}if(!(s=r)){throw Error(h+m);}}n=b[v]=function(){if(!n[f]){if(n.$superclass){n.$superclass[i]=1;n.$superclass.call(this);delete n.$superclass[i];}if(!n[i]&&n.prototype.initialize){n.prototype.initialize.apply(this,arguments);}}};n.$classpath=m;if(u){u[f]=1;n.prototype=new u();delete u[f];n.$superclass=u;n.$super=u.prototype;}t=n.prototype;for(p in s){if(s.hasOwnProperty(p)){t[p]=s[p];}}t.toString=s.toString;t.valueOf=s.valueOf;t.toLocaleString=s.toLocaleString;return n;};var d="string",c="$Objs$",i=c+"c",f=c+"e",a="non-existent",k="invalid",e=k+" classpath: ",g=a+" class: ",j=a+" superclass: ",h=k+" protobject for: ",b={};};
var fitbit=(function(a,b){a.modules=a.modules||{};if(b.isFunction(a.modules.dropdown)){return a;}a.modules.dropdown=Objs("fitbit.modules.dropdown",{initialize:function(c,d){if(!c||!c.length){return this._throwError("no catalyst specified");}this.catalyst=b(c).first();this.catalystActiveClass=null;this.anchorPoint="left below";this.elements={root:null,content:null};this.fadeEffectDuration=200;this.hideDelay=500;this.isManualShowEnabled=false;this.isMouseBoundaryDetectionEnabled=true;this.isMouseCursorInsideDropdown=false;this.namespace={css:"module-dd",event:"module-dropdown-"};this.positionOffset={x:0,y:0};this._initialize(d);},cancelHide:function(){if(this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null;}},clear:function(){b(this.elements.content).empty();},destroy:function(){this._fireCustomEvent("destroy");this.catalyst.off("."+this.namespace.event);for(var c in this.elements){b(c).remove();}this.catalyst.removeData("module-dropdown-id");delete this;},getCatalystPosition:function(){return this._getCatalystPosition();},getRootElement:function(){return(this.elements.root&&this.elements.root.length)?this.elements.root.get(0):null;},hide:function(){var c=b(this.elements.root);if(!c.is(":animated")){this._fireCustomEvent("beforeHide");this.catalyst.removeClass(this.catalystActiveClass);c.fadeOut(this.fadeEffectDuration,b.proxy(function(){this._fireCustomEvent("hide");},this));}},isVisible:function(){try{return this.elements.root.is(":visible");}catch(c){return false;}},render:function(c,d){if(c){if(!d){this.clear();}b(this.elements.content).append(c);this._fireCustomEvent("render");return true;}return false;},setPosition:function(){this._setPosition();},setPositionOffset:function(c,d){if(b.isNumeric(c)){this.positionOffset.x=c;}if(b.isNumeric(d)){this.positionOffset.y=d;}},show:function(){this.setPosition();this._fireCustomEvent("beforeShow");this.catalyst.addClass(this.catalystActiveClass);b(this.elements.root).fadeIn(this.fadeEffectDuration,b.proxy(function(){this._fireCustomEvent("show");},this));},subscribe:function(c,e,d){if(typeof c==="string"&&b.isFunction(e)){this.catalyst[(d===true)?"one":"on"](this._getEventName(c),e);return true;}return false;},toggle:function(){return this._toggle();},unsubscribe:function(c,d){if(typeof c==="string"){this.catalyst.off(this._getEventName(c),d);return true;}return false;},_applyConfiguration:function(d){if(b.isPlainObject(d)){var c=function(e){return(typeof e==="string"&&!(/^\s*$/).test(e));};if(c(d.anchorPoint)){this.anchorPoint=d.anchorPoint;}if(c(d.className)){this.customClassName=d.className;}if(c(d.catalystActiveClass)){this.catalystActiveClass=d.catalystActiveClass;}if(b.isNumeric(d.hideDelay)){this.hideDelay=d.hideDelay>0?d.hideDelay:0;}if(b.isNumeric(d.fadeEffectDuration)||d.fadeEffectDuration===false){this.fadeEffectDuration=d.fadeEffectDuration;}this.isMouseBoundaryDetectionEnabled=!(d.mouseBoundaryDetectionEnabled===false);this.isManualShowEnabled=(d.manualShowEnabled===true);}},_buildStructure:function(){var e=b.proxy(function(f){var g=this.namespace.css;if(typeof f==="string"){g+="-"+f.replace(/\s+/,"-");}return g;},this);var d=b("<div/>").addClass(e()).hide();if(this.customClassName){d.addClass(this.customClassName);}var c=b("<div/>").addClass(e("content")).appendTo(d);d.appendTo(document.body);b.extend(this.elements,{root:d,content:c});},_defineAnchorPointStrategies:function(){if(!this.anchorPointStrategies){this.anchorPointStrategies={"below":b.proxy(function(){var c=this._getCatalystPosition();return{"top":parseInt(this.positionOffset.y+c.y+c.h,10)+"px","bottom":"auto"};},this),"left":b.proxy(function(){var c=this._getCatalystPosition();return{"left":parseInt(this.positionOffset.x+c.x,10)+"px","right":"auto"};},this),"right":b.proxy(function(){var c=this._getCatalystPosition();return{"right":parseInt(b(window).width()-((0-this.positionOffset.x)+c.x+c.w),10)+"px","left":"auto"};},this)};}},_fireCustomEvent:function(c){this.catalyst.trigger(this._getEventName(c),this);},_getCatalystPosition:function(){var c=this.catalyst;var d=c.offset();return{x:Math.round(d.left),y:Math.round(d.top),w:Math.round(c.outerWidth()),h:Math.round(c.outerHeight())};},_getEventName:function(c){return(typeof c==="string"||b.isArray(c))?c+"."+this.namespace.event:null;},_getEventNames:function(c){if(c){if(typeof c==="string"){c=[c];}b.each(c,b.proxy(function(e,d){c[e]=this._getEventName(d);},this));}return(c&&c.length)?c:null;},_getPositionByAnchorPoint:function(){var d=this.anchorPoint.split(" ");if(d.length!==2){this._throwError("anchor point is invalid");}var c={};b.each(d,b.proxy(function(e,f){b.extend(c,this.anchorPointStrategies[f]());},this));if(b.isEmptyObject(c)){this._throwError("could not determine dropdown position from anchor point");}return c;},_getUniqueId:function(){if(!b.isNumeric(this.uniqueId)){if(!b.isNumeric(a.modules.dropdown.numInstances)){a.modules.dropdown.numInstances=0;}this.uniqueId=a.modules.dropdown.numInstances=a.modules.dropdown.numInstances+1;}return this.uniqueId;},_initialize:function(c){var d=this._getUniqueId();this.namespace.event+=d;this._applyConfiguration(c);this._buildStructure();b(this.catalyst).add(this.elements.root).data("module-dropdown-id",d);this._initializeCatalyst();this._initializeMouseBoundaryDetection();this._defineAnchorPointStrategies();b(window).on(this._getEventName("resize"),b.proxy(function(){if(this.isVisible()){this._fireCustomEvent("hideAfterResize");this.hide();}},this));b(document.body).on(this._getEventName("click"),b.proxy(function(f){var e=b(f.target);if(this.isVisible()&&!(e.closest([this.catalyst,"."+this.namespace.css]).length)){this.hide();}},this));this._fireCustomEvent("initialize");},_initializeCatalyst:function(){if(!this.isManualShowEnabled&&!this.isMouseDelayedShowEnabled){this.catalyst.on(this._getEventName("click"),b.proxy(function(c){if(c){c.preventDefault();}this._toggle();},this));}},_initializeMouseBoundaryDetection:function(){if(this.isMouseBoundaryDetectionEnabled){this.elements.root.on(this._getEventName("mouseenter"),b.proxy(function(){this._setMouseCursorInsideDropdown(true);},this)).on(this._getEventName("mouseleave"),b.proxy(function(){this._setMouseCursorInsideDropdown(false);if(!this.hideTimer&&this.isVisible()){this.hideTimer=setTimeout(b.proxy(function(){if(!this.isMouseCursorInsideDropdown){this.hide();}this.cancelHide();},this),this.hideDelay);}},this));}},_setMouseCursorInsideDropdown:function(c){if(c){this.isMouseCursorInsideDropdown=true;this._fireCustomEvent("mouseEnterDropdown");}else{this.isMouseCursorInsideDropdown=false;this._fireCustomEvent("mouseLeaveDropdown");}},_setPosition:function(){this.elements.root.css(this._getPositionByAnchorPoint());this._fireCustomEvent("position");},_throwError:function(c){console.log("fitbit.modules.dropdown : "+(c||"unknown error"));},_toggle:function(){if(this.isVisible()){this.hide();return false;}else{this.show();return true;}}});return a;}(fitbit||{},jQuery));
$(function(){var b=$(".wrapper-header").first();var l=b.find(".wrapper-nav");var e=b.hasClass("nav-app");l.on("click",".nav > li",function(n){if($(n.currentTarget).hasClass("nav-products")){n.preventDefault();}else{var m=$(this).find("a").first().attr("href");if(m){n.preventDefault();location.href=m;}}});var h=$(".wrapper-system-alerts");if(h.length){var g=".system-alert";var d=h.find(g);d.find(".exit").one("click",function(){var o=$(this).closest(g);var n=JSON.stringify({alertType:o.data("type"),deviceType:o.data("device")});var m={request:JSON.stringify({template:"user/dash/alertResponse.json.jsp",serviceCalls:[{name:"alert",method:"processAlert",args:{action:"CLOSE",alert:n}}]})};$.ajax({type:"post",url:"/ajaxapi",data:m,dataType:"json"});var p=(d.length>1)?"fadeOut":"slideUp";o[p](function(){var q=o.next(g);if(q.length){q.fadeIn(function(){o.remove();});}else{h.slideUp(function(){h.remove();setTimeout(function(){$("body").trigger("resetGlobalTimeSelector");},0);});}});});}var i=$.isFunction(fitbit.modules.dropdown)&&fitbit.modules.dropdown;if(i){var k="active";var f="subnav";if(e){f+=" subnav-app";}var a=l.find(".hasdropdown");a.each(function(r,n){var o=$(n);var q=null;var p=null;var t=null;var v=false;function m(){if(t){clearTimeout(t);t=null;}if(p){clearTimeout(p);p=null;}}function u(){v=false;m();if(q&&q.isVisible()){p=setTimeout(function(){if(!q.isMouseCursorInsideDropdown&&!v){q.hide();o.removeClass(k);}m();},200);}}function s(){v=true;m();if(q){q.cancelHide();if(!q.isVisible()){t=setTimeout(function(){q.show();m();},350);}}}o.one("mouseover",function(){q=new i(o,{className:f,catalystActiveClass:k,hideDelay:200,manualShowEnabled:true});q.render(o.find(".subnav-content").first());s();}).on("mouseenter",s).on("mouseleave",u);});var c=b.find(".account > .profile");if(c.length){var j=".productNavDevices";c.one("mouseover"+j+" mousedown"+j,function(n){c.off(j);if(typeof Handlebars!=="undefined"){var p=Handlebars.compile("device_{{type}}_{{name}}_");var m="com.fitbit.app.device.message.";var q=function(r){return fitbit.i18n.getResource(m+r);};var o=function(t,r){var s=p({type:t.toLowerCase(),name:r.toLowerCase()});return q(s+"displayName")||null;};$.getJSON("/internalapi/devices",function(u){var s=[];if(u.length){$.each(u,function(w,v){s.push({"className":"device-"+v.deviceVersion.toLowerCase(),"displayName":o(v.type,v.deviceVersion),"lastSyncRelative":fitbit.util.getRelativeDate(v.lastSyncTime,true),"lastSyncActual":v.lastSyncTime,"batteryLevel":v.battery?q("battery_"+v.battery.toLowerCase()):"","batteryClassName":v.battery?v.battery.toLowerCase():"","link":(v.deviceVersion===q("device_tracker_classic_name")?null:"/settings/device/"+v.type.toLowerCase())});});var t=$("#headerProfileSubNav").html();var r=Handlebars.compile(t)({devices:s});if(r){$("#profile-subnav").prepend(r);}}});}}).one("click",function(n){n.preventDefault();var m=new i(c,{anchorPoint:"below right",className:f+" subnav-profile",catalystActiveClass:k,mouseBoundaryDetectionEnabled:false});var o=$("#profile-subnav");m.render(o);m.subscribe("beforeShow",function(){o.find(".device .sync").each(function(p,q){$(q).text(fitbit.util.getRelativeDate($(q).attr("data-time"),true));});});m.subscribe("beforeShow",function(){var p=m.getRootElement();$(p).find(".link-dashboard").on("click",function(q){q.preventDefault();$.get("userSettings/dh/save?apiFormat=json&settings['show%20galileo%20dashboard']="+$(this).data("setting"),function(){window.location.reload();});});},true);m.show();});}}});
