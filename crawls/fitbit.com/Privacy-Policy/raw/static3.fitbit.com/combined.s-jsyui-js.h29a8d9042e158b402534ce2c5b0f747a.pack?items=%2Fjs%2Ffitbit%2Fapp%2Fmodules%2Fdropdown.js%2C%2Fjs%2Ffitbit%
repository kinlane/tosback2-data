(function(){var a=window.define||function(b){return b();};a(function(d){var c=(typeof d==="function");var f=c?d("jquery"):window.jQuery;if(!c){var e=window.fitbit||{};e.modules=e.modules||{};if(f.isFunction(e.modules.dropdown)){return e;}}var b=function(g,h){if(!g||!g.length){return this._throwError("no catalyst specified");}this.catalyst=f(g).first();this.catalystActiveClass=null;this.anchorPoint="left below";this.elements={root:null,content:null};this.fadeEffectDuration=200;this.hideDelay=500;this.isManualShowEnabled=false;this.isMouseBoundaryDetectionEnabled=true;this.isMouseCursorInsideDropdown=false;this.namespace={css:"module-dd",event:"module-dropdown-"};this.positionOffset={x:0,y:0};this._initialize(h);};b.prototype={cancelHide:function(){if(this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null;}},clear:function(){f(this.elements.content).empty();},destroy:function(){this._fireCustomEvent("destroy");this.catalyst.off("."+this.namespace.event);for(var g in this.elements){f(g).remove();}this.catalyst.removeData("module-dropdown-id");delete this;},getCatalystPosition:function(){return this._getCatalystPosition();},getRootElement:function(){return(this.elements.root&&this.elements.root.length)?this.elements.root.get(0):null;},hide:function(){var g=f(this.elements.root);if(!g.is(":animated")){this._fireCustomEvent("beforeHide");this.catalyst.removeClass(this.catalystActiveClass);g.fadeOut(this.fadeEffectDuration,f.proxy(function(){this._fireCustomEvent("hide");},this));}},isVisible:function(){try{return this.elements.root.is(":visible");}catch(g){return false;}},render:function(g,h){if(g){if(!h){this.clear();}f(this.elements.content).append(g);this._fireCustomEvent("render");return true;}return false;},setPosition:function(){this._setPosition();},setPositionOffset:function(g,h){if(f.isNumeric(g)){this.positionOffset.x=g;}if(f.isNumeric(h)){this.positionOffset.y=h;}},show:function(){this.setPosition();this._fireCustomEvent("beforeShow");this.catalyst.addClass(this.catalystActiveClass);f(this.elements.root).fadeIn(this.fadeEffectDuration,f.proxy(function(){this._fireCustomEvent("show");},this));},subscribe:function(g,i,h){if(typeof g==="string"&&f.isFunction(i)){this.catalyst[(h===true)?"one":"on"](this._getEventName(g),i);return true;}return false;},toggle:function(){return this._toggle();},unsubscribe:function(g,h){if(typeof g==="string"){this.catalyst.off(this._getEventName(g),h);return true;}return false;},_applyConfiguration:function(h){if(f.isPlainObject(h)){var g=function(i){return(typeof i==="string"&&!(/^\s*$/).test(i));};if(g(h.anchorPoint)){this.anchorPoint=h.anchorPoint;}if(g(h.className)){this.customClassName=h.className;}if(g(h.catalystActiveClass)){this.catalystActiveClass=h.catalystActiveClass;}if(f.isNumeric(h.hideDelay)){this.hideDelay=h.hideDelay>0?h.hideDelay:0;}if(f.isNumeric(h.fadeEffectDuration)||h.fadeEffectDuration===false){this.fadeEffectDuration=h.fadeEffectDuration;}this.isMouseBoundaryDetectionEnabled=!(h.mouseBoundaryDetectionEnabled===false);this.isManualShowEnabled=(h.manualShowEnabled===true);}},_buildStructure:function(){var i=f.proxy(function(j){var k=this.namespace.css;if(typeof j==="string"){k+="-"+j.replace(/\s+/,"-");}return k;},this);var h=f("<div/>").addClass(i()).hide();if(this.customClassName){h.addClass(this.customClassName);}var g=f("<div/>").addClass(i("content")).appendTo(h);h.appendTo(document.body);f.extend(this.elements,{root:h,content:g});},_defineAnchorPointStrategies:function(){if(!this.anchorPointStrategies){this.anchorPointStrategies={"below":f.proxy(function(){var g=this._getCatalystPosition();return{"top":parseInt(this.positionOffset.y+g.y+g.h,10)+"px","bottom":"auto"};},this),"left":f.proxy(function(){var g=this._getCatalystPosition();return{"left":parseInt(this.positionOffset.x+g.x,10)+"px","right":"auto"};},this),"right":f.proxy(function(){var g=this._getCatalystPosition();return{"right":parseInt(f(window).width()-((0-this.positionOffset.x)+g.x+g.w),10)+"px","left":"auto"};},this)};}},_fireCustomEvent:function(g){this.catalyst.trigger(this._getEventName(g),this);},_getCatalystPosition:function(){var g=this.catalyst;var h=g.offset();return{x:Math.round(h.left),y:Math.round(h.top),w:Math.round(g.outerWidth(false)),h:Math.round(g.outerHeight(false))};},_getEventName:function(g){return(typeof g==="string"||f.isArray(g))?g+"."+this.namespace.event:null;},_getEventNames:function(g){if(g){if(typeof g==="string"){g=[g];}f.each(g,f.proxy(function(i,h){g[i]=this._getEventName(h);},this));}return(g&&g.length)?g:null;},_getPositionByAnchorPoint:function(){var h=this.anchorPoint.split(" ");if(h.length!==2){this._throwError("anchor point is invalid");}var g={};f.each(h,f.proxy(function(i,j){f.extend(g,this.anchorPointStrategies[j]());},this));if(f.isEmptyObject(g)){this._throwError("could not determine dropdown position from anchor point");}return g;},_getUniqueId:function(){if(!f.isNumeric(this.uniqueId)){this.uniqueId=parseInt(Math.random().toString().replace(".",""),10);}return this.uniqueId;},_initialize:function(g){var h=this._getUniqueId();this.namespace.event+=h;this._applyConfiguration(g);this._buildStructure();f(this.catalyst).add(this.elements.root).data("module-dropdown-id",h);this._initializeCatalyst();this._initializeMouseBoundaryDetection();this._defineAnchorPointStrategies();f(window).on(this._getEventName("resize"),f.proxy(function(){if(this.isVisible()){this._fireCustomEvent("hideAfterResize");this.hide();}},this));f(document.body).on(this._getEventName("click"),f.proxy(function(j){var i=f(j.target);if(this.isVisible()&&!(i.closest(this.catalyst).length||i.closest("."+this.namespace.css).length)){this.hide();}},this));this._fireCustomEvent("initialize");},_initializeCatalyst:function(){if(!this.isManualShowEnabled&&!this.isMouseDelayedShowEnabled){this.catalyst.on(this._getEventName("click"),f.proxy(function(g){if(g){g.preventDefault();}this._toggle();},this));}},_initializeMouseBoundaryDetection:function(){if(this.isMouseBoundaryDetectionEnabled){this.elements.root.on(this._getEventName("mouseenter"),f.proxy(function(){this._setMouseCursorInsideDropdown(true);},this)).on(this._getEventName("mouseleave"),f.proxy(function(){this._setMouseCursorInsideDropdown(false);if(!this.hideTimer&&this.isVisible()){this.hideTimer=setTimeout(f.proxy(function(){if(!this.isMouseCursorInsideDropdown){this.hide();}this.cancelHide();},this),this.hideDelay);}},this));}},_setMouseCursorInsideDropdown:function(g){if(g){this.isMouseCursorInsideDropdown=true;this._fireCustomEvent("mouseEnterDropdown");}else{this.isMouseCursorInsideDropdown=false;this._fireCustomEvent("mouseLeaveDropdown");}},_setPosition:function(){this.elements.root.css(this._getPositionByAnchorPoint());this._fireCustomEvent("position");},_throwError:function(g){console.log("Fitbit Dropdown Widget : "+(g||"unknown error"));},_toggle:function(){if(this.isVisible()){this.hide();return false;}else{this.show();return true;}}};if(c){return b;}else{e.modules.dropdown=b;return e;}});}());
(function(){var a=window.define||function(b){return b();};a(function(g){var k=(typeof g==="function");var r=document.getElementById("requirejs");if(k){var c=g("jquery");var e=g("handlebars");var o=g("fitbit-widget-dropdown");g("fitbit-header-notificationDropdown");}else{var c=window.jQuery;var e=window.Handlebars;var o=c.isFunction(fitbit.modules.dropdown)&&fitbit.modules.dropdown;}if(k&&!r){var q=g("galileo/util/date").getRelativeDate;var u=g("messages-deviceNames");var n=g("messages-batteryLevels");var m="???";var j=function(w,v){return(u[w]&&u[w][v])?u[w][v]:m;};var f=function(v){return n[v]?n[v]:m;};}else{var q=fitbit.util.getRelativeDate;var t="com.fitbit.app.device.message.";var j=function(w,v){return fitbit.i18n.getResource(t+"device_"+v+"_"+w);};var f=function(v){return fitbit.i18n.getResource(t+"battery_"+v);};}var b=function(){var v=window.mixpanel;return v.master?v.master:window.mixpanel;};var p=c(".wrapper-header").first();if(p.data("fitbitHeaderInitialized")){return;}p.data("fitbitHeaderInitialized",true);var h=p.find(".wrapper-nav");var d=p.hasClass("nav-app");var s="active";var i="subnav";if(d){i+=" subnav-app";}h.on("click",".nav > li",function(w){if(c(w.currentTarget).hasClass("nav-products")){w.preventDefault();}else{var v=c(this).find("a").first().attr("href");if(v){w.preventDefault();location.href=v;}}});l();c(function(){var x=c(".wrapper-system-alerts");if(x.length){var A=".system-alert";var v=x.find(A);v.find(".exit").one("click",function(){var G=c(this).closest(A);var D={alertType:G.data("type"),deviceType:G.data("device")};var E=G.data("cw-program");if(E!=null){D.attributes={CORPORATE_PROGRAM_ID:E};}var F=JSON.stringify(D);var C={request:JSON.stringify({template:"user/dash/alertResponse.json.jsp",serviceCalls:[{name:"alert",method:"processAlert",args:{action:"CLOSE",alert:F}}]})};c.ajax({type:"post",url:"/ajaxapi",data:C,dataType:"json"});G.trigger("destroy.systemAlert");var H=(v.length>1)?"fadeOut":"slideUp";G[H](function(){var I=G.next(A);if(I.length){I.fadeIn(function(){G.remove();w(I);I.trigger("impression.systemAlert");});}else{x.slideUp(function(){x.remove();setTimeout(function(){c("body").trigger("resetGlobalTimeSelector");},0);});}});});if(v.is(".newDashInvite")){b().track("Dash: Preview Promo");}var w=function(E){if(!E){return;}var C=E.first().data("cookie");if(C&&!(/^\s*$/).test(C)){var D=new Date();D.setTime(D.getTime()+2629743830);document.cookie="system_alert"+"="+C+"; expires="+D.toGMTString()+"; path=/;";}};var z=v.first();w(z);var B=function(D){if(typeof D!=="string"){return;}var C=["_trackEvent","GlobalAlertProductReview-"+D];if(arguments.length>1){C=C.concat(Array.prototype.slice.call(arguments,1));}try{fitbit.util.deferredTrack(C);}catch(E){if(console){console.log("header.js: 'fitbit.util.deferredTrack' is not available");}}};v.filter(".amazon-review").one("impression.systemAlert",function(){B(c(this).data("device"),"Display","Show");}).one("click",".message a",function(C){B(c(C.delegateTarget).data("device"),"Click","LinkToAmazon");}).one("destroy.systemAlert",function(C){B(c(C.target).data("device"),"Click","CloseForever");});if(z.hasClass("amazon-review")){z.trigger("impression.systemAlert");}}if(o){var y=h.find(".hasdropdown");y.each(function(H,D){var E=c(D);var G=null;var F=null;var J=null;var L=false;function C(){if(J){clearTimeout(J);J=null;}if(F){clearTimeout(F);F=null;}}function K(){L=false;C();if(G&&G.isVisible()){F=setTimeout(function(){if(!G.isMouseCursorInsideDropdown&&!L){G.hide();E.removeClass(s);}C();},200);}}function I(){L=true;C();if(G){G.cancelHide();if(!G.isVisible()){J=setTimeout(function(){G.show();C();},350);}}}E.one("mouseover",function(){G=new o(E,{className:i,catalystActiveClass:s,hideDelay:200,manualShowEnabled:true});G.render(E.find(".subnav-content").first());I();}).on("mouseenter",I).on("mouseleave",K);});}});function l(){var w=p.find(".account > .nav-item-settings");if(w.length&&o){var y=".accountSettingsDropdown";var v=function(B){var A,z;return function(){if(A){return z;}A=true;z=B.apply(this,arguments);B=null;return z;};};var x=function(z,B){var C,A=v(B);C=setTimeout(A,300);b().track("Dash: Profile Menu Clicked",{"!CLICKED":z.data("mp-type")},function(){clearTimeout(C);A();});};w.one("mouseover"+y+" mousedown"+y,function(z){w.off(y).addClass("hasdropdown");if(typeof e!=="undefined"){c.post("/ajaxapi",{request:JSON.stringify({serviceCalls:[{name:"trackerSettings",method:"getAlarms"},{name:"device",method:"getOwnerDevices"}],template:"common/defaultResponse.json.jsp"})},function(B){var C=B[0];var F=B[1];var D=[];if(F.length){c.each(F,function(G,I){var H={className:"device-"+I.productName.toLowerCase(),displayName:j(I.type,"displayName"),lastSyncActual:I.lastSyncTime,batteryLevel:I.battery?f(I.battery.toLowerCase()):"",batteryClassName:I.battery?I.battery.toLowerCase():"",link:I.settingsUrl};if(I.lastSyncTime>0){H["lastSyncRelative"]=q(I.lastSyncTime);}var J;c.each(C,function(K,L){if(L.trackerId===I.id&&L.enabled&&L.nextAlarmTimeUTC){if(!J){J=L;}else{if(L.nextAlarmTimeUTC<J.nextAlarmTimeUTC){J=L;}}}});if(J){H["nextAlarmTime"]=J.nextAlarmLocalDay+" "+J.localTime;H["link"]="/settings/alarms/";}D.push(H);});var E=c("#header-settings-subnav-devices").html();var A=e.compile(E)({devices:D});if(A){c("#header-settings-subnav").prepend(A);}}},"json");}}).one("click",function(A){A.preventDefault();var z=new o(w,{anchorPoint:"below right",className:i+" subnav-settings",catalystActiveClass:s,mouseBoundaryDetectionEnabled:false});var B=c("#header-settings-subnav");z.render(B);z.subscribe("beforeShow",function(){var C=function(D){D!=null&&(location.href=D);};B.find(".device .sync").each(function(E,F){var D=parseInt(c(F).attr("data-time"));if(D>0){c(F).text(q(D));}});B.find("[data-mp-type]:not(.link-dashboard)").on("click",function(E){E.preventDefault();var D=c(this);x(D,C.bind(null,D.attr("href")));});});z.subscribe("beforeShow",function(){var D=function(E){E!=null&&c.get("/userSettings/dh/save?apiFormat=json&settings['show%20galileo%20dashboard']="+E,function(){window.location="/";});};var C=z.getRootElement();c(C).find(".link-dashboard").on("click",function(F){F.preventDefault();var E=c(this);x(E,D.bind(null,E.data("setting")));});},true);z.setPositionOffset(-59,0);z.show();b().track("Dash: View Profile Menu");});}}});}());
