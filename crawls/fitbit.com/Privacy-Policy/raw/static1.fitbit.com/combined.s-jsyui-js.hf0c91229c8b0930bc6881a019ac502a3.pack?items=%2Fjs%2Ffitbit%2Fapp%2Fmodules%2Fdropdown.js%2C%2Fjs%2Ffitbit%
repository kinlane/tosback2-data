!(function UMD(a,c,b){if(typeof define==="function"&&define.amd){define(b);}else{c[a]=b();}}).call(this,"fitbit",this,function AMD(c){var b=(typeof c==="function");var e=b?c("jquery"):window.jQuery;if(!b){var d=window.fitbit||{};d.modules=d.modules||{};if(e.isFunction(d.modules.dropdown)){return d;}}var a=function(f,g){if(!f||!f.length){return this._throwError("no catalyst specified");}this.catalyst=e(f).first();this.catalystActiveClass=null;this.anchorPoint="left below";this.elements={root:null,content:null};this.fadeEffectDuration=200;this.hideDelay=500;this.isManualShowEnabled=false;this.isMouseBoundaryDetectionEnabled=true;this.isMouseCursorInsideDropdown=false;this.namespace={css:"module-dd",event:"module-dropdown-"};this.positionOffset={x:0,y:0};this._initialize(g);};a.prototype={cancelHide:function(){if(this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null;}},clear:function(){e(this.elements.content).empty();},destroy:function(){this._fireCustomEvent("destroy");this.catalyst.off("."+this.namespace.event);for(var f in this.elements){e(f).remove();}this.catalyst.removeData("module-dropdown-id");delete this;},getCatalystPosition:function(){return this._getCatalystPosition();},getRootElement:function(){return(this.elements.root&&this.elements.root.length)?this.elements.root.get(0):null;},hide:function(){var f=e(this.elements.root);if(!f.is(":animated")){this._fireCustomEvent("beforeHide");this.catalyst.removeClass(this.catalystActiveClass);f.fadeOut(this.fadeEffectDuration,e.proxy(function(){this._fireCustomEvent("hide");},this));}},isVisible:function(){try{return this.elements.root.is(":visible");}catch(f){return false;}},render:function(f,g){if(f){if(!g){this.clear();}e(this.elements.content).append(f);this._fireCustomEvent("render");return true;}return false;},setPosition:function(){this._setPosition();},setPositionOffset:function(f,g){if(e.isNumeric(f)){this.positionOffset.x=f;}if(e.isNumeric(g)){this.positionOffset.y=g;}},show:function(){this.setPosition();this._fireCustomEvent("beforeShow");this.catalyst.addClass(this.catalystActiveClass);e(this.elements.root).fadeIn(this.fadeEffectDuration,e.proxy(function(){this._fireCustomEvent("show");},this));},subscribe:function(f,h,g){if(typeof f==="string"&&e.isFunction(h)){this.catalyst[(g===true)?"one":"on"](this._getEventName(f),h);return true;}return false;},toggle:function(){return this._toggle();},unsubscribe:function(f,g){if(typeof f==="string"){this.catalyst.off(this._getEventName(f),g);return true;}return false;},_applyConfiguration:function(g){if(e.isPlainObject(g)){var f=function(h){return(typeof h==="string"&&!(/^\s*$/).test(h));};if(f(g.anchorPoint)){this.anchorPoint=g.anchorPoint;}if(f(g.className)){this.customClassName=g.className;}if(f(g.catalystActiveClass)){this.catalystActiveClass=g.catalystActiveClass;}if(e.isNumeric(g.hideDelay)){this.hideDelay=g.hideDelay>0?g.hideDelay:0;}if(e.isNumeric(g.fadeEffectDuration)||g.fadeEffectDuration===false){this.fadeEffectDuration=g.fadeEffectDuration;}this.isMouseBoundaryDetectionEnabled=!(g.mouseBoundaryDetectionEnabled===false);this.isManualShowEnabled=(g.manualShowEnabled===true);}},_buildStructure:function(){var h=e.proxy(function(i){var j=this.namespace.css;if(typeof i==="string"){j+="-"+i.replace(/\s+/,"-");}return j;},this);var g=e("<div/>").addClass(h()).hide();if(this.customClassName){g.addClass(this.customClassName);}var f=e("<div/>").addClass(h("content")).appendTo(g);g.appendTo(document.body);e.extend(this.elements,{root:g,content:f});},_defineAnchorPointStrategies:function(){if(!this.anchorPointStrategies){this.anchorPointStrategies={"below":e.proxy(function(){var f=this._getCatalystPosition();return{"top":parseInt(this.positionOffset.y+f.y+f.h,10)+"px","bottom":"auto"};},this),"left":e.proxy(function(){var f=this._getCatalystPosition();return{"left":parseInt(this.positionOffset.x+f.x,10)+"px","right":"auto"};},this),"right":e.proxy(function(){var f=this._getCatalystPosition();return{"right":parseInt(e(window).width()-((0-this.positionOffset.x)+f.x+f.w),10)+"px","left":"auto"};},this)};}},_fireCustomEvent:function(f){this.catalyst.trigger(this._getEventName(f),this);},_getCatalystPosition:function(){var f=this.catalyst;var g=f.offset();return{x:Math.round(g.left),y:Math.round(g.top),w:Math.round(f.outerWidth()),h:Math.round(f.outerHeight())};},_getEventName:function(f){return(typeof f==="string"||e.isArray(f))?f+"."+this.namespace.event:null;},_getEventNames:function(f){if(f){if(typeof f==="string"){f=[f];}e.each(f,e.proxy(function(h,g){f[h]=this._getEventName(g);},this));}return(f&&f.length)?f:null;},_getPositionByAnchorPoint:function(){var g=this.anchorPoint.split(" ");if(g.length!==2){this._throwError("anchor point is invalid");}var f={};e.each(g,e.proxy(function(h,i){e.extend(f,this.anchorPointStrategies[i]());},this));if(e.isEmptyObject(f)){this._throwError("could not determine dropdown position from anchor point");}return f;},_getUniqueId:function(){if(!e.isNumeric(this.uniqueId)){this.uniqueId=parseInt(Math.random().toString().replace(".",""),10);}return this.uniqueId;},_initialize:function(f){var g=this._getUniqueId();this.namespace.event+=g;this._applyConfiguration(f);this._buildStructure();e(this.catalyst).add(this.elements.root).data("module-dropdown-id",g);this._initializeCatalyst();this._initializeMouseBoundaryDetection();this._defineAnchorPointStrategies();e(window).on(this._getEventName("resize"),e.proxy(function(){if(this.isVisible()){this._fireCustomEvent("hideAfterResize");this.hide();}},this));e(document.body).on(this._getEventName("click"),e.proxy(function(i){var h=e(i.target);if(this.isVisible()&&!(h.closest(this.catalyst).length||h.closest("."+this.namespace.css).length)){this.hide();}},this));this._fireCustomEvent("initialize");},_initializeCatalyst:function(){if(!this.isManualShowEnabled&&!this.isMouseDelayedShowEnabled){this.catalyst.on(this._getEventName("click"),e.proxy(function(f){if(f){f.preventDefault();}this._toggle();},this));}},_initializeMouseBoundaryDetection:function(){if(this.isMouseBoundaryDetectionEnabled){this.elements.root.on(this._getEventName("mouseenter"),e.proxy(function(){this._setMouseCursorInsideDropdown(true);},this)).on(this._getEventName("mouseleave"),e.proxy(function(){this._setMouseCursorInsideDropdown(false);if(!this.hideTimer&&this.isVisible()){this.hideTimer=setTimeout(e.proxy(function(){if(!this.isMouseCursorInsideDropdown){this.hide();}this.cancelHide();},this),this.hideDelay);}},this));}},_setMouseCursorInsideDropdown:function(f){if(f){this.isMouseCursorInsideDropdown=true;this._fireCustomEvent("mouseEnterDropdown");}else{this.isMouseCursorInsideDropdown=false;this._fireCustomEvent("mouseLeaveDropdown");}},_setPosition:function(){this.elements.root.css(this._getPositionByAnchorPoint());this._fireCustomEvent("position");},_throwError:function(f){console.log("fitbit.modules.dropdown : "+(f||"unknown error"));},_toggle:function(){if(this.isVisible()){this.hide();return false;}else{this.show();return true;}}};if(b){return a;}else{d.modules.dropdown=a;return d;}});
!(function UMD(a,c,b){if(typeof define==="function"&&define.amd){define(b);}else{c[a]=b();}}).call(this,"devnull",this,function AMD(f){var j=(typeof f==="function");var p=document.getElementById("requirejs");if(j){var b=f("jquery");var d=f("handlebars");var m=f("fitbit-widget-dropdown");f("fitbit-header-notificationDropdown");}else{var b=window.jQuery;var d=window.Handlebars;var m=b.isFunction(fitbit.modules.dropdown)&&fitbit.modules.dropdown;}if(j&&!p){var o=f("galileo/util/date").getRelativeDate;var s=f("messages-deviceNames");var l=f("messages-batteryLevels");var k="???";var i=function(u,t){return(s[u]&&s[u][t])?s[u][t]:k;};var e=function(t){return l[t]?l[t]:k;};}else{var o=fitbit.util.getRelativeDate;var r="com.fitbit.app.device.message.";var i=function(u,t){return fitbit.i18n.getResource(r+"device_"+t+"_"+u);};var e=function(t){return fitbit.i18n.getResource(r+"battery_"+t);};}var n=b(".wrapper-header").first();if(n.data("fitbitHeaderInitialized")){return;}n.data("fitbitHeaderInitialized",true);var g=n.find(".wrapper-nav");var c=n.hasClass("nav-app");var q="active";var h="subnav";if(c){h+=" subnav-app";}g.on("click",".nav > li",function(u){if(b(u.currentTarget).hasClass("nav-products")){u.preventDefault();}else{var t=b(this).find("a").first().attr("href");if(t){u.preventDefault();location.href=t;}}});a();b(function(){var v=b(".wrapper-system-alerts");if(v.length){var y=".system-alert";var t=v.find(y);t.find(".exit").one("click",function(){var E=b(this).closest(y);var B={alertType:E.data("type"),deviceType:E.data("device")};var C=E.data("cw-program");if(C!=null){B.attributes={CORPORATE_PROGRAM_ID:C};}var D=JSON.stringify(B);var A={request:JSON.stringify({template:"user/dash/alertResponse.json.jsp",serviceCalls:[{name:"alert",method:"processAlert",args:{action:"CLOSE",alert:D}}]})};b.ajax({type:"post",url:"/ajaxapi",data:A,dataType:"json"});E.trigger("destroy.systemAlert");var F=(t.length>1)?"fadeOut":"slideUp";E[F](function(){var G=E.next(y);if(G.length){G.fadeIn(function(){E.remove();u(G);G.trigger("impression.systemAlert");});}else{v.slideUp(function(){v.remove();setTimeout(function(){b("body").trigger("resetGlobalTimeSelector");},0);});}});});var u=function(C){if(!C){return;}var A=C.first().data("cookie");if(A&&!(/^\s*$/).test(A)){var B=new Date();B.setTime(B.getTime()+2629743830);document.cookie="system_alert"+"="+A+"; expires="+B.toGMTString()+"; path=/;";}};var x=t.first();u(x);var z=function(B){if(typeof B!=="string"){return;}var A=["_trackEvent","GlobalAlertProductReview-"+B];if(arguments.length>1){A=A.concat(Array.prototype.slice.call(arguments,1));}try{fitbit.util.deferredTrack(A);}catch(C){if(console){console.log("header.js: 'fitbit.util.deferredTrack' is not available");}}};t.filter(".amazon-review").one("impression.systemAlert",function(){z(b(this).data("device"),"Display","Show");}).one("click",".message a",function(A){z(b(A.delegateTarget).data("device"),"Click","LinkToAmazon");}).one("destroy.systemAlert",function(A){z(b(A.target).data("device"),"Click","CloseForever");});if(x.hasClass("amazon-review")){x.trigger("impression.systemAlert");}}if(m){var w=g.find(".hasdropdown");w.each(function(F,B){var C=b(B);var E=null;var D=null;var H=null;var J=false;function A(){if(H){clearTimeout(H);H=null;}if(D){clearTimeout(D);D=null;}}function I(){J=false;A();if(E&&E.isVisible()){D=setTimeout(function(){if(!E.isMouseCursorInsideDropdown&&!J){E.hide();C.removeClass(q);}A();},200);}}function G(){J=true;A();if(E){E.cancelHide();if(!E.isVisible()){H=setTimeout(function(){E.show();A();},350);}}}C.one("mouseover",function(){E=new m(C,{className:h,catalystActiveClass:q,hideDelay:200,manualShowEnabled:true});E.render(C.find(".subnav-content").first());G();}).on("mouseenter",G).on("mouseleave",I);});}});function a(){var t=n.find(".account > .profile");if(t.length&&m){var u=".productNavDevices";t.one("mouseover"+u+" mousedown"+u,function(v){t.off(u);if(typeof d!=="undefined"){b.post("/ajaxapi",{request:JSON.stringify({serviceCalls:[{name:"trackerSettings",method:"getAlarms"},{name:"device",method:"getOwnerDevices"}],template:"common/defaultResponse.json.jsp"})},function(x){var y=x[0];var B=x[1];var z=[];if(B.length){b.each(B,function(C,E){var D={className:"device-"+E.productName.toLowerCase(),displayName:i(E.type,"displayName"),lastSyncActual:E.lastSyncTime,batteryLevel:E.battery?e(E.battery.toLowerCase()):"",batteryClassName:E.battery?E.battery.toLowerCase():"",link:E.settingsUrl};if(E.lastSyncTime>0){D["lastSyncRelative"]=o(E.lastSyncTime);}var F;b.each(y,function(G,H){if(H.trackerId===E.id&&H.enabled&&H.nextAlarmTimeUTC){if(!F){F=H;}else{if(H.nextAlarmTimeUTC<F.nextAlarmTimeUTC){F=H;}}}});if(F){D["nextAlarmTime"]=F.nextAlarmLocalDay+" "+F.localTime;D["link"]="/settings/alarms/";}z.push(D);});var A=b("#headerProfileSubNav").html();var w=d.compile(A)({devices:z});if(w){b("#profile-subnav").prepend(w);}}},"json");}}).one("click",function(w){w.preventDefault();var v=new m(t,{anchorPoint:"below right",className:h+" subnav-profile",catalystActiveClass:q,mouseBoundaryDetectionEnabled:false});var x=b("#profile-subnav");v.render(x);v.subscribe("beforeShow",function(){x.find(".device .sync").each(function(z,A){var y=parseInt(b(A).attr("data-time"));if(y>0){b(A).text(o(y));}});});v.subscribe("beforeShow",function(){var y=v.getRootElement();b(y).find(".link-dashboard").on("click",function(z){z.preventDefault();b.get("/userSettings/dh/save?apiFormat=json&settings['show%20galileo%20dashboard']="+b(this).data("setting"),function(){window.location="/";});});},true);v.show();});}}});
