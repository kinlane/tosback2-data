!(function UMD(a,c,b){if(typeof define==="function"&&define.amd){define(b);}else{c[a]=b();}}).call(this,"fitbit",this,function AMD(c){var b=(typeof c==="function");var e=b?c("jquery"):window.jQuery;if(!b){var d=window.fitbit||{};d.modules=d.modules||{};if(e.isFunction(d.modules.dropdown)){return d;}}var a=function(f,g){if(!f||!f.length){return this._throwError("no catalyst specified");}this.catalyst=e(f).first();this.catalystActiveClass=null;this.anchorPoint="left below";this.elements={root:null,content:null};this.fadeEffectDuration=200;this.hideDelay=500;this.isManualShowEnabled=false;this.isMouseBoundaryDetectionEnabled=true;this.isMouseCursorInsideDropdown=false;this.namespace={css:"module-dd",event:"module-dropdown-"};this.positionOffset={x:0,y:0};this._initialize(g);};a.prototype={cancelHide:function(){if(this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null;}},clear:function(){e(this.elements.content).empty();},destroy:function(){this._fireCustomEvent("destroy");this.catalyst.off("."+this.namespace.event);for(var f in this.elements){e(f).remove();}this.catalyst.removeData("module-dropdown-id");delete this;},getCatalystPosition:function(){return this._getCatalystPosition();},getRootElement:function(){return(this.elements.root&&this.elements.root.length)?this.elements.root.get(0):null;},hide:function(){var f=e(this.elements.root);if(!f.is(":animated")){this._fireCustomEvent("beforeHide");this.catalyst.removeClass(this.catalystActiveClass);f.fadeOut(this.fadeEffectDuration,e.proxy(function(){this._fireCustomEvent("hide");},this));}},isVisible:function(){try{return this.elements.root.is(":visible");}catch(f){return false;}},render:function(f,g){if(f){if(!g){this.clear();}e(this.elements.content).append(f);this._fireCustomEvent("render");return true;}return false;},setPosition:function(){this._setPosition();},setPositionOffset:function(f,g){if(e.isNumeric(f)){this.positionOffset.x=f;}if(e.isNumeric(g)){this.positionOffset.y=g;}},show:function(){this.setPosition();this._fireCustomEvent("beforeShow");this.catalyst.addClass(this.catalystActiveClass);e(this.elements.root).fadeIn(this.fadeEffectDuration,e.proxy(function(){this._fireCustomEvent("show");},this));},subscribe:function(f,h,g){if(typeof f==="string"&&e.isFunction(h)){this.catalyst[(g===true)?"one":"on"](this._getEventName(f),h);return true;}return false;},toggle:function(){return this._toggle();},unsubscribe:function(f,g){if(typeof f==="string"){this.catalyst.off(this._getEventName(f),g);return true;}return false;},_applyConfiguration:function(g){if(e.isPlainObject(g)){var f=function(h){return(typeof h==="string"&&!(/^\s*$/).test(h));};if(f(g.anchorPoint)){this.anchorPoint=g.anchorPoint;}if(f(g.className)){this.customClassName=g.className;}if(f(g.catalystActiveClass)){this.catalystActiveClass=g.catalystActiveClass;}if(e.isNumeric(g.hideDelay)){this.hideDelay=g.hideDelay>0?g.hideDelay:0;}if(e.isNumeric(g.fadeEffectDuration)||g.fadeEffectDuration===false){this.fadeEffectDuration=g.fadeEffectDuration;}this.isMouseBoundaryDetectionEnabled=!(g.mouseBoundaryDetectionEnabled===false);this.isManualShowEnabled=(g.manualShowEnabled===true);}},_buildStructure:function(){var h=e.proxy(function(i){var j=this.namespace.css;if(typeof i==="string"){j+="-"+i.replace(/\s+/,"-");}return j;},this);var g=e("<div/>").addClass(h()).hide();if(this.customClassName){g.addClass(this.customClassName);}var f=e("<div/>").addClass(h("content")).appendTo(g);g.appendTo(document.body);e.extend(this.elements,{root:g,content:f});},_defineAnchorPointStrategies:function(){if(!this.anchorPointStrategies){this.anchorPointStrategies={"below":e.proxy(function(){var f=this._getCatalystPosition();return{"top":parseInt(this.positionOffset.y+f.y+f.h,10)+"px","bottom":"auto"};},this),"left":e.proxy(function(){var f=this._getCatalystPosition();return{"left":parseInt(this.positionOffset.x+f.x,10)+"px","right":"auto"};},this),"right":e.proxy(function(){var f=this._getCatalystPosition();return{"right":parseInt(e(window).width()-((0-this.positionOffset.x)+f.x+f.w),10)+"px","left":"auto"};},this)};}},_fireCustomEvent:function(f){this.catalyst.trigger(this._getEventName(f),this);},_getCatalystPosition:function(){var f=this.catalyst;var g=f.offset();return{x:Math.round(g.left),y:Math.round(g.top),w:Math.round(f.outerWidth()),h:Math.round(f.outerHeight())};},_getEventName:function(f){return(typeof f==="string"||e.isArray(f))?f+"."+this.namespace.event:null;},_getEventNames:function(f){if(f){if(typeof f==="string"){f=[f];}e.each(f,e.proxy(function(h,g){f[h]=this._getEventName(g);},this));}return(f&&f.length)?f:null;},_getPositionByAnchorPoint:function(){var g=this.anchorPoint.split(" ");if(g.length!==2){this._throwError("anchor point is invalid");}var f={};e.each(g,e.proxy(function(h,i){e.extend(f,this.anchorPointStrategies[i]());},this));if(e.isEmptyObject(f)){this._throwError("could not determine dropdown position from anchor point");}return f;},_getUniqueId:function(){if(!e.isNumeric(this.uniqueId)){this.uniqueId=parseInt(Math.random().toString().replace(".",""),10);}return this.uniqueId;},_initialize:function(f){var g=this._getUniqueId();this.namespace.event+=g;this._applyConfiguration(f);this._buildStructure();e(this.catalyst).add(this.elements.root).data("module-dropdown-id",g);this._initializeCatalyst();this._initializeMouseBoundaryDetection();this._defineAnchorPointStrategies();e(window).on(this._getEventName("resize"),e.proxy(function(){if(this.isVisible()){this._fireCustomEvent("hideAfterResize");this.hide();}},this));e(document.body).on(this._getEventName("click"),e.proxy(function(i){var h=e(i.target);if(this.isVisible()&&!(h.closest(this.catalyst).length||h.closest("."+this.namespace.css).length)){this.hide();}},this));this._fireCustomEvent("initialize");},_initializeCatalyst:function(){if(!this.isManualShowEnabled&&!this.isMouseDelayedShowEnabled){this.catalyst.on(this._getEventName("click"),e.proxy(function(f){if(f){f.preventDefault();}this._toggle();},this));}},_initializeMouseBoundaryDetection:function(){if(this.isMouseBoundaryDetectionEnabled){this.elements.root.on(this._getEventName("mouseenter"),e.proxy(function(){this._setMouseCursorInsideDropdown(true);},this)).on(this._getEventName("mouseleave"),e.proxy(function(){this._setMouseCursorInsideDropdown(false);if(!this.hideTimer&&this.isVisible()){this.hideTimer=setTimeout(e.proxy(function(){if(!this.isMouseCursorInsideDropdown){this.hide();}this.cancelHide();},this),this.hideDelay);}},this));}},_setMouseCursorInsideDropdown:function(f){if(f){this.isMouseCursorInsideDropdown=true;this._fireCustomEvent("mouseEnterDropdown");}else{this.isMouseCursorInsideDropdown=false;this._fireCustomEvent("mouseLeaveDropdown");}},_setPosition:function(){this.elements.root.css(this._getPositionByAnchorPoint());this._fireCustomEvent("position");},_throwError:function(f){console.log("fitbit.modules.dropdown : "+(f||"unknown error"));},_toggle:function(){if(this.isVisible()){this.hide();return false;}else{this.show();return true;}}};if(b){return a;}else{d.modules.dropdown=a;return d;}});
!(function UMD(a,c,b){if(typeof define==="function"&&define.amd){define(b);}else{c[a]=b();}}).call(this,"devnull",this,function AMD(e){if(typeof e==="function"){var j=e("jquery");var b=e("handlebars");var h=e("fitbit-widget-dropdown");e("fitbit-header-notificationDropdown");var n=e("galileo/util/date").getRelativeDate;var l=e("messages-deviceNames");var f=e("messages-batteryLevels");var k="???";var g=function(s,r){return(l[s]&&l[s][r])?l[s][r]:k;};var i=function(r){return f[r]?f[r]:k;};}else{var j=window.jQuery;var b=window.Handlebars;var h=j.isFunction(fitbit.modules.dropdown)&&fitbit.modules.dropdown;var n=fitbit.util.getRelativeDate;var o="com.fitbit.app.device.message.";var g=function(s,r){return fitbit.i18n.getResource(o+"device_"+r+"_"+s);};var i=function(r){return fitbit.i18n.getResource(o+"battery_"+r);};}var a=j(".wrapper-header").first();if(a.data("fitbitHeaderInitialized")){return;}a.data("fitbitHeaderInitialized",true);var q=a.find(".wrapper-nav");var c=a.hasClass("nav-app");var m="active";var d="subnav";if(c){d+=" subnav-app";}q.on("click",".nav > li",function(s){if(j(s.currentTarget).hasClass("nav-products")){s.preventDefault();}else{var r=j(this).find("a").first().attr("href");if(r){s.preventDefault();location.href=r;}}});p();j(function(){var t=j(".wrapper-system-alerts");if(t.length){var w=".system-alert";var r=t.find(w);r.find(".exit").one("click",function(){var C=j(this).closest(w);var z={alertType:C.data("type"),deviceType:C.data("device")};var A=C.data("cw-program");if(A!=null){z.attributes={CORPORATE_PROGRAM_ID:A};}var B=JSON.stringify(z);var y={request:JSON.stringify({template:"user/dash/alertResponse.json.jsp",serviceCalls:[{name:"alert",method:"processAlert",args:{action:"CLOSE",alert:B}}]})};j.ajax({type:"post",url:"/ajaxapi",data:y,dataType:"json"});C.trigger("destroy.systemAlert");var D=(r.length>1)?"fadeOut":"slideUp";C[D](function(){var E=C.next(w);if(E.length){E.fadeIn(function(){C.remove();s(E);E.trigger("impression.systemAlert");});}else{t.slideUp(function(){t.remove();setTimeout(function(){j("body").trigger("resetGlobalTimeSelector");},0);});}});});var s=function(A){if(!A){return;}var y=A.first().data("cookie");if(y&&!(/^\s*$/).test(y)){var z=new Date();z.setTime(z.getTime()+2629743830);document.cookie="system_alert"+"="+y+"; expires="+z.toGMTString()+"; path=/;";}};var v=r.first();s(v);var x=function(z){if(typeof z!=="string"){return;}var y=["_trackEvent","GlobalAlertProductReview-"+z];if(arguments.length>1){y=y.concat(Array.prototype.slice.call(arguments,1));}try{fitbit.util.deferredTrack(y);}catch(A){if(console){console.log("header.js: 'fitbit.util.deferredTrack' is not available");}}};r.filter(".amazon-review").one("impression.systemAlert",function(){x(j(this).data("device"),"Display","Show");}).one("click",".message a",function(y){x(j(y.delegateTarget).data("device"),"Click","LinkToAmazon");}).one("destroy.systemAlert",function(y){x(j(y.target).data("device"),"Click","CloseForever");});if(v.hasClass("amazon-review")){v.trigger("impression.systemAlert");}}if(h){var u=q.find(".hasdropdown");u.each(function(D,z){var A=j(z);var C=null;var B=null;var F=null;var H=false;function y(){if(F){clearTimeout(F);F=null;}if(B){clearTimeout(B);B=null;}}function G(){H=false;y();if(C&&C.isVisible()){B=setTimeout(function(){if(!C.isMouseCursorInsideDropdown&&!H){C.hide();A.removeClass(m);}y();},200);}}function E(){H=true;y();if(C){C.cancelHide();if(!C.isVisible()){F=setTimeout(function(){C.show();y();},350);}}}A.one("mouseover",function(){C=new h(A,{className:d,catalystActiveClass:m,hideDelay:200,manualShowEnabled:true});C.render(A.find(".subnav-content").first());E();}).on("mouseenter",E).on("mouseleave",G);});}});function p(){var r=a.find(".account > .profile");if(r.length&&h){var s=".productNavDevices";r.one("mouseover"+s+" mousedown"+s,function(t){r.off(s);if(typeof b!=="undefined"){j.post("/ajaxapi",{request:JSON.stringify({serviceCalls:[{name:"trackerSettings",method:"getAlarms"},{name:"device",method:"getOwnerDevices"}],template:"common/defaultResponse.json.jsp"})},function(v){var w=v[0];var z=v[1];var x=[];if(z.length){j.each(z,function(A,C){var B={className:"device-"+C.productName.toLowerCase(),displayName:g(C.type,"displayName"),lastSyncActual:C.lastSyncTime,batteryLevel:C.battery?i(C.battery.toLowerCase()):"",batteryClassName:C.battery?C.battery.toLowerCase():"",link:C.settingsUrl};if(C.lastSyncTime>0){B["lastSyncRelative"]=n(C.lastSyncTime);}var D;j.each(w,function(E,F){if(F.trackerId===C.id&&F.enabled&&F.nextAlarmTimeUTC){if(!D){D=F;}else{if(F.nextAlarmTimeUTC<D.nextAlarmTimeUTC){D=F;}}}});if(D){B["nextAlarmTime"]=D.nextAlarmLocalDay+" "+D.localTime;B["link"]="/settings/alarms/";}x.push(B);});var y=j("#headerProfileSubNav").html();var u=b.compile(y)({devices:x});if(u){j("#profile-subnav").prepend(u);}}},"json");}}).one("click",function(u){u.preventDefault();var t=new h(r,{anchorPoint:"below right",className:d+" subnav-profile",catalystActiveClass:m,mouseBoundaryDetectionEnabled:false});var v=j("#profile-subnav");t.render(v);t.subscribe("beforeShow",function(){v.find(".device .sync").each(function(x,y){var w=parseInt(j(y).attr("data-time"));if(w>0){j(y).text(n(w));}});});t.subscribe("beforeShow",function(){var w=t.getRootElement();j(w).find(".link-dashboard").on("click",function(x){x.preventDefault();j.get("userSettings/dh/save?apiFormat=json&settings['show%20galileo%20dashboard']="+j(this).data("setting"),function(){window.location.reload();});});},true);t.show();});}}});
