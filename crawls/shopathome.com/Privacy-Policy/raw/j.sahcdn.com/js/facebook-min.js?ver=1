var separator;var domain;var appID;var fb_user_is_connected=false;var fb_user_perms;var fb_user_id;var fb_root_url;window.fbAsyncInit=(function(){domain=window.location.hostname;if(domain=="localhost"){appID="252547522635"}else{if(domain.indexOf("qa-shopathome")>-1){appID="299020576722"}else{if(domain.indexOf("-shopathome.sah.com")>-1){appID="252547522635"}else{appID="500526430346"}}}if(window["rootUrl"]!=undefined){fb_root_url=rootUrl}else{fb_root_url=window.location.protocol+"//"+window.location.hostname+"/"}if(window["secureRootUrl"]==undefined){secureRootUrl="https://secure.shopathome.com/"}var fbChannelUrl=fb_root_url+(window.location.protocol=="http:"?"fb-channel.html":"fb-ssl-channel.html");FB.init({appId:appID,status:true,cookie:true,xfbml:true,channelUrl:fbChannelUrl});FB.UIServer.setLoadedNode=function(a,b){FB.UIServer._loadedNodes[a.id]=b};onFacebookInit();FB.Event.subscribe("edge.create",onFacebookLikeClick);FB.Event.subscribe("edge.create",onFacebookLikeClickTracking);FB.Event.subscribe("edge.remove",onFacebookUnLikeClick);FB.Event.subscribe("edge.remove",onFacebookUnLikeClickTracking);FB.Event.subscribe("message.send",onFacebookSendClickTracking);FB.Event.subscribe("auth.login",onFacebookLogin);FB.Event.subscribe("auth.logout",onFacebookLogout);facebook_user_is_connected(function(connected){if(connected){onFacebookConnected();$(".FacebookNotAuthenticatedContainer").hide();$(".FacebookAuthenticatedContainer").show()}else{$(".FacebookNotAuthenticatedContainer").show();$(".FacebookAuthenticatedContainer").hide()}})});(function(){var e=document.createElement("script");e.async=true;e.src=document.location.protocol+"//connect.facebook.net/en_US/all.js";document.getElementById("fb-root").appendChild(e)}());var onFacebookLogin=function(response){if(response.session){facebook_connect(response.session.uid,function(connect_response){fb_user_is_connected=true;$(".FacebookNotAuthenticatedContainer").hide();$(".FacebookAuthenticatedContainer").show();if(connect_response){window.location.href=fb_root_url+"FacebookConnect.aspx"}})}};var onFacebookLogout=function(response){facebook_disconnect(function(disconnect_response){fb_user_is_connected=false;$(".FacebookNotAuthenticatedContainer").show();$(".FacebookAuthenticatedContainer").hide()})};if(!onFacebookLikeClick){var onFacebookLikeClick=function(href){if(typeof(FacebookLikeClick)!="undefined"){FacebookLikeClick(href)}}}if(!onFacebookUnLikeClick){var onFacebookUnLikeClick=function(href){if(typeof(FacebookLikeClick)!="undefined"){FacebookUnLikeClick(href)}}}var onFacebookUnLikeClickTracking=function(href){LikeTracking(href,false)};var onFacebookLikeClickTracking=function(href){LikeTracking(href,true)};var onFacebookSendClickTracking=function(href){TrackSocial("facebook","send",href)};function LikeTracking(href,liked){var offerId=0;if($('div[href$="'+href+'"]').length>0){offerId=$('div[href$="'+href+'"]').attr("id").replace("OfferId","")}var sahPage=document.location.pathname.substring(document.location.pathname.lastIndexOf("/")+1);if(!sahPage||sahPage.length==0){sahPage=document.location.href}if(!fb_user_id){fb_user_id=0}$.ajax({type:"GET",url:secureRootUrl+"WebAPI/SAHService.svc/LikeTracking",data:"SAHPage="+escape(sahPage)+"&likeURL="+escape(href)+"&FBUID="+fb_user_id+"&liked="+liked+"&offerId="+offerId,contentType:"application/json; charset=utf-8",dataType:"jsonp"});TrackSocial("facebook",liked?"like":"unlike",href)}function TrackSocial(network,socialAction,href){try{if(_gaq){a=document.createElement("a");a.href=href;_gaq.push(["_trackSocial",network,socialAction,href,a.pathname+a.search])}}catch(e){}}if(!onFacebookInit){var onFacebookInit=function(){}}if(!onFacebookConnected){var onFacebookConnected=function(){fb_user_is_connected=true}}function facebook_user_is_connected(callback){if(!fb_user_is_connected){FB.getLoginStatus(function(response){if(response.session){fb_user_is_connected=true;fb_user_id=response.session.uid;fb_user_perms=response.perms;if(callback){callback(true)}}else{fb_user_is_connected=true;fb_user_perms="";if(callback){callback(false)}}})}}function facebook_login(requestedPerms,callback){FB.login(function(response){if(response.session){fb_user_is_connected=true;facebook_connect(response.session.uid,function(connect_response){if(callback){callback(connect_response)}})}else{if(callback){callback(false)}}},{perms:requestedPerms},{enable_profile_selector:true})}function facebook_connect(uid,callback){$.ajax({type:"POST",url:fb_root_url+"WebAPI/FacebookApi.aspx/Connect",data:"{'uid' : '"+uid+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(msg){if(callback){callback(msg.d)}},error:function(XMLHttpRequest,textStatus,errorThrown){if(callback){callback(false)}}})}function facebook_disconnect(callback){$.ajax({type:"POST",url:fb_root_url+"WebAPI/FacebookApi.aspx/Disconnect",data:"{}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(msg){if(callback){callback(true)}},error:function(XMLHttpRequest,textStatus,errorThrown){if(callback){callback(false)}}})}function save_facebook_profile_to_sah(callback){FB.api("/me",function(fb_user){$.ajax({type:"POST",url:fb_root_url+"WebAPI/FacebookApi.aspx/SaveFacebookProfileToSAH",data:"{'uid' : '"+fb_user.id+"', 'firstName' : '"+(fb_user.first_name?fb_user.first_name:"")+"', 'lastName' : '"+(fb_user.last_name?fb_user.last_name:"")+"', 'gender' : '"+(fb_user.gender?fb_user.gender:"")+"', 'userName' : '"+(fb_user.username?fb_user.username:"")+"', 'bio' : '"+(fb_user.bio?fb_user.bio:"")+"', 'location' : '"+(fb_user.location&&fb_user.location.name?fb_user.location.name:"")+"', 'birthday' : '"+(fb_user.birthday?fb_user.birthday:"")+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(msg){if(callback){callback(true)}},error:function(XMLHttpRequest,textStatus,errorThrown){if(callback){callback(false)}}})})}function request_facebook_permission(permission,callback){facebook_login(permission,function(response){if(callback){callback(response)}})}function save_facebook_preference(preferenceName,preferenceValue,callback){var result=false;$.ajax({type:"POST",url:fb_root_url+"WebApi/FacebookApi.aspx/SaveFacebookPreference",data:"{'preferenceName' : '"+preferenceName+"', 'preferenceValue' : '"+preferenceValue+"'}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(msg){if(callback){callback(true)}},error:function(XMLHttpRequest,textStatus,errorThrown){if(callback){callback(false)}}})}function post_to_facebook_stream(post_type,merchantId,user_entered_message,callback){FB.api("/me",function(fb_user){$.ajax({type:"POST",url:fb_root_url+"WebApi/FacebookApi.aspx/GetPostToPublish",data:"{'uid' : '"+fb_user.id+"', 'firstName' : '"+fb_user.first_name+"', 'postType' : '"+post_type+"', 'merchantId' : "+merchantId+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:function(msg){FB.ui({method:"stream.publish",message:(user_entered_message?user_entered_message.replace("%27","'"):""),attachment:{"name":msg.d.PostName,"href":msg.d.PostLink,"description":msg.d.Description,"media":[{"type":"image","src":msg.d.PostImage,"href":msg.d.PostLink}]},actionLinks:[{"text":"Join ShopAtHome.com","href":msg.d.PostLink}]},function(response){if(callback){callback(response)}})},error:function(XMLHttpRequest,textStatus,errorThrown){if(callback){callback(false)}}})})}function facebook_get_checkins(fbUID){FB.api("/"+fbUID+"/checkins",function(response){placesObject=response.data;if(placesObject){for(var i=0;i<placesObject.length;i++){$("#places").html(placesObject[0].place.name+" "+placesObject[0].place.location.zip)}}else{if(response.error){alert(response.error.message)}}})}function facebook_user_likes_shopathome(callback){FB.api("/me/likes",function(response){likes=response.data;var userLikesShopAtHome=false;for(var i=0;i<likes.length;i++){if(likes[i].id=="134837548388"){userLikesShopAtHome=true;break}}if(callback){callback(userLikesShopAtHome)}})};