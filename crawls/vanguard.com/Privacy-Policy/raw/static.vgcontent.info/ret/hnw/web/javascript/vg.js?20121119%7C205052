
if(!window.vg )
{
vg=new Object();
}
vg.html=new Object();
vg.comp=new Object();
vg.util=new Object();
vg.window=new Object();
vg.smil=new Object();
vg.validation=new Object();
vg.button=new Object();
vg.expRow=new Object();
vg.resultsRow=new Object();
vg.string=new Object();
vg.ageBand=new Object();
vg.listGrid=new Object();
vg.procNav={};
vg.textZoom=new Object();
vg.textZoomNG=new Object();
vg.textZoomNG.TEXT_ZOOM_CONTENT_CLASS="textZoomContent";
vg.textZoomNG.ZOOM_COOKIE="s:";
vg.textZoomNG.COOKIE_VALUES={"A-size1":"1", "A-size2":"2", "A-size3":"3"};
vg.touchScreen=new Object();
vg.touchScreen.oneFinger=new Object();
vg.event=new Object();
vg.position=new Object();
vg.event.DOM_CHANGE="CBD_DOM_CHANGE";
vg.event.GEO_CHANGE="CBD_GEO_CHANGE";
vg.event.DISP_CHANGE="CBD_DISP_CHANGE";
vg.event.PAGE_READY="CBD_PAGE_READY";
vg.event.LAYER_REPOSITION="CBD_LAYER_REPOSITION";
vg.event.LAYER_OPEN="CBD_LAYER_OPEN";
vg.event.TEXT_ZOOM_CLICK="CBD_TEXT_ZOOM_CLICK";
vg.event.LAYER_CLOSE="CBD_LAYER_CLOSE";
vg.event.ELEMENT_DISABLED="CBD_ELEMENT_DISABLED";
vg.event.CUSTOM_EVENTS=new Array();
vg.event.GSTR_DRAG_START="CBD_SYNTH_GSTR_DRAG_START";
vg.event.GSTR_DRAG_MOVE="CBD_SYNTH_GSTR_DRAG_MOVE";
vg.event.GSTR_DRAG_END="CBD_SYNTH_GSTR_DRAG_END";
vg.event.GSTR_FLICK="CBD_SYNTH_GSTR_FLICK";
vg.event.GSTR_MOVE="CBD_SYNTH_GSTR_MOVE";
vg.event.GSTR_HOVEREND="CBD_SYNTH_GSTR_HOVEREND";
vg.event.GSTR_HOVERSTART="CBD_SYNTH_GSTR_HOVERSTART";
vg.event.GSTR_CUSTOM_Y_SCROLL="CBD_SYNTH_GSTR_CUSTOM_Y_SCROLL";
vg.event.GSTR_CUSTOM_Y_SCROLL_END="CBD_SYNTH_GSTR_CUSTOM_Y_SCROLL_END";
vg.event.GSTR_DOWNSTART="CBD_SYNTH_GSTR_DOWNSTART";
vg.event.GSTR_CLICKEND="CBD_SYNTH_GSTR_CLICKEND";
vg.table=new Object();
vg.event.DragGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchstart', this, "_handleGesture", "DRAG_GSTR_TOUCHSTART");
}
else
{
vg.html.addEventListenerMethod(node, 'mousedown', this, "_handleGesture", "DRAG_GSTR_MOUSEDOWN");
}
},
_handleGesture:function(event)
{
var touch, controller=this, startEvent={}, gstrValid=true;
var _handleGestureProgress=function(event)
{
var moveEvt=event;
if(moveEvt.touches)
{
controller.normalizeTouchEvent(moveEvt, moveEvt.touches[0]);
}
moveEvt.start=startEvent;
moveEvt.customType=vg.event.GSTR_DRAG_MOVE;
var moveSub=controller.node.customEvents[vg.event.GSTR_DRAG_MOVE];
if(moveSub)
{
moveSub.fire(moveEvt);
}
}
var _handleGestureEnd=function(event)
{
var valid=gstrValid;
if(valid)
{
if(event.changedTouches)
{
if(event.changedTouches.length===1&&event.touches.length===0)
{
valid=true;
controller.normalizeTouchEvent(event, event.changedTouches[0]);
}
else
{
valid=false;
}
}
if(valid)
{
event.customType=vg.event.GSTR_DRAG_END;
event.start=startEvent;
var endEvent=controller.node.customEvents[vg.event.GSTR_DRAG_END];
if(endEvent)
{
endEvent.fire(event);
}
startEvent=null;
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListener(document, 'touchmove', _handleGestureProgress, "DRAG_GSTR_TOUCHMOVE");
vg.html.removeEventListener(document, 'touchend', _handleGestureEnd, "DRAG_GSTR_TOUCHEND");
}
else
{
vg.html.removeEventListener(document, 'mousemove', _handleGestureProgress, "DRAG_GSTR_MOUSEMOVE");
vg.html.removeEventListener(document, 'mouseup', _handleGestureEnd, "DRAG_GSTR_MOUSEUP");
}
}
}
}
if(event.touches)
{
gstrValid=(event.touches.length===1);
controller.normalizeTouchEvent(event, event.touches[0]);
touch=true;
}
if(gstrValid)
{
event.customType=controller.type;
vg.util.attachJsonOptions(startEvent, event);
if(touch)
{
vg.html.addEventListener(document, 'touchmove', _handleGestureProgress, "DRAG_GSTR_TOUCHMOVE");
vg.html.addEventListener(document, 'touchend', _handleGestureEnd, "DRAG_GSTR_TOUCHEND");
}
else
{
vg.html.addEventListener(document, 'mousemove', _handleGestureProgress, "DRAG_GSTR_MOUSEMOVE");
vg.html.addEventListener(document, 'mouseup', _handleGestureEnd, "DRAG_GSTR_MOUSEUP");
}
controller.fire(event);
}
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(document, "DRAG_GSTR_TOUCHMOVE");
vg.html.removeEventListenerById(document, "DRAG_GSTR_TOUCHEND");
vg.html.removeEventListenerById(node, "DRAG_GSTR_TOUCHSTART");
}
else
{
vg.html.removeEventListenerById(document, "DRAG_GSTR_MOUSEMOVE");
vg.html.removeEventListenerById(document, "DRAG_GSTR_MOUSEUP");
vg.html.removeEventListenerById(node, "DRAG_GSTR_MOUSEDOWN");
}
}
}
vg.event.DragMoveGesture={}
vg.event.DragEndGesture={}
vg.event.HoverStartGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchstart', this, "_handleGesture", "HOVERSTART_GSTR_TOUCHSTART");
}
else
{
vg.html.addEventListenerMethod(node, 'mouseover', this, "_handleGesture", "HOVERSTART_GSTR_MOUSEOVER");
}
},
_handleGesture:function(event)
{
if(event.touches)
{
if(event.touches.length===1)
{
this.normalizeTouchEvent(event, event.touches[0]);
}
else
{
return;
}
}
event.customType=this.type;
this.fire(event);
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(node, "HOVERSTART_GSTR_TOUCHSTART")
}
else
{
vg.html.removeEventListenerById(node, "HOVERSTART_GSTR_MOUSEOVER");
}
}
}
vg.event.MoveGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchmove', this, "_handleGestureProgress", "MOVE_GSTR_TOUCHMOVE");
}
else
{
vg.html.addEventListenerMethod(node, 'mousemove', this, "_handleGestureProgress", "MOVE_GSTR_MOUSEMOVE");
}
},
_handleGestureProgress:function(event)
{
if(event.changedTouches)
{
this.normalizeTouchEvent(event, event.changedTouches[0]);
}
event.customType=this.type;
this.fire(event);
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(node, "MOVE_GSTR_TOUCHMOVE");
}
else
{
vg.html.removeEventListenerById(node, "MOVE_GSTR_MOUSEMOVE");
}
}
}
vg.event.HoverEndGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchend', this, "_handleGesture", "HOVEREND_GSTR_TOUCHEND");
}
else
{
vg.html.addEventListenerMethod(node, 'mouseout', this, "_handleGesture", "HOVEREND_GSTR_MOUSEOUT");
}
},
_handleGesture:function(event)
{
if(event.changedTouches)
{
if(event.changedTouches.length===1&&event.touches.length===0)
{
this.normalizeTouchEvent(event, event.changedTouches[0]);
}
else
{
return;
}
}
event.customType=this.type;
this.fire(event);
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(node, "HOVEREND_GSTR_TOUCHEND")
}
else
{
vg.html.removeEventListenerById(node, "HOVEREND_GSTR_MOUSEOUT");
}
}
}
vg.event.FlickGesture=
{
on:function(node)
{
vg.html.addEventListenerMethod(node, 'touchstart', this, "_handleGesture", "FLICK_GSTR_TOUCHSTART");
vg.html.addEventListenerMethod(node, 'mousedown', this, "_handleGesture", "FLICK_GSTR_MOUSEDOWN");
},
applyFilter:function(filter, eventData)
{
var flickData=eventData.flick;
if(!flickData)
{
return false;
}
if(filter&&filter.axis)
{
flickData.axis=filter.axis;
var prop=(filter.axis=='x')?'clientX':'clientY';
flickData.distance=eventData[prop]- flickData.start[prop];
flickData.velocity=(flickData.time!==0)?flickData.distance/flickData.time:0;
}
if(!isNaN(filter.minDistance)&&filter.minDistance > Math.abs(flickData.distance))
{
return false;
}
if(!isNaN(filter.minVelocity)&&filter.minVelocity > Math.abs(flickData.velocity))
{
return false;
}
return true;
},
_handleGesture:function(event)
{
var startEvent={}, controller=this;
var gstrValid=true, valid=true;
var touch=false;
var _handleGestureProgress=function(event)
{
if(startEvent&&startEvent.flick)
{
startEvent.flick.time=new Date().getTime();
}
vg.html.removeEventListener(document, 'touchmove', _handleGestureProgress, "FLICK_GSTR_TOUCHMOVE");
vg.html.removeEventListener(document, 'mousemove', _handleGestureProgress, "FLICK_GSTR_MOUSEMOVE");
}
var _handleGestureEnd=function(event)
{
var xyDistance, time, axis, velocity, distance, touch, evt=event, endEvent={};
var endTime=new Date().getTime();
valid=gstrValid;
if(valid)
{
if(event.changedTouches)
{
if(event.changedTouches.length===1&&event.touches.length===0)
{
controller.normalizeTouchEvent(event, event.changedTouches[0]);
touch=true;
}
else
{
valid=false;
}
}
if(valid)
{
endEvent=event;
xyDistance={x:endEvent.clientX - startEvent.clientX, y:endEvent.clientY - startEvent.clientY};
axis=(Math.abs(xyDistance[0]) >=Math.abs(xyDistance[1]))?'x':'y';
distance=xyDistance[axis];
endEvent.customType=controller.type;
time=endTime - startEvent.flick.time;
endEvent.flick=
{
time:time,
start:startEvent,
distance:distance,
velocity:(time!==0)?distance/time:0
}
if(touch)
{
vg.html.removeEventListener(document, 'touchmove', _handleGestureProgress, "FLICK_GSTR_TOUCHMOVE");
vg.html.removeEventListener(document, 'touchend', _handleGestureEnd, "FLICK_GSTR_TOUCHEND");
}
else
{
vg.html.removeEventListener(document, 'mousemove', _handleGestureProgress, "FLICK_GSTR_MOUSEMOVE");
vg.html.removeEventListener(document, 'mouseup', _handleGestureEnd, "FLICK_GSTR_MOUSEUP");
}
controller.fire(endEvent);
startEvent=null;
}
}
}
if(event.touches)
{
gstrValid=(event.touches.length===1);
controller.normalizeTouchEvent(event, event.touches[0]);
touch=true;
}
if(gstrValid)
{
vg.html.stopEventPropagation(event);
vg.html.preventDefault(event);
vg.util.attachJsonOptions(startEvent, event);
startEvent.flick={time:new Date().getTime()};
if(touch)
{
vg.html.addEventListener(document, 'touchmove', _handleGestureProgress, "FLICK_GSTR_TOUCHSMOVE");
vg.html.addEventListener(document, 'touchend', _handleGestureEnd, "FLICK_GSTR_TOUCHEND");
}
else
{
vg.html.addEventListener(document, 'mousemove', _handleGestureProgress, "FLICK_GSTR_MOUSEMOVE");
vg.html.addEventListener(document, 'mouseup', _handleGestureEnd, "FLICK_GSTR_MOUSEUP");
}
}
},
detach:function(node)
{
vg.html.removeEventListenerById(node, "FLICK_GSTR_MOUSEDOWN");
vg.html.removeEventListenerById(document, "FLICK_GSTR_MOUSEMOVE");
vg.html.removeEventListenerById(document, "FLICK_GSTR_MOUSEUP");
vg.html.removeEventListenerById(node, "FLICK_GSTR_TOUCHSTART");
vg.html.removeEventListenerById(document, "FLICK_GSTR_TOUCHMOVE");
vg.html.removeEventListenerById(document, "FLICK_GSTR_TOUCHEND");
}
}
vg.event.CustomYSCrollGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchstart', this, "_handleGesture", "CUSTOM_Y_SCROLL_GSTR_TOUCHSTART");
}
},
_handleGesture:function(event)
{
var touch, controller=this,
startEvent={},
gstrValid=true,
validMoveGesture=true,
movingEngaged=false,
startDistBetweenTouches=0,
firstMoveOccured=false,
startPos=0,
isZoomThreshold=5;
var _handleGestureProgress=function(event)
{
var moveEvt=event;
validMoveGesture=((event.touches.length===1)||(event.touches.length===2) );
if(moveEvt.touches&&(moveEvt.touches.length===2)&&!movingEngaged)
{
if(!firstMoveOccured)
{
validMoveGesture=false;
}
else
{
var newDist=vg.event.getDistBetweenTouches(moveEvt.touches[0], moveEvt.touches[1]);
var diff=Math.abs(newDist - startDistBetweenTouches);
if(diff > isZoomThreshold)
{
validMoveGesture=false;
}
}
firstMoveOccured=true;
}
if(validMoveGesture)
{
if(moveEvt.changedTouches)
{
controller.normalizeTouchEvent(moveEvt, moveEvt.touches[0]);
}
moveEvt.start=startEvent;
moveEvt.customType=vg.event.GSTR_CUSTOM_Y_SCROLL;
var moveSub=controller.node.customEvents[vg.event.GSTR_CUSTOM_Y_SCROLL];
if(moveSub)
{
moveSub.fire(moveEvt);
movingEngaged=true;
}
}
}
var _handleGestureEnd=function(event)
{
var validEndMove=gstrValid&&movingEngaged;
if(validEndMove)
{
if(event.changedTouches)
{
if(event.changedTouches.length===1&&event.touches.length===0)
{
validEndMove=true;
controller.normalizeTouchEvent(event, event.changedTouches[0]);
}
else
{
validEndMove=false;
}
}
if(validEndMove)
{
event.customType=vg.event.GSTR_CUSTOM_Y_SCROLL_END;
event.start=startEvent;
var endEvent=controller.node.customEvents[vg.event.GSTR_CUSTOM_Y_SCROLL_END];
if(endEvent)
{
endEvent.fire(event);
}
startEvent=null;
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListener(controller.node, 'touchmove', _handleGestureProgress, "CUSTOM_Y_SCROLL_GSTR_TOUCHMOVE");
vg.html.removeEventListener(document, 'touchend', _handleGestureEnd, "CUSTOM_Y_SCROLL_GSTR_TOUCHEND");
}
}
}
}
if(event.touches)
{
gstrValid=((event.touches.length===1&&event.changedTouches.length===1)
||(event.touches.length===2&&event.changedTouches.length===1)
||(event.touches.length===2&&event.changedTouches.length===2) );
controller.normalizeTouchEvent(event, event.touches[0]);
touch=true;
}
if(gstrValid===true)
{
event.customType=controller.type;
startEvent=event;
if(touch)
{
startPos=event.touches[0].clientX;
if((event.touches.length===2&&event.changedTouches.length===1)
||(event.touches.length===2&&event.changedTouches.length===2) )
{
startDistBetweenTouches=vg.event.getDistBetweenTouches(event.touches[0], event.touches[1]);
}
vg.html.removeEventListenerById(controller.node, "CUSTOM_Y_SCROLL_GSTR_TOUCHMOVE");
vg.html.removeEventListenerById(document, "CUSTOM_Y_SCROLL_GSTR_TOUCHEND");
vg.html.addEventListener(controller.node, 'touchmove', _handleGestureProgress, "CUSTOM_Y_SCROLL_GSTR_TOUCHMOVE");
vg.html.addEventListener(document, 'touchend', _handleGestureEnd, "CUSTOM_Y_SCROLL_GSTR_TOUCHEND");
}
}
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(node, "CUSTOM_Y_SCROLL_GSTR_TOUCHSTART");
vg.html.removeEventListenerById(node, "CUSTOM_Y_SCROLL_GSTR_TOUCHMOVE");
vg.html.removeEventListenerById(document, "CUSTOM_Y_SCROLL_GSTR_TOUCHEND");
}
}
}
vg.event.DownStartGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchstart', this, "_handleGesture", "DOWNSTART_GSTR_TOUCHSTART");
}
else
{
vg.html.addEventListenerMethod(node, 'mousedown', this, "_handleGesture", "DOWNSTART_GSTR_MOUSEDOWN");
}
},
_handleGesture:function(event)
{
if(event.touches)
{
this.normalizeTouchEvent(event, event.touches[0]);
}
event.customType=this.type;
this.fire(event);
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(node, "DOWNSTART_GSTR_TOUCHSTART")
}
else
{
vg.html.removeEventListenerById(node, "DOWNSTART_GSTR_MOUSEDOWN");
}
}
}
vg.event.ClickEndGesture=
{
on:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.addEventListenerMethod(node, 'touchend', this, "_handleGesture", "CUSTM_GSTR_TOUCHEND");
}
else
{
vg.html.addEventListenerMethod(node, 'click', this, "_handleGesture", "CUSTM_GSTR_CLICK");
}
},
_handleGesture:function(event)
{
event.customType=this.type;
this.fire(event);
},
detach:function(node)
{
if(cbd.browser.isTouchScreen)
{
vg.html.removeEventListenerById(node, "CUSTM_GSTR_TOUCHCLICK")
}
else
{
vg.html.removeEventListenerById(node, "CUSTM_GSTR_CLICK");
}
}
}
vg.event.CustomYSCrollEndGesture={}
vg.event.SYNTH_EVENTS=
{
CBD_SYNTH_GSTR_DRAG_START:vg.event.DragGesture,
CBD_SYNTH_GSTR_DRAG_MOVE:vg.event.DragMoveGesture,
CBD_SYNTH_GSTR_DRAG_END:vg.event.DragEndGesture,
CBD_SYNTH_GSTR_FLICK:vg.event.FlickGesture,
CBD_SYNTH_GSTR_MOVE:vg.event.MoveGesture,
CBD_SYNTH_GSTR_HOVEREND:vg.event.HoverEndGesture,
CBD_SYNTH_GSTR_HOVERSTART:vg.event.HoverStartGesture,
CBD_SYNTH_GSTR_CUSTOM_Y_SCROLL:vg.event.CustomYSCrollGesture,
CBD_SYNTH_GSTR_CUSTOM_Y_SCROLL_END:vg.event.CustomYSCrollEndGesture,
CBD_SYNTH_GSTR_DOWNSTART:vg.event.DownStartGesture,
CBD_SYNTH_GSTR_CLICKEND:vg.event.ClickEndGesture
}
vg.event.SyntheticEvent=function(eventType, node)
{
this.initialize(eventType, node);
}
vg.event.SyntheticEvent.prototype=
{
initialize:function(eventType, node)
{
this.node=node;
this.type=eventType;
this.listeners=[];
if(node&&node!=window)
{
vg.util.attachJsonOptions(this, vg.event.SYNTH_EVENTS[eventType]);
}
},
on:function(){},
detach:function(){},
subscribe:function(func)
{
if(this.listeners.length==0)
{
this.on(this.node, this);
}
this.listeners.push(func);
},
unsubscribe:function(func)
{
var length=this.listeners.length;
var foundIndex=-1;
for(var i=0;i<length;i++)
{
if(this.listeners[i]==func)
{
foundIndex=i;
break;
}
}
if(foundIndex > -1)
{
this.listeners.splice(foundIndex, 1);
if(this.listeners.length===0)
{
this.detach(this.node);
}
}
},
fire:function(eventData)
{
var listener, filter, length=this.listeners.length;
for(var i=0;i<length;i++)
{
listener=this.listeners[i];
filter=listener.filter;
if(!filter||this.applyFilter(filter, eventData))
{
listener.call(this.node, eventData);
}
}
},
applyFilter:function(filter, eventData)
{
return true;
},
normalizeTouchEvent:function(event, touchInfo)
{
event.pageX=touchInfo.pageX;
event.pageY=touchInfo.pageY;
event.screenX=touchInfo.screenX;
event.screenY=touchInfo.screenY;
event.clientX=touchInfo.clientX;
event.clientY=touchInfo.clientY;
event["target"]=event["target"]||touchInfo["target"];
event["currentTarget"]=event["currentTarget"]||touchInfo["currentTarget"];
}
}
vg.event.isWithinNodes=function(event, boundaryNodes)
{
if(boundaryNodes)
{
var pageX=0;
var pageY=0;
var eventPos=vg.event.getPosition(event);
if(eventPos.x)
{
pageX=eventPos.x;
pageY=eventPos.y;
}
var boundaryNodesLength=boundaryNodes.length;
for(var i=0;i < boundaryNodesLength;i++)
{
var node=vg.html.getElement(boundaryNodes[i]);
var boundary=vg.html.findBoundary(node);
if((pageX >=boundary.left&&pageX < boundary.right)&&(pageY < boundary.bottom&&pageY >=boundary.top))
{
return true;
}
}
}
return false;
}
vg.event.getPosition=function(e)
{
var eventPos={};
if(ieQuirksMode)
{
eventPos.x=e.clientX+_cbdGetScrollLeft();
eventPos.y=e.clientY+_cbdGetScrollTop();
}
else if(e.changedTouches)
{
eventPos.x=e.changedTouches[0].pageX;
eventPos.y=e.changedTouches[0].pageY;
}
else
{
eventPos.x=e.pageX;
eventPos.y=e.pageY;
}
return eventPos;
}
vg.event.getPositionRelativeToElem=function(e, elem)
{
var elemPos=vg.html.getObjXY(elem);
var eventPos=vg.event.getPosition(e);
eventPos.x -=elemPos.x;
eventPos.y -=elemPos.y;
return eventPos;
}
vg.event.getDistBetweenTouches=function(touch1, touch2)
{
var touch1ClientY=touch1.clientY,
touch1ClientX=touch1.clientX,
touch2ClientY=touch2.clientY,
touch2ClientX=touch2.clientX,
dist=Math.round(Math.sqrt(Math.pow((touch2ClientX - touch1ClientX), 2)+Math.pow((touch2ClientY - touch1ClientY), 2) ) );
return dist;
}
vg.delayedEvents=0;
vg.html.ELEMENT_NODE="1";
vg.wu=new Object();
var CBD_GLOBAL_INFO_BOX='NON_BB_GLOBAL_INFO_BOX';
var CBD_DYNAMIC_CSS='dynmCSS';
var CBD_DYNAMIC_CSS_ID='dynmCSSDiv';
vg.comp.floatingHeadPrefix=floatingHeadPrefix='floatingTableHeader-';
if(!window._cbdLooseFuncs)
{
_cbdLooseFuncs={};
}
vg.QueryString=function(readOnLoad)
{
this.arg=new Array;
if(readOnLoad!=false)
{
this.read();
}
}
vg.QueryString.prototype=
{
get:function(sName)
{
return this.arg[sName];
},
read:function(sUrl)
{
var aArgsTemp, aTemp, sQuery;
if(sUrl)
{
sQuery=sUrl.substr(sUrl.lastIndexOf("?")+1, sUrl.length);
}
else
{
sQuery=window.location.search.substr(1, window.location.search.length);
}
if(sQuery.length < 1)
return;
aArgsTemp=sQuery.split("&");
for(var i=0;i < aArgsTemp.length;i++)
{
aTemp=aArgsTemp[i].split("=");
this.arg[aTemp[0]]=aTemp[1];
}
}
}
if(window.isNextGen)
{
vg.position.LEADER_OFFSET=18;
vg.position.LEADER_WIDTH=20;
vg.position.LEADER_HEIGHT=11;
vg.position.LINK_OFFSET=6;
vg.position.SHADOW_OFFSET=0;
vg.position.LDR_IMAGE_XOFFSET=0;
vg.position.MIN_LINK_WIDTH=vg.position.LEADER_WIDTH+vg.position.LEADER_OFFSET;
}
else
{
vg.position.LEADER_OFFSET=15;
vg.position.LEADER_WIDTH=32;
vg.position.LEADER_HEIGHT=11;
vg.position.LINK_OFFSET=0;
vg.position.SHADOW_OFFSET=(ie6)?0:6;
vg.position.MIN_LINK_WIDTH=vg.position.LEADER_WIDTH;
vg.position.LDR_IMAGE_XOFFSET=(ie6)?2:4;
}
var LEADER_OFFSET=vg.position.LEADER_OFFSET;
var LEADER_WIDTH=vg.position.LEADER_WIDTH;
var LEADER_HEIGHT=vg.position.LEADER_HEIGHT;
var LINK_OFFSET=vg.position.LINK_OFFSET;
var SHADOW_OFFSET=vg.position.SHADOW_OFFSET;
var LDR_IMAGE_XOFFSET=vg.position.LDR_IMAGE_XOFFSET;
var MIN_LINK_WIDTH=vg.position.MIN_LINK_WIDTH;
vg.position._ne=function(elem, target)
{
elem.viewNode.x=target.x+target.w;
elem.viewNode.y=target.y - elem.h;
elem.leaderId=null;
}
vg.position._se=function(elem, target)
{
elem.viewNode.x=target.x+target.w;
elem.viewNode.y=target.y+target.h;
elem.leaderId=null;
}
vg.position._sw=function(elem, target)
{
elem.viewNode.x=target.x - elem.w;
elem.viewNode.y=target.y+target.h;
elem.leaderId=null;
}
vg.position._nw=function(elem, target)
{
elem.viewNode.x=target.x - elem.w;
elem.viewNode.y=target.y - elem.h;
elem.leaderId=null;
}
vg.position._right=function(elem, target)
{
elem.viewNode.x=target.x+target.w;
elem.viewNode.y=target.y+target.h/2 - elem.h/2;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrLft"
_cbdAddLeader(elem, target);
elem.ldrOffSetX=((ie)?10:11 );
}
}
vg.position._top=function(elem, target)
{
elem.viewNode.x=target.x+target.w/2 - elem.w/2+vg.position.LDR_IMAGE_XOFFSET;
elem.viewNode.y=target.y - elem.h+vg.position.SHADOW_OFFSET;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrBot";
_cbdAddLeader(elem, target);
elem.ldrOffSetY=-1*vg.position.LEADER_HEIGHT;
}
}
vg.position._left=function(elem, target)
{
elem.viewNode.x=target.x - elem.w;
elem.viewNode.y=target.y+target.h/2 - elem.h/2;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrRgt";
_cbdAddLeader(elem, target);
elem.ldrOffSetX=-1*vg.position.LEADER_HEIGHT;
}
}
vg.position._bottom=function(elem, target)
{
elem.viewNode.x=target.x+target.w/2 - elem.w/2+vg.position.LDR_IMAGE_XOFFSET;
elem.viewNode.y=target.y+target.h;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrTop";
_cbdAddLeader(elem, target);
elem.ldrOffSetY=11;
}
}
vg.position._topLeft=function(elem, target)
{
elem.viewNode.x=target.x;
elem.viewNode.y=target.y - elem.h;
elem.x=elem.viewNode.x;
if(elem.hasLeader)
{
if(vg.position.MIN_LINK_WIDTH >=target.w)
{
elem.viewNode.x=elem.viewNode.x+target.w/2 - vg.position.LEADER_OFFSET - vg.position.LEADER_WIDTH/2;
}
elem.viewNode.y=elem.viewNode.y+vg.position.SHADOW_OFFSET;
elem.x=elem.viewNode.x;
elem.y=elem.viewNode.y;
elem.ldrLoc="xLdrBot";
var ldrData=_cbdAddLeader(elem, target);
elem.ldrOffSetY=-1*vg.position.LEADER_HEIGHT;
var ldrDiv=document.getElementById(elem.leaderId);
ldrDiv.style.left=elem.x+vg.position.LEADER_OFFSET+"px";
ldrDiv.style.top=ldrData.elem.y+vg.position.SHADOW_OFFSET+"px";
}
}
vg.position._topRight=function(elem, target)
{
elem.viewNode.x=target.x+target.w - elem.w;
elem.x=elem.viewNode.x;
elem.viewNode.y=target.y - elem.h;
if(elem.hasLeader)
{
if(vg.position.MIN_LINK_WIDTH >=target.w)
{
elem.viewNode.x=elem.viewNode.x - target.w/2+vg.position.LEADER_OFFSET+vg.position.LEADER_WIDTH/2;
}
elem.viewNode.y=elem.viewNode.y+vg.position.SHADOW_OFFSET;
elem.x=elem.viewNode.x;
elem.y=elem.viewNode.y;
elem.ldrLoc="xLdrBot";
var ldrData=_cbdAddLeader(elem, target);
elem.ldrOffSetY=-1*vg.position.LEADER_HEIGHT;
ldrDiv=document.getElementById(elem.leaderId);
ldrDiv.style.left=elem.x+elem.w - vg.position.LEADER_WIDTH - vg.position.LEADER_OFFSET+"px";
ldrDiv.style.top=ldrData.elem.y+vg.position.SHADOW_OFFSET+"px";
}
}
vg.position._fixedBottom=function(elem, target)
{
elem.x=target.x;
elem.y=target.y+target.h;
var offsetBox=(elem.x>=12?12:0);
var offsetLeader=(target.w/2);
elem.x=elem.x-offsetBox;
_cbdCreateLeader(elem.id, 'xLdrTop');
elem.ldrOffSetY=11;
elem.viewNode.x=elem.x;
elem.viewNode.y=elem.y;
ldrDiv=document.getElementById(elem.leaderId);
ldrDiv.style.left=elem.x+offsetLeader+"px";
ldrDiv.style.top=elem.y+"px";
}
vg.position._bottomLeft=function(elem, target)
{
elem.viewNode.x=target.x;
elem.viewNode.y=target.y+target.h;
elem.x=elem.viewNode.x;
if(elem.hasLeader)
{
if(vg.position.MIN_LINK_WIDTH >=target.w)
{
elem.viewNode.x=elem.viewNode.x+target.w/2 - vg.position.LEADER_OFFSET - vg.position.LEADER_WIDTH/2;
}
elem.x=elem.viewNode.x;
elem.ldrLoc="xLdrTop";
_cbdAddLeader(elem, target);
elem.ldrOffSetY=11;
ldrDiv=document.getElementById(elem.leaderId);
ldrDiv.style.left=elem.x+vg.position.LEADER_OFFSET+"px";
elem.viewNode.x=elem.x;
}
}
vg.position._bottomRight=function(elem, target)
{
elem.viewNode.x=target.x+target.w - elem.w;
elem.viewNode.y=target.y+target.h;
if(elem.hasLeader)
{
if(vg.position.MIN_LINK_WIDTH >=target.w)
{
elem.viewNode.x=elem.viewNode.x - target.w/2+vg.position.LEADER_OFFSET+vg.position.LEADER_WIDTH/2;
}
elem.x=elem.viewNode.x;
elem.ldrLoc="xLdrTop";
var ldrData=_cbdAddLeader(elem, target);
elem.ldrOffSetY=11;
ldrDiv=document.getElementById(elem.leaderId);
ldrDiv.style.left=elem.x+elem.w - vg.position.LEADER_WIDTH - vg.position.LEADER_OFFSET+"px";
}
}
vg.position._upperLeft=function(elem, target)
{
elem.viewNode.x=target.x - elem.w;
elem.viewNode.y=target.y;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrRgt";
_cbdAddLeader(elem, target);
elem.viewNode.y=target.y - vg.position.LEADER_OFFSET;
elem.ldrOffSetX=-1*vg.position.LEADER_HEIGHT;
}
}
vg.position._lowerLeft=function(elem, target)
{
elem.viewNode.x=target.x - elem.w;
elem.viewNode.y=target.y;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrRgt";
_cbdAddLeader(elem, target);
elem.viewNode.y=target.y - elem.h+vg.position.LEADER_OFFSET+vg.position.LEADER_WIDTH;
elem.ldrOffSetX=-1*vg.position.LEADER_HEIGHT;
}
}
vg.position._upperRight=function(elem, target)
{
elem.viewNode.x=target.x+target.w;
elem.viewNode.y=target.y;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrLft"
_cbdAddLeader(elem, target);
elem.viewNode.y=target.y - vg.position.LEADER_OFFSET;
elem.ldrOffSetX=vg.position.LEADER_HEIGHT;
}
}
vg.position._lowerRight=function(elem, target)
{
elem.viewNode.x=target.x+target.w;
elem.viewNode.y=target.y;
if(elem.hasLeader)
{
elem.ldrLoc="xLdrLft"
_cbdAddLeader(elem, target);
elem.viewNode.y=target.y - elem.h+vg.position.LEADER_OFFSET+vg.position.LEADER_WIDTH;
elem.ldrOffSetX=vg.position.LEADER_HEIGHT;
}
}
_cbdAddLeader=function(elem, target)
{
_cbdCreateLeader(elem.id, elem.ldrLoc);
return vg.html.position({elementNode:elem.leaderId, targetNode:target.viewNode, dispLoc:elem.dispLoc, infobox:elem.infobox});
}
vg.position._auto=function(elem, horzPos, target, defaultTop)
{
var bodyScrollTop=_cbdGetBodyScrollTop();
var spaceAboveTrigger=target.y_body - bodyScrollTop;
var spaceBelowTrigger=bodyScrollTop+jsCBDgetScreenHeight() -
(target.y_body+target.h);
var dispLoc;
var heightOfDisplayObj;
elem.dispLoc=null;
if(elem.viewNode&&
elem.viewNode.jsController&&
(typeof elem.viewNode.jsController.initHeight!='undefined')&&
(elem.viewNode.jsController.initHeight!=null)&&
(elem.viewNode.jsController.initHeight!='undefined')
)
{
heightOfDisplayObj=elem.viewNode.jsController.initHeight;
}
else
{
heightOfDisplayObj=elem.h;
}
if(elem.hasLeader)
{
heightOfDisplayObj=heightOfDisplayObj+26;
}
var positionBelow=(spaceBelowTrigger >=heightOfDisplayObj)
var positionAbove=(spaceAboveTrigger >=heightOfDisplayObj)
var nextGen=window.isNextGen;
if(elem.id=="form-field-info"&&nextGen)
{
if(positionBelow)
{
dispLoc='bottom';
}
else
{
dispLoc='top';
}
}
else
{
if((defaultTop&&(positionAbove||!positionBelow))||((positionAbove&&!positionBelow)) )
{
dispLoc='top';
}
else
{
dispLoc='bottom';
}
}
var scrollLeft=_cbdGetScrollLeft();
var screenWidth=vg.window.getAvailableScreenWidth();
var spaceOnLeft=(target.x+target.w) >=elem.w;
var spaceOnRight=(scrollLeft+screenWidth - target.x) > elem.w;
if(nextGen)
{
spaceOnRight=(spaceOnRight&&(vg.constants.GRID_MAIN_WIDTH - target.x) > elem.w );
}
if(spaceOnLeft&&spaceOnRight&&horzPos!=null)
{
dispLoc=dispLoc+horzPos;
}
else if(spaceOnRight)
{
dispLoc=dispLoc+'left';
}
else if(spaceOnLeft)
{
dispLoc=dispLoc+'right';
}
else
{
dispLoc=dispLoc+'left';
}
elem.dispLoc=dispLoc;
return vg.html.position(elem.viewNode, target.viewNode, dispLoc, elem.infobox, elem.hasLeader);
}
vg.html.isAncestor=function(container, node)
{
return cbd.getYUI().DOM.contains(container,node);
}
vg.html.toggleCheckBoxInputs=function(aParentContainerId, checked, enabledOnly)
{
var e=document.getElementById(aParentContainerId);
if(e)
{
var aInputArray=e.getElementsByTagName('input');
if(aInputArray)
{
var len=aInputArray.length;
for(i=0;i < len;i++)
{
var aInput=aInputArray[i];
if(aInput&&aInput.type==="checkbox")
{
if(enabledOnly&&aInput.disabled)
{
continue;
}
else
{
aInput.checked=checked;
}
}
}
}
}
}
vg.html.isElement=function(node)
{
return node.nodeType==vg.html.ELEMENT_NODE;
}
vg.html._setDimensions=function(obj)
{
var prop=vg.html.getObjSizePosition(obj.viewNode);
obj.x=prop.x;
obj.y=prop.y;
obj.h=prop.h;
obj.w=prop.w;
}
vg.html.getXMLNodeText=function(xmlNode)
{
var text="";
if(ieQuirksMode){
text=xmlNode.text;
}
else{
text=xmlNode.textContent;
}
return text;
}
vg.html.disableRightClickMenu=function(obj)
{
obj.oncontextmenu=function(){return false};
}
vg.html.position=function(elementNode, targetNode, dispLoc, infobox, leader, horzPos)
{
if(elementNode.elementNode!=null)
{
targetNode=elementNode.targetNode;
dispLoc=elementNode.dispLoc;
infobox=elementNode.infobox;
leader=elementNode.leader;
horzPos=elementNode.horzPos;
elementNode=elementNode.elementNode;
}
if(typeof infobox=="undefined")
{
infobox=false;
}
if(dispLoc)
{
dispLoc=dispLoc.toLowerCase();
}
if(infobox)
{
var globalInfoBox=vg.html.getElement(CBD_GLOBAL_INFO_BOX);
var parent=globalInfoBox.parentNode;
if(!parent.getAttribute(CBD_DYNAMIC_CSS))
{
var newDiv=document.createElement("div");
newDiv.setAttribute('id',CBD_DYNAMIC_CSS_ID);
newDiv.setAttribute(CBD_DYNAMIC_CSS,'true');
parent.removeChild(globalInfoBox);
newDiv.appendChild(globalInfoBox);
parent.appendChild(newDiv);
parent=newDiv;
}
var cssContainer=vg.html._cbdGetCSSContainer(targetNode);
vg.html.setStyle(cssContainer.className, parent);
}
var target=new Object();
target.viewNode=vg.html.getElement(targetNode);
vg.html._setDimensions(target);
target.y_body=(target.y -=_cbdGetTotalScroll(target.viewNode));
target.x -=_cbdGetTotalScrollLeft(target.viewNode);
var elemViewNode=vg.html.getElement(elementNode);
target.y+=_cbdGetScrollOffset(elemViewNode);
target.x+=_cbdGetScrollOffsetLeft(elemViewNode);
if(targetNode.inLayoutTopBorderTd&&(ie||safari))
{
target.y_body+=10;
target.y+=10;
}
var elem=new Object();
elem.viewNode=elemViewNode;
elem.viewNode=vg.html.getElement(elementNode);
elem.id=elem.viewNode.getAttribute('id');
elem.dispLoc=dispLoc;
elem.hasLeader=leader;
elem.leaderId=null;
elem.infobox=infobox;
vg.html._setDimensions(elem);
elem.y -=_cbdGetTotalScroll(elem.viewNode);
if(elem.hasLeader)
{
elem.leaderId="ldr_"+elem.id;
elem.ldrOffSetY=0;
elem.ldrOffSetX=0;
}
var dpData=new Object();
dpData.elem=elem;
dpData.target=target;
switch(dispLoc)
{
case "top":
vg.position._top(elem, target);
break;
case "right":
vg.position._right(elem, target);
break;
case "left":
vg.position._left(elem, target);
break;
case "bottom":
vg.position._bottom(elem, target);
break;
case "topleft":
vg.position._topLeft(elem, target);
break;
case "topright":
vg.position._topRight(elem, target);
break;
case "bottomleft":
vg.position._bottomLeft(elem, target);
break;
case "upperleft":
vg.position._upperLeft(elem, target);
break;
case "lowerleft":
vg.position._lowerLeft(elem, target);
break;
case "upperright":
vg.position._upperRight(elem, target);
break;
case "lowerright":
vg.position._lowerRight(elem, target);
break;
case "fixedbottom":
vg.position._fixedBottom(elem, target);
break;
case "bottomright":
vg.position._bottomRight(elem, target);
break;
case "ne":
vg.position._ne(elem, target);
break;
case "se":
vg.position._se(elem, target);
break;
case "sw":
vg.position._sw(elem, target);
break;
case "nw":
vg.position._nw(elem, target);
break;
default:
dpData=vg.position._auto(elem, horzPos, target, infobox);
dispLoc=dpData.elem.dispLoc;
}
var ances=vg.html.findAncestor(target.viewNode,{tagName:null,attrName:null}, jsCBDCheckFixedStyle);
if((ances!=null)&&(!ie))
{
elem.viewNode.style.position="fixed";
}
else if(elem.viewNode.style.position!="absolute")
{
elem.viewNode.style.position="absolute";
}
elem.x=parseInt(elem.viewNode.x);
elem.y=parseInt(elem.viewNode.y);
elem.ldrOffSetX=dpData.elem.ldrOffSetX;
elem.ldrOffSetY=dpData.elem.ldrOffSetY;
if("fixedbottom"!=dispLoc.toLowerCase())
{
elem.viewNode.style.left=elem.x+"px";
elem.viewNode.style.top=elem.y+"px";
}
dpData.elem.dispLoc=dispLoc;
dpData.elem=elem;
dpData.target=target;
return dpData;
}
vg.html.getNodeText=function(node)
{
var ret='';
for(var i=0;i < node.childNodes.length;i++)
{
if(node.childNodes[i].nodeType==3)
{
ret+=node.childNodes[i].nodeValue+' ';
}
}
return ret;
}
vg.html.getFirstChild=function(node)
{
var chNode=(vg.html.getElement(node)!=null)?vg.html.getElement(node).firstChild:null;
while(chNode!=null&&(chNode.nodeType!=1||chNode.tagName.toLowerCase()=='script' ) )
{
chNode=chNode.nextSibling;
}
return chNode;
}
vg.html.getFormElements=function(form)
{
var formElements=new Array();
vg.util.concat(formElements, form.getElementsByTagName('input'));
vg.util.concat(formElements, form.getElementsByTagName('select'));
vg.util.concat(formElements, form.getElementsByTagName('textarea'));
return formElements;
}
vg.html.addEventListenerMethod=function(node, eventType, obj, method, listenerId, filter, cfg)
{
vg.html.addEventListener(node, eventType,
function _callListenerMethod()
{
var args=Array.prototype.slice.call(arguments );
obj[method].apply(obj, args );
},
listenerId, filter, cfg );
}
vg.html.addEventListener=function(node, eventType, func, listenerId, filter, cfg)
{
node=vg.html.getElement(node );
if(listenerId!=null)
{
listenerId=vg.html._adjustListenerId(listenerId);
if(node&&(node!=window))
{
if(node[listenerId]!=null)
{
return;
}
else
{
node[listenerId]={eventType:eventType, func:func};
}
}
else
{
if(window.document[listenerId]!=null)
{
return;
}
else
{
window.document[listenerId]={eventType:eventType, func:func};
}
}
}
if(node)
{
if(!node.eventCounter)
{
node.eventCounter={};
}
if(node.eventCounter[eventType])
{
node.eventCounter[eventType]++;
}
else
{
node.eventCounter[eventType]=1;
}
}
if(eventType.indexOf('CBD_') >=0)
{
vg.html._addCustomEventListener(node, eventType, func, filter, cfg);
}
else
{
eventType=vg.html.getEventName(eventType);
if(node.addEventListener)
{
node.addEventListener(eventType, func, false);
}
else
{
node.attachEvent(eventType, func);
}
}
}
vg.html.removeEventListener=function(node, eventType, func, listenerId)
{
if(eventType.indexOf('CBD_') >=0)
{
vg.html._removeCustomEventListener(node, eventType, func);
}
else
{
eventType=vg.html.getEventName(eventType);
if(node.removeEventListener)
{
node.removeEventListener(eventType, func, false);
}
else
{
node.detachEvent(eventType, func);
}
}
if(listenerId!=null)
{
listenerId=vg.html._adjustListenerId(listenerId);
if(node&&(node!=window))
{
node[listenerId]=null;
}
else
{
window.document[listenerId]=null;
}
}
if(node)
{
if(node.eventCounter&&node.eventCounter[eventType]> 0)
{
node.eventCounter[eventType]--;
}
}
}
vg.html.removeEventListenerById=function(node, listenerId)
{
var listenerObj;
var listenerIdAdjusted=vg.html._adjustListenerId(listenerId);
if(node&&(node!=window))
{
listenerObj=node[listenerIdAdjusted];
}
else
{
listenerObj=window.document[listenerIdAdjusted];
}
if(!listenerObj)
{
return;
}
vg.html.removeEventListener(node, listenerObj.eventType, listenerObj.func, listenerId);
}
vg.html._adjustListenerId=function(listenerId)
{
listenerId+='_listener';
listenerId=listenerId.replace(':','_');
return listenerId;
}
vg.html.hasEventListeners=function(node, eventType)
{
return(node.eventCounter!=null&&
node.eventCounter[eventType]!=null&&
node.eventCounter[eventType]> 0);
}
vg.html.getEventName=function(eventName, omitOn)
{
if(eventName=='mouseenter'&&!ie)
{
eventName='mouseover';
}
else if(eventName=='mouseleave'&&!ie)
{
eventName='mouseout';
}
return ieQuirksMode&&!omitOn?'on'+eventName:eventName;
}
vg.html._addCustomEventListener=function(node, eventType, func, filter, cfg)
{
var event=null;
var YUI=cbd.getYUI();
var globalEvent=vg.event.CUSTOM_EVENTS[eventType];
if(globalEvent==null)
{
globalEvent=vg.html._createCustomEvent(eventType);
vg.event.CUSTOM_EVENTS[eventType]=globalEvent;
}
if(filter)
{
func.filter=filter;
}
if(cfg)
{
func.cfg=cfg;
}
if(node&&node!=window )
{
if(vg.event.CUSTOM_EVENTS[eventType].nodeListeners)
{
vg.event.CUSTOM_EVENTS[eventType].nodeListeners++;
}
else
{
vg.event.CUSTOM_EVENTS[eventType].nodeListeners=1;
}
if(!node.customEvents )
{
node.customEvents={};
}
event=node.customEvents[eventType];
if(event==null )
{
event=vg.html._createCustomEvent(eventType, node);
node.customEvents[eventType]=event;
}
}
vg.html._subscribe(eventType, event, node, func);
}
vg.html._subscribe=function(eventType, event, node, func)
{
var YUI=cbd.getYUI();
if(node&&node!=window)
{
if(eventType.indexOf("CBD_SYNTH_") >=0)
{
event.subscribe(func);
}
else
{
YUI.one(node).on(eventType, func);
}
}
else
{
YUI.Global.on(eventType, func);
}
}
vg.html._removeCustomEventListener=function(node, eventType, func)
{
var event, YUI=cbd.getYUI();
var globalEvent=vg.event.CUSTOM_EVENTS[eventType];
if(node&&node!=window )
{
if(globalEvent&&node.customEvents&&node.customEvents[eventType])
{
if(globalEvent.nodeListeners > 0)
{
globalEvent.nodeListeners--;
}
event=node.customEvents[eventType];
if(event&&eventType.indexOf("CBD_SYNTH_") >=0)
{
event.unsubscribe(func);
}
else
{
YUI.one(node).detach(eventType, func);
}
}
}
else if(globalEvent)
{
YUI.Global.detach(eventType, func);
}
}
vg.html._createCustomEvent=function(eventType, node)
{
if(eventType.indexOf("CBD_SYNTH_") >=0)
{
return new vg.event.SyntheticEvent(eventType, node);
}
var YUI=cbd.getYUI();
return new YUI.CustomEvent(eventType);
}
vg.html._fireCustomEvent=function(eventType, targetElement, eventData, skipGlobal )
{
targetElement=vg.html.getElement(targetElement );
var YUI=cbd.getYUI();
var nodeEvent=null;
if(targetElement
&&targetElement.customEvents
&&targetElement.customEvents[eventType])
{
nodeEvent=targetElement.customEvents[eventType];
}
if(eventData==null)
{
eventData={};
}
eventData.targetElement=targetElement;
if(nodeEvent )
{
cbd.getYUI().one(targetElement).fire(eventType, eventData);
}
var globalEvent=vg.event.CUSTOM_EVENTS[eventType];
if(targetElement&&targetElement!=window&&
globalEvent&&globalEvent.nodeListeners!=null&&globalEvent.nodeListeners > 0 )
{
var parentContainer=vg.html.findAncestor(targetElement,{}, vg.comp._isContainer );
if(parentContainer )
{
vg.html._fireCustomEvent(eventType, parentContainer, eventData, true );
}
}
if(globalEvent&&!skipGlobal)
{
if(!eventData) eventData={};
eventData.global=true;
cbd.getYUI().Global.fire(eventType, eventData);
}
}
vg.html.setDisabledAttr=function(node, value)
{
(ie)?node.disabled=value:node.setAttribute('disabled', value);
}
vg.html.getDisabledAttr=function(node)
{
return String((ie)?node.disabled:node.getAttribute('disabled'));
}
vg.html.disableTextSelect=function(node)
{
(ie)?node.onselectstart=function(){return false;}:node.style.MozUserSelect="none";
}
vg.html.getReadOnlyAttr=function(elem)
{
elem=vg.html.getElement(elem);
return elem.getAttribute('readonly');
}
vg.html.setStyle=function(className, node )
{
node.className=className;
}
vg.html.addStyle=function(className, node)
{
jsCBDaddStyle(node, className);
}
vg.html.removeStyle=function(className, node)
{
jsCBDdeleteStyle(node, className);
}
vg.html.hasStyle=function(classname, node )
{
if(node.className)
{
var arr=node.className.split(" " );
for(var i=0;i < arr.length;i++)
{
if(arr[i]==classname )
{
return true;
}
}
}
return false;
}
vg.html.hasFocus=function(node)
{
return document.activeElement==node;
}
vg.html.listStyles=function(node )
{
return node.className.split(" " );
}
vg.html.addOrRemoveStyle=function(className, node, add)
{
(add)?jsCBDaddStyle(node, className):jsCBDdeleteStyle(node, className);
}
vg.html.addOrRemoveStyleFromNodes=function(className, nodes, add)
{
for(var i=0;i < nodes.length;i++)
{
vg.html.addOrRemoveStyle(className, nodes[i], add);
}
}
vg.html.replaceClass=function(node, oldClass, newClass)
{
jsCBDdeleteStyle(node, oldClass);
jsCBDaddStyle(node, newClass);
}
vg.html.replaceClassOnNodes=function(nodes, oldClass, newClass)
{
for(var i=0;i < nodes.length;i++)
{
vg.html.replaceClass(nodes[i], oldClass, newClass);
}
}
vg.html.setCursorStyle=function(elem, style)
{
elem.style.cursor=style;
}
vg.html.setPadding=function(node, padding)
{
node.style.padding=padding;
}
vg.html.setHeight=function(node, height)
{
node.style.height=height;
}
vg.html.setWidth=function(node, width)
{
node.style.width=width;
}
vg.html.setLeft=function(node, left)
{
node.style.left=left+"px";;
}
vg.html.setOpacity=function(node, opacity, adjustZoom)
{
if(typeof adjustZoom=="undefined")
{
adjustZoom=false;
}
if(node.style.opacity===undefined)
{
if(!node.currentStyle.hasLayout)
{
node.style.zoom="1";
}
if(adjustZoom){node.style.zoom="0.9999";}
if(opacity!=null)
{
opacity=parseFloat(opacity)*100;
node.style.filter='alpha(opacity='+opacity+')';
}
else
{
node.style.filter=null;
}
}
else
{
node.style.opacity=opacity;
}
}
vg.html.getObjPadding=function(obj)
{
var domElement=vg.html.getElement(obj );
var pad={};
pad.left=parseInt(jsCBDGetComputedStylePropertyValue(domElement, "padding-left"));
pad.right=parseInt(jsCBDGetComputedStylePropertyValue(domElement, "padding-right"));
pad.top=parseInt(jsCBDGetComputedStylePropertyValue(domElement, "padding-top"));
pad.bottom=parseInt(jsCBDGetComputedStylePropertyValue(domElement, "padding-bottom"));
return pad;
}
vg.html.getObjHeight=function(obj)
{
var obj2=vg.html.getElement(obj );
var isHidden=obj2.style.display=='none';
var ret=0;
if(isHidden)
{
obj2.style.display='inline';
ret=obj2.offsetHeight;
obj2.style.display='none';
}
else
{
ret=obj2.offsetHeight;
}
return ret;
}
vg.html.getHeightOfHiddenElem=function(obj, fullHeight)
{
var obj=vg.html.getElement(obj );
var origHeight=obj.style.height;
obj.style.position="relative";
vg.html.setObjTop(obj, -5000);
vg.html.setLeft(obj, -5000);
obj.style.display="block";
if(fullHeight) obj.style.height="100%";
var contentH=obj.offsetHeight;
obj.style.display="";
obj.style.position="";
if(fullHeight) obj.style.height=origHeight;
return contentH;
}
vg.html.getSpanObjHeight=function(obj)
{
var obj2=vg.html.getElement(obj );
var dispStyle=jsCBDGetComputedStylePropertyValue(obj2, 'display');
var ret=0;
obj2.style.display=ie?'inline':((firefox)?'block':'inline-block');
ret=obj2.offsetHeight;
obj2.style.display=dispStyle;
return ret;
}
vg.html.getObjWidth=function(obj)
{
var obj2=vg.html.getElement(obj );
var isHidden=obj2.style.display=='none';
var ret=0;
if(isHidden )
{
obj2.style.display='inline';
ret=obj2.offsetWidth;
obj2.style.display='none';
}
else
{
ret=obj2.offsetWidth;
}
return ret;
}
vg.html.getObjClientWidth=function(obj)
{
var obj2=vg.html.getElement(obj );
var isHidden=obj2.style.display=='none';
var ret=0;
if(isHidden )
{
obj2.style.display='inline';
ret=obj2.clientWidth;
obj2.style.display='none';
}
else
{
ret=obj2.clientWidth;
}
return ret;
}
vg.html.getObjSizePosition=function(obj )
{
var objData=new Array();
objData.x=vg.html.getObjX(obj);
objData.y=vg.html.getObjY(obj);
var objSize=vg.html.getObjSize(obj);
objData.h=objSize.h;
objData.w=objSize.w;
return objData;
}
vg.comp.TEMP_VISIBLE_CLASS=TEMP_VISIBLE_CLASS="tempVisible";
vg.html.getObjSizeInHiddenAncestor=function(obj)
{
var objData={};
var currentNode=obj;
var currentNodeStyle;
var styleValueRegex=/none/;
while(currentNode.getAttribute("id")!="body")
{
currentNodeStyle=jsCBDGetComputedStylePropertyValue(currentNode, "display");
if(currentNodeStyle!=null)
{
if(styleValueRegex.test(currentNodeStyle))
{
vg.html.addStyle(vg.comp.TEMP_VISIBLE_CLASS, currentNode);
objData.h=vg.html.getObjHeight(obj);
objData.w=vg.html.getObjWidth(obj);
vg.html.removeStyle(vg.comp.TEMP_VISIBLE_CLASS, currentNode);
return objData;
}
}
currentNode=vg.html._getParentNode(currentNode);;
}
return{};
}
vg.html.isFixedHeight=function(node)
{
var isFixedHeight=false;
var node2=vg.html.getElement(node);
var node2Style=node2.style;
var node2Height;
if(node2Style!=null)
{
node2Height=node2Style.height;
if(node2Height!=""&&node2Height!="100%"&&node2Height!="auto")
{
isFixedHeight=true;
}
}
return isFixedHeight;
}
vg.html.isFixedWidth=function(node)
{
var isFixedWidth=false;
node=vg.html.getElement(node);
var nodeStyle=node.style;
var nodeWidth;
if(nodeStyle!=null)
{
nodeWidth=nodeStyle.width;
if(nodeWidth!=""&&nodeWidth!="100%"&&nodeWidth!="auto")
{
isFixedWidth=true;
}
}
return isFixedWidth;
}
vg.html.getObjX=function(obj, yui )
{
if(yui)
{
return cbd.getYUI().DOM.getX(obj);
}
var x=0;
while(obj!=null )
{
x+=obj.offsetLeft;
obj=obj.offsetParent;
}
return x;
}
vg.html.getObjY=function(obj, yui)
{
if(yui)
{
return cbd.getYUI().DOM.getY(obj);
}
var y=0;
while(obj!=null )
{
y+=obj.offsetTop;
obj=obj.offsetParent;
}
return y;
}
vg.html.getObjXY=function(obj, outsideWrapDiv )
{
var yuiXYpos=cbd.getYUI().DOM.getXY(obj);
var posObj={x:yuiXYpos[0], y:yuiXYpos[1]};
if(ieQuirksMode&&!outsideWrapDiv )
{
var wrapDiv=document.getElementById('wrapDiv');
if(wrapDiv )
{
posObj.y+=wrapDiv.scrollTop;
posObj.x+=wrapDiv.scrollLeft;
}
}
return posObj;
}
vg.html.findBoundary=function(node)
{
var boundaryLeft, boundaryRight, boundaryTop, boundaryBottom, width=0, height=0;
var offsetXY=vg.html.getObjXY(node);
width=node.offsetWidth;
height=node.offsetHeight;
boundaryLeft=offsetXY.x;
boundaryRight=boundaryLeft+width;
boundaryTop=offsetXY.y;
boundaryBottom=boundaryTop+height;
return{left:boundaryLeft, right:boundaryRight, top:boundaryTop, bottom:boundaryBottom};
}
vg.html.setObjTop=function(obj, value )
{
obj.style.top=value+"px";
}
vg.html.scrollToPosition=function(node,posX,posY)
{
var el=vg.html.getElement(node);
if(posX!=null) el.scrollLeft=parseInt(posX.toString().replace("px",""));
if(posY!=null) el.scrollTop=parseInt(posY.toString().replace("px",""));
}
vg.html.scrollIntoView=function(container, elem, elemHeight, elemY, amimate, scrollspeed)
{
var containerStartY=vg.html.getObjY(container)+container.scrollTop;
var containerHeight=container.scrollHeight;
var containerViewHeight=vg.html.getObjHeight(container);
var containerEndY=containerStartY+containerViewHeight;
if(elemHeight==null)
{
elemHeight=vg.html.getObjHeight(elem);
}
if(elemY==null)
{
elemY=vg.html.getObjY(elem);
}
var newScrollTop=container.scrollTop;
if(containerEndY < elemY+elemHeight)
{
newScrollTop=container.scrollTop+elemY - containerEndY+elemHeight;
}
else if(containerStartY > elemY - elemHeight)
{
newScrollTop=container.scrollTop -(containerStartY - elemY);
}
if(amimate)
{
var distance=Math.abs(newScrollTop - container.scrollTop);
var duration=1000;
var attributes={scroll:{to:[0, newScrollTop]}};
if(!scrollspeed) scrollspeed=3;
if(distance > 0&&scrollspeed > 0)
{
duration=Math.round(distance/scrollspeed);
}
if(container.anim)
{
container.anim.stop();
}
container.anim=vg.smil.animateElement({target:container, attr:attributes, duration:duration, scrollAnimation:true});
}
else
{
container.scrollTop=newScrollTop;
}
}
vg.html.scrollToElement=function(node, offset)
{
var pos=vg.html.getObjY(vg.html.getElement(node)) - offset;
vg.html.scrollPageVertical(pos);
}
vg.html._hasVerticalScrollBar=function(node)
{
return node.clientHeight < node.scrollHeight;
}
vg.html.getElement=function(target)
{
if(typeof(target)=="string")
{
return document.getElementById(target);
}
return target;
}
vg.html.findAncestor=function(node, oFilter, check, stopFilter)
{
return _cbdFindAncestor(node, oFilter, check, stopFilter);
}
vg.html.getSibling=function(node, oFilter, direction)
{
var siblingAccessor=(direction=="-"?'previousSibling':'nextSibling');
for(node=node[siblingAccessor];node!=null;node=node[siblingAccessor])
{
if(_cbdCheckNodeAttrs(node, oFilter))
{
return node;
}
}
return null;
}
vg.html.getSiblings=function(node, oFilter, direction)
{
var siblings=new Array();
var siblingAccessor=(direction=="-"?'previousSibling':'nextSibling');
for(node=node[siblingAccessor];node!=null;node=node[siblingAccessor])
{
if(_cbdCheckNodeAttrs(node, oFilter))
{
siblings.push(node);
}
}
return siblings;
}
vg.html.getElementsRec=function(ret, depth, context, oFilter, check, map )
{
if(!context||depth==0 )
{
return;
}
for(var i=0;i < context.childNodes.length;++i)
{
var node=context.childNodes[i];
if(!(node instanceof String ) )
{
var flag=true;
flag&=_cbdCheckNodeAttrs(node, oFilter );
if(flag&&check )
{
flag&=check(node );
}
if(flag )
{
if(map)
{
ret.push(map(node));
}
else
{
ret.push(node );
}
}
vg.html.getElementsRec(ret, depth - 1, node, oFilter, check, map );
}
}
}
vg.html.getElements=function(context, oFilter, check, map )
{
var elements=new Array();
var tagName=oFilter.tagName;
if(!context )
{
return elements;
}
if(oFilter.maxDepth!==undefined&&oFilter.maxDepth > 0 )
{
var ret=[];
vg.html.getElementsRec(ret, oFilter.maxDepth, context, oFilter, check, map );
return ret;
}
var nodes=vg.util.toArray(context.getElementsByTagName(tagName));
var nodesLength=nodes.length;
oFilter.tagName=null;
for(var i=0;i < nodesLength;i++)
{
var node=nodes[i];
var flag=true;
flag&=_cbdCheckNodeAttrs(node, oFilter );
if(flag&&check )
{
flag&=check(node );
}
if(flag )
{
if(map)
{
elements.push(map(node));
}
else
{
elements.push(node );
}
}
}
return elements;
}
vg.html.getFirstElementMatch=function(context, check, ancestorCheck)
{
if(!context||!check)
{
return;
}
if(check(context))
{
return context;
}
else
{
var childNodes=vg.util.toArray(context.childNodes);
var numChildren=childNodes.length;
var node=null;
for(var i=0;i < numChildren;i++)
{
var child=childNodes[i];
if(vg.html.isElement(child)&&(!ancestorCheck||(ancestorCheck&&ancestorCheck(child))))
{
node=vg.html.getFirstElementMatch(child, check, ancestorCheck );
if(node)
{
return node;
}
}
}
}
return false;
}
vg.html.findParentComponent=function(context, type )
{
var ret=null;
var search=true;
var node=vg.html.getElement(context );
while(!ret&&search )
{
if(node )
{
var matches=node.jsController!==undefined;
if(type )
{
matches=matches&&node.jsController instanceof type;
}
if(matches )
{
ret=node;
}
else
{
node=vg.html._getParentNode(node);
}
}
else
{
search=false;
}
}
return ret;
}
vg.html._getParentNode=function(node)
{
var assocParentId=node.getAttribute?node.getAttribute("associatedParentId"):null;
return assocParentId?document.getElementById(assocParentId):node.parentNode;
}
vg.html.stopEventPropagation=function(event)
{
if(event.stopPropagation)
{
event.stopPropagation();
}
else if(ie)
{
event.cancelBubble=true;
}
}
vg.html.preventDefault=function(event)
{
if(ieQuirksMode)
{
event.returnValue=false;
}
else
{
event.preventDefault();
}
}
vg.html.disableCopyPaste=function(event)
{
var event=jsCBDgetEvent(event);
var keyCode=event.keyCode;
if(event.ctrlKey&&(keyCode==67||keyCode==65||keyCode==86||keyCode==88 )||event.shiftKey&&keyCode==45)
{
if(ie)
{
event.returnValue=false;
}
else
{
event.preventDefault();
}
}
}
vg.html.isElementInView=function(elem)
{
if(elem==null)
return false;
var yPos=vg.html.getObjSizePosition(elem).y;
var scrollTop=_cbdGetScrollTop();
var winHeight=jsCBDgetScreenHeight();
var yHeight=elem.offsetHeight;
return((scrollTop < yPos)&&(yPos+yHeight+30 < scrollTop+winHeight));
}
vg.html.getSelection=function(input)
{
var obj={start:null, end:null};
input=vg.html.getElement(input );
if(!input) return;
if(input.createTextRange)
{
try
{
input.focus();
}
catch(err)
{
return obj;
}
var range=document.selection.createRange().duplicate();
var s=0;var e=0;
while(range.moveStart("character", -1)!=0 ) s++;
while(range.moveEnd("character", -1)!=0 ) e++;
obj.start=s;
obj.end=e;
}
else if(input.setSelectionRange)
{
obj.start=input.selectionStart;
obj.end=input.selectionEnd;
}
return obj;
}
vg.html.setSelection=function(input, start, end)
{
input=vg.html.getElement(input );
if(!input||start==null||end==null) return;
if(input.createTextRange)
{
var range=input.createTextRange();
range.collapse(true);
range.moveEnd('character', end);
range.moveStart('character', start);
range.select();
}
else if(input.setSelectionRange)
{
input.setSelectionRange(start, end);
}
try
{
input.focus();
}
catch(err)
{
}
}
vg.html.getContainerInputs=function(context, ret)
{
if(context.childNodes.length  < 0)
{
return;
}
var name=context.nodeName;
if(vg.html.isInput(context))
{
ret.push(context );
}
else
{
for(var i=0;i < context.childNodes.length;++i)
{
if(vg.html.isInput(context))
{
ret.push(context );
return;
}
var node=context.childNodes[i];
vg.html.getContainerInputs(node, ret );
}
}
}
vg.html.isInput=function(context)
{
var name=context.nodeName;
if(context.type!='hidden'&&
!context.disabled&&
(name=='INPUT'||name=='SELECT'||name=='TEXTAREA'||name=='A' ))
{
return true;
}
return false;
}
vg.html.isTextInput=function(context)
{
var type=context.type;
if(type==null||type=='text'||type=='')
{
return true;
}
return false;
}
vg.html.isHiddenInput=function(context)
{
var tagName=context.tagName;
if(tagName&&tagName.toLowerCase()=="input"&&context.getAttribute("type")=="hidden")
{
return true;
}
return false;
}
vg.html.scrollPageVertical=function(yPos)
{
vg.html.scrollPage(null, yPos);
}
vg.html.scrollPage=function(xPos, yPos)
{
var wrapDiv=document.getElementById('wrapDiv');
if(wrapDiv)
{
if(xPos)
{
wrapDiv.scrollLeft=xPos;
}
wrapDiv.scrollTop=yPos;
}
else
{
if(!xPos)
{
xPos=0;
}
window.scrollTo(xPos, yPos);
}
}
vg.html.getCompViewNode=function(node)
{
var containerNode=_cbdFindAncestor(node,{tagName:"span", attrName:"cmp", attrValue:"true"});
var viewNodeId=containerNode.id.replace("comp-","");
return  document.getElementById(viewNodeId);
}
vg.html.getCompSkin=function(node)
{
return vg.html._getComponentMataSpan(node, "skin");
}
vg.html.getCompType=function(node)
{
return vg.html._getComponentMataSpan(node, "type");
}
vg.html.getCompState=function(node)
{
return vg.html._getComponentMataSpan(node, "state");
}
vg.html._getComponentMataSpan=function(node, name)
{
return _cbdFindAncestor(node,{tagName:"span", attrName:"name", attrValue:name}, null,{tagName:"span", attrName:"cmp", attrValue:"true"});
}
vg.conf=function()
{
this.options={};
this.optionNames=[];
}
vg.conf.prototype.add=function(name, value )
{
if(!this.options[name])
{
this.optionNames.push(name );
}
this.options[name]=value;
return this;
}
vg.conf.prototype.setOptions=function(obj )
{
for(var i=0;i < this.optionNames.length;i++)
{
var name=this.optionNames[i];
obj[name]=this.options[name];
}
}
vg.util.toArray=function(items)
{
try{
return Array.prototype.slice.call(items);
}catch(ex){
var i=0,
len=items.length,
result=Array(len);
while(i<len){
result[i]=items[i];
i++;
}
}
return result;
}
vg.util._removeIEfilterProp=function(element)
{
if(ie)
{
element.style.removeAttribute('filter');
}
}
vg.util.loadJavaScriptFile=function(file, contentDomain)
{
var filePath=file+plsVersionQueryStr;
if(contentDomain)
{
var contDomain=(_cbdContentDomain)?_cbdContentDomain:jsContDomain;
filePath=contDomain+filePath;
}
jsCBDloadScript(filePath);
}
vg.util.getMousePos=function(e)
{
var mouse={};
mouse.x=e.clientX+_cbdGetScrollLeft();
mouse.y=e.clientY+_cbdGetScrollTop();
return mouse;
}
vg.util.getMousePosRelativeToElem=function(ev, elem)
{
var elemPos=vg.html.getObjXY(elem);
var mousePos=vg.util.getMousePos(ev);
mousePos.x -=elemPos.x;
mousePos.y -=elemPos.y;
return mousePos;
}
vg.util.testNSFunc=function(){
_debug("log", "Hosting-App vg object");
}
vg.util.setTimeout=function(func, timeDelay){
vg.delayedEvents++;
return setTimeout(function(){vg.util.execFunc(func);vg.delayedEvents--;}, timeDelay);
}
vg.util.execFunc=function(func, args)
{
_cbdExecuteFunc(func, args);
}
vg.util.disableTextSelection=function(event)
{
var event=jsCBDgetEvent(event );
if(ie)
{
event.returnValue=false;
}
else
{
el.style['-moz-user-select']='none';
}
}
vg.util.getHTMLbodyHeight=function()
{
var wDiv=vg.html.getElement('wrapDiv');
if(wDiv!=null)
{
return(wDiv.clientHeight >=wDiv.scrollHeight)?wDiv.clientHeight+'px':wDiv.scrollHeight+'px';
}
return cbd.getYUI().DOM.docHeight()+'px';
}
vg.util.getHTMLbodyWidth=function()
{
var elem=vg.html.getElement('wrapDiv');
if(elem)
{
return elem.scrollWidth+'px';
}
return(ie)?document.body.scrollWidth+'px':document.documentElement.scrollWidth+'px';
}
vg.util.hasScrollBar=function(elem)
{
return(elem.clientHeight < elem.scrollHeight);
}
vg.util.hasHorizScrollBar=function(elem)
{
return(elem.clientWidth < elem.scrollWidth);
}
vg.util.getHTMLbodyScrollTop=function()
{
var wDiv=vg.html.getElement('wrapDiv');
if(wDiv!=null)
{
return(wDiv.scrollTop);
}
return document.body.scrollTop;
}
vg.util.setHTMLbodyScrollTop=function(scrollTopPos)
{
var wDiv=vg.html.getElement('wrapDiv');
if(wDiv!=null)
{
wDiv.scrollTop=scrollTopPos;
}
else
{
document.body.scrollTop=scrollTopPos;
}
}
vg.util.removeTags=function(s)
{
return String(s).replace(/<\/?[^>]+>/gi, "");
}
vg.util.concat=function(array1, array2)
{
for(var i=0;i < array2.length;i++)
{
array1.push(array2[i])
}
}
vg.util.isEmpty=function(s){
return(!isEmpty(s))?(s.replace(/\s/g,'')==''):true;
}
vg.util.isJSONEmpty=function(json)
{
for(var attr in json )
{
return false;
}
return true;
}
vg.util.hasAttribute=function(elem, attrName){
return!(vg.util.isEmpty(elem.getAttribute(checkAttrName(attrName, elem))));
}
vg.util.execOnPageReady=function(func)
{
if(RIA)
{
cbd.loader.addCallback(func);
cbd.loader.load();
}
else
{
if(_cbdNonRiaPageReady)
{
func();
}
else
{
vg.html.addEventListener(window, 'load', func);
}
}
}
vg.util.checkConditionsAndExecute=function(conditions, func, trials)
{
_cbdCheckConditionsAndExecute(conditions, func, trials)
}
vg.util.isDefined=function(variable)
{
return(typeof variable!='undefined');
}
vg.util.throwException=function(methodName, error)
{
throw("Method name:"+methodName+";Error:"+error);
}
vg.util.attachJsonOptions=function(obj, opts )
{
for(var i in opts )
{
var opt=opts[i];
obj[i]=opt;
}
}
vg.util.deepAttachOptions=function(obj, opts )
{
for(var i in opts )
{
var opt=opts[i];
if(opt instanceof Array)
{
if(!obj[i])
{
obj[i]=new Array();
}
vg.util.deepAttachOptions(obj[i], opt);
}
else if(opt instanceof Object&&!(opt instanceof Function))
{
if(!(obj[i]instanceof Object))
{
obj[i]=new Object();
}
vg.util.deepAttachOptions(obj[i], opt);
}
else
{
obj[i]=opt;
}
}
}
vg.util.updateCSRFToken=function(token)
{
if(!token)
{
return;
}
var tokenInput,
inputList=vg.util.toArray(document.getElementsByName("ANTI_CSRF_TOKEN")),
inputListLength=inputList.length;
for(var i=0;i < inputListLength;i++)
{
tokenInput=inputList[i];
if(vg.html.isHiddenInput(tokenInput))
{
tokenInput.value=token;
}
}
}
vg.comp.inheritPrototype=function(Child, Parent)
{
var EmptyFunc=function(){};
EmptyFunc.prototype=Parent.prototype;
Child.prototype=new EmptyFunc();
}
vg.util.copyJsonOptions=function(opts )
{
var obj;
if(opts instanceof Array )
{
obj=new Array();
}
else
{
obj=new Object();
}
for(var i in opts )
{
if(opts[i]instanceof Object)
{
obj[i]=vg.util.copyJsonOptions(opts[i]);
}
else
{
obj[i]=opts[i];
}
}
return obj;
}
vg.util.createNameValObj=function(name, value )
{
return{name:name, value:value};
}
vg.util.buildBooleanTable=function(data )
{
var table=[];
for(var i=0;i < data.length;i++)
{
var row=data[i];
var bools=row[0];
var val=row[1];
var arr=table;
for(var j=0;j < bools.length;j++)
{
var flag=bools[j];
var idx=(flag?1:0 );
if(arr[idx]==null )
{
if(j+1==bools.length )
{
arr[idx]=val;
}
else
{
arr[idx]=[];
}
}
arr=arr[idx];
}
}
return table;
}
vg.util.getBooleanTableValue=function(table, bools )
{
var ptr=table;
for(var i=0;i < bools.length;i++)
{
ptr=ptr[bools[i]?1:0];
}
return ptr;
}
vg.util._convertToString=function(obj)
{
var type=typeof(obj);
if(type=="string")
{
var delim=obj.indexOf("'") < 0?"'":"\"";
obj=obj.replace(/\n/g, ' ');
return delim+obj+delim;
}
else if(type!="object")
{
return obj;
}
str="";
if(obj instanceof Array)
{
str="[";
for(var i=0;i < obj.length;++i)
{
if(i > 0)
{
str+=",";
}
str+=vg.util._convertToString(obj[i]);
}
str+="]";
}
else if(type=="object")
{
str="{";
var i=0;
for(var p in obj)
{
if(i++> 0)
{
str+=",";
}
var propName=p.replace(/\./g, '_');
str+=(propName+":");
str+=vg.util._convertToString(obj[p]);
}
str+="}";
}
return str;
}
vg.util._isRelativeUrl=function(url)
{
return url.indexOf(":/") < 0&&url.indexOf('/')==0;
}
vg.window.getAvailableScreenHeight=function()
{
var wrapDiv=vg.html.getElement('wrapDiv');
if(wrapDiv)
{
return vg.html.getElement('wrapDiv').clientHeight;
}
return cbd.getYUI().one("body").get("winHeight");
}
vg.window.getAvailableScreenWidth=function()
{
var wrapDiv=vg.html.getElement('wrapDiv');
if(wrapDiv)
{
return vg.html.getElement('wrapDiv').clientWidth;
}
return cbd.getYUI().one("body").get("winWidth");
}
vg.string.startsWith=function(str, c)
{
return str.charAt(0)==c;
}
vg.string.startsWithStr=function(str, strToMatch)
{
return(str.match("^"+strToMatch)==strToMatch)
}
vg.smil.isLoaded=function()
{
return cbd.getYUI()&&cbd.getYUI().Anim;
}
vg.smil.convertUnits=function(t )
{
var res=vg.smil.convertUnits.re.exec(t );
var ret=1;
if(res!=null )
{
if(res[1]=="-" )
{
ret=-1;
}
ret*=parseInt(res[2]);
if(res[3]=="s" )
{
ret*=1000;
}
}
return ret;
}
vg.smil.convertUnits.re=new RegExp("([\\+\\-]?)(\\d+)(ms|s|\\%)?" );
vg.smil.EASE_IN="easeIn";
vg.smil.getEasing=function(easingStr)
{
return cbd.getYUI().Easing[easingStr];
}
vg.smil.Animation=function(target, attr, duration, beginTime, frompoint, topoint, bypoint, funcFinished, easeIn, colorAnimation, motionAnimation, scrollAnimation, easing, disableGeoChangedEvent)
{
if(target.target!=null)
{
var params=target;
target=params.target;
attr=params.attr;
duration=params.duration;
beginTime=params.beginTime;
frompoint=params.frompoint;
topoint=params.topoint;
bypoint=params.bypoint;
funcFinished=params.funcFinished;
easeIn=params.easeIn;
colorAnimation=params.colorAnimation;
motionAnimation=params.motionAnimation;
scrollAnimation=params.scrollAnimation;
easing=params.easing;
}
this.duration=duration;
this.beginTime=beginTime;
this.attributes={from:{}, to:{}, by:{}};
this.stopped=false;
this.ready=false;
this.colorAnimation=colorAnimation;
this.motionAnimation=motionAnimation;
this.scrollAnimation=scrollAnimation;
var attrProps;
if(!easing&&easeIn)
{
easing=vg.smil.EASE_IN;
}
if(typeof(attr )=='string' )
{
if(frompoint!==undefined&&frompoint!=null ){this.attributes.from[attr]=frompoint}
if(topoint!==undefined&&topoint!=null ){this.attributes.to[attr]=topoint}
if(bypoint!==undefined&&bypoint!=null ){this.attributes.by[attr]=bypoint}
}
else if(typeof(attr )=='object'&&(!vg.util.isDefined(attr.from)&&!vg.util.isDefined(attr.to)&&!vg.util.isDefined(attr.by) ) )
{
for(var i in attr )
{
attrProps=attr[i];
if(!attrProps) continue;
attrProps.unit=attrProps.unit||"";
if(attrProps.to!==undefined)
{
this.attributes.to[i]=attrProps.to+attrProps.unit;
}
if(attrProps.from!==undefined)
{
this.attributes.from[i]=attrProps.from+attrProps.unit;
}
if(attrProps.by!==undefined)
{
this.attributes.by[i]=attrProps.by+attrProps.unit;
}
}
}
else
{
this.attributes=attr;
}
if(colorAnimation&&vg.util.isJSONEmpty(this.attributes.from))
{
for(var i in this.attributes.to)
{
if(i.toLowerCase().indexOf("color") > -1&&cbd.getYUI().one(target).getComputedStyle(i).toLowerCase()==="transparent")
{
this.attributes.from[i]="rgb(255, 255, 255)";
}
}
}
var THIS=this;
cbd.loader.loadAndExec('anim', function(){THIS.init(vg.html.getElement(target), THIS.attributes, funcFinished, easing, disableGeoChangedEvent);}, true );
}
vg.smil.Animation.prototype.init=function(target, attr, funcFinished, easing, disableGeoChangedEvent)
{
if(typeof(easing)=='string')
{
easing=vg.smil.getEasing(easing);
}
var YUI=cbd.getYUI();
this.anim=new YUI.Anim({
node:target,
from:attr.from,
to:attr.to,
by:attr.by,
easing:easing,
duration:this.duration/1000
})
if(!this.colorAnimation&&!disableGeoChangedEvent)
{
var targetElement=vg.html.getElement(target );
this.addOnFinish(function smil_geo_change(){vg.html._fireCustomEvent(vg.event.GEO_CHANGE, targetElement );});
}
if(funcFinished )
{
this.addOnFinish(funcFinished );
}
this.ready=true;
this.anim.run();
}
vg.smil.Animation.prototype.timeElapsed=function()
{
return new Date().getTime() - this.anim.get("startTime");
}
vg.smil.Animation.prototype.stop=function()
{
this.stopped=true;
this.anim.stop(false );
}
vg.smil.Animation.prototype.start=function()
{
var THIS=this;
setTimeout(
function vg_smil_start_timeout()
{
vg.util.checkConditionsAndExecute(
function vg_smil_check_anim_loaded()
{
return THIS.ready;
},
function vg_smil_start()
{
THIS.anim.animate();
}
);
}, THIS.beginTime );
}
vg.smil.Animation.prototype.duringAnimation=function(func )
{
var THIS=this;
this.anim.on("tween",  function anim_onTween(){if(!THIS.stopped ){func();}});
}
vg.smil.Animation.prototype.addOnFinish=function(func )
{
var THIS=this;
this.anim.on("end",
function anim_onComplete()
{
if(!THIS.stopped )
{
func();
}
}
);
}
vg.smil.Animation.prototype.setEase=function(name )
{
var easing=cbd.getYUI().Easing[name];
if(easing )
{
this.anim.method=easing;
}
}
vg.smil.animateElement=function(element, attr, duration, beginTime, frompoint, topoint, bypoint, funcFinished, easeIn, colorAnimation, motionAnimation, scrollAnimation, easing, disableGeoChangedEvent)
{
var anim=new vg.smil.Animation(element, attr, duration, beginTime, frompoint, topoint, bypoint, funcFinished, easeIn, colorAnimation, motionAnimation, scrollAnimation, easing, disableGeoChangedEvent);
return anim;
}
vg.smil.animateText=function(textNode, frompoint, topoint, duration)
{
var attributes={left:{from:frompoint, to:topoint}};
return vg.smil.animateElement({target:textNode, attr:attributes, duration:duration});
}
vg.smil.cbdFadeIn=function(node, time, callback)
{
jsCBDtoggleElement(node, true);
vg.smil.animateElement(node, 'opacity', time, 0, 0, 1, null, callback);
}
vg.smil.cbdFadeOut=function(node, time, callback)
{
vg.smil.animateElement(node, 'opacity', time, 0, 1, 0, null,
function()
{
vg.html.setOpacity(node,1);
jsCBDtoggleElement(node, false);
if(callback!=undefined)
{
callback();
}
});
}
vg.MouseManager=function(config)
{
vg.util.attachJsonOptions(this, config);
this.inElement=false;
vg.html.addEventListenerMethod(this.element, 'mouseleave', this, 'mouseLeave' );
vg.html.addEventListenerMethod(this.element, 'mouseenter', this, 'mouseEnter' );
}
vg.MouseManager.prototype.mouseEnter=function(e)
{
this.inElement=true;
var controller=this;
var event=jsCBDgetEvent(e, true);
if(this.mouseEnterTimer!=null)
{
clearTimeout(this.mouseEnterTimer);
}
this.mouseEnterTimer=setTimeout(function()
{
controller.checkMouseIn(event);
},
10);
}
vg.MouseManager.prototype.mouseLeave=function(e)
{
this.inElement=false;
var controller=this;
var event=jsCBDgetEvent(e, true);
if(this.mouseLeaveTimer!=null)
{
clearTimeout(this.mouseLeaveTimer);
}
this.mouseLeaveTimer=setTimeout(function()
{
controller.checkMouseOut(event);
},
100);
}
vg.MouseManager.prototype.checkMouseIn=function(e)
{
if(this.inElement)
{
this.onMouseEnter(e);
}
}
vg.MouseManager.prototype.checkMouseOut=function(e)
{
if(!this.inElement)
{
this.onMouseLeave(e);
}
}
vg.ElementPersistance=function(obj )
{
vg.util.attachJsonOptions(this, obj );
this.onlink=false;
this.openflag=false;
this.pendingTimeouts=[];
this.inLayer=false;
this.globalDiv.persistObj=this;
vg.html.addEventListenerMethod(this.globalDiv, 'mouseleave', this, 'globalOut' );
vg.html.addEventListenerMethod(this.globalDiv, 'mouseenter', this, 'globalIn' );
}
vg.ElementPersistance.openInstance;
vg.ElementPersistance.mouseLinkEnter=function(id, link, targetPosition)
{
var THIS=document.getElementById(id ).persistObj;
if(THIS!=null)
{
if(THIS.setTarget )
{
THIS.setTarget(link.getAttribute('id' ) );
}
var controller=THIS.controller;
if(targetPosition&&controller)
{
controller.targetPosition=targetPosition;
}
THIS.id=id;
THIS.linkIn();
}
}
vg.ElementPersistance.mouseLinkLeave=function(id )
{
var THIS=document.getElementById(id ).persistObj;
if(THIS!=null)
{
THIS.linkOut();
}
}
vg.ElementPersistance.prototype.addLinkNode=function(node )
{
node=vg.html.getElement(node );
vg.html.addEventListenerMethod(node, 'mouseenter', this, 'linkIn' );
vg.html.addEventListenerMethod(node, 'mouseleave', this, 'linkOut' );
}
vg.ElementPersistance.prototype.linkIn=function(e )
{
this.onlink=true;
this.clearTimeouts();
if(this.openflag )
{
var cont=vg.comp.getController(this.id);
if(cont!=null&&cont.isUrlChanged)
{
cont.loadContent();
}
else if(this.repositionFunc )
{
this.repositionFunc();
}
}
else
{
this.delayThenOpen(e);
}
}
vg.ElementPersistance.prototype.delayThenOpen=function(e )
{
var THIS=this;
var event=e;
var openTimeout=window.isNextGen?250:500;
this.pendingTimeouts.push(setTimeout(function()
{
var instance=vg.ElementPersistance.openInstance;
if(instance&&instance!=THIS)
{
instance.clearTimeouts();
instance.checkClose();
}
vg.ElementPersistance.openInstance=THIS;
THIS.openflag=true;
THIS.openFunc(event );
}, openTimeout ) );
}
vg.ElementPersistance.prototype.linkOut=function(e )
{
this.onlink=false;
this.clearTimeouts();
this.delayThenClose();
}
vg.ElementPersistance.prototype.delayThenClose=function()
{
var THIS=this;
var closeTimeout=window.isNextGen?500:200;
this.pendingTimeouts.push(setTimeout(function(){THIS.checkClose();}, closeTimeout ) );
}
vg.ElementPersistance.prototype.globalOut=function(e )
{
if(window.isNextGen&&this.withinBoundaries(e))
{
return;
}
this.inLayer=false;
this.clearTimeouts();
this.delayThenClose();
}
vg.ElementPersistance.prototype.withinBoundaries=function(e)
{
var eventPos=vg.util.getMousePos(e);
var divProp=this.globalDiv.style;
var left=parseFloat(divProp.left);
var top=parseFloat(divProp.top);
var width=parseFloat(divProp.width);
var height=parseFloat(divProp.height);
if(eventPos.x > left&&eventPos.x <(left+width)
&&eventPos.y > top&&eventPos.y <(top+height))
{
return true;
}
return false;
}
vg.ElementPersistance.prototype.globalIn=function(e )
{
this.inLayer=true;
}
vg.ElementPersistance.prototype.checkClose=function()
{
if(!this.onlink&&this.inLayer==false )
{
this.openflag=false;
this.closeFunc();
}
}
vg.ElementPersistance.prototype.clearTimeouts=function()
{
for(var i=0;i < this.pendingTimeouts.length;i++)
{
clearTimeout(this.pendingTimeouts[i]);
}
this.pendingTimeouts=[];
}
vg.comp._isCompReady=function(target)
{
return vg.comp._hasController(target);
}
vg.comp._hasController=function(node, type )
{
if(!node )
{
return false;
}
node=vg.html.getElement(node );
if(!node )
{
return false;
}
var isDefined=typeof(node.jsController )!='undefined';
if(type )
{
return isDefined&&(node.jsController instanceof type);
}
return isDefined;
}
vg.comp._isContainer=function(node )
{
if(!node )
{
return false;
}
node=vg.html.getElement(node );
var isDefined=typeof(node.jsController )!='undefined';
if(!isDefined )
{
return false;
}
var isContainer=false;
isContainer=isContainer||(window.NavBox&&node.jsController instanceof NavBox );
isContainer=isContainer||(vg.Layer&&node.jsController instanceof vg.Layer );
isContainer=isContainer||(window.SideTab&&node.jsController instanceof SideTab );
isContainer=isContainer||(window.Deck&&node.jsController instanceof Deck );
isContainer=isContainer||(window.AccordionItem&&node.jsController instanceof AccordionItem );
isContainer=isContainer||(window.cbd.DeckPlayer&&node.jsController instanceof cbd.DeckPlayer );
isContainer=isContainer||(window.vg.Div&&node.jsController instanceof vg.Div );
isContainer=isContainer||(window.vg.Container&&node.jsController instanceof vg.Container );
return isContainer;
}
vg.comp.findController=function(target, startFromParent)
{
var node=vg.html.getElement(target);
if(startFromParent)
{
node=node.parentNode;
}
var jsController;
do
{
jsController=vg.comp.getController(node);
if(jsController!=null)
{
return jsController;
}
node=vg.html._getParentNode(node);
}while(node!=null)
}
vg.comp.callMethod=function(target, methodName, args)
{
var controller=vg.comp.getController(target);
controller[methodName].call(controller, args);
}
vg.comp.applyMethod=function(target, methodName, args, compType)
{
if(args==undefined)
{
args=[];
}
var controller=vg.comp.getController(target, compType);
controller[methodName].apply(controller, args);
}
vg.comp._execEventHandler=function(attrValue, node)
{
var thisRef=node;
var pattern=/([\,\:\s\(]{1})this([\,\s\.\)]{1})/g;
attrValue=attrValue.replace(pattern,"$1thisRef$2");
attrValue=attrValue.replace(/return false;?$/g,'');
return eval(attrValue);
}
vg.comp.findHiddenComponents=function(base )
{
var inputs=new Array;
var spans=base.getElementsByTagName('span' );
for(var i=0;i < spans.length;i++)
{
inputs.push(spans[i]);
}
var divs=base.getElementsByTagName('div' );
for(var i=0;i < divs.length;i++)
{
inputs.push(divs[i]);
}
return inputs;
}
vg.comp.repaintSubComponents=function(base )
{
var inputs=vg.comp.findHiddenComponents(base );
for(var i=0;i < inputs.length;i++)
{
var node=inputs[i];
var height=node.style.height;
node.style.height='1px';
node.style.height=height;
}
}
vg.comp.getController=function(target, compType)
{
var viewNode=vg.html.getElement(target);
if(viewNode==null)
{
return null;
}
if(!viewNode.jsControllers)
{
return null;
}
return viewNode.jsControllers[compType!=null?compType:"D"];
}
vg.comp._removeController=function(target, compType)
{
var viewNode=vg.html.getElement(target);
if(viewNode!=null&&viewNode.jsControllers)
{
delete viewNode.jsControllers[compType!=null?compType:"D"];
if(viewNode.jsController)
{
viewNode.jsController=null;
}
}
}
vg.comp.getContentNode=function(target)
{
return vg.comp.getController(target).contentNode;
}
vg.comp._hideAllItems=function(items)
{
var length=items.length;
for(var i=0;i < length;i++)
{
jsCBDtoggleElement(items[i].viewNode, false);
}
}
vg.comp._registeredComps=new Array();
vg.comp._registerComponent=function(compName)
{
vg.comp._registeredComps[compName.toLowerCase()]=true;
}
vg.comp._isCompRegistered=function(compName)
{
return vg.comp._registeredComps[compName.toLowerCase()];
}
vg.comp._configureHiddenItems=function(node)
{
vg.comp._configureSlider(node);
}
vg.comp._configureSlider=function(node)
{
var oSliders=vg.html.getElements(node,{tagName:'div', attrName:'class', attrValue:'vgSlider'});
var sliderController;
for(var i=0;oSliders!=null&&i < oSliders.length;i++)
{
var slider=vg.html.getElements(oSliders[i],{tagName:'input'});
sliderController=vg.comp.getController(slider[0]);
if(sliderController!=null)
{
if(cbd.loader.isPageReady())
{
sliderController.show();
}
else
{
vg.util.execOnPageReady(function(){sliderController.show()});
}
}
}
}
vg.comp.isCompLoaded=function(name )
{
return window[name]!=null;
}
vg.comp.getButtonFromNode=function(node)
{
var buttonNode=vg.html.findAncestor(node,{tagName:"span", attrName:"type", attrValue:"button"});
return buttonNode;
}
vg.comp.trackCommandComponent=function(comp)
{
_trackSubmitButton(comp);
}
vg.comp.isCommandComp=function(element)
{
return _cbdIsButton(element)||vg.comp.isCommandLink(element)||vg.comp.isActionable(element);
}
vg.comp.isCommandLink=function(element)
{
return element.getAttribute&&(element.getAttribute("comp")=="CommandLink");
}
vg.comp.isActionable=function(element)
{
return element.getAttribute&&(element.getAttribute("actionable")=="true");
}
vg.comp.trackCommandComp=function(formId, value)
{
_cbdSetButtonHiddenInput(formId, value);
}
vg.comp.initFloodlightFrame=function()
{
var floodFrame=document.getElementById("floodIframe");
if(floodFrame)
{
if(vg.comp._floodFrameSrc)
{
floodFrame.src=vg.comp._floodFrameSrc;
}
}
}
vg.comp.destroy=function(target)
{
vg.comp._destroyComp(target);
var spans=target.getElementsByTagName('span');
var size=spans.length;
for(var i=0;i < size;i++)
{
vg.comp._destroyComp(spans[i]);
}
}
vg.comp._destroyComp=function(elem)
{
if(elem!=null)
{
var viewNode=elem.viewNode?elem.viewNode:elem;
var controllers=viewNode.jsControllers;
if(controllers!=null)
{
for(j in controllers)
{
if(controllers[j]._destroy!=null)
{
controllers[j]._destroy();
}
}
}
}
}
vg.comp.contentUpdated=function(target)
{
vg.comp._contentUpdated(target);
}
vg.comp._contentUpdated=function(target)
{
var cont=vg.comp.getController(target);
if(cont!=null&&cont._contentUpdated!=null)
{
cont._contentUpdated();
}
if(window.openLayers!=null&&window.openLayers.length!=0)
{
var layer=vg.html.findAncestor(target,{tagName:'span', attrName:'type', attrValue:'Layer'})
cont=vg.comp.getController(vg.html.getFirstChild(layer));
if(cont!=null&&cont._contentUpdated!=null)
{
cont._contentUpdated();
}
}
}
vg.comp._setInternal=function(target)
{
var parentContainer=vg.html.findAncestor(target,{tagName:'div', attrName:'class', attrValue:/ng-layer/});
var firstChild=vg.html.getFirstChild(parentContainer);
var cont=vg.comp.getController(parentContainer);
if(cont!=null)
{
if(window._cbdIsInternal==true)
{
cont._setInternal(true);
window._cbdIsInternal=null;
}
else if(!vg.html.hasStyle('intCmp',firstChild))
{
cont._setInternal(false);
}
}
}
vg.comp.setInternalFlag=function()
{
window._cbdIsInternal=true;
}
vg.comp.getComponentIds=function(context, compType, check)
{
if(vg.constants)
{
var getElementId=function(element){return element.id.replace(vg.constants.COMP_ID_PFX,"");};
return vg.html.getElements(context,
{tagName:"span", attrName:"type", attrValue:compType},
(check)?function(element){
return check(getElementId(element));
}:
null,
function(element){
return getElementId(element);
}
);
}
}
vg.comp.getCompViewNodes=function(context, compType, check)
{
return vg.html.getElements(context,{tagName:"span", attrName:"type", attrValue:compType}, check, vg.html.getFirstChild);
}
vg.comp.getSelectedInputLabels=function(context, id)
{
var check=function(element){
var attrs=element.attributes;
return(attrs['name'].value==id)&&element.checked;
}
var map=function(element){
var attrs=element.attributes;
return attrs['label'].value;
}
return vg.html.getElements(context,{tagName:'input'}, check, map);
}
vg.Controller=function(viewNodeId, contentNode, jsTransient, compType)
{
if(viewNodeId.viewNodeId!=null)
{
contentNode=viewNodeId.contentNode;
jsTransient=viewNodeId.jsTransient;
compType=viewNodeId.compType;
viewNodeId=viewNodeId.viewNodeId;
}
this.viewNode=vg.html._getElementWithIdPrefixes(viewNodeId);
if(!this.viewNode )
{
if(jsTransient)
{
return;
}
else
{
console.error('Invalid viewNode id='+viewNodeId );
return;
}
}
for(var parent=this.viewNode.parentNode, i=0;
parent!=null&&i < 3;
parent=parent.parentNode, i++)
{
var parentId=parent.getAttribute('id');
if(parentId!=null&&parentId.indexOf('comp-') > -1)
{
parent.viewNode=this.viewNode;
break;
}
}
this.contentNode=contentNode;
if(this.viewNode&&!this.viewNode.jsControllers)
{
this.viewNode.jsControllers=new Array();
}
if(compType)
{
this.viewNode.jsControllers[compType]=this;
}
else
{
this.viewNode.jsControllers["D"]=this;
this.viewNode.jsController=this.viewNode.jsControllers["D"];
}
}
vg.Controller.prototype=
{
getController:function()
{
return this.jsController;
},
getViewNode:function()
{
return this.viewNode;
},
setStatusFromHistory:function(status )
{
}
}
vg.button.BUTTON_DEFAULT_STYLE=BUTTON_DEFAULT_STYLE="default";
vg.button.BUTTON_HIGHLIGHT_STYLE=BUTTON_HIGHLIGHT_STYLE="hover";
vg.button.BUTTON_ACTIVE=BUTTON_ACTIVE="press";
vg.button.BUTTON_INPUT_CLASS=BUTTON_INPUT_CLASS="btn";
vg.button._getSpan=function(button)
{
return vg.html.getFirstChild(vg.html.getElement(button));
}
vg.button._mouseInOut=function(selected, button)
{
var isDisabled=vg.button._isDisabled(button);
var span=vg.button._getSpan(button);
if(selected&&!isDisabled)
{
vg.html.replaceClass(span, vg.button.BUTTON_DEFAULT_STYLE, vg.button.BUTTON_HIGHLIGHT_STYLE)
}
else
{
jsCBDdeleteStyle(span, vg.button.BUTTON_ACTIVE);
if(!isDisabled)
{
vg.html.replaceClass(span, vg.button.BUTTON_HIGHLIGHT_STYLE, vg.button.BUTTON_DEFAULT_STYLE);
}
}
}
vg.button._isDisabled=function(button)
{
var buttonChildren=vg.html.getElements(button,{tagName:'input', attrName:'class'}, function(input){return vg.html.hasStyle(vg.button.BUTTON_INPUT_CLASS, input);});
var buttonInput=buttonChildren[0];
var disabled='false';
if(buttonInput)
{
disabled=buttonInput.getAttribute('disabledBtn');
}
return(disabled=='true'||disabled=='disabled');
}
vg.button._select=function(selected, button, event)
{
var key=jsCBDgetKey(jsCBDgetEvent(event));
var isDisabled=vg.button._isDisabled(button);
if((key==9||key==16)&&!isDisabled)
{
selected=false;
}
var span=vg.button._getSpan(button);
if(selected)
{
jsCBDaddStyle(span, vg.button.BUTTON_ACTIVE);
if(!isDisabled)
{
vg.html.replaceClass(span, vg.button.BUTTON_HIGHLIGHT_STYLE, vg.button.BUTTON_DEFAULT_STYLE);
}
}
else
{
jsCBDdeleteStyle(span, vg.button.BUTTON_ACTIVE);
}
}
vg.button._focus=function(button)
{
var span=vg.button._getSpan(button);
}
vg.button._blur=function(button)
{
var span=vg.button._getSpan(button);
jsCBDdeleteStyle(span, vg.button.BUTTON_ACTIVE);
}
vg.button._disable=function(button, state)
{
var disableValue=(state)?"disabled":"false";
var span=vg.button._getSpan(button);
if(!button.getAttribute("intDisabledCobrowsable") )
{
(state)?jsCBDaddStyle(span, "disabled"):jsCBDdeleteStyle(span, "disabled");
}
var oldClass=null;
var newClass=null;
var elem=vg.html.getFirstChild(span);
if(!window.isNextGen)
{
elem=vg.html.getFirstChild(elem);
}
oldClass=(state)?'default':'disabled';
newClass=(state)?'disabled':'default';
vg.html.replaceClass(elem, oldClass, newClass);
var buttonChildren=vg.html.getElements(button,{tagName:'input', attrName:'class'}, function(input){return vg.html.hasStyle(vg.button.BUTTON_INPUT_CLASS, input);});
var buttonInput=buttonChildren[0];
(state)?buttonInput.setAttribute("disabledBtn", disableValue):buttonInput.removeAttribute("disabledBtn");
var inpId=button.getAttribute('id');
jsCBDcreateHiddenInput(inpId, state, inpId, button.parentNode);
if(window.isNextGen)
{
if(state)
{
buttonInput.setAttribute("tabindex", "-1");
}
else
{
var initialTabindex=buttonInput.getAttribute('initialtabindex');
if(!vg.util.isEmpty(initialTabindex) )
{
buttonInput.setAttribute("tabindex", initialTabindex);
}
else
{
buttonInput.removeAttribute("tabindex");
}
}
}
}
vg.button._handleClick=function(event, button, suppressErrorLayer)
{
if(vg.button._isDisabled(button))
{
return false;
}
if(button&&button.tagName&&button.getAttribute("intdisabledcobrowsable")=='true')
{
return false;
}
event=jsCBDgetEvent(event );
var onClickAttr=button.getAttribute('clickJs');
var thisRef=button;
if(onClickAttr!=null)
{
vg.comp._execEventHandler(onClickAttr, thisRef);
}
if(!button.getAttribute('blockSubmit'))
{
vg.button._submit(button, suppressErrorLayer);
}
}
vg.button._keyPress=function(e, button)
{
button=vg.html.getElement(button);
e=jsCBDgetEvent(e);
var key=jsCBDgetKey(e);
if(key==9 )
{
var span=vg.html.getFirstChild(vg.button._getSpan(button));
jsCBDdeleteStyle(span, vg.button.BUTTON_ACTIVE);
}
else if(key==13 )
{
vg.button._select(true, button);
}
}
vg.button.setFocus=function(button)
{
var button=vg.html.getElement(button);
var input=button.getElementsByTagName("input");
input[0].focus();
}
vg.button._submit=function(button, suppressErrorLayer)
{
var onSubmit=button.getAttribute('onSubmit');
var showMsg=button.getAttribute('showWaitMsgOnSubmit');
var immediate=button.getAttribute('immediate');
var disableWT=button.getAttribute('wtCallDisabled');
if(onSubmit==null||eval(onSubmit))
{
if(immediate)
{
vg.validation.submitParentForm(button, showMsg, disableWT);
}
else
{
vg.validation.validateAndSubmitParentForm(button, showMsg, disableWT, suppressErrorLayer);
}
}
}
vg.button.triggerClick=function(target )
{
var button=vg.html.getElement(target);
if(!vg.button._isDisabled(button))
{
jsCBDtriggerEventOnNode(target, 'click');
}
}
vg.touchScreen.SCROLL_CONTAINER_CLASS=SCROLL_CONTAINER_CLASS="tScrn-ScrollingDivContainer";
vg.touchScreen.SCROLL_EL_CLASS=SCROLL_EL_CLASS="tScrn-ScrollingDiv";
vg.touchScreen.SCROLLBAR_TACK_CLASS=SCROLLBAR_TACK_CLASS="scrollbarTrack";
vg.touchScreen.SCROLLBAR_CLASS=SCROLLBAR_CLASS="scrollbar";
vg.touchScreen.SCROLLING_EL_ID_SFX=SCROLLING_EL_ID_SFX="_scrollingEl";
vg.touchScreen.SCROLLBAR_TRACK_ID_SFX=SCROLLBAR_TRACK_ID_SFX="_scrollbarTrack";
vg.touchScreen.SCROLLBAR_ID_SFX=SCROLLBAR_ID_SFX="_scrollbar";
vg.touchScreen._makeNodeScrollable=function(id)
{
var scrollContainer=document.getElementById(id);
if(!cbd.browser.isTouchScreen||scrollContainer==null)
{
return;
}
var scrollContainerFirstChild=vg.html.getFirstChild(scrollContainer);
if(scrollContainerFirstChild&&vg.html.hasStyle(vg.touchScreen.SCROLL_EL_CLASS, scrollContainerFirstChild))
{
vg.touchScreen._setScrollingElementsProperties(id);
}
else
{
vg.touchScreen._renderScrollingElements(id);
}
}
vg.touchScreen._renderScrollingElements=function(id)
{
var scrollContainer=document.getElementById(id);
var addStyle=vg.html.addStyle;
var touchScreenNS=vg.touchScreen;
var scrollingEl=document.createElement("div");
scrollingEl.setAttribute("id", id+touchScreenNS.SCROLLING_EL_ID_SFX);
addStyle(touchScreenNS.SCROLL_EL_CLASS, scrollingEl);
var scrollbarTrack=document.createElement("div");
scrollbarTrack.setAttribute("id", id+touchScreenNS.SCROLLBAR_TRACK_ID_SFX);
addStyle(touchScreenNS.SCROLLBAR_TACK_CLASS, scrollbarTrack);
var scrollbar=document.createElement("div");
scrollbar.setAttribute("id", id+touchScreenNS.SCROLLBAR_ID_SFX);
addStyle(touchScreenNS.SCROLLBAR_CLASS, scrollbar);
scrollbarTrack.appendChild(scrollbar);
var scrollContainerParent=vg.html._getParentNode(scrollContainer);
var scrollContainerSiblings=scrollContainerParent.childNodes;
var siblingsLength=scrollContainerSiblings.length;
var lastSibling=scrollContainerSiblings[siblingsLength-1];
var nextSibling=null;
if(siblingsLength > 1&&scrollContainer!=lastSibling)
{
for(var i=0;i < siblingsLength;i++)
{
if(scrollContainerSiblings[i]==scrollContainer)
{
nextSibling=scrollContainerSiblings[i+1];
break;
}
}
}
scrollContainerParent.removeChild(scrollContainer);
var scrollContainerChildren=scrollContainer.childNodes;
while(scrollContainerChildren.length > 0)
{
var node=scrollContainerChildren[0];
scrollContainer.removeChild(node);
scrollingEl.appendChild(node);
}
scrollContainer.appendChild(scrollingEl);
scrollContainer.appendChild(scrollbarTrack);
if(nextSibling)
{
scrollContainerParent.insertBefore(scrollContainer, nextSibling);
}
else
{
scrollContainerParent.appendChild(scrollContainer);
}
vg.touchScreen._setScrollingElementsProperties(id);
}
vg.touchScreen._setScrollingElementsProperties=function(id)
{
var touchScreenNS=vg.touchScreen;
var scrollContainer=document.getElementById(id);
var scrollingEl=document.getElementById(id+touchScreenNS.SCROLLING_EL_ID_SFX);
var scrollbarTrack=document.getElementById(id+touchScreenNS.SCROLLBAR_TRACK_ID_SFX);
var scrollbar=document.getElementById(id+touchScreenNS.SCROLLBAR_ID_SFX);
var scrollElementHeights=touchScreenNS.oneFinger._getScrollingElementsHeights(scrollContainer, scrollingEl, scrollbarTrack, scrollbar);
var h_scrollContainer=scrollElementHeights.scrollContainer;
var h_scrollingEl=scrollElementHeights.scrollingEl;
var h_scrollbarTrack=scrollElementHeights.scrollbarTrack;
var h_scrollbar=scrollElementHeights.scrollbar;
if(h_scrollingEl > h_scrollContainer)
{
if(!vg.html.hasStyle(touchScreenNS.SCROLL_CONTAINER_CLASS, scrollContainer))
{
vg.html.addStyle(touchScreenNS.SCROLL_CONTAINER_CLASS, scrollContainer);
}
var scrollingElTopPos=parseInt(scrollingEl.style.top);
var offset=h_scrollContainer - h_scrollingEl;
if(scrollingElTopPos < offset)
{
vg.html.setObjTop(scrollingEl, offset);
}
vg.html.setHeight(scrollbarTrack, h_scrollbarTrack+"px");
vg.html.setHeight(scrollbar, h_scrollbar+"px");
var scrollbarNewPos=Math.round((h_scrollContainer/h_scrollingEl)*scrollingElTopPos*-1);
vg.html.setObjTop(scrollbar, scrollbarNewPos);
vg.html.addEventListener(scrollingEl, vg.event.GSTR_CUSTOM_Y_SCROLL,  touchScreenNS.customScrollY.customScrollTouchMove, "_customScrollMove");
vg.html.addEventListener(scrollingEl, vg.event.GSTR_CUSTOM_Y_SCROLL_END,  touchScreenNS.customScrollY.customScrollTouchEnd, "_customScrollEnd");
}
else
{
if(vg.html.hasStyle(touchScreenNS.SCROLL_CONTAINER_CLASS, scrollContainer))
{
vg.html.removeStyle(touchScreenNS.SCROLL_CONTAINER_CLASS, scrollContainer);
vg.html.setObjTop(scrollingEl, "0");
vg.html.removeEventListenerById(scrollingEl, "_customScrollMove");
vg.html.removeEventListenerById(scrollingEl, "_customScrollEnd");
}
}
}
vg.touchScreen.oneFinger._getScrollingElementsHeights=function(scrollContainer, scrollingEl, scrollbarTrack, scrollbar)
{
var scrollElemsHeights=new Array();
scrollElemsHeights.scrollContainer=0;
scrollElemsHeights.scrollingEl=0;
scrollElemsHeights.scrollbarTrack=0;
scrollElemsHeights.scrollbar=0;
if(scrollContainer)
{
var scrollContainerStyleHeight=scrollContainer.style.height;
if(scrollContainerStyleHeight)
{
scrollElemsHeights.scrollContainer=parseInt(scrollContainerStyleHeight);
}
else
{
scrollElemsHeights.scrollContainer=vg.html.getObjHeight(scrollContainer);
if(scrollElemsHeights.scrollContainer==0)
{
scrollElemsHeights.scrollContainer=vg.html.getObjSizeInHiddenAncestor(scrollContainer).h;
}
}
}
if(scrollingEl)
{
scrollElemsHeights.scrollingEl=vg.html.getObjHeight(scrollingEl);
if(scrollElemsHeights.scrollingEl==0)
{
scrollElemsHeights.scrollingEl=vg.html.getObjSizeInHiddenAncestor(scrollingEl).h;
}
}
if(scrollbarTrack)
{
scrollElemsHeights.scrollbarTrack=scrollElemsHeights.scrollContainer;
}
if(scrollbar)
{
scrollElemsHeights.scrollbar=Math.round((scrollElemsHeights.scrollContainer/scrollElemsHeights.scrollingEl)*scrollElemsHeights.scrollContainer);
}
return scrollElemsHeights;
}
vg.touchScreen.customScrollY=
{
scrollingEl:null,
scrollContainer:null,
scrollbar:null,
scrollElementHeights:null,
h_scrollContainer:null,
h_scrollingEl:null,
h_scrollbar:null,
offsets:null,
origin:null,
originTime:null,
step:null,
startPos:null,
speed:null,
distance:null,
min:null,
max:null,
newPos:null,
containerToScrollingElRatio:null,
scrollbarMin:null,
scrollbarMax:null,
firstTouchMove:true,
customScrollTouchMove:function(event)
{
var touchEvent=event,
customScrollNS=vg.touchScreen.customScrollY;
if(customScrollNS.firstTouchMove===true)
{
customScrollNS.initScrollingProperties(touchEvent);
customScrollNS.firstTouchMove=false;
}
touchEvent.preventDefault();
var currentPos=vg.event.getPosition(touchEvent).y;
customScrollNS.newPos=(currentPos - customScrollNS.origin)+customScrollNS.offsets[1];
if(customScrollNS.newPos <=customScrollNS.min&&customScrollNS.newPos >=customScrollNS.max)
{
vg.html.setObjTop(customScrollNS.scrollingEl, customScrollNS.newPos);
customScrollNS.moveScrollbar(customScrollNS.newPos);
}
},
customScrollTouchEnd:function(event)
{
var touchEvent=event,
customScrollNS=vg.touchScreen.customScrollY;
customScrollNS.startPos=customScrollNS.scrollingEl.offsetTop;
var end=vg.event.getPosition(touchEvent).y,
endTime=new Date().getTime(),
dist=end - customScrollNS.origin,
time=endTime - customScrollNS.originTime;
customScrollNS.speed=dist/(time/1000);
if(Math.abs(dist) > 5)
{
scroll=setInterval(customScrollNS.finishScroll,customScrollNS.step);
}
customScrollNS.firstTouchMove=true;
},
initScrollingProperties:function(event)
{
var touchEvent=event;
vg.html.stopEventPropagation(touchEvent);
var customScrollNS=vg.touchScreen.customScrollY;
customScrollNS.scrollingEl=touchEvent.currentTarget;
customScrollNS.scrollContainer=customScrollNS.scrollingEl.parentNode;
customScrollNS.scrollbar=document.getElementById(customScrollNS.scrollContainer.id+vg.touchScreen.SCROLLBAR_ID_SFX);
customScrollNS.scrollElementHeights=vg.touchScreen.oneFinger._getScrollingElementsHeights(customScrollNS.scrollContainer, customScrollNS.scrollingEl, null, customScrollNS.scrollbar);
customScrollNS.h_scrollContainer=customScrollNS.scrollElementHeights.scrollContainer;
customScrollNS.h_scrollingEl=customScrollNS.scrollElementHeights.scrollingEl;
customScrollNS.h_scrollbar=customScrollNS.scrollElementHeights.scrollbar;
if(customScrollNS.h_scrollContainer >=customScrollNS.h_scrollingEl)
{
return;
}
customScrollNS.offsets=[customScrollNS.scrollingEl.offsetLeft,customScrollNS.scrollingEl.offsetTop];
customScrollNS.origin=vg.event.getPosition(touchEvent).y;
customScrollNS.originTime=new Date().getTime();
customScrollNS.step=50;
customScrollNS.distance=0;
customScrollNS.min=2;
customScrollNS.max=- customScrollNS.h_scrollingEl+customScrollNS.scrollContainer.offsetHeight;
clearInterval(scroll);
customScrollNS.containerToScrollingElRatio=customScrollNS.h_scrollContainer/customScrollNS.h_scrollingEl;
customScrollNS.scrollbarMin=customScrollNS.min;
customScrollNS.scrollbarMax=customScrollNS.h_scrollContainer - customScrollNS.h_scrollbar - 2;
},
moveScrollbar:function(newPosition)
{
var customScrollNS=vg.touchScreen.customScrollY;
var scrollbarNewPos=Math.round(customScrollNS.containerToScrollingElRatio*newPosition*-1);
if(scrollbarNewPos >=customScrollNS.scrollbarMin&&scrollbarNewPos <=customScrollNS.scrollbarMax)
{
vg.html.setObjTop(customScrollNS.scrollbar, scrollbarNewPos);
}
},
finishScroll:function()
{
var customScrollNS=vg.touchScreen.customScrollY;
customScrollNS.distance+=Math.round(customScrollNS.speed*(customScrollNS.step/1000))
customScrollNS.newPos=customScrollNS.startPos+customScrollNS.distance;
if(customScrollNS.newPos > customScrollNS.min||customScrollNS.newPos < customScrollNS.max)
{
clearInterval(scroll);
return;
}
vg.html.setObjTop(customScrollNS.scrollingEl, customScrollNS.newPos);
customScrollNS.moveScrollbar(customScrollNS.newPos);
customScrollNS.speed=.85*customScrollNS.speed;
if(Math.abs(customScrollNS.speed) < 10)
{
customScrollNS.speed=0;
clearInterval(scroll);
}
}
}
vg.touchScreen._getTouchEvent=function(e)
{
var touchEvent=e;
return touchEvent;
}
jsCBDgetSelectedDeckCardIndex=function(deckId)
{
return vg.comp.getController(deckId).selectedIndex;
}
var PREV=-1;
var NEXT=999;
jsCBDselectDeckCard=function(deckId, cardIdx, wrap)
{
if(cardIdx!=PREV&&cardIdx!=NEXT )
{
vg.comp.callMethod(deckId, 'select',[cardIdx]);
return;
}
else
{
wrap=(wrap==null)?true:wrap;
var deck=vg.comp.getController(deckId);
var args={};
args.totalCards=deck.items.length - 1;
cardIdx=(cardIdx==NEXT)?1:cardIdx;
var toCard=deck.selectedIndex+cardIdx;
toCard=(toCard > args.totalCards||toCard < 0 )?deck.selectedIndex:toCard;
if(!wrap&&(deck.selectedIndex!=args.totalCards||deck.selectedIndex!=0) )
{
deck.select(toCard );
}
else
{
if(deck.selectedIndex==0&&cardIdx < 0)
{
deck.select(deck.items.length -1);
}
else if(deck.selectedIndex==args.totalCards&&cardIdx > 0)
{
deck.select(0);
}
else
{
deck.select(toCard );
}
}
args.curCard=deck.selectedIndex;
}
vg.comp._configureHiddenItems(document.getElementById(deckId));
if(args) return args;
}
jsCBDloadCardContent=function(cardId, callback)
{
cbd.Navigator.userCallback=callback;
vg.comp.getController(cardId).loadCardContent();
}
jsCBDsetDeckCardContentUrl=function(cardId, url)
{
var deckCard=document.getElementById(cardId);
deckCard.setAttribute("url", url);
}
Deck=function(id, adjustZoom, transDur)
{
var newPosition, controller, isNextGenLocal;
this.base=vg.Controller;
this.base(id, null);
this.items=new Array();
this.id=id;
this.selectedIndex=this.viewNode.getAttribute('selectedcardidx');
this.transType=this.viewNode.getAttribute('transitiontype');
this.fadeInOut=this.transType=="NONE"||this.transType=="CBD_FADE_IN_OUT_DECK";
this.vertSlide=this.transType=="CBD_VERT_SLIDE";
this.horizSlide=this.transType=="CBD_HORIZ_SLIDE";
this.hasCarouselType=(this.viewNode.getAttribute('carouselType')!=null)?true:false;
this.carouselType=this.viewNode.getAttribute('carouselType');
this.slider=vg.html.getFirstChild(this.viewNode);
this.height=this.viewNode.getAttribute('height');
this.isAnimated="true"==this.viewNode.getAttribute('transition');
this.afterInit=false;
this.isAdjustZoom=adjustZoom;
this.transDur=transDur;
this.deckParentController=null;
if(this.vertSlide||this.horizSlide)
{
this._setTransDur(.3);
}
else
{
if(window.isNextGen)
{
if(this.fadeInOut)
{
this._setTransDur(.25);
}
else
{
this._setTransDur(.5);
}
}
else
{
this._setTransDur(1.5);
}
}
this.easingStr=this.viewNode.getAttribute('easing');
this.PREVIOUS="Previous";
this.PREVIOUS_DISABLED="Previous disabled";
this.NEXT="Next";
this.NEXT_DISABLED="Next disabled";
if(this.selectedIndex!=null&&this.horizSlide)
{
newPosition=-(this.selectedIndex*100);
this.slider.style.left=newPosition+"%";
}
controller=this;
if(this.hasCarouselType) vg.util.execOnPageReady(function(){controller._getCarouselControllers()});
if(this.easingStr)
{
vg.util.execOnPageReady(function(){controller.easing=vg.smil.getEasing(controller.easingStr);});
}
}
Deck.prototype=
{
select:function(cardIdx)
{
if(this.selectedIndex==cardIdx)
{
return;
}
if(window.isNextGen&&this.isAnimated&&this.fadeInOut )
{
this.items[this.selectedIndex].fadeTo(cardIdx);
}
else
{
this._transitionTo(cardIdx);
}
},
_transitionTo:function(cardIdx)
{
if(!this.horizSlide&&!this.vertSlide)
{
vg.comp._hideAllItems(this.items);
}
var selectedCard=this.items[cardIdx];
var selectedNode=selectedCard.viewNode;
if(this.isAnimated&&this.fadeInOut)
{
vg.html.setOpacity(selectedNode, '0', this.isAdjustZoom);
}
jsCBDtoggleElement(selectedNode, true);
this.setSelectedCard(vg.comp.getController(selectedNode));
cbd.StateKeeper._setState(this.viewNode.getAttribute('id'), cardIdx, true);
selectedCard.loadCardContent();
selectedCard.animate();
},
_setHeight:function()
{
if(this.afterInit)
{
var curHeight=this.viewNode.style.height
this.viewNode.style.height="auto";
var toHeight=this.items[this.selectedIndex].viewNode.scrollHeight;
this.viewNode.style.height=curHeight;
var attributes={height:{to:toHeight}};
vg.smil.animateElement({target:this.viewNode, attr:attributes, duration:150, easeIn:false});
}
else
{
var setCardPosition=-(this.selectedIndex*100);
this.slider.style.top=setCardPosition+"%";
vg.html.setHeight(this.viewNode, this.items[this.selectedIndex].viewNode.scrollHeight+"px");
this.afterInit=true;
}
},
addItem:function(controller)
{
var length=this.items.length;
this.items[length]=controller;
controller.index=length;
},
setSelectedCard:function(controller)
{
this.selectedIndex=controller.index;
},
_getCarouselControllers:function()
{
var controller=this;
this._carContLft=document.getElementById(this.id+"_carLft");
this._carContRgt=document.getElementById(this.id+"_carRgt");
vg.html.addEventListener(this._carContLft, 'click', function(){controller._triggerCarousel('left')});
vg.html.addEventListener(this._carContRgt, 'click', function(){controller._triggerCarousel('right')});
this._configCarousel();
},
_triggerCarousel:function(dir)
{
jsCBDselectDeckCard(this.id,(dir=='left')?PREV:NEXT, false);
this._configCarousel();
},
_configCarousel:function()
{
vg.html.removeStyle("carDisabled", this._carContLft);
vg.html.removeStyle("carDisabled", this._carContRgt);
this._setAltText(this._carContLft, this.PREVIOUS);
this._setAltText(this._carContRgt, this.NEXT);
if(this.selectedIndex==0||this.items.length==1)
{
vg.html.addStyle("carDisabled", this._carContLft);
this._setAltText(this._carContLft, this.PREVIOUS_DISABLED);
}
if(this.selectedIndex==this.items.length-1||this.items.length==1)
{
vg.html.addStyle("carDisabled", this._carContRgt);
this._setAltText(this._carContRgt, this.NEXT_DISABLED);
}
},
_setAltText:function(obj,altText)
{
if(obj.tagName!="img")
{
var imgObj=obj.getElementsByTagName('img')[0];
imgObj.setAttribute("alt",altText);
}
else
{
obj.setAttribute("alt",altText);
}
},
_setTransDur:function(defaultTransDur)
{
if(this.transDur==null||this.transDur==''||isNaN(this.transDur))
{
this.transDur=defaultTransDur;
}
else
{
this.transDur=parseFloat(this.transDur);
}
this.transDur=this.transDur*1000;
},
_fadeIn:function(nextCardIdx)
{
this._transitionTo(nextCardIdx);
},
_updateDeckParentComponent:function()
{
var deckParentController=this.deckParentController;
if(deckParentController==null)
{
var deckParentComponent=vg.html.findParentComponent(vg.html._getParentNode(this.viewNode));
if(deckParentComponent)
{
deckParentController=vg.comp.getController(deckParentComponent.id);
}
}
if(deckParentController&&deckParentController._updateScrollingProperties)
{
deckParentController._updateScrollingProperties();
}
}
}
DeckItem=function(id, selected)
{
this.base=vg.Controller;
var contentNode=document.getElementById(id);
this.base(id, contentNode, true);
this.selected=selected;
this.id=id;
this.onTransCallback=null;
this.deckContr=vg.comp.findController(contentNode, true);
this.deckContr.addItem(this);
var contr=this;
this.onTransCallback=(window.isNextGen)?function(){contr._finishFadeInOut()}:null;
if(this.selected)
{
if(this.deckContr.vertSlide)
{
this.viewNode.style.overflow="auto";
}
this.deckContr.setSelectedCard(this);
this.loadCardContent(true);
}
}
DeckItem.prototype=
{
setCardContHeight:function()
{
this.contHeight=this.viewNode.scrollHeight;
},
isAnimated:function()
{
return this.deckContr.isAnimated;
},
animate:function()
{
var contentNode=this.contentNode;
if(this.deckContr.isAnimated)
{
if(this.deckContr.horizSlide)
{
this._horizSlide();
}
else if(this.deckContr.vertSlide)
{
this._vertSlide();
}
else
{
this._fadeInOut();
}
}
},
fadeTo:function(nextCard)
{
var deckController=this.deckContr;
this._fadeOut(function(){deckController._fadeIn(nextCard);});
},
_vertSlide:function()
{
var newPosition=-(this.deckContr.selectedIndex*100);
var currentPosition=parseInt(this.deckContr.slider.style.top);
if(!currentPosition)
{
currentPosition=0;
}
var attributes={top:{from:currentPosition, to:newPosition, unit:"%"}};
var THIS=this;
var afterAnim=function()
{
if(THIS.deckContr.height=="auto")
{
THIS.deckContr._setHeight();
}
else
{
THIS.deckContr.items[THIS.deckContr.selectedIndex].viewNode.style.overflow="auto";
}
if(THIS.deckContr.selectedIndex!=0)
{
THIS.deckContr.items[THIS.deckContr.selectedIndex-1].viewNode.style.visibility="hidden";
}
}
var numOfItems=this.deckContr.items.length;
for(var i=0;i < numOfItems;i++)
{
this.deckContr.items[i].viewNode.style.overflow="hidden";
this.deckContr.items[i].viewNode.style.visibility="visible";
}
vg.smil.animateElement({target:this.deckContr.slider, attr:attributes, duration:this.deckContr.transDur, funcFinished:afterAnim, easing:this.deckContr.easing});
},
_horizSlide:function()
{
var newPosition=-(this.deckContr.selectedIndex*100);
var currentPosition=parseInt(this.deckContr.slider.style.left);
if(!currentPosition)
{
currentPosition=0;
}
if(mac)
{
this.deckContr.slider.style.left=newPosition+'%';
}
else
{
var attributes={left:{from:currentPosition, to:newPosition, unit:"%"}};
vg.smil.animateElement({target:this.deckContr.slider, attr:attributes, duration:this.deckContr.transDur, easing:this.deckContr.easing});
}
},
_fadeInOut:function(fadeOut, callBack)
{
this._hideBackground();
vg.html.setOpacity(this.viewNode, '0', this.deckContr.isAdjustZoom);
vg.smil.animateElement(this.viewNode,'opacity',this.deckContr.transDur,0,0,1,null, this.onTransCallback);
},
_fadeOut:function(callBack)
{
this._hideBackground();
vg.smil.animateElement(this.viewNode,'opacity',this.deckContr.transDur,0,1,0,null, callBack);
},
_hideBackground:function()
{
var bColor=this.viewNode.style.backgroundColor;
if(bColor==null||bColor=="")
{
this.viewNode.style.backgroundColor="#FFF";
}
},
_finishFadeInOut:function()
{
if(ie8)
{
this.viewNode.style.filter="none";
}
},
loadCardContent:function(init)
{
var contentNode=this.contentNode;
var contentUrl=contentNode.getAttribute('url');
var contr=this;
var deckContr=this.deckContr;
var performAnimation=function(){
if(!deckContr.afterInit&&(deckContr.horizSlide||deckContr.vertSlide))
{
contr.animate();
}
};
if(contentUrl==null||contentUrl=="")
{
if(init!=true)
{
Populator._execute(contentNode, performAnimation);
}
else
{
performAnimation();
}
}
else
{
if(contentUrl.indexOf('javascript:')==0)
{
var js=contentUrl.substring('javascript:'.length);
eval(js);
performAnimation();
}
else
{
jsCBDloadContent(contentUrl, this.id, 'replaceChildren', performAnimation);
}
}
vg.comp._configureSlider(contentNode);
this.handleSelectTable();
deckContr._updateDeckParentComponent();
},
handleSelectTable:function()
{
var nodes=vg.html.getElements(this.contentNode,{tagName:'TH',attrName:'class'});
if(nodes!=null)
{
for(var i=0;nodes!=null&&i < nodes.length;i++)
{
if(nodes[i].className!=null&&nodes[i].className.indexOf(SelectTable.SELECT_ALL_BEHAVIOR) >=0)
{
var controller=vg.comp.findController(nodes[i]);
if(controller)
{
controller.show();
}
break;
}
}
}
}
}
RollOverMenu=function(id, autoplay)
{
this.base=vg.Controller;
this.base(id, null);
this.items=new Array();
this.defaultCard;
var controller=this;
this.autoplay='false';
var defaultCardAttr=this.viewNode.getAttribute('defaultCard');
this.defaultCard=(defaultCardAttr==null)?null:parseInt(defaultCardAttr);
if(autoplay=='true')
{
this.autoplay='true';
setTimeout(function(){controller._autoplayRMDeck(1)}, 3000);
}
}
RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2=ROLLOVER_HIGHLIGHT_STYLE2="roDeck-sel2";
RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE=ROLLOVER_HIGHLIGHT_STYLE="roDeck-sel";
RollOverMenu.prototype=
{
addItem:function(controller)
{
var length=this.items.length;
this.items[length]=controller;
controller.index=length;
},
_autoplayRMDeck:function(count)
{
var controller=this;
if(count < controller.items.length&&controller.autoplay=='true')
{
var menuItem=this.items[count];
var mouseTarget=menuItem.viewNode.getAttribute('mouseTarget');
if(mouseTarget!=null){
RollOverMenuItem.cbdSelectRMItem(menuItem, mouseTarget);
}
var itemCount=++count;
setTimeout(function(){controller._autoplayRMDeck(itemCount)}, 3000);
if(itemCount==controller.items.length)
{
var menuItem=controller.items[0];
var mouseTarget=menuItem.viewNode.getAttribute('mouseTarget');
setTimeout(function(){RollOverMenuItem.cbdSelectRMItem(menuItem, mouseTarget)}, 3000);
}
}
}
}
RollOverMenuItem=function(id, deckChangeMode)
{
this.base=vg.Controller;
this.base(id, null);
this.deckChangeMode=deckChangeMode.toLowerCase();
this.isMouseEnter=null;
var parentController=vg.comp.findController(this.viewNode, true);
parentController.addItem(this);
var controller=this;
vg.html.addEventListener(this.viewNode, 'click', function(){controller.click()});
vg.html.addEventListener(this.viewNode, 'mouseenter', function(e){controller.highlight();controller.recordEvent(e, 'mouseenter');});
vg.html.addEventListener(this.viewNode, 'mouseleave', function(e){controller.mouseLeave();controller.recordEvent(e, 'mouseleave');});
}
RollOverMenuItem.prototype=
{
recordEvent:function(e, eventName)
{
e=jsCBDgetEvent(e);
e.isRiaEvent=false;
},
highlight:function()
{
var parentController=vg.comp.findController(this.viewNode, true);
if(this.deckChangeMode=="onmouseover")
{
parentController.autoplay='false';
}
this.isMouseEnter='true';
this.select();
},
click:function()
{
var id=this.viewNode.getAttribute('id');
var parentController=vg.comp.findController(this.viewNode, true);
parentController.selected=true;
if(this.deckChangeMode=="onclick"||this.deckChangeMode=="onclick_2" )
{
var menuItem=vg.comp.getController(id);
var parentController=vg.comp.findController(this.viewNode, true);
vg.html.addOrRemoveStyleFromNodes(RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2, parentController.items, false);
jsCBDaddStyle(menuItem, RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2);
var clickTarget=this.viewNode.getAttribute('clickTarget');
eval(clickTarget);
}
if(this.deckChangeMode=="onmouseover")
{
RollOverMenuItem.cbdDoRMonclick(id);
var mouseTarget=this.viewNode.getAttribute('mouseTarget');
eval(mouseTarget);
}
},
select:function()
{
var id=this.viewNode.getAttribute('id');
setTimeout("RollOverMenuItem.cbdDoRMmouseEnter('"+id+"')" , 150 );
},
mouseLeave:function()
{
this.isMouseEnter=false;
if(this.deckChangeMode=="onmouseover")
{
var id=this.viewNode.getAttribute('id');
setTimeout("RollOverMenuItem.cbdDoRMmouseLeave('"+id+"')" , 150 );
}
}
}
RollOverMenuItem.cbdSelectRMItem=function(menuItem, jsTarget)
{
var parentController=vg.comp.findController(menuItem.viewNode, true);
vg.html.addOrRemoveStyleFromNodes(RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE, parentController.items, false);
jsCBDaddStyle(menuItem, RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE);
if(jsTarget!=null)
{
eval(jsTarget);
}
}
RollOverMenuItem.cbdDoRMmouseEnter=function(menuItemId)
{
var menuItem=vg.comp.getController(menuItemId);
var isMouseEnter=menuItem.isMouseEnter;
if(isMouseEnter=='true'||isMouseEnter=='autoPlay')
{
var mouseTarget=menuItem.viewNode.getAttribute('mouseTarget');
_cbdClosePrevSelectOneMenu();
RollOverMenuItem.cbdSelectRMItem(menuItem, mouseTarget);
}
}
RollOverMenuItem.cbdDoRMmouseLeave=function(menuItemId)
{
var menuItem=vg.comp.getController(menuItemId);
var parentController=vg.comp.findController(menuItem.viewNode, true);
var menuItems=parentController.items;
var defaultCardAttr=parentController.defaultCard;
var size=menuItems.length;
var mouseState='false';
var mouseEnter=null;
for(var i=1;i < size;i++)
{
mouseEnter=menuItems[i].isMouseEnter;
if(mouseEnter=='true') mouseState='true';
}
if(!isEmpty(defaultCardAttr))
{
defaultCardAttr=parseInt(defaultCardAttr);
if(defaultCardAttr >=0&&defaultCardAttr < size&&mouseState=='false')
{
for(var i=1;i < size;i++)
{
if(menuItems[i].viewNode.getAttribute('idx')==defaultCardAttr)
defaultCardAttr=i;
}
var menuItem=menuItems[defaultCardAttr];
var mouseTarget=menuItem.viewNode.getAttribute('mouseTarget');
RollOverMenuItem.cbdSelectRMItem(menuItem, mouseTarget);
if(parentController.selected)
{
vg.html.addOrRemoveStyleFromNodes(RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2, parentController.items, false);
jsCBDaddStyle(menuItem, RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2);
}
}
}
}
RollOverMenuItem.cbdDoRMonclick=function(menuItemId)
{
var menuItem=vg.comp.getController(menuItemId);
var menuItemNo=menuItem.viewNode.getAttribute('idx');
var parentController=vg.comp.findController(menuItem.viewNode, true);
var defaultCard=parentController.defaultCard;
if(!isEmpty(defaultCard))
{
parentController.defaultCard=menuItemNo;
}
vg.html.addOrRemoveStyleFromNodes(RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2, parentController.items, false);
jsCBDaddStyle(menuItem, RollOverMenu.ROLLOVER_HIGHLIGHT_STYLE2);
}
jsCBDselectRMItem=function(menuItemId)
{
var menuItem=vg.comp.getController(menuItemId);
var parentController=vg.comp.findController(menuItem.viewNode, true);
parentController.autoplay='false';
var menuItem=vg.comp.getController(menuItemId);
var jsTarget=menuItem.viewNode.getAttribute('mouseTarget');
if(jsTarget==null)
{
jsTarget=menuItem.viewNode.getAttribute('clickTarget');
}
RollOverMenuItem.cbdSelectRMItem(menuItem, jsTarget);
RollOverMenuItem.cbdDoRMonclick(menuItemId);
}
jsCBDmouseOverRMItem=function(menuItemId)
{
var menuItem=vg.comp.getController(menuItemId);
var parentController=vg.comp.findController(menuItem.viewNode, true);
parentController.autoplay='false';
var menuItem=vg.comp.getController(menuItemId);
var mouseTarget=menuItem.viewNode.getAttribute('mouseTarget');
RollOverMenuItem.cbdSelectRMItem(menuItem, mouseTarget);
}
vg.util.isIE7ZoomedInOut=function()
{
if(ie7)
{
if(self.document.body.parentElement.offsetWidth!=self.document.body.offsetWidth)
{
return true;
}
}
return false;
}
vg.comp.HIGHLIGHT_STYLE=HIGHLIGHT_STYLE="callout";
CheckBox=function(id, row, cell)
{
this.base=vg.Controller;
this.id=id;
this.base(id, null);
this.highlightObj=vg.html.findAncestor(this.viewNode,{tagName:(row)?'TR':'TD'});
var controller=this;
vg.html.addEventListener(this.viewNode, 'click', function(){controller.select()});
this.select();
}
CheckBox.prototype=
{
select:function()
{
if(this.viewNode.checked)
{
this.highlight();
}
else
{
this.unhighlight();
}
},
highlight:function()
{
jsCBDaddStyle(this.highlightObj, vg.comp.HIGHLIGHT_STYLE);
},
unhighlight:function()
{
jsCBDdeleteStyle(this.highlightObj, vg.comp.HIGHLIGHT_STYLE);
}
}
RadioButton=function(id, group, row, cell)
{
this.base=vg.Controller;
this.id=id;
this.group=group;
this.base(id, null);
this.highlightObj=vg.html.findAncestor(this.viewNode,{tagName:(row)?'TR':'TD'});
var controller=this;
vg.html.addEventListener(this.viewNode, 'click', function(){controller.select()});
this.select();
}
RadioButton.prototype=
{
select:function()
{
var results=vg.validation.getTargetInputs(this.group);
for(var i=0;i < results.length;i++)
{
if(results[i].jsController)
{
if(results[i].checked)
{
results[i].jsController.highlight();
}
else
{
results[i].jsController.unhighlight();
}
}
}
},
highlight:function()
{
jsCBDaddStyle(this.highlightObj, vg.comp.HIGHLIGHT_STYLE);
},
unhighlight:function()
{
jsCBDdeleteStyle(this.highlightObj, vg.comp.HIGHLIGHT_STYLE);
}
}
vg.expRow._hasExpandedRow=false;
vg.expRow.colImg=_cbdImagePath+"icons/nav_flipperopen.gif";
vg.expRow.expImg=_cbdImagePath+"icons/nav_flipperclosed.gif";
vg.expRow._toggleFlipperImage=function(node, show)
{
node.setAttribute("src", show?vg.expRow.colImg:vg.expRow.expImg);
}
vg.expRow._loadUrl=function(node, location)
{
var parentTr=vg.html.findAncestor(node,{tagName:'tr'});
var rowNumber=vg.html.getSiblings(parentTr,{tagName:'tr'}, '-').length+1;
var table=vg.html.findAncestor(node,{tagName:'table'});
var tableId=table.getAttribute('id');
var url=node.getAttribute('expandUrl');
var alwaysLoad=node.getAttribute('alwaysLoad')=="true";
var loaded=node.getAttribute('loaded')=="true";
if(alwaysLoad||!loaded)
{
jsCBDloadContent(url, location, 'replaceChildren', null, tableId+rowNumber);
if(!loaded)
{
node.setAttribute('loaded', 'true');
}
}
}
vg.expRow._createRow=function(node)
{
var parentTr=vg.html.findAncestor(node,{tagName:'tr'});
var nextRow=vg.html.getSibling(parentTr,{tagName:'tr'}, '+');
var colspan=vg.html.getElements(parentTr,{tagName:'td'}).length;
var newDiv=document.createElement("div");
var newTd=document.createElement("td");
newTd.setAttribute("colSpan", colspan);
newTd.appendChild(newDiv);
var newTr=document.createElement("tr");
newTr.setAttribute("type", "detailRow");
newTr.appendChild(newTd);
if(nextRow!=null)
{
parentTr.parentNode.insertBefore(newTr, nextRow);
}
else
{
parentTr.parentNode.appendChild(newTr);
}
var expandedType=node.getAttribute("expandedType");
if(expandedType=='ROW_INFO')
{
vg.html.addStyle("infoMsg", newTr);
vg.html.addStyle("nr", newTd);
newTd.setAttribute("align", "left");
vg.html.addStyle("msgInfo", newDiv);
}
else if(expandedType=='ROW_WARN')
{
vg.html.addStyle("warnMsg", newTr);
vg.html.addStyle("nr", newTd);
newTd.setAttribute("align", "left");
vg.html.addStyle("msgWarn", newDiv);
}
}
vg.expRow._toggleExpandableRow=function(node, open, highlight)
{
var parentTr=vg.html.findAncestor(node,{tagName:'tr'});
var nextRow=vg.html.getSibling(parentTr,{tagName:'tr'}, '+');
var hasNewRow=nextRow!=null&&nextRow.getAttribute("type")=="detailRow";
var expandedType=node.getAttribute("expandedType");
var url=node.getAttribute("expandUrl");
var message=node.getAttribute("expandedRowMessage");
if(!hasNewRow)
{
vg.expRow._createRow(node);
}
var newTr=vg.html.getSibling(parentTr,{tagName:'tr'}, '+');
var newTd=vg.html.getElements(newTr,{tagName:"td"})[0];
var newDiv=vg.html.getElements(newTd,{tagName:"div"})[0];
var show=(!jsCBDisVisibleElement(newTr)||!hasNewRow);
if(open!=null)
{
show=open;
}
jsCBDtoggleElement(newTr, show);
if(highlight)
{
vg.html.addOrRemoveStyle("flipperRowOpen", parentTr, show);
vg.html.addOrRemoveStyle("flipperRowClosed", parentTr,!show);
}
if(!isEmpty(message))
{
if(message.charAt(0)=='#')
{
var messageId=removeChars(message, '#');
var contentDiv=document.getElementById(messageId);
newDiv.innerHTML=contentDiv.innerHTML;
}
else
{
jsCBDsetElementInnerHtml(newDiv, '<div>'+message+'</div>');
}
}
else if(url.charAt(0)=='#')
{
url=removeChars(url, '#');
var contentDiv=document.getElementById(url);
var content=contentDiv.innerHTML;
jsCBDsetElementInnerHtml(newDiv, '<div>'+content+'</div>');
}
else
{
vg.expRow._loadUrl(node, newDiv);
}
if('ROW_DETAIL'==expandedType)
{
vg.expRow._toggleFlipperImage(node, show);
}
else if('ROW_INFO'==expandedType)
{
vg.html.addOrRemoveStyle("infoInd", parentTr, show);
vg.html.addOrRemoveStyle("infoMsg", newTr, show);
}
else
{
vg.html.addOrRemoveStyle("warnInd", parentTr, show);
vg.html.addOrRemoveStyle("warnMsg", newTr, show);
}
}
vg.expRow._openAllExpandedRows=function(tableId)
{
var searchNode=tableId?document.getElementById(tableId):document;
var expandedRows=vg.html.getElements(searchNode,{tagName:'img', attrName:'expanded', attrValue:'true'});
var rowsLength=expandedRows.length;
for(var i=0;i < rowsLength;i++)
{
vg.expRow._toggleExpandableRow(expandedRows[i], true);
}
}
vg.resultsRow._mouseEnter=function(node)
{
var attributes={backgroundColor:{to:'#E6EDF1'}};
vg.smil.animateElement({target:node, attr:attributes, duration:250, colorAnimation:true});
}
vg.resultsRow._mouseLeave=function(node)
{
var attributes={backgroundColor:{to:'#FFFFFF'}};
vg.smil.animateElement({target:node, attr:attributes, duration:350, colorAnimation:true});
}
NavDeck=function(id)
{
this.base=vg.Controller;
this.base(id, null);
this.state=this.viewNode.getAttribute("state");
this.id=this.viewNode.getAttribute("id");
this.isAnimationEnabled=(this.viewNode.getAttribute("transition")==='true');
this.isTypeTab=this.viewNode.getAttribute('type')=='tab';
this.curTab=0;
this.onTransCallback=null;
this.nodes={};
this.nodes['cbdProcNav']=document.getElementById('CBD_PROCESS_NAV'+this.id);
this.nodes['cbdNavDeck']=document.getElementById('CBD_NAV_DECK'+this.id);
this.nodes['rbscrolldiv']=vg.html.getElements(this.nodes['cbdNavDeck'],{tagName:'div', attrName:'class', attrValue:'roundBoxScrollDiv'}, null )[0];;
if(!this.isInitState())
{
var navDeck=this;
vg.html.addEventListener(window, 'load', function(){navDeck.executeCustomTransition()});
}
cbd.Navigator.deckId=id.split('_navDeck',1);
}
NavDeck.prototype=
{
executeCustomTransition:function()
{
var transFunction=this.viewNode.getAttribute("initialTransition");
if(transFunction!=null){eval(transFunction);}
},
startNav:function()
{
var procNavHolder=this.nodes['cbdProcNav'];
var boxNavDeck=vg.html.findAncestor(procNavHolder,{tagName:'div'}, function(node){return node.className&&node.className.indexOf("webReg") >=0;});
if(this.isInitState())
{
this.executeCustomTransition();
vg.html.replaceClass(this.viewNode, boxNavDeck?"initial":"OAinitial", boxNavDeck?"inProgress":"");
this.state='inProgress';
}
},
isInitState:function()
{
return this.state=='init';
}
}
NavDeck.tabAnimation=function(navDeck, isAnimationEnabled)
{
this.navDeck=navDeck;
this.navDeckNode=document.getElementById(navDeck.id);
this.navDeckTransDur="500";
this.navDeckInitTransDur="350";
this.isAnimationEnabled=isAnimationEnabled
}
NavDeck.tabAnimation.prototype=
{
isDeckCurrent:function()
{
return(navDeck.curTab==navDeck.curServerSideTab);
},
doTransition:function(initialDeckLoadCompleted)
{
if((!this.isDeckCurrent())&&initialDeckLoadCompleted)
{
this._doTransition(true);
navDeck.curTab=navDeck.curServerSideTab;
}
},
_doTransition:function(doYUIEaseIn)
{
if(!this.isAnimationEnabled) return;
var fromWidth=this._getAnimFromWidth();
var toWidth=vg.html.getObjWidth(navDeck.nodes['cbdNavDeck']);
var toHeight=vg.html.getObjHeight(navDeck.nodes['cbdNavDeck']);
if(navDeck.transDir=="left")
{
vg.html.addStyle("floatRight", navDeck.nodes['cbdNavDeck']);
}
jsCBDtoggleVisibility(navDeck.nodes['rbscrolldiv'], false);
jsCBDtoggleElement(navDeck.nodes['rbscrolldiv'], false);
var THIS=this;
var afterAnim=function(){THIS._onTransComplete()};
var attributes={width:{from:fromWidth, to:toWidth}, height:{from:0, to:toHeight}}
vg.smil.animateElement({target:navDeck.nodes['cbdNavDeck'], attr:attributes, duration:this.navDeckTransDur, funcFinished:afterAnim, easeIn:doYUIEaseIn});
},
_onTransComplete:function()
{
navDeck.nodes['cbdNavDeck'].style.width="100%";
vg.html.removeStyle("floatRight", navDeck.nodes['cbdNavDeck']);
setTimeout(function()
{
jsCBDtoggleElement(navDeck.nodes['rbscrolldiv'], true);
jsCBDtoggleVisibility(navDeck.nodes['rbscrolldiv'], true);
navDeck.nodes['cbdNavDeck'].style.height="auto";
if(navDeck.onTransCallback!=null) navDeck.onTransCallback(cbd.Navigator.cardId);
}, 50 );
},
_getAnimFromWidth:function()
{
if(navDeck.totalTabs%2 > 0 )
{
navDeck.transDir=(navDeck.curServerSideTab <=Math.floor(navDeck.totalTabs/2)+1)?"right":"left";
}
else
{
navDeck.transDir=(navDeck.curServerSideTab <=navDeck.totalTabs/2)?"right":"left";
}
navDeck.navTabs=vg.html.getElements(navDeck.nodes['cbdProcNav'],{tagName:'div', attrName:'class', attrValue:'navTabItem'}, null );
var procNavGeoData=vg.html.getObjSizePosition(navDeck.nodes['cbdProcNav']);
var tabGeoData=vg.html.getObjSizePosition(navDeck.navTabs[navDeck.curServerSideTab-1]);
return(navDeck.transDir=="right")?tabGeoData.x+tabGeoData.w - procNavGeoData.x+4:procNavGeoData.x+procNavGeoData.w - tabGeoData.x - 4;
},
_doInitialTrans:function(transDiv1,transDiv2,fadeInDur)
{
jsCBDtoggleElement(transDiv1, false);
jsCBDtoggleElement(transDiv2, true);
if(this.isAnimationEnabled)
{
this._doInitialTransAnimation(transDiv1,transDiv2,fadeInDur);
}
else
{
jsCBDtoggleVisibility(transDiv2, true);
}
},
_doInitialTransAnimation:function(transDiv1,transDiv2,fadeInDur)
{
vg.html.setOpacity(transDiv2, 0.0);
jsCBDtoggleVisibility(transDiv2, true);
var attributes={opacity:{to:1}};
vg.smil.animateElement({target:transDiv2, attr:attributes, duration:fadeInDur});
var attributes={paddingTop:{from:100, to:0}}
vg.smil.animateElement({target:this.navDeckNode, attr:attributes, duration:this.navDeckInitTransDur, easeIn:false});
vg.html.replaceClass(this.navDeck, "OAinitial","");
navDeck.curTab=navDeck.curServerSideTab;
this._doTransition(false);
},
_doReverseTransPhase1:function(transDiv1,transDiv2)
{
var fromWidth=this._getAnimFromWidth();
var toWidth=vg.html.getObjWidth(navDeck.nodes['cbdNavDeck']);
var toHeight=vg.html.getObjHeight(navDeck.nodes['cbdNavDeck']);
if(navDeck.transDir=="left")
{
vg.html.addStyle("floatRight", navDeck.nodes['cbdNavDeck']);
}
var attr1={height:{from:toHeight, to:0}}
vg.smil.animateElement({target:navDeck.nodes['cbdNavDeck'], attr:attr1, duration:this.navDeckTransDur, easeIn:false});
jsCBDtoggleVisibility(navDeck.nodes['rbscrolldiv'], false);
jsCBDtoggleElement(navDeck.nodes['rbscrolldiv'], false);
var THIS=this;
var afterAnim=function(){THIS._doReverseTransPhase2(transDiv1,transDiv2)};
var attr2={paddingTop:{from:0, to:100}}
vg.smil.animateElement({target:this.navDeckNode, attr:attr2, duration:this.navDeckInitTransDur, funcFinished:afterAnim, easeIn:false});
var attr3={opacity:{to:0}};
vg.smil.animateElement({target:transDiv2, attr:attr3, duration:this.navDeckTransDur, easeIn:false});
},
_doReverseTransPhase2:function(transDiv1,transDiv2)
{
jsCBDtoggleElement(transDiv2, false);
jsCBDtoggleElement(transDiv1, true);
vg.html.setOpacity(transDiv1, 0.0);
jsCBDtoggleVisibility(transDiv2, false);
var THIS=this;
var afterAnim=function(){THIS._onReverseTransComplete(transDiv1,transDiv2)};
var attributes={opacity:{to:1}};
vg.smil.animateElement({target:transDiv1, attr:attributes, duration:this.navDeckTransDur, funcFinished:afterAnim, easeIn:false});
},
_onReverseTransComplete:function(transDiv1,transDiv2)
{
navDeck.nodes['cbdNavDeck'].style.width="100%";
navDeck.nodes['cbdNavDeck'].style.height="100%";
jsCBDtoggleVisibility(navDeck.nodes['rbscrolldiv'], true);
jsCBDtoggleElement(navDeck.nodes['rbscrolldiv'], true);
vg.html.setOpacity(navDeck.nodes['rbscrolldiv'], 1.0);
vg.html.removeStyle("floatRight", navDeck.nodes['cbdNavDeck']);
}
}
jsCBDshowNavDeck=function(navDeckId,transDiv1Id,transDiv2Id,initTransDur,transDur)
{
var transDiv1=document.getElementById(transDiv1Id);
var transDiv2=document.getElementById(transDiv2Id);
var navDeck=vg.comp.getController(navDeckId+"_navDeck");
navDeck.animType.navDeckInitTransDur=(initTransDur!=null)?initTransDur:navDeck.animType.navDeckInitTransDur;
navDeck.animType.navDeckTransDur=(transDur!=null)?transDur:navDeck.animType.navDeckTransDur;
jsCBDtoggleElement(navDeck.nodes['rbscrolldiv'], true);
var initTransPhase=function(){navDeck.animType._doInitialTrans(transDiv1,transDiv2,navDeck.animType.navDeckInitTransDur)};
if(navDeck.viewNode.getAttribute("transition")==='true')
{
var attributes={opacity:{to:0}};
vg.smil.animateElement({target:transDiv1, attr:attributes, duration:navDeck.animType.navDeckInitTransDur, funcFinished:initTransPhase, easeIn:false});
}
else
{
jsCBDtoggleVisibility(transDiv1, false);
initTransPhase();
}
}
jsCBDhideNavDeck=function(navDeckId,transDiv1Id,transDiv2Id)
{
var transDiv1=document.getElementById(transDiv1Id);
var transDiv2=document.getElementById(transDiv2Id);
var navDeck=vg.comp.getController(navDeckId+"_navDeck");
var reverseTransPhase1=function(){navDeck.animType._doReverseTransPhase1(transDiv1,transDiv2)};
var attributes={opacity:{to:0}};
vg.smil.animateElement({target:navDeck.nodes['rbscrolldiv'], attr:attributes, duration:navDeck.animType.navDeckInitTransDur, funcFinished:reverseTransPhase1, easeIn:false});
}
vg.validation.validateAndSubmitParentForm=function(caller, showWaitMsg, disableWT, suppressErrorLayer)
{
var form=_cbdGetParentForm(caller);
var isValid=vg.validation.validateAndSubmitForm(form, caller, showWaitMsg, disableWT, suppressErrorLayer);
return isValid;
}
vg.validation.submitParentForm=function(caller, showWaitMsg, disableWT)
{
var form=_cbdGetParentForm(caller);
vg.validation.submitForm(form, caller, showWaitMsg, disableWT);
}
vg.validation.validateAndSubmitForm=function(form, submitBtn, showWaitMsg, disableWT, suppressErrorLayer)
{
var isValid=vg.validation.validateForm(form, null, suppressErrorLayer);
if(isValid )
{
vg.validation.submitForm(form, submitBtn, showWaitMsg, disableWT);
}
return isValid;
}
vg.validation.submitForm=function(form, caller, showWaitMsg, disableWT)
{
if(form.tagName=='DIV')
{
var newForm=document.createElement("form");
var formParent=form.parentNode;
newForm.setAttribute('enctype', form.getAttribute('enctype'));
newForm.setAttribute('action', form.getAttribute('action'));
newForm.setAttribute('method', form.getAttribute('method'));
newForm.setAttribute('id', form.getAttribute('id'));
newForm.setAttribute('name', form.getAttribute('name'));
if(ie)
{
newForm.innerHTML=form.innerHTML;
}
else
{
while(vg.html.getFirstChild(form))
{
var node=vg.html.getFirstChild(form);
form.removeChild(node);
newForm.appendChild(node);
}
}
formParent.removeChild(form);
formParent.appendChild(newForm);
form=newForm;
}
_cbdDisableNestedForm(form, true);
if(vg.comp.isCommandComp(caller))
{
caller=document.getElementById(caller.id);
vg.comp.trackCommandComponent(caller);
_cbdDisableSubmitButton();
}
var formElements=vg.html.retrieveInputsWithDefaultValues(form);
vg.html.clearInputDefaultValues(formElements);
form.submit();
var formId=form.getAttribute('id');
_cbdSetButtonHiddenInput(formId, "");
vg.html.resetInputDefaultValues(formElements);
if(showWaitMsg=='true')
{
jsCBDtoggle('main', false);
jsCBDtoggle('msgOnSubmit', true);
}
}
vg.validation.validateFormById=function(formId, suppressErr, suppressErrorLayer)
{
return vg.validation.validateForm(document.getElementById(formId), suppressErr, suppressErrorLayer);
}
vg.validation.suppressErrorLayer=function(flag)
{
vg.validation.isSuppressErrorLayer=flag;
}
vg.validation.validateForm=function(form, suppressErr, suppressErrorLayer)
{
var isFormValid=true;
var firstInvalidElem=null;
var formId=form.getAttribute("id");
vg.validation.clearValidationObserverErrors(formId);
var skipErrSummary=!(document.getElementById("errSummary")||document.getElementById("errSummary_span"));
var elements=vg.html.getFormElements(form);
for(var i=0;i < elements.length;++i)
{
isFormValid=vg.validation.validateElement(elements[i], true, skipErrSummary)&&isFormValid;
if(!isFormValid&&firstInvalidElem==null)
{
firstInvalidElem=elements[i];
}
}
elements=vg.validation.getCalculatedElems(form);
for(var i=0;i < elements.length;++i)
{
isFormValid=vg.validation.validateElement(elements[i], true, skipErrSummary)&&isFormValid;
if(!isFormValid&&firstInvalidElem==null)
{
firstInvalidElem=elements[i];
}
}
if(suppressErr)
return isFormValid;
if(!isFormValid)
{
if(firstInvalidElem!=null)
{
vg.validation.registerFirstInvalidElem(firstInvalidElem);
}
if(!suppressErrorLayer&&!vg.validation.isSuppressErrorLayer)
{
var customErrorLayerId=form.getAttribute("customErrorLayerId");
vg.validation.openErrorLayer(customErrorLayerId);
}
}
vg.validation.triggerValidationObservers(formId);
return isFormValid;
}
vg.validation.triggerValidationObservers=function(formId)
{
var valObserverArrays=null;
if(formId)
{
valObserverArrays=new Object();
valObserverArrays[formId]=vg.validation._valObservers[formId];
}
else
{
valObserverArrays=vg.validation._valObservers;
}
for(j in valObserverArrays)
{
var valObservers=valObserverArrays[j];
if(!isEmpty(valObservers) )
{
var valObsLength=valObservers.length;
for(var i=0;i < valObsLength;i++)
{
var node=document.getElementById(valObservers[i]);
if(node)
{
var controller=vg.comp.findController(node, false);
if(controller)
{
controller._triggerValidationObserver(vg.html.getElement(valObservers[i]) );
}
}
}
}
}
vg.validation.valObserversTimeOut=null;
}
vg.validation.clearValidationObserverErrors=function(formId)
{
var valObservers=vg.validation._valObservers[formId];
if(!isEmpty(valObservers) )
{
var valObsLength=valObservers.length;
for(var i=0;i < valObsLength;i++)
{
var validationObserverNode=document.getElementById(valObservers[i]);
if(validationObserverNode)
{
validationObserverNode.errorInputs=null;
}
}
}
}
vg.validation.getCalculatedElems=function(context)
{
return vg.html.getElements(context,{tagName:'span', attrName:'type', attrValue:'CALCULATED'});
}
vg.validation.validateElementById=function(input)
{
var compInput=vg.html.getElement(input);
var elements=vg.html.getFormElements(compInput);
var isInputValid=true;
for(var i=0;i < elements.length;++i)
{
isInputValid=vg.validation.validateElement(elements[i], true)&&isInputValid;
}
return isInputValid;
}
vg.validation.validateElement=function(input, isSubmit, skipErrSummary)
{
if(!vg.validation.isValidateClientSide(input))
{
return true;
}
var inputType=input.getAttribute('type');
if(inputType=='button'||inputType=='hidden')
{
return true;
}
var id=input.getAttribute('name');
if(id==null)
{
id=input.getAttribute('id');
}
var isValid;
var isInputGroup=vg.validation.isInputGroup(input);
var isDispersedInputGroup=vg.validation.isDispersedInputGroup(input);
var isDirty=input.dirty;
if(!isSubmit&&!isDirty&&(vg.validation.isEmptyInput(input)||input.value=='none'||isInputGroup))
{
isValid=true;
}
else
{
var isFirstInput=input.getAttribute('firstInput')=='true';
if(isSubmit&&isDispersedInputGroup&&!isFirstInput)
{
return true;
}
else
{
var hasDefaultText=vg.html.inputHasDefaultText(input);
if(hasDefaultText)
{
isValid=validateRequired(id, skipErrSummary);
}
else
{
isValid=jsCBDvalidateById(id, isSubmit, true, skipErrSummary);
}
}
}
var methodToCall=isValid?
vg.validation.setValid:vg.validation.setInvalid;
var isStateChanged=(isValid!=vg.validation.isValid(input));
if(isStateChanged)
{
if((!isSubmit&&isInputGroup)||isDispersedInputGroup)
{
var targetInputs=vg.validation.getTargetInputs(input.name);
for(var i=0;i < targetInputs.length;++i)
{
methodToCall.call(this, targetInputs[i]);
}
}
else
{
methodToCall.call(this, input);
}
}
vg.validation._notifyValidationObserver(input, isValid);
return isValid;
}
vg.validation.isValid=function(input)
{
return(input.valid==null||input.valid==true)
}
vg.validation.setValid=function(input)
{
var inputElm=vg.html.getElement(input);
inputElm.valid=true;
var tdTarget=vg.validation.getTdTarget(inputElm);
if(tdTarget!=null)
{
jsCBDdeleteStyle(tdTarget, "err");
vg.html.removeEventListener(tdTarget, 'mouseenter', vg.validation.showErrEvt, "error_in");
vg.html.removeEventListener(tdTarget, 'mouseleave', vg.validation.hideErrEvt, "error_out");
vg.validation.hideErr(false);
}
if(window.isNextGen)
{
var name=inputElm.name?inputElm.name:inputElm.id;
var errorManagerController=vg.comp.getController(name,vg.ErrorManager.TYPE);
if(errorManagerController!=null )
{
errorManagerController.updateErrorStatus(false);
}
}
}
vg.validation.setInvalid=function(input)
{
input.valid=false;
input.dirty=true;
if(window.isWtLogInputErrors)
{
var lastTwoDigitsOfID=input.id.substr(input.id.length - 2);
if(!vg.validation.isInputGroup(input)||(vg.validation.isInputGroup(input)&&lastTwoDigitsOfID==":0"))
{
jsCBDSendDCSTagsThenClear("DCSext.CBDerr", input.id);
}
}
var tdTarget=vg.validation.getTdTarget(input);
tdTarget.childInput=input;
jsCBDaddStyle(tdTarget, "err");
tdTarget.setAttribute('errTd', 'true');
vg.html.addEventListener(tdTarget, 'mouseenter', vg.validation.showErrEvt, "error_in");
vg.html.addEventListener(tdTarget, 'mouseleave', vg.validation.hideErrEvt, "error_out");
if(window.isNextGen)
{
var name=input.name?input.name:input.id;
vg.comp.getController(name,vg.ErrorManager.TYPE).updateErrorStatus(true);
}
}
vg.validation._valObservers=new Object();
vg.validation.pageHasValObservers=false;
vg.validation._notifyValidationObserver=function(input, isValid)
{
if(!vg.validation.pageHasValObservers)
{
return;
}
var validationObserverNode=vg.html.findAncestor(input,{attrName:'validationObserver'});
if(validationObserverNode&&validationObserverNode.getAttribute('validationObserver')=='true')
{
var validationObserverId=validationObserverNode.getAttribute("id");
var formId=_cbdGetParentForm(validationObserverNode).getAttribute("id");
var valObservers=vg.validation._valObservers[formId];
var alreadyInArray=false;
if(valObservers)
{
var valObsLength=valObservers.length;
for(var i=0;i < valObsLength&&!alreadyInArray;i++)
{
if(validationObserverId==valObservers[i])
{
alreadyInArray=true;
}
}
}
else
{
vg.validation._valObservers[formId]=new Array();
valObservers=vg.validation._valObservers[formId];
}
if(!alreadyInArray)
{
valObservers[valObservers.length]=validationObserverId;
}
var controller=vg.comp.findController(validationObserverNode, false);
if(controller)
{
controller._updateValidationObserverErrors(input, validationObserverNode,!isValid);
}
else
{
var viewNodeId=vg.html.getCompViewNode(validationObserverNode).id;
if(viewNodeId )
{
if(!window.observerInputList )
{
observerInputList=new Array();
}
if(!observerInputList[viewNodeId])
{
observerInputList.push(viewNodeId);
observerInputList[viewNodeId]=new Array();
}
observerInputList[viewNodeId].push({input:input, node:validationObserverNode, valid:isValid});
}
}
}
}
vg.validation.errMouseenter=function(elem)
{
return function(e){
if(vg.validation.findTargetInput(e).id==elem.id)
{
vg.validation.showErr(e);
}
};
}
vg.validation.showErrEvt=function(e)
{
var input=vg.validation.findTargetInput(e);
if(input )
{
var parentTd=vg.validation.getTdTarget(input, e);
vg.validation.showErr(input, parentTd);
}
}
vg.validation.hideErrEvt=function(e)
{
vg.validation.hideErr(false);
}
vg.validation.showErr=function(input, parentTd, errorFromServer)
{
input=vg.html.getElement(input);
if(input==null||input.valid )
{
return;
}
if(!parentTd)
{
parentTd=vg.validation.getTdTarget(input);
}
if(parentTd.offsetHeight===0 )
{
return;
}
var errLayer=document.getElementById("form-field-info");
var errLayerContents=document.getElementById("form-field-info-contents");
errLayerContents.innerHTML=vg.validation.getErrMsg(input);
clearTimeout(vg.validation.blurErrTimeout);
jsCBDtoggleElement(errLayer, true);
var errorMessageIFrame=document.getElementById("rderr_iframe_cover");
if(errorMessageIFrame)
{
var visibleErrorLayer=vg.html.getFirstChild(errLayer);
if(visibleErrorLayer)
{
errorMessageIFrame.style.height=visibleErrorLayer.clientHeight+1+"px";
errorMessageIFrame.style.width=visibleErrorLayer.clientWidth+"px";
}
}
var dispLoc="auto";
if(window.isNextGen){
errLayer.style.width="auto";
errLayer.style.left=0;
var name=input.name
if(vg.comp.getController(name,vg.ErrorManager.TYPE))
{
dispLoc=vg.comp.getController(name,vg.ErrorManager.TYPE).getErrMsgPos();
}
var errMessageWidth=vg.html.getObjWidth(errLayer);
var maxWidth=vg.constants.COL_5_WIDTH;
if(errMessageWidth > maxWidth)
{
errLayer.style.width=maxWidth+"px";
}
}
var retVal=vg.html.position({elementNode:errLayer, targetNode:parentTd, dispLoc:dispLoc, horzPos:"left"});
if(window.isNextGen)
{
retVal=vg.html.position({elementNode:errLayer, targetNode:parentTd, dispLoc:dispLoc, horzPos:"left", hasLeader:true, infobox:true, leader:true});
jsCBDtoggle("ldr_form-field-info", true);
if(retVal.elem.ldrOffSetX!=undefined)
{
var ieOffset=0;
if(ie&&retVal.elem.ldrOffSetX>0&&!(dispLoc=="upperRight"||dispLoc=="lowerRight") )
{
ieOffset=1;
}
errLayer.style.left=retVal.elem.x+retVal.elem.ldrOffSetX+ieOffset+"px";
errLayer.style.top=retVal.elem.y+retVal.elem.ldrOffSetY+"px";
}
var errorMessageIFrame=document.getElementById("rderr_iframe_cover");
if(errorMessageIFrame)
{
errorMessageIFrame.style.height=errLayer.clientHeight+"px";
errorMessageIFrame.style.width=errLayer.clientWidth+"px";
}
if(errorFromServer)
{
errLayer.errorFromServer=true;
}
}
}
vg.validation.hideErr=function(fade)
{
var errorLayerId="form-field-info";
var errorLayerLeaderId="ldr_form-field-info";
if(window.isNextGen)
{
var errorLayer=document.getElementById(errorLayerId);
if(fade)
{
vg.smil.cbdFadeOut(errorLayer, 250);
vg.smil.cbdFadeOut(document.getElementById(errorLayerLeaderId), 250);
}
else
{
jsCBDtoggle(errorLayerId, false);
jsCBDtoggle(errorLayerLeaderId, false);
}
errorLayer.errorFromServer=false;
}
else
{
jsCBDtoggle(errorLayerId, false);
}
clearTimeout(vg.validation.blurErrTimeout);
}
vg.validation.findTargetInput=function(e)
{
var eNode=jsCBDgetEventNode(e);
var tdTarget;
if(eNode.getAttribute('errTd')!=null )
{
tdTarget=eNode;
}
else
{
tdTarget=vg.html.findAncestor(eNode,
{tagName:'td', attrName:'errTd', attrValue:'true'});
}
return tdTarget?tdTarget.childInput:null;
}
var errorMessageBullet=window.isNextGen?"&#8226;":"&bull;";
vg.validation.setErrorMessageBullet=function(bulletCode)
{
errorMessageBullet=bulletCode;
}
vg.validation.getErrMsg=function(input)
{
var errMsg=input.infomsg;
if(!isEmpty(errMsg))
{
return errMsg;
}
var context=input;
var parent=input.parentNode;
if(parent.getAttribute("type")=="INPUT_DESC")
{
context=parent;
}
else if(vg.validation.isDispersedInputGroup(input))
{
context=document.getElementById(input.getAttribute('name'));
}
var errElem=vg.html.getSibling(context,{attrName:'type', attrValue:'ERR_DESC'}, "-");
if(errElem!=null)
{
var errListItemId=errElem.getAttribute('errListMsgId');
var errListItem=document.getElementById(errListItemId);
return errListItem.innerHTML;
}
return "ERROR MSG NOT FOUND";
}
vg.validation.isValidateClientSide=function(input)
{
var inputContainer=input;
if(vg.validation.isDispersedInputGroup(input))
{
inputContainer=document.getElementById(input.getAttribute('name'));
if(inputContainer==null)
{
var error="The dispersed input group "+input.getAttribute('name')+
" for "+input.getAttribute('id')+" is not on the page.";
vg.util.throwException("vg.validation.isValidateClientSide", error);
}
}
else if(vg.validation.isInputGroup(input))
{
inputContainer=vg.html.findAncestor(input,{tagName:'td'});
}
if(vg.validation.isOffForElement(inputContainer))
{
return false;
}
var form=_cbdGetParentForm(inputContainer );
if(vg.validation.isOffForElement(form))
{
return false;
}
return true;
}
vg.validation.isOffForElement=function(e)
{
var cssClass=(e!=null?e.className:null);
return(!isEmpty(cssClass)&&cssClass.indexOf('jsValOff') >=0);
}
vg.validation.isDispersedInputGroup=function(input)
{
return input.getAttribute('radiogroup')=='true';
}
vg.validation.getTdTarget=function(input, e)
{
if(e!=null)
{
var eNode=jsCBDgetEventNode(e);
if(eNode.getAttribute('errTd')!=null )
{
return eNode;
}
}
var isDispersedInputGroup=vg.validation.isDispersedInputGroup(input);
var booleanCheckbox=input.getAttribute('booleanCheckbox');
if(!(isDispersedInputGroup||booleanCheckbox=='true')&&
vg.validation.isInputGroup(input)||_cbdIsRiaSelectOneMenu(input) )
{
var inputTD=vg.html.findAncestor(input,{tagName:'td'});
return vg.html.findAncestor(inputTD,{tagName:'td'});
}
else if(input.type==="textarea")
{
var compSpan=document.getElementById('comp-'+input.name);
return vg.html.findAncestor(compSpan,{tagName:'td'});
}
else
{
return vg.html.findAncestor(input,{tagName:'td'});
}
}
vg.validation.getStyleTarget=function(input)
{
if(vg.validation.isInputGroup(input))
{
var sib=vg.html.getSibling(input,{tagName:'label'});
if(sib!=null) return sib;
return vg.html.findAncestor(input,{tagName:'label'});
}
else
{
return input;
}
}
vg.validation.isInputGroup=function(input)
{
var inputType=input.getAttribute('type');
return(inputType=='radio'||inputType=='checkbox');
}
vg.validation.closeErrLayer=function(id)
{
var closeLayerId=(id)?id:"errFormLayer";
jsCBDcloseLayer(closeLayerId);
var firstInvalidElem=vg.validation.firstInvalidElem;
var isInView=vg.html.isElementInView(firstInvalidElem);
if(window.isNextGen)
{
if(!vg.Layer.hasOpenLayer())
{
window.scrollTo(0,0);
}
}
else if(firstInvalidElem!=null&&!isInView)
{
var yPos=vg.html.getObjSizePosition(firstInvalidElem).y;
vg.html.scrollPageVertical(yPos);
}
jsCBDpreventSelectListBleedThru(false);
}
vg.validation.openErrorLayer=function(customErrorLayerId)
{
vg.validation.hideErr(false);
vg.util.execOnPageReady(function(){vg.validation.setupErrLayer(customErrorLayerId);});
}
vg.validation.openErrorLayerFinish=function(errLayerId)
{
vg.comp.closeAllMenus();
jsCBDopenLayer(errLayerId);
jsCBDpreventSelectListBleedThru(false);
}
vg.validation.setupErrLayer=function(customErrLayerId)
{
var node=(customErrLayerId)?document.getElementById(customErrLayerId ):document.getElementById('errFormLayer');
if(node)
{
vg.validation.openErrorLayerFinish(node.id);
}
else if(customErrLayerId&&!node)
{
vg.util.throwException("vg.validation.setupErrLayer", "Custom error layer not found in DOM. Check custom error layer Id:"+customErrLayerId);
}
else
{
var errLayerJsp=window.isNextGen?'ErrorLayerNG.jsf':'ErrorLayer.jsf';
jsCBDloadContent(jsCBDgetContextRoot()+'com/vanguard/util/cbd/data/jsp/'+errLayerJsp,
'formErrLayer', 'replaceChildren', function(){
vg.validation.openErrorLayerFinish('errFormLayer');
});
}
}
vg.validation.isFirstError=function()
{
return vg.validation.firstInvalidElem==null;
}
vg.validation.registerFirstInvalidElem=function(firstInvalidElem)
{
vg.validation.firstInvalidElem=firstInvalidElem;
}
vg.validation.setRiaError=function(msg_id, state, init, ajaxVal, dispErr)
{
var nextGenVar=window.isNextGen;
var msg_ids=msg_id.split(" ");
var errText="";
var first=true;
var inputId, bulletCode;
var multipleErrors=(msg_ids.length >1);
if(nextGenVar&&multipleErrors)
{
errText="<dl class='unordered'>";
}
for(var i=0;i < msg_ids.length;i++)
{
var errMsg=document.getElementById(msg_ids[i]);
inputId=msg_ids[i].replace(/:[a-zA-Z0-9-_]*$/, "" );
if(errMsg!=null)
{
if(!nextGenVar)
{
if(!first)errText+="<br/>";
first=false;
}
var msgText=errMsg.getAttribute("text");
jsCBDAddErrorMetaTag(state, inputId);
bulletCode=(isEmpty(errorMessageBullet)||!multipleErrors)?"":errorMessageBullet;
if(!(window.isNextGen&&isEmpty(bulletCode)) )
{
bulletCode+="&nbsp;";
}
if(nextGenVar)
{
if(multipleErrors)
{
errText+="<dt>"+bulletCode+"</dt><dd>"+msgText+"</dd>";
}
else
{
errText+="<p class='inline'>"+msgText+"</p>";
}
}
else
{
errText+=bulletCode+msgText;
}
}
}
if(nextGenVar&&multipleErrors)
{
errText+="</dl>";
}
var input=document.getElementById(inputId);
var targetInputs=vg.validation.getTargetInputs(inputId);
for(var i=0;i < targetInputs.length;++i)
{
targetInputs[i].infomsg=errText;
}
if(init)
{
var methodToCall=state?vg.validation.setInvalid:vg.validation.setValid;
for(var i=0;i < targetInputs.length;++i)
{
methodToCall.call(this, targetInputs[i]);
}
vg.validation._notifyValidationObserver(input,!state);
if(!ajaxVal&&vg.validation.isFirstError())
{
vg.validation.registerFirstInvalidElem(input);
if(!vg.validation.isSuppressErrorLayer )
{
vg.validation.openErrorLayer();
}
}
if(ajaxVal&&dispErr&&window.isNextGen&&state)
{
vg.validation.showErr(targetInputs[0], null, true);
var dur=vg.comp.getController(input.name,vg.ErrorManager.TYPE).getErrMsgDur();
vg.validation.blurErrTimeout=setTimeout(function(){vg.validation.hideErr(true);}, dur );
}
if(!vg.validation.valObserversTimeOut)
{
vg.validation.valObserversTimeOut=setTimeout(function delayedTriggerValObservers(){vg.validation.triggerValidationObservers();}, 200);
}
}
}
vg.validation.getTargetInputs=function(inputId)
{
var input=document.getElementById(inputId);
if("radioGroup"==input.getAttribute("type")||
"true"==input.getAttribute("radiogroup"))
{
return _cbdGetElementsByName('input', inputId)
}
else if(_cbdIsRiaSelectOneMenu(input))
{
return vg.html.getElements(input,{tagName:'input', attrName:'name', attrValue:inputId});
}
else
{
if(input.nodeName.toUpperCase()=="TABLE")
{
return input.getElementsByTagName('input');
}
else
{
return[input];
}
}
}
vg.validation.focus=function(input)
{
if(_cbdIsRiaSelectOneMenu(input))
{
input=vg.comp.getController(input).valueInput;
}
var parent=input.parentNode;
var formatFunc=parent.getAttribute('b:format');
if(formatFunc!=null)
{
_setAutoFormat(input.getAttribute("name"), eval(formatFunc), true);
input.prevVal=input.value;
}
if(window.isNextGen&&(input.valid==false))
{
vg.validation.showErr(input);
}
}
vg.validation.formatTypingTimeout=null;
vg.validation.autoFormat=function(key, func, value, inputId)
{
value=trim(value);
var delayAutoFormat=(/^0+/.test(value))?1500:250;
clearTimeout(vg.validation.formatTypingTimeout);
vg.validation.formatTypingTimeout=setTimeout(
function()
{
var input=document.getElementById(inputId);
if(input)
{
func.dataSource=input;
func(key);
}
}, delayAutoFormat);
vg.validation.blurErrTimeout=null;
}
vg.validation._autoFormatInput=function(input)
{
var formatFunc=input.parentNode.getAttribute('b:format');
var func=eval(formatFunc);
if(func)
{
func.dataSource=input;
func(null);
}
}
vg.validation.blur=function(input)
{
if(_cbdIsRiaSelectOneMenu(input))
{
input=vg.comp.getController(input).valueInput;
}
var parent=input.parentNode;
if(!parent)
{
return;
}
var styleTarget=vg.validation.getStyleTarget(input);
if(styleTarget==null)
{
return;
}
vg.validation._autoFormatInput(input);
vg.validation.procErr(input);
var formatFunc=parent.getAttribute('b:format');
if(formatFunc!=null)
{
_setAutoFormat(input.getAttribute("name"), formatFunc, false);
}
if(vg.util.isDefined(input.prevVal)&&input.prevVal!=input.value)
{
if(input.onchange!=null)
{
input.onchange();
}
}
}
vg.validation.procErr=function(input)
{
var isValid=vg.validation.validateElement(input);
if(window.isNextGen&&!isValid)
{
vg.validation.showErr(input);
clearTimeout(vg.validation.blurErrTimeout);
var dur=vg.comp.getController(input.name,vg.ErrorManager.TYPE).getErrMsgDur();
vg.validation.blurErrTimeout=setTimeout(function(){vg.validation.hideErr(true);}, dur );
}
}
vg.validation.change=function(input)
{
if(vg.util.isDefined(input.prevVal))
{
input.prevVal=input.value;
}
}
vg.validation.keydown=function(input, event)
{
input.prevValue=input.value;
}
vg.validation.keyup=function(input, event)
{
var key=jsCBDgetKey(jsCBDgetEvent(event));
var isTabKey=key==9;
var isShiftKey=key==16;
if(isTabKey||isShiftKey)
{
return;
}
var valueChanged=input.value!=input.prevValue;
if(window.isNextGen&&(input.valid==false)&&valueChanged)
{
vg.validation.hideErr();
}
}
vg.validation.textareafocus=function(textarea)
{
return;
}
vg.validation.textareablur=function(textarea)
{
return;
}
vg.validation.initDefaultText=function(id, defaultText)
{
var input=vg.html.getElement(id);
if(input)
{
input.defaultText=defaultText;
if(isEmpty(input.value))
{
input.value=defaultText;
jsCBDaddStyle(input, ASINPUT_NOFOCUS_CLASS);
}
else
{
jsCBDaddStyle(input, ASINPUT_FOCUS_CLASS);
}
}
}
vg.validation.containsError=function(id)
{
return vg.html.getElements(document.getElementById(id),{tagName:'TD', attrName:'errtd', attrValue:'true'}).length > 0;
}
vg.html.retrieveInputsWithDefaultValues=function(form)
{
var formElements=vg.html.getElements(form,{tagName:'input'}, function(input){return!isEmpty(input.defaultText);});
var formTextAreas=vg.html.getElements(form,{tagName:'textarea'}, function(input){return!isEmpty(input.defaultText);});
formElements=formElements.concat(formTextAreas);
return formElements;
}
vg.html.clearInputDefaultValues=function(formElements)
{
var formElementsLength=formElements.length;
for(var i=0;i < formElementsLength;i++)
{
var inputElement=formElements[i];
if(vg.html.inputHasDefaultText(inputElement) )
{
inputElement.value="";
}
}
return formElements;
}
vg.html.resetInputDefaultValues=function(defaultTextInputs)
{
var defaultTextInputsLength=defaultTextInputs.length;
for(var i=0;i < defaultTextInputsLength;i++)
{
var inputElement=defaultTextInputs[i];
if(inputElement.value==="")
{
inputElement.value=inputElement.defaultText;
}
}
}
vg.html.inputHasDefaultText=function(input)
{
return((input.value==input.defaultText)&&vg.html.hasStyle(ASINPUT_NOFOCUS_CLASS,input) );
}
vg.validation.isEmptyInput=function(input)
{
return vg.html.inputHasDefaultText(input)||isEmpty(input.value);
}
SelectTable=function(id, isHighlightRow, type, selectionPersist)
{
this.base=vg.Controller;
this.base(id, null);
this.isHighlightRow=isHighlightRow;
this.type=type;
this.selectionPersist=selectionPersist;
var skinElements=vg.html.getElements(vg.html.getElement('comp-'+id),{tagName:'span', attrName:'name', attrValue:'skin'});
this.skin=skinElements[0]?skinElements[0].className:null;
this.addListeners(this.viewNode.getElementsByTagName('TH'));
this.addListeners(this.viewNode.getElementsByTagName('TD'));
var controller=vg.comp.getController(id);
vg.html.addEventListener(this.viewNode, 'show', function(e){controller.show(e)});
if((this.type=="9box"&&!window.isNextGen)||this.skin==SelectTable.NINEBOX_SKIN2_CLASS)
{
this.addRoundedCorners();
}
else
{
this.show(this.viewNode);
}
}
SelectTable.PREFIX_BEHAVIOR=PREFIX_BEHAVIOR="selTblBeh";
SelectTable.COL_HEAD_BEHAVIOR=COL_HEAD_BEHAVIOR="selTblBehColHd";
SelectTable.ROW_HEAD_BEHAVIOR=ROW_HEAD_BEHAVIOR="selTblBehRowHd";
SelectTable.SELECT_ALL_BEHAVIOR=SELECT_ALL_BEHAVIOR="selTblBehSelAll";
SelectTable.DATA_CELL_BEHAVIOR=DATA_CELL_BEHAVIOR="selTblBehCell";
SelectTable.NINEBOX_SKIN2_CLASS=NINEBOX_SKIN2_CLASS="selTable-9box-skin2";
SelectTable.prototype.addRoundedCorners_d1=function()
{
var tds=this.viewNode.getElementsByTagName("td");
var tdTypes=new Array('topLft','topRgt','botLft','botRgt');
for(i=0;i < tds.length;i++)
{
var node=tds[i];
for(j=0;j < tdTypes.length;j++)
{
if(node.className.indexOf(tdTypes[j]) >=0)
{
var divO=document.createElement("div");
var divI=document.createElement("div");
vg.html.addStyle("corner", divO);
vg.html.addStyle(tdTypes[j], divI);
divO.innerHTML=node.innerHTML;
node.innerHTML=""
divO.appendChild(divI);
node.appendChild(divO);
}
}
}
}
SelectTable.prototype.addListeners=function(items)
{
var controller=vg.comp.getController(this.viewNode.getAttribute('id'));
for(i=0;i < items.length;i++)
{
var node=items[i];
var readonly=node.getAttribute("readonly");
readonly=readonly!=null&&readonly;
if(node.className!=null&&node.className.indexOf(SelectTable.PREFIX_BEHAVIOR) >=0&&!readonly)
{
vg.html.addEventListener(node, 'mouseenter', function(e){controller.mouseEnter(e)});
vg.html.addEventListener(node, 'mouseleave', function(e){controller.mouseLeave(e)});
if(this.selectionPersist)
{
vg.html.addEventListener(node, 'click', function(e){controller.dispatchEvent(e,true)});
}
}
}
}
SelectTable.prototype.countPreceding=function(parent, context, tag)
{
var count=0;
var nodes=parent.getElementsByTagName(tag);
for(var i=0;i < nodes.length;i++)
{
if(nodes[i]==context)
break;
count++;
}
return(count);
}
SelectTable.prototype.isValidColumn=function(node, currCol, col, keepheader)
{
if(node.tagName==null||node.className==null)
{
return;
}
if(node.tagName!='TD'&&(node.tagName=='TH'&&!keepheader))
return(false);
if(node.className.indexOf(SelectTable.PREFIX_BEHAVIOR) < 0)
return(false);
if(col >=0)
{
var colspan=node.getAttribute('colspan');
if(colspan!=null&&colspan!='1')
return(false);
if(currCol!=col)
return(false);
}
return(true);
}
SelectTable.prototype.extractRows=function(row, col, keepheader)
{
var nodes=new Array();
var colIndex=0;
var rowNodes=this.viewNode.getElementsByTagName('TR');
for(var i=0;i < rowNodes.length;i++)
{
if(row >=0&&i!=row)
{
continue;
}
var colNodes=rowNodes[i].childNodes;
var colCounter=1;
for(var j=0;j < colNodes.length;j++)
{
var node=colNodes[j];
if(this.isValidColumn(node,colCounter,col,keepheader))
{
nodes[nodes.length]=node;
}
if(node.tagName=='TD'||(node.tagName=='TH'&&keepheader))
{
colCounter++;
}
}
if(row >=0)
{
break;
}
}
return(nodes);
}
SelectTable.prototype.clearAll=function(isClick)
{
var nodes=this.viewNode.getElementsByTagName('TD');
var node, selected;
var nodeLength=nodes.length;
for(var i=0;i < nodeLength;i++)
{
node=nodes[i];
selected=node.getAttribute('selected')==='true';
if(isClick||!selected)
{
vg.html.addOrRemoveStyle('TableCell-sel', node, false);
if(isClick)
{
node.setAttribute('selected',false);
}
}
}
var nodes=this.viewNode.getElementsByTagName('TH');
nodeLength=nodes.length;
for(var i=0;i < nodeLength;i++)
{
node=nodes[i];
selected=node.getAttribute('selected')==='true';
if(isClick||!selected)
{
vg.html.addOrRemoveStyle('TableHeadCell-sel', node,false);
if(isClick)
{
node.setAttribute('selected',false);
}
}
}
}
SelectTable.prototype._addSelectedClass=function(nodes, isClick, className)
{
var node;
var nodeLength=nodes.length;
for(var i=0;i < nodeLength;i++)
{
node=nodes[i];
vg.html.addOrRemoveStyle(className, node, true);
if(isClick)
{
node.setAttribute('selected','true');
}
}
}
SelectTable.prototype.findFirstSelectAllHeader=function()
{
var nodes=this.viewNode.getElementsByTagName('TH');
for(var i=0;i < nodes.length;i++)
{
var node=nodes[i];
if(node.className!=null&&node.className.indexOf(SelectTable.SELECT_ALL_BEHAVIOR) >=0)
{
return(node);
}
}
return(null);
}
SelectTable.prototype.addRoundedCorners=function()
{
var tds=this.viewNode.getElementsByTagName("td");
var tdTypes=new Array('topLft','topRgt','botLft','botRgt');
for(i=0;i < tds.length;i++)
{
var node=tds[i];
var cornerDivArray=new Array();
var divO=document.createElement("div");
vg.html.addStyle("nineBox", divO);
for(j=0;j < tdTypes.length;j++)
{
if(node.className.indexOf(tdTypes[j]) >=0)
{
var divI=document.createElement("div");
vg.html.addStyle(tdTypes[j]+"El", divI);
cornerDivArray.push(divI);
}
}
for(k=0;k < cornerDivArray.length;k++)
{
divO.appendChild(cornerDivArray[k]);
}
var span=document.createElement("span");
span.innerHTML=node.innerHTML;
node.innerHTML="";
divO.appendChild(span);
node.appendChild(divO);
}
}
SelectTable.prototype.methHighlightColumn=function(context, isClick)
{
var colPos=this.countPreceding(context.parentNode,context,context.tagName);
var nodes=this.extractRows(-1,colPos,false);
this._addSelectedClass(nodes, isClick, 'TableCell-sel');
this._addSelectedClass(new Array(context), isClick, 'TableHeadCell-sel');
}
SelectTable.prototype.methHighlightRow=function(context, isClick)
{
if(this.isHighlightRow)
{
var rowPos=this.countPreceding(this.viewNode,context.parentNode,'TR');
var nodes=this.extractRows(rowPos,-1,false);
this._addSelectedClass(nodes, isClick, 'TableCell-sel');
}
this._addSelectedClass(new Array(context), isClick, 'TableHeadCell-sel');
}
SelectTable.prototype.methHighlightAll=function(context, isClick)
{
var nodes=this.extractRows(-1,-1,false);
this._addSelectedClass(nodes, isClick, 'TableCell-sel');
this._addSelectedClass(new Array(context), isClick, 'TableHeadCell-sel');
}
SelectTable.prototype.methHighlightHeaders=function(context, isClick)
{
var rowPos=this.countPreceding(this.viewNode,context.parentNode,'TR');
var nodes=this.extractRows(rowPos,-1,true);
if(nodes[0]!=null&&nodes[0].className!=null&&nodes[0].className.indexOf(SelectTable.ROW_HEAD_BEHAVIOR) >=0)
{
this._addSelectedClass(new Array(nodes[0]), isClick, 'TableHeadCell-sel');
}
var colspan=context.getAttribute('colspan');
if(colspan==null||colspan=='1')
{
nodes=this.viewNode.getElementsByTagName('TH');
var colPos=this.countPreceding(context.parentNode,context,context.tagName)+1;
if(nodes[colPos]!=null&&nodes[colPos].className!=null&&nodes[colPos].className.indexOf(SelectTable.COL_HEAD_BEHAVIOR) >=0)
{
this._addSelectedClass(new Array(nodes[colPos]), isClick, 'TableHeadCell-sel');
}
}
}
SelectTable.prototype.methHighlightCell=function(context, isClick)
{
this._addSelectedClass(new Array(context), isClick, 'TableCell-sel');
}
SelectTable.prototype.behvSelectTableColHead=function(context, isEnter, isClick)
{
this.clearAll(isClick);
if(isEnter)
{
this.methHighlightColumn(context, isClick);
}
}
SelectTable.prototype.behvSelectTableRowHead=function(context, isEnter, isClick)
{
this.clearAll(isClick);
if(isEnter)
{
this.methHighlightRow(context, isClick);
}
}
SelectTable.prototype.behvSelectAll=function(context, isEnter, isClick)
{
this.clearAll(isClick);
if(isEnter)
{
this.methHighlightAll(context, isClick);
}
}
SelectTable.prototype.behvSelectTableCell=function(context, isEnter, isClick)
{
this.clearAll(isClick);
if(isEnter)
{
this.methHighlightCell(context, isClick);
this.methHighlightHeaders(context, isClick);
}
}
SelectTable.prototype.dispatchEvent=function(e, isEnter)
{
var evtNode=jsCBDgetEventNode(e);
if(evtNode.className==null||evtNode.className==""||(evtNode.className.indexOf(SelectTable.PREFIX_BEHAVIOR) <0))
{
while(evtNode.nodeName!='TBODY'&&
(evtNode.className!=null&&evtNode.className.indexOf(SelectTable.PREFIX_BEHAVIOR) <0))
{
evtNode=evtNode.parentNode;
}
if(evtNode.className==null) return;
}
var isClick=e.type==="click";
if(evtNode.className.indexOf(SelectTable.COL_HEAD_BEHAVIOR) >=0)
{
this.behvSelectTableColHead(evtNode, isEnter, isClick);
}
else if(evtNode.className.indexOf(SelectTable.ROW_HEAD_BEHAVIOR) >=0)
{
this.behvSelectTableRowHead(evtNode, isEnter, isClick);
}
else if(evtNode.className.indexOf(SelectTable.SELECT_ALL_BEHAVIOR) >=0)
{
this.behvSelectAll(evtNode, isEnter, isClick);
}
else if(evtNode.className.indexOf(SelectTable.DATA_CELL_BEHAVIOR) >=0)
{
this.behvSelectTableCell(evtNode, isEnter, isClick);
}
}
SelectTable.prototype.mouseEnter=function(e)
{
this.dispatchEvent(e,true);
}
SelectTable.prototype.mouseLeave=function(e)
{
var evt=jsCBDgetEvent(e);
var evtNode=jsCBDgetEventNode(e);
var toNode=evt.relatedTarget||evt.toElement;
while(!isEmpty(toNode)&&toNode!=evtNode&&toNode.nodeName!='BODY')
{
toNode=toNode.parentNode;
if(toNode==evtNode) return;
}
this.dispatchEvent(e,false);
}
SelectTable.prototype.show=function(e)
{
var node=this.findFirstSelectAllHeader();
if(node!=null)
{
this.behvSelectAll(node,true);
}
}
vg.ageBand.HOVER='hover';
vg.ageBand.SELECTED='selected';
vg.ageBand.DEFAULT='default';
vg.ageBand.HIDE='ageBandHide';
vg.ageBand.allDefaultState=true;
vg.ageBand.inAgeBar=false;
vg.ageBand.selectedItem=null;
vg.ageBand.reset=function()
{
vg.ageBand.allDefaultState=true;
vg.ageBand.inAgeBar=false;
vg.ageBand.selectedItem=null;
}
vg.ageBand._mouseOver=function(obj, id)
{
if(vg.ageBand.allDefaultState)
{
vg.ageBand.inAgeBar=true;
vg.html.removeStyle(vg.ageBand.DEFAULT, obj);
vg.ageBand._itemHover(obj);
vg.ageBand._selectBand(id);
}
else
{
if(!vg.html.hasStyle(vg.ageBand.SELECTED, obj) )
{
vg.ageBand._itemHover(obj);
if(vg.ageBand.selectedItem)
{
vg.html.addStyle(vg.ageBand.HIDE, vg.ageBand.selectedItem);
}
}
}
}
vg.ageBand._mouseOut=function(obj, id)
{
if(vg.ageBand.allDefaultState)
{
vg.ageBand.inAgeBar=false;
vg.html.removeStyle(vg.ageBand.HOVER, obj);
vg.html.addStyle(vg.ageBand.DEFAULT, obj);
var items=vg.html.getElements(document.getElementById(id),{tagName:'div', attrName:'class', attrValue:''});
setTimeout(function()
{
if(!vg.ageBand.inAgeBar)
{
for(var i=0;i < items.length;i++)
{
items[i].className=vg.ageBand.DEFAULT;
}
}
}, 50 );
}
else
{
if(!vg.html.hasStyle(vg.ageBand.SELECTED, obj) )
{
vg.html.removeStyle(vg.ageBand.HOVER, obj);
if(vg.ageBand.selectedItem)
{
vg.html.removeStyle(vg.ageBand.HIDE, vg.ageBand.selectedItem);
}
}
}
}
vg.ageBand._onClick=function(obj, id, event)
{
var items=vg.html.getElements(document.getElementById(id),{tagName:'div', attrName:'class'}, function(node){return vg.html.hasStyle(vg.ageBand.SELECTED, node)});
for(var i=0;i < items.length;i++)
{
items[i].className="";
}
obj.className=vg.ageBand.SELECTED;
vg.ageBand.selectedItem=obj;
vg.ageBand._selectBand(id);
vg.ageBand.allDefaultState=false;
}
vg.ageBand._selectBand=function(id)
{
var items=vg.html.getElements(document.getElementById(id),{tagName:'div', attrName:'class', attrValue:vg.ageBand.DEFAULT});
for(var i=0;i < items.length;i++)
{
items[i].className="";
}
}
vg.ageBand._itemHover=function(obj)
{
vg.html.addStyle(vg.ageBand.HOVER, obj);
vg.ageBand._positionFloatingLabel(obj);
}
vg.ageBand._positionFloatingLabel=function(obj)
{
var floatingLabel=vg.html.getElements(obj,{tagName:'div', attrName:'class', attrValue:'floatLabel'})[0];
if(floatingLabel!=null&&!floatingLabel.isPositioned )
{
var container=vg.html.getSibling(floatingLabel,{tagName:'div', attrName:'class', attrValue:'container'}, "-");
var arrow=vg.html.getElements(container,{tagName:'div', attrName:'class', attrValue:'arrow'})[0];
var floatingLabelData=vg.html.getObjSizePosition(floatingLabel);
var arrowData=vg.html.getObjSizePosition(arrow);
var arrowCenter=arrowData.x+arrowData.w/2;
var leftLoc=arrowCenter - floatingLabelData.w/2
floatingLabel.style.left=leftLoc+"px";
floatingLabel.isPositioned=true;
}
}
Populator=function(cfg )
{
vg.util.attachJsonOptions(this, cfg );
var parent=document.getElementById(this.parentId);
parent.populator=this;
this.populatorLoaded=false;
if(this.execOnLoad&&!this.inline)
{
Populator._execute(parent);
}
}
Populator.exists=function(obj)
{
return obj.populator!=null;
}
Populator._copy=function(source, target)
{
target.populator=source.populator;
}
Populator._execute=function(obj, callBack)
{
if(Populator.exists(obj)&&(!jsCBDisPopulatorLoaded(obj)||obj.populator.type=='always'))
{
if(!obj.populator.inline)
{
var url=obj.populator.populatorUrl;
if(obj.populator.onLoad )
{
url=jsCBDaddQueryStringParam(url, 'cbdCallback', obj.populator.onLoad, false, false );
}
function _callback()
{
vg.html._fireCustomEvent(vg.event.DOM_CHANGE, obj );
if(callBack )
{
callBack.apply(window, arguments );
}
}
if(ie)
{
jsCBDloadContent(url, obj, 'replaceChildren', _callback );
}
else
{
vg.util.execOnPageReady
(
function()
{
jsCBDloadContent(url, obj, 'replaceChildren', _callback );
}
);
}
}
else
{
Populator._loadInlineContent(obj, callBack);
}
obj.populator.populatorLoaded=true;
}
}
Populator._loadInlineContent=function(obj, callBack)
{
var xmpTag=obj.getElementsByTagName("xmp");
_callback=callBack;
vg.util.execOnPageReady(function populatorLoad(){
jsCBDsetElementInnerHtml(obj, xmpTag[0].innerHTML, null);
if(callBack!=null)
{
setTimeout(function(){callBack()}, 50);
}
vg.html._fireCustomEvent(vg.event.DOM_CHANGE, obj );
});
}
Populator._remove=function(obj)
{
obj.populator=null;
}
jsCBDisPopulatorLoaded=function(parentId)
{
var parent=vg.html.getElement(parentId);
if(Populator.exists(parent))
{
return parent.populator.populatorLoaded;
}
}
RoundBox=function(id, fromColor, toColor)
{
this.base=vg.Controller;
this.base(id, null, true);
this.id=id;
this.inState=false;
this.fromColor=fromColor;
this.toColor=toColor;
this.HTMLElement=vg.html.getElement(this.id).getElementsByTagName('table')[0];
var controller=this;
this.mouseManager=new vg.MouseManager(
{
element:document.getElementById(this.id),
onMouseEnter:function(){controller.enterRoundBox()},
onMouseLeave:function(){controller.leaveRoundBox()}
}
);
vg.html.addEventListener(this.viewNode, 'click', function(e){controller.clickRoundBox(e)});
}
RoundBox.prototype=
{
clickRoundBox:function(e)
{
if(this.inState==false&&
jsCBDgetEventNode(e).tagName.toLowerCase()!='a'&&
jsCBDgetEventNode(e).tagName.toLowerCase()!='select'&&
jsCBDgetEventNode(e).tagName.toLowerCase()!='input')
{
eval(this.viewNode.getAttribute('clickJs'));
}
},
enterRoundBox:function()
{
vg.smil.animateElement(this.HTMLElement, 'backgroundColor', 200, 0, null, this.toColor, null, null, null, true);
},
leaveRoundBox:function()
{
vg.smil.animateElement(this.HTMLElement, 'backgroundColor', 200, 0, null, this.fromColor, null, null, null, true);
}
}
var DISABLE_DIV_CONTAINER="CBD_DISABLE_DIV_CONTAINER";
vg.html.openDisableDiv=function(coveredEl,opac,layerId,layerDelay,layerResize,waitCursor,opacColor,loadingIndicator)
{
if(coveredEl.coveredEl!=null)
{
opac=coveredEl.opac;
layerId=coveredEl.layerId;
layerDelay=coveredEl.layerDelay;
layerResize=coveredEl.layerResize;
waitCursor=coveredEl.waitCursor;
opacColor=coveredEl.opacColor;
coveredEl=coveredEl.coveredEl;
}
var controller=vg.html._getDisDivController(coveredEl);
if(controller&&controller.disDiv&&controller.disDiv.parentNode)
{
controller.openDisableModalDiv(opac,layerId,layerDelay,layerResize,waitCursor,opacColor);
}
else
{
if(window.isNextGen)
{
new Scrim(coveredEl,opac,layerId,layerDelay,layerResize,waitCursor,opacColor,loadingIndicator)
}
else
{
new DisableModalDiv(coveredEl,opac,layerId,layerDelay,layerResize,waitCursor,opacColor);
}
}
}
vg.html.isDisableDivOpen=function(coveredEl)
{
var controller=vg.html._getDisDivController(coveredEl);
if(controller&&controller.disDiv&&controller.disDiv.parentNode)
{
return jsCBDisVisibleElement(controller.disDiv,false);
}
return false;
}
vg.html.closeDisableDiv=function(coveredEl)
{
var controller=vg.html._getDisDivController(coveredEl);
if(controller)
{
controller.closeDisableModalDiv();
}
}
vg.html.closeAllDisableDivs=function()
{
var disDivCont=document.getElementById(DISABLE_DIV_CONTAINER);
if(!disDivCont) return;
for(var i=0;i<disDivCont.divArray.length;i++)
{
var controller=disDivCont.divArray[i].controller;
controller.closeDisableModalDiv();
}
}
vg.html._resizeDisableDivs=function()
{
var disDivCont=document.getElementById(DISABLE_DIV_CONTAINER);
if(!disDivCont) return;
for(var i=0;i<disDivCont.divArray.length;i++)
{
var controller=disDivCont.divArray[i].controller;
controller.positionSizeDisableModalDiv();
if(controller.layerState)
{
controller.positionSizeDisableLayer();
}
}
}
vg.html._getDisDivController=function(coveredEl)
{
var disDivCont=document.getElementById(DISABLE_DIV_CONTAINER);
var coveredElem=(vg.html.getElement(coveredEl).id )?vg.html.getElement(coveredEl).id:vg.html.getElement(coveredEl);
if(disDivCont&&disDivCont.divArray)
{
for(var i=0;i<disDivCont.divArray.length;i++)
{
if(disDivCont.divArray[i].coveredEl==coveredElem)
return disDivCont.divArray[i].controller;
}
}
return null;
}
DisableModalDiv=function(coveredEl,opac,layerId,layerDelay,layerResize,waitCursor,opacColor)
{
this.base=vg.Controller;
this.base(coveredEl, null);
this.defaultColor='#FFFFFF';
this.defaultOpac=0.75;
this.defaultToWait=true;
this.layer=null;
this.minWidthDiv=null;
this.opacColor=opacColor;
this.coveredEl=(vg.html.getElement(coveredEl).id)?vg.html.getElement(coveredEl).id:vg.html.getElement(coveredEl);
this.createDisableModalDiv(coveredEl);
this.openDisableModalDiv(opac,layerId,layerDelay,layerResize,waitCursor,opacColor);
}
DisableModalDiv._removeOrphanNodes=function()
{
var disDivCont=document.getElementById(DISABLE_DIV_CONTAINER);
if(!disDivCont||!disDivCont.divArray)
{
return;
}
var divArray=disDivCont.divArray;
for(var i=divArray.length-1;i>=0;i--)
{
var disableDiv=divArray[i];
if(disableDiv!=null)
{
var contr=disableDiv.controller;
var divLayer=contr.layer;
var layerScrollDiv=divLayer?vg.Layer.getScrollDiv(divLayer.id):null;
var disDivParent=contr.disDiv.parentNode;
var triggerElem=vg.html.getElement(disableDiv.coveredEl);
if(!triggerElem||
!triggerElem.parentNode||
!disDivParent||
(divLayer&&layerScrollDiv!=disDivParent))
{
if(disDivParent)
{
disDivParent.removeChild(contr.disDiv);
}
divArray.splice(i, 1);
}
}
}
}
DisableModalDiv.prototype=
{
createDisableModalDiv:function(coveredEl)
{
var disDivCont=document.getElementById(DISABLE_DIV_CONTAINER);
var parentLayerId, parentLayer, parentLayerContr;
var controller=this;
if(!disDivCont)
{
var disDivCont=document.createElement('div');
disDivCont.setAttribute("id",DISABLE_DIV_CONTAINER);
document.getElementById('main').appendChild(disDivCont);
}
var disDiv=this.constructDisabledDiv();
var parentLayerSpan=vg.html.findAncestor(vg.html.getElement(coveredEl),{tagName:"span", attrName:"type", attrValue:"Layer"});
if(parentLayerSpan)
{
parentLayerId=parentLayerSpan.getAttribute('id').substr(5);
parentLayer=document.getElementById(parentLayerId);
parentLayerContr=vg.comp.getController(parentLayer);
}
if(parentLayer&&parentLayerContr)
{
var layerScrollDiv=vg.html.getElements(parentLayer,{tagName:'div', attrName:'class', attrValue:parentLayerContr.scrollDiv_css})[0];
var minWidthDiv=vg.html.getElements(parentLayer,{tagName:'div', attrName:'name', attrValue:'min-width'})[0];
if(minWidthDiv)
{
var minWidthDivParent=minWidthDiv.parentNode;
if(layerScrollDiv&&minWidthDivParent!=layerScrollDiv)
{
layerScrollDiv.appendChild(minWidthDiv);
}
}
if(layerScrollDiv)
{
layerScrollDiv.appendChild(disDiv );
vg.html.addEventListener(null, vg.event.LAYER_REPOSITION, function(e){controller.positionSizeDisableModalDiv()});
vg.html.addEventListener(null, vg.event.LAYER_OPEN, function(e){controller.positionSizeDisableModalDiv()});
}
}
else
{
disDivCont.appendChild(disDiv );
}
if(!disDivCont.divArray )
{
disDivCont.divArray=new Array();
}
disDivCont.divArray.push({coveredEl:this.coveredEl, controller:this});
this.layer=parentLayer;
this.minWidthDiv=minWidthDiv;
this.disDiv=disDiv;
this.setDisDivOpacity(this.defaultOpac);
return disDiv;
},
constructDisabledDiv:function()
{
var disDiv=document.createElement('div');
disDiv.style.display="none";
disDiv.style.zIndex="120";
disDiv.style.background=(this.opacColor)?this.opacColor:"#FFFFFF";
disDiv.style.position="absolute";
return disDiv;
},
openDisableModalDiv:function(opac,layerId,layerDelay,layerResize,waitCursor,opacColor)
{
var coveredEl=vg.html.getElement(this.coveredEl);
var pos=this.positionSizeDisableModalDiv();
if(this.loadingIndicator&&window.isNextGen)
{
this._positionLoadingIndicator();
}
jsCBDtoggleElement(this.disDiv, true);
this.setDisDivOpacity(opac);
waitCursor=(waitCursor!=null)?waitCursor:this.defaultToWait;
if(waitCursor)
this.disDiv.style.cursor="wait";
if(ie&&CBD_FLOATING_HEAD)
{
coveredEl.setAttribute('covered','true');
vg.html._fireCustomEvent(vg.event.ELEMENT_DISABLED, coveredEl );
}
if(layerId!=null)
{
this.layerId=layerId;
this.layerDelay=(layerDelay!=null)?layerDelay:"5";
this.layerResize=(layerResize!=null)?layerResize:true;
this.layerState=true;
this.waitCursor=waitCursor;
this.positionSizeDisableLayer();
this.openDisableLayer();
}
vg.html.toggleInputTabIndex(coveredEl, true);
},
closeDisableModalDiv:function()
{
jsCBDtoggleElement(this.disDiv, false);
var coveredEl=vg.html.getElement(this.coveredEl);
if(coveredEl&&ie&&CBD_FLOATING_HEAD)
{
coveredEl.setAttribute('covered','false');
vg.html._fireCustomEvent(vg.event.ELEMENT_DISABLED, coveredEl );
}
vg.html.toggleInputTabIndex(coveredEl, false);
this.layerState=false;
clearTimeout(this.t);
if(this.layerId)
{
jsCBDcloseLayer(this.layerId);
}
this.disDiv.style.cursor="auto";
},
setDisDivOpacity:function(opac)
{
this.opac=(opac==null)?this.defaultOpac:opac;
vg.html.setOpacity(this.disDiv,this.opac);
},
positionSizeDisableModalDiv:function()
{
var coveredEl=vg.html.getElement(this.coveredEl);
var layerDiv=this.layer;
var pos=vg.html.getObjXY(coveredEl);
var size=vg.html.getObjSize(coveredEl);
pos.w=size.w;
pos.h=size.h;
var disDiv=this.disDiv;
if(!layerDiv&&disDiv )
{
disDiv.style.left=pos.x -1+"px";
disDiv.style.top=pos.y - 1+"px";
vg.html.setWidth(disDiv,pos.w+2+"px");
vg.html.setHeight(disDiv,pos.h+2+"px");
}
else if(layerDiv&&disDiv&&this.minWidthDiv)
{
if(ie)
{
var offsetObj=coveredEl;
var topOffset=0;
var leftOffset=0;
while(offsetObj&&offsetObj!=this.disDiv.parentNode)
{
topOffset+=offsetObj.offsetTop;
leftOffset+=offsetObj.offsetLeft;
offsetObj=offsetObj.offsetParent;
}
this.disDiv.style.left=leftOffset+"px";
this.disDiv.style.top=topOffset+"px";
this.disDiv.style.position="absolute";
}
else
{
this.disDiv.style.left=coveredEl.offsetLeft - this.minWidthDiv.offsetLeft+"px";
this.disDiv.style.top=coveredEl.offsetTop - this.minWidthDiv.offsetTop - 1+"px";
this.disDiv.style.position="relative";
}
vg.html.setWidth(this.disDiv,pos.w+2+"px");
vg.html.setHeight(this.disDiv,pos.h+2+"px");
}
disDiv.pos=pos;
return pos;
},
positionSizeDisableLayer:function()
{
vg.comp._lazyLoadComp(this.layerId);
var layer=vg.comp.getController(document.getElementById(this.layerId));
var disDiv=this.disDiv;
if(this.layerResize)
{
var w,h
h=.5*disDiv.pos.h;
h=(h > "200")?"200":(h < "150")?"150":h;
w=2*h;
w=(w > "400")?"400":(w < "300")?"300":(w > .8*disDiv.pos.w)?.8*disDiv.pos.w:w;
layer.width=w+"px";
layer.height=h+"px";
layer.positionLeft=disDiv.pos.x+(disDiv.pos.w-w)/2;
layer.initSize();
}
layer.reposition();
layer.outerDiv.style.width="100%";
if(this.waitCursor)
{
layer.outerDiv.style.cursor='wait';
}
},
openDisableLayer:function()
{
var controller=this;
this.t=setTimeout(function()
{
if(controller.layerState)
{
jsCBDopenLayer(controller.layerId);
}
}, parseFloat(controller.layerDelay)*1000 );
},
_positionLoadingIndicator:function()
{
var coveredEl=this.coveredEl;
var loadIndicatorDiv=this.loadIndicatorDiv;
var loadingIndicatorHeight=this.loadingIndicatorHeight;
var loadingIndicatorWidth=this.loadingIndicatorWidth;
var bodyScrollTop=_cbdGetScrollTop();
var scrollLeft=_cbdGetScrollLeft();
var screenHeight=jsCBDgetScreenHeight();
var screenWidth=jsCBDgetScreenWidth();
var scrimWidth=vg.html.getObjWidth(coveredEl);
var scrimHeight=vg.html.getObjHeight(coveredEl);
var scrimYPosTop=vg.html.getObjY(document.getElementById(coveredEl));
var scrimYPosBottom=scrimYPosTop+scrimHeight;
var scrimXPosLeft=vg.html.getObjXY(document.getElementById(coveredEl)).x;
var scrimXPosRight=scrimXPosLeft+scrimWidth;
var screenYPosTop=bodyScrollTop;
var screenYPosBottom=bodyScrollTop+screenHeight;
var screenXPosLeft=scrollLeft;
var screenXPosRight=scrollLeft+screenWidth;
var topOfScrimInView=((scrimYPosTop >=screenYPosTop)&&(scrimYPosTop <=screenYPosBottom));
var bottomOfScrimInView=((scrimYPosBottom <=screenYPosBottom)&&(scrimYPosBottom >=screenYPosTop));
var leftOfScrimInView=((scrimXPosLeft >=screenXPosLeft)&&(scrimXPosLeft <=screenXPosRight));
var rightOfScrimInView=((screenXPosRight >=screenXPosLeft)&&(scrimXPosRight <=screenXPosRight));
var loadIndYPos;
var loadIndXPos;
if((scrimYPosTop < screenYPosTop)&&(scrimYPosBottom > screenYPosBottom) )
{
loadIndYPos=parseInt((screenHeight - loadingIndicatorHeight)/2+(bodyScrollTop - scrimYPosTop));
}
else if(!bottomOfScrimInView&&topOfScrimInView)
{
loadIndYPos=parseInt((screenHeight -(scrimYPosTop - bodyScrollTop) - loadingIndicatorHeight)/2);
}
else if(!topOfScrimInView&&bottomOfScrimInView)
{
loadIndYPos=parseInt(((scrimYPosBottom - bodyScrollTop - loadingIndicatorHeight)/2)+(bodyScrollTop - scrimYPosTop));
}
else
{
loadIndYPos=parseInt((scrimHeight - loadingIndicatorHeight)/2);
}
if((scrimXPosLeft < screenXPosLeft)&&(scrimXPosRight > screenXPosRight) )
{
loadIndXPos=parseInt((screenWidth - loadingIndicatorWidth)/2+(scrollLeft - scrimXPosLeft));
}
else if(!rightOfScrimInView&&leftOfScrimInView)
{
loadIndXPos=parseInt((screenWidth -(scrimXPosLeft - scrollLeft) - loadingIndicatorWidth)/2);
}
else if(!leftOfScrimInView&&rightOfScrimInView)
{
loadIndXPos=parseInt(((scrimXPosRight - scrollLeft - loadingIndicatorWidth)/2)+(scrollLeft - scrimXPosLeft));
}
else
{
loadIndXPos=parseInt((scrimWidth - loadingIndicatorWidth)/2);
}
vg.html.setObjTop(loadIndicatorDiv, loadIndYPos);
vg.html.setLeft(loadIndicatorDiv, loadIndXPos);
loadIndicatorDiv.style.display="block";
}
}
Scrim=function(coveredEl,opac,layerId,layerDelay,layerResize,waitCursor,opacColor,loadingIndicator)
{
var COMP_TYPE="scrim";
this.base=vg.Controller;
this.base({viewNodeId:coveredEl,compType:COMP_TYPE});
this.compType=COMP_TYPE;
this.defaultColor='#FFFFFF';
this.defaultToWait=false;
this.defaultOpac=0.65;
this.layer=null;
this.minWidthDiv=null;
this.opacColor=opacColor;
this.loadingIndicatorWidth=36;
this.loadingIndicatorHeight=36;
this.loadingIndicator=loadingIndicator;
this.coveredEl=(vg.html.getElement(coveredEl).id)?vg.html.getElement(coveredEl).id:vg.html.getElement(coveredEl);
this.createDisableModalDiv(coveredEl);
this.openDisableModalDiv(opac,layerId,layerDelay,layerResize,waitCursor,opacColor);
}
var EmptyFunc=function(){};
EmptyFunc.prototype=DisableModalDiv.prototype;
Scrim.prototype=new EmptyFunc();
Scrim.prototype.constructDisabledDiv=function()
{
var disDiv=document.createElement('div');
disDiv.style.display="none";
disDiv.style.fontSize="0px";
disDiv.style.zIndex="120";
disDiv.style.position="absolute";
var disDivChild=document.createElement('div');
disDivChild.style.background=(this.opacColor)?this.opacColor:this.defaultColor;
disDivChild.style.position="absolute";
disDiv.appendChild(disDivChild);
if(this.loadingIndicator)
{
this.loadIndicatorDiv=document.createElement('div');
vg.html.setStyle("loadIndicator", this.loadIndicatorDiv);
disDiv.appendChild(this.loadIndicatorDiv);
}
return disDiv;
}
Scrim.prototype.positionSizeDisableModalDiv=function()
{
var coveredEl=vg.html.getElement(this.coveredEl);
var layerDiv=this.layer;
var pos=vg.html.getObjXY(coveredEl);
var size=vg.html.getObjSize(coveredEl);
pos.w=size.w;
pos.h=size.h;
var disDiv=this.disDiv;
if(!layerDiv&&disDiv )
{
disDiv.style.left=pos.x -1+"px";
disDiv.style.top=pos.y - 1+"px";
vg.html.setWidth(disDiv.firstChild,pos.w+2+"px");
vg.html.setHeight(disDiv.firstChild,pos.h+2+"px");
}
else if(layerDiv&&disDiv&&this.minWidthDiv)
{
this.disDiv.firstChild.style.left=coveredEl.offsetLeft - this.minWidthDiv.offsetLeft+"px";
this.disDiv.style.top=coveredEl.offsetTop - this.minWidthDiv.offsetTop - 1+"px";
this.disDiv.style.position="relative";
vg.html.setWidth(this.disDiv.firstChild,pos.w+"px");
vg.html.setHeight(this.disDiv.firstChild,pos.h+"px");
}
disDiv.pos=pos;
return pos;
}
Scrim.prototype.setDisDivOpacity=function(opac)
{
if(this.disDiv.style.position=="relative")
{
this.disDiv.style.zoom="1";
}
this.opac=(opac==null)?this.defaultOpac:opac;
vg.html.setOpacity(this.disDiv.firstChild,this.opac);
}
_cbdGlobalObjects=new Array("cbd","vg", "chatPopup", "errCount", "pageLevelErrors", "allValidators", "_flashCharts", "flyoutArray", "FOCArray","Deck","DeckItem","RolloverMenu","RolloverMenuItem","SideTab","SideTabItem","CheckBox","InfoBox","RadioButton","NineBoxFilter","NavDeck","FlyoutContainer","AutoSuggest","SelectList","SelectTable","Populator","TabBox","RoundBox","DisableModalDiv","SelectOneMenu", "_cbdLooseFuncs");
if(!window._cbdNamespaceBackup )
{
_cbdNamespaceBackup={};
}
vg.util.loadClientSideComp=function(config)
{
if(!config) return;
var loader=cbd.loader;
if(config.module )
{
loader.require(config.module);
}
if(config.callback )
{
loader.addCallback(config.callback);
}
if(config.module||config.callback)
{
loader.load();
}
}
vg.util.loadJSIntoNS=function(load)
{
var _isJSfunctionsLoaded=function()
{
return(window.jsfunctionsLoaded);
}
var _cbdLoadLoader=function()
{
cbd.page.basePageLoaded=true;
jsCBDloadScript(load.server+window.loaderWebContextRoot+'/javascript/loader.js' );
_cbdCheckConditionsAndExecute(_isCBDLoaderDefined, _cbdLoadCoreFiles);
}
var _cbdLoadCoreFiles=function()
{
cbd.loader.require("RIA");
cbd.loader.require('AJAX');
cbd.loader.require('VG');
cbd.loader.require('FORMCHECK');
if(load.jsFiles)
{
var length=load.jsFiles.length;
for(var index=0;index < length;index++)
{
cbd.loader.addModule({
name:load.jsFiles[index],
type:'js',
fullpath:load.server+window.loaderWebContextRoot+load.jsFiles[index]
});
cbd.loader.require(load.jsFiles[index]);
}
}
cbd.loader.addCallback(function(){vg.util.execFunc(load.callback)});
cbd.loader.load();
}
var _cbdloadJSIntoNS=function(){
if(!(load.server)||(load.server==null))
{
load.server="";
}
_cbdSaveOriginalNamespace();
if(load.contextRoot!=null)
{
_cbdContextRoot=load.contextRoot;
}
window.jsfunctionsLoaded=false;
window.loaderWebBase=load.server;
if(load.webContextRoot)
{
window.loaderWebContextRoot=load.webContextRoot;
}
else
{
window.loaderWebContextRoot='/web'
}
jsCBDloadScript(load.server+window.loaderWebContextRoot+'/javascript/jsfunctions.js');
_cbdCheckConditionsAndExecute(_isJSfunctionsLoaded,_cbdLoadLoader);
}
_cbdCheckConditionsAndExecute(_cbdAreDelayedEventsFinished, _cbdloadJSIntoNS)
}
_cbdSaveOriginalNamespace=function()
{
for(var prop in window)
{
if(prop.indexOf('jsCBD')==0||prop.indexOf('_cbd')==0)
{
_cbdNamespaceBackup[prop]=window[prop];
}
}
for(i=0;i < _cbdGlobalObjects.length;i++)
{
_cbdNamespaceBackup[_cbdGlobalObjects[i]]=window[_cbdGlobalObjects[i]];
if(window[_cbdGlobalObjects[i]]instanceof Array)
{
window[_cbdGlobalObjects[i]]=new Array();
}
else
{
window[_cbdGlobalObjects[i]]=null;
}
}
}
vg.util.Map=function()
{
this.objArray=new Array();
}
vg.util.Map.prototype=
{
put:function(key, val)
{
this.objArray[key]=val;
},
get:function(key)
{
return this.objArray[key];
}
}
vg.comp._lazyLoadComp=function(id, requiredModule, event)
{
if(!vg.comp._hasController(id))
{
var script=vg.html._getElementWithIdPrefixes(id+"_script");
if(script!=null)
{
if(requiredModule)
{
cbd.loader.loadAndExec(requiredModule, function evalScript(){eval(script.innerHTML);}, true);
}
else
{
eval(script.innerHTML);
}
}
}
}
vg.util.restoreOriginalNS=function(func)
{
var _restore=function()
{
vg.html._cbdCopyProperties(_cbdNamespaceBackup._cbdLooseFuncs, window);
vg.html._cbdCopyProperties(_cbdNamespaceBackup, window);
vg.util.execFunc(func);
}
_cbdCheckConditionsAndExecute(_cbdAreDelayedEventsFinished, _restore)
}
vg.html._cbdCopyProperties=function(sourceNode, destinationNode)
{
for(var prop in sourceNode)
{
destinationNode[prop]=sourceNode[prop];
}
}
vg.html._cbdGetCSSContainer=function(targetNode)
{
return cssContainer=vg.html.findAncestor(targetNode,{},
function(node)
{
return vg.html.hasStyle("vg0", node)||vg.html.hasStyle("vg1", node);
}
);
}
HeightSyncCallout=function(tbId,clId)
{
this.base=vg.Controller;
this.tabbox=vg.html.getElement(tbId);
this.callout=vg.html.getElement(clId);
this.tabDiv=this.tabbox.getElementsByTagName('div')[0];
this.roundBox=this.tabbox.getElementsByTagName('table')[0];
this.scrollDiv=vg.html.getElements(this.roundBox,{tagName:'div', attrName:'class', attrValue:'roundBoxScrollDiv'})[0];
var controller=this;
vg.html.addEventListener(this.tabbox, 'click', function(e){controller.adjustHeight(e)});
vg.html.addEventListener(null, vg.event.GEO_CHANGE, function(e, args){controller.adjustHeight(e,args)});
vg.html.addEventListener(null, vg.event.DOM_CHANGE, function(e, args){controller.adjustHeight(e,args)});
vg.html.addEventListener(window, 'resize', function(e, args){controller.adjustHeight(e,args);});
this.adjustHeight();
}
HeightSyncCallout.prototype=
{
adjustHeight:function()
{
vg.html.setHeight(this.roundBox,(ie)?"100%":"auto");
vg.html.setHeight(this.scrollDiv,(ie)?"":"auto");
vg.html.setHeight(this.callout,(ie)?"100%":"auto");
var tabboxHeight=vg.html.getObjHeight(this.tabbox);
var tabDivHeight=vg.html.getObjHeight(this.tabDiv);
var scrollDivHeight=vg.html.getObjHeight(this.scrollDiv.parentNode);
var calloutHeight=vg.html.getObjHeight(this.callout);
if(tabboxHeight > calloutHeight )
{
vg.html.setHeight(this.callout,tabboxHeight+"px")
}
else
{
vg.html.setHeight(this.scrollDiv,calloutHeight-tabDivHeight+"px");
}
}
}
vg.Menu=function(cfg)
{
vg.util.attachJsonOptions(this, cfg);
this.base=vg.Controller;
this.base(this.id, null);
this.menuBar=null;
var THIS=this;
var init_menus=function()
{
var YUI=cbd.getYUI();
var menuBar=YUI.one(document.getElementById(THIS.id));
THIS.menuBar=menuBar.plug(YUI.Plugin.MenuBarPlugin, cfg);
};
cbd.loader.loadAndExec('cbdMenuPlugin', init_menus);
}
vg.Menu.selectedMenu=null;
vg.Menu.setLabel=function(id, text)
{
vg.html.getElement(id+"_labelSpanInner").innerHTML=text;
}
vg.Menu._closeMenu=function(e)
{
var openMenuNav=vg.Menu.selectedMenu,
openRootMenu=openMenuNav?openMenuNav._rootMenu:null,
eNode=jsCBDgetEventNode(e);
if(openMenuNav!=null)
{
if(e.type=='scroll')
{
if(!cbd.browser.isTouchScreen)
{
openMenuNav._hideAllSubmenus(openRootMenu);
}
}
else if(eNode!=null)
{
var clickedInsideMenu=openRootMenu.compareTo(eNode)||openRootMenu.contains(eNode);
if(!clickedInsideMenu)
{
openMenuNav._hideAllSubmenus(openRootMenu);
}
}
}
}
vg.Menu.prototype=
{
_destroy:function()
{
if(this.menuBar )
{
this.menuBar.destroy();
}
}
}
vg._removeFilter=function(fBarId, fId, onremove)
{
var fBarInput=document.getElementById(fBarId+"_x");
fBarInput.value=fId;
if(onremove!=null)
{
onremove(fBarId, fId);
}
}
vg.util.WINDOW_DATA_PFX=WINDOW_DATA_PFX="__s";
vg.util.WINDOW_DATA_SFX=WINDOW_DATA_SFX="__e";
vg.util._addWindowData=function(name, value)
{
if(window.name.indexOf(vg.util.WINDOW_DATA_PFX) >=0)
{
vg.util._getAndRemoveWindowData(name);
}
window.name=window.name+vg.util.WINDOW_DATA_PFX+name+value+vg.util.WINDOW_DATA_SFX+name;
}
vg.util._getAndRemoveWindowData=function(name)
{
var p="(.*)";
var regex=new RegExp(vg.util.WINDOW_DATA_PFX+name+p+vg.util.WINDOW_DATA_SFX+name);
var windowData=regex.exec(window.name);
if(windowData!=null)
{
window.name=window.name.replace(regex, "");
return windowData[1];
}
return null;
}
vg.wu.WU=WU="WU";
vg.wu.trackLink=function(link)
{
var linkLocation=jsCBDgetMetaTag("DCSext.pageid");
if(isEmpty(link) )
{
link="";
}
var cont="";
if(linkLocation)
{
cont=linkLocation.content;
}
vg.util._addWindowData(vg.wu.WU, link+':'+cont);
}
vg.wu.captureReferrerLink=function()
{
var linkLocationTrackInfo=vg.util._getAndRemoveWindowData(vg.wu.WU);
if(!isEmpty(linkLocationTrackInfo))
{
var linkLocationInfoArray=linkLocationTrackInfo.split(":");
jsCBDAddMetaTag('Link', linkLocationInfoArray[0]);
jsCBDAddMetaTag('LinkLocation',(linkLocationInfoArray.length==2)?linkLocationInfoArray[1]:"");
}
}
vg.wu._addMetaTagsForStrt=function()
{
var pageRendered=(_cbdStrtTimes.pageRendered - _cbdStrtTimes.headStart);
var pageResponsive=(_cbdStrtTimes.pageResponsive - _cbdStrtTimes.headStart);
var serverTime=_cbdStrtTimes.serverTime;
jsCBDAddMetaTag('strt.clntRendered', vg.wu._formatStrtTime(pageRendered));
jsCBDAddMetaTag('strt.clntResponsive', vg.wu._formatStrtTime(pageResponsive));
jsCBDAddMetaTag('strt.server', vg.wu._formatStrtTime(serverTime));
jsCBDAddMetaTag('strt.total', vg.wu._formatStrtTime(serverTime+pageResponsive));
}
vg.wu._formatStrtTime=function(timeInMs)
{
if(timeInMs&&!isNaN(timeInMs))
{
var timeInSec=(timeInMs/1000).toString();
var decimalIdx=timeInSec.indexOf('.');
if(decimalIdx >=0&&(timeInSec.length - decimalIdx) > 3)
{
timeInSec=timeInSec.substring(0, decimalIdx+3);
}
return timeInSec
}
return "";
}
vg.wu._logSPIFirstPage=false;
vg.wu.setLogSPIFirstPage=function(logPage)
{
vg.wu._logSPIFirstPage=logPage;
}
vg.wu.isLogSPIFirstPage=function()
{
return vg.wu._logSPIFirstPage;
}
vg.Label=function(options)
{
this.id=options.id
this.haveError=new Array();
this.base=vg.Controller;
this.base(this.id, null);
}
vg.Label.prototype=
{
updateStatus:function(cid,error)
{
if(error)
{
if(!this._contains(cid))
{
this.haveError.push(cid);
}
}
else
{
if(this._contains(cid))
{
var idx=this._getIndex(cid);
if(idx!=-1)
{
this.haveError.splice(idx,1);
}
}
}
this._updateErrorStatus();
},
_getIndex:function(cid)
{
for(var i=0;i<this.haveError.length;i++)
{
if(cid==this.haveError[i])
{
return i;
}
}
return -1;
},
_contains:function(item)
{
for(var i=0;i<this.haveError.length;i++)
{
if(item==this.haveError[i])
{
return true;
}
}
return false;
},
_updateErrorStatus:function()
{
var self=document.getElementById(this.id);
if(this.haveError.length>0)
{
jsCBDaddStyle(self,"err");
}
else
{
jsCBDdeleteStyle(self,"err");
}
}
}
vg.ErrorManager=function(options)
{
this.id=options.id;
this.labelIds=options.labelIds;
this.errMsgDur=options.errMsgDur?options.errMsgDur:3000;
this.errMsgPos=options.errMsgPos?options.errMsgPos:"auto";
if(this.errMsgPos=="bottom")
{
this.errMsgPos="bottomLeft";
}
else if(this.errMsgPos=="top")
{
this.errMsgPos="topLeft";
}
this.errMsgs=options.errMsgs;
this.activeErrorMsg=options.activeErrorMsg;
this.errorProneType=options.errorProneType;
this.base=vg.Controller;
this.base(this.id, null, null, vg.ErrorManager.TYPE);
}
vg.ErrorManager.TYPE="errorManager";
vg.ErrorManager.prototype=
{
getLabelIds:function(){return this.labelIds;},
getErrMsgDur:function(){return this.errMsgDur;},
getErrMsgPos:function(){return this.errMsgPos;},
getErrMsgContent:function(id)
{
return this.errMsgs[id];
},
updateErrorStatus:function(status)
{
this._flagLabels(status);
},
_flagLabels:function(status)
{
var labels=this.getLabelIds();
if(labels&&labels.length>0)
{
for(var i=0;i<labels.length;i++)
{
vg.comp.getController(labels[i]).updateStatus(this.id,status);
}
}
}
}
vg.Div=function(id)
{
this.base=vg.Controller;
this.base(id, null);
if(cbd.browser.isTouchScreen&&vg.html.isFixedHeight(this.viewNode))
{
vg.touchScreen._makeNodeScrollable(id);
vg.html.addEventListener(this.viewNode, vg.event.GEO_CHANGE, function(){vg.touchScreen._makeNodeScrollable(id);});
}
if(vg.html.isFixedHeight(this.viewNode)||vg.html.isFixedWidth(this.viewNode))
{
vg.html.addEventListener(this.viewNode, 'scroll' , function(evt)
{
vg.comp.closeAllMenus(evt);
}
);
}
}
vg.comp.closeAllMenus=function(event)
{
_cbdClosePrevSelectOneMenu();
if(vg.Menu)
{
vg.Menu._closeMenu(event);
}
}
vg.Container=function(id)
{
this.base=vg.Controller;
this.base(id, null);
if(cbd.browser.isTouchScreen&&vg.html.isFixedHeight(this.viewNode))
{
vg.touchScreen._makeNodeScrollable(id);
vg.html.addEventListener(this.viewNode, vg.event.GEO_CHANGE, function(){vg.touchScreen._makeNodeScrollable(id);});
}
}
var InfoBoxFactory=null;
CompManager=function()
{
}
CompManager.prototype=
{
_setCompConfig:function(id, compType, e)
{
if("INFOBOX"==compType)
{
var THIS=this;
function configureInfoBoxFactory()
{
var config=THIS._retrieveConfig(id);
InfoBoxFactory._configure(config, e);
}
if(InfoBoxFactory==null)
{
cbd.loader.loadAndExec('cbdInfoBox',
function createInfoBoxFactory()
{
InfoBoxFactory=new InfoBox(null, null, null, null, null, null, null, true);
configureInfoBoxFactory();
vg.html.addEventListener(document.body, 'touchstart', function(e){InfoBox.close()});
},
true);
}
else
{
configureInfoBoxFactory();
}
}
},
_retrieveConfig:function(id)
{
id=vg.html._getFullyQualifiedId(id)
var comp=vg.html.getElement(id);
if(comp!=null&&comp.conf!=null)
{
return comp.conf;
}
else
{
comp.conf=eval('('+comp.getAttribute("config")+')');
comp.conf.id=id;
return comp.conf;
}
}
}
var compManager=new CompManager();
vg.GridCompScrim=function(gridId)
{
var gridComp=vg.html.getElement(gridId);
var gridCompScrim=vg.html.getElement(gridId+"_gridCompScrim");
if(gridComp&&gridCompScrim)
{
if(ie&&CBD_FLOATING_HEAD)
{
gridComp.setAttribute('covered','true');
vg.html._fireCustomEvent(vg.event.ELEMENT_DISABLED, gridComp );
}
vg.html.toggleInputTabIndex(gridComp, true);
}
}
vg.html.openGridCompScrim=function(gridId)
{
var scrimDiv=vg.html.getElement(gridId+"_gridCompScrim");
var gridComp=vg.html.getElement(gridId);
var scrimWrapperDiv=vg.html.getElement(gridId+"_gridCompScrimWrapper");
if(scrimDiv&&gridComp&&scrimWrapperDiv)
{
scrimWrapperDiv.style.position="relative";
jsCBDtoggleElement(scrimDiv, true);
if(ie&&CBD_FLOATING_HEAD)
{
gridComp.setAttribute('covered','true');
vg.html._fireCustomEvent(vg.event.ELEMENT_DISABLED, gridComp );
}
vg.html.toggleInputTabIndex(gridComp, true);
}
}
vg.html.closeGridCompScrim=function(gridId)
{
var scrimDiv=vg.html.getElement(gridId+"_gridCompScrim");
var gridComp=vg.html.getElement(gridId);
var scrimWrapperDiv=vg.html.getElement(gridId+"_gridCompScrimWrapper");
if(scrimDiv&&gridComp&&scrimWrapperDiv)
{
jsCBDtoggleElement(scrimDiv, false);
scrimWrapperDiv.style.position="static";
vg.html.toggleInputTabIndex(gridComp, false);
if(ie&&CBD_FLOATING_HEAD)
{
gridComp.setAttribute('covered','false');
vg.html._fireCustomEvent(vg.event.ELEMENT_DISABLED, gridComp );
}
}
}
vg.html.closeAllGridCompScrims=function()
{
var gridComps=vg.html.getElements(document.getElementById('main'),{tagName:'div', attrName:'class', attrValue:'grid-ScrimWrapper'}, null, function(element){return element.parentNode;});
var gridCompsLength=gridComps.length;
for(var i=0;i < gridCompsLength;i++)
{
var scrimDiv=vg.html.getElements(gridComps[i],{tagName:'div', attrName:'class', attrValue:'grid-Scrim'})[0];
if(!scrimDiv.style.display!="none")
{
vg.html.closeGridCompScrim(gridComps[i].id);
}
}
}
vg.html.getTabableInputs=function(node)
{
var container=vg.html.getElement(node);
if(container)
{
var inputs=new Array();
_cbdConcat(inputs, container.getElementsByTagName('input'));
_cbdConcat(inputs, container.getElementsByTagName('select'));
_cbdConcat(inputs, container.getElementsByTagName('a'));
_cbdConcat(inputs, container.getElementsByTagName('img'));
_cbdConcat(inputs, container.getElementsByTagName('textarea'));
return inputs;
}
return null;
}
vg.html.toggleInputTabIndex=function(node, disableTabIndex)
{
var containerNode=vg.html.getElement(node);
var cacheTabIndex;
if(containerNode)
{
var inputs=vg.html.getTabableInputs(containerNode);
var inputsLength=inputs.length;
for(var i=0;i< inputsLength;i++)
{
var currentInput=inputs[i];
if(disableTabIndex)
{
cacheTabIndex=currentInput.tabIndex;
if(cacheTabIndex > 0)
{
currentInput.setAttribute("cacheTabIndex", cacheTabIndex);
}
currentInput.tabIndex=-1;
}
else
{
cacheTabIndex=currentInput.getAttribute('cacheTabIndex');
if(cacheTabIndex)
{
currentInput.tabIndex=cacheTabIndex;
}
else if(currentInput.tabIndex=="-1")
{
currentInput.tabIndex=0;
}
}
}
}
}
vg.html._idPrefixes=new Array();
vg.html._getElementWithIdPrefixes=function(id)
{
var idPrefix;
var length=vg.html._idPrefixes.length;
var node=vg.html.getElement(id)
for(var i=0;!node&&i < length;i++)
{
idPrefix=vg.html._idPrefixes[i];
node=vg.html.getElement(idPrefix+id);
}
return node;
}
vg.html._getFullyQualifiedId=function(id)
{
var element=vg.html._getElementWithIdPrefixes(id);
return element?element.id:id;
}
vg.html.getObjSize=function(obj)
{
var objData={w:vg.html.getObjWidth(obj)};
objData.h=(obj&&obj.tagName.toLowerCase()=="span")?vg.html.getSpanObjHeight(obj):vg.html.getObjHeight(obj);
objData.w=vg.html.getObjWidth(obj);
return objData;
}
vg.table.toggleAllTableFlippers=function(tableId, state)
{
var table=vg.html.getElement(tableId);
var flippers=vg.html.getElements(table,{tagName:'tr', attrName:'flipperId'});
var size=flippers.length;
for(var i=0;i < size;i++)
{
var flipper=flippers[i];
var id=flipper.getAttribute("flipperId");
jsCBDtoggleFlipper(id, state, false, id+":state", null);
}
}
vg.procNav.click=function(deckId, index){
try{
var pn=document.getElementById("CBD_PROCESS_NAV"+deckId+"_navDeck");
if(pn){
var pnSteps=vg.html.getElements(pn,
{tagName:'td', attrName:'class', attrValue:/completed/});
if(pnSteps){
var pnStepsIdx=pnSteps[index];
if(pnStepsIdx){
var onclk=pnStepsIdx.getAttribute("onclick");
if(onclk){
if(onclk instanceof Function){
onclk();
}else{
eval(onclk);
}
}
}
}
}
}catch(err){
}
}
vg.textZoom._resize=function(aLink, contentIds, fontClass, textZoomId)
{
var A_SIZE1="default";
var A_SIZE2="A-size2";
var A_SIZE3="A-size3";
var content_Ids=contentIds.split(",");
var textZoomElement=document.getElementById(textZoomId);
var selectedFontClass=null;
if(textZoomElement.selectedSizeClass )
{
selectedFontClass=textZoomElement.selectedSizeClass;
}
var defaultFont=fontClass==A_SIZE1;
for(var i=0;i < content_Ids.length;i++)
{
content_Ids[i]=trim(content_Ids[i]);
if(selectedFontClass)
{
vg.html.removeStyle(textZoomElement.selectedSizeClass, vg.html.getElement(content_Ids[i]));
}
if(!defaultFont)
{
vg.html.addStyle(fontClass, vg.html.getElement(content_Ids[i]));
}
}
textZoomElement.selectedSizeClass=defaultFont?null:fontClass;
jsCBDtoggleLink(aLink, true, "A-selected", textZoomId, true);
}
vg.textZoomNG._resize=function(aLink, fontClass, onLoadSizeClass)
{
var textZoomElement=vg.html.findAncestor(aLink,{}, function(node){return vg.html.hasStyle("A-size", node)});
if(!textZoomElement.currentSizeClass)
{
textZoomElement.currentSizeClass=onLoadSizeClass;
}
var sizeNode=vg.html.getElement("body");
vg.html.removeStyle(textZoomElement.currentSizeClass, sizeNode);
vg.html.addStyle(fontClass, sizeNode);
var currentSizeTrigger=vg.html.getElements(textZoomElement,{tagName:'span'}, function(node){return vg.html.hasStyle(textZoomElement.currentSizeClass, node)})[0];
var selectedClass="A-selected";
jsCBDdeleteStyle(currentSizeTrigger, selectedClass);
vg.html._fireCustomEvent(vg.event.TEXT_ZOOM_CLICK,null,{textZoomId:textZoomElement.id});
jsCBDaddStyle(aLink, selectedClass);
textZoomElement.currentSizeClass=fontClass;
var cookieValue=vg.textZoomNG.COOKIE_VALUES[fontClass]||"1";
jsCBDsetConfigInfo(vg.textZoomNG.ZOOM_COOKIE, cookieValue );
}
vg.textZoomNG._resizeNodeOutsideOfZoomContent=function(nodeOutsideOfZoomContent, nodeInsideOfZoomContent)
{
if(window.isNextGen&&(nodeInsideOfZoomContent.textZoom===true||vg.html.findAncestor(nodeInsideOfZoomContent,{}, function(node){return vg.html.hasStyle(vg.textZoomNG.TEXT_ZOOM_CONTENT_CLASS, node)})))
{
jsCBDaddStyle(nodeOutsideOfZoomContent, vg.textZoomNG.TEXT_ZOOM_CONTENT_CLASS);
nodeInsideOfZoomContent.textZoom=true;
}
}

var SELECTED_TAB_CLASS="current";
var UNSELECTED_TAB_CLASS="unselected";
var SELECTED_TAB_ERR_CLASS="current-err";
var UNSELECTED_TAB_ERR_CLASS="unselected-err";
var DISABLED_TAB_CLASS="disabled";
TabBox=function(id, showError)
{
this.base=vg.Controller;
this.base(id, null);
this.id=id;
this.domChangedTimeout=null;
this.tabType=this.viewNode.getAttribute('tabtype');
this.hasSideTabContent=this.viewNode.getAttribute('hassidetabcontent');
var itemsWrapper=vg.html.getElements(this.viewNode,{tagName:'div', attrName:'id', attrValue:this.viewNode.getAttribute("id")+'_tabBoxItemContainer'})[0];
this.tabBoxItems=vg.html.getElements(itemsWrapper,{tagName:'div', maxDepth:1});
if(showError)
{
vg.validation.pageHasValObservers=true;
}
this.tabsDiv=vg.html.getElements(this.viewNode,{tagName:'div', attrName:'class', attrValue:'tabbox'})[0];
if(this.tabsDiv==null) this.tabsDiv=vg.html.getElements(this.viewNode,{tagName:'div', attrName:'class', attrValue:'int-tabbox'})[0];
this.isSubhead=false;
if(this.tabsDiv==null)
{
this.tabsDiv=vg.html.getElements(this.viewNode,{tagName:'div', attrName:'class', attrValue:'subhead'})[0];
if(this.tabsDiv==null) this.tabsDiv=vg.html.getElements(this.viewNode,{tagName:'div', attrName:'class', attrValue:'int-subhead'})[0];
if(this.tabsDiv!=null)
{
this.isSubhead=true;
this.parentItem=document.getElementById(this.id.substring(0, this.id.lastIndexOf(":")+1)+this.tabsDiv.getAttribute("parentitem"));
this.parentTabBox=document.getElementById(this.id.substring(0, this.id.lastIndexOf(":")));
}
}
this.tabsList=vg.html.getElements(this.tabsDiv,{tagName:'ul'})[0];
this.tabs=vg.html.getElements(this.tabsList,{tagName:'li'});
if(this.hasSideTabContent=='true')
{
this.sideTabContentLeftTD=document.getElementById(this.id+'_tabboxSideContentTD1');
var THIS=this;
var func=function(){THIS._setTabTD_width(THIS.tabsList)};
vg.util.execOnPageReady(func);
}
if(window.observerInputList&&observerInputList[id])
{
for(var i=0;i < observerInputList[id].length;i++)
{
var observerInput=observerInputList[id][i];
this._updateValidationObserverErrors(observerInput.input, observerInput.node,!observerInput.valid);
}
observerInputList[id]=null;
}
if(cbd.browser.isTouchScreen&&window.isNextGen)
{
this._addTouchScrolling();
}
}
TabBox.truthTable=vg.util.buildBooleanTable([
[[true,  true,  true], SELECTED_TAB_ERR_CLASS],
[[true,  true, false], SELECTED_TAB_ERR_CLASS],
[[true, false,  true], UNSELECTED_TAB_ERR_CLASS],
[[true, false, false], UNSELECTED_TAB_ERR_CLASS],
[[false,  true,  true], 'int-'+SELECTED_TAB_CLASS],
[[false,  true, false], SELECTED_TAB_CLASS],
[[false, false,  true], 'int-'+UNSELECTED_TAB_CLASS],
[[false, false, false], UNSELECTED_TAB_CLASS]
]);
TabBox.prototype=
{
_updateValidationObserverErrors:function(input, tabBoxItemNode, isError)
{
if(!tabBoxItemNode.errorInputs)
{
tabBoxItemNode.errorInputs=new Array();
}
var inputId=input.getAttribute("id");
var errorInputIdx=-1;
for(var i=0;i < tabBoxItemNode.errorInputs.length&&(errorInputIdx < 0);i++)
{
if(inputId==tabBoxItemNode.errorInputs[i])
{
errorInputIdx=i;
}
}
var foundInArray=errorInputIdx >=0;
if(isError&&!foundInArray )
{
tabBoxItemNode.errorInputs[tabBoxItemNode.errorInputs.length]=inputId;
}
else if(!isError&&foundInArray )
{
tabBoxItemNode.errorInputs.splice(errorInputIdx, 1);
}
},
_triggerValidationObserver:function(tabBoxItemNode)
{
var tabIndex, parentTabIndex, parentTab;
for(var i=0;i < this.tabBoxItems.length&&!tabIndex;i++)
{
if(this.tabBoxItems[i]==tabBoxItemNode)
{
tabIndex=i;
}
}
if(this.isSubhead)
{
tabIndex*=2;
var parentController=vg.comp.getController(this.parentTabBox);
for(var i=0;i < parentController.tabBoxItems.length&&!parentTabIndex;i++)
{
if(parentController.tabBoxItems[i]==this.parentItem)
{
parentTabIndex=i;
}
}
}
var tab=this.tabs[tabIndex];
if(parentTabIndex!=undefined)
{
parentTab=parentController.tabs[parentTabIndex];
}
var errorInputsLength=tabBoxItemNode.errorInputs?tabBoxItemNode.errorInputs.length:0;
var hasErrors=errorInputsLength > 0;
var isSelected=tab.getAttribute('mode' )=='selected'||tab.getAttribute('mode' )=='current';
var isDisabled=tab.getAttribute('mode' )=='disabled';
if(isDisabled)
{
tab.className=DISABLED_TAB_CLASS;
}
else
{
tab.className=this._setTabStyles(tabBoxItemNode, isSelected);
}
if(parentTab)
{
isSelected=parentTab.getAttribute('mode' )=='selected'||parentTab.getAttribute('mode' )=='current';
isDisabled=parentTab.getAttribute('mode' )=='disabled';
this.parentItem.errorInputs=new Array();
for(var i=0;i < this.tabBoxItems.length;i++)
{
var itemErrorInputs=this.tabBoxItems[i].errorInputs;
if(itemErrorInputs&&itemErrorInputs.length > 0)
{
this.parentItem.errorInputs=this.parentItem.errorInputs.concat(itemErrorInputs)
};
}
if(isDisabled)
{
parentTab.className=DISABLED_TAB_CLASS;
}
else
{
parentTab.className=this._setTabStyles(this.parentItem, isSelected);
}
}
},
_setTabStyles:function(tabBoxItemNode, isSelected)
{
var errorInputsLength=tabBoxItemNode.errorInputs?tabBoxItemNode.errorInputs.length:0;
var hasErrors=errorInputsLength > 0;
var style=null;
return vg.util.getBooleanTableValue(TabBox.truthTable,
[hasErrors, isSelected, tabBoxItemNode.getAttribute('internal' )=='true']);
},
_getSelectedTabIndex:function()
{
var tabsExcludingSpacers=vg.html.getElements(this.tabsList,{tagName:'li',attrName:'class', attrValue:/[^spacer]/});
var tabsExcludingSpacersLength=tabsExcludingSpacers.length;
for(var i=0;i < tabsExcludingSpacersLength;i++)
{
if(tabsExcludingSpacers[i].getAttribute('mode' )=='current' ) return i;
}
return null;
},
_setTabDivBorder:function(selectedIndex)
{
var tab=this.tabBoxItems[selectedIndex];
var isInternal=tab.getAttribute('internal' )=='true';
if(!this.isSubhead)
{
if(isInternal)
{
vg.html.replaceClass(this.tabsDiv, this.tabsDiv.className, "int-tabbox");
}
else
{
vg.html.replaceClass(this.tabsDiv, this.tabsDiv.className, "tabbox");
}
}
},
_setTabTD_width:function()
{
var tabsUL=vg.html.getElement(this.tabsList );
var width=0;
width+=this._getTabWidth(tabsUL, false);
for(i=0;i < this.tabs.length;i++)
{
width+=this._getTabWidth(this.tabs[i],true);
}
width+=20;
this.sideTabContentLeftTD.style.width=width+'px';
this.tabsDiv.style.width=width+'px';
},
_getTabWidth:function(node,getTotalObjWidth)
{
var node2=vg.html.getElement(node );
var contentWidth=vg.html.getObjWidth(node2);
getTotalObjWidth=(getTotalObjWidth==null)?true:getTotalObjWidth;
var widthParms=['margin-left', 'margin-right', 'border-left-width', 'border-right-width', 'padding-left', 'padding-right'];
var boxWidth=0;
for(var prop in widthParms)
{
var val=parseInt(jsCBDGetComputedStylePropertyValue(node2, widthParms[prop]).replace("px","")  );
if(val > 0) boxWidth+=val;
}
return(getTotalObjWidth)?contentWidth+boxWidth:boxWidth;
},
_addTouchScrolling:function()
{
var selectedTabBoxItem=this.tabBoxItems[this._getSelectedTabIndex()];
if(selectedTabBoxItem&&vg.html.isFixedHeight(selectedTabBoxItem))
{
vg.touchScreen._makeNodeScrollable(selectedTabBoxItem.getAttribute('id'));
}
var tabBoxItemsLength=this.tabBoxItems.length;
for(var i=0;i < tabBoxItemsLength;i++)
{
var tabboxItem=this.tabBoxItems[i];
var h_tabItem;
if(tabboxItem)
{
h_tabItem=tabboxItem.style.height;
}
if(tabboxItem&&h_tabItem!="100%"&&h_tabItem!="")
{
vg.html.addEventListenerMethod(tabboxItem, vg.event.DOM_CHANGE, this, '_handleDomChange' );
}
}
},
_handleDomChange:function()
{
if(cbd.browser.isTouchScreen&&window.isNextGen)
{
clearTimeout(this.domChangedTimeout);
var SELF=this;
this.domChangedTimeout=setTimeout(
function()
{
var selectedTabBoxItem=SELF.tabBoxItems[SELF._getSelectedTabIndex()];
vg.touchScreen._makeNodeScrollable(selectedTabBoxItem.getAttribute('id'));
}, 100);
}
}
}
TabBox.setTabBoxItemLabel=function(id, index, label)
{
var tabBoxItem=document.getElementById(id+"_tabBoxItemLink"+index);
if(tabBoxItem&&tabBoxItem.innerHTML)
{
tabBoxItem.innerHTML=label;
}
}

AutoSuggest=function(id, numCharsToTrigger, labelColumn, tableUrl, onSelect, onValueChange, maxRowsBeforeScroll, position, defaultText, fieldIDToHide, onBlurJS, displayAsCombo, triggerChangeOnBlur, selectableCellSpans, onInputEnter)
{
this.base=vg.Controller;
this.base(id, null);
this.highlightedNodes=null;
var dropdownHolder=vg.html.getSibling(this.viewNode,{tagName:'span', attrName:'class', attrValue:AutoSuggest.AUTO_SUGGEST_COMP_CLASS}, "+");
this.dropdown=vg.html.getFirstChild(dropdownHolder);
this.insideFloatingHead=false;
if(vg.html.findAncestor(this.viewNode,{tagName:'tr', attrName:'floathead', attrValue:'true'}))
{
this.insideFloatingHead=true;
}
if(!this.dropdown&&id.indexOf(vg.comp.floatingHeadPrefix)==0)
{
this.dropdown=this._copyFloatingProtoDropdown(id, dropdownHolder);
}
this.tableContainer=vg.html.getFirstChild(vg.html.getFirstChild(this.dropdown));
this.labelInput=this.viewNode;
this.valueInput=vg.html.getSibling(this.labelInput,{tagName:'input'}, "+");
this.numCharsToTrigger=numCharsToTrigger;
this.labelColumn=labelColumn;
this.tableUrl=tableUrl;
this.onSelect=onSelect;
this.onInputEnter=onInputEnter;
this.onValueChange=onValueChange;
this.maxRowsBeforeScroll=maxRowsBeforeScroll > 0?maxRowsBeforeScroll:null;
this.position=position;
this.defaultText=defaultText;
this.fieldIDToHide=fieldIDToHide;
this.triggerChangeOnBlur=triggerChangeOnBlur;
this.selectableCellSpans=selectableCellSpans;
this.currentCellCol=0;
this.cursor;
this.onBlurJS=(onBlurJS==''?null:onBlurJS);
this.displayAsCombo=displayAsCombo;
this.isStatic=displayAsCombo;
this.isSuggestionsOpen=false;
this.isTabPressed=false;
this.isDropDownClicked=false;
this.isRowClicked=false;
this.oldLabelInputValue=this.labelInput.value;
if(this._isHybrid()&&this._hasEnoughChars())
{
this.isStatic=false;
}
this.labelInput.setAttribute("autocomplete", "off");
if(isEmpty(this.labelInput.value)&&this.defaultText)
{
this.labelInput.value=this.defaultText;
vg.html.replaceClass(this.viewNode, ASINPUT_FOCUS_CLASS, ASINPUT_NOFOCUS_CLASS);
}
var asThickBorderTd=vg.html.findAncestor(this.viewNode,{tagName:"td", attrName:"class"}, function(input){return vg.html.hasStyle("layoutTopBorder", input);});
if(asThickBorderTd)
{
this.viewNode.inLayoutTopBorderTd=true;
}
this.loading=false;
this.scroll=false;
var controller=this;
vg.html.addEventListener(this.labelInput, 'click', function(e){controller._inputClick(e);});
vg.html.addEventListener(this.labelInput, 'blur', function(e){controller._onBlurAction(e);});
vg.html.addEventListener(this.labelInput, 'keyup', function(e){controller._keyup(e);});
vg.html.addEventListener(this.labelInput, 'keydown', function(e){controller._keydown(e);});
vg.html.addEventListener(this.dropdown, 'mousedown', function(e){controller._ddMouseDown(e);});
vg.html.addEventListener(this.dropdown, 'mouseup', function(e){controller._ddMouseUp(e);});
var wrapDiv=document.getElementById('wrapDiv');
if(ie&&wrapDiv)
{
vg.html.addEventListener(wrapDiv, 'scroll' , function(){controller.hideSuggestions();});
}
else if(this.insideFloatingHead)
{
vg.html.addEventListener(window, 'scroll' , function(){controller.hideSuggestions();});
}
this._addRowListeners();
vg.util.execOnPageReady(function(){controller._createAutoSugCont()});
}
AutoSuggest.AUTO_SUGGEST_SELECTED=AUTO_SUGGEST_SELECTED='selected';
AutoSuggest.AUTO_SUGGEST_COMP_CLASS=AUTO_SUGGEST_COMP_CLASS='comp-shdwBox';
AutoSuggest.AUTO_SUGGEST_DROPDOWN_CLASS=AUTO_SUGGEST_DROPDOWN_CLASS='shdwBox';
AutoSuggest.AUTO_SUGGEST_DROPDOWN_SUFFIX=AUTO_SUGGEST_DROPDOWN_SUFFIX='ShdwBox';
AutoSuggest.AUTO_SUGGEST_DISABLED=AUTO_SUGGEST_DISABLED='disabled';
AutoSuggest.AUTO_SUGGEST_CONTAINER=AUTO_SUGGEST_CONTAINER='AUTO_SUGGEST_CONTAINER';
AutoSuggest.AS_SELECT_ITEM_EVENT=AS_SELECT_ITEM_EVENT='AutoSuggestSelectItem';
var _cbdSelectedAutoSuggest;
AutoSuggest.prototype=
{
_triggerChangeEventOnBlur:function(){
return((this.labelInput.value!=this.oldLabelInputValue)&&(this.triggerChangeOnBlur));
},
_onBlurAction:function(e)
{
if(!this.isRowClicked&&this.isDropDownClicked)
{
this.labelInput.focus();
this.isDropDownClicked=false;
return;
}
this._resetDefaultText(e);
if(this.isTabPressed||!this.isSuggestionsOpen)
{
this._blur(e);
}
if(this.isRowClicked)
{
this.labelInput.focus();
this.isRowClicked=false;
}
if(this._triggerChangeEventOnBlur()){
this._executeValueChange();
}
this.oldLabelInputValue=this.labelInput.value;
},
_copyFloatingProtoDropdown:function(id, dropdownHolder)
{
var asCont=document.getElementById(AutoSuggest.AUTO_SUGGEST_CONTAINER);
if(asCont)
{
this._removeASDropdown(id+AutoSuggest.AUTO_SUGGEST_DROPDOWN_SUFFIX);
var origId=id.replace(vg.comp.floatingHeadPrefix, '');
var origDropdown=vg.html.getElements(asCont,{tagName:'div', attrName:'associatedParentId', attrValue:origId});
var newDropdown=null;
if(origDropdown[0])
{
newDropdown=origDropdown[0].cloneNode(true);
newDropdown.id=vg.comp.floatingHeadPrefix+id;
dropdownHolder.appendChild(newDropdown);
}
return newDropdown;
}
return null;
},
_createAutoSugCont:function()
{
if(document.getElementById(AutoSuggest.AUTO_SUGGEST_CONTAINER))
{
var asCont=document.getElementById(AutoSuggest.AUTO_SUGGEST_CONTAINER);
}
else
{
var asCont=document.createElement('div');
asCont.setAttribute("id", AutoSuggest.AUTO_SUGGEST_CONTAINER);
var mainElement=document.getElementById('body');
if(!mainElement)
{
mainElement=document.getElementById('cbd-main')
}
var cssContainer=vg.html._cbdGetCSSContainer(this.viewNode);
cssContainer.appendChild(asCont);
}
this.dropdown.setAttribute("associatedParentId", this.viewNode.getAttribute('id'));
var id=this.viewNode.getAttribute('id')+AutoSuggest.AUTO_SUGGEST_DROPDOWN_SUFFIX;
this._removeASDropdown(id);
asCont.appendChild(this.dropdown);
this.dropdown.style.zIndex="999";
},
_removeASDropdown:function(id)
{
var asCont=document.getElementById(AutoSuggest.AUTO_SUGGEST_CONTAINER);
if(asCont&&document.getElementById(id))
{
for(var i=0;i < asCont.childNodes.length;i++)
{
if(id==asCont.childNodes[i].getAttribute('id') )
{
asCont.removeChild(asCont.childNodes[i]);
}
}
}
},
_inputClick:function(e)
{
this.isTabPressed=false;
if(this.defaultText)
{
_cbdClearInputDefaultText(this.labelInput, this.defaultText, e);
}
this._showOrHideSuggestions(null, true);
},
_ddMouseDown:function(e)
{
this.isDropDownClicked=true;
},
_ddMouseUp:function(e)
{
this.isDropDownClicked=false;
},
_resetDefaultText:function(e)
{
if(this.defaultText)
{
_cbdSetInputDefaultText(this.labelInput, this.defaultText);
}
},
_blur:function(e)
{
this.hideSuggestions();
if(this.onBlurJS!=null)
{
vg.comp._execEventHandler(this.onBlurJS, this.viewNode);
}
},
_rowClick:function(e)
{
this.isRowClicked=true;
this.highlightedNodes=this._getSelectedEl(e);
this._selectRow(e);
},
_selectRow:function(e)
{
var rowInfo=this._getRowInfo(this.highlightedNodes);
if(rowInfo.value!="cbdDisabled"&&this.onSelect(rowInfo.value, rowInfo.label, this.viewNode.getAttribute("id")) )
{
this._setInputValues(rowInfo);
this.oldLabelInputValue=this.labelInput.value;
if(this._isHybrid())
{
this.isStatic=false;
}
this.hideSuggestions();
this.labelInput.focus();
}
},
_setInputValues:function(rowInfo, skipChange)
{
this.labelInput.value=vg.util.removeTags(rowInfo.label);
this.valueInput.value=vg.util.removeTags(rowInfo.value);
if(this.onValueChange!=null&&!skipChange)
{
this._executeValueChange();
}
},
_executeValueChange:function()
{
this.onValueChange(this.viewNode.getAttribute('id'), this.valueInput.value, this.labelInput.value, this.tableLoadQuery);
},
_getRowInfo:function(rowCells)
{
var row=vg.html.findAncestor(rowCells[0],{tagName:'tr'});
var rowInfo={label:""};
rowInfo.label=row.getAttribute("label");
var labelCell=rowCells[this.labelColumn];
if(labelCell&&!rowInfo.label)
{
var labelAttr=labelCell.getAttribute("label");
if(labelAttr)
{
rowInfo.label=labelAttr;
}
else if(labelCell.innerText)
{
rowInfo.label=labelCell.innerText;
}
else if(labelCell.textContent)
{
rowInfo.label=labelCell.textContent;
}
}
rowInfo.value=row.getAttribute("value");
var valAttr=labelCell?labelCell.getAttribute("value"):null;
if(valAttr&&!rowInfo.value)
{
rowInfo.value=valAttr;
}
return rowInfo;
},
_rowMouseOver:function(e)
{
this._addSelectedStyle(e);
},
_rowMouseOut:function(e)
{
this._removeSelectedStyle(e);
},
_keydown:function(e)
{
var key=jsCBDgetKey(jsCBDgetEvent(e));
if(key==9)
{
this.isTabPressed=true;
}
},
_keyup:function(e)
{
var key=jsCBDgetKey(jsCBDgetEvent(e));
if(key==40||key==38||key==13||key==9||(this.selectableCellSpans&&(key==37||key==39)) )
{
if(jsCBDisVisibleElement(this.dropdown) )
{
if(key==9)
{
vg.html.stopEventPropagation(e);
}
else if(key==13)
{
if(this.highlightedNodes)
{
this._selectRow(e);
}
else
{
this.onInputEnter(this.labelInput.value);
}
}
else if(key==40||key==38||key==37||key==39 )
{
vg.html.stopEventPropagation(e);
var oldRow;
if(this.highlightedNodes&&this.highlightedNodes[0])
{
oldRow=this.highlightedNodes[0].parentNode;
this._removeSelectedStyle(this._getRowsCells(oldRow));
}
var newRow;
if(!oldRow)
{
newRow=this._getSuggestTableRows()[0];
}
else if(key==40 )
{
var nextRow=vg.html.getSibling(oldRow,{tagName:"tr"}, "+");
newRow=nextRow?nextRow:oldRow;
}
else if(key==38 )
{
var prevRow=vg.html.getSibling(oldRow,{tagName:"tr"}, "-");
newRow=prevRow?prevRow:oldRow;
}
else
{
newRow=oldRow;
var spanIndex=this._getCellSpanIndex(this.currentCellCol);
spanIndex+=(key==39)?1:-1;
if(this.selectableCellSpans[spanIndex])
{
this.currentCellCol=this._getFirstCellOfSpan(spanIndex);
}
}
if(newRow )
{
var selectedCells=this._getRowsCells(newRow);;
if(this.selectableCellSpans )
{
var selectedCell=selectedCells[this.currentCellCol]?selectedCells[this.currentCellCol]:selectedCells[0];
selectedCells=this._getSelectedEl(selectedCell);
}
var rowInfo=this._getRowInfo(selectedCells);
this._setInputValues(rowInfo, true);
this._addSelectedStyle(selectedCells);
var optHeight=vg.html.getObjHeight(newRow);
var optionY=(optHeight*newRow.getAttribute('index'))+vg.html.getObjY(this.tableContainer);
vg.html.scrollIntoView(this.tableContainer, newRow, optHeight, optionY);
}
}
}
else if(key==13)
{
this.onInputEnter(this.labelInput.value);
}
}
else
{
var controller=this;
clearTimeout(this.typingTimeout);
this.typingTimeout=setTimeout(function()
{
controller.valueInput.value="";
controller._showOrHideSuggestions(true);
}, 250);
}
},
_isHybrid:function()
{
return this.displayAsCombo&&!isEmpty(this.tableUrl);
},
_showOrHideSuggestions:function(searchForValue, inputClicked, comboClicked)
{
if(this._isHybrid())
{
if(!(inputClicked||comboClicked))
{
if(this._hasEnoughChars()&&this.isStatic)
{
this.isStatic=false;
}
else if(!this._hasEnoughChars()&&!this.isStatic)
{
this.isStatic=true;
this._getTable(null,"");
return;
}
}
}
if(comboClicked||(this.isStatic&&!this._isHybrid())||this._hasEnoughChars())
{
this.loadTable(null, searchForValue);
}
else
{
this.hideSuggestions();
}
},
loadTable:function(addlParams, searchForValue)
{
var controller=this;
if(this.isStatic)
{
if(controller._getSuggestTableRows().length > 0 )
{
controller._dropdownCreator()
}
else
{
controller.hideSuggestions();
}
return;
}
else if(!this._hasEnoughChars())
{
controller.hideSuggestions();
return;
}
controller._getTable(addlParams, searchForValue);
},
_getTable:function(addlParams, searchForValue){
var controller=this;
if(controller.loading)
{
controller.pendingReq=true;
controller.addlParams=addlParams;
controller.searchForValue=searchForValue;
}
else
{
this.loading=true;
var showDDFunc=function()
{
controller.loading=false;
if(controller._getSuggestTableRows().length > 0 )
{
controller._addRowListeners();
controller._dropdownCreator();
if(controller._isHybrid()&&!controller._hasEnoughChars())
{
controller.hideSuggestions();
}
}
else
{
controller.hideSuggestions();
}
if(controller.pendingReq)
{
controller.loadTable(controller.addlParams, controller.searchForValue);
controller.pendingReq=false;
}
controller.labelInput.focus();
};
if(!isEmpty(this.tableUrl))
{
this.suggestionLoader=jsCBDloadContent(
this._getUrlWithParameters(addlParams),
this.tableContainer, 'replaceChildren',	showDDFunc	);
}
}
},
_dropdownCreator:function()
{
this.showSuggestions();
this._setDropdownWidth();
this._setDropdownHeight();
this._setDropdownPosition();
},
_getUrlWithParameters:function(addlParams)
{
var value=this._getSearchedValue();
this.tableLoadQuery=value;
value=encodeURIComponent(value);
var url=jsCBDaddQueryStringParam(this.tableUrl, "cbdASId", this.viewNode.getAttribute("id"));
url=jsCBDaddQueryStringParam(url, "cbdASValue", value);
if(!isEmpty(addlParams))
{
url+="&"+addlParams;
}
return url;
},
_getSearchedValue:function()
{
var value=this.labelInput.value.replace(/[\%]/g, " ");
if(this.labelInput.value==this.labelInput.defaultText)
{
value="";
}
return value;
},
showSuggestions:function()
{
this.isSuggestionsOpen=true;
jsCBDtoggleElement(this.dropdown, true);
_cbdSelectedAutoSuggest=this;
this._preventBleedThru(this.fieldIDToHide, true);
},
hideSuggestions:function()
{
this._cancelSuggestions();
jsCBDtoggleElement(this.dropdown, false);
_cbdSelectedAutoSuggest=null;
if(this.highlightedNodes)
{
this._removeSelectedStyle(this.highlightedNodes);
this.currentCellCol=0;
}
this._preventBleedThru(this.fieldIDToHide, false);
this.isSuggestionsOpen=false;
},
_cancelSuggestions:function()
{
clearTimeout(this.typingTimeout);
if(this.suggestionLoader)
{
this.suggestionLoader.abort();
this.loading=false;
}
},
_preventBleedThru:function(elemIDs, isHideElem)
{
if(ie6_proper||ie5)
{
if(elemIDs==null||elemIDs=="") return;
var list=elemIDs.split(",");
for(var x=0;x < list.length;x++)
{
var id=list[x];
if(isHideElem)
{
jsCBDsetVisibility(id,false);
}
else
{
jsCBDsetVisibility(id,true);
}
}
}
},
_hasEnoughChars:function()
{
return((this.labelInput.value!=this.defaultText)&&
(this.labelInput.value.length >=this.numCharsToTrigger));
},
_addSelectedStyle:function(e)
{
this._addOrRemoveSelectedStyle(e, true);
},
_removeSelectedStyle:function(e)
{
this._addOrRemoveSelectedStyle(e, false);
},
_addOrRemoveSelectedStyle:function(e, addOrRemove)
{
var length;
var selectedEls=e.length?e:this._getSelectedEl(e);
if(addOrRemove)
{
if(this.highlightedNodes)
{
length=this.highlightedNodes.length
for(var i=0;i < length;i++)
{
var selectedEl=this.highlightedNodes[i];
vg.html.removeStyle(AutoSuggest.AUTO_SUGGEST_SELECTED, selectedEl);
}
}
this.highlightedNodes=selectedEls;
}
else if(this.highlightedNodes===selectedEls)
{
this.highlightedNodes=null;
}
length=selectedEls.length;
for(var i=0;i < length;i++)
{
var selectedEl=selectedEls[i];
vg.html.addOrRemoveStyle(AutoSuggest.AUTO_SUGGEST_SELECTED, selectedEl, addOrRemove);
}
},
_getSelectedEl:function(e)
{
var eNode=e.tagName?e:jsCBDgetEventNode(e);
if(this.selectableCellSpans )
{
return this._getSelectedCells(eNode);
}
var selectedRow=vg.html.findAncestor(eNode,{tagName:'tr'});
return this._getRowsCells(selectedRow);
},
_getRowsCells:function(row)
{
return vg.html.getElements(row,{tagName:'td'});
},
_getSelectedCells:function(node)
{
var selectedCells=[];
var selectedCell=(node.tagName.toLowerCase()=='td')?node:vg.html.findAncestor(node,{tagName:'td'});
var cellSiblings=vg.html.getElements(selectedCell.parentNode,{tagName:'td'});
var cellIndex=0;
var selectedIndex=selectedCell.cellIndex;
for(var i=0;i < this.selectableCellSpans.length;i++)
{
var spanOfCells=this.selectableCellSpans[i];
if(selectedIndex < spanOfCells+cellIndex )
{
this.currentCellCol=cellIndex;
for(var j=cellIndex;j < cellIndex+spanOfCells;j++)
{
if(cellSiblings[j])
{
selectedCells.push(cellSiblings[j]);
}
}
return selectedCells;
}
cellIndex+=spanOfCells;
}
return selectedCells;
},
_getCellSpanIndex:function(column)
{
var cellIndex=0;
for(var i=0;i < this.selectableCellSpans.length;i++)
{
var spanOfCells=this.selectableCellSpans[i];
if(column < spanOfCells+cellIndex )
{
return i;
}
cellIndex+=spanOfCells;
}
return 0;
},
_getFirstCellOfSpan:function(spanIndex)
{
if(this.selectableCellSpans[spanIndex])
{
var column=0;
for(var i=0;i < spanIndex;i++)
{
column+=this.selectableCellSpans[i];
}
return column;
}
return 0;
},
_setDropdownWidth:function()
{
var table=this._getSuggestTable();
if(table)
{
vg.html.setWidth(this.dropdown, "auto");
var offset=this.scroll||safari?19:2;
var tableWidth=vg.html.getObjWidth(table);
if(tableWidth&&tableWidth > 0)
{
if(typeof isNextGen==='undefined'||!isNextGen)
{
tableWidth+=26;
}
else
{
tableWidth+=12;
}
vg.html.setWidth(this.dropdown,(tableWidth+offset)+'px');
}
}
},
_setDropdownHeight:function()
{
var table=this._getSuggestTable();
if(table)
{
var tableHeight=vg.html.getObjHeight(table);
var rows=vg.html.getElements(table,{tagName:'tr'});
var numRowsDisplayed=rows.length;
if(this.maxRowsBeforeScroll&&rows.length > this.maxRowsBeforeScroll)
{
numRowsDisplayed=this.maxRowsBeforeScroll;
}
var displayHeight=0;
for(var i=0;i < numRowsDisplayed;i++)
{
displayHeight+=vg.html.getObjHeight(rows[i]);
}
if(tableHeight > displayHeight)
{
this.tableContainer.style.overflowY="auto";
this.scroll=true;
}
else
{
if(tableHeight < displayHeight)
{
displayHeight=tableHeight;
}
this.scroll=false;
}
vg.html.setHeight(this.tableContainer, displayHeight+"px");
if(ieQuirksMode)
{
vg.html.setHeight(this.dropdown,(displayHeight - 8)+"px");
}
}
},
_setDropdownPosition:function()
{
this.position=(this.position!="left")?"right":"left";
var data=vg.html.position({elementNode:this.dropdown, targetNode:this.viewNode, dispLoc:"auto", horzPos:this.position});
if(data.elem.dispLoc.indexOf("top") > -1)
{
var marginTop=parseInt(jsCBDGetComputedStylePropertyValue(this.dropdown, "margin-top"));
vg.html.setObjTop(this.dropdown, this.dropdown.style.top.replace("px","") - marginTop);
}
},
_addRowListeners:function(e)
{
var controller=this;
var rows=this._getSuggestTableRows();
for(var i=0;i < rows.length;i++)
{
var cells=this._getRowsCells(rows[i]);
if(this._getRowInfo(cells).value!="cbdDisabled")
{
vg.html.addEventListener(rows[i], 'mouseover', function(e){controller._rowMouseOver(e);});
vg.html.addEventListener(rows[i], 'mouseout', function(e){controller._rowMouseOut(e);});
vg.html.addEventListener(rows[i], 'mousedown', function(e){controller._rowClick(e);});
}
}
},
_getSuggestTable:function()
{
var compSpan=vg.html.getElements(this.dropdown,{tagName:'span', attrName:'type', attrValue:'DataTable'})[0];
return vg.html.getElements(compSpan,{tagName:'table'})[0];
},
_getSuggestTableRows:function()
{
return vg.html.getElements(this._getSuggestTable(),{tagName:'tr'});
}
}
AutoSuggest._allowKeyPress=function(element, event)
{
var as=vg.comp.getController(element);
if(as.highlightedNodes)
{
return jsCBDblockEnterKey(event)
}
}
AutoSuggest._showHideSuggestions=function(autoSuggestId, event)
{
var element=document.getElementById(autoSuggestId);
var as=vg.comp.getController(element);
as.labelInput.focus();
as._showOrHideSuggestions(null, null, true);
}
jsCBDloadAutoSuggestTable=function(autoSuggestId, params)
{
var autoSuggest=vg.comp.getController(autoSuggestId);
if(autoSuggest)
{
autoSuggest.loadTable(params);
}
}
jsCBDcloseAutoSuggest=function(e)
{
if(_cbdSelectedAutoSuggest!=null)
{
if(e.type=='scroll')
{
_cbdSelectedAutoSuggest._blur();
}
else
{
var eNode=jsCBDgetEventNode(e);
if(eNode!=null)
{
var clickedOnDropdown=eNode.className&&(eNode.className==AutoSuggest.AUTO_SUGGEST_DROPDOWN_CLASS);
var clickedInsideInput=eNode.getAttribute('id')&&(eNode.getAttribute('id')==_cbdSelectedAutoSuggest.viewNode.getAttribute('id'));
var clickedInsideDropdown=vg.html.findAncestor(eNode,{tagName:'div', attrName:'class', attrValue:AutoSuggest.AUTO_SUGGEST_DROPDOWN_CLASS})!=null;
var isScrollEevent=_cbdIsScrollEvent(eNode.scrollTop, eNode.scrollLeft);
if(!clickedInsideInput&&!clickedInsideDropdown&&!clickedOnDropdown&&eNode.tagName!="HTML"&&!isScrollEevent)
{
_cbdSelectedAutoSuggest._blur();
}
}
}
}
}
_cbdGHAutoSuggestValueChange=function(id, value, label, tableLoadQuery)
{
if(value.substring(0,7)=="https:/")
{
jsCBDgoToUrl(value.substring(7));
}
else if(value.indexOf("javascript:")===0)
{
eval(value);
}
else
{
document.getElementById("searchForm").submit();
}
}
jsCBDhideASDropDown=function(target )
{
var controller;
if(target ){
controller=vg.comp.getController(target);
}
else if(_cbdSelectedAutoSuggest ){
controller=_cbdSelectedAutoSuggest;
}
else
{
target=vg.html.getElements(document.getElementById('body'),{tagName:'input'}, function(node){return vg.html.hasStyle(ASINPUT_FOCUS_CLASS, node)})[0];
controller=vg.comp.getController(target);
}
if(controller ){
controller.hideSuggestions();
}
}
jsCBDresetAutoSuggest=function(id)
{
var autoSuggest=vg.comp.findController(id, false);
if(autoSuggest)
{
autoSuggest.labelInput.value="";
autoSuggest.valueInput.value="";
autoSuggest._resetDefaultText();
}
}
jsCBDgetAutoSuggestSelection=function()
{
var activeElement=document.activeElement;
if(!activeElement)
{
return null;
}
var parentNode=activeElement.parentNode;
if(!parentNode)
{
return null;
}
var cursorInfo=null;
if(parentNode.getAttribute("type")==="AutoSuggestInput")
{
cursorInfo=vg.html.getSelection(activeElement);
cursorInfo.activeElement=activeElement;
}
return cursorInfo;
}
jsCBDsetAutoSuggestSelection=function(cursorInfo)
{
if(cursorInfo instanceof Object&&(typeof cursorInfo.start=='number')&&(typeof cursorInfo.end=='number')&&cursorInfo.activeElement)
{
vg.html.setSelection(cursorInfo.activeElement, cursorInfo.start, cursorInfo.end);
}
}
jsCBDsetAutoSuggestTableUrl=function(id, table )
{
var autoSuggest=vg.comp.findController(id, false);
if(autoSuggest)
{
autoSuggest.tableUrl=table;
}
}
