var Prototype={Version:"1.7_rc3",Browser:function(){var a=navigator.userAgent,b=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:a.indexOf("AppleWebKit/")>-1,Gecko:a.indexOf("Gecko")>-1&&a.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!!(a&&a.prototype)}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!==
"undefined")return true;var a=document.createElement("div"),b=document.createElement("form"),c=false;if(a.__proto__&&a.__proto__!==b.__proto__)c=true;return c}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;
var Abstract={},Try={these:function(){for(var a,b=0,c=arguments.length;b<c;b++){var e=arguments[b];try{a=e();break}catch(f){}}return a}},Class=function(){function a(){}function b(){function f(){this.initialize.apply(this,arguments)}var h=null,l=$A(arguments);if(Object.isFunction(l[0]))h=l.shift();Object.extend(f,Class.Methods);f.superclass=h;f.subclasses=[];if(h){a.prototype=h.prototype;f.prototype=new a;h.subclasses.push(f)}h=0;for(var p=l.length;h<p;h++)f.addMethods(l[h]);if(!f.prototype.initialize)f.prototype.initialize=
Prototype.emptyFunction;return f.prototype.constructor=f}function c(f){var h=this.superclass&&this.superclass.prototype,l=Object.keys(f);if(e){f.toString!=Object.prototype.toString&&l.push("toString");f.valueOf!=Object.prototype.valueOf&&l.push("valueOf")}for(var p=0,m=l.length;p<m;p++){var t=l[p],w=f[t];if(h&&Object.isFunction(w)&&w.argumentNames()[0]=="$super"){var B=w;w=function(z){return function(){return h[z].apply(this,arguments)}}(t).wrap(B);w.valueOf=B.valueOf.bind(B);w.toString=B.toString.bind(B)}this.prototype[t]=
w}return this}var e=function(){for(var f in{toString:1})if(f==="toString")return false;return true}();return{create:b,Methods:{addMethods:c}}}();
(function(){function a(G){switch(G){case null:return n;case void 0:return q}switch(typeof G){case "boolean":return u;case "number":return r;case "string":return v}return C}function b(G,L){for(var E in L)G[E]=L[E];return G}function c(G){try{if(g(G))return"undefined";if(G===null)return"null";return G.inspect?G.inspect():String(G)}catch(L){if(L instanceof RangeError)return"...";throw L;}}function e(G){return f("",{"":G},[])}function f(G,L,E){L=L[G];var J=typeof L;if(a(L)===C&&typeof L.toJSON==="function")L=
L.toJSON(G);G=j.call(L);switch(G){case y:case o:case D:L=L.valueOf()}switch(L){case null:return"null";case true:return"true";case false:return"false"}J=typeof L;switch(J){case "string":return L.inspect(true);case "number":return isFinite(L)?String(L):"null";case "object":J=0;for(var R=E.length;J<R;J++)if(E[J]===L)throw new TypeError;E.push(L);var S=[];if(G===Q){J=0;for(R=L.length;J<R;J++){var W=f(J,L,E);S.push(typeof W==="undefined"?"null":W)}S="["+S.join(",")+"]"}else{var da=Object.keys(L);J=0;for(R=
da.length;J<R;J++){G=da[J];W=f(G,L,E);typeof W!=="undefined"&&S.push(G.inspect(true)+":"+W)}S="{"+S.join(",")+"}"}E.pop();return S}}function h(G){return JSON.stringify(G)}function l(G){return $H(G).toQueryString()}function p(G){return G&&G.toHTML?G.toHTML():String.interpret(G)}function m(G){if(a(G)!==C)throw new TypeError;var L=[];for(var E in G)G.hasOwnProperty(E)&&L.push(E);return L}function t(G){var L=[];for(var E in G)L.push(G[E]);return L}function w(G){return b({},G)}function B(G){return!!(G&&
G.nodeType==1)}function z(G){return j.call(G)===Q}function K(G){return G instanceof Hash}function P(G){return typeof G==="function"}function F(G){return j.call(G)===D}function I(G){return j.call(G)===y}function g(G){return typeof G==="undefined"}var j=Object.prototype.toString,n="Null",q="Undefined",u="Boolean",r="Number",v="String",C="Object",o="[object Boolean]",y="[object Number]",D="[object String]",Q="[object Array]",T=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&
typeof JSON.stringify(Prototype.K)==="undefined";if(typeof Array.isArray=="function"&&Array.isArray([])&&!Array.isArray({}))z=Array.isArray;b(Object,{extend:b,inspect:c,toJSON:T?h:e,toQueryString:l,toHTML:p,keys:Object.keys||m,values:t,clone:w,isElement:B,isArray:z,isHash:K,isFunction:P,isString:F,isNumber:I,isUndefined:g})})();
Object.extend(Function.prototype,function(){function a(B,z){for(var K=B.length,P=z.length;P--;)B[K+P]=z[P];return B}function b(B,z){B=w.call(B,0);return a(B,z)}function c(){var B=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return B.length==1&&!B[0]?[]:B}function e(B){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var z=this,K=w.call(arguments,1);return function(){var P=b(K,arguments);
return z.apply(B,P)}}function f(B){var z=this,K=w.call(arguments,1);return function(P){P=a([P||window.event],K);return z.apply(B,P)}}function h(){if(!arguments.length)return this;var B=this,z=w.call(arguments,0);return function(){var K=b(z,arguments);return B.apply(this,K)}}function l(B){var z=this,K=w.call(arguments,1);B*=1E3;return window.setTimeout(function(){return z.apply(z,K)},B)}function p(){return this.delay.apply(this,a([0.01],arguments))}function m(B){var z=this;return function(){var K=
a([z.bind(this)],arguments);return B.apply(this,K)}}function t(){if(this._methodized)return this._methodized;var B=this;return this._methodized=function(){var z=a([this],arguments);return B.apply(null,z)}}var w=Array.prototype.slice;return{argumentNames:c,bind:e,bindAsEventListener:f,curry:h,delay:l,defer:p,wrap:m,methodize:t}}());
(function(a){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function c(){return this.toISOString()}if(!a.toISOString)a.toISOString=b;if(!a.toJSON)a.toJSON=c})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1E3)},execute:function(){this.callback(this)},stop:function(){if(this.timer){clearInterval(this.timer);this.timer=null}},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(a){this.currentlyExecuting=
false;throw a;}}});Object.extend(String,{interpret:function(a){return a==null?"":String(a)},specialChar:{"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(E){if(Object.isFunction(E))return E;var J=new Template(E);return function(R){return J.evaluate(R)}}function b(E,J){var R="",S=this,W;J=a(J);if(Object.isString(E))E=RegExp.escape(E);if(!(E.length||E.source)){J=J("");return J+S.split("").join(J)+J}for(;S.length>0;)if(W=S.match(E)){R+=S.slice(0,W.index);R+=String.interpret(J(W));S=S.slice(W.index+W[0].length)}else{R+=S;S=""}return R}function c(E,J,R){J=a(J);R=Object.isUndefined(R)?1:R;return this.gsub(E,
function(S){if(--R<0)return S[0];return J(S)})}function e(E,J){this.gsub(E,J);return String(this)}function f(E,J){E=E||30;J=Object.isUndefined(J)?"...":J;return this.length>E?this.slice(0,E-J.length)+J:String(this)}function h(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function l(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function p(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function m(){var E=new RegExp(Prototype.ScriptFragment,"img"),
J=new RegExp(Prototype.ScriptFragment,"im");return(this.match(E)||[]).map(function(R){return(R.match(J)||["",""])[1]})}function t(){return this.extractScripts().map(function(E){return eval(E)})}function w(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function B(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function z(E){var J=this.strip().match(/([^?#]*)(#.*)?$/);if(!J)return{};return J[1].split(E||"&").inject({},function(R,
S){if((S=S.split("="))[0]){var W=decodeURIComponent(S.shift());S=S.length>1?S.join("="):S[0];if(S!=undefined)S=decodeURIComponent(S);if(W in R){Object.isArray(R[W])||(R[W]=[R[W]]);R[W].push(S)}else R[W]=S}return R})}function K(){return this.split("")}function P(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function F(E){return E<1?"":(new Array(E+1)).join(this)}function I(){return this.replace(/-+(.)?/g,function(E,J){return J?J.toUpperCase():""})}function g(){return this.charAt(0).toUpperCase()+
this.substring(1).toLowerCase()}function j(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function n(){return this.replace(/_/g,"-")}function q(E){var J=this.replace(/[\x00-\x1f\\]/g,function(R){if(R in String.specialChar)return String.specialChar[R];return"\\u00"+R.charCodeAt().toPaddedString(2,16)});if(E)return'"'+J.replace(/"/g,'\\"')+'"';return"'"+J.replace(/'/g,"\\'")+"'"}function u(E){return this.replace(E||
Prototype.JSONFilter,"$1")}function r(){var E=this;if(E.blank())return false;E=E.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");E=E.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");E=E.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(E)}function v(E){var J=this.unfilterJSON(),R=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(R.test(J))J=J.replace(R,function(W){return"\\u"+("0000"+W.charCodeAt(0).toString(16)).slice(-4)});
try{if(!E||J.isJSON())return eval("("+J+")")}catch(S){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function C(){var E=this.unfilterJSON();return JSON.parse(E)}function o(E){return this.indexOf(E)>-1}function y(E){return this.lastIndexOf(E,0)===0}function D(E){var J=this.length-E.length;return J>=0&&this.indexOf(E,J)===J}function Q(){return this==""}function T(){return/^\s*$/.test(this)}function G(E,J){return(new Template(this,J)).evaluate(E)}var L=window.JSON&&typeof JSON.parse===
"function"&&JSON.parse('{"test": true}').test;return{gsub:b,sub:c,scan:e,truncate:f,strip:String.prototype.trim||h,stripTags:l,stripScripts:p,extractScripts:m,evalScripts:t,escapeHTML:w,unescapeHTML:B,toQueryParams:z,parseQuery:z,toArray:K,succ:P,times:F,camelize:I,capitalize:g,underscore:j,dasherize:n,inspect:q,unfilterJSON:u,isJSON:r,evalJSON:L?C:v,include:o,startsWith:y,endsWith:D,empty:Q,blank:T,interpolate:G}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){if(a&&Object.isFunction(a.toTemplateReplacements))a=a.toTemplateReplacements();return this.template.gsub(this.pattern,function(b){if(a==null)return b[1]+"";var c=b[1]||"";if(c=="\\")return b[2];var e=a,f=b[3],h=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;b=h.exec(f);if(b==null)return c;for(;b!=null;){var l=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1];e=e[l];if(null==
e||""==b[3])break;f=f.substring("["==b[3]?b[1].length:b[0].length);b=h.exec(f)}return c+String.interpret(e)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(r,v){var C=0;try{this._each(function(y){r.call(v,y,C++)})}catch(o){if(o!=$break)throw o;}return this}function b(r,v,C){var o=-r,y=[],D=this.toArray();if(r<1)return D;for(;(o+=r)<D.length;)y.push(D.slice(o,o+r));return y.collect(v,C)}function c(r,v){r=r||Prototype.K;var C=true;this.each(function(o,y){C=C&&!!r.call(v,o,y);if(!C)throw $break;});return C}function e(r,v){r=r||Prototype.K;var C=false;this.each(function(o,y){if(C=!!r.call(v,o,y))throw $break;
});return C}function f(r,v){r=r||Prototype.K;var C=[];this.each(function(o,y){C.push(r.call(v,o,y))});return C}function h(r,v){var C;this.each(function(o,y){if(r.call(v,o,y)){C=o;throw $break;}});return C}function l(r,v){var C=[];this.each(function(o,y){r.call(v,o,y)&&C.push(o)});return C}function p(r,v,C){v=v||Prototype.K;var o=[];if(Object.isString(r))r=new RegExp(RegExp.escape(r));this.each(function(y,D){r.match(y)&&o.push(v.call(C,y,D))});return o}function m(r){if(Object.isFunction(this.indexOf))if(this.indexOf(r)!=
-1)return true;var v=false;this.each(function(C){if(C==r){v=true;throw $break;}});return v}function t(r,v){v=Object.isUndefined(v)?null:v;return this.eachSlice(r,function(C){for(;C.length<r;)C.push(v);return C})}function w(r,v,C){this.each(function(o,y){r=v.call(C,r,o,y)});return r}function B(r){var v=$A(arguments).slice(1);return this.map(function(C){return C[r].apply(C,v)})}function z(r,v){r=r||Prototype.K;var C;this.each(function(o,y){o=r.call(v,o,y);if(C==null||o>=C)C=o});return C}function K(r,
v){r=r||Prototype.K;var C;this.each(function(o,y){o=r.call(v,o,y);if(C==null||o<C)C=o});return C}function P(r,v){r=r||Prototype.K;var C=[],o=[];this.each(function(y,D){(r.call(v,y,D)?C:o).push(y)});return[C,o]}function F(r){var v=[];this.each(function(C){v.push(C[r])});return v}function I(r,v){var C=[];this.each(function(o,y){r.call(v,o,y)||C.push(o)});return C}function g(r,v){return this.map(function(C,o){return{value:C,criteria:r.call(v,C,o)}}).sort(function(C,o){C=C.criteria;o=o.criteria;return C<
o?-1:C>o?1:0}).pluck("value")}function j(){return this.map()}function n(){var r=Prototype.K,v=$A(arguments);if(Object.isFunction(v.last()))r=v.pop();var C=[this].concat(v).map($A);return this.map(function(o,y){return r(C.pluck(y))})}function q(){return this.toArray().length}function u(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:a,eachSlice:b,all:c,every:c,any:e,some:e,collect:f,map:f,detect:h,findAll:l,select:l,filter:l,grep:p,include:m,member:m,inGroupsOf:t,inject:w,invoke:B,
max:z,min:K,partition:P,pluck:F,reject:I,sortBy:g,toArray:j,entries:j,zip:n,size:q,inspect:u,find:h}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,c=new Array(b);b--;)c[b]=a[b];return c}function $w(a){if(!Object.isString(a))return[];return(a=a.strip())?a.split(/\s+/):[]}Array.from=$A;
(function(){function a(n){for(var q=0,u=this.length;q<u;q++)n(this[q])}function b(){this.length=0;return this}function c(){return this[0]}function e(){return this[this.length-1]}function f(){return this.select(function(n){return n!=null})}function h(){return this.inject([],function(n,q){if(Object.isArray(q))return n.concat(q.flatten());n.push(q);return n})}function l(){var n=g.call(arguments,0);return this.select(function(q){return!n.include(q)})}function p(n){return(n===false?this.toArray():this)._reverse()}
function m(n){return this.inject([],function(q,u,r){if(0==r||(n?q.last()!=u:!q.include(u)))q.push(u);return q})}function t(n){return this.uniq().findAll(function(q){return n.detect(function(u){return q===u})})}function w(){return g.call(this,0)}function B(){return this.length}function z(){return"["+this.map(Object.inspect).join(", ")+"]"}function K(n,q){q||(q=0);var u=this.length;if(q<0)q=u+q;for(;q<u;q++)if(this[q]===n)return q;return-1}function P(n,q){q=isNaN(q)?this.length:(q<0?this.length+q:q)+
1;n=this.slice(0,q).reverse().indexOf(n);return n<0?n:q-n-1}function F(){for(var n=g.call(this,0),q,u=0,r=arguments.length;u<r;u++){q=arguments[u];if(Object.isArray(q)&&!("callee"in q))for(var v=0,C=q.length;v<C;v++)n.push(q[v]);else n.push(q)}return n}var I=Array.prototype,g=I.slice,j=I.forEach;j||(j=a);Object.extend(I,Enumerable);if(!I._reverse)I._reverse=I.reverse;Object.extend(I,{_each:j,clear:b,first:c,last:e,compact:f,flatten:h,without:l,reverse:p,uniq:m,intersect:t,clone:w,toArray:w,size:B,
inspect:z});if(function(){return[].concat(arguments)[0][0]!==1}(1,2))I.concat=F;if(!I.indexOf)I.indexOf=K;if(!I.lastIndexOf)I.lastIndexOf=P})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(F){this._object=Object.isHash(F)?F.toObject():Object.clone(F)}function b(F){for(var I in this._object){var g=this._object[I],j=[I,g];j.key=I;j.value=g;F(j)}}function c(F,I){return this._object[F]=I}function e(F){if(this._object[F]!==Object.prototype[F])return this._object[F]}function f(F){var I=this._object[F];delete this._object[F];return I}function h(){return Object.clone(this._object)}function l(){return this.pluck("key")}function p(){return this.pluck("value")}
function m(F){var I=this.detect(function(g){return g.value===F});return I&&I.key}function t(F){return this.clone().update(F)}function w(F){return(new Hash(F)).inject(this,function(I,g){I.set(g.key,g.value);return I})}function B(F,I){if(Object.isUndefined(I))return F;return F+"="+encodeURIComponent(String.interpret(I))}function z(){return this.inject([],function(F,I){var g=encodeURIComponent(I.key);if((I=I.value)&&typeof I=="object"){if(Object.isArray(I))return F.concat(I.map(B.curry(g)))}else F.push(B(g,
I));return F}).join("&")}function K(){return"#<Hash:{"+this.map(function(F){return F.map(Object.inspect).join(": ")}).join(", ")+"}>"}function P(){return new Hash(this)}return{initialize:a,_each:b,set:c,get:e,unset:f,toObject:h,toTemplateReplacements:h,keys:l,values:p,index:m,merge:t,update:w,toQueryString:z,inspect:K,toJSON:h,clone:P}}());Hash.from=$H;
Object.extend(Number.prototype,function(){function a(){return this.toPaddedString(2,16)}function b(){return this+1}function c(m,t){$R(0,this,true).each(m,t);return this}function e(m,t){t=this.toString(t||10);return"0".times(m-t.length)+t}function f(){return Math.abs(this)}function h(){return Math.round(this)}function l(){return Math.ceil(this)}function p(){return Math.floor(this)}return{toColorPart:a,succ:b,times:c,toPaddedString:e,abs:f,round:h,ceil:l,floor:p}}());
function $R(a,b,c){return new ObjectRange(a,b,c)}
var ObjectRange=Class.create(Enumerable,function(){function a(e,f,h){this.start=e;this.end=f;this.exclusive=h}function b(e){for(var f=this.start;this.include(f);){e(f);f=f.succ()}}function c(e){if(e<this.start)return false;if(this.exclusive)return e<this.end;return e<=this.end}return{initialize:a,_each:b,include:c}}()),Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||
false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,e){this.each(function(f){if(Object.isFunction(f[a]))try{f[a].apply(f,[b,c,e])}catch(h){}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});
Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters))this.options.parameters=this.options.parameters.toObject()}});
Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,b,c){$super(c);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){a+=(a?"&":"")+"_method="+this.method;this.method="post"}if(a)if(this.method=="get")this.url+=(this.url.include("?")?"&":"?")+a;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))a+=
"&_=";this.parameters=a.toQueryParams();try{var b=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?this.options.postBody||a:null;this.transport.send(this.body);!this.options.asynchronous&&
this.transport.overrideMimeType&&this.onStateChange()}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;a>1&&!(a==4&&this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){a["Content-type"]=this.options.contentType+(this.options.encoding?
"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)a.Connection="close"}if(typeof this.options.requestHeaders=="object"){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var c=0,e=b.length;c<e;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(h){a[h.key]=h.value})}for(var f in a)this.transport.setRequestHeader(f,a[f])},success:function(){var a=this.getStatus();return!a||a>=200&&a<300},getStatus:function(){try{return this.transport.status||
0}catch(a){return 0}},respondToReadyState:function(a){a=Ajax.Request.Events[a];var b=new Ajax.Response(this);if(a=="Complete"){try{this._complete=true;(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(c){this.dispatchException(c)}var e=b.getHeader("Content-type");if(this.options.evalJS=="force"||this.options.evalJS&&this.isSameOrigin()&&e&&e.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))this.evalResponse()}try{(this.options["on"+
a]||Prototype.emptyFunction)(b,b.headerJSON);Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(f){this.dispatchException(f)}if(a=="Complete")this.transport.onreadystatechange=Prototype.emptyFunction},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;a=this.transport=a.transport;var b=this.readyState=a.readyState;if(b>2&&!Prototype.Browser.IE||b==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(a.responseText);this.headerJSON=this._getHeaderJSON()}if(b==4){a=a.responseXML;this.responseXML=Object.isUndefined(a)?null:a;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,
getStatusText:function(){try{return this.transport.statusText||""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;a=decodeURIComponent(escape(a));try{return a.evalJSON(this.request.options.sanitizeJSON||
!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}},_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||a.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,c,e){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};e=Object.clone(e);var f=e.onComplete;e.onComplete=function(h,l){this.updateContent(h.responseText);Object.isFunction(f)&&f(h,l)}.bind(this);$super(c,e)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],c=this.options;c.evalScripts||(a=a.stripScripts());if(b=$(b))if(c.insertion)if(Object.isString(c.insertion)){var e=
{};e[c.insertion]=a;b.insert(e)}else c.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,c,e){$super(e);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){if(this.options.decay){this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1;this.lastText=a.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(a){if(arguments.length>1){for(var b=0,c=[],e=arguments.length;b<e;b++)c.push($(arguments[b]));return c}if(Object.isString(a))a=document.getElementById(a);return Element.extend(a)}if(Prototype.BrowserFeatures.XPath)document._getElementsByXPath=function(a,b){var c=[];a=document.evaluate(a,$(b)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);b=0;for(var e=a.snapshotLength;b<e;b++)c.push(Element.extend(a.snapshotItem(b)));return c};if(!Node)var Node={};
Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});
(function(a){var b=function(){try{var e=document.createElement('<input name="x">');return e.tagName.toLowerCase()==="input"&&e.name==="x"}catch(f){return false}}(),c=a.Element;a.Element=function(e,f){f=f||{};e=e.toLowerCase();var h=Element.cache;if(b&&f.name){e="<"+e+' name="'+f.name+'">';delete f.name;return Element.writeAttribute(document.createElement(e),f)}h[e]||(h[e]=Element.extend(document.createElement(e)));e="type"in f?document.createElement(e):h[e].cloneNode(false);return Element.writeAttribute(e,
f)};Object.extend(a.Element,c||{});if(c)a.Element.prototype=c.prototype})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(a){var b=a._prototypeUID;if(b){Element.stopObserving(a);a._prototypeUID=void 0;delete Element.Storage[b]}};
Element.Methods={visible:function(a){return $(a).style.display!="none"},toggle:function(a){a=$(a);Element[Element.visible(a)?"hide":"show"](a);return a},hide:function(a){a=$(a);a.style.display="none";return a},show:function(a){a=$(a);a.style.display="";return a},remove:function(a){a=$(a);a.parentNode.removeChild(a);return a},update:function(){function a(f,h){f=$(f);for(var l=Element._purgeElement,p=f.getElementsByTagName("*"),m=p.length;m--;)l(p[m]);if(h&&h.toElement)h=h.toElement();if(Object.isElement(h))return f.update().insert(h);
h=Object.toHTML(h);l=f.tagName.toUpperCase();if(l==="SCRIPT"&&e){f.text=h;return f}if(b||c)if(l in Element._insertionTranslations.tags){for(;f.firstChild;)f.removeChild(f.firstChild);Element._getContentFromAnonymousElement(l,h.stripScripts()).each(function(t){f.appendChild(t)})}else f.innerHTML=h.stripScripts();else f.innerHTML=h.stripScripts();h.evalScripts.bind(h).defer();return f}var b=function(){var f=document.createElement("select"),h=true;f.innerHTML='<option value="test">test</option>';if(f.options&&
f.options[0])h=f.options[0].nodeName.toUpperCase()!=="OPTION";return h}(),c=function(){try{var f=document.createElement("table");if(f&&f.tBodies){f.innerHTML="<tbody><tr><td>test</td></tr></tbody>";return typeof f.tBodies[0]=="undefined"}}catch(h){return true}}(),e=function(){var f=document.createElement("script"),h=false;try{f.appendChild(document.createTextNode(""));h=!f.firstChild||f.firstChild&&f.firstChild.nodeType!==3}catch(l){h=true}return h}();return a}(),replace:function(a,b){a=$(a);if(b&&
b.toElement)b=b.toElement();else if(!Object.isElement(b)){b=Object.toHTML(b);var c=a.ownerDocument.createRange();c.selectNode(a);b.evalScripts.bind(b).defer();b=c.createContextualFragment(b.stripScripts())}a.parentNode.replaceChild(b,a);return a},insert:function(a,b){a=$(a);if(Object.isString(b)||Object.isNumber(b)||Object.isElement(b)||b&&(b.toElement||b.toHTML))b={bottom:b};var c,e,f;for(var h in b){c=b[h];h=h.toLowerCase();e=Element._insertionTranslations[h];if(c&&c.toElement)c=c.toElement();if(Object.isElement(c))e(a,
c);else{c=Object.toHTML(c);f=(h=="before"||h=="after"?a.parentNode:a).tagName.toUpperCase();f=Element._getContentFromAnonymousElement(f,c.stripScripts());if(h=="top"||h=="after")f.reverse();f.each(e.curry(a));c.evalScripts.bind(c).defer()}}return a},wrap:function(a,b,c){a=$(a);if(Object.isElement(b))$(b).writeAttribute(c||{});else b=Object.isString(b)?new Element(b,c):new Element("div",b);a.parentNode&&a.parentNode.replaceChild(b,a);b.appendChild(a);return b},inspect:function(a){a=$(a);var b="<"+
a.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(c){var e=c.first();c=c.last();if(e=(a[e]||"").toString())b+=" "+c+"="+e.inspect(true)});return b+">"},recursivelyCollect:function(a,b,c){a=$(a);c=c||-1;for(var e=[];a=a[b];){a.nodeType==1&&e.push(Element.extend(a));if(e.length==c)break}return e},ancestors:function(a){return Element.recursivelyCollect(a,"parentNode")},descendants:function(a){return Element.select(a,"*")},firstDescendant:function(a){for(a=$(a).firstChild;a&&a.nodeType!=
1;)a=a.nextSibling;return $(a)},immediateDescendants:function(a){var b=[];for(a=$(a).firstChild;a;){a.nodeType===1&&b.push(Element.extend(a));a=a.nextSibling}return b},previousSiblings:function(a){return Element.recursivelyCollect(a,"previousSibling")},nextSiblings:function(a){return Element.recursivelyCollect(a,"nextSibling")},siblings:function(a){a=$(a);return Element.previousSiblings(a).reverse().concat(Element.nextSiblings(a))},match:function(a,b){a=$(a);if(Object.isString(b))return Prototype.Selector.match(a,
b);return b.match(a)},up:function(a,b,c){a=$(a);if(arguments.length==1)return $(a.parentNode);var e=Element.ancestors(a);return Object.isNumber(b)?e[b]:Prototype.Selector.find(e,b,c)},down:function(a,b,c){a=$(a);if(arguments.length==1)return Element.firstDescendant(a);return Object.isNumber(b)?Element.descendants(a)[b]:Element.select(a,b)[c||0]},previous:function(a,b,c){a=$(a);if(Object.isNumber(b)){c=b;b=false}Object.isNumber(c)||(c=0);return b?Prototype.Selector.find(a.previousSiblings(),b,c):a.recursivelyCollect("previousSibling",
c+1)[c]},next:function(a,b,c){a=$(a);if(Object.isNumber(b)){c=b;b=false}Object.isNumber(c)||(c=0);if(b)return Prototype.Selector.find(a.nextSiblings(),b,c);else{Object.isNumber(c);return a.recursivelyCollect("nextSibling",c+1)[c]}},select:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a)},adjacent:function(a){a=$(a);var b=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(b,a.parentNode).without(a)},identify:function(a){a=
$(a);var b=Element.readAttribute(a,"id");if(b)return b;do b="anonymous_element_"+Element.idCounter++;while($(b));Element.writeAttribute(a,"id",b);return b},readAttribute:function(a,b){a=$(a);if(Prototype.Browser.IE){var c=Element._attributeTranslations.read;if(c.values[b])return c.values[b](a,b);if(c.names[b])b=c.names[b];if(b.include(":"))return!a.attributes||!a.attributes[b]?null:a.attributes[b].value}return a.getAttribute(b)},writeAttribute:function(a,b,c){a=$(a);var e={},f=Element._attributeTranslations.write;
if(typeof b=="object")e=b;else e[b]=Object.isUndefined(c)?true:c;for(var h in e){b=f.names[h]||h;c=e[h];if(f.values[h])b=f.values[h](a,c);if(c===false||c===null)a.removeAttribute(b);else c===true?a.setAttribute(b,b):a.setAttribute(b,c)}return a},getHeight:function(a){return Element.getDimensions(a).height},getWidth:function(a){return Element.getDimensions(a).width},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(a=$(a)){a=a.className;return a.length>0&&(a==b||
(new RegExp("(^|\\s)"+b+"(\\s|$)")).test(a))}},addClassName:function(a,b){if(a=$(a)){Element.hasClassName(a,b)||(a.className+=(a.className?" ":"")+b);return a}},removeClassName:function(a,b){if(a=$(a)){a.className=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)")," ").strip();return a}},toggleClassName:function(a,b){if(a=$(a))return Element[Element.hasClassName(a,b)?"removeClassName":"addClassName"](a,b)},cleanWhitespace:function(a){a=$(a);for(var b=a.firstChild;b;){var c=b.nextSibling;b.nodeType==
3&&!/\S/.test(b.nodeValue)&&a.removeChild(b);b=c}return a},empty:function(a){return $(a).innerHTML.blank()},descendantOf:function(a,b){a=$(a);b=$(b);if(a.compareDocumentPosition)return(a.compareDocumentPosition(b)&8)===8;if(b.contains)return b.contains(a)&&b!==a;for(;a=a.parentNode;)if(a==b)return true;return false},scrollTo:function(a){a=$(a);var b=Element.cumulativeOffset(a);window.scrollTo(b[0],b[1]);return a},getStyle:function(a,b){a=$(a);b=b=="float"?"cssFloat":b.camelize();var c=a.style[b];
if(!c||c=="auto")c=(a=document.defaultView.getComputedStyle(a,null))?a[b]:null;if(b=="opacity")return c?parseFloat(c):1;return c=="auto"?null:c},getOpacity:function(a){return $(a).getStyle("opacity")},setStyle:function(a,b){a=$(a);var c=a.style;if(Object.isString(b)){a.style.cssText+=";"+b;return b.include("opacity")?a.setOpacity(b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a}for(var e in b)if(e=="opacity")a.setOpacity(b[e]);else c[e=="float"||e=="cssFloat"?Object.isUndefined(c.styleFloat)?"cssFloat":"styleFloat":
e]=b[e];return a},setOpacity:function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;return a},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b){a._madePositioned=true;a.style.position="relative";if(Prototype.Browser.Opera){a.style.top=0;a.style.left=0}}return a},undoPositioned:function(a){a=$(a);if(a._madePositioned){a._madePositioned=undefined;a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right=""}return a},makeClipping:function(a){a=
$(a);if(a._overflow)return a;a._overflow=Element.getStyle(a,"overflow")||"auto";if(a._overflow!=="hidden")a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a._overflow)return a;a.style.overflow=a._overflow=="auto"?"":a._overflow;a._overflow=null;return a},clonePosition:function(a,b,c){c=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},c||{});b=$(b);var e=Element.viewportOffset(b),f=[0,0],h=null;a=$(a);if(Element.getStyle(a,"position")==
"absolute"){h=Element.getOffsetParent(a);f=Element.viewportOffset(h)}if(h==document.body){f[0]-=document.body.offsetLeft;f[1]-=document.body.offsetTop}if(c.setLeft)a.style.left=e[0]-f[0]+c.offsetLeft+"px";if(c.setTop)a.style.top=e[1]-f[1]+c.offsetTop+"px";if(c.setWidth)a.style.width=b.offsetWidth+"px";if(c.setHeight)a.style.height=b.offsetHeight+"px";return a}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});
Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};
if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(a,b,c){switch(c){case "left":case "top":case "right":case "bottom":if(a(b,"position")==="static")return null;case "height":case "width":if(!Element.visible(b))return null;var e=parseInt(a(b,c),10);if(e!==b["offset"+c.capitalize()])return e+"px";return(c==="height"?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(e,
function(f,h){h=a(b,h);return h===null?f:f-parseInt(h,10)})+"px";default:return a(b,c)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(a,b,c){if(c==="title")return b.title;return a(b,c)})}else if(Prototype.Browser.IE){Element.Methods.getStyle=function(a,b){a=$(a);b=b=="float"||b=="cssFloat"?"styleFloat":b.camelize();var c=a.style[b];if(!c&&a.currentStyle)c=a.currentStyle[b];if(b=="opacity"){if(c=(a.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))if(c[1])return parseFloat(c[1])/
100;return 1}if(c=="auto"){if((b=="width"||b=="height")&&a.getStyle("display")!="none")return a["offset"+b.capitalize()]+"px";return null}return c};Element.Methods.setOpacity=function(a,b){function c(h){return h.replace(/alpha\([^\)]*\)/gi,"")}a=$(a);var e=a.currentStyle;if(e&&!e.hasLayout||!e&&a.style.zoom=="normal")a.style.zoom=1;e=a.getStyle("filter");var f=a.style;if(b==1||b===""){(e=c(e))?(f.filter=e):f.removeAttribute("filter");return a}else if(b<1.0E-5)b=0;f.filter=c(e)+"alpha(opacity="+b*
100+")";return a};Element._attributeTranslations=function(){var a="className",b="for",c=document.createElement("div");c.setAttribute(a,"x");if(c.className!=="x"){c.setAttribute("class","x");if(c.className==="x")a="class"}c=null;c=document.createElement("label");c.setAttribute(b,"x");if(c.htmlFor!=="x"){c.setAttribute("htmlFor","x");if(c.htmlFor==="x")b="htmlFor"}c=null;return{read:{names:{"class":a,className:a,"for":b,htmlFor:b},values:{_getAttr:function(e,f){return e.getAttribute(f)},_getAttr2:function(e,
f){return e.getAttribute(f,2)},_getAttrNode:function(e,f){return(e=e.getAttributeNode(f))?e.value:""},_getEv:function(){var e=document.createElement("div"),f;e.onclick=Prototype.emptyFunction;e=e.getAttribute("onclick");if(String(e).indexOf("{")>-1)f=function(h,l){l=h.getAttribute(l);if(!l)return null;l=l.toString();l=l.split("{")[1];l=l.split("}")[0];return l.strip()};else if(e==="")f=function(h,l){l=h.getAttribute(l);if(!l)return null;return l.strip()};e=null;return f}(),_flag:function(e,f){return $(e).hasAttribute(f)?
f:null},style:function(e){return e.style.cssText.toLowerCase()},title:function(e){return e.title}}}}}();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(a,b){a.checked=!!b},style:function(a,b){a.style.cssText=b?b:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(a){Element._attributeTranslations.write.names[a.toLowerCase()]=
a;Element._attributeTranslations.has[a.toLowerCase()]=a});(function(a){Object.extend(a,{href:a._getAttr2,src:a._getAttr2,type:a._getAttr,action:a._getAttrNode,disabled:a._flag,checked:a._flag,readonly:a._flag,multiple:a._flag,onload:a._getEv,onunload:a._getEv,onclick:a._getEv,ondblclick:a._getEv,onmousedown:a._getEv,onmouseup:a._getEv,onmouseover:a._getEv,onmousemove:a._getEv,onmouseout:a._getEv,onfocus:a._getEv,onblur:a._getEv,onkeypress:a._getEv,onkeydown:a._getEv,onkeyup:a._getEv,onsubmit:a._getEv,
onreset:a._getEv,onselect:a._getEv,onchange:a._getEv})})(Element._attributeTranslations.read.values);Prototype.BrowserFeatures.ElementExtensions&&function(){function a(b){b=b.getElementsByTagName("*");for(var c=[],e=0,f;f=b[e];e++)f.tagName!=="!"&&c.push(f);return c}Element.Methods.down=function(b,c,e){b=$(b);if(arguments.length==1)return b.firstDescendant();return Object.isNumber(c)?a(b)[c]:Element.select(b,c)[e||0]}}()}else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent))Element.Methods.setOpacity=
function(a,b){a=$(a);a.style.opacity=b==1?0.999999:b===""?"":b<1.0E-5?0:b;return a};else if(Prototype.Browser.WebKit)Element.Methods.setOpacity=function(a,b){a=$(a);a.style.opacity=b==1||b===""?"":b<1.0E-5?0:b;if(b==1)if(a.tagName.toUpperCase()=="IMG"&&a.width){a.width++;a.width--}else try{var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(e){}return a};
if("outerHTML"in document.documentElement)Element.Methods.replace=function(a,b){a=$(a);if(b&&b.toElement)b=b.toElement();if(Object.isElement(b)){a.parentNode.replaceChild(b,a);return a}b=Object.toHTML(b);var c=a.parentNode,e=c.tagName.toUpperCase();if(Element._insertionTranslations.tags[e]){var f=a.next();e=Element._getContentFromAnonymousElement(e,b.stripScripts());c.removeChild(a);f?e.each(function(h){c.insertBefore(h,f)}):e.each(function(h){c.appendChild(h)})}else a.outerHTML=b.stripScripts();
b.evalScripts.bind(b).defer();return a};Element._returnOffset=function(a,b){var c=[a,b];c.left=a;c.top=b;return c};Element._getContentFromAnonymousElement=function(a,b){var c=new Element("div");if(a=Element._insertionTranslations.tags[a]){c.innerHTML=a[0]+b+a[1];for(b=a[2];b--;)c=c.firstChild}else c.innerHTML=b;return $A(c.childNodes)};
Element._insertionTranslations={before:function(a,b){a.parentNode.insertBefore(b,a)},top:function(a,b){a.insertBefore(b,a.firstChild)},bottom:function(a,b){a.appendChild(b)},after:function(a,b){a.parentNode.insertBefore(b,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};
(function(){var a=Element._insertionTranslations.tags;Object.extend(a,{THEAD:a.TBODY,TFOOT:a.TBODY,TH:a.TD})})();Element.Methods.Simulated={hasAttribute:function(a,b){b=Element._attributeTranslations.has[b]||b;a=$(a).getAttributeNode(b);return!!(a&&a.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);
(function(a){if(!Prototype.BrowserFeatures.ElementExtensions&&a.__proto__){window.HTMLElement={};window.HTMLElement.prototype=a.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}})(document.createElement("div"));
Element.extend=function(){function a(h){if(typeof window.Element!="undefined"){var l=window.Element.prototype;if(l){var p="_"+(Math.random()+"").slice(2);h=document.createElement(h);l[p]="x";h=h[p]!=="x";delete l[p];return h}}return false}function b(h,l){for(var p in l){var m=l[p];if(Object.isFunction(m)&&!(p in h))h[p]=m.methodize()}}var c=a("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(c)return function(h){if(h&&typeof h._extendedByPrototype=="undefined"){var l=h.tagName;
if(l&&/^(?:object|applet|embed)$/i.test(l)){b(h,Element.Methods);b(h,Element.Methods.Simulated);b(h,Element.Methods.ByTag[l.toUpperCase()])}}return h};return Prototype.K}var e={},f=Element.Methods.ByTag;c=Object.extend(function(h){if(!h||typeof h._extendedByPrototype!="undefined"||h.nodeType!=1||h==window)return h;var l=Object.clone(e),p=h.tagName.toUpperCase();f[p]&&Object.extend(l,f[p]);b(h,l);h._extendedByPrototype=Prototype.emptyFunction;return h},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(e,
Element.Methods);Object.extend(e,Element.Methods.Simulated)}}});c.refresh();return c}();Element.hasAttribute=document.documentElement.hasAttribute?function(a,b){return a.hasAttribute(b)}:Element.Methods.Simulated.hasAttribute;
Element.addMethods=function(a){function b(m){m=m.toUpperCase();Element.Methods.ByTag[m]||(Element.Methods.ByTag[m]={});Object.extend(Element.Methods.ByTag[m],a)}function c(m,t,w){w=w||false;for(var B in m){var z=m[B];if(Object.isFunction(z))if(!w||!(B in t))t[B]=z.methodize()}}function e(m){var t,w={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",
Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(w[m])t="HTML"+w[m]+"Element";if(window[t])return window[t];t="HTML"+m+"Element";if(window[t])return window[t];t="HTML"+m.capitalize()+"Element";if(window[t])return window[t];m=document.createElement(m);return m.__proto__||m.constructor.prototype}
var f=Prototype.BrowserFeatures,h=Element.Methods.ByTag;if(!a){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var l=a;a=arguments[1]}if(l)Object.isArray(l)?l.each(b):b(l);else Object.extend(Element.Methods,a||{});l=window.HTMLElement?HTMLElement.prototype:
Element.prototype;if(f.ElementExtensions){c(Element.Methods,l);c(Element.Methods.Simulated,l,true)}if(f.SpecificElementExtensions)for(var p in Element.Methods.ByTag){f=e(p);Object.isUndefined(f)||c(h[p],f.prototype)}Object.extend(Element,Element.Methods);delete Element.ByTag;Element.extend.refresh&&Element.extend.refresh();Element.cache={}};
document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};
(function(a){function b(){if(e.WebKit&&!f.evaluate)return document;if(e.Opera&&window.parseFloat(window.opera.version())<9.5)return document.body;return document.documentElement}function c(p){h||(h=b());l[p]="client"+p;a["get"+p]=function(){return h[l[p]]};return a["get"+p]()}var e=Prototype.Browser,f=document,h,l={};a.getWidth=c.curry("Width");a.getHeight=c.curry("Height")})(document.viewport);Element.Storage={UID:1};
Element.addMethods({getStorage:function(a){if(a=$(a)){if(a===window)a=0;else{if(typeof a._prototypeUID==="undefined")a._prototypeUID=Element.Storage.UID++;a=a._prototypeUID}Element.Storage[a]||(Element.Storage[a]=$H());return Element.Storage[a]}},store:function(a,b,c){if(a=$(a)){arguments.length===2?Element.getStorage(a).update(b):Element.getStorage(a).set(b,c);return a}},retrieve:function(a,b,c){if(a=$(a)){a=Element.getStorage(a);var e=a.get(b);if(Object.isUndefined(e)){a.set(b,c);e=c}return e}},
clone:function(a,b){if(a=$(a)){a=a.cloneNode(b);a._prototypeUID=void 0;if(b){b=Element.select(a,"*");for(var c=b.length;c--;)b[c]._prototypeUID=void 0}return Element.extend(a)}},purge:function(a){if(a=$(a)){var b=Element._purgeElement;b(a);a=a.getElementsByTagName("*");for(var c=a.length;c--;)b(a[c]);return null}}});
(function(){function a(g){g=g.match(/^(\d+)%?$/i);if(!g)return null;return Number(g[1])/100}function b(g,j,n){var q=null;if(Object.isElement(g)){q=g;g=q.getStyle(j)}if(g===null)return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(g))return window.parseFloat(g);var u=g.include("%"),r=n===document.viewport;if(/\d/.test(g)&&q&&q.runtimeStyle&&!(u&&r)){n=q.style.left;j=q.runtimeStyle.left;q.runtimeStyle.left=q.currentStyle.left;q.style.left=g||0;g=q.style.pixelLeft;q.style.left=n;q.runtimeStyle.left=j;return g}if(q&&
u){n=n||q.parentNode;g=a(g);u=null;q.getStyle("position");q=j.include("left")||j.include("right")||j.include("width");j=j.include("top")||j.include("bottom")||j.include("height");if(n===document.viewport)if(q)u=document.viewport.getWidth();else{if(j)u=document.viewport.getHeight()}else if(q)u=$(n).measure("width");else if(j)u=$(n).measure("height");return u===null?0:u*g}return 0}function c(g){for(;g&&g.parentNode;){if(g.getStyle("display")==="none")return false;g=$(g.parentNode)}return true}function e(g){if(g.include("border"))g+=
"-width";return g.camelize()}function f(g,j){return new Element.Layout(g,j)}function h(g,j){return $(g).getLayout().get(j)}function l(g){g=$(g);var j=Element.getStyle(g,"display");if(j&&j!=="none")return{width:g.offsetWidth,height:g.offsetHeight};j=g.style;j={visibility:j.visibility,position:j.position,display:j.display};var n={visibility:"hidden",display:"block"};if(j.position!=="fixed")n.position="absolute";Element.setStyle(g,n);n={width:g.offsetWidth,height:g.offsetHeight};Element.setStyle(g,j);
return n}function p(g){if(F(g))return $(document.body);if(Element.getStyle(g,"display")!=="inline"&&g.offsetParent)return $(g.offsetParent);if(g===document.body)return $(g);for(;(g=g.parentNode)&&g!==document.body;)if(Element.getStyle(g,"position")!=="static")return g.nodeName==="HTML"?$(document.body):$(g);return $(document.body)}function m(g){var j=0,n=0;if(g.parentNode){do{j+=g.offsetTop||0;n+=g.offsetLeft||0;g=g.offsetParent}while(g)}return new Element.Offset(n,j)}function t(g){var j=g.getLayout(),
n=0,q=0;do{n+=g.offsetTop||0;q+=g.offsetLeft||0;if(g=g.offsetParent){if(P(g))break;if(Element.getStyle(g,"position")!=="static")break}}while(g);q-=j.get("margin-top");n-=j.get("margin-left");return new Element.Offset(q,n)}function w(g){var j=0,n=0;do{j+=g.scrollTop||0;n+=g.scrollLeft||0;g=g.parentNode}while(g);return new Element.Offset(n,j)}function B(g){var j=0,n=0,q=document.body,u=g;do{j+=u.offsetTop||0;n+=u.offsetLeft||0;if(u.offsetParent==q&&Element.getStyle(u,"position")=="absolute")break}while(u=
u.offsetParent);u=g;do if(u!=q){j-=u.scrollTop||0;n-=u.scrollLeft||0}while(u=u.parentNode);return new Element.Offset(n,j)}function z(g){g=$(g);if(Element.getStyle(g,"position")==="absolute")return g;var j=p(g),n=g.viewportOffset();j=j.viewportOffset();n=n.relativeTo(j);j=g.getLayout();g.store("prototype_absolutize_original_styles",{left:g.getStyle("left"),top:g.getStyle("top"),width:g.getStyle("width"),height:g.getStyle("height")});g.setStyle({position:"absolute",top:n.top+"px",left:n.left+"px",width:j.get("width")+
"px",height:j.get("height")+"px"});return g}function K(g){g=$(g);if(Element.getStyle(g,"position")==="relative")return g;var j=g.retrieve("prototype_absolutize_original_styles");j&&g.setStyle(j);return g}function P(g){return g.nodeName.toUpperCase()==="BODY"}function F(g){return g!==document.body&&!Element.descendantOf(g,document.body)}var I=Prototype.K;if("currentStyle"in document.documentElement)I=function(g){if(!g.currentStyle.hasLayout)g.style.zoom=1;return g};Element.Layout=Class.create(Hash,
{initialize:function($super,j,n){$super();this.element=$(j);Element.Layout.PROPERTIES.each(function(q){this._set(q,null)},this);if(n){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(g,j){return Hash.prototype.set.call(this,g,j)},set:function(){throw"Properties of Element.Layout are read-only.";},get:function($super,j){var n=$super(j);return n===null?this._compute(j):n},_begin:function(){if(!this._prepared){var g=
this.element;if(!c(g)){g.store("prototype_original_styles",{position:g.style.position||"",width:g.style.width||"",visibility:g.style.visibility||"",display:g.style.display||""});var j=g.getStyle("position"),n=g.getStyle("width"),q=j==="fixed"?document.viewport:g.parentNode;g.setStyle({position:"absolute",visibility:"hidden",display:"block"});var u=g.getStyle("width");j=n&&u===n?b(g,"width",q):j==="absolute"||j==="fixed"?b(g,"width",q):$(g.parentNode).getLayout().get("width")-this.get("margin-left")-
this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right");g.setStyle({width:j+"px"})}this._prepared=true}},_end:function(){var g=this.element,j=g.retrieve("prototype_original_styles");g.store("prototype_original_styles",null);g.setStyle(j);this._prepared=false},_compute:function(g){var j=Element.Layout.COMPUTATIONS;if(!(g in j))throw"Property not found.";return this._set(g,j[g].call(this,this.element))},toObject:function(){var g=$A(arguments),
j={};(g.length===0?Element.Layout.PROPERTIES:g.join(" ").split(" ")).each(function(n){if(Element.Layout.PROPERTIES.include(n)){var q=this.get(n);if(q!=null)j[n]=q}},this);return j},toHash:function(){var g=this.toObject.apply(this,arguments);return new Hash(g)},toCSS:function(){var g=$A(arguments),j={};(g.length===0?Element.Layout.PROPERTIES:g.join(" ").split(" ")).each(function(n){if(Element.Layout.PROPERTIES.include(n))if(!Element.Layout.COMPOSITE_PROPERTIES.include(n)){var q=this.get(n);if(q!=null)j[e(n)]=
q+"px"}},this);return j},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),
COMPUTATIONS:{height:function(){this._preComputing||this._begin();var g=this.get("border-box-height");if(g<=0){this._preComputing||this._end();return 0}var j=this.get("border-top"),n=this.get("border-bottom"),q=this.get("padding-top"),u=this.get("padding-bottom");this._preComputing||this._end();return g-j-n-q-u},width:function(){this._preComputing||this._begin();var g=this.get("border-box-width");if(g<=0){this._preComputing||this._end();return 0}var j=this.get("border-left"),n=this.get("border-right"),
q=this.get("padding-left"),u=this.get("padding-right");this._preComputing||this._end();return g-j-n-q-u},"padding-box-height":function(){var g=this.get("height"),j=this.get("padding-top"),n=this.get("padding-bottom");return g+j+n},"padding-box-width":function(){var g=this.get("width"),j=this.get("padding-left"),n=this.get("padding-right");return g+j+n},"border-box-height":function(g){this._preComputing||this._begin();g=g.offsetHeight;this._preComputing||this._end();return g},"border-box-width":function(g){this._preComputing||
this._begin();g=g.offsetWidth;this._preComputing||this._end();return g},"margin-box-height":function(){var g=this.get("border-box-height"),j=this.get("margin-top"),n=this.get("margin-bottom");if(g<=0)return 0;return g+j+n},"margin-box-width":function(){var g=this.get("border-box-width"),j=this.get("margin-left"),n=this.get("margin-right");if(g<=0)return 0;return g+j+n},top:function(g){return g.positionedOffset().top},bottom:function(g){var j=g.positionedOffset();g=g.getOffsetParent().measure("height");
var n=this.get("border-box-height");return g-n-j.top},left:function(g){return g.positionedOffset().left},right:function(g){var j=g.positionedOffset();g=g.getOffsetParent().measure("width");var n=this.get("border-box-width");return g-n-j.left},"padding-top":function(g){return b(g,"paddingTop")},"padding-bottom":function(g){return b(g,"paddingBottom")},"padding-left":function(g){return b(g,"paddingLeft")},"padding-right":function(g){return b(g,"paddingRight")},"border-top":function(g){return b(g,"borderTopWidth")},
"border-bottom":function(g){return b(g,"borderBottomWidth")},"border-left":function(g){return b(g,"borderLeftWidth")},"border-right":function(g){return b(g,"borderRightWidth")},"margin-top":function(g){return b(g,"marginTop")},"margin-bottom":function(g){return b(g,"marginBottom")},"margin-left":function(g){return b(g,"marginLeft")},"margin-right":function(g){return b(g,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&Object.extend(Element.Layout.COMPUTATIONS,{right:function(g){var j=
I(g.getOffsetParent());g=g.getBoundingClientRect();return(j.getBoundingClientRect().right-g.right).round()},bottom:function(g){var j=I(g.getOffsetParent());g=g.getBoundingClientRect();return(j.getBoundingClientRect().bottom-g.bottom).round()}});Element.Offset=Class.create({initialize:function(g,j){this.left=g.round();this.top=j.round();this[0]=this.left;this[1]=this.top},relativeTo:function(g){return new Element.Offset(this.left-g.left,this.top-g.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},
toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});if(Prototype.Browser.IE){p=p.wrap(function(g,j){j=$(j);if(F(j))return $(document.body);var n=j.getStyle("position");if(n!=="static")return g(j);j.setStyle({position:"relative"});g=g(j);j.setStyle({position:n});return g});t=t.wrap(function(g,j){j=$(j);if(!j.parentNode)return new Element.Offset(0,0);var n=j.getStyle("position");if(n!=="static")return g(j);var q=j.getOffsetParent();q&&q.getStyle("position")===
"fixed"&&I(q);j.setStyle({position:"relative"});g=g(j);j.setStyle({position:n});return g})}else if(Prototype.Browser.Webkit)m=function(g){var j=0,n=0;do{j+=g.offsetTop||0;n+=g.offsetLeft||0;if(g.offsetParent==document.body)if(Element.getStyle(g,"position")=="absolute")break;g=g.offsetParent}while(g);return new Element.Offset(n,j)};Element.addMethods({getLayout:f,measure:h,getDimensions:l,getOffsetParent:p,cumulativeOffset:m,positionedOffset:t,cumulativeScrollOffset:w,viewportOffset:B,absolutize:z,
relativize:K});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(g){g=$(g);if(F(g))return new Element.Offset(0,0);g=g.getBoundingClientRect();var j=document.documentElement;return new Element.Offset(g.left-j.clientLeft,g.top-j.clientTop)}})})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};
Prototype.Selector=function(){function a(){throw new Error('Method "Prototype.Selector.select" must be defined.');}function b(){throw new Error('Method "Prototype.Selector.match" must be defined.');}function c(h,l,p){p=p||0;var m=Prototype.Selector.match,t=h.length,w=0,B;for(B=0;B<t;B++)if(m(h[B],l)&&p==w++)return Element.extend(h[B])}function e(h){for(var l=0,p=h.length;l<p;l++)Element.extend(h[l]);return h}var f=Prototype.K;return{select:a,match:b,find:c,extendElements:Element.extend===f?f:e,extendElement:Element.extend}}();
Prototype._original_property=window.Sizzle;
(function(){function a(g,j,n,q,u,r){u=g=="previousSibling"&&!r;for(var v=0,C=q.length;v<C;v++){var o=q[v];if(o){if(u&&o.nodeType===1){o.sizcache=n;o.sizset=v}o=o[g];for(var y=false;o;){if(o.sizcache===n){y=q[o.sizset];break}if(o.nodeType===1&&!r){o.sizcache=n;o.sizset=v}if(o.nodeName===j){y=o;break}o=o[g]}q[v]=y}}}function b(g,j,n,q,u,r){u=g=="previousSibling"&&!r;for(var v=0,C=q.length;v<C;v++){var o=q[v];if(o){if(u&&o.nodeType===1){o.sizcache=n;o.sizset=v}o=o[g];for(var y=false;o;){if(o.sizcache===
n){y=q[o.sizset];break}if(o.nodeType===1){if(!r){o.sizcache=n;o.sizset=v}if(typeof j!=="string"){if(o===j){y=true;break}}else if(p.filter(j,[o]).length>0){y=o;break}}o=o[g]}q[v]=y}}}var c=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,f=Object.prototype.toString,h=false,l=true;[0,0].sort(function(){l=false;return 0});var p=function(g,j,n,q){n=n||[];var u=j=j||document;if(j.nodeType!==1&&j.nodeType!==9)return[];
if(!g||typeof g!=="string")return n;for(var r=[],v,C,o,y,D=true,Q=F(j),T=g;(c.exec(""),v=c.exec(T))!==null;){T=v[3];r.push(v[1]);if(v[2]){y=v[3];break}}if(r.length>1&&t.exec(g))if(r.length===2&&m.relative[r[0]])C=I(r[0]+r[1],j);else for(C=m.relative[r[0]]?[j]:p(r.shift(),j);r.length;){g=r.shift();if(m.relative[g])g+=r.shift();C=I(g,C)}else{if(!q&&r.length>1&&j.nodeType===9&&!Q&&m.match.ID.test(r[0])&&!m.match.ID.test(r[r.length-1])){v=p.find(r.shift(),j,Q);j=v.expr?p.filter(v.expr,v.set)[0]:v.set[0]}if(j){v=
q?{expr:r.pop(),set:B(q)}:p.find(r.pop(),r.length===1&&(r[0]==="~"||r[0]==="+")&&j.parentNode?j.parentNode:j,Q);C=v.expr?p.filter(v.expr,v.set):v.set;if(r.length>0)o=B(C);else D=false;for(;r.length;){var G=r.pop();v=G;if(m.relative[G])v=r.pop();else G="";if(v==null)v=j;m.relative[G](o,v,Q)}}else o=[]}o||(o=C);if(!o)throw"Syntax error, unrecognized expression: "+(G||g);if(f.call(o)==="[object Array]")if(D)if(j&&j.nodeType===1)for(g=0;o[g]!=null;g++){if(o[g]&&(o[g]===true||o[g].nodeType===1&&P(j,o[g])))n.push(C[g])}else for(g=
0;o[g]!=null;g++)o[g]&&o[g].nodeType===1&&n.push(C[g]);else n.push.apply(n,o);else B(o,n);if(y){p(y,u,n,q);p.uniqueSort(n)}return n};p.uniqueSort=function(g){if(K){h=l;g.sort(K);if(h)for(var j=1;j<g.length;j++)g[j]===g[j-1]&&g.splice(j--,1)}return g};p.matches=function(g,j){return p(g,null,null,j)};p.find=function(g,j,n){var q,u;if(!g)return[];for(var r=0,v=m.order.length;r<v;r++){var C=m.order[r];if(u=m.leftMatch[C].exec(g)){var o=u[1];u.splice(1,1);if(o.substr(o.length-1)!=="\\"){u[1]=(u[1]||"").replace(/\\/g,
"");q=m.find[C](u,j,n);if(q!=null){g=g.replace(m.match[C],"");break}}}}q||(q=j.getElementsByTagName("*"));return{set:q,expr:g}};p.filter=function(g,j,n,q){for(var u=g,r=[],v=j,C,o,y=j&&j[0]&&F(j[0]);g&&j.length;){for(var D in m.filter)if((C=m.match[D].exec(g))!=null){var Q=m.filter[D],T,G;o=false;if(v==r)r=[];if(m.preFilter[D])if(C=m.preFilter[D](C,v,n,r,q,y)){if(C===true)continue}else o=T=true;if(C)for(var L=0;(G=v[L])!=null;L++)if(G){T=Q(G,C,L,v);var E=q^!!T;if(n&&T!=null)if(E)o=true;else v[L]=
false;else if(E){r.push(G);o=true}}if(T!==undefined){n||(v=r);g=g.replace(m.match[D],"");if(!o)return[];break}}if(g==u)if(o==null)throw"Syntax error, unrecognized expression: "+g;else break;u=g}return v};var m=p.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,
CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},relative:{"+":function(g,j,n){var q=typeof j==="string",u=q&&!/\W/.test(j);q=q&&!u;if(u&&!n)j=j.toUpperCase();n=0;u=g.length;for(var r;n<u;n++)if(r=g[n]){for(;(r=r.previousSibling)&&
r.nodeType!==1;);g[n]=q||r&&r.nodeName===j?r||false:r===j}q&&p.filter(j,g,true)},">":function(g,j,n){var q=typeof j==="string";if(q&&!/\W/.test(j)){j=n?j:j.toUpperCase();n=0;for(var u=g.length;n<u;n++){var r=g[n];if(r){q=r.parentNode;g[n]=q.nodeName===j?q:false}}}else{n=0;for(u=g.length;n<u;n++)if(r=g[n])g[n]=q?r.parentNode:r.parentNode===j;q&&p.filter(j,g,true)}},"":function(g,j,n){var q=e++,u=b;if(!/\W/.test(j)){var r=j=n?j:j.toUpperCase();u=a}u("parentNode",j,q,g,r,n)},"~":function(g,j,n){var q=
e++,u=b;if(typeof j==="string"&&!/\W/.test(j)){var r=j=n?j:j.toUpperCase();u=a}u("previousSibling",j,q,g,r,n)}},find:{ID:function(g,j,n){if(typeof j.getElementById!=="undefined"&&!n)return(g=j.getElementById(g[1]))?[g]:[]},NAME:function(g,j){if(typeof j.getElementsByName!=="undefined"){var n=[];j=j.getElementsByName(g[1]);for(var q=0,u=j.length;q<u;q++)j[q].getAttribute("name")===g[1]&&n.push(j[q]);return n.length===0?null:n}},TAG:function(g,j){return j.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,
j,n,q,u,r){g=" "+g[1].replace(/\\/g,"")+" ";if(r)return g;r=0;for(var v;(v=j[r])!=null;r++)if(v)if(u^(v.className&&(" "+v.className+" ").indexOf(g)>=0))n||q.push(v);else if(n)j[r]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g,j){for(var n=0;j[n]===false;n++);return j[n]&&F(j[n])?g[1]:g[1].toUpperCase()},CHILD:function(g){if(g[1]=="nth"){var j=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]=="even"&&"2n"||g[2]=="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=j[1]+(j[2]||
1)-0;g[3]=j[3]-0}g[0]=e++;return g},ATTR:function(g,j,n,q,u,r){j=g[1].replace(/\\/g,"");if(!r&&m.attrMap[j])g[1]=m.attrMap[j];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,j,n,q,u){if(g[1]==="not")if((c.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=p(g[3],null,null,j);else{g=p.filter(g[3],j,n,true^u);n||q.push.apply(q,g);return false}else if(m.match.POS.test(g[0])||m.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===
false&&g.type!=="hidden"},disabled:function(g){return g.disabled===true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,j,n){return!!p(n[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===
g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toUpperCase()==="BUTTON"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},setFilters:{first:function(g,j){return j===0},last:function(g,j,n,q){return j===q.length-1},even:function(g,j){return j%2===0},odd:function(g,j){return j%2===1},
lt:function(g,j,n){return j<n[3]-0},gt:function(g,j,n){return j>n[3]-0},nth:function(g,j,n){return n[3]-0==j},eq:function(g,j,n){return n[3]-0==j}},filter:{PSEUDO:function(g,j,n,q){var u=j[1],r=m.filters[u];if(r)return r(g,n,j,q);else if(u==="contains")return(g.textContent||g.innerText||"").indexOf(j[3])>=0;else if(u==="not"){j=j[3];n=0;for(q=j.length;n<q;n++)if(j[n]===g)return false;return true}},CHILD:function(g,j){var n=j[1],q=g;switch(n){case "only":case "first":for(;q=q.previousSibling;)if(q.nodeType===
1)return false;if(n=="first")return true;q=g;case "last":for(;q=q.nextSibling;)if(q.nodeType===1)return false;return true;case "nth":n=j[2];var u=j[3];if(n==1&&u==0)return true;j=j[0];var r=g.parentNode;if(r&&(r.sizcache!==j||!g.nodeIndex)){var v=0;for(q=r.firstChild;q;q=q.nextSibling)if(q.nodeType===1)q.nodeIndex=++v;r.sizcache=j}g=g.nodeIndex-u;return n==0?g==0:g%n==0&&g/n>=0}},ID:function(g,j){return g.nodeType===1&&g.getAttribute("id")===j},TAG:function(g,j){return j==="*"&&g.nodeType===1||g.nodeName===
j},CLASS:function(g,j){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(j)>-1},ATTR:function(g,j){var n=j[1];g=m.attrHandle[n]?m.attrHandle[n](g):g[n]!=null?g[n]:g.getAttribute(n);n=g+"";var q=j[2];j=j[4];return g==null?q==="!=":q==="="?n===j:q==="*="?n.indexOf(j)>=0:q==="~="?(" "+n+" ").indexOf(j)>=0:!j?n&&g!==false:q==="!="?n!=j:q==="^="?n.indexOf(j)===0:q==="$="?n.substr(n.length-j.length)===j:q==="|="?n===j||n.substr(0,j.length+1)===j+"-":false},POS:function(g,j,n,q){var u=m.setFilters[j[2]];
if(u)return u(g,n,j,q)}}},t=m.match.POS;for(var w in m.match){m.match[w]=new RegExp(m.match[w].source+/(?![^\[]*\])(?![^\(]*\))/.source);m.leftMatch[w]=new RegExp(/(^(?:.|\r|\n)*?)/.source+m.match[w].source)}var B=function(g,j){g=Array.prototype.slice.call(g,0);if(j){j.push.apply(j,g);return j}return g};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(z){B=function(g,j){j=j||[];if(f.call(g)==="[object Array]")Array.prototype.push.apply(j,g);else if(typeof g.length==="number")for(var n=
0,q=g.length;n<q;n++)j.push(g[n]);else for(n=0;g[n];n++)j.push(g[n]);return j}}var K;if(document.documentElement.compareDocumentPosition)K=function(g,j){if(!g.compareDocumentPosition||!j.compareDocumentPosition){if(g==j)h=true;return 0}g=g.compareDocumentPosition(j)&4?-1:g===j?0:1;if(g===0)h=true;return g};else if("sourceIndex"in document.documentElement)K=function(g,j){if(!g.sourceIndex||!j.sourceIndex){if(g==j)h=true;return 0}g=g.sourceIndex-j.sourceIndex;if(g===0)h=true;return g};else if(document.createRange)K=
function(g,j){if(!g.ownerDocument||!j.ownerDocument){if(g==j)h=true;return 0}var n=g.ownerDocument.createRange(),q=j.ownerDocument.createRange();n.setStart(g,0);n.setEnd(g,0);q.setStart(j,0);q.setEnd(j,0);g=n.compareBoundaryPoints(Range.START_TO_END,q);if(g===0)h=true;return g};(function(){var g=document.createElement("div"),j="script"+(new Date).getTime();g.innerHTML="<a name='"+j+"'/>";var n=document.documentElement;n.insertBefore(g,n.firstChild);if(document.getElementById(j)){m.find.ID=function(q,
u,r){if(typeof u.getElementById!=="undefined"&&!r)return(u=u.getElementById(q[1]))?u.id===q[1]||typeof u.getAttributeNode!=="undefined"&&u.getAttributeNode("id").nodeValue===q[1]?[u]:undefined:[]};m.filter.ID=function(q,u){var r=typeof q.getAttributeNode!=="undefined"&&q.getAttributeNode("id");return q.nodeType===1&&r&&r.nodeValue===u}}n.removeChild(g);n=g=null})();(function(){var g=document.createElement("div");g.appendChild(document.createComment(""));if(g.getElementsByTagName("*").length>0)m.find.TAG=
function(j,n){n=n.getElementsByTagName(j[1]);if(j[1]==="*"){j=[];for(var q=0;n[q];q++)n[q].nodeType===1&&j.push(n[q]);n=j}return n};g.innerHTML="<a href='#'></a>";if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")m.attrHandle.href=function(j){return j.getAttribute("href",2)};g=null})();document.querySelectorAll&&function(){var g=p,j=document.createElement("div");j.innerHTML="<p class='TEST'></p>";if(!(j.querySelectorAll&&j.querySelectorAll(".TEST").length===
0)){p=function(q,u,r,v){u=u||document;if(!v&&u.nodeType===9&&!F(u))try{return B(u.querySelectorAll(q),r)}catch(C){}return g(q,u,r,v)};for(var n in g)p[n]=g[n];j=null}}();document.getElementsByClassName&&document.documentElement.getElementsByClassName&&function(){var g=document.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(g.getElementsByClassName("e").length!==0){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){m.order.splice(1,0,"CLASS");
m.find.CLASS=function(j,n,q){if(typeof n.getElementsByClassName!=="undefined"&&!q)return n.getElementsByClassName(j[1])};g=null}}}();var P=document.compareDocumentPosition?function(g,j){return g.compareDocumentPosition(j)&16}:function(g,j){return g!==j&&(g.contains?g.contains(j):true)},F=function(g){return g.nodeType===9&&g.documentElement.nodeName!=="HTML"||!!g.ownerDocument&&g.ownerDocument.documentElement.nodeName!=="HTML"},I=function(g,j){var n=[],q="",u;for(j=j.nodeType?[j]:j;u=m.match.PSEUDO.exec(g);){q+=
u[0];g=g.replace(m.match.PSEUDO,"")}g=m.relative[g]?g+"*":g;u=0;for(var r=j.length;u<r;u++)p(g,j[u],n);return p.filter(q,n)};window.Sizzle=p})();(function(a){function b(f,h){return e(a(f,h||document))}function c(f,h){return a.matches(h,[f]).length==1}var e=Prototype.Selector.extendElements;Prototype.Selector.engine=a;Prototype.Selector.select=b;Prototype.Selector.match=c})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){if(typeof b!="object")b={hash:!!b};else if(Object.isUndefined(b.hash))b.hash=true;var c,e,f=false,h=b.submit,l;if(b.hash){b={};l=function(p,m,t){if(m in p){Object.isArray(p[m])||(p[m]=[p[m]]);p[m].push(t)}else p[m]=t;return p}}else{b="";l=function(p,m,t){return p+(p?"&":"")+encodeURIComponent(m)+"="+encodeURIComponent(t)}}return a.inject(b,function(p,m){if(!m.disabled&&m.name){c=m.name;e=$(m).getValue();if(e!=null&&
m.type!="file"&&(m.type!="submit"||!f&&h!==false&&(!h||c==h)&&(f=true)))p=l(p,c,e)}return p})}};
Form.Methods={serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){a=$(a).getElementsByTagName("*");for(var b,c=[],e=Form.Element.Serializers,f=0;b=a[f];f++)c.push(b);return c.inject([],function(h,l){e[l.tagName.toLowerCase()]&&h.push(Element.extend(l));return h})},getInputs:function(a,b,c){a=$(a);a=a.getElementsByTagName("input");if(!b&&!c)return $A(a).map(Element.extend);for(var e=0,f=[],h=a.length;e<h;e++){var l=a[e];b&&l.type!=b||c&&l.name!=c||
f.push(Element.extend(l))}return f},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){a=$(a).getElements().findAll(function(c){return"hidden"!=c.type&&!c.disabled});var b=a.findAll(function(c){return c.hasAttribute("tabIndex")&&c.tabIndex>=0}).sortBy(function(c){return c.tabIndex}).first();return b?b:a.find(function(c){return/^(?:input|select|textarea)$/i.test(c.tagName)})},
focusFirstElement:function(a){a=$(a);a.findFirstElement().activate();return a},request:function(a,b){a=$(a);b=Object.clone(b||{});var c=b.parameters,e=a.readAttribute("action")||"";if(e.blank())e=window.location.href;b.parameters=a.serialize(true);if(c){if(Object.isString(c))c=c.toQueryParams();Object.extend(b.parameters,c)}if(a.hasAttribute("method")&&!b.method)b.method=a.method;return new Ajax.Request(e,b)}};
Form.Element={focus:function(a){$(a).focus();return a},select:function(a){$(a).select();return a}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(b!=undefined){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return $(a).value!=""},activate:function(a){a=$(a);try{a.focus();
if(a.select&&(a.tagName.toLowerCase()!="input"||!/^(?:button|reset|submit)$/i.test(a.type)))a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=true;return a},enable:function(a){a=$(a);a.disabled=false;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers={input:function(a,b){switch(a.type.toLowerCase()){case "checkbox":case "radio":return Form.Element.Serializers.inputSelector(a,b);default:return Form.Element.Serializers.textarea(a,b)}},inputSelector:function(a,b){if(Object.isUndefined(b))return a.checked?a.value:null;else a.checked=!!b},textarea:function(a,b){if(Object.isUndefined(b))return a.value;else a.value=b},select:function(a,b){if(Object.isUndefined(b))return this[a.type=="select-one"?"selectOne":"selectMany"](a);
else for(var c,e,f=!Object.isArray(b),h=0,l=a.length;h<l;h++){c=a.options[h];e=this.optionValue(c);if(f){if(e==b){c.selected=true;return}}else c.selected=b.include(e)}},selectOne:function(a){var b=a.selectedIndex;return b>=0?this.optionValue(a.options[b]):null},selectMany:function(a){var b,c=a.length;if(!c)return null;var e=0;for(b=[];e<c;e++){var f=a.options[e];f.selected&&b.push(this.optionValue(f))}return b},optionValue:function(a){return Element.extend(a).hasAttribute("value")?a.value:a.text}};
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,c,e){$super(e,c);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a)){this.callback(this.element,a);this.lastValue=a}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();if(this.lastValue!=a){this.callback(this.element,a);this.lastValue=a}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this));break}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(){function a(o){return j(o,0)}function b(o){return j(o,1)}function c(o){return j(o,2)}function e(o){o=F.extend(o);var y=o.target,D=o.type;if((o=o.currentTarget)&&o.tagName)if(D==="load"||D==="error"||D==="click"&&o.tagName.toLowerCase()==="input"&&o.type==="radio")y=o;if(y.nodeType==Node.TEXT_NODE)y=y.parentNode;return Element.extend(y)}function f(o,y){o=F.element(o);if(!y)return o;for(;o;){if(Object.isElement(o)&&Prototype.Selector.match(o,y))return Element.extend(o);o=o.parentNode}}function h(o){return{x:l(o),
y:p(o)}}function l(o){var y=document.documentElement,D=document.body||{scrollLeft:0};return o.pageX||o.clientX+(y.scrollLeft||D.scrollLeft)-(y.clientLeft||0)}function p(o){var y=document.documentElement,D=document.body||{scrollTop:0};return o.pageY||o.clientY+(y.scrollTop||D.scrollTop)-(y.clientTop||0)}function m(o){F.extend(o);o.preventDefault();o.stopPropagation();o.stopped=true}function t(o,y,D){var Q=Element.retrieve(o,"prototype_event_registry");if(Object.isUndefined(Q)){r.push(o);Q=Element.retrieve(o,
"prototype_event_registry",$H())}var T=Q.get(y);if(Object.isUndefined(T)){T=[];Q.set(y,T)}if(T.pluck("handler").include(D))return false;var G;if(y.include(":"))G=function(L){if(Object.isUndefined(L.eventName))return false;if(L.eventName!==y)return false;F.extend(L,o);D.call(o,L)};else if(!g&&(y==="mouseenter"||y==="mouseleave")){if(y==="mouseenter"||y==="mouseleave")G=function(L){F.extend(L,o);for(var E=L.relatedTarget;E&&E!==o;)try{E=E.parentNode}catch(J){E=o}E!==o&&D.call(o,L)}}else G=function(L){F.extend(L,
o);D.call(o,L)};G.handler=D;T.push(G);return G}function w(){for(var o=0,y=r.length;o<y;o++){F.stopObserving(r[o]);r[o]=null}}function B(o,y,D){o=$(o);D=t(o,y,D);if(!D)return o;if(y.include(":"))if(o.addEventListener)o.addEventListener("dataavailable",D,false);else{o.attachEvent("ondataavailable",D);o.attachEvent("onlosecapture",D)}else{y=v(y);o.addEventListener?o.addEventListener(y,D,false):o.attachEvent("on"+y,D)}return o}function z(o,y,D){o=$(o);var Q=Element.retrieve(o,"prototype_event_registry");
if(!Q)return o;if(!y){Q.each(function(E){z(o,E.key)});return o}var T=Q.get(y);if(!T)return o;if(!D){T.each(function(E){z(o,y,E.handler)});return o}var G=T.find(function(E){return E.handler===D});if(!G)return o;if(y.include(":"))if(o.removeEventListener)o.removeEventListener("dataavailable",G,false);else{o.detachEvent("ondataavailable",G);o.detachEvent("onlosecapture",G)}else{var L=v(y);o.removeEventListener?o.removeEventListener(L,G,false):o.detachEvent("on"+L,G)}Q.set(y,T.without(G));return o}function K(o,
y,D,Q){o=$(o);if(Object.isUndefined(Q))Q=true;if(o==document&&document.createEvent&&!o.dispatchEvent)o=document.documentElement;var T;if(document.createEvent){T=document.createEvent("HTMLEvents");T.initEvent("dataavailable",Q,true)}else{T=document.createEventObject();T.eventType=Q?"ondataavailable":"onlosecapture"}T.eventName=y;T.memo=D||{};document.createEvent?o.dispatchEvent(T):o.fireEvent(T.eventType,T);return F.extend(T)}function P(o,y,D,Q){o=$(o);if(Object.isFunction(D)&&Object.isUndefined(Q)){Q=
D;D=null}return(new F.Handler(o,y,D,Q)).start()}var F={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}},I=document.documentElement,g="onmouseenter"in I&&"onmouseleave"in I;I=window.attachEvent&&!window.addEventListener;var j;if(I){var n={0:1,1:4,2:2};j=function(o,y){return o.button===n[y]}}else j=Prototype.Browser.WebKit?function(o,y){switch(y){case 0:return o.which==
1&&!o.metaKey;case 1:return o.which==1&&o.metaKey;default:return false}}:function(o,y){return o.which?o.which===y+1:o.button===y};F.Methods={isLeftClick:a,isMiddleClick:b,isRightClick:c,element:e,findElement:f,pointer:h,pointerX:l,pointerY:p,stop:m};var q=Object.keys(F.Methods).inject({},function(o,y){o[y]=F.Methods[y].methodize();return o});if(I){var u=function(o){switch(o.type){case "mouseover":o=o.fromElement;break;case "mouseout":o=o.toElement;break;default:return null}return Element.extend(o)};
Object.extend(q,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}});F.extend=function(o,y){if(!o)return false;if(o._extendedByPrototype)return o;o._extendedByPrototype=Prototype.emptyFunction;var D=F.pointer(o);Object.extend(o,{target:o.srcElement||y,relatedTarget:u(o),pageX:D.x,pageY:D.y});return Object.extend(o,q)}}else{F.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(F.prototype,
q);F.extend=Prototype.K}var r=[];Prototype.Browser.IE&&window.attachEvent("onunload",w);Prototype.Browser.WebKit&&window.addEventListener("unload",Prototype.emptyFunction,false);var v=Prototype.K,C={mouseenter:"mouseover",mouseleave:"mouseout"};g||(v=function(o){return C[o]||o});F.Handler=Class.create({initialize:function(o,y,D,Q){this.element=$(o);this.eventName=y;this.selector=D;this.callback=Q;this.handler=this.handleEvent.bind(this)},start:function(){F.observe(this.element,this.eventName,this.handler);
return this},stop:function(){F.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(o){var y=o.findElement(this.selector);y&&this.callback.call(this.element,o,y)}});Object.extend(F,F.Methods);Object.extend(F,{fire:K,observe:B,stopObserving:z,on:P});Element.addMethods({fire:K,observe:B,stopObserving:z,on:P});Object.extend(document,{fire:K.methodize(),observe:B.methodize(),stopObserving:z.methodize(),on:P.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,
F);else window.Event=F})();
(function(){function a(){if(!document.loaded){e&&window.clearTimeout(e);document.loaded=true;document.fire("dom:loaded")}}function b(){if(document.readyState==="complete"){document.stopObserving("readystatechange",b);a()}}function c(){try{document.documentElement.doScroll("left")}catch(f){e=c.defer();return}a()}var e;if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,false);else{document.observe("readystatechange",b);if(window==top)e=c.defer()}Event.observe(window,"load",
a)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||
document.documentElement.scrollTop||document.body.scrollTop||0},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=Element.cumulativeOffset(a);return c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,c){var e=Element.cumulativeScrollOffset(a);this.xcomp=b+e[0]-this.deltaX;this.ycomp=c+e[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);
return this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},
relativize:function(a){Position.prepare();return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,c){c=c||{};return Element.clonePosition(b,a,c)}};
if(!document.getElementsByClassName)document.getElementsByClassName=function(a){function b(c){return c.blank()?null:"[contains(concat(' ', @class, ' '), ' "+c+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(c,e){e=e.toString().strip();return(e=/\s/.test(e)?$w(e).map(b).join(""):b(e))?document._getElementsByXPath(".//*"+e,c):[]}:function(c,e){e=e.toString().strip();var f=[],h=/\s/.test(e)?$w(e):null;if(!h&&!e)return f;c=$(c).getElementsByTagName("*");e=" "+e+" ";for(var l=
0,p,m;p=c[l];l++)if(p.className&&(m=" "+p.className+" ")&&(m.include(e)||h&&h.all(function(t){return!t.toString().blank()&&m.include(" "+t+" ")})))f.push(Element.extend(p));return f};return function(c,e){return $(e||document.body).getElementsByClassName(c)}}(Element.Methods);Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(b){return b.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(a,b){for(var c=Prototype.Selector.match,e=[],f=0,h=a.length;f<h;f++){var l=a[f];c(l,b)&&e.push(Element.extend(l))}return e},
findElement:function(a,b,c){c=c||0;for(var e=0,f,h=0,l=a.length;h<l;h++){f=a[h];if(Prototype.Selector.match(f,b)&&c===e++)return Element.extend(f)}},findChildElements:function(a,b){b=b.toArray().join(", ");return Prototype.Selector.select(b,a||document)}})})();String.prototype.parseColor=function(a){var b="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(","),e=0;do b+=parseInt(c[e]).toColorPart();while(++e<3)}else if(this.slice(0,1)=="#"){if(this.length==4)for(e=1;e<4;e++)b+=(this.charAt(e)+this.charAt(e)).toLowerCase();if(this.length==7)b=this.toLowerCase()}return b.length==7?b:a||this};
Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return b.nodeType==3?b.nodeValue:b.hasChildNodes()?Element.collectTextNodes(b):""}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return c.nodeType==3?c.nodeValue:c.hasChildNodes()&&!Element.hasClassName(c,b)?Element.collectTextNodesIgnoreClass(c,b):""}).flatten().join("")};
Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:b/100+"em"});Prototype.Browser.WebKit&&window.scrollBy(0,0);return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var b=document.createTextNode(" ");a.appendChild(b);a.removeChild(b)}catch(c){}};
var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return-Math.cos(a*Math.PI)/2+0.5},reverse:function(a){return 1-a},flicker:function(a){a=-Math.cos(a*Math.PI)/4+0.75+Math.random()/4;return a>1?1:a},wobble:function(a){return-Math.cos(a*Math.PI*9*a)/2+0.5},pulse:function(a,b){return-Math.cos(a*((b||5)-0.5)*2*Math.PI)/2+0.5},spring:function(a){return 1-
Math.cos(a*4.5*Math.PI)*Math.exp(-a*6)},none:function(){return 0},full:function(){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE)b+=";zoom:1";a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(e){a.insertBefore((new Element("span",{style:b})).update(e==" "?String.fromCharCode(160):e),c)});Element.remove(c)}})},multiple:function(a,b,c){a=
(typeof a=="object"||Object.isFunction(a))&&a.length?a:$(a).childNodes;var e=Object.extend({speed:0.1,delay:0},c||{}),f=e.delay;$A(a).each(function(h,l){new b(h,Object.extend(e,{delay:l*e.speed+f}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(a,b,c){a=$(a);b=(b||"appear").toLowerCase();c=Object.extend({queue:{position:"end",scope:a.id||"global",limit:1}},c||{});Effect[a.visible()?Effect.PAIRS[b][1]:Effect.PAIRS[b][0]](a,c)}};
Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;
Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(a){var b=(new Date).getTime();switch(Object.isString(a.options.queue)?a.options.queue:a.options.queue.position){case "front":this.effects.findAll(function(c){return c.state=="idle"}).each(function(c){c.startOn+=a.finishOn;c.finishOn+=a.finishOn});break;case "with-last":b=this.effects.pluck("startOn").max()||b;break;case "end":b=this.effects.pluck("finishOn").max()||
b;break}a.startOn+=b;a.finishOn+=b;if(!a.options.queue.limit||this.effects.length<a.options.queue.limit)this.effects.push(a);if(!this.interval)this.interval=setInterval(this.loop.bind(this),15)},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){for(var a=(new Date).getTime(),b=0,c=this.effects.length;b<c;b++)this.effects[b]&&this.effects[b].loop(a)}});
Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a))return a;return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue)}};Effect.Queue=Effect.Queues.get("global");
Effect.Base=Class.create({position:null,start:function(a){if(a&&a.transition===false)a.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),a||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1E3;this.finishOn=this.startOn+this.options.duration*1E3;this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=function(){function b(c,
e){c.options[e+"Internal"]&&c.options[e+"Internal"](c);c.options[e]&&c.options[e](c)}return function(c){if(this.state==="idle"){this.state="running";b(this,"beforeSetup");this.setup&&this.setup();b(this,"afterSetup")}if(this.state==="running"){this.position=c=this.options.transition(c)*this.fromToDelta+this.options.from;b(this,"beforeUpdate");this.update&&this.update(c);b(this,"afterUpdate")}}}();this.event("beforeStart");this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":
this.options.queue.scope).add(this)},loop:function(a){if(a>=this.startOn)if(a>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");this.finish&&this.finish();this.event("afterFinish")}else{a=(a-this.startOn)/this.totalTime;var b=(a*this.totalFrames).round();if(b>this.currentFrame){this.render(a);this.currentFrame=b}}},cancel:function(){this.options.sync||Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);this.state="finished"},
event:function(a){this.options[a+"Internal"]&&this.options[a+"Internal"](this);this.options[a]&&this.options[a](this)},inspect:function(){var a=$H();for(property in this)Object.isFunction(this[property])||a.set(property,this[property]);return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});
Effect.Parallel=Class.create(Effect.Base,{initialize:function(a,b){this.effects=a||[];this.start(b)},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");b.finish&&b.finish(a);b.event("afterFinish")})}});
Effect.Tween=Class.create(Effect.Base,{initialize:function(a,b,c){a=Object.isString(a)?$(a):a;var e=$A(arguments),f=e.last();e=e.length==5?e[3]:null;this.method=Object.isFunction(f)?f.bind(a):Object.isFunction(a[f])?a[f].bind(a):function(h){a[f]=h};this.start(Object.extend({from:b,to:c},e||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(a){this.start(Object.extend({duration:0},a||{}))},update:Prototype.emptyFunction});
Effect.Opacity=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&this.element.setStyle({zoom:1});this.start(Object.extend({from:this.element.getOpacity()||0,to:1},b||{}))},update:function(a){this.element.setOpacity(a)}});
Effect.Move=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({x:0,y:0,mode:"relative"},b||{}))},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*
a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(a,b,c,e){return new Effect.Move(a,Object.extend({x:c,y:b},e||{}))};
Effect.Scale=Class.create(Effect.Base,{initialize:function(a,b,c){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:b},c||{}))},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=
this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box")this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))this.dims=
[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]},update:function(a){a=this.options.scaleFrom/100+this.factor*a;this.options.scaleContent&&this.fontSize&&this.element.setStyle({fontSize:this.fontSize*a+this.fontSizeType});this.setDimensions(this.dims[0]*a,this.dims[1]*a)},finish:function(){this.restoreAfterFinish&&this.element.setStyle(this.originalStyle)},setDimensions:function(a,b){var c={};
if(this.options.scaleX)c.width=b.round()+"px";if(this.options.scaleY)c.height=a.round()+"px";if(this.options.scaleFromCenter){a=(a-this.dims[0])/2;b=(b-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY)c.top=this.originalTop-a+"px";if(this.options.scaleX)c.left=this.originalLeft-b+"px"}else{if(this.options.scaleY)c.top=-a+"px";if(this.options.scaleX)c.left=-b+"px"}}this.element.setStyle(c)}});
Effect.Highlight=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;this.start(Object.extend({startcolor:"#fffae2"},b||{}))},setup:function(){if(this.element.getStyle("display")=="none")this.cancel();else{this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor)this.options.endcolor=
this.element.getStyle("background-color").parseColor("#ffffff");if(!this.options.restorecolor)this.options.restorecolor=this.element.getStyle("background-color");this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))}},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,e){return b+
(this._base[e]+this._delta[e]*a).round().toColorPart()}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(a,b){b=b||{};var c=document.viewport.getScrollOffsets();a=$(a).cumulativeOffset();if(b.offset)a[1]+=b.offset;return new Effect.Tween(null,c.top,a[1],b,function(e){scrollTo(c.left,e.round())})};
Effect.Fade=function(a,b){a=$(a);var c=a.getInlineOpacity();b=Object.extend({from:a.getOpacity()||1,to:0,afterFinishInternal:function(e){e.options.to==0&&e.element.hide().setStyle({opacity:c})}},b||{});return new Effect.Opacity(a,b)};
Effect.Appear=function(a,b){a=$(a);b=Object.extend({from:a.getStyle("display")=="none"?0:a.getOpacity()||0,to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},b||{});return new Effect.Opacity(a,b)};
Effect.Puff=function(a,b){a=$(a);var c={opacity:a.getInlineOpacity(),position:a.getStyle("position"),top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};return new Effect.Parallel([new Effect.Scale(a,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(e){Position.absolutize(e.effects[0].element)},afterFinishInternal:function(e){e.effects[0].element.hide().setStyle(c)}},
b||{}))};Effect.BlindUp=function(a,b){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(c){c.element.hide().undoClipping()}},b||{}))};
Effect.BlindDown=function(a,b){a=$(a);var c=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:c.height,originalWidth:c.width},restoreAfterFinish:true,afterSetup:function(e){e.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(e){e.element.undoClipping()}},b||{}))};
Effect.SwitchOff=function(a,b){a=$(a);var c=a.getInlineOpacity();return new Effect.Appear(a,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(e){new Effect.Scale(e.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(f){f.element.makePositioned().makeClipping()},afterFinishInternal:function(f){f.element.hide().undoClipping().undoPositioned().setStyle({opacity:c})}})}},b||{}))};
Effect.DropOut=function(a,b){a=$(a);var c={top:a.getStyle("top"),left:a.getStyle("left"),opacity:a.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(a,{x:0,y:100,sync:true}),new Effect.Opacity(a,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(e){e.effects[0].element.makePositioned()},afterFinishInternal:function(e){e.effects[0].element.hide().undoPositioned().setStyle(c)}},b||{}))};
Effect.Shake=function(a,b){a=$(a);b=Object.extend({distance:20,duration:0.5},b||{});var c=parseFloat(b.distance),e=parseFloat(b.duration)/10,f={top:a.getStyle("top"),left:a.getStyle("left")};return new Effect.Move(a,{x:c,y:0,duration:e,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-c*2,y:0,duration:e*2,afterFinishInternal:function(l){new Effect.Move(l.element,{x:c*2,y:0,duration:e*2,afterFinishInternal:function(p){new Effect.Move(p.element,{x:-c*2,y:0,duration:e*2,afterFinishInternal:function(m){new Effect.Move(m.element,
{x:c*2,y:0,duration:e*2,afterFinishInternal:function(t){new Effect.Move(t.element,{x:-c,y:0,duration:e,afterFinishInternal:function(w){w.element.undoPositioned().setStyle(f)}})}})}})}})}})}})};
Effect.SlideDown=function(a,b){a=$(a).cleanWhitespace();var c=a.down().getStyle("bottom"),e=a.getDimensions();return new Effect.Scale(a,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:e.height,originalWidth:e.width},restoreAfterFinish:true,afterSetup:function(f){f.element.makePositioned();f.element.down().makePositioned();window.opera&&f.element.setStyle({top:""});f.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(f){f.element.down().setStyle({bottom:f.dims[0]-
f.element.clientHeight+"px"})},afterFinishInternal:function(f){f.element.undoClipping().undoPositioned();f.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};
Effect.SlideUp=function(a,b){a=$(a).cleanWhitespace();var c=a.down().getStyle("bottom"),e=a.getDimensions();return new Effect.Scale(a,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:e.height,originalWidth:e.width},restoreAfterFinish:true,afterSetup:function(f){f.element.makePositioned();f.element.down().makePositioned();window.opera&&f.element.setStyle({top:""});f.element.makeClipping().show()},afterUpdateInternal:function(f){f.element.down().setStyle({bottom:f.dims[0]-
f.element.clientHeight+"px"})},afterFinishInternal:function(f){f.element.hide().undoClipping().undoPositioned();f.element.down().undoPositioned().setStyle({bottom:c})}},b||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};
Effect.Grow=function(a,b){a=$(a);var c=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},b||{}),e={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},f=a.getDimensions(),h,l,p,m;switch(c.direction){case "top-left":h=l=p=m=0;break;case "top-right":h=f.width;l=m=0;p=-f.width;break;case "bottom-left":h=p=0;l=f.height;m=-f.height;break;
case "bottom-right":h=f.width;l=f.height;p=-f.width;m=-f.height;break;case "center":h=f.width/2;l=f.height/2;p=-f.width/2;m=-f.height/2;break}return new Effect.Move(a,{x:h,y:l,duration:0.01,beforeSetup:function(t){t.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(t){new Effect.Parallel([new Effect.Opacity(t.element,{sync:true,to:1,from:0,transition:c.opacityTransition}),new Effect.Move(t.element,{x:p,y:m,sync:true,transition:c.moveTransition}),new Effect.Scale(t.element,
100,{scaleMode:{originalHeight:f.height,originalWidth:f.width},sync:true,scaleFrom:window.opera?1:0,transition:c.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(w){w.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(w){w.effects[0].element.undoClipping().undoPositioned().setStyle(e)}},c))}})};
Effect.Shrink=function(a,b){a=$(a);b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},b||{});var c={top:a.style.top,left:a.style.left,height:a.style.height,width:a.style.width,opacity:a.getInlineOpacity()},e=a.getDimensions(),f,h;switch(b.direction){case "top-left":f=h=0;break;case "top-right":f=e.width;h=0;break;case "bottom-left":f=0;h=e.height;break;case "bottom-right":f=e.width;h=
e.height;break;case "center":f=e.width/2;h=e.height/2;break}return new Effect.Parallel([new Effect.Opacity(a,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(a,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(a,{x:f,y:h,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(l){l.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(l){l.effects[0].element.hide().undoClipping().undoPositioned().setStyle(c)}},
b))};Effect.Pulsate=function(a,b){a=$(a);var c=b||{},e=a.getInlineOpacity(),f=c.transition||Effect.Transitions.linear;return new Effect.Opacity(a,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(h){h.element.setStyle({opacity:e})}},c),{transition:function(h){return 1-f(-Math.cos(h*(c.pulses||5)*2*Math.PI)/2+0.5)}}))};
Effect.Fold=function(a,b){a=$(a);var c={top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height};a.makeClipping();return new Effect.Scale(a,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(){new Effect.Scale(a,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(e){e.element.hide().undoClipping().setStyle(c)}})}},b||{}))};
Effect.Morph=Class.create(Effect.Base,{initialize:function(a,b){this.element=$(a);if(!this.element)throw Effect._elementDoesNotExistError;a=Object.extend({style:{}},b||{});if(Object.isString(a.style))if(a.style.include(":"))this.style=a.style.parseStyle();else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var c=this.element.getStyles();this.style=this.style.reject(function(e){return e.value==c[e.key]});a.afterFinishInternal=function(e){e.element.addClassName(e.options.style);
e.transforms.each(function(f){e.element.style[f.style]=""})}}else this.style=$H(a.style);this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b))b="#ffffff";b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(b){var c=b[0];b=b[1];var e=null;if(b.parseColor("#zzzzzz")!="#zzzzzz"){b=b.parseColor();e="color"}else if(c=="opacity"){b=parseFloat(b);Prototype.Browser.IE&&!this.element.currentStyle.hasLayout&&
this.element.setStyle({zoom:1})}else if(Element.CSS_LENGTH.test(b)){e=b.match(/^([\+\-]?[0-9\.]+)(.*)$/);b=parseFloat(e[1]);e=e.length==3?e[2]:null}var f=this.element.getStyle(c);return{style:c.camelize(),originalValue:e=="color"?a(f):parseFloat(f||0),targetValue:e=="color"?a(b):b,unit:e}}.bind(this)).reject(function(b){return b.originalValue==b.targetValue||b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))})},update:function(a){for(var b={},c,e=this.transforms.length;e--;)b[(c=this.transforms[e]).style]=
c.unit=="color"?"#"+Math.round(c.originalValue[0]+(c.targetValue[0]-c.originalValue[0])*a).toColorPart()+Math.round(c.originalValue[1]+(c.targetValue[1]-c.originalValue[1])*a).toColorPart()+Math.round(c.originalValue[2]+(c.targetValue[2]-c.originalValue[2])*a).toColorPart():(c.originalValue+(c.targetValue-c.originalValue)*a).toFixed(3)+(c.unit===null?"":c.unit);this.element.setStyle(b,true)}});
Effect.Transform=Class.create({initialize:function(a,b){this.tracks=[];this.options=b||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var b=a.get("ids"),c=a.get("effect"),e=a.get("options");return[$(b)||$$(b)].flatten().map(function(f){return new c(f,Object.extend({sync:true},
e))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");
Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");
String.prototype.parseStyle=function(){var a,b=$H();if(Prototype.Browser.WebKit)a=(new Element("div",{style:this})).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';a=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){a[c]&&b.set(c,a[c])});Prototype.Browser.IE&&this.include("opacity")&&b.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return b};
Element.getStyles=document.defaultView&&document.defaultView.getComputedStyle?function(a){var b=document.defaultView.getComputedStyle($(a),null);return Element.CSS_PROPERTIES.inject({},function(c,e){c[e]=b[e];return c})}:function(a){a=$(a);var b=a.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(e,f){e[f]=b[f];return e});if(!c.opacity)c.opacity=a.getOpacity();return c};
Effect.Methods={morph:function(a,b,c){a=$(a);new Effect.Morph(a,Object.extend({style:b},c||{}));return a},visualEffect:function(a,b,c){a=$(a);b=b.dasherize().camelize();b=b.charAt(0).toUpperCase()+b.substring(1);new Effect[b](a,c);return a},highlight:function(a,b){a=$(a);new Effect.Highlight(a,b);return a}};
$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(b,c){b=$(b);Effect[a.charAt(0).toUpperCase()+a.substring(1)](b,c);return b}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined")throw"controls.js requires including script.aculo.us' effects.js library";var Autocompleter={};
Autocompleter.Base=Class.create({baseInitialize:function(a,b,c){this.element=a=$(a);this.update=$(b);this.active=this.changed=this.hasFocus=false;this.entryCount=this.index=0;this.oldElementValue=this.element.value;if(this.setOptions)this.setOptions(c);else this.options=c||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=
this.options.onShow||function(e,f){if(!f.style.position||f.style.position=="absolute"){f.style.position="absolute";Position.clone(e,f,{setHeight:false,offsetTop:e.offsetHeight})}Effect.Appear(f,{duration:0.15})};this.options.onHide=this.options.onHide||function(e,f){new Effect.Fade(f,{duration:0.15})};if(typeof this.options.tokens=="string")this.options.tokens=new Array(this.options.tokens);this.options.tokens.include("\n")||this.options.tokens.push("\n");this.observer=null;this.element.setAttribute("autocomplete",
"off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){Element.getStyle(this.update,"display")=="none"&&this.options.onShow(this.element,this.update);if(!this.iefix&&Prototype.Browser.IE&&Element.getStyle(this.update,"position")=="absolute"){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');
this.iefix=$(this.update.id+"_iefix")}this.iefix&&setTimeout(this.fixIEOverlapping.bind(this),50)},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:!this.update.style.height});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();Element.getStyle(this.update,"display")!="none"&&this.options.onHide(this.element,this.update);this.iefix&&Element.hide(this.iefix)},startIndicator:function(){this.options.indicator&&Element.show(this.options.indicator)},
stopIndicator:function(){this.options.indicator&&Element.hide(this.options.indicator)},onKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(a);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(a);return}else if(a.keyCode==Event.KEY_TAB||
a.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&a.keyCode==0)return;this.hasFocus=this.changed=true;this.observer&&clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1E3)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(a){var b=Event.findElement(a,"LI");if(this.index!=b.autocompleteIndex){this.index=b.autocompleteIndex;this.render()}Event.stop(a)},onClick:function(a){this.index=
Event.findElement(a,"LI").autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(){setTimeout(this.hide.bind(this),250);this.active=this.hasFocus=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++)this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected");if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0)this.index--;else this.index=
this.entryCount-1;this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1)this.index++;else this.index=0;this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(a){if(this.options.updateElement)this.options.updateElement(a);else{var b=
"";if(this.options.select){var c=$(a).select("."+this.options.select)||[];if(c.length>0)b=Element.collectTextNodes(c[0],this.options.select)}else b=Element.collectTextNodesIgnoreClass(a,"informal");c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]),f=this.element.value.substr(c[0]).match(/^\s+/);if(f)e+=f[0];this.element.value=e+b+this.element.value.substr(c[1])}else this.element.value=b;this.oldElementValue=this.element.value;this.element.focus();this.options.afterUpdateElement&&
this.options.afterUpdateElement(this.element,a)}},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else this.entryCount=0;this.stopIndicator();this.index=0;if(this.entryCount==1&&
this.options.autoSelect){this.selectEntry();this.hide()}else this.render()}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars)this.getUpdatedChoices();else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();
return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var a=this.element.value;if(a.strip().empty())return[-1,0];for(var b=arguments.callee.getFirstDifferencePos(a,this.oldElementValue),c=b==this.oldElementValue.length?1:0,e=-1,f=a.length,h,l=0,p=this.options.tokens.length;l<p;++l){h=a.lastIndexOf(this.options.tokens[l],b+c-1);if(h>e)e=h;h=a.indexOf(this.options.tokens[l],b+c);if(-1!=h&&h<f)f=h}return this.tokenBounds=[e+
1,f]}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(a,b){for(var c=Math.min(a.length,b.length),e=0;e<c;++e)if(a[e]!=b[e])return e;return c};
Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(a,b,c,e){this.baseInitialize(a,b,e);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=c},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams)this.options.parameters+=
"&"+this.options.defaultParams;new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});
Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(a,b,c,e){this.baseInitialize(a,b,e);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){for(var c=[],e=[],f=b.getToken(),h=0;h<b.options.array.length&&c.length<b.options.choices;h++)for(var l=b.options.array[h],p=b.options.ignoreCase?
l.toLowerCase().indexOf(f.toLowerCase()):l.indexOf(f);p!=-1;){if(p==0&&l.length!=f.length){c.push("<li><strong>"+l.substr(0,f.length)+"</strong>"+l.substr(f.length)+"</li>");break}else if(f.length>=b.options.partialChars&&b.options.partialSearch&&p!=-1)if(b.options.fullSearch||/\s/.test(l.substr(p-1,1))){e.push("<li>"+l.substr(0,p)+"<strong>"+l.substr(p,f.length)+"</strong>"+l.substr(p+f.length)+"</li>");break}p=b.options.ignoreCase?l.toLowerCase().indexOf(f.toLowerCase(),p+1):l.indexOf(f,p+1)}if(e.length)c=
c.concat(e.slice(0,b.options.choices-c.length));return"<ul>"+c.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};
Ajax.InPlaceEditor=Class.create({initialize:function(a,b,c){this.url=b;this.element=a=$(a);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(c);Object.extend(this.options,c||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId))this.options.formId=""}if(this.options.externalControl)this.options.externalControl=$(this.options.externalControl);if(!this.options.externalControl)this.options.externalControlOnly=
false;this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!(!this._editing||
a.ctrlKey||a.altKey||a.shiftKey))if(Event.KEY_ESC==a.keyCode)this.handleFormCancellation(a);else Event.KEY_RETURN==a.keyCode&&this.handleFormSubmission(a)},createControl:function(a,b,c){var e=this.options[a+"Control"];b=this.options[a+"Text"];if("button"==e){c=document.createElement("input");c.type="submit";c.value=b;c.className="editor_"+a+"_button";if("cancel"==a)c.onclick=this._boundCancelHandler;this._form.appendChild(c);this._controls[a]=c}else if("link"==e){e=document.createElement("a");e.href=
"#";e.appendChild(document.createTextNode(b));e.onclick="cancel"==a?this._boundCancelHandler:this._boundSubmitHandler;e.className="editor_"+a+"_link";if(c)e.className+=" "+c;this._form.appendChild(e);this._controls[a]=e}},createEditField:function(){var a=this.options.loadTextURL?this.options.loadingText:this.getText(),b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var c=this.options.size||this.options.cols||0;if(0<c)b.size=c}else{b=document.createElement("textarea");
b.rows=1>=this.options.rows?this.options.autoRows:this.options.rows;b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=a;b.className="editor_field";if(this.options.submitOnBlur)b.onblur=this._boundSubmitHandler;this._controls.editor=b;this.options.loadTextURL&&this.loadExternalText();this._form.appendChild(this._controls.editor)},createForm:function(){function a(c,e){c=b.options["text"+c+"Controls"];!c||e===false||b._form.appendChild(document.createTextNode(c))}var b=this;this._form=
$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();"textarea"==this._controls.editor.tagName.toLowerCase()&&this._form.appendChild(document.createElement("br"));this.options.onFormCustomization&&this.options.onFormCustomization(this,this._form);a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",
this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML)this.element.innerHTML=this._oldInnerHTML;this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(!(this._saving||this._editing)){this._editing=true;this.triggerCallback("onEnterEditMode");this.options.externalControl&&this.options.externalControl.hide();
this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);this.options.loadTextURL||this.postProcessEditField();a&&Event.stop(a)}},enterHover:function(){this.options.hoverClassName&&this.element.addClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=
this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();a&&Event.stop(a)},handleFormSubmission:function(a){var b=this._form,c=$F(this._controls.editor);this.prepareSubmission();b=this.options.callback(b,c)||"";if(Object.isString(b))b=b.toQueryParams();b.editorId=this.element.id;if(this.options.htmlResponse){c=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});
new Ajax.Updater({success:this.element},this.url,c)}else{c=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(c,{parameters:b,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,c)}a&&Event.stop(a)},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();this.options.externalControl&&this.options.externalControl.show();
this._editing=this._saving=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(){this.options.hoverClassName&&this.element.removeClassName(this.options.hoverClassName);this._saving||this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),
onComplete:Prototype.emptyFunction,onSuccess:function(b){this._form.removeClassName(this.options.loadingClassName);b=b.responseText;if(this.options.stripLoadedTextTags)b=b.stripTags();this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a)$(this._controls.editor)["focus"==a?"focus":"activate"]()},
prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=
a;this.options.externalControlOnly||this.element.observe(b.key,a);this.options.externalControl&&this.options.externalControl.observe(b.key,a)}.bind(this))},removeForm:function(){if(this._form){this._form.remove();this._form=null;this._controls={}}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(a,
b){"function"==typeof this.options[a]&&this.options[a](this,b)},unregisterListeners:function(){$H(this._listeners).each(function(a){this.options.externalControlOnly||this.element.stopObserving(a.key,a.value);this.options.externalControl&&this.options.externalControl.stopObserving(a.key,a.value)}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});
Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,b,c,e){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(b,c,e)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];this.options.loadCollectionURL?this.loadCollection():this.checkForExternalText();this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);
this.showLoadingText(this.options.loadingCollectionText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){b=b.responseText.strip();if(!/^\[.*\]$/.test(b))throw"Server returned an invalid collection representation.";this._collection=eval(b);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,a)},
showLoadingText:function(a){this._controls.editor.disabled=true;var b=this._controls.editor.firstChild;if(!b){b=document.createElement("option");b.value="";this._controls.editor.appendChild(b);b.selected=true}b.update((a||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();this.options.loadTextURL?this.loadExternalText():this.buildOptionList()},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);
Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(e){return 2===e.length?e:[e,e].flatten()});var a="value"in this.options?this.options.value:this._text,
b=this._collection.any(function(e){return e[0]==a}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,f){c=document.createElement("option");c.value=e[0];c.selected=b?e[0]==a:0==f;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});
Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){function b(c,e){c in a||e===undefined||(a[c]=e)}if(a){b("cancelControl",a.cancelLink?"link":a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined);b("okControl",a.okLink?"link":a.okButton?"button":a.okLink==a.okButton==false?false:undefined);b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)}};
Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",
savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(a,b){new Effect.Highlight(b,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;a._effect&&a._effect.cancel()},onFailure:function(a){alert("Error communication with the server: "+
a.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};
Form.Element.DelayedObserver=Class.create({initialize:function(a,b,c){this.delay=b||0.5;this.element=$(a);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(){if(this.lastValue!=$F(this.element)){this.timer&&clearTimeout(this.timer);this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1E3);this.lastValue=$F(this.element)}},onTimerEvent:function(){this.timer=null;this.callback(this.element,
$F(this.element))}});var RFC822SingleEmailRegex=/^(?:[^\x00-\x2a\x2c\x2e\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\xff]+|\x22(?:[^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(?:\x2e(?:[^\x00-\x2a\x2c\x2e\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\xff]+|\x22(?:[^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40(?:[^\x00-\x2a\x2c\x2e\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\xff]+|\x5b(?:[^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(?:\x2e(?:[^\x00-\x2a\x2c\x2e\x2f\x3a-\x40\x5b-\x5e\x60\x7b-\xff]+|\x5b(?:[^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))+$/;
if(!document.onunload)document.onunload=function(){};function makeDynamicFrameTarget(a){var b="dynamic_frame_"+ +new Date,c=(new Element("iframe",{name:b})).setStyle({display:"none"});$(document.body).insert(c);a.target=b}function makeDynamicFrameTargetForUrl(a){a=(new Element("form",{action:a,method:"post"})).setStyle({display:"none"});$(document.body).insert(a);makeDynamicFrameTarget(a);return a}var lastFacebookStatus="unknown";
function requestAdditionalPermissions(){disableFacebookButtons();FB.login(function(a){FacebookApiLoader.updateLoginStatus();setTimeout(function(){window.location.reload()},2E3)},{scope:"email, user_birthday, publish_actions"})}function disableFacebookButtons(){$$("a.sprite_facebook").each(function(a){var b;a.hide();if(!a.next(".spinner")){b=a.hasClassName("no_inverse");a.insert({after:'<span class="spinner facebook_spinner'+(b?"":" spinner_inverse")+'">loading&hellip;</span>'})}})}
function reenableFacebookButtons(){$$("a.sprite_facebook").each(function(a){a.show();a.next(".spinner").remove()})}
function showFacebookErrorLightbox(){var a,b;if(active_user.isAuthenticated())a='<h1 class="phl">There\'s been an error!</h1><p class="regtext mhl mvm">The connection with Facebook\'s servers has timed out. Please refresh your page and try the linking process again.</p>';else{a='<h1 class="phl">There\'s been an error!</h1><p class="regtext mhl mvm">We were unable to create a Kongregate account with Facebook.</p><p class="regtext mhl mvm">Click on "Create My Account" below to create a Kongregate account using your email address instead.</p><a id="error_signup_link" href="#" class="submission_button mhl mvm">Create My Account</a>';b=
function(){$("error_signup_link").observe("click",function(e){e.preventDefault();try{lightbox.prototype.shutdown()}catch(f){}lightbox.prototype.initializeKongregateLightboxFromAjax("/accounts/new/behind_login?no_facebook_connect=true&game_id="+active_user.gameId(),{afterStaticContentLoad:function(){lightbox.prototype.toggleRegistration();$("lightbox_email_register").show();$("lightbox_facebook_register").hide();$("lightbox").removeClassName("lightbox_login")}})})}}try{lightbox.prototype.shutdown()}catch(c){}lightbox.prototype.initializeKongregateLightboxFromContent(a,
{done_class_name:"lightbox_login",afterStaticContentLoad:b});reenableFacebookButtons()}function showMatchingUserForm(a,b,c){a="/facebook_connection/login_lightbox?username="+a+"&matched_on="+b;if(active_user.gameId())a+="&game_id="+active_user.gameId();try{lightbox.prototype.shutdown()}catch(e){}lightbox.prototype.initializeKongregateLightboxFromAjax(a,{done_class_name:"lightbox_login"})}function write_to_document(a){document.write(a)}
function toggleTabs(a,b){Element.show(a);Element.show(a+"_title");Element.show(b+"_link");Element.hide(b);Element.hide(b+"_title");Element.hide(a+"_link");$(a+"_tab").className="tab current";$(b+"_tab").className="tab"}
var TopicForm={editNewTitle:function(a){$("new_topic").innerHTML=a.value.length>5?a.value:"New Topic"}},EditForm={init:function(a){$("edit-post-"+a+"_spinner").show();this.clearReplyId()},setReplyId:function(a){$("edit").setAttribute("post_id",a.toString());$("posts-"+a+"-row").addClassName("editing");$("reply")&&$("reply").hide()},clearReplyId:function(){var a=this.currentReplyId();if(!(!a||a==="")){(a=$("posts-"+a+"-row"))&&a.removeClassName("editing");$("edit").setAttribute("post_id","")}},currentReplyId:function(){return $("edit").getAttribute("post_id")},
isEditing:function(a){if(this.currentReplyId()==a.toString()){$("edit").show();$("edit_post_body").focus();return true}return false},cancel:function(){this.clearReplyId();$("edit").hide()}},ReplyForm={init:function(){EditForm.cancel();$("reply").toggle();$("post_body").focus()}};function showChatSelector(a,b){new lightbox("/rooms/change?game_rooms="+a+"&game_id="+b)}function limitText(a,b){if(a.value.length>b)a.value=a.value.substring(0,b)}
function limitCheckedBoxes(a,b,c){for(var e=0,f=0;f<a.length;f++)e+=a[f].checked?1:0;if(e>b)a[c].checked=false}Prototype.Platform={Windows:!!navigator.platform.match(/Win/),Macintosh:!!navigator.platform.match(/Mac/),Linux:!!navigator.platform.match(/Linux/)};Hash.prototype.getWithDefault=function(a,b){var c=this.get(a);return undefined==c?this.set(a,b()):c};Hash.prototype.getOrSet=function(a,b){var c=this.get(a);return undefined==c?this.set(a,b):c};
Element.addMethods("textarea",{positionCaretAtEnd:function(a){a=$(a);if(a.createTextRange){var b=a.createTextRange();b.move("character",a.value.length);b.select()}else if(a.selectionStart!==null){b=a.value.length;a.focus();a.setSelectionRange(b,b)}else{a.focus();a.value+=""}return a}});
Element.addMethods({ieHappyHide:function(a){a=$(a);a.style.display="none";a.style.visibility="hidden";return a},ieHappyShow:function(a){a=$(a);a.style.display="";a.style.visibility="visible";return a},setText:function(a,b){a=$(a);a[Prototype.Browser.Gecko?"textContent":"innerText"]=b;return a}});String.prototype.evalScripts=function(){return this.extractScripts?this.extractScripts().map(function(a){return eval(a)}):this};
function autoTruncate(a,b){b||(b=1);$$("."+a).each(function(c){var e=c.down("a"),f=e.getStyle("font-size");c=c.getWidth();var h=11;if(f)h=parseInt(f.sub("px",""),10);f=e.innerHTML;c=Math.round(c/(h-4.5)*b);e.update(f.truncate(c))})}function insertTrackingPixelWithTimestamp(a){stamp=+new Date;document.write('<img src="'+a+stamp+'?"/>')}
Prototype.Browser.Gecko&&function(){Event.observe(document,"keypress",function(a){if(a.keyCode==Event.KEY_TAB)if("select,input,button,textarea".indexOf(a.target.nodeName.toLowerCase())>-1){var b=$(a.target),c=b.up("form").getElements().findAll(function(f){return"hidden"!=f.type&&!f.disabled});b=c.indexOf(b);var e=null;if(e=a.shiftKey?b-1>=0?c[b-1]:null:b+1<c.length?c[b+1]:null){a.stop();e.focus()}}})}();function CommentsController(a){this.initialize(a)}
CommentsController.prototype={initialize:function(a){this._comments_path=a.comments_path;this._hidden_threshold=a.hidden_threshold;this._active_user=a.active_user;this._comment_ids=a.comment_ids;this._top_comments=a.top_comments;this._show_blog_comment=a.show_blog_comment;this._call_to_action=a.call_to_action},showNewCommentForm:function(a){if(a==undefined)a="";if(this._call_to_action||this._active_user.isAuthenticated()){try{holodeck.recordAnalyticsEvent("Comments","Add")}catch(b){}$("commentutility")&&
Element.hide("commentutility"+a);Element.show("comment_new"+a)}},showReplyToCommentForm:function(a){$("reply_to_comment").show();$("comment_"+a).insert($("reply_to_comment"));$("response_content").value="";a=a;$("reply_to_comment_submit").stopObserving("click");$("reply_to_comment_submit").on("click",function(){comments_controller.replyToComment(a)})},showEditReplyToCommentForm:function(a){$("reply_to_comment").show();$("comment_response_"+a).insert($("reply_to_comment"));$("response_content").value=
$("comment_response_content_"+a).innerHTML;a=a;$("reply_to_comment_submit").stopObserving("click");$("reply_to_comment_submit").on("click",function(){comments_controller.replyToComment(a)})},resetNewCommentForm:function(a){if(a==undefined)a="";$("comment_content"+a).value="";$("comment_errors"+a).hide();Element.hide("comment_new"+a);this.reenableNewCommentForm(a);$("commentutility")&&$("commentutility"+a).show()},reenableNewCommentForm:function(a){if(a==undefined)a="";Element.hide("comment_indicator"+
a);$("post_comment_submit"+a).disabled=false},submitNewCommentForm:function(a,b){if(b==undefined)b="";var c=this;Element.show("comment_indicator"+b);$("post_comment_submit"+b).disabled=true;c._call_to_action&&$("post_comment_submit"+b).hide();$(a).request({method:"post",onSuccess:function(e){var f;if(c._call_to_action){(f=$("added_comments_list"))&&f.insert({top:e.responseText});window.location.hash="_";window.location.hash="recent_comments";e=f.down();new Effect.Highlight(e,{});active_user.isFacebookConnected()||
e.insert({after:$("facebook_comment_upsell").show()})}else(f=$$(".comment_list").first())&&f.insert(e.responseText);$("no_comments").hide();c.resetNewCommentForm(b);if(c._call_to_action){$("comment_indicator"+b).hide();$("post_comment_submit"+b).show();c.showNewCommentForm(b)}urchinTracker("/new_comment")},on400:function(e){c.showNewCommentErrors(e.responseText,b)},on500:function(){c.showNewCommentErrors("A server error occured.",b)}})},showNewCommentErrors:function(a,b){if(b==undefined)b="";var c=
$("comment_errors"+b);c.show();c.update(a);if(this._call_to_action){$("comment_indicator"+b).hide();$("post_comment_submit"+b).show()}this.reenableNewCommentForm(b)},userSilenced:function(){var a=$("comment_user_silenced");$("comment_add_a_comment").hide();a.update(this._active_user.silencedMessage());a.show()},checkUserSilenced:function(){this._active_user.isSilenced()&&this.userSilenced()},lightUpSingleComment:function(a,b){a=$("comment_"+a);a.removeClassName("rated_negative");a.removeClassName("rated_positive");
a.addClassName(b?"rated_positive":"rated_negative")},currentRating:function(a){var b=$("comment_current_rating_"+a).innerHTML;return isNaN(b)?NaN:parseInt($("comment_current_rating_"+a).innerHTML,10)},opinionForComment:function(a){a=$("comment_"+a);return a.hasClassName("rated_negative")?false:a.hasClassName("rated_positive")?true:null},rateComment:function(a,b){var c=this.opinionForComment(a);if(c!==b){var e=this.currentRating(a);if(c===true)e-=1;else if(c===false)e+=1;if(b===true)e+=1;else if(b===
false)e-=1;c=$("comment_"+a);$("comment_rating_area_"+a);var f=this;this.hideRatingLinks(a);isNaN(e)||$("comment_current_rating_"+a).update(e);c.removeClassName("below_threshold");c.removeClassName("above_threshold");c.addClassName(e>this._hidden_threshold||isNaN(e)?"above_threshold":"below_threshold");this.lightUpSingleComment(a,b);new Ajax.Request(this._comments_path+"/"+a+"/ratings.js",{parameters:{opinion:b},onComplete:function(){f.showRatingLinks(a)}})}},flagComment:function(a){var b=this;this.hideRatingLinks(a);
new Ajax.Request(this._comments_path+"/"+a+"/flaggings.js",{onComplete:function(){b.showRatingLinks(a);$("comment_flagged_"+a).show();$("comment_flagged_"+a).update("<span>This comment has been flagged for review.</span>")}})},hideRatingLinks:function(a){var b=$("comment_rating_links_"+a),c=$("flag_indicator_"+a);a=$("comment_status_"+a);c.show();a.hide();b.hide()},showRatingLinks:function(a){var b=$("comment_rating_links_"+a),c=$("flag_indicator_"+a);a=$("comment_status_"+a);c.hide();b.show();a.show()},
showCommentContent:function(a){Element.hide("show_comment_content_"+a);Element.show("hide_comment_content_"+a);Element.show("comment_content_"+a)},hideCommentContent:function(a){Element.show("show_comment_content_"+a);Element.hide("hide_comment_content_"+a);Element.hide("comment_content_"+a)},removeComment:function(a){var b=this._comments_path+"/"+a+".js",c=$("flag_indicator_"+a),e=$("remove_comment_"+a),f=$("comment_"+a);c.show();e.hide();new Ajax.Request(b,{method:"delete",onSuccess:function(){f.remove()}})},
spamComment:function(a){var b=this._comments_path+"/"+a+"/spam.js",c=$("flag_indicator_"+a),e=$("spam_comment_"+a),f=$("comment_"+a);c.show();e.hide();new Ajax.Request(b,{method:"post",onSuccess:function(){f.remove()}})},replyToComment:function(a){var b=this._comments_path+"/"+a+"/reply",c=$("flag_indicator_"+a),e=$("reply_to_comment_"+a),f=$("comment_"+a);c.show();e&&e.hide();new Ajax.Request(b,{method:"post",parameters:{response_content:$("response_content").value,show_blog_comment:this._show_blog_comment},
onSuccess:function(h){var l=$("reply_to_comment");l.hide();$$(".user_message").last().insert({after:l});f.replace(h.responseText);comments_controller.showAdminControls();c.hide()}})},cancelReply:function(){$("reply_to_comment").hide();$("response_content").value=""},checkUserRatingStatus:function(){var a=this;new Ajax.Request(this._active_user.accountUrl()+"/comment_ratings.json",{method:"get",parameters:{comment_ids:Object.toJSON(this._comment_ids),game_id:this._active_user.gameId(),top_comments:this._top_comments?
true:""},onSuccess:function(b){a.lightUpComments(b.responseJSON)}})},clearReply:function(a){var b=this._comments_path+"/"+a+"/clear_reply",c=$("flag_indicator_"+a),e=$("clear_reply_to_comment_"+a),f=$("reply_to_comment_"+a),h=$("comment_"+a);c.show();e.hide();new Ajax.Request(b,{method:"post",onSuccess:function(){c.hide();f.show();h.down(".comment_reply").remove()}})},lightUpComments:function(a){var b=this;$H(a).each(function(c){b.lightUpSingleComment(c.key,c.value)})},showAdminControls:function(){if(active_user.isAdmin()){$$(".admin_controls").each(Element.show);
$$(".developer_controls").each(Element.show)}else active_user.isDeveloperOfGame()&&$$(".developer_controls").each(Element.show)}};FeedbackFormBuilder=Class.create();FeedbackFormType=Class.create();FeedbackFormType.prototype={initialize:function(a,b,c,e,f){this.type=a;this.property_class=b;this.desc_text_area=c;this.sidebar_id=e;this.login_required=f}};FeedbackFormBuilder.FEEDBACK_DESCRIPTION_TEXT_LIMIT=2E3;
FeedbackFormBuilder.selectAccomplishment=function(a){if(a=="")$("missing_accomplishment_options").innerHTML="Please select a game";else{$("missing_accomplishment_options").hide();$("missing_accomplishment_spinner").show();new Ajax.Request("/feedbacks/missing_accomplishments_for.json?game_id="+a,{method:"get",onComplete:function(b){$("missing_accomplishment_spinner").hide();$("missing_accomplishment_options").update(b.responseJSON.select_html).show()}})}};
FeedbackFormBuilder.prototype={initialize:function(a){var b=$("select_topic").options[$("select_topic").selectedIndex].value;this.currentTextArea=null;this._character_count_message_node=$("character_count_message");this._character_count_node=this._character_count_message_node.down("#character_count");this._character_count_node.update(FeedbackFormBuilder.FEEDBACK_DESCRIPTION_TEXT_LIMIT);this._addCharCounterToTextAreas();this._element=$(a);this._classes=new Array("abuse","general","game_missing_accomplishment",
"game_bug");this.types=[new FeedbackFormType("Feedback","general","feedback_general_content","general_feedback_instructions"),new FeedbackFormType("BugReport","general","feedback_general_content","general_bug_feedback_instructions"),new FeedbackFormType("FeatureRequest","general","feedback_general_content","general_feedback_instructions"),new FeedbackFormType("AdvertisingInquiryFeedback","general","feedback_general_content","advertiser_feedback_instructions"),new FeedbackFormType("MediaOpportunityFeedback",
"general","feedback_general_content","media_opportunity_feedback_instructions"),new FeedbackFormType("ArcadeAppFeedback","general","feedback_general_content","kongregate_arcade_feedback_instructions"),new FeedbackFormType("OtherInquiryFeedback","general","feedback_general_content","general_feedback_instructions"),new FeedbackFormType("DevelopmentSupportFeedback","general","feedback_general_content","developer_support_feedback_instructions"),new FeedbackFormType("AbusiveUser","abuse","feedback_abuse_content",
"abusive_user_feedback_instructions"),new FeedbackFormType("MissingAccomplishmentFeedback","game_missing_accomplishment","feedback_missing_accomplishment_content","missing_accomplishment_feedback_instructions",true),new FeedbackFormType("GameBugReport","game_bug","feedback_game_bug_content","game_bug_feedback_instructions"),new FeedbackFormType("PowerupRewardsFeedback","general","feedback_general_content","power_up_rewards_instructions")];this._text_area_names=this.types.map(function(c){return c.desc_text_area}).uniq();
this._sidebar_ids=this.types.map(function(c){return c.sidebar_id}).uniq();this._clearContentExcept(b);this._hideAll();this.subjectChanged();this._setSubmitState()},_findTypeByTypeStr:function(a){return this.types.find(function(b){return b.type==a})},_clearContentExcept:function(a){var b=this._findTypeByTypeStr(a);this._text_area_names.each(function(c){if(c!=b.desc_text_area)$(c).value=""})},_hideAll:function(){this._classes.each(function(a){this._getElementsForClass(a).each(function(b){b.hide()})}.bind(this));
this._hideSidebars()},_hideSidebars:function(){this._sidebar_ids.each(function(a){$(a).hide()})},_showType:function(a){this.type=a=this._findTypeByTypeStr(a);this.showElementsOfClass(a.property_class);this._showSidebarForType(a);this.copyContent(a.desc_text_area)},_showSidebarForType:function(a){$(a.sidebar_id).show()},copyContent:function(a){a=$(a);if(this.currentTextArea&&this.currentTextArea!=a){a.value=this.currentTextArea.value;this.currentTextArea.value=""}this.currentTextArea=a},_setSubmitState:function(){if($F("select_topic")==
"Feedback"){$("feedback_submit_button").disable();$("feedback_submission_warning").show()}else{$("feedback_submit_button").enable();$("feedback_submission_warning").hide()}},_getElementsForClass:function(a){return this._element.select("."+a)},showElementsOfClass:function(a){this._getElementsForClass(a).each(function(b){b.show()})},select:function(a){this._hideAll();this._showType(a)},_loginRequired:function(){return typeof this.type!="undefined"&&this.type.login_required},_enableForm:function(){$("login_message").hide();
$("feedback_form_form").enable();$("feedback_submit_button").show()},_disableForm:function(){$("login_message").show();$("feedback_form_form").disable();$("select_topic").enable();$("feedback_submit_button").hide()},subjectChanged:function(){var a=$F("select_topic");this.select(a);this._loginRequired()&&!active_user.isAuthenticated()?this._disableForm():this._enableForm();var b=$("chooser"),c=$("feedback_game_id");c.onchange=function(){};a=="GameBugReport"&&$("game_bug_input_cell").appendChild(b);
if(a=="MissingAccomplishmentFeedback"){$("game_missing_accomplishment_input_cell").appendChild(b);c.onchange=function(){FeedbackFormBuilder.selectAccomplishment(c.value)};c.value!=""&&c.onchange()}this._setSubmitState()},_spin:function(){$("feedback_form_content").style.display="none";$("feedback_spinner").style.display="block"},_unspin:function(){$("feedback_spinner").style.display="none";$("feedback_form_content").style.display="block"},_addCharCounterToTextAreas:function(){var a=this;$$(".feedback_text_area").each(function(b){b.observe("keyup",
a._checkCharCount)})},_checkCharCount:function(){var a=this.getValue().length;a=FeedbackFormBuilder.FEEDBACK_DESCRIPTION_TEXT_LIMIT-a;feedbackFormBuilder._character_count_node.update(a);a<0?feedbackFormBuilder._character_count_message_node.addClassName("negative"):feedbackFormBuilder._character_count_message_node.removeClassName("negative")}};Function.prototype.runWhenDomLoaded=function(){if(document.loaded)this.defer();else{var a=this;document.observe("dom:loaded",function(){a()})}};Cookie={set:function(a,b,c,e){a=encodeURIComponent(a)+"="+encodeURIComponent(b||"");if(c!==undefined){b=new Date;b.setTime(b.getTime()+864E5*parseFloat(c));a+="; expires="+b.toGMTString()}a+=e?"; path="+e:"; path=/";return document.cookie=a},setWithDate:function(a,b,c){a=encodeURIComponent(a)+"="+encodeURIComponent(b||"");if(c!==undefined)a+="; expires="+c.toGMTString();a+="; path=/";return document.cookie=a},get:function(a){return(a=document.cookie.match(new RegExp("(^|;)\\s*"+encodeURIComponent(a)+
"=([^;\\s]*)")))?decodeURIComponent(a[2].gsub(/\+/," ")):null},erase:function(a,b){var c=Cookie.get(a)||true;Cookie.set(a,"",-1,b);return c},accept:function(){if(typeof navigator.cookieEnabled=="boolean")return navigator.cookieEnabled;Cookie.set("_test","1");return Cookie.erase("_test")==="1"}};var swfobject=function(){function a(){if(!ca){try{var s=D.getElementsByTagName("body")[0].appendChild(I("span"));s.parentNode.removeChild(s)}catch(A){return}ca=true;s=G.length;for(var H=0;H<s;H++)G[H]()}}function b(s){if(ca)s();else G[G.length]=s}function c(s){if(typeof y.addEventListener!=r)y.addEventListener("load",s,false);else if(typeof D.addEventListener!=r)D.addEventListener("load",s,false);else if(typeof y.attachEvent!=r)g(y,"onload",s);else if(typeof y.onload=="function"){var A=y.onload;y.onload=
function(){A();s()}}else y.onload=s}function e(){T?f():h()}function f(){var s=D.getElementsByTagName("body")[0],A=I(v);A.setAttribute("type",C);var H=s.appendChild(A);if(H){var M=0;(function(){if(typeof H.GetVariable!=r){var N=H.GetVariable("$version");if(N){N=N.split(" ")[1].split(",");O.pv=[parseInt(N[0],10),parseInt(N[1],10),parseInt(N[2],10)]}}else if(M<10){M++;setTimeout(arguments.callee,10);return}s.removeChild(A);H=null;h()})()}else h()}function h(){var s=L.length;if(s>0)for(var A=0;A<s;A++){var H=
L[A].id,M=L[A].callbackFn,N={success:false,id:H};if(O.pv[0]>0){var U=F(H);if(U)if(j(L[A].swfVersion)&&!(O.wk&&O.wk<312)){q(H,true);if(M){N.success=true;N.ref=l(H);M(N)}}else if(L[A].expressInstall&&p()){N={};N.data=L[A].expressInstall;N.width=U.getAttribute("width")||"0";N.height=U.getAttribute("height")||"0";if(U.getAttribute("class"))N.styleclass=U.getAttribute("class");if(U.getAttribute("align"))N.align=U.getAttribute("align");var V={};U=U.getElementsByTagName("param");for(var X=U.length,Y=0;Y<
X;Y++)if(U[Y].getAttribute("name").toLowerCase()!="movie")V[U[Y].getAttribute("name")]=U[Y].getAttribute("value");m(N,V,H,M)}else{t(U);M&&M(N)}}else{q(H,true);if(M){if((H=l(H))&&typeof H.SetVariable!=r){N.success=true;N.ref=H}M(N)}}}}function l(s){var A=null;if((s=F(s))&&s.nodeName=="OBJECT")if(typeof s.SetVariable!=r)A=s;else if(s=s.getElementsByTagName(v)[0])A=s;return A}function p(){return!fa&&j("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function m(s,A,H,M){fa=true;W=M||null;da={success:false,
id:H};var N=F(H);if(N){if(N.nodeName=="OBJECT"){R=w(N);S=null}else{R=N;S=H}s.id=o;if(typeof s.width==r||!/%$/.test(s.width)&&parseInt(s.width,10)<310)s.width="310";if(typeof s.height==r||!/%$/.test(s.height)&&parseInt(s.height,10)<137)s.height="137";D.title=D.title.slice(0,47)+" - Flash Player Installation";M=O.ie&&O.win?"ActiveX":"PlugIn";M="MMredirectURL="+encodeURI(y.location).toString().replace(/&/g,"%26")+"&MMplayerType="+M+"&MMdoctitle="+D.title;if(typeof A.flashvars!=r)A.flashvars+="&"+M;else A.flashvars=
M;if(O.ie&&O.win&&N.readyState!=4){M=I("div");H+="SWFObjectNew";M.setAttribute("id",H);N.parentNode.insertBefore(M,N);N.style.display="none";(function(){N.readyState==4?N.parentNode.removeChild(N):setTimeout(arguments.callee,10)})()}B(s,A,H)}}function t(s){if(O.ie&&O.win&&s.readyState!=4){var A=I("div");s.parentNode.insertBefore(A,s);A.parentNode.replaceChild(w(s),A);s.style.display="none";(function(){s.readyState==4?s.parentNode.removeChild(s):setTimeout(arguments.callee,10)})()}else s.parentNode.replaceChild(w(s),
s)}function w(s){var A=I("div");if(O.win&&O.ie)A.innerHTML=s.innerHTML;else if(s=s.getElementsByTagName(v)[0])if(s=s.childNodes)for(var H=s.length,M=0;M<H;M++)!(s[M].nodeType==1&&s[M].nodeName=="PARAM")&&s[M].nodeType!=8&&A.appendChild(s[M].cloneNode(true));return A}function B(s,A,H){var M,N=F(H);if(O.wk&&O.wk<312)return M;if(N){if(typeof s.id==r)s.id=H;if(O.ie&&O.win){var U="";for(var V in s)if(s[V]!=Object.prototype[V])if(V.toLowerCase()=="data")A.movie=s[V];else if(V.toLowerCase()=="styleclass")U+=
' class="'+s[V]+'"';else if(V.toLowerCase()!="classid")U+=" "+V+'="'+s[V]+'"';V="";for(var X in A)if(A[X]!=Object.prototype[X])V+='<param name="'+X+'" value="'+A[X]+'" />';N.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+U+">"+V+"</object>";E[E.length]=s.id;M=F(s.id)}else{X=I(v);X.setAttribute("type",C);for(U in s)if(s[U]!=Object.prototype[U])if(U.toLowerCase()=="styleclass")X.setAttribute("class",s[U]);else U.toLowerCase()!="classid"&&X.setAttribute(U,s[U]);for(var Y in A)A[Y]!=
Object.prototype[Y]&&Y.toLowerCase()!="movie"&&z(X,Y,A[Y]);N.parentNode.replaceChild(X,N);M=X}}return M}function z(s,A,H){var M=I("param");M.setAttribute("name",A);M.setAttribute("value",H);s.appendChild(M)}function K(s){var A=F(s);if(A&&A.nodeName=="OBJECT")if(O.ie&&O.win){A.style.display="none";(function(){A.readyState==4?P(s):setTimeout(arguments.callee,10)})()}else A.parentNode.removeChild(A)}function P(s){if(s=F(s)){for(var A in s)if(typeof s[A]=="function")s[A]=null;s.parentNode.removeChild(s)}}
function F(s){var A=null;try{A=D.getElementById(s)}catch(H){}return A}function I(s){return D.createElement(s)}function g(s,A,H){s.attachEvent(A,H);J[J.length]=[s,A,H]}function j(s){var A=O.pv;s=s.split(".");s[0]=parseInt(s[0],10);s[1]=parseInt(s[1],10)||0;s[2]=parseInt(s[2],10)||0;return A[0]>s[0]||A[0]==s[0]&&A[1]>s[1]||A[0]==s[0]&&A[1]==s[1]&&A[2]>=s[2]?true:false}function n(s,A,H,M){if(!(O.ie&&O.mac)){var N=D.getElementsByTagName("head")[0];if(N){H=H&&typeof H=="string"?H:"screen";if(M)ja=Z=null;
if(!Z||ja!=H){M=I("style");M.setAttribute("type","text/css");M.setAttribute("media",H);Z=N.appendChild(M);if(O.ie&&O.win&&typeof D.styleSheets!=r&&D.styleSheets.length>0)Z=D.styleSheets[D.styleSheets.length-1];ja=H}if(O.ie&&O.win)Z&&typeof Z.addRule==v&&Z.addRule(s,A);else Z&&typeof D.createTextNode!=r&&Z.appendChild(D.createTextNode(s+" {"+A+"}"))}}}function q(s,A){if(ka){A=A?"visible":"hidden";if(ca&&F(s))F(s).style.visibility=A;else n("#"+s,"visibility:"+A)}}function u(s){return/[\\\"<>\.;]/.exec(s)!=
null&&typeof encodeURIComponent!=r?encodeURIComponent(s):s}var r="undefined",v="object",C="application/x-shockwave-flash",o="SWFObjectExprInst",y=window,D=document,Q=navigator,T=false,G=[e],L=[],E=[],J=[],R,S,W,da,ca=false,fa=false,Z,ja,ka=true,O=function(){var s=typeof D.getElementById!=r&&typeof D.getElementsByTagName!=r&&typeof D.createElement!=r,A=Q.userAgent.toLowerCase(),H=Q.platform.toLowerCase(),M=H?/win/.test(H):/win/.test(A);H=H?/mac/.test(H):/mac/.test(A);A=/webkit/.test(A)?parseFloat(A.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,
"$1")):false;var N=!+"\u000b1",U=[0,0,0],V=null;if(typeof Q.plugins!=r&&typeof Q.plugins["Shockwave Flash"]==v){if((V=Q.plugins["Shockwave Flash"].description)&&!(typeof Q.mimeTypes!=r&&Q.mimeTypes[C]&&!Q.mimeTypes[C].enabledPlugin)){T=true;N=false;V=V.replace(/^.*\s+(\S+\s+\S+$)/,"$1");U[0]=parseInt(V.replace(/^(.*)\..*$/,"$1"),10);U[1]=parseInt(V.replace(/^.*\.(.*)\s.*$/,"$1"),10);U[2]=/[a-zA-Z]/.test(V)?parseInt(V.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof y.ActiveXObject!=r)try{var X=
new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(X)if(V=X.GetVariable("$version")){N=true;V=V.split(" ")[1].split(",");U=[parseInt(V[0],10),parseInt(V[1],10),parseInt(V[2],10)]}}catch(Y){}return{w3:s,pv:U,wk:A,ie:N,win:M,mac:H}}();(function(){if(O.w3){if(typeof D.readyState!=r&&D.readyState=="complete"||typeof D.readyState==r&&(D.getElementsByTagName("body")[0]||D.body))a();if(!ca){typeof D.addEventListener!=r&&D.addEventListener("DOMContentLoaded",a,false);if(O.ie&&O.win){D.attachEvent("onreadystatechange",
function(){if(D.readyState=="complete"){D.detachEvent("onreadystatechange",arguments.callee);a()}});y==top&&function(){if(!ca){try{D.documentElement.doScroll("left")}catch(s){setTimeout(arguments.callee,0);return}a()}}()}O.wk&&function(){ca||(/loaded|complete/.test(D.readyState)?a():setTimeout(arguments.callee,0))}();c(a)}}})();(function(){O.ie&&O.win&&window.attachEvent("onunload",function(){for(var s=J.length,A=0;A<s;A++)J[A][0].detachEvent(J[A][1],J[A][2]);s=E.length;for(A=0;A<s;A++)K(E[A]);for(var H in O)O[H]=
null;O=null;for(var M in swfobject)swfobject[M]=null;swfobject=null})})();return{registerObject:function(s,A,H,M){if(O.w3&&s&&A){var N={};N.id=s;N.swfVersion=A;N.expressInstall=H;N.callbackFn=M;L[L.length]=N;q(s,false)}else M&&M({success:false,id:s})},getObjectById:function(s){if(O.w3)return l(s)},embedSWF:function(s,A,H,M,N,U,V,X,Y,ea){var ga={success:false,id:A};if(O.w3&&!(O.wk&&O.wk<312)&&s&&A&&H&&M&&N){q(A,false);b(function(){H+="";M+="";var ba={};if(Y&&typeof Y===v)for(var aa in Y)ba[aa]=Y[aa];
ba.data=s;ba.width=H;ba.height=M;aa={};if(X&&typeof X===v)for(var ha in X)aa[ha]=X[ha];if(V&&typeof V===v)for(var ia in V)if(typeof aa.flashvars!=r)aa.flashvars+="&"+ia+"="+V[ia];else aa.flashvars=ia+"="+V[ia];if(j(N)){ha=B(ba,aa,A);ba.id==A&&q(A,true);ga.success=true;ga.ref=ha}else if(U&&p()){ba.data=U;m(ba,aa,A,ea);return}else q(A,true);ea&&ea(ga)})}else ea&&ea(ga)},switchOffAutoHideShow:function(){ka=false},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}},
hasFlashPlayerVersion:j,createSWF:function(s,A,H){if(O.w3)return B(s,A,H)},showExpressInstall:function(s,A,H,M){O.w3&&p()&&m(s,A,H,M)},removeSWF:function(s){O.w3&&K(s)},createCSS:function(s,A,H,M){O.w3&&n(s,A,H,M)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(s){var A=D.location.search||D.location.hash;if(A){if(/\?/.test(A))A=A.split("?")[1];if(s==null)return u(A);A=A.split("&");for(var H=0;H<A.length;H++)if(A[H].substring(0,A[H].indexOf("="))==s)return u(A[H].substring(A[H].indexOf("=")+
1))}return""},expressInstallCallback:function(){if(fa){var s=F(o);if(s&&R){s.parentNode.replaceChild(R,s);if(S){q(S,true);if(O.ie&&O.win)R.style.display="block"}W&&W(da)}fa=false}}}}();HandlerQueue=function(){function a(e){c.push(e)}function b(){for(var e=c.length-1;e>=0;e--)c[e].apply(this,arguments)}var c=[];return{add:a,handle:b}};ActiveUser=function(a){this.initialize(a)};ActiveUser.UPDATE_FREQUENCY=1200;ActiveUser.SILENCED_TEMPLATE=new Template('You have been silenced for #{until}. Click <a href="/pages/silenced">here</a> to read about silences.');ActiveUser.ADMIN_LOAD_TOOLS_PATH="/admin/load_toolbar";ActiveUser.USER_DATA_LS_KEY="kong_user_data";
ActiveUser.prototype={initialize:function(a){this._dynamic_style_ele=this._holodeck=null;this._attributes=$H();this._game_attributes=$H();this._attribute_observer_handler=new HandlerQueue;this._on_authenticated_handler=new HandlerQueue;this._on_adblock_detected_handler=new HandlerQueue;this._captured_inline_selectors=[];this._domain=a.domain;this._load_toolbar=a.load_toolbar;this._game_page=a.game_page;this._redirect_capture=a.redirect_capture;this._new_session_url=a.new_session_url;this.updateAttributes(a.kong_user_data);
this.split_treatments=this.getAttributes().split_treatments;this.isAuthenticated()&&this.createUpdater();this.addRunWhenAuthenticatedObserver(function(b){b.populateUserSpecificLinks.bind(b).runWhenDomLoaded();b.loadAdminToolbar();b.lightPowerupRewardsUpsell()});this.lightUpBadgeOfTheDayOverlay();this.lightPowerupRewardsUpsell();setTimeout(this.checkForAdBlockerTask.bind(this),1E4)},setHolodeck:function(a){this._holodeck=a},createUpdater:function(){var a=this;new PeriodicalExecuter(function(){a.pullUserData()},
ActiveUser.UPDATE_FREQUENCY)},pullUserData:function(){var a=this,b="/accounts/"+this.username()+"/info.json";new Ajax.Request(b,{method:"get",onSuccess:function(c){a.updateAttributes(c.responseJSON)}})},addAttributesObserver:function(a){this._attribute_observer_handler.add(a)},addOnAuthenticatedObserver:function(a){this._on_authenticated_handler.add(a)},addRunWhenAuthenticatedObserver:function(a){this.addOnAuthenticatedObserver(a);this.isAuthenticated()&&a(this)},updateAttributes:function(a){var b=
$.jStorage.get(ActiveUser.USER_DATA_LS_KEY),c=this._attributes.get("username");if(b&&(b.version>a.version||b.generated_at>a.generated_at))a=b;this._attributes.update(a);this._attribute_observer_handler.handle(this);a.username&&a.username!=c&&this.usernameUpdated();$.jStorage.set(ActiveUser.USER_DATA_LS_KEY,this._attributes.toObject())},updateGameAttributes:function(a){this._game_attributes.update(a)},gameCookieName:function(){if(this._game_id)return"kong_game_"+this._game_id},getGameAttributesFromCookie:function(){var a=
Cookie.get(this.gameCookieName());a&&this.updateGameAttributes(a.evalJSON())},updateGameAttributesCookie:function(){var a=this.getGameAttributes();a&&Cookie.set(this.gameCookieName(),Object.toJSON(a),undefined,this.gameCookiePath())},getAttributes:function(){return this._attributes.toObject()},getGameAttributes:function(){return this._game_attributes.toObject()},username:function(){return this._attributes.get("username")},siteVisitorUID:function(){return Cookie.get("kong_svid")},advertiserGender:function(a,
b){var c=this._attributes.get("gender");if(/^m/i.match(c))return a;else if(/^f/i.match(c))return b},videoEggGender:function(){return this.advertiserGender("m","f")},googleGender:function(){return this.advertiserGender(1,2)},googleAgeBracket:function(){var a=this._attributes.get("age");return a<=17?undefined:a<=24?1001:a<=34?1002:a<=44?1003:a<=54?1004:a<=64?1005:1006},avatarPath:function(){var a=this._attributes.get("avatar_url");if(!a)return"";if((a=a.match(/http:\/\/[a-z\.:0-9]*(.*)$/))&&a.length==
2)return a[1]},id:function(){return this._attributes.get("id")},facebook_uid:function(){return this._attributes.get("facebook_uid")},solvedCaptcha:function(){return this._attributes.get("solved_captcha")},chatUsername:function(){return this._attributes.get("chat_username")||this._attributes.get("username")},chatPassword:function(){return this._attributes.get("chat_password")},gameAuthToken:function(){return this._game_attributes.get("game_auth_token")},userVars:function(){return this._game_attributes.get("user_vars")},
userVarsSig:function(){return this._game_attributes.get("user_vars_sig")},specialChatVars:function(){return this._attributes.get("special_chat_vars")},gameplaysCount:function(){return this._attributes.get("gameplays_count")},ratingsCount:function(){return this._attributes.get("ratings_count")},gameplaysCountFromCookie:function(){try{return parseInt(Cookie.get(Holodeck.KONG_GAMEPLAYS_COOKIE_NAME)||1,10)}catch(a){return 0}},duelingGroup:function(){var a=this.specialChatVars();if(a)if(a=a.dueling_quest_data)return a.dueling_quest_slug||
"";return""},age:function(){return this._attributes.get("age")},points:function(){return this._attributes.get("points")},pointsAway:function(){return this._attributes.get("points_away")},friendsOnlineCount:function(){return this._attributes.get("friends_online_count")},friendsOnlineNames:function(){return this._attributes.get("friends_online_names")},unreadShoutsCount:function(){return this._attributes.get("unread_shouts_count")},unreadWhispersCount:function(){return this._attributes.get("unread_whispers_count")},
pointsForLastLevel:function(){return this._attributes.get("points_for_last_level")},pointsAfterLastLevel:function(){return active_user.points()-active_user.pointsForLastLevel()},level:function(){return this._attributes.get("level")},lastLevelupAt:function(){var a=this._attributes.get("last_levelup_at");return a?new Date(a):undefined},recentLevelup:function(){return this.lastLevelupAt()>new Date((new Date).getTime()-864E5)},senderNameOrEmail:function(){return this._attributes.get("sender_name_or_email")},
boshEnabled:function(){return this._game_attributes.get("bosh_enabled")},compressionEnabled:function(){return this._game_attributes.get("compression_enabled")},usernameUpdated:function(){if(this.isAuthenticated()){this.createUpdater();this._on_authenticated_handler.handle(this)}},isAuthenticated:function(){return!!(this.username()&&!/^Guest/.match(this.username()))},isAdmin:function(){return this.isAuthenticated()&&this._attributes.get("admin")},isPremium:function(){return!Cookie.get("admin_premium_off")&&
this.isAuthenticated()&&this._attributes.get("premium")},premiumizeUpsellNode:function(a,b,c){this.isPremium()||a.addClassName("clickable").observe("click",function(e){lightbox.prototype.initializePremiumMembershipPurchase(b,c);Event.stop(e);return false});return a},isDeveloperOfGame:function(){return document.location.pathname.split("/")[2]==this.username()},isDeveloper:function(){return this.isAuthenticated()&&this._attributes.get("developer")},isModerator:function(){return this.isAuthenticated()&&
this._attributes.get("moderator")},isCurator:function(){return this.isAuthenticated()&&this._attributes.get("curator")},isForumModerator:function(){return this.isAuthenticated()&&this._attributes.get("forum_moderator")},isGamestopEmployee:function(){return this.isAuthenticated()&&this._attributes.get("gamestop_employee")},getsAdminBar:function(){if(!this._load_toolbar)return false;return this.isModerator()||this.isCurator()||this.isForumModerator()||this.isGamestopEmployee()},silencedUntil:function(){var a=
this._attributes.get("silenced_until");return a?new Date(a):undefined},isSilenced:function(){var a=this.silencedUntil();return Boolean(a&&a>new Date)},silencedMessage:function(){return ActiveUser.SILENCED_TEMPLATE.evaluate({until:TimeInWordsHelper.distanceInWords(new Date,this.silencedUntil())})},populateUserSpecificLinks:function(a){var b=this.username();(a?a.select("a"):$$("a.user_specific")).each(function(c){c.href=c.href.replace("Guest",b).replace("KongregateHolodeckTemplateUsername",b)})},addCapturedSelector:function(a,
b){this._captured_inline_selectors.push(a);var c=this,e=function(f){var h=f.onclick;if(h)f.onclick=c.capturedSelectorWrapper.bindAsEventListener(c,h.bind(f),b)};$$(a).each(function(f){f.match("a, input[type=button]")?e(f):f.getElementsBySelector("a, input[type=button]").each(e);f.addClassName("lbOn")})},capturedSelectorWrapper:function(a,b,c){var e="function"==typeof b;if(this.isAuthenticated()){if(e)return b(a)}else{this._redirect_capture?this.redirectToLogin():this.activateInlineLogin({},c);"function"==
typeof b&&this.saveCapturedFunction(b.curry(a));a.preventDefault!=undefined&&Event.stop(a);return false}},activateInlineLogin:function(a,b){a||(a={});a=$H(a);var c="/accounts/new/behind_login";if(this._holodeck){this._holodeck.recordAnalyticsEvent("Lightbox","Signin");a.set("game_id",this._game_id)}if(a.size()>0)c=c+"?"+a.toQueryString();b?lightbox.prototype.initializeKongregateLightboxFromAjax(c,{afterStaticContentLoad:function(){lightbox.prototype.toggleRegistration();active_user.focusFormField("username")}}):
lightbox.prototype.initializeKongregateLightboxFromAjax(c,{done_class_name:"lightbox_login",afterStaticContentLoad:function(){active_user.focusFormField("username")}})},focusFormField:function(a){var b=$(a);b&&setTimeout(function(){b.focus()},0)},activateKredPurchase:function(a){this.isAuthenticated()&&lightbox.prototype.initializeKredPurchase(a)},activatePasswordRecovery:function(){if(this.isGamePage())this.activateInlineLogin({recover:true});else document.location="/sessions/new?recover=true"},
redirectToLogin:function(){top.location=this._new_session_url},debugLevel:function(){if(!this._debug_level)this._debug_level=this.documentLocationSearchQuery().debug_level;return this._debug_level},documentLocationSearchQuery:function(){if(!this._document_location_search_query)this._document_location_search_query=document.location.search.parseQuery();return this._document_location_search_query},seenSharedContentWelcome:function(){return!!this._game_attributes.get("seen_shared_content_welcome")},setSeenSharedContentWelcome:function(a){this._game_attributes.set("seen_shared_content_welcome",
a);this.updateGameAttributesCookie()},saveCapturedFunction:function(a){this._capturedFunction=a},runCapturedFunction:function(){"function"==typeof this._capturedFunction&&this._capturedFunction.defer();this._capturedFunction=null},gameId:function(){return this._game_id},setGame:function(a,b){this._game_id=a;this._game_resource_path=b;this.getGameAttributesFromCookie()},gamePath:function(){if(!this._game_path){var a=document.location.pathname.match(/(.*)\/$/);this._game_path=a?a[1]:document.location.pathname}return this._game_path},
gameResourcePath:function(){return this._game_resource_path},gameCookiePath:function(){if(!this._game_cookie_path)this._game_cookie_path=this.gamePath().match(/(.*)\/.*/)[1];return this._game_cookie_path},referrerUrl:function(a){if(!this.isAuthenticated())return a;var b=a.match(/\?/)?"&":"?";return a+b+"referrer="+encodeURIComponent(this.username())},formAuthenticityToken:function(){return this._attributes.get("form_authenticity_token")},gameType:function(){return this._game_attributes.get("game_type")},
hasRequiredPlugins:function(){return this.hasRequiredPluginsFor(this.gameType())},hasRequiredPluginsFor:function(a){if(a=="unity"){var b=false;unityObject.detectUnity(function(c){b=c=="installed"||c=="running"});return b}else return true},accountUrl:function(){return"/accounts/"+this.username()},isGamePage:function(){return!!this._game_page},domain:function(){return this._domain},isMobileUserAgent:function(){return this._attributes.get("mobile_user_agent")},countryCode:function(){return this.valueOfSearchParameter("force_country_code")||
this._attributes.get("country_code")},loadAdminToolbar:function(){this.getsAdminBar()&&new Ajax.Updater("admin_links_placeholder",ActiveUser.ADMIN_LOAD_TOOLS_PATH,{method:"get",evalScripts:true})},recordTreatments:function(a){a&&this._attributes.get("treatments")&&this._attributes.get("treatments").each(function(b){b.analytics_slot&&a._setCustomVar(b.analytics_slot,b.group_permalink,b.treatment_permalink,2)})},valueOfSearchParameter:function(a){return location.search.parseQuery()[a]},powerupRewardsUser:function(){return this._attributes.get("powerup_rewards_user")},
powerupRewardsProUser:function(){return!!this.powerupRewardsBonus()},powerupRewardsBonus:function(){return this._attributes.get("powerup_rewards_bonus")},powerupRewardsBonusFor:function(a){a=parseInt(a,10);var b=this.powerupRewardsBonus();return a>0&&b?(a*b).ceil():a},showPowerupRewardsUpsell:function(){return"US"==this.countryCode()},occasionallyShowRegistrationLightbox:function(){!this.isAuthenticated()&&this.gameplaysCount()-2>=0&&(this.gameplaysCount()-2)%7==0&&this.activateInlineLogin({},true)},
lightPowerupRewardsUpsell:function(){if(this.showPowerupRewardsUpsell()){this.createCSS(".powerup_rewards_upsell","display:block");this.createCSS(".powerup_rewards_botd_upsell","display:inline")}},lightUpBadgeOfTheDayOverlay:function(){var a=this._attributes.get("botd_badge_id");a&&this.createCSS(".badge_of_the_day_overlay span.botd_badge_id_"+a,"display:block")},createCSS:function(a,b){var c;if(!this._dynamic_style_ele){var e=$$("head")[0];c=new Element("style",{type:"text/css",media:"screen"});
e.appendChild(c)}if(!this._dynamic_style_ele)if(Prototype.Browser.IE&&!Prototype.Browser.IE9){if((c=document.styleSheets)&&c.length>0)this._dynamic_style_ele=c[c.length-1]}else this._dynamic_style_ele=c;if(Prototype.Browser.IE&&!Prototype.Browser.IE9)this._dynamic_style_ele&&typeof this._dynamic_style_ele.addRule=="object"&&this._dynamic_style_ele.addRule(a,b);else this._dynamic_style_ele&&typeof document.createTextNode!="undefined"&&this._dynamic_style_ele.appendChild(document.createTextNode(a+" {"+
b+"}"))},needForSpeedNumberCompleted:function(){return this._attributes.get("need_for_speed_number_completed")},invokeConversionIframe:function(){Cookie.erase("_kong_acct_created","/");try{$("conversion_dynamic_iframe_target").update((new Template($("conversion_dynamic_iframe").innerHTML)).evaluate())}catch(a){}},ignoreBounceMessage:function(a,b){$(a).up(".sitemessage").hide();new Ajax.Request(b)},isAdBlockerEnabled:function(){return false},checkForAdBlockerTask:function(){this.isAdBlockerEnabled()&&
this._on_adblock_detected_handler.handle();this._on_adblock_detected_handler=null},runIfAdBlockerDetected:function(a){if(this._on_adblock_detected_handler==null)this.isAdBlockerEnabled()&&a();else this._on_adblock_detected_handler.add(a)},shoutForGame:function(a,b){a="/accounts/"+this.username()+"/permissions_for_game.json?game_id="+a;new Ajax.Request(a,{method:"get",onSuccess:function(c){json=c.responseJSON;allow=json!=null&&json.always_allow_shouts;b(allow)}})},kredBuyerType:function(){return this._attributes.get("kred_buyer_type")},
isFacebookConnected:function(){return!!this._attributes.get("facebook_uid")},facebookAccessTokenNeedsUpdate:function(){return!!this._attributes.get("access_token_needs_update")},facebookStatus:function(){return this._attributes.get("facebook_status")},facebookLoginUrl:function(){return this._attributes.get("facebook_url")},gameTagTreatment:function(){return this.split_treatments.tags_replace_description},bumperTimeout:function(){return this.split_treatments.bumper_timeout||"5"},hasGoogleADayForToday:function(){if(!this.isAuthenticated())return false;
return!!this._attributes.get("gad_earned")}};Function.prototype.bufferingFunction=function(a,b){var c=Function.preconditionBufferingGroup(a,b),e=this,f=function(){c.push(e,arguments,this,f,b);a(this)&&c.unwind()};return f};
Function.preconditionBufferingGroup=function(a,b){if(!this._buffering_function_groups)this._buffering_function_groups=[];if(undefined===a._buffering_group_id)a._buffering_group_id=this._buffering_function_groups.length;a=a._buffering_group_id;this._buffering_function_groups[a]||(this._buffering_function_groups[a]=function(){var c=[];return{push:function(e,f,h,l,p){c.push({fn:e,outerFunction:l,args:f,bind_to:h,timestamp:new Date,tag:p})},unwind:function(){if(c.length){var e;e=function(f,h){var l=function(p,
m){if(p.localeCompare&&m.localeCompare)return p.localeCompare(m);if(p>m)return-1;if(p<m)return 1;return 0};return l(f.tag,h.tag)||l(f.timestamp,h.timestamp)};if(b instanceof Function)c.sort(b);else b&&c.sort(e);for(;e=c.shift();)e.fn.apply(e.bind_to,e.args)}}}}());return this._buffering_function_groups[a]};Function.unbufferBufferingGroup=function(a){a._buffering_group_id&&Function.preconditionBufferingGroup(a).unwind()};var hookup_hintables=function(){$$(".hintable").each(function(a){var b=a.title,c=a.form,e=c.restoreHints,f=function(){if(b==a.value||""==a.value){a.value="";a.removeClassName("hinted_value")}},h=function(){if(""==a.value){a.value=b;a.addClassName("hinted_value")}},l=a.form.onsubmit;h();a.observe("click",f);a.observe("focus",f);a.observe("blur",h);a.restoreHint=h;c.onsubmit=function(){var p=true;f();if(l)try{p=l.apply(this,arguments)}catch(m){}h();return p};c.restoreHints=function(){h();e&&e.apply(this,
arguments)}})};document.observe("dom:loaded",function(){hookup_hintables()});Ajax.CachedAutocompleter=Class.create();
Object.extend(Object.extend(Ajax.CachedAutocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(a,b,c,e){this.baseInitialize(a,b,e);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=c;this.cache={};if(this.options.forceActivation){Event.stopObserving(this.element,"keydown");Event.observe(this.element,"keydown",this.onKeyPressWithForcedActivation.bindAsEventListener(this));Event.observe(this.element,
"focus",this.onFocus.bindAsEventListener(this))}},getUpdatedChoices:function(){var a=this.getToken().toLowerCase();if(this.cache[a])this.updateChoices(this.cache[a]);else{this.startIndicator();entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(a);this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams)this.options.parameters+="&"+this.options.defaultParams;new Ajax.Request(this.url,this.options)}},onComplete:function(a){this.updateChoices(this.cache[a.request.parameters.search]=
a.responseText)},markPrevious:function(){if(this.index>0)this.index--;else{this.index=this.entryCount-1;this.update.scrollTop=this.update.scrollHeight}selection=this.getEntry(this.index);selection_top=selection.offsetTop;if(selection_top<this.update.scrollTop)this.update.scrollTop-=selection.offsetHeight},markNext:function(){if(this.index<this.entryCount-1)this.index++;else{this.index=0;this.update.scrollTop=0}selection=this.getEntry(this.index);selection_bottom=selection.offsetTop+selection.offsetHeight;
if(selection_bottom>this.update.scrollTop+this.update.offsetHeight)this.update.scrollTop+=selection.offsetHeight},selectEntry:function(){if(this.index>=0){this.active=false;this.updateElement(this.getCurrentEntry())}else{try{this.element.form.onsubmit()}catch(a){}this.element.form.submit()}},onFocus:function(){this.hasFocus=true;if(this.oldElementValue==this.element.value&&this.element.value.length>=this.options.minChars)this.entryCount>0?this.render():this.show()},onKeyPressWithForcedActivation:function(a){var b=
a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||Prototype.Browser.WebKit>0&&a.keyCode==0,c=this.element.value.length>=this.options.minChars;if(!this.active&&b&&c){Event.stop(a);this.observer&&clearTimeout(this.observer);this.changed=false;this.hasFocus=true;this.getUpdatedChoices()}else this.onKeyPress(a)},updateChoices:function(a){if(!this.changed&&this.hasFocus){this.update.innerHTML=a;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&
this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else this.entryCount=0;this.stopIndicator();this.update.scrollTop=0;this.index=this.options.noAutoDefault?-1:0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else this.render()}}});Number.prototype.withDelimiters=function(a,b){a||(a=",");b||(b=1E3);for(var c=[],e=Math.floor(this);e;){c.unshift(e%b);e=Math.floor(e/b)}return[c.shift()].concat(c.map(function(f){return f.toPaddedString((b-1+"").length)})).join(a)};Ajax.Poller=function(a,b,c,e){this.initialize(a,b,c,e)};
Ajax.Poller.prototype={initialize:function(a,b,c,e){this._stopped=true;c=c||5E3;e=e||3E4;var f=this,h=Object.extend(Object.extend({method:"get"},b),{on202:function(){if(!f._stopped){setTimeout(f._poll,c);b.on202&&b.on202.apply(b,arguments)}},onFailure:function(){if(!f._stopped){setTimeout(f._poll,e);b.onFailure&&b.onFailure.apply(b,arguments)}}});this._poll=function(){new Ajax.Request(a,h)}},start:function(a){this._stopped=false;setTimeout(this._poll.bind(this),a||0)},stop:function(){this._stopped=
true}};Form.serializeElements=function(a,b){if(typeof b!="object")b={hash:!!b};else if(Object.isUndefined(b.hash))b.hash=true;var c,e,f=false,h=b.submit,l;if(b.hash){b={};l=function(p,m,t){if(m in p){Object.isArray(p[m])||(p[m]=[p[m]]);p[m].push(t)}else p[m]=t;return p}}else{b="";l=function(p,m,t){return p+(p?"&":"")+encodeURIComponent(m)+"="+encodeURIComponent(t)}}return a.inject(b,function(p,m){if(!m.disabled&&m.name){c=m.name;e=$(m).getValue();if(e!=null&&m.type!="file"&&(m.type!="submit"||!f&&h!==false&&
(!h||c==h)&&(f=true)))p=l(p,c,e)}return p})};(function(a,b){var c=0;b.prototype.toGlobalReference=function(){var e=this,f;f="_tgrFn"+c++;a[f]=function(){try{delete a[f]}catch(h){a[f]=undefined}e()};return f}})(this,Function);Prototype.Browser.IE6=navigator.userAgent.indexOf("MSIE 6.")>-1;Prototype.Browser.IE7=navigator.userAgent.indexOf("MSIE 7.")>-1;Prototype.Browser.IE8=navigator.userAgent.indexOf("MSIE 8.")>-1;Prototype.Browser.IE9=navigator.userAgent.indexOf("MSIE 9.")>-1;if(Prototype.Browser.IE8)Element._attributeTranslations.write.names["class"]=undefined;
if(Prototype.Browser.WebKit){var indexOfVersion=navigator.userAgent.indexOf("Version");if(indexOfVersion>-1){var versionString=navigator.userAgent.substr(indexOfVersion,13),version=versionString.split("/")[1];if(version){version=parseInt(version.gsub(".",""));if(version>=503)Prototype.Browser.Safari503=true}}};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return c.nodeType==3?c.nodeValue:c.hasChildNodes()&&!Element.hasClassName(c,b)?Element.collectTextNodesIgnoreClass(c,b):""}).flatten().join("").strip()};Element.Methods.collectTextNodesIgnoreClass=Element.collectTextNodesIgnoreClass;Element.addMethods(Element.Methods);Element.Methods.selectedOptionValue=function(a){a=$(a);if("SELECT"===a.tagName)return(a=a.select("option")[a.selectedIndex])&&a.readAttribute("value")};Element.Methods.selectOptionValue=function(a,b){a=$(a);if("SELECT"==a.tagName)a.selectedIndex=a.select("option").pluck("value").indexOf(b)};Element.addMethods(Element.Methods);FocusHandler=Class.create({initialize:function(a,b,c){this._row=a;this._text=b;this._callback=c;this._elementsToInspect=a.getInputElements();this._elementToAffect=a.getHelpElement()},setText:function(a){this._text=a},_inputIsValid:undefined,onFocus:function(){FocusHandler._last_row=this._row},onBlur:function(){if(this._inputIsValid()){this._elementsToInspect.each(function(a){Element.removeClassName(a,"error_field")});Element.removeClassName(this._elementToAffect,"error_msg");this._elementToAffect.innerHTML=
"";return false}else{this._elementsToInspect.each(function(a){Element.addClassName(a,"error_field")});Element.addClassName(this._elementToAffect,"error_msg");this._elementToAffect.innerHTML=this._text;this._callback();return true}},_rowChanged:function(){return this._row!=FocusHandler._last_row}});
HelpFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,c){$super(b,c,function(){})},onBlur:function(){var a=this._elementToAffect.childNodes[0];a&&a.remove();return false},_createHelpDiv:function(){this._removeHelpDiv();var a=new Element("div");a.id="help_wrapper";var b=new Element("div");b.id="help_text";a.appendChild(b);this._elementToAffect.appendChild(a);return b},_removeHelpDiv:function(){var a=this._elementToAffect.childNodes[0];a&&a.remove()},_errorsArePresent:function(){return this._elementToAffect.hasClassName("error_msg")}});
HelpTextFocusHandler=Class.create(HelpFocusHandler,{initialize:function($super,b,c){$super(b,c)},onFocus:function($super){$super();if(this._errorsArePresent())return false;if(this._text)this._createHelpDiv().innerHTML=this._text;return true}});HelpImageFocusHandler=Class.create(HelpFocusHandler,{initialize:function($super,b,c){$super(b,null);this._imageElement=c},onFocus:function($super){$super();if(this._errorsArePresent())return false;this._setImage(this._imageElement);return true},_setImage:function(a){this._createHelpDiv().appendChild(a)}});
HelpCreditCardFocusHandler=Class.create(HelpImageFocusHandler,{initialize:function($super,b,c){$super(b,c);this._setImage(this._imageElement)},onBlur:function(){}});NonEmptyInputFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,c,e){$super(b,c,e)},_inputIsValid:function(){return this._row.getInputValue()!=""}});
CreditCardValidationFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,c,e){$super(b,c,e)},_inputIsValid:function(){for(var a=[/^4\d{12}(\d{3})?$/,/^(5[1-5]\d{4}|677189)\d{10}$/,/^(6011|65\d{2})\d{12}$/,/^3[47]\d{13}$/],b=["visa","master_card","discover","american_express"],c=0,e=a.length;c<e;c++)if(this._row.getInputValue().match(a[c])){this._creditCardType=b[c];return true}return false},getCreditCardType:function(){return this._creditCardType}});
DateValidationFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,c,e){$super(b,c,e)},_deferValidation:function(){return!this._rowChanged()&&this._isIncomplete()},_isIncomplete:function(){return!this._month()||!this._year()},_month:function(){return this._row.getInputElements()[0].value},_year:function(){return this._row.getInputElements()[1].value}});
CompleteDateValidationFocusHandler=Class.create(DateValidationFocusHandler,{initialize:function($super,b,c,e){$super(b,c,e)},_inputIsValid:function(){if(this._deferValidation())return true;return this._row.getInputValue().length>=6}});
FutureDateValidationFocusHandler=Class.create(DateValidationFocusHandler,{initialize:function($super,b,c,e){$super(b,c,e)},_getCurrentDate:function(){return new Date},_inputIsValid:function(){if(this._deferValidation())return true;var a=this._row.getInputValue().split("/"),b=this._getCurrentDate();return!(a[1]==b.getFullYear()&&a[0]<b.getMonth()+1)}});
CvvValidationFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,c){this._requiredCvvLength=0;$super(b,"credit card number must be valid",c)},setCreditCardType:function(a){this._requiredCvvLength=this._getRequiredCvvLengthFor(a);this.setText("code must be "+this._requiredCvvLength+" digits")},_getRequiredCvvLengthFor:function(a){if(a=="american_express")return 4;else if(a=="test")return 1;return 3},_inputIsValid:function(){return this._row.getInputValue().length==this._requiredCvvLength}});
ValidInputCallbackFocusHandler=Class.create(FocusHandler,{initialize:function($super,b,c){$super(b,"",c)},onBlur:function(){this._callback();return false}});CreditCardForm=Class.create({initialize:function(a,b,c,e,f){this._tableElement=a;this._rows=[];this._togglePayNow=f;this._ccImages={};$H({visa:"/images/ccmark_visa.gif",master_card:"/images/ccmark_mastercard.png",american_express:"/images/ccmark_amex.png",discover:"/images/ccmark_discover.gif"}).each(function(h){this._ccImages[h.key]=new Element("img");this._ccImages[h.key].src=h.value}.bind(this));this._ccNumberRow=new FormCreditCardNumberRow("Credit card number","number","credit_card",e.number,
this._checkAllRowsForValidity.bind(this),this._propagateCreditCardType.bind(this));this._rows.push(this._ccNumberRow);this._rows.push(new FormExpirationDateRow("Expiration Date","","credit_card",b,c,e.month,e.year,this._checkAllRowsForValidity.bind(this)));this._cvvRow=new FormCvvRow("Card security code","cvv","credit_card",e.cvv,this._checkAllRowsForValidity.bind(this));this._rows.push(this._cvvRow);this._rows.push(new FormNonEmptyRow("First name","first_name","billing","Please enter your first name exactly as it appears on your credit card",
e.first_name,this._checkAllRowsForValidity.bind(this),false));this._rows.push(new FormNonEmptyRow("Last name","last_name","billing","Please enter your last name exactly as it appears on your credit card",e.last_name,this._checkAllRowsForValidity.bind(this),false));this._rows.push(new FormNonEmptyRow("Billing address","street_address","billing","Enter the street address where your statements are mailed to. (eg, 12 Maple Drive)",e.street_address,this._checkAllRowsForValidity.bind(this),false));this._rows.push(new FormCanBeEmptyRow("Billing address (cont)",
"extended_address","billing","Apartment number, suite number or department",e.extended_address,this._checkAllRowsForValidity.bind(this),false));this._rows.push(new FormNonEmptyRow("City","locality","billing","",e.locality,this._checkAllRowsForValidity.bind(this),false));this._rows.push(new FormNonEmptyRow("State/Province/Region","region","billing","",e.region,this._checkAllRowsForValidity.bind(this),false));this._rows.push(new FormNonEmptyRow("Postal Code","postal_code","billing","",e.postal_code,
this._checkAllRowsForValidity.bind(this),true));this._attachRowsToTableElement()},rowCount:function(){return this._rows.length},reportAllErrors:function(){this._rows.each(function(a){a._callAllOnBlurHandlers()})},_checkAllRowsForValidity:function(){},_enablePayNow:function(){var a=$$(".checkout_button")[0];a.disabled=false;a.removeClassName("disabled")},_disablePayNow:function(){var a=$$(".checkout_button")[0];if(this._togglePayNow){a.disabled=true;a.addClassName("disabled")}},_attachRowsToTableElement:function(){this._rows.each(function(a){Element.insert(this._tableElement,
{before:a.getElement()})}.bind(this))},_propagateCreditCardType:function(){var a=this._ccNumberRow.getCreditCardType();this._ccNumberRow._helpCreditCardFocusHandler._setImage(this._ccImages[a]);this._cvvRow.setCreditCardType(a)}});function NewWelcomeBox(a,b){this.initialize(a,b)}
NewWelcomeBox.prototype={initialize:function(a,b){var c=this;this._user=a;this._navigation=b;this.updateValues();this.addObservers();a.addRunWhenAuthenticatedObserver(this.addObservers.bind(this));a.addAttributesObserver(function(){c.updateValues()});if(Prototype.Browser.IE6)this.orig_welcome_height=$("welcome").getHeight()},addObservers:function(){var a=this._navigation,b=$("profile_hover_area");$("profile_open_control").observe("mouseover",function(c){a.onMouseOverNavTab(c.target)});b.observe("mouseover",
function(){a.onMouseOverNavTab(b)});$("profile-box-tab-pane").observe("mouseover",function(){a.clearResetTimer()})},open:function(){var a=$("profile-box-tab-pane")?$("profile-box-tab-pane"):$("guest_user_welcome_content");$("welcome").addClassName("exposed");Prototype.Browser.IE6&&$("welcome").setStyle({height:this.orig_welcome_height+$("profile-box-tab-pane").getHeight()+"px"});a.show();Shim.shimElement(a)},close:function(){var a=$("profile-box-tab-pane")?$("profile-box-tab-pane"):$("guest_user_welcome_content");
$("welcome").removeClassName("exposed");a.hide();Shim.hide();Prototype.Browser.IE6&&$("welcome").setStyle({height:this.orig_welcome_height+"px"})},updateValues:function(){if(this._user.isAuthenticated()){var a=this._user.getAttributes(),b=$("welcome");b.select(".kreds_balance_or_kreds_link").each(function(h){h.update(this.kredsBalanceOrKredsLinkString(a.kreds_balance));h.href=this.kredAccountUrlOrKredsLinkUrl(a.kreds_balance)}.bind(this));this.updateFriendInfo(b);var c=(new Element("img")).writeAttribute({id:"welcome_box_small_user_avatar",
src:a.avatar_url,title:a.username,name:"user_avatar",alt:"Avatar for "+a.username,height:28,width:28});b.down("span#small_avatar_placeholder").update(c);var e,f;if(active_user.pointsAway()==0){e=active_user.points();f=e+" points"}else{e=active_user.pointsAway();f=e+(e==1?" point":" points")+"&nbsp;to level up"}b.select(".points_to_level_up").each(function(h){h.update(e)});b.select(".points_to_level_up_text").each(function(h){h.update(f)});b.select(".total_points_amount").each(function(h){h.update(active_user.points())});
b.select(".facebook_nav_item").each(function(h){active_user.isFacebookConnected()&&h.hide()});$("welcome_box_levelbug_img_placeholder").writeAttribute({id:"welcome_levelbug","class":"spritesite levelbug level_"+a.level,title:"Level "+a.level,name:"welcome_levelbug",alt:"Levelbug"+a.level});if(a.level==65){$("profile-section-points-needed").hide();$("max-level").show()}else{c=(new Element("span")).writeAttribute({id:"welcome_next_levelbug","class":"spritesite levelbug level_"+(a.level+1),title:"Level "+
(a.level+1),name:"next_welcome_levelbug",alt:"Levelbug"+(a.level+1)});b.down("span#welcome_box_next_levelbug_img_placeholder").update(c)}active_user.isDeveloper()&&$("profile_developer_section_placeholder").replace((new Template($("developer_section_template").innerHTML)).evaluate({username:active_user.username()}));new ProgressBar($("progress-bar"),{value:active_user.pointsAfterLastLevel(),maxValue:active_user.pointsAway()+active_user.pointsAfterLastLevel()});active_user.populateUserSpecificLinks(b);
b.select(".username_holder").each(function(h){h.update(active_user.username())});this.updateMessagesLink(active_user.unreadShoutsCount(),active_user.unreadWhispersCount());c=active_user.unreadShoutsCount()+active_user.unreadWhispersCount();b.down(".my_messages").update(this.messagesCountString(c));if(c>0){$("profile_bar_messages").addClassName("alert_messages");$("profile_control_unread_message_count").update(c);$("profile_control_unread_message_count").addClassName("has_messages");$("my-messages-link").setAttribute("title",
active_user.unreadShoutsCount()+" shouts, "+active_user.unreadWhispersCount()+" whispers");active_user.unreadShoutsCount()==0&&$("my-messages-link").setAttribute("href","/accounts/"+active_user.username()+"/private_messages")}$("guest_user_welcome_content").hide();$("nav_welcome_box").show()}},updateFriendInfo:function(a){a.select(".friends_online_count").each(function(b){b.update(active_user.friendsOnlineCount())});a.down("#friends-online-header").update(this.friendsOnlineString(active_user.friendsOnlineCount()));
if(active_user.friendsOnlineCount()>0){a.select(".friends_online_link").each(function(b){b.title=active_user.friendsOnlineNames()});a.down("#friends-online-list").update(this.getFriendLinks(active_user.friendsOnlineNames())).show()}else{a.select(".friends_online_link").each(function(b){b.title="No friends online."});a.down("#friends-online-list").hide()}$("profile_nav_following_link").update("Friends");$("profile_nav_follower_link").update("Fans")},getFriendLinks:function(a){a=a.split(", ");var b=
"",c=0;for(c=0;c<a.length;c++)b+=a[c].match(/and.*!/)?"<a href='/accounts/"+active_user.getAttributes().username+"/friends'>"+a[c]+"</a>":"<a href='/accounts/"+a[c]+"'>"+a[c]+"</a>"+(c==a.length-1?"":", ");return b},friendsOnlineString:function(a){friend_count_string="No friends online";if(1==a)friend_count_string="1 friend online";else if(a>1)friend_count_string=a+" friends online";return"<span>"+friend_count_string+"</span>"},messagesCountString:function(a){return a>0?"<strong>My Messages</strong>":
"My Messages"},updateMessagesLink:function(a,b){var c=$("unread_messages_welcome_box_links"),e=$("unread_shouts_welcome_box_link"),f=$("unread_whispers_welcome_box_link"),h=$("shouts_whispers_comma"),l=a>0,p=b>0,m=l&&p,t=null;if(c){if(l){e.href="/accounts/"+encodeURIComponent(this._user.username())+"/messages";t=a>1?" shouts":" shout";e.update(a+t);e.show()}if(p){f.href="/accounts/"+encodeURIComponent(this._user.username())+"/private_messages";t=b>1?" whispers":" whisper";f.update(b+t);f.show()}m&&
h.show();if(l||p)c.show()}},kredsBalanceOrKredsLinkString:function(a){return 0==a?"Get Kreds!":1==a?"1 Kred":a.withDelimiters()+" Kreds"},kredAccountUrlOrKredsLinkUrl:function(a){return 0==a?"/kreds":"/accounts/"+encodeURIComponent(this._user.username())+"/kred_account"}};Prototype.extendFrame=function(a){a=$(a);for(var b in Element.Methods)if(Object.isFunction(Element.Methods[b]))a.contentWindow.Element.prototype[b]=Element.Methods[b].methodize();return a};function Navigation(a){this.initialize(a)}Navigation.COMMUNITY_MESSAGE_TEMPLATE=new Template("Get activity updates from #{friends} and your other friends on Kongregate.");
Navigation.prototype={initialize:function(a){this._user=a;this._rollover_delay=0.2;this._waiting=false;this._employee_link=$("nav_employee");this._moderator_link=$("nav_moderator");this._botd={};this._botd.image=$("nav-botd-image");this._botd.border=$("nav-botd-border");this._botd.overlay=$("nav-botd-overlay");this._botd.link=$("nav-botd-link");this._botd.badge_links=$$("#nav-botd .badge_link");this._botd.description=$("nav-botd-description");this._botd.game_name=$("nav-botd-game-name");this._challenge=
{};this._challenge.name_link=$("challenge-name-link");this._challenge.tiny_image=$("challenge-tiny-image");this._challenge.description=$("challenge-description");this._challenge.links=$$(".challenge_link");this._challenge.wrapper=$("current-challenge");this._challenge.header=$("challenge-header");this._community={};this._community.message=$("community-message-holder");var b=this,c=$("new_nav_wrapper"),e=$("search_bar");$(document.body).observe("mouseover",function(f){f=$(f.target);var h=$("profile_bar");
if(f&&f.descendantOf&&(h&&f.descendantOf(h)||!f.descendantOf(c)||f.descendantOf(e)))b.onMouseLeave()});$$(".nav_tab_li").each(function(f){f.subnav=f.down("dl");f.subnav&&f.observe("mouseover",function(h){var l=$(h.target);if("LI"!=h.target.tagName)l=h.target.up("li");b.onMouseOverNavTab(l)})});$$(".nav-tab-pane").each(function(f){f.observe("mouseover",function(){b.clearResetTimer()})});this.updateValues();this.activateSignIn();a.addRunWhenAuthenticatedObserver(function(){b.welcome_box=new NewWelcomeBox(a,
b);b.updateValues();b.displayRecentlyPlayedGames()});a.addOnAuthenticatedObserver(function(){$("welcome").removeClassName("expanded")});a.addAttributesObserver(function(){b.updateValues()})},displayRecentlyPlayedGames:function(){new Ajax.Request("/accounts/"+active_user.username()+"/nav_recently_played",{method:"get",onSuccess:function(a){a=$A(a.responseJSON);var b,c;if(a.size()>0){c='<dt><span>Recently Played <em class="recently_played_see_all"><a href="/accounts/'+active_user.username()+'/recently-played">(see all)</a></em></span></dt>';
b=new Template('<dd class="media mini_game"><a href="#{url}" class="img mrs"><img src="#{icon_url}" /></a><span class="mini_game_info bd"><span class="truncate_one_line"><a href="#{url}">#{title}</a></span><span class="truncate_one_line">by <a href="#{url}">#{uploaded_by_username}</a></span></span></dd>');a.each(function(e){c+=b.evaluate(e)});$("nav-game-categories").insert({before:c})}}})},showNewStarburst:function(){parseInt(Cookie.get("kong_seen_comm_tab")||0,10)>3||$("new_community_nav_tab").insert({top:'<span class="spriteall spritenav new_icon">New</span>'})},
activateSignIn:function(){if(!active_user.isAuthenticated()){var a=$("welcome_username"),b=$("welcome_password"),c=$("welcome"),e=new PeriodicalExecuter(function(f){var h,l;if(a.getValue().empty())$("welcome_username_label").show();else{$("welcome_username_label").hide();h=true}if(b.getValue().empty())$("welcome_password_label").show();else{$("welcome_password_label").hide();l=true}h&&l&&f.stop()},0.5);a.observe("focus",function(){c.hasClassName("expanded")||c.addClassName("expanded");$("remember_holder").show();
$("forgot_holder").show();$("welcome_username_label").hide();e.stop()});a.observe("blur",function(){a.getValue().empty()&&$("welcome_username_label").show()});b.observe("focus",function(){c.hasClassName("expanded")||c.addClassName("expanded");$("remember_holder").show();$("forgot_holder").show();$("welcome_password_label").hide();e.stop()});b.observe("blur",function(){b.getValue().empty()&&$("welcome_password_label").show()});(function(){e.stop()}).delay(45)}},buryElement:function(a,b){a.hasClassName("non-hideable-ad")||
(Prototype.Browser.IE6||Prototype.Browser.IE7?a.hide():b.descendants().each(function(c){if("shim"!=c.id&&c.tagName=="IFRAME")if(c.src.match(/^http:/))a.hide();else{c.relativize();c.setStyle({"z-index":-1});this.buryElement(a,Prototype.extendFrame(c).contentWindow.document.body)}}.bind(this)))},activateNav:function(a){this.iCanHazReset=true;this.resetCurrentNav();$$(".ad-container").each(function(b){this.buryElement(b,b)}.bind(this));if(a.hasClassName("profile_control"))this.welcome_box&&this.welcome_box.open(a);
else{a.addClassName("hover");a.subnav.show();Shim.shimElement(a.subnav)}this.iCanHazReset=true},clearResetTimer:function(){this._reset_timer&&clearTimeout(this._reset_timer);this._reset_timer=null},resetCurrentNav:function(){if(this.iCanHazReset){this.iCanHazReset=false;this.welcome_box&&this.welcome_box.close();game_title_auto_completer&&game_title_auto_completer.hide();$("game_title").blur();Shim.hide();$$(".nav_tab_li").each(function(a){a.removeClassName("hover")});$$(".nav-tab-pane").invoke("hide");
$$(".ad-container").invoke("show")}},onMouseLeave:function(){this.clearResetTimer();this._waiting=false;this._reset_timer=this.resetCurrentNav.bind(this).delay(this._rollover_delay)},onMouseOverNavTab:function(a){this.clearResetTimer();if(this._waiting)this._reset_timer=this.activateNav.bind(this).delay(this._rollover_delay,a);else{this._waiting=true;this._reset_timer=this.activateNav.bind(this).delay(0,a)}},updateValues:function(){var a=this._user.getAttributes(),b="Badge"+a.botd_badge_id;$$(".featured_link").invoke("hide");
[["admin",active_user.isAdmin()],["user",active_user.isAuthenticated()],["gamestop_employee",active_user.isGamestopEmployee()],["mod",active_user.isModerator()],["guest",!active_user.isAuthenticated()]].each(function(c){var e=c[1];$$("."+c[0]+"_visible").each(function(f){if(e){f.show();$("featured_section_"+f.getAttribute("name")).show()}})});if(this._user.isAuthenticated()){this._employee_link[this._user.isGamestopEmployee()?"show":"hide"]();this._moderator_link[this._user.isModerator()?"show":"hide"]();
$("headerwrap").addClassName("logged_in")}else{this._employee_link.hide();this._moderator_link.hide()}if(a.current_challenge_name){this._challenge.name_link.update(a.current_challenge_name);this._challenge.tiny_image.writeAttribute({src:a.current_challenge_tiny_image});this._challenge.description.update(a.current_challenge_description);this._challenge.links.each(function(c){c.writeAttribute({href:a.current_challenge_uri})})}else{this._challenge.wrapper.hide();this._challenge.header.hide();$("new_achievements_nav_tab").addClassName("no-challenges")}if(a.botd_icon_uri){this._botd.image.writeAttribute({src:a.botd_icon_uri,
alt:b,title:b});this._botd.border.writeAttribute({alt:b,title:b});this._botd.overlay.writeAttribute({alt:b,title:b});this._botd.overlay.addClassName("botd_badge_id_"+a.botd_badge_id);this._botd.link.update(a.botd_name);this._botd.badge_links.each(function(c){c.writeAttribute({href:a.botd_game_uri})});this._botd.description&&this._botd.description.update(a.botd_description);this._botd.game_name.update(a.botd_game_name)}if(this._user.isAuthenticated()&&a.community_friends&&a.community_friends.length>
0){b=a.community_friends.collect(function(c){return"<a href='/accounts/"+c+"'>"+c+"</a>"}).join(", ");this._community.message.update(Navigation.COMMUNITY_MESSAGE_TEMPLATE.evaluate({friends:b}))}this.showNewStarburst()}};function Home(a){this.initialize(a)}
Home.prototype={initialize:function(a){if(a.isAuthenticated()){if(a.recentLevelup())this.showLevelupBox();else if(a.level()>=6){$("recommended_badges_holder").show();$("recommended_badges_pod_spinner").show();this.getRecommendedBadges()}else $("tip_pod").show();a.ratingsCount()>=5&&this.getRecommendedGames()}else{$("captcha_holder").show();$("signup_pod_form").down("h3").hide();$("signup_pod_form").down(".intro").hide();var b=Cookie.get("guest_accomplishments");b=b?b.split(","):[];$("guest_accomplishments").update(b.length);
$("guest_points").update(Cookie.get("guest_points")||"0");if(Cookie.get("guest_points")||b.length>0){$("guest_accomplishment_upsell").show();$("guest_signup_intro").hide()}$("registration_showcase_1").update($("signup_pod"));$("registration_showcase_2").update($("staff_picks_pod"));$("signup_pod").show();$("staff_picks_pod").show();a.solvedCaptcha()&&$("user_captcha_validation")&&$("user_captcha_validation").hide()}this._recommended_badges_page=0},showLevelupBox:function(){$$(".user_level").each(function(a){a.update(active_user.level());
a.addClassName("level_"+active_user.level())});$("user_points").update(active_user.pointsAway());$("user_username").update(active_user.username());$("levelup_pod").show();this.getLevelupRecommendedBadges()},getLevelupRecommendedBadges:function(){new Ajax.Request("/recommended_badges?limit=2&levelup_module=true",{method:"get",onSuccess:function(a){$("levelup_recommended_badges").update(a.responseText);$("levelup_recommended_badges").show();$("recommended_badges_pod_spinner")!=undefined&&$("recommended_badges_pod_spinner").hide()}})},
setRecommendedBadgesPage:function(a){this._recommended_badges_page=a},getRecommendedBadges:function(){new Ajax.Updater({success:"recommended_badges_holder"},"/recommended_badges",{method:"get",evalScripts:true,onSuccess:function(){$("recommended_badges_holder").up("div").appendChild($("recommended_badges_pod_spinner"));$("recommended_badges_pod_spinner").hide()}})},getRecommendedGames:function(){new Ajax.Updater({success:"recommended_games_pod_holder"},"/recommended_games?home_page=true",{method:"get",
onSuccess:function(){$("recommended_games_pod_spinner").hide()},evalScripts:true})}};if(typeof Control=="undefined")Control={};var $proc=function(a){return typeof a=="function"?a:function(){return a}},$value=function(a){return typeof a=="function"?a():a};
Object.Event={extend:function(a){a._objectEventSetup=function(b){this._observers=this._observers||{};this._observers[b]=this._observers[b]||[]};a.observe=function(b,c){if(typeof b=="string"&&typeof c!="undefined"){this._objectEventSetup(b);this._observers[b].include(c)||this._observers[b].push(c)}else for(var e in b)this.observe(e,b[e])};a.stopObserving=function(b,c){this._objectEventSetup(b);if(b&&c)this._observers[b]=this._observers[b].without(c);else if(b)this._observers[b]=[];else this._observers=
{}};a.observeOnce=function(b,c){var e=function(){c.apply(this,arguments);this.stopObserving(b,e)}.bind(this);this._objectEventSetup(b);this._observers[b].push(e)};a.notify=function(b){this._objectEventSetup(b);var c=[],e=$A(arguments).slice(1);try{for(var f=0;f<this._observers[b].length;++f)c.push(this._observers[b][f].apply(this._observers[b][f],e)||null)}catch(h){if(h==$break)return false;else throw h;}return c};if(a.prototype){a.prototype._objectEventSetup=a._objectEventSetup;a.prototype.observe=
a.observe;a.prototype.stopObserving=a.stopObserving;a.prototype.observeOnce=a.observeOnce;a.prototype.notify=function(b){if(a.notify){var c=$A(arguments).slice(1);c.unshift(this);c.unshift(b);a.notify.apply(a,c)}this._objectEventSetup(b);c=$A(arguments).slice(1);var e=[];try{if(this.options&&this.options[b]&&typeof this.options[b]=="function")e.push(this.options[b].apply(this,c)||null);for(var f=0;f<this._observers[b].length;++f)e.push(this._observers[b][f].apply(this._observers[b][f],c)||null)}catch(h){if(h==
$break)return false;else throw h;}return e}}}};Element.addMethods({observeOnce:function(a,b,c){var e=function(){c.apply(this,arguments);Element.stopObserving(a,b,e)};Element.observe(a,b,e)}});(function(){function a(b){var c;if(b.wheelDelta)c=b.wheelDelta/120;else if(b.detail)c=-b.detail/3;if(c)if(b.element().fire("mouse:wheel",{delta:c}).stopped){b.stop();return false}}document.observe("mousewheel",a)})();
var IframeShim=Class.create({initialize:function(){this.element=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:void(0);",frameborder:0});$(document.body).insert(this.element)},hide:function(){this.element.hide();return this},show:function(){this.element.show();return this},positionUnder:function(a){a=$(a);var b=a.cumulativeOffset(),c=a.getDimensions();this.element.setStyle({left:b[0]+"px",top:b[1]+"px",width:c.width+
"px",height:c.height+"px",zIndex:a.getStyle("zIndex")-1}).show();return this},setBounds:function(a){for(prop in a)a[prop]+="px";this.element.setStyle(a);return this},destroy:function(){this.element&&this.element.remove();return this}});if(typeof Draggable!="undefined")Draggable.prototype.draw=function(a){var b=Position.cumulativeOffset(this.element);if(this.options.ghosting){var c=Position.realOffset(this.element);b[0]+=c[0]-Position.deltaX;b[1]+=c[1]-Position.deltaY}c=this.currentDelta();b[0]-=c[0];b[1]-=c[1];if(this.options.scroll&&this.options.scroll!=window&&this._isScrollChild){b[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;b[1]-=this.options.scroll.scrollTop-this.originalScrollTop}c=[0,1].map(function(m){return a[m]-
b[m]-this.offset[m]}.bind(this));if(this.options.snap)c=typeof this.options.snap=="function"?this.options.snap(c[0],c[1],this):this.options.snap instanceof Array?c.map(function(m,t){return Math.round(m/this.options.snap[t])*this.options.snap[t]}.bind(this)):c.map(function(m){return Math.round(m/this.options.snap)*this.options.snap}.bind(this));if(this.options.onDraw)this.options.onDraw.bind(this)(c);else{var e=this.element.style;if(this.options.constrainToViewport){var f=document.viewport.getDimensions(),
h=this.element.getDimensions(),l=parseInt(this.element.getStyle("margin-top")),p=parseInt(this.element.getStyle("margin-left"));f=[[0-p,0-l],[f.width-h.width-p,f.height-h.height-l]];if(!this.options.constraint||this.options.constraint=="horizontal")this.element.style.left=c[0]>=f[0][0]&&c[0]<=f[1][0]?c[0]+"px":(c[0]<f[0][0]?f[0][0]:f[1][0])+"px";if(!this.options.constraint||this.options.constraint=="vertical")this.element.style.top=c[1]>=f[0][1]&&c[1]<=f[1][1]?c[1]+"px":(c[1]<=f[0][1]?f[0][1]:f[1][1])+
"px"}else{if(!this.options.constraint||this.options.constraint=="horizontal")e.left=c[0]+"px";if(!this.options.constraint||this.options.constraint=="vertical")e.top=c[1]+"px"}if(e.visibility=="hidden")e.visibility=""}};if(typeof Prototype=="undefined")throw"Control.Window requires Prototype to be loaded.";if(typeof IframeShim=="undefined")throw"Control.Window requires IframeShim to be loaded.";if(typeof Object.Event=="undefined")throw"Control.Window requires Object.Event to be loaded.";
Control.Window=Class.create({initialize:function(a,b){Control.Window.windows.push(this);this.remoteContentLoaded=this.ajaxRequest=this.sourceContainer=this.href=this.isOpen=this.container=false;this.numberInSequence=Control.Window.windows.length+1;this.indicator=false;this.effects={fade:false,appear:false};this.indicatorEffects={fade:false,appear:false};this.options=Object.extend({beforeOpen:Prototype.emptyFunction,afterOpen:Prototype.emptyFunction,beforeClose:Prototype.emptyFunction,afterClose:Prototype.emptyFunction,
height:null,width:null,className:false,position:"center",offsetLeft:0,offsetTop:0,iframe:false,hover:false,indicator:false,closeOnClick:false,iframeshim:true,fade:false,fadeDuration:0.75,draggable:false,onDrag:Prototype.emptyFunction,resizable:false,minHeight:false,minWidth:false,maxHeight:false,maxWidth:false,onResize:Prototype.emptyFunction,constrainToViewport:false,method:"post",parameters:{},onComplete:Prototype.emptyFunction,onSuccess:Prototype.emptyFunction,onFailure:Prototype.emptyFunction,
onException:Prototype.emptyFunction,onRemoteContentLoaded:Prototype.emptyFunction,insertRemoteContentAt:false},b||{});this.indicator=this.options.indicator?$(this.options.indicator):false;if(a)if(typeof a=="string"&&a.match(Control.Window.uriRegex))this.href=a;else{this.container=$(a);this.createDefaultContainer(a);if(this.container&&(this.container.readAttribute("href")&&this.container.readAttribute("href")!=""||this.options.hover&&this.options.hover!==true)){if(this.options.hover&&this.options.hover!==
true)this.sourceContainer=$(this.options.hover);else{this.sourceContainer=this.container;this.href=this.container.readAttribute("href");if((b=this.href.match(/^#(.+)$/))&&b[1]){this.container=$(b[1]);this.href=false}else this.container=false}this.sourceContainerOpenHandler=function(c){this.open(c);c.stop();return false}.bindAsEventListener(this);this.sourceContainerCloseHandler=function(c){this.close(c)}.bindAsEventListener(this);this.sourceContainerMouseMoveHandler=function(c){this.position(c)}.bindAsEventListener(this);
if(this.options.hover){this.sourceContainer.observe("mouseenter",this.sourceContainerOpenHandler);this.sourceContainer.observe("mouseleave",this.sourceContainerCloseHandler);this.options.position=="mouse"&&this.sourceContainer.observe("mousemove",this.sourceContainerMouseMoveHandler)}else this.sourceContainer.observe("click",this.sourceContainerOpenHandler)}}this.createDefaultContainer(a);if(this.options.insertRemoteContentAt===false)this.options.insertRemoteContentAt=this.container;a={margin:0,position:"absolute",
zIndex:Control.Window.initialZIndexForWindow()};if(this.options.width)a.width=$value(this.options.width)+"px";if(this.options.height)a.height=$value(this.options.height)+"px";this.container.setStyle(a);this.options.className&&this.container.addClassName(this.options.className);this.positionHandler=this.position.bindAsEventListener(this);this.outOfBoundsPositionHandler=this.ensureInBounds.bindAsEventListener(this);this.bringToFrontHandler=this.bringToFront.bindAsEventListener(this);this.container.observe("mousedown",
this.bringToFrontHandler);this.container.hide();this.closeHandler=this.close.bindAsEventListener(this);if(this.options.iframeshim){this.iFrameShim=new IframeShim;this.iFrameShim.hide()}this.applyResizable();this.applyDraggable();Event.observe(window,"resize",this.outOfBoundsPositionHandler);this.notify("afterInitialize")},open:function(a){if(this.isOpen){this.bringToFront();return false}if(this.notify("beforeOpen")===false)return false;if(this.options.closeOnClick){if(this.options.closeOnClick===
true)this.closeOnClickContainer=$(document.body);else if(this.options.closeOnClick=="container")this.closeOnClickContainer=this.container;else if(this.options.closeOnClick=="overlay"){Control.Overlay.load();this.closeOnClickContainer=Control.Overlay.container}else this.closeOnClickContainer=$(this.options.closeOnClick);this.closeOnClickContainer.observe("click",this.closeHandler)}if(this.href&&!this.options.iframe&&!this.remoteContentLoaded){this.remoteContentLoaded=true;if(this.href.match(/\.(jpe?g|gif|png|tiff?)$/i)){a=
new Element("img");a.observe("load",function(c){this.getRemoteContentInsertionTarget().insert(c);this.position();if(this.notify("onRemoteContentLoaded")!==false){this.options.indicator&&this.hideIndicator();this.finishOpen()}}.bind(this,a));a.writeAttribute("src",this.href)}else if(!this.ajaxRequest){this.options.indicator&&this.showIndicator();this.ajaxRequest=new Ajax.Request(this.href,{method:this.options.method,parameters:this.options.parameters,onComplete:function(c){this.notify("onComplete",
c);this.ajaxRequest=false}.bind(this),onSuccess:function(c){this.getRemoteContentInsertionTarget().insert(c.responseText);this.notify("onSuccess",c);if(this.notify("onRemoteContentLoaded")!==false){this.options.indicator&&this.hideIndicator();this.finishOpen()}}.bind(this),onFailure:function(c){this.notify("onFailure",c);this.options.indicator&&this.hideIndicator()}.bind(this),onException:function(c,e){this.notify("onException",c,e);this.options.indicator&&this.hideIndicator()}.bind(this)})}return true}else if(this.options.iframe&&
!this.remoteContentLoaded){this.remoteContentLoaded=true;this.options.indicator&&this.showIndicator();this.getRemoteContentInsertionTarget().insert(Control.Window.iframeTemplate.evaluate({href:this.href}));var b=this.container.down("iframe");b.onload=function(){this.notify("onRemoteContentLoaded");this.options.indicator&&this.hideIndicator();b.onload=null}.bind(this)}this.finishOpen(a);return true},close:function(a){if(!this.isOpen||this.notify("beforeClose",a)===false)return false;this.options.closeOnClick&&
this.closeOnClickContainer.stopObserving("click",this.closeHandler);if(this.options.fade)this.effects.fade=new Effect.Fade(this.container,{queue:{position:"front",scope:"Control.Window"+this.numberInSequence},from:1,to:0,duration:this.options.fadeDuration/2,afterFinish:function(){this.iFrameShim&&this.iFrameShim.hide();this.isOpen=false;this.notify("afterClose")}.bind(this)});else{this.container.hide();this.iFrameShim&&this.iFrameShim.hide()}this.ajaxRequest&&this.ajaxRequest.transport.abort();if(!(this.options.draggable||
this.options.resizable)&&this.options.position=="center")Event.stopObserving(window,"resize",this.positionHandler);!this.options.draggable&&this.options.position=="center"&&Event.stopObserving(window,"scroll",this.positionHandler);this.options.indicator&&this.hideIndicator();if(!this.options.fade){this.isOpen=false;this.notify("afterClose")}return true},position:function(a){if(this.options.position=="mouse"){var b=[Event.pointerX(a),Event.pointerY(a)];this.container.setStyle({top:b[1]+$value(this.options.offsetTop)+
"px",left:b[0]+$value(this.options.offsetLeft)+"px"})}else{a=this.container.getDimensions();var c=document.viewport.getDimensions();Position.prepare();var e=Position.deltaX+Math.floor((c.width-a.width)/2);b=Position.deltaY+(c.height>a.height?Math.floor((c.height-a.height)/2):0);if(this.options.position=="center")this.container.setStyle({top:a.height<=c.height?(b!=null&&b>0?b:0)+"px":0,left:a.width<=c.width?(e!=null&&e>0?e:0)+"px":0});else if(this.options.position=="relative"){b=this.sourceContainer.cumulativeOffset();
e=b[1]+$value(this.options.offsetTop);b=b[0]+$value(this.options.offsetLeft);this.container.setStyle({top:a.height<=c.height?(this.options.constrainToViewport?Math.max(0,Math.min(c.height-a.height,e)):e)+"px":0,left:a.width<=c.width?(this.options.constrainToViewport?Math.max(0,Math.min(c.width-a.width,b)):b)+"px":0})}else if(this.options.position.length){e=$value(this.options.position[1])+$value(this.options.offsetTop);b=$value(this.options.position[0])+$value(this.options.offsetLeft);this.container.setStyle({top:a.height<=
c.height?(this.options.constrainToViewport?Math.max(0,Math.min(c.height-a.height,e)):e)+"px":0,left:a.width<=c.width?(this.options.constrainToViewport?Math.max(0,Math.min(c.width-a.width,b)):b)+"px":0})}this.iFrameShim&&this.updateIFrameShimZIndex()}},ensureInBounds:function(){if(this.isOpen){var a=document.viewport.getDimensions(),b=this.container.cumulativeOffset(),c=this.container.getDimensions();b.left+c.width>a.width&&this.container.setStyle({left:Math.max(0,a.width-c.width)+"px"});b.top+c.height>
a.height&&this.container.setStyle({top:Math.max(0,a.height-c.height)+"px"})}},bringToFront:function(){Control.Window.bringToFront(this);this.notify("bringToFront")},destroy:function(){this.container.stopObserving("mousedown",this.bringToFrontHandler);if(this.draggable){Resizables.removeObserver(this.container);this.draggable.handle.stopObserving("mousedown",this.bringToFrontHandler);this.draggable.destroy()}if(this.resizable){Resizables.removeObserver(this.container);this.resizable.handle.stopObserving("mousedown",
this.bringToFrontHandler);this.resizable.destroy()}this.container&&!this.sourceContainer&&this.container.remove();if(this.sourceContainer)if(this.options.hover){this.sourceContainer.stopObserving("mouseenter",this.sourceContainerOpenHandler);this.sourceContainer.stopObserving("mouseleave",this.sourceContainerCloseHandler);this.options.position=="mouse"&&this.sourceContainer.stopObserving("mousemove",this.sourceContainerMouseMoveHandler)}else this.sourceContainer.stopObserving("click",this.sourceContainerOpenHandler);
this.iFrameShim&&this.iFrameShim.destroy();Event.stopObserving(window,"resize",this.outOfBoundsPositionHandler);Control.Window.windows=Control.Window.windows.without(this);this.notify("afterDestroy")},applyResizable:function(){if(this.options.resizable){if(typeof Resizable=="undefined")throw"Control.Window requires resizable.js to be loaded.";var a=null;if(this.options.resizable===true){a=new Element("div",{className:"resizable_handle"});this.container.insert(a)}else a=$(this.options.resziable);this.resizable=
new Resizable(this.container,{handle:a,minHeight:this.options.minHeight,minWidth:this.options.minWidth,maxHeight:this.options.constrainToViewport?function(b){return document.viewport.getDimensions().height-parseInt(b.style.top||0)-(b.getHeight()-parseInt(b.style.height||0))}:this.options.maxHeight,maxWidth:this.options.constrainToViewport?function(b){return document.viewport.getDimensions().width-parseInt(b.style.left||0)-(b.getWidth()-parseInt(b.style.width||0))}:this.options.maxWidth});this.resizable.handle.observe("mousedown",
this.bringToFrontHandler);Resizables.addObserver(new Control.Window.LayoutUpdateObserver(this,function(){this.iFrameShim&&this.updateIFrameShimZIndex();this.notify("onResize")}.bind(this)))}},applyDraggable:function(){if(this.options.draggable){if(typeof Draggables=="undefined")throw"Control.Window requires dragdrop.js to be loaded.";var a=null;if(this.options.draggable===true){a=new Element("div",{className:"draggable_handle"});this.container.insert(a)}else a=$(this.options.draggable);this.draggable=
new Draggable(this.container,{handle:a,constrainToViewport:this.options.constrainToViewport,zindex:this.container.getStyle("z-index"),starteffect:function(){if(Prototype.Browser.IE){this.old_onselectstart=document.onselectstart;document.onselectstart=function(){return false}}}.bind(this),endeffect:function(){document.onselectstart=this.old_onselectstart}.bind(this)});this.draggable.handle.observe("mousedown",this.bringToFrontHandler);Draggables.addObserver(new Control.Window.LayoutUpdateObserver(this,
function(){this.iFrameShim&&this.updateIFrameShimZIndex();this.notify("onDrag")}.bind(this)))}},createDefaultContainer:function(a){if(!this.container){this.container=new Element("div",{id:"control_window_"+this.numberInSequence});$(document.body).insert(this.container);typeof a=="string"&&$(a)==null&&!a.match(/^#(.+)$/)&&!a.match(Control.Window.uriRegex)&&this.container.update(a)}},finishOpen:function(a){this.bringToFront();if(this.options.fade){if(typeof Effect=="undefined")throw"Control.Window requires effects.js to be loaded.";
this.effects.fade&&this.effects.fade.cancel();this.effects.appear=new Effect.Appear(this.container,{queue:{position:"end",scope:"Control.Window."+this.numberInSequence},from:0,to:1,duration:this.options.fadeDuration/2,afterFinish:function(){this.iFrameShim&&this.updateIFrameShimZIndex();this.isOpen=true;this.notify("afterOpen")}.bind(this)})}else this.container.show();this.position(a);if(!(this.options.draggable||this.options.resizable)&&this.options.position=="center")Event.observe(window,"resize",
this.positionHandler,false);!this.options.draggable&&this.options.position=="center"&&Event.observe(window,"scroll",this.positionHandler,false);if(!this.options.fade){this.isOpen=true;this.notify("afterOpen")}return true},showIndicator:function(){this.showIndicatorTimeout=window.setTimeout(function(){if(this.options.fade)this.indicatorEffects.appear=new Effect.Appear(this.indicator,{queue:{position:"front",scope:"Control.Window.indicator."+this.numberInSequence},from:0,to:1,duration:this.options.fadeDuration/
2});else this.indicator.show()}.bind(this),Control.Window.indicatorTimeout)},hideIndicator:function(){this.showIndicatorTimeout&&window.clearTimeout(this.showIndicatorTimeout);this.indicator.hide()},getRemoteContentInsertionTarget:function(){return typeof this.options.insertRemoteContentAt=="string"?this.container.down(this.options.insertRemoteContentAt):$(this.options.insertRemoteContentAt)},updateIFrameShimZIndex:function(){this.iFrameShim&&this.iFrameShim.positionUnder(this.container)}});
Object.extend(Control.Window,{windows:[],baseZIndex:9999,indicatorTimeout:250,iframeTemplate:new Template('<iframe src="#{href}" width="100%" height="100%" frameborder="0"></iframe>'),uriRegex:/^(\/|\#|https?\:\/\/|[\w]+\/)/,bringToFront:function(a){Control.Window.windows=Control.Window.windows.without(a);Control.Window.windows.push(a);Control.Window.windows.each(function(b,c){c=Control.Window.baseZIndex+c;b.container.setStyle({zIndex:c});b.isOpen&&b.iFrameShim&&b.updateIFrameShimZIndex();if(b.options.draggable)b.draggable.options.zindex=
c})},open:function(a,b){a=new Control.Window(a,b);a.open();return a},initialZIndexForWindow:function(){return Control.Window.baseZIndex+(Control.Window.windows.length-1)}});Object.Event.extend(Control.Window);
Control.Window.LayoutUpdateObserver=Class.create({initialize:function(a,b){this.w=a;this.element=$(a.container);this.observer=b},onStart:Prototype.emptyFunction,onEnd:function(a,b){b.element==this.element&&this.iFrameShim&&this.w.updateIFrameShimZIndex()},onResize:function(a,b){b.element==this.element&&this.observer(this.element)},onDrag:function(a,b){b.element==this.element&&this.observer(this.element)}});
Control.Overlay={id:"control_overlay",loaded:false,container:false,lastOpacity:0,styles:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:9998},ieStyles:{position:"absolute",top:0,left:0,zIndex:9998},effects:{fade:false,appear:false},load:function(){if(Control.Overlay.loaded)return false;Control.Overlay.loaded=true;Control.Overlay.container=new Element("div",{id:Control.Overlay.id});$(document.body).insert(Control.Overlay.container);if(Prototype.Browser.IE){Control.Overlay.container.setStyle(Control.Overlay.ieStyles);
Event.observe(window,"scroll",Control.Overlay.positionOverlay);Event.observe(window,"resize",Control.Overlay.positionOverlay);Control.Overlay.observe("beforeShow",Control.Overlay.positionOverlay)}else Control.Overlay.container.setStyle(Control.Overlay.styles);Control.Overlay.iFrameShim=new IframeShim;Control.Overlay.iFrameShim.hide();Event.observe(window,"resize",Control.Overlay.positionIFrameShim);Control.Overlay.container.hide();return true},unload:function(){if(!Control.Overlay.loaded)return false;
Event.stopObserving(window,"resize",Control.Overlay.positionOverlay);Control.Overlay.stopObserving("beforeShow",Control.Overlay.positionOverlay);Event.stopObserving(window,"resize",Control.Overlay.positionIFrameShim);Control.Overlay.iFrameShim.destroy();Control.Overlay.container.remove();Control.Overlay.loaded=false;return true},show:function(a,b){if(Control.Overlay.notify("beforeShow")===false)return false;Control.Overlay.lastOpacity=a;Control.Overlay.positionIFrameShim();Control.Overlay.iFrameShim.show();
if(b){if(typeof Effect=="undefined")throw"Control.Window requires effects.js to be loaded.";Control.Overlay.effects.fade&&Control.Overlay.effects.fade.cancel();Control.Overlay.effects.appear=new Effect.Appear(Control.Overlay.container,{queue:{position:"end",scope:"Control.Overlay"},afterFinish:function(){Control.Overlay.notify("afterShow")},from:0,to:Control.Overlay.lastOpacity,duration:(b===true?0.75:b)/2})}else{Control.Overlay.container.setStyle({opacity:a||1});Control.Overlay.container.show();
Control.Overlay.notify("afterShow")}return true},hide:function(a){if(Control.Overlay.notify("beforeHide")===false)return false;Control.Overlay.effects.appear&&Control.Overlay.effects.appear.cancel();Control.Overlay.iFrameShim.hide();if(a)Control.Overlay.effects.fade=new Effect.Fade(Control.Overlay.container,{queue:{position:"front",scope:"Control.Overlay"},afterFinish:function(){Control.Overlay.notify("afterHide")},from:Control.Overlay.lastOpacity,to:0,duration:(a===true?0.75:a)/2});else{Control.Overlay.container.hide();
Control.Overlay.notify("afterHide")}return true},positionIFrameShim:function(){Control.Overlay.container.visible()&&Control.Overlay.iFrameShim.positionUnder(Control.Overlay.container)},positionOverlay:function(){Control.Overlay.container.setStyle({width:document.body.clientWidth+"px",height:document.body.clientHeight+"px"})}};Object.Event.extend(Control.Overlay);
Control.ToolTip=Class.create(Control.Window,{initialize:function($super,b,c,e){$super(c,Object.extend(Object.extend(Object.clone(Control.ToolTip.defaultOptions),e||{}),{position:"mouse",hover:b}))}});Object.extend(Control.ToolTip,{defaultOptions:{offsetLeft:10}});Control.Modal=Class.create(Control.Window,{initialize:function($super,b,c){Control.Modal.InstanceMethods.beforeInitialize.bind(this)();$super(b,Object.extend(Object.clone(Control.Modal.defaultOptions),c||{}))}});
Object.extend(Control.Modal,{defaultOptions:{overlayOpacity:0.5,closeOnClick:"overlay"},current:false,open:function(a,b){a=new Control.Modal(a,b);a.open();return a},close:function(){Control.Modal.current&&Control.Modal.current.close()},InstanceMethods:{beforeInitialize:function(){Control.Overlay.load();this.overlayFinishedOpening=false;this.observe("beforeOpen",Control.Modal.Observers.beforeOpen.bind(this));this.observe("afterOpen",Control.Modal.Observers.afterOpen.bind(this));this.observe("afterClose",
Control.Modal.Observers.afterClose.bind(this))}},Observers:{beforeOpen:function(){if(this.overlayFinishedOpening)Control.Window.windows.without(this).invoke("close");else{Control.Overlay.observeOnce("afterShow",function(){this.overlayFinishedOpening=true;this.open()}.bind(this));Control.Overlay.show(this.options.overlayOpacity,this.options.fade?this.options.fadeDuration:false);throw $break;}},afterOpen:function(){Control.Modal.current=this},afterClose:function(){Control.Overlay.hide(this.options.fade?
this.options.fadeDuration:false);this.overlayFinishedOpening=Control.Modal.current=false}}});
Control.LightBox=Class.create(Control.Window,{initialize:function($super,b,c){this.allImagesLoaded=false;if(c.modal){c=Object.extend(Object.clone(Control.LightBox.defaultOptions),c||{});c=Object.extend(Object.clone(Control.Modal.defaultOptions),c);c=Control.Modal.InstanceMethods.beforeInitialize.bind(this)(c);$super(b,c)}else $super(b,Object.extend(Object.clone(Control.LightBox.defaultOptions),c||{}));(this.hasRemoteContent=this.href&&!this.options.iframe)?this.observe("onRemoteContentLoaded",Control.LightBox.Observers.onRemoteContentLoaded.bind(this)):
this.applyImageObservers();this.observe("beforeOpen",Control.LightBox.Observers.beforeOpen.bind(this))},applyImageObservers:function(){var a=this.getImages();this.numberImagesToLoad=a.length;this.numberofImagesLoaded=0;a.each(function(b){b.observe("load",function(){++this.numberofImagesLoaded;if(this.numberImagesToLoad==this.numberofImagesLoaded){this.allImagesLoaded=true;this.onAllImagesLoaded()}}.bind(this,b));b.hide()}.bind(this))},onAllImagesLoaded:function(){this.getImages().each(function(a){this.showImage(a)}.bind(this));
if(this.hasRemoteContent){this.options.indicator&&this.hideIndicator();this.finishOpen()}else this.open()},getImages:function(){return this.container.select(Control.LightBox.imageSelector)},showImage:function(a){a.show()}});Object.extend(Control.LightBox,{imageSelector:"img",defaultOptions:{},Observers:{beforeOpen:function(){if(!this.hasRemoteContent&&!this.allImagesLoaded)throw $break;},onRemoteContentLoaded:function(){this.applyImageObservers();if(!this.allImagesLoaded)throw $break;}}});function UserProfileHoverbox(){this.initialize()}
UserProfileHoverbox.prototype={initialize:function(){this._hoverboxCache={};this._timeout=this._currentHoverElement=this._currentUserAnchor=this._hoverbox=null;this._mouseOverHandler=this.handleMouseOverUser.bindAsEventListener(this);this.refreshMouseOverObservers()},refreshMouseOverObservers:function(){$$(".hover_profile",".hover_profile_simple").each(function(a){if(a.href!=undefined)a.observe("mouseover",this._mouseOverHandler);else{var b=a.down(".js_hover_profile_link");b!=undefined&&b.href!=undefined&&
a.observe("mouseover",this._mouseOverHandler)}}.bind(this))},handleMouseOverUser:function(a){var b=a.findElement("A")||a.findElement().down(".js_hover_profile_link")||null;if(b!=null)if(!(!b.hasClassName("js_hover_profile_link")&&!b.hasClassName("hover_profile")&&!b.hasClassName("hover_profile_simple")))if(!(b!=null&&this._currentUserAnchor!=null&&b.href==this._currentUserAnchor.href)){this.cancelOrCloseOpen();this._currentHoverElement=a.findElement(".hover_profile")||a.findElement(".hover_profile_simple");
this._currentUserAnchor=b;this._timeout=setTimeout(this.openHoverbox.bindAsEventListener(this),500);this._currentHoverElement.observe("mouseleave",this.cancelOrCloseOpen.bindAsEventListener(this))}},openHoverbox:function(){var a=this._currentHoverElement.cumulativeOffset();document.viewport.getDimensions();var b={},c=this._currentHoverElement.hasClassName("hover_profile_simple");if(c)b.simple="true";this._hoverbox=this._hoverboxCache[this._currentUserAnchor.href];if(this._hoverbox!=null&&this._hoverbox._is_simple!=
c){this._hoverbox.destroy();this._hoverbox=null;this._hoverboxCache[this._currentUserAnchor.href]=null}if(this._hoverbox==null){this._hoverbox=new Control.Window(this._currentUserAnchor,{method:"GET",parameters:b,offsetLeft:30,offsetTop:-22,className:"hover_profile_window"});this._hoverbox._is_simple=c;this._hoverbox.sourceContainer.stopObserving("click");this._hoverbox.observe("afterDestroy",this.handleBoxDestroy.bindAsEventListener(this,this._hoverbox))}this._hoverbox.observe("bringToFront",this.handleBoxBeforeOpen.bindAsEventListener(this));
this._hoverbox.observe("afterOpen",this.handleBoxOpened.bindAsEventListener(this));this._hoverbox.options.position=[a[0],a[1]];this._hoverbox.href+="/show_hover";this._hoverbox.open();this._currentHoverElement.stopObserving("mouseleave");this._currentHoverElement.observe("mouseleave",this.handleMouseLeaveUser.bindAsEventListener(this))},handleMouseLeaveUser:function(){if(this._hoverbox!=null)if(this._hoverbox.isOpen){this._currentHoverElement.stopObserving("mouseleave");this.startCloseTimeout()}else this.cancelOrCloseOpen()},
cancelOrCloseOpen:function(){if(this._hoverbox!=null){this._hoverbox.stopObserving("afterOpen");this._hoverbox.container.stopObserving("mouseenter");this._hoverbox.container.stopObserving("mouseleave");if(this._hoverbox.ajaxRequest){this._hoverbox.ajaxRequest.transport.abort();this._hoverbox.close();this._hoverbox.destroy()}else this._hoverbox.close();this._hoverbox=null}this._currentHoverElement=this._currentUserAnchor=null;this.cancelTimeout()},cancelTimeout:function(){if(this._timeout!=null){clearTimeout(this._timeout);
this._timeout=null}},startCloseTimeout:function(){this._timeout=setTimeout(this.mouseLeaveTimeout.bindAsEventListener(this),500)},mouseLeaveTimeout:function(){this.cancelOrCloseOpen()},handleBoxBeforeOpen:function(){var a=document.viewport.getDimensions();if(this._currentHoverElement.cumulativeOffset()[0]+this._currentHoverElement.getWidth()/2>a.width-440){this._hoverbox.options.offsetLeft=-this._hoverbox.container.getDimensions().width;$(this._hoverbox.container).addClassName("profile_left");$(this._hoverbox.container).removeClassName("profile_right")}else{this._hoverbox.options.offsetLeft=
this._currentHoverElement.getWidth()/2;$(this._hoverbox.container).addClassName("profile_right");$(this._hoverbox.container).removeClassName("profile_left")}},handleBoxOpened:function(){this._hoverboxCache[this._currentUserAnchor.href]=this._hoverbox;this._hoverbox.container.observe("mouseenter",this.cancelTimeout.bindAsEventListener(this));this._hoverbox.container.observe("mouseleave",this.startCloseTimeout.bindAsEventListener(this));var a=this._hoverbox.container.down(".mini_profile_bio");if(a!=
undefined){a.setStyle({width:a.getWidth()+"px"});a.show()}},handleBoxDestroy:function(a,b){b.container.remove()}};function registerHoverProfileObservers(){if(typeof userProfileHoverbox=="undefined")userProfileHoverbox=new UserProfileHoverbox;else userProfileHoverbox.refreshMouseOverObservers()}document.observe("dom:loaded",function(){registerHoverProfileObservers()});function FavoriteHoverbox(a,b,c,e,f){this.initialize(a,b,c,e,f)}
FavoriteHoverbox.prototype={initialize:function(a,b,c,e,f){var h="",l="";if(a==undefined)h="You have already earned the "+b+" point maximum for ratings per day. Come back tomorrow to rate more!";else if(c)if(a.rating>=4){h="You have updated your rating."+String(f||"");l="hover_add_favorite hover_long"}else h="You have updated your rating.";else if(a.rating>=4){h="Thanks. You just earned 1 point!"+String(f||"");l="hover_add_favorite hover_long"}else h="Sweet! You earned 1 point and improved your recommendations.";
setTimeout(function(){var p=$(e+"rating-indicator").next(".star-rating"),m;if(p==undefined)p=$$("#star_ratings_block"+e.sub("game","").sub("-","")+" .star-rating-big").first();p.addClassName("rating_message_hover_anchor");p.visible()||p.show();m=new Control.Window(null,{closeOnClick:true,position:"relative",offsetLeft:p.getWidth(),offsetTop:function(){return e=="quicklinks_"?p.getHeight()/2-m.container.getHeight()+12:p.getHeight()/2-12}});m.observe("afterClose",function(){m.destroy()});m.sourceContainer=
p;m.container.insert('<div class="'+(e=="quicklinks_"?"hover_high ":"")+"rating_message hover_item "+l+'"><div class="hover_arrow_1"></div><div class="hover_arrow_2"></div><div class="hover_container pas media"><span class="rating_icon spritesite img"></span><p class="bd">'+h+"</p></div></div>");m.open();setTimeout(function(){m.close()},5E3)},0)}};function LikesHoverbox(){this.initialize()}
LikesHoverbox.prototype={initialize:function(){this._hoverboxCache={};this._timeout=this._currentHoverElement=this._currentUserAnchor=this._hoverbox=null;this._mouseOverHandler=this.handleMouseOverUser.bindAsEventListener(this);this.refreshMouseOverObservers()},refreshMouseOverObservers:function(){$$(".like_count").each(function(a){a.observe("mouseover",this._mouseOverHandler)}.bind(this))},handleMouseOverUser:function(a){if(parseInt(a.target.innerHTML.gsub(/[()]/,""))!=0){this.cancelOrCloseOpen();
this._currentUserAnchor=this._currentHoverElement=a.target;this._timeout=setTimeout(this.openHoverbox.bindAsEventListener(this),500);this._currentHoverElement.observe("mouseleave",this.cancelOrCloseOpen.bindAsEventListener(this))}},openHoverbox:function(){var a=this._currentHoverElement.cumulativeOffset();document.viewport.getDimensions();var b={},c=this._currentHoverElement.up("li").id.sub("feed_item_",""),e=this._currentHoverElement.hasClassName("hover_profile_simple");this._likeHref="/user_likes?feed_item_id="+
c;if(e)b.simple="true";this._hoverbox=this._hoverboxCache[this._likeHref];if(this._hoverbox!=null){this._hoverbox.destroy();this._hoverbox=null;this._hoverboxCache[this._likeHref]=null}if(this._hoverbox==null){this._hoverbox=new Control.Window(this._currentUserAnchor,{method:"GET",parameters:b,offsetLeft:30,offsetTop:-22,className:"hover_likes_window"});this._hoverbox._is_simple=e;this._hoverbox.sourceContainer.stopObserving("click");this._hoverbox.observe("afterDestroy",this.handleBoxDestroy.bindAsEventListener(this,
this._hoverbox))}this._hoverbox.observe("bringToFront",this.handleBoxBeforeOpen.bindAsEventListener(this));this._hoverbox.observe("afterOpen",this.handleBoxOpened.bindAsEventListener(this));this._hoverbox.options.position=[a[0],a[1]];this._hoverbox.href="/user_likes?feed_item_id="+c;this._hoverbox.open();this._currentHoverElement.stopObserving("mouseleave");this._currentHoverElement.observe("mouseleave",this.handleMouseLeaveUser.bindAsEventListener(this))},handleMouseLeaveUser:function(){if(this._hoverbox!=
null)if(this._hoverbox.isOpen){this._currentHoverElement.stopObserving("mouseleave");this.startCloseTimeout()}else this.cancelOrCloseOpen()},cancelOrCloseOpen:function(){if(this._hoverbox!=null){this._hoverbox.stopObserving("afterOpen");this._hoverbox.container.stopObserving("mouseenter");this._hoverbox.container.stopObserving("mouseleave");if(this._hoverbox.ajaxRequest){this._hoverbox.ajaxRequest.transport.abort();this._hoverbox.close();this._hoverbox.destroy()}else this._hoverbox.close();this._hoverbox=
null}this._currentHoverElement=this._currentUserAnchor=null;this.cancelTimeout()},cancelTimeout:function(){if(this._timeout!=null){clearTimeout(this._timeout);this._timeout=null}},startCloseTimeout:function(){this._timeout=setTimeout(this.mouseLeaveTimeout.bindAsEventListener(this),500)},mouseLeaveTimeout:function(){this.cancelOrCloseOpen()},handleBoxBeforeOpen:function(){var a=document.viewport.getDimensions();if(this._currentHoverElement.cumulativeOffset()[0]+this._currentHoverElement.getWidth()/
2>a.width-440){this._hoverbox.options.offsetLeft=-this._hoverbox.container.getDimensions().width;$(this._hoverbox.container).addClassName("profile_left");$(this._hoverbox.container).removeClassName("profile_right")}else{this._hoverbox.options.offsetLeft=this._currentHoverElement.getWidth()/2;$(this._hoverbox.container).addClassName("profile_right");$(this._hoverbox.container).removeClassName("profile_left")}},handleBoxOpened:function(){this._hoverboxCache[this._likeHref]=this._hoverbox;this._hoverbox.container.observe("mouseenter",
this.cancelTimeout.bindAsEventListener(this));this._hoverbox.container.observe("mouseleave",this.startCloseTimeout.bindAsEventListener(this));var a=this._hoverbox.container.down(".mini_profile_bio");if(a!=undefined){a.setStyle({width:a.getWidth()+"px"});a.show()}},handleBoxDestroy:function(a,b){b.container.remove()}};function registerLikeObservers(){if(typeof likesHoverbox=="undefined")likesHoverbox=new LikesHoverbox;else likesHoverbox.refreshMouseOverObservers()}document.observe("dom:loaded",function(){registerLikeObservers()});function Roller(a){this.initialize(a)}
Roller.prototype={initialize:function(a){this._scrollDelay=a.scrollDelay;this._currentPane=0;this._paneScrollTimer=null;this._scrollDuration=a.scrollDuration?(a.scrollDuration||8E3)/1E3:1;this._effect=null;this._scrollablePane=$(a.scrollablePane)||$("featured_content_scrollable");this._scrollCallbacks=[];this._showDots=a.showDots==undefined?true:a.showDots;this._container=$(a.container);var b,c;if(a.targetableCountryCodes){b=".ind_pane.non_targeted";if(a.targetableCountryCodes.include(active_user.countryCode()))b+=", .ind_pane."+
active_user.countryCode()+"_only";if(active_user.countryCode()!="US")b+=", .ind_pane.Rest_Of_World_only"}else b=".ind_pane";this._panes=c=this._scrollablePane.select(b);this._scrollablePane.select(" .ind_pane").filter(function(e){return c.indexOf(e)<0}).each(Element.hide);if((this._nitems=c.length)&&!c[0].hasClassName("volatile")&&!c[0].hasClassName("loaded")){this._panes_loaded=[];this.loadPaneNumber(0)}a=c[0].clone(true);c[c.length-1].insert({after:a});c.push(a);this._panes_loaded=c.map(function(e){return e.match(".volatile, .loaded")})},
scrollToPane:function(a){this.loadPaneNumber(a);a=this._panes[a].positionedOffset();var b=this._scrollDuration;this._effect&&this._effect.cancel();this._effect=new Effect.Morph(this._scrollablePane,{style:"left:"+-a[0]+"px; top:0px;",duration:b});if(this._showDots&&this._container){this._container.down(".pane_dots").descendants().each(function(c){c.hasClassName("roller_dot")&&c.removeClassName("active_dot").addClassName("inactive_dot")});this._container.down(".pane_dots").down(".dot_"+(this._currentPane<
this._nitems?this._currentPane:0)).removeClassName("inactive_dot").addClassName("active_dot")}this._scrollCallbacks.each(function(c){c(this._currentPane)})},setPane:function(a){this.loadPaneNumber(a);var b=this._panes[a].positionedOffset();this._currentPane=a;this._effect&&this._effect.cancel();this._scrollablePane.setStyle({left:-b[0]+"px",top:"0px"})},loadPaneNumber:function(a){if(!this._panes_loaded[a]){var b=this._panes[a];this._panes_loaded[a]=true;b.update(Base64.decode(b.down(".pane_contents").innerHTML));
b.addClassName("loaded");$H(active_user.split_treatments.feature_roll).each(function(c){$$(".ind_pane."+c[0]+" div.featured_split_treatment").each(Element.hide);$$("."+c.join(" div.")).each(Element.show)})}},scrollToNextPane:function(){this.scrollToNextPaneAndStop();this.setNextPaneScrollTimeout()},scrollToNextPaneAndStop:function(){clearTimeout(this._paneScrollTimer);if(this._currentPane==this._nitems){this._currentPane=0;this.isEffectRunning()||this.setPane(this._currentPane)}this._currentPane++;
this.scrollToPane(this._currentPane)},scrollToPreviousPaneAndStop:function(){clearTimeout(this._paneScrollTimer);if(0==this._currentPane){this._currentPane=this._nitems;this.isEffectRunning()||this.setPane(this._currentPane)}this._currentPane--;this.scrollToPane(this._currentPane)},scrollToPreviousPane:function(){this.scrollToPreviousPaneAndStop();this.setNextPaneScrollTimeout()},setNextPaneScrollTimeout:function(){this._paneScrollTimer=setTimeout(this.scrollToNextPane.bind(this),this._scrollDelay)},
isEffectRunning:function(){return this._effect&&"finished"!=this._effect.state},addOnScrollObserver:function(a){this._scrollCallbacks.push(a)},paneCount:function(){return this._nitems}};Roller.rolodex={};function AjaxRoller(a){this.initialize(a)}AjaxRoller.prototype=Object.extend(AjaxRoller.prototype,Roller.prototype);
AjaxRoller.prototype=Object.extend(AjaxRoller.prototype,{loadPaneNumber:function(a){if(!this._panes_loaded[a]){var b=this,c=document.location.pathname.split("/")[2];new Ajax.Request("/accounts/"+c+"/games_pod",{method:"get",parameters:{page:this._currentPane},asynchronous:false,onSuccess:function(e){e=e.responseJSON;var f=b._panes[a];b._panes_loaded[a]=true;f.update(e.html);f.addClassName("loaded");active_user.isAdmin()&&$$(".admin_controls").each(Element.show)}})}}});AjaxRoller.rolodex={};var SocialHistory=function(a){function b(B,z,K){if(B.currentStyle)var P=B.currentStyle[K];else if(window.getComputedStyle)P=z.defaultView.getComputedStyle(B,null).getPropertyValue(K);return P}function c(B){B.parentNode.removeChild(B)}function e(){var B=document.createElement("iframe");B.style.position="absolute";B.style.visibility="hidden";document.body.appendChild(B);if(B.contentDocument)B.doc=B.contentDocument;else if(B.contentWindow)B.doc=B.contentWindow.document;B.doc.open();B.doc.write("<style>");
B.doc.write("a{color: #000000; display:none;}");B.doc.write("a:visited {color: #FF0000; display:inline;}");B.doc.write("</style>");B.doc.close();return B}function f(B){var z=m.doc.createElement("a");z.href=B;z.innerHTML=l;m.doc.body.appendChild(z)}var h={Digg:["http://digg.com","http://digg.com/login"],Reddit:["http://reddit.com","http://reddit.com/new/","http://reddit.com/controversial/","http://reddit.com/top/","http://reddit.com/r/reddit.com/","http://reddit.com/r/programming/"],StumbleUpon:["http://stumbleupon.com"],
"Yahoo Buzz":["http://buzz.yahoo.com"],Facebook:["http://facebook.com/home.php","http://facebook.com","https://login.facebook.com/login.php"],"Del.icio.us":["https://secure.del.icio.us/login","http://del.icio.us/"],MySpace:["http://www.myspace.com/"],Technorati:["http://www.technorati.com"],Newsvine:["https://www.newsvine.com","https://www.newsvine.com/_tools/user/login"],Songza:["http://songza.com"],Slashdot:["http://slashdot.org/"],"Ma.gnolia":["http://ma.gnolia.com/"],Blinklist:["http://www.blinklist.com"],
Furl:["http://furl.net","http://furl.net/members/login"],"Mister Wong":["http://www.mister-wong.com"],Current:["http://current.com","http://current.com/login.html"],Menaeme:["http://meneame.net","http://meneame.net/login.php"],Oknotizie:["http://oknotizie.alice.it","http://oknotizie.alice.it/login.html.php"],Diigo:["http://www.diigo.com/","https://secure.diigo.com/sign-in"],Funp:["http://funp.com","http://funp.com/account/loginpage.php"],Blogmarks:["http://blogmarks.net"],"Yahoo Bookmarks":["http://bookmarks.yahoo.com"],
Xanga:["http://xanga.com"],Blogger:["http://blogger.com"],"Last.fm":["http://www.last.fm/","https://www.last.fm/login/"],N4G:["http://www.n4g.com"],Faves:["http://faves.com","http://faves.com/home","https://secure.faves.com/signIn"],Simpy:["http://www.simpy.com","http://www.simpy.com/login"],Yigg:["http://www.yigg.de"],Kirtsy:["http://www.kirtsy.com","http://www.kirtsy.com/login.php"],Fark:["http://www.fark.com","http://cgi.fark.com/cgi/fark/users.pl?self=1"],Mixx:["https://www.mixx.com/login/dual",
"http://www.mixx.com"],"Google Bookmarks":["http://www.google.com/bookmarks","http://www.google.com/ig/add?moduleurl=bookmarks.xml&hl=en"],Subbmitt:["http://subbmitt.com/"],Twitter:["http://twitter.com","http://twitter.com/login"]};for(var l in a){if(typeof h[l]=="undefined")h[l]=[];if(typeof a[l]=="string")h[l].push(a[l]);else h[l]=h[l].concat(a[l])}var p={},m=e();for(l in h){var t=h[l];for(a=0;a<t.length;a++){f(t[a],l);if(t[a].match(/www\./)){var w=t[a].replace(/www\./,"");f(w,l)}else{w=t[a].indexOf("//")+
2;w=t[a].substring(0,w)+"www."+t[a].substring(w);f(w,l)}}}t=m.doc.body.childNodes;for(a=0;a<t.length;a++)if(b(t[a],m.doc,"display")!="none")p[t[a].innerHTML]=true;c(m);return new (function(){var B=[];for(var z in p)B.push(z);this.visitedSites=function(){return B};this.doesVisit=function(P){if(typeof h[P]=="undefined")return-1;return typeof p[P]!="undefined"};var K=[];for(z in h)K.push(z);this.checkedSites=function(){return K}})};function subjectChanged(a){if($("select_type")){var b=$F("select_type");b&&b!=""&&$("abuse_form_submit").enable();if(b=="OtherAbuseReport"||b=="InappropriateChatReport"||b=="UnderageUserReport"||b=="PermabanRequest"){$("description_field").show();updateDescriptionPrompt(true,a)}if(b=="InappropriateUsernameReport"||b=="InappropriateAvatarReport"||b=="InappropriateProfileReport"){$("description_field").show();updateDescriptionPrompt(false,a)}}}
function updateDescriptionPrompt(a,b){b="Please describe your reason for reporting "+b+" using as much detail as possible";var c=$("abuse_report_description_label_block").innerHTML;a=a?c.gsub("Please add any other information that would be helpful",b):c.gsub(b,"Please add any other information that would be helpful");$("abuse_report_description_label_block").update(a)};function upd(a,b,c){if(a.checked||c=="always"){if(c){index=a.id.substring(a.id.indexOf("[")+1,a.id.indexOf("]"));radio_id="handle["+index+"]";$(radio_id).checked="handle"}b&&b.show()}else b&&b.hide()};function AgeGate(a,b){a&&b?this.initialize(a,b):this.initialize(null,a)}AgeGate.MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];
AgeGate.prototype={initialize:function(a,b){var c=this;this._cookie_name=b.cookie_name||"age_gate";this._active_user=b.active_user||active_user;this._required_age=b.required_age;this._age_met=false;if(this._use_form=b.use_form===undefined?true:b.use_form){this._element=$(a);this._button_text=b.button_text||"Go"}this._onSuccess=(b.onSuccess||function(){}).wrap(function(e){c._age_met=true;Cookie.set(c._cookie_name,"YES");return e()});this._onFailure=(b.onFailure||function(){}).wrap(function(e){Cookie.set(c._cookie_name,
"NO");return e()});this._onError=b.onError||function(){};this.preflight()||this._age_met||(this._use_form?this.writeForm():this._onFailure())},preflight:function(){var a=this._active_user.age();if(a){a>=this._required_age?this._onSuccess():this._onFailure();return true}a=Cookie.get(this._cookie_name);if(a=="YES"){this._onSuccess();return true}else if(a=="NO"){this._onFailure();return true}return false},writeForm:function(){var a=this,b="",c=0;b='<form action="#">';b+="<dl>";b+="<dt><label>Date of Birth</label></dt>";
b+='<dd id="date">';b+='<select id="user_month" name="user_month">';b+='<option value=""></option>';for(c=0;c<AgeGate.MONTHS.length;c++)b+='<option value="'+c+'">'+AgeGate.MONTHS[c]+"</option>";b+="</select>";b+='<select id="user_day" name="user_day">';b+='<option value=""></option>';for(c=1;c<=31;c++)b+='<option value="'+c+'">'+c+"</option>";b+="</select>";b+='<select id="user_year" name="user_year">';b+='<option value=""></option>';for(c=2005;c>=1908;c--)b+='<option value="'+c+'">'+c+"</option>";
b+="</select>";b+="</dd>";b+="</dl>";b+='<input type="submit" value="'+this._button_text+'" />';b+="</form>";this._element.innerHTML+=b;(function(){a._element.immediateDescendants()[0].onsubmit=function(){a.checkAge(this);return false}}).defer()},checkAge:function(a){var b=Number(a.user_month.getValue()),c=Number(a.user_day.getValue());a=Number(a.user_year.getValue());if(isNaN(b)||c===0||a===0)this._onError();else{b=new Date(a+this._required_age,b,c);(new Date).getTime()-b.getTime()<0?this._onFailure():
this._onSuccess()}}};AvailabilityCheck=function(a,b){this.initialize(a,b)};
AvailabilityCheck.prototype={initialize:function(a,b){b||(b={});this.request=null;this.generatedUsername=b.generatedUsername;this.validateLength=!!b.validateLength;this.clear=b.clear||function(){$("availability_success").hide();$("availability_failure").hide()};this.success=b.success||function(){$("availability_success").show()};this.failure=b.failure||function(c){$("availability_failure").update(c).show()};Event.observe(a,"keyup",this.keyup.bind(this));Event.observe(a,"blur",this.blur.bind(this))},
blur:function(a){this.makeRequest(a)},keyup:function(a){if(this.request){this.request.transport.abort();this.request=null;$("checking_availability").hide()}this.checker&&clearTimeout(this.checker);this.checker=setTimeout(this.makeRequest.bind(this,a),1E3)},makeRequest:function(a){var b=this,c=a.target.value;if(this.generatedUsername&&this.generatedUsername==c){this.clear();this.success()}else if(c.length==0){this.validateLength&&this.clear();b.failure("Username can't be blank")}else if(c.length<4){this.validateLength&&
this.clear();b.failure("Username is too short, needs to be between 4 to 16 characters")}else if(c.length>16){this.validateLength&&this.clear();b.failure("Username is too long, needs to be between 4 to 16 characters")}else if(this.request==null){$("checking_availability").show();this.clear();this.request=new Ajax.Request("/accounts/availability",{parameters:{username:a.target.value},method:"get",onSuccess:function(e){e=String(e.responseText).evalJSON();$("checking_availability").hide();e.success?b.success():
b.failure("Username taken. Please try again.")}})}}};function hideAllButOne(a,b){$$(a).each(function(c){Element.hide(c)});Element.show(b)};Base64=function(){var a=function(c){c=c.replace(/\r\n/g,"\n");var e="",f,h,l;f=0;for(h=c.length;f<h;f++){l=c.charCodeAt(f);if(l<128)e+=String.fromCharCode(l);else{if(l>127&&l<2048)e+=String.fromCharCode(l>>6|192);else{e+=String.fromCharCode(l>>12|224);e+=String.fromCharCode(l>>6&63|128)}e+=String.fromCharCode(l&63|128)}}return e},b=function(c){for(var e="",f=0,h=c1=c2=0;f<c.length;){h=c.charCodeAt(f);if(h<128){e+=String.fromCharCode(h);f++}else if(h>191&&h<224){c2=c.charCodeAt(f+1);e+=String.fromCharCode((h&
31)<<6|c2&63);f+=2}else{c2=c.charCodeAt(f+1);c3=c.charCodeAt(f+2);e+=String.fromCharCode((h&15)<<12|(c2&63)<<6|c3&63);f+=3}}return e};return{encode:function(c){var e="",f,h,l,p,m,t,w=0;for(c=a(c);w<c.length;){f=c.charCodeAt(w++);h=c.charCodeAt(w++);l=c.charCodeAt(w++);p=f>>2;f=(f&3)<<4|h>>4;m=(h&15)<<2|l>>6;t=l&63;if(isNaN(h))m=t=64;else if(isNaN(l))t=64;e=e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t)}return e},decode:function(c){var e="",f,h,l,p,m,t=0;for(c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");t<c.length;){f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(t++));h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(t++));p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(t++));
m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(t++));f=f<<2|h>>4;h=(h&15)<<4|p>>2;l=(p&3)<<6|m;e+=String.fromCharCode(f);if(p!=64)e+=String.fromCharCode(h);if(m!=64)e+=String.fromCharCode(l)}return e=b(e)}}}();Array.prototype.binarySearch=function(a,b,c){b||(b=function(p,m){return p==m?0:p<m?-1:1});for(var e=0,f=this.length-1,h,l;e<=f;){h=Math.floor((e+f)/2);l=b(this[h],a);if(l<0)e=h+1;else if(l>0)f=h-1;else return h}if(c)return e;return-1};Array.prototype.orderedInsert=function(a,b){b=this.binarySearch(a,b,true);this.splice(b,0,a);return b};Array.prototype.orderedDelete=function(a,b){a=this.binarySearch(a,b);a>=0&&this.splice(a,1);return a};var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,e=a[b].prop;this.versionSearchString=a[b].versionSearch||a[b].identity;if(c){if(c.indexOf(a[b].subString)!=-1)return a[b].identity}else if(e)return a[b].identity}},
searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b!=-1)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,
subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},
{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};CampaignAvatarPicker=function(a){var b=function(c){var e=(c.element().up("a")||c.element()).readAttribute("data-avatar-id"),f="/accounts/"+active_user.username()+"/pick_campaign_avatar";if(active_user.isAuthenticated())new Ajax.Request(f,{parameters:{campaign_avatar_id:e,authenticity_token:active_user.formAuthenticityToken()},onCreate:function(){var h=$$(a).first();h.insert({after:new Element("img",{src:"/images/presentation/indicator_barbershop.gif",id:"campaign-avatar-picker-indicator"})});h.hide()},
onSuccess:function(){window.location.reload()},onFailure:function(){alert("Sorry! We were unable to change your avatar. Please try again later.");$$(a).first().show();$("campaign-avatar-picker-indicator").remove()}});else active_user.activateInlineLogin({},true);c.preventDefault()};$$(a+" li a").each(function(c){c.observe("click",b)})};function onClickablePodClick(a){if("A"!=a.element().nodeName){a=a.element();if(a=a.hasClassName("js_clickable_pod")?a:a.up(".js_clickable_pod")){a=a.down(".js_clickable_pod_link");document.location=a.href}}}function observeClickablePods(){$$(".js_clickable_pod").each(function(a){a.observe("click",onClickablePodClick)})};if(Object.isUndefined(Effect))throw"dragdrop.js requires including script.aculo.us' effects.js library";
var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(a,b){a=$(a);var c=Object.extend({greedy:true,hoverclass:null,tree:false},b||{});if(c.containment){c._containers=[];b=c.containment;Object.isArray(b)?b.each(function(e){c._containers.push($(e))}):c._containers.push($(b))}if(c.accept)c.accept=[c.accept].flatten();Element.makePositioned(a);c.element=a;this.drops.push(c)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i)if(Element.isParent(a[i].element,
deepest.element))deepest=a[i];return deepest},isContained:function(a,b){var c;c=b.tree?a.treeNode:a.parentNode;return b._containers.detect(function(e){return c==e})},isAffected:function(a,b,c){return c.element!=b&&(!c._containers||this.isContained(b,c))&&(!c.accept||Element.classNames(b).detect(function(e){return c.accept.include(e)}))&&Position.within(c.element,a[0],a[1])},deactivate:function(a){a.hoverclass&&Element.removeClassName(a.element,a.hoverclass);this.last_active=null},activate:function(a){a.hoverclass&&
Element.addClassName(a.element,a.hoverclass);this.last_active=a},show:function(a,b){if(this.drops.length){var c,e=[];this.drops.each(function(f){Droppables.isAffected(a,b,f)&&e.push(f)});if(e.length>0)c=Droppables.findDeepestChild(e);this.last_active&&this.last_active!=c&&this.deactivate(this.last_active);if(c){Position.within(c.element,a[0],a[1]);c.onHover&&c.onHover(b,c.element,Position.overlap(c.overlap,c.element));c!=this.last_active&&Droppables.activate(c)}}},fire:function(a,b){if(this.last_active){Position.prepare();
if(this.isAffected([Event.pointerX(a),Event.pointerY(a)],b,this.last_active))if(this.last_active.onDrop){this.last_active.onDrop(b,this.last_active.element,a);return true}}},reset:function(){this.last_active&&this.deactivate(this.last_active)}},Draggables={drags:[],observers:[],register:function(a){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);
Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(a){if(a.options.delay)this._timeout=
setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay);else{window.focus();this.activeDraggable=a}},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(this.activeDraggable){var b=[Event.pointerX(a),Event.pointerY(a)];if(!(this._lastPointer&&this._lastPointer.inspect()==b.inspect())){this._lastPointer=b;this.activeDraggable.updateDrag(a,b)}}},endDrag:function(a){if(this._timeout){clearTimeout(this._timeout);this._timeout=
null}if(this.activeDraggable){this._lastPointer=null;this.activeDraggable.endDrag(a);this.activeDraggable=null}},keyPress:function(a){this.activeDraggable&&this.activeDraggable.keyPress(a)},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(a,b,c){this[a+"Count"]>0&&this.observers.each(function(e){e[a]&&e[a](a,b,c)});b.options[a]&&
b.options[a](b,c)},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}},Draggable=Class.create({initialize:function(a,b){var c={handle:false,reverteffect:function(e,f,h){var l=Math.sqrt(Math.abs(f^2)+Math.abs(h^2))*0.02;new Effect.Move(e,{x:-h,y:-f,duration:l,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var f=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,
{duration:0.2,from:0.7,to:f,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=false}})},zindex:1E3,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!b||Object.isUndefined(b.endeffect))Object.extend(c,{starteffect:function(e){e._opacity=Element.getOpacity(e);Draggable._dragging[e]=true;new Effect.Opacity(e,{duration:0.2,from:e._opacity,to:0.7})}});b=Object.extend(c,b||{});this.element=$(a);if(b.handle&&Object.isString(b.handle))this.handle=
this.element.down("."+b.handle,0);if(!this.handle)this.handle=$(b.handle);if(!this.handle)this.handle=this.element;if(b.scroll&&!b.scroll.scrollTo&&!b.scroll.outerHTML){b.scroll=$(b.scroll);this._isScrollChild=Element.childOf(this.element,b.scroll)}Element.makePositioned(this.element);this.options=b;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,
"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return[parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]},initDrag:function(a){if(!(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]))if(Event.isLeftClick(a))if(!((tag_name=Event.element(a).tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA"))){var b=
[Event.pointerX(a),Event.pointerY(a)],c=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(e){return b[e]-c[e]});Draggables.activate(this);Event.stop(a)}},startDrag:function(a){this.dragging=true;if(!this.delta)this.delta=this.currentDelta();if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);(this._originallyAbsolute=this.element.getStyle("position")==
"absolute")||Position.absolutize(this.element);this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll)if(this.options.scroll==window){var b=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=b.left;this.originalScrollTop=b.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}Draggables.notify("onStart",this,a);this.options.starteffect&&this.options.starteffect(this.element)},updateDrag:function(a,
b){this.dragging||this.startDrag(a);if(!this.options.quiet){Position.prepare();Droppables.show(b,this.element)}Draggables.notify("onDrag",this,a);this.draw(b);this.options.change&&this.options.change(this);if(this.options.scroll){this.stopScrolling();var c;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll))c=[left,top,left+width,top+height];else{c=Position.page(this.options.scroll);c[0]+=this.options.scroll.scrollLeft+Position.deltaX;c[1]+=this.options.scroll.scrollTop+
Position.deltaY;c.push(c[0]+this.options.scroll.offsetWidth);c.push(c[1]+this.options.scroll.offsetHeight)}var e=[0,0];if(b[0]<c[0]+this.options.scrollSensitivity)e[0]=b[0]-(c[0]+this.options.scrollSensitivity);if(b[1]<c[1]+this.options.scrollSensitivity)e[1]=b[1]-(c[1]+this.options.scrollSensitivity);if(b[0]>c[2]-this.options.scrollSensitivity)e[0]=b[0]-(c[2]-this.options.scrollSensitivity);if(b[1]>c[3]-this.options.scrollSensitivity)e[1]=b[1]-(c[3]-this.options.scrollSensitivity);this.startScrolling(e)}Prototype.Browser.WebKit&&
window.scrollBy(0,0);Event.stop(a)},finishDrag:function(a,b){this.dragging=false;if(this.options.quiet){Position.prepare();var c=[Event.pointerX(a),Event.pointerY(a)];Droppables.show(c,this.element)}if(this.options.ghosting){this._originallyAbsolute||Position.relativize(this.element);delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null}c=false;if(b)(c=Droppables.fire(a,this.element))||(c=false);c&&this.options.onDropped&&this.options.onDropped(this.element);Draggables.notify("onEnd",
this,a);if((a=this.options.revert)&&Object.isFunction(a))a=a(this.element);b=this.currentDelta();if(a&&this.options.reverteffect){if(c==0||a!="failure")this.options.reverteffect(this.element,b[1]-this.delta[1],b[0]-this.delta[0])}else this.delta=b;if(this.options.zindex)this.element.style.zIndex=this.originalZ;this.options.endeffect&&this.options.endeffect(this.element);Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){if(a.keyCode==Event.KEY_ESC){this.finishDrag(a,false);Event.stop(a)}},
endDrag:function(a){if(this.dragging){this.stopScrolling();this.finishDrag(a,true);Event.stop(a)}},draw:function(a){var b=Position.cumulativeOffset(this.element);if(this.options.ghosting){var c=Position.realOffset(this.element);b[0]+=c[0]-Position.deltaX;b[1]+=c[1]-Position.deltaY}c=this.currentDelta();b[0]-=c[0];b[1]-=c[1];if(this.options.scroll&&this.options.scroll!=window&&this._isScrollChild){b[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;b[1]-=this.options.scroll.scrollTop-this.originalScrollTop}c=
[0,1].map(function(f){return a[f]-b[f]-this.offset[f]}.bind(this));if(this.options.snap)c=Object.isFunction(this.options.snap)?this.options.snap(c[0],c[1],this):Object.isArray(this.options.snap)?c.map(function(f,h){return(f/this.options.snap[h]).round()*this.options.snap[h]}.bind(this)):c.map(function(f){return(f/this.options.snap).round()*this.options.snap}.bind(this));var e=this.element.style;if(!this.options.constraint||this.options.constraint=="horizontal")e.left=c[0]+"px";if(!this.options.constraint||
this.options.constraint=="vertical")e.top=c[1]+"px";if(e.visibility=="hidden")e.visibility=""},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(a){if(a[0]||a[1]){this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed];this.lastScrolled=new Date;this.scrollInterval=setInterval(this.scroll.bind(this),10)}},scroll:function(){var a=new Date,b=a-this.lastScrolled;
this.lastScrolled=a;if(this.options.scroll==window)with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){a=b/1E3;this.options.scroll.scrollTo(left+a*this.scrollSpeed[0],top+a*this.scrollSpeed[1])}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*b/1E3;this.options.scroll.scrollTop+=this.scrollSpeed[1]*b/1E3}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=
Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*b/1E3;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*b/1E3;if(Draggables._lastScrollPointer[0]<0)Draggables._lastScrollPointer[0]=0;if(Draggables._lastScrollPointer[1]<0)Draggables._lastScrollPointer[1]=0;this.draw(Draggables._lastScrollPointer)}this.options.change&&this.options.change(this)},_getWindowScroll:function(a){var b,c,e;with(a.document){if(a.document.documentElement&&
documentElement.scrollTop){b=documentElement.scrollTop;c=documentElement.scrollLeft}else if(a.document.body){b=body.scrollTop;c=body.scrollLeft}if(a.innerWidth){e=a.innerWidth;a=a.innerHeight}else if(a.document.documentElement&&documentElement.clientWidth){e=documentElement.clientWidth;a=documentElement.clientHeight}else{e=body.offsetWidth;a=body.offsetHeight}}return{top:b,left:c,width:e,height:a}}});Draggable._dragging={};
var SortableObserver=Class.create({initialize:function(a,b){this.element=$(a);this.observer=b;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();this.lastValue!=Sortable.serialize(this.element)&&this.observer(this.element)}}),Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){for(;a.tagName.toUpperCase()!="BODY";){if(a.id&&Sortable.sortables[a.id])return a;
a=a.parentNode}},options:function(a){if(a=Sortable._findRootElement($(a)))return Sortable.sortables[a.id]},destroy:function(a){a=$(a);if(a=Sortable.sortables[a.id]){Draggables.removeObserver(a.element);a.droppables.each(function(b){Droppables.remove(b)});a.draggables.invoke("destroy");delete Sortable.sortables[a.element.id]}},create:function(a,b){a=$(a);var c=Object.extend({element:a,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:a,handle:false,
only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},b||{});this.destroy(a);var e={revert:true,quiet:c.quiet,scroll:c.scroll,scrollSpeed:c.scrollSpeed,scrollSensitivity:c.scrollSensitivity,delay:c.delay,ghosting:c.ghosting,constraint:c.constraint,handle:c.handle};if(c.starteffect)e.starteffect=c.starteffect;if(c.reverteffect)e.reverteffect=
c.reverteffect;else if(c.ghosting)e.reverteffect=function(l){l.style.top=0;l.style.left=0};if(c.endeffect)e.endeffect=c.endeffect;if(c.zindex)e.zindex=c.zindex;var f={overlap:c.overlap,containment:c.containment,tree:c.tree,hoverclass:c.hoverclass,onHover:Sortable.onHover},h={onHover:Sortable.onEmptyHover,overlap:c.overlap,containment:c.containment,hoverclass:c.hoverclass};Element.cleanWhitespace(a);c.draggables=[];c.droppables=[];if(c.dropOnEmpty||c.tree){Droppables.add(a,h);c.droppables.push(a)}(c.elements||
this.findElements(a,c)||[]).each(function(l,p){p=c.handles?$(c.handles[p]):c.handle?$(l).select("."+c.handle)[0]:l;c.draggables.push(new Draggable(l,Object.extend(e,{handle:p})));Droppables.add(l,f);if(c.tree)l.treeNode=a;c.droppables.push(l)});if(c.tree)(Sortable.findTreeElements(a,c)||[]).each(function(l){Droppables.add(l,h);l.treeNode=a;c.droppables.push(l)});this.sortables[a.id]=c;Draggables.addObserver(new SortableObserver(a,c.onUpdate))},findElements:function(a,b){return Element.findChildren(a,
b.only,b.tree?true:false,b.tag)},findTreeElements:function(a,b){return Element.findChildren(a,b.only,b.tree?true:false,b.treeTag)},onHover:function(a,b,c){if(!Element.isParent(b,a))if(!(c>0.33&&c<0.66&&Sortable.options(b).tree))if(c>0.5){Sortable.mark(b,"before");if(b.previousSibling!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,b);b.parentNode!=c&&Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}else{Sortable.mark(b,"after");var e=b.nextSibling||
null;if(e!=a){c=a.parentNode;a.style.visibility="hidden";b.parentNode.insertBefore(a,e);b.parentNode!=c&&Sortable.options(c).onChange(a);Sortable.options(b.parentNode).onChange(a)}}},onEmptyHover:function(a,b,c){var e=a.parentNode,f=Sortable.options(b);if(!Element.isParent(b,a)){var h=Sortable.findElements(b,{tag:f.tag,only:f.only}),l=null;if(h){var p=Element.offsetSize(b,f.overlap)*(1-c);for(c=0;c<h.length;c+=1)if(p-Element.offsetSize(h[c],f.overlap)>=0)p-=Element.offsetSize(h[c],f.overlap);else{l=
p-Element.offsetSize(h[c],f.overlap)/2>=0?c+1<h.length?h[c+1]:null:h[c];break}}b.insertBefore(a,l);Sortable.options(e).onChange(a);f.onChange(a)}},unmark:function(){Sortable._marker&&Sortable._marker.hide()},mark:function(a,b){var c=Sortable.options(a.parentNode);if(!(c&&!c.ghosting)){if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var e=
Position.cumulativeOffset(a);Sortable._marker.setStyle({left:e[0]+"px",top:e[1]+"px"});if(b=="after")c.overlap=="horizontal"?Sortable._marker.setStyle({left:e[0]+a.clientWidth+"px"}):Sortable._marker.setStyle({top:e[1]+a.clientHeight+"px"});Sortable._marker.show()}},_tree:function(a,b,c){for(var e=Sortable.findElements(a,b)||[],f=0;f<e.length;++f){var h=e[f].id.match(b.format);if(h){h={id:encodeURIComponent(h?h[1]:null),element:a,parent:c,children:[],position:c.children.length,container:$(e[f]).down(b.treeTag)};
h.container&&this._tree(h.container,b,h);c.children.push(h)}}return c},tree:function(a,b){a=$(a);var c=this.options(a);b=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:a.id,format:c.format},b||{});return Sortable._tree(a,b,{id:null,parent:null,children:[],container:a,position:0})},_constructIndex:function(a){var b="";do if(a.id)b="["+a.position+"]"+b;while((a=a.parent)!=null);return b},sequence:function(a,b){a=$(a);var c=Object.extend(this.options(a),b||{});return $(this.findElements(a,
c)||[]).map(function(e){return e.id.match(c.format)?e.id.match(c.format)[1]:""})},setSequence:function(a,b,c){a=$(a);var e=Object.extend(this.options(a),c||{}),f={};this.findElements(a,e).each(function(h){if(h.id.match(e.format))f[h.id.match(e.format)[1]]=[h,h.parentNode];h.parentNode.removeChild(h)});b.each(function(h){var l=f[h];if(l){l[1].appendChild(l[0]);delete f[h]}})},serialize:function(a,b){a=$(a);var c=Object.extend(Sortable.options(a),b||{}),e=encodeURIComponent(b&&b.name?b.name:a.id);return c.tree?
Sortable.tree(a,b).children.map(function(f){return[e+Sortable._constructIndex(f)+"[id]="+encodeURIComponent(f.id)].concat(f.children.map(arguments.callee))}).flatten().join("&"):Sortable.sequence(a,b).map(function(f){return e+"[]="+encodeURIComponent(f)}).join("&")}};Element.isParent=function(a,b){if(!a.parentNode||a==b)return false;if(a.parentNode==b)return true;return Element.isParent(a.parentNode,b)};
Element.findChildren=function(a,b,c,e){if(!a.hasChildNodes())return null;e=e.toUpperCase();if(b)b=[b].flatten();var f=[];$A(a.childNodes).each(function(h){if(h.tagName&&h.tagName.toUpperCase()==e&&(!b||Element.classNames(h).detect(function(l){return b.include(l)})))f.push(h);if(c)(h=Element.findChildren(h,b,c,e))&&f.push(h)});return f.length>0?f.flatten():[]};Element.offsetSize=function(a,b){return a["offset"+(b=="vertical"||b=="height"?"Height":"Width")]};DynamicFrameTarget=function(a){this.initialize(a)};
DynamicFrameTarget.prototype={initialize:function(a){this.name="dynamic_frame_"+ +new Date;this.frame=new Element("iframe",{name:this.name,id:this.name});$(document.body).insert(this.frame);this.frame.setStyle({display:"none"});a.form.target=this.name;var b=this,c=function(){var e;if(this.contentDocument)e=this.contentDocument;else if(this.contentWindow)e=this.contentWindow.document;else if(window.frames[this.name])e=window.frames[iframe.name].document;else if(b.frame.contentWindow.document)e=b.frame.contentWindow.document;
if(e&&e.body.innerHTML.length>0){e=e.body;e=String((e.childElementCount>0?e.children[0]:e).innerHTML).evalJSON();b.callback(e)}};if(this.frame.attachEvent)this.frame.attachEvent("onload",c);else this.frame.onload=c;this.callback=a.callback?a.callback:function(e){if(e.success)a.success&&a.success(e);else a.failure&&a.failure(e)}}};DynamicFrameTarget.subclasses=[];var FacebookApiLoader=function(){function a(m){m.status==="connected"&&m.authResponse.userID==active_user.facebook_uid()&&c(m.authResponse)}function b(){FB.getLoginStatus(a)}function c(m){var t=(new Element("form",{action:"https://"+location.hostname+"/facebook_connection/update_auth_token",method:"post"})).setStyle({display:"none"});$(document.body).insert(t);t.insert(new Element("input",{type:"hidden",name:"access_token",value:m.accessToken}));t.insert(new Element("input",{type:"hidden",name:"expires",
value:m.expiresIn}));new DynamicFrameTarget({form:t});t.submit()}function e(m,t){var w=new Element("div",{id:"fb-root"}),B=new Element("script",{async:true,src:window.location.protocol+"//connect.facebook.net/en_US/all.js"});p.app_id=m;$$(".js_facebook_like_button").each(function(z){var K=active_user.valueOfSearchParameter,P=(Math.floor(K("km_generation"))||-1)+1,F=new Template(z.innerHTML),I=active_user.siteVisitorUID();z.replace(F.evaluate({url:Object.toQueryString({kme:"Followed fb_like",source:"fb_like",
km_orig_source:K("km_orig_source")||"fb_like",km_prev_source:K("km_source")||K("source"),km_orig_person:K("km_orig_person")||I,km_prev_person:I,km_generation:P})}))});window.fbAsyncInit=function(){FB.init({appId:m,status:true,cookie:true,xfbml:true,channelUrl:t,oauth:true});l=true;h.each(function(z){z()});active_user.facebookAccessTokenNeedsUpdate()&&b()};$$("head")[0].insert(w);w.insert(B)}function f(m){l?m():h.push(m)}var h=[],l=false,p;return p={populate:e,addApiLoadedCallback:f,updateLoginStatus:b}}();var facebook_api_timeout=5E3,FacebookApiWrapper=function(){function a(e,f){return function(h){if(c){clearTimeout(f);e(h)}}}function b(e){c=true;return setTimeout(function(){c=false;e&&e()},facebook_api_timeout)}var c;return{api:function(e,f,h){h=b(h);FB.api(e,a(f,h))}}}();var FacebookAuthenticator=function(a){a||(a={});if(active_user.isGamePage())a.game_id=active_user.gameId();if($("welcome_remember_me")&&$("welcome_remember_me").checked)a.remember_me=true;disableFacebookButtons();window.open("https://"+location.hostname+"/auth/facebook?state="+encodeURIComponent($H(a).toQueryString()),"Log in with Facebook","menubar=no,toolbar=no,status=no,width=600,height=400")};
$(document).observe("dom:loaded",function(){FacebookApiLoader.addApiLoadedCallback(function(){window.location.toString();!active_user.isAuthenticated()&&!Cookie.get("FacebookLoginAttempt")&&FB.getLoginStatus(function(a){a.status=="connected"&&new Ajax.Request("/facebook_connection/status",{method:"get",parameters:{uid:a.authResponse.userID},onSuccess:function(b){if(b.responseJSON.status=="linked"){Cookie.set("FacebookLoginAttempt",true);if(active_user.isGamePage()){b=(new Element("form",{action:"/accounts/status",
method:"get"})).setStyle({display:"none"});$(document.body).insert(b);new DynamicFrameTarget({form:b,success:function(c){setActiveUser(c)}});b.insert(new Element("input",{type:"hidden",name:"from_facebook",value:true}));b.insert(new Element("input",{type:"hidden",name:"game_id",value:active_user.gameId()}));b.insert(new Element("input",{type:"hidden",name:"authenticity_token",value:active_user.formAuthenticityToken()}));b.insert(new Element("input",{type:"hidden",name:"existing_user",value:true}));
b.submit()}else{lightbox.prototype.initializeKongregateLightboxFromContent('<div class="fb_oauth_content"><span class="med_fb_logo spritesite">Facebook</span><h1 class="mbl">Just a moment</h1><p class="regtextLrg">Signing you back into your Kongregate account&hellip; <br/>automatically!</p></div>',{done_class_name:"lightbox_login"});window.location.reload()}}}})})})});var FacebookFriendFinder=function(a){var b=this;FB.getLoginStatus(function(c){c.status==="connected"&&FB.api("me/friends",function(e){var f=$A(e.data).pluck("id");e&&new Ajax.Request("/facebook_connection/friends",{parameters:{"uid[]":f},onSuccess:function(h){b.friends=h.responseJSON;a(b)}})})},true)};
FacebookFriendFinder.prototype.clickFriend=function(a){if(a.hasClassName("selected")){a.removeClassName("selected");a.down("input").checked=false}else{a.addClassName("selected");a.down("input").checked=true}};
FacebookFriendFinder.prototype.displayFriendForm=function(a,b,c){var e=new Template('<h2 class="h2 phn bright">#{friend_count} of your Facebook Friends #{is_or_are} on Kongregate</h2><p class="intro regtext mbm">Kongregate is more fun with friends.</p><form id="facebook_friends_form" class="pan" action="#"><span class="mll spinner" style="display: none;" id="friend_finder_spinner">Loading...</span><div class="select_users"><ul id="facebook_friends_list" class="users medium_user"></ul></div><input class="btn btn_wide btn_action" id="friend_finder_button" type="submit" value="Connect with Friends" /><a id="facebook_friends_skip" class="mrm" href="#">Skip this step</a></form>'),f=
new Template('<li class="user medium_user clickable selected" onclick="FacebookFriendFinder.prototype.clickFriend(this)"><input type="checkbox" name="user_id[]" value="#{id}" class="mtm img" checked="checked" /><span class="check_mark spritesite"></span><img width="40" height="40" class="user_avatar" src="#{avatar_url}" /><span class="names"><strong class="sprite_facebook facebook_name first_name truncate_one_line">#{first_name} #{last_name}</strong><em class="second_name truncate_one_line">(<span class="spritesite levelbug level_#{level}">#{username}</span>)</em></span></li>'),
h,l,p;b.update(e.evaluate({friend_count:this.friends.length,is_or_are:this.friends.length==1?"is":"are"}));h=$("facebook_friends_form");l=$("facebook_friends_skip");p=$("facebook_friends_list");h.observe("submit",function(m){m.preventDefault();$("friend_finder_button").hide();l.hide();$("friend_finder_spinner").show();new Ajax.Request(a,{parameters:h.serialize(),onSuccess:function(){c()},onFailure:function(){alert("There was an error while trying to create your new friends.");$("friend_finder_spinner").hide();
l.show();$("friend_finder_button").show()}})});l.observe("click",c);this.friends.each(function(m){m=$H(m).inject({},function(t,w){t[w[0]]=Object.isString(w[1])?w[1].escapeHTML():w[1];return t});p.insert(f.evaluate(m))})};var FacebookWidgetLoader={load:function(){var a=new Template('<iframe src="http://www.facebook.com/plugins/#{widget_type}.php?site=kongregate.com&amp;width=297&amp;height=350&amp;header=true&amp;colorscheme=light scrolling="no" frameborder="0" allowTransparency="true" style="border:none; overflow:hidden; width:297px; height:350px"></iframe>'),b=Cookie.get("kong_fbwn"),c=location.search.parseQuery();if(c.fb_widget&&("recommendations"==c.fb_widget||"activity"==c.fb_widget))b=c.fb_widget;if(b&&"news_section"!=
b){$("facebook_content_holder").update(a.evaluate({widget_type:b}));$("facebook_content_holder").show()}else $("kongregate_announcements").show()}};FeedHandler=Class.create({_feedType:"self",_feedContainerName:"feed_items_container",_feedContainer:null,_feedItemIds:[],_offset:0,_pageSize:20,_morePath:null,_destroyPath:null,_blinking:false,initialize:function(a,b,c,e,f){this._feedType=a;this._feedContainerName=b;this._pageSize=c;this._morePath=e;this._destroyPath=f;this._self_disabling={};$(document).observe("click",this.clickHandler.bindAsEventListener(this))},setOffset:function(a){this._offset=a},addFeedItemIds:function(a){this._feedItemIds=
this._feedItemIds.concat(a||[])},updateFeedInfo:function(a,b){this.setOffset(a);this.addFeedItemIds(b);this.setFirstFeedItemClass()},container:function(){if(!this._feedContainer)this._feedContainer=$(this._feedContainerName);return this._feedContainer},indicator:function(){return this.container().select("#more_feed_items_indicator").first()},showMoreElement:function(){return this.container().select("#show_more_feed_items_label").first()},automaticallyFetchMore:function(){if(this._morePath.match(/mini_feed_items/)!=
null)$$(".mini_item").length<15&&this.requestNextPage();else $$(".feed_item").length<15&&this.requestNextPage()},setFirstFeedItemClass:function(){this.container().select(".first_feed_item").each(function(b){b.removeClassName("first_feed_item")});var a=this.container().select(".feed_item").first();a&&a.addClassName("first_feed_item")},insertMoreShoutComments:function(a){var b=a.message_id;if(a.new_url){$("show_more_comments_link_"+b).href=a.new_url;$("show_more_comments_link_"+b).show()}else $("show_more_comments_link_"+
b).hide();$("shout_indicator_"+b).hide();$("shout_short_comments_"+b).hide();$("shout_more_comments_"+b).insert({top:a.content})},requestNextPage:function(){var a=this.indicator(),b=this;if(!(!a||a.visible())){a.show();this.showMoreElement().hide();new Ajax.Request(this._morePath,{parameters:{feed_type:this._feedType,offset:this._offset,num:this._pageSize,excluded_ids:this._feedItemIds.join(","),excluded_followed_users:$$(".js_followed_username").map(function(c){return c.innerHTML}).uniq().join(","),
excluded_forum_users:$$(".js_forum_post_user").map(function(c){return c.innerHTML}).uniq().join(",")},method:"get",onSuccess:function(c){b.container().select("#additional_feed_items").first().remove();b.container().insert(c.responseText);b.setFirstFeedItemClass()},onFailure:function(){b.indicator().hide();b.showMoreElement().show()}})}},requestNextPageIfMoreItemsNeeded:function(){this.container().getHeight()<1500&&this.requestNextPage()},removeFeedItems:function(a){if(!(!(a instanceof Array)||a.length<=
0)){new Effect.DropOut("feed_item_"+a[0]);new Ajax.Request(this._destroyPath,{method:"post",parameters:{ids:a.join(","),context:this._feedType},onSuccess:function(){},onFailure:function(){}})}},unfollowUser:function(a,b){new Effect.DropOut("feed_item_"+b[0]);new Ajax.Request("/accounts/"+active_user.username()+"/friends/"+a+".json",{method:"put",parameters:{unfriend_from:"feed"},onSuccess:function(){},onFailure:function(){}})},blockGame:function(a,b,c){new Effect.DropOut("feed_item_"+c);new Ajax.Request("/games/"+
b+"/"+a+"/blocks",{method:"post",parameters:{user_game_permissions:{allow_something:false}},onSuccess:function(){},onFailure:function(){}})},isMiniFeed:function(){return this._morePath.match(/mini_feed_items/)!=null},feedItemElement:function(a){return this.isMiniFeed()?$("mini_item_"+a):$("feed_item_"+a)},observeUnlike:function(a){a=this.feedItemElement(a).down(".like_link");if(a!=null){a.observe("mouseenter",function(){this.down(".like_text").update("Unlike")});a.observe("mouseleave",function(){this.down(".like_text").update("Liked")})}},
likeFeedItem:function(a){var b=this;if(this._self_disabling[a]==null){this._self_disabling[a]=true;new Ajax.Request("/user_likes",{method:"post",parameters:{feed_item_id:a},onSuccess:function(c){if(b.isMiniFeed()){var e=$("mini_item_"+a);e.down(".like_link").removeClassName("feed_like");e.down(".like_link").addClassName("feed_unlike")}else{e=$("feed_item_"+a);e.down(".like_text").update("Liked")}e.down(".like_link").onclick=function(){feedHandler.unlikeFeedItem(a);return false};b._self_disabling[a]=
null;b.observeUnlike(a);e.down(".like_count").update("("+c.responseJSON.count+")")},onFailure:function(){b._self_disabling[a]=null}})}},unlikeFeedItem:function(a){var b=this;if(this._self_disabling[a]==null){this._self_disabling[a]=true;new Ajax.Request("/user_likes",{method:"delete",parameters:{feed_item_id:a},onSuccess:function(c){var e=b.isMiniFeed()?$("mini_item_"+a):$("feed_item_"+a);e.down(".like_link").onclick=function(){feedHandler.likeFeedItem(a);return false};b._self_disabling[a]=null;e.down(".like_text").update("Like");
e.down(".like_link").stopObserving("mouseenter");e.down(".like_link").stopObserving("mouseleave");if(b.isMiniFeed()){e.down(".like_link").removeClassName("feed_unlike");e.down(".like_link").addClassName("feed_like")}else e.down(".like_count").update("("+c.responseJSON.count+")")},onFailure:function(){b._self_disabling[a]=null}})}},clickHandler:function(a){var b=a.element();if(this.isMiniFeed()){if(a=b.hasClassName("mini_item")?b:b.up(".mini_item"))if(a=a.id.sub("mini_item_","")){b=(b=Cookie.get("feed_item_clicks"))?
b.evalJSON():{};b[this._feedType]=b[this._feedType]||[];b[this._feedType]=b[this._feedType].concat([a]);Cookie.set("feed_item_clicks",Object.toJSON(b))}}else if(a=b.hasClassName("feed_item")?b:b.up(".feed_item")){var c=b.up("a");if("A"==b.nodeName||c){b="A"==b.nodeName?b.href:c.href;a=a.id.sub("feed_item_","");if(b&&!b.match(/#$/)){b=(b=Cookie.get("feed_item_clicks"))?b.evalJSON():{};b[this._feedType]=b[this._feedType]||[];b[this._feedType]=b[this._feedType].concat([a]);Cookie.set("feed_item_clicks",
Object.toJSON(b))}}}}});FileField=function(a,b){function c(e){var f=e.pointerX();e=e.pointerY();var h=b.getOffsetParent().viewportOffset();b.setOpacity(0);if(!this.containerPositon)this.containerPositon=a.getBoundingClientRect();if(e>=this.containerPositon.top&&e<this.containerPositon.bottom&&f>=this.containerPositon.left&&f<this.containerPositon.right){b.style.left=f-this.containerPositon.left+30-b.getWidth()+"px";b.style.top=e-h[1]-10+"px"}else{b.style.left=0;b.style.top=0}}a.observe("mousemove",c.bind(this))};function FlashMessages(a){this.initialize(a)}FlashMessages.DISPLAY_TEMPLATE=new Template('<div class="sitemessage"><h2>#{message}</h2></div>');FlashMessages.COOKIE_NAME="kong_flash_messages";
FlashMessages.prototype={initialize:function(){this._data={};if(Cookie.accept()){this._messages_node=$("global");this._insertMessages()}},data:function(){this._getDataFromCookie();return this._data},_getDataFromCookie:function(){var a=Cookie.get(FlashMessages.COOKIE_NAME);if(a){a=a.evalJSON();if(this._data)Object.extend(this._data,a);else this._data=a}this._clearCookie()},_insertMessages:function(){var a=this.data().messages;if(this._messages_node&&a)this._messages_node.innerHTML=a.map(function(b){return FlashMessages.DISPLAY_TEMPLATE.evaluate({message:b})}).join()},
_clearCookie:function(){Cookie.erase(FlashMessages.COOKIE_NAME,"/")}};function FollowToggleButton(a){this.initialize(a)}FollowToggleButton.prototype={initialize:function(a){this._indicatorTag=a},mouseOver:function(a){a=Event.findElement(a);a.removeClassName("btn_alt");a.update("Unfriend")},mouseOut:function(a){a=Event.findElement(a);a.addClassName("btn_alt");a.update("Friend")},toggle:function(a){a=Event.findElement(a);a.update(this._indicatorTag);a.onmouseover="";a.onmouseout=""}};FormRow=Class.create({initialize:function(a,b,c,e,f){this._formCallback=f;this._tr=new Element("tr");this._tr.appendChild(this._createFieldNameColumn(a,b));this._tr.appendChild(this._createInputColumn(b,c,e));this._helpColumn=this._createHelpColumn(b);this._tr.appendChild(this._helpColumn);this._focusHandlers=[];this.getInputElements().each(function(h){h.onfocus=this._callAllOnFocusHandlers.bind(this);h.onblur=this._callAllOnBlurHandlers.bind(this)}.bind(this));this._hasValidInput=false;this._setInputValidityTrue=
function(){this.setInputValidity(true)}.bind(this);this._setInputValidityFalse=function(){this.setInputValidity(false)}.bind(this)},hasValidInput:function(){return this._hasValidInput},setInputValidity:function(a){this._hasValidInput=a;this._formCallback()},_callAllOnFocusHandlers:function(){for(var a=0;a<this._focusHandlers.length;a++)if(this._focusHandlers[a].onFocus())break},_callAllOnBlurHandlers:function(){for(var a=0;a<this._focusHandlers.length;a++)if(this._focusHandlers[a].onBlur())break},
getElement:function(){return this._tr},getInputElements:function(){return[this.getColumn(1).childNodes[0]]},getInputValue:function(){return this.getColumn(1).childNodes[0].value},getHelpElement:function(){return this.getColumn(2)},getColumn:function(a){return this._tr.childNodes[a]},addFocusHandler:function(a){this._focusHandlers.push(a)},focusHandlerCount:function(){return this._focusHandlers.length},_createFieldNameColumn:function(a,b){var c=new Element("td");c.innerHTML='<label for="credit_card_transaction_'+
b+'">'+a+"</label>";c.className="purchase_label";return c},_createInputColumn:function(a,b,c){var e=new Element("td");e.className="purchase_input";this._inputElement=new Element("input");this._inputElement.id="credit_card_transaction_"+a;this._inputElement.name="transaction["+b+"]["+a+"]";this._inputElement.size=30;this._inputElement.value=c?c:"";e.appendChild(this._inputElement);return e},_createHelpColumn:function(a){var b=new Element("td");b.id=a+"_help";return b}});
FormNonEmptyRow=Class.create(FormRow,{initialize:function($super,b,c,e,f,h,l,p){$super(b,c,e,h,l);p&&this.getInputElements().each(function(m){m.onkeyup=function(){this.getInputValue()!=""&&this._callAllOnBlurHandlers()}.bind(this)}.bind(this));this.addFocusHandler(new NonEmptyInputFocusHandler(this,"can't be blank",this._setInputValidityFalse));this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);
this.addFocusHandler(new HelpTextFocusHandler(this,f))}});FormCanBeEmptyRow=Class.create(FormRow,{initialize:function($super,b,c,e,f,h,l){$super(b,c,e,h,l);this._hasValidInput=true;this.addFocusHandler(new HelpTextFocusHandler(this,f))}});
FormCreditCardNumberRow=Class.create(FormRow,{initialize:function($super,b,c,e,f,h,l){$super(b,c,e,f,h);this.addFocusHandler(new NonEmptyInputFocusHandler(this,"can't be blank",this._setInputValidityFalse));this._ccNumberFocusHandler=new CreditCardValidationFocusHandler(this,"invalid account number",this._setInputValidityFalse);this.addFocusHandler(this._ccNumberFocusHandler);this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,l,this._setInputValidityFalse);this.addFocusHandler(this._validInputCallbackFocusHandler);
this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);b=new Element("img");b.src="/images/creditcard_marks.png";this._helpCreditCardFocusHandler=new HelpCreditCardFocusHandler(this,b);this.addFocusHandler(this._helpCreditCardFocusHandler)},getCreditCardType:function(){return this._ccNumberFocusHandler.getCreditCardType()},getInputValue:function(){return this.getColumn(1).childNodes[0].value.replace(/\s+/g,
"")}});
FormCvvRow=Class.create(FormRow,{initialize:function($super,b,c,e,f,h){$super(b,c,e,f,h);this.addFocusHandler(new NonEmptyInputFocusHandler(this,"can't be blank",this._setInputValidityFalse));this._cvvValidationFocusHandler=new CvvValidationFocusHandler(this,this._setInputValidityFalse);this.addFocusHandler(this._cvvValidationFocusHandler);this._validInputCallbackFocusHandler=new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);this._helpTextFocusHandler=
new HelpTextFocusHandler(this,"");this.addFocusHandler(this._helpTextFocusHandler)},setCreditCardType:function(a){this._cvvValidationFocusHandler.setCreditCardType(a);var b="";b=a=="american_express"?"Please enter the four digit code that's printed on the front of your card, just to the right of the account number.":"Please enter the last three digits printed on the signature line on the back side of your card.";this._helpTextFocusHandler.setText(b)}});
FormExpirationDateRow=Class.create(FormRow,{initialize:function($super,b,c,e,f,h,l,p,m){this._formCallback=m;this._monthHTML=f;this._yearHTML=h;this._defaultMonth=l;this._defaultYear=p;$super(b,c+"cc_month",e,"",m);this.addFocusHandler(new CompleteDateValidationFocusHandler(this,"month &amp; year are required",this._setInputValidityFalse));this.addFocusHandler(new FutureDateValidationFocusHandler(this,"date must be in the future",this._setInputValidityFalse));this._validInputCallbackFocusHandler=
new ValidInputCallbackFocusHandler(this,this._setInputValidityTrue);this.addFocusHandler(this._validInputCallbackFocusHandler);this.addFocusHandler(new HelpTextFocusHandler(this,""))},_createInputColumn:function(){var a=new Element("td");a.addClassName("purchase_input");Element.insert(a,this._monthHTML);a.childNodes[0].value=this._defaultMonth;Element.insert(a,this._yearHTML);a.childNodes[1].value=this._defaultYear;return a},getInputElements:function(){return[this.getColumn(1).childNodes[0],this.getColumn(1).childNodes[1]]},
getInputValue:function(){return this.getColumn(1).childNodes[0].value+"/"+this.getColumn(1).childNodes[1].value},setMonthInput:function(a){this.getColumn(1).childNodes[0].selectedIndex=a},setYearInput:function(a){this.getColumn(1).childNodes[1].selectedIndex=a}});function evalJS(a){eval(a)}function updateTaskProgress(a,b){try{$(a+"-progress-amount").update(b)}catch(c){console.warn("error during updateTaskProgress on %s to %s",a,b)}}function markTaskComplete(a){try{Element.addClassName(a,"complete");Element.removeClassName(a,"incomplete");$(a+"-progress")&&Element.hide(a+"-progress");new Effect.Highlight(a,{})}catch(b){console.warn("error during markTaskComplete on %s",a)}}
function markAccomplishmentComplete(a){try{Element.addClassName(a,"complete");Element.removeClassName(a,"incomplete");new Effect.Highlight(a,{})}catch(b){console.warn("error during markAccomplishmentComplete on %s",a)}};var GameBrowser={highlightCurrentSidebarItem:function(a){(a=$("browser-sidebar-"+a))&&a.addClassName("active")},updateTagSidebarItem:function(a,b){if(a&&b){$("browser-sidebar-tag-games-link").href=b;$("browser-sidebar-tag-games-link").update(a);$("browser-sidebar-tag-games").addClassName("active");$("browser-sidebar-tag-games").show()}}};var GameMetricsUpdater=function(){return{update:function(){new Ajax.Request(active_user.gameResourcePath()+"/metrics.json",{method:"get",onSuccess:function(a){a=a.responseJSON;[[".favorites_count",a.favorites_count_with_delimiter],[".gameplays_count",a.gameplays_count_with_delimiter],[".average_rating",a.average_rating_text],[".average_rating_with_count",a.average_rating_with_count],["#rating_message",a.rating_message],["#below_game_rating_message",a.below_game_rating_message],["#star_ratings_block",
a.user_rating],["#below_game_star_ratings_block",a.below_game_user_rating],["#quicklinks_star_ratings_block",a.quicklinks_user_rating],[".flag_game",a.flagged],["#favorite_game",a.favorite_message],["#below_game_favorite_game",a.below_game_favorite_message],["#quicklinks_favorite_block",a.quicklinks_favorite_message],["#user_donation_holder",a.last_tip_message],["#combined_favorites_js",a.combined_favorites_js],["#game_block",a.block_game_js]].each(function(b){var c=b[0],e=b[1];e&&$$(c).each(function(f){f.update(e)})})},
onFailure:function(a){console.error("Error loading game metrics: %o",a.responseText)}})}}}();var Hoptoad={VERSION:"0.1.0",NOTICE_XML:'<?xml version="1.0" encoding="UTF-8"?><notice version="2.0"><api-key></api-key><notifier><name>hoptoad_notifier_js</name><version>0.1.0</version><url>http://hoptoadapp.com</url></notifier><error><class>EXCEPTION_CLASS</class><message>EXCEPTION_MESSAGE</message><backtrace>BACKTRACE_LINES</backtrace></error><request><url>REQUEST_URL</url><component>REQUEST_COMPONENT</component><action>REQUEST_ACTION</action></request><server-environment><project-root>PROJECT_ROOT</project-root><environment-name>production</environment-name></server-environment></notice>',
ROOT:window.location.protocol+"//"+window.location.host,BACKTRACE_MATCHER:/^(.*)\@(.*)\:(\d+)$/,backtrace_filters:[/notifier\.js/],notify:function(a){a=escape(Hoptoad.generateXML(a));a="//"+(Hoptoad.host||"hoptoadapp.com")+"/notifier_api/v2/notices?data="+a;var b=document.createElement("iframe");b.style.width="1px";b.style.height="1px";b.style.display="none";b.src=a;document.getElementsByTagName("head")[0].appendChild(b)},setEnvironment:function(a){Hoptoad.NOTICE_XML=Hoptoad.NOTICE_XML.replace(/<environment-name>.*<\/environment-name>/,
"<environment-name>"+a+"</environment-name>")},setHost:function(a){Hoptoad.host=a},setKey:function(a){Hoptoad.NOTICE_XML=Hoptoad.NOTICE_XML.replace(/<api-key>.*<\/api-key>/,"<api-key>"+a+"</api-key>")},setErrorDefaults:function(a){Hoptoad.errorDefaults=a},generateXML:function(a){a=Hoptoad.mergeDefault(Hoptoad.errorDefaults,a);var b=Hoptoad.NOTICE_XML,c=Hoptoad.escapeText((a.url||"")+(location.hash||"")||""),e=Hoptoad.escapeText(a.component||""),f=Hoptoad.escapeText(a.action||""),h=Hoptoad.escapeText(a.type||
"Error"),l=Hoptoad.escapeText(a.message||"Unknown error."),p=Hoptoad.generateBacktrace(a);if(Hoptoad.trim(c)==""&&Hoptoad.trim(e)=="")b=b.replace(/<request>.*<\/request>/,"");else{var m="",t=a["cgi-data"]||{};t.HTTP_USER_AGENT=navigator.userAgent;m+="<cgi-data>";m+=Hoptoad.generateVariables(t);m+="</cgi-data>";t=["params","session"];for(var w=0;w<2;w++){h=t[w];if(a[h]){m+="<"+h+">";m+=Hoptoad.generateVariables(a[h]);m+="</"+h+">"}}b=b.replace("</request>",m+"</request>").replace("REQUEST_URL",c).replace("REQUEST_ACTION",
f).replace("REQUEST_COMPONENT",e)}return b.replace("PROJECT_ROOT",Hoptoad.ROOT).replace("EXCEPTION_CLASS",h).replace("EXCEPTION_MESSAGE",l).replace("BACKTRACE_LINES",p.join(""))},generateBacktrace:function(a){a=a||{};if(typeof a.stack!="string")try{0()}catch(b){a.stack=b.stack}var c=[];a=Hoptoad.getStackTrace(a);for(var e=0,f=a.length;e<f;e++){var h=a[e],l=h.match(Hoptoad.BACKTRACE_MATCHER);if(l&&Hoptoad.validBacktraceLine(h)){h=l[2].replace(Hoptoad.ROOT,"[PROJECT_ROOT]");e==0&&l[2].match(document.location.href)&&
c.push('<line method="" file="internal: " number=""/>');c.push('<line method="'+Hoptoad.escapeText(l[1])+'" file="'+Hoptoad.escapeText(h)+'" number="'+l[3]+'" />')}}return c},getStackTrace:function(a){a=printStackTrace({e:a,guess:false});for(var b=0,c=a.length;b<c;b++)if(!a[b].match(/\:\d+$/)){if(a[b].indexOf("@")==-1)a[b]+="@unsupported.js";a[b]+=":0"}return a},validBacktraceLine:function(a){for(var b=0;b<Hoptoad.backtrace_filters.length;b++)if(a.match(Hoptoad.backtrace_filters[b]))return false;
return true},generateVariables:function(a){var b,c="";for(b in a)c+='<var key="'+Hoptoad.escapeText(b)+'">'+Hoptoad.escapeText(a[b])+"</var>";return c},escapeText:function(a){return a.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/'/g,"&#39;").replace(/"/g,"&#34;")},trim:function(a){return a.toString().replace(/^\s+/,"").replace(/\s+$/,"")},mergeDefault:function(a,b){var c={},e;for(e in b)c[e]=b[e];for(e in a)c.hasOwnProperty(e)||(c[e]=a[e]);return c}};
function printStackTrace(a){a=a||{guess:true};var b=a.e||null;a=!!a.guess;var c=new printStackTrace.implementation;b=c.run(b);return a?c.guessFunctions(b):b}printStackTrace.implementation=function(){};
printStackTrace.implementation.prototype={run:function(a){a=a||this.createException();var b=this.mode(a);return b==="other"?this.other(arguments.callee):this[b](a)},createException:function(){try{return this.undef(),null}catch(a){return a}},mode:function(a){if(a.arguments&&a.stack)return this._mode="chrome";else if(typeof window!=="undefined"&&window.opera)return this._mode=a.stacktrace?"opera10":"opera";else if(a.stack)return this._mode="firefox";return this._mode="other"},instrumentFunction:function(a,
b,c){a=a||window;a["_old"+b]=a[b];a[b]=function(){c.call(this,printStackTrace());return a["_old"+b].apply(this,arguments)};a[b]._instrumented=true},deinstrumentFunction:function(a,b){a[b].constructor===Function&&a[b]._instrumented&&a["_old"+b].constructor===Function&&(a[b]=a["_old"+b])},chrome:function(a){return a.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,
"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera10:function(a){a=a.stacktrace.split("\n");var b=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i,c,e,f;c=2;e=0;for(f=a.length;c<f-2;c++)if(b.test(a[c])){var h=RegExp.$6+":"+RegExp.$1+":"+RegExp.$2,l=RegExp.$3;l=l.replace(/<anonymous function\:?\s?(\S+)?>/g,"{anonymous}");a[e++]=l+"@"+h}a.splice(e,a.length-e);return a},opera:function(a){a=a.message.split("\n");var b=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i,
c,e,f;c=4;e=0;for(f=a.length;c<f;c+=2)b.test(a[c])&&(a[e++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:"{anonymous}()@"+RegExp.$2+":"+RegExp.$1)+" -- "+a[c+1].replace(/^\s+/,""));a.splice(e,a.length-e);return a},other:function(a){for(var b=/function\s*([\w\-$]+)?\s*\(/i,c=[],e,f;a&&c.length<10;){e=b.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}";f=Array.prototype.slice.call(a.arguments||[]);c[c.length]=e+"("+this.stringifyArguments(f)+")";a=a.caller}return c},stringifyArguments:function(a){for(var b=
0;b<a.length;++b){var c=a[b];c===void 0?(a[b]="undefined"):c===null?(a[b]="null"):c.constructor&&(c.constructor===Array?(a[b]=c.length<3?"["+this.stringifyArguments(c)+"]":"["+this.stringifyArguments(Array.prototype.slice.call(c,0,1))+"..."+this.stringifyArguments(Array.prototype.slice.call(c,-1))+"]"):c.constructor===Object?(a[b]="#object"):c.constructor===Function?(a[b]="#function"):c.constructor===String&&(a[b]='"'+c+'"'))}return a.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();
if(b)return b.open("GET",a,false),b.setRequestHeader("User-Agent","XMLHTTP/1.0"),b.send(""),b.responseText},createXMLHTTPObject:function(){for(var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<b.length;c++)try{return a=b[c](),this.createXMLHTTPObject=b[c],a}catch(e){}},isSameDomain:function(a){return a.indexOf(location.hostname)!==
-1},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessFunctions:function(a){for(var b=0;b<a.length;++b){var c=a[b],e=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/.exec(c);if(e){var f=e[1];e=e[4];f&&this.isSameDomain(f)&&e&&(f=this.guessFunctionName(f,e),a[b]=c.replace("{anonymous}",f))}}return a},guessFunctionName:function(a,b){var c;try{c=this.guessFunctionNameFromLines(b,this.getSource(a))}catch(e){c=
"getSource failed with url: "+a+", exception: "+e.toString()}return c},guessFunctionNameFromLines:function(a,b){for(var c=/function ([^(]*)\(([^)]*)\)/,e=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,f="",h=0;h<10;++h)if(f=b[a-h]+f,f!==void 0){var l=e.exec(f);if(l&&l[1])return l[1];else if((l=c.exec(f))&&l[1])return l[1]}return"(?)"}};function ImageSwitcher(a){this.initialize(a)}
ImageSwitcher.prototype={initialize:function(a){var b=this;this._image_ids=a.image_ids;this._current_image=this._image_ids.first();this._current_text=this.makeTextId(this._current_image);document.observe("dom:loaded",function(){b._image_ids.each(function(c){$(b.makeTextId(c)).observe("mouseover",b.switchFunction(c))})})},switchFunction:function(a){var b=this;return function(){$(b._current_image).hide();$(b._current_text).removeClassName("selected");b._current_image=a;b._current_text=b.makeTextId(a);
$(b._current_image).show();$(b._current_text).addClassName("selected")}},makeTextId:function(a){return a+"Text"}};function showTrailerPopup(a){window.open(a,"","width=520,height=400,status=no,resizable=no,scrollbars=no")};InteractiveHover=Class.create(Control.Window,{initialize:function($super,b,c){var e;$super(b,c);b=function(f){this.open(f);if(e!=null){clearTimeout(e);e=null}}.bind(this);c=function(f){e=setTimeout(function(){this.close(f)}.bind(this),1E3)}.bind(this);this.sourceContainer.observe("mouseenter",b);this.container.observe("mouseenter",b);this.sourceContainer.observe("mouseleave",c);this.container.observe("mouseleave",c)}});(function(a){function b(){if("localStorage"in window)try{if(window.localStorage){l=window.localStorage;B="localStorage"}}catch(z){}else if("globalStorage"in window)try{l=window.globalStorage[window.location.hostname];B="globalStorage"}catch(K){}else{p=document.createElement("link");if(p.addBehavior){p.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(p);p.load("jStorage");var P="{}";try{P=p.getAttribute("jStorage")}catch(F){}l.jStorage=P;B="userDataBehavior"}else{p=
null;return}}c()}function c(){if(l.jStorage)try{h=w(String(l.jStorage))}catch(z){l.jStorage="{}"}else l.jStorage="{}";m=l.jStorage?String(l.jStorage).length:0}function e(){try{l.jStorage=t(h);if(p){p.setAttribute("jStorage",l.jStorage);p.save("jStorage")}m=l.jStorage?String(l.jStorage).length:0}catch(z){}}function f(z){if(!z||typeof z!="string"&&typeof z!="number")throw new TypeError("Key name must be string or numeric");return true}if(!a||!(a.toJSON||Object.toJSON||window.JSON))throw new Error("jQuery, MooTools or Prototype needs to be loaded before jStorage!");
var h={},l={jStorage:"{}"},p=null,m=0,t=a.toJSON||Object.toJSON||window.JSON&&(JSON.encode||JSON.stringify),w=a.evalJSON||window.JSON&&(JSON.decode||JSON.parse)||function(z){return String(z).evalJSON()},B=false;_XMLService={isXML:function(z){return(z=(z?z.ownerDocument||z:0).documentElement)?z.nodeName!=="HTML":false},encode:function(z){if(!this.isXML(z))return false;try{return(new XMLSerializer).serializeToString(z)}catch(K){try{return z.xml}catch(P){}}return false},decode:function(z){var K="DOMParser"in
window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(P){var F=new ActiveXObject("Microsoft.XMLDOM");F.async="false";F.loadXML(P);return F};if(!K)return false;z=K.call("DOMParser"in window&&new DOMParser||window,z,"text/xml");return this.isXML(z)?z:false}};a.jStorage={version:"0.1.4.3",set:function(z,K){f(z);if(_XMLService.isXML(K))K={_is_xml:true,xml:_XMLService.encode(K)};h[z]=K;e();return K},get:function(z,K){f(z);if(z in h)return typeof h[z]=="object"&&h[z]._is_xml&&h[z]._is_xml?
_XMLService.decode(h[z].xml):h[z];return typeof K=="undefined"?null:K},deleteKey:function(z){f(z);if(z in h){delete h[z];e();return true}return false},flush:function(){h={};e();try{window.localStorage.clear()}catch(z){}return true},storageObj:function(){function z(){}z.prototype=h;return new z},index:function(){var z=[],K;for(K in h)h.hasOwnProperty(K)&&z.push(K);return z},storageSize:function(){return m},currentBackend:function(){return B},reInit:function(){var z;if(p&&p.addBehavior){z=document.createElement("link");
p.parentNode.replaceChild(z,p);p=z;p.style.behavior="url(#default#userData)";document.getElementsByTagName("head")[0].appendChild(p);p.load("jStorage");z="{}";try{z=p.getAttribute("jStorage")}catch(K){}l.jStorage=z;B="userDataBehavior"}c()}};b()})(window.jQuery||$);var KongAds=function(){function a(f){return f.replace(/[^a-z0-9-+_]+/gi,"_").substr(0,10)}function b(f,h){var l=[],p=[],m=a(f);if(h instanceof Array){for(f=h.length;f--;)p[f]=a(h[f]);l.push([m,p])}else l.push([m,a(h)]);return l}function c(f){var h=[];if(1==f.length)for(var l in f[0])h=h.concat(b(l,f[0][l]));else if(2==f.length)h=h.concat(b(f[0],f[1]));return h}function e(f){this.initialize(f)}e.prototype={initialize:function(f){this._network_id=f.networkId;this._publisher_id=f.publisherId;this._rendering_mode=
f.renderingMode;this._slots={}},defineAd:function(f,h,l){var p=this,m="/"+this._network_id+"/"+this._publisher_id+"/"+f;googletag.cmd.push(function(){p._slots[f]=googletag.defineSlot(m,[h,l],f+"-ad-slot").addService(googletag.pubads())});return this},setTargeting:function(){var f=arguments;googletag.cmd.push(function(){for(var h=googletag.pubads(),l=c(f),p=l.length;p--;)h.setTargeting(l[p][0],l[p][1])});return this},setGenderTargeting:function(f){googletag.cmd.push(function(){googletag.pubads().set("demographic_gender",
f)});return this},setAgeTargeting:function(f){googletag.cmd.push(function(){googletag.pubads().set("demographic_age",f)});return this},displayAd:function(f){googletag.cmd.push(function(){googletag.display(f+"-ad-slot")});return this},requestAds:function(){if(document.location.search.match(/username=/)||document.referrer.match(/username=/))return this;googletag.cmd.push(function(){var f=googletag.pubads();f[renderingMode]();f.enableSingleRequest();googletag.enableServices()});return this},getSlot:function(f){return this._slots[f]},
onDealspotOfferUnavailable:function(){$("dealspot_banner_holder").remove();$("game_leaderboad_banner_holder").show()},onDealspotOfferAvailable:function(){$("game_leaderboad_banner_holder").remove();$("dealspot_target").update($("dealspot_banner_holder").addClassName("horizontal_ad").setStyle({top:"",left:""}))},onDealspotOpen:function(){$("game").setStyle({top:"-10000px",left:"-10000px"})},onDealspotClose:function(){$("game").setStyle({top:"",left:""})}};return{KongDFPAds:e}}(),KongDFPAds=KongAds.KongDFPAds;function KredPackagePicker(a){this.initialize(a)}
KredPackagePicker.prototype={initialize:function(a){this._kred_packages=a.kred_packages;this._active_user=a.active_user;this._purchase_methods={};this._package_purchase_selected_callbacks={};this._payment_options_preselected_callbacks={};this._payment_options_selected_callbacks={};this._kav_required=a.kav_required;this._package_choices_node=null;this._required_kreds=a.required_kreds;this._current_balance=a.current_balance;this._use_stored_cc=this._has_stored_cc=a.has_stored_cc;this._use_stored_paypal=
this._has_paypal_billing_agreement=a.has_paypal_billing_agreement;this._blocked_for_cc=a.blocked_for_cc;this._kred_deficit=[this._required_kreds-this._current_balance,0].max();this._payment_option_selected=false;var b=this;document.observe("dom:loaded",function(){b.showFirstPage(a.preselected_payment_method)})},showFirstPage:function(a){var b=this,c=this._purchase_methods[a],e=function(f){(f=b._payment_options_preselected_callbacks[f])&&f.each(function(h){h(c,b)})};if(c){e(c.purchase_record_class);
this.showPreselectedPaymentOption(a)}else{b.recordAnalyticsPageview("/kred_lightbox/payment_selection");$("payment_method_selection").show()}},customPackageVariables:function(){return Object.toQueryString({uid:this._active_user.id(),kpid:this._selected_kred_package.id})},returnToSelectPackage:function(){this.reselectPurchaseMethod()},reselectPurchaseMethod:function(){this.selectPaymentOption(this._selected_payment_option)},returnToSelectPaymentMethod:function(){$$(".kred_flow_step").each(Element.hide);
$("payment_method_selection").show();$("blocked_for_cc_message").hide();this._use_stored_cc=this._has_stored_cc;this.recordAnalyticsPageview("/kred_lightbox/payment_selection")},checkIfVerificationRequired:function(){if(this._kav_required){window.location="/accounts/"+active_user.username()+"/kred_account_verification/edit";return true}},hideKredFlow:function(){$$(".kred_flow_step").each(Element.hide)},addPurchaseMethod:function(a){this._purchase_methods[a.purchase_record_class]=a},showPreselectedPaymentOption:function(a){if(a=
this._purchase_methods[a])this.selectPaymentOption(a.purchase_record_class);else this._payment_option_selected||$("payment_method_selection").show()},returnToRegularPaypal:function(){this._use_stored_paypal=false;this.reselectPurchaseMethod()},resetStoredPaypal:function(){this._use_stored_paypal=this._has_paypal_billing_agreement},returnToRegularCC:function(){this._use_stored_cc=false;this.reselectPurchaseMethod()},blockForCC:function(){this._blocked_for_cc=true},selectPaymentOption:function(a){if(this.useStoredCC()&&
a=="CreditCardTransaction"){$("kred_discount_message")&&$("kred_discount_message").show();$("gamestop-employee-discount-message")&&$("gamestop-employee-discount-message").show()}else{$("kred_discount_message")&&$("kred_discount_message").hide();$("gamestop-employee-discount-message")&&$("gamestop-employee-discount-message").hide()}var b=this._purchase_methods[a];this._payment_option_selected=true;if(!this.checkIfVerificationRequired()){this.hideKredFlow();this._selected_payment_option=a;this.setPackageClassForPurchaseMethod(a);
this.recordSelectedPaymentOptionAnalytics(b);$$(".kred_purchase_method_name").each(function(f){f.update(b.name)});this.showPackageSelection(b);$$(".package-selection-footer, .package-selection-sidebar").each(Element.hide);$("generic-package-selection-sidebar").show();$("generic-package-selection-footer").show();$$(".package-selection-sidebar .powerup_rewards_upsell").each(Element.show);$$(".package-selection-sidebar .gamestop_employee_upsell").each(Element.show);$$("#employee_kred_text").each(Element.hide);
$$(".js_kred_discount_message").invoke("show");var c=this,e=this._payment_options_selected_callbacks[b.purchase_record_class];e&&e.each(function(f){f(b,c)});a.match(/Boku/)&&$$(".js_kred_discount_message").invoke("hide");this.populateFormValuesAndSummaries()}},setPackageClassForPurchaseMethod:function(a){a.match(/Boku|Zong/i)?$("kred_packages_choices_div").removeClassName("kred_sale_purchase_method"):$("kred_packages_choices_div").addClassName("kred_sale_purchase_method")},recordSelectedPaymentOptionAnalytics:function(a){a=
a.preselect_param;if("mobile"==a)a="zong";if("game_card"==a)this.recordAnalyticsPageview("/kred_lightbox/ugc/code_entry");else"offers"==a?this.recordAnalyticsPageview("/kred_lightbox/trialpay/iframe"):this.recordAnalyticsPageview("/kred_lightbox/"+a+"/package_selection")},addPackage:function(a){if(this._package_choices_node===null)this._package_choices_node=$("kred_package_choices_ul");this._package_choices_node.insert((new Template($(a.package_template_id||(a.discounted_dollar_price!=a.dollar_price?
"kred_package_discounted_template":"kred_package_template")).innerHTML)).evaluate(a),{position:"bottom"});a.special_info&&$("kred_package_special_info_"+a.id).update(this.processPackageSpecialInfo(a.id,a.special_info));a.kred_bonus&&$("kred_bonus_info_"+a.id).show();if(a=$$("#kred_package_"+a.id+" input,type[radio]")[0]){var b=this.populateFormValuesAndSummaries.bind(this);a.observe("click",b);a.observe("change",b)}},processPackageSpecialInfo:function(a,b){if(b.length<100)return b;var c=this,e=new Element("a",
{href:"#",id:"show_package_special_info_"+a});e.update("(show important info)");e.observe("click",function(f){c.packageSpecialInfoShowMore(a,b);Event.stop(f);return false});return e},packageSpecialInfoShowMore:function(a,b){var c=$("kred_package_special_info_hover_"+a),e=$("kred_package_special_info_hover_content_"+a);$("kred_package_special_info_hover_close_"+a).observe("click",function(f){package_picker.hideSpecialInfoHover(a);Event.stop(f);return false});e.update(b);$("kred_package_special_info_"+
a).hide();c.show()},hideSpecialInfoHover:function(a){$("kred_package_special_info_hover_"+a).hide();$("kred_package_special_info_"+a).show()},setPackagesForPurchaseMethod:function(a,b){var c=this;a=this._purchase_methods[a];var e=this._kred_packages.pluck("id"),f=b.pluck("id");a.kred_package_ids=f;b.each(function(h){if(!e.include(h.id)){c._kred_packages.push(h);c.addPackage(h)}})},updatePackageSelectionForPurchaseMethod:function(a){var b=this._purchase_methods[a],c=this.recommendPackage(b);this._kred_packages.each(function(e){var f=
$("kred_package_"+e.id);if(f){b.kred_package_ids.include(e.id)?f.show():f.hide();if(f=$("kred_package_radio_"+e.id))f.checked=e.id==c}})},showPackageSelection:function(a){var b=this.recommendPackage(a),c=$("kred_package_selection");this.hidePackageSelection();a.kred_package_ids.each(function(e){$("kred_package_"+e).show();$("kred_package_radio_"+e).checked=e==b});$("selectPackageButton").show();$("kred_package_choices_wrapper").writeAttribute("class","kred_package_wrapper_"+a.preselect_param);c.show()},
kredDeficit:function(){return this._kred_deficit},kredPackageById:function(a){return this._kred_packages.find(function(b){return b.id==a})},recommendPackage:function(a){var b=this.dynamicPackageRecommendation(a);if(b)return b;if(!this.kredDeficit())return this.defaultRecommendation(a);return a.kred_package_ids.find(function(c){return(c=this.kredPackageById(c))&&c.kred_amount>=this.kredDeficit()}.bind(this))||this.defaultRecommendation(a)},dynamicPackageRecommendation:function(a){if("GameStopCardTransaction"==
a.purchase_record_class)if(a.kred_package_ids.include("gs_dynamic_package"))return"gs_dynamic_package";else if(a.kred_package_ids.length<5)return a.kred_package_ids.last();return null},defaultRecommendation:function(a){return a.preferred_kred_package_id||a.kred_package_ids.last()},hidePackageSelection:function(){$$(".kred_package").each(Element.hide)},selectedPurchaseMethod:function(){return this._purchase_methods[this._selected_payment_option]},selectedKredPackage:function(){var a=this.selectedPurchaseMethod().kred_package_ids.find(function(b){return $("kred_package_radio_"+
b).checked});return this._kred_packages.find(function(b){return b.id==a})},selectPackage:function(){$$(".kred_flow_step").each(Element.hide);var a=this._purchase_methods[this._selected_payment_option];this.recordSelectedPackageAnalytics(a);var b=this,c=this.selectedKredPackage();a=this._package_purchase_selected_callbacks[a.purchase_record_class];this._selected_kred_package=c;this.populateFormValuesAndSummaries();a&&a.each(function(e){e(c,b)});this.showPurchaseForm()},recordSelectedPackageAnalytics:function(a){var b;
if("KredPackageCreditCardPurchase"==a.purchase_record_class)b=this._has_stored_cc?"/kred_lightbox/credit_card/old_stored_card":"/kred_lightbox/credit_card/form";else if("PaypalTransaction"==a.purchase_record_class)b="/kred_lightbox/paypal/waiting_screen";else if("ZongTransaction"==a.purchase_record_class)b="/kred_lightbox/zong/iframe";else if("BokuTransaction"==a.purchase_record_class)b="/kred_lightbox/boku/iframe";else if("PaysafeTransaction"==a.purchase_record_class)b="/kred_lightbox/paysafe/iframe";
b&&this.recordAnalyticsPageview(b)},populateFormValuesAndSummaries:function(){var a=this,b=this.selectedKredPackage();if(!(!b||"BokuTransaction"==this._selected_payment_option)){$$(".kred_purchase_form_kred_package_id").each(function(c){c.value=b.id});$$(".kred_purchase_form_kred_package_dollar_price").each(function(c){var e=b.discounted_dollar_price.gsub("$","");c.value=e}.bind(this));$$(".kred_purchase_form_kred_package_kred_amount").each(function(c){c.value=b.kred_amount});$$(".kred_purchase_form_kred_package_item_name").each(function(c){c.value=
b.kred_amount+" Kreds"});$$(".kred_purchase_form_kred_package_custom_package_variables").each(function(c){c.value=a.customPackageVariables()});$$(".kred_purchase_summary_dollar_price").each(function(c){c.update(b.discounted_dollar_price)});$$(".kred_purchase_summary_kred_amount").each(function(c){c.update(b.kred_amount)})}},showPurchaseForm:function(){$("purchase_method_form_"+this._selected_payment_option).show()},addPreselectedPaymentOptionCallback:function(a,b){this._payment_options_preselected_callbacks[a]||
(this._payment_options_preselected_callbacks[a]=[]);this._payment_options_preselected_callbacks[a].push(b)},addSelectedPaymentOptionCallback:function(a,b){this._payment_options_selected_callbacks[a]||(this._payment_options_selected_callbacks[a]=[]);this._payment_options_selected_callbacks[a].push(b)},addSelectedPackageCallback:function(a,b){this._package_purchase_selected_callbacks[a]||(this._package_purchase_selected_callbacks[a]=[]);this._package_purchase_selected_callbacks[a].push(b)},displayCurrency:function(a,
b){output="";if($w("USD CAD").include(a))output+="$";output+=b.toFixed(2);if("USD"!=a)output+=" "+a;return output},setCreditCardAsSelectedPaymentMethod:function(){this._selected_payment_option="KredPackageCreditCardPurchase"},reportKredPurchase:function(a){this.recordAnalyticsPageview("/purchase/kreds?"+Object.toQueryString(a))},recordAnalyticsPageview:function(a){pageTracker&&pageTracker._trackPageview(a)},handleSuccessfulStoredCCExpirationUpdate:function(a){$("update_expired_stored_cc_form").hide();
$("stored_cc_expiration_date").update(a);$("stored_cc_form_container").show()},handleFailedStoredCCExpirationUpdate:function(a){$("update_cc_expiration_submit_button").restore();$("expiration_update_error_message").update(a);$("expiration_update_error_message_block").show()},hasStoredPayPal:function(){return this._has_paypal_billing_agreement},useStoredPayPal:function(){return this._use_stored_paypal},hasStoredCC:function(){return this._has_stored_cc},useStoredCC:function(){return this._use_stored_cc},
clearStoredCC:function(){this._has_stored_cc=this._use_stored_cc=false},isVerificationRequired:function(){return this._kav_required},isBlockedForCC:function(){return this._blocked_for_cc},failedStoredCC:function(){this.clearStoredCC();this.selectPackage()},failStoredPayPal:function(){this._has_paypal_billing_agreement=this._use_stored_paypal=false}};var detect=navigator.userAgent.toLowerCase(),total,thestring,lightbox=Class.create();
lightbox.prototype={yPos:0,xPos:0,initialize:function(a,b){this.wait_for_shutdown=this._activated=false;this.done_class_name="done";if(typeof a=="string"){this.content=a;this.activate()}else{this.content=a.href;a.observer_function=this.activate.bindAsEventListener(this);Event.observe(a,"click",a.observer_function,true);a.onclick=function(){return false}}this._on_close_callbacks=[];b&&this._on_close_callbacks.push(b)},shutdown:function(){if(!this.wait_for_shutdown){this.stopListening();this.deactivate.apply(this,
arguments)}},shutdownWithoutCallbacks:function(){this._on_close_callbacks=[];this.shutdown.apply(this,arguments)},addOnCloseCallback:function(a){if(!this._on_close_callbacks)this._on_close_callbacks=[];this._on_close_callbacks.push(a)},clearOnCloseCallbacks:function(){this._on_close_callbacks=[]},initializeKredTipPurchaseFrame:function(a,b){b&&this.addOnCloseCallback(b);this.addOnCloseCallback(function(){new Ajax.Request(active_user.gamePath()+"/game_tips",{method:"get"})});this.initializeKredPurchaseFrame(a)},
initializeKredItemPurchaseFrame:function(a){top.kredPurchaseSuccess=false;this.addOnCloseCallback(function(b){b=b||{success:false};b.success=!!b.success;try{holodeck.konduit().dispatchEvent({type:"purchase_result",data:b})}catch(c){}});this.initializeKredPurchaseFrame(a)},initializeKredCardCartPurchaseFrame:function(a){this.addOnCloseCallback(function(b){if(b&&b.success)top.location=top.location.href});this.initializeKredPurchaseFrame(a)},secureUrlForPath:function(a){var b=window.location.host,c=
window.lightboxSecureProtocol;if(b.match(/local/)||b.match(/webhop/))c="http://";return c+b+a},initializeKredPurchase:function(a,b){var c=this.secureUrlForPath("/kred_package_purchases/new"),e={};if(a)e.purchase_method=a;if(b)e.tracking_code=b;a=Object.toQueryString(e);if(a.length>0)c=c+"?"+a;this.initializeKredPurchaseFrame(c)},initializeShoutFrame:function(a,b){this.initializeKongregateLightboxFromAjax("/api/new_shout?game_id="+a+"&message="+b,{done_class_name:"lightbox_login"})},initializeFeedPostFrame:function(a,
b,c,e){var f="";$H(e).each(function(h){f+="kv_params["+h[0]+"]="+h[1]+"&"});this.initializeKongregateLightboxFromAjax("/api/feed_post?game_id="+a+"&message="+b+"&image_uri="+c+"&"+f,{done_class_name:"lightbox_login"})},initializeInvitationFrame:function(a,b,c,e){var f="";$H(e).each(function(h){f+="kv_params["+h[0]+"]="+h[1]+"&"});this.initializeKongregateLightboxFromAjax("/api/new_invitation?game_id="+a+"&message="+b+"&filter="+c+"&"+f,{done_class_name:"lightbox_invite"})},initializeKredPurchaseFrame:function(a){if(!this._kongregate_lightbox_wrapper_template)this._kongregate_lightbox_wrapper_template=
new Template($("kongregate_lightbox_wrapper_template").innerHTML);this.staticContent=this._kongregate_lightbox_wrapper_template.evaluate({iframe_src:a});this.done_class_name="kred_purchase";this.activate()},userAuthenticated:function(){if(active_user.isAuthenticated())return true;else{var a="/accounts/new/behind_login";if(typeof holodeck!="undefined")a=a+"?game_id="+holodeck.gameId();var b={done_class_name:"lightbox_login"};if(active_user.signinLightboxRegistrationFirst())b.afterStaticContentLoad=
lightbox.prototype.toggleRegistration;this.initializeKongregateLightboxFromAjax(a,b);return false}},initializePremiumMembershipPurchase:function(a,b){a=this.secureUrlForPath("/premium_membership_purchases/new?referer="+a);var c=new Template($("kongregate_lightbox_wrapper_template").innerHTML);if(b)a+="&initial_tab="+b;this.staticContent=c.evaluate({iframe_src:a});this.done_class_name="kred_purchase";this.activate()},initializeKongregateLightboxFromAjax:function(a,b){b||(b={});if(!this._kongregate_lightbox_wrapper_template_noframe)this._kongregate_lightbox_wrapper_template_noframe=
new Template($("kongregate_lightbox_wrapper_template_noframe").innerHTML);this.staticContent=this._kongregate_lightbox_wrapper_template_noframe.evaluate({});this.staticContentDivUrl=a;this.afterStaticContentLoad=b.afterStaticContentLoad;if(b.no_class_name==undefined)this.done_class_name=["kred_purchase"].concat(b.done_class_name||[]).join(" ");this.activate()},initializeKongregateLightboxFromContent:function(a,b){b||(b={});var c=$(document.createElement("div"));c.innerHTML=(new Template($("kongregate_lightbox_wrapper_template_noframe").innerHTML)).evaluate({});
c.down("#lightbox_form").update(a);c.down("#kongregate_lightbox_spinner").hide();this.staticContent=c.innerHTML;this.done_class_name=["kred_purchase"].concat(b.done_class_name||[]).join(" ");this.afterStaticContentLoad=b.afterStaticContentLoad;this.activate()},keyUpHandler:function(a){if(a.keyCode==27){if(this.ajaxRequest){this.ajaxRequest.transport.abort();this.ajaxRequest=null}this.deactivate()}},clickHandler:function(a){if(a.target.id=="overlay"){if(this.ajaxRequest){this.ajaxRequest.transport.abort();
this.ajaxRequest=null}this.deactivate()}},activate:function(a){if($("lightbox"))if(!this._activated){this._activated=true;if(!this.done_class_name)this.done_class_name="done";if(Prototype.Browser.IE){this.getScroll();this.prepareIE("100%","hidden");this.setScroll(0,0);this.hideSelects("hidden")}this.cachedKeyUpHandler=this.keyUpHandler.bindAsEventListener(this);this.cachedClickHandler=this.clickHandler.bindAsEventListener(this);$(document).observe("keyup",this.cachedKeyUpHandler);$(document).observe("click",
this.cachedClickHandler);this.hideHiddenElements();setTimeout(function(){$("lightbox").className="loading";this.displayLightbox("block")}.bind(this),10);a&&typeof a=="object"&&a.stopPropagation&&a.stopPropagation()}},deactivate:function(){if(this._activated){this._activated=false;this.staticContent=undefined;var a=$("lbContent");a&&a.remove();if(Prototype.Browser.IE){this.setScroll(0,this.yPos);this.prepareIE("auto","auto");this.hideSelects("visible")}$(document).stopObserving("keyup",this.cachedKeyUpHandler);
$(document).stopObserving("click",this.cachedClickHandler);this.displayLightbox("none");this.done_class_name="done";(function(b,c){b.onClose.apply(b,c)}).defer(this,arguments);this.showHiddenElements()}},prepareIE:function(a,b){Prototype.Browser.IE6&&$$("html, body").each(function(c){c.setStyle({height:a,overflow:b})})},hideSelects:function(a){selects=document.getElementsByTagName("select");for(i=0;i<selects.length;i++)selects[i].style.visibility=a},domElementsToHide:function(){return $$("object").concat($$(".ad")).select(function(a){return a&&
"konduit"!=a.id&&"gamediv"!=a.id})},hideHiddenElements:function(){this.moveGameDivOffScreen();var a=this._dom_elements_actually_hidden=[];this.domElementsToHide().each(function(b){if("visible"==b.getStyle("visibility")){a.push(b);Prototype.Browser.Safari503?b.hide():b.setStyle({visibility:"hidden"});b.hiddenByLightbox=true}});this.hideGameInIFrame()},showHiddenElements:function(){this.moveGameDivOnScreen();if(this._dom_elements_actually_hidden){this._dom_elements_actually_hidden.each(function(a){Prototype.Browser.Safari503?
a.show():a.setStyle({visibility:"visible"});a.hiddenByLightbox=false});this.showGameInIFrame()}},hideGameInIFrame:function(){},showGameInIFrame:function(){},shouldMoveGameDiv:function(){return active_user&&active_user.isGamePage()},moveGameDivOffScreen:function(){$("game")&&this.shouldMoveGameDiv()&&$("game").setStyle({top:"-10000px",left:"-10000px"})},moveGameDivOnScreen:function(){$("game")&&this.shouldMoveGameDiv()&&$("game").setStyle({top:"",left:""})},getScroll:function(){if(self.pageYOffset)this.yPos=
self.pageYOffset;else if(document.documentElement&&document.documentElement.scrollTop)this.yPos=document.documentElement.scrollTop;else if(document.body)this.yPos=document.body.scrollTop},setScroll:function(a,b){window.scrollTo(a,b)},reloadInfoFromUrl:function(a,b){if($("lightbox_form")){if(b)$("lightbox").className=b;$("lightbox_form").update("");$("kongregate_lightbox_spinner").show();new Ajax.Updater("lightbox_form",a,{method:"get",evalScripts:true,onComplete:function(){Element.hide("kongregate_lightbox_spinner");
this.afterStaticContentLoad&&this.afterStaticContentLoad();this.afterStaticContentLoad=undefined}.bind(this)})}},displayLightbox:function(a){$("overlay").style.display=a;$("lightbox").style.display=a;a!="none"&&this.loadInfo()},loadInfo:function(){if(this.staticContent){this.renderContents(this.staticContent);this.staticContent=undefined;if(this.staticContentDivUrl){this.ajaxRequest=new Ajax.Updater("lightbox_form",this.staticContentDivUrl,{method:"get",evalScripts:true,onComplete:function(){Element.hide("kongregate_lightbox_spinner");
this.afterStaticContentLoad&&this.afterStaticContentLoad();this.afterStaticContentLoad=undefined}.bind(this)});this.staticContentDivUrl=undefined}else{this.afterStaticContentLoad&&this.afterStaticContentLoad();this.afterStaticContentLoad=undefined}}else new Ajax.Request(this.content,{method:"get",parameters:"",onComplete:this.processInfo.bindAsEventListener(this)})},processInfo:function(a){this.renderContents(a.responseText)},renderContents:function(a){a="<div id='lbContent'>"+a+"</div>";var b=$("lbLoadMessage");
new Insertion.Before(b,a);b.hide();$("lightbox").className=this.done_class_name;this.actions()},actions:function(){lbActions=document.getElementsByClassName("lbAction");var a=document.getElementById("username");a&&Prototype.Browser.Gecko&&Prototype.Platform.Macintosh&&a.focus();for(i=0;i<lbActions.length;i++){Event.observe(lbActions[i],"click",this[lbActions[i].rel].bindAsEventListener(this),false);lbActions[i].onclick=function(){return false}}},insert:function(a){link=Event.element(a).parentNode;
Element.remove($("lbContent"));new Ajax.Request(link.href,{method:"post",parameters:"",onComplete:this.processInfo.bindAsEventListener(this)})},toggleRegistration:function(){var a=$("lightbox"),b=$("lightboxlogin"),c=$("lightboxregister"),e,f,h;if(c.style.display=="block"){e="none";f="block";h="kred_purchase lightbox_login";active_user.focusFormField("username")}else{e="block";f="none";h="kred_purchase";active_user.focusFormField("user_username")}if(b)b.style.display=f;c.style.display=e;a.className=
h;if(pageTracker){pageTracker._trackEvent("Registration","begin_create");pageTracker._trackPageview("/accounts/begin_create")}},onClose:function(){if(this._on_close_callbacks)for(var a=arguments;this._on_close_callbacks.length>0;)this._on_close_callbacks.pop().apply(this,a);this._on_close_callbacks=[]},stopListening:function(){$$(".lbOn").each(function(a){a.stopObserving("click",a.observer_function,true);a.getElementsBySelector("a").each(function(b){if(b.original_onclick){b.onclick=b.original_onclick;
b.original_onclick=null}})})}};function initialize(){addLightboxMarkup();lbox=document.getElementsByClassName("lbOn");for(i=0;i<lbox.length;i++)valid=new lightbox(lbox[i])}
function addLightboxMarkup(){bod=document.getElementsByTagName("body")[0];overlay=document.createElement("div");overlay.id="overlay";lb=document.createElement("div");lb.id="lightbox";lb.className="loading";lb.innerHTML='<div id="lbLoadMessage"><p><img src="/images/presentation/indicator.gif" class="indicator" style="width: 16px; height: 16px;" /> Loading</p></div>';bod.appendChild(overlay);bod.appendChild(lb)};var NoteWatcher={watch:function(){var a=$("note"),b=$("submit");if(a.value!="")b.enable();else{b.disable();a.focus()}},setFocus:function(){$("note")&&$("note").focus()}};function NewsPostBox(){this.initialize()}
NewsPostBox.prototype={initialize:function(){this._spinner=$("news_post_box_submission_button_spinner");this._submit_button=$("news_post_box_submission_button");this._text_area=$("game_news_feed_item_content")},onSuccess:function(a){new Ajax.Request("/feed_items/"+a,{method:"get",onSuccess:function(b){this._text_area.setValue("");this.onComplete();$("news_post_success_message").update("Your update has been posted.").show();$("news_post_error_message").update("").hide();containers=$$(".js_news_posts");
containers.each(function(c){c.insert({top:b.responseText});new Effect.Highlight(c.down(".js_feed_item"));c.down(".js_feed_item")&&c.down(".js_feed_item").next(4)&&c.down(".js_feed_item").next(4).hide()});$("news_post_box").hide();$("news_post_link").show()}.bind(this),onFailure:function(){this.onFailure("Shout successfully created, but failed to update page.")}.bind(this)})},onFailure:function(a){$("news_post_error_message").update(a).show();this.onComplete()},onComplete:function(){this._spinner.hide();
this._submit_button.show()},deletePost:function(a){var b=$$(".js_delete_post_button_"+a),c=$$(".js_delete_post_spinner_"+a),e=$$(".js_game_post_"+a),f=$$(".js_news_item_error_message");b.invoke("hide");c.invoke("show");new Ajax.Request("/feed_items/"+a,{method:"delete",onSuccess:function(){c.invoke("hide");f.invoke("hide");e.each(function(h){new Effect.Fade(h,{duration:1})})}.bind(this),onFailure:function(){f.each(function(h){h.update("Failed to delete news item").show()});b.invoke("show");c.invoke("hide");
e.each(function(h){new Effect.Highlight(h,{startcolor:"#cc3333"})})}.bind(this)})}};d=document;ndc=[];coc=[];kg=true;function zelph_onDOMload(a,b){es=zelph_getElementsBySelector(a);if(ndc[a]==null){ndc[a]=0;coc[coc.length]="zelph_onDOMload('"+a+"', '"+b+"')"}if(es.length>ndc[a]){nes=es.length;for(var c=ndc[a];c<nes;c++){theTarget=es[c];eval(b)}ndc[a]=nes}kg==true&&setTimeout("zelph_onDOMload('"+a+"', '"+b+"')",100);return true}
function zelph_getElementsBySelector(a){var b=[];var c=b="",e=a,f=[];if(a.indexOf(" ")>0){b=a.split(" ");c=b[0].split("#");if(c.length==1)return f;if(d.getElementById(c[1]))return d.getElementById(c[1]).getElementsByTagName(b[1]);return false}if(a.indexOf("#")>0){b=a.split("#");e=b[0];b=b[1]}if(b!=""){if(d.getElementById(b)){f.push(d.getElementById(b));return f}return false}if(a.indexOf(".")>0){b=a.split(".");e=b[0];c=b[1]}b=d.getElementsByTagName(e);if(c=="")return b;for(a=0;a<b.length;a++){curClass=
" "+b[a].className+" ";curClass.indexOf(" "+c+" ")!="-1"&&f.push(b[a])}return f}function zelph_stopIt(){kg="";for(x=0;x<coc.length;x++)eval(coc[x])}function zelph_addLoadEvent(a){var b=window.onload;window.onload=typeof window.onload!="function"?a:function(){b();a()}}zelph_addLoadEvent(zelph_stopIt);var PaymentHelpText={showHelpText:function(a,b){var c=$("help_wrapper");b=$(b);if(!(a==""||a==null))if(b.className!="error_msg"){b.appendChild(c);$("help_text").innerHTML=a;c.show()}},hideHelpText:function(){$("help_wrapper").hide()}};function PostMessageHandler(a){function b(){return l}function c(p){var m;l.find(function(w){return m=w(p)});if(m)m();else try{bumper.embedAd(p)}catch(t){}}function e(p){c.defer(p.evalJSON())}function f(p){l.push(p)}function h(p){if(p.origin==window.location.protocol+"//"+window.location.host)try{e(p.data)}catch(m){}}var l=[];window.attachEvent?window.attachEvent("onmessage",h):window.addEventListener("message",h,false);return{addCallback:f,getHandlers:b,runCallbackForUnparsedPayload:e}};VALID_LOYALTY_CARD_NUMBER_LENGTH=12;VALID_LOYALTY_CARD_NUMBER_LENGTH_MAX=14;window.onPowerupRewardsLinkFailure=function(a){$("create_powerup_rewards_account_submit").restore();$("powerup_rewards_link_info").hide();if(a.match(/must be activated/)){a=a.split(". ");$("powerup_rewards_link_error_message").update(a[0]+".");$("please_check_number_content").update(a[1])}else $("powerup_rewards_link_error_message").update(a);$("powerup_rewards_link_errors").show()};
window.validatePowerupRewardsLoyaltyNumber=function(a){var b=a.length;if(window.luhn(a)&&(b>=VALID_LOYALTY_CARD_NUMBER_LENGTH||b<=VALID_LOYALTY_CARD_NUMBER_LENGTH_MAX)){$$("#powerup_rewards_link_errors,#powerup_rewards_link_info").each(Element.hide);return true}else{onPowerupRewardsLinkFailure("Loyalty card number is an invalid format");return false}};
window.luhn=function(a){var b=[[0,2,4,6,8,1,3,5,7,9],[0,1,2,3,4,5,6,7,8,9]],c=0;a.toString().replace(/\D+/g,"").replace(/[\d]/g,function(e,f,h){c+=b[h.length-f&1][parseInt(e,10)]});return 0===c%10&&c>0};
window.startPollingOnWork=function(a,b){var c=window.parent,e=c.powerupRewardsPoller,f=c.powerupRewardsPollerTimeout;e&&e.stop();f&&c.clearTimeout(f);e=new c.Ajax.Poller("/accounts/"+a+"/powerup_rewards/show_work?id="+b,{on200:function(h){f&&c.clearTimeout(f);e.stop();if(h.responseJSON.success){c.$("powerup_rewards_link_in_progress").hide();c.$("powerup_rewards_link_success").show();top.kredPurchaseSuccess=true;window.kongMobileApp&&window.kongMobileApp.dispatchEvent("power_up_rewards_account_linked",
"")}else c.onPowerupRewardsLinkFailure(h.responseJSON.message)}});f=c.setTimeout(function(){e.stop();c.onPowerupRewardsLinkFailure("Linking your account timed out, please try again later.")},12E4);c.powerupRewardsPollerTimeout=f;c.powerupRewardsPoller=e;e.start()};PremiumOnlyLinks={attachHandlers:function(){$$("a.premium_only").each(function(a){var b=a.onclick?a.onclick.bind(a):null;a.onclick=PremiumOnlyLinks.capturedSelectorWrapper.bindAsEventListener(active_user,b)});$$(".premium_icon").each(function(a){a.observe("click",function(){active_user.isPremium()||(a.up(".game")?lightbox.prototype.initializePremiumMembershipPurchase("beta_game","beta_tab"):lightbox.prototype.initializePremiumMembershipPurchase("username_icon","icon_tab"))})});active_user.isPremium()||
active_user.createCSS(".premium_icon","cursor: pointer");active_user.addRunWhenAuthenticatedObserver(function(){active_user.isPremium()&&active_user.createCSS(".premium_icon","cursor: default")})},capturedSelectorWrapper:function(a,b){var c="function"==typeof b;if(this.isPremium()){if(c)return b(a)}else{lightbox.prototype.initializePremiumMembershipPurchase("beta_game","beta_tab");Event.stop(a);return false}}};ProfileGearControl=function(a){this.initialize(a)};
ProfileGearControl.prototype={initialize:function(a){this._rollover_delay=a.rollover_delay||0.2;this._hover_target=$(a.hover_target_id);this._container=$(a.container_id);this._target_hovering_class=a.target_hovering_class;if(this._hover_target&&this._container){var b=this;this._hover_target.observe("mouseover",function(){b.onMouseOver()});this._container.observe("mouseover",function(){b.onMouseOver()});this._hover_target.observe("mouseout",function(){b.onMouseLeave()});this._container.observe("mouseout",
function(){b.onMouseLeave()})}},clearTimer:function(){this._reset_timer&&clearTimeout(this._reset_timer);this._reset_timer=null},showDropdown:function(){this._target_hovering_class&&this._hover_target.addClassName(this._target_hovering_class);this._container.show()},closeDropdown:function(){this._target_hovering_class&&this._hover_target.removeClassName(this._target_hovering_class);this._container.hide()},onMouseLeave:function(){this.clearTimer();this._waiting=false;this._reset_timer=this.closeDropdown.bind(this).delay(this._rollover_delay)},
onMouseOver:function(){this.clearTimer();if(this._waiting)this._reset_timer=this.showDropdown.bind(this).delay(this._rollover_delay);else{this._waiting=true;this._reset_timer=this.showDropdown.bind(this).delay(0)}}};function ProfileShoutBox(a){this.initialize(a)}
ProfileShoutBox.prototype={initialize:function(a){var b=a.submit_button_id||"shout_box_submission_button";this._shout_box=$(a.shout_box_id||"shout_content");this._submit_button=$(b);this._spinner=$(b+"_spinner");this._long_width=a.long_width||100;this._short_width=a.short_width||90;this.addShoutBoxObservers()},addShoutBoxObservers:function(){this._shout_box.observe("focus",this.onFocus.bind(this));this._shout_box.getValue()&&this.onFocus()},onFocus:function(){active_user.isAuthenticated()?this._shout_box.setAttribute("cols",
this._short_width):active_user.activateInlineLogin({},true)},onSuccess:function(a){new Ajax.Request("/feed_items/shout/"+a,{onSuccess:function(b){this._submit_button.show();this._shout_box.setValue("");this._spinner.hide();$("shout_error_message").update("");container=$("feed_items_container");container.insert({top:b.responseText});feedHandler.setFirstFeedItemClass();new Effect.Highlight(container.down(".feed_item"));$("empty_activit_feed")&&$("empty_activit_feed").remove()}.bind(this),onFailure:function(){this.onFailure("Shout successfully created, but failed to update feed.")}})},
onFailure:function(a){$("shout_error_message").update(a).show();this._submit_button.show();this._spinner.hide()}};var ProgressBar=function(a,b){b||(b={});this.value=b.value||0;this.maxValue=b.maxValue||100;a.addClassName("progress-bar");this.bar=new Element("div",{"class":"progress-bar-bar"});a.insert(this.bar);this.label=new Element("span",{"class":"progress-bar-label"});this.bar.insert(this.label);this.updateDisplay()};ProgressBar.prototype.setValue=function(a){this.value=a;this.updateDisplay()};ProgressBar.prototype.setMaxValue=function(a){this.maxValue=a;this.updateDisplay()};
ProgressBar.prototype.updateDisplay=function(){this.label.update('<a href="/accounts/'+active_user.getAttributes().username+'/points">'+this.value+" PTS</a>");this.bar.setStyle({width:this.value/this.maxValue*100+"%"})};function QuickPick(a){this.initialize(a)}
QuickPick.prototype={initialize:function(a){this._destination=a.destination;this._template=a.template;this._destination.down()},setQuickPicks:function(a){this._quick_picks=a.map(function(b){b.plays=b.plays.withDelimiters()+" plays";return b});this._last_pick=parseInt(Math.random()*a.length,10)},pickOne:function(){this._last_pick=(this._last_pick+1)%this._quick_picks.length;this._destination.update(this._template.evaluate(this._quick_picks[this._last_pick]))},spin:function(a,b,c){if(0==arguments.length)this.spin(10,
1.4,300);else{this.pickOne();a<c&&setTimeout(this.spin.bind(this,a*b,b,c),a)}if(!this._ever_spun){this._ever_spun=true;this.prefetchIcons()}},prefetchIcons:function(){var a=$(document.body);this._quick_picks.each(function(b){a.insert(new Element("img",{src:b.icon,style:"display:none"}))})}};RegistrationFormValidator=function(a,b){function c(w,B){if(w.getValue()==""){l(w,B+" can't be blank");return false}return true}function e(w,B,z){if(w.getValue().length<z){l(w,B+" is too short, needs to be "+z+" characters or longer");return false}return true}function f(w){if(!w.getValue().match(RFC822SingleEmailRegex)){l(w,"Invalid email address");return false}return true}function h(w,B){$(w).up("div.form_block, dl").down(".error_block").insert((new Element("span",{"class":"name_validation validation_symbol",
id:"availability_success"})).update(B||"&nbsp;"))}function l(w,B){w=$(w).up("div.form_block, dl").down(".error_block");var z=w.down("ul");if(!z){z=new Element("ul");w.insert(z)}z.insert((new Element("li")).update(B))}function p(w){$(w).up("div.form_block, dl").down(".error_block").innerHTML=""}function m(w){return w.sub("%s",b.fieldIdPrefix)}b||(b={});if(!b.fieldIdPrefix)b.fieldIdPrefix="user";var t=a.down(m("input#%s_username"));new AvailabilityCheck(t,{clear:function(){p(t);t.removeClassName("with_error")},
success:function(){h(t,"Username available!")},failure:function(w){t.addClassName("with_error");l(t,w)},generatedUsername:b.generatedUsername,validateLength:true});$(m("%s_password")).observe("blur",function(w){w=w.element();p(w);if(c(w,"Password")&&e(w,"Password",5)){w.removeClassName("with_error");h(w)}else w.addClassName("with_error")});$(m("%s_email_address")).observe("blur",function(w){w=w.element();p(w);if(c(w,"Email address")&&f(w)){w.removeClassName("with_error");h(w)}else w.addClassName("with_error")})};function ShareWithUsersTab(a,b,c){this.initialize(a,b,c)}
ShareWithUsersTab.prototype={initialize:function(a,b,c){this._share_dialog=b;this._tab_id=a;this._current_page=0;this._request_more_func=c;$(a+"_tab").observe("click",this.handleShowTab.bindAsEventListener(this))},getMore:function(){this._current_page++;this._request_more_func();$(this._tab_id+"_indicator").show()},handleShowTab:function(){this.refreshSelected()},handleScroll:function(){if($(this._tab_id).scrollTop+$(this._tab_id).getHeight()>=$(this._tab_id).scrollHeight){Event.stopObserving($(this._tab_id),
"scroll");this.getMore()}},onRequestSuccess:function(){$(this._tab_id).observe("scroll",this.handleScroll.bindAsEventListener(this))},onRequestComplete:function(){$(this._tab_id+"_indicator").hide();this.refreshSelected()},refreshSelected:function(){for(var a=$(this._tab_id).select(".user"),b=0;b<a.length;++b){var c=a[b].select("#recipient_ids_").first();c.checked=this._share_dialog.isSelected(c.value);this._share_dialog.isSelected(c.value)?a[b].addClassName("selected"):a[b].removeClassName("selected")}}};
function ShareWithFriendsDialog(a){this.initialize(a)}
ShareWithFriendsDialog.prototype={initialize:function(a){this._selected_users=[];this._user_limit=a;this._error_msg_timer=this._search_box_timer=null;$("max_users_error").hide();$("new_game_invite_feed_item").setAttribute("action","javascript:;")},setRequestFunctions:function(a,b,c){this._friends_tab=new ShareWithUsersTab("share_with_friends",this,a);this._friends_tab.getMore();this._fans_tab=new ShareWithUsersTab("share_with_fans",this,b);this._fans_tab.getMore();this._chat_members_tab=new ShareWithUsersTab("share_with_chat_members",
this,c);this._chat_members_tab.getMore()},toggleSelected:function(a,b){var c=this.findSelected(a),e=false;if(c>-1){this._selected_users.splice(c,1);e=true;$("error_messages").update("")}else if(this._selected_users.length<this._user_limit){c={};c.user_id=a;c.username=b;this._selected_users.push(c);e=true;$("error_messages").update("")}else if(this._selected_users.length>=this._user_limit){$("max_users_error").show();$("max_users_error").removeClassName("hidden");this._error_msg_timer!=null&&clearTimeout(this._search_box_timer);
this._error_msg_timer=setTimeout(function(){this._error_msg_timer=null;$("max_users_error").hide()},2500)}this._friends_tab.refreshSelected();this._fans_tab.refreshSelected();this._chat_members_tab.refreshSelected();$("selected_users").update(this.selectedUsersMessage());$("recipients").value=this.getSelectedUserIds();return e},selectedUsersMessage:function(){var a=this._selected_users.length;return a==0?"no users selected":a==1?this._selected_users[0].username+" selected":a==2?this._selected_users[0].username+
" and "+this._selected_users[1].username+" selected":a==3?this._selected_users[0].username+", "+this._selected_users[1].username+" and "+this._selected_users[2].username+" selected":a==4?this._selected_users[0].username+", "+this._selected_users[1].username+", "+this._selected_users[2].username+" and 1 other user selected":this._selected_users[0].username+", "+this._selected_users[1].username+", "+this._selected_users[2].username+" and "+(a-3)+" other users selected"},refreshSearchDropdown:function(){for(var a=
$$(".recipient_chooser").first().select(".user"),b=0;b<a.length;++b)this.isSelected(eval("("+a[b].down(".metadata").innerHTML+")").user_id)?a[b].addClassName("chosen"):a[b].removeClassName("chosen")},searchUserSelected:function(a){var b=shareWithFriendsDialog.toggleSelected(a.user_id,a.username);$("recipient_search").value="";if(b){$("recipient_search_container").hide();if(this.isSelected(a.user_id))$("recipient_list_updated_msg").innerHTML=a.username+" was added to the recipient list";else $("recipient_list_updated_msg").innerHTML=
a.username+" was removed from the recipient list";$("recipient_list_updated_msg").show();this._search_box_timer!=null&&clearTimeout(this._search_box_timer);this._search_box_timer=setTimeout(function(){this._search_box_timer=null;$("recipient_list_updated_msg").hide();$("recipient_search_container").show()},2500)}},findSelected:function(a){for(var b=0;b<this._selected_users.length;b++)if(this._selected_users[b].user_id==a)return b;return-1},isSelected:function(a){return this.findSelected(a)>-1},getSelectedUserIds:function(){for(var a=
"",b=0;b<this._selected_users.length;++b){a+=this._selected_users[b].user_id;if(b+1<this._selected_users.length)a+=","}return a}};var Shim={shimElement:function(a){var b=$("shim")||this.createShim();b.show();b.absolutize();b.clonePosition(a);this.hideIframe()},hide:function(){var a=$("shim");a&&a.hide();this.showIframe()},createShim:function(){var a=new Element("iframe",{id:"shim",style:"display:none; z-index:1000000 ; border: 0;"});a.setOpacity(0);document.body.insert({top:a});return a},hideIframe:function(){var a=$("gameiframe");a&&!a.hasClassName("dont_hide")&&a.up("#game").setStyle({top:"-10000px",left:"-10000px"})},showIframe:function(){var a=
$("gameiframe");a&&!a.hasClassName("dont_hide")&&a.up("#game").setStyle({top:"",left:""})}};var SiteStatsUpdater=function(){var a=new Template("<strong>#{users_online_count_with_delimiter}</strong> online playing <strong>#{games_count_with_delimiter}</strong> free games!"),b=new Template('<a onclick="holodeck.showChatTab(); return false;" href="#" class="spritegame">Join #{people_online_text} in chat right now!</a>');return{update:function(){new Ajax.Request("/site_stats.json",{method:"get",onSuccess:function(c){c=c.responseJSON;$("playing").update(a.evaluate(c));$("holodeck_chat_promotion")&&
$("holodeck_chat_promotion").update(b.evaluate(c));if(ls)try{pageTracker._trackEvent("LoadTime","SiteStatsFinished",document.location.pathname,(new Date).getTime()-ls)}catch(e){}}})}}}();function SkinChooser(a){this.initialize(a)}
SkinChooser.prototype={initialize:function(a){this._current_skin_class=a||"";this._default_style="background:#eee url(/images/presentation/new_homepage_background.png) repeat-x 0 0;";Roller.rolodex.user_skin_chooser=new Roller({scrollablePane:"user_skin_chooser_scrollable",scrollDuration:500,container:"user_skin_chooser_container",showDots:false});try{$("new_user_skin").down(".scroll_left").observe("click",function(){Roller.rolodex.user_skin_chooser.scrollToPreviousPaneAndStop()});$("new_user_skin").down(".scroll_right").observe("click",
function(){Roller.rolodex.user_skin_chooser.scrollToNextPaneAndStop()})}catch(b){}},updateSkin:function(a,b,c){if(!$("skins_pod_spinner").visible()){$("skins_pod_spinner").show();$("user_skin_skin_id").value=a;$("new_user_skin").onsubmit();$("primarywrap").setStyle(b);this.setBodyClass(c);$("new_user_skin").hide()}},setDefault:function(){if(!$("skins_pod_spinner").visible()){$("skins_pod_spinner").show();$("new_user_skin").hide()}this.setBodyClass("");$("primarywrap").setStyle(this._default_style)},
setBodyClass:function(a){var b=$$("body").first();b.removeClassName(this._current_skin_class);this._current_skin_class=a;b.addClassName(this._current_skin_class)},onSkinSet:function(){$("skins_pod_spinner").hide();$("new_user_skin").show()}};Element.addMethods({textNodes:function(a){return $A(a.childNodes).map(function(b){return b.nodeType==3?[b]:b.nodeType==1?$(b).textNodes():[]}).flatten()},splitLongWords:function(a){var b=/\S{30,}/,c=function(){return Prototype.Browser.IE?document.createElement("wbr"):document.createTextNode(String.fromCharCode(8203))};a.textNodes().each(function(e){var f=e.parentNode;e=e;for(var h;(h=e.nodeValue.search(b))>=0;)if(/http:/.test(e.nodeValue.substr(0,h+30)))if(/^\s/.test(e.nodeValue)){h=e.nodeValue.search(/\S/);
e=e.splitText(h)}else if((h=e.nodeValue.search(/\s+/))>=0)e=e.splitText(h);else return;else{e=e.splitText(h+30);f.insertBefore(c(),e)}})}});document.observe("dom:loaded",function(){$$(".splittext").invoke("splitLongWords")});var delayed_response;function facebookSignInSuccess(a){if(active_user.isAuthenticated()&&a.new_facebook_connection)existingUserConnected();else a.existing_user?setActiveUser(a):accountCreationSuccess(a)}
function existingUserConnected(){new FacebookFriendFinder(function(a){try{lightbox.prototype.shutdown()}catch(b){}lightbox.prototype.initializeKongregateLightboxFromAjax("/facebook_connection/confirm",{done_class_name:a.friends.length>0?"wide":"fb_confirm_narrow",afterStaticContentLoad:function(){a.friends.length>0?a.displayFriendForm("/account"+active_user.username()+"/friends/create_many",$("facebook_friends"),function(){try{lightbox.prototype.shutdown()}catch(c){}}):$("facebook_friends_wrapper").hide();
lightbox.prototype.addOnCloseCallback(function(){active_user.isGamePage()?$$(".facebook_nav_item").invoke("hide"):window.location.reload()})}})})}
function accountCreationSuccess(a){if(a.game){active_user.invokeConversionIframe();if(a.from_facebook){try{lightbox.prototype.shutdown()}catch(b){}lightbox.prototype.initializeKongregateLightboxFromAjax(a.full_finalize_form_facebook_connection_url,{done_class_name:"lightbox_login"});delayed_response=a}else setActiveUser(a)}else if(a.from_facebook){delayed_response=a;try{lightbox.prototype.shutdown()}catch(c){}lightbox.prototype.initializeKongregateLightboxFromAjax(a.full_finalize_form_facebook_connection_url,
{done_class_name:"lightbox_login"})}else{Cookie.set("_kong_acct_created","true",1,"/");window.location.href=a.destination_uri}}
function accountCreationFailure(a){tracking_code_service.reportTrackingCode();if(a.banned)if(a.from_lightbox)$("lightbox_email_register").replace(a.content);else window.location.href=a.banned_url;else if(a.from_lightbox){$("lightbox_form").update(a.content);lightbox.prototype.toggleRegistration()}else if(a.signup_tab)parent.$("signup_tab_form").update(a.content);else{var b=parent.$("signup_pod_form");if(b)b.update(a.content);else(b=parent.$("accounts_new_form")||parent.$("new_user"))&&b.replace(a.content);
active_user.solvedCaptcha()&&$("user_captcha_validation")&&$("user_captcha_validation").hide()}}
function sessionStatus(a){if(window.frames.secure_login_frame)window.frames.secure_login_frame.location.href="about:blank";if(Cookie.accept())if(a.authenticated)if(a.game)setActiveUser(a);else{try{$("welcome_box_sign_in_button").disable()}catch(b){}window.location.href=a.destination_uri}else if(a.ban_id)window.location.href=a.banned_url;else{a.from_lightbox&&$("lightboxlogin").replace(a.content);try{$("welcome_box_sign_in_button").restore()}catch(c){}try{$("sessions_new_form_spinner").restore()}catch(e){}active_user.activateInlineLogin()}else window.location.href="http://www.kongregate.com/sessions/new"}
function finalizeCompletion(a){setActiveUser(a&&a.response?a.response:delayed_response)}
function finalizeFailure(a){if($("lightbox").visible()||holodeck.isShowingSignupTab()){$$(".error_block").invoke("remove");$$(".with_error").invoke("removeClassName","with_error");$H(a.errors).each(function(b){var c=b[0];b=b[1];$("user_"+c+"_label").insert({before:"<span class='error_block error'>"+b+"</span>"});$("user_"+c).addClassName("with_error")});$("facebook_signup_submit_button").restore();$("facebook_signup_skip_button").show()}else setActiveUser(delayed_response)}
function showFriendFinderForm(a,b){var c="/accounts/"+b.username+"/friends/create_many",e=function(){b.new_facebook_connection=false;setActiveUser(b)};try{lightbox.prototype.shutdownWithoutCallbacks()}catch(f){}lightbox.prototype.initializeKongregateLightboxFromContent('<div id="facebook_friends"></div>',{done_class_name:"lightbox_login",afterStaticContentLoad:function(){a.displayFriendForm(c,$("facebook_friends"),function(){try{lightbox.prototype.shutdown()}catch(h){}});lightbox.prototype.addOnCloseCallback(e)}})}
function setupWelcomeMessageCookie(){var a=Cookie.get("temp_flash_message");if(a){Cookie.set(FlashMessages.COOKIE_NAME,Object.toJSON({messages:[a]}));Cookie.erase("temp_flash_message","/")}}
function setActiveUser(a){if(a&&a.new_facebook_connection)new FacebookFriendFinder(function(c){if(c.friends.length>0)showFriendFinderForm(c,a);else{a.new_facebook_connection=false;setActiveUser(a)}});else{try{top.lightbox.prototype.shutdown();tracking_code_service.reportTrackingCode()}catch(b){}if(active_user.isGamePage()){active_user.updateAttributes(a.user_data_sigil);holodeck.switchUser(a.chat_username,a.chat_password,a.user_chat_hash,a.game_auth_token,a.user_id,true);holodeck.closeSignupTab();
holodeck.rebootstrapChat();GameMetricsUpdater.update();a.default_nag&&holodeck.updateDefaultChatNag(a.default_nag);$("share_tab_pane_content").update(a.shared_tab_pane_content);active_user.runCapturedFunction();holodeck.redoPromptSavedSharedContent();holodeck.redoShowSharedContentsIndex();holodeck.loadAdminControls(active_user);a.has_pending_collaborators&&holodeck.loadCollaborators();holodeck.loadDiscussions();holodeck.prepareAvatarTab()}else{setupWelcomeMessageCookie(a);if(a.destination_uri)window.location.href=
a.destination_uri;else window.location.reload()}}};function addDOMLoadEvent(a){if(!window.__load_events){var b=function(){if(!arguments.callee.done){arguments.callee.done=true;if(window.__load_timer){clearInterval(window.__load_timer);window.__load_timer=null}for(var c=0;c<window.__load_events.length;c++)window.__load_events[c]();window.__load_events=null}};document.addEventListener&&document.addEventListener("DOMContentLoaded",b,false);if(/WebKit/i.test(navigator.userAgent))window.__load_timer=setInterval(function(){/loaded|complete/.test(document.readyState)&&
b()},10);window.onload=b;window.__load_events=[]}window.__load_events.push(a)}
function tabset(){if(!document.getElementById)return false;var a=document.getElementsByTagName("dl");for(k=0;k<a.length;k++){var b=a[k];if(b.className.indexOf("tabset")!=-1){var c=0,e=b.getElementsByTagName("dd");for(i=0;i<e.length;i++)if(e[i].parentNode==b){if(i==0)var f=e.item(0);else e[i].style.display="none";e[i].count=c++}c=[];e=b.getElementsByTagName("dt");for(i=0;i<e.length;i++)if(e[i].parentNode==b)c[c.length]=e[i];b=[];for(i=0;i<c.length;i++){if(!c[i].transformed_to_tab){c[i].transformed_to_tab=
true;c[i].count=i;c[i].onclick=toggleDt;c[i].innerHTML="<a href='#' title='"+c[i].innerHTML+"'>"+c[i].innerHTML+"</a>";c[i].parentNode.removeChild(c[i]);f.parentNode.insertBefore(c[i],f)}if(c[i].className.indexOf("active")>=0)b[b.length]=c[i]}for(i=0;i<b.length;i++)b[i].onclick()}}}
function toggleDt(){var a=this.parentNode.getElementsByTagName("dt");for(i=0;i<a.length;i++)if(this==a[i]&&this.className.indexOf("dormant")>=0&&this.className.indexOf("active")==-1&&a[i].parentNode==this.parentNode){this.className+=" active";this.className=this.className.replace(/(?:^\s*|\s*$)/,"")}else if(this!=a[i]&&a[i].parentNode==this.parentNode)a[i].className=a[i].className.replace("active","dormant");a=this.parentNode.getElementsByTagName("dd");for(i=0;i<a.length;i++)if(a[i].parentNode==this.parentNode)a[i].style.display=
this.count==a[i].count?"block":"none";return false}addDOMLoadEvent(tabset);TimeInWordsHelper={distanceInWords:function(a,b,c){a=a.getTime();b=b.getTime();b=Math.round(Math.abs(a-b)/1E3);a=Math.round(b/60);if(a<=1){if(!c)return 0==a?"less than a minute":"1 minute";if(b<5)return"less than 5 seconds";if(b<10)return"less than 10 seconds";if(b<20)return"less than 20 seconds";if(b<40)return"half a minute";if(b<60)return"less than a minute";return"1 minute"}if(a<45)return a+" minutes";if(a<90)return"1 hour";if(a<1440)return Math.round(a/60)+" hours";if(a<2880)return"1 day";if(a<
43200)return Math.round(a/1440)+" days";if(a<86400)return"about 1 month";if(a<525600)return Math.round(a/43200)+" months";if(a<1051200)return"about 1 year";return"over "+Math.round(a/525600)+" years"},distanceInWordsFromNow:function(a,b){return TimeInWordsHelper.distanceInWords(new Date,a,b)}};TippingPointMeter=function(a){this.initialize(a)};
TippingPointMeter.prototype={initialize:function(a){this._target_node=$(a.target_node_id);this._current_value=a.current_value||0;this._max_value=a.max_value||100;this._value_label=a.value_label;this._meter_node=this._target_node.down(".meter");this._meter_node.addClassName("tipping-point-meter");this._bar_ele=new Element("div",{"class":"tipping-point-meter-bar"});this._meter_node.insert(this._bar_ele);this._label_ele=this._target_node.down(".number_gifts");this._label_ele.update(this._value_label);
this._bar_ele.setStyle({width:this._current_value/this._max_value*100+"%"})}};function TrackingCodeService(a){var b=a.dataProvider,c=a.pageTracker,e={},f=function(){l(b().tracking_code,function(m){c._trackPageview(m);(m=p(m))&&c._trackEvent(m[0],m[1])});b().tracking_code=undefined},h=function(){l(b().minor_tracking_code,function(m){(m=p(m))&&c._trackEvent(m[0],m[1])});b().minor_tracking_code=undefined},l=function(m,t){if(m&&c){var w=(new Date).getTime(),B=e[m];if(!B||w-B>15E3){e[m]=w;t(m)}}},p=function(m){if(!m)return null;if((m=m.match(/^\/([^\/]*)\/(.*)$/))&&3==m.length)return[TrackingCodeService.TRACKING_CODE_EVENT_CATEGORIES[m[1]],
m[2]]};a=function(){f();h()};a();return{reportTrackingCode:a}}TrackingCodeService.TRACKING_CODE_EVENT_CATEGORIES={games:"GameSubmission",accounts:"Registration",sessions:"Sessions"};function autoInit_trees(){for(var a=document.getElementsByTagName("ul"),b=0;b<a.length;b++)if(a[b].className&&a[b].className.indexOf("tree")!=-1){initTree(a[b]);a[b].className=a[b].className.replace(/ ?unformatted ?/," ")}}
function initTree(a){var b,c,e,f,h,l,p;for(b=0;b<a.childNodes.length;b++)if(a.childNodes[b].tagName&&a.childNodes[b].tagName.toLowerCase()=="li"){var m=a.childNodes[b];e=document.createElement("span");c=document.createElement("span");f=document.createElement("span");e.appendChild(c);c.appendChild(f);e.className="a "+m.className.replace("closed","spanClosed");e.onMouseOver=function(){};c.className="b";c.onclick=treeToggle;f.className="c";l=m.childNodes.length;h=0;p=null;for(c=0;c<m.childNodes.length;c++)if(m.childNodes[c].tagName&&
m.childNodes[c].tagName.toLowerCase()=="div")h=c+1;else if(m.childNodes[c].tagName&&m.childNodes[c].tagName.toLowerCase()=="ul"){p=m.childNodes[c];l=c;break}for(c=h;c<l;c++)f.appendChild(m.childNodes[h]);m.childNodes.length>h?m.insertBefore(e,m.childNodes[h]):m.appendChild(e);if(p!=null)if(initTree(p)){addClass(m,"children","closed");addClass(e,"children","spanClosed")}}if(m){addClass(m,"last","closed");addClass(e,"last","spanClosed");return true}else return false}
function treeToggle(a,b){for(a=this;a!=null&&(!a.tagName||a.tagName.toLowerCase()!="li");)a=a.parentNode;var c=findChildWithTag(a,"ul"),e=findChildWithTag(a,"span");if(b!=null)if(b=="open")treeOpen(e,a);else b=="close"&&treeClose(e,a);else if(c!=null)a.className.match(/(^| )closed($| )/)?treeOpen(e,a):treeClose(e,a)}function treeOpen(a,b){removeClass(a,"spanClosed");removeClass(b,"closed")}function treeClose(a,b){addClass(a,"spanClosed");addClass(b,"closed")}
function findChildWithTag(a,b){for(var c=0;c<a.childNodes.length;c++)if(a.childNodes[c].tagName!=null&&a.childNodes[c].tagName.toLowerCase()==b)return a.childNodes[c];return null}function addClass(a,b,c){if(c!=null&&a.className.match(new RegExp("(^| )"+c)))a.className=a.className.replace(new RegExp("( |^)"+c),"$1"+b+" "+c);else if(!a.className.match(new RegExp("(^| )"+b+"($| )"))){a.className+=" "+b;a.className=a.className.replace(/(^ +)|( +$)/g,"")}}
function removeClass(a,b){var c=" "+a.className+" ";c=c.replace(new RegExp(" ("+b+" +)+","g")," ");a.className=c.replace(/(^ +)|( +$)/g,"")}_LOADERS=Array();function callAllLoaders(){var a,b;for(a=0;a<_LOADERS.length;a++){b=_LOADERS[a];b!=callAllLoaders&&b()}}function appendLoader(a){if(window.onload&&window.onload!=callAllLoaders)_LOADERS[_LOADERS.length]=window.onload;window.onload=callAllLoaders;_LOADERS[_LOADERS.length]=a}appendLoader(autoInit_trees);UniversalTabs=function(){var a=0,b=function(e,f){var h=e.readAttribute("href"),l="dynamic-tab-"+a++;f=e.up(".tab_container").down(".tab_group");e.writeAttribute("href","#"+l);f.insert({bottom:(new Element("div",{id:l,"class":"tab"})).update('<span class="spinner spinner_big">Loading...</span>')});new Ajax.Request(h,{method:"get",evalScripts:true,onSuccess:function(p){$(l).update(p.responseText)},onFailure:function(){$(l).update("")}})},c=function(e){var f=e.readAttribute("href");f=$(f.sub("#",""));
f.siblings().each(function(h){h.removeClassName("active")});f.addClassName("active");e.up().siblings().each(function(h){h.down().removeClassName("active")});e.addClassName("active")};return{setup:function(){$$(".tab_container").each(function(e){$(e).addClassName("js")});$$(".tab_index a").each(function(e){if(e.hasClassName("active")&&!e.readAttribute("href").include("#")){b(e);c(e)}e.observe("click",function(f){f.stop();e.readAttribute("href").include("#")||b(e);c(e)})})}}}();
document.observe("dom:loaded",function(){UniversalTabs.setup()});
