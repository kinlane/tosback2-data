/**
 * Unobtrusive scripting adapter for jQuery
 *
 * Requires jQuery 1.6.0 or later.
 * https://github.com/rails/jquery-ujs

 * Uploading file using rails.js
 * =============================
 *
 * By default, browsers do not allow files to be uploaded via AJAX. As a result, if there are any non-blank file fields
 * in the remote form, this adapter aborts the AJAX submission and allows the form to submit through standard means.
 *
 * The `ajax:aborted:file` event allows you to bind your own handler to process the form submission however you wish.
 *
 * Ex:
 *     $('form').live('ajax:aborted:file', function(event, elements){
 *       // Implement own remote file-transfer handler here for non-blank file inputs passed in `elements`.
 *       // Returning false in this handler tells rails.js to disallow standard form submission
 *       return false;
 *     });
 *
 * The `ajax:aborted:file` event is fired when a file-type input is detected with a non-blank value.
 *
 * Third-party tools can use this hook to detect when an AJAX file upload is attempted, and then use
 * techniques like the iframe method to upload the file instead.
 *
 * Required fields in rails.js
 * ===========================
 *
 * If any blank required inputs (required="required") are detected in the remote form, the whole form submission
 * is canceled. Note that this is unlike file inputs, which still allow standard (non-AJAX) form submission.
 *
 * The `ajax:aborted:required` event allows you to bind your own handler to inform the user of blank required inputs.
 *
 * !! Note that Opera does not fire the form's submit event if there are blank required inputs, so this event may never
 *    get fired in Opera. This event is what causes other browsers to exhibit the same submit-aborting behavior.
 *
 * Ex:
 *     $('form').live('ajax:aborted:required', function(event, elements){
 *       // Returning false in this handler tells rails.js to submit the form anyway.
 *       // The blank required inputs are passed to this function in `elements`.
 *       return ! confirm("Would you like to submit the form with missing info?");
 *     });
 */
function RepositionNav(){var a=$(window).height(),b=$("#nav").height()/2,c=a/2,d=c-b;$("#nav").css({top:d})}function number_to_currency(a){var b=Number(a).toFixed(2),c=b-parseInt(b);return c==0?"$"+String(Number(a).toFixed(0)):"$"+String(Number(a).toFixed(2))}function is_email_valid(a){return!!a.match(/^[^@\s]+@(?:[-a-z0-9]+\.)+[a-z]{2,}$/i)}function on_page(){var a=arguments[0],b=a.split(/\s*,\s*/),c=arguments;$(document).ready(function(){if(_.include(b,$("body").attr("id")))for(var a=1;a<c.length;a++)c[a].call(this)})}function delegate_chain(){return function(a){return function(b){var c;for(var d=0,e=a.length;d<e;d++){if(typeof a[d]!="function")throw"delegate_chain was passed a parameter that isnt a function";var f=a[d].apply(this,arguments);if(f===!1)return b.stopPropagation(),b.preventDefault(),!1}}}(arguments)}(function(a,b){var c;a.rails=c={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not(button[type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(b){var c=a('meta[name="csrf-token"]').attr("content");c&&b.setRequestHeader("X-CSRF-Token",c)},fire:function(b,c,d){var e=a.Event(c);return b.trigger(e,d),e.result!==!1},confirm:function(a){return confirm(a)},ajax:function(b){return a.ajax(b)},handleRemote:function(d){var e,f,g,h=d.data("cross-domain")||null,i=d.data("type")||a.ajaxSettings&&a.ajaxSettings.dataType,j;if(c.fire(d,"ajax:before")){if(d.is("form")){e=d.attr("method"),f=d.attr("action"),g=d.serializeArray();var k=d.data("ujs:submit-button");k&&(g.push(k),d.data("ujs:submit-button",null))}else d.is(c.inputChangeSelector)?(e=d.data("method"),f=d.data("url"),g=d.serialize(),d.data("params")&&(g=g+"&"+d.data("params"))):(e=d.data("method"),f=d.attr("href"),g=d.data("params")||null);j={type:e||"GET",data:g,dataType:i,crossDomain:h,beforeSend:function(a,e){return e.dataType===b&&a.setRequestHeader("accept","*/*;q=0.5, "+e.accepts.script),c.fire(d,"ajax:beforeSend",[a,e])},success:function(a,b,c){d.trigger("ajax:success",[a,b,c])},complete:function(a,b){d.trigger("ajax:complete",[a,b])},error:function(a,b,c){d.trigger("ajax:error",[a,b,c])}},f&&(j.url=f),c.ajax(j)}},handleMethod:function(c){var d=c.attr("href"),e=c.data("method"),f=c.attr("target"),g=a("meta[name=csrf-token]").attr("content"),h=a("meta[name=csrf-param]").attr("content"),i=a('<form method="post" action="'+d+'"></form>'),j='<input name="_method" value="'+e+'" type="hidden" />';h!==b&&g!==b&&(j+='<input name="'+h+'" value="'+g+'" type="hidden" />'),f&&i.attr("target",f),i.hide().append(j).appendTo("body"),i.submit()},disableFormElements:function(b){b.find(c.disableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";b.data("ujs:enable-with",b[c]()),b[c](b.data("disable-with")),b.prop("disabled",!0)})},enableFormElements:function(b){b.find(c.enableSelector).each(function(){var b=a(this),c=b.is("button")?"html":"val";b.data("ujs:enable-with")&&b[c](b.data("ujs:enable-with")),b.prop("disabled",!1)})},allowAction:function(a){var b=a.data("confirm"),d=!1,e;return b?(c.fire(a,"confirm")&&(d=c.confirm(b),e=c.fire(a,"confirm:complete",[d])),d&&e):!0},blankInputs:function(b,c,d){var e=a(),f,g=c||"input,textarea";return b.find(g).each(function(){f=a(this);if(d?f.val():!f.val())e=e.add(f)}),e.length?e:!1},nonBlankInputs:function(a,b){return c.blankInputs(a,b,!0)},stopEverything:function(b){return a(b.target).trigger("ujs:everythingStopped"),b.stopImmediatePropagation(),!1},callFormSubmitBindings:function(c){var d=c.data("events"),e=!0;return d!==b&&d.submit!==b&&a.each(d.submit,function(a,b){if(typeof b.handler=="function")return e=b.handler(b.data)}),e},disableElement:function(a){a.data("ujs:enable-with",a.html()),a.html(a.data("disable-with")),a.bind("click.railsDisable",function(a){return c.stopEverything(a)})},enableElement:function(a){a.data("ujs:enable-with")!==b&&(a.html(a.data("ujs:enable-with")),a.data("ujs:enable-with",!1)),a.unbind("click.railsDisable")}},a.ajaxPrefilter(function(a,b,d){a.crossDomain||c.CSRFProtection(d)}),a(c.linkDisableSelector).live("ajax:complete",function(){c.enableElement(a(this))}),a(c.linkClickSelector).live("click.rails",function(d){var e=a(this),f=e.data("method"),g=e.data("params");if(!c.allowAction(e))return c.stopEverything(d);e.is(c.linkDisableSelector)&&c.disableElement(e);if(e.data("remote")!==b)return(d.metaKey||d.ctrlKey)&&(!f||f==="GET")&&!g?!0:(c.handleRemote(e),!1);if(e.data("method"))return c.handleMethod(e),!1}),a(c.inputChangeSelector).live("change.rails",function(b){var d=a(this);return c.allowAction(d)?(c.handleRemote(d),!1):c.stopEverything(b)}),a(c.formSubmitSelector).live("submit.rails",function(d){var e=a(this),f=e.data("remote")!==b,g=c.blankInputs(e,c.requiredInputSelector),h=c.nonBlankInputs(e,c.fileInputSelector);if(!c.allowAction(e))return c.stopEverything(d);if(g&&e.attr("novalidate")==b&&c.fire(e,"ajax:aborted:required",[g]))return c.stopEverything(d);if(f)return h?c.fire(e,"ajax:aborted:file",[h]):!a.support.submitBubbles&&c.callFormSubmitBindings(e)===!1?c.stopEverything(d):(c.handleRemote(e),!1);setTimeout(function(){c.disableFormElements(e)},13)}),a(c.formInputClickSelector).live("click.rails",function(b){var d=a(this);if(!c.allowAction(d))return c.stopEverything(b);var e=d.attr("name"),f=e?{name:e,value:d.val()}:null;d.closest("form").data("ujs:submit-button",f)}),a(c.formSubmitSelector).live("ajax:beforeSend.rails",function(b){this==b.target&&c.disableFormElements(a(this))}),a(c.formSubmitSelector).live("ajax:complete.rails",function(b){this==b.target&&c.enableFormElements(a(this))})})(jQuery),function(){"use strict","bind"in Function.prototype||(Function.prototype.bind=function(a){var b=this;if(arguments.length<=1)return function(){return b.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){return b.apply(a,arguments.length===0?c:c.concat(Array.prototype.slice.call(arguments)))}}),"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,b){b===undefined&&(b=0),b<0&&(b+=this.length),b<0&&(b=0);for(var c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,b){b===undefined&&(b=this.length-1),b<0&&(b+=this.length),b>this.length-1&&(b=this.length-1);for(b++;b-->0;)if(b in this&&this[b]===a)return b;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;c<d;c++)c in this&&a.call(b,this[c],c,this)}),"map"in Array.prototype||(Array.prototype.map=function(a,b){var c=new Array(this.length);for(var d=0,e=this.length;d<e;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),"filter"in Array.prototype||(Array.prototype.filter=function(a,b){var c=[],d;for(var e=0,f=this.length;e<f;e++)e in this&&a.call(b,d=this[e],e,this)&&c.push(d);return c}),"every"in Array.prototype||(Array.prototype.every=function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(a,b){for(var c=0,d=this.length;c<d;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1})}();var BinaryFile=function(a,b,c){var d=a,e=b||0,f=0;this.getRawData=function(){return d},typeof a=="string"?(f=c||d.length,this.getByteAt=function(a){return d.charCodeAt(a+e)&255},this.getBytesAt=function(a,b){var c=[];for(var f=0;f<b;f++)c[f]=d.charCodeAt(a+f+e)&255;return c}):typeof a=="unknown"&&(f=c||IEBinary_getLength(d),this.getByteAt=function(a){return IEBinary_getByteAt(d,a+e)},this.getBytesAt=function(a,b){return(new VBArray(IEBinary_getBytesAt(d,a+e,b))).toArray()}),this.getLength=function(){return f},this.getSByteAt=function(a){var b=this.getByteAt(a);return b>127?b-256:b},this.getShortAt=function(a,b){var c=b?(this.getByteAt(a)<<8)+this.getByteAt(a+1):(this.getByteAt(a+1)<<8)+this.getByteAt(a);return c<0&&(c+=65536),c},this.getSShortAt=function(a,b){var c=this.getShortAt(a,b);return c>32767?c-65536:c},this.getLongAt=function(a,b){var c=this.getByteAt(a),d=this.getByteAt(a+1),e=this.getByteAt(a+2),f=this.getByteAt(a+3),g=b?(((c<<8)+d<<8)+e<<8)+f:(((f<<8)+e<<8)+d<<8)+c;return g<0&&(g+=4294967296),g},this.getSLongAt=function(a,b){var c=this.getLongAt(a,b);return c>2147483647?c-4294967296:c},this.getStringAt=function(a,b){var c=[],d=this.getBytesAt(a,b);for(var e=0;e<b;e++)c[e]=String.fromCharCode(d[e]);return c.join("")},this.getCharAt=function(a){return String.fromCharCode(this.getByteAt(a))},this.toBase64=function(){return window.btoa(d)},this.fromBase64=function(a){d=window.atob(a)}},BinaryAjax=function(){function a(){var a=null;return window.ActiveXObject?a=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(a=new XMLHttpRequest),a}function b(b,c,d){var e=a();e?(c&&(typeof e.onload!="undefined"?e.onload=function(){e.status=="200"?c(this):d&&d(),e=null}:e.onreadystatechange=function(){e.readyState==4&&(e.status=="200"?c(this):d&&d(),e=null)}),e.open("HEAD",b,!0),e.send(null)):d&&d()}function c(b,c,d,e,f,g){var h=a();if(h){var i=0;e&&!f&&(i=e[0]);var j=0;e&&(j=e[1]-e[0]+1),c&&(typeof h.onload!="undefined"?h.onload=function(){h.status=="200"||h.status=="206"||h.status=="0"?(h.binaryResponse=new BinaryFile(h.responseText,i,j),h.fileSize=g||h.getResponseHeader("Content-Length"),c(h)):d&&d(),h=null}:h.onreadystatechange=function(){if(h.readyState==4){if(h.status=="200"||h.status=="206"||h.status=="0"){var a={status:h.status,binaryResponse:new BinaryFile(typeof h.responseBody=="unknown"?h.responseBody:h.responseText,i,j),fileSize:g||h.getResponseHeader("Content-Length")};c(a)}else d&&d();h=null}}),h.open("GET",b,!0),h.overrideMimeType&&h.overrideMimeType("text/plain; charset=x-user-defined"),e&&f&&h.setRequestHeader("Range","bytes="+e[0]+"-"+e[1]),h.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),h.send(null)}else d&&d()}return function(a,d,e,f){f?b(a,function(b){var g=parseInt(b.getResponseHeader("Content-Length"),10),h=b.getResponseHeader("Accept-Ranges"),i,j;i=f[0],f[0]<0&&(i+=g),j=i+f[1]-1,c(a,d,e,[i,j],h=="bytes",g)}):c(a,d,e)}}();document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n\tIEBinary_getByteAt = AscB(MidB(strBinary, iOffset + 1, 1))\r\nEnd Function\r\nFunction IEBinary_getBytesAt(strBinary, iOffset, iLength)\r\n  Dim aBytes()\r\n  ReDim aBytes(iLength - 1)\r\n  For i = 0 To iLength - 1\r\n   aBytes(i) = IEBinary_getByteAt(strBinary, iOffset + i)\r\n  Next\r\n  IEBinary_getBytesAt = aBytes\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n\tIEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n</script>\r\n");var EXIF={};(function(){function b(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function c(a){return!!a.exifdata}function d(a,b){BinaryAjax(a.src,function(c){var d=e(c.binaryResponse);a.exifdata=d||{},b&&b()})}function e(b){var c=[],d=[];if(b.getByteAt(0)!=255||b.getByteAt(1)!=216)return c;var e=2,g=b.getLength();while(e<g){if(b.getByteAt(e)!=255){a&&console.log("Not a valid marker at offset "+e+", found: "+b.getByteAt(e));var h={};for(var i=0;i<c.length;i++)$.extend(h,c[i]);return h}var k=b.getByteAt(e+1);k==22400?(a&&console.log("Found 0xFFE1 marker"),c.push(j(b,e+4,b.getShortAt(e+2,!0)-2)),e+=2+b.getShortAt(e+2,!0)):k==225?(a&&console.log("Found 0xFFE1 marker"),c.push(j(b,e+4,b.getShortAt(e+2,!0)-2))):k==237&&(a&&console.log("Found 0xFFED marker"),c.push(f(b,e+4,b.getShortAt(e+2,!0)-2))),e+=2+b.getShortAt(e+2,!0)}}function f(b,c,d){exif={};if(b.getStringAt(c,9)!="Photoshop")return a&&console.log("Not valid Photoshop data! "+b.getStringAt(c,9)),!1;var e=[];for(i=0;i<d;i++){var f=String(b.getByteAt(c+i))+":"+String(b.getByteAt(c+i+1)),g=b.getByteAt(c+i+3),h=b.getByteAt(c+i+2);if(g!=0){if(f=="2:120"){var j=b.getStringAt(c+i+4,g);try{exif.ImageDescription=decodeURIComponent(escape(j))}catch(k){}}if(f=="2:15")var l=b.getStringAt(c+i+4,g);if(f=="2:20")var m=b.getStringAt(c+i+4,g);if(f=="2:25"){var n=b.getStringAt(c+i+4,g);try{e.push(decodeURIComponent(escape(n)))}catch(k){}}if(f=="2:5"&&h!=7){var o=b.getStringAt(c+i+4,g);try{exif.ImageTitle=decodeURIComponent(escape(o))}catch(k){}}if(f=="2:80"){var p=b.getStringAt(c+i+4,g);exif.Artist=p}}}return exif.ImageKeywords=e.join(","),exif.ImageCategory=l||m,exif}function g(b,c,d,e,f){var g=b.getShortAt(d,f),i={};for(var j=0;j<g;j++){var k=d+j*12+2,l=e[b.getShortAt(k,f)];!l&&a&&console.log("Unknown tag: "+b.getShortAt(k,f)),i[l]=h(b,k,c,d,f)}return i}function h(a,b,c,d,e){var f=a.getShortAt(b+2,e),g=a.getLongAt(b+4,e),h=a.getLongAt(b+8,e)+c;switch(f){case 1:case 7:if(g==1)return a.getByteAt(b+8,e);var i=g>4?h:b+8,j=[];for(var k=0;k<g;k++)j[k]=a.getByteAt(i+k);return j;case 2:var l=g>4?h:b+8;return a.getStringAt(l,g-1);case 3:if(g==1)return a.getShortAt(b+8,e);var i=g>2?h:b+8,j=[];for(var k=0;k<g;k++)j[k]=a.getShortAt(i+2*k,e);return j;case 4:if(g==1)return a.getLongAt(b+8,e);var j=[];for(var k=0;k<g;k++)j[k]=a.getLongAt(h+4*k,e);return j;case 5:if(g==1)return a.getLongAt(h,e)/a.getLongAt(h+4,e);var j=[];for(var k=0;k<g;k++)j[k]=a.getLongAt(h+8*k,e)/a.getLongAt(h+4+8*k,e);return j;case 9:if(g==1)return a.getSLongAt(b+8,e);var j=[];for(var k=0;k<g;k++)j[k]=a.getSLongAt(h+4*k,e);return j;case 10:if(g==1)return a.getSLongAt(h,e)/a.getSLongAt(h+4,e);var j=[];for(var k=0;k<g;k++)j[k]=a.getSLongAt(h+8*k,e)/a.getSLongAt(h+4+8*k,e);return j}}function j(b,c,d){if(b.getStringAt(c,4)!="Exif")return a&&console.log("Not valid EXIF data! "+b.getStringAt(c,4)),!1;var e,f=c+6;if(b.getShortAt(f)==18761)e=!1;else if(b.getShortAt(f)==19789)e=!0;else return a&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;if(b.getShortAt(f+2,e)!=42)return a&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var h=b.getLongAt(f+4,e),i=g(b,f,f+h,EXIF.TiffTags,e);if(i.ExifIFDPointer){var j=g(b,f,f+i.ExifIFDPointer,EXIF.Tags,e);for(var k in j){switch(k){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":j[k]=EXIF.StringValues[k][j[k]];break;case"ExifVersion":case"FlashpixVersion":j[k]=String.fromCharCode(j[k][0],j[k][1],j[k][2],j[k][3]);break;case"ComponentsConfiguration":j[k]=EXIF.StringValues.Components[j[k][0]]+EXIF.StringValues.Components[j[k][1]]+EXIF.StringValues.Components[j[k][2]]+EXIF.StringValues.Components[j[k][3]]}i[k]=j[k]}}if(i.GPSInfoIFDPointer){var l=g(b,f,f+i.GPSInfoIFDPointer,EXIF.GPSTags,e);for(var k in l){switch(k){case"GPSVersionID":l[k]=l[k][0]+"."+l[k][1]+"."+l[k][2]+"."+l[k][3]}i[k]=l[k]}}return i}function k(){var a=document.getElementsByTagName("img");for(var c=0;c<a.length;c++)a[c].getAttribute("exif")=="true"&&(a[c].complete?EXIF.getData(a[c]):b(a[c],"load",function(){EXIF.getData(this)}))}var a=!1;EXIF.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},EXIF.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},EXIF.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},EXIF.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},EXIF.getData=function(a,b){return a.complete?(c(a)?b&&b():d(a,b),!0):!1},EXIF.getTag=function(a,b){if(!c(a))return;return a.exifdata[b]},EXIF.getAllTags=function(a){if(!c(a))return{};var b=a.exifdata,d={};for(var e in b)b.hasOwnProperty(e)&&(d[e]=b[e]);return d},EXIF.pretty=function(a){if(!c(a))return"";var b=a.exifdata,d="";for(var e in b)b.hasOwnProperty(e)&&(typeof b[e]=="object"?d+=e+" : ["+b[e].length+" values]\r\n":d+=e+" : "+b[e]+"\r\n");return d},EXIF.readFromBinaryFile=function(a){return e(a)},b(window,"load",k)})(),function(a){var b=!1;a.fn.farbtastic=function(b){return a.farbtastic(this,b),this},a.farbtastic=function(b,c){var b=a(b)[0];return b.farbtastic||(b.farbtastic=new a._farbtastic(b,c))},a._farbtastic=function(c,d){var e=this;e.linkTo=function(b){typeof e.callback=="object"&&a(e.callback).unbind("keyup",e.updateValue),e.color=null;if(typeof b=="function")e.callback=b;else if(typeof b=="object"||typeof b=="string")e.callback=a(b),e.callback.bind("keyup",e.updateValue),e.callback[0].value&&e.setColor(e.callback[0].value);return this},e.updateValue=function(a){this.value&&this.value!=e.color&&e.setColor(this.value)},e.setColor=function(a){var b=e.unpack(a);return e.color!=a&&b&&(e.color=a,e.rgb=b,e.hsl=e.RGBToHSL(e.rgb),e.updateDisplay()),this},e.setHSL=function(a){return e.hsl=a,e.rgb=e.HSLToRGB(a),e.color=e.pack(e.rgb),e.updateDisplay(),this},e.initWidget=function(){var b={width:d.width,height:d.width};a(c).html('<div class="farbtastic" style="position: relative"><div class="farbtastic-solid"></div><canvas class="farbtastic-mask"></canvas><canvas class="farbtastic-overlay"></canvas></div>').find("*").attr(b).css(b).end().find("div>*").css("position","absolute"),a.browser.msie&&a("canvas",c).each(function(){var c={"class":a(this).attr("class"),style:this.getAttribute("style")},d=document.createElement("canvas");a(this).before(a(d).attr(c)).remove(),G_vmlCanvasManager&&G_vmlCanvasManager.initElement(d),a(d).attr(b).css(b).css("position","absolute").find("*").attr(b).css(b)}),e.radius=(d.width-d.wheelWidth)/2-1,e.square=Math.floor((e.radius-d.wheelWidth/2)*.7)-1,e.mid=Math.floor(d.width/2),e.markerSize=d.wheelWidth*.3,e.solidFill=a(".farbtastic-solid",c).css({width:e.square*2-1,height:e.square*2-1,left:e.mid-e.square,top:e.mid-e.square}),e.cnvMask=a(".farbtastic-mask",c),e.ctxMask=e.cnvMask[0].getContext("2d"),e.cnvOverlay=a(".farbtastic-overlay",c),e.ctxOverlay=e.cnvOverlay[0].getContext("2d"),e.ctxMask.translate(e.mid,e.mid),e.ctxOverlay.translate(e.mid,e.mid),e.drawCircle(),e.drawMask()},e.drawCircle=function(){var c=+(new Date),f=24,g=e.radius,h=d.wheelWidth,i=8/g/f*Math.PI,j=e.ctxMask,k=0,l,m;j.save(),j.lineWidth=h/g,j.scale(g,g);for(var n=0;n<=f;++n){var o=n/f,p=o*Math.PI*2,q=Math.sin(k),r=-Math.cos(k);x2=Math.sin(p),y2=-Math.cos(p),am=(k+p)/2,tan=1/Math.cos((p-k)/2),xm=Math.sin(am)*tan,ym=-Math.cos(am)*tan,color2=e.pack(e.HSLToRGB([o,1,.5]));if(n>0)if(a.browser.msie){var s=(1+Math.min(Math.abs(Math.tan(k)),Math.abs(Math.tan(Math.PI/2-k))))/f;l=e.pack(e.HSLToRGB([m-.15*s,1,.5])),color2=e.pack(e.HSLToRGB([o+.15*s,1,.5]));var t=j.createLinearGradient(q,r,x2,y2);t.addColorStop(0,l),t.addColorStop(1,color2),j.fillStyle=t;var u=(g+h/2)/g,v=(g-h/2)/g;j.beginPath(),j.moveTo(q*u,r*u),j.quadraticCurveTo(xm*u,ym*u,x2*u,y2*u),j.lineTo(x2*v,y2*v),j.quadraticCurveTo(xm*v,ym*v,q*v,r*v),j.fill()}else{var t=j.createLinearGradient(q,r,x2,y2);t.addColorStop(0,l),t.addColorStop(1,color2),j.strokeStyle=t,j.beginPath(),j.moveTo(q,r),j.quadraticCurveTo(xm,ym,x2,y2),j.stroke()}k=p-i,l=color2,m=o}j.restore(),b&&a("body").append("<div>drawCircle "+(+(new Date)-c)+"ms")},e.drawMask=function(){function g(a,b,c){var d=1/a,e=1/b;for(var f=0;f<=b;++f){var g=1-f*e;for(var h=0;h<=a;++h){var i=1-h*d,j=1-2*Math.min(g*i,(1-g)*i),k=j>0?(2*g-1+j)*.5/j:0;c(h,f,k,j)}}}var c=+(new Date),d=e.square*2,f=e.square;if(e.ctxMask.getImageData){var h=Math.floor(d/2),i=document.createElement("canvas");i.width=i.height=h+1;var j=i.getContext("2d"),k=j.getImageData(0,0,h+1,h+1),l=0;g(h,h,function(a,b,c,d){k.data[l++]=k.data[l++]=k.data[l++]=c*255,k.data[l++]=d*255}),j.putImageData(k,0,0),e.ctxMask.drawImage(i,0,0,h+1,h+1,-f,-f,f*2,f*2)}else if(!a.browser.msie){var h=Math.floor(d/2);g(h,h,function(a,b,c,d){c=Math.round(c*255),e.ctxMask.fillStyle="rgba("+c+", "+c+", "+c+", "+d+")",e.ctxMask.fillRect(a*2-f-1,b*2-f-1,2,2)})}else{var m,n,o=6,p=Math.floor(d/o);g(p,6,function(b,c,d,g){b==0&&(m=n,n=[]),d=Math.round(d*255),g=Math.round(g*255);if(c>0){var h=m[b][0],i=m[b][1],j=e.packDX(h,i),k=e.packDX(d,g),l=Math.round(e.mid+((c-1)*.333-1)*f),q=Math.round(e.mid+(c*.333-1)*f);a("<div>").css({position:"absolute",filter:"progid:DXImageTransform.Microsoft.Gradient(StartColorStr="+j+", EndColorStr="+k+", GradientType=0)",top:l,height:q-l,left:e.mid+(b*o-f-1),width:o-(b==p?Math.round(o/2):0)}).appendTo(e.cnvMask)}n.push([d,g])})}b&&a("body").append("<div>drawMask "+(+(new Date)-c)+"ms")},e.drawMarkers=function(){var a=d.width,b=Math.ceil(e.markerSize/4),c=e.markerSize-b+1,f=e.hsl[0]*6.28,g=Math.sin(f)*e.radius,h=-Math.cos(f)*e.radius,j=2*e.square*(.5-e.hsl[1]),k=2*e.square*(.5-e.hsl[2]),l=e.invert?"#fff":"#000",m=e.invert?"#000":"#fff",n=[{x:g,y:h,r:c,c:"#000",lw:b+1},{x:g,y:h,r:e.markerSize,c:"#fff",lw:b},{x:j,y:k,r:c,c:m,lw:b+1},{x:j,y:k,r:e.markerSize,c:l,lw:b}];e.ctxOverlay.clearRect(-e.mid,-e.mid,a,a);for(i in n){var o=n[i];e.ctxOverlay.lineWidth=o.lw,e.ctxOverlay.strokeStyle=o.c,e.ctxOverlay.beginPath(),e.ctxOverlay.arc(o.x,o.y,o.r,0,Math.PI*2,!0),e.ctxOverlay.stroke()}},e.updateDisplay=function(){e.invert=e.rgb[0]*.3+e.rgb[1]*.59+e.rgb[2]*.11<=.6,e.solidFill.css("backgroundColor",e.pack(e.HSLToRGB([e.hsl[0],1,.5]))),e.drawMarkers(),typeof e.callback=="object"?(a(e.callback).css({backgroundColor:e.color,color:e.invert?"#fff":"#000"}),a(e.callback).each(function(){typeof this.value=="string"&&this.value!=e.color&&(this.value=e.color)})):typeof e.callback=="function"&&e.callback.call(e,e.color)},e.widgetCoords=function(a){return{x:a.pageX-e.offset.left-e.mid,y:a.pageY-e.offset.top-e.mid}},e.mousedown=function(b){a._farbtastic.dragging||(a(document).bind("mousemove",e.mousemove).bind("mouseup",e.mouseup),a._farbtastic.dragging=!0),e.offset=a(c).offset();var d=e.widgetCoords(b);return e.circleDrag=Math.max(Math.abs(d.x),Math.abs(d.y))>e.square+2,e.mousemove(b),!1},e.mousemove=function(a){var b=e.widgetCoords(a);if(e.circleDrag){var c=Math.atan2(b.x,-b.y)/6.28;e.setHSL([(c+1)%1,e.hsl[1],e.hsl[2]])}else{var d=Math.max(0,Math.min(1,-(b.x/e.square/2)+.5)),f=Math.max(0,Math.min(1,-(b.y/e.square/2)+.5));e.setHSL([e.hsl[0],d,f])}return!1},e.mouseup=function(){a(document).unbind("mousemove",e.mousemove),a(document).unbind("mouseup",e.mouseup),a._farbtastic.dragging=!1},e.dec2hex=function(a){return(a<16?"0":"")+a.toString(16)},e.packDX=function(a,b){return"#"+e.dec2hex(b)+e.dec2hex(a)+e.dec2hex(a)+e.dec2hex(a)},e.pack=function(a){var b=Math.round(a[0]*255),c=Math.round(a[1]*255),d=Math.round(a[2]*255);return"#"+e.dec2hex(b)+e.dec2hex(c)+e.dec2hex(d)},e.unpack=function(a){if(a.length==7){function b(b){return parseInt(a.substring(b,b+2),16)/255}return[b(1),b(3),b(5)]}if(a.length==4){function b(b){return parseInt(a.substring(b,b+1),16)/15}return[b(1),b(2),b(3)]}},e.HSLToRGB=function(a){var b,c,d,e,f,g=a[0],h=a[1],i=a[2];return c=i<=.5?i*(h+1):i+h-i*h,b=i*2-c,[this.hueToRGB(b,c,g+.33333),this.hueToRGB(b,c,g),this.hueToRGB(b,c,g-.33333)]},e.hueToRGB=function(a,b,c){return c=(c+1)%1,c*6<1?a+(b-a)*c*6:c*2<1?b:c*3<2?a+(b-a)*(.66666-c)*6:a},e.RGBToHSL=function(a){var b=a[0],c=a[1],d=a[2],e=Math.min(b,c,d),f=Math.max(b,c,d),g=f-e,h=0,i=0,j=(e+f)/2;return j>0&&j<1&&(i=g/(j<.5?2*j:2-2*j)),g>0&&(f==b&&f!=c&&(h+=(c-d)/g),f==c&&f!=d&&(h+=2+(d-b)/g),f==d&&f!=b&&(h+=4+(b-c)/g),h/=6),[h,i,j]},d.callback||(d={callback:d}),d=a.extend({width:300,wheelWidth:(d.width||300)/10,callback:null},d),e.initWidget(),a("canvas.farbtastic-overlay",c).mousedown(e.mousedown),d.callback&&e.linkTo(d.callback),e.setColor("#808080")}}(jQuery),function(a){function b(b,c){return parseInt(a.css(b[0],c))||0}function c(a){return a[0].offsetWidth+b(a,"marginLeft")+b(a,"marginRight")}function d(a){return a[0].offsetHeight+b(a,"marginTop")+b(a,"marginBottom")}a.fn.jCarouselLite=function(b){return b=a.extend({btnPrev:null,btnNext:null,btnGo:null,mouseWheel:!1,auto:null,speed:200,easing:null,vertical:!1,circular:!0,visible:3,start:0,scroll:1,beforeStart:null,afterEnd:null},b||{}),this.each(function(){function t(){return m.slice(p).slice(0,l)}function u(c){return e||(b.beforeStart&&b.beforeStart.call(this,t()),b.circular?c<=b.start-l-1?(i.css(f,-((n-l*2)*q)+"px"),p=c==b.start-l-1?n-l*2-1:n-l*2-b.scroll):c>=n-l+1?(i.css(f,-(l*q)+"px"),p=c==n-l+1?l+1:l+b.scroll):p=c:c<0?p=0:c+l>n?p=n-l:c>n?p=n:p=c,e=!0,i.animate(f=="left"?{left:-(p*q)}:{top:-(p*q)},b.speed,b.easing,function(){b.afterEnd&&b.afterEnd.call(this,t()),e=!1}),b.circular||(a(b.btnPrev+","+b.btnNext).removeClass("disabled"),a(p<=0&&b.btnPrev).addClass("disabled"),a(p+l>=n&&b.btnNext).addClass("disabled"))),!1}var e=!1,f=b.vertical?"top":"left",g=b.vertical?"height":"width",h=a(this),i=a("ul",h),j=a("li",i),k=j.size(),l=b.visible;b.circular&&(i.prepend(j.slice(k-l-1+1).clone()).append(j.slice(0,l).clone()),b.start+=l);var m=a("li",i),n=m.size(),p=b.start;h.css("visibility","visible"),m.css({overflow:"hidden","float":b.vertical?"none":"left"}),i.css({margin:"0",padding:"0",position:"relative","list-style-type":"none","z-index":"1"}),h.css({overflow:"hidden",position:"relative","z-index":"2",left:"0px"});var q=b.vertical?
d(m):c(m),r=q*n,s=q*l;m.css({width:m.width(),height:m.height()}),i.css(g,r+"px").css(f,-(p*q)),h.css(g,s+"px"),p<=0&&a(b.btnPrev).addClass("disabled"),p+l>=n&&a(b.btnNext).addClass("disabled"),b.btnPrev&&a(b.btnPrev).click(function(){return u(p-b.scroll)}),b.btnNext&&a(b.btnNext).click(function(){return u(p+b.scroll)}),b.btnGo&&a.each(b.btnGo,function(c,d){a(d).click(function(){return u(b.circular?b.visible+c:c)})}),b.mouseWheel&&h.mousewheel&&h.mousewheel(function(a,c){return c>0?u(p-b.scroll):u(p+b.scroll)}),b.auto&&setInterval(function(){u(p+b.scroll)},b.auto+b.speed)})}}(jQuery),function(a){a.Jcrop=function(b,c){function i(a){return parseInt(a,10)+"px"}function j(a){return parseInt(a,10)+"%"}function k(a){return d.baseClass+"-"+a}function l(){return a.fx.step.hasOwnProperty("backgroundColor")}function m(b){var c=a(b).offset();return[c.left,c.top]}function n(a){return[a.pageX-e[0],a.pageY-e[1]]}function o(b){typeof b!="object"&&(b={}),d=a.extend(d,b),typeof d.onChange!="function"&&(d.onChange=function(){}),typeof d.onSelect!="function"&&(d.onSelect=function(){}),typeof d.onRelease!="function"&&(d.onRelease=function(){})}function p(a){a!==f&&(bd.setCursor(a),f=a)}function q(a,b){e=m(G),bd.setCursor(a==="move"?a:a+"-resize");if(a==="move")return bd.activateHandlers(s(b),A);var c=bb.getFixed(),d=t(a),f=bb.getCorner(t(d));bb.setPressed(bb.getCorner(d)),bb.setCurrent(f),bd.activateHandlers(r(a,c),A)}function r(a,b){return function(c){if(!d.aspectRatio)switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}else switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}bb.setCurrent(c),bc.update()}}function s(a){var b=a;return be.watchKeys(),function(a){bb.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,bc.update()}}function t(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function u(a){return function(b){return d.disabled?!1:a==="move"&&!d.allowMove?!1:(Y=!0,q(a,n(b)),b.stopPropagation(),b.preventDefault(),!1)}}function v(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),V=a.width()/d,W=a.height()/e,a.width(d).height(e)}function z(a){return{x:parseInt(a.x*V,10),y:parseInt(a.y*W,10),x2:parseInt(a.x2*V,10),y2:parseInt(a.y2*W,10),w:parseInt(a.w*V,10),h:parseInt(a.h*W,10)}}function A(a){var b=bb.getFixed();b.w>d.minSelect[0]&&b.h>d.minSelect[1]?(bc.enableHandles(),bc.done()):bc.release(),bd.setCursor(d.allowSelect?"crosshair":"default")}function B(a){if(d.disabled)return!1;if(!d.allowSelect)return!1;Y=!0,e=m(G),bc.disableHandles(),p("crosshair");var b=n(a);return bb.setPressed(b),bd.activateHandlers(C,A),be.watchKeys(),a.stopPropagation(),a.preventDefault(),!1}function C(a){bb.setCurrent(a),bc.update()}function D(){var b=a("<div></div>").addClass(k("tracker"));return a.browser.msie&&b.css({opacity:0,backgroundColor:"white"}),b}function bf(a){J.removeClass().addClass(k("holder")).addClass(a)}function bg(a,b){function t(){window.setTimeout(u,l)}var c=parseInt(a[0],10)/V,e=parseInt(a[1],10)/W,f=parseInt(a[2],10)/V,g=parseInt(a[3],10)/W;if(Z)return;var h=bb.flipCoords(c,e,f,g),i=bb.getFixed(),j=[i.x,i.y,i.x2,i.y2],k=j,l=d.animationDelay,m=h[0]-j[0],n=h[1]-j[1],o=h[2]-j[2],p=h[3]-j[3],q=0,r=d.swingSpeed;x=k[0],y=k[1],f=k[2],g=k[3],bc.animMode(!0);var s,u=function(){return function(){q+=(100-q)/r,k[0]=x+q/100*m,k[1]=y+q/100*n,k[2]=f+q/100*o,k[3]=g+q/100*p,q>=99.8&&(q=100),q<100?(bi(k),t()):(bc.done(),typeof b=="function"&&b.call(bs))}}();t()}function bh(a){bi([parseInt(a[0],10)/V,parseInt(a[1],10)/W,parseInt(a[2],10)/V,parseInt(a[3],10)/W])}function bi(a){bb.setPressed([a[0],a[1]]),bb.setCurrent([a[2],a[3]]),bc.update()}function bj(){return z(bb.getFixed())}function bk(){return bb.getFixed()}function bl(a){o(a),br()}function bm(){d.disabled=!0,bc.disableHandles(),bc.setCursor("default"),bd.setCursor("default")}function bn(){d.disabled=!1,br()}function bo(){bc.done(),bd.activateHandlers(null,null)}function bp(){J.remove(),F.show(),a(b).removeData("Jcrop")}function bq(a,b){bc.release(),bm();var c=new Image;c.onload=function(){var e=c.width,f=c.height,g=d.boxWidth,h=d.boxHeight;G.width(e).height(f),G.attr("src",a),K.attr("src",a),v(G,g,h),H=G.width(),I=G.height(),K.width(H).height(I),P.width(H+O*2).height(I+O*2),J.width(H).height(I),bn(),typeof b=="function"&&b.call(bs)},c.src=a}function br(a){d.allowResize?a?bc.enableOnly():bc.enableHandles():bc.disableHandles(),bd.setCursor(d.allowSelect?"crosshair":"default"),bc.setCursor(d.allowMove?"move":"default"),d.hasOwnProperty("setSelect")&&(bh(d.setSelect),bc.done(),delete d.setSelect),d.hasOwnProperty("trueSize")&&(V=d.trueSize[0]/H,W=d.trueSize[1]/I),d.hasOwnProperty("bgColor")&&(l()&&d.fadeTime?J.animate({backgroundColor:d.bgColor},{queue:!1,duration:d.fadeTime}):J.css("backgroundColor",d.bgColor),delete d.bgColor),d.hasOwnProperty("bgOpacity")&&(Q=d.bgOpacity,bc.isAwake()&&(d.fadeTime?G.fadeTo(d.fadeTime,Q):J.css("opacity",d.opacity)),delete d.bgOpacity),R=d.maxSize[0]||0,S=d.maxSize[1]||0,T=d.minSize[0]||0,U=d.minSize[1]||0,d.hasOwnProperty("outerImage")&&(G.attr("src",d.outerImage),delete d.outerImage),bc.refresh()}var d=a.extend({},a.Jcrop.defaults),e,f,g=!1;a.browser.msie&&a.browser.version.split(".")[0]==="6"&&(g=!0),typeof b!="object"&&(b=a(b)[0]),typeof c!="object"&&(c={}),o(c);var E={border:"none",margin:0,padding:0,position:"absolute"},F=a(b),G=F.clone().removeAttr("id").css(E);G.width(F.width()),G.height(F.height()),F.after(G).hide(),v(G,d.boxWidth,d.boxHeight);var H=G.width(),I=G.height(),J=a("<div />").width(H).height(I).addClass(k("holder")).css({position:"relative",backgroundColor:d.bgColor}).insertAfter(F).append(G);delete d.bgColor,d.addClass&&J.addClass(d.addClass);var K=a("<img />").attr("src",G.attr("src")).css(E).width(H).height(I),L=a("<div />").width(j(100)).height(j(100)).css({zIndex:310,position:"absolute",overflow:"hidden"}).append(K),M=a("<div />").width(j(100)).height(j(100)).css("zIndex",320),N=a("<div />").css({position:"absolute",zIndex:300}).insertBefore(G).append(L,M);g&&N.css({overflowY:"hidden"});var O=d.boundary,P=D().width(H+O*2).height(I+O*2).css({position:"absolute",top:i(-O),left:i(-O),zIndex:290}).mousedown(B),Q=d.bgOpacity,R,S,T,U,V,W,X=!0,Y,Z,_;e=m(G);var ba=function(){function a(){var a={},b=["touchstart","touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var e=b[d];e="on"+e;var f=e in c;f||(c.setAttribute(e,"return;"),f=typeof c[e]=="function"),a[b[d]]=f}return a.touchstart&&a.touchend&&a.touchmove}catch(g){return!1}}function b(){return d.touchSupport===!0||d.touchSupport===!1?d.touchSupport:a()}return{createDragger:function(a){return function(b){return b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,d.disabled?!1:a==="move"&&!d.allowMove?!1:(Y=!0,q(a,n(b)),b.stopPropagation(),b.preventDefault(),!1)}},newSelection:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,B(a)},isSupported:a,support:b()}}(),bb=function(){function i(d){d=o(d),c=a=d[0],e=b=d[1]}function j(a){a=o(a),f=a[0]-c,g=a[1]-e,c=a[0],e=a[1]}function k(){return[f,g]}function l(d){var f=d[0],g=d[1];0>a+f&&(f-=f+a),0>b+g&&(g-=g+b),I<e+g&&(g+=I-(e+g)),H<c+f&&(f+=H-(c+f)),a+=f,c+=f,b+=g,e+=g}function m(a){var b=n();switch(a){case"ne":return[b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function n(){if(!d.aspectRatio)return q();var f=d.aspectRatio,g=d.minSize[0]/V,i=d.maxSize[0]/V,j=d.maxSize[1]/W,k=c-a,l=e-b,m=Math.abs(k),n=Math.abs(l),o=m/n,s,t;return i===0&&(i=H*10),j===0&&(j=I*10),o<f?(t=e,w=n*f,s=k<0?a-w:w+a,s<0?(s=0,h=Math.abs((s-a)/f),t=l<0?b-h:h+b):s>H&&(s=H,h=Math.abs((s-a)/f),t=l<0?b-h:h+b)):(s=c,h=m/f,t=l<0?b-h:b+h,t<0?(t=0,w=Math.abs((t-b)*f),s=k<0?a-w:w+a):t>I&&(t=I,w=Math.abs(t-b)*f,s=k<0?a-w:w+a)),s>a?(s-a<g?s=a+g:s-a>i&&(s=a+i),t>b?t=b+(s-a)/f:t=b-(s-a)/f):s<a&&(a-s<g?s=a-g:a-s>i&&(s=a-i),t>b?t=b+(a-s)/f:t=b-(a-s)/f),s<0?(a-=s,s=0):s>H&&(a-=s-H,s=H),t<0?(b-=t,t=0):t>I&&(b-=t-I,t=I),r(p(a,b,s,t))}function o(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>H&&(a[0]=H),a[1]>I&&(a[1]=I),[a[0],a[1]]}function p(a,b,c,d){var e=a,f=c,g=b,h=d;return c<a&&(e=c,f=a),d<b&&(g=d,h=b),[Math.round(e),Math.round(g),Math.round(f),Math.round(h)]}function q(){var d=c-a,f=e-b,g;return R&&Math.abs(d)>R&&(c=d>0?a+R:a-R),S&&Math.abs(f)>S&&(e=f>0?b+S:b-S),U/W&&Math.abs(f)<U/W&&(e=f>0?b+U/W:b-U/W),T/V&&Math.abs(d)<T/V&&(c=d>0?a+T/V:a-T/V),a<0&&(c-=a,a-=a),b<0&&(e-=b,b-=b),c<0&&(a-=c,c-=c),e<0&&(b-=e,e-=e),c>H&&(g=c-H,a-=g,c-=g),e>I&&(g=e-I,b-=g,e-=g),a>H&&(g=a-I,e-=g,b-=g),b>I&&(g=b-I,e-=g,b-=g),r(p(a,b,c,e))}function r(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var a=0,b=0,c=0,e=0,f,g;return{flipCoords:p,setPressed:i,setCurrent:j,getOffset:k,moveOffset:l,getCorner:m,getFixed:n}}(),bc=function(){function l(b){var c=a("<div />").css({position:"absolute",opacity:d.borderOpacity}).addClass(k(b));return L.append(c),c}function m(b,c){var d=a("<div />").mousedown(u(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c});return ba.support&&d.bind("touchstart",ba.createDragger(b)),M.append(d),d}function n(a){return m(a,c++).css({top:i(-h+1),left:i(-h+1),opacity:d.handleOpacity}).addClass(k("handle"))}function o(a){var b=d.handleSize,e=b,f=b,g=h,k=h;switch(a){case"n":case"s":f=j(100);break;case"e":case"w":e=j(100)}return m(a,c++).width(f).height(e).css({top:i(-g+1),left:i(-k+1)})}function p(a){var b;for(b=0;b<a.length;b++)f[a[b]]=n(a[b])}function q(a){var b=Math.round(a.h/2-h),c=Math.round(a.w/2-h),d=-h+1,e=-h+1,g=a.w-h,j=a.h-h,k,l;f.e&&(f.e.css({top:i(b),left:i(g)}),f.w.css({top:i(b)}),f.s.css({top:i(j),left:i(c)}),f.n.css({left:i(c)})),f.ne&&(f.ne.css({left:i(g)}),f.se.css({top:i(j),left:i(g)}),f.sw.css({top:i(j)})),f.b&&(f.b.css({top:i(j)}),f.r.css({left:i(g)}))}function r(a,b){K.css({top:i(-b),left:i(-a)}),N.css({top:i(b),left:i(a)})}function s(a,b){N.width(a).height(b)}function t(){var a=bb.getFixed();bb.setPressed([a.x,a.y]),bb.setCurrent([a.x2,a.y2]),v()}function v(){if(b)return w()}function w(){var a=bb.getFixed();s(a.w,a.h),r(a.x,a.y),g&&q(a),b||x(),d.onChange.call(bs,z(a))}function x(){N.show(),d.bgFade?G.fadeTo(d.fadeTime,Q):G.css("opacity",Q),b=!0}function y(){C(),N.hide(),d.bgFade?G.fadeTo(d.fadeTime,1):G.css("opacity",1),b=!1,d.onRelease.call(bs)}function A(){g&&(q(bb.getFixed()),M.show())}function B(){g=!0;if(d.allowResize)return q(bb.getFixed()),M.show(),!0}function C(){g=!1,M.hide()}function E(a){Z===a?C():B()}function F(){E(!1),t()}var b,c=370,e={},f={},g=!1,h=d.handleOffset;d.drawBorders&&(e={top:l("hline"),bottom:l("hline bottom"),left:l("vline"),right:l("vline right")}),d.dragEdges&&(f.t=o("n"),f.b=o("s"),f.r=o("e"),f.l=o("w")),d.sideHandles&&p(["n","s","e","w"]),d.cornerHandles&&p(["sw","nw","ne","se"]);var H=D().mousedown(u("move")).css({cursor:"move",position:"absolute",zIndex:360});return ba.support&&H.bind("touchstart.jcrop",ba.createDragger("move")),L.append(H),C(),{updateVisible:v,update:w,release:y,refresh:t,isAwake:function(){return b},setCursor:function(a){H.css("cursor",a)},enableHandles:B,enableOnly:function(){g=!0},showHandles:A,disableHandles:C,animMode:E,done:F}}(),bd=function(){function f(){P.css({zIndex:450}),e&&a(document).bind("mousemove",h).bind("mouseup",i)}function g(){P.css({zIndex:290}),e&&a(document).unbind("mousemove",h).unbind("mouseup",i)}function h(a){return b(n(a)),!1}function i(a){return a.preventDefault(),a.stopPropagation(),Y&&(Y=!1,c(n(a)),bc.isAwake()&&d.onSelect.call(bs,z(bb.getFixed())),g(),b=function(){},c=function(){}),!1}function j(a,d){return Y=!0,b=a,c=d,f(),!1}function k(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,h(a)}function l(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,i(a)}function m(a){P.css("cursor",a)}var b=function(){},c=function(){},e=d.trackDocument;return ba.support&&a(document).bind("touchmove",k).bind("touchend",l),e||P.mousemove(h).mouseup(i).mouseout(i),G.before(P),{activateHandlers:j,setCursor:m}}(),be=function(){function e(){d.keySupport&&(b.show(),b.focus())}function f(a){b.hide()}function h(a,b,c){d.allowMove&&(bb.moveOffset([b,c]),bc.updateVisible()),a.preventDefault(),a.stopPropagation()}function i(a){if(a.ctrlKey)return!0;_=a.shiftKey?!0:!1;var b=_?10:1;switch(a.keyCode){case 37:h(a,-b,0);break;case 39:h(a,b,0);break;case 38:h(a,0,-b);break;case 40:h(a,0,b);break;case 27:bc.release();break;case 9:return!0}return!1}var b=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),c=a("<div />").css({position:"absolute",overflow:"hidden"}).append(b);return d.keySupport&&(b.keydown(i).blur(f),g||!d.fixedSupport?(b.css({position:"absolute",left:"-20px"}),c.append(b).insertBefore(G)):b.insertBefore(G)),{watchKeys:e}}();ba.support&&P.bind("touchstart",ba.newSelection),M.hide(),br(!0);var bs={setImage:bq,animateTo:bg,setSelect:bh,setOptions:bl,tellSelect:bj,tellScaled:bk,setClass:bf,disable:bm,enable:bn,cancel:bo,release:bc.release,destroy:bp,focus:be.watchKeys,getBounds:function(){return[H*V,I*W]},getWidgetSize:function(){return[H,I]},getScaleFactor:function(){return[V,W]},ui:{holder:J,selection:N}};return a.browser.msie&&J.bind("selectstart",function(){return!1}),F.data("Jcrop",bs),bs},a.fn.Jcrop=function(b,c){function d(d){var e=typeof b=="object"?b:{},f=e.useImg||d.src,g=new Image;g.onload=function(){function b(){var b=a.Jcrop(d,e);typeof c=="function"&&c.call(b)}function f(){!g.width||!g.height?window.setTimeout(f,50):b()}window.setTimeout(f,50)},g.src=f}return this.each(function(){if(a(this).data("Jcrop")){if(b==="api")return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else d(this)}),this},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:9,handleOffset:5,aspectRatio:0,keySupport:!0,cornerHandles:!0,sideHandles:!0,drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onRelease:function(){}}}(jQuery),function(a){a.address=function(){var b=function(b){a(a.address).trigger(a.extend(a.Event(b),function(){for(var b={},d=a.address.parameterNames(),e=0,f=d.length;e<f;e++)b[d[e]]=a.address.parameter(d[e]);return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:d,parameters:b,queryString:a.address.queryString()}}.call(a.address)))},d=function(){return a().bind.apply(a(a.address),Array.prototype.slice.call(arguments)),a.address},e=function(){return Q.pushState&&G.state!==y},f=function(){return("/"+R.pathname.replace(new RegExp(G.state),"")+R.search+(g()?"#"+g():"")).replace(U,"/")},g=function(){var a=R.href.indexOf("#");return a!=-1?l(R.href.substr(a+1),F):""},h=function(){return e()?f():g()},j=function(){return"javascript"},k=function(a){return a=a.toString(),(G.strict&&a.substr(0,1)!="/"?"/":"")+a},l=function(a,b){return G.crawlable&&b?(a!==""?"!":"")+a:a.replace(/^\!/,"")},m=function(a,b){return parseInt(a.css(b),10)},n=function(a){for(var b,c,d=0,e=a.childNodes.length;d<e;d++){try{"src"in a.childNodes[d]&&a.childNodes[d].src&&(b=String(a.childNodes[d].src))}catch(f){}if(c=n(a.childNodes[d]))b=c}return b},o=function(){if(!Z){var a=h();bc!=a&&(K&&I<7?R.reload():(K&&I<8&&G.history&&T(r,50),bc=a,p(F)))}},p=function(a){b(B),b(a?C:D),T(q,10)},q=function(){if(G.tracker!=="null"&&G.tracker!==null){var b=a.isFunction(G.tracker)?G.tracker:O[G.tracker],d=(R.pathname+R.search+(a.address&&!e()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");a.isFunction(b)?b(d):a.isFunction(O.urchinTracker)?O.urchinTracker(d):O.pageTracker!==y&&a.isFunction(O.pageTracker._trackPageview)?O.pageTracker._trackPageview(d):O._gaq!==y&&a.isFunction(O._gaq.push)&&O._gaq.push(["_trackPageview",decodeURI(d)])}},r=function(){var a=j()+":"+F+";document.open();document.writeln('<html><head><title>"+P.title.replace("'","\\'")+"</title><script>var "+z+' = "'+encodeURIComponent(h())+(P.domain!=R.hostname?'";document.domain="'+P.domain:"")+"\";</script></head></html>');document.close();";I<7?V.src=a:V.contentWindow.location.replace(a)},s=function(){if(W&&X!=-1){var a,b=W.substr(X+1).split("&");for(i=0;i<b.length;i++)a=b[i].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(a[0])&&(G[a[0]]=isNaN(a[1])?/^(true|yes)$/i.test(a[1]):parseInt(a[1],10)!==0),/^(state|tracker)$/.test(a[0])&&(G[a[0]]=a[1]);W=null}bc=h()},t=function(){if(!$){$=E,s();var d=function(){u.call(this),x.call(this)},f=a("body").ajaxComplete(d);d(),G.wrap&&(a("body > *").wrapAll('<div style="padding:'+(m(f,"marginTop")+m(f,"paddingTop"))+"px "+(m(f,"marginRight")+m(f,"paddingRight"))+"px "+(m(f,"marginBottom")+m(f,"paddingBottom"))+"px "+(m(f,"marginLeft")+m(f,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+z+'" style="height:100%;overflow:auto;position:relative;'+(M&&!window.statusbar.visible?"resize:both;":"")+'" />'),a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),M&&a('<style type="text/css" />').appendTo("head").text("#"+z+"::-webkit-resizer { background-color: #fff; }")),K&&I<8&&(d=P.getElementsByTagName("frameset")[0],V=P.createElement((d?"":"i")+"frame"),d?(d.insertAdjacentElement("beforeEnd",V),d[d.cols?"cols":"rows"]+=",0",V.noResize=E,V.frameBorder=V.frameSpacing=0):(V.style.display="none",V.style.width=V.style.height=0,V.tabIndex=-1,P.body.insertAdjacentElement("afterBegin",V)),T(function(){a(V).bind("load",function(){var a=V.contentWindow;bc=a[z]!==y?a[z]:"",bc!=h()&&(p(F),R.hash=l(bc,E))}),V.contentWindow[z]===y&&r()},50)),T(function(){b("init"),p(F)},1),e()||(K&&I>7||!K&&"on"+A in O?O.addEventListener?O.addEventListener(A,o,F):O.attachEvent&&O.attachEvent("on"+A,o):S(o,50))}},u=function(){var b,d=a("a"),e=d.size(),f=-1,g=function(){++f!=e&&(b=a(d.get(f)),b.is('[rel*="address:"]')&&b.address(),T(g,1))};T(g,1)},v=function(){bc!=h()&&(bc=h(),p(F))},w=function(){O.removeEventListener?O.removeEventListener(A,o,F):O.detachEvent&&O.detachEvent("on"+A,o)},x=function(){if(G.crawlable){var b=R.pathname.replace(/\/$/,"");a("body").html().indexOf("_escaped_fragment_")!=-1&&a('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var d=a(this).attr("href").replace(/^http:/,"").replace(new RegExp(b+"/?$"),"");(d===""||d.indexOf("_escaped_fragment_")!=-1)&&a(this).attr("href","#"+d.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2"))})}},y,z="jQueryAddress",A="hashchange",B="change",C="internalChange",D="externalChange",E=!0,F=!1,G={autoUpdate:E,crawlable:F,history:E,strict:E,wrap:F},H=a.browser,I=parseFloat(a.browser.version),J=H.mozilla,K=H.msie,L=H.opera,M=H.webkit||H.safari,N=F,O=function(){try{return top.document!==y?top:window}catch(a){return window}}(),P=O.document,Q=O.history,R=O.location,S=setInterval,T=setTimeout,U=/\/{2,9}/g;H=navigator.userAgent;var V,W=n(document),X=W?W.indexOf("?"):-1,Y=P.title,Z=F,$=F,_=E,ba=E,bb=F,bc=h();if(K){I=parseFloat(H.substr(H.indexOf("MSIE")+4)),P.documentMode&&P.documentMode!=I&&(I=P.documentMode!=8?7:8);var bd=P.onpropertychange;P.onpropertychange=function(){bd&&bd.call(P),P.title!=Y&&P.title.indexOf("#"+h())!=-1&&(P.title=Y)}}if(N=J&&I>=1||K&&I>=6||L&&I>=9.5||M&&I>=523){L&&(history.navigationMode="compatible");if(document.readyState=="complete")var be=setInterval(function(){a.address&&(t(),clearInterval(be))},50);else s(),a(t);a(window).bind("popstate",v).bind("unload",w)}else!N&&g()!==""?R.replace(R.href.substr(0,R.href.indexOf("#"))):q();return{bind:function(a,b,c){return d(a,b,c)},init:function(a){return d("init",a)},change:function(a){return d(B,a)},internalChange:function(a){return d(C,a)},externalChange:function(a){return d(D,a)},baseURL:function(){var a=R.href;return a.indexOf("#")!=-1&&(a=a.substr(0,a.indexOf("#"))),/\/$/.test(a)&&(a=a.substr(0,a.length-1)),a},autoUpdate:function(a){return a!==y?(G.autoUpdate=a,this):G.autoUpdate},crawlable:function(a){return a!==y?(G.crawlable=a,this):G.crawlable},history:function(a){return a!==y?(G.history=a,this):G.history},state:function(a){if(a!==y){G.state=a;var b=f();return G.state!==y&&(Q.pushState?b.substr(0,3)=="/#/"&&R.replace(G.state.replace(/^\/$/,"")+b.substr(2)):b!="/"&&b.replace(/^\/#/,"")!=g()&&T(function(){R.replace(G.state.replace(/^\/$/,"")+"/#"+b)},1)),this}return G.state},strict:function(a){return a!==y?(G.strict=a,this):G.strict},tracker:function(a){return a!==y?(G.tracker=a,this):G.tracker},wrap:function(a){return a!==y?(G.wrap=a,this):G.wrap},update:function(){return bb=E,this.value(bc),bb=F,this},title:function(a){return a!==y?(T(function(){Y=P.title=a,ba&&V&&V.contentWindow&&V.contentWindow.document&&(V.contentWindow.document.title=a,ba=F),!_&&J&&R.replace(R.href.indexOf("#")!=-1?R.href:R.href+"#"),_=F},50),this):P.title},value:function(a){if(a!==y){a=k(a),a=="/"&&(a="");if(bc==a&&!bb)return;_=E,bc=a;if(G.autoUpdate||bb)p(E),e()?Q[G.history?"pushState":"replaceState"]({},"",G.state.replace(/\/$/,"")+(bc===""?"/":bc)):(Z=E,M?G.history?R.hash="#"+l(bc,E):R.replace("#"+l(bc,E)):bc!=h()&&(G.history?R.hash="#"+l(bc,E):R.replace("#"+l(bc,E))),K&&I<8&&G.history&&T(r,50),M?T(function(){Z=F},1):Z=F);return this}return N?k(bc):null},path:function(a){if(a!==y){var b=this.queryString(),c=this.hash();return this.value(a+(b?"?"+b:"")+(c?"#"+c:"")),this}return k(bc).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(U,"/").split("/");return(a.substr(0,1)=="/"||a.length===0)&&b.splice(0,1),a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1),b},queryString:function(a){if(a!==y){var b=this.hash();return this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:"")),this}return a=bc.split("?"),a.slice(1,a.length).join("?").split("#")[0]},parameter:function(b,d,e){var f,g;if(d!==y){var h=this.parameterNames();g=[],d=d?d.toString():"";for(f=0;f<h.length;f++){var i=h[f],j=this.parameter(i);typeof j=="string"&&(j=[j]),i==b&&(j=d===null||d===""?[]:e?j.concat([d]):[d]);for(var k=0;k<j.length;k++)g.push(i+"="+j[k])}return a.inArray(b,h)==-1&&d!==null&&d!==""&&g.push(b+"="+d),this.queryString(g.join("&")),this}if(d=this.queryString()){e=[],g=d.split("&");for(f=0;f<g.length;f++)d=g[f].split("="),d[0]==b&&e.push(d.slice(1).join("="));if(e.length!==0)return e.length!=1?e:e[0]}},parameterNames:function(){var b=this.queryString(),d=[];if(b&&b.indexOf("=")!=-1){b=b.split("&");for(var e=0;e<b.length;e++){var f=b[e].split("=")[0];a.inArray(f,d)==-1&&d.push(f)}}return d},hash:function(a){return a!==y?(this.value(bc.split("#")[0]+(a?"#"+a:"")),this):(a=bc.split("#"),a.slice(1,a.length).join("#"))}}}(),a.fn.address=function(b){if(!a(this).attr("address")){var d=function(d){if(d.shiftKey||d.ctrlKey||d.metaKey)return!0;if(a(this).is("a")){var e=b?b.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:a.address.state()!==undefined&&a.address.state()!="/"?a(this).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""):a(this).attr("href").replace(/^(#\!?|\.)/,"");a.address.value(e),d.preventDefault()}};a(this).click(d).live("click",d).live("submit",function(d){if(a(this).is("form")){var e=a(this).attr("action");e=b?b.call(this):(e.indexOf("?")!=-1?e.replace(/&$/,""):e+"?")+a(this).serialize(),a.address.value(e),d.preventDefault()}}).attr("address",!0)}return this}}(jQuery),function(a){function b(a){window.console&&window.console.log&&window.console.log("bigTarget selection count: "+a.size())}function c(){if(window.getSelection)return window.getSelection().toString();if(document.getSelection)return document.getSelection();if(document.selection)return document.selection.createRange().text}a.fn.bigTarget=function(d){b(this);var e=a.extend({},a.fn.bigTarget.defaults,d);return this.each(function(){var b=a(this),d=b.attr("href"),f=b.attr("title"),g=a.meta?a.extend({},e,b.data()):e;b.parents(g.clickZone).hover(function(){$h=a(this),$h.addClass(g.hoverClass),typeof g.title!="undefined"&&g.title===!0&&f!=""&&$h.attr("title",f)},function(){$h.removeClass(g.hoverClass),typeof g.title!="undefined"&&g.title===!0&&f!=""&&$h.removeAttr("title")}).click(function(){if(c()==""){if(b.is("[rel*=external]"))return window.open(d),!1;window.location=d}})})},a.fn.bigTarget.defaults={hoverClass:"hover",clickZone:"li:eq(0)",title:!0}}(jQuery),function(a){var b=function(a){if(!a)var a=window.event;a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()};a.fn.checkbox=function(c){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(d){}var e={cls:"jquery-checkbox",empty:"/unity/img/scripts/jquery-checkbox/empty.png"};e=a.extend(e,c||{});var f=function(b){var c=b.checked,d=b.disabled,e=a(b);return b.stateInterval&&clearInterval(b.stateInterval),b.stateInterval=setInterval(function(){b.disabled!=d&&e.trigger((d=!!b.disabled)?"disable":"enable"),b.checked!=c&&e.trigger((c=!!b.checked)?"check":"uncheck")},10),e};return this.each(function(){var c=this,d=f(c);c.wrapper&&c.wrapper.remove(),c.wrapper=a('<span class="'+e.cls+'"><span class="mark"><img src="'+e.empty+'" /></span></span>'),c.wrapperInner=c.wrapper.children("span:eq(0)"),c.wrapper.hover(function(a){c.wrapperInner.addClass(e.cls+"-hover"),b(a)},function(a){c.wrapperInner.removeClass(e.cls+"-hover"),b(a)}),d.css({position:"absolute",zIndex:-1,visibility:"hidden"}).after(c.wrapper);var g=!1;d.attr("id")&&(g=a("label[for="+d.attr("id")+"]"),g.length||(g=!1)),g||(g=d.closest?d.closest("label"):d.parents("label:eq(0)"),g.length||(g=!1)),g&&(g.hover(function(a){c.wrapper.trigger("mouseover",[a])},function(a){c.wrapper.trigger("mouseout",[a])}),g.click(function(a){return d.trigger("click",[a]),b(a),!1})),c.wrapper.click(function(a){return d.trigger("click",[a]),b(a),!1}),d.click(function(a){b(a)}),d.bind("disable",function(){c.wrapperInner.addClass(e.cls+"-disabled")}).bind("enable",function(){c.wrapperInner.removeClass(e.cls+"-disabled")}),d.bind("check",function(){c.wrapper.addClass(e.cls+"-checked")}).bind("uncheck",function(){c.wrapper.removeClass(e.cls+"-checked")}),a("img",c.wrapper).bind("dragstart",function(){return!1}).bind("mousedown",function(){return!1}),window.getSelection&&c.wrapper.css("MozUserSelect","none"),c.checked&&c.wrapper.addClass(e.cls+"-checked"),c.disabled&&c.wrapperInner.addClass(e.cls+"-disabled")})}}(jQuery),jQuery.cookie=function(a,b,c){if(typeof b=="undefined"){var i=null;if(document.cookie&&document.cookie!=""){var j=document.cookie.split(";");for(var k=0;k<j.length;k++){var l=jQuery.trim(j[k]);if(l.substring(0,a.length+1)==a+"="){i=decodeURIComponent(l.substring(a.length+1));break}}}return i}c=c||{},b===null&&(b="",c.expires=-1);var d="";if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){var e;typeof c.expires=="number"?(e=new Date,e.setTime(e.getTime()+c.expires*24*60*60*1e3)):e=c.expires,d="; expires="+e.toUTCString()}var f=c.path?"; path="+c.path:"",g=c.domain?"; domain="+c.domain:"",h=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),d,f,g,h].join("")};var jaaulde=window.jaaulde||{};jaaulde.utils=jaaulde.utils||{},jaaulde.utils.cookies=function(){var a,b,c,d,e={expiresAt:null,path:"/",domain:null,secure:!1};return a=function(a){var b,c;return typeof a!="object"||a===null?b=e:(b={expiresAt:e.expiresAt,path:e.path,domain:e.domain,secure:e.secure},typeof a.expiresAt=="object"&&a.expiresAt instanceof Date?b.expiresAt=a.expiresAt:typeof a.hoursToLive=="number"&&a.hoursToLive!==0&&(c=new Date,c.setTime(c.getTime()+a.hoursToLive*60*60*1e3),b.expiresAt=c),typeof a.path=="string"&&a.path!==""&&(b.path=a.path),typeof a.domain=="string"&&a.domain!==""&&(b.domain=a.domain),a.secure===!0&&(b.secure=a.secure)),b},b=function(b){return b=a(b),(typeof b.expiresAt=="object"&&b.expiresAt instanceof Date?"; expires="+b.expiresAt.toGMTString():"")+"; path="+b.path+(typeof b.domain=="string"?"; domain="+b.domain:"")+(b.secure===!0?"; secure":"")},c=function(){var a={},b,c,d,e,f=document.cookie.split(";"),g;for(b=0;b<f.length;b+=1){c=f[b].split("="),d=c[0].replace(/^\s*/,"").replace(/\s*$/,"");try{e=decodeURIComponent(c[1])}catch(h){e=c[1]}if(typeof JSON=="object"&&JSON!==null&&typeof JSON.parse=="function")try{g=e,e=JSON.parse(e)}catch(i){e=g}a[d]=e}return a},d=function(){},d.prototype.get=function(a){var b,d,e=c();if(typeof a=="string")b=typeof e[a]!="undefined"?e[a]:null;else if(typeof a=="object"&&a!==null){b={};for(d in a)typeof e[a[d]]!="undefined"?b[a[d]]=e[a[d]]:b[a[d]]=null}else b=e;return b},d.prototype.filter=function(a){var b,d={},e=c();typeof a=="string"&&(a=new RegExp(a));for(b in e)b.match(a)&&(d[b]=e[b]);return d},d.prototype.set=function(a,c,d){if(typeof d!="object"||d===null)d={};if(typeof c=="undefined"||c===null)c="",d.hoursToLive=-8760;else if(typeof c!="string")if(typeof JSON=="object"&&JSON!==null&&typeof JSON.stringify=="function")c=JSON.stringify(c);else throw new Error("cookies.set() received non-string value and could not serialize.");var e=b(d);document.cookie=a+"="+encodeURIComponent(c)+e},d.prototype.del=function(a,b){var c={},d;if(typeof b!="object"||b===null)b={};typeof a=="boolean"&&a===!0?c=this.get():typeof a=="string"&&(c[a]=!0);for(d in c)typeof d=="string"&&d!==""&&this.set(d,null,b)},d.prototype.test=function(){var a=!1,b="cT",c="data";return this.set(b,c),this.get(b)===c&&(this.del(b),a=!0),a},d.prototype.setOptions=function(b){typeof b!="object"&&(b=null),e=a(b)},new d}(),function(){window.jQuery&&function(a){a.cookies=jaaulde.utils.cookies;var b={cookify:function(b){return this.each(function(){var c,d=["name","id"],e,f=a(this),g;for(c in d)if(!isNaN(c)){e=f.attr(d[c]);if(typeof e=="string"&&e!==""){f.is(":checkbox, :radio")?f.attr("checked")&&(g=f.val()):f.is(":input")?g=f.val():g=f.html();if(typeof g!="string"||g==="")g=null;a.cookies.set(e,g,b);break}}})},cookieFill:function(){return this.each(function(){var b,c,d=["name","id"],e,f=a(this),g;c=function(){return b=d.pop(),!!b};while(c()){e=f.attr(b);if(typeof e=="string"&&e!==""){g=a.cookies.get(e),g!==null&&(f.is(":checkbox, :radio")?f.val()===g?f.attr("checked","checked"):f.removeAttr("checked"):f.is(":input")?f.val(g):f.html(g));break}}})},cookieBind:function(b){return this.each(function(){var c=a(this);c.cookieFill().change(function(){c.cookify(b)})})}};a.each(b,function(b){a.fn[b]=this})}(window.jQuery)}(),function(a,b){function d(b){a.fn.cycle.debug&&e(b)}function e(){window.console&&console.log&&console.log("[cycle] "+Array.prototype.join.call(arguments," "))}function f(b,c,d){var e=a(b).data("cycle.opts"),f=!!b.cyclePause;f&&e.paused?e.paused(b,e,c,d):!f&&e.resumed&&e.resumed(b,e,c,d)}function g(c,d,g){function k(b,c,d){if(!b&&c===!0){var f=a(d).data("cycle.opts");if(!f)return e("options not found, can not resume"),!1;d.cycleTimeout&&(clearTimeout(d.cycleTimeout),d.cycleTimeout=0),n(f.elements,f,1,!f.backwards)}}c.cycleStop===b&&(c.cycleStop=0);if(d===b||d===null)d={};if(d.constructor==String){switch(d){case"destroy":case"stop":var h=a(c).data("cycle.opts");if(!h)return!1;return c.cycleStop++,c.cycleTimeout&&clearTimeout(c.cycleTimeout),c.cycleTimeout=0,h.elements&&a(h.elements).stop(),a(c).removeData("cycle.opts"),d=="destroy"&&i(c,h),!1;case"toggle":return c.cyclePause=c.cyclePause===1?0:1,k(c.cyclePause,g,c),f(c),!1;case"pause":return c.cyclePause=1,f(c),!1;case"resume":return c.cyclePause=0,k(!1,g,c),f(c),!1;case"prev":case"next":h=a(c).data("cycle.opts");if(!h)return e('options not found, "prev/next" ignored'),!1;return a.fn.cycle[d](h),!1;default:d={fx:d}}return d}if(d.constructor==Number){var j=d;return d=a(c).data("cycle.opts"),d?j<0||j>=d.elements.length?(e("invalid slide index: "+j),!1):(d.nextSlide=j,c.cycleTimeout&&(clearTimeout(c.cycleTimeout),c.cycleTimeout=0),typeof g=="string"&&(d.oneTimeFx=g),n(d.elements,d,1,j>=d.currSlide),!1):(e("options not found, can not advance slide"),!1)}return d}function h(b,c){if(!a.support.opacity&&c.cleartype&&b.style.filter)try{b.style.removeAttribute("filter")}catch(d){}}function i(b,c){c.next&&a(c.next).unbind(c.prevNextEvent),c.prev&&a(c.prev).unbind(c.prevNextEvent),(c.pager||c.pagerAnchorBuilder)&&a.each(c.pagerAnchors||[],function(){this.unbind().remove()}),c.pagerAnchors=null,a(b).unbind("mouseenter.cycle mouseleave.cycle"),c.destroy&&c.destroy(c)}function j(c,d,g,i,j){var o,s=a.extend({},a.fn.cycle.defaults,i||{},a.metadata?c.metadata():a.meta?c.data():{}),t=a.isFunction(c.data)?c
.data(s.metaAttr):null;t&&(s=a.extend(s,t)),s.autostop&&(s.countdown=s.autostopCount||g.length);var u=c[0];c.data("cycle.opts",s),s.$cont=c,s.stopCount=u.cycleStop,s.elements=g,s.before=s.before?[s.before]:[],s.after=s.after?[s.after]:[],!a.support.opacity&&s.cleartype&&s.after.push(function(){h(this,s)}),s.continuous&&s.after.push(function(){n(g,s,0,!s.backwards)}),k(s),!a.support.opacity&&s.cleartype&&!s.cleartypeNoBg&&r(d),c.css("position")=="static"&&c.css("position","relative"),s.width&&c.width(s.width),s.height&&s.height!="auto"&&c.height(s.height),s.startingSlide!==b?(s.startingSlide=parseInt(s.startingSlide,10),s.startingSlide>=g.length||s.startSlide<0?s.startingSlide=0:o=!0):s.backwards?s.startingSlide=g.length-1:s.startingSlide=0;if(s.random){s.randomMap=[];for(var v=0;v<g.length;v++)s.randomMap.push(v);s.randomMap.sort(function(a,b){return Math.random()-.5});if(o)for(var w=0;w<g.length;w++)s.startingSlide==s.randomMap[w]&&(s.randomIndex=w);else s.randomIndex=1,s.startingSlide=s.randomMap[1]}else s.startingSlide>=g.length&&(s.startingSlide=0);s.currSlide=s.startingSlide||0;var x=s.startingSlide;d.css({position:"absolute",top:0,left:0}).hide().each(function(b){var c;s.backwards?c=x?b<=x?g.length+(b-x):x-b:g.length-b:c=x?b>=x?g.length-(b-x):x-b:g.length-b,a(this).css("z-index",c)}),a(g[x]).css("opacity",1).show(),h(g[x],s),s.fit&&(s.aspect?d.each(function(){var b=a(this),c=s.aspect===!0?b.width()/b.height():s.aspect;s.width&&b.width()!=s.width&&(b.width(s.width),b.height(s.width/c)),s.height&&b.height()<s.height&&(b.height(s.height),b.width(s.height*c))}):(s.width&&d.width(s.width),s.height&&s.height!="auto"&&d.height(s.height))),s.center&&(!s.fit||s.aspect)&&d.each(function(){var b=a(this);b.css({"margin-left":s.width?(s.width-b.width())/2+"px":0,"margin-top":s.height?(s.height-b.height())/2+"px":0})}),s.center&&!s.fit&&!s.slideResize&&d.each(function(){var b=a(this);b.css({"margin-left":s.width?(s.width-b.width())/2+"px":0,"margin-top":s.height?(s.height-b.height())/2+"px":0})});var y=s.containerResize&&!c.innerHeight();if(y){var z=0,A=0;for(var B=0;B<g.length;B++){var C=a(g[B]),D=C[0],E=C.outerWidth(),F=C.outerHeight();E||(E=D.offsetWidth||D.width||C.attr("width")),F||(F=D.offsetHeight||D.height||C.attr("height")),z=E>z?E:z,A=F>A?F:A}z>0&&A>0&&c.css({width:z+"px",height:A+"px"})}var G=!1;s.pause&&c.bind("mouseenter.cycle",function(){G=!0,this.cyclePause++,f(u,!0)}).bind("mouseleave.cycle",function(){G&&this.cyclePause--,f(u,!0)});if(l(s)===!1)return!1;var H=!1;i.requeueAttempts=i.requeueAttempts||0,d.each(function(){var b=a(this);this.cycleH=s.fit&&s.height?s.height:b.height()||this.offsetHeight||this.height||b.attr("height")||0,this.cycleW=s.fit&&s.width?s.width:b.width()||this.offsetWidth||this.width||b.attr("width")||0;if(b.is("img")){var c=a.browser.msie&&this.cycleW==28&&this.cycleH==30&&!this.complete,d=a.browser.mozilla&&this.cycleW==34&&this.cycleH==19&&!this.complete,f=a.browser.opera&&(this.cycleW==42&&this.cycleH==19||this.cycleW==37&&this.cycleH==17)&&!this.complete,g=this.cycleH===0&&this.cycleW===0&&!this.complete;if(c||d||f||g){if(j.s&&s.requeueOnImageNotLoaded&&++i.requeueAttempts<100)return e(i.requeueAttempts," - img slide not loaded, requeuing slideshow: ",this.src,this.cycleW,this.cycleH),setTimeout(function(){a(j.s,j.c).cycle(i)},s.requeueTimeout),H=!0,!1;e("could not determine size of image: "+this.src,this.cycleW,this.cycleH)}}return!0});if(H)return!1;s.cssBefore=s.cssBefore||{},s.cssAfter=s.cssAfter||{},s.cssFirst=s.cssFirst||{},s.animIn=s.animIn||{},s.animOut=s.animOut||{},d.not(":eq("+x+")").css(s.cssBefore),a(d[x]).css(s.cssFirst);if(s.timeout){s.timeout=parseInt(s.timeout,10),s.speed.constructor==String&&(s.speed=a.fx.speeds[s.speed]||parseInt(s.speed,10)),s.sync||(s.speed=s.speed/2);var I=s.fx=="none"?0:s.fx=="shuffle"?500:250;while(s.timeout-s.speed<I)s.timeout+=s.speed}s.easing&&(s.easeIn=s.easeOut=s.easing),s.speedIn||(s.speedIn=s.speed),s.speedOut||(s.speedOut=s.speed),s.slideCount=g.length,s.currSlide=s.lastSlide=x,s.random?(++s.randomIndex==g.length&&(s.randomIndex=0),s.nextSlide=s.randomMap[s.randomIndex]):s.backwards?s.nextSlide=s.startingSlide===0?g.length-1:s.startingSlide-1:s.nextSlide=s.startingSlide>=g.length-1?0:s.startingSlide+1;if(!s.multiFx){var J=a.fn.cycle.transitions[s.fx];if(a.isFunction(J))J(c,d,s);else if(s.fx!="custom"&&!s.multiFx)return e("unknown transition: "+s.fx,"; slideshow terminating"),!1}var K=d[x];return s.skipInitializationCallbacks||(s.before.length&&s.before[0].apply(K,[K,K,s,!0]),s.after.length&&s.after[0].apply(K,[K,K,s,!0])),s.next&&a(s.next).bind(s.prevNextEvent,function(){return p(s,1)}),s.prev&&a(s.prev).bind(s.prevNextEvent,function(){return p(s,0)}),(s.pager||s.pagerAnchorBuilder)&&q(g,s),m(s,g),s}function k(b){b.original={before:[],after:[]},b.original.cssBefore=a.extend({},b.cssBefore),b.original.cssAfter=a.extend({},b.cssAfter),b.original.animIn=a.extend({},b.animIn),b.original.animOut=a.extend({},b.animOut),a.each(b.before,function(){b.original.before.push(this)}),a.each(b.after,function(){b.original.after.push(this)})}function l(b){var c,f,g=a.fn.cycle.transitions;if(b.fx.indexOf(",")>0){b.multiFx=!0,b.fxs=b.fx.replace(/\s*/g,"").split(",");for(c=0;c<b.fxs.length;c++){var h=b.fxs[c];f=g[h];if(!f||!g.hasOwnProperty(h)||!a.isFunction(f))e("discarding unknown transition: ",h),b.fxs.splice(c,1),c--}if(!b.fxs.length)return e("No valid transitions named; slideshow terminating."),!1}else if(b.fx=="all"){b.multiFx=!0,b.fxs=[];for(var i in g)g.hasOwnProperty(i)&&(f=g[i],g.hasOwnProperty(i)&&a.isFunction(f)&&b.fxs.push(i))}if(b.multiFx&&b.randomizeEffects){var j=Math.floor(Math.random()*20)+30;for(c=0;c<j;c++){var k=Math.floor(Math.random()*b.fxs.length);b.fxs.push(b.fxs.splice(k,1)[0])}d("randomized fx sequence: ",b.fxs)}return!0}function m(b,c){b.addSlide=function(d,e){var f=a(d),g=f[0];b.autostopCount||b.countdown++,c[e?"unshift":"push"](g),b.els&&b.els[e?"unshift":"push"](g),b.slideCount=c.length,b.random&&(b.randomMap.push(b.slideCount-1),b.randomMap.sort(function(a,b){return Math.random()-.5})),f.css("position","absolute"),f[e?"prependTo":"appendTo"](b.$cont),e&&(b.currSlide++,b.nextSlide++),!a.support.opacity&&b.cleartype&&!b.cleartypeNoBg&&r(f),b.fit&&b.width&&f.width(b.width),b.fit&&b.height&&b.height!="auto"&&f.height(b.height),g.cycleH=b.fit&&b.height?b.height:f.height(),g.cycleW=b.fit&&b.width?b.width:f.width(),f.css(b.cssBefore),(b.pager||b.pagerAnchorBuilder)&&a.fn.cycle.createPagerAnchor(c.length-1,g,a(b.pager),c,b),a.isFunction(b.onAddSlide)?b.onAddSlide(f):f.hide()}}function n(c,e,f,g){function q(){var a=0,b=e.timeout;e.timeout&&!e.continuous?(a=o(c[e.currSlide],c[e.nextSlide],e,g),e.fx=="shuffle"&&(a-=e.speedOut)):e.continuous&&h.cyclePause&&(a=10),a>0&&(h.cycleTimeout=setTimeout(function(){n(c,e,0,!e.backwards)},a))}var h=e.$cont[0],i=c[e.currSlide],j=c[e.nextSlide];f&&e.busy&&e.manualTrump&&(d("manualTrump in go(), stopping active transition"),a(c).stop(!0,!0),e.busy=0,clearTimeout(h.cycleTimeout));if(e.busy){d("transition active, ignoring new tx request");return}if(h.cycleStop!=e.stopCount||h.cycleTimeout===0&&!f)return;if(!f&&!h.cyclePause&&!e.bounce&&(e.autostop&&--e.countdown<=0||e.nowrap&&!e.random&&e.nextSlide<e.currSlide)){e.end&&e.end(e);return}var k=!1;if((f||!h.cyclePause)&&e.nextSlide!=e.currSlide){k=!0;var l=e.fx;i.cycleH=i.cycleH||a(i).height(),i.cycleW=i.cycleW||a(i).width(),j.cycleH=j.cycleH||a(j).height(),j.cycleW=j.cycleW||a(j).width(),e.multiFx&&(g&&(e.lastFx===b||++e.lastFx>=e.fxs.length)?e.lastFx=0:!g&&(e.lastFx===b||--e.lastFx<0)&&(e.lastFx=e.fxs.length-1),l=e.fxs[e.lastFx]),e.oneTimeFx&&(l=e.oneTimeFx,e.oneTimeFx=null),a.fn.cycle.resetState(e,l),e.before.length&&a.each(e.before,function(a,b){if(h.cycleStop!=e.stopCount)return;b.apply(j,[i,j,e,g])});var m=function(){e.busy=0,a.each(e.after,function(a,b){if(h.cycleStop!=e.stopCount)return;b.apply(j,[i,j,e,g])}),h.cycleStop||q()};d("tx firing("+l+"); currSlide: "+e.currSlide+"; nextSlide: "+e.nextSlide),e.busy=1,e.fxFn?e.fxFn(i,j,e,m,g,f&&e.fastOnEvent):a.isFunction(a.fn.cycle[e.fx])?a.fn.cycle[e.fx](i,j,e,m,g,f&&e.fastOnEvent):a.fn.cycle.custom(i,j,e,m,g,f&&e.fastOnEvent)}else q();if(k||e.nextSlide==e.currSlide){var p;e.lastSlide=e.currSlide,e.random?(e.currSlide=e.nextSlide,++e.randomIndex==c.length&&(e.randomIndex=0,e.randomMap.sort(function(a,b){return Math.random()-.5})),e.nextSlide=e.randomMap[e.randomIndex],e.nextSlide==e.currSlide&&(e.nextSlide=e.currSlide==e.slideCount-1?0:e.currSlide+1)):e.backwards?(p=e.nextSlide-1<0,p&&e.bounce?(e.backwards=!e.backwards,e.nextSlide=1,e.currSlide=0):(e.nextSlide=p?c.length-1:e.nextSlide-1,e.currSlide=p?0:e.nextSlide+1)):(p=e.nextSlide+1==c.length,p&&e.bounce?(e.backwards=!e.backwards,e.nextSlide=c.length-2,e.currSlide=c.length-1):(e.nextSlide=p?0:e.nextSlide+1,e.currSlide=p?c.length-1:e.nextSlide-1))}k&&e.pager&&e.updateActivePagerLink(e.pager,e.currSlide,e.activePagerClass)}function o(a,b,c,e){if(c.timeoutFn){var f=c.timeoutFn.call(a,a,b,c,e);while(c.fx!="none"&&f-c.speed<250)f+=c.speed;d("calculated timeout: "+f+"; speed: "+c.speed);if(f!==!1)return f}return c.timeout}function p(b,c){var d=c?1:-1,e=b.elements,f=b.$cont[0],g=f.cycleTimeout;g&&(clearTimeout(g),f.cycleTimeout=0);if(b.random&&d<0)b.randomIndex--,--b.randomIndex==-2?b.randomIndex=e.length-2:b.randomIndex==-1&&(b.randomIndex=e.length-1),b.nextSlide=b.randomMap[b.randomIndex];else if(b.random)b.nextSlide=b.randomMap[b.randomIndex];else{b.nextSlide=b.currSlide+d;if(b.nextSlide<0){if(b.nowrap)return!1;b.nextSlide=e.length-1}else if(b.nextSlide>=e.length){if(b.nowrap)return!1;b.nextSlide=0}}var h=b.onPrevNextEvent||b.prevNextClick;return a.isFunction(h)&&h(d>0,b.nextSlide,e[b.nextSlide]),n(e,b,1,c),!1}function q(b,c){var d=a(c.pager);a.each(b,function(e,f){a.fn.cycle.createPagerAnchor(e,f,d,b,c)}),c.updateActivePagerLink(c.pager,c.startingSlide,c.activePagerClass)}function r(b){function c(a){return a=parseInt(a,10).toString(16),a.length<2?"0"+a:a}function e(b){for(;b&&b.nodeName.toLowerCase()!="html";b=b.parentNode){var d=a.css(b,"background-color");if(d&&d.indexOf("rgb")>=0){var e=d.match(/\d+/g);return"#"+c(e[0])+c(e[1])+c(e[2])}if(d&&d!="transparent")return d}return"#ffffff"}d("applying clearType background-color hack"),b.each(function(){a(this).css("background-color",e(this))})}"use strict";var c="2.9999.5";a.support===b&&(a.support={opacity:!a.browser.msie}),a.expr[":"].paused=function(a){return a.cyclePause},a.fn.cycle=function(b,c){var f={s:this.selector,c:this.context};return this.length===0&&b!="stop"?!a.isReady&&f.s?(e("DOM not ready, queuing slideshow"),a(function(){a(f.s,f.c).cycle(b,c)}),this):(e("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this):this.each(function(){var h=g(this,b,c);if(h===!1)return;h.updateActivePagerLink=h.updateActivePagerLink||a.fn.cycle.updateActivePagerLink,this.cycleTimeout&&clearTimeout(this.cycleTimeout),this.cycleTimeout=this.cyclePause=0,this.cycleStop=0;var i=a(this),k=h.slideExpr?a(h.slideExpr,this):i.children(),l=k.get();if(l.length<2){e("terminating; too few slides: "+l.length);return}var m=j(i,k,l,h,f);if(m===!1)return;var p=m.continuous?10:o(l[m.currSlide],l[m.nextSlide],m,!m.backwards);p&&(p+=m.delay||0,p<10&&(p=10),d("first timeout: "+p),this.cycleTimeout=setTimeout(function(){n(l,m,0,!h.backwards)},p))})},a.fn.cycle.resetState=function(b,c){c=c||b.fx,b.before=[],b.after=[],b.cssBefore=a.extend({},b.original.cssBefore),b.cssAfter=a.extend({},b.original.cssAfter),b.animIn=a.extend({},b.original.animIn),b.animOut=a.extend({},b.original.animOut),b.fxFn=null,a.each(b.original.before,function(){b.before.push(this)}),a.each(b.original.after,function(){b.after.push(this)});var d=a.fn.cycle.transitions[c];a.isFunction(d)&&d(b.$cont,a(b.elements),b)},a.fn.cycle.updateActivePagerLink=function(b,c,d){a(b).each(function(){a(this).children().removeClass(d).eq(c).addClass(d)})},a.fn.cycle.next=function(a){p(a,1)},a.fn.cycle.prev=function(a){p(a,0)},a.fn.cycle.createPagerAnchor=function(b,c,e,g,h){var i;a.isFunction(h.pagerAnchorBuilder)?(i=h.pagerAnchorBuilder(b,c),d("pagerAnchorBuilder("+b+", el) returned: "+i)):i='<a href="#">'+(b+1)+"</a>";if(!i)return;var j=a(i);if(j.parents("body").length===0){var k=[];e.length>1?(e.each(function(){var b=j.clone(!0);a(this).append(b),k.push(b[0])}),j=a(k)):j.appendTo(e)}h.pagerAnchors=h.pagerAnchors||[],h.pagerAnchors.push(j);var l=function(c){c.preventDefault(),h.nextSlide=b;var d=h.$cont[0],e=d.cycleTimeout;e&&(clearTimeout(e),d.cycleTimeout=0);var f=h.onPagerEvent||h.pagerClick;a.isFunction(f)&&f(h.nextSlide,g[h.nextSlide]),n(g,h,1,h.currSlide<b)};/mouseenter|mouseover/i.test(h.pagerEvent)?j.hover(l,function(){}):j.bind(h.pagerEvent,l),!/^click/.test(h.pagerEvent)&&!h.allowPagerClickBubble&&j.bind("click.cycle",function(){return!1});var m=h.$cont[0],o=!1;h.pauseOnPagerHover&&j.hover(function(){o=!0,m.cyclePause++,f(m,!0,!0)},function(){o&&m.cyclePause--,f(m,!0,!0)})},a.fn.cycle.hopsFromLast=function(a,b){var c,d=a.lastSlide,e=a.currSlide;return b?c=e>d?e-d:a.slideCount-d:c=e<d?d-e:d+a.slideCount-e,c},a.fn.cycle.commonReset=function(b,c,d,e,f,g){a(d.elements).not(b).hide(),typeof d.cssBefore.opacity=="undefined"&&(d.cssBefore.opacity=1),d.cssBefore.display="block",d.slideResize&&e!==!1&&c.cycleW>0&&(d.cssBefore.width=c.cycleW),d.slideResize&&f!==!1&&c.cycleH>0&&(d.cssBefore.height=c.cycleH),d.cssAfter=d.cssAfter||{},d.cssAfter.display="none",a(b).css("zIndex",d.slideCount+(g===!0?1:0)),a(c).css("zIndex",d.slideCount+(g===!0?0:1))},a.fn.cycle.custom=function(b,c,d,e,f,g){var h=a(b),i=a(c),j=d.speedIn,k=d.speedOut,l=d.easeIn,m=d.easeOut;i.css(d.cssBefore),g&&(typeof g=="number"?j=k=g:j=k=1,l=m=null);var n=function(){i.animate(d.animIn,j,l,function(){e()})};h.animate(d.animOut,k,m,function(){h.css(d.cssAfter),d.sync||n()}),d.sync&&n()},a.fn.cycle.transitions={fade:function(b,c,d){c.not(":eq("+d.currSlide+")").css("opacity",0),d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d),d.cssBefore.opacity=0}),d.animIn={opacity:1},d.animOut={opacity:0},d.cssBefore={top:0,left:0}}},a.fn.cycle.ver=function(){return c},a.fn.cycle.defaults={activePagerClass:"activeSlide",after:null,allowPagerClickBubble:!1,animIn:null,animOut:null,aspect:!1,autostop:0,autostopCount:0,backwards:!1,before:null,center:null,cleartype:!a.support.opacity,cleartypeNoBg:!1,containerResize:1,continuous:0,cssAfter:null,cssBefore:null,delay:0,easeIn:null,easeOut:null,easing:null,end:null,fastOnEvent:0,fit:0,fx:"fade",fxFn:null,height:"auto",manualTrump:!0,metaAttr:"cycle",next:null,nowrap:0,onPagerEvent:null,onPrevNextEvent:null,pager:null,pagerAnchorBuilder:null,pagerEvent:"click.cycle",pause:0,pauseOnPagerHover:0,prev:null,prevNextEvent:"click.cycle",random:0,randomizeEffects:1,requeueOnImageNotLoaded:!0,requeueTimeout:250,rev:0,shuffle:null,skipInitializationCallbacks:!1,slideExpr:null,slideResize:1,speed:1e3,speedIn:null,speedOut:null,startingSlide:b,sync:1,timeout:4e3,timeoutFn:null,updateActivePagerLink:null,width:null}}(jQuery),function(a){"use strict",a.fn.cycle.transitions.none=function(b,c,d){d.fxFn=function(b,c,d,e){a(c).show(),a(b).hide(),e()}},a.fn.cycle.transitions.fadeout=function(b,c,d){c.not(":eq("+d.currSlide+")").css({display:"block",opacity:1}),d.before.push(function(b,c,d,e,f,g){a(b).css("zIndex",d.slideCount+(g!==!0?1:0)),a(c).css("zIndex",d.slideCount+(g!==!0?0:1))}),d.animIn.opacity=1,d.animOut.opacity=0,d.cssBefore.opacity=1,d.cssBefore.display="block",d.cssAfter.zIndex=0},a.fn.cycle.transitions.scrollUp=function(b,c,d){b.css("overflow","hidden"),d.before.push(a.fn.cycle.commonReset);var e=b.height();d.cssBefore.top=e,d.cssBefore.left=0,d.cssFirst.top=0,d.animIn.top=0,d.animOut.top=-e},a.fn.cycle.transitions.scrollDown=function(b,c,d){b.css("overflow","hidden"),d.before.push(a.fn.cycle.commonReset);var e=b.height();d.cssFirst.top=0,d.cssBefore.top=-e,d.cssBefore.left=0,d.animIn.top=0,d.animOut.top=e},a.fn.cycle.transitions.scrollLeft=function(b,c,d){b.css("overflow","hidden"),d.before.push(a.fn.cycle.commonReset);var e=b.width();d.cssFirst.left=0,d.cssBefore.left=e,d.cssBefore.top=0,d.animIn.left=0,d.animOut.left=0-e},a.fn.cycle.transitions.scrollRight=function(b,c,d){b.css("overflow","hidden"),d.before.push(a.fn.cycle.commonReset);var e=b.width();d.cssFirst.left=0,d.cssBefore.left=-e,d.cssBefore.top=0,d.animIn.left=0,d.animOut.left=e},a.fn.cycle.transitions.scrollHorz=function(b,c,d){b.css("overflow","hidden").width(),d.before.push(function(b,c,d,e){d.rev&&(e=!e),a.fn.cycle.commonReset(b,c,d),d.cssBefore.left=e?c.cycleW-1:1-c.cycleW,d.animOut.left=e?-b.cycleW:b.cycleW}),d.cssFirst.left=0,d.cssBefore.top=0,d.animIn.left=0,d.animOut.top=0},a.fn.cycle.transitions.scrollVert=function(b,c,d){b.css("overflow","hidden"),d.before.push(function(b,c,d,e){d.rev&&(e=!e),a.fn.cycle.commonReset(b,c,d),d.cssBefore.top=e?1-c.cycleH:c.cycleH-1,d.animOut.top=e?b.cycleH:-b.cycleH}),d.cssFirst.top=0,d.cssBefore.left=0,d.animIn.top=0,d.animOut.left=0},a.fn.cycle.transitions.slideX=function(b,c,d){d.before.push(function(b,c,d){a(d.elements).not(b).hide(),a.fn.cycle.commonReset(b,c,d,!1,!0),d.animIn.width=c.cycleW}),d.cssBefore.left=0,d.cssBefore.top=0,d.cssBefore.width=0,d.animIn.width="show",d.animOut.width=0},a.fn.cycle.transitions.slideY=function(b,c,d){d.before.push(function(b,c,d){a(d.elements).not(b).hide(),a.fn.cycle.commonReset(b,c,d,!0,!1),d.animIn.height=c.cycleH}),d.cssBefore.left=0,d.cssBefore.top=0,d.cssBefore.height=0,d.animIn.height="show",d.animOut.height=0},a.fn.cycle.transitions.shuffle=function(b,c,d){var e,f=b.css("overflow","visible").width();c.css({left:0,top:0}),d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!0,!0)}),d.speedAdjusted||(d.speed=d.speed/2,d.speedAdjusted=!0),d.random=0,d.shuffle=d.shuffle||{left:-f,top:15},d.els=[];for(e=0;e<c.length;e++)d.els.push(c[e]);for(e=0;e<d.currSlide;e++)d.els.push(d.els.shift());d.fxFn=function(b,c,d,e,f){d.rev&&(f=!f);var g=f?a(b):a(c);a(c).css(d.cssBefore);var h=d.slideCount;g.animate(d.shuffle,d.speedIn,d.easeIn,function(){var c=a.fn.cycle.hopsFromLast(d,f);for(var i=0;i<c;i++)f?d.els.push(d.els.shift()):d.els.unshift(d.els.pop());if(f)for(var j=0,k=d.els.length;j<k;j++)a(d.els[j]).css("z-index",k-j+h);else{var l=a(b).css("z-index");g.css("z-index",parseInt(l,10)+1+h)}g.animate({left:0,top:0},d.speedOut,d.easeOut,function(){a(f?this:b).hide(),e&&e()})})},a.extend(d.cssBefore,{display:"block",opacity:1,top:0,left:0})},a.fn.cycle.transitions.turnUp=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!1),d.cssBefore.top=c.cycleH,d.animIn.height=c.cycleH,d.animOut.width=c.cycleW}),d.cssFirst.top=0,d.cssBefore.left=0,d.cssBefore.height=0,d.animIn.top=0,d.animOut.height=0},a.fn.cycle.transitions.turnDown=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!1),d.animIn.height=c.cycleH,d.animOut.top=b.cycleH}),d.cssFirst.top=0,d.cssBefore.left=0,d.cssBefore.top=0,d.cssBefore.height=0,d.animOut.height=0},a.fn.cycle.transitions.turnLeft=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!1,!0),d.cssBefore.left=c.cycleW,d.animIn.width=c.cycleW}),d.cssBefore.top=0,d.cssBefore.width=0,d.animIn.left=0,d.animOut.width=0},a.fn.cycle.transitions.turnRight=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!1,!0),d.animIn.width=c.cycleW,d.animOut.left=b.cycleW}),a.extend(d.cssBefore,{top:0,left:0,width:0}),d.animIn.left=0,d.animOut.width=0},a.fn.cycle.transitions.zoom=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!1,!1,!0),d.cssBefore.top=c.cycleH/2,d.cssBefore.left=c.cycleW/2,a.extend(d.animIn,{top:0,left:0,width:c.cycleW,height:c.cycleH}),a.extend(d.animOut,{width:0,height:0,top:b.cycleH/2,left:b.cycleW/2})}),d.cssFirst.top=0,d.cssFirst.left=0,d.cssBefore.width=0,d.cssBefore.height=0},a.fn.cycle.transitions.fadeZoom=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!1,!1),d.cssBefore.left=c.cycleW/2,d.cssBefore.top=c.cycleH/2,a.extend(d.animIn,{top:0,left:0,width:c.cycleW,height:c.cycleH})}),d.cssBefore.width=0,d.cssBefore.height=0,d.animOut.opacity=0},a.fn.cycle.transitions.blindX=function(b,c,d){var e=b.css("overflow","hidden").width();d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d),d.animIn.width=c.cycleW,d.animOut.left=b.cycleW}),d.cssBefore.left=e,d.cssBefore.top=0,d.animIn.left=0,d.animOut.left=e},a.fn.cycle.transitions.blindY=function(b,c,d){var e=b.css("overflow","hidden").height();d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d),d.animIn.height=c.cycleH,d.animOut.top=b.cycleH}),d.cssBefore.top=e,d.cssBefore.left=0,d.animIn.top=0,d.animOut.top=e},a.fn.cycle.transitions.blindZ=function(b,c,d){var e=b.css("overflow","hidden").height(),f=b.width();d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d),d.animIn.height=c.cycleH,d.animOut.top=b.cycleH}),d.cssBefore.top=e,d.cssBefore.left=f,d.animIn.top=0,d.animIn.left=0,d.animOut.top=e,d.animOut.left=f},a.fn.cycle.transitions.growX=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!1,!0),d.cssBefore.left=this.cycleW/2,d.animIn.left=0,d.animIn.width=this.cycleW,d.animOut.left=0}),d.cssBefore.top=0,d.cssBefore.width=0},a.fn.cycle.transitions.growY=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!1),d.cssBefore.top=this.cycleH/2,d.animIn.top=0,d.animIn.height=this.cycleH,d.animOut.top=0}),d.cssBefore.height=0,d.cssBefore.left=0},a.fn.cycle.transitions.curtainX=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!1,!0,!0),d.cssBefore.left=c.cycleW/2,d.animIn.left=0,d.animIn.width=this.cycleW,d.animOut.left=b.cycleW/2,d.animOut.width=0}),d.cssBefore.top=0,d.cssBefore.width=0},a.fn.cycle.transitions.curtainY=function(b,c,d){d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!1,!0),d.cssBefore.top=c.cycleH/2,d.animIn.top=0,d.animIn.height=c.cycleH,d.animOut.top=b.cycleH/2,d.animOut.height=0}),d.cssBefore.height=0,d.cssBefore.left=0},a.fn.cycle.transitions.cover=function(b,c,d){var e=d.direction||"left",f=b.css("overflow","hidden").width(),g=b.height();d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d),e=="right"?d.cssBefore.left=-f:e=="up"?d.cssBefore.top=g:e=="down"?d.cssBefore.top=-g:d.cssBefore.left=f}),d.animIn.left=0,d.animIn.top=0,d.cssBefore.top=0,d.cssBefore.left=0},a.fn.cycle.transitions.uncover=function(b,c,d){var e=d.direction||"left",f=b.css("overflow","hidden").width(),g=b.height();d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!0,!0),e=="right"?d.animOut.left=f:e=="up"?d.animOut.top=-g:e=="down"?d.animOut.top=g:d.animOut.left=-f}),d.animIn.left=0,d.animIn.top=0,d.cssBefore.top=0,d.cssBefore.left=0},a.fn.cycle.transitions.toss=function(b,c,d){var e=b.css("overflow","visible").width(),f=b.height();d.before.push(function(b,c,d){a.fn.cycle.commonReset(b,c,d,!0,!0,!0),!d.animOut.left&&!d.animOut.top?a.extend(d.animOut,{left:e*2,top:-f/2,opacity:0}):d.animOut.opacity=0}),d.cssBefore.left=0,d.cssBefore.top=0,d.animIn.left=0},a.fn.cycle.transitions.wipe=function(b,c,d){var e=b.css("overflow","hidden").width(),f=b.height();d.cssBefore=d.cssBefore||{};var g;if(d.clip)if(/l2r/.test(d.clip))g="rect(0px 0px "+f+"px 0px)";else if(/r2l/.test(d.clip))g="rect(0px "+e+"px "+f+"px "+e+"px)";else if(/t2b/.test(d.clip))g="rect(0px "+e+"px 0px 0px)";else if(/b2t/.test(d.clip))g="rect("+f+"px "+e+"px "+f+"px 0px)";else if(/zoom/.test(d.clip)){var h=parseInt(f/2,10),i=parseInt(e/2,10);g="rect("+h+"px "+i+"px "+h+"px "+i+"px)"}d.cssBefore.clip=d.cssBefore.clip||g||"rect(0px 0px 0px 0px)";var j=d.cssBefore.clip.match(/(\d+)/g),k=parseInt(j[0],10),l=parseInt(j[1],10),m=parseInt(j[2],10),n=parseInt(j[3],10);d.before.push(function(b,c,d){if(b==c)return;var g=a(b),h=a(c);a.fn.cycle.commonReset(b,c,d,!0,!0,!1),d.cssAfter.display="block";var i=1,j=parseInt(d.speedIn/13,10)-1;(function o(){var a=k?k-parseInt(i*(k/j),10):0,b=n?n-parseInt(i*(n/j),10):0,c=m<f?m+parseInt(i*((f-m)/j||1),10):f,d=l<e?l+parseInt(i*((e-l)/j||1),10):e;h.css({clip:"rect("+a+"px "+d+"px "+c+"px "+b+"px)"}),i++<=j?setTimeout(o,13):g.css("display","none")})()}),a.extend(d.cssBefore,{display:"block",opacity:1,top:0,left:0}),d.animIn={left:0},d.animOut={left:0}}}(jQuery),function(a){a.fn.equalHeights=function(b,c){return tallest=b?b:0,this.each(function(){a(this).height()>tallest&&(tallest=a(this).height())}),c&&tallest>c&&(tallest=c),this.each(function(){a(this).css("min-height",tallest).css("overflow","visible")})}}(jQuery),function(a){function c(b){var c=b.data;b.isDefaultPrevented()||(b.preventDefault(),a(this).ajaxSubmit(c))}function d(b){var c=b.target,d=a(c);if(!d.is(":submit,input:image")){var e=d.closest(":submit");if(e.length===0)return;c=e[0]}var f=this;f.clk=c;if(c.type=="image")if(b.offsetX!==undefined)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if(typeof a.fn.offset=="function"){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)}function e(){if(!a.fn.ajaxSubmit.debug)return;var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}"use strict";var b={};b.fileapi=a("<input type='file'/>").get(0).files!==undefined,b.formdata=window.FormData!==undefined,a.fn.ajaxSubmit=function(c){function x(b){var d=new FormData;for(var e=0;e<b.length;e++)d.append(b[e].name,b[e].value);if(c.extraData)for(var f in c.extraData)c.extraData.hasOwnProperty(f)&&d.append(f,c.extraData[f]);c.data=null;var g=a.extend(!0,{},a.ajaxSettings,c,{contentType:!1,processData:!1,cache:!1,type:"POST"});c.uploadProgress&&(g.xhr=function(){var a=jQuery.ajaxSettings.xhr();return a.upload&&(a.upload.onprogress=function(a){var b=0,d=a.loaded||a.position,e=a.total;a.lengthComputable&&(b=Math.ceil(d/e*100)),c.uploadProgress(a,d,e,b)}),a}),g.data=null;var h=g.beforeSend;g.beforeSend=function(a,b){b.data=d,h&&h.call(b,a,c)},a.ajax(g)}function y(b){function x(a){var b=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;return b}function A(){function g(){try{var a=x(o).readyState;e("state = "+a),a&&a.toLowerCase()=="uninitialized"&&setTimeout(g,50)}catch(b){e("Server abort: ",b," (",b.name,")"),F(w),t&&clearTimeout(t),t=undefined}}var b=h.attr("target"),c=h.attr("action");f.setAttribute("target",m),d||f.setAttribute("method","POST"),c!=j.url&&f.setAttribute("action",j.url),!j.skipEncodingOverride&&(!d||/post/i.test(d))&&h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),j.timeout&&(t=setTimeout(function(){s=!0,F(v)},j.timeout));var i=[];try{if(j.extraData)for(var k in j.extraData)j.extraData.hasOwnProperty(k)&&i.push(a('<input type="hidden" name="'+k+'">').attr("value",j.extraData[k]).appendTo(f)[0]);j.iframeTarget||(n.appendTo("body"),o.attachEvent?o.attachEvent("onload",F):o.addEventListener("load",F,!1)),setTimeout(g,15),f.submit()}finally{f.setAttribute("action",c),b?f.setAttribute("target",b):h.removeAttr("target"),a(i).remove()}}function F(b){if(p.aborted||E)return;try{C=x(o)}catch(c){e("cannot access response document: ",c),b=w}if(b===v&&p){p.abort("timeout");return}if(b==w&&p){p.abort("server abort");return}if(!C||C.location.href==j.iframeSrc)if(!s)return;o.detachEvent?o.detachEvent("onload",F):o.removeEventListener("load",F,!1);var d="success",f;try{if(s)throw"timeout";var g=j.dataType=="xml"||C.XMLDocument||a.isXMLDoc(C);e("isXml="+g);if(!g&&window.opera&&(C.body===null||!C.body.innerHTML)&&--D){e("requeing onLoad callback, DOM not available"),setTimeout(F,250);return}var h=C.body?C.body:C.documentElement;p.responseText=h?h.innerHTML:null,p.responseXML=C.XMLDocument?C.XMLDocument:C,g&&(j.dataType="xml"),p.getResponseHeader=function(a){var b={"content-type":j.dataType};return b[a]},h&&(p.status=Number(h.getAttribute("status"))||p.status,p.statusText=h.getAttribute("statusText")||p.statusText);var i=(j.dataType||"").toLowerCase(),k=/(json|script|text)/.test(i);if(k||j.textarea){var m=C.getElementsByTagName("textarea")[0];if(m)p.responseText=m.value,p.status=Number(m.getAttribute("status"))||p.status,p.statusText=m.getAttribute("statusText")||p.statusText;else if(k){var q=C.getElementsByTagName("pre")[0],r=C.getElementsByTagName("body")[0];q?p.responseText=q.textContent?q.textContent:q.innerText:r&&(p.responseText=r.textContent?r.textContent:r.innerText)}}else i=="xml"&&!p.responseXML&&p.responseText&&(p.responseXML=G(p.responseText));try{B=I(p,i,j)}catch(b){d="parsererror",p.error=f=b||d}}catch(b){e("error caught: ",b),d="error",p.error=f=b||d}p.aborted&&(e("upload aborted"),d=null),p.status&&(d=p.status>=200&&p.status<300||p.status===304?"success":"error"),d==="success"?(j.success&&j.success.call(j.context,B,"success",p),l&&a.event.trigger("ajaxSuccess",[p,j])):d&&(f===undefined&&(f=p.statusText),j.error&&j.error.call(j.context,p,d,f),l&&a.event.trigger("ajaxError",[p,j,f])),l&&a.event.trigger("ajaxComplete",[p,j]),l&&!--a.active&&a.event.trigger("ajaxStop"),j.complete&&j.complete.call(j.context,p,d),E=!0,j.timeout&&clearTimeout(t),setTimeout(function(){j.iframeTarget||n.remove(),p.responseXML=null},100)}var f=h[0],g,i,j,l,m,n,o,p,q,r,s,t,u=!!a.fn.prop;if(a(":input[name=submit],:input[id=submit]",f).length){alert('Error: Form elements must not have name or id of "submit".');return}if(b)for(i=0;i<k.length;i++)g=a(k[i]),u?g.prop("disabled",!1):g.removeAttr("disabled");j=a.extend(!0,{},a.ajaxSettings,c),j.context=j.context||j,m="jqFormIO"+(new Date).getTime(),j.iframeTarget?(n=a(j.iframeTarget),r=n.attr("name"),r?m=r:n.attr("name",m)):(n=a('<iframe name="'+m+'" src="'+j.iframeSrc+'" />'),n.css({position:"absolute",top:"-1000px",left:"-1000px"})),o=n[0],p={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(b){var c=b==="timeout"?"timeout":"aborted";e("aborting upload... "+c),this.aborted=1,n.attr("src",j.iframeSrc),p.error=c,j.error&&j.error.call(j.context,p,c,b),l&&a.event.trigger("ajaxError",[p,j,c]),j.complete&&j.complete.call(j.context,p,c)}},l=j.global,l&&0===a.active++&&a.event.trigger("ajaxStart"),l&&a.event.trigger("ajaxSend",[p,j]);if(j.beforeSend&&j.beforeSend.call(j.context,p,j)===!1){j.global&&a.active--;return}if(p.aborted)return;q=f.clk,q&&(r=q.name,r&&!q.disabled&&(j.extraData=j.extraData||{},j.extraData[r]=q.value,q.type=="image"&&(j.extraData[r+".x"]=f.clk_x,j.extraData[r+".y"]=f.clk_y)));var v=1,w=2,y=a("meta[name=csrf-token]").attr("content"),z=a("meta[name=csrf-param]").attr("content");z&&y&&(j.extraData=j.extraData||{},j.extraData[z]=y),j.forceSync?A():setTimeout(A,10);var B,C,D=50,E,G=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&b.documentElement.nodeName!="parsererror"?b:null},H=a.parseJSON||function(a){return window.eval("("+a+")")},I=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f=c==="xml"||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&g.documentElement.nodeName==="parsererror"&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),typeof g=="string"&&(c==="json"||!c&&e.indexOf("json")>=0?g=H(g):(c==="script"||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g}}if(!this.length)return e("ajaxSubmit: skipping submit process - no element selected"),this;var d,f,g,h=this;typeof c=="function"&&(c={success:c}),d=this.attr("method"),f=this.attr("action"),g=typeof f=="string"?a.trim(f):"",g=g||window.location.href||"",g&&(g=(g.match(/^([^#]+)/)||[])[1]),c=a.extend(!0,{url:g,success:a.ajaxSettings.success,type:d||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},c);var i={};this.trigger("form-pre-serialize",[this,c,i]);if(i.veto)return e("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(c.beforeSerialize&&c.beforeSerialize(this,c)===!1)return e("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var j=c.traditional;j===undefined&&(j=a.ajaxSettings.traditional);var k=[],l,m=this.formToArray(c.semantic,k);c.data&&(c.extraData=c.data,l=a.param(c.data,j));if(c.beforeSubmit&&c.beforeSubmit(m,this,c)===!1)return e("ajaxSubmit: submit aborted via beforeSubmit callback"),this;this.trigger("form-submit-validate",[m,this,c,i]);if(i.veto)return e("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var n=a.param(m,j);l&&(n=n?n+"&"+l:l),c.type.
toUpperCase()=="GET"?(c.url+=(c.url.indexOf("?")>=0?"&":"?")+n,c.data=null):c.data=n;var o=[];c.resetForm&&o.push(function(){h.resetForm()}),c.clearForm&&o.push(function(){h.clearForm(c.includeHidden)});if(!c.dataType&&c.target){var p=c.success||function(){};o.push(function(b){var d=c.replaceTarget?"replaceWith":"html";a(c.target)[d](b).each(p,arguments)})}else c.success&&o.push(c.success);c.success=function(a,b,d){var e=c.context||c;for(var f=0,g=o.length;f<g;f++)o[f].apply(e,[a,b,d||h,h])};var q=a("input:file:enabled[value]",this),r=q.length>0,s="multipart/form-data",t=h.attr("enctype")==s||h.attr("encoding")==s,u=b.fileapi&&b.formdata;e("fileAPI :"+u);var v=(r||t)&&!u;c.iframe!==!1&&(c.iframe||v)?c.closeKeepAlive?a.get(c.closeKeepAlive,function(){y(m)}):y(m):(r||t)&&u?x(m):a.ajax(c);for(var w=0;w<k.length;w++)k[w]=null;return this.trigger("form-submit-notify",[this,c]),this},a.fn.ajaxForm=function(b){b=b||{},b.delegation=b.delegation&&a.isFunction(a.fn.on);if(!b.delegation&&this.length===0){var f={s:this.selector,c:this.context};return!a.isReady&&f.s?(e("DOM not ready, queuing ajaxForm"),a(function(){a(f.s,f.c).ajaxForm(b)}),this):(e("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return b.delegation?(a(document).off("submit.form-plugin",this.selector,c).off("click.form-plugin",this.selector,d).on("submit.form-plugin",this.selector,b,c).on("click.form-plugin",this.selector,b,d),this):this.ajaxFormUnbind().bind("submit.form-plugin",b,c).bind("click.form-plugin",b,d)},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(c,d){var e=[];if(this.length===0)return e;var f=this[0],g=c?f.getElementsByTagName("*"):f.elements;if(!g)return e;var h,i,j,k,l,m,n;for(h=0,m=g.length;h<m;h++){l=g[h],j=l.name;if(!j)continue;if(c&&f.clk&&l.type=="image"){!l.disabled&&f.clk==l&&(e.push({name:j,value:a(l).val(),type:l.type}),e.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}));continue}k=a.fieldValue(l,!0);if(k&&k.constructor==Array){d&&d.push(l);for(i=0,n=k.length;i<n;i++)e.push({name:j,value:k[i]})}else if(b.fileapi&&l.type=="file"&&!l.disabled){d&&d.push(l);var o=l.files;if(o.length)for(i=0;i<o.length;i++)e.push({name:j,value:o[i],type:l.type});else e.push({name:j,value:"",type:l.type})}else k!==null&&typeof k!="undefined"&&(d&&d.push(l),e.push({name:j,value:k,type:l.type,required:l.required}))}if(!c&&f.clk){var p=a(f.clk),q=p[0];j=q.name,j&&!q.disabled&&q.type=="image"&&(e.push({name:j,value:p.val()}),e.push({name:j+".x",value:f.clk_x},{name:j+".y",value:f.clk_y}))}return e},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(!d)return;var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;f<g;f++)c.push({name:d,value:e[f]});else e!==null&&typeof e!="undefined"&&c.push({name:this.name,value:e})}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;d<e;d++){var f=this[d],g=a.fieldValue(f,b);if(g===null||typeof g=="undefined"||g.constructor==Array&&!g.length)continue;g.constructor==Array?a.merge(c,g):c.push(g)}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();c===undefined&&(c=!0);if(c&&(!d||b.disabled||e=="reset"||e=="button"||(e=="checkbox"||e=="radio")&&!b.checked||(e=="submit"||e=="image")&&b.form&&b.form.clk!=b||f=="select"&&b.selectedIndex==-1))return null;if(f=="select"){var g=b.selectedIndex;if(g<0)return null;var h=[],i=b.options,j=e=="select-one",k=j?g+1:i.length;for(var l=j?g:0;l<k;l++){var m=i[l];if(m.selected){var n=m.value;n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value);if(j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(b){var c=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var d=this.type,e=this.tagName.toLowerCase();c.test(d)||e=="textarea"?this.value="":d=="checkbox"||d=="radio"?this.checked=!1:e=="select"?this.selectedIndex=-1:b&&(b===!0&&/hidden/.test(d)||typeof b=="string"&&a(this).is(b))&&(this.value="")})},a.fn.resetForm=function(){return this.each(function(){(typeof this.reset=="function"||typeof this.reset=="object"&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return a===undefined&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return b===undefined&&(b=!0),this.each(function(){var c=this.type;if(c=="checkbox"||c=="radio")this.checked=b;else if(this.tagName.toLowerCase()=="option"){var d=a(this).parent("select");b&&d[0]&&d[0].type=="select-one"&&d.find("option").selected(!1),this.selected=b}})},a.fn.ajaxSubmit.debug=!1}(jQuery);var FORMALIZE=function(a,b,c){var d="placeholder"in c.createElement("input"),e="autofocus"in c.createElement("input"),f=!!a.browser.msie&&parseInt(a.browser.version,10)===6,g=!!a.browser.msie&&parseInt(a.browser.version,10)===7;return{go:function(){for(var a in FORMALIZE.init)FORMALIZE.init[a]()},init:{full_input_size:function(){g&&a("textarea, input.input_full").length&&a("textarea, input.input_full").wrap('<span class="input_full_wrap"></span>')},ie6_skin_inputs:function(){if(f&&a("input, select, textarea").length){var b=/button|submit|reset/,c=/date|datetime|datetime-local|email|month|number|password|range|search|tel|text|time|url|week/;a("input").each(function(){var d=a(this);this.getAttribute("type").match(b)?(d.addClass("ie6_button"),this.disabled&&d.addClass("ie6_button_disabled")):this.getAttribute("type").match(c)&&(d.addClass("ie6_input"),this.disabled&&d.addClass("ie6_input_disabled"))}),a("textarea, select").each(function(){this.disabled&&a(this).addClass("ie6_input_disabled")})}},autofocus:function(){e||!a(":input[autofocus]").length||a(":input[autofocus]:visible:first").focus()},placeholder:function(){!d&&!!a(":input[placeholder]").length&&(FORMALIZE.misc.add_placeholder(),a(":input[placeholder]").each(function(){if(this.type!=="password"){var b=a(this),c=b.attr("placeholder");b.focus(function(){b.val()===c&&b.val("").removeClass("placeholder_text")}).blur(function(){FORMALIZE.misc.add_placeholder()}),b.closest("form").submit(function(){b.val()===c&&b.val("").removeClass("placeholder_text")}).bind("reset",function(){setTimeout(FORMALIZE.misc.add_placeholder,50)})}}))}},misc:{add_placeholder:function(){d||!a(":input[placeholder]").length||a(":input[placeholder]").each(function(){if(this.type!=="password"){var b=a(this),c=b.attr("placeholder");(!b.val()||b.val()===c)&&b.val(c).addClass("placeholder_text")}})}}}}(jQuery,this,this.document);jQuery(document).ready(function(){FORMALIZE.go()}),function(a){function b(b){if(typeof b.data!="string")return;var c=b.handler,d=b.data.toLowerCase().split(" ");b.handler=function(b){if(!(this===b.target||!/textarea|select/i.test(b.target.nodeName)&&b.target.type!=="text"&&b.target.type!="email"))return;var e=b.type!=="keypress"&&a.hotkeys.specialKeys[b.which],f=String.fromCharCode(b.which).toLowerCase(),g,h="",i={};b.altKey&&e!=="alt"&&(h+="alt+"),b.ctrlKey&&e!=="ctrl"&&(h+="ctrl+"),b.metaKey&&!b.ctrlKey&&e!=="meta"&&(h+="meta+"),b.shiftKey&&e!=="shift"&&(h+="shift+"),e?i[h+e]=!0:(i[h+f]=!0,i[h+a.hotkeys.shiftNums[f]]=!0,h==="shift+"&&(i[a.hotkeys.shiftNums[f]]=!0));for(var j=0,k=d.length;j<k;j++)if(i[d[j]])return c.apply(this,arguments)}}a.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},a.each(["keydown","keyup","keypress"],function(){a.event.special[this]={add:b}})}(jQuery),function(a){function d(b,c,d){var e=c.hash.slice(1),f=document.getElementById(e)||document.getElementsByName(e)[0];if(!f)return;b&&b.preventDefault();var g=a(d.target);if(d.lock&&g.is(":animated")||d.onBefore&&d.onBefore.call(d,b,f,g)===!1)return;d.stop&&g.stop(!0);if(d.hash){var h=f.id==e?"id":"name",i=a("<a> </a>").attr(h,e).css({position:"absolute",top:a(window).scrollTop(),left:a(window).scrollLeft()});f[h]="",a("body").prepend(i),location=c.hash,i.remove(),f[h]=e}g.scrollTo(f,d).trigger("notify.serialScroll",[f])}var b=location.href.replace(/#.*/,""),c=a.localScroll=function(b){a("body").localScroll(b)};c.defaults={duration:1e3,axis:"y",event:"click",stop:!0,target:window,reset:!0},c.hash=function(b){if(location.hash){b=a.extend({},c.defaults,b),b.hash=!1;if(b.reset){var e=b.duration;delete b.duration,a(b.target).scrollTo(0,b),b.duration=e}d(0,location,b)}},a.fn.localScroll=function(e){function f(){return!!this.href&&!!this.hash&&this.href.replace(this.hash,"")==b&&(!e.filter||a(this).is(e.filter))}return e=a.extend({},c.defaults,e),e.lazy?this.bind(e.event,function(b){var c=a([b.target,b.target.parentNode]).filter(f)[0];c&&d(b,c,e)}):this.find("a,area").filter(f).bind(e.event,function(a){d(a,this,e)}).end().end()}}(jQuery),function(a,b,c){var d=b.event,e;d.special.smartresize={setup:function(){b(this).bind("resize",d.special.smartresize.handler)},teardown:function(){b(this).unbind("resize",d.special.smartresize.handler)},handler:function(a,b){var c=this,d=arguments;a.type="smartresize",e&&clearTimeout(e),e=setTimeout(function(){jQuery.event.handle.apply(c,d)},b==="execAsap"?0:100)}},b.fn.smartresize=function(a){return a?this.bind("smartresize",a):this.trigger("smartresize",["execAsap"])},b.Mason=function(a,c){this.element=b(c),this._create(a),this._init()};var f=["position","height"];b.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1},b.Mason.prototype={_filterFindBricks:function(a){var b=this.options.itemSelector;return b?a.filter(b).add(a.find(b)):a},_getBricks:function(a){var b=this._filterFindBricks(a).css({position:"absolute"}).addClass("masonry-brick");return b},_create:function(c){this.options=b.extend(!0,{},b.Mason.settings,c),this.styleQueue=[],this.reloadItems();var d=this.element[0].style;this.originalStyle={};for(var e=0,g=f.length;e<g;e++){var h=f[e];this.originalStyle[h]=d[h]||""}this.element.css({position:"relative"}),this.horizontalDirection=this.options.isRTL?"right":"left",this.offset={};var i=b(document.createElement("div"));this.element.prepend(i),this.offset.y=Math.round(i.position().top),this.options.isRTL?(i.css({"float":"right",display:"inline-block"}),this.offset.x=Math.round(this.element.outerWidth()-i.position().left)):this.offset.x=Math.round(i.position().left),i.remove();var j=this;setTimeout(function(){j.element.addClass("masonry")},0),this.options.isResizable&&b(a).bind("smartresize.masonry",function(){j.resize()})},_init:function(a){this._getColumns(),this._reLayout(a)},option:function(a,c){b.isPlainObject(a)&&(this.options=b.extend(!0,this.options,a))},layout:function(a,c){var d,e,f,g,h,i;for(var j=0,k=a.length;j<k;j++){d=b(a[j]),e=Math.ceil(d.outerWidth(!0)/this.columnWidth),e=Math.min(e,this.cols);if(e===1)this._placeBrick(d,this.colYs);else{f=this.cols+1-e,g=[];for(i=0;i<f;i++)h=this.colYs.slice(i,i+e),g[i]=Math.max.apply(Math,h);this._placeBrick(d,g)}}var l={};l.height=Math.max.apply(Math,this.colYs)-this.offset.y;if(this.options.isFitWidth){var m=0,j=this.cols;while(--j){if(this.colYs[j]!==this.offset.y)break;m++}l.width=(this.cols-m)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:l});var n=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",o=this.options.animationOptions,p;for(j=0,k=this.styleQueue.length;j<k;j++)p=this.styleQueue[j],p.$el[n](p.style,o);this.styleQueue=[],c&&c.call(a),this.isLaidOut=!0},_getColumns:function(){var a=this.options.isFitWidth?this.element.parent():this.element,b=a.width();this.columnWidth=this.options.columnWidth||this.$bricks.outerWidth(!0)||b,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((b+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(a,b){var c=Math.min.apply(Math,b),d=0;for(var e=0,f=b.length;e<f;e++)if(b[e]===c){d=e;break}var g={top:c};g[this.horizontalDirection]=this.columnWidth*d+this.offset.x,this.styleQueue.push({$el:a,style:g});var h=c+a.outerHeight(!0),i=this.cols+1-f;for(e=0;e<i;e++)this.colYs[d+e]=h},resize:function(){var a=this.cols;this._getColumns(),this.cols!==a&&this._reLayout()},_reLayout:function(a){var b=this.cols;this.colYs=[];while(b--)this.colYs.push(this.offset.y);this.layout(this.$bricks,a)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(a){this.reloadItems(),this._init(a)},appended:function(a,b,c){if(b){this._filterFindBricks(a).css({top:this.element.height()});var d=this;setTimeout(function(){d._appended(a,c)},1)}else this._appended(a,c)},_appended:function(a,b){var c=this._getBricks(a);this.$bricks=this.$bricks.add(c),this.layout(c,b)},remove:function(a){this.$bricks=this.$bricks.not(a),a.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var c=this.element[0].style;for(var d=0,e=f.length;d<e;d++){var g=f[d];c[g]=this.originalStyle[g]}this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),b(a).unbind(".masonry")}},b.fn.imagesLoaded=function(a){function b(){--g<=0&&this.src!==h&&(setTimeout(d),f.unbind("load error",b))}function d(){a.call(e,f)}var e=this,f=e.find("img").add(e.filter("img")),g=f.length,h="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return g||d(),f.bind("load error",b).each(function(){if(this.complete||this.complete===c){var a=this.src;this.src=h,this.src=a}}),e};var g=function(a){this.console&&console.error(a)};b.fn.masonry=function(a){if(typeof a=="string"){var c=Array.prototype.slice.call(arguments,1);this.each(function(){var d=b.data(this,"masonry");if(!d)g("cannot call methods on masonry prior to initialization; attempted to call method '"+a+"'");else{if(!b.isFunction(d[a])||a.charAt(0)==="_"){g("no such method '"+a+"' for masonry instance");return}d[a].apply(d,c)}})}else this.each(function(){var c=b.data(this,"masonry");c?(c.option(a||{}),c._init()):b.data(this,"masonry",new b.Mason(a,this))});return this}}(window,jQuery),function(a){a.fn.parallax=function(b,c,d,e){function f(b,c){c.each(function(){var c=a(this),d=c.offset().top;if(e==1)var f=c.outerHeight(!0);else var f=c.height();d+f>=b&&d+f-h<b&&l(b,f),d<=b&&d+f>=b&&d-h<b&&d+f-h>b&&l(b,f),d+f>b&&d-h<b&&d>b&&l(b,f)})}function k(a,b,c,d,e){return a+" "+Math.round(-(b+c-d)*e)+"px"}function l(a,e){j.css({backgroundPosition:k(b,e,a,c,d)})}var g=a(window),h=a(window).height(),i=g.scrollTop(),j=a(this);b==null&&(b="50%"),c==null&&(c=0),d==null&&(d=.1),e==null&&(e=!0),height=j.height(),j.css({backgroundPosition:k(b,e,c,d)}),g.bind("scroll",function(){var b=g.scrollTop();f(b,j),a("#pixels").html(b)})}}(jQuery),function(a){"use strict";var b,c,d;a.extend({roundaboutShapes:{def:"lazySusan",lazySusan:function(a,b,c){return{x:Math.sin(a+b),y:Math.sin(a+3*Math.PI/2+b)/8*c,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}}}}),b={bearing:0,tilt:0,minZ:100,maxZ:280,minOpacity:.4,maxOpacity:1,minScale:.4,maxScale:1,duration:600,btnNext:null,btnNextCallback:function(){},btnPrev:null,btnPrevCallback:function(){},btnToggleAutoplay:null,btnStartAutoplay:null,btnStopAutoplay:null,easing:"swing",clickToFocus:!0,clickToFocusCallback:function(){},focusBearing:0,shape:"lazySusan",debug:!1,childSelector:"li",startingChild:null,reflect:!1,floatComparisonThreshold:.001,autoplay:!1,autoplayDuration:1e3,autoplayPauseOnHover:!1,autoplayCallback:function(){},autoplayInitialDelay:0,enableDrag:!1,dropDuration:600,dropEasing:"swing",dropAnimateTo:"nearest",dropCallback:function(){},dragAxis:"x",dragFactor:4,triggerFocusEvents:!0,triggerBlurEvents:!0,responsive:!1},c={autoplayInterval:null,autoplayIsRunning:!1,autoplayStartTimeout:null,animating:!1,childInFocus:-1,touchMoveStartPosition:null,stopAnimation:!1,lastAnimationStep:!1},d={init:function(e,f,g){var h,i=(new Date).getTime();return e=typeof e=="object"?e:{},f=a.isFunction(f)?f:function(){},f=a.isFunction(e)?e:f,h=a.extend({},b,e,c),this.each(function(){var b=a(this),c=b.children(h.childSelector).length,e=360/c,i=h.startingChild&&h.startingChild>c-1?c-1:h.startingChild,j=h.startingChild===null?h.bearing:360-i*e,k=b.css("position")!=="static"?b.css("position"):"relative";b.css({padding:0,position:k}).addClass("roundabout-holder").data("roundabout",a.extend({},h,{startingChild:i,bearing:j,oppositeOfFocusBearing:d.normalize.apply(null,[h.focusBearing-180]),dragBearing:j,period:e})),g?b.unbind(".roundabout").children(h.childSelector).unbind(".roundabout"):h.responsive&&a(window).bind("resize",function(){d.relayoutChildren.apply(b)}),h.clickToFocus&&b.children(h.childSelector).each(function(c){a(this).bind("click.roundabout",function(){var e=d.getPlacement.apply(b,[c]);if(!d.isInFocus.apply(b,[e]))return d.stopAnimation.apply(a(this)),b.data("roundabout").animating||d.animateBearingToFocus.apply(b,[e,b.data("roundabout").clickToFocusCallback]),!1})}),h.btnNext&&a(h.btnNext).bind("click.roundabout",function(){return b.data("roundabout").animating||d.animateToNextChild.apply(b,[b.data("roundabout").btnNextCallback]),!1}),h.btnPrev&&a(h.btnPrev).bind("click.roundabout",function(){return d.animateToPreviousChild.apply(b,[b.data("roundabout").btnPrevCallback]),!1}),h.btnToggleAutoplay&&a(h.btnToggleAutoplay).bind("click.roundabout",function(){return d.toggleAutoplay.apply(b),!1}),h.btnStartAutoplay&&a(h.btnStartAutoplay).bind("click.roundabout",function(){return d.startAutoplay.apply(b),!1}),h.btnStopAutoplay&&a(h.btnStopAutoplay).bind("click.roundabout",function(){return d.stopAutoplay.apply(b),!1}),h.autoplayPauseOnHover&&b.bind("mouseenter.roundabout.autoplay",function(){d.stopAutoplay.apply(b,[!0])}).bind("mouseleave.roundabout.autoplay",function(){d.startAutoplay.apply(b)}),h.enableDrag&&(a.isFunction(b.drag)?a.isFunction(b.drop)?b.drag(function(a,c){var e=b.data("roundabout"),f=e.dragAxis.toLowerCase()==="x"?"deltaX":"deltaY";d.stopAnimation.apply(b),d.setBearing.apply(b,[e.dragBearing+c[f]/e.dragFactor])}).drop(function(a){var c=b.data("roundabout"),e=d.getAnimateToMethod(c.dropAnimateTo);d.allowAnimation.apply(b),d[e].apply(b,[c.dropDuration,c.dropEasing,c.dropCallback]),c.dragBearing=c.period*d.getNearestChild.apply(b)}):h.debug&&alert("You do not have the drop plugin loaded."):h.debug&&alert("You do not have the drag plugin loaded."),b.each(function(){var b=a(this).get(0),c=a(this).data("roundabout"),e=c.dragAxis.toLowerCase()==="x"?"pageX":"pageY",f=d.getAnimateToMethod(c.dropAnimateTo);b.addEventListener&&(b.addEventListener("touchstart",function(a){c.touchMoveStartPosition=a.touches[0][e]},!1),b.addEventListener("touchmove",function(b){var f=(b.touches[0][e]-c.touchMoveStartPosition)/c.dragFactor;b.preventDefault(),d.stopAnimation.apply(a(this)),d.setBearing.apply(a(this),[c.dragBearing+f])},!1),b.addEventListener("touchend",function(b){b.preventDefault(),d.allowAnimation.apply(a(this)),f=d.getAnimateToMethod(c.dropAnimateTo),d[f].apply(a(this),[c.dropDuration,c.dropEasing,c.dropCallback]),c.dragBearing=c.period*d.getNearestChild.apply(a(this))},!1))})),d.initChildren.apply(b,[f,g])})},initChildren:function(b,c){var e=a(this),f=e.data("roundabout");return b=b||function(){},e.children(f.childSelector).each(function(b){var f,g,h,i=d.getPlacement.apply(e,[b]);c&&a(this).data("roundabout")&&(f=a(this).data("roundabout").startWidth,g=a(this).data("roundabout").startHeight,h=a(this).data("roundabout").startFontSize),a(this).addClass("roundabout-moveable-item").css("position","absolute"),a(this).data("roundabout",{startWidth:f||a(this).width(),startHeight:g||a(this).height(),startFontSize:h||parseInt(a(this).css("font-size"),10),degrees:i,backDegrees:d.normalize.apply(null,[i-180]),childNumber:b,currentScale:1,parent:e})}),d.updateChildren.apply(e),f.autoplay&&(f.autoplayStartTimeout=setTimeout(function(){d.startAutoplay.apply(e)},f.autoplayInitialDelay)),e.trigger("ready"),b.apply(e),e},updateChildren:function(){return this.each(function(){var b=a(this),c=b.data("roundabout"),e=-1,f={bearing:c.bearing,tilt:c.tilt,stage:{width:Math.floor(a(this).width()*.9),height:Math.floor(a(this).height()*.9)},animating:c.animating,inFocus:c.childInFocus,focusBearingRadian:d.degToRad.apply(null,[c.focusBearing]),shape:a.roundaboutShapes[c.shape]||a.roundaboutShapes[a.roundaboutShapes.def]};f.midStage={width:f.stage.width/2,height:f.stage.height/2},f.nudge={width:f.midStage.width+f.stage.width*.05,height:f.midStage.height+f.stage.height*.05},f.zValues={min:c.minZ,max:c.maxZ,diff:c.maxZ-c.minZ},f.opacity={min:c.minOpacity,max:c.maxOpacity,diff:c.maxOpacity-c.minOpacity},f.scale={min:c.minScale,max:c.maxScale,diff:c.maxScale-c.minScale},b.children(c.childSelector).each(function(g){d.updateChild.apply(b,[a(this),f,g,function(){a(this).trigger("ready")}])&&(!f.animating||c.lastAnimationStep)?(e=g,a(this).addClass("roundabout-in-focus")):a(this).removeClass("roundabout-in-focus")}),e!==f.inFocus&&(c.triggerBlurEvents&&b.children(c.childSelector).eq(f.inFocus).trigger("blur"),c.childInFocus=e,c.triggerFocusEvents&&e!==-1&&b.children(c.childSelector).eq(e).trigger("focus")),b.trigger("childrenUpdated")})},updateChild:function(b,c,e,f){var g,h=this,i=a(b),j=i.data("roundabout"),k=[],l=d.degToRad.apply(null,[360-j.degrees+c.bearing]);return f=f||function(){},l=d.normalizeRad.apply(null,[l]),g=c.shape(l,c.focusBearingRadian,c.tilt),g.scale=g.scale>1?1:g.scale,g.adjustedScale=(c.scale.min+c.scale.diff*g.scale).toFixed(4),g.width=(g.adjustedScale*j.startWidth).toFixed(4),g.height=(g.adjustedScale*j.startHeight).toFixed(4),i.css({left:(g.x*c.midStage.width+c.nudge.width-g.width/2).toFixed(0)+"px",top:(g.y*c.midStage.height+c.nudge.height-g.height/2).toFixed(0)+"px",width:g.width+"px",height:g.height+"px",opacity:(c.opacity.min+c.opacity.diff*g.scale).toFixed(2),zIndex:Math.round(c.zValues.min+c.zValues.diff*g.z),fontSize:(g.adjustedScale*j.startFontSize).toFixed(1)+"px"}),j.currentScale=g.adjustedScale,h.data("roundabout").debug&&(k.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+i.css("width")+'; background-color: #ffc;">'),k.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+e+"</strong><br />"),k.push("<strong>left:</strong> "+i.css("left")+"<br />"),k.push("<strong>top:</strong> "+i.css("top")+"<br />"),k.push("<strong>width:</strong> "+i.css("width")+"<br />"),k.push("<strong>opacity:</strong> "+i.css("opacity")+"<br />"),k.push("<strong>height:</strong> "+i.css("height")+"<br />"),k.push("<strong>z-index:</strong> "+i.css("z-index")+"<br />"),k.push("<strong>font-size:</strong> "+i.css("font-size")+"<br />"),k.push("<strong>scale:</strong> "+i.data("roundabout").currentScale),k.push("</div>"),i.html(k.join(""))),i.trigger("reposition"),f.apply(h),d.isInFocus.apply(h,[j.degrees])},setBearing:function(b,c){return c=c||function(){},b=d.normalize.apply(null,[b]),this.each(function(){var c,e,f,g=a(this),h=g.data("roundabout"),i=h.bearing;h.bearing=b,g.trigger("bearingSet"),d.updateChildren.apply(g),c=Math.abs(i-b);if(!h.animating||c>180)return;c=Math.abs(i-b),g.children(h.childSelector).each(function(c){var e;d.isChildBackDegreesBetween.apply(a(this),[b,i])&&(e=i>b?"Clockwise":"Counterclockwise",a(this).trigger("move"+e+"ThroughBack"))})}),c.apply(this),this},adjustBearing:function(b,c){return c=c||function(){},b===0?this:(this.each(function(){d.setBearing.apply(a(this),[a(this).data("roundabout").bearing+b])}),c.apply(this),this)},setTilt:function(b,c){return c=c||function(){},this.each(function(){a(this).data("roundabout").tilt=b,d.updateChildren.apply(a(this))}),c.apply(this),this},adjustTilt:function(b,c){return c=c||function(){},this.each(function(){d.setTilt.apply(a(this),[a(this).data("roundabout").tilt+b])}),c.apply(this),this},animateToBearing:function(b,c,e,f,g){var h=(new Date).getTime();return g=g||function(){},a.isFunction(f)?(g=f,f=null):a.isFunction(e)?(g=e,e=null):a.isFunction(c)&&(g=c,c=null),this.each(function(){var i,j,k,l=a(this),m=l.data("roundabout"),n=c?c:m.duration,o=e?e:m.easing||"swing";f||(f={timerStart:h,start:m.bearing,totalTime:n}),i=h-f.timerStart;if(m.stopAnimation){d.allowAnimation.apply(l),m.animating=!1;return}i<n?(m.animating||l.trigger("animationStart"),m.animating=!0,typeof a.easing.def=="string"?(j=a.easing[o]||a.easing[a.easing.def],k=j(null,i,f.start,b-f.start,f.totalTime)):k=a.easing[o](i/f.totalTime,i,f.start,b-f.start,f.totalTime),k=d.normalize.apply(null,[k]),m.dragBearing=k,d.setBearing.apply(l,[k,function(){setTimeout(function(){d.animateToBearing.apply(l,[b,n,o,f,g])},0)}])):(m.lastAnimationStep=!0,b=d.normalize.apply(null,[b]),d.setBearing.apply(l,[b,function(){l.trigger("animationEnd")}]),m.animating=!1,m.lastAnimationStep=!1,m.dragBearing=b,g.apply(l))}),this},animateToNearbyChild:function(b,c){var e=b[0],f=b[1],g=b[2]||function(){};return a.isFunction(f)?(g=f,f=null):a.isFunction(e)&&(g=e,e=null),this.each(function(){var b,h,i=a(this),j=i.data("roundabout"),k=j.reflect?j.bearing:j.bearing%360,l=i.children(j.childSelector).length;if(!j.animating)if(j.reflect&&c==="previous"||!j.reflect&&c==="next"){k=Math.abs(k)<j.floatComparisonThreshold?360:k;for(b=0;b<l;b+=1){h={lower:j.period*b,upper:j.period*(b+1)},h.upper=b===l-1?360:h.upper;if(k<=Math.ceil(h.upper)&&k>=Math.floor(h.lower)){l===2&&k===360?d.animateToDelta.apply(i,[-180,e,f,g]):d.animateBearingToFocus.apply(i,[h.lower,e,f,g]);break}}}else{k=Math.abs(k)<j.floatComparisonThreshold||360-Math.abs(k)<j.floatComparisonThreshold?0:k;for(b=l-1;b>=0;b-=1){h={lower:j.period*b,upper:j.period*(b+1)},h.upper=b===l-1?360:h.upper;if(k>=Math.floor(h.lower)&&k<Math.ceil(h.upper)){l===2&&k===360?d.animateToDelta.apply(i,[180,e,f,g]):d.animateBearingToFocus.apply(i,[h.upper,e,f,g]);break}}}})},animateToNearestChild:function(b,c,e){return e=e||function(){},a.isFunction(c)?(e=c,c=null):a.isFunction(b)&&(e=b,b=null),this.each(function(){var f=d.getNearestChild.apply(a(this));d.animateToChild.apply(a(this),[f,b,c,e])})},animateToChild:function(b,c,e,f){return f=f||function(){},a.isFunction(e)?(f=e,e=null):a.isFunction(c)&&(f=c,c=null),this.each(function(){var g,h=a(this),i=h.data("roundabout");i.childInFocus!==b&&!i.animating&&(g=h.children(i.childSelector).eq(b),d.animateBearingToFocus.apply(h,[g.data("roundabout").degrees,c,e,f]))})},animateToNextChild:function(a,b,c){return d.animateToNearbyChild.apply(this,[arguments,"next"])},animateToPreviousChild:function(a,b,c){return d.animateToNearbyChild.apply(this,[arguments,"previous"])},animateToDelta:function(b,c,e,f){return f=f||function(){},a.isFunction(e)?(f=e,e=null):a.isFunction(c)&&(f=c,c=null),this.each(function(){var g=a(this).data("roundabout").bearing+b;d.animateToBearing.apply(a(this),[g,c,e,f])})},animateBearingToFocus:function(b,c,e,f){return f=f||function(){},a.isFunction(e)?(f=e,e=null):a.isFunction(c)&&(f=c,c=null),this.each(function(){var g=a(this).data("roundabout").bearing-b;g=Math.abs(360-g)<Math.abs(g)?360-g:-g,g=g>180?-(360-g):g,g!==0&&d.animateToDelta.apply(a(this),[g,c,e,f])})},stopAnimation:function(){return this.each(function(){a(this).data("roundabout").stopAnimation=!0})},allowAnimation:function(){return this.each(function(){a(this).data("roundabout").stopAnimation=!1})},startAutoplay:function(b){return this.each(function(){var c=a(this),e=c.data("roundabout");b=b||e.autoplayCallback||function(){},clearInterval(e.autoplayInterval),e.autoplayInterval=setInterval(function(){d.animateToNextChild.apply(c,[b])},e.autoplayDuration),e.autoplayIsRunning=!0,c.trigger("autoplayStart")})},stopAutoplay:function(b){return this.each(function(){clearInterval(a(this).data("roundabout").autoplayInterval),a(this).data("roundabout").autoplayInterval=null,a(this).data("roundabout").autoplayIsRunning=!1,b||a(this).unbind(".autoplay"),a(this).trigger("autoplayStop")})},toggleAutoplay:function(b){return this.each(function(){var c=a(this),e=c.data("roundabout");b=b||e.autoplayCallback||function(){},d.isAutoplaying.apply(a(this))?d.stopAutoplay.apply(a(this),[b]):d.startAutoplay.apply(a(this),[b])})},isAutoplaying:function(){return this.data("roundabout").autoplayIsRunning},changeAutoplayDuration:function(b){return this.each(function(){var c=a(this),e=c.data("roundabout");e.autoplayDuration=b,d.isAutoplaying.apply(c)&&(d.stopAutoplay.apply(c),setTimeout(function(){d.startAutoplay.apply(c)},10))})},normalize:function(a){var b=a%360;return b<0?360+b:b},normalizeRad:function(a){while(a<0)a+=Math.PI*2;while(a>Math.PI*2)a-=Math.PI*2;return a},isChildBackDegreesBetween:function(b,c){var d=a(this).data("roundabout").backDegrees;return b>c?d>=c&&d<b:d<c&&d>=b},getAnimateToMethod:function(a){return a=a.toLowerCase(),a==="next"?"animateToNextChild":a==="previous"?"animateToPreviousChild":"animateToNearestChild"},relayoutChildren:function(){return this.each(function(){var b=a(this),c=a.extend({},b.data("roundabout"));c.startingChild=b.data("roundabout").childInFocus,d.init.apply(b,[c,null,!0])})},getNearestChild:function(){var b=a(this),c=b.data("roundabout"),d=b.children(c.childSelector).length;return c.reflect?Math.round(c.bearing/c.period)%d:(d-Math.round(c.bearing/c.period)%d)%d},degToRad:function(a){return d.normalize.apply(null,[a])*Math.PI/180},getPlacement:function(a){var b=this.data("roundabout");return b.reflect?b.period*a:360-b.period*a},isInFocus:function(a){var b,c=this,e=c.data("roundabout"),f=d.normalize.apply(null,[e.bearing]);return a=d.normalize.apply(null,[a]),b=Math.abs(f-a),b<=e.floatComparisonThreshold||b>=360-e.floatComparisonThreshold},getChildInFocus:function(){var b=a(this).data("roundabout");return b.childInFocus>-1?b.childInFocus:!1}},a.fn.roundabout=function(b){if(d[b])return d[b].apply(this,Array.prototype.slice.call(arguments,1));if(typeof b=="object"||a.isFunction(b)||!b)return d.init.apply(this,arguments);a.error("Method "+b+" does not exist for jQuery.roundabout.")}}(jQuery),function(a){function c(a){return typeof a=="object"?a:{top:a,left:a}}var b=a.scrollTo=function(b,c,e){a(window).scrollTo(b,c,e)};b.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1},b.window=function(b){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!c)return b;var e=(b.contentWindow||b).document||b.ownerDocument||b;return a.browser.safari||e.compatMode=="BackCompat"?e.body:e.documentElement})},a.fn.scrollTo=function(e,f,g){return typeof f=="object"&&(g=f,f=0),typeof g=="function"&&(g={onAfter:g}),e=="max"&&(e=9e9),g=a.extend({},b.defaults,g),f=f||g.speed||g.duration,g.queue=g.queue&&g.axis.length>1,g.queue&&(f/=2),g.offset=c(g.offset),g.over=c(g.over),this._scrollable().each(function(){function r(a){i.animate(o,f,g.easing,a&&function(){a.call(this,e,g)})}var h=this,i=a(h),l=e,m,o={},q=i.is("html,body");switch(typeof l){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(l)){l=c(l);break}l=a(l,this);case"object":if(l.is||l.style)m=(l=a(l)).offset()}a.each(g.axis.split(""),function(a,c){var d=c=="x"?"Left":"Top",e=d.toLowerCase(),f="scroll"+d,j=h[f],n=b.max(h,c);if(m)o[f]=m[e]+(q?0:j-i.offset()[e]),g.margin&&(o[f]-=parseInt(l.css("margin"+d))||0,o[f]-=parseInt(l.css("border"+d+"Width"))||0),o[f]+=g.offset[e]||0,g.over[e]&&(o[f]+=l[c=="x"?"width":"height"]()*g.over[e]);else{var p=l[e];o[f]=p.slice&&p.slice(-1)=="%"?parseFloat(p)/100*n:p}/^\d+$/.test(o[f])&&(o[f]=o[f]<=0?0:Math.min(o[f],n)),!a&&g.queue&&(j!=o[f]&&r(g.onAfterFirst),delete o[f])}),r(g.onAfter)}).end()},b.max=function(b,c){var e=c=="x"?"Width":"Height",f="scroll"+e;if(!a(b).is("html,body"))return b[f]-a(b)[e.toLowerCase()]();var g="client"+e,h=b.ownerDocument.documentElement,i=b.ownerDocument.body;return Math.max(h[f],i[f])-Math.min(h[g],i[g])}}(jQuery),function(a){function b(b){var c=b.data.selected,d=b.data.options,e=navigator.userAgent.toLowerCase().indexOf("mobile")>0,f=a(window).height(),g=c.outerHeight(!0),h=a(document
).scrollTop();if(!e&&h<=a(document).height()-f&&h>c.offset().top-d.topPadding){var i=0;d.topPadding!="undefined"&&(i+=d.topPadding);var j=c.offset().left;c.data("PanelsTop",c.offset().top-i);if(d.savePanelSpace==1){var k=c.outerWidth(!0),l=c.css("float"),m=c.css("display"),n=Math.ceil(Math.random()*9999);c.data("PanelSpaceID","stickyPanelSpace"+n),c.before("<div id='"+c.data("PanelSpaceID")+"' style='width:"+k+"px;height:"+g+"px;float:"+l+";display:"+m+";'>&nbsp;</div>")}d.afterDetachCSSClass!=""&&c.addClass(d.afterDetachCSSClass),c.data("Original_Inline_CSS",c.attr("style")?c.attr("style"):""),c.css({margin:0,left:j,top:i,position:"fixed"})}h<=c.data("PanelsTop")&&c.css("top")!="auto"&&(d.savePanelSpace==1&&a("#"+c.data("PanelSpaceID")).remove(),c.attr("style",c.data("Original_Inline_CSS")),d.afterDetachCSSClass!=""&&c.removeClass(d.afterDetachCSSClass))}a.fn.stickyPanel=function(c){var c=a.extend({},a.fn.stickyPanel.defaults,c);return this.each(function(){a(window).bind("scroll.stickyPanel",{selected:a(this),options:c},b)})},a.fn.stickyPanel.defaults={topPadding:0,afterDetachCSSClass:"",savePanelSpace:!1}}(jQuery),function(){function a(b,c,d){if(b===c)return 0!==b||1/b==1/c;if(null==b||null==c)return b===c;b._chain&&(b=b._wrapped),c._chain&&(c=c._wrapped);if(b.isEqual&&v.isFunction(b.isEqual))return b.isEqual(c);if(c.isEqual&&v.isFunction(c.isEqual))return c.isEqual(b);var e=i.call(b);if(e!=i.call(c))return!1;switch(e){case"[object String]":return b==""+c;case"[object Number]":return b!=+b?c!=+c:0==b?1/b==1/c:b==+c;case"[object Date]":case"[object Boolean]":return+b==+c;case"[object RegExp]":return b.source==c.source&&b.global==c.global&&b.multiline==c.multiline&&b.ignoreCase==c.ignoreCase}if("object"!=typeof b||"object"!=typeof c)return!1;for(var f=d.length;f--;)if(d[f]==b)return!0;d.push(b);var f=0,g=!0;if("[object Array]"==e){if(f=b.length,g=f==c.length)for(;f--&&(g=f in b==f in c&&a(b[f],c[f],d)););}else{if("constructor"in b!="constructor"in c||b.constructor!=c.constructor)return!1;for(var h in b)if(v.has(b,h)&&(f++,!(g=v.has(c,h)&&a(b[h],c[h],d))))break;if(g){for(h in c)if(v.has(c,h)&&!(f--))break;g=!f}}return d.pop(),g}var b=this,c=b._,d={},e=Array.prototype,f=Object.prototype,g=e.slice,h=e.unshift,i=f.toString,j=f.hasOwnProperty,k=e.forEach,l=e.map,m=e.reduce,n=e.reduceRight,o=e.filter,p=e.every,q=e.some,r=e.indexOf,s=e.lastIndexOf,f=Array.isArray,t=Object.keys,u=Function.prototype.bind,v=function(a){return new G(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=v),exports._=v):b._=v,v.VERSION="1.3.3";var w=v.each=v.forEach=function(a,b,c){if(a!=null)if(k&&a.forEach===k)a.forEach(b,c);else if(a.length===+a.length){for(var e=0,f=a.length;e<f;e++)if(e in a&&b.call(c,a[e],e,a)===d)break}else for(e in a)if(v.has(a,e)&&b.call(c,a[e],e,a)===d)break};v.map=v.collect=function(a,b,c){var d=[];return a==null?d:l&&a.map===l?a.map(b,c):(w(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d)},v.reduce=v.foldl=v.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(m&&a.reduce===m)return d&&(b=v.bind(b,d)),e?a.reduce(b,c):a.reduce(b);w(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},v.reduceRight=v.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(n&&a.reduceRight===n)return d&&(b=v.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=v.toArray(a).reverse();return d&&!e&&(b=v.bind(b,d)),e?v.reduce(f,b,c,d):v.reduce(f,b)},v.find=v.detect=function(a,b,c){var d;return x(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},v.filter=v.select=function(a,b,c){var d=[];return a==null?d:o&&a.filter===o?a.filter(b,c):(w(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},v.reject=function(a,b,c){var d=[];return a==null?d:(w(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},v.every=v.all=function(a,b,c){var e=!0;return a==null?e:p&&a.every===p?a.every(b,c):(w(a,function(a,f,g){if(!(e=e&&b.call(c,a,f,g)))return d}),!!e)};var x=v.some=v.any=function(a,b,c){b||(b=v.identity);var e=!1;return a==null?e:q&&a.some===q?a.some(b,c):(w(a,function(a,f,g){if(e||(e=b.call(c,a,f,g)))return d}),!!e)};v.include=v.contains=function(a,b){var c=!1;return a==null?c:r&&a.indexOf===r?a.indexOf(b)!=-1:c=x(a,function(a){return a===b})},v.invoke=function(a,b){var c=g.call(arguments,2);return v.map(a,function(a){return(v.isFunction(b)?b||a:a[b]).apply(a,c)})},v.pluck=function(a,b){return v.map(a,function(a){return a[b]})},v.max=function(a,b,c){if(!b&&v.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!b&&v.isEmpty(a))return-Infinity;var d={computed:-Infinity};return w(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e>=d.computed&&(d={value:a,computed:e})}),d.value},v.min=function(a,b,c){if(!b&&v.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!b&&v.isEmpty(a))return Infinity;var d={computed:Infinity};return w(a,function(a,e,f){e=b?b.call(c,a,e,f):a,e<d.computed&&(d={value:a,computed:e})}),d.value},v.shuffle=function(a){var b=[],c;return w(a,function(a,d){c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a}),b},v.sortBy=function(a,b,c){var d=v.isFunction(b)?b:function(a){return a[b]};return v.pluck(v.map(a,function(a,b,e){return{value:a,criteria:d.call(c,a,b,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c===void 0?1:d===void 0?-1:c<d?-1:c>d?1:0}),"value")},v.groupBy=function(a,b){var c={},d=v.isFunction(b)?b:function(a){return a[b]};return w(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},v.sortedIndex=function(a,b,c){c||(c=v.identity);for(var d=0,e=a.length;d<e;){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},v.toArray=function(a){return a?v.isArray(a)||v.isArguments(a)?g.call(a):a.toArray&&v.isFunction(a.toArray)?a.toArray():v.values(a):[]},v.size=function(a){return v.isArray(a)?a.length:v.keys(a).length},v.first=v.head=v.take=function(a,b,c){return b!=null&&!c?g.call(a,0,b):a[0]},v.initial=function(a,b,c){return g.call(a,0,a.length-(b==null||c?1:b))},v.last=function(a,b,c){return b!=null&&!c?g.call(a,Math.max(a.length-b,0)):a[a.length-1]},v.rest=v.tail=function(a,b,c){return g.call(a,b==null||c?1:b)},v.compact=function(a){return v.filter(a,function(a){return!!a})},v.flatten=function(a,b){return v.reduce(a,function(a,c){return v.isArray(c)?a.concat(b?c:v.flatten(c)):(a[a.length]=c,a)},[])},v.without=function(a){return v.difference(a,g.call(arguments,1))},v.uniq=v.unique=function(a,b,c){var c=c?v.map(a,c):a,d=[];return a.length<3&&(b=!0),v.reduce(c,function(c,e,f){if(b?v.last(c)!==e||!c.length:!v.include(c,e))c.push(e),d.push(a[f]);return c},[]),d},v.union=function(){return v.uniq(v.flatten(arguments,!0))},v.intersection=v.intersect=function(a){var b=g.call(arguments,1);return v.filter(v.uniq(a),function(a){return v.every(b,function(b){return v.indexOf(b,a)>=0})})},v.difference=function(a){var b=v.flatten(g.call(arguments,1),!0);return v.filter(a,function(a){return!v.include(b,a)})},v.zip=function(){for(var a=g.call(arguments),b=v.max(v.pluck(a,"length")),c=Array(b),d=0;d<b;d++)c[d]=v.pluck(a,""+d);return c},v.indexOf=function(a,b,c){if(a==null)return-1;var d;if(c)return c=v.sortedIndex(a,b),a[c]===b?c:-1;if(r&&a.indexOf===r)return a.indexOf(b);c=0;for(d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1},v.lastIndexOf=function(a,b){if(a==null)return-1;if(s&&a.lastIndexOf===s)return a.lastIndexOf(b);for(var c=a.length;c--;)if(c in a&&a[c]===b)return c;return-1},v.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0);for(var c=arguments[2]||1,d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);e<d;)f[e++]=a,a+=c;return f};var y=function(){};v.bind=function(a,b){var c,d;if(a.bind===u&&u)return u.apply(a,g.call(arguments,1));if(!v.isFunction(a))throw new TypeError;return d=g.call(arguments,2),c=function(){if(this instanceof c){y.prototype=a.prototype;var e=new y,f=a.apply(e,d.concat(g.call(arguments)));return Object(f)===f?f:e}return a.apply(b,d.concat(g.call(arguments)))}},v.bindAll=function(a){var b=g.call(arguments,1);return b.length==0&&(b=v.functions(a)),w(b,function(b){a[b]=v.bind(a[b],a)}),a},v.memoize=function(a,b){var c={};return b||(b=v.identity),function(){var d=b.apply(this,arguments);return v.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},v.delay=function(a,b){var c=g.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},v.defer=function(a){return v.delay.apply(v,[a,1].concat(g.call(arguments,1)))},v.throttle=function(a,b){var c,d,e,f,g,h,i=v.debounce(function(){g=f=!1},b);return function(){return c=this,d=arguments,e||(e=setTimeout(function(){e=null,g&&a.apply(c,d),i()},b)),f?g=!0:h=a.apply(c,d),i(),f=!0,h}},v.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments;c&&!d&&a.apply(e,f),clearTimeout(d),d=setTimeout(function(){d=null,c||a.apply(e,f)},b)}},v.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},v.wrap=function(a,b){return function(){var c=[a].concat(g.call(arguments,0));return b.apply(this,c)}},v.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},v.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},v.keys=t||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],c;for(c in a)v.has(a,c)&&(b[b.length]=c);return b},v.values=function(a){return v.map(a,v.identity)},v.functions=v.methods=function(a){var b=[],c;for(c in a)v.isFunction(a[c])&&b.push(c);return b.sort()},v.extend=function(a){return w(g.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},v.pick=function(a){var b={};return w(v.flatten(g.call(arguments,1)),function(c){c in a&&(b[c]=a[c])}),b},v.defaults=function(a){return w(g.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},v.clone=function(a){return v.isObject(a)?v.isArray(a)?a.slice():v.extend({},a):a},v.tap=function(a,b){return b(a),a},v.isEqual=function(b,c){return a(b,c,[])},v.isEmpty=function(a){if(a==null)return!0;if(v.isArray(a)||v.isString(a))return a.length===0;for(var b in a)if(v.has(a,b))return!1;return!0},v.isElement=function(a){return!!a&&a.nodeType==1},v.isArray=f||function(a){return i.call(a)=="[object Array]"},v.isObject=function(a){return a===Object(a)},v.isArguments=function(a){return i.call(a)=="[object Arguments]"},v.isArguments(arguments)||(v.isArguments=function(a){return!!a&&!!v.has(a,"callee")}),v.isFunction=function(a){return i.call(a)=="[object Function]"},v.isString=function(a){return i.call(a)=="[object String]"},v.isNumber=function(a){return i.call(a)=="[object Number]"},v.isFinite=function(a){return v.isNumber(a)&&isFinite(a)},v.isNaN=function(a){return a!==a},v.isBoolean=function(a){return a===!0||a===!1||i.call(a)=="[object Boolean]"},v.isDate=function(a){return i.call(a)=="[object Date]"},v.isRegExp=function(a){return i.call(a)=="[object RegExp]"},v.isNull=function(a){return a===null},v.isUndefined=function(a){return a===void 0},v.has=function(a,b){return j.call(a,b)},v.noConflict=function(){return b._=c,this},v.identity=function(a){return a},v.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},v.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},v.result=function(a,b){if(a==null)return null;var c=a[b];return v.isFunction(c)?c.call(a):c},v.mixin=function(a){w(v.functions(a),function(b){I(b,v[b]=a[b])})};var z=0;v.uniqueId=function(a){var b=z++;return a?a+b:b},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/.^/,B={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},C;for(C in B)B[B[C]]=C;var D=/\\|'|\r|\n|\t|\u2028|\u2029/g,E=/\\(\\|'|r|n|t|u2028|u2029)/g,F=function(a){return a.replace(E,function(a,b){return B[b]})};v.template=function(a,b,c){c=v.defaults(c||{},v.templateSettings),a="__p+='"+a.replace(D,function(a){return"\\"+B[a]}).replace(c.escape||A,function(a,b){return"'+\n_.escape("+F(b)+")+\n'"}).replace(c.interpolate||A,function(a,b){return"'+\n("+F(b)+")+\n'"}).replace(c.evaluate||A,function(a,b){return"';\n"+F(b)+"\n;__p+='"})+"';\n",c.variable||(a="with(obj||{}){\n"+a+"}\n");var a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n",d=new Function(c.variable||"obj","_",a);return b?d(b,v):(b=function(a){return d.call(this,a,v)},b.source="function("+(c.variable||"obj")+"){\n"+a+"}",b)},v.chain=function(a){return v(a).chain()};var G=function(a){this._wrapped=a};v.prototype=G.prototype;var H=function(a,b){return b?v(a).chain():a},I=function(a,b){G.prototype[a]=function(){var a=g.call(arguments);return h.call(a,this._wrapped),H(b.apply(v,a),this._chain)}};v.mixin(v),w("pop,push,reverse,shift,sort,splice,unshift".split(","),function(a){var b=e[a];G.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;return(a=="shift"||a=="splice")&&d===0&&delete c[0],H(c,this._chain)}}),w(["concat","join","slice"],function(a){var b=e[a];G.prototype[a]=function(){return H(b.apply(this._wrapped,arguments),this._chain)}}),G.prototype.chain=function(){return this._chain=!0,this},G.prototype.value=function(){return this._wrapped}}.call(this),px=function(){},px.signed_in===undefined&&(px.signed_in=null),px.active_user===undefined&&(px.active_user=null),px.site_url=function(a,b){var c=window.location.protocol,d=c+"//"+window.location.host,e=b?b:d,a=a?a:"/";return e+a},px.addGear=function(a){a=="camera"?(newcamera='<li class="type-camera"><input name="camera[][id]" type="hidden" />',newcamera+='<input type="text" name="camera[][name]" class="small"></li>',$("#gearlist").append(newcamera)):a=="lens"?(newlens='<li class="type-lens"><input type="hidden" name="lens[][id]" value="">',newlens+='<input type="text" name="lens[][name]" class="small"></li>',$("#gearlist").append(newlens)):a=="misc"&&(misc='<li class="type-misc"><input type="hidden" name="misc[][id]" value="">',misc+='<input type="text" name="misc[][name]" class="small"></li>',$("#gearlist").append(misc))},px.slideMap=function(){$("#map_dropdown").css("visibility")=="hidden"?$("#map_dropdown").css("visibility","visible"):$("#map_dropdown").slideToggle("fast")},px.setLoginRedirect=function(){var a=$.getUrlVar("r");$("#login_redirect").val(a)},$.fn.textWidth=function(){var a=$(this).html(),b="<span>"+a+"</span>";$(this).html(b);var c=$(this).find("span:first").width();return $(this).html(a),c},px.upgradeShowTab=function(a){$("#detailsContainer").css("min-height","300px"),$("#detailsContainer").css("height","auto !important;"),$("#comparison_header, #highlights_header").toggleClass("active"),a=="highlights"?($("#comparison").fadeOut("fast"),$("#gallery").fadeOut("fast"),window.setTimeout(function(){$("#"+a).fadeIn(700)},200)):a=="comparison"?($("#highlights").fadeOut("fast"),$("#gallery").fadeOut("fast"),window.setTimeout(function(){$("#"+a).fadeIn(700)},200)):a=="gallery"&&($("#highlights").fadeOut("fast"),$("#comparison").fadeOut("fast"),window.setTimeout(function(){$("#"+a).fadeIn(700)},200))},px.toggleNSFW=function(){$.ajax({type:"POST",url:"/settings/site",data:{nsfw:"nsfw"},context:document.body,success:function(){$("#user_photo").attr("src","/graphics/userpic.png")}})},px.deleteUserPhoto=function(){$.ajax({type:"POST",url:"/settings/deleteuserphoto",context:document.body,success:function(){$("#user_photo").attr("src","/graphics/userpic.png")}})},px.deleteAccount=function(a){var b=confirm("Are you sure? This cannot be undone.");if(b)$("form#delete_account").submit();else return alert("Ok, we will not delete your account."),!1},px.shareVoteFB=function(){try{FB.getLoginStatus(function(a){!a.authResponse})}catch(a){window.location=redirect}},px.getId=function(a,b){var c=a.substr(a.lastIndexOf("_")+1);return b===!0&&(c=parseInt(c)),c},px.datepicker=function(a,b){$(a).datepicker({showAnim:"fadeIn",dateFormat:"MM d, yy",altField:b,altFormat:"yy-mm-dd 12:00:00",maxDate:new Date}),$(a).change(function(){($(this).val()==""||!$(this).val())&&$(b).val("")})},$.extend({getUrlVars:function(){var a=[],b,c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var d=0;d<c.length;d++)b=c[d].split("="),a.push(b[0]),a[b[0]]=b[1];return a},getUrlVar:function(a){return $.getUrlVars()[a]}}),$(function(a){var b=function(b){var c=a("#copyright"),d,e,f;if(b.pageX==null){var g=document.documentElement&&document.documentElement.scrollLeft!=null?document.documentElement:document.body;e=b.clientX+g.scrollLeft,f=b.clientY+g.scrollTop}else e=b.pageX,f=b.pageY;return c.data("timeout")&&clearTimeout(c.data("timeout")),c.css({position:"absolute",top:f,left:e,"z-index":"1000"}).data("timeout",setTimeout(function(){a("#copyright").fadeOut("fast")},1800)).effect("pulsate",{times:2},50),b.preventDefault(),!1};a("div#thephoto a, .post_entry_photo img, .post_entry_div_img img, .image img, .item-image img, .invoice-single-photo img").live("contextmenu",b),a("div#thephoto a").live("click",function(a){return a.stopPropagation?a.stopPropagation():a.preventDefault?a.preventDefault():a.returnValue=!1,!1}),a("#fave_link").bind("click",function(){a("#fave_link .newfave").removeClass("faved"),a("#fave_link .newfave").removeClass("unpressed"),a("#fave_link .newfave").addClass("loading")}),a("#thephoto a").click(function(b){b.preventDefault();var c=function(){a("#thephoto").removeClass("active"),a("#mainphoto").attr("src",a("#mainphoto").attr("data-src")),a("#lightbox").remove()};if(a("#lightbox").length>0)return c(),!1;a("#thephoto").addClass("active"),a("#mainphoto").attr("src",a(this).attr("href")),a("body").append('<div id="lightbox"></div>'),a("#lightbox").css({overflow:"auto"}).click(function(){c()})})}),px.validateURL=function(a){var b=/(?:[\w-]+\.)+[a-z]{2,6}$/i;return b.test(a)},px.validateDomain=function(a){return a==""||px.validateURL(a)===!0?!0:(px.messages.create({type:"error",message:"Please enter a valid URL"}),!1)},px.are_cookies_enabled=function(){if(navigator.cookieEnabled===!1)return!1;document.cookie="cookies_are_enabled=1";var a=document.cookie.split(/\s*;\s*/),b;while(b=a.shift()){var c=b.split("=");if(c[0]=="cookies_are_enabled")return!0}return!1},px.valid_email=function(a){return!!a.match(/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i)},px.error=function(a){px.messages.create({type:"error",message:a})},$('div.button,button.button,input.button,a,img[src^="http://cdn.500px.net/"],img[src^="http://s3.amazonaws.com/"], .entry-body img').live("dragstart",function(a){this.tagName=="A"&&$(this).hasClass("button")||this.tagName=="BUTTON"||this.tagName=="INPUT"||this.tagName=="DIV"||this.tagName=="IMG"?a.preventDefault():this.tagName=="A"&&$(this).children("button.button,input.button")?a.preventDefault():$(this).children('img[src^="http://cdn.500px.net/"],img[src^="http://s3.amazonaws.com/"]').length>0&&a.preventDefault()}),function(a){a.extend({getGo:function(b,c){document.location=b+"?"+a.param(c)},postGo:function(b,c){var d=a("<form>").attr("method","post").attr("action",b);a.each(c,function(b,c){a("<input type='hidden'>").attr("name",b).attr("value",c).appendTo(d)}),d.appendTo("body"),d.submit()}})}(jQuery),function(a){$.fn.clone=function(){var b=a.apply(this,arguments),c=this.find("textarea"),d=b.find("textarea");for(var e=0,f=c.length;e<f;++e)$(d[e]).val($(c[e]).val());return b}}($.fn.clone),$(function(){jQuery.browser.chrome=/chrome/.test(navigator.userAgent.toLowerCase()),jQuery.support.bfCache=function(){return document.body.setAttribute("onpageshow","return;"),!jQuery.browser.chrome&&typeof window.onpageshow=="function"}()}),_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},__http=window.location.protocol=="https:"?"https://":"http://",__uploader_host=__http+"upload.500px.com",$(document).ready(function(){$("#hellobar").delegate("a[data-oauth-provider-login]","oauth:loggedIn",function(){window.location.reload()}).delegate("a[data-oauth-provider-login]","oauth:loginFailure",function(){px.error("There was a problem with your login attempt. Please check your details and try again.")}),$("#hellobar .close_x").live("click",function(){$(this).closest("#hellobar").slideUp("slow",function(){$(this).remove(),$.cookie("fb_bar_closed",!0,{path:"/"})})}),$(".clearafter").after('<div class="clear"></div>'),$(".photo .links").hover(function(){$(this).animate({opacity:"1"},200)},function(){$(this).animate({opacity:"0"},200)}),$("#header .arrow").hover(function(){$(".dropdown",this).stop(!0,!0).fadeIn(200)},function(){$(".dropdown",this).stop(!0,!0).fadeOut(200)}),$("#add").hover(function(){$(".dropdown",this).stop(!0,!0).fadeIn(200)},function(){$(".dropdown",this).stop(!0,!0).fadeOut(200)}),$(".trial-bar .close").click(function(){$(".trial-bar").slideUp("slow",function(){$(this).remove()}),$.get("/dismiss/notifier/trial",function(){$(".trial-bar").remove()})}),$(".trial-bar .learnmore").click(function(){px.lightbox.initialize(function(){var a=$("#awesome-features").clone().show();$("#lightbox_content").width("535px"),$("#lightbox_content").height("436px"),$("#lightbox_content").css("marginTop","100px"),$("#lightbox_content").prepend(a)})}),$(".photo").live("mouseenter",function(){$(".loupe, .rollover",this).fadeIn(200)}).live("mouseleave",function(){$(".loupe, .rollover",this).fadeOut(200)});var a={afterDetachCSSClass:"floated",savePanelSpace:!0};csbDisplayEvent=function(){var a=$("#csb .copy").text(),b=a+" ("+px.uniquePathName+")";typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","Banners","Banner Viewed",b])},csbSignUpEvent=function(){var a=$("#csb .copy").text(),b=a+" ("+px.uniquePathName+")";typeof _gaq!="undefined"&&_gaq.push(["_trackEvent","Banners","Banner Clicked",b])},typeof px.uniquePathName=="undefined"&&(px.uniquePathName=window.location.pathname),$.cookie("context_banner")!==null&&parseInt($.cookie("context_banner"))==0?$("#csb").remove():($("#csb").stickyPanel(a),$("#csb .close_x").click(function(){var a=$("#csb .copy").text(),b=a+" ("+px.uniquePathName+")";_gaq.push(["_trackEvent","Banners","Banner Closed",b]),$("#csb").slideUp(500,function(){$(this).remove()}),$.cookie("context_banner","0")}),$("#csb .copy").length>0&&$("#csb").is(":visible")&&csbDisplayEvent())}),window.pxLocales={photo:{error_saving_vote:"There was a problem recording your vote. Please try again."},registration:{username_taken:"Username has already been taken",avatar_failed:"There was an error reading the avatar you uploaded. Ensure the file is a valid JPEG."},pages:{cookies:{cookies_are_still_not_enabled:"We were still unable to save a cookie in your browser. Please double check that your cookies are enabled."}},settings:{index:{error_cancelling_subscription:"There was a problem communicating with the server. Please try again in a few minutes."}},subscriptions:{unload_guard:"Closing this page might interrupt your upgrade process.",payment_failed:"There was a problem processing your payment: {{error_message}}. Please check your details and try again."},pxForm:{errors:{required:"Required field",too_short:"Must be at least {{min_length}} characters",too_long:"Must be no more than {{max_length}} characters",confirmation:"Doesn't match",credit_card:"Must be a valid credit card number",date_is_past:"Date is past",expired:"Expired",numeric:"Must be a number",phone:"Wrong phone format"}}},window.pxShippingStates={canada:{BC:{name:"British Columbia",shipping:8.99,tax_rate:0,billing_only:!1},YK:{name:"Yukon",shipping:8.99,tax_rate:0,billing_only:!1},NWT:{name:"Northwest Territories",shipping:8.99,tax_rate:0,billing_only:!1},NV:{name:"Nunavut",shipping:8.99,tax_rate:0,billing_only:!1},AB:{name:"Alberta",shipping:8.99,tax_rate:0,billing_only:!1},SK:{name:"Saskatchewan",shipping:8.99,tax_rate:0,billing_only:!1},MN:{name:"Manitoba",shipping:8.99,tax_rate:0,billing_only:!1},ON:{name:"Ontario",shipping:8.99,tax_rate:0,billing_only:!1},QC:{name:"Quebec",shipping:8.99,tax_rate:0,billing_only:!1},NF:{name:"Newfoundland and Labrador",shipping:8.99,tax_rate:0,billing_only:!1},NB:{name:"New Brunswick",shipping:8.99,tax_rate:0,billing_only:!1},PEI:{name:"Prince Edward Island",shipping:8.99,tax_rate:0,billing_only:!1},NS:{name:"Nova Scotia",shipping:8.99,tax_rate:0,billing_only:!1}},united_states:{AL:{name:"Alabama",shipping:8.99,tax_rate:0,billing_only:!1},AK:{name:"Alaska",shipping:38.99,tax_rate:0,billing_only:!1},AZ:{name:"Arizona",shipping:8.99,tax_rate:0,billing_only:!1},AR:{name:"Arkansas",shipping:8.99,tax_rate:0,billing_only:!1},CA:{name:"California",shipping:8.99,tax_rate:0,billing_only:!1},CO:{name:"Colorado",shipping:8.99,tax_rate:0,billing_only:!1},CT:{name:"Connecticut",shipping:8.99,tax_rate:0,billing_only:!1},DE:{name:"Delaware",shipping:8.99,tax_rate:0,billing_only:!1},DC:{name:"District of Columbia",shipping:8.99,tax_rate:0,billing_only:!1},FL:{name:"Florida",shipping:8.99,tax_rate:6,billing_only:!1},GA:{name:"Georgia",shipping:8.99,tax_rate:0,billing_only:!1},HI:{name:"Hawaii",shipping:38.99,tax_rate:0,billing_only:!1},ID:{name:"Idaho",shipping:8.99,tax_rate:0,billing_only:!1},IL:{name:"Illinois",shipping:8.99,tax_rate:0,billing_only:!1},IN:{name:"Indiana",shipping:8.99,tax_rate:0,billing_only:!1},IA:{name:"Iowa",shipping:8.99,tax_rate:0,billing_only:!1},KS:{name:"Kansas",shipping:8.99,tax_rate:0,billing_only:!1},KY:{name:"Kentucky",shipping:8.99,tax_rate:0,billing_only:!1},LA:{name:"Louisiana",shipping:8.99,tax_rate:0,billing_only:!1},ME:{name:"Maine",shipping:8.99,tax_rate:0,billing_only:!1},MD:{name:"Maryland",shipping:8.99,tax_rate:0,billing_only:!1},MA:{name:"Massachusetts",shipping:8.99,tax_rate:0,billing_only:!1},MI:{name:"Michigan",shipping:8.99,tax_rate:0,billing_only:!1},MN:{name:"Minnesota",shipping:8.99,tax_rate:0,billing_only:!1},MS:{name:"Mississippi",shipping:8.99,tax_rate:0,billing_only:!1},MO:{name:"Missouri",shipping:8.99,tax_rate:0,billing_only:!1},MT:{name:"Montana",shipping:8.99,tax_rate:0,billing_only:!1},NC:{name:"North Carolina",shipping:8.99,tax_rate:0,billing_only:!1},ND:{name:"North Dakota",shipping:8.99,tax_rate:0,billing_only:!1},NE:{name:"Nebraska",shipping:8.99,tax_rate:0,billing_only:!1},NV:{name:"Nevada",shipping:8.99,tax_rate:0,billing_only:!1},NH:{name:"New Hampshire",shipping:8.99,tax_rate:0,billing_only:!1},NJ:{name:"New Jersey",shipping:8.99,tax_rate:7,billing_only:!1},NM:{name:"New Mexico",shipping:8.99,tax_rate:0,billing_only:!1},NY:{name:"New York",shipping:8.99,tax_rate:0,billing_only:!1},OH:{name:"Ohio",shipping:8.99,tax_rate:0,billing_only:!1},OK:{name:"Oklahoma",shipping:8.99,tax_rate:0,billing_only:!1},OR:{name:"Oregon",shipping:8.99,tax_rate:0,billing_only:!1},PA:{name:"Pennsylvania",shipping:8.99,tax_rate:0,billing_only:!1},RI:{name:"Rhode Island",shipping:8.99,tax_rate:0,billing_only:!1},SC:{name:"South Carolina",shipping:8.99,tax_rate:0,billing_only:!1},SD:{name:"South Dakota",shipping:8.99,tax_rate:0,billing_only:!1},TN:{name:"Tennessee",shipping:8.99,tax_rate:0,billing_only:!1},TX:{name:"Texas",shipping:8.99,tax_rate:0,billing_only:!1},UT:{name:"Utah",shipping:8.99,tax_rate:0,billing_only:!1},VT:{name:"Vermont",shipping:8.99,tax_rate:0,billing_only:!1},VA:{name:"Virginia",shipping:8.99,tax_rate:0,billing_only:!1},WA:{name:"Washington",shipping:8.99,tax_rate:0,billing_only:!1},WV:{name:"West Virginia",shipping:8.99,tax_rate:0,billing_only:!1},WI:{name:"Wisconsin",shipping:8.99,tax_rate:0,billing_only:!1},WY:{name:"Wyoming",shipping:8.99,tax_rate:0,billing_only:!1}}},jQuery(function(){window.documentIsReady=!0}),window.MaximumErrorCount=1,window.onerror=function(a,b,c){window.errorCount||(window.errorCount=0),newRelicJS.log&&window.errorCount<=window.MaximumErrorCount&&(window.errorCount+=1,jQuery.post("/javascript_error",{error:a,file:b,location:window.location.href,lineNumber:c,params:newRelicJS,documentReady:window.documentIsReady,ua:navigator.userAgent}))},px.oauth={callback:!1,failure_callback:!1,cancel_callback:!1,matching_user_template:null,login:function(a,b,c){var d,e,f;a=="flickr"?(d=900,e=550):(d=850,e=500);var g=typeof window.screenX!="undefined"?window.screenX:window.screenLeft,h=typeof window.screenY!="undefined"?window.screenY:window.screenTop,i=typeof window.outerWidth!="undefined"?window.outerWidth:document.body.clientWidth,j=typeof window.outerHeight!="undefined"?window.outerHeight:document.body.clientHeight-22,k=parseInt(g+(i-d)/2,10),l=parseInt(h+(j-e)/2.5,10),m="width="+d+",height="+e+",left="+k+",top="+l,n="/auth/"+a+"?origin=";return c?n+=encodeURIComponent(c):n+="callback://javascript",b?window.location.href=n:(f=window.open(n,"Login",m),window.focus&&f.focus()),!1},ask_for_email:function(a){px.lightbox.initialize(px.oauth.email_lightbox,a)},email_lightbox:function(a){$("#lightbox_content").width("420px"),$("#lightbox_content").height("200px"),$("#lightbox_content").prepend(a)},provider_login_link_handler:function(a){a.preventDefault();var b=$(this),c=b.attr("data-oauth-provider-login"),d=jQuery.Event("oauth:beforeLogin",{provider:c});b.trigger(d);if(d.isDefaultPrevented())return a.stopPropagation(),!1;px.oauth.callback=function(a,c){var d=jQuery.Event("oauth:loggedIn",{provider:a,user:c});b.trigger(d)},px.oauth.failure_callback=function(){var a=jQuery.Event("oauth:loginFailed",{provider:c});b.trigger(a)},px.oauth.cancel_callback=function(){var a=jQuery.Event("oauth:loginCancelled",{provider:c});b.trigger(a)},px.oauth.login(c)},email_form:{email:null,init:function(){$("#authentication_email").bind("ajax:beforeSend",px.oauth.email_form.show_loading).bind("ajax:complete",px.oauth.email_form.hide_loading).bind("ajax:success",px.oauth.email_form.success).bind("ajax:error",px.oauth.email_form.error),$("#oauth_multiple_user_select").delegate("a.this_is_me","click",delegate_chain(px.oauth.email_form.hide_other_users,px.oauth.email_form.show_password)).delegate("a.this_is_not_me","click",px.oauth.email_form.show_all_users).delegate("button.login_by_password","click",delegate_chain(px.oauth.email_form.submit_password)).delegate("input.user_password","keydown",px.oauth.email_form.clear_password_error).delegate(".enter_different_email","click",px.oauth.email_form.reset).delegate(".create_account_anyway","click",px.oauth.email_form.create_new_account),window.resizeTo(455,455),window.moveTo((screen.availWidth-455)/2,(screen.availHeight-455)/2-50)},create_new_account:function(a){$.ajax("/auth/email",{type:"post",data:$("#authentication_email").serialize()+"&dont_care_about_matching_users=1",success:function(a){window.close(),window.opener.px.oauth.callback(null,a.user)}})},reset:function(a){$("#authenticate_form").find('input[name="auth_email"]').val(""),$("#oauth_multiple_user_select .users").html(""),$("#oauth_multiple_user_select").find(".email_matched, .email_not_matched, .single_account, .plural_account").show(),$("#oauth_multiple_user_select").addClass("noshow"),$("#authenticate_form").show(),a.preventDefault()},submit_password:function(){var a=$(this).closest(".user"),b={id:$(this).attr("data-user-id"),password:a.find(".user_password").val()};$.ajax("/signup/password",{type:"post",data:b,success:_.bind(px.oauth.email_form.password_submitted,this,a),complete:_.bind(px.oauth.email_form.hide_password_loader,this,a)}),a.find(".ask_password_field").find("button.login_by_password").addClass("noshow").nextAll(".loading").removeClass("noshow")},hide_password_loader:function(a){a.find(".ask_password_field").find("button.login_by_password").removeClass("noshow").nextAll(".loading").addClass("noshow")},password_submitted:function(a,b){b.valid?window.location.href="/auth/"+px.oauth.provider+"?origin=callback://javascript":(a.find(".ask_password_field").nextAll(".error").remove(),a.find(".ask_password_field").after('<span class="error">Password is incorrect</span>'),a.find("input.user_password").val(""))},clear_password_error:function(){$(this).closest(".ask_password_field").nextAll(".error").remove()},show_all_users:function(){var a=$(this).closest("ul");a.find(".ask_password").hide(),a.find("li").show()},hide_other_users:function(){var a=$(this).closest("li.user");a.siblings("li").hide()},show_password:function(a){var b=$(this).closest("li.user");b.find(".ask_password").removeClass("noshow").hide().slideDown(),a.preventDefault()},show_loading:function(){$(this).addClass("loading")},hide_loading:function(){$(this).removeClass("loading")},success:function(a,b){if(b.matching_users){var c=_.template(px.oauth.matching_user_template);$.each(b.users,function(a,b){$(".users").append(c(b))}),b.users.length>1?$("#oauth_multiple_user_select .single_account").hide():$("#oauth_multiple_user_select .plural_account").hide(),b.email_match?$("#oauth_multiple_user_select .email_not_matched").hide(
):$("#oauth_multiple_user_select .email_matched").hide(),$("#authenticate_form").hide(),$("#oauth_multiple_user_select").removeClass("noshow")}else window.close(),window.opener.px.oauth.callback(b.provider,b.user)},error:function(a,b){var c=JSON.parse(b.responseText);$(this).nextAll(".email_error").html(c.error)}}},$(document).ready(function(){$("body").delegate("a[data-oauth-provider-login]","click",px.oauth.provider_login_link_handler)}),on_page("authentications_create, authentications_email",px.oauth.email_form.init),px.hotkeys={initialize:function(a){for(hotkey in a)$(document).bind("keydown",hotkey,px.hotkeys.callback_with(a[hotkey]))},callback_with:function(a){return function(b){px.hotkeys.callback(b,a)}},callback:function(a,b){var c=b.call(this,a);c||a.preventDefault()}},px.map={},px.map.markers=[],px.map.id,px.map.placeMarker=function(a){var b={location:null,map:null},c=$.extend(b,a),d=new google.maps.Marker({position:c.location,map:c.map});return typeof c.map.markers=="undefined"&&(c.map.markers=[]),c.map.markers.push(d),d},px.map.placeSingleMarker=function(a){var b={location:null,map:null,settings:{inputLatitude:"#map_latitude",inputLongitude:"#map_longitude"}},c=$.extend(b,a);typeof c.map.markers=="undefined"&&(c.map.markers=[]),$(c.map.markers).each(function(){this.setMap(null)});var d=px.map.placeMarker({location:c.location,map:c.map});c.map.setCenter(c.location),$(c.settings.inputLatitude).val(c.location.lat()),$(c.settings.inputLongitude).val(c.location.lng())},px.map.removeMarkers=function(){$(px.map.markers).each(function(){this.setMap(null)}),$("#map_latitude").val(""),$("#map_longitude").val("")},px.map.editMap=function(a,b){google.maps.event.addListener(a,"click",function(b){px.map.placeSingleMarker({location:b.latLng,map:a})}),typeof b.removeElement!="undefined"&&$(b.removeElement).click(function(){$(a.markers).each(function(){this.setMap(null)}),$(b.inputLatitude).val(""),$(b.inputLongitude).val("")})},px.map.uploadMap=function(a,b){google.maps.event.addListener(a,"click",function(c){px.map.placeSingleMarker({location:c.latLng,map:a,settings:{inputLatitude:b.inputLatitude,inputLongitude:b.inputLongitude}})}),typeof b.removeElement!="undefined"&&$(b.removeElement).click(function(){$(a.markers).each(function(){this.setMap(null)}),$(b.inputLatitude).val(""),$(b.inputLongitude).val("")})},px.map.search=function(a){var b={map:px.map.id,query:null,marker:!1,callback:null,callbackSettings:{}},c=$.extend(b,a);geocoder=new google.maps.Geocoder;var d={address:c.query};geocoder.geocode(d,function(a,b){b==google.maps.GeocoderStatus.OK&&(c.map.setCenter(a[0].geometry.location),c.map.fitBounds(a[0].geometry.viewport),c.marker===!0&&px.map.placeSingleMarker({map:c.map,location:a[0].geometry.location}),c.callback!=null&&c.callback(c.callbackSettings))})},px.map.initialize=function(a){var b={element:"map",latitude:0,longitude:0,zoom:8,disableUi:!0,mapTypeControl:!1,markers:[],callback:null,callbackSettings:{}},c=$.extend(b,a),d=new google.maps.LatLng(c.latitude,c.longitude),e={zoom:c.zoom,center:d,disableDefaultUI:c.disableUi,streetViewControl:!1,scrollwheel:!0,mapTypeControl:c.mapTypeControl,mapTypeId:google.maps.MapTypeId.ROADMAP},f=null;try{f=new google.maps.Map(document.getElementById(c.element),e)}catch(g){return console.log("Error while initializing the map on "+c.element),console.log(g),!1}return $.each(c.markers,function(a,b){loc=new google.maps.LatLng(b.latitude,b.longitude),px.map.placeMarker({location:loc,map:f})}),c.callback!=null&&c.callback(f,c.callbackSettings),f},px.map.searchLabel=function(a,b){a==""?($(b).removeClass("hide"),$(b).addClass("active")):($(b).removeClass("active"),$(b).addClass("hide"))},px.map.setEditSearch=function(){$("#map_search").focus(function(){px.map.searchLabel($(this).val(),$(this).prev())}),$("#map_search").blur(function(){$(this).val()==""&&($(this).prev().removeClass("hide"),$(this).prev().removeClass("active"))}),$("#map_search").keydown(function(a){var b=a.keyCode;b==13?(a.preventDefault(),px.map.search({query:$(this).val()})):px.map.searchLabel($(this).val(),$(this).prev())})},px.lightbox={},px.lightbox.change=!1,px.lightbox.closeMessage="You have unsaved changes. Do you really wish to close the lightbox?",px.lightbox.initialize=function(a,b){if($("#lightbox").length>0)return!1;var c='<div id="lightbox"><div id="lightbox_background"></div><div id="lightbox_content"><div id="lightbox_close"></div></div></div>';$("body").append(c),$("#lightbox_background").click(function(){px.lightbox.close()}),$("#lightbox_close").click(function(){px.lightbox.close()}),$("#lightbox #files .card.pointer").live("click",function(){var a=$(this).data("drawer-name");if(a===undefined)return;$(this).parents(".sidebar").find(".drawer-"+a).slideToggle(300)}),$("html").addClass("lightbox"),$(window).bind("beforeunload",function(a){if(!px.lightbox.checkClose())return a.preventDefault(),!1}),px.lightbox.scroll(),a(b)},px.lightbox.scroll=function(){$("#lightbox").bind("scroll",function(a){$("#lightbox_background").css({top:$(this).scrollTop()+"px"})})},px.lightbox.checkClose=function(){if(px.lightbox.change==1){if(!confirm(px.lightbox.closeMessage))return!1;px.lightbox.change=!1}return!0},px.lightbox.close=function(){px.lightbox.checkClose()==1&&($("#lightbox").remove(),$("html").removeClass("lightbox"))},px.lightbox.wait=function(a){var b='<div id="lightbox_wait_loader"></div>';$("#lightbox_content input:submit").attr("disabled","disabled").after(b);var c=$("#lightbox_content").height()-20,d='<div id="lightbox_wait" class="wait_overlay" style="height:'+c+'px"></div>';$("#lightbox_content").append(d)},px.lightbox.removeWait=function(){$("#lightbox_wait_loader").remove(),$("#lightbox_wait").remove(),$("#lightbox_content input:submit").removeAttr("disabled")},window.pxLightbox=function(a){if(typeof a=="undefined")return $("#lightbox_content").data("pxLightbox");if($("#lightbox").length>0)throw"pxLightbox: You cannot open two lightboxes";var b=this;if(a instanceof jQuery)this.element=$(a),this.options={};else if(typeof a=="object")this.options=a;else throw"pxLightbox: You must specify an options object or a jQuery selector";var c=function(){return b.element},d=function(){var a='<div id="lightbox"><div id="lightbox_background"></div><div id="lightbox_content"><div id="lightbox_close"></div></div></div>';$("body").append(a),$("html").addClass("lightbox");if(c())$("#lightbox_content").width(c().attr("data-lightbox-width")),$("#lightbox_content").height(c().attr("data-lightbox-height"));else if(b.options.height&&b.options.width)$("#lightbox_content").width(b.options.width),$("#lightbox_content").height(b.options.height);else throw"pxLightbox: No width and/or height specified";var d;c()?d=$(c().attr("data-lightbox")):d=$(b.options.content);var e=d.wrap("<div>").parent().html();d.replaceWith('<div id="lightbox_content_placeholder" style="display: none;"></div>'),b.original_lightbox_content=e,$("#lightbox_content").append(e),c()&&c().data("pxLightbox",b),$("#lightbox_content").data("pxLightbox",b);if(c()){var f=jQuery.Event("lightbox:opened");c().trigger(f)}b.options.open&&b.option.open.call(b)},e=function(){$("#lightbox_background").click(b.close),$("#lightbox_close").click(b.close),$("#lightbox_content").delegate(".close_lightbox_button","click",b.close)},f=function(){$("#lightbox").remove(),$("html").removeClass("lightbox"),$("#lightbox_content_placeholder").replaceWith(b.original_lightbox_content)};this.close=function(a){a&&(a.stopPropagation(),a.preventDefault()),f();if(c()){var d=jQuery.Event("lightbox:closed");c().trigger(d)}b.options.close&&close.call(b);if(a)return!1},d(),e()},$.fn.pxLightbox=function(){return this.data("pxLightbox")},$("a[data-lightbox]").live("click",function(a){var b=jQuery.Event("lightbox:beforeOpen");return $(this).trigger(b),!b.isDefaultPrevented()&&!$(this).hasClass("disabled")&&new pxLightbox($(this)),a.preventDefault(),!1}),px.organizer={},px.organizer.id=0,px.organizer.type="all",px.organizer.cancelSort=!1,px.organizer.collectionChanged=!1,px.organizer.collectionTitle="",px.organizer.navRequest=null,px.organizer.unloadGuard=!1,px.organizer.navigatorLock=!1,px.organizer.initialize=function(){px.organizer.thumbnailsReady(),$("#thumbs #more").live("click",function(a){return $(this).html('<img src="/unity/img/spinners/loader-small.gif"/> '),$.ajax({type:"GET",url:$(this).attr("href"),success:function(a){jResult=$(a),$("#thumbs .thumb:last").after(jResult.find(".thumb")),$("#thumbs #more").replaceWith(jResult.find("#more")),px.organizer.thumbnailsReady()},error:function(a,b,c){}}),a.preventDefault(),!1}),$("#thumbs .edit").live("click",function(){var a=$(this).parent().attr("id");a=px.getId(a,!0),px.lightbox.initialize(px.edit.initialize,{id:a})}),$("#thumbs .remove").live("click",function(){px.organizer.selectHandler().removePhoto({element:$(this).parent()})}),$("#navigator li a.group").live("click",function(){if(this.id=="collection_null")return;px.organizer.navRequest&&px.organizer.navRequest.abort();var a=$(this);if(px.organizer.navRequest&&px.organizer.navRequest.readyState==0)$("#collection_null").size()>0&&($("#collection_null").parent().remove(),px.organizer.navigatorOverflow());else if($("#collection_null.active").size()>0){if($("#collection_title").size()>0&&($("#collection_title").val().match(/untitled/i)==null&&px.organizer.collectionChanged==1||$("#thumbs .thumb").size()>0)&&confirm("There are unsaved changes to this collection, would you like to save them?"))return px.organizer.saveOrder({success_callback:function(){a.trigger("click")}}),!1;$("#collection_null.active").parent().remove(),px.organizer.navigatorOverflow()}else if(px.organizer.type==="collection"&&px.organizer.id!=null&&px.organizer.collectionChanged==1){if(confirm("There are unsaved changes to this collection, would you like to save them?"))return px.organizer.saveOrder({success_callback:function(){a.trigger("click")}}),!1;px.organizer.collectionTitle!=""&&($("#collection_"+px.organizer.id).find(".title").text(px.organizer.collectionTitle),px.organizer.collectionTitle="")}$("#navigator").find("a.active").removeClass("active"),$(this).addClass("active");var b=$(this).attr("id"),c="";b.indexOf("_")>=0?(c=b.substr(0,b.indexOf("_")),b=b.substr(b.indexOf("_")+1)):(c=b,b="");switch(c){case"all":px.organizer.navRequest=px.organizer.getAll();break;case"community":px.organizer.navRequest=px.organizer.getCommunity();break;case"collection":px.organizer.navRequest=px.organizer.getCollection(b,null,$(this).attr("data-collection-kind"))}}).not("#all").droppable({accept:".thumb",hoverClass:"drop",over:function(a){},out:function(){},drop:function(a,b){$("#thumbs").append($(b.draggable).clone().show().addClass("ui-draggable-dragging ui-fadeout").css({position:"absolute",top:b.position.top+"px",left:b.position.left+"px"})),$(".ui-fadeout").animate({height:"0px",width:"0px",top:"+=70",left:"+=70",opacity:0},400,"easeInQuad",function(){$(this).remove()}),px.organizer.drop({element:this,ui:b})}}),px.organizer.orderCollections(),$("#open_upload, #open_upload_library, #open_upload_profile, #open_upload_collection").live("click",function(){if(px.organizer.type=="collection"&&px.organizer.id==null)px.organizer.saveOrder({success_callback:function(){px.lightbox.initialize(px.upload.initialize,{})}});else{var a={};px.organizer.type=="collection"&&(a.type="collection",a.id=px.organizer.id),px.lightbox.initialize(px.upload.initialize,a)}}),$("#new_set_button").live("click",px.organizer.sets.createNew),$("#take_the_tour").live("click",function(){px.lightbox.initialize(px.tour.initialize)});var a,b=function(){window.location.hash.length!=0&&(window.location.hash=="#upload"?$("#open_upload").click():window.location.hash=="#new_set"?$("#new_set_button").click():window.location.hash=="#new_collection"?$("#new_collection_button").click():(a=window.location.hash.match(/#collection_(\d+)/))&&$("#collection_"+a[1]).click(),window.location.hash="")};window.onhashchange=b,b(),px.organizer.scrolled(),px.organizer.navigatorOverflow(),$("#navigator").live("DOMSubtreeModified",function(a){px.organizer.navigatorLock==0&&(px.organizer.navigatorLock=!0,px.organizer.navigatorOverflow())}),$(window).bind("resize",function(){var a=$(window).height()-$("#header").height()-$("#footer").outerHeight();a<300&&(a=300),$("#organizer").css({"min-height":a+"px"}),px.organizer.navigatorOverflow()}),$("body").delegate("form.share_set_form","ajax:before",delegate_chain(px.organizer.sets.share.validate_form,px.organizer.sets.share.show_loading)).delegate("form.share_set_form","ajax:error",delegate_chain(px.organizer.sets.share.hide_loading,px.organizer.sets.share.show_error)).delegate("form.share_set_form","ajax:success",px.organizer.sets.share.success)},px.organizer.sets={createNew:function(a){px.organizer.navRequest=px.organizer.getCollection(null,null,"profile")},share:{validate_form:function(){var a=$(this).find(".email_input"),b=$(this).find("textarea");if(a.val().trim()=="")return a.focus(),px.error("Please enter an email address to share the set with."),!1;if(!is_email_valid(a.val()))return a.focus(),px.error("Please enter a valid email address."),!1;if(b.val().trim()=="")return b.focus(),px.error("Please enter a message."),!1;$(this).find(".set_id").val(px.organizer.id)},show_loading:function(){var a=$(this).find(".submit_row").find("button, input").not(".loading");a.hide(),a.nextAll(".loading").removeClass("noshow")},hide_loading:function(){var a=$(this).find(".submit_row").find("button, input").not(".loading");a.show(),a.nextAll(".loading").addClass("noshow")},show_error:function(a,b){px.error(b.responseText)},success:function(){px.lightbox.close(),px.messages.create({type:"success",message:"Your message was sent."})}}},px.organizer.selectHandler=function(a){a===undefined&&(a=px.organizer.type);if(a==""||a=="all")return px.organizer.allPhotos;if(a=="community")return px.organizer.communityPhotos;if(a=="collection")return px.organizer.collectionPhotos;alert("Internal error, please reload the page.")},px.organizer.thumbnailsReady=function(){$("#thumbs .thumb img").live("mousedown",function(a){a.preventDefault()});switch(px.organizer.type){case"community":case"all":$("#thumbs .thumb").draggable({items:".thumb",helper:"clone",cursorAt:{cursor:"hand",top:70,left:70},zIndex:"3",revert:"invalid"});break;default:$("#thumbs").sortable({items:".thumb",helper:"clone",cursor:"hand",placeholder:px.organizer.selectHandler().isSortable()?"cue":"hidden",tolerance:"pointer",create:function(a,b){},start:function(a,b){b.helper.find(".btn").hide(),(b.helper===null||b.item.id==b.helper.id)&&!px.organizer.selectHandler().isSortable()&&(px.organizer.cancelSort=!0)},stop:function(a,b){if(px.organizer.cancelSort===!0)return px.organizer.cancelSort=!1,$(this).sortable("cancel"),!1;px.organizer.saveOrder({type:px.organizer.type,id:px.organizer.id}),px.organizer.selectHandler().saveOrder()},receive:function(a,b){$(b.item).addClass("disabled").fadeTo(333,.15),px.organizer.saveOrder({type:px.organizer.type,id:px.organizer.id})}})}},px.organizer.drop=function(a){var b={element:null,event:null,ui:null},c=$.extend(b,a),d=px.getId(c.ui.draggable.attr("id"),!0);px.organizer.cancelSort=!0;if($(c.element).hasClass("active"))return!1;var e=$(c.element).attr("id"),f="";e.indexOf("_")>=0?(f=e.substr(0,e.indexOf("_")),e=e.substr(e.indexOf("_")+1)):(f=e,e="");switch(f){case"community":px.organizer.addToCommunity(c.ui.draggable);break;case"collection":px.organizer.addToCollection(e,c.ui.draggable)}},px.organizer.getAll=function(){var a="nolayout";return a+="&bar=false",px.organizer.wait(),$.ajax({type:"GET",url:"/organizer/library",data:a}).done(function(a){px.organizer.removeWait(),$("#content").html(a),px.organizer.type="all",px.organizer.id=null,$("#upload_into").html(""),$("#open_upload").show(),px.organizer.thumbnailsReady(),$("#thumbs .remove").html("Delete")})},px.organizer.getCommunity=function(){return px.organizer.type=="community"?!1:(px.organizer.wait(),$.ajax({type:"GET",url:"/organizer/community?nolayout"}).done(function(a){px.organizer.removeWait(),$("#content").html(a),px.organizer.type="community",px.organizer.id=0,$("#upload_into").html("to Profile"),$("#open_upload").show(),px.organizer.thumbnailsReady()}))},px.organizer.getCollection=function(a,b,c){if(!c)var c="portfolio";if(px.organizer.id==a&&px.organizer.type=="collection"&&px.organizer.collection_kind==c)return px.organizer.removeWait(),!1;var d={nolayout:"true",kind:c};if(a!==null&&a!==undefined)d.collection_id=a;else{$("#collection_null").length>0&&$("#collection_null").remove(),px.organizer.id=null,px.organizer.type="collection",px.organizer.collection_kind=c;var e=$("<span></span>").addClass("handle"),f=$("<span></span>").addClass("title").html("Untitled"),g=$("<span></span>").addClass("count").html("0"),h=$("<a></a>").attr({id:"collection_null","class":"group clearfix ui-droppable active","data-collection-kind":c});h.append(e).append(f).append(g);var i=$("<li></li>").addClass("collection");i.append(h),$("#navigator").find("a.active").removeClass("active"),$("ul.collections.kind_"+c+" li.title").after(i),px.organizer.navigatorOverflow()}return px.organizer.wait(),$.ajax({type:"GET",url:"/organizer/collection",data:d,success:function(b){px.organizer.removeWait(),$("#content").html(b),px.organizer.type="collection",px.organizer.id=a,px.organizer.collection_kind=c,px.organizer.collectionTitle=$(".collections.kind_"+c+" .active .title").text();var d=$("#collection_title").val();d!==undefined?($("#upload_into").html("to "+d),$("#open_upload").show(),$("#navigator a.active").find(".title").html(d)):$("#open_upload").hide(),$("#collection_title").keyup(function(a){px.organizer.collectionChanged=!0;if(a.keyCode==13){px.organizer.selectHandler().saveOrder();return}$("#collection_"+px.organizer.id+" .title").html($(this).val()),$("#collection_url").val($(this).val().replace(/[^a-zA-Z0-9]+/g,"_").toLowerCase()),$("#upload_into").text("to "+$(this).val())}).keydown(function(){px.organizer.collectionChanged=!0,$("#collection_"+px.organizer.id+" .title").html($(this).val()),$("#collection_url").val($(this).val().replace(/[^a-zA-Z0-9]+/g,"_").toLowerCase()),$("#upload_into").text("to "+$(this).val())}).blur(function(){px.organizer.collectionChanged=!0,$(this).val()==""&&($(this).val(d),$("#collection_"+px.organizer.id+" .title").html($(this).val()),$("#collection_url").val($(this).val().replace(/[^a-zA-Z0-9]+/g,"_").toLowerCase()),$("#upload_into").text("to "+$(this).val()))}),$("#collection_url").focusout(function(){px.organizer.collectionChanged=!0,$(this).val($(this).val().toLowerCase())}),$("#collection_private").change(function(){px.organizer.collectionChanged=!0}),$("#collection_password").focusout(function(){px.organizer.collectionChanged=!0}),$("#sharing #emailbutton").click(function(){if($("#collection_null.active").size()>0)return confirm("You must save this set before you can share it.")?(px.organizer.saveOrder({success_callback:function(){px.lightbox.initialize(px.organizer.shareSetCallback,{})}}),!1):!1;if(px.organizer.collectionChanged==1&&confirm("There are unsaved changes to this set. Would you like to save them before you share it?"))return px.organizer.saveOrder({success_callback:function(){px.lightbox.initialize(px.organizer.shareSetCallback,{})}}),!1;px.lightbox.initialize(px.organizer.shareSetCallback,{})}),px.organizer.thumbnailsReady()}})},px.organizer.shareSetCallback=function(a){$("#lightbox_content").width("600px"),$("#lightbox_content").height("230px"),$("#lightbox_content").prepend($("#email-box").clone()),$("#lightbox_content").find("#email-box").show();var b=($(window).height()-280)/2+"px";$("#lightbox_content").css({position:"relative",top:b,margin:"0px auto"}),$("#lightbox_content form").get(0).reset(),$("#lightbox_content input.email_input").focus()},px.organizer.disappearPhoto=function(a){$(a.element).fadeOut(333,function(){$(this).remove(),px.organizer.saveOrder({type:px.organizer.type,id:px.organizer.id}),px.organizer.updateBlankSlate()})},px.organizer.removePhoto=function(a){var b={element:null},c=$.extend(b,a);px.organizer.disappearPhoto(c)},px.organizer.addToCommunity=function(a){$.ajax({type:"POST",url:"/photo/"+px.getId($(a).attr("id"))+"/edit",data:"photo[community]=1",dataType:"json"}).done(function(a){$("#community .count").html(parseInt($("#community .count").text())+1)}).error(function(a,b){px.messages.create({type:"error",message:"Error when publishing the photo"})})},px.organizer.addToCollection=function(a,b){px.organizer.collectionPhotos.addPhoto({id:a,type:"collection",element:b})},px.organizer.saveOrder=function(a){var b={type:px.organizer.type,id:px.organizer.id},c=$.extend(b,a);px.organizer.selectHandler().saveOrder(c),px.organizer.updateSidebarCount(),px.organizer.updateBlankSlate()},px.organizer.reloadNavigatorLock=!1,px.organizer.reloadNavigator=function(){if(px.organizer.reloadNavigatorLock)return!1;px.organizer.reloadNavigatorLock=!0,$.ajax({type:"GET",url:"/organizer/navigator"}).success(function(a){var b=$("#navigator .active").attr("id");jResult=$(a),$("#navigator").replaceWith(jResult),$("#navigator li a.group").not("#all").droppable("destroy").droppable({accept:".thumb",hoverClass:"drop",drop:function(a,b){px.organizer.drop({element:this,ui:b})}}),$("#navigator .active").removeClass("active"),$("#"+b).addClass("active"),px.organizer.reloadNavigatorLock=!1,px.organizer.orderCollections()})},px.organizer.updateSidebarCount=function(){px.organizer.type=="all"||px.organizer.type=="community"?px.organizer.reloadNavigator():$("#"+px.organizer.type+(!isNaN(px.organizer.id)&&px.organizer.id>0?"_"+px.organizer.id:"")).find(".count").html($("#thumbs .thumb").size())},px.organizer.updateBlankSlate=function(){$("#thumbs .thumb").size()<1?$(".empty_photos").show():$(".empty_photos").hide()},px.organizer.wait=function(){!$("#organizer_wait").length>0&&$("#content").append('<div id="organizer_wait" class="wait_overlay" style="height:'+$("#content").height()+'px"></div>')},px.organizer.removeWait=function(){$("#organizer_wait").remove()},px.organizer.updateNewPhotos=function(a){px.organizer.reloadNavigator(),a=a.reverse();var b=new Array;$.each(a,function(a,b){var c=$("<div></div>").attr("id","photo_"+b).addClass("thumb").append($("<img />").attr("src","/api/photo/getpath?id="+b+"&s=2").attr("alt","photo")).append($("<a></a>").attr("class","remove btn").html("Remove")).append($("<a></a>").attr("class","edit btn").html("Edit"));$("#thumbs").prepend(c)}),$(".empty_photos").hide(),px.organizer.thumbnailsReady()},px.organizer.scrolled=function(){$("#organizer").css({"min-height":$("#px").height()-$("#header").height()+"px"}),window.onscroll=function(a){window.pageYOffset>=125?$("#organizer").addClass("scrolled"):$("#organizer").removeClass("scrolled"),px.organizer.navigatorOverflow()},$(window).bind("scrollstop",function(a){px.organizer.navigatorOverflow()})},px.organizer.allPhotos={},px.organizer.allPhotos.addPhoto=function(a){px.organizer.allPhotos.add(a)},px.organizer.allPhotos.removePhoto=function(a){px.organizer.allPhotos.remove(a)},px.organizer.allPhotos.isSortable=function(a){return!1},px.organizer.allPhotos.saveOrder=function(a){},px.organizer.allPhotos.add=function(a){var b={element:null},c=$.extend(b,a)},px.organizer.allPhotos.remove=function(a){var b={element:null},c=$.extend(b,a);if(confirm("Are you sure you want to delete this photo? It will be removed from your profile, collections and stories.")==0)return!1;px.organizer.disappearPhoto(c),$.ajax({type:"POST",url:"/photo/"+px.getId($(c.element).attr("id"))+"/delete",dataType:"json"}).done(function(a){}).error(function(a,b){alert("Error when destroying the photo")})},px.organizer.communityPhotos={},px.organizer.communityPhotos.addPhoto=function(a){px.organizer.communityPhotos.add(a)},px.organizer.communityPhotos.removePhoto=function(a){px.organizer.communityPhotos.remove(a)},px.organizer.communityPhotos.isSortable=function(a){return!1},px.organizer.communityPhotos.saveOrder=function(a){},px.organizer.communityPhotos.add=function(a){var b={element:null},c=$.extend(b,a);px.organizer.communityPhotos.placeSort(c),$.ajax({type:"POST",url:"/photo/"+px.getId($(c.element).attr("id"))+"/edit",data:{photo:{community:1}},dataType:"json"}).done(function(a){px.organizer.updateSidebarCount()}).error(function(a,b){alert("Error when adding the photo to the community")})},px.organizer.communityPhotos.remove=function(a){var b={element:null},c=$.extend(b,a);px.organizer.disappearPhoto(c),$.ajax({type:"POST",url:"/photo/"+px.getId($(c.element).attr("id"))+"/edit",data:{photo:{community:0}},dataType:"json"}).done(function(a){px.organizer.updateSidebarCount(),px.organizer.updateBlankSlate()}).error(function(a,b){alert("Error when removing the photo from the community")})},px.organizer.communityPhotos.placeSort=function(a){var b=$(a.element),c=px.getId(b.attr("id"),!0),d=$("#thumbs .thumb"),e=null;for(var f=0;f<d.size();f++)if(px.getId($(d.get(f)).attr("id"),!0)<c){e=$(d.get(f));break}e===null&&(e=$("#thumbs .thumb:first").get(0)),b.detach().insertBefore(e),$("#thumbs").sortable("refreshPositions")},px.organizer.collectionPhotos={},px.organizer.collectionPhotos.addPhoto=function(a){px.organizer.collectionPhotos.add(a)},px.organizer.collectionPhotos.removePhoto=function(a){px.organizer.collectionPhotos.remove(a)},px.organizer.collectionPhotos.isSortable=function(a){return!0},px.organizer.collectionPhotos.add=function(a){var b={id:px.organizer.id,type:px.organizer.type,element:null},c=$.extend(b,a);if(c.type!="collection")return!1;$("#"+px.organizer.collection_kind+"_collections_loader").hide().html('<img src="/unity/img/spinners/tiny_blue_spinner.gif"> Saving...').fadeIn("slow"),c.id==px.organizer.id?px.organizer.collectionPhotos.saveOrder(a):$.ajax({type:"PUT",url:"/settings/portfolio/collections/"+a.id,data:{add_photos:[{id:px.getId($(c.element).attr("id")),position:999}]},dataType:"json",success:function(a){$("#"+px.organizer.collection_kind+"_collections_loader").show().html("Saved").delay(1e3).fadeOut("slow"),$("#collection_"+a.collection.id+" .count").html(a.collection.count)},error:function(){}})},px.organizer.collectionPhotos.remove=function(a){var b={element:null},c=$.extend(b,a);px.organizer.disappearPhoto(c),px.organizer.collectionPhotos.saveOrder()},px.organizer.collectionPhotos.saveCollectionLock=!1,px.organizer.collectionPhotos.saveCollection=function(a){px.organizer.collectionPhotos.saveCollectionLock=!0;if(!px.organizer.collectionPhotos.validateSettings(a))return px.organizer.collectionPhotos.saveCollectionLock=!1,px.messages.create({type:"error",message:"Please enter valid settings."}),!1;$("#"+px.organizer.collection_kind+"_collections_loader").hide().html('<img src="/unity/img/spinners/tiny_blue_spinner.gif"> Saving...').fadeIn("slow"),$.ajax({type:"POST",url:"/settings/portfolio/collections",data:{collection_id:$("#collection_id").val(),collection_kind:$("#collection_kind").val(),collection_title:$("#collection_title").val(),collection_path:$("#collection_url").val(),collection_password:$("#collection_password").val(),collection_private:$("#collection_private").is(":checked")},dataType:"json"}).done(function(a){var b=$("<span></span>").addClass("handle"),c=$("<span></span>").addClass("title").html(a.collection.title),d=$("<span></span>").addClass("count").html(a.collection.count),e=$("<a></a>").attr({id:"collection_"+a.collection.id,"class":"group clearfix ui-droppable active"});e.append(b).append(c).append(d);var f=$("<li></li>").addClass("collection");f.append(e),$("#collection_null").before(f),$("#collection_null").remove(),px.organizer.navigatorOverflow(),$("#navigator li a.group").not("#all").droppable("destroy").droppable({accept:".thumb",hoverClass:"drop",drop:function(a,b){px.organizer.drop({element:this,ui:b})}}),$("#collection_id").val(a.collection.id),px.organizer.id=a.collection.id,px.organizer.collectionPhotos.saveCollectionLock=!1,px.organizer.collectionPhotos.saveOrder()}).error(function(a,b){px.organizer.collectionPhotos.saveCollectionLock=!1,response=null;try{response=jQuery.parseJSON(a.responseText)}catch(c){}response!==null&&response.message!==undefined?px.messages.create({type:"error",message:"Error when saving a new collection. "+response.message}):px.messages.create({type:"error",message:"Error when saving a new collection. Please try again."}),$("#"+px.organizer.collection_kind+"_collections_loader").hide().html("Error :(").fadeIn("slow")})},px.organizer.collectionPhotos.saveOrder=function(a){var b=$("#thumbs").sortable("toArray");$.each(b,function(a,c){b[a]=px.getId(c,!0)});var c={id:px.organizer.id,type:px.organizer.type,order:b},d=$.extend(c,a);if(px.organizer.type=="collection"&&px.organizer.id==null){px.organizer.collectionPhotos.saveCollectionLock||px.organizer.collectionPhotos.saveCollection(a);return}px.organizer.collectionPhotos.saveOrderTimeout!==null&&clearTimeout(px.organizer.collectionPhotos.saveOrderTimeout),px.organizer.collectionPhotos.saveOrderTimeout=setTimeout(function(){$("#"+px.organizer.collection_kind+"_collections_loader").hide().html('<img src="/unity/img/spinners/tiny_blue_spinner.gif"> Saving...').fadeIn("slow"),px.organizer.collectionPhotos._saveOrder(d)},1500)},px.organizer.collectionPhotos.deleteCollection=function(a){if(!confirm("Delete collection "+$("#collection_title").val()+"?"))return!1;px.organizer.collectionChanged=!1,px.organizer.collectionPhotos.saveCollectionLock&&clearTimeout(px.organizer.collectionPhotos.saveCollectionLock),$("#all").click();if(a===undefined)return!1;$.ajax({type:"DELETE",url:"/settings/portfolio/collections/"+a+"?_method=delete",dataType:"json"}).done(function(b){$("#collection_"+a).parent().fadeOut(function(){$(this).hide()}),px.organizer.reloadNavigator()}).error(function(a,b){alert("Error when deleting the collection")})},px.organizer.collectionPhotos.saveOrderTimeout=null,px.organizer.collectionPhotos._saveOrder=function(a){if(px.organizer.collectionPhotos.saveCollectionLock)return!1;px.organizer.collectionPhotos.saveCollectionLock=!0;if(!px.organizer.collectionPhotos.validateSettings(a))return px.organizer.collectionPhotos.saveCollectionLock=!1,alert("Error: Please enter valid settings"),!1;var b=$("#collection_details").find(".button.green");b.attr("rel",b.text()).html('<img src="/unity/img/spinners/loader-small-white-green.gif" width="16" height="16" />');var c=$.map(a.order,function(a,b){return{photo_id:a,position:b}}),d=!1;c.length==0&&(d=!0),$.ajax({type:"PUT",url:"/settings/portfolio/collections/"+a.id,data:{_method:"put",kind:$("#collection_kind").val(),title:$("#collection_title").val(),path:$("#collection_url").val(),password:$("#collection_password").val(),"private":$("#collection_private").is(":checked"),photos:$.map(a.order,function(a,b){return{photo_id:a,position:b}}),no_photos:d},dataType:"json"}).done(function(c){px.organizer.collectionChanged=!1,px.organizer.collectionTitle=$("#collections .active .title").text(),b.text(b.attr("rel")),$("#"+px.organizer.collection_kind+"_collections_loader").show().html("Saved").delay(1e3).fadeOut("slow"),$("#collection_link").attr("href","http://"+$('label[for="collection_url"]').text().trim()+$("#collection_url").val()),px.organizer.collectionPhotos.saveCollectionLock=!1,a.success_callback!==undefined&&a.success_callback()}).error(function(a,c){b.text(b.attr("rel")),$("#"+px.organizer.collection_kind+"_collections_loader").show().html("Error :(").delay(1e3).fadeOut("slow"),alert("Error when saving the collection"),px.organizer.collectionPhotos.saveCollectionLock=!1})},px.organizer.collectionPhotos.validateSettings=function(a){return $("#collection_title").val().length==0?(px.messages.create({type:"error",message:"Collection must have a title."}),!1):$("#collection_url").val().match(/[a-zA-Z0-9]+/i)?!0:(px.messages.create({type:"error",message:"Collection must only contain alphanumeric characters."}),!1)},px.organizer.orderCollections=function(){$("ul.collections").sortable({items:"li.collection",axis:"y",helper:"clone",placeholder:"placeholder",create:function(a,b){},start:function(a,b){$("#collection_null").size()>0&&px.organizer.collectionPhotos.saveOrder(),$("body").addClass("unselected")},stop:function(a,b){$("body").removeClass("unselected")},update:function(a,b){$("body").removeClass("unselected");var c=$(this).find(".collection a").get();c=$.map(c,function(a,b){return{id:px.getId(a.id),position:b}}),$("#"+px.organizer.collection_kind+"_collections_loader").hide().html('<img src="/unity/img/spinners/tiny_blue_spinner.gif"> Saving...').fadeIn("slow"),$.ajax({type:"POST",url:"/settings/portfolio/collections",data:{_method:"put",kind:this.id=="collections_portfolio"?"portfolio":"profile",collections:c
},dataType:"json"}).done(function(a){$("#"+px.organizer.collection_kind+"_collections_loader").show().html("Saved").delay(1e3).fadeOut("slow")}).error(function(a,b){alert("Error when saving the collection order")})}}),$("ul#collections_portfolio").sortable("option","connectWith","ul#collections_profile"),$("ul#collections_profile").sortable("option","connectWith","ul#collections_portfolio")},px.organizer.navigatorOverflow=function(){var a=$(window).height(),b=$("#organizer").height(),c=$("#navigator").offset().top;$("#hellobar").length>0&&(c-=$("#hellobar").outerHeight());var d=0;b-c+44<a?d=b-c+44:d=a-10,$("#navigator").addClass("short").height(d+"px"),setTimeout(function(){px.organizer.navigatorLock=!1},500)},px.organizer.markSafeForWork=function(a){$(a).hasClass("disabled")||($(a).addClass("active blue").siblings(".button").removeClass("active blue"),$(a).siblings("input.nsfw").val(0))},px.organizer.markNotSafeForWork=function(a){$(a).hasClass("disabled")||($(a).addClass("active blue").siblings(".button").removeClass("active blue"),$(a).siblings("input.nsfw").val(1))},px.friend_finder={click_handler:function(a){a.preventDefault();var b=$(this).attr("data-friend-finder-provider"),c=jQuery.Event("friend_finder:loggingIn");$(this).trigger(c);if(c.isDefaultPrevented())return!1;var d=$(this);px.oauth.callback=function(a){var b=jQuery.Event("friend_finder:loggedIn");px.friend_finder.find_friends(a,d)},px.oauth.failure_callback=function(){var a=jQuery.Event("friend_finder:loginFailed");d.trigger(a)},px.oauth.login(b)},find_friends:function(a,b){$.ajax("/settings/friends_for_finder/"+a,{data:{initial:!0},success:function(c){setTimeout(function(){px.friend_finder.poll(a,b,c)},400)},error:function(){px.friend_finder.error(b)}})},error:function(a){var b=jQuery.Event("friend_finder:error");a.trigger(b),a.trigger("friend_finder:complete")},poll:function(a,b,c){$.ajax("/settings/friends_for_finder/"+a,{data:{job_id:c.job_id},success:function(c){if(c.pending)setTimeout(function(){px.friend_finder.poll(a,b,c)},400);else{var d=jQuery.Event("friend_finder:success",{contacts:c.contacts});b.trigger(d),b.trigger("friend_finder:complete")}},error:function(){px.friend_finder.error(b)}})}},$(document).ready(function(){$("body").delegate("a[data-friend-finder-provider]","click",px.friend_finder.click_handler)}),px.sharelizers={fb:{pop:function(a){window.open(a,"fbshare","height=380,width=660,resizable=0,toolbar=0,menubar=0,status=0,location=0,scrollbars=0")},count:function(a,b){b=b||"",$.getJSON("https://graph.facebook.com/"+a+"&callback=?",function(a){a.shares!=0&&a.shares!=undefined&&a.shares!=null&&($("#fbbutton"+b).addClass("hascount"),$("#fbbutton"+b).after('<a class="button count"><span>'+a.shares+"</span></a>"))})}},tw:{pop:function(a){window.open(a,"twshare","height=260,width=550,resizable=1,toolbar=0,menubar=0,status=0,location=0")},count:function(a,b){b=b||"",$.getJSON("http://urls.api.twitter.com/1/urls/count.json?url="+a+"&callback=?",function(a){a.count!=0&&a.count!=undefined&&a.count!=null&&($("#twbutton"+b).addClass("hascount"),$("#twbutton"+b).after('<a class="button count"><span>'+a.count+"</span></a>"))})}},pin:{pop:function(a){window.open(a,"pinshare","height=270,width=630,resizable=0,toolbar=0,menubar=0,status=0,location=0,scrollbars=0")},count:function(a,b){$.getJSON("http://api.pinterest.com/v1/urls/count.json?url="+a+"&callback=?",function(a){a.count!=0&&a.count!=undefined&&a.count!=null&&($("#pinbutton"+b).addClass("hascount"),$("#pinbutton"+b).after('<a class="button count"><span>'+a.count+"</span></a>"))})}}},px.upload={},px.upload.id=0,px.upload.files=[],px.upload.filesComplete=[],px.upload.displayEagerThumbnails=!0,px.upload.resizeIframe=function(event){if(event.origin.match(/^https?:\/\/(localhost:\d+|(upload\.)?500px\.com)/i)){var data=$.parseJSON(event.data);data.height&&$("#lightboxIframe").height(data.height+"px"),data.exec&&eval(data.exec)}},px.upload.postMessage=function(a){var b={height:Helper.getDocHeight()};a&&(b.exec=a),b=JSON.stringify(b),window.parent.postMessage(b,__post_domain)},px.upload.executor=px.upload.postMessage,px.upload.initialize=function(a){var b={type:"all",id:0},c=$.extend(b,a);px.upload.id=0,px.upload.files=[],px.upload.filesComplete=[];var d="layout=empty";a.type&&a.id&&(d+="&type="+a.type+"&id="+a.id),t=new Date,d+="&_t="+t.getTime();if(typeof window.FormData!="undefined"){$("#lightbox_content").addClass("loading").css({"min-height":"200px"}).width("1080px"),window.addEventListener("message",px.upload.resizeIframe,!1),$("#lightbox_content").css({"min-height":"200px"}).width("1080px");var e=$('<iframe width="100%" id="lightboxIframe" scrolling="no">').prependTo("#lightbox_content");e.attr("src",__uploader_host+"/organizer/upload?"+d),e.load(function(){$("#lightbox_content").removeClass("loading").addClass("complete")})}else $("#lightbox_content").addClass("loading").css({"min-height":"150px"}).width("580px"),$.ajax({type:"POST",url:"/organizer/uploadie",data:d}).success(function(a){var b=a.substr(a.indexOf("<form"),a.indexOf("</form")-a.indexOf("<form")+7);$("#lightbox_content").removeClass("loading").addClass("complete"),$("#lightbox_content").prepend(b),px.upload.readyIE()}).error(function(a,b,c){$(".msg").remove(),px.lightbox.close(),window.my_xhr=a,px.messages.create({type:"error",message:"Please log in or activate your user. "+b+": "+a.status+" "+c})})},px.upload.ready=function(){var a=document.getElementById("dropbox");a.addEventListener("dragenter",px.upload.dragEnter,!1),a.addEventListener("dragexit",px.upload.dragExit,!1),a.addEventListener("dragover",px.upload.dragOver,!1),a.addEventListener("drop",px.upload.drop,!1),$("#browse").change(function(a){var b=document.getElementById("browse").files;px.upload.readFiles(b)}),$("#browse_button").click(function(){$("#browse").trigger("click")}),$("#upgrade_link").click(function(){px.upload.executor("window.location.href = '/upgrade'")}),$("#upload_done").submit(function(a){var b=!0;$("#upload_done div.nsfw_control").each(function(){if($(this).find("input.nsfw").val()=="")return b=!1});if(!b){var c="px.messages.create({type: 'error', message: 'Please mark all photos if they are safe for work or not'})";return px.upload.executor(c),!1}return a.preventDefault(),px.upload.done(this),!1}),px.upload.markAsNsfwControl()},px.upload.dragEnter=function(a){a.stopPropagation(),a.preventDefault(),$("#dropbox").addClass("active"),$("#drop_message").hide(),$("#drop_message_hover").show()},px.upload.dragExit=function(a){a.stopPropagation(),a.preventDefault(),$("#dropbox").removeClass("active"),$("#drop_message_hover").hide(),$("#drop_message").show()},px.upload.dragOver=function(a){a.stopPropagation(),a.preventDefault()},px.upload.drop=function(a){a.stopPropagation(),a.preventDefault(),$("#dropbox").removeClass("active"),$("#drop_message_hover").hide(),$("#drop_message").show();var b=a.dataTransfer.files,c=b.length;c>0&&px.upload.readFiles(b)},px.upload.readFiles=function(a){$.each(a,function(a,b){if(px.upload.files.length>=parseInt($("#upload_limits").val()))return alert("You have reached the maximum number of uploads for this week. Visit 500px.com/upgrade to become Awesome and have unlimited uploads."),!1;if(px.upload.files.length>=10)return alert("You can only upload 10 photos at a time."),!1;if($.inArray(b.name+"_"+b.size,px.upload.files)<0){if(typeof b.type!="undefined"&&b.type!=""&&b.type!="image/jpeg")return alert("The photo needs to be a JPEG image."),!1;if(typeof b.type=="undefined"||b.type=="")return alert("There was a problem reading the file using drag and drop. Please try browsing to that photo instead."),!1;var c=new px.upload.fileReady(b,px.upload.id);px.upload.id++}else alert("You are already uploading this photo.")})},px.upload.fileReady=function(a,b){this.file=a,this.id=b,px.upload.files.push(a.name+"_"+a.size);try{var c=new FileReader;c.vars=this,typeof px.upload.fileLoadCallback!="undefined"?c.onload=px.upload.fileLoadCallback:c.onload=px.upload.fileLoad,c.readAsDataURL(a)}catch(d){var e={target:{}};e.target.vars=this,e.target.vars.file=a,e.target.vars.id=b,typeof px.upload.fileLoadCallback!="undefined"?px.upload.fileLoadCallback(e):px.upload.fileLoad(e)}},px.upload.fileEXIF=function(){var a=EXIF.readFromBinaryFile(new BinaryFile(this.result)),b=this.vars.id,c=20,d=-30;if(typeof a.GPSLatitude!="undefined"&&typeof a.GPSLongitude!="undefined"&&a.GPSLatitude[0]&&a.GPSLongitude[0]){var e=1;a.GPSLatitudeRef=="S"&&(e=-1);var f=1;a.GPSLongitudeRef=="W"&&(f=-1),c=Math.round(Math.abs(Math.round((a.GPSLatitude[0]||0)*1e6))+Math.abs(Math.round((a.GPSLatitude[1]||0)*1e6))/60+Math.abs(Math.round((a.GPSLatitude[2]||0)*1e6))/3600)*e/1e6,d=Math.round(Math.abs(Math.round((a.GPSLongitude[0]||0)*1e6))+Math.abs(Math.round((a.GPSLongitude[1]||0)*1e6))/60+Math.abs(Math.round((a.GPSLongitude[2]||0)*1e6))/3600)*f/1e6,$("#map_latitude_"+b).val(c),$("#map_longitude_"+b).val(d),px.map.initialize({latitude:c,longitude:d,zoom:12,element:"map_"+b,markers:[{latitude:c,longitude:d}],disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+b),inputLongitude:$("#map_longitude_"+b),removeElement:$("#map_remove_marker_"+b)}})}else px.map.initialize({latitude:c,longitude:d,zoom:1,element:"map_"+b,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+b),inputLongitude:$("#map_longitude_"+b),removeElement:$("#map_remove_marker_"+b)}});px.datepicker($("#taken_at_display_"+b),"#taken_at_"+b);var g="";typeof a.ExposureTime!="undefined"&&(a.ExposureTime<1?g="1/"+Math.round(1/a.ExposureTime):g=Math.floor(a.ExposureTime));var h="",i="",j="";typeof a.DateTimeOriginal!="undefined"?h=a.DateTimeOriginal:typeof a.DateTimeDigitized!="undefined"&&(h=a.DateTimeDigitized),h!=""&&(h=px.upload.takenDate(h),j=px.upload.takenDateToHuman(h)),$("#taken_at_"+b).val(h),$("#taken_at_display_"+b).val(j),$("#camera_"+b).val(a.Model),$("#focal_"+b).val(a.FocalLength),$("#iso_"+b).val(a.ISOSpeedRatings),$("#shutter_"+b).val(g),$("#aperture_"+b).val(a.FNumber),$("#photo_description_"+b).val(a.ImageDescription),$("#photo_title_"+b).val(a.ImageTitle),$("#tags_"+b).val(a.ImageKeywords)},px.upload.takenDate=function(a){var b=a.split(" ");return b[0]=b[0].replace(/:/gi,"-"),b[0]+" "+b[1]},px.upload.takenDateToHuman=function(a){date=new Date(a.replace(/-/gi," "));switch(date.getMonth()){case 0:m="January";break;case 1:m="February";break;case 2:m="March";break;case 3:m="April";break;case 4:m="May";break;case 5:m="June";break;case 6:m="July";break;case 7:m="August";break;case 8:m="September";break;case 9:m="October";break;case 10:m="November";break;case 11:m="December"}return m+" "+date.getDate()+", "+date.getFullYear()},px.upload.getLoadedEXIF=function(a,b){if(a.taken_at&&a.taken_at!=""&&$("#taken_at_"+b).val()==""&&$("#taken_at_display_"+b).val()==""){var c=a.taken_at.substr(0,10),d=c.split("-");date=new Date(d[1]+"/"+d[2]+"/"+d[0]);switch(date.getMonth()){case 0:m="January";break;case 1:m="February";break;case 2:m="March";break;case 3:m="April";break;case 4:m="May";break;case 5:m="June";break;case 6:m="July";break;case 7:m="August";break;case 8:m="September";break;case 9:m="October";break;case 10:m="November";break;case 11:m="December"}var e=m+" "+date.getDate()+", "+date.getFullYear();$("#taken_at_"+b).val(c),$("#taken_at_display_"+b).val(e)}$("#camera_"+b).val()==""&&$("#camera_"+b).val(a.camera),$("#focal_"+b).val()==""&&$("#focal_"+b).val(a.focal_length),$("#iso_"+b).val()==""&&$("#iso_"+b).val(a.iso),$("#shutter_"+b).val()==""&&$("#shutter_"+b).val(a.shutter_speed),$("#aperture_"+b).val()==""&&$("#aperture_"+b).val(a.aperture),$("#photo_description_"+b).val()==""&&$("#photo_description_"+b).val(a.description),$("#photo_title_"+b).val()==""&&$("#photo_title_"+b).val(a.name),$("#tags_"+b).val()==""&&$("#tags_"+b).val(a.tags_string)},px.upload.fileLoad=function(a){px.upload.executor("px.lightbox.change = true");var b=a.target.vars.id;$("#upload").removeClass("disabled").removeAttr("disabled");var c=$("#file").clone().show().html().toString().replace(/idPlaceholder/g,b);$("#files").prepend(c),px.upload.executor(),px.upload.displayEagerThumbnails&&a.total<=2097152?$("#cropbox_"+b).attr("src",a.target.result):$("#cropbox_"+b).hide().after('<p class="sub_text"><br><br>Generating a preview...</p>'),$("#photo_remaining_count").text(parseInt($("#photo_remaining_count").text())-1),$("#progress_"+b).find(".name").html(a.target.vars.file.name);var d=a.target.vars.file.name+"_"+a.target.vars.file.size;a.target.vars.uid=d;try{var e=new FileReader;e.vars=a.target.vars,e.onloadend=px.upload.fileEXIF,e.readAsBinaryString(a.target.vars.file)}catch(f){px.map.initialize({latitude:20,longitude:-30,zoom:1,element:"map_"+b,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+b),inputLongitude:$("#map_longitude_"+b),removeElement:$("#map_remove_marker_"+b)}}),px.datepicker($("#taken_at_display_"+b),"#taken_at_"+b)}px.upload.fileLoadPartTwo(a.target.vars,b,d)},px.upload.fileLoadPartTwo=function(a,b,c){navigator.userAgent.indexOf("Safari/")!=-1&&navigator.userAgent.indexOf("Chrome")==-1&&$.ajax("/close_connection",{async:!1});var d=new FormData;d.append("Filedata",a.file),d.append("k",$("#param_k").val()),d.append("ks",$("#param_ks").val());var e=new XMLHttpRequest;e.open("POST","/upload"),e.upload.vars=a,e.upload.addEventListener("progress",px.upload.fileProgress,!1),e.upload.addEventListener("load",px.upload.fileLoaded,!1),e.upload.addEventListener("abort",function(){var a=px.upload.files.indexOf(this.vars.uid);a!=-1&&px.upload.files.splice(a,1)},!1),e.onreadystatechange=function(a){if(e.readyState===4)if(e.status===200){px.upload.filesComplete.push(c);var d=$.parseJSON(e.responseText);jQuery.browser.webkit&&navigator.userAgent.indexOf("Chrome")==-1&&px.upload.getLoadedEXIF(d.photo,b),$("#photo_id_"+b).val(d.photo.id),$("#remove_and_cancel_"+b).text("Delete").unbind("click");if($("#cropbox_"+b).attr("src")=="/unity/img/bgs/pixel.gif"||$("#cropbox_"+b).attr("src")=="")$("#cropbox_"+b).attr("src","/api/photo/getpath?id="+d.photo.id+"&s=4"),$("#cropbox_"+b).load(function(){$(this).show().siblings(".sub_text").remove()});$("#remove_and_cancel_"+b).click(function(){var a=px.upload.files.indexOf(c),d=px.upload.filesComplete.indexOf(c);a!=-1&&d!=-1&&(px.upload.files.splice(a,1),px.upload.filesComplete.splice(d,1)),$("#photo_remaining_count").text(parseInt($("#photo_remaining_count").text())+1),$.ajax({type:"POST",url:"/photo/"+$("#photo_id_"+b).val()+"/delete",dataType:"json"}).done(function(a){}).error(function(a,b){}),px.upload.remove(b)})}else{$("#upload_"+b).append('<div class="wait_overlay"><span>'+c.substr(0,c.lastIndexOf("_"))+' failed to upload. <a id="tryagain_'+b+'">Try again?</a></span></div>');var f=px.upload.files.indexOf(c);f!=-1&&px.upload.files.splice(f,1),$("#photo_remaining_count").text(parseInt($("#photo_remaining_count").text())+1),$("#tryagain_"+b).click(function(){$("#upload_"+b).find(".wait_overlay").remove(),a.originalTarget!=null?px.upload.fileLoadPartTwo(a.originalTarget.upload.vars,b,c):px.upload.fileLoadPartTwo(a.target.upload.vars,b,c)})}},$("#remove_and_cancel_"+b).click(function(){px.upload.fileAbort(e,b)}),e.send(d)},px.upload.fileAbort=function(a,b){a.abort(),px.upload.remove(b)},px.upload.fileProgress=function(a){var b=this.vars.id;if(a.lengthComputable){var c=Math.round(a.loaded*100/a.total);screen,$("#progress_"+b+" .bar").width(c+"%"),$("#progress_"+b+" .amount").html(c+"%")}},px.upload.fileLoaded=function(a){var b=this.vars.id;$("#progress_"+b+" .bar").width("100%"),$("#progress_"+b+" .amount").html("100%")},px.upload.wait=function(){var a='<div id="lightbox_wait_loader"></div>';$("input:submit").attr("disabled","disabled").after(a);var b=$("body").height()-45,c='<div id="lightbox_wait" class="wait_overlay" style="height:'+b+'px"></div>';$("body").append(c)},px.upload.removeWait=function(){$("#lightbox_wait_loader").remove(),$("#lightbox_wait").remove(),$("input:submit").removeAttr("disabled")},px.upload.done=function(form,callback,callbackSettings){if($("#upload").hasClass("disabled"))return!1;typeof px.upload.files!="undefined"&&px.upload.files.length>1&&$("#upload_message").text("Uploading photos..."),$("#upload_message").show(),px.upload.wait();var waitForUpload=setInterval(function(){if(px.upload.checkComplete(px.upload.files,px.upload.filesComplete)!=1)return!1;clearInterval(waitForUpload);var action=$(form).attr("action"),photos=$(form).serializeArray();photos.push({name:"authenticity_token",value:$('meta[name="csrf-token"]').attr("content")}),typeof px.upload.files!="undefined"&&px.upload.files.length>1?$("#upload_message").text("Saving photos..."):typeof px.upload.files!="undefined"&&px.upload.files.length<2&&$("#upload_message").text("Saving photo...");var ids=[];$(".photo_id").each(function(){$(this).val()!=""&&ids.push($(this).val())}),$.ajax({type:"POST",url:action,data:photos,dataType:"json"}).success(function(result){px.upload.files=[],px.upload.filesComplete=[],px.upload.executor("px.lightbox.change = false"),px.upload.executor("px.lightbox.close()"),px.upload.executor("px.messages.create({type:'success',message:'"+result.message+"'})"),px.upload.executor("px.organizer.updateNewPhotos(["+eval(ids)+"])"),callback&&callback(callbackSettings)}).error(function(a){px.upload.removeWait()})},1e3);return!1},px.upload.checkComplete=function(a,b){a.sort(),b.sort();var c=!0;return $.each(a,function(d,e){if(a[d]!=b[d])return c=!1,!1}),c},px.upload.remove=function(a){$("#upload_"+a).fadeTo(666,.001,function(){$(this).hide("blind",{direction:"vertical"},666,function(){$(this).remove(),px.upload.executor(),px.upload.files.length==0&&$("#upload").addClass("disabled").attr("disabled","disabled")})})},px.upload.markAsNsfwControl=function(){$(".nsfw_false_button").live("click",function(){px.organizer.markSafeForWork(this)}),$(".nsfw_true_button").live("click",function(){px.organizer.markNotSafeForWork(this)}),$("select.category").live("change",function(){var a=$(this).parentsUntil(".sidebar").parent();$(this).val()=="4"?(px.organizer.markNotSafeForWork($(a).find(".nsfw_true_button")),$(a).find(".nsfw_true_button").addClass("disabled"),$(a).find(".nsfw_false_button").addClass("disabled")):($(a).find(".nsfw_true_button").removeClass("disabled"),$(a).find(".nsfw_false_button").removeClass("disabled"))})},px.upload.readyIE=function(){$("#upload_done").submit(function(){if($("#browse").val()=="")return px.messages.create({type:"error",message:"Please select a photo to upload"}),!1;px.lightbox.wait(),$("#upload_message").show(),$("#upload").addClass("disabled").attr("disabled","disabled")})},px.edit={},px.edit.refresh=!1,px.edit.postMessageResult=function(event){if(event.origin.match(/^https?:\/\/(localhost:\d+|(upload\.)?500px\.com)/i)){$("#lightboxIframe").height("955px");if(event.data){var data=event.data;eval(data)}}},px.edit.postMessage=function(a){window.parent.postMessage(a,__post_domain)},px.edit.initialize=function(a){var b={type:null,id:0,refresh:!1},c=$.extend(b,a);px.edit.refresh=c.refresh,$("#lightbox_content").addClass("loading").css({"min-height":"200px"}).width("1080px");var d="layout=empty";d+="&id="+c.id,a.community&&(d+="&community="+a.community);if($.browser.msie!=1){window.addEventListener("message",px.edit.postMessageResult,!1);var e=$('<iframe width="100%" id="lightboxIframe" scrolling="no" frameborder="0">').prependTo("#lightbox_content")}else{window.attachEvent("onmessage",px.edit.postMessageResult,!1);var e=$('<iframe width="100%" id="lightboxIframe" scrolling="no" frameborder="0">').prependTo("#lightbox_content")}e.attr("src",__uploader_host+"/organizer/edit?"+d),e.load(function(){$("#lightbox_content").removeClass("loading").addClass("complete")})},px.edit.ready=function(){px.upload.executor=px.edit.postMessage;if($("#map_latitude").val()!=""||$("#map_longitude").val()!=""){var a=$("#map_latitude").val(),b=$("#map_longitude").val(),c=10;px.map.initialize({latitude:a,longitude:b,zoom:c,markers:[{latitude:a,longitude:b}],disableUi:!1,mapTypeControl:!1,element:"map",callback:px.map.editMap,callbackSettings:{removeElement:$("#map_remove_marker"),inputLatitude:$("#map_latitude"),inputLongitude:$("#map_longitude")}})}else px.map.initialize({latitude:20,longitude:-30,zoom:1,disableUi:!1,mapTypeControl:!1,element:"map",callback:px.map.editMap,callbackSettings:{removeElement:$("#map_remove_marker"),inputLatitude:$("#map_latitude"),inputLongitude:$("#map_longitude")}});px.datepicker($("#taken_at_display"),"#taken_at"),$(".sidebar input, .sidebar textarea").change(function(){px.upload.executor("px.lightbox.change = true")});var d=new Image;d.src=$("#cropbox").attr("src"),$("#cropbox").Jcrop({aspectRatio:1,bgOpacity:.2,onSelect:function(a){var b=$("#cropbox").height(),c=d.height;c>b&&(ratio=c/b,a.x=Math.round(a.x*ratio),a.x2=Math.round(a.x2*ratio),a.y=Math.round(a.y*ratio),a.y2=Math.round(a.y2*ratio));var e=a.x+","+a.x2+","+a.y+","+a.y2;$("#thumbnail_coordinates").val(e)}}),$("#edit").submit(function(a){var b=!0;$("#edit div.nsfw_control").each(function(){if($(this).find("input.nsfw").val()=="")return b=!1});if(!b){var c="px.messages.create({type: 'error', message: 'Please mark all photos if they are safe for work or not'})";return px.upload.executor(c),!1}a.preventDefault(),px.upload.done(this,function(){px.edit.refresh==1&&window.location.reload()})}),$("#edit_delete").click(function(a){px.edit.deletePhoto()}),px.edit.markAsNSFW(),$("#photo_nsfw_false").click(function(){px.organizer.markSafeForWork(this)}),$("#photo_nsfw_true").click(function(){px.organizer.markNotSafeForWork(this)})},px.edit.deletePhoto=function(){if(confirm("Are you sure you want to delete this photo? The photo will be permanently deleted from the website.")){px.upload.wait();var a=$("#photo_id").val(),b=$("#photo_name").val();String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),b.trim().length==0&&(b="Untitled"),$.ajax({type:"POST",url:"/photo/"+a+"/delete",dataType:"json"}).done(function(c){px.upload.executor("px.lightbox.change = false"),px.upload.executor("px.lightbox.close()"),px.upload.executor("px.edit.removePhoto("+a+")"),px.upload.executor("px.messages.create({type:'success',message:'"+b+" has been deleted'})")}).error(function(a,b){alert("Error when destroying the photo")})}},px.edit.removePhoto=function(a){$("#photo_"+a)&&px.organizer.removePhoto({element:$("#photo_"+a)})},px.edit.markAsNSFW=function(){$("#photo_category").val()=="4"&&(px.organizer.markNotSafeForWork($("#photo_nsfw_true")),$("#photo_nsfw_true").addClass("disabled"),$("#photo_nsfw_false").addClass("disabled")),$("#photo_category").change(function(){$(this).val()=="4"?(px.organizer.markNotSafeForWork($("#photo_nsfw_true")),$("#photo_nsfw_true").addClass("disabled"),$("#photo_nsfw_false").addClass("disabled")):($("#photo_nsfw_true").removeClass("disabled"),$("#photo_nsfw_false").removeClass("disabled"))})},px.comments=function(){},px.comments.init=function(a){(matches=location.hash.match(/#(comment_\d+)/))&&$(location.hash).nextAll("form").length>0&&(form=$(location.hash).nextAll("form"),form.show(),form.find(".comment_body").focus()),$("#show-comments").delegate("a.ajax_pagination_link","click",px.comments.load_comments_page),window.history.replaceState&&a&&window.history.replaceState({page:a},"page "+a,window.location.pathname+window.location.search)},px.comments.pop_state=function(a){if(window.history.state==null)return;if(a.state){var b=$('#show-comments .pager a[page="'+a.state.page+'"]');b.length>0&&b.click()}},px.comments.load_comments_page=function(a){px.comments.xhr&&px.comments.xhr.abort();var b=$(this).attr("href"),c=$(this).attr("page");b=b.replace(/^(.*?)(\?(.+))$/,"$1/comments$2"),px.comments.xhr=$.getJSON(b,function(a){$("#show-comments #showcomments").html(a.comments),$("#show-comments .pager").html(a.pagination),px.comments.xhr=null});if(window.history.pushState){var d={page:c},e;c==1?e=window.location.pathname:e=window.location.pathname+"?page="+c,window.location.pathname+window.location.search!=e&&(window.onpopstate=null,window.history.pushState(d,"page "+c,e),window.onpopstate=px.comments.pop_state)}return a.preventDefault(),!1},px.comments.toggle_submit_button=function(){$(this).find(".comment_body").val().length>0?$(this).find(".submit_button").removeAttr("disabled").removeClass("disabled"):$(this).find(".submit_button").attr("disabled","disabled").addClass("disabled")},px.comments.vote=function(a){a.preventDefault();if($(this).hasClass("disabled"))return!1;var b="",c=parseInt($(this).parent().siblings(".comment_rating").html());return $(this).hasClass("vote_up")?c++:c--,c>0?b="positive":c<0&&(b="negative"),$(this).addClass("disabled").siblings(".vote_up, .vote_down").addClass("disabled").unbind("click"),$(this).parent().siblings(".comment_rating").fadeOut(333,function(){$(this).removeClass("positive negative").addClass(b).html(c).fadeIn(333)}),$.getJSON($(this).attr("href"),{},function(a){a.status===200;return}),!1},$("#showcomments a.reply_to_comment_button").live("click",function(){var a=$(this).closest(".comment").get(0).id,b=$("#"+a+"_reply_form");b.slideToggle(500,function(){b.find("textarea").focus()})}),$(".comment_reply_form").live("ajax:success",function(a,b){this.reset(),$(this).find(".replay_loader").hide(),$(this).find("#add_comment_button").show().attr("disabled","disabled").addClass("disabled"),$("#comment_"+b.comment_id+"_reply_form").slideToggle(500)}).live("ajax:beforeSend",function(){$(this).find("#add_comment_button").hide().attr("disabled","disabled"),$(this).find(".replay_loader").show()}).live("ajax:error",function(a,b){px.messages.create({type:"error",message:b.responseText})}),$(".like_comment_link").live("ajax:success",function(a,b){$(this).closest(".comment").find(".rating").html(b.comment_rating),$(this).closest(".actions").replaceWith(b.actions_html)}).live("ajax:error",function(a,b){px.messages.create({type:"error",message:b.responseText})}),$("a.show_flagged_comment_link").live("click",function(){var a=$(this).closest(".body_text"),b=a.closest(".comment");a.children(".faded").remove(),b.children(".actions").replaceWith(a.children(".original_actions").html()),b.children(".actions").fadeIn(200),b.find(".rating").css("opacity",0),a.html(a.children(".original_text").html())}),$("#new_comment").live("ajax:beforeSend",function(){$("#add_comment_button").hide().attr("disabled","disabled"),$("#post_button_load").show()}).live("ajax:complete",function(){$("#comment_body").val(""),$("#add_comment_button").show(),$("#add_comment_button").attr("disabled","disabled"),$("#add_comment_button").addClass("disabled"),$("#post_button_load").hide()}).live("keyup",px.comments.toggle_submit_button),$("form.comment_reply_form").live("keyup",px.comments.toggle_submit_button),$("form.new_corporate_blog_comment").live("keyup",px.comments.toggle_submit_button),$(".comment_body").live("paste",function(){setTimeout(function(){px.comments.toggle_submit_button()},300)}),px.messages={},px.messages.create=function(a){var b={type:"",message:"",delay:5e3},c=$.extend(b,a),d='<div class="msg '+c.type+'"><div class="inside">'+c.message+'</div><a class="close_x"></a></div>',e=50;$(".msg").length>0?($(".msg").remove(),$("#px").append(d).find(".msg").css({top:"0px"}),e=$(".msg").outerHeight()+10,c.delay>0&&$(".msg").delay(c.delay).animate({top:"-"+e+"px"},500,function(){$(this).remove()})):($("#px").append(d),e=$(".msg").outerHeight()+10,$(".msg").animate({top:"0px"},500).delay(c.delay).animate({top:"-"+e+"px"},500,function(){$(this).remove()})),$(".msg").mouseover(function(){$(this).stop(!0,!0).css({top:"0px"})}),$(".msg").mouseout(function(){$(this).animate({top:"0px"},1).delay(c.delay).animate({top:"-"+e+"px"},500,function(){$(this).remove()})})},px.messages.close=function(a){var b=$(".msg").outerHeight()+10,c=a?$(a.target).parent():$(".msg");c.stop().animate({top:"-"+b+"px"},500,function(){$(this).remove()})},$(".msg .close_x").live("click",px.messages.close),px.form=function(a){var b=this,c=function(){return b.element},d=function(){c().unbind("submit",b.validate).bind("submit",b.validate),c().unbind("ajax:before",b.validate).bind("ajax:before",b.validate),c().delegate("input","keydown",b.remove_error).delegate("select","change",b.remove_error)};this.validate=function(a){var c=$(b.element),d=!0,e=jQuery.Event("pxForm:beforeValidation");c.trigger(e),c.find(".validate:visible").each(function(){d=b.validate_field.call(this)&&d}),!d&&a&&(a.preventDefault(),a.stopPropagation());if(d){var e=jQuery.Event("pxForm:validationSuccess");c.trigger(e)}else{var e=jQuery.Event("pxForm:validationFailed");c.trigger(e)}var e=jQuery.Event("pxForm:afterValidation");return c.trigger(e),d},this.validate_field=function(){var a=$(this),c=a.val().trim(),d=jQuery.Event("pxForm:validate"),e=a.trigger(d);if(d.result==1)return!0;if(typeof d.result=="string")return b.add_error.call(this,d.result),!1;if(a.hasClass("validate_required")&&c=="")return b.add_error.call(this,"required"),!1;if(a.hasClass("validate_confirmation")){var f=$("#"+this.id+"_confirmation");if(f.val().trim().toLowerCase()!=c.toLowerCase())return b.add_error.call(this,"confirmation"),!1}if(a.hasClass("validate_credit_card")&&!c.match(/^\d{13,19}$/))return b.add_error.call(this,"credit_card"),!1;if(a.hasClass("validate_date_is_not_past")){var g=parseInt(a.find(".validate_date_month").val(),10),h=parseInt(a.find(".validate_date_year").val(),10),i=new Date;if(i.getMonth()+1>g&&i.getFullYear()>=h)return b.add_error.call(this,"date_is_past"),!1}if(a.hasClass("validate_numeric")&&!c.match(/^\d+$/))return b.add_error.call(this,"numeric"),!1;if(a.hasClass("validate_phone")&&c!=""&&!c.match(/\+?1?\s*-?\s*\.?\s*(\d{3}|\(\s*\d{3}\s*\))\.?\s*\s*-?\s*\.?\s*\d{3}\s*-?\s*\.?\s*\d{4}/gi))return b.add_error.call(this,"phone"),!1;if(a.hasClass("validate_length")){var j=parseInt(a.attr("minlength"),10),k=parseInt(a.attr("maxlength"),10);j&&c.length<j?b.add_error.call(this,"too_short",{min_length:j}):k&&c.length>k&&b.add_error.call(this,"too_long",{max_length:k})}return!0},this.add_error=function(a,c){var d=$(this),e,f;b.remove_error.call(this);if(f=d.attr("data-pxForm-message"))var a=f;var g=pxLocales.pxForm.errors[a],h;if(c){var i=_.template(g);h=i(c)}else h=g;var j=$("<div />",{"class":"pxForm_error",text:h});$(this).after(j)},this.remove_error=function(){$(this).nextAll(".pxForm_error").remove(),$(this).closest(".validate").nextAll(".pxForm_error").remove();var a=jQuery.Event("pxForm:afterErrorCleared",{element:$(this)});c().trigger(a)},this.element=$(a),this.element.data("pxForm",this),c().addClass("pxFormInitialized"),d()},px.form.init_this=function(){new px.form(this)},px.form.init=function(){$("form.pxForm:not(.pxFormInitialized)").each(px.form.init_this)},$.fn.pxForm=function(){return this.data("pxForm")},$(document).ready(px.form.init),px.sets={page:1,"private":!1,init_password_form:function(){$("#px").delegate("form.unlock_set","ajax:beforeSend",delegate_chain(px.sets.validate_unlock_form,px.sets.show_unlock_loading)).delegate("form.unlock_set","ajax:success",px.sets.show_unlocked_set).delegate("form.unlock_set","ajax:error",delegate_chain(px.sets.show_unlock_error,px.sets.hide_unlock_loading))},init_show:function(){$("#px").delegate("#like_set_link","ajax:beforeSend",px.sets.show_like_loading).delegate("#like_set_link","ajax:success",px.sets.show_like_complete).delegate("#like_set_link","ajax:complete",px.sets.hide_like_loading).delegate("#like_set_link","ajax:error",px.sets.like_error).delegate("#start_slideshow_button","click",px.sets.slideshow.start).delegate("#ssclose","click",px.sets.slideshow.close).delegate(".photo > a, .photo .userdetails a","click",px.sets.photo_clicked),px.hotkeys.initialize({right:px.sets.slideshow.next_photo,left:px.sets.slideshow.prev_photo}),$(window).unbind().scroll(px.sets.load_next_page)},photo_clicked:function(a){if(px.sets.private){var b=Number($(this).closest(".photo").attr("id").match(/(\d+)/)[1]),c=null;$.each(px.sets.slideshow.data,function(a,d){d.id==b&&(c=a)}),px.sets.slideshow.init(px.sets.slideshow.data),px.sets.slideshow.start(c),a.preventDefault()}},load_next_page:function(a){var b=$("#the_set #more").data("total-pages");if(px.sets.page<b&&$(window).height()+$(window).scrollTop()>=$(document).height()-500){if($("#the_set #more").hasClass("disabled"))return a.preventDefault(),a.stopPropagation(),!1;$("#the_set #more").addClass("disabled").show(),px.sets.page+=1,$.getJSON("",{page:px.sets.page,password:$("#set_password").val()},function(a){$("#the_set .col.d4:last").after(a.html_photos),$("#the_set #more").removeClass("disabled").hide()})}},validate_unlock_form:function(
){var a=$(this).find('input[type="password"]');if(a.val().trim()=="")return px.error("You must enter a password."),a.focus(),!1},show_unlock_loading:function(){$(this).find("button").addClass("noshow"),$(this).find("button.loading").removeClass("noshow")},show_unlocked_set:function(a,b){$("body").attr("id")=="sets_index"?window.location=$(this).attr("data-href"):$("#px > .container").html(b)},show_unlock_error:function(){px.error("The password you entered is incorrect."),$(this).find(".set_password").select().focus()},hide_unlock_loading:function(){$(this).find("button").removeClass("noshow"),$(this).find("button.loading").addClass("noshow")},slideshow:{data:null,inited:!1,init:function(a){if(px.sets.slideshow.inited)return;if(!a&&px.sets.slideshow.data.length>0)var a=px.sets.slideshow.data;var b=$("#slideshow ul");for(var c=0;c<a.length;c++){var d=$("<img>").attr("src",a[c].path),e=$("<br />"),f=$("<a>").attr("href","/photo/"+a[c].id).html(a[c].name);$("<td>").attr("valgin","middle").append(d).append(e).append(f).appendTo(b).wrap($("<tr>"))}b.find("tr").wrap($("<table>")),b.find("table").wrap($("<li>")),px.sets.slideshow.inited=!0},start:function(a){if(isNaN(a))var a=0;$("#cover").fadeIn(400);var b=[self.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,self.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop],c=jQuery("html");c.data("scroll-position",b),c.data("previous-overflow",c.css("overflow")),c.css("overflow","hidden"),window.scrollTo(b[0],b[1]),$("#slideshow ul").cycle({fx:"fade",next:"#ssright",prev:"#ssleft",speedIn:250,speedOut:300,sync:0,timeout:0,pager:"#ssnav",startingSlide:a}),$("#slideshow").show(),$("#ssnav").show(),$("#ssleft").show(),$("#ssright").show(),$("#ssclose").delay(250).fadeIn(400),$("#slideshow img").css("max-height",$(window).height()-40-40+"px"),px.hotkeys.initialize({esc:px.sets.slideshow.close})},close:function(){var a=jQuery("html"),b=a.data("scroll-position");a.css("overflow",a.data("previous-overflow")),window.scrollTo(b[0],b[1]),$("#slideshow").hide(),$("#slideshow ul").cycle("destroy"),$("#cover").hide(),$("#ssnav").hide(),$("#ssleft").hide(),$("#ssright").hide(),$("#ssclose").hide()},next_photo:function(){$("#ssright:visible").click()},prev_photo:function(){$("#ssleft:visible").click()}},like_error:function(a,b){px.messages.create({type:"error",message:b.responseText}),$("#like_set_link").show()},show_like_loading:function(){$(this).hide(),$("#like_set_loader").show()},hide_like_loading:function(){$("#like_set_loader").hide()},show_like_complete:function(){$("#like_set_complete").show();var a=parseInt($("#set_like_count").html());a++,$("#set_like_count").html(a)}},on_page("sets_show",px.sets.init_show,px.sets.init_password_form),on_page("sets_index",px.sets.init_password_form),px.stories={},px.stories.list=[],px.stories.listTemp=[],px.stories.library={},px.stories.newStory={},px.stories.xhrs={},px.stories.changed=!1,px.stories.initialize=function(){$.extend($.ui.sortable.prototype,{_intersectsWithPointer:function(a){var b=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,a.top,a.height),c=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,a.left,a.width),d=(this.options.axis=="x"||b)&&(this.options.axis=="y"||c),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return d?this.floating?f&&f=="right"||e=="down"?2:1:e&&(e=="down"?2:1):!1}}),$("#file input").attr("disabled","disabled"),$("#stories_new").submit(function(){px.stories.changed=!1;var a=0;return $(".story_photo").each(function(b,c){$(c).find(".position").val(a),a++}),px.stories.disableButtons(),px.stories.validate()}),$(".story_photo .delete").live("click",function(){var a=$(this).closest(".story_photo").attr("id");a=px.getId(a),px.stories.removePhoto(a);var b=px.stories.xhrs[a];px.stories.executorFrame("px.stories.abortFile('"+a+"')")}),$(".story_photo").not("#photo_idPlaceholder").each(function(){var a=px.getId($(this).attr("id"));if($("#map_latitude_"+a).val()!=""&&$("#map_longitude_"+a).val()!=""){var b=$("#map_latitude_"+a).val(),c=$("#map_longitude_"+a).val();px.map.initialize({latitude:b,longitude:c,zoom:10,markers:[{latitude:b,longitude:c}],element:"map_"+a,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+a),inputLongitude:$("#map_longitude_"+a),removeElement:$("#map_remove_"+a)}})}else px.map.initialize({latitude:20,longitude:-30,zoom:1,element:"map_"+a,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+a),inputLongitude:$("#map_longitude_"+a),removeElement:$("#map_remove_"+a)}});px.datepicker($(this).find("input.date"),"#taken_at_"+a)}),$("#delete").click(function(){px.stories.changed=!1}),$("#preview").click(function(){px.stories.preview.open()}),px.upload.displayEagerThumbnails=!1,px.upload.fileLoadCallback=function(a){px.stories.fileLoad(a)};if($.browser.msie==1||$.browser.opera==1)$("#drop_message").remove(),$("#drop_message_ie").show();px.stories.changeMade(),$("#photo_list .story_photo").each(function(){px.stories.list.push(px.getId($(this).attr("id"),!0))})},px.stories.changeMade=function(){$("#stories_new input, #stories_new textarea").live("change",function(){px.stories.changed=!0}),$(window).bind("beforeunload",function(a){a=a||window.event;if(px.stories.changed==1)return"You have unsaved changes to your story."})},px.stories.validate=function(){return $("#blog_post_title").val()==""?(px.messages.create({type:"error",message:"Your story needs to have a title",delay:5e3}),$.scrollTo("#header"),px.stories.enableButtons(),!1):$("#blog_post_body").val()==""?(px.messages.create({type:"error",message:"Your story needs to have an introduction",delay:5e3}),$.scrollTo("#header"),px.stories.enableButtons(),!1):!0},px.stories.postMessageResultFrame=function(event){event.origin.match(/^https?:\/\/(localhost:\d+|(upload\.)?500px\.com)/i)&&event.data&&eval(event.data)},px.stories.postMessageResult=function(event){event.origin.match(/^https?:\/\/(localhost:\d+|(upload\.)?500px\.com)/i)&&event.data&&eval(event.data)},px.stories.executor=function(a){window.parent.postMessage(a,__post_domain)},px.stories.executorFrame=function(a){document.getElementById("dropboxFrame").contentWindow.window.postMessage(a,__uploader_host)},px.stories.trackXHR=function(a,b){px.stories.xhrs[a]=b},px.stories.fileLoadParent=function(a,b){var c=$($("#file").clone().show().html().toString().replace(/idPlaceholder/g,a));c.find("input").removeAttr("disabled"),$("#photo_list").append(c),px.datepicker($("#photo_"+a).find("input.date"),"#taken_at_"+a),px.stories.changed=!0,px.stories.sortable()},px.stories.fileLoadFailedEXIF=function(a){px.map.initialize({latitude:20,longitude:-30,zoom:1,element:"map_"+a,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+a),inputLongitude:$("#map_longitude_"+a),removeElement:$("#map_remove_marker_"+a)}})},px.stories.fileEXIFParent=function(a,b){a=jQuery.parseJSON(a),a.location===!0?($("#map_latitude_"+b).val(a.lat),$("#map_longitude_"+b).val(a.long),px.map.initialize({latitude:a.lat,longitude:a.long,zoom:12,element:"map_"+b,markers:[{latitude:a.lat,longitude:a.long}],disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+b),inputLongitude:$("#map_longitude_"+b),removeElement:$("#map_remove_marker_"+b)}})):px.map.initialize({latitude:a.lat,longitude:a.long,zoom:1,element:"map_"+b,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+b),inputLongitude:$("#map_longitude_"+b),removeElement:$("#map_remove_marker_"+b)}}),$("#taken_at_"+b).val(a.taken),$("#photo_"+b).find("input.date").val(a.takenToHuman),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_name").val(a.ImageTitle),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_description").val(a.ImageDescription),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_camera").val(a.Model),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_focal_length").val(a.FocalLength),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_aperture").val(a.FNumber),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_shutter_speed").val(a.shutter)},px.stories.abortFile=function(a){var b=px.stories.xhrs[a];if(typeof b!="undefined"&&b.readyState>=1&&b.readyState<=3){b.abort();var c=px.upload.files.indexOf(b.upload.vars.uid);c!=-1&&px.upload.files.splice(c,1),px.upload.checkComplete(px.upload.files,px.upload.filesComplete)==1&&px.stories.enableButtons(!0)}},px.stories.fileEXIF=function(){var a=EXIF.readFromBinaryFile(new BinaryFile(this.result)),b=this.vars.id;a.lat=20,a.long=-30;if(typeof a.GPSLatitude!="undefined"&&typeof a.GPSLongitude!="undefined"&&a.GPSLatitude[0]&&a.GPSLongitude[0]){a.location=!0;var c=1;a.GPSLatitudeRef=="S"&&(c=-1);var d=1;a.GPSLongitudeRef=="W"&&(d=-1),a.lat=Math.round(Math.abs(Math.round(a.GPSLatitude[0]*1e6))+Math.abs(Math.round(a.GPSLatitude[1]*1e6))/60+Math.abs(Math.round(a.GPSLatitude[2]*1e6))/3600)*c/1e6,a.long=Math.round(Math.abs(Math.round(a.GPSLongitude[0]*1e6))+Math.abs(Math.round(a.GPSLongitude[1]*1e6))/60+Math.abs(Math.round(a.GPSLongitude[2]*1e6))/3600)*d/1e6}a.shutter="",typeof a.ExposureTime!="undefined"&&(a.ExposureTime<1?a.shutter="1/"+Math.round(1/a.ExposureTime):a.shutter=Math.floor(a.ExposureTime)),a.taken="";var e="";a.takenToHuman="",typeof a.DateTimeOriginal!="undefined"?a.taken=a.DateTimeOriginal:typeof a.DateTimeDigitized!="undefined"&&(a.taken=a.DateTimeDigitized);if(a.taken!=""){var f=a.taken.split(" ");f[0]=f[0].replace(/:/gi,"-"),a.taken=f[0]+" "+f[1],e=new Date(a.taken.replace(/-/gi," "));switch(e.getMonth()){case 0:m="January";break;case 1:m="February";break;case 2:m="March";break;case 3:m="April";break;case 4:m="May";break;case 5:m="June";break;case 6:m="July";break;case 7:m="August";break;case 8:m="September";break;case 9:m="October";break;case 10:m="November";break;case 11:m="December"}a.takenToHuman=m+" "+e.getDate()+", "+e.getFullYear()}a=JSON.stringify(a),px.stories.executor("px.stories.fileEXIFParent('"+a+"', '"+b+"')")},px.stories.getLoadedEXIF=function(a,b){if(a.taken_at&&a.taken_at!=""&&$("#taken_at_"+b).val()==""&&$("#photo_"+b).find("input.date").val()==""){var c=a.taken_at.substr(0,10),d=c.split("-");date=new Date(d[1]+"/"+d[2]+"/"+d[0]);switch(date.getMonth()){case 0:m="January";break;case 1:m="February";break;case 2:m="March";break;case 3:m="April";break;case 4:m="May";break;case 5:m="June";break;case 6:m="July";break;case 7:m="August";break;case 8:m="September";break;case 9:m="October";break;case 10:m="November";break;case 11:m="December"}var e=m+" "+date.getDate()+", "+date.getFullYear();$("#taken_at_"+b).val(c),$("#photo_"+b).find("input.date").val(e)}$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_camera").val()==""&&$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_camera").val(a.camera),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_focal_length").val()==""&&$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_focal_length").val(a.focal_length),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_shutter_speed").val()==""&&$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_shutter_speed").val(a.shutter_speed),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_aperture").val()==""&&$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_aperture").val(a.aperture),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_description").val()==""&&$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_description").val(a.description),$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_name").val()==""&&$("#blog_post_photo_links_attributes_"+b+"_photo_attributes_name").val(a.name)},px.stories.fileLoad=function(a){px.stories.executor("px.stories.disableButtons(true)");var b=a.target.vars.id,c=a.target.vars.file.name+"_"+a.target.vars.file.size;px.stories.executor('px.stories.fileLoadParent("'+b+'", "'+c+'")'),a.target.vars.uid=c,a.target.vars.id=b;try{var d=new FileReader;d.vars=a.target.vars,d.onloadend=px.stories.fileEXIF,d.readAsBinaryString(a.target.vars.file)}catch(e){}px.stories.fileLoadPartTwo(a.target.vars,b,c)},px.stories.fileLoadPartTwo=function(a,b,c){px.stories.executor("px.stories.changed=true");var d=new FormData;d.append("Filedata",a.file),d.append("k",$("#param_k").val()),d.append("ks",$("#param_ks").val());var e=new XMLHttpRequest;px.stories.xhrs[b]=e,e.open("POST","/upload"),e.upload.vars=a,e.upload.addEventListener("progress",px.upload.fileProgress,!1),e.upload.addEventListener("load",px.upload.fileLoaded,!1),e.upload.addEventListener("abort",function(){var a=px.upload.files.indexOf(this.vars.uid);a!=-1&&px.upload.files.splice(a,1)},!1),e.onreadystatechange=function(a){if(e.readyState===4)if(e.status===200){px.upload.filesComplete.push(c);var d=$.parseJSON(e.responseText);$.browser.webkit&&navigator.userAgent.indexOf("Chrome")==-1&&(px.stories.getLoadedEXIF(d.photo,b),px.stories.executor('px.stories.getLoadedEXIF("'+d.photo+'", "'+b+'")')),px.stories.executor('px.stories.fileLoadPartTwoSuccess("'+b+'", "'+c+'", "'+d.photo.id+'")'),px.upload.checkComplete(px.upload.files,px.upload.filesComplete)==1&&px.stories.executor("px.stories.enableButtons(true)")}else px.stories.executor('px.stories.fileLoadPartTwoFailed("'+b+'", "'+c+'", "'+d.photo.id+'")')},e.send(d)},px.stories.fileLoadPartTwoSuccess=function(a,b,c){px.stories.list.push(parseInt(c)),px.upload.filesComplete.push(b),$("#photo_"+a).attr("id","photo_"+c),$("#photo_id_"+a).val(c).attr("id","photo_id_"+c),$("#cropbox_"+a).attr("src","/api/photo/getpath?id="+c+"&s=3").attr("id","cropbox_"+c).siblings(".sub_text").remove()},px.stories.fileLoadPartTwoFailed=function(a,b,c){$("#photo_"+a).append('<div class="wait_overlay"><span>'+b.substr(0,b.lastIndexOf("_"))+' failed to upload. <a d="tryagain">Try again?</a></span></div>');var d=px.upload.files.indexOf(b);d!=-1&&px.upload.files.splice(d,1),$("#tryagain").click(function(){$("#photo_"+a).find(".wait_overlay").remove(),oEvent.originalTarget!=null?px.stories.fileLoadPartTwo(oEvent.originalTarget.upload.vars,a,b):px.stories.fileLoadPartTwo(oEvent.target.upload.vars,a,b)})},px.stories.library.ready=function(){$(".thumb").unbind().click(function(){if($(this).hasClass("disabled"))return!1;var a=px.getId($(this).attr("id"),!0);if($(this).hasClass("selected"))px.stories.list.splice($.inArray(a,px.stories.list),1);else{if(px.stories.list.length>=10)return alert("You have reached the maximum number of photos for this story."),!1;px.stories.list.push(a),px.lightbox.change=!0}$(this).toggleClass("selected")}),$("#stories_library #more").click(function(a){return $(this).html('<img src="/unity/img/spinners/loader-small.gif"/> '),$.ajax({type:"GET",url:$(this).attr("href"),success:function(a){jResult=$(a);var b=a.substr(a.indexOf('<div class="start"></div>')+25);b=b.substr(b,b.indexOf('<div class="end"></div>')),$("#library .photos").append(b),$("#stories_library #more").replaceWith(jResult.find("#more")),px.stories.library.ready()},error:function(a,b,c){}}),a.preventDefault(),!1}),$("#add_to_story").unbind().click(function(){if(px.stories.list.length<=0)return alert("You have not selected any photos."),!1;px.lightbox.change=!1,px.stories.list=px.stories.list.concat(px.stories.listTemp),px.lightbox.close(),px.stories.library.add()}),$.each(px.stories.list,function(a,b){$("#library_photo_"+b).addClass("disabled")})},px.stories.library.open=function(){$("#open_library").click(function(a){a.preventDefault();if($("#lightbox").length>0)return!1;px.stories.executor("px.lightbox.initialize(px.stories.library.display)")})},px.stories.library.display=function(){$("#lightbox_content").addClass("loading").css({"min-height":"200px"}).width("1080px");var a="nolayout";$.ajax({type:"GET",url:"/"+px.stories.user+"/stories/library",data:a}).done(function(a){$("#lightbox_content").removeClass("loading").addClass("complete").prepend(a),px.stories.library.ready()})},px.stories.photos={},px.stories.photos.add=function(a){var b=$($("#file").clone().show().html().toString().replace(/idPlaceholder/g,a));b.find("input").removeAttr("disabled");var c=px.stories.photo_data[a];typeof c!="undefined"&&(b.find("input.title").val(c.name),b.find("textarea.description").val(c.description),b.find("input.taken_at").val(c.taken_at),b.find("input.date").val(c.taken_at_string),b.find("input.camera").val(c.camera),b.find("input.focal-length").val(c.focal_length),b.find("input.aperture").val(c.aperture),b.find("input.shutter-speed").val(c.shutter_speed),b.find("input.latitude").val(c.latitude),b.find("input.longitude").val(c.longitude)),$("#photo_list").append(b),$("#cropbox_"+a).attr("src","/api/photo/getpath?id="+a+"&s=3");var d=$("#map_latitude_"+a).val(),e=$("#map_longitude_"+a).val(),f={latitude:20,longitude:-30,zoom:1,element:"map_"+a,disableUi:!1,mapTypeControl:!1,callback:px.map.uploadMap,callbackSettings:{inputLatitude:$("#map_latitude_"+a),inputLongitude:$("#map_longitude_"+a),removeElement:$("#map_remove_"+a)}};d!=""&&e!=""&&(f.latitude=d,f.longitude=e,f.zoom=7,f.markers=[{latitude:d,longitude:e}]),px.map.initialize(f),px.datepicker($("#photo_"+a).find("input.date"),"#taken_at_"+a)},px.stories.library.add=function(){$.each(px.stories.list,function(a,b){$("#photo_"+b).length==0?px.stories.photos.add(b):$("#photo_"+b).show().fadeTo(500,1).find("input.delete_this").val(0)}),$("#photo_list").sortable("destroy"),px.stories.sortable(),px.stories.allowPublish(),px.stories.changed=!0},px.stories.preview={},px.stories.preview.open=function(){return px.lightbox.initialize(px.stories.preview.initialize,{}),!1},px.stories.preview.initialize=function(){$("#lightbox_content").addClass("loading").css({"min-height":"200px"}).width("1200px");var a="nolayout=1";$.ajax({type:"POST",url:window.location.pathname.split("/").slice(0,3).join("/")+"/preview?nolayout=1",data:$("form#stories_new").serialize()}).done(function(a){$("#lightbox_content").removeClass("loading").addClass("complete").prepend(a),px.stories.preview.ready()})},px.stories.preview.ready=function(){$("#back_to_editing").click(function(){px.lightbox.change=!1,px.lightbox.close()}),$("#preview_publish").click(function(){px.lightbox.change=!1,px.lightbox.close(),$("#publish").trigger("click")}),px.stories.changeFontSize()},px.stories.allowPublish=function(){},px.stories.sortable=function(){$("#photo_list").sortable({axis:"y",handle:".handle",scollSpeed:120,placeholder:"ui-sortable-placeholder",forceHelperSize:!0,forcePlaceholderSize:!0,update:function(a,b){px.stories.updatePhotoOrder()},start:function(a,b){$("body").addClass("unselected"),$(this).sortable("refreshPositions")},stop:function(a,b){$("body").removeClass("unselected"),$(this).find(".story_photo")}})},px.stories.updatePhotoOrder=function(){},px.stories.removePhoto=function(a){var b=$("#photo_"+a);px.stories.list.splice($.inArray(a,px.stories.list),1),px.upload.files.splice($.inArray(a,px.upload.files),1),px.upload.filesComplete.splice($.inArray(a,px.upload.filesComplete),1),b.fadeTo(500,1e-4,function(){b.effect("blind",{},500,function(){b.find(".delete_this").length>0?(b.find(".delete_this").val("1"),b.hide()):b.remove(),$(b).next("input")>0&&$(b).next("input").remove(),px.stories.updatePhotoOrder()})}),px.stories.allowPublish()},px.stories.map=function(a){var b=a.lat,c=a.lng,d=a.id,e=$("#photo_"+d+" .exif").width()-2,f='<img src="http://maps.googleapis.com/maps/api/staticmap?center='+b+","+c+"&zoom=5&size="+e+"x"+e+"&maptype=roadmap&markers=color:red%7Ccolor:red%7C"+b+","+c+'&sensor=false" />';$("#photo_"+d+" .map").html(f),$("#photo_"+d+" .location a").click(function(){$("#photo_"+d+" .map").toggle()})},px.stories.disableButtons=function(a){a==1&&($("#upload_message").fadeIn(),$("#lightbox_wait_loader").fadeIn()),$("#preview").addClass("disabled").attr("disabled","disabled"),$("#publish").addClass("disabled").attr("disabled","disabled")},px.stories.enableButtons=function(a){a==1&&($("#upload_message").fadeOut(),$("#lightbox_wait_loader").fadeOut()),$("#preview").removeClass("disabled").removeAttr("disabled"),$("#publish").removeClass("disabled").removeAttr("disabled")},px.stories.map_static=function(a){var b=a.lat,c=a.lng,d=a.id,e=a.type,f=$("#preview_photo_"+d+" .exif").width()-2;e=="landscape"&&f<198&&(f=198),e=="portrait"&&f>200&&(f=200);var g='<img src="http://maps.googleapis.com/maps/api/staticmap?center='+b+","+c+"&zoom=6&size="+f+"x"+f+"&maptype=roadmap&markers=color:red%7Ccolor:red%7C"+b+","+c+'&sensor=false" />',h='<a href="http://maps.google.com/maps?ll='+b+","+c+"&spn=0.1,0.1&t=m&z=12&q="+b+","+c+'" target="_blank">'+g+"</a>";$("#preview_photo_"+d+" .map").html(h),$("#preview_photo_"+d+" .location a").click(function(){$("#preview_photo_"+d+" .map").toggle()})},px.stories.changeFontSize=function(){$("#stories .font_sizes a").click(function(){var a=$(this).attr("title");$(this).addClass("active").siblings().removeClass("active"),$("#stories").removeClass("font_small font_medium font_large").addClass(a),$.cookie("story_font_size",a,{path:"/"})})},px.stories.photo_data={},px.cookies={init:function(){var a,b;$.browser.chrome?(a="chrome",b="Chrome"):$.browser.safari?(a="safari",b="Safari"):$.browser.opera?(a="opera",b="Opera"):$.browser.msie?(a="msie",b="Internet Explorer"):$.browser.mozilla&&(a="firefox",b="Firefox"),$(".browser_human_name").html(b),a&&$("#steps_"+a).addClass("display")},check:function(){px.are_cookies_enabled()?$(".continue_button:visible").removeClass("disabled"):setTimeout(px.cookies.check,1e3)},display_flash_if_cookies_are_not_enabled:function(){if(px.are_cookies_enabled()){var a,b=window.location.search.replace(/^\?/,""),c=b.split("&");_.each(c,function(b){param_parts=b.split("="),param_parts[0]=="r"&&(a=decodeURIComponent(param_parts[1]))}),a?window.location.href=a:window.location.href="/"}else $("#recheck-cookies").removeClass("noshow"),px.error(pxLocales.pages.cookies.cookies_are_still_not_enabled)}},on_page("cookies_check",px.cookies.display_flash_if_cookies_are_not_enabled),on_page("cookies_index, cookies_check",px.cookies.init),px.flow={},px.flow.host="",px.flow.count=0,px.flow.initialize=function(){$("#flow a#more").click(px.flow.loadMore),$("#flow img").each(function(){var a=$(this);a.hide(),a.load(function(){a.show()})}),px.flow.preventDragging(),px.flow.fixDisoriented(),$(window).unbind().scroll(function(a){var b=$(window).height()+$(window).scrollTop()>=$(document).height()-700,c=$("#flow a#more").data("page");b&&c%5!=0&&$("#flow a#more").trigger("click")});var a=function(){if($(window).height()+$(window).scrollTop()>=$(document).height()-100)$("#flow a#more").trigger("click");else return!0};px.hotkeys.initialize({space:a})},px.flow.loadMore=function(a){return $(this).hasClass("disabled")?(a.preventDefault(),a.stopPropagation(),!1):($(this).html('<img src="/unity/img/spinners/loader-small.gif"/> '),$(this).addClass("disabled"),px.flow.requestMore($(this).attr("href")),a.preventDefault(),!1)},px.flow.requestMore=function(a){$.ajax({type:"GET",url:px.site_url(a,px.flow.host),xhrFields:{withCredentials:$.support.cors},success:function(a){var b=$(a);b.find("img").each(function(){var a=$(this);a.hide(),a.load(function(){a.fadeIn()})}),$("#building-flow").fadeOut(),$("#flow #more").before(b.find("div.row")),$("#flow #more").replaceWith(b.find("#more")),$("#flow a#more").unbind().click(px.flow.loadMore),px.flow.fixDisoriented()}})},px.flow.preventDragging=function(){$("#flow img").live("mousedown",function(a){return!1})},px.flow.fixDisoriented=function(){$("#flow img").load(function(){px.flow.fixDisorientedPartTwo($(this))}).each(function(){this.complete&&$(this).load()})},px.flow.fixDisorientedPartTwo=function(a){if($(a).attr("src").indexOf("4.jpg")>0&&$(a).hasClass("disoriented")){var b=px.flow.count;px.flow.count++;var c='<div id="temp'+b+'" style="position: absolute; left:10px; top: 10px; z-index:-1000;"></div>';$("body").append(c);var d=$(a).parent().height(),e=$(a).parent().width();$("#temp"+b).html($(a).clone());var f=$("#temp"+b).find("img").height(),g=$("#temp"+b).find("img").width(),h=$(a).closest(".box").attr("class").split(" ")[1],i=$(a).closest(".image").attr("class").split(" ")[2],j=0;$("#temp"+b).remove();if(h=="large"||h=="tall")h=="large"&&i=="three"?(className="landscape",css={left:Math.round((e-g/f*d)/2)+"px"}):h=="tall"&&i=="one_long"?(className="portrait",css={left:Math.round((e-g/f*d)/2)+"px"}):g==0||f==0?(className="unknown",css={}):g/f>1.1?(className="landscape",css={left:Math.round((e-g/f*d)/2)+"px"}):g/f<.9?(className="portrait",css={top:-1*Math.round((f-441)/4)+"px"}):(className="square",css={});else if(h=="wide")g==0||f==0?(className="unknown",css={}):g/f>1?(className="landscape",j=-1*Math.round((f-441)/4),j>0&&(j=0),css={top:j+"px"}):g/f<1?(className="portrait",css={top:-1*Math.round((f-441)/4)+"px"}):(className="square",j=Math.round((f-441)/4),j>0&&(j*=-1),css={top:j+"px"});else if(h=="super_wide"||h=="extra_wide")if(i=="one"){className="landscape";var k=-1*Math.round((f-441)/2);k>0&&(k=0),css={top:k+"px"}}else i=="four"&&g/f<1?(className="portrait",j=(e-g/f*d)/2,j>0?(className="skinny",css={top:-1*Math.round(j)+"px"}):css={left:Math.round(j)+"px"}):g==0||f==0?(className="unknown",css={}):g/f>1?(className="landscape",css={left:Math.round((e-g/f*d)/2)+"px"}):g/f<1?(className="portrait",css={top:-1*Math.round((e-g/f*d)/2)+"px"}):(className="square",css={});$(a).removeClass("disoriented").addClass(className+" changed").css(css)}},px.activities={},px.activities.host="",px.activities.initialize=function(){},px.activities.loadMore=function(a){return $(this).hasClass("disabled")?(a.preventDefault(),a.stopPropagation(),!1):($(this).html('<img src="/unity/img/spinners/loader-small.gif"/> '),$(this).addClass("disabled"),px.activities.requestMore($(this).attr("href")),a.preventDefault(),!1)},px.activities.requestMore=function(a){nextPagePosition=$("#more").offset().top,$.ajax({type:"GET",url:px.site_url(a,px.activities.host),xhrFields:{withCredentials:$.support.cors},success:function(a){$("#building-flow").fadeOut(),jResult=$(a),$("#activities #more").before(jResult.find("div.activity")),$("#activities #more").replaceWith(jResult.find("#more")),$("#activities #more").not(".noact").unbind().click(px.activities.loadMore),$(document.body).animate({scrollTop:nextPagePosition},333)}})},px.tour={},px.tour.initialize=function(a){var b={url:"/organizer/tour"},c=$.extend(b,a);$("#lightbox_content").addClass("loading").css({"min-height":"410px"}).width("800px"),px.tour.length=0,px.tour.current=1,px.tour.clickable=!0,px.tour.width=0,$.ajax({type:"GET",url:c.url,data:"nolayout"}).done(function(a){$("#lightbox_content").removeClass("loading").addClass("complete").prepend(a),px.tour.ready()})},px.tour.ready=function(){px.tour.length=$("#tour .slide").length,px.tour.width=$("#tour .slide").width(),$("#tour .slides").width(px.tour.width*px.tour.length),$("#tour_next").click(function(){px.tour.next()}),$("#tour_previous").click(function(){px.tour.prev()})},px.tour.next=function(){px.tour.clickable==1&&px.tour.current<px.tour.length&&($(".slides").animate({left:"-="+px.tour.width},667,"easeOutCubic",function(){px.tour.clickable=!0}),px.tour.clickable=!1,px.tour.current++,px.tour.current==px.tour.length?$("#tour_next").addClass("hidden"):$("#tour_previous").removeClass("hidden"))},px.tour.prev=function(){px.tour.clickable==1&&px.tour.current>1&&($(".slides").animate({left:"+="+px.tour.width},667,"easeOutCubic",function(){px.tour.clickable=!0}),px.tour.clickable=!1,px.tour.current--,px.tour.current==1?$("#tour_previous").addClass("hidden"):$("#tour_next").removeClass("hidden"))},px.market={init_slider:function(){$("#cat-bestsellers .images").cycle({fx:"fade",speed:1e3,timeout:5e3,after:function(){$("#cat-just_sold .images").cycle("next")}}),$("#cat-just_sold .images").cycle({fx:"fade",speed:1e3,timeout:0,after:function(){$("#cat-new_arrivals .images").cycle("next")}}),$("#cat-new_arrivals .images").cycle({fx:"fade",speed:1e3,timeout:0})},banner:{content:[],pgrid_size:9,rotation_position:0,init:function(){$("#market-banner-container .photo").each(function(a,b){px.market.banner.rotate(),$(b).fadeIn()}),px.market.banner.preloadImages(),setInterval(px.market.banner.rotate,4e3)},rotate:function(){px.market.banner.rotation_position+=1;var a=px.market.banner.content.shift(),b=$("#p"+px.market.banner.rotation_position);b.fadeOut("fast",function(){px.market.banner.assign_data(b,a),b.fadeIn("slow")}),px.market.banner.content.push(a),px.market.banner.rotation_position>px.market.banner.pgrid_size&&(px.market.banner.rotation_position=0)},preloadImages:function(){preloadedImage=new Array,$.each(px.market.banner.content,function(a,b){_.each(_.keys(b),function(c){c=="data-photo-thumb-url"&&(preloadedImage[a]=new Image,preloadedImage[a].src=b[c])})})},assign_data:function(a,b){_.each(_.keys(b),function(c){a.data(c.replace("data-",""),b[c])});var c=a.data("photo-name")+" by "+a.data("photo-author-name");a.find("a").attr({href:"#flyout-"+a.data("photo-id"),title:c}),a.find("img").attr({src:a.data("photo-thumb-url"),alt:c})}},init_flyover_links:function(){$("#market_set, #market_category, #market_search, #market_favorites").delegate("#market .photo_thumb .photo > a, #market .photo_thumb .title a","click",px.market.open_flyover),$("#market_index").delegate("#market-banner-container .photo a","click",px.market.open_flyover)},open_flyover:function(a){var b=$(this),c=$($(this).parents(".photo").get(0)),d=null,e=c.data("photo-name");e.length>24&&(e=e.substr(0,18)+"...");var f=c.data("photo-author-name");return f.length>16&&(f=f.substr(0,14)+"..."),d={photo_id:c.data("photo-id"),photo_name:e,photo_author_name:f,photo_author_username:c.data("photo-author-username"),photo_thumb_url:c.data("photo-thumb-url")},px.market.flyover_lightbox.init({template_settings:d}),!1},flyover_lightbox:{init:function(a){var b={url:"#"},c=$.extend(b,a);px.lightbox.initialize(px.market.flyover_lightbox.initialized,c)},initialized:function(a){var b=_.template($("#market-flyover-template").html(),a.template_settings);$("#lightbox_content").css("width","680px"),$("#lightbox_content").css("height","532px"),$("#lightbox_content").addClass("complete").prepend(b),px.market.flyover_lightbox.ready()},ready:function(){$(".wallcontrols #flyover_mode_photo").click(px.market.flyover_lightbox.switch_to_photo),$(".wallcontrols #flyover_mode_wall").click(px.market.flyover_lightbox.switch_to_wall)},switch_to_photo:function(){$("#flyover_mode_photo").addClass("selected"),$("#flyover_mode_wall").removeClass("selected"),$(".photoview img").removeClass("photo-wall"),$(".the-wall").fadeOut()},switch_to_wall:function(){$("#flyover_mode_photo").removeClass("selected"),$("#flyover_mode_wall").addClass("selected"),$(".photoview img").addClass("photo-wall"),$(".the-wall").fadeIn()}},init_more:function(){$("#more").live("click",px.market.more),$(window).scroll(function(a){var b=$(window).height()+$(window).scrollTop()>=$(document).height()-500;b&&$("#more:not(.disabled)").trigger("click")}),$(".sharing").each(function(a,b){var c=$(b).data("id")||"",d=$(b).data("url")||document.location.href;px.market.load_sharelizer_count(d,c)})},load_sharelizer_count:function(a,b){$("#fbbutton"+b).length&&px.sharelizers.fb.count(a,b),$("#twbutton"+b).length&&px.sharelizers.tw.count(a,b),$("#pinbutton"+b).length&&px.sharelizers.pin.count(a,b)},more:function(){var a=$(this);return $(a).addClass("loading disabled"),$.getJSON($(this).attr("href")+"&nolayout=true",function(b){$.each(b.items,function(b,c){var d=$(a).prev(".clear").before(c.html).prev().hide();$(d).fadeIn("slow"),c.type=="set"&&px.market.load_sharelizer_count(c.url,c.id)});if(b.current_page>=b.total_pages)$(a).fadeOut("fast",function(){$(this).remove()});else{var c=$(a).attr("href").replace(/page=\d+/g,"page="+(b.current_page+1));$(a).attr("href",c).removeClass("loading disabled")}}),!1},template:'<div class="lighttext"><div class="market_set_name"><strong><a href="#" class="add_photo_to_this_market_set" data-set-id="{{id}}">{{title}}</a></strong></div> {{photos_count}} photos <em>({{status_string}})</em></div>',init_add_photo_to_mark_set_links:function(){$("body").delegate("a.add_photo_to_market_set_link","lightbox:opened",px.market.add_to_set_lightbox).delegate("a.add_photo_to_this_market_set","click",px.market.add_photo_to_this_set)},add_to_set_lightbox:function(){$.get("/admin/store/market_photo_sets.json",{},px.market.load_photo_sets_into_lightbox)},load_photo_sets_into_lightbox:function(a){$("#lightbox_content").html('<div id="admin_photo_sets_list"></div>');var b=
$("#admin_photo_sets_list"),c=_.template(px.market.template);_.each(a,function(a){b.append(c(a))})},current_photo_id:function(){return window.location.href.match(/\/photo\/(\d+)/)[1]},add_photo_to_this_set:function(){var a=$(this).attr("data-set-id"),b=px.market.current_photo_id;$.ajax("/admin/store/market_photo_sets/"+a+"/photos",{type:"post",data:{photo_id:b},success:px.market.photo_was_added_to_set,error:px.market.photo_was_not_added_to_set})},photo_was_added_to_set:function(){px.lightbox.close(),px.messages.create({type:"success",message:"Photo was added to the set"})},photo_was_not_added_to_set:function(){px.lightbox.close(),px.error("Photo could not be added to the set. Maybe it's already in the set.")}},on_page("market_index",px.market.init_slider),on_page("market_index",px.market.banner.init),on_page("market_index",px.market.init_flyover_links),on_page("market_sets",px.market.init_more),on_page("market_category",px.market.init_flyover_links),on_page("market_category",px.market.init_more),on_page("market_set",px.market.init_more),on_page("market_set",px.market.init_flyover_links),on_page("market_favorites",px.market.init_more),on_page("market_favorites",px.market.init_flyover_links),on_page("market_search",px.market.init_flyover_links),on_page("market_search",px.market.init_more),on_page("photo_show",px.market.init_add_photo_to_mark_set_links),px.signup={username:null,templates:{},init:function(){$("#signup_step_1").delegate("form#user_new","ajax:beforeSend",delegate_chain(px.signup.form.validate_fields,px.signup.form.fade_out_only)).delegate("form#user_new","ajax:error",px.signup.form.errors_from_server).delegate("form#user_new","ajax:success",delegate_chain(px.signup.form.user_from_server,px.signup.step2.show,px.signup.step2.populate_user_details)).delegate("form#user_new .validatable","keydown",px.signup.form.clear_error).delegate("form#user_new #user_password","blur",px.signup.form.validate_field).delegate("form#user_new #user_email","blur",delegate_chain(px.signup.form.validate_field,px.signup.form.email_available)).delegate("form#user_new #user_email","keydown",px.signup.form.cancel_email_available).delegate("a[data-oauth-provider-login]","oauth:loggedIn",delegate_chain(px.signup.form.fade_out)).delegate("a[data-oauth-provider-login]","oauth:loginFailed",delegate_chain(px.signup.form.hide_loading,px.signup.form.show_oauth_error)),$("#signup_step_2").delegate("a[data-friend-finder-provider]","friend_finder:loggingIn",px.signup.findfriends.show_loader).delegate("a[data-friend-finder-provider]","friend_finder:complete",px.signup.findfriends.hide_loader).delegate("a[data-friend-finder-provider]","friend_finder:success",delegate_chain(px.signup.findfriends.show,px.signup.findfriends.hide_button)).delegate("form#avatar_form","submit",px.signup.step2.upload_avatar).delegate("form#avatar_form #avatar","change",px.signup.step2.submit_avatar_form).delegate("li.found_friend a.follow_user","ajax:beforeSend",px.signup.findfriends.show_loader_button).delegate("li.found_friend a.follow_user","ajax:error",px.signup.findfriends.hide_loader_button).delegate("li.found_friend a.follow_user","ajax:success",px.signup.findfriends.show_now_following_text).delegate("#finish_step2","click",delegate_chain(px.signup.step2.submit_form,px.signup.step2.show_loader)).delegate("form#signup_details_form","ajax:success",delegate_chain(px.signup.step2.redirect,px.signup.step3.show)).delegate("form#signup_details_form","ajax:error",delegate_chain(px.signup.step2.hide_loader)).delegate("form#signup_details_form #user_username","keydown",delegate_chain(px.signup.step2.clear_username_error,px.signup.step2.cancel_username_available)).delegate("form#signup_details_form #user_username","keyup",px.signup.step2.update_username).delegate("form#signup_details_form #user_username","blur",delegate_chain(px.signup.step2.validate_username,px.signup.step2.username_available)),$("body#registrations_welcome").delegate("a.follow_user","ajax:beforeSend",px.signup.recommended_followers.show_follow_loading).delegate("a.follow_user","ajax:error",px.signup.recommended_followers.hide_follow_loading).delegate("a.follow_user","ajax:success",px.signup.recommended_followers.following).delegate(".user-suggestion a.remove","click",px.signup.step3.change_follower),$(".field_with_errors").each(function(a,b){$(b).replaceWith($(b).html())}),$("body").addClass("compare-bg"),$(".user-suggestion").last().addClass("last"),px.signed_in&&($("#signup_step_2").addClass("display"),$(".user_username").html(px.signup.username),px.signup.twitter&&px.signup.step2.load_friends({provider:"twitter"}),px.signup.facebook&&px.signup.step2.load_friends({provider:"facebook"}))},check_if_cookies_are_enabled:function(){px.are_cookies_enabled()||px.messages.create({type:"error",message:"You must have cookies enabled to signup."})},recommended_followers:{following:function(){$(this).nextAll(".follow_loader").remove(),$(this).nextAll(".follow_complete").removeClass("noshow"),$(this).remove()},hide_follow_loading:function(){$(this).removeClass("loading")},show_follow_loading:function(){$(this).hide(),$(this).nextAll(".follow_loader").removeClass("noshow")}},step3:{recommended_followers:[],show:function(){window.location.href="/signup/welcome"},change_follower:function(a){var b=$(this).closest(".user-suggestion");px.signup.step3.recommended_followers.length<=1&&$(".user-suggestion a.remove").remove(),b.animate({opacity:0},500,function(){var a=px.signup.step3.recommended_followers.shift();b.replaceWith(a),px.signup.step3.recommended_followers.length<=1&&$(".user-suggestion a.remove").remove(),$(".user-suggestion").last().addClass("last")}),a.preventDefault()}},findfriends:{show_now_following_text:function(){var a=$("<img />",{src:"/unity/img/icons/grey/large/checkmark.png","class":"right now_following"});$(this).nextAll(".follow_loader").remove(),$(this).replaceWith(a)},show_loader_button:function(){$(this).hide(),$(this).nextAll(".follow_loader").removeClass("noshow")},hide_loader_button:function(){$(this).show(),$(this).nextAll(".follow_loader").addClass("noshow")},show:function(a){var b=a.contacts.found;if(b.length==0)return $(this).closest(".friendfinder_button").addClass("no_friends"),!1;var c=_.template(px.signup.templates.friend),d=$(this).closest("li").next("li.friend_finder_results").find("ul");_.each(b,_.bind(px.signup.findfriends.add_friend,this,c,d)),d.closest("li.friend_finder_results").addClass("display")},add_friend:function(a,b,c){b.append(a({full_name:c.name,username:c.user.user.username||"",provider_username:c.username||"",image:c.picture}))},hide_button:function(){$(this).closest(".friendfinder_button").hide()},show_loader:function(){$(this).closest(".friendfinder_button").addClass("loading")},hide_loader:function(){$(this).closest(".friendfinder_button").removeClass("loading")}},step2:{update_username:function(){var a=$(this).val();a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),$(".user_username").html(a)},redirect:function(){var a=$("#redirect_to").val()||"";if(a.length>0&&a!="/"&&a!="/flow")return window.location.href=a,!1},submit_avatar_form:function(){$("form#avatar_form").submit()},submit_form:function(){$("#signup_step_2 form#signup_details_form").trigger("submit.rails")},show_loader:function(a){var b=$(this).closest("#step_2_wrapper").find("#finish_step2_wrapper").addClass("loading");a.preventDefault()},hide_loader:function(a){var b=$(this).closest("#step_2_wrapper").find("#finish_step2_wrapper").removeClass("loading");a.preventDefault()},load_friends:function(a){var b=$('a[data-friend-finder-provider="'+a.provider+'"]');px.signup.findfriends.show_loader.call(b),px.friend_finder.find_friends(a.provider,b)},check_if_new_user:function(a){if(!a.user.was_created)return $("#redirect_to").val()!=""?window.location.href=$("#redirect_to").val():window.location.href="/",!1},show:function(){$(".sign-up-step").removeClass("display"),$("#signup_step_2").css({opacity:0}).addClass("display").animate({opacity:1},500)},populate_user_details:function(a){$("#user_firstname").val(a.user.firstname||""),$("#user_lastname").val(a.user.lastname||""),$("#user_username").val(a.user.username),$("#user_about").val(a.user.about||""),$("#signup_step_2 .user_username").html(a.user.username)},upload_avatar:function(){return $(this).find('input[type="file"]').val()==""?!1:($(this).ajaxSubmit({dataType:"json",beforeSubmit:px.signup.step2.upload_avatar_loader,success:px.signup.step2.upload_avatar_success}),!1)},upload_avatar_loader:function(){$(".pick-avatar").addClass("loading"),$(".pick-avatar .loader").show()},check_avatar_version:function(a){$.get("/settings/avatar_version",function(b){if(b.version!=a){var c=$(".pick-avatar .user-photo");c.attr("src",b.url),c.attr("data-version",b.version),$(".pick-avatar").removeClass("loading"),$(".pick-avatar .loader").hide()}else setTimeout(_.bind(px.signup.step2.check_avatar_version,this,a),500)})},upload_avatar_success:function(a){if(a.success){var b=$(".pick-avatar .user-photo"),c=b.attr("data-version");px.signup.step2.check_avatar_version(c)}else $(".pick-avatar").removeClass("loading"),$(".pick-avatar .loader").hide(),a.avatar_error?px.messages.create({type:"error",message:pxLocales.registration.avatar_failed}):px.messages.create({type:"error",message:"Sorry, the avatar was not uploaded. Please try again."})},username_available_xhr:null,username_available:function(){var a=$(this).parents("form"),b=a.find("#user_username"),c=a.find("#user_email");px.signup.step2.username_available_xhr=$.get(px.site_url("/signup/username_available/"+b.val()),px.signup.step2.set_availability)},cancel_username_available:function(){px.signup.step2.username_available_xhr&&px.signup.step2.username_available_xhr.abort()},set_availability:function(a){if(a.success){$("#user_username").addClass("valid");return}px.signup.step2.clear_username_error();var b=$("<div />",{"class":"error",text:pxLocales.registration.username_taken,style:"display: none;"});$("#user_username").addClass("invalid").after(b),b.slideDown()},clear_username_error:function(){$("#user_username").removeClass("invalid"),$("#user_username").next(".error").remove()},validate_username:function(){px.signup.step2.clear_username_error();var a=$(this),b=null;if(a.val()=="")return;a.val().length<4||a.val().length>35?b=$("<div />",{"class":"error",text:"Username must be between 4 and 35 characters"}):a.val().match(/^[a-z0-9_\-]+$/i)||(b=$("<div />",{"class":"error",text:"Username can only contain letters, numbers, _ and -"}));if(b!=null)return $(this).after(b),b.slideDown(),$(this).addClass("invalid"),!1}},form:{show_oauth_error:function(){px.error("There was a problem with your login attempt. Check your login details and try again.")},email_available_xhr:null,email_available:function(){var a=$(this).parents("form"),b=a.find("#user_username"),c=a.find("#user_email");px.signup.form.email_available_xhr=$.get(px.site_url("/signup/email_available/"),{email:c.val()},px.signup.form.set_availability)},cancel_email_available:function(){px.signup.form.email_available_xhr&&px.signup.form.email_available_xhr.abort()},clear_error:function(){$("#"+this.id+"_error").remove(),$(this).removeClass("invalid").removeClass("valid")},add_error:function(a,b){$("#user_"+a+"_error").remove(),$("#user_"+a).after($("<div />",{id:"user_"+a+"_error","class":"error",text:b,style:"display: none;"})),$("#user_"+a+"_error").slideDown(),$("#user_"+a).addClass("invalid")},set_availability:function(a){if(a.success){$("#user_"+a.success).addClass("valid");return}for(var b in a.errors){var c=a.errors[b];px.signup.form.add_error(b,c)}},user_from_server:function(a,b){if(b.success)a.user=b.user;else return!1},errors_from_server:function(a,b){var c=JSON.parse(b.responseText);px.signup.form.set_availability(c),$("#signup_step_1").addClass("display").find(".content").css("opacity",1),$("#signup_step_1").find("a,button").show(),$(".sign-up-step_2").removeClass("display")},validate_fields:function(a){var b=["email","password"],c,d=!0;while(c=b.shift()){var e=px.signup.form.validate.call(this,c);e!==!0&&(px.signup.form.add_error(c,e),d=!1)}return d},validate_field:function(a){if($(this).val()=="")return!1;var b=this.id.split("_")[1],c=px.signup.form.validate.call($(this).parents("form"),b);if(c!==!0)return px.signup.form.add_error(b,c),!1},validate:function(a){var b=$(this),c=b.find("#user_password"),d=b.find("#user_username"),e=b.find("#user_email");if(a=="email"){if(!e.val().match(/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i))return"Invalid email address"}else if(a=="password")if(c.val().length<6||c.val().length>64)return"Must be between 6 and 64 characters";return!0},fade_out:function(a){var b=$(this).parents(".sign-up-step");b.find(".content").animate({opacity:0},250,_.bind(px.signup.form.show_loading,this,a))},fade_out_only:function(a){var b=$(this).parents(".sign-up-step");b.find(".content").animate({opacity:0},250,function(){b.addClass("loading"),b.find("a, button").hide()})},show_loading:function(a){var b=$(this).parents(".sign-up-step");b.find("a, button").hide(),b.addClass("loading"),_.delay(delegate_chain(px.signup.step2.check_if_new_user,px.signup.step2.show,px.signup.step2.populate_user_details,px.signup.step2.load_friends),500,a)},hide_loading:function(){var a=$(this).parents(".sign-up-step");a.find(".content").stop(),a.find(".content").css({opacity:1}),a.find("a, button").show(),a.removeClass("loading")}}},on_page("registrations_new, registrations_create",px.signup.check_if_cookies_are_enabled),on_page("registrations_new, registrations_create, registrations_welcome, registrations_profile, registrations_about",px.signup.init),px.settings={init:function(){$("body#settings_index").delegate("a[data-oauth-provider-login]","oauth:loggedIn",px.settings.oauth_connected),$("#subscription_info").delegate("a#cancel_subscription","ajax:beforeSend",delegate_chain(Helper.stop_if_has_loading_class,Helper.show_loader)).delegate("a#cancel_subscription","ajax:success",px.settings.subscription.cancelled).delegate("a#cancel_subscription","ajax:complete",Helper.hide_loader).delegate("a#cancel_subscription","ajax:error",px.settings.subscription.error_cancelling).delegate("a#change_payment_method","click",px.settings.subscription.toggle_change_method_form).delegate("select#payment_profile_id","change",px.settings.subscription.show_card_changed),$("input:checkbox:visible").checkbox(),$(".g1 .controls").equalHeights(),$(".g2 .controls").equalHeights(),$("body").delegate("#lightbox_content .payment_profile_form","paymentProfile:newCard",px.settings.subscription.add_new_card);var a=$(".avatar_is_loading");if(a.length>0){var b=a.attr("data-version");$.get("/settings/avatar_version",_.bind(px.settings.check_avatar_version,this,b))}},check_avatar_version:function(a,b){if((b.version||0)!=a){var c=$('<img src="'+b.url+'" id="user_photo" class="avatar" height="100" width="100" /><br>');$(".avatar_is_loading").replaceWith(c),$("#header #username .img img").attr("src",b.small_url)}else setTimeout(function(){$.get("/settings/avatar_version",_.bind(px.settings.check_avatar_version,this,a))},500)},subscription:{show_card_changed:function(){$("#subscription_info .card_explanation").hide(),$("#subscription_info .card_explanation_changed").removeClass("noshow")},add_new_card:function(a){$("#subscription_info").html(a.card_data.settings_html),$("#subscription_info .change_payment_profile").removeClass("noshow").show(),px.settings.subscription.show_card_changed()},toggle_change_method_form:function(){$("#subscription_info .change_payment_profile").hasClass("noshow")&&$("#subscription_info .change_payment_profile").hide().removeClass("noshow"),$("#subscription_info .change_payment_profile").stop().slideToggle(function(){$(this).css("height","auto")})},cancelled:function(){$("#subscription_info .not_cancelled").hide(),$("#subscription_info .you_have_cancelled").removeClass("noshow")},error_cancelling:function(a,b){px.messages.create({type:"error",message:pxLocales.settings.index.error_cancelling_subscription})}},oauth_connected:function(){window.location.reload()}},on_page("settings_index",px.settings.init),px.photos={next_id:null,prev_id:null,initialize_show:function(){px.hotkeys.initialize({f:px.photos.favorite,l:px.photos.like,right:px.photos.next,k:px.photos.next,j:px.photos.prev,left:px.photos.prev,m:px.photos.userNext,n:px.photos.userPrev}),px.photos.loadMorePhotos(),px.photos.store.preorder.initialize(),px.photos.store.quickEnable.initialize(),px.photos.check_for_social_referrer(),px.photos.vote_controls.load_voted_faved_state(),$("#sidebar").delegate("a.dislike_link","ajax:beforeSend",delegate_chain(px.photos.vote_controls.check_if_reason_is_needed,px.photos.vote_controls.photo_liked)).delegate("a.vote_button.like","ajax:beforeSend",px.photos.vote_controls.photo_liked).delegate("a.vote_button.like a.dislike_link","ajax:error",px.photos.vote_controls.error_saving_vote).delegate("a.vote_button.like, a.dislike_link","ajax:success",delegate_chain(px.photos.vote_controls.handle_errors,px.photos.vote_controls.show_negative_vote_form,px.photos.vote_controls.update_values)).delegate("a.favorite_button","ajax:before",px.photos.vote_controls.set_favorite_path).delegate("a.favorite_button","ajax:beforeSend",delegate_chain(px.photos.vote_controls.ensure_single_favorite_xhr,px.photos.vote_controls.photo_favorited)).delegate("a.favorite_button","ajax:success",px.photos.vote_controls.update_values).delegate("#negative_vote_form form","ajax:beforeSend",delegate_chain(px.photos.vote_controls.hide_negative_vote_form,px.photos.vote_controls.photo_liked)).delegate("#negative_vote_form form","ajax:error",delegate_chain(px.photos.vote_controls.show_negative_vote_form,px.photos.vote_controls.error_saving_vote)).delegate("#negative_vote_form form","ajax:success",delegate_chain(px.photos.vote_controls.handle_errors,px.photos.vote_controls.show_negative_vote_form,px.photos.vote_controls.update_values)).delegate("#negative_vote_form form .cancel","click",px.photos.vote_controls.hide_negative_vote_form),$("#sm-enticement").delegate("a[data-oauth-provider-login]","oauth:loggedIn",px.photos.smenticement.logged_in).delegate("a[data-oauth-provider-login]","oauth:loginFailure",px.photos.smenticement.failed)},perform_action:function(){px.photos.perform_action_after_loading=="favorite"?$(".vote_fav_wrap .favorite_button.in_favorites").length==0&&px.photos.favorite():px.photos.perform_action_after_loading=="like"&&px.photos.like()},vote_controls:{check_if_reason_is_needed:function(){if(px.photos.needs_to_explain_negative_vote)return px.photos.vote_controls.show_negative_vote_form(!0,{needs_reason:!0}),!1},hide_negative_vote_form:function(a){$("#negative_vote_form").slideUp(),a.preventDefault(),a.stopPropagation()},show_negative_vote_form:function(a,b){b.needs_reason&&($("#negative_vote_form").slideDown(),px.photos.vote_controls.reset_controls())},reset_controls:function(){var a=$(".card .vote_fav_controls");a.find(".vote_button.like").addClass("display"),a.find(".voted_button").removeClass("display"),a.find(".dislike_wrap").show()},ensure_single_favorite_xhr:function(a,b){px.photos.favorite_xhr&&(px.photos.favorite_xhr.abort(),px.photos.favorite_xhr=null),px.photos.favorite_xhr=b},photo_favorited:function(){$(this).toggleClass("in_favorites")},set_favorite_path:function(){var a=$(this).attr("data-photo-id"),b;$(this).hasClass("in_favorites")?b="remove":b="add";var c=$(this).attr("href").replace(/\?.*$/,"");$(this).attr("href",c+"?do="+b+"&photo_id="+a)},handle_errors:function(a,b){if(b.error)return px.photos.vote_controls.error_saving_vote(b.error),!1},update_values:function(a,b){b.total_votes&&$("#photo_rating_total_votes").fadeOut(150,function(){$("#photo_rating_total_votes .votes_count").html(b.total_votes),$("#photo_rating_total_votes").fadeIn(150)}),b.favorites_total&&$("#photo_rating_favs").fadeOut(150,function(){$("#photo_rating_favs .favorites_count").html(b.favorites_total),$("#photo_rating_favs").fadeIn(150)}),$("#photo_rating_score").fadeOut(150,function(){$("#photo_rating_score").html(b.rating),$("#photo_rating_score").fadeIn(150)}),b.highest_rating&&px.photos.update_highest_rating(b.highest_rating,b.highest_rating_date),$("#photo_rating_score").addClass("pulse-animated")},photo_liked:function(){var a=$(".card .vote_fav_controls");a.find(".vote_button.like").removeClass("display"),a.find(".voted_button").addClass("display"),a.find(".dislike_wrap").hide()},error_saving_vote:function(a){px.error(a||pxLocales.photo.error_saving_vote),px.photos.vote_controls.reset_controls()},load_voted_faved_state:function(){if(!px.signed_in){var a=$(".card .vote_fav_controls");a.addClass("display"),$(".card .vote_fav_controls_placeholder").remove(),px.photos.perform_action();return}$.get(window.location.pathname+"/voting_state",function(a){var b=$(".card .vote_fav_controls");a.already_voted&&(b.find(".vote_button").removeClass("display"),b.find(".voted_button").addClass("display"),b.find(".dislike_link").removeClass("display")),a.in_favorites&&b.find(".favorite_button").addClass("in_favorites"),a.negative_vote_explain&&(px.photos.needs_to_explain_negative_vote=!0),b.addClass("display"),$(".card .vote_fav_controls_placeholder").remove(),px.photos.perform_action()})}},smenticement:{logged_in:function(){window.location.reload()},failed:function(){px.error("There was a problem with your login attempt. Please check your details and try again.")}},check_for_social_referrer:function(){px.signed_in||(document.referrer.match(/facebook/)?($("#sm-enticement .card").attr("id","fbcard"),$("#sm-enticement").show()):document.referrer.match(/t\.co/)?($("#sm-enticement .card").attr("id","twcard"),$("#twitter_login").insertBefore("#facebook_login"),$("#sm-enticement").show()):($("#csb").show(),csbDisplayEvent()))},update_highest_rating:function(a,b){$("#photo_highest_rating").html(a),$("#highest_rating_date").html(b),$(".highestpulse.empty_rating").removeClass("empty_rating")},favorite:function(){$(".vote_fav_wrap .favorite_button").click()},like:function(){$(".vote_fav_wrap .vote_button:visible").click()},loadMorePhotos:function(){var a=$("#thephoto > a > img").data("photo-id"),b="/photo/"+a+"/navigation";b+="?from="+$("#more-photos").data("from"),$("#more-photos").load(b,function(){if($("#more-photos .photos").size()==0)return;$("#more-photos").fadeIn().find(".photos").css("opacity",0).jCarouselLite({btnNext:".set-next",btnPrev:".set-prev",circular:!1,start:$("#more-photos ul > li").index($("#more-photos li.current"))-1,scroll:3,speed:500,easing:"easeInOutExpo",afterEnd:function(a){var b=a.first(),c=a.last();for(var d=0;d<=9;d++){b=b.prev(),c=c.next();var e=b.find("img[data-src]");e.length>0&&(e.attr("src",e.attr("data-src")),e.removeAttr("data-src"));var e=c.find("img[data-src]");e.length>0&&(e.attr("src",e.attr("data-src")),e.removeAttr("data-src"))}}}),$("#more-photos .photos").fadeTo("fast",1)})},next:function(){var a=$("#more-photos li.current").next().find("a").attr("href");a&&(location.href=a)},prev:function(){var a=$("#more-photos li.current").prev().find("a").attr("href");a&&(location.href=a)},userNext:function(){$(".set-next").click()},userPrev:function(){$(".set-prev").click()}},px.photos.store={},px.photos.store.quickEnable={initialize:function(){$("#quick_store_enable").live("ajax:beforeSend",function(){$("#quick_store_enable").addClass("unity-loader centered").html("&nbsp;&nbsp;&nbsp;")}).live("ajax:complete",function(){px.messages.create({type:"success",message:"The photo is now on the market!"}),$("#quick_store_enable").remove(),$("#buy, #download").removeClass("noshow")})}},px.photos.store.preorder={confirmation_lightbox:function(a){$("#lightbox_content").width("300px").height("140px"),$("#lightbox_content").html(a)},initialize:function(){$("#preorder").live("click",function(a){return px.photos.store.preorder.send(a),!1}),$("#preorder_guest").live("click",function(a){var b=$(this);return px.lightbox.initialize(px.photos.store.preorder.lightbox.initialize,{url:b.attr("href")}),a.preventDefault(),!1}),$("#preorder_guest_form").live("ajax:success",function(a,b){b.status==422?$("#lightbox_content").html(b.form_html):b.status==200&&($("#preorder_guest").html("Notified the author!"),$("#preorder_guest").die("click"),b.show_confirmation?($("#lightbox_content").html(b.confirm_html),$("#lightbox_content").width("300px").height("140px"),$("#lightbox_content .close_lightbox_button").click(function(){px.lightbox.close()})):px.lightbox.close())}).live("ajax:beforeSend",function(){$(this).find(".submit_button").hide(),$(this).find(".error").remove(),$(this).find(".loading").show()}),"#preorder_send"===location.hash&&$("#preorder").trigger("click")},send:function(a){var b=$(a.currentTarget);$.ajax({type:"POST",url:b.attr("href"),data:"nolayout",dataType:"json",beforeSend:function(){b.data("original-state",b.html()),b.html('<img src="/unity/img/spinners/loader-small.gif" align="texttop" class="faded" /> Notifying the author...')}}).done(function(a){b.html("Notified the author!"),$("#preorder").die("click"),a.show_confirmation&&(px.lightbox.initialize(px.photos.store.preorder.confirmation_lightbox,a.confirm_html),$("#lightbox_content .close_lightbox_button").click(function(){px.lightbox.close()}))}).error(function(a){b.html(b.data("original-state")),px.messages.create({type:"error",message:"Could not notify the author. Please, try again."})})}},px.photos.store.preorder.lightbox={initialize:function(a){var b={url:"/"},c=$.extend(b,a);$("#lightbox_content").width("400px").height("240px"),$("#lightbox_content").addClass("loading"),px.lightbox.wait(),$.ajax({type:"GET",url:c.url,dataType:"json"}).done(function(a){$("#lightbox_content").removeClass("loading").addClass("complete").prepend(a.guest_form),px.photos.store.preorder.lightbox.ready()})},ready:function(){px.lightbox.removeWait(),$("#lightbox_content").removeClass("loading")}},on_page("photo_show",px.photos.initialize_show),px.home_page={init:function(){$(document).ready(function(){$("#homepage-signup").delegate("a#facebook_login","oauth:loggedIn",px.home_page.show_facebook_loading).delegate("a#twitter_login","oauth:loggedIn",px.home_page.show_twitter_loading).delegate(".sign-up-form .validatable","keydown",px.home_page.clear_error).delegate(".sign-up-form #user_email","blur",delegate_chain(px.home_page.validate_field,px.home_page.email_available)).delegate(".sign-up-form #user_password","blur",px.home_page.validate_field).delegate(".sign-up-form #user_email","keydown",px.home_page.cancel_email_available).delegate(".sign-up-form","submit",delegate_chain(px.home_page.validate_fields,px.home_page.fade_out_only))})},show_facebook_loading:function(){var a=$(this).closest(".fb_container");a.delay(100).fadeOut("slow",function(){a.nextAll("#fb_loading").removeClass("noshow"),window.location.reload()})},show_twitter_loading:function(){var a=$(this).closest(".fb_container");a.delay(100).fadeOut("slow",function(){a.nextAll("#tw_loading").removeClass("noshow"),window.location.reload()})},fade_out_only:function(){if($(".sign-up-form #submit").hasClass("disabled"))return!1;$(".sign-up-form #submit").addClass("disabled"),$(".fb_container").animate({opacity:0},250,function(){$("#homepage-signup #loader").show()})},clear_error:function(a){$("#"+this.id+"_error").remove(),$("#"+this.id).removeClass("invalid").addClass("valid")},validate_fields:function(){var a=["email","password"];clear=!0;for(var b in a){var c=px.home_page.validate(a[b]);c!==!0&&(px.home_page.add_error(a[b],c),clear=!1)}if(clear===!1)return!1},add_error:function(a,b){$("#user_"+a+"_error").remove();var c=$("#user_"+a);c.after($("<div />",{id:"user_"+a+"_error","class":"error",text:b,style:"display: none;"})),$("#user_"+a+"_error").slideDown(),$("#user_"+a).removeClass("valid").addClass("invalid")},validate_field:function(){if($(this).val()=="")return!1;var a=this.id.split("_")[1],b=px.home_page.validate(a);if(b!==!0)return px.home_page.add_error(a,b),!1},validate:function(a){if(a=="email"){var b=$(".sign-up-form #user_email").val();if(!b.match(/^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i))return"Invalid email address"}else{var c=$(".sign-up-form #user_password").val();if(c.length<6||c.length>64)return"Must be between 6 and 64 characters"}return!0},email_available_xhr:null,email_available:function(){email=$("#user_email"),px.home_page.email_available_xhr=$.get(px.site_url("/signup/email_available/"),{email:email.val()},px.home_page.set_availability)},cancel_email_available:function(){px.home_page.email_available_xhr&&px.home_page.email_available_xhr.abort()},set_availability:function(a){if(a.success){$("#user_"+a.sucess).addClass("valid");return}px.home_page.add_error("email",a.errors.email)},errors_from_server:function(a,b){var c=JSON.parse(b.responseText);px.home_page.set_availability(c),$("#homepage-signup #loader").hide(),$(".fb_container").css({opacity:1},250),$(".sign-up-form #submit").show().removeClass("disabled")}},on_page("home_index",px.home_page.init),px.subscriptions={unload_guard:!1,init:function(){$("#upgrade-payment").delegate("select#subscription_payment_profile_id","change",px.subscriptions.update_payment_method).delegate("form#payment_form","ajax:before",delegate_chain(px.subscriptions.prevent_double_submit,px.subscriptions.enable_unload_guard,px.subscriptions.clear_promo_code_field_if_not_selected,px.subscriptions.show_loader)).delegate("form#payment_form","ajax:beforeSend",px.subscriptions.disable_form_fields).delegate("form#payment_form","ajax:complete",delegate_chain(px.subscriptions.enable_form_fields,px.form.init)).delegate("form#payment_form","ajax:success",delegate_chain(px.subscriptions.hide_loader,px.subscriptions.form_response,px.form.init)).delegate("#hasPromo","change",px.subscriptions.toggle_promo_code_field).delegate("#apply_promo_code","click",delegate_chain(Helper.stop_if_has_loading_class,px.subscriptions.apply_promo_code)),px.subscriptions.update_payment_method(),px.subscriptions.setup_unload_guard()},disable_form_fields:function(){$("form#payment_form").find("input, select, button").attr("disabled","disabled")},enable_form_fields:function(){$("form#payment_form").find("input, select, button").removeAttr("disabled")},setup_unload_guard:function(){window.onbeforeunload=function(){if(px.subscriptions.unload_guard)return pxLocales.subscriptions.unload_guard}},prevent_double_submit:function(){if($("#upgrade_payment_button").hasClass("loading"))return!1},form_response:function(a,b){b.error?px.subscriptions.authorization_failed.call(this,b):px.subscriptions.authorization_obtained.call(this,b)},authorization_obtained:function(a){$("#upgrade-payment").slideUp("slow",function(){$(this).after(a.complete_html)}),$("#the_gift_code").val(a.gift_code),$("input.subscription_id").val(a.id),px.subscriptions.unload_guard=!1},authorization_failed:function(a){a.form_html?$("#payment_form").replaceWith(a.form_html):a.promo_code_error?($("#promo").addClass("error"),$("#promo").closest("#promocodefield").find("div.error").remove(),$("#promo").closest("#promocodefield").append('<div class="error" id="promocodeerror">'+a.promo_code_error+"</div>")):(px.messages.create({type:"error",message:_.template(pxLocales.subscriptions.payment_failed)({error_message:a.message!==undefined?a.message:""})}),$("#payment_form form").show()),px.subscriptions.update_payment_method(),$("span.upgrade_price").html(number_to_currency(a.price))},enable_unload_guard:function(){px.subscriptions.unload_guard=!0},disable_unload_guard:function(){px.subscriptions.unload_guard=!1},clear_promo_code_field_if_not_selected:function(){$("#hasPromo").is(":checked")||$("#promo").val("")},show_loader:function(){$(this).find("#upgrade_payment_button").addClass("loading")},hide_loader:function(){$(this).find("#upgrade_payment_button").removeClass("loading")},apply_promo_code:function(a){$(this).addClass("loading");var b={promo_code:$("#promo").val(),product:$("#subscription_kind").val()=="subscription"?"upgrade":"gift"};return b.membership=$("#subscription_membership").val(),$.get("/upgrade/promo_code",b,px.subscriptions.promo_code_applied),!1},promo_code_applied:function(a){if(a.error)$("#promo").closest("#promocodefield").find("div.error").remove(),$("#promo").closest("#promocodefield").append('<div class="error">'+a.error+"</div>"),$("#promocodefield #apply_promo_code").removeClass("loading"),$("#promocodefield input").addClass("error");else{$("#promocodefield input").removeClass("error"),$(".upgrade_price").html(number_to_currency(a.price));var b=$("#promo").closest("#promocodefield");b.find(".error").remove(),$("#promo").attr("readonly","readonly"),$("#hasPromo").css("display","none"),b.find("button").remove(),b.append('<div class="success">Applied</div>'),$(".explain_recurring_subscription"
).length>0&&($(".explain_recurring_charge").removeClass("noshow"),$(".for_the_first_year").removeClass("noshow"))}$("#apply_promo_code").hide(),$("#apply_promo_code").removeClass("loading")},toggle_promo_code_field:function(){$("#hasPromo").is(":checked")?$("#promocodefield").show():$("#promocodefield").hide()},load_saved_billing_address:function(){var a=$("#subscription_payment_profile_id option:selected"),b,c;if(a){b=JSON.parse(a.attr("data-billing-address"));var d=["first_name","last_name","address1","country","state","city","zip"];while(c=d.shift())$("#saved_billing_"+c).html(b[c]),c=="state"&&$("#billing_state_select").val(b[c]).trigger("change"),$("#sale_billing_address_attributes_"+c).val(b[c]).trigger("change")}},update_payment_method:function(){var a=$("#subscription_payment_profile_id");a.length>0?a.val()!=""?($(".show_when_paying_with_saved_card").show(),$(".hide_when_paying_with_saved_card").hide(),px.subscriptions.load_saved_billing_address()):($(".show_when_paying_with_saved_card").hide(),$(".hide_when_paying_with_saved_card").show()):$(".show_when_paying_with_saved_card").hide()},index:{init:function(){$("body").addClass("compare"),$("#redeem_form form").live("ajax:success",function(a,b){b.success?b.signed_in?($("#redeem_form_and_link").hide(),$(".compare-intro").hide(),$("#compare").slideUp(200),$(b.html_complete_page).insertBefore($("#compare"))):location.href="<%= SECURE_500PX_URL %>/login?r=/upgrade/redeem/"+b.code:$(this).find(".error").html(b.error),$(this).find(".submit_button").show(),$(this).find("button.loading").hide()}).live("ajax:beforeSend",function(){$(this).find(".submit_button").hide(),$(this).find("button.loading").show()}),$("#show_redeem_form").live("click",function(){$("#redeem_form").slideToggle(200),$("#gift-options").hide()}),$("#show_gift_options").live("click",function(){$("#gift-options").slideToggle(200),$("#redeem_form").hide()})}}},on_page("subscriptions_index",px.subscriptions.index.init),on_page("subscriptions_new, subscriptions_create",px.subscriptions.init),px.login={init:function(){$("body").addClass("compare-bg"),$("#sessions_new, #sessions_create").delegate("a[data-oauth-provider-login]","oauth:loggedIn",delegate_chain(px.login.fade_out,px.login.redirect)).delegate("a[data-oauth-provider-login]","oauth:loginFailed",px.login.oauth_failure),$("#user_new").bind("submit",delegate_chain(px.login.validate,px.login.fade_out)),$("#user_username, #user_password").bind("keydown",px.login.clear_errors)},fade_out:function(a){var b=$(this).closest(".sign-in-step");b.find(".submit_button_loading").show(),b.find("input:submit").hide()},oauth_failure:function(){px.error("There was a problem with your login attempt. Check your details and try again.")},redirect:function(a){var b=$("#login_redirect").val();if(a.user.was_created){var c="/signup/profile";b!=""&&(c=c+"?r="+encodeURIComponent(b)),window.location=c}else b==""?window.location="/":window.location=b},clear_errors:function(){$(".error").remove()},validate:function(){var a=$("#user_username"),b=$("#user_password");px.login.clear_errors();var c=!0;!a.val().match(/^[a-z0-9_\-]+$/i)&&!px.valid_email(a.val())&&(a.after($("<div />",{"class":"error",text:"Invalid email address or username",style:"display: none;"})),a.next(".error").slideDown(),a.focus(),c=!1);if(b.val().length<6||b.val().length>64)b.after($("<div />",{"class":"error",text:"Must be between 6 and 64 characters",style:"display: none;"})),b.next(".error").slideDown(),b.focus(),c=!1;return c}},on_page("sessions_new, sessions_create",px.login.init),px.users={show:{initialize:function(){window.location.hash=="#follow"&&$("#follow_user_follow").length>0&&($("#follow_user_follow").live("ajax:success",px.users.show.follow_success).live("ajax:complete",function(){$("#follow_user_follow").die("ajax:success",px.users.show.follow_success)}),$("#follow_user_follow").click())},follow_success:function(){px.messages.create({type:"success",message:"You are now following this user."})}}},on_page("user_showuser",px.users.show.initialize),px.payment_profiles={init:function(){$("#payment_profiles").delegate(".credit-card","mouseenter",px.payment_profiles.fade_in_actions).delegate(".credit-card","mouseleave",px.payment_profiles.fade_out_actions).delegate(".delete_card","click",px.payment_profiles.prevent_double_submit).delegate(".delete_card","ajax:beforeSend",delegate_chain(Helper.show_loader,px.payment_profiles.disable_edit_button)).delegate(".delete_card","ajax:complete",Helper.hide_loader).delegate(".delete_card","ajax:success",px.payment_profiles.remove_credit_card),$("body").delegate("#lightbox_content .payment_profile_form","paymentProfile:newCard",px.payment_profiles.add_new_card)},init_lightbox:function(){$("body").delegate("#add_new_payment_card, .credit-card a.edit_card, #add_new_card","lightbox:opened",delegate_chain(px.payment_profiles.lightbox.initialize,px.payment_profiles.load_state_options,px.payment_profiles.lightbox.resize,px.form.init)).delegate("#lightbox .payment_profile_form","pxForm:afterErrorCleared",px.payment_profiles.lightbox.resize).delegate("#lightbox .payment_profile_form.edit_profile .credit_card_number","pxForm:validate",px.payment_profiles.validate_only_if_credit_card_present).delegate("#lightbox .payment_profile_form.edit_profile #expiry-date .validate","pxForm:validate",px.payment_profiles.validate_only_if_credit_card_present).delegate("#lightbox .payment_profile_form.edit_profile .verification_value","pxForm:validate",px.payment_profiles.validate_only_if_credit_card_present).delegate("#lightbox select.state_select","change",px.payment_profiles.copy_state_select_value_to_input).delegate("#lightbox_content .payment_profile_form","ajax:error",delegate_chain(px.payment_profiles.handle_error,px.payment_profiles.load_state_options,px.payment_profiles.lightbox.resize,px.form.init)).delegate("#lightbox_content .payment_profile_form button.submit_button","click",px.payment_profiles.prevent_double_submit).delegate("#lightbox_content .payment_profile_form","pxForm:afterValidation",px.payment_profiles.lightbox.resize).delegate("#lightbox_content .payment_profile_form","ajax:beforeSend",delegate_chain(px.payment_profiles.disable_form_fields,px.payment_profiles.show_loading)).delegate("#lightbox_content .payment_profile_form","ajax:complete",delegate_chain(px.payment_profiles.enable_form_fields,px.payment_profiles.hide_loading)).delegate("#lightbox_content .payment_profile_form","ajax:success",delegate_chain(px.payment_profiles.fire_new_card_event,px.payment_profiles.lightbox.close)).delegate("#lightbox_content select.country_select","change",px.payment_profiles.load_state_options)},validate_only_if_credit_card_present:function(a){if($(this).closest("form").find(".credit_card_number").val().trim()=="")return a.result=!0,!0},fire_new_card_event:function(a,b){var c=jQuery.Event("paymentProfile:newCard",{card_data:b});$(this).trigger(c)},disable_form_fields:function(){$(this).find("input, select").attr("disabled","disabled")},enable_form_fields:function(){$(this).find("input, select").removeAttr("disabled")},disable_edit_button:function(){$(this).prevAll(".edit_card").addClass("disabled")},lightbox:{initialize:function(){new px.form($("#lightbox_content form.pxForm")),$("#lightbox_content input:checkbox").checkbox()},close:function(){pxLightbox().close()},resize:function(){var a=$("#lightbox_content .payment_form_wrapper").outerHeight();$("#lightbox_content").height(a+"px")}},remove_credit_card:function(){$(this).closest(".credit-card").remove()},fade_in_actions:function(){var a=$(this).find(".card-actions");if(a.length>0){if($(this).find("a.delete_card.loading").length>0)return;a.stop().css("opacity","0").removeClass("noshow").animate({opacity:1},250)}},fade_out_actions:function(){var a=$(this).find(".card-actions");if(a.length>0){if($(this).find("a.delete_card.loading").length>0)return;a.stop().css("opacity","1").animate({opacity:0},250)}},show_loading:function(){$(this).find("button.submit_button").addClass("loading")},hide_loading:function(){$(this).find("button.submit_button").removeClass("loading")},prevent_double_submit:function(a){if($(this).hasClass("loading"))return a.stopPropagation(),a.preventDefault(),!1},copy_state_select_value_to_input:function(){$(this).prevAll("input.state_select").val($(this).val())},load_state_options:function(){var a=$("#lightbox_content"),b=a.find(".country_select option:selected"),c=a.find("select.state_select"),d=b.val().toLowerCase().replace(/\s+/g,"_"),e=pxShippingStates[d];c.find("option").remove();if(e){c.show(),c.prevAll("input.state_select").hide(),a.find("input.state_select").hide();for(var f in e){var g=$("<option></option>");g.attr("value",f),g.html(e[f].name),c.append(g)}c.val(c.prevAll("input.state_select").val())}else c.hide(),c.prevAll("input.state_select").show();$("#lightbox select.state_select").trigger("change")},handle_error:function(a,b,c){var d=JSON.parse(b.responseText);$(".payment_profile_form").replaceWith(d.html),px.payment_profiles.lightbox.resize()},add_new_card:function(a){var b=a.card_data,c;b["default"]&&$(".credit-card span.default").remove(),b.new_record?b["default"]?$("#payment_profiles_list").prepend(b.html):$("#payment_profiles_list .add-card").before(b.html):($("#payment_profile_"+b.id).replaceWith(b.html),b["default"]&&$("#payment_profile_"+b.id).prependTo($("#payment_profiles_list")))}},on_page("payment_profiles_index",px.payment_profiles.init,px.payment_profiles.init_lightbox),on_page("settings_index",px.payment_profiles.init_lightbox),$(function(a){a("#new_comment").bind("ajax:error",function(){alert(I18n[I18n.locale])})});var I18n={locale:"en",en:"There was a problem submitting your comment, please try again or contact us at help@500px.com to get help",br:"Houve um problema submeter o seu comentário, por favor, tente novamente ou entre em contato conosco help@500px.com para obter ajuda",de:"Es gab ein Problem Einreichung Ihren Kommentar, bitte versuchen Sie es erneut oder kontaktieren Sie uns unter help@500px.com Hilfe zu bekommen",es:"Hubo un problema al enviar tu comentario, por favor, inténtelo de nuevo o póngase en contacto con nosotros en help@500px.com",ru:"Не удалось записать ваш голос. Пожалуйста попробуйте еще раз или обратись к нам по адресу help@500px.com за поддержкой"};px.storeFront={dont_hide_ajax_spinner:!1,init:function(a,b){px.storeFront.price.sub_total=a,px.storeFront.media_type=b,$(".wallcontrols #flyover_mode_photo").click(function(){$("#flyover_mode_photo").addClass("selected"),$("#flyover_mode_wall").removeClass("selected"),$(".the-wall").slideUp(600),$(".the-photo").slideDown(600)});var c=function(a){$("#flyover_mode_photo").removeClass("selected"),$("#flyover_mode_wall").addClass("selected"),a?($(".the-wall").slideDown(600),$(".the-photo").slideUp(600)):($(".the-wall").show(),$(".the-photo").hide()),$("html, body").animate({scrollTop:0},600)};$(".wallcontrols #flyover_mode_wall").click(function(){c(!0)}),$.address.init(function(a){var b=a.value.replace(/[#,\/]/g,""),d=$("#flyover_mode_wall").attr("href").replace(/[#,\/]/g,"");b===d&&c(!1)}),$("#purchase").delegate(".billing-details input:text","change",px.storeFront.copy_billing_input_to_shipping).delegate("#sale_same_address","change",px.storeFront.toggle_shipping_address).delegate("#billing select","change",px.storeFront.copy_billing_input_to_shipping).delegate("#sale_billing_address_attributes_country","change",px.storeFront.state_select.update).delegate("#sale_shipping_address_attributes_country","change",px.storeFront.state_select.update).delegate("#sale_billing_address_attributes_country","change",px.storeFront.price.update).delegate("#sale_shipping_address_attributes_country","change",px.storeFront.price.update).delegate("#billing_state_select","change",px.storeFront.billing_state_updated).delegate("#billing_state_select, #shipping_state_select","change",px.storeFront.price.update).delegate("form.sale_form","ajax:success",px.storeFront.show_invoice).delegate("form.sale_form","ajax:beforeSend",px.storeFront.show_ajax_spinner).delegate("form.sale_form","ajax:error",delegate_chain(px.storeFront.handle_checkout_error,px.form.init)).delegate("form.sale_form","reset_state",px.storeFront.hide_ajax_spinner).delegate("form.sale_form","ajax:complete",px.storeFront.hide_ajax_spinner).delegate("#store_purchase_button","click",px.storeFront.submit_form).delegate("#sale_payment_profile_id","change",px.storeFront.update_payment_method).delegate("form.sale_form","reloaded",px.storeFront.form_reloaded),px.storeFront.unloadGuard=!1,window.onbeforeunload=function(a){if(px.storeFront.unloadGuard)return"Closing this page might interrupt your payment."},$("body").delegate(".guest_login_lightbox form","ajax:beforeSend",px.storeFront.guest_login.show_ajax_spinner).delegate(".guest_login_lightbox form","ajax:error",px.storeFront.guest_login.show_error_message).delegate(".guest_login_lightbox form","ajax:success",px.lightbox.close).delegate(".guest_login_lightbox form","ajax:success",px.storeFront.submit_form).delegate(".guest_login_lightbox form","ajax:complete",px.storeFront.hide_ajax_spinner),px.storeFront.form_reloaded()},form_reloaded:function(){$("#sale_billing_address_attributes_country").trigger("change"),$("#sale_shipping_address_attributes_country").trigger("change"),px.storeFront.billing_state_updated(),px.storeFront.toggle_shipping_address(),px.storeFront.price.update(),px.storeFront.update_payment_method()},error_message:function(a){px.messages.create({type:"error",message:"There was a problem processing your payment: "+a+"\nPlease check your payment details and try again."})},toggle_shipping_address:function(){$("#sale_same_address").is(":checked")?($("#shipping").hide(),$("#billing input, #billing select").each(px.storeFront.copy_billing_input_to_shipping)):$("#shipping").show()},show_invoice:function(a,b){$("#purchase").hide();var c=$("#store_complete a.print_link");c.attr("href","/settings/purchases/invoice/"+b.sale_id),$("#download_digital_version").attr("href","/settings/purchases/download/"+b.sale_id),$("#store_complete").show(),$("#store_invoice").html(b.invoice_html),px.storeFront.unloadGuard=!1},update_payment_method:function(){$("#sale_payment_profile_id").length>0&&$("#sale_payment_profile_id").val()!=""?($(".hide_when_paying_with_saved_card").hide(),$(".show_when_paying_with_saved_card").show(),px.storeFront.load_saved_billing_address()):($(".hide_when_paying_with_saved_card").show(),$(".show_when_paying_with_saved_card").hide(),px.storeFront.media_type=="print"&&$("#phone").show())},clear_saved_billing_address:function(){var a=["first_name","last_name","address1","city","zip"],b;while(b=a.shift())$("#sale_billing_address_attributes_"+b).val("")},load_saved_billing_address:function(){var a=$("#sale_payment_profile_id option:selected"),b,c;if(a){b=JSON.parse(a.attr("data-billing-address")),status=a.attr("data-status"),phone=a.attr("data-phone");var d=["first_name","last_name","address1","country","state","city","zip"];while(c=d.shift())$("#saved_billing_"+c).html(b[c]),$("#sale_billing_address_attributes_"+c).val(b[c]).trigger("change"),c=="state"&&$("#billing_state_select").val(b[c]).trigger("change");px.storeFront.media_type=="print"&&(parseInt(status)?$("#phone").hide():$("#phone").show().find("input").val(phone))}},show_ajax_spinner:function(a){if(a.isPropagationStopped())return!1;px.storeFront.unloadGuard=!0,$(this).find("input, select, button").attr("disabled","disabled"),$("#store_purchase_button").hide(),$("#store_purchase_button").prevAll(".loader").show()},hide_ajax_spinner:function(a){if(px.storeFront.dont_hide_ajax_spinner)return;var b=$(this).find("#store_purchase_button");b.show(),b.prevAll(".loader").hide(),$(this).find("input, select, button").removeAttr("disabled")},handle_checkout_error:function(a,b){var c=jQuery.parseJSON(b.responseText);c.redirect?(c.paypal&&(px.storeFront.unloadGuard=!1,px.storeFront.dont_hide_ajax_spinner=!0),location.href=c.redirect):c.user_exists?px.storeFront.show_login_lightbox(c.user):c.checkout_failed&&($("form.sale_form").replaceWith(c.html),$(".eqcol").equalHeights(),$("#sale_billing_address_attributes_country").trigger("change"),$("#sale_shipping_address_attributes_country").trigger("change"),c.error_message&&px.storeFront.error_message(c.error_message),px.storeFront.form_reloaded())},submit_form:function(a){$("form.sale_form").trigger("submit.rails"),a.preventDefault()},copy_billing_input_to_shipping:function(a){var b=$(this);if($("#sale_same_address").is(":checked")==1){var c="#"+b.attr("id"),d=$(c.replace("billing","shipping"));d.val(b.val()),d.trigger("change")}},show_login_lightbox:function(a){px.lightbox.initialize(function(a){$("#the_store_form").trigger("reset_state");var b=$("#guest_login_lightbox").clone();$(b).attr("id",""),$("#lightbox_content").width("500px").height("240px"),$("#lightbox_content").append(b),$("#lightbox_content .guest_login_lightbox .user_full_name").html(a.full_name),$("#lightbox_content .guest_login_lightbox .user_avatar").attr("src",a.avatar),$("#lightbox_content #user_username").val(a.username)},a)},we_ship_to:function(a){return!!px.storeFront.shipping_states[a]},billing_state_updated:function(){var a=$("#billing_state_select").val();$("#sale_billing_address_attributes_state").val($("#billing_state_select").val())},disable_same_as_billing_option:function(){$("#shipping").length>0&&($("#sale_same_address").get(0).checked=!1,$("#shipping").show(),$("#same_as_billing_field").hide())},is_same_as_billing:function(){return $("#shipping").length>0&&$("#sale_same_address").get(0).checked}},px.storeFront.price={sub_total:0,update:function(){var a=$("#shipping_state_select option:selected"),b;if(px.storeFront.media_type=="print"){var c=Number(a.attr("data-shipping-price")),d=Number(a.attr("data-tax-rate"));$(".purchase_price").html(number_to_currency(px.storeFront.price.sub_total)),$(".purchase_shipping").html(number_to_currency(c));var e=px.storeFront.price.sub_total;$(".purchase_subtotal").html(number_to_currency(e));var f=e*(d/100);f==0?$(".purchase_taxes_wrapper").hide():($(".tax_percent").html(d),$(".purchase_taxes_wrapper").show()),$(".purchase_taxes").html(number_to_currency(f)),b=e+c+f}else b=px.storeFront.price.sub_total;$(".purchase_total").html(number_to_currency(b))}},px.storeFront.guest_login={show_ajax_spinner:function(a){$(this).find("button").addClass("loading")},hide_ajax_spinner:function(a){$(this).find("button").removeClass("loading")},show_error_message:function(a,b){var c=jQuery.parseJSON(b.responseText);px.messages.create({type:"error",message:c.error})}},px.storeFront.state_select={update:function(a){var b=$(this).val(),c=b.toLowerCase().replace(/\s+/g,"_");this.id=="sale_billing_address_attributes_country"?px.storeFront.we_ship_to(c)?($("#same_as_billing_field").show(),px.storeFront.state_select.load_options(c,$("#billing_state_select")),$("#billing_state_select").show(),$("#sale_billing_address_attributes_state").hide()):(px.storeFront.disable_same_as_billing_option(),$("#billing_state_select").hide(),$("#sale_billing_address_attributes_state").show()):px.storeFront.state_select.load_options(c,$("#shipping_state_select"))},load_options:function(a,b){$(b).find("option").remove();var c=px.storeFront.shipping_states[a];for(var d in c){if(c[d].billing_only&&$(b).attr("id")=="shipping_state_select")continue;var e=$("<option></option>");e.attr("value",d),e.html(c[d].name),e.attr("data-shipping-price",c[d].shipping),e.attr("data-tax-rate",c[d].tax_rate),$(b).append(e)}var f=$(b).attr("current_value");f&&f!=""&&$(b).val(f),$(b).trigger("change")},set_value:function(a,b){a!=""&&$(b).val(a),$(b).trigger("change")}};var StoreManager={montage:{order:[],fade_in:function(a,b,c,d){setTimeout(function(){a.animate({opacity:1},{duration:c,queue:!1}),typeof d=="function"&&d.call()},b)},init:function(){var a=$("#photo_grid a.included").get(),b=a.pop(),c,d,e=0,f=0;while(c=a.shift())d=$(c).find("img"),StoreManager.montage.fade_in(d.first(),e*f,e),f++;StoreManager.montage.fade_in($(b).find("img").first(),e*f,e,StoreManager.montage.start_fade)},start_fade:function(){setTimeout(StoreManager.montage.fade,1e3)},fade:function(){var a=StoreManager.montage.order.shift();StoreManager.montage.order.push(a);var b=$($("#photo_grid a").get(a)),c=b.find("img:visible"),d=b.find("img:visible").next();d.length==0&&(d=b.find("img:first-child")),c.css("z-index","100"),d.css("z-index","99"),d.show(),c.fadeOut(1e3),setTimeout(StoreManager.montage.fade,3e3)}},setup:{check_continue_button:function(a){var b=$.map(a.find("input.license_input"),function(a){return $(a).val()});return b.indexOf("1")==-1?($(".submit_setup").addClass("disabled"),!1):($(".submit_setup").removeClass("disabled"),!0)}},sales:{load_history:function(a){$("#completed_sales li.history").hide("fast");var b=$("#completed_sales ul.history").length>0;$("#completed_sales ul.history").remove(),$("#completed_sales li.empty").remove(),$("#completed_sales").append(a.html),$("#history_pagination").html(a.pagination),b?$("#completed_sales ul.history").show():$("#completed_sales ul.history").slideDown("slow"),$("#load_sales_history").hide()}},disable_store:function(){$(this).closest("form").submit()}};$("#store-setup a.canvas-prints, #store-setup a.downloads,#selling-options a.canvas-prints, #selling-options a.downloads").live("click",function(){$(this).toggleClass("selected"),$(this).hasClass("selected")?$(this).prev("input").val(1):$(this).prev("input").val(""),StoreManager.setup.check_continue_button($(this).closest("form"))}),$("#store-setup a.submit_setup, #selling-options a.submit_setup").live("click",function(){var a=$($(this).closest("form"));return StoreManager.setup.check_continue_button(a)?$(this).closest("form").submit():alert("You must select at least one type of media to sell."),!1}),$("li.photo_selection a.change").live("click",function(){return $(this).closest(".high-res-details").hide(),$(this).closest("li").find(".high-res-details.upload").show(),!1}),$("li.photo_selection a.cancel_upload").live("click",function(){var a=$(this).closest(".high-res-details");a.hide(),a.next(".high-res-details").show()}),$("li.photo_selection input.filefield").live("change",function(){var a=$(this).closest(".high-res-details");a.find(".photo-thumbnail").hide(),a.find(".ajax-loader").show(),$(this).closest("form").submit()}),$("li.photo_selection input.enable_photo").live("click",function(){var a=$(this),b=$(this).parents(".photo_selection"),c=a.is(":checked")?"1":"";a.closest(".sale-details").addClass("loading"),a.attr("disabled","disabled");var d=a.closest(".sale-details");$.post("/settings/store/photos",{for_sale:c,photo_id:a.attr("photo_id")},function(){d.removeClass("loading"),a.removeAttr("disabled"),c?$(b).find(".sale-size-details").show():$(b).find(".sale-size-details").hide()})}),$(".photo_is_private a.button").live("ajax:beforeSend",function(){$(this).addClass("loading")}).live("ajax:success",function(a,b){}).live("ajax:complete",function(){$(this).removeClass("loading")}),$(".sale-size-details a").live("click",function(){var a=$(this),b=$(this),c=null,d="";d.length>24&&(d=d.substr(0,18)+"...");var e="";return e.length>16&&(e=e.substr(0,14)+"..."),c={photo_id:b.data("photo-id"),photo_user_id:b.data("user-id"),photo_sale_url:b.data("photo-url"),photo_width:b.data("photo-width"),photo_height:b.data("photo-height"),photo_store_width:b.data("photo-store-width"),photo_store_height:b.data("photo-store-height")},flyover_lightbox.init({template_settings:c},a),!1});var jcropapi="",flyover_lightbox={init:function(a,b){this.target=b;var c={},d=$.extend(c,a);this.width=a.template_settings.photo_width,this.height=a.template_settings.photo_height,this.store_width=a.template_settings.photo_store_width,this.store_height=a.template_settings.photo_store_height,px.lightbox.initialize(flyover_lightbox.initialized,d)},initialized:function(a){var b=_.template($("#market-flyover-template").html(),a.template_settings);$("#lightbox_content").css("width","820px"),$("#lightbox_content").css("height","auto"),$("#lightbox_content").addClass("complete").prepend(b),flyover_lightbox.disable_ratios(),flyover_lightbox.ready()},to_default:function(){var a=flyover_lightbox.nearest_ratio(flyover_lightbox.get_ratio(),!0);flyover_lightbox.set_ratio(a)},to_size:function(){if(!$(this).hasClass("disabled")&&!$(this).hasClass("selected")){$("#size-selection a").removeClass("selected"),$("#size-selection a").removeClass("blue"),$(this).addClass("selected blue");var a=$(this).data("size");flyover_lightbox.set_ratio(RATIOS[a])}},ready:function(){var a=this;$(".tosize").click(this.to_size),$(".upload_store_size").submit(this.submit_crop);var b=this.width,c=this.height,d=this.get_ratio(),e=this.nearest_ratio(d,!0),f=RATIOS.indexOf(Number(e));$("#size-selection a[data-size="+f+"]").addClass("selected blue");var g={setSelect:[0,0,b,c],allowResize:!1,bgOpacity:.2,trueSize:[b,c],allowSelect:!1,onChange:a.change_coords};this.jcrop_api=null,$("#cropbox").Jcrop(g,function(){a.jcrop_api=this,a.set_ratio(e)}),setInterval(function(){if($(window).height()<600)return;var a="";a=$("#lightbox_content").offset().top,a+=$("#lightbox_content").outerHeight(),a=a>$(window).height();var b=1,c=$(window).height(),d=$("#lightbox_content"),e=$(".photoview"),f=$(d).outerHeight()+$(d).offset().top,g=$(e).outerHeight()+$(e).offset().top;b=c/f*(g/f),f>c&&$(".photoview").css("zoom")==1&&$(".photoview").animate({zoom:b*.9},250)},1e3)},change_coords:function(a){$("#cropsize").val([a.x,a.y,a.x2,a.y2])},nearest_ratio:function(a,b){var c=null,d=RATIOS.slice(0);return b||d.pop(),jQuery.each(d,function(){if(c==null||Math.abs(this-a)<Math.abs(c-a))c=this}),c},disable_ratios:function(){var a=this.width,b=this.height,c=this.store_width,d=this.store_height,e=a>b;e||(a=this.height,b=this.width);var f=this.get_ratio();$.each($("#size-selection a"),function(g,h){r=RATIOS[$(h).data("size")],r<f?cut=Math.round(a):cut=Math.round(b/r);var i;e?i=c/(a/cut)<3e3:i=d/(a/cut)<3e3,i&&$(h).addClass("disabled")})},set_ratio:function(a){var b=this.height,c=this.width,d=c>b;d||(b=this.width,c=this.height);var e=this.get_ratio();a<e?(res_width=Math.round(c),res_height=Math.round(c*a)):(res_width=Math.round(b/a),res_height=Math.round(b));var f=parseInt((b-res_height)/2),g=parseInt((c-res_width)/2),h=[g,f,res_width+g,res_height+f];if(!d){var f=parseInt((b-res_height)/2),g=parseInt((c-res_width)/2);h=[f,g,res_height+f,res_width+g]}this.set_options(a,h)},get_ratio:function(){var a=this.width,b=this.height;return b>a&&(a=this.height,b=this.width),Math.round(b/a*1e3)/1e3},set_options:function(a,b){jQuery("#cropsize").val(b),jQuery("#ratio").val(a),this.jcrop_api.animateTo(b)},submit_crop:function(){var a=jQuery(this).attr("action"),b=jQuery(this).serialize();return jQuery.post(a,b,function(a){var b=parseFloat(jQuery("#ratio").val()),c=SIZES[RATIOS.indexOf(b)],d=flyover_lightbox.target;jQuery(d).replaceWith(c),px.lightbox.close(),px.messages.create({type:"success",message:"Photo crop updated"})}).error(function(){px.error("Error")}),!1}},PayoutRequest={amount:!1,modal_init:function(){var a=$("#payment-modal-content");$("#lightbox_content").width("600px"),$("#lightbox_content").prepend(a.clone()),$("#lightbox_content #payment-modal-content").show()},show_modal:function(){px.lightbox.initialize(PayoutRequest.modal_init),px.lightbox.change=!0},update_amounts:function(a){PayoutRequest.amount=a.available_integer,$(".pending_amount").html(a.pending),$(".total_amount").html(a.total),$(".available_amount").html(a.available)},paypal_clicked:function(){return PayoutRequest.method_clicked.call(this,"paypal"),!1},cheque_clicked:function(){return PayoutRequest.method_clicked.call(this,"cheque"),!1},paypal_complete:function(a,b){if(b.errors)$("#lightbox_content #payment-paypal .form_container").replaceWith(b.html);else if(b.success){$(this).closest(".form_container").hide();var c=$(this).closest(".payment-method"),d=c.find(".request-confirm");d.show(),d.find("#paypal-amount").html(b.amount),d.find("#paypal-sent-to").html(b.paypal_account),PayoutRequest.update_amounts(b.amounts),$("#payout-history").replaceWith(b.history),px.lightbox.change=!1}},cheque_complete:function(a,b){if(b.errors)$("#lightbox_content #payment-cheque .new_payment_form").closest(".form_container").replaceWith(b.html);else if(b.success){$(this).closest(".form_container").hide();var c=$(this).closest(".payment-method"),d=c.find(".request-confirm");d.find("#address_buttons").hide(),d.find(".close_request_confirm").show(),d.find("#cheque-amount").html(b.amount),d.show(),PayoutRequest.update_amounts(b.amounts),$("#payout-history").replaceWith(b.history),px.lightbox.change=!1}},method_clicked:function(a){if(PayoutRequest.amount==0)return alert("You have no money available for payment."),!1;if(PayoutRequest.amount<110&&a=="cheque")return alert("You must have at least $110 to request payment by cheque."),!1;if(PayoutRequest.amount<100)return alert("You must have at least $100 to request payment."),!1;PayoutRequest.show_modal(),$("#lightbox_content .payment-method").hide(),$("#lightbox_content #payment-"+a).show()},show_cheque_confirmation:function(){if(!PayoutRequest.validate($(this).closest("form")))return;$("#lightbox_content #cheque-amount").html($("#amount_to_be_paid_for_cheque").html());var a={address:{name:$("#lightbox_content #payout_request_address_attributes_first_name").val()+" "+$("#lightbox_content #payout_request_address_attributes_last_name").val(),address1:$("#lightbox_content #payout_request_address_attributes_address1").val(),city:$("#lightbox_content #payout_request_address_attributes_city").val()+", "+$("#lightbox_content #payout_request_address_attributes_state").val(),country:$("#lightbox_content #payout_request_address_attributes_country").val(),zip:$("#lightbox_content #payout_request_address_attributes_zip").val()}};$("#lightbox_content #confirm-name").html(a.address.name),$("#lightbox_content #confirm-address").html(a.address.address1),$("#lightbox_content #confirm-city").html(a.address.city),$("#lightbox_content #confirm-country").html(a.address.country),$("#lightbox_content #confirm-zip").html(a.address.zip),$(this).closest(".form_container").hide(),$(this).closest(".payment-method").find(".request-confirm").show()},validate:function(a){var b=$(a).find(".validate").get(),c;while(c=b.shift())if($(c).val().length==0)return $(c).focus(),$(c).addClass("error"),!1;return!0}},StorePayments={address_lightbox:function(a){$("#lightbox_content").width("320px"),$("#lightbox_content").height("490px"),$("#lightbox_content").prepend(a.find(".shipping-form").html())}};$("#current-orders a.cancel_order").live("ajax:beforeSend",function(a){$(this).addClass("loading")}),$("#current-orders a.cancel_order").live("ajax:success",function(a,b){$("#purchase_"+b.id).replaceWith(b.html)}),$("#current-orders a.change_shipping").live("click",function(){px.lightbox.initialize(StorePayments.address_lightbox,$(this).closest(".order"))}),$("#lightbox_content form.edit_address").live("ajax:beforeSend",function(a){$("#lightbox_content form.edit_address").hide(),$("#lightbox_content .address_loader").show()}),$("#lightbox_content form.edit_address").live("ajax:success",function(a,b){b.success?($("#lightbox_content .address_loader").hide(),$("#lightbox_content .address_updated").show(),$("#purchase_"+b.id).replaceWith(b.purchase_html)):($("#lightbox_content .address_loader").hide(),$("#lightbox_content .address_wrapper").replaceWith(b.html),$("#lightbox_content").height($("#lightbox_content form.new_address").height()))}),$("#lightbox_content .close_address_window").live("click",function(){px.lightbox.close()}),px.gift={},px.gift.send={init:function(){$("#gift-send-options").delegate(".send-option h4","click",px.gift.send.show_option).delegate(".send-option h4","mouseenter",px.gift.send.add_over_class).delegate(".send-option h4","mouseleave",px.gift.send.remove_over_class).delegate("#email form","ajax:success",px.gift.send.handle_email_form_response).delegate("#email form","ajax:beforeSend",delegate_chain(px.gift.send.prevent_double_submit,px.gift.send.show_loader)).delegate("#email form","ajax:complete",px.gift.send.hide_loader).delegate("#find-user form","ajax:success",px.gift.send.handle_user_form).delegate("#find-user form","ajax:beforeSend",delegate_chain(px.gift.send.prevent_double_submit,px.gift.send.show_loader)).delegate("#find-user form","ajax:complete",px.gift.send.hide_loader).delegate("a#gift_username_confirm","ajax:beforeSend",delegate_chain(Helper.stop_if_has_loading_class,Helper.show_loader)).delegate("a#gift_username_confirm","ajax:complete",Helper.hide_loader).delegate("a#gift_username_confirm","ajax:success",px.gift.send.handle_user_gifted),$(".send-option .option"
).hide()},handle_user_gifted:function(a,b){b.error?px.messages.create({type:"error",message:b.error}):($("#give_gift_options").hide(),$("#your_gift_was_sent_to").html($("#gift_username_value").val()),$(".send-options").hide("blind",{direction:"vertical"},1e3),$("#gift-send-complete").delay(1e3).show())},show_option:function(){$(".send-option h4").removeClass("on"),$(".send-option .option").slideUp("normal"),$(this).next().is(":hidden")&&($(this).addClass("on"),$(this).next().slideDown("normal"))},add_over_class:function(){$(this).addClass("over")},remove_over_class:function(){$(this).removeClass("over")},handle_email_form_response:function(a,b){b.error?$("#email form .error").html(b.error):($("#email form .error").html(""),$("#give_gift_options").hide(),$("#your_gift_was_sent_to").html($("#gift_email_value").val()),$(".send-options").hide("blind",{direction:"vertical"},1e3),$("#gift-send-complete").delay(1e3).queue(function(){$(this).show()}))},show_loader:function(){$(this).find(".submit_button").addClass("loading")},hide_loader:function(){$(this).find(".submit_button").removeClass("loading")},prevent_double_submit:function(){if($(this).find(".submit_button").hasClass("loading"))return!1},handle_user_form:function(a,b){b.error?$("#find-user form .error").html(b.error):($("#find-user form .error").html(""),$("#gift_username_confirm").attr("href","/upgrade/gift_username?user="+b.username+"&subscription_id="+b.subscription_id),$("#confirm_username").html(b.username),$("#confirm_name").html(b.fullname),$("#confirm_avatar").attr("src",b.avatar),$("#gift_username_results").show())}};var FriendsFinder={username:!1,more_id:{},invite:{name:""},init:function(){$(".find_friends_button form").live("submit",function(){return $(this).hide(),$(this).parent().addClass("loading"),px.oauth.login($(".button",this).attr("provider")),!1}),$("a.close_provider").live("click",function(){var a=$(this).closest(".friends");a.removeClass("display"),a.parents(".service").find(".find_friends_button").addClass("display"),a.parents(".service").find(".find_friends_button form").show()}),$("input.follow_friend").live("click",function(){var a=$(this).closest(".friend");return $.post("/settings/friendfinder",{username:a.attr("username")},function(a){a.error?alert(a.error):a.added&&($(".user_"+a.added).find(".follow_friend").closest("form").replaceWith('<a href="" class="following button" onclick="return false">Following</a>'),$(".user_"+a.added).find("a.following").effect("pulsate",{times:3},50))}),!1}),$("input.invite_friend").live("click",function(a){var b=$(this).attr("provider"),c=$(this).attr("recipient_id");return b=="facebook"?window.open("http://www.facebook.com/messages/"+c):(px.lightbox.initialize(FriendsFinder.lightbox),$("#lightbox #invitefriend_name").html($(this).attr("recipient_name")),$("#lightbox #invitefriend_form form").get(0).reset(),$("#lightbox #invite_message").val(FriendsFinder.message(b)),$("#lightbox #invitefriend_id").val(c),$("#lightbox #invitefriend_provider").val(b)),a.preventDefault(),!1}),$(".friend_finder_pagination a.ajax_pagination_link").live("click",function(){var a=$(this).closest(".friend_finder_pagination"),b=a.attr("provider"),c=a.attr("contact_type");$.ajax({url:"/settings/friendfinder/more",data:{page:$(this).attr("page"),provider:b,type:c},success:function(a){a.error?alert(a.error):$("#service_"+a.provider).find(c=="invite_contacts"?".invite_friends_list":".friends_list").replaceWith(a.html)},dataTypeString:"json"})}),$("#invitefriend_form form").live("submit",function(){var a=$(this);$("input[type=submit]",a).attr("disabled","disabled"),$(".loading",a).show(),$.post(this.action,$(this).serialize(),function(b){b.error&&alert(b.error),$(".loading",a).hide(),$("input[type=submit]",a).attr("disabled",null)})})},message:function(a){return a=="twitter"?"Hi! I want to invite you to 500px.com, an awesome photography community!\n\nSign up for a free account at http://500px.com/signup":"Hi! I want to invite you to 500px.com, an awesome photography community!\n\nSign up for a free account at http://500px.com/signup\n\nCheck out my profile and follow me at http://500px.com/"+FriendsFinder.username},oauth_failure:function(){alert("Sorry, there was something wrong with your login attempt. Please try again.")},refresh_view:function(a,b){var c=$("#service_"+a);c.find(".find_friends_button").removeClass("loading"),c.find(".invite_friends_list").html(""),c.find(".friends_list").html('<div class="loader"></div>'),b.html&&(c.find(".find_friends_button").removeClass("display"),c.find(".friends_list").hide(),c.find(".contacts_empty").remove(),c.find(".friends_list").replaceWith(b.html),c.find(".invite_friends_list").replaceWith(b.invite_html),c.find(".friendsfilter a.filter").unbind().click(function(){if($(this).hasClass("active"))return!1;var a=$(this).attr("href").split("#").join("");return c.find(".friendsfilter a.filter").removeClass("active"),$(this).addClass("active"),c.find(".friends").css("min-height",c.find(".friends").height()),c.find(".invite_friends_list, .friends_list").hide(),c.find("."+a).slideDown("fast"),setTimeout(function(){c.find(".friends").css("min-height","")},400),!1}),c.find(".friends").addClass("display"),c.find(".friends_list .contacts_empty").size()>0&&c.find(".invite_friends_list .contacts_empty").size()==0?c.find('a.filter[href="#invite_friends_list"]').click():c.find('a.filter[href="#friends_list"]').click())},refresh:function(a,b){$.get("/settings/friends_for_finder/"+a,b==null?"initial=1":"job_id="+b,function(b){var c=$("#service_"+a);b.pending===!0?setTimeout(function(){FriendsFinder.refresh(a,b.job_id)},1500):b.status=="failed"?(px.messages.create({type:"error",message:"Something went wrong. Please try again.",delay:1e4}),c.find(".find_friends_button").removeClass("loading"),c.find(".find_friends_button").addClass("display"),c.find(".find_friends_button form").show()):b.error?(c.find(".friends").addClass("display"),c.find(".loader").html(b.error)):b.html&&FriendsFinder.refresh_view(a,b)})},lightbox:function(){html=$("#invitefriend_form").clone(),$("#lightbox_content").width("420px"),$("#lightbox_content").height("300px"),$("#lightbox_content").prepend(html)}};Helper={},Helper.getDocHeight=function(){return Math.max($(document).height(),$(window).height(),document.documentElement.clientHeight)},Helper.show_loader=function(){$(this).addClass("loading")},Helper.hide_loader=function(){$(this).removeClass("loading")},Helper.stop_if_has_loading_class=function(){if($(this).hasClass("loading"))return!1},Ajax={},Ajax.update_html=function(a,b){var c;a.handleObj?c=b.html:c=a.html;if(c.replace){for(var d in c.replace)$("#"+d).replaceWith(c.replace[d]);c.replace=null}if(c.append){for(var d in c.append)$("#"+d).append(c.append[d]);c.append=null}if(c.prepend){for(var d in c.prepend)$("#"+d).append(c.prepend[d]);c.prepend=null}for(var d in c)$("#"+d).html(c[d])},$(".ajax_update_html").live("ajax:success",Ajax.update_html),px.applications={init:function(){$(document).ready(function(){$(".app-info").hide(),$(".view-details").click(function(){id=$(this).attr("id"),id=id.replace(/name-/g,""),info_compiled=info_template({app:data[id]}),$("#info-"+id).html(info_compiled),$(this).parent().parent().parent().find(".app-info").slideToggle(300)}),$("body").delegate("#app-register","ajax:success",px.applications.success).delegate("#app-register","ajax:error",px.applications.reg_error).delegate("#app-register","ajax:error",px.applications.reg_resize).delegate("#app-register .button","click",px.applications.loading_gif),$("#show-reg-from").click(function(){setTimeout("$('#lightbox_content #content').replaceWith($('#reg_form_template').html());",5)}),from_developers==1&&$("#show-reg-from").trigger("click"),_.templateSettings={interpolate:/\{\{(.+?)\}\}/g}})},show_edit_form:function(a){form_compiled=form_template({app:data[a]}),setTimeout("$('#lightbox_content #content').replaceWith(form_compiled);",5),$("body").delegate("#lightbox_content #app-edit","ajax:success",px.applications.success).delegate("#lightbox_content #app-edit","ajax:error",px.applications.edit_error).delegate("#lightbox_content #app-edit","ajax:error",px.applications.edit_resize).delegate("#lightbox_content .button","click",px.applications.loading_gif)},success:function(){if(from_developers==1)return window.location.assign("../settings/applications"),!0;window.location.reload()},edit_error:function(a,b){$("#lightbox_content #app-edit").replaceWith(b.responseText)},edit_resize:function(){var a=$("#lightbox_content #container").height();$("#lightbox_content").height(a+"px")},reg_error:function(a,b){b.status==401?window.location.assign("/login?r=%2Fdevelopers"):$("#lightbox_content #app-register").replaceWith(b.responseText)},reg_resize:function(){var a=$("#lightbox_content #app-register").height()+25;$("#lightbox_content").height(a+"px")},loading_gif:function(a){$(this).val()=="disabled"?a.preventDefault():($(this).val("disabled"),$(this).empty(),$(this).append(loading))}},on_page("settings_applications",px.applications.init),$("a.subscribe_to_comments_button").live("ajax:beforeSend",function(){if($(this).attr("disabled")=="disabled")return!1;$(this).addClass("loading"),$(this).attr("disabled","disabled")})