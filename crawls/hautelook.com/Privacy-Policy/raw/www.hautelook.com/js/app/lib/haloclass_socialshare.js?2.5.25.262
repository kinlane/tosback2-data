var a;$Halo.Social=$Halo.Social||{};
$Halo.Social.loadFbApi=$Halo.Social.loadFbApi||function(){$(document).ready(function(){if(window.FB)$Halo.bigbro.notify("Facebook_ApiReady");else{var b=$("#fb-root");if(b.size()===0)b=Halo.createEl({type:"div",opts:{id:"fb-root"}});var c=Halo.createEl({type:"script",opts:{src:"//connect.facebook.net/en_US/all.js",async:"true"}});b.append(c);window.fbAsyncInit=function(){FB.init({appId:"294902430988",status:true,cookie:true,xfbml:true,oauth:true});$Halo.bigbro.notify("Facebook_ApiReady")};$("body").append(b);
c=b=null}})};$Halo.Social.baseHref="http://"+window.location.host+"/index/index/mk/invite";$Halo.Social.enableFbLike=typeof $Halo.Social.enableFbLike==="undefined"?1:0;$Halo.Social.hidePlaxo=$.browser.msie==true&&$.browser.version.substr(0,1)=="8";$Halo.Social.hidePlaxo=$Halo.Social.hidePlaxo||$.browser.opera==true;
$Halo.Social.shareTypes={catalog:{popupText:'Get a $10 credit each time a friend you invite makes their first purchase. Your message to friends will be, "#eventTitle is on sale at HauteLook!"',popupTitle:"Enter the email addresses of your friends",twitterCopy:"Look what I found on @HauteLook. Check out #eventTitle now! "},product:{popupText:'Get a $10 credit each time a friend you invite makes their first purchase. Your message to friends will be, "Check out this item from #eventTitle now!"',popupTitle:"Enter the email addresses of your friends",
twitterCopy:"Look what I found on @HauteLook. Check out this item from #eventTitle now! "}};$Halo.Social.shareTypes.about=$Halo.Social.shareTypes.catalog;$Halo.ShareBar=$Halo.ShareBar||function(b){b=b||{};this.shareType=b.shareType||b.share_type||"invalid";if(this.shareType in $Halo.Social.shareTypes)for(var c in $Halo.Social.shareTypes[this.shareType])this[c]=$Halo.Social.shareTypes[this.shareType][c];this.dom=b.dom||false;this.data=b.data||{};this.useFbLike=$Halo.Social.enableFbLike&&b.useFbLike};
$Halo.ShareBar.prototype=new $Halo.Obj;a=$Halo.ShareBar.prototype;a.copyInserts=["eventTitle"];a.likeUrl="";a.shareUrl="";a.twitterLink="";a.fbLink="";a.emailUrl="/member-invites/email-share/";a.urlBuild={contentId:"/content/",eventTitle:"/title/",eventCode:"/event_code/",eventId:"/event_id/",productImage:"/product_image/",inventoryId:"/inventory_id/"};
a.init=function(){if(this.dom)this.dom=$(this.dom);else throw new Error("ShareBar Error: Cannot render because this.dom is not a valid node.");if(!this.member){$Halo.ShareBar.prototype.member=Sandbox.getMember();if(!this.member){Sandbox.forceMemberUpdate(false,$.proxy(this.init,this));return}}this.likeUrl="";this.likeUrl+=$Halo.Social.baseHref;for(var b in this.data)if(b in this.urlBuild)this.likeUrl+=this.urlBuild[b]+encodeURIComponent(this.data[b].replace(/\//g,"@").replace(/&/g,"%26").replace(/ /g,
"%20"));this.shareUrl="";this.shareUrl+=this.likeUrl+"/inv_code/"+this.member.invitation_code;for(b=0;b<this.copyInserts.length;b++)if(this.copyInserts[b]in this.data){re=new RegExp("#"+this.copyInserts[b],"g");this.popupText=this.popupText.replace(re,this.data[this.copyInserts[b]]);this.popupTitle=this.popupTitle.replace(re,this.data[this.copyInserts[b]]);this.twitterCopy=this.twitterCopy.replace(re,this.data[this.copyInserts[b]].replace(/&/g,"%26"))}this.fbLink="http://www.facebook.com/sharer.php?u="+
this.shareUrl+"?sid=99991";this.twitterLink="/twitter/index/base/"+encodeURIComponent(this.twitterCopy)+"/url/"+encodeURIComponent(this.shareUrl)+"?sid=99992";this._bindEvents()};
a._bindEvents=function(){this.dom.find("a.share_link").bindOnce("click.socialshare",$.proxy(function(){this.showOverlay();return false},this));this.dom.find("a.share_twitter").removeAttr("href").attr("href",this.twitterLink);this.dom.find("a.share_fb").removeAttr("href").attr("href",this.fbLink);if(this.useFbLike){this.like=this.like||new $Halo.FbLike;this.like.dom=this.dom;this.like.url=this.likeUrl;$Halo.bigbro.subscribe("Facebook_ApiReady",function(){$Halo.bigbro.unsubscribe("Facebook_ApiReady",
arguments.callee);this.like.render();FB.XFBML.parse()},this);$Halo.Social.loadFbApi()}};a.overlay=false;a.overlayContent=false;
a.getOverlay=function(){this.overlay?this.showOverlay():$.ajax({url:"/modules/html/module/overlays%2Fsocial-share?"+buildVersion,type:"GET",dataType:"html",success:$.proxy(function(b){$Halo.bigbro.subscribe("socialOverlayReady",function(c){$Halo.ShareBar.prototype.overlay=c;$Halo.ShareBar.prototype.overlayContent=$(b);$Halo.Social.hidePlaxo&&$Halo.ShareBar.prototype.overlayContent.find("#plaxo_container").remove();$(document).bind("overlayReady.social",$.proxy(function(){$(document).unbind("overlayReady.social");
this.showOverlay()},this));this.overlay.loadHTML(this.overlayContent)},this);$Halo.bigbro.notify("newOverlay","social",{minHeight:266,minWidth:425,displayLoader:false})},this)})};
a.loadPlaxo=function(){if(!$Halo.Social.hidePlaxo){var b=$(this.overlayContent);$.getScript("/js/plaxoloader.js",function(){b.find("#plaxo_container").bindOnce("click.social",function(){try{showPlaxoABChooser("invite_email_list","/plaxo")}catch(c){Halo.errors.add(c)}typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Invite popup","Plaxo"]);return true})})}};
a.resetOverlay=function(){var b=$(this.overlayContent);b.find(".invite_copy").html(this.popupText);b.find(".invite_title").text(this.popupTitle);b.find(".twitter_btn").attr("href",this.twitterLink).bindOnce("click.social",function(){typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Invite popup","Twitter"])});b.find(".fb_btn").attr("href",this.fbLink).bindOnce("click.social",function(){typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Invite popup","Facebook"])});var c=this;b.find(".invite_cancel").bindOnce("click.social",
function(){$("#moduleOverlayClose").click()});b.find(".invite_send").bindOnce("click.social",function(){typeof _gaq!=="undefined"&&_gaq.push(["_trackEvent","Invite popup","Email"]);c.sendEmail(c)});b.find("#invite_email_list").attr("value","");b.find(".invite_response").text("").addClass("hidden").removeClass("red")};
a.showOverlay=function(){if(this.overlay){$("#sb-container:visible").size()!==0&&$("#sb-nav-close").click();this.resetOverlay();this.loadPlaxo();this.overlay.display()}else $.getScript("/css/app/modules/default/overlays/social-share.css",$.proxy(this.getOverlay,this),undefined,"css")};
a.sendEmail=function(){var b=this.overlay,c=$(this.overlayContent);c.find(".invite_response").text("").addClass("hidden").removeClass("red");var d="referral_data[friend_emails]="+c.find("#invite_email_list").val().replace(/[\s&\?=<>\(\):`]/g,"").replace(/"[^"]*"/g,"");d+="&referral_data[url]="+this.shareUrl;d+="&referral_data[shareEmailType]="+this.shareType;d+="&referral_data[brand_name]="+encodeURIComponent(this.data.eventTitle);d+="&referral_data[event_id]="+(this.data.eventId||this.data.contentId);
$.ajax({url:this.emailUrl,type:"post",data:d,dataType:"json",success:function(e){if(e&&e.message){c.find(".invite_response").text(e.message).removeClass("hidden");if(+e.success===1){c.find(".invite_response").addClass("red");c.find("#invite_email_list").attr("value","")}}b.resize()}})};$Halo.FbLike=$Halo.FbLike||function(b){b=b||{};this.dom=b.dom?$(b.dom):false;this.node=false;this.url=b.url||false};$Halo.FbLike.prototype=new $Halo.Obj;
$Halo.FbLike.prototype.render=function(){if(!this.url||!this.dom||!this.dom.size())throw new Error("Cannot render Facebook Like, invalid data");if(this.node){$(this.node).remove();this.node=null}this.node=Halo.createEl({into:this.dom,type:"fb:like",opts:{show_faces:"false",href:this.url,font:"arial"}})};$Halo.InviteBar=$Halo.InviteBar||function(b){b=b||{};this.dom=b.dom||false;this.emailDefault=b.emailDefault||""};$Halo.InviteBar.prototype=new $Halo.ShareBar;a=$Halo.InviteBar.prototype;
a.twitterCopy="I find amazing deals every day on HauteLook. Check it out! ";a.popupText='Get a $10 credit each time a friend you invite makes their first purchase.<br /><br />Your message to friends will be, "Come join me on HauteLook!"<br /><br />';a.popupTitle="Enter the email addresses of your friends";a.data={};a.useFbLike=0;a.copyInserts=[];a.emailUrl="/member-invites/email-invites/";
a._bindEvents=function(){this.dom.children("img, div.btn").bindOnce("click.social",$.proxy(function(){var b=this.dom.find("#headerInviteEmail").val();if(b!==""&&b!==this.emailDefault)this.showOverlay=function(){if(this.overlay){this.resetOverlay();$(this.overlayContent).find("#invite_email_list").attr("value",b);this.dom.find("#headerInviteEmail").attr("value","");this.loadPlaxo();this.sendEmail();delete this.showOverlay}else $.getScript("/css/app/modules/default/overlays/social-share.css",$.proxy(this.getOverlay,
this),undefined,"css")};this.showOverlay();return false},this));$Halo.bigbro.notify("SocialBound");this.dom.children("#headerInviteEmail").bindOnce("keydown.social",$.proxy(function(b){+b.keyCode==13&&this.dom.find("div.btn").click()},this))};
a.sendEmail=function(){var b=this.overlay,c=$(this.overlayContent),d=c.find("#invite_email_list").val().replace(/[\s&\?=<>\(\):`]/g,"").replace(/"[^"]*"/g,"");c.find(".invite_response").text("").addClass("hidden").removeClass("red");d="referral_data[friend_emails]="+d;d+="&referral_data[url]="+this.shareUrl;d+="&referral_data[personal_msg]="+escape("Come join me on HauteLook!");$.ajax({url:this.emailUrl,type:"post",data:d,dataType:"json",success:$.proxy(function(e){if(e&&e.message){c.find(".invite_response").text(e.message).removeClass("hidden");
if(+e.success===1){c.find(".invite_copy").html('Enter more friends\' email addresses to get more $10 credits each time one of them makes their first purchase. <br /><br />Your message to friends will be, "Come join me on HauteLook!"<br /><br />');c.find(".invite_title").text("Invitation sent!");c.find("#invite_email_list").attr("value","")}else{c.find(".invite_response").addClass("red");c.find(".invite_copy").html(this.popupText);c.find(".invite_title").text(this.popupTitle)}}if(e=(e=$("#moduleOverlayLoadedContent").size()===
1)&&$("#moduleOverlayLoadedContent").data("overlay").name==b.name)b.resize();else{$("#sb-container:visible").size()!==0&&$("#sb-nav-close").click();b.display()}},this)})};
