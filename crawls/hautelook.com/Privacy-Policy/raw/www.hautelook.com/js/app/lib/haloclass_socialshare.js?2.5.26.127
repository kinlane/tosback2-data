$Halo.Social=$Halo.Social||{};
$Halo.Social.loadFbApi=$Halo.Social.loadFbApi||function(){$(document).ready(function(){if(window.FB)$Halo.bigbro.notify("Facebook_ApiReady");else{var a=$("#fb-root");0===a.size()&&(a=Halo.createEl({type:"div",opts:{id:"fb-root"}}));var c=Halo.createEl({type:"script",opts:{src:"//connect.facebook.net/en_US/all.js",async:"true"}});a.append(c);window.fbAsyncInit=function(){FB.init({appId:"294902430988",status:!0,cookie:!0,xfbml:!0,oauth:!0});$Halo.bigbro.notify("Facebook_ApiReady")};$("body").append(a);
c=a=null}})};$Halo.Social.baseHref="http://"+window.location.host+"/index/index/mk/invite";$Halo.Social.enableFbLike="undefined"===typeof $Halo.Social.enableFbLike?1:0;$Halo.Social.hidePlaxo=!0==$.browser.msie&&"8"==$.browser.version.substr(0,1);$Halo.Social.hidePlaxo=$Halo.Social.hidePlaxo||!0==$.browser.opera;
$Halo.Social.shareTypes={catalog:{popupText:'Get a $10 credit each time a friend you invite makes their first purchase. Your message to friends will be, "#eventTitle is on sale at HauteLook!"',popupTitle:"Enter the email addresses of your friends",twitterCopy:"Look what I found on @HauteLook. Check out #eventTitle now! "},product:{popupText:'Get a $10 credit each time a friend you invite makes their first purchase. Your message to friends will be, "Check out this item from #eventTitle now!"',popupTitle:"Enter the email addresses of your friends",
twitterCopy:"Look what I found on @HauteLook. Check out this item from #eventTitle now! "}};$Halo.Social.shareTypes.about=$Halo.Social.shareTypes.catalog;$Halo.ShareBar=$Halo.ShareBar||function(a){a=a||{};this.shareType=a.shareType||a.share_type||"invalid";if(this.shareType in $Halo.Social.shareTypes)for(var c in $Halo.Social.shareTypes[this.shareType])this[c]=$Halo.Social.shareTypes[this.shareType][c];this.dom=a.dom||!1;this.data=a.data||{};this.useFbLike=$Halo.Social.enableFbLike&&a.useFbLike};
$Halo.ShareBar.prototype=new $Halo.Obj;$Halo.ShareBar.prototype.copyInserts=["eventTitle"];$Halo.ShareBar.prototype.likeUrl="";$Halo.ShareBar.prototype.shareUrl="";$Halo.ShareBar.prototype.twitterLink="";$Halo.ShareBar.prototype.fbLink="";$Halo.ShareBar.prototype.emailUrl="/member-invites/email-share/";$Halo.ShareBar.prototype.urlBuild={contentId:"/content/",eventTitle:"/title/",eventCode:"/event_code/",eventId:"/event_id/",productImage:"/product_image/",inventoryId:"/inventory_id/"};
$Halo.ShareBar.prototype.init=function(){if(this.dom)this.dom=$(this.dom);else throw Error("ShareBar Error: Cannot render because this.dom is not a valid node.");if(!this.member&&($Halo.ShareBar.prototype.member=Sandbox.getMember(),!this.member)){Sandbox.forceMemberUpdate(!1,$.proxy(this.init,this));return}this.likeUrl="";this.likeUrl+=$Halo.Social.baseHref;for(var a in this.data)a in this.urlBuild&&(this.likeUrl+=this.urlBuild[a]+encodeURIComponent(this.data[a].replace(/\//g,"@").replace(/&/g,"%26").replace(/ /g,
"%20")));this.shareUrl="";this.shareUrl+=this.likeUrl+"/inv_code/"+this.member.invitation_code;for(a=0;a<this.copyInserts.length;a++)this.copyInserts[a]in this.data&&(re=RegExp("#"+this.copyInserts[a],"g"),this.popupText=this.popupText.replace(re,this.data[this.copyInserts[a]]),this.popupTitle=this.popupTitle.replace(re,this.data[this.copyInserts[a]]),this.twitterCopy=this.twitterCopy.replace(re,this.data[this.copyInserts[a]].replace(/&/g,"%26")));this.fbLink="http://www.facebook.com/sharer.php?u="+
this.shareUrl+"?sid=99991";this.twitterLink="/twitter/index/base/"+encodeURIComponent(this.twitterCopy)+"/url/"+encodeURIComponent(this.shareUrl)+"?sid=99992";this._bindEvents()};
$Halo.ShareBar.prototype._bindEvents=function(){this.dom.find("a.share_link").bindOnce("click.socialshare",$.proxy(function(){this.showOverlay();return!1},this));this.dom.find("a.share_twitter").removeAttr("href").attr("href",this.twitterLink);this.dom.find("a.share_fb").removeAttr("href").attr("href",this.fbLink);this.useFbLike&&(this.like=this.like||new $Halo.FbLike,this.like.dom=this.dom,this.like.url=this.likeUrl,$Halo.bigbro.subscribe("Facebook_ApiReady",function(){$Halo.bigbro.unsubscribe("Facebook_ApiReady",
arguments.callee);this.like.render();FB.XFBML.parse()},this),$Halo.Social.loadFbApi())};$Halo.ShareBar.prototype.overlay=!1;$Halo.ShareBar.prototype.overlayContent=!1;
$Halo.ShareBar.prototype.getOverlay=function(){this.overlay?this.showOverlay():$.ajax({url:"/modules/html/module/overlays%2Fsocial-share?"+buildVersion,type:"GET",dataType:"html",success:$.proxy(function(a){$Halo.bigbro.subscribe("socialOverlayReady",function(c){$Halo.ShareBar.prototype.overlay=c;$Halo.ShareBar.prototype.overlayContent=$(a);$Halo.Social.hidePlaxo&&$Halo.ShareBar.prototype.overlayContent.find("#plaxo_container").remove();$(document).bind("overlayReady.social",$.proxy(function(){$(document).unbind("overlayReady.social");
this.showOverlay()},this));this.overlay.loadHTML(this.overlayContent)},this);$Halo.bigbro.notify("newOverlay","social",{minHeight:266,minWidth:425,displayLoader:!1})},this)})};
$Halo.ShareBar.prototype.loadPlaxo=function(){if(!$Halo.Social.hidePlaxo){var a=$(this.overlayContent);$.getScript("/js/plaxoloader.js",function(){a.find("#plaxo_container").bindOnce("click.social",function(){try{showPlaxoABChooser("invite_email_list","/plaxo")}catch(a){Halo.errors.add(a)}"undefined"!==typeof _haq&&_haq.push(["_trackEvent","Invite popup","Plaxo"]);return!0})})}};
$Halo.ShareBar.prototype.resetOverlay=function(){var a=$(this.overlayContent);a.find(".invite_copy").html(this.popupText);a.find(".invite_title").text(this.popupTitle);a.find(".twitter_btn").attr("href",this.twitterLink).bindOnce("click.social",function(){"undefined"!==typeof _haq&&_haq.push(["_trackEvent","Invite popup","Twitter"])});a.find(".fb_btn").attr("href",this.fbLink).bindOnce("click.social",function(){"undefined"!==typeof _haq&&_haq.push(["_trackEvent","Invite popup","Facebook"])});var c=
this;a.find(".invite_cancel").bindOnce("click.social",function(){$("#moduleOverlayClose").click()});a.find(".invite_send").bindOnce("click.social",function(){"undefined"!==typeof _haq&&_haq.push(["_trackEvent","Invite popup","Email"]);c.sendEmail(c)});a.find("#invite_email_list").attr("value","");a.find(".invite_response").text("").addClass("hidden").removeClass("red")};
$Halo.ShareBar.prototype.showOverlay=function(){this.overlay?(0!==$("#sb-container:visible").size()&&$("#sb-nav-close").click(),this.resetOverlay(),this.loadPlaxo(),this.overlay.display()):$.getScript("/css/app/modules/default/overlays/social-share.css",$.proxy(this.getOverlay,this),void 0,"css")};
$Halo.ShareBar.prototype.sendEmail=function(){var a=this.overlay,c=$(this.overlayContent);c.find(".invite_response").text("").addClass("hidden").removeClass("red");var b="referral_data[friend_emails]="+c.find("#invite_email_list").val().replace(/[\s&\?=<>\(\):`]/g,"").replace(/"[^"]*"/g,""),b=b+("&referral_data[url]="+this.shareUrl),b=b+("&referral_data[shareEmailType]="+this.shareType),b=b+("&referral_data[brand_name]="+encodeURIComponent(this.data.eventTitle)),b=b+("&referral_data[event_id]="+(this.data.eventId||
this.data.contentId));$.ajax({url:this.emailUrl,type:"post",data:b,dataType:"json",success:function(b){b&&b.message&&(c.find(".invite_response").text(b.message).removeClass("hidden"),1===+b.success&&(c.find(".invite_response").addClass("red"),c.find("#invite_email_list").attr("value","")));a.resize()}})};$Halo.FbLike=$Halo.FbLike||function(a){a=a||{};this.dom=a.dom?$(a.dom):!1;this.node=!1;this.url=a.url||!1};$Halo.FbLike.prototype=new $Halo.Obj;
$Halo.FbLike.prototype.render=function(){if(!this.url||!this.dom||!this.dom.size())throw Error("Cannot render Facebook Like, invalid data");this.node&&($(this.node).remove(),this.node=null);this.node=Halo.createEl({into:this.dom,type:"fb:like",opts:{show_faces:"false",href:this.url,font:"arial"}})};$Halo.InviteBar=$Halo.InviteBar||function(a){a=a||{};this.dom=a.dom||!1;this.emailDefault=a.emailDefault||""};$Halo.InviteBar.prototype=new $Halo.ShareBar;$Halo.InviteBar.prototype.twitterCopy="I find amazing deals every day on HauteLook. Check it out! ";
$Halo.InviteBar.prototype.popupText='Get a $10 credit each time a friend you invite makes their first purchase.<br /><br />Your message to friends will be, "Come join me on HauteLook!"<br /><br />';$Halo.InviteBar.prototype.popupTitle="Enter the email addresses of your friends";$Halo.InviteBar.prototype.data={};$Halo.InviteBar.prototype.useFbLike=0;$Halo.InviteBar.prototype.copyInserts=[];$Halo.InviteBar.prototype.emailUrl="/member-invites/email-invites/";
$Halo.InviteBar.prototype._bindEvents=function(){this.dom.children("img, div.btn").bindOnce("click.social",$.proxy(function(){var a=this.dom.find("#headerInviteEmail").val();""!==a&&a!==this.emailDefault&&(this.showOverlay=function(){this.overlay?(this.resetOverlay(),$(this.overlayContent).find("#invite_email_list").attr("value",a),this.dom.find("#headerInviteEmail").attr("value",""),this.loadPlaxo(),this.sendEmail(),delete this.showOverlay):$.getScript("/css/app/modules/default/overlays/social-share.css",
$.proxy(this.getOverlay,this),void 0,"css")});this.showOverlay();return!1},this));$Halo.bigbro.notify("SocialBound");this.dom.children("#headerInviteEmail").bindOnce("keydown.social",$.proxy(function(a){13==+a.keyCode&&this.dom.find("div.btn").click()},this))};
$Halo.InviteBar.prototype.sendEmail=function(){var a=this.overlay,c=$(this.overlayContent),b=c.find("#invite_email_list").val().replace(/[\s&\?=<>\(\):`]/g,"").replace(/"[^"]*"/g,"");c.find(".invite_response").text("").addClass("hidden").removeClass("red");b="referral_data[friend_emails]="+b+("&referral_data[url]="+this.shareUrl);b+="&referral_data[personal_msg]="+escape("Come join me on HauteLook!");$.ajax({url:this.emailUrl,type:"post",data:b,dataType:"json",success:$.proxy(function(b){b&&b.message&&
(c.find(".invite_response").text(b.message).removeClass("hidden"),1===+b.success?(c.find(".invite_copy").html('Enter more friends\' email addresses to get more $10 credits each time one of them makes their first purchase. <br /><br />Your message to friends will be, "Come join me on HauteLook!"<br /><br />'),c.find(".invite_title").text("Invitation sent!"),c.find("#invite_email_list").attr("value","")):(c.find(".invite_response").addClass("red"),c.find(".invite_copy").html(this.popupText),c.find(".invite_title").text(this.popupTitle)));
(b=(b=1===$("#moduleOverlayLoadedContent").size())&&$("#moduleOverlayLoadedContent").data("overlay").name==a.name)?a.resize():(0!==$("#sb-container:visible").size()&&$("#sb-nav-close").click(),a.display())},this)})};
