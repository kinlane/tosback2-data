(function(){var b=BrowserStorage.setStorageEngines("cookie");Halo.setTrackingCookiesFromUrl();if(b.get("hlmt")!==null){b=arguments;var c=Sandbox.getMember(),e=function(){var a="",f=window.location.pathname.toString(),h=window.location.search.toString(),d=f.split("/");if(arrayIndexOf.call(["","campaigns","invite","index","canada","nordstromrack"],d[1])!=-1){if(h.length>0){h=h.substring(1).split("&");for(var g in h){a=h[g].split("=");a[1]=a[1].split("#")[0];switch(a[0]){case "event_id":a="/event/"+
a[1];break;case "inventory_id":a="/product/"+a[1];break;case "u":a=a[1];break;case "content":a="/content/"+a[1];break;default:a="/events";break}if(a!="/events")break}}if(!a||a=="/events"){d=f.split("/");for(g in d){switch(d[g]){case "event_id":a="/event/"+d[+g+1];break;case "inventory_id":a="/product/"+d[+g+1];break;case "u":a=d[+g+1];break;case "content":a="/content/"+d[+g+1];break;default:a="/events";break}if(a!="/events")break}}if(a)window.location.href=a}};if(c)if(c.expirationTS&&c.expirationTS>
+new Date){Sandbox.setMember(false);arguments.callee()}else e();else Sandbox.forceMemberUpdate(b.callee,e)}else{c=["","campaigns","index","canada","nordstromrack"];e=window.location.pathname.split("/");if(arrayIndexOf.call(["returns-policy","return-policy","about","support","careers","affiliate","help","unsubscribe","giftreturns","forgot-password","press","apps","apps/iphone","logout","login"],e[1])!=-1){Sandbox.setMember(false);$Halo.bigbro.notify("memberNotLoggedIn")}else{window.location.pathname!=
"/"&&b.set("RETURN_URL",window.location.pathname);if(b.get("HLMEMBER")!==null&&e[1]!="login")window.location.href="/login";else if(arrayIndexOf.call(c,e[1])==-1&&b.get("HLMEMBER")===null)window.location.href="/";else $().ready(function(){$(".hidden").removeClass("hidden")})}}})();
var checkLogin=function(){var b={controller_name:"",action_name:"",url:"",format:"json"};return function(c,e,a){b.controller_name=c;b.action_name=e;b.url=a;$.ajax({type:"POST",url:"/login/check-login",dataType:"json",data:b,success:function(f){try{if(f&&typeof f.success!="undefined"&&f.success==true)window.location.href=f.data.return_url;else throw new Error("Response from login/check-login was invalid.");}catch(h){this.error()}},error:function(){$.getScript("/js/app/modules/loaders/overlays/soft-login.js",
function(){Sandbox.moduleStatus("overlays/login/soft-login")==="active"?$Halo.bigbro.notify("softLoginOverlayDisplay"):setTimeout(arguments.callee,25)})}});return false}}();
$(document).ready(function(){$("#headerCheckout .btn, #moduleCart div.checkout_btn").live("click",function(){return checkLogin("checkout","index","/checkout")});$("#ModulePaypalOverlay #paypal_ok").live("click",function(){window.location.href="/paypal/set-express-checkout"});$(".ssl_link").live("click",function(){var b={controller_name:"member",action_name:"",url:""},c=$(this).attr("href").substring(1);if($.browser.msie&&($.browser.version.indexOf("7")==0||$.browser.version.indexOf("6")==0)&&c.indexOf(".com")!=
-1)c=c.substring(+c.indexOf(".com")+5);switch(c){case "orders":b.action_name="orders";b.url="/orders";break;case "returns":b.action_name="returns";b.url="/returns";break;case "shipping":b.action_name="shipping";b.url="/shipping";break;case "invites":b.action_name="invites";b.url="/invites";break;case "account":default:b.action_name="account";b.url="/account";break}return checkLogin(b.controller_name,b.action_name,b.url)})});
