var messaging=function(l){function c(b){var a=$(document.createElement(b.type));"undefined"!=typeof b.opts&&$.each(b.opts,function(b,k){a.attr(b,k)});"undefined"!=typeof b.txt&&a.html(b.txt);"undefined"==typeof b.where?a.appendTo(b.into):a.prependTo(b.into);return a}var a=$.extend(!0,{},{shadowbox:{content:null,height:110,initialHeight:110,initialWidth:310,player:"html",title:null,width:310,options:{animSequence:"sync",enableKeys:!1,setKeys:{27:"Shadowbox.close()"},onFinish:function(){},onClose:function(){$(document).trigger("shadowbox_closed")},
modal:!0}},base_url:!1,cache_html:!0,additional_params:"",cache_response:!1,require_response:!0,messaging_id:!1},l),g=!1,f=!1,h=0,i=0,e={init:function(){document.getElementById("messaging_popups")||c({into:"body",type:"div",opts:{id:"messaging_popups",style:"display: none;"}});if(!1===a.messaging_id||1==$("#"+a.messaging_id).length)a.messaging_id=a.base_url.replace(/-/,"_")+"_"+(""+(new Date).getTime()).replace(/\D/gi,""),c({into:$("#messaging_popups"),type:"div",opts:{id:"messaging_placeholder_"+
a.messaging_id,style:"width:"+a.shadowbox.initialWidth+"px; height:"+a.shadowbox.initialHeight+"px;"}}),c({into:"#messaging_placeholder_"+a.messaging_id,type:"div",opts:{id:a.messaging_id,"class":"messaging"}}),a.shadowbox.href="#messaging_placeholder_"+a.messaging_id,e.getHtml()},getHtml:function(){$.ajax({url:"/messaging/"+(a.cache_html?"cache/":"")+a.base_url+"/html"+a.additional_params,cache:!0,success:function(b){1==$("#"+a.messaging_id).length?($("#"+a.messaging_id).empty(),$("#"+a.messaging_id).html(b)):
c({into:$("#messaging_popups"),type:"div",opts:{id:a.messaging_id,"class":"messaging"},txt:b})}})},getResponse:function(b,d,j){if("undefined"==typeof b||null===b)b={empty:0};$.ajax({type:"post",url:"/messaging/"+(a.cache_response?"cache/":"")+a.base_url+a.additional_params,data:b,dataType:"json",success:function(k){a.cache_response&&(g=k);f||e.processResponseAndDisplayShadowbox($.extend(!0,b,k),d,j)}})},processResponseAndDisplayShadowbox:function(b,d,j){"undefined"!=typeof b.success&&(!0===b.success&&
!1===f)&&(f=!0,$.each(b.data.messaging_js,function(b,a){h+=1;$.getScript(a,function(){h-=1})}),$.each(b.data.messaging_css,function(a,b){i+=1;$.getScript(b,function(){i-=1},"css")}),$("#"+a.messaging_id).ready(function(){"undefined"==typeof b.data&&(b.data={});var e=setInterval(function(){var c,g;if(h===0&&i===0){c=$("#messaging_placeholder_"+a.messaging_id);clearInterval(e);a.shadowbox.content=c.html();g=c.find("#"+a.messaging_id).detach();a.shadowbox.options.onFinish=function(){f=false;if(typeof d==
"function")d(b);else if(typeof d=="string"&&typeof j=="string")window[j][d](b);g.appendTo(c)};Shadowbox.open(a.shadowbox)}},225)}))}};this.resize=function(){};this.close=function(a,d){Shadowbox.close();if("function"==typeof a)a(response);else if("string"==typeof a&&"string"==typeof d)window[d][a](response)};this.display=function(b,d,c){"function"===typeof Shadowbox.open&&!f&&(f=!0,a.require_response?a.cache_response&&!1!==g?e.processResponseAndDisplayShadowbox(g,d,c):e.getResponse(b,d,c):e.processResponseAndDisplayShadowbox({success:!0,
data:b},d,c),f=!1)};e.init()};
