(function(B){B.fn.buildecho=function(D){return this.each(function(){new B.buildecho(this,D);});};var A=TWP.eidosBase||"http://devprev.digitalink.com";var C={config:{dserv:A,badgeText:A+"/Fragment/SysConfig/WebPortal/twpweb/modules/comments/badge_text.jpt",echoContainer:"echo_container",badgeTextContainer:"echo-tip-text-container",echoVars:"comment-vars"},submitboxTemplate:"<!--  submit box container -->"+'<div id="echo_comment_box_container{elementIndex}" class="echo_comment_box_wrapper">'+'<div class="comment-box-header" id="echo_comment_box_header{elementIndex}"> '+'<span class="weigh-in" id="weighIn">{commentType}</span> '+'<div id="comment-info-links">'+'<span class="discussion-policy">'+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_policy.html">Discussion Policy</a>'+"</span>"+'<span class="faq-policy"> | '+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_faq.html#faq">FAQ</a>'+"</span>"+'<span class="about-comments"> | '+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_faq.html">{linkText}</a>'+"</span>"+"</div>"+"<!-- /weigh in box --> "+"<!-- Submit form container --> "+'<div class="echo-comment comment-box hidden" id="echo_comment_box{elementIndex}"> </div>'+'<div style="clear: both;height:0px;">&#160;</div> '+"</div></div> <!-- /submit form container -->",countTemplate:"<!-- Comment count container --> "+'<div  id="echo_count_container{elementIndex}" class="comment-count comment-count-primary echo-count-container">'+'<span class="count-bubble smoother-dark"> '+'<span  id="echo_counter{elementIndex}" class="comment-number echo-counter count-bubble-number{elementIndex}"><span class="loading">Loading...</span></span> '+'<span class="count-bubble-end"></span> '+"</span> "+'<span class="count-label smoother-light">{commentType}</span> '+"</div>"+"<!-- /Comment count container -->",streamTemplate:"<!-- Stream container --> "+'<div id="echo_stream_container{elementIndex}" class="echo_stream_container margin-bottom-20">'+'<div class="comment-header" rel="{streamtarget}"> '+"{tablinks}"+"</div> "+"<!-- /comment tab container -->"+"<!-- comment stream container --> "+'<div id="echo_comment_stream{elementIndex}" class="echo-stream"></div> '+"</div><!--  /stream container -->",tablinks:'<div class="stream-header-info">'+'<span class="others-saying">Read what others are saying</span>'+'<span class="about-badges"><a href="http://www.washingtonpost.com/wp-srv/interactivity/get-a-badge.html">About Badges</a></span>'+"</div>"+'<ul id="comment-stream-tabs" class="header-primary comment-stream-tabs"></ul>',sortlinks:'<ul id="comment-stream-sortorder" class="header-secondary comment-stream-sortorder"> '+'<li class="option active"><a href="#" rel="reverseChronological">Newest first</a> </li> '+'<li class="option last"> <a href="#" rel="chronological">Oldest first</a></li> '+'<li class="option last"><a href="#" rel="likesDescending">Most Recommended first</a></li>'+"</ul> "};B.buildecho=function(E,D){this.options=B.extend(C,D);this.props={};this.init(E);};B.buildecho.fn=B.buildecho.prototype={};B.buildecho.fn.extend=B.buildecho.extend=jQuery.extend;B.buildecho.fn.extend({createDataObject:function(I){var F={};if(typeof I.attr("data")!=="undefined"&&I.attr("data").length>0){var G=I.attr("data").split("&");for(var E=0;E<G.length;E++){if(G[E]!=""){var D=G[E].split("=");F[D[0].toLowerCase()]=(D[1]=="true")?true:(D[1])=="false"?false:D[1];}}}else{var G;G=I[0].attributes;for(var E=0;E<G.length;E++){var H=G[E].nodeValue;F[G[E].nodeName.toLowerCase()]=(H=="true")?true:(H)=="false"?false:H;}}return F;},init:function(F){var D=this;var E=B(F);if(E.length==0){return ;}E.each(function(I,G){var L=B(G);var H="";var M="";if(L.children().length==0){H=new Date();M="_"+H.getTime()+"_"+(Math.floor(Math.random()*22));L.attr("id",(D.options.config.echoContainer+M));var J=B('<div class="comments" id="comments'+M+'"></div>');L.append(J);if(B("#echo-tip-text-container").length==0){L.append('<div id="'+D.options.config.badgeTextContainer+'"></div>');}if(B(".badgetext").length==0){D.loadTextFile(D.options.config.badgeText,B("#"+D.options.config.badgeTextContainer));}var N=L.attr("class").replace(/\s+/g," ").split(" ");var K=D.createDataObject(L);B.each(N,function(Q,R){if(R!=D.options.config.echoContainer&&R!=D.options.config.echoVars){R=R.replace("-","");var O="";var T="";try{T=D.options[R+"Template"];}catch(S){}if(R=="stream"){T=T.replace("{streamtarget}","echo_comment_stream"+M);T=(K.includetabs!=false)?T.replace("{tablinks}",D.options.tablinks):T.replace("{tablinks}","");}if(R=="count"){var P=(K.webtype=="discussion_story")?"Posts":"Comments";T=T.replace("{commentType}",P);}if(R=="submitbox"){var U=(K.webtype=="discussion_story")?"Your Posts":((K.webtype=="ugc_photo_story")?"Post a Photo":(K.webtype=="topic_story")?"Start a conversation":(K.webtype=="promo_story")?"Add your thoughts":"Weigh In");T=T.replace("{commentType}",U);U=(K.webtype=="ugc_photo_story")?"About Photo Galleries":"About Discussions";T=T.replace("{linkText}",U);U=(K.webtype=="ugc_photo_story")?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":"";T=T.replace("{linkSpacer}",U);}if(R=="count"||R=="submitbox"||R=="stream"){O=B(T.replace(/{elementIndex}/gi,M));B(".echo-counter",O).attr("guid",K.guid);B(".echo-comment",O).attr("guid",K.guid);B(".echo-stream",O).attr("guid",K.guid);B(L).append(O);}}});L.addClass("comments");}else{}});},loadTextFile:function(F,D){var E="";E=B.ajax({url:F,async:false});D.append(B(E.responseText));}});})(jQuery);