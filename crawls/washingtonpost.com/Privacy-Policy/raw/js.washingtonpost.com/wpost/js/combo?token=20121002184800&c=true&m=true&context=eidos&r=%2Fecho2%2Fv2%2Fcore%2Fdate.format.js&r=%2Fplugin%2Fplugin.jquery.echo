var dateFormat=function(){var A=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,B=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,D=/[^-+\dA-Z]/g,C=function(F,E){F=String(F);E=E||2;while(F.length<E){F="0"+F;}return F;};return function(J,V,R){var G=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(J)=="[object String]"&&!/\d/.test(J)){V=J;J=undefined;}J=J?new Date(J):new Date;if(isNaN(J)){throw SyntaxError("invalid date");}V=String(G.masks[V]||V||G.masks["default"]);if(V.slice(0,4)=="UTC:"){V=V.slice(4);R=true;}var T=R?"getUTC":"get",O=J[T+"Date"](),E=J[T+"Day"](),K=J[T+"Month"](),Q=J[T+"FullYear"](),S=J[T+"Hours"](),N=J[T+"Minutes"](),U=J[T+"Seconds"](),P=J[T+"Milliseconds"](),F=R?0:J.getTimezoneOffset(),I={d:O,dd:C(O),ddd:G.i18n.dayNames[E],dddd:G.i18n.dayNames[E+7],m:K+1,mm:C(K+1),mmm:G.i18n.monthNames[K],mmmm:G.i18n.monthNames[K+12],yy:String(Q).slice(2),yyyy:Q,h:S%12||12,hh:C(S%12||12),H:S,HH:C(S),M:N,MM:C(N),s:U,ss:C(U),l:C(P,3),L:C(P>99?Math.round(P/10):P),t:S<12?"a":"p",tt:S<12?"am":"pm",T:S<12?"A":"P",TT:S<12?"AM":"PM",Z:R?"UTC":(String(J).match(B)||[""]).pop().replace(D,""),o:(F>0?"-":"+")+C(Math.floor(Math.abs(F)/60)*100+Math.abs(F)%60,4),S:["th","st","nd","rd"][O%10>3?0:(O%100-O%10!=10)*O%10]};return V.replace(A,function(H){return H in I?I[H]:H.slice(1,H.length-1);});};}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(A,B){return dateFormat(this,A,B);};(function(B){B.fn.buildecho=function(D){return this.each(function(){new B.buildecho(this,D);});};var A=TWP.eidosBase||"http://www.washingtonpost.com";var C={config:{dserv:A,badgeText:A+"/Fragment/SysConfig/WebPortal/twpweb/modules/comments/badge_text.jpt",echoContainer:"echo_container",badgeTextContainer:"echo-tip-text-container",echoVars:"comment-vars"},submitboxTemplate:"<!--  submit box container -->"+'<div id="echo_comment_box_container{elementIndex}" class="echo_comment_box_wrapper">'+'<div class="comment-box-header" id="echo_comment_box_header{elementIndex}"> '+'<span class="weigh-in" id="weighIn">{commentType}</span> '+'<div id="comment-info-links">'+'<span class="discussion-policy">'+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_policy.html">Discussion Policy</a>'+"</span>"+'<span class="faq-policy"> | '+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_faq.html#faq">FAQ</a>'+"</span>"+'<span class="about-comments"> | '+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_faq.html">{linkText}</a>'+"</span>"+"</div>"+"<!-- /weigh in box --> "+"<!-- Submit form container --> "+'<div class="echo-comment comment-box hidden" id="echo_comment_box{elementIndex}"> </div>'+'<div style="clear: both;height:0px;">&#160;</div> '+"</div></div> <!-- /submit form container -->",countTemplate:"<!-- Comment count container --> "+'<div  id="echo_count_container{elementIndex}" class="comment-count comment-count-primary echo-count-container">'+'<span class="count-bubble smoother-dark"> '+'<span  id="echo_counter{elementIndex}" class="comment-number echo-counter count-bubble-number{elementIndex}"><span class="loading">Loading...</span></span> '+'<span class="count-bubble-end"></span> '+"</span> "+'<span class="count-label smoother-light">{commentType}</span> '+"</div>"+"<!-- /Comment count container -->",streamTemplate:"<!-- Stream container --> "+'<div id="echo_stream_container{elementIndex}" class="echo_stream_container margin-bottom-20">'+'<div class="comment-header" rel="{streamtarget}"> '+"{tablinks}"+"</div> "+"<!-- /comment tab container -->"+"<!-- comment stream container --> "+'<div id="echo_comment_stream{elementIndex}" class="echo-stream"></div> '+"</div><!--  /stream container -->",tablinks:'<div class="stream-header-info">'+'<span class="others-saying">Read what others are saying</span>'+'<span class="about-badges"><a href="http://www.washingtonpost.com/wp-srv/interactivity/get-a-badge.html">About Badges</a></span>'+"</div>"+'<ul id="comment-stream-tabs" class="header-primary comment-stream-tabs"></ul>',sortlinks:'<ul id="comment-stream-sortorder" class="header-secondary comment-stream-sortorder"> '+'<li class="option active"><a href="#" rel="reverseChronological">Newest first</a> </li> '+'<li class="option last"> <a href="#" rel="chronological">Oldest first</a></li> '+'<li class="option last"><a href="#" rel="likesDescending">Most Recommended first</a></li>'+"</ul> "};B.buildecho=function(E,D){this.options=B.extend(C,D);this.props={};this.init(E);};B.buildecho.fn=B.buildecho.prototype={};B.buildecho.fn.extend=B.buildecho.extend=jQuery.extend;B.buildecho.fn.extend({createDataObject:function(I){var F={};if(typeof I.attr("data")!=="undefined"&&I.attr("data").length>0){var G=I.attr("data").split("&");for(var E=0;E<G.length;E++){if(G[E]!=""){var D=G[E].split("=");F[D[0].toLowerCase()]=(D[1]=="true")?true:(D[1])=="false"?false:D[1];}}}else{var G;G=I[0].attributes;for(var E=0;E<G.length;E++){var H=G[E].nodeValue;F[G[E].nodeName.toLowerCase()]=(H=="true")?true:(H)=="false"?false:H;}}return F;},init:function(F){var D=this;var E=B(F);if(E.length==0){return ;}E.each(function(I,G){var L=B(G);var H="";var M="";if(L.children().length==0){H=new Date();M="_"+H.getTime()+"_"+(Math.floor(Math.random()*22));if(L.attr("id")=="echo_container"){L.attr("id",(D.options.config.echoContainer+M));}var J=B('<div class="comments" id="comments'+M+'"></div>');L.append(J);if(B("#echo-tip-text-container").length==0){L.append('<div id="'+D.options.config.badgeTextContainer+'"></div>');}if(B(".badgetext").length==0){D.loadTextFile(D.options.config.badgeText,B("#"+D.options.config.badgeTextContainer));}var N=L.attr("class").replace(/\s+/g," ").split(" ");var K=D.createDataObject(L);B.each(N,function(Q,R){if(R!=D.options.config.echoContainer&&R!=D.options.config.echoVars){R=R.replace("-","");var O="";var T="";try{T=D.options[R+"Template"];}catch(S){}if(R=="stream"){T=T.replace("{streamtarget}","echo_comment_stream"+M);T=(K.includetabs!=false)?T.replace("{tablinks}",D.options.tablinks):T.replace("{tablinks}","");}if(R=="count"){var P=(K.webtype=="discussion_story")?"Posts":"Comments";T=T.replace("{commentType}",P);}if(R=="submitbox"){var U="";if(K.webtype=="discussion_story"){U="Your Posts";}else{if(K.webtype=="ugc_photo_story"){U="Post a Photo";}else{if(K.webtype=="topic_story"){U=(typeof K.submitboxheading!="undefined"&&K.submitboxheading!="")?K.submitboxheading:"Weigh in";}else{if(K.webtype=="promo_story"){U="Add your thoughts";}else{U="Comment";}}}}T=T.replace("{commentType}",U);U=(K.webtype=="ugc_photo_story")?"About Photo Galleries":"About Discussions";T=T.replace("{linkText}",U);U=(K.webtype=="ugc_photo_story")?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":"";T=T.replace("{linkSpacer}",U);}if(R=="count"||R=="submitbox"||R=="stream"){O=B(T.replace(/{elementIndex}/gi,M));B(".echo-counter",O).attr("guid",K.guid);B(".echo-comment",O).attr("guid",K.guid);B(".echo-stream",O).attr("guid",K.guid);B(L).append(O);}}});L.addClass("comments");}else{}});},loadTextFile:function(F,D){var E="";
E=B.ajax({url:F,async:false});D.append(B(E.responseText));}});})(jQuery);Date.prototype.setISO8601=function(D){var A=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(D.toString().match(new RegExp(A))){var C=D.match(new RegExp(A));var B=0;this.setUTCDate(1);this.setUTCFullYear(parseInt(C[1],10));this.setUTCMonth(parseInt(C[3],10)-1);this.setUTCDate(parseInt(C[5],10));this.setUTCHours(parseInt(C[7],10));this.setUTCMinutes(parseInt(C[9],10));this.setUTCSeconds(parseInt(C[11],10));if(C[12]){this.setUTCMilliseconds(parseFloat(C[12])*1000);}else{this.setUTCMilliseconds(0);}if(C[13]!="Z"){B=(C[15]*60)+parseInt(C[17],10);B*=((C[14]=="-")?-1:1);this.setTime(this.getTime()-B*60*1000);}}else{this.setTime(Date.parse(D));}return this;};function editAvatar(A){new TWP.Overlay($("<iframe/>",{width:"600px",height:"300px",src:jQuery(A.target).parent().attr("href")}),null);}(function(C){wp_e2=window.wp_e2||{};wp_e2.extensions=C.extend({},wp_e2.extensions);wp_e2.config=C.extend({},wp_e2.config);wp_e2_defaults={allow_comments:true,allow_links:true,allow_photos:false,allow_videos:false,commentMaxLength:3000,defaulttab:"top",display_ugc_photos:false,display_more:true,includebadges:true,includepause:true,includepermalink:false,includereply:true,includereport:true,includerecommend:true,includesorts:true,includetabs:true,isallcomments:false,max_items_to_display:0,maxItemsTop:3,maxItems:15,photoCommentMaxLength:500,source:"washpost.com",topicCommentMaxLength:140};wp_e2_core={apiBaseURL:"http://echoapi.wpdigital.net",echoSubmissionProxyURL:"http://apps.echoenabled.com/v2/esp/activity",appkey:"dev.washpost.com",backplaneSettings:{serverBaseURL:"http://api.echoenabled.com/v1",busName:"washpost.com"},bookmarkletUrl:"https://testapp12b:7001/bookmarklet/edit-comment.html",counterTarget:".echo-counter",debug:false,default_items:15,default_plugins:{streamPluginArray:[{"name":"TWP_Stream","thisContainer":""}],submitboxPluginArray:[{"name":"FormAuth","nestedPlugins":[{"name":"SubmitAuth"}]},{"name":"SubmitForm"}],replyPluginArray:[{"name":"Reply","actionString":"Add your thoughts...","nestedPlugins":[{"name":"FormAuth","nestedPlugins":[{"name":"ReplyAuth"}]},{"name":"ReplyForm","thisContainer":""}]}],ugcstreamPluginArray:[{"name":"TWP_UGC_Gallery"}],ugcsubmitboxPluginArray:[{"name":"FormAuth","nestedPlugins":[{"name":"SubmitAuth"}]},{"name":"SubmitForm"},{"name":"FileUpload","thumbnailRes":[90,60],"previewRes":[300,200],"webRes":[610,407],"showDefaultInputs":false,"fileSizeMax":5120,"fileSizeMin":0,"filesMax":1,"storageServer":"http://s3.amazonaws.com/twp_echo_ugc","authorName":""}]},environment:{"dev":{logOutURL:TWP.signin.logouturl_page+"?destination=",logInURL:TWP.signin.logincommentsurl_page+"?destination=",profileURL:TWP.signin.registrationcommentsurl_page+"?destination=",registerURL:TWP.signin.registrationcommentsurl_page+"?destination=",proxyURL:"http://bunsen.wapolabs.com/identity/1.5.2/js/wapo_jskit_login_redirect.js",twp_echojsUrl:"/rw/sites/twpweb/js/echo2/v2/core/twp_comments_echo2.js",metaUrl:"http://iddevreg.digitalink.com/identity/public/visitor/submit_metadata.json",bookmarkletUrl:"https://testapp12b:7001/bookmarklet/edit-comment.html",appkey:"dev.washpost.com"},"qa":{logOutURL:TWP.signin.logouturl_page+"?destination=",logInURL:TWP.signin.logincommentsurl_page+"?destination=",profileURL:TWP.signin.registrationcommentsurl_page+"?destination=",registerURL:TWP.signin.registrationcommentsurl_page+"?destination=",proxyURL:"http://bunsen.wapolabs.com/identity/1.5.2/js/wapo_jskit_login_redirect.js",twp_echojsUrl:"/rw/sites/twpweb/js/echo2/v2/core/twp_comments_echo2.js",metaUrl:"https://idstg.digitalink.com/identity/public/visitor/submit_metadata.json",bookmarkletUrl:"https://testapp12b:7001/bookmarklet/edit-comment.html",appkey:"dev.washpost.com"},"stage":{logOutURL:TWP.signin.logouturl_page+"?destination=",logInURL:TWP.signin.logincommentsurl_page+"?destination=",profileURL:TWP.signin.registrationcommentsurl_page+"?destination=",registerURL:TWP.signin.registrationcommentsurl_page+"?destination=",proxyURL:"http://bunsen.wapolabs.com/identity/1.5.2/js/wapo_jskit_login_redirect.js",twp_echojsUrl:"/rw/sites/twpweb/js/echo2/v2/core/twp_comments_echo2.js",metaUrl:"http://id.washingtonpost.com/identity/public/visitor/submit_metadata.json",bookmarkletUrl:"https://testapp12b:7001/bookmarklet/edit-comment.html",appkey:"prod.washpost.com"},"prod":{logOutURL:TWP.signin.logouturl_page+"?destination=",logInURL:TWP.signin.logincommentsurl_page+"?destination=",profileURL:TWP.signin.registrationcommentsurl_page+"?destination=",registerURL:TWP.signin.registrationcommentsurl_page+"?destination=",proxyURL:"http://bunsen.wapolabs.com/identity/1.5.2/js/wapo_jskit_login_redirect.js",twp_echojsUrl:"/rw/sites/twpweb/js/echo2/v2/core/twp_comments_echo2.js",metaUrl:"http://id.washingtonpost.com/identity/public/visitor/submit_metadata.json",bookmarkletUrl:"https://liveadmin.washingtonpost.com/bookmarklet/edit-comment.html",appkey:"prod.washpost.com"}},guid:window.location.href,identityjsUrl:"",liveUpdatesTimeout:{counter:{"default":20,"closed":0,"no_webtype":60},stream:{"default":20,"closed":0,"no_webtype":0}},logOutURL:"",logInURL:"",markerDisplay:{"top_commenter":"Post Forum Member","top_local":"Washingtologist","top_sports":"SuperFan","staff":"Post Writer","fact_checker":"Fact Checker","post_recommended":"Post Recommended","world_watcher":"World Watcher","culture_connoisseur":"Culture Connoisseur"},metaUrl:"",moderationrequired:false,pageURL:window.location.href,profileURL:"",proxyURL:"",registerURL:"",sectionid:"",source:"washpost.com",streamPluginArray:[],streamSettings:{defaults:{appkey:"dev.washpost.com",target:"#comment-stream",apiBaseURL:"",children:{additionalItemsPerPage:300,moreButtonSlideTimeout:400,itemsSlideTimeout:400},childrenItemsPerPage:10,childrenSortOrder:"chronological",plugins:[],truncateReplies:{after:0,clickable:true},streamStateLabel:{icon:true,text:true},viaLabel:{icon:true,text:true},reTag:false,streamStateToggleBy:"button",maxBodyCharacters:3000,aggressiveSanitization:false,openLinksInNewWindow:false,sortorder:"reverseChronological",reply:false,request:"childrenof",allowedItemStates:["Untouched","CommunityFlagged","ModeratorApproved"],allowedUserStates:["ModeratorApproved"],safeHTML:"aggressive",childrenMaxDepth:1}},streamTabs:{all:{active:false,userMarkers:[""],childrenMaxDepth:1,childrenItemsPerPage:3,childrenSortOrder:"chronological",maxBodyCharacters:3000,title:"All Comments",defaultsort:"reverseChronological",displaysort:true},top:{active:false,userMarkers:[],itemMarkers:[],userMarkersxx:["top_commenter","top_local","top_sports","staff"],itemMarkersxx:["post_recommended"],title:"Top Comments",childrenMaxDepth:1,childrenItemsPerPage:1,childrenSortOrder:"chronological",tabUrl:"",maxBodyCharacters:500,request:"childrenof",defaultsort:"reverseChronological",displaysort:true}},streamClient:null,streamId:"",streamTarget:"#echo_comment_stream",submitboxPluginArray:[],submitTarget:"#comment-box",tabs:"",twp_echojsUrl:"",uploadPhotoPluginArray:[]};wp_e2.createDataObject=function(H,E){var G={};if(typeof H.attr("data")!=="undefined"&&H.attr("data").length>0){var D=H.attr("data").split("&");for(var F=0;F<D.length;F++){if(D[F]!=""){valArry=D[F].split("=");G[valArry[0].toLowerCase()]=(valArry[1]=="true")?true:(valArry[1])=="false"?false:valArry[1];wp_e2[E][valArry[0].toLowerCase()]=G[valArry[0].toLowerCase()];}}}else{var D=H[0].attributes;for(var F=0;F<D.length;F++){G[D[F].nodeName.toLowerCase()]=(D[F].nodeValue=="true")?true:(D[F].nodeValue)=="false"?false:D[F].nodeValue;wp_e2[E][D[F].nodeName.toLowerCase()]=G[D[F].nodeName.toLowerCase()];}}return G;};wp_e2.initDataObject=function(E){var D=(typeof E!="undefined")?E:C(".comment-vars");D.each(function(H,F){var I=C(F);var G=I.attr("id");wp_e2[G]={};data=wp_e2.createDataObject(I,G);C.each(wp_e2_defaults,function(J,K){wp_e2[G][J]=(typeof data[J]!=="undefined"&&data[J]!=="")?data[J]:wp_e2_defaults[J];
});wp_e2[G].allCommentsURL=data.articleurlfacet;wp_e2.streamSettings.defaults.sortorder=(typeof data.defaultsort!=="undefined"&&data.defaultsort!="")?data.defaultsort:wp_e2.streamSettings.defaults.sortorder;wp_e2[G].itemMarkersTop=data.markers;wp_e2[G].itemMarkers=data.markersall;wp_e2[G].markerDisplay=(typeof data.markerdisplay!=="undefined"&&data.markerdisplay!="")?jQuery.parseJSON("{"+data.markerdisplay.replace(/'/g,'"')+"}"):wp_e2.markerDisplay;wp_e2.streamTabs.all.maxItems=(typeof data.maxitems!=="undefined"&&data.maxitems!="")?data.maxitems:wp_e2_defaults.maxItems;wp_e2[G].tabs=(typeof data.tabs!=="undefined"&&data.tabs!="")?jQuery.parseJSON(data.tabs.replace(/'/g,'"')):"";wp_e2[G].userMarkersTop=data.usermarkers;wp_e2[G].userMarkers=data.usermarkersall;wp_e2[G].webType=(typeof data.webtype=="undefined")?"article_story":data.webtype;wp_e2[G]=C.extend(wp_e2[G],wp_e2.config);if(wp_e2[G].includetabs==true){wp_e2[G].streamTabs=C.extend(true,{},wp_e2.streamTabs,wp_e2[G].tabs);C.each(wp_e2[G].tabs,function(J,K){if(wp_e2[G].tabs[J]&&wp_e2[G].tabs[J]["default"]==="true"){wp_e2[G].defaulttab=J;}});}else{wp_e2[G].streamTabs={};wp_e2[G].streamTabs[wp_e2[G].defaulttab]={};wp_e2[G].streamTabs[wp_e2[G].defaulttab]=C.extend(true,{},wp_e2.streamTabs[wp_e2[G].defaulttab]);}if(wp_e2[G].streamTabs.top){wp_e2[G].streamTabs.top.maxItems=(typeof data.maxitemstop!=="undefined"&&data.maxitemstop!="")?data.maxitemstop:wp_e2_defaults.maxItemsTop;}if(wp_e2[G].streamTabs.all){wp_e2[G].streamTabs.all.maxItems=(typeof data.maxitems!=="undefined"&&data.maxitems!="")?data.maxitems:wp_e2_defaults.maxItems;if(typeof data.markersall!=="undefined"&&data.markersall!=""){wp_e2[G].streamTabs.all.itemMarkers=wp_e2[G].itemMarkers.split(",");}if(typeof data.usermarkersall!=="undefined"&&data.usermarkersall!=""){wp_e2[G].streamTabs.all.userMarkers=wp_e2[G].userMarkers.split(",");}if(wp_e2[G].streamTabs.top&&(parseInt(wp_e2[G].streamTabs.all.maxItems)<=parseInt(wp_e2[G].streamTabs.top.maxItems))){wp_e2[G].streamTabs.all.maxItems=wp_e2_defaults.maxItems;}}wp_e2[G].streamTabs[wp_e2[G].defaulttab].active=true;if(wp_e2[G].streamTabs.top){if(typeof data.usermarkers!=="undefined"&&data.usermarkers!=""){wp_e2[G].streamTabs.top.userMarkers=wp_e2[G].userMarkersTop.split(",");}if(typeof data.markers!=="undefined"&&data.markers!=""){wp_e2[G].streamTabs.top.itemMarkers=wp_e2[G].itemMarkersTop.split(",");}}if(wp_e2[G].allow_photos||wp_e2[G].allow_videos){wp_e2.streamSettings.defaults.safeHTML="false";}if(!data.isallcomments&&data.maxitems>0){wp_e2[G].max_items_to_display=data.maxitems;if((wp_e2[G].webType).toLowerCase().indexOf("blogstory")<0&&(wp_e2[G].webType).toLowerCase().indexOf("discussion_story")<0){wp_e2[G].streamTabs.top=C.extend(true,{},wp_e2[G].streamTabs.top,{tabUrl:data.articleurlfacet+"?ctab=top_&#comments"});wp_e2[G].streamTabs.all=C.extend(true,{},wp_e2[G].streamTabs.all,{tabUrl:data.articleurlfacet+"?ctab=all_&#comments"});}}if((wp_e2[G].webType).toLowerCase().indexOf("discussion_story")>=0){if(typeof wp_e2[G].streamTabs.top!="undefined"){wp_e2[G].streamTabs.top.title="Top Posts";}if(typeof wp_e2[G].streamTabs.all!="undefined"){wp_e2[G].streamTabs.all.title="All Posts";}}if((wp_e2[G].webType).toLowerCase().indexOf("topic_story")>=0){wp_e2[G].commentMaxLength=(typeof wp_e2.config.topicCommentMaxLength!="undefined")?wp_e2.config.topicCommentMaxLength:wp_e2_defaults.topicCommentMaxLength;}else{wp_e2[G].commentMaxLength=wp_e2_defaults.commentMaxLength;}if(wp_e2[G].webType=="ugc_photo_story"){wp_e2[G].commentMaxLength=wp_e2_defaults.photoCommentMaxLength;wp_e2.default_plugins.streamPluginArray=wp_e2.default_plugins.ugcstreamPluginArray;wp_e2.default_plugins.submitboxPluginArray=wp_e2.default_plugins.ugcsubmitboxPluginArray;}});};C(".echo_container").not(".processed").buildecho(wp_e2.config.options);C.extend(wp_e2,wp_e2_core,wp_e2_defaults,wp_e2.config,wp_e2.extensions);wp_e2.initDataObject();wp_e2.plugins=C.extend(true,{},wp_e2.default_plugins,wp_e2.plugins);wp_e2.streamSettings.defaults.apiBaseURL=wp_e2.apiBaseURL;var A=((typeof TWP==="undefined")||(typeof TWP.Data==="undefined")||(typeof TWP.Data.environment)==="undefined")?"dev":TWP.Data.environment;var B=(typeof eidosBase!=="undefined"&&eidosBase!=="")?eidosBase:"";wp_e2.logOutURL=wp_e2.environment[A].logOutURL;wp_e2.logInURL=wp_e2.environment[A].logInURL;wp_e2.profileURL=wp_e2.environment[A].profileURL;wp_e2.proxyURL=wp_e2.environment[A].proxyURL;wp_e2.registerURL=wp_e2.environment[A].registerURL;wp_e2.identityjsUrl=wp_e2.environment[A].identityjsUrl;wp_e2.twp_echojsUrl=B+wp_e2.environment[A].twp_echojsUrl;wp_e2.metaUrl=wp_e2.environment[A].metaUrl;wp_e2.appkey=wp_e2.environment[A].appkey;wp_e2.bookmarkletUrl=wp_e2.environment[A].bookmarkletUrl;if(window.location.href.indexOf("echodebug=true",0)>0){wp_e2.debug=true;}if(typeof TWP_Debug=="undefined"||TWP_Debug==""){TWP_Debug={};}if(!TWP_Debug.initialTime){TWP_Debug.initialTime=new Date();}wp_e2.debug&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2_identity.js - Starting Identity Load");})(jQuery);(function(F){var E="all";var H="echo_container_a";var G=wp_e2[H].guid;var K="echo_comment_stream";var C="";function B(M){var L=(typeof M!="undefined")?F(".echo-stream",M):F(".echo-stream");L.each(function(){var N=F(this).attr("id");var Q=F(this).closest(".echo_container_lite").attr("id");var P=wp_e2[Q].guid;if(typeof F(this).attr("guid")!=="undefined"){P=F(this).attr("guid");}var O=wp_e2[Q].itemUrl;wp_e2[Q][N]={};wp_e2[Q][N].streamSettings=F.extend(true,{},wp_e2.streamSettings);J(Q,N);});}function D(){var L=(typeof elm!="undefined")?F(elm):F(".echo_container_lite");L.each(function(M,N){thisContainer=F(N).attr("id");if(F(".echo-counter",N).length>0||F(N).hasClass("echo-counter")){thisId="echo-counter";wp_e2[thisContainer][thisId]={};wp_e2[thisContainer][thisId].streamSettings=F.extend(true,{},wp_e2.streamSettings);J(thisContainer,thisId);}});}function J(M,L){F.each(wp_e2[M].streamTabs,function(N,O){tab=N.toLowerCase();wp_e2[M][L].streamSettings[tab]=F.extend(true,{},wp_e2[M][L].streamSettings.defaults,O);if((typeof O.userMarkers!="undefined")&&O.userMarkers.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedUserMarkers=O.userMarkers;}if((typeof O.userStates!="undefined")&&O.userStates.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedUserStates=O.userStates;}if((typeof O.itemMarkers!="undefined")&&O.itemMarkers.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedItemMarkers=O.itemMarkers;}if((typeof O.itemStates!="undefined")&&O.itemStates.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedItemStates=O.itemStates;}if((typeof O.children!="undefined")&&O.children!==""){wp_e2[M][L].streamSettings[tab].children=O.children;}if((typeof O.maxItems!="undefined")&&O.maxItems!==""){wp_e2[M][L].streamSettings[tab].maxItems=O.maxItems;}if((typeof O.request!="undefined")&&O.request!==""){wp_e2[M][L].streamSettings[tab].request=O.request;}});}function A(R,c,U,X,d){var P=(typeof U=="undefined")?wp_e2:wp_e2[U];var W=(typeof U=="undefined"||typeof X=="undefined")?wp_e2:wp_e2[U][X];var M=(typeof P.webType!=="undefined")?P.webType.toLowerCase():"";var c=(!c)?P.guid:c;d=(typeof d=="undefined")?"":d;var R=R.toLowerCase();wp_e2.MODERATOR_APPROVED="ModeratorApproved";wp_e2.MODERATOR_BANNED="ModeratorBanned";wp_e2.MODERATOR_DELETED="ModeratorDeleted";wp_e2.COMMUNITY_FLAGGED="CommunityFlagged";wp_e2.MODERATOR_FLAGGED="ModeratorFlagged";wp_e2.SYSTEM_FLAGGED="SystemFlagged";wp_e2.STREAM_BASE="http://www.washingtonpost.com";wp_e2.UNTOUCHED="Untouched";var Z=((typeof W.streamSettings[R].allowedItemMarkers!="undefined")?" markers: "+W.streamSettings[R].allowedItemMarkers.toString()+" ":"");var a=((typeof W.streamSettings[R].allowedUserMarkers!="undefined"&&W.streamSettings[R].allowedUserMarkers.toString()!="")?" user.markers: "+W.streamSettings[R].allowedUserMarkers.toString()+" ":"");var O="";if(P.moderation_required===true){O="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";
}else{O="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}var e="";if(M===wp_e2.WEBTYPE_PHOTO){e="(state:"+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}else{if(P.moderation_required===true){e="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{e="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+","+wp_e2.UNTOUCHED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}}var V="";if(Z!=""&&a!=""){V="("+Z+" OR "+a+") ";}else{if(Z!=""){V="("+Z+") ";}else{if(a!=""){V="("+a+")";}}}var T="";if(P.moderation_required===true){T="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{T="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}var Y=" (("+O+") "+(V!=""?" AND "+V:"")+")  ";var S="";if((typeof P.source!="undefined"&&P.source.indexOf("Twitter")>=0)){S="("+W.streamSettings[R].request+": "+c+" ("+e+")"+" "+V+" source:Twitter"+") ";}var L="";if((typeof P.source!="undefined"&&P.source.indexOf("washpost.com")>=0)){L="("+W.streamSettings[R].request+": "+c+" source:"+P.source.toString()+Y+" )";}var b="";if(typeof P.streamId!="undefined"&&P.streamId!=""){b="("+W.streamSettings[R].request+":"+wp_e2.STREAM_BASE+"/"+P.streamId+((typeof W.streamSettings[R].allowedItemMarkers!=="undefined"&&W.streamSettings[R].allowedItemMarkers.toString()!="")?" markers: "+W.streamSettings[R].allowedItemMarkers.toString():"")+" ("+e+")"+")";}var Q=(L!="")?L:"";Q=Q+((b!=""&&Q!=="")?" OR "+b:b);Q=Q+((S!=""&&Q!=="")?" OR "+S:S);if(d==""){Q="("+Q+")"+" itemsPerPage: "+"10"+" sortOrder: "+W.streamSettings[R].sortOrder+" safeHTML:"+W.streamSettings[R].safeHTML+" childrenSortOrder:"+W.streamSettings[R].childrenSortOrder+" childrenItemsPerPage:"+W.streamSettings[R].childrenItemsPerPage+" children: "+W.streamSettings[R].childrenMaxDepth+" "+" (("+T+") "+((R==="top")?"":(V!=""?" AND "+V:""))+") ";}var N="http://echoapi.wpdigital.net/v1/count?q="+Q+"&appkey="+wp_e2.appkey;I(Q);}function I(a){var O="http://echoapi.wpdigital.net/v1/count?q="+a+"&appkey="+wp_e2.appkey;var b="http://echoapi.wpdigital.net/v1/search?q="+a+"&appkey="+wp_e2.appkey;var N=wp_e2.echo_container_a.allCommentsURL;var M='<div id="view-all-comments-ie78"><div id="view-all-comments-message-ie78"><p class="view-comments-link-ie78"><a href="'+N+'?ctab=all_&">View all comments &raquo;</a></p><p class="comment-controls-ie78"><a href="'+N+'?ctab=all_&">Add your comment | Reply to a comment | Recommend a comment | Report an offensive comment</a></p></div></div>';var P='<div class="echo-application-message"><span class="echo-application-message-icon echo-application-message-empty echo-primaryFont"><span class="note">No comments are available at the moment. <a href="'+N+'?ctab=all_&">Leave a comment</a></span></span></div>';var Z=0;var X=0;var R='<div class="echo-stream-container comments-wrapper-ie78"><div class="echo-stream-body"></div></div>';var W='<div class="echo-item-content"><div class="echo-item-container echo-item-container-root echo-item-depth-0"><div class="echo-item-wrapper echo-item-wrapper-root">';var Q=' <div class="echo-item-content"><div class="echo-item-container echo-item-container-child echo-item-depth-1"><div class="echo-item-wrapper echo-item-wrapper-child">';var L='<div class="echo-item-subwrapper"><div class="echo-item-header-wrapper"><div class="echo-item-avatar-wrapper"><div class="echo-item-avatar">';var V='</div></div><div class="echo-item-authorName echo-linkColor">';var U='</div><div class="echo-item-date">';var Y='</div></div><div class="echo-item-subcontainer"><div class="echo-item-frame"><div class="echo-item-modeSwitch echo-clickable" style="display: none; "></div><span></span><div class="echo-clear"></div><div class="echo-item-data"><div class="echo-item-re"></div><div class="echo-item-body echo-primaryColor"><span class="echo-item-text">';var T='</span></div></div></div></div><div class="echo-clear"></div></div></div><div class="echo-clear"></div></div></div>';F("span.count-bubble-number").each(function(c,d){jQuery.ajax({url:O,dataType:"jsonp",cache:false,context:d,success:function(f,e){if(f.count){F(d).html(f.count);}else{if(f.errorCode=="more_than"){F(d).html("5000+");}else{F(d).html("0");}}},error:function(f,e){F(d).html("0");}});});F("#echo_comment_stream").addClass("echo-ui");F("div#comments").addClass("comments-full-wrapper-ie78");var S=F(R);S.find(".echo-stream-body").each(function(c,d){jQuery.ajax({url:b,dataType:"jsonp",cache:false,context:d,success:function(k,e){if(e!="error"&&k.entries!="undefined"){if(k.entries.length>0){Z=k.entries.length;var g=0;while(g<Z&&X<3){if(k.entries[g].object.status!="ModeratorDeleted"){var j=new Date();j.setISO8601(k.entries[g].object.published);currDateFmt=j.format("h:MM TT Z");prevDateFmt=j.format("m/d/yyyy h:MM TT Z");if(j.format("m/d/yyyy")==new Date().format("m/d/yyyy")){j=currDateFmt;}else{j=prevDateFmt;}var f=new String(k.entries[g].object.content);var h=f.replace(/\n+/g,"<br><br>");if(k.entries[g].targets[0].id!=k.entries[g].targets[0].conversationID){F(d).append(W+L+'<img src="'+k.entries[g].actor.avatar+'">'+V+k.entries[g].actor.title+U+j+Y+h+T);if(X==0){currentItemContainer=F(d).find("echo-item-container")[X];F(currentItemContainer).css("border-top","none");}if(k.entries[g].actor.markers!=undefined){markersObject=k.entries[g].actor.markers;markersNum=k.entries[g].actor.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];currentItemContainer=F(d).find("div.echo-item-container")[g];for(x=0;x<markersNum;x++){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-user-marker-"+markerString);F(currentItemContainer).addClass("echo-item-user-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-user-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}if(k.entries[g].object.markers!=undefined){markersObject=k.entries[g].object.markers;markersNum=k.entries[g].object.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];currentItemContainer=F(d).find("div.echo-item-container")[g];for(x=0;x<markersNum;x++){if(markersObject[x]=="post_recommended"){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-marker-"+markerString);F(currentItemContainer).addClass("echo-item-user-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-marker-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}}}else{F(d).append(Q+L+'<img src="'+k.entries[g].actor.avatar+'">'+V+k.entries[g].actor.title+U+j+Y+h+T);if(k.entries[g].actor.markers!=undefined){markersObject=k.entries[g].actor.markers;markersNum=k.entries[g].actor.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];currentItemContainer=F(d).find("div.echo-item-container")[g];for(x=0;x<markersNum;x++){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-user-marker-"+markerString);F(currentItemContainer).addClass("echo-item-user-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-user-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}if(k.entries[g].object.markers!=undefined){markersObject=k.entries[g].object.markers;markersNum=k.entries[g].object.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];
for(x=0;x<markersNum;x++){if(markersObject[x]=="post_recommended"){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-marker-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}}}}g++;X++;if(X==3||X==Z){F(d).append(M);}}}else{F(d).prepend(P);}}else{F(d).prepend(P);}},error:function(f,e){F(d).prepend(P);}});F("#echo_comment_stream").append(S);F("span.weigh-in").remove();F("div.stream-header-info").remove();F("ul.header-primary").css("display","none");F("div#comment-info-links").append('<span class="about-badges"> | <a href="http://www.washingtonpost.com/wp-srv/interactivity/get-a-badge.html">About Badges</a></span>');});}F(document).ready(function(){D(F("#echo_container_a.echo_container_lite"));B(F("#echo_container_a.echo_container_lite"));A(E,G,H,K,C);});})(jQuery);