(function(F){var E="all";var H="echo_container_a";var G=wp_e2[H].guid;var K="echo_comment_stream";var C="";function B(M){var L=(typeof M!="undefined")?F(".echo-stream",M):F(".echo-stream");L.each(function(){var N=F(this).attr("id");var Q=F(this).closest(".echo_container_lite").attr("id");var P=wp_e2[Q].guid;if(typeof F(this).attr("guid")!=="undefined"){P=F(this).attr("guid");}var O=wp_e2[Q].itemUrl;wp_e2[Q][N]={};wp_e2[Q][N].streamSettings=F.extend(true,{},wp_e2.streamSettings);J(Q,N);});}function D(){var L=(typeof elm!="undefined")?F(elm):F(".echo_container_lite");L.each(function(M,N){thisContainer=F(N).attr("id");if(F(".echo-counter",N).length>0||F(N).hasClass("echo-counter")){thisId="echo-counter";wp_e2[thisContainer][thisId]={};wp_e2[thisContainer][thisId].streamSettings=F.extend(true,{},wp_e2.streamSettings);J(thisContainer,thisId);}});}function J(M,L){F.each(wp_e2[M].streamTabs,function(N,O){tab=N.toLowerCase();wp_e2[M][L].streamSettings[tab]=F.extend(true,{},wp_e2[M][L].streamSettings.defaults,O);if((typeof O.userMarkers!="undefined")&&O.userMarkers.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedUserMarkers=O.userMarkers;}if((typeof O.userStates!="undefined")&&O.userStates.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedUserStates=O.userStates;}if((typeof O.itemMarkers!="undefined")&&O.itemMarkers.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedItemMarkers=O.itemMarkers;}if((typeof O.itemStates!="undefined")&&O.itemStates.toString()!==""){wp_e2[M][L].streamSettings[tab].allowedItemStates=O.itemStates;}if((typeof O.children!="undefined")&&O.children!==""){wp_e2[M][L].streamSettings[tab].children=O.children;}if((typeof O.maxItems!="undefined")&&O.maxItems!==""){wp_e2[M][L].streamSettings[tab].maxItems=O.maxItems;}if((typeof O.request!="undefined")&&O.request!==""){wp_e2[M][L].streamSettings[tab].request=O.request;}});}function A(R,c,U,X,d){var P=(typeof U=="undefined")?wp_e2:wp_e2[U];var W=(typeof U=="undefined"||typeof X=="undefined")?wp_e2:wp_e2[U][X];var M=(typeof P.webType!=="undefined")?P.webType.toLowerCase():"";var c=(!c)?P.guid:c;d=(typeof d=="undefined")?"":d;var R=R.toLowerCase();wp_e2.MODERATOR_APPROVED="ModeratorApproved";wp_e2.MODERATOR_BANNED="ModeratorBanned";wp_e2.MODERATOR_DELETED="ModeratorDeleted";wp_e2.COMMUNITY_FLAGGED="CommunityFlagged";wp_e2.MODERATOR_FLAGGED="ModeratorFlagged";wp_e2.SYSTEM_FLAGGED="SystemFlagged";wp_e2.STREAM_BASE="http://www.washingtonpost.com";wp_e2.UNTOUCHED="Untouched";var Z=((typeof W.streamSettings[R].allowedItemMarkers!="undefined")?" markers: "+W.streamSettings[R].allowedItemMarkers.toString()+" ":"");var a=((typeof W.streamSettings[R].allowedUserMarkers!="undefined"&&W.streamSettings[R].allowedUserMarkers.toString()!="")?" user.markers: "+W.streamSettings[R].allowedUserMarkers.toString()+" ":"");var O="";if(P.moderation_required===true){O="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{O="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}var e="";if(M===wp_e2.WEBTYPE_PHOTO){e="(state:"+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}else{if(P.moderation_required===true){e="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{e="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+","+wp_e2.UNTOUCHED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}}var V="";if(Z!=""&&a!=""){V="("+Z+" OR "+a+") ";}else{if(Z!=""){V="("+Z+") ";}else{if(a!=""){V="("+a+")";}}}var T="";if(P.moderation_required===true){T="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{T="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}var Y=" (("+O+") "+(V!=""?" AND "+V:"")+")  ";var S="";if((typeof P.source!="undefined"&&P.source.indexOf("Twitter")>=0)){S="("+W.streamSettings[R].request+": "+c+" ("+e+")"+" "+V+" source:Twitter"+") ";}var L="";if((typeof P.source!="undefined"&&P.source.indexOf("washpost.com")>=0)){L="("+W.streamSettings[R].request+": "+c+" source:"+P.source.toString()+Y+" )";}var b="";if(typeof P.streamId!="undefined"&&P.streamId!=""){b="("+W.streamSettings[R].request+":"+wp_e2.STREAM_BASE+"/"+P.streamId+((typeof W.streamSettings[R].allowedItemMarkers!=="undefined"&&W.streamSettings[R].allowedItemMarkers.toString()!="")?" markers: "+W.streamSettings[R].allowedItemMarkers.toString():"")+" ("+e+")"+")";}var Q=(L!="")?L:"";Q=Q+((b!=""&&Q!=="")?" OR "+b:b);Q=Q+((S!=""&&Q!=="")?" OR "+S:S);if(d==""){Q="("+Q+")"+" itemsPerPage: "+"10"+" sortOrder: "+W.streamSettings[R].sortOrder+" safeHTML:"+W.streamSettings[R].safeHTML+" childrenSortOrder:"+W.streamSettings[R].childrenSortOrder+" childrenItemsPerPage:"+W.streamSettings[R].childrenItemsPerPage+" children: "+W.streamSettings[R].childrenMaxDepth+" "+" (("+T+") "+((R==="top")?"":(V!=""?" AND "+V:""))+") ";}var N="http://echoapi.wpdigital.net/v1/count?q="+Q+"&appkey="+wp_e2.appkey;I(Q);}function I(a){var O="http://echoapi.wpdigital.net/v1/count?q="+a+"&appkey="+wp_e2.appkey;var b="http://echoapi.wpdigital.net/v1/search?q="+a+"&appkey="+wp_e2.appkey;var N=wp_e2.echo_container_a.allCommentsURL;var M='<div id="view-all-comments-ie78"><div id="view-all-comments-message-ie78"><p class="view-comments-link-ie78"><a href="'+N+'?ctab=all_&">View all comments &raquo;</a></p><p class="comment-controls-ie78"><a href="'+N+'?ctab=all_&">Add your comment | Reply to a comment | Recommend a comment | Report an offensive comment</a></p></div></div>';var P='<div class="echo-application-message"><span class="echo-application-message-icon echo-application-message-empty echo-primaryFont"><span class="note">No comments are available at the moment. <a href="'+N+'?ctab=all_&">Leave a comment</a></span></span></div>';var Z=0;var X=0;var R='<div class="echo-stream-container comments-wrapper-ie78"><div class="echo-stream-body"></div></div>';var W='<div class="echo-item-content"><div class="echo-item-container echo-item-container-root echo-item-depth-0"><div class="echo-item-wrapper echo-item-wrapper-root">';var Q=' <div class="echo-item-content"><div class="echo-item-container echo-item-container-child echo-item-depth-1"><div class="echo-item-wrapper echo-item-wrapper-child">';var L='<div class="echo-item-subwrapper"><div class="echo-item-header-wrapper"><div class="echo-item-avatar-wrapper"><div class="echo-item-avatar">';var V='</div></div><div class="echo-item-authorName echo-linkColor">';var U='</div><div class="echo-item-date">';var Y='</div></div><div class="echo-item-subcontainer"><div class="echo-item-frame"><div class="echo-item-modeSwitch echo-clickable" style="display: none; "></div><span></span><div class="echo-clear"></div><div class="echo-item-data"><div class="echo-item-re"></div><div class="echo-item-body echo-primaryColor"><span class="echo-item-text">';var T='</span></div></div></div></div><div class="echo-clear"></div></div></div><div class="echo-clear"></div></div></div>';F("span.count-bubble-number").each(function(c,d){jQuery.ajax({url:O,dataType:"jsonp",cache:false,context:d,success:function(f,e){if(f.count){F(d).html(f.count);}else{if(f.errorCode=="more_than"){F(d).html("5000+");}else{F(d).html("0");}}},error:function(f,e){F(d).html("0");}});});F("#echo_comment_stream").addClass("echo-ui");F("div#comments").addClass("comments-full-wrapper-ie78");var S=F(R);S.find(".echo-stream-body").each(function(c,d){jQuery.ajax({url:b,dataType:"jsonp",cache:false,context:d,success:function(k,e){if(e!="error"&&k.entries!="undefined"){if(k.entries.length>0){Z=k.entries.length;
var g=0;while(g<Z&&X<3){if(k.entries[g].object.status!="ModeratorDeleted"){var j=new Date();j.setISO8601(k.entries[g].object.published);currDateFmt=j.format("h:MM TT Z");prevDateFmt=j.format("m/d/yyyy h:MM TT Z");if(j.format("m/d/yyyy")==new Date().format("m/d/yyyy")){j=currDateFmt;}else{j=prevDateFmt;}var f=new String(k.entries[g].object.content);var h=f.replace(/\n+/g,"<br><br>");if(k.entries[g].targets[0].id!=k.entries[g].targets[0].conversationID){F(d).append(W+L+'<img src="'+k.entries[g].actor.avatar+'">'+V+k.entries[g].actor.title+U+j+Y+h+T);if(X==0){currentItemContainer=F(d).find("echo-item-container")[X];F(currentItemContainer).css("border-top","none");}if(k.entries[g].actor.markers!=undefined){markersObject=k.entries[g].actor.markers;markersNum=k.entries[g].actor.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];currentItemContainer=F(d).find("div.echo-item-container")[g];for(x=0;x<markersNum;x++){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-user-marker-"+markerString);F(currentItemContainer).addClass("echo-item-user-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-user-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}if(k.entries[g].object.markers!=undefined){markersObject=k.entries[g].object.markers;markersNum=k.entries[g].object.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];currentItemContainer=F(d).find("div.echo-item-container")[g];for(x=0;x<markersNum;x++){if(markersObject[x]=="post_recommended"){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-marker-"+markerString);F(currentItemContainer).addClass("echo-item-user-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-marker-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}}}else{F(d).append(Q+L+'<img src="'+k.entries[g].actor.avatar+'">'+V+k.entries[g].actor.title+U+j+Y+h+T);if(k.entries[g].actor.markers!=undefined){markersObject=k.entries[g].actor.markers;markersNum=k.entries[g].actor.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];currentItemContainer=F(d).find("div.echo-item-container")[g];for(x=0;x<markersNum;x++){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-user-marker-"+markerString);F(currentItemContainer).addClass("echo-item-user-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-user-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}if(k.entries[g].object.markers!=undefined){markersObject=k.entries[g].object.markers;markersNum=k.entries[g].object.markers.length;currentItemSubWrapper=F(d).find("div.echo-item-subwrapper")[g];for(x=0;x<markersNum;x++){if(markersObject[x]=="post_recommended"){markerString=markersObject[x];F(currentItemSubWrapper).addClass("echo-item-marker-"+markerString);markerDivString='<div class="marker"><span class="marker echo-item-marker-'+markerString+'"></span></div>';F(currentItemSubWrapper).prepend(markerDivString);}}}}}g++;X++;if(X==3||X==Z){F(d).append(M);}}}else{F(d).prepend(P);}}else{F(d).prepend(P);}},error:function(f,e){F(d).prepend(P);}});F("#echo_comment_stream").append(S);F("span.weigh-in").remove();F("div.stream-header-info").remove();F("ul.header-primary").css("display","none");F("div#comment-info-links").append('<span class="about-badges"> | <a href="http://www.washingtonpost.com/wp-srv/interactivity/get-a-badge.html">About Badges</a></span>');});}F(document).ready(function(){D(F("#echo_container_a.echo_container_lite"));B(F("#echo_container_a.echo_container_lite"));A(E,G,H,K,C);});})(jQuery);