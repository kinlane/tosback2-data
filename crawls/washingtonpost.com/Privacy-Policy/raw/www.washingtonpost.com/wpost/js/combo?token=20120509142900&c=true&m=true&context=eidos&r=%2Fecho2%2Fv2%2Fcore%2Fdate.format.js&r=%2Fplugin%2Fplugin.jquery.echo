var dateFormat=function(){var A=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,B=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,D=/[^-+\dA-Z]/g,C=function(F,E){F=String(F);E=E||2;while(F.length<E){F="0"+F;}return F;};return function(J,V,R){var G=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(J)=="[object String]"&&!/\d/.test(J)){V=J;J=undefined;}J=J?new Date(J):new Date;if(isNaN(J)){throw SyntaxError("invalid date");}V=String(G.masks[V]||V||G.masks["default"]);if(V.slice(0,4)=="UTC:"){V=V.slice(4);R=true;}var T=R?"getUTC":"get",O=J[T+"Date"](),E=J[T+"Day"](),K=J[T+"Month"](),Q=J[T+"FullYear"](),S=J[T+"Hours"](),N=J[T+"Minutes"](),U=J[T+"Seconds"](),P=J[T+"Milliseconds"](),F=R?0:J.getTimezoneOffset(),I={d:O,dd:C(O),ddd:G.i18n.dayNames[E],dddd:G.i18n.dayNames[E+7],m:K+1,mm:C(K+1),mmm:G.i18n.monthNames[K],mmmm:G.i18n.monthNames[K+12],yy:String(Q).slice(2),yyyy:Q,h:S%12||12,hh:C(S%12||12),H:S,HH:C(S),M:N,MM:C(N),s:U,ss:C(U),l:C(P,3),L:C(P>99?Math.round(P/10):P),t:S<12?"a":"p",tt:S<12?"am":"pm",T:S<12?"A":"P",TT:S<12?"AM":"PM",Z:R?"UTC":(String(J).match(B)||[""]).pop().replace(D,""),o:(F>0?"-":"+")+C(Math.floor(Math.abs(F)/60)*100+Math.abs(F)%60,4),S:["th","st","nd","rd"][O%10>3?0:(O%100-O%10!=10)*O%10]};return V.replace(A,function(H){return H in I?I[H]:H.slice(1,H.length-1);});};}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(A,B){return dateFormat(this,A,B);};(function(B){B.fn.buildecho=function(D){return this.each(function(){new B.buildecho(this,D);});};var A=TWP.eidosBase||"http://devprev.digitalink.com";var C={config:{dserv:A,badgeText:A+"/Fragment/SysConfig/WebPortal/twpweb/modules/comments/badge_text.jpt",echoContainer:"echo_container",badgeTextContainer:"echo-tip-text-container",echoVars:"comment-vars"},submitboxTemplate:"<!--  submit box container -->"+'<div id="echo_comment_box_container{elementIndex}" class="echo_comment_box_wrapper">'+'<div class="comment-box-header" id="echo_comment_box_header{elementIndex}"> '+'<span class="weigh-in" id="weighIn">{commentType}</span> '+'<div id="comment-info-links">'+'<span class="discussion-policy">'+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_policy.html">Discussion Policy</a>'+"</span>"+'<span class="faq-policy"> | '+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_faq.html#faq">FAQ</a>'+"</span>"+'<span class="about-comments"> | '+'<a class="iframe-overlay" config="overlayOpacity=.5&width=600&height=600" href="http://www.washingtonpost.com/wp-srv/interactivity/policy/discussion_faq.html">{linkText}</a>'+"</span>"+"</div>"+"<!-- /weigh in box --> "+"<!-- Submit form container --> "+'<div class="echo-comment comment-box hidden" id="echo_comment_box{elementIndex}"> </div>'+'<div style="clear: both;height:0px;">&#160;</div> '+"</div></div> <!-- /submit form container -->",countTemplate:"<!-- Comment count container --> "+'<div  id="echo_count_container{elementIndex}" class="comment-count comment-count-primary echo-count-container">'+'<span class="count-bubble smoother-dark"> '+'<span  id="echo_counter{elementIndex}" class="comment-number echo-counter count-bubble-number{elementIndex}"><span class="loading">Loading...</span></span> '+'<span class="count-bubble-end"></span> '+"</span> "+'<span class="count-label smoother-light">{commentType}</span> '+"</div>"+"<!-- /Comment count container -->",streamTemplate:"<!-- Stream container --> "+'<div id="echo_stream_container{elementIndex}" class="echo_stream_container margin-bottom-20">'+'<div class="comment-header" rel="{streamtarget}"> '+"{tablinks}"+"</div> "+"<!-- /comment tab container -->"+"<!-- comment stream container --> "+'<div id="echo_comment_stream{elementIndex}" class="echo-stream"></div> '+"</div><!--  /stream container -->",tablinks:'<div class="stream-header-info">'+'<span class="others-saying">Read what others are saying</span>'+'<span class="about-badges"><a href="http://www.washingtonpost.com/wp-srv/interactivity/get-a-badge.html">About Badges</a></span>'+"</div>"+'<ul id="comment-stream-tabs" class="header-primary comment-stream-tabs"></ul>',sortlinks:'<ul id="comment-stream-sortorder" class="header-secondary comment-stream-sortorder"> '+'<li class="option active"><a href="#" rel="reverseChronological">Newest first</a> </li> '+'<li class="option last"> <a href="#" rel="chronological">Oldest first</a></li> '+'<li class="option last"><a href="#" rel="likesDescending">Most Recommended first</a></li>'+"</ul> "};B.buildecho=function(E,D){this.options=B.extend(C,D);this.props={};this.init(E);};B.buildecho.fn=B.buildecho.prototype={};B.buildecho.fn.extend=B.buildecho.extend=jQuery.extend;B.buildecho.fn.extend({createDataObject:function(I){var F={};if(typeof I.attr("data")!=="undefined"&&I.attr("data").length>0){var G=I.attr("data").split("&");for(var E=0;E<G.length;E++){if(G[E]!=""){var D=G[E].split("=");F[D[0].toLowerCase()]=(D[1]=="true")?true:(D[1])=="false"?false:D[1];}}}else{var G;G=I[0].attributes;for(var E=0;E<G.length;E++){var H=G[E].nodeValue;F[G[E].nodeName.toLowerCase()]=(H=="true")?true:(H)=="false"?false:H;}}return F;},init:function(F){var D=this;var E=B(F);if(E.length==0){return ;}E.each(function(I,G){var L=B(G);var H="";var M="";if(L.children().length==0){H=new Date();M="_"+H.getTime()+"_"+(Math.floor(Math.random()*22));L.attr("id",(D.options.config.echoContainer+M));var J=B('<div class="comments" id="comments'+M+'"></div>');L.append(J);if(B("#echo-tip-text-container").length==0){L.append('<div id="'+D.options.config.badgeTextContainer+'"></div>');}if(B(".badgetext").length==0){D.loadTextFile(D.options.config.badgeText,B("#"+D.options.config.badgeTextContainer));}var N=L.attr("class").replace(/\s+/g," ").split(" ");var K=D.createDataObject(L);B.each(N,function(Q,R){if(R!=D.options.config.echoContainer&&R!=D.options.config.echoVars){R=R.replace("-","");var O="";var T="";try{T=D.options[R+"Template"];}catch(S){}if(R=="stream"){T=T.replace("{streamtarget}","echo_comment_stream"+M);T=(K.includetabs!=false)?T.replace("{tablinks}",D.options.tablinks):T.replace("{tablinks}","");}if(R=="count"){var P=(K.webtype=="discussion_story")?"Posts":"Comments";T=T.replace("{commentType}",P);}if(R=="submitbox"){var U=(K.webtype=="discussion_story")?"Your Posts":((K.webtype=="ugc_photo_story")?"Post a Photo":(K.webtype=="topic_story")?"Start a conversation":(K.webtype=="promo_story")?"Add your thoughts":"Weigh In");T=T.replace("{commentType}",U);U=(K.webtype=="ugc_photo_story")?"About Photo Galleries":"About Discussions";T=T.replace("{linkText}",U);U=(K.webtype=="ugc_photo_story")?"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;":"";T=T.replace("{linkSpacer}",U);}if(R=="count"||R=="submitbox"||R=="stream"){O=B(T.replace(/{elementIndex}/gi,M));B(".echo-counter",O).attr("guid",K.guid);B(".echo-comment",O).attr("guid",K.guid);B(".echo-stream",O).attr("guid",K.guid);B(L).append(O);}}});L.addClass("comments");}else{}});},loadTextFile:function(F,D){var E="";E=B.ajax({url:F,async:false});D.append(B(E.responseText));}});})(jQuery);(function(A){if(typeof (A._$)!="undefined"){A.noConflict();
}if(!window.Echo){window.Echo={};}if(!Echo.Global){Echo.Global={};}if(!Echo.Vars){Echo.Vars={"regexps":{"matchLabel":/{Label:([^:}]+[^}]*)}/g,"matchData":/{Data:(([a-z]+\.)*[a-z]+)}/ig,"mobileUA":/mobile|midp-|opera mini|iphone|ipad|blackberry|nokia|samsung|docomo|symbian|windows ce|windows phone|android|up\.browser|ipod|netfront|skyfire|palm|webos|audiovox/i,"parseUrl":/^((([^:\/\?#]+):)?\/\/)?([^\/\?#]*)?([^\?#]*)(\?([^#]*))?(#(.*))?/,"w3cdtf":/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z$/}};}A.extend({"addCss":function(D,F){Echo.Vars.css=Echo.Vars.css||{"index":1,"processed":{}};if(F){if(Echo.Vars.css.processed[F]){return ;}Echo.Vars.css.processed[F]=true;}var C="";var B=Echo.Vars.css.anchor;if(B&&B.length){C=B.html();}if(C.length+D.length>100000){Echo.Vars.css.index++;B=null;C="";}var E=A('<style id="echo-css-'+Echo.Vars.css.index+'" type="text/css">'+C+D+"</style>");if(B&&B.length){B.replaceWith(E);}else{if(Echo.Vars.css.anchor){Echo.Vars.css.anchor.after(E);}else{A(document.getElementsByTagName("head")[0]||document.documentElement).prepend(E);}}Echo.Vars.css.anchor=E;},"foldl":function(C,B,D){A.each(B,function(E,F){result=D(F,C,E);if(result!==undefined){C=result;}});return C;},"intersperse":function(B,C){return A.foldl([],B,function(E,F,D){if(F.length){F.push(C);}F.push(E);});},"getNestedValue":function(B,F,G,H){if(typeof B=="string"){B=B.split(/\./);}if(!B.length){return F;}var E=true;var C=function(J,I){if(H){H(I,J);}if(typeof I[J]=="undefined"){E=false;}else{return I[J];}};var D=B.length==1?C(B.pop(),F):A.foldl(F,B,C);return E?D:G;},"setNestedValue":function(G,B,E){var C=B.split(/\./);var F=C.pop();var D=A.getNestedValue(C,G,undefined,function(I,H){if(typeof I[H]=="undefined"){I[H]={};}});D[F]=E;},"htmlize":function(B){if(!B){return"";}return A("<div>").text(B).html();},"object2JSON":function(F){var D=function(G){var H={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return G.replace(/[\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff\\]/g,function(I){return(H.hasOwnProperty(I))?H[I]:"\\u"+("0000"+I.charCodeAt(0).toString(16)).slice(-4);});};var C;switch(typeof F){case"number":C=isFinite(F)?F:"null";break;case"string":C='"'+D(F)+'"';break;case"boolean":C='"'+F.toString()+'"';break;default:if(F instanceof Array){var B=A.map(F,function(G){return A.object2JSON(G);});C="["+B.join(",")+"]";}else{if(F instanceof Object){var E=F.exportProperties||F;var B=A.foldl([],E,function(I,H,G){if(E instanceof Array){G=I;I=F[G];}H.push('"'+G+'":'+A.object2JSON(I));});C="{"+B.join(",")+"}";}else{C="null";}}}return C;},"htmlTextTruncate":function(N,E,M,G){if(!E||N.length<E){return N;}var P=[],I=0,H=0;var L="br hr input img area param base link meta option".split(" ");var C=A.foldl({},L,function(S,R,Q){R[S]=true;});for(var F=0;F<N.length;F++){var D=N.charAt(F);if(D=="<"){var K=N.indexOf(">",F);if(K<0){return N;}var B=N.substring(F+1,K);var O={"name":"","closing":false};if(B.charAt(0)=="/"){O.closing=true;B=B.substring(1);}O.name=B.match(/(\w)+/)[0];if(O.closing){var J=P.pop();if(!J||J.name!=O.name){return N;}}else{if(!C[O.name]){P.push(O);}}F=K;}else{if(D=="&"&&N.substring(F).match(/^(\S)+;/)){F=N.indexOf(";",F);}else{if(I==E){H=F;break;}I++;}}}if(H||G){if(H){N=N.substring(0,H)+(M||"");}for(var F=P.length-1;F>=0;F--){N+="</"+P[F].name+">";}}return N;},"mapClass2Object":function(C,B){B=B||{};C.find("*").andSelf().each(function(E,F){if(F.className){var D=F.className.split(/[ ]+/);A.each(D,function(G,H){B[H]=F;});}});return B;},"stripTags":function(B){return A("<div>").html(B).text();},"parseUrl":function(B){var C=B.match(Echo.Vars.regexps.parseUrl);return C?{"scheme":C[3],"domain":C[4],"path":C[5],"query":C[7],"fragment":C[9]}:undefined;},"toDOM":function(C,G,F){var D=A(C);var E=A.mapClass2Object(D);var H={"set":function(I,J){E[G+I]=J;},"get":function(I,K){var J=E[(K?"":G)+I];return J&&A(J);},"remove":function(J){var I;if(typeof J=="string"){I=G+J;}else{I=J.echo.name;}A(E[I]).remove();delete E[I];},"content":D};var B;if(typeof F=="object"){B=function(I,J,K){if(!F[I]){return ;}return F[I](J,K);};}else{B=F;}A.each(E,function(M,J){var L=M.match(G+"(.*)");var I=L?L[1]:undefined;if(I&&B){J=A(J);J.echo=J.echo||{};J.echo.name=M;var K=B(I,J,H);if(typeof K!="undefined"){J.empty().append(K);}}});return H;},"loadScriptContent":function(D,F){Echo.Vars.scriptState=Echo.Vars.scriptState||{};if(Echo.Vars.scriptState[D]=="loaded"){F();return ;}var E=Echo.Broadcast.subscribe("internal.scriptLoaded",function(G,H){if(D!=H){return ;}Echo.Broadcast.unsubscribe("internal.scriptLoaded",E);F();});if(Echo.Vars.scriptState[D]=="loading"){return ;}Echo.Vars.scriptState[D]="loading";var C=document.createElement("script");C.type="text/javascript";C.charset="utf-8";C.src=D;var B=document.getElementsByTagName("head")[0]||document.documentElement;B.insertBefore(C,B.firstChild);C.onload=C.onreadystatechange=function(){var G=C.readyState;if(!G||G=="loaded"||G=="complete"){Echo.Vars.scriptState[D]="loaded";Echo.Broadcast.publish("internal.scriptLoaded",D);C.onload=C.onreadystatechange=null;}};},"sendPostRequest":function(C,E,G){var F="echo-post-"+Math.random();var B=A("#echo-post-request").length?A("#echo-post-request").empty():A('<div id="echo-post-request"/>').css({"height":0}).prependTo("body");A('<iframe id="'+F+'" name="'+F+'" width="0" height="0" frameborder="0" border="0"></iframe>').appendTo(B);var D=A("<form/>",{"target":F,"method":"POST","enctype":"application/x-www-form-urlencoded","acceptCharset":"UTF-8","action":C}).appendTo(B);A.each(E,function(H,I){A("<input/>",{"type":"hidden","name":H,"value":I}).appendTo(D);});D.submit();G();},"getVisibleColor":function(C){var B;do{B=C.css("backgroundColor");if(B!=""&&B!="transparent"&&!/rgba\(0, 0, 0, 0\)/.test(B)||A.nodeName(C.get(0),"body")){break;}}while(C=C.parent());return B||"transparent";},"timestampFromW3CDTF":function(B){var E=["year","month","day","hours","minutes","seconds"];var C={};var D=B.match(Echo.Vars.regexps.w3cdtf);A.each(E,function(F,G){C[G]=D[F+1];});return Date.UTC(C["year"],C["month"]-1,C["day"],C["hours"],C["minutes"],C["seconds"])/1000;},"isMobileDevice":function(){return Echo.Vars.regexps.mobileUA.test(navigator.userAgent);}});if(!Echo.Plugins){Echo.Plugins={};}Echo.isExtended=function(B,D,C){if(!B){return false;}C=C||true;var E=[B].concat(D).join(".");Echo.Vars.extensions=Echo.Vars.extensions||{};if(Echo.Vars.extensions[E]==C){return true;}Echo.Vars.extensions[E]=C;return false;};Echo.extendRenderer=function(B,F,D,C){if(!B||!Echo[B]||!F||!D||!A.isFunction(D)||Echo.isExtended(C,[B,"renderer",F])){return ;}var E=Echo[B].prototype.renderers[F]||function(){};Echo[B].prototype.renderers[F]=function(){var H=C&&this.config.get("plugins."+C);if(!H||!H.enabled){return E.apply(this,arguments);}var G=this;if(!this.parentRenderer){this.parentRenderer=function(J,I){return G.parentRenderers[J].apply(G,I);};}this.parentRenderers=this.parentRenderers||{};this.parentRenderers[F]=E;return D.apply(this,arguments);};};Echo.extendTemplate=function(C,E,I,B,H){if(!C||!Echo[C]||!I||!B||!E||Echo.isExtended(H,[C,"template",B,I],E)){return ;}var G=Echo[C].prototype.template;var F=A.isFunction(G)?G:function(){return G;};var D={"insertBefore":"before","insertAfter":"after","insertAsFirstChild":"prepend","insertAsLastChild":"append","replace":"replaceWith"};Echo[C].prototype.template=function(){var J=H&&this.config.get("plugins."+H);if(!J||!J.enabled){return F.call(this);}var K=A("<div/>").html(F.call(this));A("."+B,K)[D[I]](E);return K.html();};};Echo.include=function(B,D){if(!B.length){return D();}var C=B.pop();Echo.include(B,function(){if(typeof C.loaded=="undefined"){if(C.application){C.loaded=function(){return !!Echo[C.application];};}else{D();}}if(A.isFunction(C.loaded)&&!C.loaded()){A.loadScriptContent(C.url,D);}else{D();}});};Echo.createPlugin=function(C){if(!C||!C.name||!C.init||!C.applications){return{};}var B=C.name;var E=function(){var F=function(G){return"plugins."+B+(G?"."+G:"");
};F.get=function(G,H,I,J){return G.config.get(F(H),J?G.config.get(H,I):I);};F.set=function(G,H,I){G.config.set(F(H),I);};F.remove=function(G,H){G.config.remove(F(H));};return F;};var D=C.init||function(){};Echo.Plugins[B]=Echo.Plugins[B]||A.extend(C,{"init":function(H,G){var F=H.config.get(G,"enabled");if(typeof F=="undefined"){H.config.set(G,"enabled",true);}D(H,G);},"set":function(F,G,H){F.vars=F.vars||{};F.vars[B]=F.vars[B]||{};A.setNestedValue(F.vars[B],G,H);},"get":function(F,G){var H=(F.vars||{})[B]||{};if(!G){return H;}return A.getNestedValue(G,H);},"addCss":function(F){A.addCss(F,"plugins-"+B);},"label":function(F,G){return Echo.Localization.label(F,"Plugins."+B,G);},"addLabels":function(F){Echo.Localization.extend(F,"Plugins."+B);},"topic":function(H,G){var F=typeof H=="string"?H:H.namespace;return F+".Plugins."+B+"."+G;},"config":E(),"subscribe":function(H,G,I){var F=this;return H.subscribe(G,function(){if(!H.isPluginEnabled(F.name)){return ;}I.apply(this,arguments);});},"publish":function(G,F,H){G.publish(F,H);},"unsubscribe":function(G,F,H){G.unsubscribe(F,H);},"extendRenderer":function(F,H,G){Echo.extendRenderer(F,H,G,B);},"extendTemplate":function(G,H,I,F){Echo.extendTemplate(G,H,I,F,B);},"addItemControl":function(G,H){var F=G.config.get("itemControls."+B,[]);G.config.set("itemControls."+B,F.concat(H));},"assembleConfig":function(F,G){G.user=F.user;G.appkey=F.config.get("appkey","");G.plugins=this.config.get(F,"nestedPlugins",[]);G.contextId=F.config.get("contextId");G.apiBaseURL=F.config.get("apiBaseURL");return(new Echo.Config(G,this.config.get(F))).getAsHash();}});return Echo.Plugins[B];};if(!Echo.Broadcast){Echo.Broadcast={};}Echo.Broadcast.initContext=function(C,B){B=B||"empty";Echo.Vars.subscriptions=Echo.Vars.subscriptions||{};Echo.Vars.subscriptions[B]=Echo.Vars.subscriptions[B]||{};Echo.Vars.subscriptions[B][C]=Echo.Vars.subscriptions[B][C]||{};return B;};Echo.Broadcast.subscribe=function(C,D,B){var E=(new Date()).valueOf()+Math.random();B=Echo.Broadcast.initContext(C,B);Echo.Vars.subscriptions[B][C][E]=D;return E;};Echo.Broadcast.unsubscribe=function(C,D,B){B=Echo.Broadcast.initContext(C,B);if(C&&D){delete Echo.Vars.subscriptions[B][C][D];}else{if(C){delete Echo.Vars.subscriptions[B][C];}}};Echo.Broadcast.publish=function(C,D,B){B=Echo.Broadcast.initContext(C,B);if(B=="*"){A.each(Echo.Vars.subscriptions,function(E){A.each(Echo.Vars.subscriptions[E][C]||{},function(G,F){F.apply(this,[C,D]);});});}else{if(Echo.Vars.subscriptions[B][C]){A.each(Echo.Vars.subscriptions[B][C],function(F,E){E.apply(this,[C,D]);});}if(B!="empty"){Echo.Broadcast.publish(C,D,"empty");}}};if(!Echo.Object){Echo.Object=function(){};}Echo.Object.prototype.init=function(B){A.extend(this,B||{});};Echo.Object.prototype.template="";Echo.Object.prototype.namespace="";Echo.Object.prototype.cssPrefix="echo-";Echo.Object.prototype.substitute=function(C,D){var B=this;C=C.replace(Echo.Vars.regexps.matchLabel,function(F,E){return B.label(E);});C=C.replace(Echo.Vars.regexps.matchData,function(F,E){return A.getNestedValue(E,D,"");});return C;};Echo.Object.prototype.renderers={};Echo.Object.prototype.label=function(C,D){var B=Echo.Localization.label(C,this.namespace,D);return B!=C?B:Echo.Localization.label(C,"",D);};Echo.Object.prototype.render=function(D,E,G,B){var C=this;if(D){if(A.isFunction(this.renderers[D])){return this.renderers[D].call(this,E,G,B);}}else{var F=A.isFunction(this.template)?this.template():this.template;this.dom=A.toDOM(this.substitute(F,this.data||{}),this.cssPrefix,function(){return C.render.apply(C,arguments);});return this.dom.content;}};Echo.Object.prototype.rerender=function(B,D){var J=this;if(!B){if(this.dom){this.dom.content.replaceWith(this.render());}return ;}if(!this.dom){return ;}if(typeof B!="string"){A.map(B,function(K){J.rerender(K,D);});return ;}else{if(!this.dom.get(B)){return ;}}if(D){var I=A.isFunction(this.template)?this.template():this.template;var G=this.substitute(I,this.data||{});var E=this.dom.get(B);var H=A("."+this.cssPrefix+B,A(G));H=A.toDOM(H,this.cssPrefix,function(K,L,M){J.dom.set(K,L);return J.render.apply(J,arguments);}).content;E.replaceWith(H);}else{var F=this.dom.get(B);var C=this.renderers[B].call(this,F,this.dom);if(typeof C!="undefined"){F.empty().append(C);}}};Echo.Object.prototype.hyperlink=function(E,D){D=D||{};if(D.openInNewWindow&&!E.target){E.target="_blank";}var C=E.caption||"";delete E.caption;if(!D.skipEscaping){E.href=A.htmlize(E.href);}E.href=E.href||"javascript:void(0)";var B=A.foldl([],E,function(H,G,F){G.push(F+'="'+H+'"');});return"<a "+B.join(" ")+">"+C+"</a>";};Echo.Object.prototype.newContextId=function(){return(new Date()).valueOf()+Math.random();};Echo.Object.prototype.getContextId=function(){return this.config&&this.config.get("contextId");};Echo.Object.prototype.subscribe=function(B,C){return Echo.Broadcast.subscribe(B,C,this.getContextId());};Echo.Object.prototype.unsubscribe=function(B,C){Echo.Broadcast.unsubscribe(B,C,this.getContextId());};Echo.Object.prototype.publish=function(B,C){Echo.Broadcast.publish(B,C,this.getContextId());};Echo.Object.prototype.clearCache=function(){if(this.vars&&this.vars.cache){this.vars.cache={};}};Echo.Application=function(){this.addCss();};Echo.Application.prototype=new Echo.Object();Echo.Application.prototype.errorMessages={"error_busy":"Loading. Please wait...","error_timeout":"Loading. Please wait...","error_waiting":"Loading. Please wait...","error_result_too_large":"(result_too_large) The search result is too large.","error_wrong_query":"(wrong_query) Incorrect or missing query parameter.","error_incorrect_appkey":"(incorrect_appkey) Incorrect or missing appkey.","error_internal_error":"(internal_error) Unknown server error.","error_quota_exceeded":"(quota_exceeded) Required more quota than is available.","error_incorrect_user_id":"(incorrect_user_id) Incorrect user specified in User ID predicate.","error_unknown":"(unknown) Unknown error."};Echo.Application.prototype.initApplication=function(D){var B=this;var C=this.config.get("appkey");if(!C){this.showMessage({"type":"error","message":"Incorrect or missing mandatory parameter appkey"});return ;}this.config.get("target").addClass("echo-ui");this.user=this.config.get("user")||new Echo.User({"appkey":C,"apiBaseURL":this.config.get("apiBaseURL"),"contextId":this.config.get("contextId")});this.user.init(function(){B.initPlugins(D);});Echo.Localization.extend(this.errorMessages);};Echo.Application.prototype.messageTemplates={"compact":'<span class="echo-application-message-icon echo-application-message-{Data:type}" title="{Data:message}">'+"</span>","default":'<div class="echo-application-message">'+'<span class="echo-application-message-icon echo-application-message-{Data:type} echo-primaryFont">'+"{Data:message}"+"</span>"+"</div>"};Echo.Application.prototype.showMessage=function(C,D){if(!this.config.get("debug")&&C.type=="error"){return ;}var B=this.messageTemplates[C.layout||this.messageLayout||"default"];(D||this.config.get("target")).empty().append(this.substitute(B,C));};Echo.Application.prototype.isWaitingForData=function(B){return B&&(B.errorCode=="waiting"||B.errorCode=="timeout"||B.errorCode=="busy");};Echo.Application.prototype.handleErrorResponse=function(G,D){var B=this;D=D||{};var H=this.config.get("target");var E=function(){if(B.waitingTimeoutStep>0){if(B.waitingTimeoutStep<4){B.waitingTimeoutStep++;}}else{B.waitingTimeoutStep=1;}return Math.round(Math.exp(B.waitingTimeoutStep))*1000;};if(this.error!=G){if(!this.config.get("debug")){H.hide();}else{var C=this.label("error_"+G.errorCode);var F=C=="error_"+G.errorCode?"("+G.errorCode+") "+(G.errorMessage||""):C;H.show();this.showMessage({"type":this.isWaitingForData(G)?"loading":"error","message":F},D.messageTarget);}}this.error=G;if(this.isWaitingForData(G)){this.waitingTimer=setTimeout(function(){B.cleanupErrorHandlers();if(D.waitingHandler){D.waitingHandler();}else{B.refresh();}},E());}else{this.waitingTimeoutStep=0;}if(D.callback){D.callback(G);
}};Echo.Application.prototype.cleanupErrorHandlers=function(B){if(B){this.waitingTimeoutStep=0;delete this.error;}if(this.waitingTimer){clearTimeout(this.waitingTimer);}};Echo.Application.prototype.initPlugins=function(E){var D=this;var C=this.config.get("pluginsOrder");var B=A.foldl([],C,function(F,H){var G=Echo.Plugins[F];if(G&&G.dependencies&&G.dependencies.length){return H.concat(G.dependencies);}});Echo.include(B,function(){A.map(C,function(F){var G=Echo.Plugins[F];if(G&&G.init&&D.isPluginApplicable(G)){G.init(G,D);}});if(E){E();}});};Echo.Application.prototype.enablePlugin=function(B){this.config.set("plugins."+B+".enabled",true);};Echo.Application.prototype.disablePlugin=function(B){this.config.set("plugins."+B+".enabled",false);};Echo.Application.prototype.isPluginEnabled=function(B){return this.config.get("plugins."+B+".enabled",true);};Echo.Application.prototype.isPluginApplicable=function(D){var C=this,B=false;A.each(D.applications,function(F,E){if(Echo[E]&&C instanceof Echo[E]){B=true;return false;}});return B;};Echo.Application.prototype.initConfig=function(D,E,C){var B={};B.target=function(F){return A(F);};B.plugins=function(G){var F=A.foldl({"hash":{},"order":[]},G||[],function(H,I){var J=A.inArray(H.name,I.order);if(J>=0){I.order.splice(J,1);}I.order.push(H.name);I.hash[H.name]=H;});this.set("pluginsOrder",F.order);return F.hash;};D=A.extend({"plugins":[]},D||{});E=A.extend({"appkey":"","apiBaseURL":"http://api.echoenabled.com","liveUpdates":true,"liveUpdatesTimeout":10,"liveUpdatesTimeoutMin":3,"debug":true,"contextId":this.newContextId()},E||{});this.config=new Echo.Config(D,E,function(F,H){var G=C&&C[F]||B&&B[F];return G?G.call(this,H):H;});};Echo.Application.prototype.sendAPIRequest=function(B,C){B.query.appkey=this.config.get("appkey");A.get(this.config.get("apiBaseURL")+"/v1/"+B.endpoint,B.query,C,"jsonp");};Echo.Application.prototype.initLiveUpdates=function(D,B){var C=this;this.liveUpdates={"originalTimeout":this.config.get("liveUpdatesTimeout"),"timers":{},"timeouts":[],"responseHandler":function(E){if(C.liveUpdates.timers.watchdog){clearTimeout(C.liveUpdates.timers.watchdog);}C.changeLiveUpdatesTimeout(E);B(E);},"requestParamsGetter":D};};Echo.Application.prototype.changeLiveUpdatesTimeout=function(H){var D=this;if(typeof H=="string"){H={"liveUpdatesTimeout":H};}H.liveUpdatesTimeout=parseInt(H.liveUpdatesTimeout);var C=function(J){if(!J&&D.liveUpdates.originalTimeout!=D.config.get("liveUpdatesTimeout")){D.config.set("liveUpdatesTimeout",D.liveUpdates.originalTimeout);}else{if(J&&J>D.config.get("liveUpdatesTimeout")){D.config.set("liveUpdatesTimeout",J);}}};var B=function(J){return !!(J.entries&&J.entries.length);};if(!this.nextSince){C(H.liveUpdatesTimeout);return ;}var F=this.config.get("liveUpdatesTimeout");var I=parseInt(this.nextSince);var E=Math.floor((new Date()).getTime()/1000);var G=B(H)?E-I>F?this.config.get("liveUpdatesTimeoutMin",3):F+1:F+2;if(G>this.liveUpdates.originalTimeout){G=this.liveUpdates.originalTimeout;}this.config.set("liveUpdatesTimeout",G);if(G==this.liveUpdates.originalTimeout){C(H.liveUpdatesTimeout);}};Echo.Application.prototype.stopLiveUpdates=function(){if(this.liveUpdates.timers.regular){clearTimeout(this.liveUpdates.timers.regular);}if(this.liveUpdates.timers.watchdog){clearTimeout(this.liveUpdates.timers.watchdog);}};Echo.Application.prototype.startLiveUpdates=function(D){var B=this;if(!this.liveUpdates||!D&&!this.config.get("liveUpdates")&&!this.liveUpdates.timeouts.length){return ;}this.stopLiveUpdates();if(D){this.liveUpdates.timeouts=[0,1,3];}var C=this.liveUpdates.timeouts.length?this.liveUpdates.timeouts.shift():this.config.get("liveUpdatesTimeout");this.liveUpdates.timers.regular=setTimeout(function(){B.liveUpdates.timers.watchdog=setTimeout(function(){B.startLiveUpdates();},5000);B.sendAPIRequest(B.liveUpdates.requestParamsGetter(),B.liveUpdates.responseHandler);},C*1000);};Echo.Application.prototype.addCss=function(){var C="echo-css-fancybox";if(A("#"+C).length){return ;}var B=document.getElementsByTagName("head")[0]||document.documentElement;B.insertBefore(A("<link>",{"rel":"stylesheet","id":C,"type":"text/css","href":"//www.washingtonpost.com/rw/sites/twpweb/css/echo2/core/fancybox.css"}).get(0),A(B).children().get(0));A.addCss(".echo-application-message { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }"+".echo-application-message-icon { display: inline-block; height: 16px; padding-left: 16px; background: no-repeat left center; }"+".echo-application-message .echo-application-message-icon { padding-left: 21px; height: auto; }"+".echo-application-message-empty { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/information.png); }"+".echo-application-message-loading { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/loading.gif); }"+".echo-application-message-error { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/warning.gif); }","application");};Echo.User=function(B){this.data={};this.config=new Echo.Config(B,{"appkey":"","apiBaseURL":"http://api.echoenabled.com","contextId":undefined});};Echo.User.prototype.init=function(E){var B=this;this.callback=E||function(){};if(!this.config.get("appkey")||!window.Backplane||!Backplane.getChannelID()){this.set({});this.callback();return ;}this.listenEvents();var D=this._global("get","state");if(D=="ready"){this.set(A.extend({},this._global("get","data")));this.callback();}else{var C=Echo.Broadcast.subscribe("User.onInit",function(F,G){if(G.appkey!=B.config.get("appkey")){return ;}Echo.Broadcast.unsubscribe("User.onInit",C);B.set(A.extend({},B._global("get","data")));B.callback();});if(D=="init"){this.request();}}};Echo.User.prototype.listenEvents=function(){var B=this;if(this.backplaneSubscriptionID){return ;}var C=function(F){var E=(F?"":"internal.")+"User.onInvalidate";var G={"data":B.data,"appkey":B.config.get("appkey")};var D=F?undefined:B.config.get("contextId");Echo.Broadcast.publish(E,G,D);};this.backplaneSubscriptionID=Backplane.subscribe(function(E){if(E.type=="identity/ack"){var D=false;if(B._global("get","state")=="ready"){D=true;B._global("set","state","init");}B.init(function(){C();if(D){C(true);}});}});};Echo.User.prototype._global=function(E,C,D){var B=this.config.get("appkey");Echo.Vars.users=Echo.Vars.users||{};Echo.Vars.users[B]=Echo.Vars.users[B]||{"state":"init","data":{}};if(E=="get"){return Echo.Vars.users[B][C];}Echo.Vars.users[B][C]=D;};Echo.User.prototype.set=function(){if(!arguments.length){return ;}if(arguments.length==1&&typeof arguments[0]=="object"){this._global("set","data",arguments[0]);this.data=this.normalize(arguments[0]);this.account=this.assemble();}else{if(arguments.length==2&&typeof arguments[0]=="string"){this.account[arguments[0]]=arguments[1];}}};Echo.User.prototype.get=function(B,C){return(this.account.hasOwnProperty(B)&&typeof this.account[B]!="undefined")?this.account[B]:C;};Echo.User.prototype.logout=function(C){var B=this;A.get(window.location.protocol+"//apps.echoenabled.com/v2/logout",{"sessionID":Backplane.getChannelID()},function(D){Backplane.expectMessages("identity/ack");},"jsonp");};Echo.User.prototype.request=function(D){var B=this,C=this.config.get("appkey");this._global("set","state","waiting");A.get(this.config.get("apiBaseURL")+"/v1/users/whoami",{"appkey":C,"sessionID":Backplane.getChannelID()},function(E){if(E.result&&E.result=="session_not_found"){E={};}B._global("set","state","ready");B.set(A.extend({},E));Echo.Broadcast.publish("User.onInit",{"data":E,"appkey":C});if(D){D();}},"jsonp");};Echo.User.prototype.normalize=function(C){var B=function(D){return A.foldl({},D||[],function(E,F){F[E]=true;});};C=C||{};C.echo=C.echo||{};A.extend(C,C.echo);C.poco=C.poco||{"entry":{}};C.roles=B(C.echo.roles);C.markers=B(C.echo.markers);C.sessionID=window.Backplane&&Backplane.getChannelID()||undefined;C.accounts=C.poco.entry.accounts||[];
return C;};Echo.User.prototype.getActiveAccounts=function(){return A.map(this.data.accounts,function(B){if(B.loggedIn=="true"){return B;}});};Echo.User.prototype.assemble=function(){var B=this.getActiveAccounts();var C=B[0]||{};return A.extend(this.data,{"id":C.identityUrl||this.data.poco.entry.id||C.userid,"name":this.data.poco.entry.displayName||C.username,"avatar":A.foldl(undefined,C.photos||[],function(D){if(D.type=="avatar"){return D.value;}}),"state":this.data.echo.state||"Untouched","domain":C.domain,"logged":!!B.length,"defaultAvatar":"//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/avatar-default.png","fakeIdentityURL":"http://js-kit.com/ECHO/user/fake_user"});};Echo.User.prototype.hasIdentity=function(C){var B=false;A.each(this.data.accounts,function(D,E){if(E.identityUrl&&E.identityUrl==C){B=true;return false;}});return B;};Echo.User.prototype.hasAny=function(E,C){if(!this.account){return false;}var B=this,D=false;A.each(C,function(F,H){var G=B.get(E,{});if((typeof G=="string"&&G==H)||G[H]){D=true;return false;}});return D;};Echo.User.prototype.hasAnyRole=function(B){return this.hasAny("roles",B);};Echo.User.prototype.isAdmin=function(){return this.hasAny("roles",["administrator","moderator"]);};Echo.User.prototype.logged=function(){return !!(this.account&&this.account.logged);};Echo.Config=function(E,C,D){var B=this;this.normalize=D||function(F,G){return G;};this.data={};this.cache={};if(!C&&!D){this.data=E;}else{A.each(this.combine(E,A.extend({},C)),function(F,G){B.set(F,G);});}};Echo.Config.prototype.get=function(C,D){var B=C;if(typeof B!="string"){B=B.join(".");}if(!this.cache.hasOwnProperty(B)){this.cache[B]=A.getNestedValue(C,this.data);}return typeof this.cache[B]=="undefined"?D:this.cache[B];};Echo.Config.prototype.set=function(B,D){var C=B.split(/\./);delete this.cache[B];if(typeof D=="object"){this.clearCacheByPrefix(B);}return A.setNestedValue(this.data,B,this.normalize(C.pop(),D));};Echo.Config.prototype.remove=function(B){var C=B.split(/\./);var E=C.pop();var D=A.getNestedValue(C,this.data);delete D[E];};Echo.Config.prototype.combine=function(D,C){var B=this;return A.foldl(C,D,function(G,F,E){F[E]=A.isPlainObject(G)&&C.hasOwnProperty(E)?B.combine(G,C[E]):G;});};Echo.Config.prototype.extend=function(B){var C=this;A.each(B,function(D,E){C.set(D,E);});};Echo.Config.prototype.getAsHash=function(){return this.data;};Echo.Config.prototype.clearCacheByPrefix=function(C){var B=this;C+=".";A.each(this.cache,function(D,E){if(!D.indexOf(C)){delete B.cache[D];}});};if(!Echo.UI){Echo.UI={cornersCss:function(B,C){return("{scope}.ui-corner-tl { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; }"+"{scope}.ui-corner-tr { -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }"+"{scope}.ui-corner-bl { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }"+"{scope}.ui-corner-br { -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-top { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }"+"{scope}.ui-corner-bottom { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-right {  -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-left { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }"+"{scope}.ui-corner-all { -moz-border-radius: {radius}; -webkit-border-radius: {radius}; border-radius: {radius}; }").replace(/{scope}/g,C||"").replace(/{radius}/g,B);}};}(function(){A.addCss(".echo-ui { text-align: left; }"+".echo-ui .ui-helper-hidden { display: none; }"+".echo-ui .ui-helper-hidden-accessible { position: absolute; left: -99999999px; }"+".echo-ui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }"+'.echo-ui .ui-helper-clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }'+".echo-ui .ui-helper-clearfix { display: inline-block; }"+"/* required comment for clearfix to work in Opera \\*/"+"* html .echo-ui .ui-helper-clearfix { height:1%; }"+".echo-ui .ui-helper-clearfix { display:block; }"+"/* end clearfix */"+".echo-ui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }"+".echo-ui .ui-resizable-handle { position: absolute;font-size: 0.1px;z-index: 99999; display: block;}"+".echo-ui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }"+".echo-ui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }"+".echo-ui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }"+".echo-ui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }"+".echo-ui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }"+".echo-ui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }"+".echo-ui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }"+".echo-ui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }"+".echo-ui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}"+".echo-ui .ui-state-disabled { cursor: default !important; }"+".echo-ui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; width: 16px; height: 16px; }"+".echo-ui .ui-widget-header { font-weight: bold; border: 0px; }"+".echo-ui, .echo-ui .ui-widget :active { outline: none; }"+".echo-ui .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }"+".echo-ui .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-ui .ui-state-default a:visited { color: #555555; text-decoration: none; }"+".echo-ui .ui-state-hover, .echo-ui .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }"+".echo-ui .ui-state-hover a, .echo-ui .ui-state-hover a:hover { color: #212121; text-decoration: none; }"+".echo-ui .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }"+".echo-ui .ui-state-active a, .echo-ui .ui-state-active a:link, .echo-ui .ui-state-active a:visited { color: #212121; text-decoration: none; }"+".echo-primaryBackgroundColor {  }"+".echo-secondaryBackgroundColor { background-color: #F4F4F4; }"+".echo-trinaryBackgroundColor { background-color: #ECEFF5; }"+".echo-primaryColor { color: #3A3A3A; }"+".echo-secondaryColor { color: #C6C6C6; }"+".echo-primaryFont { font-family: Arial, sans-serif; font-size: 12px; font-weight: normal; line-height: 16px; }"+".echo-secondaryFont { font-family: Arial, sans-serif; font-size: 11px; }"+".echo-linkColor, .echo-linkColor a { color: #476CB8; }"+".echo-clickable { cursor: pointer; }"+".echo-relative { position: relative; }"+".echo-clear { clear: both; }","ui-general");})();Echo.UI.Dialog=function(B){B.config=B.config||{};this.init(B);this.config.dialogClass="echo-ui echo-dialog "+(this.config.dialogClass||"");
this.addCss();this.contentElement=this.render().dialog(this.config).addClass("ui-corner-all");if(this.content){if(A.isFunction(this.content)){this.content(this.contentElement);}else{this.contentElement.append(this.content);}}this.widget=this.contentElement.dialog("widget");if(this.hasTabs){A(".ui-dialog-titlebar",this.widget).after(A(".echo-tabs-header",this.widget));}};Echo.UI.Dialog.prototype=new Echo.Object();Echo.UI.Dialog.prototype.cssPrefix="echo-dialog-";Echo.UI.Dialog.prototype.template="<div></div>";Echo.UI.Dialog.prototype.open=function(){this.contentElement.hide();this.contentElement.dialog("open");this.contentElement.show();};Echo.UI.Dialog.prototype.close=function(){this.contentElement.dialog("close");};Echo.UI.Dialog.prototype.addCss=function(){A.addCss(".echo-dialog { position: absolute; padding: 0px 7px 20px 7px; width: 300px; border: 1px solid #aaaaaa; background: #dfebf2; -moz-border-radius: 7px; -webkit-border-radius: 7px; border-radius: 7px;"+(!A.browser.msie?" overflow: hidden;":"")+" }"+".echo-dialog .ui-dialog-titlebar { background: #dfebf2; cursor: move; padding: 7px 0px 10px 5px; position: relative; color: #4a4a4a; font: 18px Helvetica,sans-serif; }"+".echo-dialog .ui-dialog-titlebar .ui-state-default, .echo-dialog .ui-dialog-titlebar .ui-state-active, .echo-dialog .ui-dialog-titlebar .ui-state-hover, .echo-dialog .ui-dialog-titlebar .ui-state-focus { border: 0px; background: none; }"+".echo-dialog .ui-dialog-title { float: left; margin: .1em 16px .2em 0; } "+".echo-dialog .ui-dialog-titlebar-close { position: absolute; right: 0px; top: 50%; width: 19px; margin: -10px 0 0 0; padding: 0px; height: 18px; }"+".echo-dialog .ui-dialog-titlebar-close span { display: block; margin: 1px; }"+".echo-dialog .ui-dialog-titlebar-close:hover, .ui-dialog .ui-dialog-titlebar-close:focus { padding: 0px; }"+".echo-dialog .ui-dialog-content { border: 0; padding: 0px; margin: 0px; background: #ffffff; overflow: auto; }"+".echo-dialog .ui-resizable-se { width: 14px; height: 14px; right: 3px; bottom: 3px; }"+".echo-dialog .ui-icon-closethick { background: no-repeat top right url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/container/closeWindow.png); }"+".echo-dialog .ui-icon-grip-diagonal-se { background: no-repeat bottom right url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/container/resizeHandle.png); }"+Echo.UI.cornersCss("7px",".echo-dialog "),"ui-dialog");if(A.browser.msie){A.addCss(".echo-dialog .ui-dialog-content { zoom: 1; position: relative; }","ui-dialog-ie");}};Echo.UI.Tabs=function(D){var C=this;D.config=D.config||{};this.init(D);if(!this.tabs){return ;}var B=this.idPrefix;this.idPrefix=this.idPrefix+Math.ceil(Math.random()*999999999)+"-";this.addCss();var E=A.foldl([],this.tabs,function(G,H,F){G.classPrefix=B;G.idPrefix=C.idPrefix;if(G.icon){G.label="<span>"+G.label+"</span>";}if(G.disabled){H.push(F);}});this.target.append(this.render());this.tabIndexById={};A.each(this.tabs,function(F,G){C.tabIndexById[G.id]=F;if(G.content){var H=A("#"+G.idPrefix+G.id);if(A.isFunction(G.content)){G.content(H);}else{H.append(G.content);}}});if(this.addUIClass!==false){this.target.addClass("echo-ui");}A.extend(this.config,{"disabled":E.concat(C.config.disabled||[]),"select":function(F,G){C.content[G.index?"addClass":"removeClass"]("ui-corner-tl");}});this.headerElement=A(".echo-tabs-header",this.target).tabs(this.config);this.panelsElement=A(".echo-tabs-panels",this.target).tabs(this.config);A(".echo-tabs-header, .echo-tabs-header .ui-tabs-nav",this.target).removeClass("ui-corner-all");this.content=A(this.content||".echo-tabs-panels",this.target);this.content.removeClass("ui-corner-all").addClass("ui-corner-tr ui-corner-bottom");};Echo.UI.Tabs.prototype=new Echo.Object();Echo.UI.Tabs.prototype.cssPrefix="echo-tabs-";Echo.UI.Tabs.prototype.template=function(){var B=this;return'<div class="echo-tabs">'+'<div class="echo-tabs echo-tabs-header">'+"<ul>"+A.map(this.tabs,function(C){return B.substitute('<li><a class="echo-{Data:classPrefix}{Data:id}" href="#{Data:idPrefix}{Data:id}">{Data:label}</a></li>',C);}).join("\n")+"</ul>"+"</div>"+'<div class="echo-tabs echo-tabs-panels"></div>'+"</div>";};Echo.UI.Tabs.prototype.renderers={};Echo.UI.Tabs.prototype.renderers.panels=function(C){var B=this;A.each(this.tabs,function(D,E){var F=A.toDOM(B.substitute('<div id="{Data:idPrefix}{Data:id}" class="{Data:idPrefix}{Data:id}"></div>',E));C.append(F.content);});};Echo.UI.Tabs.prototype.select=function(B){this.headerElement.tabs("select",this.tabIndexById[B]);};Echo.UI.Tabs.prototype.addCss=function(){A.addCss(".echo-ui .ui-tabs { position: relative; padding: 0px; border: 0px; }"+".echo-tabs .echo-tabs-panels { background: #ffffff; }"+".echo-ui .ui-tabs .ui-tabs-nav { margin: 0; padding: 0px; }"+".echo-ui .ui-tabs .ui-tabs-nav li { list-style: none; float: left; position: relative; top: 1px; margin: 0 .2em 1px 0; border-bottom: 0 !important; padding: 0; white-space: nowrap; }"+".echo-ui .ui-tabs .ui-tabs-nav li a { float: left; padding: .3em .7em; text-decoration: none; font-size: 12px; font-family: Helvetica,sans-serif; }"+".echo-ui .ui-tabs .ui-tabs-nav li.ui-tabs-selected { margin-bottom: 0; padding-bottom: 1px; }"+".echo-ui .ui-tabs .ui-tabs-nav li.ui-tabs-selected a, .echo-ui .ui-tabs .ui-tabs-nav li.ui-state-disabled a, .echo-ui .ui-tabs .ui-tabs-nav li.ui-state-processing a { cursor: text; color: #4a4a4a; }"+".echo-ui .ui-tabs .ui-tabs-nav li a, .echo-ui .ui-tabs.ui-tabs-collapsible .ui-tabs-nav li.ui-tabs-selected a { cursor: pointer; color: #393939; }"+".echo-ui .ui-tabs .ui-tabs-panel { display: block; border-width: 0; padding: 1em 1.4em; background: none; }"+".echo-ui .ui-tabs .ui-tabs-hide { display: none !important; }"+".echo-ui .echo-tabs-header .ui-state-hover, .echo-ui .echo-tabs-header .ui-state-focus { border: 0px; background: none; color: #212121; }"+".echo-ui .echo-tabs-header .ui-state-default { border: 0px; background: none; font-weight: normal; }"+".echo-ui .echo-tabs-header .ui-state-active { border: 0px; background: #ffffff; font-weight: bold; }"+".echo-ui .ui-tabs .ui-tabs-nav li a span { display: inline-block; padding-left: 22px; }"+(A.browser.opera?".echo-ui .ui-tabs-nav { height: 25px; overflow: hidden; }":"")+Echo.UI.cornersCss("7px",".echo-tabs "),"ui-tabs");if(A.browser.msie){A.addCss(".echo-ui .ui-tabs { zoom:  1; position: static; }","ui-tabs-ie");}};if(!Echo.Localization){Echo.Localization={labels:{}};}Echo.Localization.key=function(B,C){return(C?C+".":"")+B;};Echo.Localization.extend=function(C,B){A.each(C,function(D,E){Echo.Localization.labels[Echo.Localization.key(D,B)]=E;});};Echo.Localization.label=function(C,D,E){var B=Echo.Localization.labels[Echo.Localization.key(C,D)]||C;A.each(E||{},function(F,G){B=B.replace(new RegExp("{"+F+"}","g"),G);});return B;};})(jQuery);(function(A){Echo.Localization.extend({"defaultModeSwitchTitle":"Switch to metadata view","guest":"Guest","today":"Today","yesterday":"Yesterday","lastWeek":"Last Week","lastMonth":"Last Month","secondAgo":"Second Ago","secondsAgo":"Seconds Ago","minuteAgo":"Minute Ago","minutesAgo":"Minutes Ago","hourAgo":"Hour Ago","hoursAgo":"Hours Ago","dayAgo":"Day Ago","daysAgo":"Days Ago","weekAgo":"Week Ago","weeksAgo":"Weeks Ago","metadataModeSwitchTitle":"Return to default view","monthAgo":"Month Ago","monthsAgo":"Months Ago","sharedThisOn":"I shared this on {service}...","userID":"User ID:","textToggleTruncatedMore":"more","textToggleTruncatedLess":"less","fromLabel":"from","viaLabel":"via","loading":"Loading...","childrenMoreItems":"View more items"},"Item");Echo.Item=function(B){this.vars={};this.textExpanded=false;this.blocked=false;this.controlsOrder=[];this.controls={};this.init(B);};Echo.Item.prototype=new Echo.Object();Echo.Item.prototype.cssPrefix="echo-item-";Echo.Item.prototype.namespace="Item";Echo.Item.prototype.template=function(){var B=this.isChildrenPaginationEnabled()?this.config.get("children.sortOrder")=="chronological"?'<div class="echo-item-children"></div>'+'<div class="echo-item-expandChildren echo-item-container-child echo-trinaryBackgroundColor echo-clickable">'+'<span class="echo-item-expandChildrenLabel echo-message-icon"></span>'+"</div>"+'<div class="echo-item-childrenByCurrentActorLive"></div>':'<div class="echo-item-expandChildren echo-item-container-child echo-trinaryBackgroundColor echo-clickable">'+'<span class="echo-item-expandChildrenLabel echo-message-icon"></span>'+"</div>"+'<div class="echo-item-children"></div>'+'<div class="echo-item-childrenByCurrentActorLive"></div>':'<div class="echo-item-children"></div>';
return'<div class="echo-item-content">'+'<div class="echo-item-container">'+'<div class="echo-item-avatar-wrapper">'+'<div class="echo-item-avatar"></div>'+"</div>"+'<div class="echo-item-wrapper">'+'<div class="echo-item-subwrapper">'+'<div class="echo-item-subcontainer">'+'<div class="echo-item-frame">'+'<div class="echo-item-modeSwitch echo-clickable"></div>'+'<div class="echo-item-authorName echo-linkColor"></div>'+'<div class="echo-clear"></div>'+'<div class="echo-item-data">'+'<div class="echo-item-re"></div>'+'<div class="echo-item-body echo-primaryColor"> '+'<span class="echo-item-text"></span>'+'<span class="echo-item-textEllipses">...</span>'+'<span class="echo-item-textToggleTruncated echo-linkColor echo-clickable"></span>'+"</div>"+'<div class="echo-item-markers echo-secondaryFont echo-secondaryColor"></div>'+'<div class="echo-item-tags echo-secondaryFont echo-secondaryColor"></div>'+"</div>"+'<div class="echo-item-metadata">'+'<div class="echo-item-metadata-userID">'+'<span class="echo-item-metadata-title echo-item-metadata-icon echo-item-metadata-userID">'+"{Label:userID}"+"</span>"+'<span class="echo-item-metadata-value">{Data:actor.id}</span>'+"</div>"+"</div>"+'<div class="echo-item-footer echo-secondaryColor echo-secondaryFont">'+'<img class="echo-item-sourceIcon echo-clickable">'+'<div class="echo-item-date"></div>'+'<div class="echo-item-from"></div>'+'<div class="echo-item-via"></div>'+'<div class="echo-item-controls"></div>'+'<div class="echo-clear"></div>'+"</div>"+"</div>"+"</div>"+'<div class="echo-clear"></div>'+"</div>"+"</div>"+'<div class="echo-clear"></div>'+'<div class="echo-item-childrenMarker"></div>'+"</div>"+B+"</div>";};Echo.Item.prototype.renderers={};Echo.Item.prototype.renderers.authorName=function(B){return this.data.actor.title||this.label("guest");};Echo.Item.prototype.renderers.markers=function(B,C){this.render("extraField",B,C,{"type":"markers"});};Echo.Item.prototype.renderers.tags=function(B,C){this.render("extraField",B,C,{"type":"tags"});};Echo.Item.prototype.renderers.extraField=function(F,H,B){var E=this;var G=(B||{}).type;if(!this.data.object[G]||!this.user.isAdmin()){H.remove(F);return ;}var C=this.config.get("limits."+G);var D=A.foldl([],this.data.object[G],function(K,L){var J=(K.length>C)?'<span title="{Data:item}">{Data:truncatedItem}</span>':"<span>{Data:item}</span>";var I=A.htmlTextTruncate(K,C,"...");L.push(E.substitute(J,{"item":K,"truncatedItem":I}));});F.prepend(D.sort().join(", "));};Echo.Item.prototype.renderers.container=function(D,F){var C=this;D.removeClass(A.map(["child","root","child-thread","root-thread"],function(G){return"echo-item-container-"+G;}).join(" "));var B=this.threading?"-thread":"";if(this.depth){D.addClass("echo-item-container-child"+B);D.addClass("echo-trinaryBackgroundColor");}else{D.addClass("echo-item-container-root"+B);}D.addClass("echo-item-depth-"+this.depth);var E=function(G){A.map(C.controlsOrder,function(H){if(!C.controls[H].element){return ;}C.controls[H].clickableElements[G+"Class"]("echo-linkColor");});};if(!A.isMobileDevice()){D.unbind(["mouseleave","mouseenter"]).hover(function(){if(C.user.isAdmin()){F.get("modeSwitch").show();}E("add");},function(){if(C.user.isAdmin()){F.get("modeSwitch").hide();}E("remove");});}};Echo.Item.prototype.renderers.modeSwitch=function(D){var C=this;D.hide();if(!this.user.isAdmin()){return ;}var E="default";var B=function(F){F.attr("title",C.label(E+"ModeSwitchTitle"));};B(D);D.click(function(){E=(E=="default"?"metadata":"default");B(D);C.dom.get("data").toggle();C.dom.get("metadata").toggle();});if(A.isMobileDevice()){D.show();}};Echo.Item.prototype.renderers.wrapper=function(B){B.addClass("echo-item-wrapper"+(this.depth?"-child":"-root"));};Echo.Item.prototype.renderers.avatar=function(){var B=this;var D=(!this.depth?48:24);var C=this.data.actor.avatar||this.user.get("defaultAvatar");return A("<img>",{"src":C,"width":D,"height":D}).bind({"error":function(){A(this).attr("src",B.user.get("defaultAvatar"));}});};Echo.Item.prototype.renderers.childrenContainer=function(D,E,C){var B=this;A.each(D.children(),function(F,G){A(G).detach();});A.map(this.children,function(G){if(C&&C.filter&&!C.filter(G)){return ;}var F=!G.dom;D.append(F?G.render():G.dom.content);if(G.deleted){B.publish("internal.Item.onDelete",{"item":G});}else{if(G.added){B.publish("internal.Item.onAdd",{"item":G});}else{if(F&&G instanceof Echo.Item){B.publish("internal.Item.onRender",{"item":G});}}}});};Echo.Item.prototype.renderers.children=function(B,C){this.render("childrenContainer",B,C,{"filter":function(D){return !D.byCurrentUser;}});};Echo.Item.prototype.renderers.childrenByCurrentActorLive=function(B,C){this.render("childrenContainer",B,C,{"filter":function(D){return D.byCurrentUser;}});};Echo.Item.prototype.renderers.control=function(C,H,B){if(!B||!B.name){return ;}var D=B.template||'<a class="echo-item-control echo-item-control-{Data:name}">{Data:label}</a>';var F={"label":B.label||"","name":B.name};var G=A(this.substitute(D,F));var E=A(".echo-clickable",G);if(!E.length){E=G;G.addClass("echo-clickable");}E[B.onetime?"one":"bind"]({"click":function(I){I.stopPropagation();if(B.callback){B.callback();}}});if(A.isMobileDevice()){E.addClass("echo-linkColor");}return G;};Echo.Item.prototype.renderers.controlsDelimiter=function(){return A('<span class="echo-item-control-delim"> \u00b7 </span>');};Echo.Item.prototype.renderers.controls=function(E){var D=this;this.assembleControls();this.sortControls();var B=E.empty();var C=this.render("controlsDelimiter");A.map(this.controlsOrder,function(F){var G=D.controls[F];if(!G||!G.visible()){return ;}var H=G.dom||D.render("control",undefined,undefined,G);if(H){D.controls[F].element=H;D.controls[F].clickableElements=A(".echo-clickable",H);if(!D.controls[F].clickableElements.length){D.controls[F].clickableElements=H;}B.append(C.clone(true)).append(H);}});};Echo.Item.prototype.renderers.re=function(){if(!this.config.get("reTag")){return ;}var M=this;var D=this.data.object.context;var K="";var J=this.data.object.permalink;var B=this.config.get("limits");var I=this.config.get("openLinksInNewWindow");var L=function(N){var O=A.parseUrl(N);return(O&&O.domain)?O.domain:N;};var E=function(O){var N=B.reTitle;if(!O.title){N=B.reLink;O.title=O.uri.replace(/^https?:\/\/(.*)/ig,"$1");}if(O.title.length>N){O.title=O.title.substring(0,N)+"...";}return"<div>"+M.hyperlink({"class":"echo-primaryColor","href":O.uri,"caption":"Re: "+A.stripTags(O.title)},{"openInNewWindow":I})+"</div>";};var G=document.location.href;var H=L(G);if(J==G||this.depth||!D||!D.length){return ;}var C=false;A.each(D,function(N,O){if(O.uri==G){C=true;return false;}});if(C){return ;}if(this.config.get("optimizedContext")){var F=D[0];A.each(D,function(N,O){if(L(O.uri)==H){F=O;return false;}});if(F){K=E(F);}}else{A.each(D,function(N,O){K+=E(O);});}return A(K);};Echo.Item.prototype.renderers.sourceIcon=function(B,C){if(!this.config.get("viaLabel.icon")||this.data.source.name=="jskit"||this.data.source.name=="echo"){C.remove(B);}B.hide().attr("src",A.htmlize(this.data.source.icon||this.config.get("providerIcon"))).show().one("error",function(){C.remove(B);}).wrap(this.hyperlink({"href":this.data.source.uri||this.data.object.permalink},{"openInNewWindow":this.config.get("openLinksInNewWindow")}));};Echo.Item.prototype.renderers.via=function(D,E){var B=this;var C=function(F){return(B.data[F].name||"").toLowerCase();};if(C("source")==C("provider")){return ;}this.render("viaText",D,E,{"label":"via","field":"provider"});};Echo.Item.prototype.renderers.from=function(B,C){this.render("viaText",B,C,{"label":"from","field":"source"});};Echo.Item.prototype.renderers.viaText=function(D,F,B){B=B||{};var E=this.data[B.field];if(!this.config.get("viaLabel.text")||!E.name||E.name=="jskit"||E.name=="echo"){return ;}var C=this.hyperlink({"class":"echo-secondaryColor","href":E.uri||this.data.object.permalink,"caption":E.name},{"openInNewWindow":this.config.get("openLinksInNewWindow")});D.html("&nbsp;"+this.label(B.label+"Label")+"&nbsp;").append(C);
};Echo.Item.prototype.renderers.textToggleTruncated=function(C){var B=this;C.unbind("click").click(function(){B.textExpanded=!B.textExpanded;B.rerender(["body","textToggleTruncated"]);});return this.label("textToggleTruncated"+(this.textExpanded?"Less":"More"));};Echo.Item.prototype.renderers.body=function(D,V){var Q=this;var J=function(b,a){V.get("text").empty().append(b);V.get("textEllipses")[!a||Q.textExpanded?"hide":"show"]();V.get("textToggleTruncated")[a||Q.textExpanded?"show":"hide"]();};var O=this.data.object.content.replace(/<!\[CDATA\[(.*?)\]\]>/g,"$1");var S=this.data.source.name;var T=this.config.get("openLinksInNewWindow");var M=this.config.get("contentTransformations."+this.data.object.content_type,{});if(S&&S=="Twitter"&&this.config.get("aggressiveSanitization")){J(this.label("sharedThisOn",{"service":S}));return ;}var H=this.config.get("limits");var K=function(a){var c=(a.length>H.tags)?'<span class="echo-item-tag" title="{Data:tag}">{Data:truncatedTag}</span>':'<span class="echo-item-tag">{Data:tag}</span>';var b=a.substring(0,H.tags)+"...";return(Q.substitute(c,{"tag":a,"truncatedTag":b}));};if(M.hashtags){O=O.replace(/(#|\uff03)(<a[^>]*>[^<]*<\/a>)/ig,function(b,a,c){return K(c);});}var E=function(a){if(!M.hashtags){return a;}return a.replace(/(^|[^\w&\/])(?:#|\uff03)([^\s\.,;:'"#@\$%<>!\?\(\)\[\]]+)/ig,function(c,b,d){return b+K(d);});};var P=function(b){var a=[];b=b.replace(/((<a\s+[^>]*>)(.*?)(<\/a>))|<.*?>/ig,function(d,c,h,g,f){if(c){var e=P(g);e.text=E(e.text);d=h+R(e)+f;}a.push(d);return" %%HTML_TAG%% ";});return{"text":b,"tags":a};};var R=function(a){A.each(a.tags,function(c,b){a.text=a.text.replace(" %%HTML_TAG%% ",b);});return a.text;};var X="((?:http|ftp|https):\\/\\/(?:[a-z0-9#:\\/\\;\\?\\-\\.\\+,@&=%!\\*\\'(){}\\[\\]$_|^~`](?!gt;|lt;))+)";var W=function(a){return a.replace(/(<a\s+[^>]*>)(.*?)(<\/a>)/ig,function(c,b,e,d){if(new RegExp("^"+X+"$").test(e)){e=e.length>H.bodyLink?e.substring(0,H.bodyLink)+"...":e;}if(T&&!/\s+target=("[^<>"]*"|'[^<>']*'|\w+)/.test(b)){b=b.replace(/(^<a\s+[^>]*)(>$)/,'$1 target="_blank"$2');}return b+e+d;});};var U=P(O);if(S&&S!="jskit"&&S!="echo"){var G=this.depth?this.data.target.id:this.config.get("reTag")?this.data.object.permalink||this.data.target.id:undefined;if(G){U.text=U.text.replace(new RegExp(G,"g"),"");if(!/\S/.test(U.text)){J(this.label("sharedThisOn",{"service":S}));return ;}}}var B=U.text=E(U.text);if(M.urls){U.text=U.text.replace(new RegExp(X,"ig"),function(b,a){return Q.hyperlink({"href":a,"caption":a},{"skipEscaping":true,"openInNewWindow":T});});}if(M.smileys){if(U.text!=B){U=P(R(U));}var I=this.initSmileysConfig();if(U.text.match(I.regexps.test)){A.each(I.codes,function(a,b){U.text=U.text.replace(I.regexps[b],I.tag(I.hash[b]));});}}if(M.newlines){U.text=U.text.replace(/\n\n+/g,"\n\n");U.text=U.text.replace(/\n/g,"&nbsp;<br>");}var L=W(R(U));var F=false;if((H.body||H.lines)&&!Q.textExpanded){if(H.lines){var C=M.newlines?"<br>":"\n";var N=L.split(C);if(N.length>H.lines){L=N.splice(0,H.lines).join(C);F=true;}}var Y=H.body&&L.length>H.body?H.body:F?L.length:undefined;var Z=A.htmlTextTruncate(L,Y,"",true);if(Z.length!=L.length){F=true;}L=Z;}J(L,F);};Echo.Item.prototype.renderers.date=function(C){var B=C||this.dom&&this.dom.get("date");this.calcAge();if(B){B.html(this.age);}};Echo.Item.prototype.renderers.expandChildrenLabel=function(D,E,B){if(!this.children.length||!this.hasMoreChildren()){return ;}B=B||{};B.state=B.state||"regular";var C={"loading":{"css":"echo-item-message-loading","label":"loading"},"regular":{"css":"echo-linkColor echo-message-icon","label":"childrenMoreItems"}};D.removeClass(C[B.state=="loading"?"regular":"loading"].css).addClass(C[B.state].css).html(this.label(C[B.state].label));};Echo.Item.prototype.renderers.expandChildren=function(D,E,B){if(!this.children.length){return ;}if(!this.hasMoreChildren()){if(A.browser.msie&&document.compatMode!="CSS1Compat"){D.animate({"height":"1px","marginTop":"hide","marginBottom":"hide","paddingTop":"hide","paddingBottom":"hide"},{"duration":this.config.get("children.moreButtonSlideTimeout"),"complete":function(){D.hide();}});}else{D.slideUp(this.config.get("children.moreButtonSlideTimeout"));}return ;}var C=this;B=B||{};D.css("display","block");D.addClass("echo-item-depth-"+(this.depth+1));D.unbind("click").one("click",function(){C.render("expandChildrenLabel",E.get("expandChildrenLabel"),E,{"state":"loading"});C.publish("internal.Item.onChildrenExpand",{"data":C.data});});};Echo.Item.prototype.isChildrenPaginationEnabled=function(){return !!this.config.get("children.itemsPerPage");};Echo.Item.prototype.hasMoreChildren=function(){return this.data.hasMoreChildren=="true";};Echo.Item.prototype.getNextPageAfter=function(){var C=A.grep(this.children,function(D){return !D.live;});var B=this.config.get("children.sortOrder")=="chronological"?C.length-1:0;return C.length?C[B].data.pageAfter:undefined;};Echo.Item.prototype.initSmileysConfig=function(){if(Echo.Vars.smileys){return Echo.Vars.smileys;}var B=function(E){return E.replace(/([\W])/g,"\\$1");};var C=Echo.Vars.smileys={"codes":[],"regexps":[]};C.hash={":)":{file:"smile.png",title:"Smile"},":-)":{file:"smile.png",title:"Smile"},";)":{file:"wink.png",title:"Wink"},";-)":{file:"wink.png",title:"Wink"},":(":{file:"unhappy.png",title:"Frown"},":-(":{file:"unhappy.png",title:"Frown"},"=-O":{file:"surprised.png",title:"Surprised"},":-D":{file:"grin.png",title:"Laughing"},":-P":{file:"tongue.png",title:"Tongue out"},"=)":{file:"happy.png",title:"Happy"},"B-)":{file:"evilgrin.png",title:"Evil grin"}};var D=[];A.each(C.hash,function(E){var F=B(E);D.push(F);C.codes.push(E);C.regexps[E]=new RegExp(F,"g");});C.regexps.test=new RegExp(D.join("|"));C.tag=function(E){return'<img class="echo-item-smiley-icon" src="//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/smileys/emoticon_'+E.file+'" title="'+E.title+'" border="0" alt="'+E.title+'" />';};return C;};Echo.Item.prototype.assembleControls=function(){var C=this;var B=[];A.each(this.config.get("itemControls",{}),function(E,D){A.map(D,function(H){var G=A.isFunction(H)?H.call(C):A.extend({},H);if(!G.name){return ;}var J=G.callback||function(){};G.callback=function(){J.call(C);C.publish("internal.Item.onControlClick",{"name":G.name,"plugin":E,"item":{"data":C.data,"target":C.dom.content}});};G.label=G.label||G.name;G.plugin=E;if(typeof G.visible=="undefined"){G.visible=true;}var I=G.visible;G.visible=function(){return I&&C.config.get("plugins."+E+".enabled");};var F=E+"."+G.name;C.controls[F]=G;if(A.inArray(F,C.controlsOrder)<0){B.push(F);}});});C.controlsOrder=B.concat(C.controlsOrder);};Echo.Item.prototype.sortControls=function(){var C=this;var E=this.controlsOrder;var F=this.config.get("itemControlsOrder");if(!F){this.config.set("itemControlsOrder",E);}else{if(F!=E){var D=function(G,H,I){if(!C.controls[G]){return ;}H.push(G);I=I||A.inArray(G,E);if(I>=0){delete E[I];}};var B=A.foldl([],F,function(G,I){if(/^(.*)\./.test(G)){D(G,I);}else{var H=new RegExp("^"+G+".");A.map(E,function(K,J){if(K&&K.match(H)){D(K,I,J);}});}});this.controlsOrder=B;this.config.set("itemControlsOrder",B);}else{if(!F.length){this.controlsOrder=[];}}}};Echo.Item.prototype.traverse=function(B,E,D){var C=this;A.each(B||[],function(F,G){D=C.traverse(G.children,E,E(G,D));});return D;};Echo.Item.prototype.refreshDate=function(){this.rerender("date");A.map(this.children||[],function(B){B.refreshDate();});};Echo.Item.prototype.calcAge=function(){if(!this.timestamp){return ;}var D=this;var H=new Date(this.timestamp*1000);var E=(new Date()).getTime();var B;var G=Math.floor((E-H.getTime())/1000);var F=Math.floor(G/86400);var C=function(I,J){return I+" "+D.label(J+(I==1?"":"s")+"Ago");};if(isNaN(F)||F<0||F>=365){B=H.toLocaleDateString()+", "+H.toLocaleTimeString();}else{if(G<60){B=C(G,"second");}else{if(G<60*60){G=Math.floor(G/60);B=C(G,"minute");}else{if(G<60*60*24){G=Math.floor(G/(60*60));B=C(G,"hour");}else{if(G<60*60*48){B=this.label("yesterday");}else{if(F<7){B=C(F,"day");
}else{if(F<14){B=this.label("lastWeek");}else{if(F<30){G=Math.floor(F/7);B=C(G,"week");}else{if(F<60){B=this.label("lastMonth");}else{if(F<365){G=Math.floor(F/31);B=C(G,"month");}}}}}}}}}}if(this.age!=B){this.age=B;}};Echo.Item.prototype.block=function(C){if(this.blocked){return ;}this.blocked=true;var E=this.dom.get("container");var D=E.width();var B=E.outerHeight();this.blockers={"backdrop":A('<div class="echo-item-blocker-backdrop"></div>').css({"width":D,"height":B}),"message":A(this.substitute('<div class="echo-item-blocker-message">{Data:label}</div>',{"label":C})).css({"left":((parseInt(D)-200)/2)+"px","top":((parseInt(B)-20)/2)+"px"})};E.addClass("echo-relative").prepend(this.blockers.backdrop).prepend(this.blockers.message);};Echo.Item.prototype.unblock=function(){if(!this.blocked){return ;}this.blocked=false;this.blockers.backdrop.remove();this.blockers.message.remove();this.dom.get("container").removeClass("echo-relative");};Echo.Item.prototype.getAccumulator=function(B){return this.data.object.accumulators[B];};Echo.Localization.extend({"guest":"Guest","live":"Live","paused":"Paused","more":"More","loading":"Loading...","emptyStream":"No items at this time...","new":"new"},"Stream");Echo.Stream=function(C){if(!C||!C.target){return ;}var B=this;this.vars={"cache":{}};this.initConfig(C,{"aggressiveSanitization":false,"contentTransformations":{"text":["smileys","hashtags","urls","newlines"],"html":["smileys","hashtags","urls","newlines"],"xhtml":["smileys","hashtags","urls"]},"children":{"additionalItemsPerPage":2,"displaySortOrder":"chronological","sortOrder":"chronological","moreButtonSlideTimeout":600,"itemsSlideTimeout":600},"fadeTimeout":2800,"flashColor":"#ffff99","itemControlsOrder":undefined,"itemsPerPage":15,"maxBodyLinkLength":50,"maxBodyCharacters":500,"maxBodyLines":25,"maxReLinkLength":30,"maxReTitleLength":143,"maxTagLength":16,"maxMarkerLength":16,"openLinksInNewWindow":false,"optimizedContext":true,"providerIcon":"http://www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/favicons/comments.png","reTag":true,"slideTimeout":700,"sortOrder":"reverseChronological","streamStateLabel":{"icon":true,"text":true},"submissionProxyURL":window.location.protocol+"//apps.echoenabled.com/v2/esp/activity","streamStateToggleBy":"mouseover","viaLabel":{"icon":false,"text":false}},this.assembleConfigNormalizer());this.initVars();this.initApplication(function(){B.addCss();B.config.get("target").empty().append(B.render());B.recalcEffectsTimeouts();B.initLiveUpdates(function(){return{"endpoint":"search","query":{"q":B.constructSearchQuery(),"since":B.nextSince||0}};},function(D){B.handleLiveUpdatesResponse(D);});if(B.config.get("data")){B.handleInitialResponse(B.config.get("data"),function(D){B.lastRequest={"initial":true,"data":D};B.render("body");});}else{B.initialItemsRequest();}B.listenEvents();B.publish("Stream.onRender",B.prepareBroadcastParams());});};Echo.Stream.prototype=new Echo.Application();Echo.Stream.prototype.namespace="Stream";Echo.Stream.prototype.cssPrefix="echo-stream-";Echo.Stream.prototype.template='<div class="echo-stream-container echo-primaryFont echo-primaryBackgroundColor">'+'<div class="echo-stream-header">'+'<div class="echo-stream-state echo-secondaryColor"></div>'+'<div class="echo-clear"></div>'+"</div>"+'<div class="echo-stream-body"></div>'+'<div class="echo-stream-more"></div>'+'<div class="echo-stream-brand">'+'<a class="echo-stream-brand-link" href="http://aboutecho.com" target="_blank">'+'<div class="echo-stream-brand-message">social networking by</div>'+"</a>"+"</div>"+"</div>";Echo.Stream.prototype.renderers={};Echo.Stream.prototype.renderers.body=function(C){var B=this;C=C||this.dom.get("body");if(!this.lastRequest){this.showMessage({"type":"loading","message":this.label(this.isWaitingForData(this.error)?"error_"+this.error.errorCode:"loading")},C);return ;}if(this.lastRequest.data.length){if(this.lastRequest.initial){C.empty();}this.appendRootItems(this.lastRequest.data,C);}else{this.showMessage({"type":"empty","message":this.label("emptyStream")},C);}if(this.lastRequest.initial&&this.config.get("streamStateToggleBy")=="mouseover"&&this.config.get("liveUpdates")){C.bind({"mouseleave":function(){B.setStreamState("live");},"mouseenter":function(){B.setStreamState("paused");}});}this.publish("Stream.onReady",this.prepareBroadcastParams({"initial":this.lastRequest.initial}));};Echo.Stream.prototype.renderers.state=function(E){var B=this;var C=this.config.get("streamStateLabel");if((!C.icon&&!C.text)||!this.config.get("liveUpdates")){return ;}var G=0;if(this.activities.state=="paused"){G=A.foldl(0,B.activities.queue,function(H,I){if(H.affectCounter){return ++I;}});}var F=this.activities.state+G;if(F==this.activities.lastState){return ;}E=(E||this.dom.get("state")).empty();if(!this.activities.lastState&&this.config.get("streamStateToggleBy")=="button"){E.addClass("echo-linkColor echo-clickable").click(function(H){B.setStreamState(B.activities.state=="paused"?"live":"paused");});}var D={"picture":'<span class="echo-stream-state-picture echo-stream-state-picture-'+this.activities.state+'"></span>',"message":this.config.get("streamStateToggleBy")=="button"?'<a href="javascript:void(0)" class="echo-stream-state-message">{Label:'+this.activities.state+"}</a>":'<span class="echo-stream-state-message">{Label:'+this.activities.state+"}</span>","count":' <span class="echo-stream-state-count">({Data:count} {Label:new})</span>'};if(C.icon){E.append(D.picture);}if(C.text){E.append(this.substitute(D.message));if(G&&this.activities.state=="paused"){E.append(this.substitute(D.count,{"count":G}));}}this.activities.lastState=F;};Echo.Stream.prototype.renderers.more=function(C,D){var B=this;if(this.isViewComplete||!this.threads.length){C.empty().hide();return ;}C.empty().append(this.label("more")).bind({"mouseenter":function(){C.addClass("echo-stream-more-hover");},"mouseleave":function(){C.removeClass("echo-stream-more-hover");}}).show().unbind("click").one("click",function(){B.publish("Stream.onMoreButtonPress",B.prepareBroadcastParams());C.html(B.label("loading"));B.moreRequestItems(C);});};Echo.Stream.prototype.initVars=function(){this.activities={"queue":[],"state":this.config.get("liveUpdates")?"live":"paused","lastState":"","animations":0};this.hasInitialData=false;this.items={};this.threads=[];this.cleanupErrorHandlers();};Echo.Stream.prototype.actualizeChildrenList=function(D,B){var C=this;return A.map(B,function(F){F.targets=A.map(F.targets,function(G){G.conversationID=D.conversation;return G;});F=C.normalizeEntry(F);var E=C.items[F.unique];if(E&&E.byCurrentUser){C.applyStructureUpdates("delete",E);}return F;});};Echo.Stream.prototype.createChildrenItemsDomWrapper=function(C,D){var B=this;var F=A("<div class='echo-item-children-wrapper'></div>");var E=function(G){return B.getItemListIndex(G,D.children);};A.each(C,function(G,H){H.render();var I=G>0&&E(C[G-1])<E(H)?"append":"prepend";F[I](H.dom.content);});return F;};Echo.Stream.prototype.listenEvents=function(){var B=this;this.subscribe("internal.User.onInvalidate",function(){B.refresh();});this.subscribe("internal.Item.onAdd",function(C,D){D.item.dom.content.hide();B.queueActivity({"action":"animation","actorID":D.item.data.actor.id,"itemUnique":D.item.data.unique,"handler":function(){delete D.item.added;B.addItemSpotUpdate(D.item);}});});this.subscribe("internal.Item.onDelete",function(C,D){B.queueActivity({"action":"animation","itemUnique":D.item.data.unique,"actorID":D.item.data.actor.id,"handler":function(){delete D.item.deleted;B.deleteItemSpotUpdate(D.item);}});});this.subscribe("internal.Item.onRender",function(C,D){B.publish("Stream.Item.onRender",B.prepareBroadcastParams({"item":{"data":D.item.data,"target":D.item.dom.content}}));});this.subscribe("internal.Item.onControlClick",function(C,D){var C=B.namespace+".Item.onControlClick";B.publish(C,B.prepareBroadcastParams(D));});this.subscribe("internal.Item.onChildrenExpand",function(D,C){B.childrenRequestItems(C.data.unique);
});A.map(["Submit.onPostComplete","Submit.onEditComplete"],function(C){Echo.Broadcast.subscribe(C,function(){B.startLiveUpdates(true);});});};Echo.Stream.prototype.childrenRequestItems=function(D){var B=this;var C=this.items[D];this.sendAPIRequest({"endpoint":"search","query":{"q":this.constructChildrenSearchQuery(C)}},function(G){var F=C.dom.get("expandChildren");if(G.result=="error"){B.handleErrorResponse(G,{"messageTarget":F,"waitingHandler":function(){B.childrenRequestItems(D);}});if(!B.isWaitingForData(G)){F.removeClass("echo-clickable").delay(3000).slideUp(B.config.get("children.moreButtonSlideTimeout"));}return ;}if(!G.hasMoreChildren||G.hasMoreChildren=="false"){C.data.hasMoreChildren=false;}C.data.nextPageAfter=G.nextPageAfter;G.entries=B.actualizeChildrenList(C,G.entries);B.publish("Stream.onDataReceive",B.prepareBroadcastParams({"entries":G.entries,"initial":false}));var E=[];A.each(G.entries,function(I,J){var H=B.initItem(J);B.applyStructureUpdates("add",H);if(J.parentUnique==C.data.unique){E.push(H);}});B.placeChildrenItems(C,E,G.entries);});};Echo.Stream.prototype.initialItemsRequest=function(){var B=this;this.requestItems({},function(C){B.lastRequest={"initial":true,"data":C};B.render("body");});};Echo.Stream.prototype.moreRequestItems=function(C){var B=this;C=C||this.dom.get("more");this.lastRequest={"initial":false};this.requestItems({"pageAfter":'"'+(B.nextPageAfter||"0")+'"'},function(D){if(D.length){B.lastRequest.data=D;B.render("body");}else{C.html(B.label("emptyStream")).delay(1000).fadeOut(1000);}});};Echo.Stream.prototype.setStreamState=function(B){this.activities.state=B;if(B=="live"){this.executeNextActivity();}this.rerender("state");};Echo.Stream.prototype.refresh=function(){this.stopLiveUpdates();this.initVars();delete this.lastRequest;this.clearCache();this.rerender();this.initialItemsRequest();this.publish("Stream.onRerender",this.prepareBroadcastParams());};Echo.Stream.prototype.extractPresentationConfig=function(B){return A.foldl({},["sortOrder","itemsPerPage","safeHTML"],function(C,D){if(typeof B[C]!="undefined"){D[C]=B[C];}});};Echo.Stream.prototype.extractTimeframeConfig=function(D){var C=function(I){var E=I.match(/^(<|>)(.*)$/);var J=E[1];var G=E[2].match(/^'([0-9]+) seconds ago'$/);var F=G?function(){return Math.floor((new Date()).getTime()/1000)-G[1];}:function(){return E[2];};var H;if(J=="<"){H=function(K){return K<F();};}else{if(J==">"){H=function(K){return K>F();};}}return H;};var B=A.foldl([],["before","after"],function(E,G){if(!D[E]){return ;}var F=C(D[E]);if(F){G.push(F);}});return{"timeframe":B};};Echo.Stream.prototype.assembleConfigNormalizer=function(){var B=this;var E=function(F){return F<0?0:F;};var D={"contentTransformations":function(F){A.each(F,function(H,G){F[H]=A.foldl({},G||[],function(I,J){J[I]=true;});});return F;},"safeHTML":function(F){return"off"!=F;},"streamStateToggleBy":function(F){if(F=="mouseover"&&A.isMobileDevice()){return"button";}return F;},"fadeTimeout":E,"slideTimeout":E};var C={"body":"maxBodyCharacters","lines":"maxBodyLines","reLink":"maxReLinkLength","reTitle":"maxReTitleLength","bodyLink":"maxBodyLinkLength","tags":"maxTagLength","markers":"maxMarkerLength"};A.each(C,function(G,F){D[F]=function(H){this.set("limits."+G,H);return H;};});return D;};Echo.Stream.prototype.getRespectiveAccumulator=function(D,C){var B={"likesDescending":"likesCount","flagsDescending":"flagsCount","repliesDescending":"repliesCount"};return D.getAccumulator(B[C]);};Echo.Stream.prototype.appendRootItems=function(D,B){var C=this;var E=document.createDocumentFragment();A.each(D||[],function(F,G){E.appendChild(G.render().get(0));C.publish("Stream.Item.onRender",C.prepareBroadcastParams({"item":{"data":G.data,"target":G.dom.content}}));});B.append(E);this.rerender("more");};Echo.Stream.prototype.prepareBroadcastParams=function(B){B=B||{};B.target=this.config.get("target").get(0);B.query=this.config.get("query");if(B.item&&B.item.target){B.item.target=B.item.target.get(0);}return B;};Echo.Stream.prototype.constructSearchQuery=function(B){var C=B&&B["pageAfter"]&&"pageAfter:"+B["pageAfter"]||"";return[this.config.get("query",""),C].join(" ");};Echo.Stream.prototype.constructChildrenSearchQuery=function(D){var F=this.config.get("children.maxDepth")-D.depth-1;var E=parseInt(this.config.get("children.additionalItemsPerPage"));var C=D.getNextPageAfter();var B=this.config.get("children.filter");var G=!B||B=="()"?"":B+" ";return G+A.foldl("",{"childrenof":D.data.object.id,"children":F,"childrenItemsPerPage":F?parseInt(this.config.get("children.itemsPerPage")):0,"itemsPerPage":E,"sortOrder":this.config.get("children.sortOrder"),"childrenSortOrder":this.config.get("children.sortOrder"),"pageAfter":C?'"'+(C||0)+'"':undefined},function(J,I,H){return I+=(typeof J!="undefined"?H+":"+J+" ":"");})+G;};Echo.Stream.prototype.requestItems=function(B,D){var C=this;this.sendAPIRequest({"endpoint":"search","query":{"q":this.constructSearchQuery(B)}},function(E){C.handleInitialResponse(E,D);});};Echo.Stream.prototype.handleInitialResponse=function(H,F){var D=this,C=[],B=[];var G=this.lastRequest&&!this.lastRequest.initial;H=H||{};if(H.result=="error"){this.handleErrorResponse(H,{"messageTarget":G?D.dom.get("more"):D.dom.get("body"),"waitingHandler":function(){if(G){D.moreRequestItems();}else{D.refresh();}}});return ;}this.cleanupErrorHandlers(true);this.config.get("target").show();this.changeLiveUpdatesTimeout(H);this.nextSince=H.nextSince||0;this.nextPageAfter=H.nextPageAfter;this.config.extend(this.extractPresentationConfig(H));H.children.itemsPerPage=+H.children.itemsPerPage;this.config.combine(H.children,this.config.get("children"));this.config.extend(this.extractTimeframeConfig(H));var E=this.config.get("sortOrder");H.entries=H.entries||[];this.publish("Stream.onDataReceive",D.prepareBroadcastParams({"entries":H.entries,"initial":!this.hasInitialData}));A.each(H.entries,function(I,K){K=D.normalizeEntry(K);var J=D.initItem(K);D.applyStructureUpdates("add",J);if(D.isRootItem(J)){D.addItemToList(B,J,E);}});this.hasInitialData=true;this.isViewComplete=B.length!=this.config.get("itemsPerPage");F(B);this.startLiveUpdates();};Echo.Stream.prototype.checkTimeframeSatisfy=function(){var C=this;var B=this.config.get("timeframe");var D=A.foldl([],this.threads,function(E,G){var F=A.foldl(true,B,function(I,H){return H?I(E.timestamp):false;});if(!F){G.push(E);}});A.map(D,function(E){C.applySpotUpdates("delete",E);});};Echo.Stream.prototype.handleLiveUpdatesResponse=function(C){var B=this;C=C||{};if(C.result=="error"){this.startLiveUpdates();return ;}this.nextSince=C.nextSince||0;this.refreshItemsDate();this.checkTimeframeSatisfy();this.applyLiveUpdates(C.entries);this.render("state");this.executeNextActivity();this.startLiveUpdates();};Echo.Stream.prototype.applyLiveUpdates=function(B){var C=this;A.each(B||[],function(D,G){G=C.normalizeEntry(G);var F=C.items[G.unique];var H=C.classifyAction(G);if(!F&&H!="post"){return ;}switch(H){case"post":if(F){C.applySpotUpdates("replace",C.updateItem(G));}else{F=C.initItem(G,true);var E=C.isRootItem(F)?C.withinVisibleFrame(F):C.withinVisibleChildrenFrame(F);if(!E&&!C.isRootItem(F)&&C.user.hasIdentity(F.data.actor.id)){F.byCurrentUser=true;}if(E||F.byCurrentUser){C.publish("Stream.Item.onReceive",C.prepareBroadcastParams({"item":{"data":F.data}}));C.applySpotUpdates("add",F);}else{delete C.items[G.unique];}}break;case"delete":C.applySpotUpdates("delete",F);break;}});this.recalcEffectsTimeouts();};Echo.Stream.prototype.recalcEffectsTimeouts=function(){var D=this;var F={"fade":D.config.get("fadeTimeout"),"slide":D.config.get("slideTimeout")};D.timeouts=D.timeouts||{"fade":F.fade,"slide":F.slide};if(F.fade==0&&F.slide==0){return ;}D.timeouts.coeff=D.timeouts.coeff||{"fade":D.timeouts.fade/(F.fade+F.slide),"slide":D.timeouts.slide/(F.fade+F.slide)};var B=function(H,G){G=Math.round(G*D.timeouts.coeff[H]);if(G<100){return 0;}if(G>F[H]){return F[H];}return G;};var E=D.config.get("liveUpdatesTimeout")*1000*0.8;
var C=D.activities.queue.length?E/D.activities.queue.length:E;D.timeouts.fade=B("fade",C);D.timeouts.slide=B("slide",C);};Echo.Stream.prototype.refreshItemsDate=function(){A.map(this.threads,function(B){B.refreshDate();});};Echo.Stream.prototype.executeNextActivity=function(){var B=this.activities;if(B.animations>0||!B.queue.length||this.config.get("liveUpdates")&&B.state=="paused"&&B.queue[0].action!="replace"&&!B.queue[0].byCurrentUser){return ;}B.queue.shift().handler();};Echo.Stream.prototype.applySpotUpdates=function(F,E,C){var B=this;C=C||{};var D=function(I){switch(I){case"add":B.applyStructureUpdates(I,E);E.added=true;if(B.isRootItem(E)){B.placeRootItem(E);}else{var M=B.getParentItem(E);if(M&&M.dom){M.rerender(["container","children","childrenByCurrentActorLive"]);}}B.executeNextActivity();break;case"replace":E.unblock();if(B.maybeMoveItem(E)){var M=B.getParentItem(E);var K=B.config.get(M?"children.sortOrder":"sortOrder");var H=M?M.children:B.threads;var J=B.getItemListIndex(E,H);var G=A.extend([],H);G.splice(J,1);var L=B.getItemProjectedIndex(E,G,K);if(J!=L){B.applySpotUpdates("delete",E,{"keepChildren":true});B.applySpotUpdates("add",E);}}if(E&&E.dom){E.rerender("container",true);}B.executeNextActivity();break;case"delete":E.deleted=true;if(B.isRootItem(E)){B.publish("internal.Item.onDelete",{"item":E});B.applyStructureUpdates(I,E,C);}else{var M=B.getParentItem(E);if(M){M.rerender(["children","childrenByCurrentActorLive"]);B.applyStructureUpdates(I,E,C);M.rerender("container");}}B.executeNextActivity();break;}};this.queueActivity({"action":F,"itemUnique":E.data.unique,"actorID":E.data.actor.id,"handler":function(){D(F);}});};Echo.Stream.prototype.queueActivity=function(F){var C=this.items[F.itemUnique];if(!C){return ;}var B=C.blocked||F.actorID&&this.user.hasIdentity(F.actorID);var E=this.getActivityDependency(A.extend(F,{"byCurrentUser":B}));var D={"action":F.action,"type":F.type||"","affectCounter":F.action=="add","itemUnique":F.itemUnique,"byCurrentUser":B,"handler":function(){F.handler();}};if(E.dependent||typeof E.index=="undefined"){this.activities.queue.push(D);}else{this.activities.queue.splice(E.index,0,D);}};Echo.Stream.prototype.getActivityDependency=function(D){var B;var C=D.action!="replace"&&D.action!="animation";A.each(this.activities.queue,function(E,F){if(C){if(typeof B=="undefined"&&D.byCurrentUser&&!F.byCurrentUser){C=false;B=E;return false;}}else{if(typeof B=="undefined"&&(D.action=="replace"&&F.action!="replace"||D.action=="animation"&&F.action!="animation"||D.byCurrentUser&&!F.byCurrentUser)){B=E;}if(D.action=="replace"&&F.action=="add"&&F.itemUnique==D.itemUnique){C=true;return false;}}});return{"dependent":C,"index":B};};Echo.Stream.prototype.addItemSpotUpdate=function(F){var D=this;this.activities.animations++;if(this.timeouts.slide){var G=F.dom.content.show().css("height");F.dom.content.css("height",G).hide().animate({"height":"show","marginTop":"show","marginBottom":"show","paddingTop":"show","paddingBottom":"show"},this.timeouts.slide,function(){if(!F.dom||!F.dom.content){return ;}F.dom.content.css("height","");});}else{F.dom.content.show();}var E=function(){if(!F.dom||!F.dom.content){return ;}D.publish("Stream.Item.onRender",D.prepareBroadcastParams({"item":{"data":F.data,"target":F.dom.content}}));};if(this.timeouts.fade){var B=F.dom.get("container");var C=A.getVisibleColor(B);B.delay(this.timeouts.slide).css({"backgroundColor":this.config.get("flashColor")}).animate({"backgroundColor":C},this.timeouts.fade,"linear",function(){B.css("backgroundColor","");E();D.activities.animations--;D.executeNextActivity();});}else{E();this.activities.animations--;this.executeNextActivity();}};Echo.Stream.prototype.deleteItemSpotUpdate=function(C,D){var B=this;this.activities.animations++;D=D||function(){if(!C.dom||!C.dom.content){return ;}C.children?C.dom.content.detach():C.dom.remove("content");delete C.dom;C.vars={};var E=A.foldl(0,B.items,function(F,G){return G+1;});if(!E){B.showMessage({"type":"empty","message":B.label("emptyStream")},B.dom.get("body"));}B.activities.animations--;B.executeNextActivity();};if(this.timeouts.slide){C.dom.content.slideUp(this.timeouts.slide,D);}else{D();}};Echo.Stream.prototype.classifyAction=function(B){return(B.verbs[0]=="http://activitystrea.ms/schema/1.0/delete")?"delete":"post";};Echo.Stream.prototype.isRootItem=function(B){return !this.config.get("children.maxDepth")||B.id==B.conversation;};Echo.Stream.prototype.hasParentItem=function(B){return !!this.getParentItem(B);};Echo.Stream.prototype.maybeMoveItem=function(B){return B.forceInject;};Echo.Stream.prototype.withinVisibleFrame=function(F,C,B,D){C=C||this.threads;B=typeof B=="undefined"?this.isViewComplete:B;D=D||this.config.get("sortOrder");var E=C.length?C[C.length-1]:undefined;if(B||E==undefined){return true;}return this.compareItems(E,F,D);};Echo.Stream.prototype.withinVisibleChildrenFrame=function(C){var B=this.getParentItem(C);if(!this.isChildrenPaginationEnabled()||!B){return this.hasParentItem(C);}return this.withinVisibleFrame(C,B.children,!B.hasMoreChildren(),this.config.get("children.sortOrder"));};Echo.Stream.prototype.getParentItem=function(B){return this.isRootItem(B)?undefined:this.items[B.data.parentUnique];};Echo.Stream.prototype.compareItems=function(D,B,F){var E=this;switch(F){case"chronological":return D.timestamp>B.timestamp;case"reverseChronological":return D.timestamp<=B.timestamp;case"likesDescending":case"repliesDescending":case"flagsDescending":var C=function(G){return E.getRespectiveAccumulator(G,F);};return(C(D)<C(B)||(C(D)==C(B)&&this.compareItems(D,B,"reverseChronological")));}};Echo.Stream.prototype.placeRootItem=function(E){var D=E.render();if(this.threads.length>1){var F=this.getItemListIndex(E,this.threads);var B=this.threads[F+1],C=this.threads[F-1];if(B){B.dom.content.before(D);}else{C.dom.content.after(D);}}else{this.dom.get("body").empty().append(D);}this.publish("internal.Item.onAdd",{"item":E});};Echo.Stream.prototype.placeChildrenItems=function(G,E,C){var D=this;var B=this.createChildrenItemsDomWrapper(E,G);var I=-1;A.each(G.children,function(K,J){if(D.isItemInList(J.data,C)){I=K-1;return false;}});var F=I>=0?G.children[I].dom.content:G.dom.get("children");var H=I>=0?"insertAfter":this.config.get("children.sortOrder")!="chronological"?"prependTo":"appendTo";B[H](A(F));G.rerender("childrenByCurrentActorLive");B.css("height",B.show().css("height")).hide().animate({"height":"show","marginTop":"show","marginBottom":"show","paddingTop":"show","paddingBottom":"show"},{"duration":this.config.get("children.itemsSlideTimeout"),"complete":function(){B.css("height","");G.rerender(["expandChildren","expandChildrenLabel"]);B.children().unwrap();}});};Echo.Stream.prototype.getItemListIndex=function(D,C){var B=-1;A.each(C||[],function(E,F){if(F==D||(F.unique&&D.unique&&F.unique==D.unique)){B=E;return false;}});return B;};Echo.Stream.prototype.isItemInList=function(C,B){return this.getItemListIndex(C,B)>=0;};Echo.Stream.prototype.isChildrenPaginationEnabled=function(){return !!this.config.get("children.itemsPerPage");};Echo.Stream.prototype.initItem=function(E,F){var B=this;var D=new Echo.Item({"children":[],"config":new Echo.Config(this.config.getAsHash()),"conversation":E.target.conversationID,"data":E,"depth":0,"id":E.object.id,"live":F,"threading":false,"timestamp":A.timestampFromW3CDTF(E.object.published),"user":this.user});var C=D.template;D.template=function(){if(!B.vars.cache.itemTemplate){B.vars.cache.itemTemplate=A.isFunction(C)?C.apply(this,arguments):C;}return B.vars.cache.itemTemplate;};this.items[D.data.unique]=D;return D;};Echo.Stream.prototype.updateItem=function(E){var D=this.items[E.unique];var B=this.config.get(this.isRootItem(D)?"sortOrder":"children.sortOrder");var C=B.match(/replies|likes|flags/);var F=C&&this.getRespectiveAccumulator(D,B);if(D.data.object.published!=E.object.published){D.timestamp=A.timestampFromW3CDTF(E.object.published);D.forceInject=true;}A.extend(D.data,E);if(C){if(this.getRespectiveAccumulator(D,B)!=F){D.forceInject=true;
}}return D;};Echo.Stream.prototype.getItemProjectedIndex=function(F,C,E){var B=this;var D;if(F.live||F.forceInject){A.each(C||[],function(G,H){if(B.compareItems(H,F,E)){D=G;return false;}});}return typeof D!="undefined"?D:C.length;};Echo.Stream.prototype.addItemToList=function(B,D,C){B.splice(this.getItemProjectedIndex(D,B,C),0,D);delete D.forceInject;this.items[D.data.unique]=D;};Echo.Stream.prototype.applyStructureUpdates=function(G,F,D){var C=this;D=D||{};switch(G){case"add":if(!this.isRootItem(F)){var E=this.getParentItem(F);if(!E){delete this.items[F.data.unique];return ;}F.depth=E.depth+1;if(!this.isChildrenPaginationEnabled()&&F.depth>1){F.depth=1;F.data.parentUnique=E.data.parentUnique;F.data.target.id=E.data.target.id;F.forceInject=true;this.applyStructureUpdates("add",F);return ;}E.threading=true;F.forceInject=true;this.addItemToList(E.children,F,this.isChildrenPaginationEnabled()?this.config.get("children.displaySortOrder"):this.config.get("children.sortOrder"));}else{this.addItemToList(this.threads,F,this.config.get("sortOrder"));}break;case"delete":var B=null;if(this.isRootItem(F)){B=this.threads;}else{B=this.items[F.data.parentUnique].children;if(B.length==1){var E=this.getParentItem(F);if(E){E.threading=false;}}}B.splice(this.getItemListIndex(F,B),1);if(!D.keepChildren){F.traverse(F.children,function(H){delete C.items[H.data.unique];});delete F.children;}delete this.items[F.data.unique];break;}};Echo.Stream.prototype.normalizeEntry=function(C){if(C.normalized){return C;}var B=this;C.normalized=true;A.each(C.targets||[],function(D,E){if((E.id==E.conversationID)||(E.id==C.object.id)||(B.items[E.id+E.conversationID])){C.target=E;}});C.object.content_type=C.object.content_type||"text";C.object.accumulators=C.object.accumulators||{};C.object.accumulators.repliesCount=parseInt(C.object.accumulators.repliesCount||"0");C.object.accumulators.flagsCount=parseInt(C.object.accumulators.flagsCount||"0");C.object.accumulators.likesCount=parseInt(C.object.accumulators.likesCount||"0");C.object.context=C.object.context||[];C.object.flags=C.object.flags||[];C.object.likes=C.object.likes||[];C.target=C.target||C.targets[0]||{};C.target.conversationID=C.target.conversationID||C.object.id;C.source=C.source||{};C.provider=C.provider||{};C.unique=C.object.id+C.target.conversationID;C.parentUnique=C.target.id+C.target.conversationID;return C;};Echo.Stream.prototype.addCss=function(){var C=this;A.addCss(".echo-stream-message-wrapper { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }"+".echo-stream-message-empty, .echo-stream-message-loading, .echo-stream-message-error { display: inline-block; height: 16px; padding-left: 21px; background: no-repeat left center; }"+".echo-stream-message-empty { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/information.png); }"+".echo-stream-message-loading { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/loading.gif); }"+".echo-stream-message-error { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/warning.gif); }"+".echo-stream-header { margin: 10px 0px 10px 20px; }"+".echo-stream-state { float: right; }"+".echo-stream-state-picture { display: inline-block; height: 9px; width: 8px; }"+'.echo-stream-state-picture-paused { background: url("//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/control_pause.png") no-repeat center center; }'+'.echo-stream-state-picture-live { background: url("//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/control_play.png") no-repeat center center; }'+".echo-stream-state-message { margin-left: 5px; text-decoration: none; }"+".echo-clickable a.echo-stream-state-message:hover { text-decoration: underline; }"+".echo-stream-brand { text-align: right; display: none; }"+".echo-stream-brand-message { display: inline-block; height: 17px; line-height: 17px; border: none; padding-right: 48px; background: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/echo-brand.png) no-repeat right; font-size: 10px; font-family: Arial; }"+".echo-stream-container a.echo-stream-brand-link { text-decoration: none; color: #666666; } "+".echo-stream-more-hover { background-color: #E4E4E4; }"+".echo-stream-more { text-align: center; border: solid 1px #E4E4E4; margin-top: 10px; padding: 10px; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; cursor: pointer; font-weight: bold; }"+".echo-stream-more .echo-application-message { padding: 0; border: none; border-radius: 0; }","stream");A.addCss(".echo-item-content { word-wrap: break-word; }"+".echo-item-container-root { padding: 10px 0px; }"+".echo-item-container-root-thread { padding: 10px 0px 0px 0px; }"+".echo-item-container-child { padding: 10px; margin: 0px 20px 2px 0px; }"+".echo-item-container-child-thread { padding: 10px; margin: 0px 20px 2px 0px; }"+".echo-item-avatar-wrapper { margin-right: -58px; float: left; position: relative; }"+".echo-item-children .echo-item-avatar-wrapper, .echo-item-childrenByCurrentActorLive .echo-item-avatar-wrapper { margin-right: -34px; }"+".echo-item-children .echo-item-subwrapper, .echo-item-childrenByCurrentActorLive .echo-item-subwrapper { margin-left: 34px; }"+".echo-item-wrapper { float: left; width: 100%; }"+".echo-item-subwrapper { margin-left: 58px; }"+".echo-item-subcontainer { float: left; width: 100%; }"+".echo-item-markers { line-height: 16px; background: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/curation/metadata/marker.png) no-repeat; padding: 0px 0px 4px 21px; margin-top: 7px; }"+".echo-item-tags { line-height: 16px; background: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/tag_blue.png) no-repeat; padding: 0px 0px 4px 21px; }"+".echo-item-metadata { display: none; }"+".echo-item-metadata-title { font-weight: bold; line-height: 25px; height: 25px; margin-right: 5px; }"+".echo-item-metadata-icon { display: inline-block; padding-left: 26px; }"+"div.echo-item-metadata-userID { border-bottom: 1px solid #e1e1e1; border-top: 1px solid #e1e1e1;}"+'span.echo-item-metadata-userID { background: url("//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/curation/metadata/user.png") no-repeat left center; }'+'.echo-item-modeSwitch { float: right; width: 16px; height: 16px; background:url("//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/curation/metadata/flip.png") no-repeat 0px 3px; }'+".echo-item-childrenMarker { border-color: transparent transparent #ECEFF5; border-width: 0px 11px 11px; border-style: solid; margin: 3px 0px 0px 77px; height: 1px; width: 0px; display: none; }"+".echo-item-container-root-thread .echo-item-childrenMarker { display: block; }"+".echo-item-avatar { width: 48px; height: 48px; }"+".echo-item-children .echo-item-avatar, .echo-item-childrenByCurrentActorLive .echo-item-avatar { width: 24px; height: 24px; }"+".echo-item-authorName { float: left; font-size: 15px; font-family: Arial, sans-serif; font-weight: bold; }"+".echo-item-re { font-weight: bold; }"+".echo-item-re a:link, .echo-item-re a:visited, .echo-item-re a:active { text-decoration: none; }"+".echo-item-re a:hover { text-decoration: underline; }"+".echo-item-body { padding-top: 4px; }"+".echo-item-controls { float: left; margin-left: 3px; }"+".echo-item-sourceIcon { float: left; height: 16px; width: 16px; margin-right: 5px; border: 0px; }"+".echo-item-date, .echo-item-from, .echo-item-via { float: left; }"+".echo-item-from a, .echo-item-via a { text-decoration: none; color: #C6C6C6; }"+".echo-item-from a:hover, .echo-item-via a:hover { color: #476CB8; }"+'.echo-item-tag { display: inline-block; height: 16px; background: url("//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/tag_blue.png") no-repeat; padding-left: 18px; }'+".echo-item-textToggleTruncated { margin-left: 5px; }"+".echo-item-blocker-backdrop { position: absolute; left: 0px; top: 0px; background: #FFFFFF; opacity: 0.7; z-index: 100; }"+".echo-item-blocker-message { position: absolute; z-index: 200; width: 200px; height: 20px; line-height: 20px; text-align: center; background-color: #FFFF99; border: 1px solid #C6C677; opacity: 0.7; -moz-border-radius: 0.5em 0.5em 0.5em 0.5em; }"+".echo-item-expandChildren { display:none; text-align: center; padding:4px; }"+".echo-item-expandChildren .echo-item-expandChildrenLabel { display: inline-block; padding-left: 22px; }"+'.echo-item-expandChildren .echo-message-icon { background: url("//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/whirlpool.png") no-repeat 5px 4px; }'+".echo-item-expandChildren .echo-item-message-loading { background: no-repeat left top url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/loading.gif); }"+".echo-item-expandChildren .echo-application-message { padding: 0; border:none; border-radius: 0; }","item");
var B=[];for(var D=0;D<=20;D++){B.push(".echo-item-depth-"+D+" { margin-left: "+(D?68+(D-1)*44:0)+"px; }");}A.addCss(B.join("\n"),"item-depths");if(A.browser.msie){A.addCss(".echo-item-childrenMarker { font-size: 1px; line-height: 1px; filter: chroma(color=black); }"+".echo-item-blocker-backdrop, .echo-item-blocker-message { filter:Alpha(Opacity=70); }"+".echo-stream-container { zoom: 1; }"+".echo-item-content { zoom: 1; }"+".echo-item-container { zoom: 1; }"+".echo-item-subwrapper { zoom: 1; }"+".echo-item-avatar-wrapper { position: static; }"+".echo-stream-state-picture { vertical-align: middle; }","stream-ie");}};})(jQuery);(function(A){if(typeof (A._$)!="undefined"){A.noConflict();}if(!window.Echo){window.Echo={};}if(!Echo.Global){Echo.Global={};}if(!Echo.Vars){Echo.Vars={"regexps":{"matchLabel":/{Label:([^:}]+[^}]*)}/g,"matchData":/{Data:(([a-z]+\.)*[a-z]+)}/ig,"mobileUA":/mobile|midp-|opera mini|iphone|ipad|blackberry|nokia|samsung|docomo|symbian|windows ce|windows phone|android|up\.browser|ipod|netfront|skyfire|palm|webos|audiovox/i,"parseUrl":/^((([^:\/\?#]+):)?\/\/)?([^\/\?#]*)?([^\?#]*)(\?([^#]*))?(#(.*))?/,"w3cdtf":/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z$/}};}A.extend({"addCss":function(D,F){Echo.Vars.css=Echo.Vars.css||{"index":1,"processed":{}};if(F){if(Echo.Vars.css.processed[F]){return ;}Echo.Vars.css.processed[F]=true;}var C="";var B=Echo.Vars.css.anchor;if(B&&B.length){C=B.html();}if(C.length+D.length>100000){Echo.Vars.css.index++;B=null;C="";}var E=A('<style id="echo-css-'+Echo.Vars.css.index+'" type="text/css">'+C+D+"</style>");if(B&&B.length){B.replaceWith(E);}else{if(Echo.Vars.css.anchor){Echo.Vars.css.anchor.after(E);}else{A(document.getElementsByTagName("head")[0]||document.documentElement).prepend(E);}}Echo.Vars.css.anchor=E;},"foldl":function(C,B,D){A.each(B,function(E,F){result=D(F,C,E);if(result!==undefined){C=result;}});return C;},"intersperse":function(B,C){return A.foldl([],B,function(E,F,D){if(F.length){F.push(C);}F.push(E);});},"getNestedValue":function(B,F,G,H){if(typeof B=="string"){B=B.split(/\./);}if(!B.length){return F;}var E=true;var C=function(J,I){if(H){H(I,J);}if(typeof I[J]=="undefined"){E=false;}else{return I[J];}};var D=B.length==1?C(B.pop(),F):A.foldl(F,B,C);return E?D:G;},"setNestedValue":function(G,B,E){var C=B.split(/\./);var F=C.pop();var D=A.getNestedValue(C,G,undefined,function(I,H){if(typeof I[H]=="undefined"){I[H]={};}});D[F]=E;},"htmlize":function(B){if(!B){return"";}return A("<div>").text(B).html();},"object2JSON":function(F){var D=function(G){var H={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return G.replace(/[\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff\\]/g,function(I){return(H.hasOwnProperty(I))?H[I]:"\\u"+("0000"+I.charCodeAt(0).toString(16)).slice(-4);});};var C;switch(typeof F){case"number":C=isFinite(F)?F:"null";break;case"string":C='"'+D(F)+'"';break;case"boolean":C='"'+F.toString()+'"';break;default:if(F instanceof Array){var B=A.map(F,function(G){return A.object2JSON(G);});C="["+B.join(",")+"]";}else{if(F instanceof Object){var E=F.exportProperties||F;var B=A.foldl([],E,function(I,H,G){if(E instanceof Array){G=I;I=F[G];}H.push('"'+G+'":'+A.object2JSON(I));});C="{"+B.join(",")+"}";}else{C="null";}}}return C;},"htmlTextTruncate":function(N,E,M,G){if(!E||N.length<E){return N;}var P=[],I=0,H=0;var L="br hr input img area param base link meta option".split(" ");var C=A.foldl({},L,function(S,R,Q){R[S]=true;});for(var F=0;F<N.length;F++){var D=N.charAt(F);if(D=="<"){var K=N.indexOf(">",F);if(K<0){return N;}var B=N.substring(F+1,K);var O={"name":"","closing":false};if(B.charAt(0)=="/"){O.closing=true;B=B.substring(1);}O.name=B.match(/(\w)+/)[0];if(O.closing){var J=P.pop();if(!J||J.name!=O.name){return N;}}else{if(!C[O.name]){P.push(O);}}F=K;}else{if(D=="&"&&N.substring(F).match(/^(\S)+;/)){F=N.indexOf(";",F);}else{if(I==E){H=F;break;}I++;}}}if(H||G){if(H){N=N.substring(0,H)+(M||"");}for(var F=P.length-1;F>=0;F--){N+="</"+P[F].name+">";}}return N;},"mapClass2Object":function(C,B){B=B||{};C.find("*").andSelf().each(function(E,F){if(F.className){var D=F.className.split(/[ ]+/);A.each(D,function(G,H){B[H]=F;});}});return B;},"stripTags":function(B){return A("<div>").html(B).text();},"parseUrl":function(B){var C=B.match(Echo.Vars.regexps.parseUrl);return C?{"scheme":C[3],"domain":C[4],"path":C[5],"query":C[7],"fragment":C[9]}:undefined;},"toDOM":function(C,G,F){var D=A(C);var E=A.mapClass2Object(D);var H={"set":function(I,J){E[G+I]=J;},"get":function(I,K){var J=E[(K?"":G)+I];return J&&A(J);},"remove":function(J){var I;if(typeof J=="string"){I=G+J;}else{I=J.echo.name;}A(E[I]).remove();delete E[I];},"content":D};var B;if(typeof F=="object"){B=function(I,J,K){if(!F[I]){return ;}return F[I](J,K);};}else{B=F;}A.each(E,function(M,J){var L=M.match(G+"(.*)");var I=L?L[1]:undefined;if(I&&B){J=A(J);J.echo=J.echo||{};J.echo.name=M;var K=B(I,J,H);if(typeof K!="undefined"){J.empty().append(K);}}});return H;},"loadScriptContent":function(D,F){Echo.Vars.scriptState=Echo.Vars.scriptState||{};if(Echo.Vars.scriptState[D]=="loaded"){F();return ;}var E=Echo.Broadcast.subscribe("internal.scriptLoaded",function(G,H){if(D!=H){return ;}Echo.Broadcast.unsubscribe("internal.scriptLoaded",E);F();});if(Echo.Vars.scriptState[D]=="loading"){return ;}Echo.Vars.scriptState[D]="loading";var C=document.createElement("script");C.type="text/javascript";C.charset="utf-8";C.src=D;var B=document.getElementsByTagName("head")[0]||document.documentElement;B.insertBefore(C,B.firstChild);C.onload=C.onreadystatechange=function(){var G=C.readyState;if(!G||G=="loaded"||G=="complete"){Echo.Vars.scriptState[D]="loaded";Echo.Broadcast.publish("internal.scriptLoaded",D);C.onload=C.onreadystatechange=null;}};},"sendPostRequest":function(C,E,G){var F="echo-post-"+Math.random();var B=A("#echo-post-request").length?A("#echo-post-request").empty():A('<div id="echo-post-request"/>').css({"height":0}).prependTo("body");A('<iframe id="'+F+'" name="'+F+'" width="0" height="0" frameborder="0" border="0"></iframe>').appendTo(B);var D=A("<form/>",{"target":F,"method":"POST","enctype":"application/x-www-form-urlencoded","acceptCharset":"UTF-8","action":C}).appendTo(B);A.each(E,function(H,I){A("<input/>",{"type":"hidden","name":H,"value":I}).appendTo(D);});D.submit();G();},"getVisibleColor":function(C){var B;do{B=C.css("backgroundColor");if(B!=""&&B!="transparent"&&!/rgba\(0, 0, 0, 0\)/.test(B)||A.nodeName(C.get(0),"body")){break;}}while(C=C.parent());return B||"transparent";},"timestampFromW3CDTF":function(B){var E=["year","month","day","hours","minutes","seconds"];var C={};var D=B.match(Echo.Vars.regexps.w3cdtf);A.each(E,function(F,G){C[G]=D[F+1];});return Date.UTC(C["year"],C["month"]-1,C["day"],C["hours"],C["minutes"],C["seconds"])/1000;},"isMobileDevice":function(){return Echo.Vars.regexps.mobileUA.test(navigator.userAgent);}});if(!Echo.Plugins){Echo.Plugins={};}Echo.isExtended=function(B,D,C){if(!B){return false;}C=C||true;var E=[B].concat(D).join(".");Echo.Vars.extensions=Echo.Vars.extensions||{};if(Echo.Vars.extensions[E]==C){return true;}Echo.Vars.extensions[E]=C;return false;};Echo.extendRenderer=function(B,F,D,C){if(!B||!Echo[B]||!F||!D||!A.isFunction(D)||Echo.isExtended(C,[B,"renderer",F])){return ;}var E=Echo[B].prototype.renderers[F]||function(){};Echo[B].prototype.renderers[F]=function(){var H=C&&this.config.get("plugins."+C);if(!H||!H.enabled){return E.apply(this,arguments);}var G=this;if(!this.parentRenderer){this.parentRenderer=function(J,I){return G.parentRenderers[J].apply(G,I);};}this.parentRenderers=this.parentRenderers||{};this.parentRenderers[F]=E;return D.apply(this,arguments);};};Echo.extendTemplate=function(C,E,I,B,H){if(!C||!Echo[C]||!I||!B||!E||Echo.isExtended(H,[C,"template",B,I],E)){return ;}var G=Echo[C].prototype.template;var F=A.isFunction(G)?G:function(){return G;};var D={"insertBefore":"before","insertAfter":"after","insertAsFirstChild":"prepend","insertAsLastChild":"append","replace":"replaceWith"};
Echo[C].prototype.template=function(){var J=H&&this.config.get("plugins."+H);if(!J||!J.enabled){return F.call(this);}var K=A("<div/>").html(F.call(this));A("."+B,K)[D[I]](E);return K.html();};};Echo.include=function(B,D){if(!B.length){return D();}var C=B.pop();Echo.include(B,function(){if(typeof C.loaded=="undefined"){if(C.application){C.loaded=function(){return !!Echo[C.application];};}else{D();}}if(A.isFunction(C.loaded)&&!C.loaded()){A.loadScriptContent(C.url,D);}else{D();}});};Echo.createPlugin=function(C){if(!C||!C.name||!C.init||!C.applications){return{};}var B=C.name;var E=function(){var F=function(G){return"plugins."+B+(G?"."+G:"");};F.get=function(G,H,I,J){return G.config.get(F(H),J?G.config.get(H,I):I);};F.set=function(G,H,I){G.config.set(F(H),I);};F.remove=function(G,H){G.config.remove(F(H));};return F;};var D=C.init||function(){};Echo.Plugins[B]=Echo.Plugins[B]||A.extend(C,{"init":function(H,G){var F=H.config.get(G,"enabled");if(typeof F=="undefined"){H.config.set(G,"enabled",true);}D(H,G);},"set":function(F,G,H){F.vars=F.vars||{};F.vars[B]=F.vars[B]||{};A.setNestedValue(F.vars[B],G,H);},"get":function(F,G){var H=(F.vars||{})[B]||{};if(!G){return H;}return A.getNestedValue(G,H);},"addCss":function(F){A.addCss(F,"plugins-"+B);},"label":function(F,G){return Echo.Localization.label(F,"Plugins."+B,G);},"addLabels":function(F){Echo.Localization.extend(F,"Plugins."+B);},"topic":function(H,G){var F=typeof H=="string"?H:H.namespace;return F+".Plugins."+B+"."+G;},"config":E(),"subscribe":function(H,G,I){var F=this;return H.subscribe(G,function(){if(!H.isPluginEnabled(F.name)){return ;}I.apply(this,arguments);});},"publish":function(G,F,H){G.publish(F,H);},"unsubscribe":function(G,F,H){G.unsubscribe(F,H);},"extendRenderer":function(F,H,G){Echo.extendRenderer(F,H,G,B);},"extendTemplate":function(G,H,I,F){Echo.extendTemplate(G,H,I,F,B);},"addItemControl":function(G,H){var F=G.config.get("itemControls."+B,[]);G.config.set("itemControls."+B,F.concat(H));},"assembleConfig":function(F,G){G.user=F.user;G.appkey=F.config.get("appkey","");G.plugins=this.config.get(F,"nestedPlugins",[]);G.contextId=F.config.get("contextId");G.apiBaseURL=F.config.get("apiBaseURL");return(new Echo.Config(G,this.config.get(F))).getAsHash();}});return Echo.Plugins[B];};if(!Echo.Broadcast){Echo.Broadcast={};}Echo.Broadcast.initContext=function(C,B){B=B||"empty";Echo.Vars.subscriptions=Echo.Vars.subscriptions||{};Echo.Vars.subscriptions[B]=Echo.Vars.subscriptions[B]||{};Echo.Vars.subscriptions[B][C]=Echo.Vars.subscriptions[B][C]||{};return B;};Echo.Broadcast.subscribe=function(C,D,B){var E=(new Date()).valueOf()+Math.random();B=Echo.Broadcast.initContext(C,B);Echo.Vars.subscriptions[B][C][E]=D;return E;};Echo.Broadcast.unsubscribe=function(C,D,B){B=Echo.Broadcast.initContext(C,B);if(C&&D){delete Echo.Vars.subscriptions[B][C][D];}else{if(C){delete Echo.Vars.subscriptions[B][C];}}};Echo.Broadcast.publish=function(C,D,B){B=Echo.Broadcast.initContext(C,B);if(B=="*"){A.each(Echo.Vars.subscriptions,function(E){A.each(Echo.Vars.subscriptions[E][C]||{},function(G,F){F.apply(this,[C,D]);});});}else{if(Echo.Vars.subscriptions[B][C]){A.each(Echo.Vars.subscriptions[B][C],function(F,E){E.apply(this,[C,D]);});}if(B!="empty"){Echo.Broadcast.publish(C,D,"empty");}}};if(!Echo.Object){Echo.Object=function(){};}Echo.Object.prototype.init=function(B){A.extend(this,B||{});};Echo.Object.prototype.template="";Echo.Object.prototype.namespace="";Echo.Object.prototype.cssPrefix="echo-";Echo.Object.prototype.substitute=function(C,D){var B=this;C=C.replace(Echo.Vars.regexps.matchLabel,function(F,E){return B.label(E);});C=C.replace(Echo.Vars.regexps.matchData,function(F,E){return A.getNestedValue(E,D,"");});return C;};Echo.Object.prototype.renderers={};Echo.Object.prototype.label=function(C,D){var B=Echo.Localization.label(C,this.namespace,D);return B!=C?B:Echo.Localization.label(C,"",D);};Echo.Object.prototype.render=function(D,E,G,B){var C=this;if(D){if(A.isFunction(this.renderers[D])){return this.renderers[D].call(this,E,G,B);}}else{var F=A.isFunction(this.template)?this.template():this.template;this.dom=A.toDOM(this.substitute(F,this.data||{}),this.cssPrefix,function(){return C.render.apply(C,arguments);});return this.dom.content;}};Echo.Object.prototype.rerender=function(B,D){var J=this;if(!B){if(this.dom){this.dom.content.replaceWith(this.render());}return ;}if(!this.dom){return ;}if(typeof B!="string"){A.map(B,function(K){J.rerender(K,D);});return ;}else{if(!this.dom.get(B)){return ;}}if(D){var I=A.isFunction(this.template)?this.template():this.template;var G=this.substitute(I,this.data||{});var E=this.dom.get(B);var H=A("."+this.cssPrefix+B,A(G));H=A.toDOM(H,this.cssPrefix,function(K,L,M){J.dom.set(K,L);return J.render.apply(J,arguments);}).content;E.replaceWith(H);}else{var F=this.dom.get(B);var C=this.renderers[B].call(this,F,this.dom);if(typeof C!="undefined"){F.empty().append(C);}}};Echo.Object.prototype.hyperlink=function(E,D){D=D||{};if(D.openInNewWindow&&!E.target){E.target="_blank";}var C=E.caption||"";delete E.caption;if(!D.skipEscaping){E.href=A.htmlize(E.href);}E.href=E.href||"javascript:void(0)";var B=A.foldl([],E,function(H,G,F){G.push(F+'="'+H+'"');});return"<a "+B.join(" ")+">"+C+"</a>";};Echo.Object.prototype.newContextId=function(){return(new Date()).valueOf()+Math.random();};Echo.Object.prototype.getContextId=function(){return this.config&&this.config.get("contextId");};Echo.Object.prototype.subscribe=function(B,C){return Echo.Broadcast.subscribe(B,C,this.getContextId());};Echo.Object.prototype.unsubscribe=function(B,C){Echo.Broadcast.unsubscribe(B,C,this.getContextId());};Echo.Object.prototype.publish=function(B,C){Echo.Broadcast.publish(B,C,this.getContextId());};Echo.Object.prototype.clearCache=function(){if(this.vars&&this.vars.cache){this.vars.cache={};}};Echo.Application=function(){this.addCss();};Echo.Application.prototype=new Echo.Object();Echo.Application.prototype.errorMessages={"error_busy":"Loading. Please wait...","error_timeout":"Loading. Please wait...","error_waiting":"Loading. Please wait...","error_result_too_large":"(result_too_large) The search result is too large.","error_wrong_query":"(wrong_query) Incorrect or missing query parameter.","error_incorrect_appkey":"(incorrect_appkey) Incorrect or missing appkey.","error_internal_error":"(internal_error) Unknown server error.","error_quota_exceeded":"(quota_exceeded) Required more quota than is available.","error_incorrect_user_id":"(incorrect_user_id) Incorrect user specified in User ID predicate.","error_unknown":"(unknown) Unknown error."};Echo.Application.prototype.initApplication=function(D){var B=this;var C=this.config.get("appkey");if(!C){this.showMessage({"type":"error","message":"Incorrect or missing mandatory parameter appkey"});return ;}this.config.get("target").addClass("echo-ui");this.user=this.config.get("user")||new Echo.User({"appkey":C,"apiBaseURL":this.config.get("apiBaseURL"),"contextId":this.config.get("contextId")});this.user.init(function(){B.initPlugins(D);});Echo.Localization.extend(this.errorMessages);};Echo.Application.prototype.messageTemplates={"compact":'<span class="echo-application-message-icon echo-application-message-{Data:type}" title="{Data:message}">'+"</span>","default":'<div class="echo-application-message">'+'<span class="echo-application-message-icon echo-application-message-{Data:type} echo-primaryFont">'+"{Data:message}"+"</span>"+"</div>"};Echo.Application.prototype.showMessage=function(C,D){if(!this.config.get("debug")&&C.type=="error"){return ;}var B=this.messageTemplates[C.layout||this.messageLayout||"default"];(D||this.config.get("target")).empty().append(this.substitute(B,C));};Echo.Application.prototype.isWaitingForData=function(B){return B&&(B.errorCode=="waiting"||B.errorCode=="timeout"||B.errorCode=="busy");};Echo.Application.prototype.handleErrorResponse=function(G,D){var B=this;D=D||{};var H=this.config.get("target");var E=function(){if(B.waitingTimeoutStep>0){if(B.waitingTimeoutStep<4){B.waitingTimeoutStep++;
}}else{B.waitingTimeoutStep=1;}return Math.round(Math.exp(B.waitingTimeoutStep))*1000;};if(this.error!=G){if(!this.config.get("debug")){H.hide();}else{var C=this.label("error_"+G.errorCode);var F=C=="error_"+G.errorCode?"("+G.errorCode+") "+(G.errorMessage||""):C;H.show();this.showMessage({"type":this.isWaitingForData(G)?"loading":"error","message":F},D.messageTarget);}}this.error=G;if(this.isWaitingForData(G)){this.waitingTimer=setTimeout(function(){B.cleanupErrorHandlers();if(D.waitingHandler){D.waitingHandler();}else{B.refresh();}},E());}else{this.waitingTimeoutStep=0;}if(D.callback){D.callback(G);}};Echo.Application.prototype.cleanupErrorHandlers=function(B){if(B){this.waitingTimeoutStep=0;delete this.error;}if(this.waitingTimer){clearTimeout(this.waitingTimer);}};Echo.Application.prototype.initPlugins=function(E){var D=this;var C=this.config.get("pluginsOrder");var B=A.foldl([],C,function(F,H){var G=Echo.Plugins[F];if(G&&G.dependencies&&G.dependencies.length){return H.concat(G.dependencies);}});Echo.include(B,function(){A.map(C,function(F){var G=Echo.Plugins[F];if(G&&G.init&&D.isPluginApplicable(G)){G.init(G,D);}});if(E){E();}});};Echo.Application.prototype.enablePlugin=function(B){this.config.set("plugins."+B+".enabled",true);};Echo.Application.prototype.disablePlugin=function(B){this.config.set("plugins."+B+".enabled",false);};Echo.Application.prototype.isPluginEnabled=function(B){return this.config.get("plugins."+B+".enabled",true);};Echo.Application.prototype.isPluginApplicable=function(D){var C=this,B=false;A.each(D.applications,function(F,E){if(Echo[E]&&C instanceof Echo[E]){B=true;return false;}});return B;};Echo.Application.prototype.initConfig=function(D,E,C){var B={};B.target=function(F){return A(F);};B.plugins=function(G){var F=A.foldl({"hash":{},"order":[]},G||[],function(H,I){var J=A.inArray(H.name,I.order);if(J>=0){I.order.splice(J,1);}I.order.push(H.name);I.hash[H.name]=H;});this.set("pluginsOrder",F.order);return F.hash;};D=A.extend({"plugins":[]},D||{});E=A.extend({"appkey":"","apiBaseURL":"http://api.echoenabled.com","liveUpdates":true,"liveUpdatesTimeout":10,"liveUpdatesTimeoutMin":3,"debug":true,"contextId":this.newContextId()},E||{});this.config=new Echo.Config(D,E,function(F,H){var G=C&&C[F]||B&&B[F];return G?G.call(this,H):H;});};Echo.Application.prototype.sendAPIRequest=function(B,C){B.query.appkey=this.config.get("appkey");A.get(this.config.get("apiBaseURL")+"/v1/"+B.endpoint,B.query,C,"jsonp");};Echo.Application.prototype.initLiveUpdates=function(D,B){var C=this;this.liveUpdates={"originalTimeout":this.config.get("liveUpdatesTimeout"),"timers":{},"timeouts":[],"responseHandler":function(E){if(C.liveUpdates.timers.watchdog){clearTimeout(C.liveUpdates.timers.watchdog);}C.changeLiveUpdatesTimeout(E);B(E);},"requestParamsGetter":D};};Echo.Application.prototype.changeLiveUpdatesTimeout=function(H){var D=this;if(typeof H=="string"){H={"liveUpdatesTimeout":H};}H.liveUpdatesTimeout=parseInt(H.liveUpdatesTimeout);var C=function(J){if(!J&&D.liveUpdates.originalTimeout!=D.config.get("liveUpdatesTimeout")){D.config.set("liveUpdatesTimeout",D.liveUpdates.originalTimeout);}else{if(J&&J>D.config.get("liveUpdatesTimeout")){D.config.set("liveUpdatesTimeout",J);}}};var B=function(J){return !!(J.entries&&J.entries.length);};if(!this.nextSince){C(H.liveUpdatesTimeout);return ;}var F=this.config.get("liveUpdatesTimeout");var I=parseInt(this.nextSince);var E=Math.floor((new Date()).getTime()/1000);var G=B(H)?E-I>F?this.config.get("liveUpdatesTimeoutMin",3):F+1:F+2;if(G>this.liveUpdates.originalTimeout){G=this.liveUpdates.originalTimeout;}this.config.set("liveUpdatesTimeout",G);if(G==this.liveUpdates.originalTimeout){C(H.liveUpdatesTimeout);}};Echo.Application.prototype.stopLiveUpdates=function(){if(this.liveUpdates.timers.regular){clearTimeout(this.liveUpdates.timers.regular);}if(this.liveUpdates.timers.watchdog){clearTimeout(this.liveUpdates.timers.watchdog);}};Echo.Application.prototype.startLiveUpdates=function(D){var B=this;if(!this.liveUpdates||!D&&!this.config.get("liveUpdates")&&!this.liveUpdates.timeouts.length){return ;}this.stopLiveUpdates();if(D){this.liveUpdates.timeouts=[0,1,3];}var C=this.liveUpdates.timeouts.length?this.liveUpdates.timeouts.shift():this.config.get("liveUpdatesTimeout");this.liveUpdates.timers.regular=setTimeout(function(){B.liveUpdates.timers.watchdog=setTimeout(function(){B.startLiveUpdates();},5000);B.sendAPIRequest(B.liveUpdates.requestParamsGetter(),B.liveUpdates.responseHandler);},C*1000);};Echo.Application.prototype.addCss=function(){var C="echo-css-fancybox";if(A("#"+C).length){return ;}var B=document.getElementsByTagName("head")[0]||document.documentElement;B.insertBefore(A("<link>",{"rel":"stylesheet","id":C,"type":"text/css","href":"//rw/sites/twpweb/css/echo2/core/fancybox.css"}).get(0),A(B).children().get(0));A.addCss(".echo-application-message { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }"+".echo-application-message-icon { display: inline-block; height: 16px; padding-left: 16px; background: no-repeat left center; }"+".echo-application-message .echo-application-message-icon { padding-left: 21px; height: auto; }"+".echo-application-message-empty { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/information.png); }"+".echo-application-message-loading { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/loading.gif); }"+".echo-application-message-error { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/warning.gif); }","application");};Echo.User=function(B){this.data={};this.config=new Echo.Config(B,{"appkey":"","apiBaseURL":"http://api.echoenabled.com","contextId":undefined});};Echo.User.prototype.init=function(E){var B=this;this.callback=E||function(){};if(!this.config.get("appkey")||!window.Backplane||!Backplane.getChannelID()){this.set({});this.callback();return ;}this.listenEvents();var D=this._global("get","state");if(D=="ready"){this.set(A.extend({},this._global("get","data")));this.callback();}else{var C=Echo.Broadcast.subscribe("User.onInit",function(F,G){if(G.appkey!=B.config.get("appkey")){return ;}Echo.Broadcast.unsubscribe("User.onInit",C);B.set(A.extend({},B._global("get","data")));B.callback();});if(D=="init"){this.request();}}};Echo.User.prototype.listenEvents=function(){var B=this;if(this.backplaneSubscriptionID){return ;}var C=function(F){var E=(F?"":"internal.")+"User.onInvalidate";var G={"data":B.data,"appkey":B.config.get("appkey")};var D=F?undefined:B.config.get("contextId");Echo.Broadcast.publish(E,G,D);};this.backplaneSubscriptionID=Backplane.subscribe(function(E){if(E.type=="identity/ack"){var D=false;if(B._global("get","state")=="ready"){D=true;B._global("set","state","init");}B.init(function(){C();if(D){C(true);}});}});};Echo.User.prototype._global=function(E,C,D){var B=this.config.get("appkey");Echo.Vars.users=Echo.Vars.users||{};Echo.Vars.users[B]=Echo.Vars.users[B]||{"state":"init","data":{}};if(E=="get"){return Echo.Vars.users[B][C];}Echo.Vars.users[B][C]=D;};Echo.User.prototype.set=function(){if(!arguments.length){return ;}if(arguments.length==1&&typeof arguments[0]=="object"){this._global("set","data",arguments[0]);this.data=this.normalize(arguments[0]);this.account=this.assemble();}else{if(arguments.length==2&&typeof arguments[0]=="string"){this.account[arguments[0]]=arguments[1];}}};Echo.User.prototype.get=function(B,C){return(this.account.hasOwnProperty(B)&&typeof this.account[B]!="undefined")?this.account[B]:C;};Echo.User.prototype.logout=function(C){var B=this;A.get(window.location.protocol+"//apps.echoenabled.com/v2/logout",{"sessionID":Backplane.getChannelID()},function(D){Backplane.expectMessages("identity/ack");},"jsonp");};Echo.User.prototype.request=function(D){var B=this,C=this.config.get("appkey");this._global("set","state","waiting");A.get(this.config.get("apiBaseURL")+"/v1/users/whoami",{"appkey":C,"sessionID":Backplane.getChannelID()},function(E){if(E.result&&E.result=="session_not_found"){E={};
}B._global("set","state","ready");B.set(A.extend({},E));Echo.Broadcast.publish("User.onInit",{"data":E,"appkey":C});if(D){D();}},"jsonp");};Echo.User.prototype.normalize=function(C){var B=function(D){return A.foldl({},D||[],function(E,F){F[E]=true;});};C=C||{};C.echo=C.echo||{};A.extend(C,C.echo);C.poco=C.poco||{"entry":{}};C.roles=B(C.echo.roles);C.markers=B(C.echo.markers);C.sessionID=window.Backplane&&Backplane.getChannelID()||undefined;C.accounts=C.poco.entry.accounts||[];return C;};Echo.User.prototype.getActiveAccounts=function(){return A.map(this.data.accounts,function(B){if(B.loggedIn=="true"){return B;}});};Echo.User.prototype.assemble=function(){var B=this.getActiveAccounts();var C=B[0]||{};return A.extend(this.data,{"id":C.identityUrl||this.data.poco.entry.id||C.userid,"name":this.data.poco.entry.displayName||C.username,"avatar":A.foldl(undefined,C.photos||[],function(D){if(D.type=="avatar"){return D.value;}}),"state":this.data.echo.state||"Untouched","domain":C.domain,"logged":!!B.length,"defaultAvatar":"//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/avatar-default.png","fakeIdentityURL":"http://js-kit.com/ECHO/user/fake_user"});};Echo.User.prototype.hasIdentity=function(C){var B=false;A.each(this.data.accounts,function(D,E){if(E.identityUrl&&E.identityUrl==C){B=true;return false;}});return B;};Echo.User.prototype.hasAny=function(E,C){if(!this.account){return false;}var B=this,D=false;A.each(C,function(F,H){var G=B.get(E,{});if((typeof G=="string"&&G==H)||G[H]){D=true;return false;}});return D;};Echo.User.prototype.hasAnyRole=function(B){return this.hasAny("roles",B);};Echo.User.prototype.isAdmin=function(){return this.hasAny("roles",["administrator","moderator"]);};Echo.User.prototype.logged=function(){return !!(this.account&&this.account.logged);};Echo.Config=function(E,C,D){var B=this;this.normalize=D||function(F,G){return G;};this.data={};this.cache={};if(!C&&!D){this.data=E;}else{A.each(this.combine(E,A.extend({},C)),function(F,G){B.set(F,G);});}};Echo.Config.prototype.get=function(C,D){var B=C;if(typeof B!="string"){B=B.join(".");}if(!this.cache.hasOwnProperty(B)){this.cache[B]=A.getNestedValue(C,this.data);}return typeof this.cache[B]=="undefined"?D:this.cache[B];};Echo.Config.prototype.set=function(B,D){var C=B.split(/\./);delete this.cache[B];if(typeof D=="object"){this.clearCacheByPrefix(B);}return A.setNestedValue(this.data,B,this.normalize(C.pop(),D));};Echo.Config.prototype.remove=function(B){var C=B.split(/\./);var E=C.pop();var D=A.getNestedValue(C,this.data);delete D[E];};Echo.Config.prototype.combine=function(D,C){var B=this;return A.foldl(C,D,function(G,F,E){F[E]=A.isPlainObject(G)&&C.hasOwnProperty(E)?B.combine(G,C[E]):G;});};Echo.Config.prototype.extend=function(B){var C=this;A.each(B,function(D,E){C.set(D,E);});};Echo.Config.prototype.getAsHash=function(){return this.data;};Echo.Config.prototype.clearCacheByPrefix=function(C){var B=this;C+=".";A.each(this.cache,function(D,E){if(!D.indexOf(C)){delete B.cache[D];}});};if(!Echo.UI){Echo.UI={cornersCss:function(B,C){return("{scope}.ui-corner-tl { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; }"+"{scope}.ui-corner-tr { -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }"+"{scope}.ui-corner-bl { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }"+"{scope}.ui-corner-br { -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-top { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }"+"{scope}.ui-corner-bottom { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-right {  -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-left { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }"+"{scope}.ui-corner-all { -moz-border-radius: {radius}; -webkit-border-radius: {radius}; border-radius: {radius}; }").replace(/{scope}/g,C||"").replace(/{radius}/g,B);}};}(function(){A.addCss(".echo-ui { text-align: left; }"+".echo-ui .ui-helper-hidden { display: none; }"+".echo-ui .ui-helper-hidden-accessible { position: absolute; left: -99999999px; }"+".echo-ui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }"+'.echo-ui .ui-helper-clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }'+".echo-ui .ui-helper-clearfix { display: inline-block; }"+"/* required comment for clearfix to work in Opera \\*/"+"* html .echo-ui .ui-helper-clearfix { height:1%; }"+".echo-ui .ui-helper-clearfix { display:block; }"+"/* end clearfix */"+".echo-ui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }"+".echo-ui .ui-resizable-handle { position: absolute;font-size: 0.1px;z-index: 99999; display: block;}"+".echo-ui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }"+".echo-ui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }"+".echo-ui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }"+".echo-ui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }"+".echo-ui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }"+".echo-ui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }"+".echo-ui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }"+".echo-ui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }"+".echo-ui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}"+".echo-ui .ui-state-disabled { cursor: default !important; }"+".echo-ui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; width: 16px; height: 16px; }"+".echo-ui .ui-widget-header { font-weight: bold; border: 0px; }"+".echo-ui, .echo-ui .ui-widget :active { outline: none; }"+".echo-ui .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }"+".echo-ui .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-ui .ui-state-default a:visited { color: #555555; text-decoration: none; }"+".echo-ui .ui-state-hover, .echo-ui .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }"+".echo-ui .ui-state-hover a, .echo-ui .ui-state-hover a:hover { color: #212121; text-decoration: none; }"+".echo-ui .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }"+".echo-ui .ui-state-active a, .echo-ui .ui-state-active a:link, .echo-ui .ui-state-active a:visited { color: #212121; text-decoration: none; }"+".echo-primaryBackgroundColor {  }"+".echo-secondaryBackgroundColor { background-color: #F4F4F4; }"+".echo-trinaryBackgroundColor { background-color: #ECEFF5; }"+".echo-primaryColor { color: #3A3A3A; }"+".echo-secondaryColor { color: #C6C6C6; }"+".echo-primaryFont { font-family: Arial, sans-serif; font-size: 12px; font-weight: normal; line-height: 16px; }"+".echo-secondaryFont { font-family: Arial, sans-serif; font-size: 11px; }"+".echo-linkColor, .echo-linkColor a { color: #476CB8; }"+".echo-clickable { cursor: pointer; }"+".echo-relative { position: relative; }"+".echo-clear { clear: both; }","ui-general");
})();if(!Echo.Localization){Echo.Localization={labels:{}};}Echo.Localization.key=function(B,C){return(C?C+".":"")+B;};Echo.Localization.extend=function(C,B){A.each(C,function(D,E){Echo.Localization.labels[Echo.Localization.key(D,B)]=E;});};Echo.Localization.label=function(C,D,E){var B=Echo.Localization.labels[Echo.Localization.key(C,D)]||C;A.each(E||{},function(F,G){B=B.replace(new RegExp("{"+F+"}","g"),G);});return B;};})(jQuery);(function(A){Echo.Localization.extend({"you":"You"},"UserListItem");Echo.UserListItem=function(B){this.vars={};this.init(B);this.addCss();};Echo.UserListItem.prototype=new Echo.Object();Echo.UserListItem.prototype.namespace="UserListItem";Echo.UserListItem.prototype.cssPrefix="echo-user-list-item-";Echo.UserListItem.prototype.renderers={};Echo.UserListItem.prototype.template='<span class="echo-user-list-item-container">'+'<img class="echo-user-list-item-avatar">'+'<span class="echo-user-list-item-title">{Data:title}</span>'+"</span>";Echo.UserListItem.prototype.renderers.avatar=function(D,E){var B=this;var C=this.data.avatar||this.user.get("defaultAvatar");if(this.config.get("userLabel.avatar")){D.attr("src",C).bind({"error":function(){A(this).attr("src",B.user.get("defaultAvatar"));}});if(!this.config.get("userLabel.text")){D.attr("title",this.data.title);}}else{E.remove(D);}};Echo.UserListItem.prototype.renderers.title=function(B,C){if(this.config.get("userLabel.text")){return this.isYou()?this.label("you"):this.data.title;}else{C.remove(B);}};Echo.UserListItem.prototype.isYou=function(){return this.data.id&&this.data.id==this.user.get("id");};Echo.UserListItem.prototype.addCss=function(){A.addCss(".echo-user-list-item-avatar { width: 16px; height: 16px; margin: 0px 3px 0px 0px; vertical-align: text-top; }"+".echo-user-list-only-avatars .echo-user-list-item-avatar { margin: 0px 2px; }"+".echo-user-list-item-container, .echo-user-list-item-container span { white-space: nowrap; }"+".echo-user-list-only-avatars .echo-user-list-item-container { white-space: normal; }","user-list-item");};Echo.Localization.extend({"and":"and","more":"more"},"UserList");Echo.UserList=function(C){if(!C||!C.target){return ;}var B=this;this.vars={};this.initVars();this.initConfig(C,{"checkViewTimeout":2,"initialUsersCount":undefined,"totalUsersCount":undefined,"query":"","suffixText":"","userLabel":{"avatar":true,"text":true}});this.messageLayout="compact";this.initApplication(function(){B.addCss();B.config.get("target").empty().append(B.render());if(B.config.get("query")){B.showMessage({"type":"loading"},B.dom.get("container"));B.initLiveUpdates(function(){return{"endpoint":"search","query":{"q":B.config.get("query"),"since":B.nextSince||0}};},function(E){B.handleLiveUpdatesResponse(E);});B.request();}else{if(B.config.get("data")){var D=B.config.get("data");D.itemsPerPage=D.itemsPerPage||2;B.config.set("liveUpdates",false);B.handleInitialResponse(D);}}});};Echo.UserList.prototype=new Echo.Application();Echo.UserList.prototype.namespace="UserList";Echo.UserList.prototype.cssPrefix="echo-user-list-";Echo.UserList.prototype.template='<span class="echo-user-list-container">'+'<span class="echo-user-list-actors"></span>'+'<span class="echo-user-list-more"></span>'+'<span class="echo-user-list-suffixText"></span>'+"</span>";Echo.UserList.prototype.renderers={};Echo.UserList.prototype.renderers.more=function(E){var D=this;if(!this.isMoreButtonVisible()){E.hide();return ;}E.empty().show();var F=this.count.total-this.count.visible;var C=(F>0?F+" ":"")+this.label("more");var B=!this.fromExternalData()||this.count.visible<this.users.length;if(B){E.addClass("echo-linkColor").append(this.hyperlink({"caption":C}));}else{E.removeClass("echo-linkColor").append(C);}this.moreRequestInProgress=false;if(B){E.one("click",function(){D.getMoreUsers();});}};Echo.UserList.prototype.renderers.actors=function(D){var C=this;if(!this.users.length){return ;}var I=[];var F=this.config.get("userLabel");if(!this.users.length||!F.avatar&&!F.text){return ;}var H=(F.avatar&&!F.text?"addClass":"removeClass");D[H]("echo-user-list-only-avatars");var E=function(L,K){var J=K?' class="echo-user-list-'+K+'"':"";return"<span"+J+">"+L+"</span>";};A.map(this.users.slice(0,this.count.visible),function(J){I.push(J.instance.render());});var B=this.config.get("userLabel.text")?", ":"";var G;if(!this.isMoreButtonVisible()){G=I.pop();}if(I.length){I=B?A.intersperse(I,E(B,"delimiter")):I;I.push(E("&nbsp;"+this.label("and")+" ","and"));}if(!this.isMoreButtonVisible()){I.push(G);}A.map(I,function(J){D.append(J);});};Echo.UserList.prototype.renderers.suffixText=function(){return this.config.get("suffixText","");};Echo.UserList.prototype.initVars=function(){this.users=[];this.uniqueUsers={};this.isViewComplete=false;delete this.nextPageAfter;this.count={"total":0,"visible":0};this.cleanupErrorHandlers();};Echo.UserList.prototype.isMoreButtonVisible=function(){return !this.fromExternalData()&&!this.isViewComplete||this.count.visible<this.count.total;};Echo.UserList.prototype.fromExternalData=function(){return !this.config.get("query")&&!!this.config.get("data");};Echo.UserList.prototype.getMoreUsers=function(){if(this.fromExternalData()){this.count.visible+=this.config.get("itemsPerPage");if(this.count.visible>this.users.length){this.count.visible=this.users.length;}this.rerender();}else{if(!this.moreRequestInProgress){this.showMessage({"type":"loading"},this.dom.get("more"));this.moreRequestInProgress=true;}this.request();}};Echo.UserList.prototype.request=function(){var B=this;var C=this.config.get("query");if(typeof this.nextPageAfter!="undefined"){C='pageAfter:"'+this.nextPageAfter+'" '+C;}this.sendAPIRequest({"endpoint":"search","query":{"q":C}},function(D){B.changeLiveUpdatesTimeout(D);B.handleInitialResponse(D);});};Echo.UserList.prototype.handleInitialResponse=function(B){if(B.result=="error"){this.handleErrorResponse(B);return ;}this.cleanupErrorHandlers(true);if(B.itemsPerPage&&B.itemsPerPage!=this.config.get("itemsPerPage")){this.config.set("itemsPerPage",+B.itemsPerPage);}if(this.fromExternalData()){this.count.total=this.config.get("totalUsersCount",0);}this.nextSince=B.nextSince||0;this.nextPageAfter=B.nextPageAfter||0;if(!B.entries.length){if(!this.isViewComplete){this.isViewComplete=true;this.rerender();}this.startLiveUpdates();return ;}if(!this.count.visible){if(this.fromExternalData()){this.count.visible=this.config.get("initialUsersCount",this.config.get("itemsPerPage"));}else{this.count.visible=this.config.get("itemsPerPage");}}this.processResponse(B);};Echo.UserList.prototype.handleLiveUpdatesResponse=function(C){var B=this;if(C.result=="error"){this.startLiveUpdates();return ;}this.nextSince=C.nextSince||0;if(!C.entries.length){this.startLiveUpdates();return ;}this.processResponse(C,true);};Echo.UserList.prototype.processResponse=function(F,E){var C=this;var D=new Echo.Config(this.config.getAsHash());var B=false;var G=false;A.each(F.entries,function(K,M){var L=(M.verbs&&M.verbs[0]=="http://activitystrea.ms/schema/1.0/delete");var I=C.uniqueUsers[M.actor.id];if(L&&!I){return ;}if(L){if(!--I.itemsCount){var J;A.each(C.users,function(O,N){if(N.instance.data.id==M.actor.id){J=O;return false;}});C.users.splice(J,1);delete C.uniqueUsers[M.actor.id];G=true;}}else{if(I){I.itemsCount++;}else{var H=new Echo.UserListItem({"data":M.actor,"user":C.user,"config":D});I={"itemsCount":1,"instance":H};C.users[H.isYou()?"unshift":"push"](I);C.uniqueUsers[M.actor.id]=I;B=true;}}});if(this.fromExternalData()){this.count.total=Math.max(this.users.length,this.count.total);}else{this.count.total=this.count.visible=this.users.length;}this.count.visible=Math.min(this.count.visible,this.users.length);if(!this.count.total){this.isViewComplete=false;}if(B||G){this.rerender();}if(E||B){this.startLiveUpdates();}else{this.getMoreUsers();}};Echo.UserList.prototype.refresh=function(){this.stopLiveUpdates();this.initVars();this.rerender();if(this.config.get("query")){this.request();}else{if(this.config.get("data")){this.handleInitialResponse(this.config.get("data"));
}}};Echo.UserList.prototype.getVisibleUsersCount=function(){return this.count.visible;};Echo.UserList.prototype.addCss=function(){A.addCss(".echo-user-list-container { line-height: 20px; vertical-align: middle; }"+".echo-user-list-more { white-space: nowrap; }"+".echo-user-list-more .echo-application-message-icon { display: inline; margin: 0px 5px; }","user-list");};})(jQuery);(function(A){if(typeof (A._$)!="undefined"){A.noConflict();}if(!window.Echo){window.Echo={};}if(!Echo.Global){Echo.Global={};}if(!Echo.Vars){Echo.Vars={"regexps":{"matchLabel":/{Label:([^:}]+[^}]*)}/g,"matchData":/{Data:(([a-z]+\.)*[a-z]+)}/ig,"mobileUA":/mobile|midp-|opera mini|iphone|ipad|blackberry|nokia|samsung|docomo|symbian|windows ce|windows phone|android|up\.browser|ipod|netfront|skyfire|palm|webos|audiovox/i,"parseUrl":/^((([^:\/\?#]+):)?\/\/)?([^\/\?#]*)?([^\?#]*)(\?([^#]*))?(#(.*))?/,"w3cdtf":/^(\d{4})-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)Z$/}};}A.extend({"addCss":function(D,F){Echo.Vars.css=Echo.Vars.css||{"index":1,"processed":{}};if(F){if(Echo.Vars.css.processed[F]){return ;}Echo.Vars.css.processed[F]=true;}var C="";var B=Echo.Vars.css.anchor;if(B&&B.length){C=B.html();}if(C.length+D.length>100000){Echo.Vars.css.index++;B=null;C="";}var E=A('<style id="echo-css-'+Echo.Vars.css.index+'" type="text/css">'+C+D+"</style>");if(B&&B.length){B.replaceWith(E);}else{if(Echo.Vars.css.anchor){Echo.Vars.css.anchor.after(E);}else{A(document.getElementsByTagName("head")[0]||document.documentElement).prepend(E);}}Echo.Vars.css.anchor=E;},"foldl":function(C,B,D){A.each(B,function(E,F){result=D(F,C,E);if(result!==undefined){C=result;}});return C;},"intersperse":function(B,C){return A.foldl([],B,function(E,F,D){if(F.length){F.push(C);}F.push(E);});},"getNestedValue":function(B,F,G,H){if(typeof B=="string"){B=B.split(/\./);}if(!B.length){return F;}var E=true;var C=function(J,I){if(H){H(I,J);}if(typeof I[J]=="undefined"){E=false;}else{return I[J];}};var D=B.length==1?C(B.pop(),F):A.foldl(F,B,C);return E?D:G;},"setNestedValue":function(G,B,E){var C=B.split(/\./);var F=C.pop();var D=A.getNestedValue(C,G,undefined,function(I,H){if(typeof I[H]=="undefined"){I[H]={};}});D[F]=E;},"htmlize":function(B){if(!B){return"";}return A("<div>").text(B).html();},"object2JSON":function(F){var D=function(G){var H={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return G.replace(/[\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff\\]/g,function(I){return(H.hasOwnProperty(I))?H[I]:"\\u"+("0000"+I.charCodeAt(0).toString(16)).slice(-4);});};var C;switch(typeof F){case"number":C=isFinite(F)?F:"null";break;case"string":C='"'+D(F)+'"';break;case"boolean":C='"'+F.toString()+'"';break;default:if(F instanceof Array){var B=A.map(F,function(G){return A.object2JSON(G);});C="["+B.join(",")+"]";}else{if(F instanceof Object){var E=F.exportProperties||F;var B=A.foldl([],E,function(I,H,G){if(E instanceof Array){G=I;I=F[G];}H.push('"'+G+'":'+A.object2JSON(I));});C="{"+B.join(",")+"}";}else{C="null";}}}return C;},"htmlTextTruncate":function(N,E,M,G){if(!E||N.length<E){return N;}var P=[],I=0,H=0;var L="br hr input img area param base link meta option".split(" ");var C=A.foldl({},L,function(S,R,Q){R[S]=true;});for(var F=0;F<N.length;F++){var D=N.charAt(F);if(D=="<"){var K=N.indexOf(">",F);if(K<0){return N;}var B=N.substring(F+1,K);var O={"name":"","closing":false};if(B.charAt(0)=="/"){O.closing=true;B=B.substring(1);}O.name=B.match(/(\w)+/)[0];if(O.closing){var J=P.pop();if(!J||J.name!=O.name){return N;}}else{if(!C[O.name]){P.push(O);}}F=K;}else{if(D=="&"&&N.substring(F).match(/^(\S)+;/)){F=N.indexOf(";",F);}else{if(I==E){H=F;break;}I++;}}}if(H||G){if(H){N=N.substring(0,H)+(M||"");}for(var F=P.length-1;F>=0;F--){N+="</"+P[F].name+">";}}return N;},"mapClass2Object":function(C,B){B=B||{};C.find("*").andSelf().each(function(E,F){if(F.className){var D=F.className.split(/[ ]+/);A.each(D,function(G,H){B[H]=F;});}});return B;},"stripTags":function(B){return A("<div>").html(B).text();},"parseUrl":function(B){var C=B.match(Echo.Vars.regexps.parseUrl);return C?{"scheme":C[3],"domain":C[4],"path":C[5],"query":C[7],"fragment":C[9]}:undefined;},"toDOM":function(C,G,F){var D=A(C);var E=A.mapClass2Object(D);var H={"set":function(I,J){E[G+I]=J;},"get":function(I,K){var J=E[(K?"":G)+I];return J&&A(J);},"remove":function(J){var I;if(typeof J=="string"){I=G+J;}else{I=J.echo.name;}A(E[I]).remove();delete E[I];},"content":D};var B;if(typeof F=="object"){B=function(I,J,K){if(!F[I]){return ;}return F[I](J,K);};}else{B=F;}A.each(E,function(M,J){var L=M.match(G+"(.*)");var I=L?L[1]:undefined;if(I&&B){J=A(J);J.echo=J.echo||{};J.echo.name=M;var K=B(I,J,H);if(typeof K!="undefined"){J.empty().append(K);}}});return H;},"loadScriptContent":function(D,F){Echo.Vars.scriptState=Echo.Vars.scriptState||{};if(Echo.Vars.scriptState[D]=="loaded"){F();return ;}var E=Echo.Broadcast.subscribe("internal.scriptLoaded",function(G,H){if(D!=H){return ;}Echo.Broadcast.unsubscribe("internal.scriptLoaded",E);F();});if(Echo.Vars.scriptState[D]=="loading"){return ;}Echo.Vars.scriptState[D]="loading";var C=document.createElement("script");C.type="text/javascript";C.charset="utf-8";C.src=D;var B=document.getElementsByTagName("head")[0]||document.documentElement;B.insertBefore(C,B.firstChild);C.onload=C.onreadystatechange=function(){var G=C.readyState;if(!G||G=="loaded"||G=="complete"){Echo.Vars.scriptState[D]="loaded";Echo.Broadcast.publish("internal.scriptLoaded",D);C.onload=C.onreadystatechange=null;}};},"sendPostRequest":function(C,E,G){var F="echo-post-"+Math.random();var B=A("#echo-post-request").length?A("#echo-post-request").empty():A('<div id="echo-post-request"/>').css({"height":0}).prependTo("body");A('<iframe id="'+F+'" name="'+F+'" width="0" height="0" frameborder="0" border="0"></iframe>').appendTo(B);var D=A("<form/>",{"target":F,"method":"POST","enctype":"application/x-www-form-urlencoded","acceptCharset":"UTF-8","action":C}).appendTo(B);A.each(E,function(H,I){A("<input/>",{"type":"hidden","name":H,"value":I}).appendTo(D);});D.submit();G();},"getVisibleColor":function(C){var B;do{B=C.css("backgroundColor");if(B!=""&&B!="transparent"&&!/rgba\(0, 0, 0, 0\)/.test(B)||A.nodeName(C.get(0),"body")){break;}}while(C=C.parent());return B||"transparent";},"timestampFromW3CDTF":function(B){var E=["year","month","day","hours","minutes","seconds"];var C={};var D=B.match(Echo.Vars.regexps.w3cdtf);A.each(E,function(F,G){C[G]=D[F+1];});return Date.UTC(C["year"],C["month"]-1,C["day"],C["hours"],C["minutes"],C["seconds"])/1000;},"isMobileDevice":function(){return Echo.Vars.regexps.mobileUA.test(navigator.userAgent);}});if(!Echo.Plugins){Echo.Plugins={};}Echo.isExtended=function(B,D,C){if(!B){return false;}C=C||true;var E=[B].concat(D).join(".");Echo.Vars.extensions=Echo.Vars.extensions||{};if(Echo.Vars.extensions[E]==C){return true;}Echo.Vars.extensions[E]=C;return false;};Echo.extendRenderer=function(B,F,D,C){if(!B||!Echo[B]||!F||!D||!A.isFunction(D)||Echo.isExtended(C,[B,"renderer",F])){return ;}var E=Echo[B].prototype.renderers[F]||function(){};Echo[B].prototype.renderers[F]=function(){var H=C&&this.config.get("plugins."+C);if(!H||!H.enabled){return E.apply(this,arguments);}var G=this;if(!this.parentRenderer){this.parentRenderer=function(J,I){return G.parentRenderers[J].apply(G,I);};}this.parentRenderers=this.parentRenderers||{};this.parentRenderers[F]=E;return D.apply(this,arguments);};};Echo.extendTemplate=function(C,E,I,B,H){if(!C||!Echo[C]||!I||!B||!E||Echo.isExtended(H,[C,"template",B,I],E)){return ;}var G=Echo[C].prototype.template;var F=A.isFunction(G)?G:function(){return G;};var D={"insertBefore":"before","insertAfter":"after","insertAsFirstChild":"prepend","insertAsLastChild":"append","replace":"replaceWith"};Echo[C].prototype.template=function(){var J=H&&this.config.get("plugins."+H);if(!J||!J.enabled){return F.call(this);}var K=A("<div/>").html(F.call(this));A("."+B,K)[D[I]](E);
return K.html();};};Echo.include=function(B,D){if(!B.length){return D();}var C=B.pop();Echo.include(B,function(){if(typeof C.loaded=="undefined"){if(C.application){C.loaded=function(){return !!Echo[C.application];};}else{D();}}if(A.isFunction(C.loaded)&&!C.loaded()){A.loadScriptContent(C.url,D);}else{D();}});};Echo.createPlugin=function(C){if(!C||!C.name||!C.init||!C.applications){return{};}var B=C.name;var E=function(){var F=function(G){return"plugins."+B+(G?"."+G:"");};F.get=function(G,H,I,J){return G.config.get(F(H),J?G.config.get(H,I):I);};F.set=function(G,H,I){G.config.set(F(H),I);};F.remove=function(G,H){G.config.remove(F(H));};return F;};var D=C.init||function(){};Echo.Plugins[B]=Echo.Plugins[B]||A.extend(C,{"init":function(H,G){var F=H.config.get(G,"enabled");if(typeof F=="undefined"){H.config.set(G,"enabled",true);}D(H,G);},"set":function(F,G,H){F.vars=F.vars||{};F.vars[B]=F.vars[B]||{};A.setNestedValue(F.vars[B],G,H);},"get":function(F,G){var H=(F.vars||{})[B]||{};if(!G){return H;}return A.getNestedValue(G,H);},"addCss":function(F){A.addCss(F,"plugins-"+B);},"label":function(F,G){return Echo.Localization.label(F,"Plugins."+B,G);},"addLabels":function(F){Echo.Localization.extend(F,"Plugins."+B);},"topic":function(H,G){var F=typeof H=="string"?H:H.namespace;return F+".Plugins."+B+"."+G;},"config":E(),"subscribe":function(H,G,I){var F=this;return H.subscribe(G,function(){if(!H.isPluginEnabled(F.name)){return ;}I.apply(this,arguments);});},"publish":function(G,F,H){G.publish(F,H);},"unsubscribe":function(G,F,H){G.unsubscribe(F,H);},"extendRenderer":function(F,H,G){Echo.extendRenderer(F,H,G,B);},"extendTemplate":function(G,H,I,F){Echo.extendTemplate(G,H,I,F,B);},"addItemControl":function(G,H){var F=G.config.get("itemControls."+B,[]);G.config.set("itemControls."+B,F.concat(H));},"assembleConfig":function(F,G){G.user=F.user;G.appkey=F.config.get("appkey","");G.plugins=this.config.get(F,"nestedPlugins",[]);G.contextId=F.config.get("contextId");G.apiBaseURL=F.config.get("apiBaseURL");return(new Echo.Config(G,this.config.get(F))).getAsHash();}});return Echo.Plugins[B];};if(!Echo.Broadcast){Echo.Broadcast={};}Echo.Broadcast.initContext=function(C,B){B=B||"empty";Echo.Vars.subscriptions=Echo.Vars.subscriptions||{};Echo.Vars.subscriptions[B]=Echo.Vars.subscriptions[B]||{};Echo.Vars.subscriptions[B][C]=Echo.Vars.subscriptions[B][C]||{};return B;};Echo.Broadcast.subscribe=function(C,D,B){var E=(new Date()).valueOf()+Math.random();B=Echo.Broadcast.initContext(C,B);Echo.Vars.subscriptions[B][C][E]=D;return E;};Echo.Broadcast.unsubscribe=function(C,D,B){B=Echo.Broadcast.initContext(C,B);if(C&&D){delete Echo.Vars.subscriptions[B][C][D];}else{if(C){delete Echo.Vars.subscriptions[B][C];}}};Echo.Broadcast.publish=function(C,D,B){B=Echo.Broadcast.initContext(C,B);if(B=="*"){A.each(Echo.Vars.subscriptions,function(E){A.each(Echo.Vars.subscriptions[E][C]||{},function(G,F){F.apply(this,[C,D]);});});}else{if(Echo.Vars.subscriptions[B][C]){A.each(Echo.Vars.subscriptions[B][C],function(F,E){E.apply(this,[C,D]);});}if(B!="empty"){Echo.Broadcast.publish(C,D,"empty");}}};if(!Echo.Object){Echo.Object=function(){};}Echo.Object.prototype.init=function(B){A.extend(this,B||{});};Echo.Object.prototype.template="";Echo.Object.prototype.namespace="";Echo.Object.prototype.cssPrefix="echo-";Echo.Object.prototype.substitute=function(C,D){var B=this;C=C.replace(Echo.Vars.regexps.matchLabel,function(F,E){return B.label(E);});C=C.replace(Echo.Vars.regexps.matchData,function(F,E){return A.getNestedValue(E,D,"");});return C;};Echo.Object.prototype.renderers={};Echo.Object.prototype.label=function(C,D){var B=Echo.Localization.label(C,this.namespace,D);return B!=C?B:Echo.Localization.label(C,"",D);};Echo.Object.prototype.render=function(D,E,G,B){var C=this;if(D){if(A.isFunction(this.renderers[D])){return this.renderers[D].call(this,E,G,B);}}else{var F=A.isFunction(this.template)?this.template():this.template;this.dom=A.toDOM(this.substitute(F,this.data||{}),this.cssPrefix,function(){return C.render.apply(C,arguments);});return this.dom.content;}};Echo.Object.prototype.rerender=function(B,D){var J=this;if(!B){if(this.dom){this.dom.content.replaceWith(this.render());}return ;}if(!this.dom){return ;}if(typeof B!="string"){A.map(B,function(K){J.rerender(K,D);});return ;}else{if(!this.dom.get(B)){return ;}}if(D){var I=A.isFunction(this.template)?this.template():this.template;var G=this.substitute(I,this.data||{});var E=this.dom.get(B);var H=A("."+this.cssPrefix+B,A(G));H=A.toDOM(H,this.cssPrefix,function(K,L,M){J.dom.set(K,L);return J.render.apply(J,arguments);}).content;E.replaceWith(H);}else{var F=this.dom.get(B);var C=this.renderers[B].call(this,F,this.dom);if(typeof C!="undefined"){F.empty().append(C);}}};Echo.Object.prototype.hyperlink=function(E,D){D=D||{};if(D.openInNewWindow&&!E.target){E.target="_blank";}var C=E.caption||"";delete E.caption;if(!D.skipEscaping){E.href=A.htmlize(E.href);}E.href=E.href||"javascript:void(0)";var B=A.foldl([],E,function(H,G,F){G.push(F+'="'+H+'"');});return"<a "+B.join(" ")+">"+C+"</a>";};Echo.Object.prototype.newContextId=function(){return(new Date()).valueOf()+Math.random();};Echo.Object.prototype.getContextId=function(){return this.config&&this.config.get("contextId");};Echo.Object.prototype.subscribe=function(B,C){return Echo.Broadcast.subscribe(B,C,this.getContextId());};Echo.Object.prototype.unsubscribe=function(B,C){Echo.Broadcast.unsubscribe(B,C,this.getContextId());};Echo.Object.prototype.publish=function(B,C){Echo.Broadcast.publish(B,C,this.getContextId());};Echo.Object.prototype.clearCache=function(){if(this.vars&&this.vars.cache){this.vars.cache={};}};Echo.Application=function(){this.addCss();};Echo.Application.prototype=new Echo.Object();Echo.Application.prototype.errorMessages={"error_busy":"Loading. Please wait...","error_timeout":"Loading. Please wait...","error_waiting":"Loading. Please wait...","error_result_too_large":"(result_too_large) The search result is too large.","error_wrong_query":"(wrong_query) Incorrect or missing query parameter.","error_incorrect_appkey":"(incorrect_appkey) Incorrect or missing appkey.","error_internal_error":"(internal_error) Unknown server error.","error_quota_exceeded":"(quota_exceeded) Required more quota than is available.","error_incorrect_user_id":"(incorrect_user_id) Incorrect user specified in User ID predicate.","error_unknown":"(unknown) Unknown error."};Echo.Application.prototype.initApplication=function(D){var B=this;var C=this.config.get("appkey");if(!C){this.showMessage({"type":"error","message":"Incorrect or missing mandatory parameter appkey"});return ;}this.config.get("target").addClass("echo-ui");this.user=this.config.get("user")||new Echo.User({"appkey":C,"apiBaseURL":this.config.get("apiBaseURL"),"contextId":this.config.get("contextId")});this.user.init(function(){B.initPlugins(D);});Echo.Localization.extend(this.errorMessages);};Echo.Application.prototype.messageTemplates={"compact":'<span class="echo-application-message-icon echo-application-message-{Data:type}" title="{Data:message}">'+"</span>","default":'<div class="echo-application-message">'+'<span class="echo-application-message-icon echo-application-message-{Data:type} echo-primaryFont">'+"{Data:message}"+"</span>"+"</div>"};Echo.Application.prototype.showMessage=function(C,D){if(!this.config.get("debug")&&C.type=="error"){return ;}var B=this.messageTemplates[C.layout||this.messageLayout||"default"];(D||this.config.get("target")).empty().append(this.substitute(B,C));};Echo.Application.prototype.isWaitingForData=function(B){return B&&(B.errorCode=="waiting"||B.errorCode=="timeout"||B.errorCode=="busy");};Echo.Application.prototype.handleErrorResponse=function(G,D){var B=this;D=D||{};var H=this.config.get("target");var E=function(){if(B.waitingTimeoutStep>0){if(B.waitingTimeoutStep<4){B.waitingTimeoutStep++;}}else{B.waitingTimeoutStep=1;}return Math.round(Math.exp(B.waitingTimeoutStep))*1000;};if(this.error!=G){if(!this.config.get("debug")){H.hide();
}else{var C=this.label("error_"+G.errorCode);var F=C=="error_"+G.errorCode?"("+G.errorCode+") "+(G.errorMessage||""):C;H.show();this.showMessage({"type":this.isWaitingForData(G)?"loading":"error","message":F},D.messageTarget);}}this.error=G;if(this.isWaitingForData(G)){this.waitingTimer=setTimeout(function(){B.cleanupErrorHandlers();if(D.waitingHandler){D.waitingHandler();}else{B.refresh();}},E());}else{this.waitingTimeoutStep=0;}if(D.callback){D.callback(G);}};Echo.Application.prototype.cleanupErrorHandlers=function(B){if(B){this.waitingTimeoutStep=0;delete this.error;}if(this.waitingTimer){clearTimeout(this.waitingTimer);}};Echo.Application.prototype.initPlugins=function(E){var D=this;var C=this.config.get("pluginsOrder");var B=A.foldl([],C,function(F,H){var G=Echo.Plugins[F];if(G&&G.dependencies&&G.dependencies.length){return H.concat(G.dependencies);}});Echo.include(B,function(){A.map(C,function(F){var G=Echo.Plugins[F];if(G&&G.init&&D.isPluginApplicable(G)){G.init(G,D);}});if(E){E();}});};Echo.Application.prototype.enablePlugin=function(B){this.config.set("plugins."+B+".enabled",true);};Echo.Application.prototype.disablePlugin=function(B){this.config.set("plugins."+B+".enabled",false);};Echo.Application.prototype.isPluginEnabled=function(B){return this.config.get("plugins."+B+".enabled",true);};Echo.Application.prototype.isPluginApplicable=function(D){var C=this,B=false;A.each(D.applications,function(F,E){if(Echo[E]&&C instanceof Echo[E]){B=true;return false;}});return B;};Echo.Application.prototype.initConfig=function(D,E,C){var B={};B.target=function(F){return A(F);};B.plugins=function(G){var F=A.foldl({"hash":{},"order":[]},G||[],function(H,I){var J=A.inArray(H.name,I.order);if(J>=0){I.order.splice(J,1);}I.order.push(H.name);I.hash[H.name]=H;});this.set("pluginsOrder",F.order);return F.hash;};D=A.extend({"plugins":[]},D||{});E=A.extend({"appkey":"","apiBaseURL":"http://api.echoenabled.com","liveUpdates":true,"liveUpdatesTimeout":10,"liveUpdatesTimeoutMin":3,"debug":true,"contextId":this.newContextId()},E||{});this.config=new Echo.Config(D,E,function(F,H){var G=C&&C[F]||B&&B[F];return G?G.call(this,H):H;});};Echo.Application.prototype.sendAPIRequest=function(B,C){B.query.appkey=this.config.get("appkey");A.get(this.config.get("apiBaseURL")+"/v1/"+B.endpoint,B.query,C,"jsonp");};Echo.Application.prototype.initLiveUpdates=function(D,B){var C=this;this.liveUpdates={"originalTimeout":this.config.get("liveUpdatesTimeout"),"timers":{},"timeouts":[],"responseHandler":function(E){if(C.liveUpdates.timers.watchdog){clearTimeout(C.liveUpdates.timers.watchdog);}C.changeLiveUpdatesTimeout(E);B(E);},"requestParamsGetter":D};};Echo.Application.prototype.changeLiveUpdatesTimeout=function(H){var D=this;if(typeof H=="string"){H={"liveUpdatesTimeout":H};}H.liveUpdatesTimeout=parseInt(H.liveUpdatesTimeout);var C=function(J){if(!J&&D.liveUpdates.originalTimeout!=D.config.get("liveUpdatesTimeout")){D.config.set("liveUpdatesTimeout",D.liveUpdates.originalTimeout);}else{if(J&&J>D.config.get("liveUpdatesTimeout")){D.config.set("liveUpdatesTimeout",J);}}};var B=function(J){return !!(J.entries&&J.entries.length);};if(!this.nextSince){C(H.liveUpdatesTimeout);return ;}var F=this.config.get("liveUpdatesTimeout");var I=parseInt(this.nextSince);var E=Math.floor((new Date()).getTime()/1000);var G=B(H)?E-I>F?this.config.get("liveUpdatesTimeoutMin",3):F+1:F+2;if(G>this.liveUpdates.originalTimeout){G=this.liveUpdates.originalTimeout;}this.config.set("liveUpdatesTimeout",G);if(G==this.liveUpdates.originalTimeout){C(H.liveUpdatesTimeout);}};Echo.Application.prototype.stopLiveUpdates=function(){if(this.liveUpdates.timers.regular){clearTimeout(this.liveUpdates.timers.regular);}if(this.liveUpdates.timers.watchdog){clearTimeout(this.liveUpdates.timers.watchdog);}};Echo.Application.prototype.startLiveUpdates=function(D){var B=this;if(!this.liveUpdates||!D&&!this.config.get("liveUpdates")&&!this.liveUpdates.timeouts.length){return ;}this.stopLiveUpdates();if(D){this.liveUpdates.timeouts=[0,1,3];}var C=this.liveUpdates.timeouts.length?this.liveUpdates.timeouts.shift():this.config.get("liveUpdatesTimeout");this.liveUpdates.timers.regular=setTimeout(function(){B.liveUpdates.timers.watchdog=setTimeout(function(){B.startLiveUpdates();},5000);B.sendAPIRequest(B.liveUpdates.requestParamsGetter(),B.liveUpdates.responseHandler);},C*1000);};Echo.Application.prototype.addCss=function(){var C="echo-css-fancybox";if(A("#"+C).length){return ;}var B=document.getElementsByTagName("head")[0]||document.documentElement;B.insertBefore(A("<link>",{"rel":"stylesheet","id":C,"type":"text/css","href":"//www.washingtonpost.com/rw/sites/twpweb/css/echo2/core/fancybox.css"}).get(0),A(B).children().get(0));A.addCss(".echo-application-message { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }"+".echo-application-message-icon { display: inline-block; height: 16px; padding-left: 16px; background: no-repeat left center; }"+".echo-application-message .echo-application-message-icon { padding-left: 21px; height: auto; }"+".echo-application-message-empty { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/information.png); }"+".echo-application-message-loading { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/loading.gif); }"+".echo-application-message-error { background-image: url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/warning.gif); }","application");};Echo.User=function(B){this.data={};this.config=new Echo.Config(B,{"appkey":"","apiBaseURL":"http://api.echoenabled.com","contextId":undefined});};Echo.User.prototype.init=function(E){var B=this;this.callback=E||function(){};if(!this.config.get("appkey")||!window.Backplane||!Backplane.getChannelID()){this.set({});this.callback();return ;}this.listenEvents();var D=this._global("get","state");if(D=="ready"){this.set(A.extend({},this._global("get","data")));this.callback();}else{var C=Echo.Broadcast.subscribe("User.onInit",function(F,G){if(G.appkey!=B.config.get("appkey")){return ;}Echo.Broadcast.unsubscribe("User.onInit",C);B.set(A.extend({},B._global("get","data")));B.callback();});if(D=="init"){this.request();}}};Echo.User.prototype.listenEvents=function(){var B=this;if(this.backplaneSubscriptionID){return ;}var C=function(F){var E=(F?"":"internal.")+"User.onInvalidate";var G={"data":B.data,"appkey":B.config.get("appkey")};var D=F?undefined:B.config.get("contextId");Echo.Broadcast.publish(E,G,D);};this.backplaneSubscriptionID=Backplane.subscribe(function(E){if(E.type=="identity/ack"){var D=false;if(B._global("get","state")=="ready"){D=true;B._global("set","state","init");}B.init(function(){C();if(D){C(true);}});}});};Echo.User.prototype._global=function(E,C,D){var B=this.config.get("appkey");Echo.Vars.users=Echo.Vars.users||{};Echo.Vars.users[B]=Echo.Vars.users[B]||{"state":"init","data":{}};if(E=="get"){return Echo.Vars.users[B][C];}Echo.Vars.users[B][C]=D;};Echo.User.prototype.set=function(){if(!arguments.length){return ;}if(arguments.length==1&&typeof arguments[0]=="object"){this._global("set","data",arguments[0]);this.data=this.normalize(arguments[0]);this.account=this.assemble();}else{if(arguments.length==2&&typeof arguments[0]=="string"){this.account[arguments[0]]=arguments[1];}}};Echo.User.prototype.get=function(B,C){return(this.account.hasOwnProperty(B)&&typeof this.account[B]!="undefined")?this.account[B]:C;};Echo.User.prototype.logout=function(C){var B=this;A.get(window.location.protocol+"//apps.echoenabled.com/v2/logout",{"sessionID":Backplane.getChannelID()},function(D){Backplane.expectMessages("identity/ack");},"jsonp");};Echo.User.prototype.request=function(D){var B=this,C=this.config.get("appkey");this._global("set","state","waiting");A.get(this.config.get("apiBaseURL")+"/v1/users/whoami",{"appkey":C,"sessionID":Backplane.getChannelID()},function(E){if(E.result&&E.result=="session_not_found"){E={};}B._global("set","state","ready");
B.set(A.extend({},E));Echo.Broadcast.publish("User.onInit",{"data":E,"appkey":C});if(D){D();}},"jsonp");};Echo.User.prototype.normalize=function(C){var B=function(D){return A.foldl({},D||[],function(E,F){F[E]=true;});};C=C||{};C.echo=C.echo||{};A.extend(C,C.echo);C.poco=C.poco||{"entry":{}};C.roles=B(C.echo.roles);C.markers=B(C.echo.markers);C.sessionID=window.Backplane&&Backplane.getChannelID()||undefined;C.accounts=C.poco.entry.accounts||[];return C;};Echo.User.prototype.getActiveAccounts=function(){return A.map(this.data.accounts,function(B){if(B.loggedIn=="true"){return B;}});};Echo.User.prototype.assemble=function(){var B=this.getActiveAccounts();var C=B[0]||{};return A.extend(this.data,{"id":C.identityUrl||this.data.poco.entry.id||C.userid,"name":this.data.poco.entry.displayName||C.username,"avatar":A.foldl(undefined,C.photos||[],function(D){if(D.type=="avatar"){return D.value;}}),"state":this.data.echo.state||"Untouched","domain":C.domain,"logged":!!B.length,"defaultAvatar":"//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/avatar-default.png","fakeIdentityURL":"http://js-kit.com/ECHO/user/fake_user"});};Echo.User.prototype.hasIdentity=function(C){var B=false;A.each(this.data.accounts,function(D,E){if(E.identityUrl&&E.identityUrl==C){B=true;return false;}});return B;};Echo.User.prototype.hasAny=function(E,C){if(!this.account){return false;}var B=this,D=false;A.each(C,function(F,H){var G=B.get(E,{});if((typeof G=="string"&&G==H)||G[H]){D=true;return false;}});return D;};Echo.User.prototype.hasAnyRole=function(B){return this.hasAny("roles",B);};Echo.User.prototype.isAdmin=function(){return this.hasAny("roles",["administrator","moderator"]);};Echo.User.prototype.logged=function(){return !!(this.account&&this.account.logged);};Echo.Config=function(E,C,D){var B=this;this.normalize=D||function(F,G){return G;};this.data={};this.cache={};if(!C&&!D){this.data=E;}else{A.each(this.combine(E,A.extend({},C)),function(F,G){B.set(F,G);});}};Echo.Config.prototype.get=function(C,D){var B=C;if(typeof B!="string"){B=B.join(".");}if(!this.cache.hasOwnProperty(B)){this.cache[B]=A.getNestedValue(C,this.data);}return typeof this.cache[B]=="undefined"?D:this.cache[B];};Echo.Config.prototype.set=function(B,D){var C=B.split(/\./);delete this.cache[B];if(typeof D=="object"){this.clearCacheByPrefix(B);}return A.setNestedValue(this.data,B,this.normalize(C.pop(),D));};Echo.Config.prototype.remove=function(B){var C=B.split(/\./);var E=C.pop();var D=A.getNestedValue(C,this.data);delete D[E];};Echo.Config.prototype.combine=function(D,C){var B=this;return A.foldl(C,D,function(G,F,E){F[E]=A.isPlainObject(G)&&C.hasOwnProperty(E)?B.combine(G,C[E]):G;});};Echo.Config.prototype.extend=function(B){var C=this;A.each(B,function(D,E){C.set(D,E);});};Echo.Config.prototype.getAsHash=function(){return this.data;};Echo.Config.prototype.clearCacheByPrefix=function(C){var B=this;C+=".";A.each(this.cache,function(D,E){if(!D.indexOf(C)){delete B.cache[D];}});};if(!Echo.Localization){Echo.Localization={labels:{}};}Echo.Localization.key=function(B,C){return(C?C+".":"")+B;};Echo.Localization.extend=function(C,B){A.each(C,function(D,E){Echo.Localization.labels[Echo.Localization.key(D,B)]=E;});};Echo.Localization.label=function(C,D,E){var B=Echo.Localization.labels[Echo.Localization.key(C,D)]||C;A.each(E||{},function(F,G){B=B.replace(new RegExp("{"+F+"}","g"),G);});return B;};if(!Echo.UI){Echo.UI={cornersCss:function(B,C){return("{scope}.ui-corner-tl { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; }"+"{scope}.ui-corner-tr { -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }"+"{scope}.ui-corner-bl { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }"+"{scope}.ui-corner-br { -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-top { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; }"+"{scope}.ui-corner-bottom { -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-right {  -moz-border-radius-topright: {radius}; -webkit-border-top-right-radius: {radius}; border-top-right-radius: {radius}; -moz-border-radius-bottomright: {radius}; -webkit-border-bottom-right-radius: {radius}; border-bottom-right-radius: {radius}; }"+"{scope}.ui-corner-left { -moz-border-radius-topleft: {radius}; -webkit-border-top-left-radius: {radius}; border-top-left-radius: {radius}; -moz-border-radius-bottomleft: {radius}; -webkit-border-bottom-left-radius: {radius}; border-bottom-left-radius: {radius}; }"+"{scope}.ui-corner-all { -moz-border-radius: {radius}; -webkit-border-radius: {radius}; border-radius: {radius}; }").replace(/{scope}/g,C||"").replace(/{radius}/g,B);}};}(function(){A.addCss(".echo-ui { text-align: left; }"+".echo-ui .ui-helper-hidden { display: none; }"+".echo-ui .ui-helper-hidden-accessible { position: absolute; left: -99999999px; }"+".echo-ui .ui-helper-reset { margin: 0; padding: 0; border: 0; outline: 0; line-height: 1.3; text-decoration: none; font-size: 100%; list-style: none; }"+'.echo-ui .ui-helper-clearfix:after { content: "."; display: block; height: 0; clear: both; visibility: hidden; }'+".echo-ui .ui-helper-clearfix { display: inline-block; }"+"/* required comment for clearfix to work in Opera \\*/"+"* html .echo-ui .ui-helper-clearfix { height:1%; }"+".echo-ui .ui-helper-clearfix { display:block; }"+"/* end clearfix */"+".echo-ui .ui-helper-zfix { width: 100%; height: 100%; top: 0; left: 0; position: absolute; opacity: 0; filter:Alpha(Opacity=0); }"+".echo-ui .ui-resizable-handle { position: absolute;font-size: 0.1px;z-index: 99999; display: block;}"+".echo-ui .ui-resizable-disabled .ui-resizable-handle, .ui-resizable-autohide .ui-resizable-handle { display: none; }"+".echo-ui .ui-resizable-n { cursor: n-resize; height: 7px; width: 100%; top: -5px; left: 0; }"+".echo-ui .ui-resizable-s { cursor: s-resize; height: 7px; width: 100%; bottom: -5px; left: 0; }"+".echo-ui .ui-resizable-e { cursor: e-resize; width: 7px; right: -5px; top: 0; height: 100%; }"+".echo-ui .ui-resizable-w { cursor: w-resize; width: 7px; left: -5px; top: 0; height: 100%; }"+".echo-ui .ui-resizable-se { cursor: se-resize; width: 12px; height: 12px; right: 1px; bottom: 1px; }"+".echo-ui .ui-resizable-sw { cursor: sw-resize; width: 9px; height: 9px; left: -5px; bottom: -5px; }"+".echo-ui .ui-resizable-nw { cursor: nw-resize; width: 9px; height: 9px; left: -5px; top: -5px; }"+".echo-ui .ui-resizable-ne { cursor: ne-resize; width: 9px; height: 9px; right: -5px; top: -5px;}"+".echo-ui .ui-state-disabled { cursor: default !important; }"+".echo-ui .ui-icon { display: block; text-indent: -99999px; overflow: hidden; background-repeat: no-repeat; width: 16px; height: 16px; }"+".echo-ui .ui-widget-header { font-weight: bold; border: 0px; }"+".echo-ui, .echo-ui .ui-widget :active { outline: none; }"+".echo-ui .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }"+".echo-ui .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-ui .ui-state-default a:visited { color: #555555; text-decoration: none; }"+".echo-ui .ui-state-hover, .echo-ui .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }"+".echo-ui .ui-state-hover a, .echo-ui .ui-state-hover a:hover { color: #212121; text-decoration: none; }"+".echo-ui .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }"+".echo-ui .ui-state-active a, .echo-ui .ui-state-active a:link, .echo-ui .ui-state-active a:visited { color: #212121; text-decoration: none; }"+".echo-primaryBackgroundColor {  }"+".echo-secondaryBackgroundColor { background-color: #F4F4F4; }"+".echo-trinaryBackgroundColor { background-color: #ECEFF5; }"+".echo-primaryColor { color: #3A3A3A; }"+".echo-secondaryColor { color: #C6C6C6; }"+".echo-primaryFont { font-family: Arial, sans-serif; font-size: 12px; font-weight: normal; line-height: 16px; }"+".echo-secondaryFont { font-family: Arial, sans-serif; font-size: 11px; }"+".echo-linkColor, .echo-linkColor a { color: #476CB8; }"+".echo-clickable { cursor: pointer; }"+".echo-relative { position: relative; }"+".echo-clear { clear: both; }","ui-general");
})();Echo.UI.Button=function(C,B){this.states=B||{};this.element=A(C);this.addCss();if(this.states.normal&&!this.states.normal.label){this.states.normal.label=A(C).html();}A(C).button(this.states.normal).wrap('<span class="echo-button"></span>');this.wrapper=A(C).parent();};Echo.UI.Button.prototype=new Echo.Object();Echo.UI.Button.prototype.setState=function(B){this.element.removeClass("ui-button-text-only ui-button-text-icons ui-button-text-icon");this.element.button("option",this.states[B]);};Echo.UI.Button.prototype.addCss=function(){A.addCss(".echo-button .ui-button { display: inline-block; position: relative; padding: 0; margin-right: .1em; text-decoration: none !important; cursor: pointer; text-align: center; overflow: visible; }"+".echo-button .ui-button-icon-only { width: 1.8em; }"+".echo-button button.ui-button-icon-only { width: 2em; }"+".echo-button .ui-button-icons-only { width: 3em; }"+".echo-button button.ui-button-icons-only { width: 3.3em; }"+".echo-button .ui-button .ui-button-text { display: block; }"+".echo-button .ui-button-text-only .ui-button-text { padding: .4em .8em; }"+".echo-button .ui-button-icon-only .ui-button-text, .echo-button .ui-button-icons-only .ui-button-text { padding: .4em; text-indent: -9999999px; }"+".echo-button .ui-button-text-icon .ui-button-text, .echo-button .ui-button-text-icons .ui-button-text { padding: .4em .8em .4em 2.1em; }"+".echo-button .ui-button-text-icons .ui-button-text { padding-left: 1.9em; padding-right: 1.9em; }"+".echo-button input.ui-button { padding: .4em .8em; }"+".echo-button .ui-button-icon-only .ui-icon, .echo-button .ui-button-text-icon .ui-icon, .echo-button .ui-button-text-icons .ui-icon, .echo-button .ui-button-icons-only .ui-icon { position: absolute; top: 50%; margin-top: -8px; }"+".echo-button .ui-button-icon-only .ui-icon { left: 50%; margin-left: -8px; }"+".echo-button .ui-button-text-icon .ui-button-icon-primary, .echo-button .ui-button-text-icons .ui-button-icon-primary, .echo-button .ui-button-icons-only .ui-button-icon-primary { left: .3em; }"+".echo-button .ui-button-text-icons .ui-button-icon-secondary, .echo-button .ui-button-icons-only .ui-button-icon-secondary { right: .3em; }"+".echo-button button.ui-button::-moz-focus-inner { border: 0; padding: 0; }"+".echo-button .ui-state-default { border: 1px solid #d3d3d3; background: #e6e6e6; color: #555555; }"+".echo-button .ui-state-default a, .echo-ui .ui-state-default a:link, .echo-button .ui-state-default a:visited { color: #555555; text-decoration: none; }"+".echo-button .ui-state-hover, .echo-button .ui-state-focus { border: 1px solid #999999; background: #dfebf2; color: #212121; }"+".echo-button .ui-state-active { border: 1px solid #aaaaaa; background: #dfebf2; color: #212121; }"+Echo.UI.cornersCss("4px",".echo-button button"),"ui-buttons");if(A.browser.msie){A.addCss(".echo-button .ui-button { zoom: 1; }","ui-buttons-ie");}A.addCss(".echo-button .ui-icon-arrow-right { background: no-repeat center url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/curation/button/apply_normal.png); }"+".echo-button .ui-icon-save { margin-right: 5px; background: no-repeat center url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/curation/button/save_normal.png); }"+".echo-button .ui-icon-waiting { margin-right: 5px; background: no-repeat center url(//www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/loading.gif); }","ui-buttons-icons");};})(jQuery);(function(A){Echo.Localization.extend({"createdBy":"Created by","loading":"Loading...","markers":"Markers:","markersHint":"Marker1, marker2, marker3, ...","on":"on","post":"Post","posting":"Posting...","postingFailed":'There was a server error while trying to submit your item. Please try again in a few minutes. <b>Error: "{error}"</b>.',"postingTimeout":"There was a network issue while trying to submit your item. Please try again in a few minutes.","tagsHint":"Tag1, tag2, tag3, ...","tags":"Tags:","update":"Update","updating":"Updating...","yourName":"Your Name (required)","yourWebsiteOptional":"Your website (optional)"},"Submit");Echo.Submit=function(C){if(!C||!C.target){return ;}var B=this;this.vars={};this.initConfig(C,{"targetURL":document.location.href,"submissionProxyURL":window.location.protocol+"//apps.echoenabled.com/v2/esp/activity","markers":[],"source":{},"tags":[],"mode":"standard","data":{},"inReplyTo":{},"actionString":"Type your comment here...","postingTimeout":30});this.initialMode=this.config.get("mode");this.initApplication(function(){B.contextId=B.config.get("contextId",B.newContextId());B.addCss();B.config.get("target").empty().append(B.render());B.listenEvents();B.publish("Submit.onRender",B.prepareBroadcastParams());});};Echo.Submit.prototype=new Echo.Application();Echo.Submit.prototype.namespace="Submit";Echo.Submit.prototype.cssPrefix="echo-submit-";Echo.Submit.prototype.template=function(){return this.templates[this.config.get("mode")];};Echo.Submit.prototype.templates={};Echo.Submit.prototype.templates.standard='<div class="echo-submit-container">'+'<div class="echo-submit-header"></div>'+'<div class="echo-submit-body">'+'<div class="echo-submit-content echo-submit-border">'+'<textarea class="echo-submit-text echo-submit-text-area echo-primaryFont echo-primaryColor"></textarea>'+"</div>"+'<div class="echo-submit-markersContainer echo-submit-metadata-container echo-primaryFont echo-primaryColor">'+'<div class="echo-submit-metadata-label">{Label:markers}</div>'+'<div class="echo-submit-metadata-wrapper">'+'<div class="echo-submit-metadata-subwrapper echo-submit-border ">'+'<input class="echo-submit-markers echo-primaryFont">'+"</div>"+"</div>"+'<div class="echo-clear"></div>'+"</div>"+'<div class="echo-submit-tagsContainer echo-submit-metadata-container echo-primaryFont echo-primaryColor">'+'<div class="echo-submit-metadata-label">{Label:tags}</div>'+'<div class="echo-submit-metadata-wrapper">'+'<div class="echo-submit-metadata-subwrapper echo-submit-border ">'+'<input class="echo-submit-tags echo-submit-border echo-primaryFont">'+"</div>"+"</div>"+'<div class="echo-clear"></div>'+"</div>"+"</div>"+'<div class="echo-submit-controls">'+'<div class="echo-submit-post-container echo-ui">'+'<button type="button" class="echo-submit-postButton echo-primaryFont"></button>'+"</div>"+'<div class="echo-clear"></div>'+"</div>"+"</div>";Echo.Submit.prototype.templates.edit=Echo.Submit.prototype.templates.standard;Echo.Submit.prototype.templates.compact='<div class="echo-submit-container">'+'<div class="echo-submit-content echo-submit-border">'+'<input class="echo-submit-text echo-submit-text-input echo-primaryFont echo-primaryColor">'+"</div>"+"</div>";Echo.Submit.prototype.renderers={};Echo.Submit.prototype.renderers.container=function(B){if(this.initialMode=="compact"){B.click(function(C){C.stopPropagation();});}};Echo.Submit.prototype.renderers.tagsContainer=Echo.Submit.prototype.renderers.markersContainer=function(B,C){if(this.user.isAdmin()){B.show();}else{B.hide();}};Echo.Submit.prototype.renderers.metaFields=function(C,F,B){var D=B.type;var E=this.config.get("data.object."+D,this.config.get(D,[]));F.get(D).iHint({"text":this.label(D+"Hint"),"className":"echo-secondaryColor"}).val(A.trim(A.stripTags(E.join(", ")))).blur();};Echo.Submit.prototype.renderers.markers=function(B,C){this.render("metaFields",B,C,{"type":"markers"});};Echo.Submit.prototype.renderers.tags=function(B,C){this.render("metaFields",B,C,{"type":"tags"});};Echo.Submit.prototype.renderers.editModeUserInfo=function(C,G){var E='<div class="echo-submit-userInfoWrapper echo-primaryFont echo-primaryFont echo-primaryColor">'+"{Label:createdBy} "+'<span class="echo-submit-author">{Data:author}</span> '+"{Label:on} {Data:date}"+"</div>";var D={};var F=this.config.get("data.object.published");var B=new Date(A.timestampFromW3CDTF(F)*1000);return A.toDOM(this.substitute(E,{"date":B.toLocaleDateString()+", "+B.toLocaleTimeString(),"author":this.config.get("data.actor.title",this.label("guest"))}),this.cssPrefix,{}).content;
};Echo.Submit.prototype.renderers.anonymousModeUserInfo=function(C,G){var B=this;var F="echo-submit-anonymousUserInfo";var E='<div class="echo-submit-userInfoWrapper">'+'<div class="{Data:prefix}Avatar"></div>'+'<div class="{Data:prefix}Fields">'+'<div class="{Data:prefix}FieldsWrapper">'+'<div class="{Data:prefix}NameContainer echo-submit-border">'+'<input class="{Data:prefix}Name echo-primaryFont echo-primaryColor">'+"</div>"+'<div class="{Data:prefix}UrlContainer echo-submit-border">'+'<input class="{Data:prefix}Url echo-primaryFont echo-primaryColor">'+"</div>"+"</div>"+"</div>"+'<div class="echo-clear"></div>'+"</div>";var D={"Avatar":function(I){var H=B.user.get("avatar",B.user.get("defaultAvatar"));I.append('<img src="'+H+'">');},"Name":function(H){G.set("anonymousUserInfoName",H);H.val(B.user.get("name","")).iHint({"text":B.label("yourName"),"className":"echo-secondaryColor"});},"Url":function(H){G.set("anonymousUserInfoUrl",H);H.val(B.user.get("domain","")).iHint({"text":B.label("yourWebsiteOptional"),"className":"echo-secondaryColor"});}};var E=this.substitute(E,{"prefix":F});return A.toDOM(E,F,D).content;};Echo.Submit.prototype.renderers.header=function(B,D){var C=this.config.get("mode")=="edit"?"edit":"anonymous";return this.render(C+"ModeUserInfo",B,D);};Echo.Submit.prototype.renderers.text=function(C){var B=this,D=this.config.get("data.object.content");if(D){C.val(D);}C.iHint({"text":B.config.get("actionString"),"className":"echo-secondaryColor"});if(this.config.get("mode")=="compact"){C.focus(function(){B.config.set("mode","standard");B.rerender();setTimeout(function(){B.dom.get("text").focus();},0);B.publish("Submit.onExpand",B.prepareBroadcastParams());});}};Echo.Submit.prototype.renderers.postButton=function(E){var C=this,F=this.config.get("mode")=="edit";var D=new Echo.UI.Button(E,{"normal":{"icons":false,"disabled":false,"label":C.label(F?"update":"post")},"posting":{"icons":{"primary":"ui-icon-waiting"},"disabled":true,"label":C.label(F?"updating":"posting")}});C.posting=C.posting||{};C.posting.subscriptions=C.posting.subscriptions||[];var B=function(G,I,H){A.each(["Post","Edit"],function(L,J){var K="Submit.on"+J+G;var M=C.posting.subscriptions;if(M[K]){C.unsubscribe(K,M[K]);}M[K]=C.subscribe(K,function(N,O){if(C.config.get("target").get(0)!=O.target){return ;}D.setState(I);if(H){H();}});});};B("Init","posting");B("Complete","normal",function(){C.dom.get("text").val("").trigger("blur");C.rerender(["tagsContainer","markersContainer"]);});B("Error","normal");this.posting.action=this.posting.action||function(){var G=false;A.each(["anonymousUserInfoName","text"],function(I,H){G=C.highlightMandatory(C.dom.get(H));return !G;});if(G){return ;}C.post();};E.unbind("click",this.posting.action).bind("click",this.posting.action);};Echo.Submit.prototype.post=function(){var K=this,F=this.config.get("mode")=="edit";var D=function(L){return K.dom.get(L);};var C=function(L,M){var N=F?"Edit":"Post";K.publish("Submit.on"+N+L,K.prepareBroadcastParams({"postData":M}));};var E;if(F){E=[].concat(K.getContentUpdate(D("text").val()),K.getMetaDataUpdates("tag","tags",D("tags").val()),K.getMetaDataUpdates("mark","markers",D("markers").val()));if(!E.length){C("Complete",[]);return ;}}else{E={"avatar":K.user.get("avatar",""),"content":D("text").val(),"markers":A.trim(D("markers").val()),"name":K.user.get("name",(K.user.logged()?"":D("anonymousUserInfoName").val())),"source":K.config.get("source"),"tags":A.trim(D("tags").val()),"target":K.config.get("targetURL"),"url":K.user.get("domain",(K.user.logged()?"":D("anonymousUserInfoUrl").val())),"verb":"post"};}var B;var J=false;var I=function(N){if(B){clearTimeout(B);}if(N.result=="error"){if(J){return ;}var L=J=(N.errorCode=="timeout");var M=L?K.label("postingTimeout"):K.label("postingFailed",{"error":N.errorMessage||N.errorCode});A.fancybox({"content":'<div class="echo-submit-error">'+M+"</div>","height":70,"width":L?320:390,"padding":15,"orig":D("text"),"autoDimensions":false,"transitionIn":"elastic","transitionOut":"elastic","onComplete":function(){if(A.browser.msie&&document.compatMode!="CSS1Compat"){var O=arguments[2];var P=2*O.padding+40;A("#fancybox-wrap").css({"width":O.width+P,"height":O.height+P});}}});C("Error",N);}else{C("Complete",E);}};C("Init",E);var H={"appkey":K.config.get("appkey"),"content":A.object2JSON(E),"sessionID":K.user.get("sessionID","")};A.ajax({"type":"GET","url":K.config.get("submissionProxyURL"),"data":H,"success":I,"error":function(){I({"result":"error","errorCode":"internal_error"});},"dataType":"jsonp"});var G=this.config.get("postingTimeout");if(G){B=setTimeout(function(){I({"result":"error","errorCode":"timeout"});},G*1000);}};Echo.Submit.prototype.highlightMandatory=function(B){if(B&&!A.trim(B.val())){B.parent().addClass("echo-submit-mandatory");B.focus(function(){A(this).parent().removeClass("echo-submit-mandatory");});return true;}return false;};Echo.Submit.prototype.prepareBroadcastParams=function(B){B=B||{};B.data=this.config.get("data");B.target=this.config.get("target").get(0);B.targetURL=this.config.get("targetURL");B.inReplyTo=this.config.get("inReplyTo");return B;};Echo.Submit.prototype.getContentUpdate=function(B){if(this.config.get("data.object.content","")==B){return[];}return[{"verb":"update","field":"content","value":B,"target":this.config.get("data.object.id")}];};Echo.Submit.prototype.getMetaDataUpdates=function(I,D,F){var C=this;var E=function(J){return A.map(J||[],function(K){return A.trim(K);});};var B={"modified":E(F.split(",")),"current":E(this.config.get("data.object."+D,""))};var H=[];var G=function(K,J,L){A.map(K,function(M){if(M&&A.inArray(M,J)==-1){var N={"verb":L,"target":C.config.get("data.object.id")};N[D]=M;H.push(N);}});};G(B.current,B.modified,"un"+I);G(B.modified,B.current,I);return H;};Echo.Submit.prototype.switchMode=function(C){if(!C){C=(this.config.get("mode")=="standard"?"compact":"standard");}if(this.config.get("mode")!=C){this.config.set("mode",C);this.rerender();var B="Submit.on"+(C=="compact"?"Collapse":"Expand");this.publish(B,this.prepareBroadcastParams());}};Echo.Submit.prototype.refresh=function(){this.rerender(["container","header","markersContainer","tagsContainer","postButton"]);this.publish("Submit.onRerender",this.prepareBroadcastParams());};Echo.Submit.prototype.listenEvents=function(){var B=this;this.subscribe("internal.User.onInvalidate",function(){B.refresh();});if(this.initialMode=="compact"){Echo.Broadcast.subscribe("document.onclick",function(){if(B.dom&&B.dom.get("text").val()){return ;}B.switchMode("compact");});if(!Echo.Vars.onClickRegistered){A(document).click(function(){Echo.Broadcast.publish("document.onclick");});Echo.Vars.onClickRegistered=true;}}};Echo.Submit.prototype.addCss=function(){A.addCss(".echo-submit-header { margin-bottom: 3px; }"+".echo-submit-anonymousUserInfoAvatar { float: left; margin-right: -48px; }"+".echo-submit-anonymousUserInfoAvatar img { width: 48px; height: 48px; }"+".echo-submit-anonymousUserInfoFields { width: 100%; float: left; }"+".echo-submit-anonymousUserInfoFields input { width: 100%; }"+".echo-submit-anonymousUserInfoFieldsWrapper { margin-left: 53px; }"+".echo-submit-anonymousUserInfoNameContainer { margin: 1px 0px 4px 0px; padding: 0px 2px 1px 3px; background-color: #fff; }"+".echo-submit-anonymousUserInfoName { font-size: 14px; font-weight: bold; border: none; }"+".echo-submit-anonymousUserInfoUrlContainer { padding: 0px 2px 1px 3px; background-color: #fff; }"+".echo-submit-anonymousUserInfoUrl { height: 19px; border: none; }"+".echo-submit-author { font-weight: bold; }"+".echo-submit-content { padding: 5px 5px 5px 6px; background-color: #fff; }"+".echo-submit-text-area { width: 100%; height: 102px; padding: 0px; margin: 0px; border: none; resize:none ; }"+".echo-submit-text-input { width: 100%; border: none; }"+".echo-submit-metadata-container { margin-top: 6px; }"+".echo-submit-metadata-label { float: left; width: 50px; margin-right: -50px; text-align: right; line-height: 22px; }"+".echo-submit-metadata-wrapper { float: left; width: 100%; }"+".echo-submit-metadata-subwrapper { margin-left: 55px; padding: 2px 2px 2px 3px; background-color: #fff; }"+".echo-submit-metadata-subwrapper input { width: 100%; border: none; }"+".echo-submit-controls { margin-top: 5px; }"+".echo-submit-post-container { float: right; }"+".echo-submit-border { border: 1px solid #d2d2d2; }"+".echo-submit-mandatory { border: 1px solid red; }"+".echo-submit-queries-view-option { padding-right: 5px; }"+".echo-submit-error { color: #444444; font: 14px Arial; line-height: 150%; padding-left: 85px; background: no-repeat url(http://www.washingtonpost.com/rw/sites/twpweb/img/echo2/core/info70.png); height: 70px; }","submit");
if(A.browser.msie){A.addCss(".echo-submit-container { zoom: 1; }"+".echo-submit-body { zoom: 1; }"+".echo-submit-header { zoom: 1; }"+".echo-submit-content { zoom: 1; }"+".echo-submit-markersContainer { zoom: 1; }"+".echo-submit-tagsContainer { zoom: 1; }","submit-ie");}if(A.browser.webkit){A.addCss(".echo-submit-container input, .echo-submit-container textarea { background-position: 0px; }"+".echo-submit-text-area { outline: none; }"+".echo-submit-anonymousUserInfoName { outline: none; }"+".echo-submit-anonymousUserInfoUrl { outline: none; }"+".echo-submit-metadata-subwrapper input { outline: none; }","submit-webkit");}};})(jQuery);