(function(D){var A=wp_e2.debug;var J=false;var C=false;var G=false;var B=null;var F=null;var E={};var I={};var H=true;wp_e2.wp_site_domain=["washingtonpost.com","digitalink.com"];wp_e2.USER_ROLE_ADMINISTRATOR="administrator";wp_e2.SORT_DESCENDING="reverseChronological";wp_e2.SORT_ASCENDING="chronological";wp_e2.MODERATION_REQUIRED="premodreq";wp_e2.MODERATOR_APPROVED="ModeratorApproved";wp_e2.MODERATOR_BANNED="ModeratorBanned";wp_e2.MODERATOR_DELETED="ModeratorDeleted";wp_e2.COMMUNITY_FLAGGED="CommunityFlagged";wp_e2.MODERATOR_FLAGGED="ModeratorFlagged";wp_e2.SYSTEM_FLAGGED="SystemFlagged";wp_e2.UNTOUCHED="Untouched";wp_e2.PHOTO="photo";wp_e2.WEBTYPE_PHOTO="ugc_photo_story";wp_e2.WEBTYPE_BLOG="blogstory";wp_e2.WEBTYPE_PROMO="promo_story";wp_e2.WEBTYPE_DISCUSSION_STORY="discussion_story";wp_e2.STREAM_BASE="http://www.washingtonpost.com";if(typeof Backplane!="undefined"){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - initializing backplane");Backplane.init(wp_e2.backplaneSettings);}else{A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - no backplane");}Date.prototype.setISO8601=function(N){var K=/(\d\d\d\d)(-)?(\d\d)(-)?(\d\d)(T)?(\d\d)(:)?(\d\d)(:)?(\d\d)(\.\d+)?(Z|([+-])(\d\d)(:)?(\d\d))/;if(N.toString().match(new RegExp(K))){var M=N.match(new RegExp(K));var L=0;this.setUTCDate(1);this.setUTCFullYear(parseInt(M[1],10));this.setUTCMonth(parseInt(M[3],10)-1);this.setUTCDate(parseInt(M[5],10));this.setUTCHours(parseInt(M[7],10));this.setUTCMinutes(parseInt(M[9],10));this.setUTCSeconds(parseInt(M[11],10));if(M[12]){this.setUTCMilliseconds(parseFloat(M[12])*1000);}else{this.setUTCMilliseconds(0);}if(M[13]!="Z"){L=(M[15]*60)+parseInt(M[17],10);L*=((M[14]=="-")?-1:1);this.setTime(this.getTime()-L*60*1000);}}else{this.setTime(Date.parse(N));}return this;};wp_e2.getQuery=function(P,b,T,W,c){var O=(typeof T=="undefined")?wp_e2:wp_e2[T];var V=(typeof T=="undefined"||typeof W=="undefined")?wp_e2:wp_e2[T][W];var L=(typeof O.webType!=="undefined")?O.webType.toLowerCase():"";var b=(!b)?O.guid:b;c=(typeof c=="undefined")?"":c;var P=P.toLowerCase();var M="";if((typeof wp_e2.echo_user!=="undefined"&&typeof wp_e2.echo_user.get("state")!=="undefined"&&wp_e2.echo_user.logged())&&((typeof O.isAllComments!="undefined"&&O.isAllComments===true)||(L===wp_e2.WEBTYPE_BLOG)||O.moderation_required===true)){if(wp_e2.echo_user.get("state")===wp_e2.UNTOUCHED||wp_e2.echo_user.get("state")===wp_e2.MODERATOR_BANNED||wp_e2.echo_user.get("state")===wp_e2.MODERATOR_DELETED||O.moderation_required===true){M="OR (-state:"+wp_e2.SYSTEM_FLAGGED+","+wp_e2.MODERATOR_FLAGGED+" user.id:'"+wp_e2.echo_user.account.id+"')";}}var Y=((typeof V.streamSettings[P].allowedItemMarkers!="undefined")?" markers: "+V.streamSettings[P].allowedItemMarkers.toString()+" ":"");var Z=((typeof V.streamSettings[P].allowedUserMarkers!="undefined"&&V.streamSettings[P].allowedUserMarkers.toString()!="")?" user.markers: "+V.streamSettings[P].allowedUserMarkers.toString()+" ":"");if(O.display_ugc_photos){V.streamSettings[P].allowedItemStates=[wp_e2.MODERATOR_APPROVED];}var N="";if(L===wp_e2.WEBTYPE_PHOTO){N="(state:"+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}else{if(O.moderation_required===true){N="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{N="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}}var d="";if(L===wp_e2.WEBTYPE_PHOTO){d="(state:"+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}else{if(O.moderation_required===true){d="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{d="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+","+wp_e2.UNTOUCHED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+","+wp_e2.MODERATOR_DELETED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}}var S="";if(L===wp_e2.WEBTYPE_PHOTO){S="(state:"+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}else{if(O.moderation_required===true){S="(state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+" ) ";}else{S="(state:Untouched user.state:"+wp_e2.MODERATOR_APPROVED+") "+"OR (state:"+wp_e2.COMMUNITY_FLAGGED+","+wp_e2.MODERATOR_APPROVED+" -user.state:"+wp_e2.MODERATOR_BANNED+","+wp_e2.MODERATOR_DELETED+") ";}}var U="";if(Y!=""&&Z!=""){U="("+Y+" OR "+Z+") ";}else{if(Y!=""){U="("+Y+") ";}else{if(Z!=""){U="("+Z+")";}}}var e=0;if(typeof V.streamSettings[P].maxItems!="undefined"){e=V.streamSettings[P].maxItems;}else{if(L===wp_e2.WEBTYPE_BLOG||D(".comment-stream-tabs li.active a",D("#"+T)).attr("rel")==="all"||O.isAllComments===true){e=O.default_items;}else{if(O.max_items_to_display>0){e=O.max_items_to_display;}}}var X=" (("+N+M+") "+(U!=""?" AND "+U:"")+")  ";var R="";if((typeof O.source!="undefined"&&O.source.indexOf("Twitter")>=0)){R="("+V.streamSettings[P].request+": "+b+" ("+d+")"+" "+U+" source:Twitter"+") ";}var K="";if((typeof O.source!="undefined"&&O.source.indexOf("washpost.com")>=0)){K="("+V.streamSettings[P].request+": "+b+" source:"+O.source.toString()+X+" )";}var a="";if(typeof O.streamId!="undefined"&&O.streamId!=""){a="("+V.streamSettings[P].request+":"+wp_e2.STREAM_BASE+"/"+O.streamId+((typeof V.streamSettings[P].allowedItemMarkers!=="undefined"&&V.streamSettings[P].allowedItemMarkers.toString()!="")?" markers: "+V.streamSettings[P].allowedItemMarkers.toString():"")+" ("+d+")"+")";}var Q=(K!="")?K:"";Q=Q+((a!=""&&Q!=="")?" OR "+a:a);Q=Q+((R!=""&&Q!=="")?" OR "+R:R);if(c==""){Q="("+Q+")"+" itemsPerPage: "+e+" sortOrder: "+V.streamSettings[P].sortOrder+" safeHTML:"+V.streamSettings[P].safeHTML+" childrenSortOrder:"+V.streamSettings[P].childrenSortOrder+" childrenItemsPerPage:"+V.streamSettings[P].childrenItemsPerPage+" children: "+V.streamSettings[P].childrenMaxDepth+" "+" (("+S+M+") "+((P==="top")?"":(U!=""?" AND "+U:""))+") ";}else{Q="url: "+c+" itemsPerPage: "+e+" sortOrder: "+V.streamSettings[P].sortOrder+" safeHTML:"+V.streamSettings[P].safeHTML+" children: "+V.streamSettings[P].childrenMaxDepth+" childrenSortOrder:"+V.streamSettings[P].childrenSortOrder+" childrenItemsPerPage:"+V.streamSettings[P].childrenItemsPerPage+" "+" (("+S+M+") "+((P==="top")?"":(U!=""?" AND "+U:""))+") ";}A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - query - "+T+" - "+P+": "+Q);return Q;};wp_e2.isTopCommenter=function(L,K){currUserMarkers=wp_e2.echo_user.get("markers");if(wp_e2[L].streamTabs.top){for(i=0;i<wp_e2[L].streamTabs.top.userMarkers.length;i++){if(currUserMarkers[wp_e2[L].streamTabs.top.userMarkers[i]]===true){return true;}}}return false;};wp_e2.resetCharacterLimit=function(K,L){D(".characters-remaining",K).html(wp_e2[L].commentMaxLength);};wp_e2.initCommentCount=function(){var K=(typeof elm!="undefined")?D(elm):D(".echo_container");K.each(function(L,M){thisContainer=D(M).attr("id");if(D(".echo-counter",M).length>0||D(M).hasClass("echo-counter")){thisId="echo-counter";wp_e2[thisContainer][thisId]={};wp_e2[thisContainer][thisId].streamSettings=D.extend(true,{},wp_e2.streamSettings);wp_e2.initStreamTabs(thisContainer,thisId);}});};wp_e2.renderCommentCount=function(){if(wp_e2.isUserSynced()){D(".echo-counter").each(function(){var N=D(this).closest(".echo_container").attr("id");var M=(typeof N!=="undefined")?wp_e2[N].guid:wp_e2.guid;if(typeof D(this).attr("guid")!=="undefined"){M=D(this).attr("guid");
}var K=D(this).closest("a").attr("rel");var O=(typeof K!=="undefined"&&K!="")?K:"all";var L=wp_e2.getTimeoutValue("counter","default",N);wp_e2.streamSettings[O]=D.extend(true,{},wp_e2.streamSettings.defaults);wp_e2.streamSettings[O].target=this;wp_e2.streamSettings[O].query=wp_e2.getQuery(O,M,N,"echo-counter");wp_e2.streamSettings[O].liveUpdatesTimeout=L;wp_e2.streamSettings[O].liveUpdates=(L=="0")?false:true;D(this).data("stream",new Echo.Counter(wp_e2.streamSettings[O]));A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - started counter and attached to .echo-counter for stream: ["+N+"]["+O+"].streamSettings["+O+"]");});}};wp_e2.initCommentStream=function(L){var K=(typeof L!="undefined")?D(".echo-stream",L):D(".echo-stream");K.each(function(){var N=D(this).attr("id");var R=D(this).closest(".echo_container").attr("id");var Q=wp_e2[R].guid;if(typeof D(this).attr("guid")!=="undefined"){Q=D(this).attr("guid");}var P=wp_e2[R].itemUrl;wp_e2[R][N]={};wp_e2[R][N].streamSettings=D.extend(true,{},wp_e2.streamSettings);wp_e2.initTabs(R,N);wp_e2.whirlpoolArray=[{"name":"Whirlpools","after":1,"clickable":true}];wp_e2.whirlpoolTopArray=[{"name":"Whirlpools","after":0,"clickable":true}];wp_e2.streamPluginArray=[{"name":"TWP_Stream","isAllComments":wp_e2[R].isAllComments,"allCommentsURL":wp_e2[R].allCommentsURL,"webType":wp_e2[R].webType,"display_more":wp_e2[R].display_more,"allowPhotos":wp_e2[R].allow_photos,"allowVideos":wp_e2[R].allow_videos,"markerListTop":((wp_e2[R].streamTabs.top)?wp_e2[R].streamTabs.top.userMarkers:""),"markerDisplay":wp_e2[R].markerDisplay,"bookmarkletUrl":wp_e2.bookmarkletUrl}];if(wp_e2[R].display_ugc_photos===true){wp_e2[R][N].streamSettings["defaults"].plugins=wp_e2[R][N].streamSettings["defaults"].plugins.concat(wp_e2.displayPhotoGalleryPluginArray);}else{wp_e2[R][N].streamSettings["defaults"].plugins=wp_e2[R][N].streamSettings["defaults"].plugins.concat(wp_e2.streamPluginArray);if(wp_e2[R].includerecommend===true){wp_e2[R][N].streamSettings["defaults"].plugins=wp_e2[R][N].streamSettings["defaults"].plugins.concat({"name":"TWP_Like","proxyURL":wp_e2.proxyURL,"echoSubmissionProxyURL":wp_e2.echoSubmissionProxyURL});}replyPluginArray=[];if(wp_e2[R].allow_comments===true&&wp_e2[R].includereply===true){replyPluginArray=[{"name":"Reply","actionString":"Add your thoughts...","nestedPlugins":[{"name":"FormAuth","nestedPlugins":[{"name":"ReplyAuth"}]},{"name":"ReplyForm","proxyURL":wp_e2.proxyURL,"commentMaxLength":wp_e2[R].commentMaxLength,"echoSubmissionProxyURL":wp_e2.echoSubmissionProxyURL}]}];wp_e2[R][N].streamSettings["defaults"].plugins=wp_e2[R][N].streamSettings["defaults"].plugins.concat(replyPluginArray);}if(wp_e2[R].includereport===true){wp_e2[R][N].streamSettings["defaults"].plugins=wp_e2[R][N].streamSettings["defaults"].plugins.concat({"name":"TWP_CommunityFlag","proxyURL":wp_e2.metaUrl,"echoSubmissionProxyURL":wp_e2.metaUrl});}}wp_e2.initStreamTabs(R,N);var O=wp_e2.getTimeoutValue("stream",wp_e2[R].webType,R);var M=(typeof P!="undefined"&&P!="")?P:Q;A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - init Comment Stream - "+R+" - "+Q+"-"+N+"-"+P);D.each(wp_e2[R].streamTabs,function(S,T){tab=S.toLowerCase();wp_e2[R][N].streamSettings[tab].target="#"+N;wp_e2[R][N].streamSettings[tab].targetURL=M;wp_e2[R][N].streamSettings[tab].query=wp_e2.getQuery(tab,Q,R,N,P);wp_e2[R][N].streamSettings[tab].liveUpdatesTimeout=O;wp_e2[R][N].streamSettings[tab].liveUpdates=(O=="0")?false:true;wp_e2[R][N].streamSettings[tab].streamStateLabel.icon=(O=="0")?false:true;wp_e2[R][N].streamSettings[tab].streamStateLabel.text=(O=="0")?false:true;});});};wp_e2.renderCommentStream=function(L,K,M){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - check for stream render: "+L);if(wp_e2.isUserSynced()){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js -  stream render: "+L+" userloginstate: "+B+" echo_user: "+wp_e2.echo_user.logged());var K=D("#"+M).closest(".echo_container").attr("id");var N=wp_e2[K][M].streamSettings;N[L].reply=wp_e2[K].allow_comments;N[L].query=wp_e2.getQuery(L,N[L].targetURL,K,M,wp_e2[K].itemUrl);if(wp_e2[K].webType==wp_e2.WEBTYPE_PHOTO){N[L].liveUpdates=false;}if(typeof D("#"+M).data("stream")=="undefined"||D("#"+M).data("stream")==null){D("#"+M).data("stream",new Echo.Stream(N[L]));}else{thisClient=D("#"+M).data("stream");(L==="top")?thisClient.config.set("plugins.Whirlpools.after",0):thisClient.config.set("plugins.Whirlpools.after",1);thisClient.config.set("maxBodyCharacters",N[L].maxBodyCharacters);thisClient.config.set("query",N[L].query);setTimeout(function(){thisClient.refresh();},0);}A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - comment stream rendered for stream: "+L);}};wp_e2.initSubmitBox=function(L){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - ---Submit Box Initialized");var K=(typeof L!="undefined")?D(".comment-box",L):D(".comment-box");K.each(function(){var M=D(this);var O="#"+D(this).attr("id");var P=D(this).closest(".echo_container").attr("id");var U=D("#"+P);var R=wp_e2[P].guid;if(typeof D(this).attr("guid")!=="undefined"){R=D(this).attr("guid");}var N=wp_e2[P].itemUrl;if(wp_e2[P].allow_comments===false){D(".comment-box-header .weigh-in",U).html('<span class="closed">Comments are closed.</span>');}wp_e2.setSubmitMarkers(P);if(wp_e2[P].allow_comments){wp_e2.submitPluginArray=[];pluginArray=[{"name":"FormAuth","nestedPlugins":[{"name":"SubmitAuth","logoutURL":wp_e2.logOutURL,"profileURL":wp_e2.profileURL,"webType":wp_e2[P].webType,"displayUGCPhotos":wp_e2[P].display_ugc_photos}]},{"name":"SubmitForm","commentMaxLength":wp_e2[P].commentMaxLength,"pageURL":wp_e2.pageURL,"loginURL":wp_e2.logInURL,"logoutURL":wp_e2.logOutURL,"profileURL":wp_e2.profileURL,"proxyURL":wp_e2.proxyURL,"echoSubmissionProxyURL":wp_e2.echoSubmissionProxyURL,"displayUGCPhotos":wp_e2[P].display_ugc_photos,"isWashingtonpostDomain":wp_e2.isWashingtonpostDomainName()}];wp_e2.submitPluginArray=wp_e2.submitPluginArray.concat(pluginArray);if(wp_e2[P].display_ugc_photos===true){wp_e2.uploadPhotoPluginArray[0]=D.extend(true,{},wp_e2.uploadPhotoPluginArray[0],{authorName:wp_e2.echo_user.get("name"),"photoCommentMaxLength":wp_e2[P].photoCommentMaxLength});wp_e2.submitPluginArray=wp_e2.submitPluginArray.concat(wp_e2.uploadPhotoPluginArray);}var T=(typeof N!="undefined"&&N!="")?N:R;var Q=(typeof wp_e2[P].webType!=="undefined"&&wp_e2[P].webType!==wp_e2.WEBTYPE_PHOTO)?"compact":"standard";var S=(wp_e2[P].display_ugc_photos===true)?"Add additional information here. (Will not be displayed with your photo.)":"Type your comment here";submitClient=new Echo.Submit({"target":O,"appkey":wp_e2.appkey,"targetURL":T,"apiBaseURL":wp_e2.apiBaseURL,"plugins":wp_e2.submitPluginArray,"mode":Q,"actionString":S});M.data("submitbox",submitClient);}});};wp_e2.renderSubmitBox=function(K){if(wp_e2.isUserSynced()&&J===true){D(".comment-box").each(function(){var O=D(this);var L="#"+D(this).attr("id");var M=D(this).closest(".echo_container").attr("id");var N=D("#"+M);if(wp_e2[M].display_ugc_photos==true){if(K!=="login"){D(".comments div.echo-submit-body",N).addClass("hidden");D(".comments div.echo-submit-controls",N).addClass("hidden");}else{D(".comments div.echo-submit-body",N).removeClass("hidden");D(".echo-submit-upload-control-caption",N).addClass("hidden");D(".echo-submit-content",N).addClass("hidden");D(".echo-submit-controls",N).addClass("hidden");}}if(D("div.comment-box",N).hasClass("hidden")){D("div.comment-box",N).removeClass("hidden");}A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - unhiding comment box for userLoginState: "+K+" isRendered: "+J);
});}};wp_e2.initStreamTabs=function(L,K){D.each(wp_e2[L].streamTabs,function(M,N){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - "+M+": "+N.title+": "+N.active+" "+((N.userMarkers)?N.userMarkers.toString():"")+" "+((N.itemMarkers)?N.itemMarkers.toString():""));tab=M.toLowerCase();wp_e2[L][K].streamSettings[tab]=D.extend(true,{},wp_e2[L][K].streamSettings.defaults,N);wp_e2[L][K].streamSettings[tab].plugins=wp_e2[L][K].streamSettings[tab].plugins.concat((tab==="top")?wp_e2.whirlpoolTopArray:wp_e2.whirlpoolArray);if((typeof N.userMarkers!="undefined")&&N.userMarkers.toString()!==""){wp_e2[L][K].streamSettings[tab].allowedUserMarkers=N.userMarkers;}if((typeof N.userStates!="undefined")&&N.userStates.toString()!==""){wp_e2[L][K].streamSettings[tab].allowedUserStates=N.userStates;}if((typeof N.itemMarkers!="undefined")&&N.itemMarkers.toString()!==""){wp_e2[L][K].streamSettings[tab].allowedItemMarkers=N.itemMarkers;}if((typeof N.itemStates!="undefined")&&N.itemStates.toString()!==""){wp_e2[L][K].streamSettings[tab].allowedItemStates=N.itemStates;}if((typeof N.children!="undefined")&&N.children!==""){wp_e2[L][K].streamSettings[tab].children=N.children;}if((typeof N.maxItems!="undefined")&&N.maxItems!==""){wp_e2[L][K].streamSettings[tab].maxItems=N.maxItems;}if((typeof N.request!="undefined")&&N.request!==""){wp_e2[L][K].streamSettings[tab].request=N.request;}});};wp_e2.initTabs=function(N,K){var O=D("#"+N);if(wp_e2[N].includetabs&&D("li.tab",O).length==0){D.each(wp_e2[N].streamTabs,function(R,T){var S=D('<li class="tab">');if(T.active===true){S.addClass("active");}S.append('<a href="'+((typeof T.tabUrl!="undefined")?T.tabUrl:"")+'" rel="'+R+'"><span class="tab-text">'+T.title+' (<span class="echo-counter tab-count-'+R+'"></span>)</span></a>');D(".comment-stream-tabs",O).prepend(S);});D("#echo-comments-overview").clone().appendTo(D(".comment-stream-tabs li.echo-comments-tip span.thistip",O));var Q=D("#echo-comments-overview",O);var P=D(".badge-list",Q);var M="";if(P.length>0&&typeof wp_e2[N].streamTabs.top!="undefined"){D.each(wp_e2[N].streamTabs.top.userMarkers,function(R,S){if(S!="staff"){M+=(typeof wp_e2[N].markerDisplay[S]!=="undefined")?wp_e2[N].markerDisplay[S]+", ":"";}});P.html(M.substring(0,M.lastIndexOf(", ")));}(D("#"+N+" .tooltip.echo-comments-tip").length>0)?D("#"+N+" .tooltip.echo-comments-tip").tooltip():"";var L=TWP.Util.Url.getParameters(window.location.href)["ctab"];L=(typeof L=="undefined")?"":(L.substring(0,L.indexOf("_"))=="")?"top":L.substring(0,L.indexOf("_"));if(L!=""){D(".comment-stream-tabs li",D("#"+N)).removeClass("active");D('.comment-stream-tabs li a[rel|="'+L+'"]',D("#"+N)).parents("li").addClass("active");}D(".comment-stream-tabs li.tab a").click(function(T){A&&window.console&&console.log&&console.log("url in tab?"+(D(this).attr("href").indexOf("http")>=0)+" "+T);D(this).parents("ul").find("li").removeClass("active");D(this).parents("li").addClass("active");var S=D(this).attr("rel").toLowerCase();var R=D(this).closest(".echo_container").attr("id");var U=D(this).closest(".comment-header").attr("rel");if(D("#"+U).attr("sortorder")){wp_e2[R][U].streamSettings[S].sortOrder=D("#"+U).attr("sortorder");}A&&window.console&&console.log&&console.log("url in tab?"+D(this).attr("href"));if(typeof T.which!=="undefined"&&D(this).attr("href")&&D(this).attr("href").indexOf("http")>=0){window.location.href=D(this).attr("href");}else{T.stopPropagation();T.preventDefault();}wp_e2.renderCommentStream(S,R,U);T.stopImmediatePropagation();T.stopPropagation();return false;});}if(wp_e2[N].includesorts){D("#comment-stream-sortorder li a",O).click(function(R){D(this).parents("ul").find("li").removeClass("active");D(this).parents("li").addClass("active");var S=D(this).closest(".comment-header").attr("rel");D("#"+S).attr("sortorder",D(this).attr("rel"));if(D(".comment-stream-tabs li.active a",O).length>0){D(".comment-stream-tabs li.active a",O).click();}else{wp_e2[N][S].streamSettings[wp_e2[N].defaultTab].sortOrder=D("#"+S).attr("sortorder");wp_e2.renderCommentStream(wp_e2[N].defaultTab,N,S);}R.stopImmediatePropagation();R.stopPropagation();return false;});}};wp_e2.setAvatarEvent=function(){D("a.comment-overlay").unbind();D("a.comment-overlay").click(function(K){K.preventDefault();if(typeof editAvatar!=="undefined"){editAvatar(K);}});};wp_e2.isWashingtonpostDomainName=function(){var L=false;var K=TWP.Util.Url.getHostName().substring(TWP.Util.Url.getHostName().indexOf(".")+1);for(i=0;i<wp_e2.wp_site_domain.length;i++){if(wp_e2.wp_site_domain[i].indexOf(K)>=0){L=true;}}return L;};wp_e2.init=function(){if(typeof (Echo)!=="undefined"){if(typeof wapoEnv!=="undefined"&&!wp_e2.isWashingtonpostDomainName()){wapoEnv.site_base_domain=TWP.Util.Url.getHostName().substring(TWP.Util.Url.getHostName().indexOf(".")+1);wapoEnv.site_url="//"+TWP.Util.Url.getHostName();}if(typeof wapoIdentityInit==="function"){wapoIdentityInit();}}wp_e2.initOmnitureVariables();wp_e2.backplaneSettings.targetURL=wp_e2.guid;wp_e2.streamSettings.defaults.appkey=wp_e2.appkey;if(D(".ugc-background").length>0){D(".ugc-background").eq(0).ugcGallery();}Echo.Broadcast.subscribe("Stream.onMoreButtonPress",function(M,O,K){var L=D(O.target).closest(".echo_container").attr("id");if(typeof sendDataToOmniture==="function"){if(typeof wp_e2[L].webType!=="undefined"&&wp_e2[L].webType!==wp_e2.WEBTYPE_PHOTO){try{sendDataToOmniture("echo.onmore","event5",I);A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - MORE: omniture event5");}catch(N){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - MORE: omniture event5"+N);}}}});Echo.Broadcast.subscribe("Stream.onRender",function(M,P,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.onRender");var L=D(P.target).closest(".echo_container").attr("id");if(wp_e2[L].includesorts!=false){var N=D("#"+L+" .comment-header").attr("rel");var Q=D(".echo-stream-header",D("#"+L));var O=(D("#"+L+" .tab.active a").length>0)?D("#"+L+" .tab.active a").attr("rel"):wp_e2[L].defaultTab;if(Q.length>0&&D(".comment-sortorder",D("#"+L)).length==0){Q.prepend('<div class="comment-sortorder">'+"Sort Comments:&nbsp;&nbsp;"+'<select class="comment-sortorder-select">'+'<option value="reverseChronological">Newest to Oldest</option>'+'<option value="chronological">Oldest to Newest</option>'+'<option value="likesDescending">Most Recommended</option>'+"</select></div>");D('.comment-sortorder-select option[value="'+wp_e2[L][N].streamSettings[O].sortOrder+'"]').attr("selected","selected");D(".comment-sortorder-select",Q).change(function(){wp_e2[L][N].streamSettings[O].sortOrder=D(this).attr("value");wp_e2.renderCommentStream(O,L,N);});}}});Echo.Broadcast.subscribe("Stream.onRerender",function(M,P,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.onRerender");var L=D(P.target).closest(".echo_container").attr("id");if(wp_e2[L].includesorts!=false){var N=D("#"+L+" .comment-header").attr("rel");var Q=D(".echo-stream-header",D("#"+L));var O=(D("#"+L+" .tab.active a").length>0)?D("#"+L+" .tab.active a").attr("rel"):wp_e2[L].defaultTab;if(Q.length>0&&D(".comment-sortorder",D("#"+L)).length==0){Q.prepend('<div class="comment-sortorder">'+"Sort Comments:&nbsp;&nbsp;"+'<select class="comment-sortorder-select">'+'<option value="reverseChronological">Newest to Oldest</option>'+'<option value="chronological">Oldest to Newest</option>'+'<option value="likesDescending">Most Recommended</option>'+"</select></div>");D('.comment-sortorder-select option[value="'+wp_e2[L][N].streamSettings[O].sortOrder+'"]').attr("selected","selected");D(".comment-sortorder-select",Q).change(function(){wp_e2[L][N].streamSettings[O].sortOrder=D(this).attr("value");
wp_e2.renderCommentStream(O,L,N);});}}});Echo.Broadcast.subscribe("Stream.Item.onRender",function(L,M,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.Item.onRender");D(".tooltip",D(M.item.target)).tooltip();});Echo.Broadcast.subscribe("Stream.onReady",function(L,M,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Stream.onReady");});Echo.Broadcast.subscribe("Photo.onUploadError",function(L,M,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - photo upload error");D(".echo-submit-header",M.target).hide().html('<p class="echo-photo-error">'+M+' <img class="notice-close" src="/rw/sites/twpweb/img/icons/icon-square-close.gif"/></p>').fadeIn(3000,function(){D(".notice-close",M.target).click(function(){D(".echo-submit-header").fadeOut(1000,function(){D(".echo-submit-header p").remove();});});});D('input[name="Filedata"]',M.target).click(function(){D(".echo-submit-header").fadeOut(1000,function(){D(".echo-submit-header p").remove();});});});Echo.Broadcast.subscribe("Submit.onPostInit",function(L,M,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Post Init");});Echo.Broadcast.subscribe("Submit.onPostComplete",function(P,N,Q){var O=D(N.target).closest(".echo_container").attr("id");var M=D("#"+O+" .echo_stream").attr("id");var S=D("#"+O);if(typeof sendDataToOmniture==="function"){try{E.eVar26=(wp_e2[O].display_ugc_photos===true)?"submit - ugc":"submit - comments";sendDataToOmniture("echo.onpostcomplete","event3",E);A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Post COmplete: omniture event3");E.eVar26="";}catch(L){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Post COmplete: omniture event3 - "+L);}}wp_e2.resetCharacterLimit(N.target,O);if(D("#ugc-photo-gallery").length>0){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Post COmplete: hidding photo stuff");D("input.echo-submit-markers",N.target).val(wp_e2[O].submitMarkers);D(".echo-submit-upload-control-caption",S).addClass("hidden");D(".echo-submit-content",S).addClass("hidden");D(".echo-submit-controls",S).addClass("hidden");}var K="";var R=(wp_e2[O].webType==wp_e2.WEBTYPE_DISCUSSION_STORY)?"View your Post":"View Your Comment";if(D("#ugc-photo-gallery").length>0){K='<p class="echo-view-all-comments">Thank you for your photo.  It will be posted in this gallery after review. <img class="notice-close" src="/rw/sites/twpweb/img/icons/icon-square-close.gif"/></p>';}else{if(D("div.comments_allComments",S).length==0&&((typeof wp_e2[O].webType!=="undefined")&&wp_e2[O].webType.toLowerCase()!=wp_e2.WEBTYPE_BLOG)){K='<p class="echo-view-all-comments">Thank you. <a href="'+wp_e2[O].allCommentsURL+'?ctab=all_&#weighIn">'+R+'</a>. <img class="notice-close" src="/rw/sites/twpweb/img/icons/icon-square-close.gif"/></p>';}else{K="<p class=\"echo-view-all-comments\">Thank you. <a href=\"\" onClick=\"javascript:$('.comment-stream-tabs li a[rel=\\'all\\']', $('#"+O+"')).click();$('.echo-submit-header').fadeOut(1000,function(){$('.echo-submit-header p').remove()});return false;\">"+R+'</a>. <img class="notice-close" src="/rw/sites/twpweb/img/icons/icon-square-close.gif"/></p>';}}if(D("#ugc-photo-gallery").length>0||(D(".comment-stream-tabs .tab.active a",S).attr("rel")==="top"&&!wp_e2.isTopCommenter(O,M))){D(".echo-submit-header",S).hide().html(K).fadeIn(3000,function(){D(".notice-close",S).click(function(){D(".echo-submit-header",S).fadeOut(1000,function(){D(".echo-submit-header p",S).remove();});});});}});Echo.Broadcast.subscribe("Counter.onUpdate",function(L,M,K){D(M.target).html(M.data.count);});Echo.Broadcast.subscribe("Submit.onRender",function(M,N,K){var L=D(N.target).closest(".echo_container").attr("id");if(N.data&&N.data.unique){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onRender (Reply) triggered wp_e2.echo_user.logged is: "+wp_e2.echo_user.logged()+" userLoginState: "+B);}else{A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onRender triggered wp_e2.echo_user.logged is: "+wp_e2.echo_user.logged()+" userLoginState: "+B);D("input.echo-submit-markers",N.target).val(wp_e2[L].submitMarkers);D("#share-comments",N.target).children().remove();if(D("div.module.share.comments.inline.hidden").length>0){D("div.module.share.comments.inline.hidden").clone(true).removeClass("hidden").appendTo(D("#share-comments",N.target));(D.isFunction(D.fn.share))?D("div.module.share.comments.inline").share():"";}J=true;wp_e2.renderSubmitBox(B);wp_e2.setAvatarEvent();}});Echo.Broadcast.subscribe("Submit.onRerender",function(M,N,K){var L=D(N.target).closest(".echo_container").attr("id");if(N.data&&N.data.unique){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onRerender (Reply) triggered.  wp_e2.echo_user.logged is: "+wp_e2.echo_user.logged());}else{A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Submit.onRerender triggered.  wp_e2.echo_user.logged is: "+wp_e2.echo_user.logged());D("input.echo-submit-markers",N.target).val(wp_e2[L].submitMarkers);(D.isFunction(D.fn.share))?D("div.module.share.comments.inline").share():"";J=true;wp_e2.renderSubmitBox(B);wp_e2.setAvatarEvent();}});Echo.Broadcast.subscribe("Submit.onExpand",function(M,N,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - onExpand triggered.  wp_e2.echo_user.logged is: "+wp_e2.echo_user.logged());var L=D(N.target).closest(".echo_container").attr("id");D("input.echo-submit-markers",N.target).val(wp_e2[L].submitMarkers);wp_e2.setAvatarEvent();});Echo.Broadcast.subscribe("User.onInvalidate",function(L,M,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - User.onInvalidate triggered.  wp_e2.echo_user.logged is: "+wp_e2.echo_user.logged());});Echo.Broadcast.subscribe("User.onInit",function(L,M,K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - onInit triggered");wp_e2.echo_user=new Echo.User({"appkey":wp_e2.appkey,"apiBaseURL":wp_e2.apiBaseURL});wp_e2.echo_user.init(function(){var N=wp_e2.echo_user.getActiveAccounts();});C=true;wp_e2.initContainers();});if(typeof Echo=="object"){Echo.LoginStateChange=function(K){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Echo.LoginStateChange triggered for login state: "+K);B=K;wp_e2.renderSubmitBox(K);wp_e2.renderCommentCount();D(".echo_stream_container").each(function(N,O){var M=D(O).closest(".echo_container").attr("id");if(D(".comment-stream-tabs li.active a",O).length>0){D(".comment-stream-tabs li.active a",O).click();}else{var L=D(".echo-stream",O).attr("id");wp_e2.renderCommentStream(wp_e2[M].defaultTab,M,L);}});D(".comment-stream").trigger("wp_e2Init.Complete");};}else{A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - no echo present");}A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - init complete");G=true;};wp_e2.initContainers=function(L){wp_e2.initSubmitBox(L);
wp_e2.initCommentStream(L);wp_e2.initCommentCount(L);wp_e2.renderCommentCount(L);var K=(typeof L!="undefined")?D(".echo_stream_container",L):D(".echo_stream_container");K.each(function(N,O){var M=D(O).closest(".echo_container").attr("id");if(D(".comment-stream-tabs li.active a",O).length>0){D(".comment-stream-tabs li.active a",O).click();}else{thisId=D(".echo-stream",O).attr("id");wp_e2.renderCommentStream(wp_e2[M].defaultTab,M,thisId);}D(O).trigger("wp_e2Init.Complete");});K=(typeof L!="undefined")?D(L):D(".echo_container");K.removeClass("unprocessed").addClass("processed");};wp_e2.setSubmitMarkers=function(L){var K=(wp_e2[L].sectionId!==""&&typeof wp_e2[L].sectionId!="undefined")?wp_e2[L].sectionId:"";K+=(wp_e2[L].moderation_required===true)?", "+wp_e2.MODERATION_REQUIRED:"";K+=(wp_e2[L].display_ugc_photos===true)?", "+wp_e2.PHOTO:"";wp_e2[L].submitMarkers=K;};wp_e2.getTimeoutValue=function(N,K,L){if(typeof L!=="undefined"&&wp_e2[L].allow_comments==false){K="closed";}else{if(typeof K=="undefined"||K==""){K="no_webtype";}}var M=(typeof wp_e2.liveUpdatesTimeout[N][K]!=="undefined")?wp_e2.liveUpdatesTimeout[N][K]:wp_e2.liveUpdatesTimeout[N]["default"];return M;};wp_e2.initOmnitureVariables=function(){var K={};try{K={"eVar1":s.eVar1,"eVar2":s.eVar2,"eVar8":s.eVar8,"eVar17":s.eVar17,"eVar33":s.eVar33};}catch(L){}D.extend(E,K);I={"eVar26":"view more - comments"};D.extend(I,K);};wp_e2.isUserSynced=function(){var K=false;if(typeof B!=="undefined"&&B!==null&&typeof wp_e2.echo_user!=="undefined"&&((B==="login"&&wp_e2.echo_user.logged())||(B==="logout"&&!wp_e2.echo_user.logged()))){K=true;}return K;};wp_e2.initToolTips=function(){D(".echo-sign-in").each(function(){D(this).attr("href",wp_e2.logInURL+wp_e2.pageURL);});};wp_e2.toString=function(L,K){for(myKey in L){console.log("config"+((typeof K==="undefined"||K===-1)?"":"["+K+"]")+"["+myKey+"] = "+L[myKey]);if(typeof L[myKey]==="object"){wp_e2.toString(L[myKey],myKey);}}};D(document).ready(function(){A&&window.console&&console.log&&console.log("["+(new Date()-TWP_Debug.initialTime)/1000+"]"+"echo2/v2/core/twp_comments_echo2.js - Document Ready");wp_e2.init();wp_e2.initToolTips();});})(jQuery);