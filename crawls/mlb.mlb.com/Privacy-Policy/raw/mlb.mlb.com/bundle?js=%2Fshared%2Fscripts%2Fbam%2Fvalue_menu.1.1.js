/*! stopgap_start */(function(e){e.fn.hoverIntent=function(o,n){var p={sensitivity:7,interval:500,timeout:500};p=e.extend(p,n?{over:o,out:n}:o);var r,q,l,j;var k=function(s){r=s.pageX;q=s.pageY;};var i=function(t,s){s.hoverIntent_t=clearTimeout(s.hoverIntent_t);if((Math.abs(l-r)+Math.abs(j-q))<p.sensitivity){e(s).unbind("mousemove.hoverIntent",k);s.hoverIntent_s=1;return p.over.apply(s,[t]);}else{l=r;j=q;s.hoverIntent_t=setTimeout(function(){i(t,s);},p.interval);}};var m=function(t,s){s.hoverIntent_t=clearTimeout(s.hoverIntent_t);s.hoverIntent_s=0;return p.out.apply(s,[t]);};var h=function(v){var u=(v.type=="mouseover"?v.fromElement:v.toElement)||v.relatedTarget;while(u&&u!=this){try{u=u.parentNode;}catch(v){u=this;}}if(u==this){return false;}var t=jQuery.extend({},v);var s=this;if(s.hoverIntent_t){s.hoverIntent_t=clearTimeout(s.hoverIntent_t);}if(v.type=="mouseover"){l=t.pageX;j=t.pageY;e(s).bind("mousemove.hoverIntent",k);if(s.hoverIntent_s!=1){s.hoverIntent_t=setTimeout(function(){i(t,s);},p.interval);}}else{e(s).unbind("mousemove",k);if(s.hoverIntent_s==1){s.hoverIntent_t=setTimeout(function(){m(t,s);},p.timeout);}}};return this.bind("mouseover.hoverIntent mouseout.hoverIntent",h);};var c=window.console,f="open",b="opening",g="closed",d={open:true,opening:true},a={closed:true};e.widget("bam.valuemenu",{_widgetClass:function(i){var h=this.widgetBaseClass+"-";return e.map(e.trim(i).split(rwhite),function(j){return h+j;}).join(" ");},_error:function(i,j){var h=Array.prototype.slice.call(arguments,2);if(h.length){i=i.replace(/\$(\d)/g,function(l,k){return h[k];});}c.error(i);throw new Error(this.widgetBaseClass+": "+j+": "+i);},_log:function(){if(this.debug===true&&c&&c.log){}},options:{selector:{menu:".value-menu-links",menuItems:".value-menu-item",menuLink:".value-menu-link",drawer:".value-menu-panels",panel:".panel",panelPrefix:".panel-",ad:".ad"},attr:{panelUrl:"data-panel-url",sectionName:"data-section",adSize:"data-size",adSlot:"data-slot"},hoverIntent:{timeout:500,interval:300}},_create:function(){var j=this.element,i=this.options,h=this;this._menu=j.find(i.selector.menu);this._menuLinks=this._menu.find(i.selector.menuLink);this._menuItems=this._menuLinks.filter(i.selector.menuItems);this._nonMenuItems=this._menuLinks.not(this._menuItems);this._drawer=j.find(i.selector.drawer);this._panels=this._drawer.find(i.selector.panel);this._drawerState=g;this._ads=e();if(!(this._menu.length&&this._menuItems.length&&this._drawer.length&&this._panels.length)){this._error("could not find some of the elements for construction","_create");}if(bam.env.client.isIPad==false&&bam.env.client.isAndroid==false){j.addClass("no-touch");}this._menuItems.each(function(){var n=e(this),l=n.attr(i.attr.panelUrl),p=n.attr(i.attr.sectionName),k=h._panels.filter(i.selector.panelPrefix+p),m,q;function o(){if(!q){q=e.Deferred();e.ajax(l,{beforeSend:function(){h._log("LOAD",l);}}).then(function(r){h._log("RENDER",l);k.html(r);m=k.find(i.selector.ad);h._ads=h._ads.add(m);n.data(h.widgetBaseClass+"section",p).data(h.widgetBaseClass+"panel",k).data(h.widgetBaseClass+"ad",m);q.resolve(k);});}return q;}if(bam.env.client.isIPad==true||bam.env.client.isAndroid==true){n.one("click",o);e(document).ready(function(){o();n.unbind("click",o);});}else{n.one("mouseover",o);e(window).load(function(){o();n.unbind("mouseover",o);});}});this._trigger("created");},_init:function(){var h=this;if(bam.env.client.isIPad==true||bam.env.client.isAndroid==true){this._menuItems.on("click","a.value-menu-section",function(i){i.preventDefault();}).on("click",function(){if(h._selected===this&&h._isFocused){h._selected=null;h._isFocused=false;h.closeDrawer.apply(h);e(this).removeClass("active").find("a.value-menu-section").trigger("mouseleave");}else{h._selected=this;h._isFocused=true;h.openDrawer.apply(h);h.showContentIfReady();}});}else{this.element.hoverIntent(e.extend(h.options.hoverIntent,{over:function(){h._isFocused=true;h.openDrawer.apply(h);},out:function(){h._isFocused=false;h.closeDrawer.apply(h);}}));this._menuItems.on("mouseenter",function(){h._selected=this;h.showContentIfReady();if(h._manuallyClosed||(h._isFocused&&h._drawerState in a)){h.openDrawer();h._manuallyClosed=false;}}).on("mouseleave",function(){h._selected=null;});this._nonMenuItems.on("mouseenter",function(){h.selected=null;if(h._isFocused){h.closeDrawer();h._manuallyClosed=true;}});}this.debug=!!(~document.location.search.indexOf("debug=valuemenu")||~document.location.search.indexOf("debug=all"));this._trigger("init-done");},showContentIfReady:function(){if(this._drawerState in d&&this._selected){this._log("showing content",this._selected);var i=e(this._selected),l=i.data(this.widgetBaseClass+"section"),h=i.data(this.widgetBaseClass+"panel"),j=i.data(this.widgetBaseClass+"ad"),k=j.find("iframe:eq(0)");h.find("img.no-src").each(function(){this.src=e(this).attr("data-src");}).removeClass("no-src");i.addClass("active").siblings().removeClass("active");this._panels.removeClass("visible").filter(h).addClass("visible");if(j.length&&!k.length||k.data("empty")){!j.data("dcRefreshableAd")?j.dcRefreshableAd({size:j.attr(this.options.attr.adSize),interval:0,customparams:{slot:j.attr(this.options.attr.adSlot)}}):j.dcRefreshableAd("refresh");k.data("empty",false);this._log("AD LOADED");}this._log(i);}},openDrawer:function(){if(this._drawerState in a&&this._selected){this._drawer.trigger("beforeopen");this._drawerState=b;this.showContentIfReady();this._drawer.stop(true,true).slideDown("fast",function(){e(this).trigger("afteropen");});this._drawerState=f;this._log(f);e("#hdr_search .ui-autocomplete:visible").hide();}},closeDrawer:function(){if(!this._selected){this._menuItems.removeClass("active");this._drawer.trigger("beforeclose");this._drawer.stop(true,true).slideUp("fast",function(){e(this).trigger("afterclose");});this._ads.find("iframe:eq(0)").attr("src","about:blank").data("empty",true);this._log(g);this._drawerState=g;}},destroy:function(){this.element.unbind("mouseover.hoverIntent mouseout.hoverIntent");}});}(jQuery));/*! stopgap_end */