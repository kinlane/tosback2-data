var Tumblr=Tumblr||{};Tumblr.SpellChecker={dictionary:[],maxTransforms:1,costMultiplier:1,damerauLevenshteinDist:function(l,k,g){if(typeof(l)!=="string"||typeof(k)!=="string"){return false}if(typeof(g)!="number"){g=99}var f=0,d=0,c=0,n=l.length,m=k.length;if(n===0||m===0){return(Math.abs(n-m)<=g)?Math.max(n,m):false}if(n<m){var e;e=n;n=m;m=e;e=l;l=k;k=e}var h=[];for(f=0;f<=n;f++){h[f]=[];h[f][0]=f}for(d=0;d<=m;d++){h[0][d]=d}for(f=1;f<=n;f++){for(d=1;d<=m;d++){if(l[f-1]==k[d-1]){c=0}else{c=1}h[f][d]=Math.min(h[f-1][d]+1,h[f][d-1]+1,h[f-1][d-1]+c);if(f==1||d==1){continue}if(l[f-1]==k[d-2]&&l[f-2]==k[d-1]){h[f][d]=Math.min(h[f][d],h[f-2][d-2]+c)}}}return(h[n][m]<=g)?h[n][m]:false},returnFunc:function(a){return a.name},suggest:function(b){var a=[],f=0,e=this.damerauLevenshteinDist,d=this.maxTransforms,c=this.returnFunc;this.dictionary.each(function(g){if((f=e(b,g.name,d))!==false){a.push({name:g.name,dist:f,cost:g.cost})}});if(a.length){return a.sortBy(this.sortByFunc,this).map(this.returnFunc)}else{return[]}},sortByFunc:function(c){var b=this.costMultiplier;return(c.dist+c.cost*b)},initialized:false,init:function(d,a){if(!(d instanceof Array)){return false}var c=[];var b;d.each(function(f){var e=typeof(f);if(e==="object"){c.push(f)}else{if(e==="string"){c.push({name:f,cost:0})}}});this.dictionary=c;if(typeof(a)=="object"){for(b in a){if(a.hasOwnProperty(b)&&this.hasOwnProperty(b)){this[b]=a[b]}}}this.initialized=true;return this}};
(function(i,k,a){var e=["webkit","Moz","ms","O"];var p={};var o;function g(q,t){var r=k.createElement(q||"div");var s;for(s in t){r[s]=t[s]}return r}function h(r){for(var q=1,s=arguments.length;q<s;q++){r.appendChild(arguments[q])}return r}var j=function(){var q=g("style");h(k.getElementsByTagName("head")[0],q);return q.sheet||q.styleSheet}();function c(u,q,v,y){var r=["opacity",q,~~(u*100),v,y].join("-");var s=0.01+v/y*100;var x=Math.max(1-(1-u)/q*(100-s),u);var w=o.substring(0,o.indexOf("Animation")).toLowerCase();var t=w&&"-"+w+"-"||"";if(!p[r]){j.insertRule("@"+t+"keyframes "+r+"{0%{opacity:"+x+"}"+s+"%{opacity:"+u+"}"+(s+0.01)+"%{opacity:1}"+(s+q)%100+"%{opacity:"+u+"}100%{opacity:"+x+"}}",0);p[r]=1}return r}function n(u,v){var t=u.style;var q;var r;if(t[v]!==a){return v}v=v.charAt(0).toUpperCase()+v.slice(1);for(r=0;r<e.length;r++){q=e[r]+v;if(t[q]!==a){return q}}}function f(q,s){for(var r in s){q.style[n(q,r)||r]=s[r]}return q}function m(s){for(var q=1;q<arguments.length;q++){var r=arguments[q];for(var t in r){if(s[t]===a){s[t]=r[t]}}}return s}function l(q){var r={x:q.offsetLeft,y:q.offsetTop};while((q=q.offsetParent)){r.x+=q.offsetLeft;r.y+=q.offsetTop}return r}var d={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto"};var b=function b(q){if(!this.spin){return new b(q)}this.opts=m(q||{},b.defaults,d)};b.defaults={};b.prototype={spin:function(x){this.stop();var B=this;var q=B.opts;var r=B.el=f(g(0,{className:q.className}),{position:"relative",zIndex:q.zIndex});var A=q.radius+q.length+q.width;var C;var z;if(x){x.insertBefore(r,x.firstChild||null);z=l(x);C=l(r);f(r,{left:(q.left=="auto"?z.x-C.x+(x.offsetWidth>>1):q.left+A)+"px",top:(q.top=="auto"?z.y-C.y+(x.offsetHeight>>1):q.top+A)+"px"})}r.setAttribute("aria-role","progressbar");B.lines(r,B.opts);if(!o){var u=0;var s=q.fps;var w=s/q.speed;var v=(1-q.opacity)/(w*q.trail/100);var y=w/q.lines;!function t(){u++;for(var D=q.lines;D;D--){var E=Math.max(1-(u+D*y)%w*v,q.opacity);B.opacity(r,q.lines-D,E,q)}B.timeout=B.el&&setTimeout(t,~~(1000/s))}()}return B},stop:function(){var q=this.el;if(q){clearTimeout(this.timeout);if(q.parentNode){q.parentNode.removeChild(q)}this.el=a}return this},lines:function(s,u){var r=0;var q;function t(v,w){return f(g(),{position:"absolute",width:(u.length+u.width)+"px",height:u.width+"px",background:v,boxShadow:w,transformOrigin:"left",transform:"rotate("+~~(360/u.lines*r)+"deg) translate("+u.radius+"px,0)",borderRadius:(u.width>>1)+"px"})}for(;r<u.lines;r++){q=f(g(),{position:"absolute",top:1+~(u.width/2)+"px",transform:u.hwaccel?"translate3d(0,0,0)":"",opacity:u.opacity,animation:o&&c(u.opacity,u.trail,r,u.lines)+" "+1/u.speed+"s linear infinite"});if(u.shadow){h(q,f(t("#000","0 0 4px #000"),{top:2+"px"}))}h(s,h(q,t(u.color,"0 0 1px rgba(0,0,0,.1)")))}return s},opacity:function(r,q,s){if(q<r.childNodes.length){r.childNodes[q].style.opacity=s}}};!function(){var r=f(g("group"),{behavior:"url(#default#VML)"});var q;if(!n(r,"transform")&&r.adj){for(q=4;q--;){j.addRule(["group","roundrect","fill","stroke"][q],"behavior:url(#default#VML)")}b.prototype.lines=function(v,u){var t=u.length+u.width;var B=2*t;function A(){return f(g("group",{coordsize:B+" "+B,coordorigin:-t+" "+-t}),{width:B,height:B})}var w=-(u.width+u.length)*2+"px";var z=f(A(),{position:"absolute",top:w,left:w});var y;function x(C,s,D){h(z,h(f(A(),{rotation:360/u.lines*C+"deg",left:~~s}),h(f(g("roundrect",{arcsize:1}),{width:t,height:u.width,left:u.radius,top:-u.width>>1,filter:D}),g("fill",{color:u.color,opacity:u.opacity}),g("stroke",{opacity:0}))))}if(u.shadow){for(y=1;y<=u.lines;y++){x(y,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(y=1;y<=u.lines;y++){x(y)}return h(v,z)};b.prototype.opacity=function(t,s,v,u){var w=t.firstChild;u=u.shadow&&u.lines||0;if(w&&s+u<w.childNodes.length){w=w.childNodes[s+u];w=w&&w.firstChild;w=w&&w.firstChild;if(w){w.opacity=v}}}}else{o=n(r,"animation")}}();i.Spinner=b})(window,document);
(function(c,b){var a=Backbone.View.extend({el:"body",initialize:function(){this.frame_width=100;this.frame_count=98;this.frame_rate=12;this.freeze_frames=[1,7,20,29,38,47,70,88];this.current_frame=this.freeze_frames[Math.floor(Math.random()*this.freeze_frames.length)]-1;this.is_animating=false;this.animation=false;this.animation_time=false;this.determine_animation_method();this.$loader=this.create_loader()},create_loader:function(){return c('<div id="illustrated_loader" class="illustrated_loader" />')},attach_loader:function(){if(!c("#illustrated_loader").length){this.$el.append(this.$loader)}},determine_animation_method:function(){(function(){var e=0;var f=["ms","moz","webkit","o"];for(var d=0;d<f.length&&!window.requestAnimationFrame;++d){window.requestAnimationFrame=window[f[d]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[f[d]+"CancelAnimationFrame"]||window[f[d]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(k,h){var g=new Date().getTime();var i=Math.max(0,16-(g-e));var j=window.setTimeout(function(){k(g+i)},i);e=g+i;return j}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(g){clearTimeout(g)}}}());this.animation_method=(requestAnimationFrame)?"requestAnimationFrame":"interval"},start_animation:function(){this.attach_loader();this.current_frame=(this.current_frame)?this.current_frame:0;this.set_frame();if(this.animation_method=="interval"){if(this.is_animating){return}this.animation=setInterval(function(){this.next_frame()}.bind(this),1000/this.frame_rate)}else{var d=new Date().getTime(),e=d-(this.animation_time||d);this.animation_time=d;setTimeout(function(){this.animation=requestAnimationFrame(this.start_animation.bind(this));this.next_frame()}.bind(this),1000/this.frame_rate)}this.is_animating=true},stop_animation:function(){if(this.animation_method=="interval"){clearInterval(this.animation)}else{cancelAnimationFrame(this.animation)}this.is_animating=false},next_frame:function(){this.current_frame++;if(_.contains(this.freeze_frames,this.current_frame)){this.stop_animation();setTimeout(this.start_animation.bind(this),500);return}if(this.frame_wait>=this.frame_rate){this.frame_wait=0}if(this.current_frame>=this.frame_count){this.current_frame=0}this.set_frame()},set_frame:function(){this.$loader.css({"background-position":"-"+(this.current_frame*this.frame_width)+"px 0px"})}});b.IllustratedLoader=a})(jQuery,Tumblr);
var SignupProcess=(function(){var V,z,s,p,o,m,b,t,g,Q,T,k,r=false,f=[],M,B,L,a,O,q,x,y;var w=(document.location.protocol==="https:"),E="";b=[{name:"gmail.com",cost:0,share:30.2102985741},{name:"yahoo.com",cost:0,share:26.013029172},{name:"hotmail.com",cost:1,share:18.1002246857},{name:"aol.com",cost:6,share:3.03687405106},{name:"live.com",cost:9,share:2.06294942827},{name:"hotmail.co.uk",cost:10,share:1.95604539045},{name:"aim.com",cost:10,share:1.89339378918},{name:"mail.com",cost:17,share:1.2102985741},{name:"ymail.com",cost:18,share:1.0549753888},{name:"msn.com",cost:32,share:0.609550330148}];g=(window.devicePixelRatio)?true:false;function h(X){var W=X.element();if(W.hasClassName("login")){if(!w){return true}P("signup_account signup_birthday signup_register signup_waiting");c("signup_login")}if(W.hasClassName("signup")){if(!w){return true}if($(document.body).hasClassName("has_login_captcha")){return true}P("signup_login signup_waiting");c("signup_account")}if(W.hasClassName("cancel")){if($(document.body).hasClassName("has_login_captcha")){return true}if($(document.body).hasClassName("already_logged_in")){return true}P()}if(W.hasClassName("logout")){return true}if(W.parentNode.id=="logo"&&!m.current_view){return true}X.stop();return false}function c(W){m.current_view=W;$(document.body).addClassName("show_form").addClassName(W);Tumblr.KeyCommands.suspend();loading_next_page=true;j(W);Tumblr.PlaceHolders.init();x.track_url("/signup?update_view="+W)}function P(W){reset_form=(W===undefined)?true:false;W=W||"show_form signup_account signup_birthday signup_register signup_login signup_waiting slow_motion now";$w(W).each(function(X){$(document.body).removeClassName(X)});if($("signup_button_signup")){$("signup_button_signup").removeClassName("shallow").addClassName("other_blue")}Tumblr.KeyCommands.resume();loading_next_page=false;m.current_view=null;document.activeElement.blur();if(Tumblr.Glass.visible){Tumblr.Glass.hide()}s=null;if(reset_form){n()}if(reset_form){x.track_url("/signup?reset_view")}}function j(X){var Y=$(X),ab,aa,Z;$("signup_forms_submit").removeClassName("changed");s=$$("#"+X+" input");o.action=o.getAttribute("data-secure-ajax-action");l();U();if(R(X)){I();o.action=o.getAttribute("data-secure-action");s=$$('#signup_account input:not("#signup_username")');if($("signup_button_signup")){$("signup_button_signup").addClassName("shallow").removeClassName("other_blue")}if(g){$("signup_username").focus();$("signup_email").focus()}if(m.errors){e(m.errors);m.errors=null}if($(document.body).hasClassName("has_login_captcha")){Recaptcha.create($("recaptcha_public_key").value,"recaptcha_widget",{theme:"custom",custom_theme_widget:"recaptcha_widget",callback:function(){Recaptcha.focus_response_field;$("signup_forms_panel").style.display="none";$("signup_forms_panel").style.display="block"}})}}if(X=="signup_account"){if(g){$("signup_username").focus();$("signup_email").focus()}if(q){if(!O){O=new Tumblr.PasswordStrengthMeter()}else{O.update()}}}if(X=="signup_birthday"){setTimeout(function(){$("signup_age").focus()},500);N($("signup_age"));Y.observe("keyup",function(ad){ab=ad.element();if(ab.hasClassName("signup_age")){N(ab)}});Y.observe("keydown",function(ad){ab=ad.element();if(ab.hasClassName("signup_age")){N(ab)}});Y.observe("keypress",function(ad){ab=ad.element();if(ab.hasClassName("signup_age")){N(ab)}})}if(X=="signup_register"){if(g){setTimeout(function(){$("recaptcha_response_field").focus()},1000)}Recaptcha.create($("recaptcha_public_key").value,"recaptcha_widget",{theme:"custom",custom_theme_widget:"recaptcha_widget",callback:function(){Recaptcha.focus_response_field;$("signup_forms_panel").style.display="none";$("signup_forms_panel").style.display="block"}});Y.observe("keyup",function(){$("signup_forms_submit").addClassName("changed")})}if(X=="signup_waiting"){if(y){var W=new Tumblr.IllustratedLoader();W.start_animation()}else{var ac=new Spinner(m.spinner_opts).spin();$("signup_waiting").appendChild(ac.el)}if($("failed_redirect_link")){$("failed_redirect_link").addClassName("show")}Event.stopObserving(window,"keydown");Event.stopObserving(window,"keyup")}}function U(){$$("#"+m.current_view+" input").each(function(W){W.removeAttribute("disabled")})}function l(){$$("#signup_form input").each(function(W){W.setAttribute("disabled","disabled")})}function I(){$$("#signup_form input").each(function(W){W.removeAttribute("disabled")})}function F(){l();U()}function N(W){label=(W.labels)?W.labels[0]:W.previous();slug=label.children[0];slug.innerHTML=W.value;if(W.value===""){W.addClassName("is_empty");label.addClassName("is_empty")}else{W.removeClassName("is_empty");label.removeClassName("is_empty")}if(parseInt(W.value,10)>29){label.addClassName("years_young").removeClassName("years_old")}else{label.addClassName("years_old").removeClassName("years_young")}}function S(aa){var X=$("signup_form_errors"),Z=aa.length,W,Y;X.innerHTML="";for(Y=Z-1;Y>=0;Y--){W=document.createElement("li");W.className="error";W.innerHTML=aa[Y];X.appendChild(W);x.track_url("/signup?error="+aa[Y].stripTags())}}function e(X){if(X&&X.length){S(X);$("signup_forms").addClassName("has_errors")}if(m.current_view=="signup_register"){Recaptcha.reload()}if(!B){$("signup_forms_container").addClassName("shake").addClassName("animated")}var W=setTimeout(function(){$("signup_forms_container").removeClassName("shake")},500)}function n(){$("signup_form").reset();Tumblr.PlaceHolders.init();K()}function K(){$("signup_forms_container").removeClassName("shake");$("signup_forms").removeClassName("has_errors")}function v(){var X=s.length,aa=[],Z,Y,W;for(W=X-1;W>=0;W--){Z=s[W];if((Z.value===""||(Z.type=="checkbox"&&Z.checked===false))&&Z.getAttribute("data-required")){switch(Z.id){case"signup_email":Y=J(["Don't forget your email address!","You forgot to enter your email address!"]);break;case"signup_password":Y=J(["Don't forget your password!","You forgot to enter your password!"]);break;case"signup_username":Y=J(["Don't forget your username!","You forgot to enter your username!"]);break;case"signup_age":Y=J(["Don't forget to tell us your age!","You forgot to tell us your age."]);break;case"signup_tos":Y=J(["One more thing &ndash; please accept our Terms!","You must accept Tumblr's terms before proceeding."]);break;case"recaptcha_response_field":Y=J(["Don't forget to fill out the Captcha!","Please fill out the Captcha."]);break;default:Y=J(["There was an error. Please try again.","Oops. There was an error. Try again."])}aa.push(__(Y))}}if(aa.length){e(aa);return false}return true}function H(af){if(R(m.current_view)){return true}af=(af.element)?af.element():af;var ah=[],Y=af.value,W;if(af.value!==""){if(af.id=="signup_email"){var aa,ae,ac,ag,ai,X;Tumblr.SpellChecker.init(b,{costMultiplier:0.05});ac=(ae=Y.match(/[^@]+$/))?ae[0]:"";if(!/\@/.test(Y)){W="That's not a valid email address. Please try again."}else{if(Y.toLowerCase().indexOf("@tumblr.com")!=-1){W=J(["That email address is already in use. Please try again.","That email address is already associated with another account."])}else{if(!r&&(aa=Tumblr.SpellChecker.suggest(ac)).length){ai=Y.split("@")[0]+"@"+aa[0];if(ai!=Y){X=__("Oops. Did you mean %1$s ?");email_placeholder="%1$s";ag='<a href="#" id="signup_email_suggestion">'+ai+"</a>";W=X.replace(email_placeholder,ag,"g");r=true}}}}}if(af.id=="signup_password"){if(Y.empty()||Y.blank()){W="Don't forget your password!"}if(O&&O.block_registration_step){W=O.block_registration_step}}if(af.id=="signup_username"){if(Y.endsWith("-")){W="Sorry, your username cannot end with a hyphen. Try again."}if(Y.startsWith("-")){W="Sorry, your username cannot start with a hyphen. Try again."}if(Y.toLowerCase().indexOf("tumblr")!=-1){W="Sorry, your username cannot contain Tumblr. Try another one."}}if(af.id=="signup_age"){var ab=parseInt(Y);var ad=new String(ab);var Z=Y.replace(/^\s+|\s+$/g,"");if(!(ad==Z)){W="Please enter your age as a number only!"}else{if(ab<1){W="Please enter a number!"}}}if(W){ah.push(__(W))}}if(ah.length){e(ah);return false}K();return true}function A(){for(var W=s.length-1;W>=0;W--){if(!H(s[W])){return false}}return v()}function C(){K();if(R(m.current_view)){o.submit();return true}else{if(A()){I();o.request({parameters:{action:m.current_view,tracking_url:T,tracking_version:Q,form_key:E},onFailure:function(W){W=JSON.parse(W.responseText);if(W.redirect){x.track_url("/signup?error=redirect");window.location.replace(W.redirect)}else{e(W.errors)}if(m.current_view=="signup_register"){x.track_url("/regi_fail"+k)}},onSuccess:function(W){W=JSON.parse(W.responseText);if(W.signup_success){x.track_url("/regi_success"+k)}if(W.redirect){c("signup_waiting");window.location.replace(W.redirect)}else{c($(m.current_view).next().id)}}})}}}function D(W){if(W.target.id=="signup_email_suggestion"){$("signup_email").value=W.target.innerHTML;$("signup_password").focus();K();W.stop()}}function u(){var W=document.activeElement,X=(s)?s.length-1:false;if(W&&X&&s[X]){return(W.id==s[X].id)?true:false}return}function d(){if(document.body.hasClassName("signup_login")){SignupProcess.update_view("signup_login")}else{if(document.body.hasClassName("signup_account")){SignupProcess.update_view("signup_account")}else{if(document.body.hasClassName("signup_waiting")){SignupProcess.update_view("signup_waiting")}}}}function G(){var W=$("signup_subhead"),X=$("signup_subhead_content"),Y;if(!W){return}Y=W.getWidth();if(X.getWidth()>Y){W.addClassName("medium");setTimeout(function(){if(X.getWidth()>Y){W.addClassName("small").removeClassName("medium");setTimeout(function(){if(X.getWidth()>Y){W.addClassName("infinitesimal").removeClassName("small")}},0)}},0)}}function i(){t=$$(".like_button, .reblog_button, .everyone_i_follow, .my_posts, .send_to_signup")}function R(W){return(W==="signup_login")}function J(W){if(!W.length){return}var Y=W.length,X=Math.floor(Math.random()*Y);return W[X]}return{initialize:function(W){W=W||{};y=W.use_illustrated_loader||false;E=document.getElementById("tumblr_form_key").getAttribute("content");M=document.body.className.match("is_login_register");M=(M&&M.length)?true:false;L=(document.body.hasClassName("is_tablet"));a=(document.body.hasClassName("is_mobile_handset"));B=(L||a);q=(document.body.hasClassName("show_password_strength"));o=$("signup_form");p=$("signup_forms_submit");V=$$(".signup_buttons .login_signup_button, #logo");z=$$(".signup_view");signup_form_fields=$$("#signup_form input");m=this;Q="modal";T=document.location.pathname;k="?url="+T+"&version="+Q;i();x=new Tumblr.OnboardingBehaviors();Event.observe(document,"click",function(X){if(t.indexOf(X.target)!==-1){var Y=document.getElementById("signup_button_signup");if(Y){Y.click()}X.stop()}});if(!M&&o){V.each(function(X){Event.observe(X,"click",h)});Event.observe(window,"keydown",function(X){f[X.keyCode]=1;if(f[16]){$(document.body).addClassName("slow_motion")}if(f[17]&&f[18]&&f[76]){$(document.body).removeClassName("slow_motion");c("signup_login");f=[];return false}});Event.observe(window,"keyup",function(X){f[X.keyCode]=0;if(X.keyCode==16){$(document.body).removeClassName("slow_motion")}if(X.keyCode==27){if($(document.body).hasClassName("lite")){return}if($(document.body).hasClassName("already_logged_in")){window.location="/dashboard"}else{P()}}})}if(o){signup_form_fields.each(function(X){Event.observe(X,"change",H)});Event.observe(o,"submit",function(X){X.stop();C()});Event.observe(o,"keydown",function(X){if(X.keyCode==9&&!X.shiftKey){if(u()){X.stop()}}if(X.keyCode==13){X.stop();C()}});Event.observe($("signup_form_errors"),"click",D);Event.observe(p,"click",function(){C()});Event.observe("signup_forms_container","scroll",function(X){$("signup_forms_container").scrollLeft=0});d();if(m.errors){e(m.errors);m.errors=null}}G()},update_send_to_signup_links:i,reset_view:function(){P()},update_view:function(W){P();c(W)},current_view:null,spinner_opts:{lines:16,length:11,width:4,radius:17,color:"#fff",speed:0.9,trail:34,shadow:false,hwaccel:false,className:"signup_waiting_spinner spinner",zIndex:2000000000,top:"50",left:"auto"}}})();
(function(b,a){var c=Backbone.View.extend({el:"body",events:{},initialize:function(){b("#signup_form input").on("focus",function(d){if(!this.tracking_events){this.start_tracking_events();this.tracking_events=true}}.bind(this))},tracking_events:false,track_url:function(d){d=encodeURI(d.toLowerCase().replace(/ /g,"-"));if(_gaq){_gaq.push(["_trackPageview",d])}},start_tracking_events:function(){b("body").on("click",function(d){var e=d.currentTarget,f=e.nodeName;f+=(e.id.length)?"-"+e.id:"";f+=(e.className.length)?"-"+e.className:"";this.track_url("/signup?clicked="+f)}.bind(this));b(window).on("keyup",function(d){if(d.keyCode==27){this.track_url("/signup?keypress=esc")}}.bind(this))}});a.OnboardingBehaviors=c})(jQuery,Tumblr);
