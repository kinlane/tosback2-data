/* help_modal_template.js */
if(typeof($help_support)!="object"){$help_support={}}$help_support.modal_html='<div id="inline_support_modal_container" class="modal_alert big support_modal popover belowscreen"> <hr style="display:none" /><!-- HR tag is a fix for IE bug where inline styles are not processed when added by prototype.js --> <style type="text/css"> #inline_support_modal_container { border: none; padding: 0; margin-left: -300px; /* override left margin since this has less padding than usual */ -webkit-box-shadow: 0 1px 30px rgba(0,0,0,0.85); -moz-box-shadow: 0 1px 30px rgba(0,0,0,0.85); box-shadow: 0 1px 30px rgba(0,0,0,0.85); padding: 7px; background: #fff url(\'/images/airmail_stripes.png\') top left repeat; background: -webkit-linear-gradient(bottom, rgba(0, 0, 0, 0.18) 0px, rgba(0, 0, 0, 0) 50px), #fff url(\'/images/airmail_stripes.png\') top left repeat; } #inline_support_modal_container.modal_is_visible{ top: 50%; margin-top: -234px; } #inline_support_container{ border-radius: 6px; padding: 32px 25px 25px; background: white; background: -webkit-linear-gradient(bottom, rgba(0, 0, 0, 0.18) 0px, rgba(255, 255, 255, 0) 50px), white; background-position-y: 0; background-position-y: 4px, 0; background-repeat: repeat; background-repeat: repeat-x, repeat; } .support_form{ text-align: initial; text-align: start; position: relative; font-size: 16px; } .support_form label, .support_form input, .support_form textarea, .support_form select { font-family: \'Helvetica Neue\', Helvetica, Arial, sans-serif; } .support_form label{ text-transform: uppercase; font-size: 12px; font-weight: bold; color: #7d7d7d; display: inline-block; min-width: 70px; max-width: 250px; /* position: relative; */ /* right: 12px; */ white-space: nowrap; } .support_form.english label { text-align: right; } .support_inputs_container{ display: block; border: 1px solid #ccc; width: 100%; border-radius: 6px; } .support_form .oneline_option input{ box-sizing: border-box; } .support_form .halfline_option input{ min-width: 185px; max-width: 400px; } /* redundancy because this is resized for internationalization */ .support_form .wholeline_option input{ width: 400px; min-width: 380px; max-width: 400px; } .support_form .user_info_container{ margin: 16px 0 0; } .support_form .error{ position: absolute; right: 100px; background-color: lightPink; border: 1px solid red; border-radius: 6px; } .blog_container { padding-top: 10px; } .select_wrapper .arrow-down { display: inline-block; padding-bottom: 5px; margin-left: -10px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 5px solid #000; z-index: 0; pointer-events: none; } .select_wrapper { display: inline-block; } .blog_container select { -webkit-appearance: button; -moz-appearance: button; -webkit-border: 0; -moz-border: 0; -webkit-box-shadow: 0; -moz-box-shadow: 0; -webkit-padding-start: 2px; -webkit-padding-end: 20px; width: 456px; z-index: 1; } .support_form .user_info_container input, .support_form #support_form_subject, .support_form .blog_container select, .support_form .scrollable_container textarea{ -moz-box-sizing: border-box; /* see: BUG 243412: https://bugzilla.mozilla.org/show_bug.cgi?id=243412 */ box-sizing: border-box; border: none; background: none; font-size: 16px; /* position: relative; */ /* left: -3px; */ } .support_form .oneline_option{ border-bottom: 1px solid #e5e5e5; box-sizing: border-box; whitespace: no-wrap; } .support_form .halfline_option{ min-width: 260px; max-width: 100%; float: left; margin: 0 0 10px; white-space: nowrap; } .support_form .wholeline_option{ width: 100%; } .support_form .subject_container{ padding: 1px 0 0; } .support_form .scrollable_container{ margin: 0; overflow:hidden; height: 1080px; background: #fff url(\'/images/textarea_bkgd_lines.png\'); line-height: 36px; font-size: 14px; } #support_form_body_container{ overflow-x: hidden; overflow-y: scroll; height: 252px; padding: 0; margin: 0 0 25px; } #support_form_body_label { padding: 7px 0 0; } .support_form textarea{ padding: 0 6px 6px 0; width: 436px; resize: none; height: 1000px; vertical-align: text-top; line-height: 36px; overflow: hidden; margin: -11px 2px 0; } .support_form textarea.is_safari{ margin-top: -2px !important; } /* .support_form textarea:first-line{ line-height: 32px; } */ #support_category{ float:left; } .support_form .form_controls{ float: left; } .support_form .upload_file input{ padding: 1px; line-height: initial; white-space: initial; } .support_form .upload_file{ float: right; } .support_form .gibson{ font-family: Gibson, Helvetica Neue, Helvetica, sans-serif; text-align: center; font-weight: bold; font-size: 28px; padding: 0; margin: 0 auto; color: #000; whitespace: nowrap; height: 20px; max-width: 536px; min-width: 400px; } .support_form .gibson h2{ font-family: Gibson, Helvetica Neue, Helvetica, sans-serif; text-align: center; font-weight: bold; font-size: 28px; padding: 0; margin: 0; letter-spacing: 9px; text-transform: uppercase; color: #000; whitespace: nowrap; height: 20px; max-width: 536px; display: inline-block; } .support_form .bottom_row{ padding-top: 3px; } .support_form .chrome{ height: 33px; font-size: 15px; } .support_form #reply_to_email_container { margin-right: 10px; } .support_form #support_form_submit { padding-right: 13px; padding-left: 13px; } .support_form #support_form_cancel { padding-right: 12px; padding-left: 12px; } .support_form ol{ list-style-type: none; padding: 0; margin: 0; } .support_form .background_wrapper{ -webkit-transition: all .25s; -moz-transition: all .25s; -o-transition: all .25s; transition: all .25s; border-radius: 6px; padding: 4px; margin: 0; } #support_form_error_container{ border: 1px solid #fcc; border-radius: 6px; background-color: #efefef; margin: 0; padding: 0; opacity: 0; max-height: 0; overflow: hidden; -webkit-transition-property: max-height, opacity, margin; -webkit-transition-duration: 0.5s; -webkit-transition-timing-function: ease; -moz-transition-property: max-height, opacity, margin; -moz-transition-duration: 0.5s; -moz-transition-timing-function: ease; -o-transition-property: max-height, opacity, margin; -o-transition-duration: 0.5s; -o-transition-timing-function: ease; transition-property: max-height, opacity, margin; transition-duration: 0.5s; transition-timing-function: ease; } .delay { -webkit-transition-delay: 1.0s; -moz-transition-delay: 1.0s; -o-transition-delay: 1.0s; transition-delay: 1.0s; } #support_form_error_container.has_errors{ max-height: 300px; margin-bottom: 15px; opacity: 1; overflow: auto; } .support_form .enumerated_errors{ list-style-type: none; margin: 0; } .support_form .enumerated_errors li{ margin: 0; opacity: 0; max-height: 0; overflow: hidden; -webkit-transition-property: max-height, opacity, margin; -webkit-transition-duration: 0.5s; -webkit-transition-timing-function: ease; -moz-transition-property: max-height, opacity, margin; -moz-transition-duration: 0.5s; -moz-transition-timing-function: ease; -o-transition-property: max-height, opacity, margin; -o-transition-duration: 0.5s; -o-transition-timing-function: ease; transition-property: max-height, opacity, margin; transition-duration: 0.5s; transition-timing-function: ease; } .support_form .enumerated_errors li.is_error{ opacity: 1; max-height: 100px; margin: 5px; } /* .support_form .background_wrapper.active{ background: #fff; border-radius: 6px; -webkit-box-shadow: 0 5px 11px rgba(0,0,0, 0.5); -moz-box-shadow: 0 5px 11px rgba(0,0,0, 0.5); box-shadow: 0 5px 11px rgba(0,0,0, 0.5); padding: 6px; } */ </style> <div class="support_form" id="inline_support_container"> <div> <div class="enter_info"> <div class="gibson"> <h2 id="inline_support_form_header" class="gibson" data-str_key="contact_tumblr" style="display: inline-block;">Contact Tumblr</h2> </div> <form id="inline_support_form" action="/support/ticket/new" src="" method="POST" enctype="multipart/form-data"> <iframe id="support_form_target" name="support_form_target" style="width:0;height:0;border:none;margin:0;padding:0;"></iframe> <input type="hidden" name="jsonp" value="help_modal.evaluate_response"> <input type="hidden" name="support_type" id="support_form_support_type" value=""> <input type="hidden" name="form_key" id="support_form_form_key" value=""> <div class="resizeable_options"> <div class="user_info_container"> <div class="required oneline_option halfline_option" id="reply_to_email_container"> <label for="support_form_user_email" data-str_key="support_form_user_email_label">Email</label> <input type="email" id="support_form_user_email" name="user_email" value="" placeholder="you@example.com" required data-has_placeholder="true" data-str_key="support_form_user_email_placeholder"> </div> <div class="required oneline_option halfline_option" id="reply_to_name_container"> <label for="support_form_user_name" style="text-align: left; min-width:48px;" data-str_key="support_form_user_name_label">Name</label> <input type="text" id="support_form_user_name" name="user_name" value="" placeholder="Your name" required data-has_placeholder="true" data-str_key="support_form_user_name_placeholder"> </div> <div class="clearfix" style="clear:both;"></div> </div> <div class="subject_container"> <div class="required oneline_option wholeline_option"> <label for="support_form_subject" data-str_key="support_form_subject_label">Subject</label> <input id="support_form_subject" name="subject" required data-has_placeholder="true" data-str_key="support_form_subject_placeholder" value=""> </div> <div class="clearfix" style="clear:both;"></div> </div> <div class="blog_container" style="display: none;" id="blog_container"> <div class="oneline_option wholeline_option"> <label for="support_form_blog" id="support_form_blog_label" data-str_key="support_form_blog_label">Blog</label> <div class="select_wrapper"><select name="support_form_blog" id="support_form_user_blogs"> <option value="n/a">N/A</option> </select><div class="arrow-down"></div></div> </div> <div class="clearfix" style="clear:both;"></div> </div> <div class="required support_option" id="support_form_body_container"> <div class="scrollable_container"> <label for="support_form_body" id="support_form_body_label" data-str_key="support_form_body_label">Details</label> <textarea id="support_form_body" name="body" required data-has_placeholder="true" data-str_key="support_form_body_placeholder"></textarea> </div> </div> </div> <div id="support_form_error_container"> <div class="form_field_errors"> <ul class="enumerated_errors"> </ul> </div> </div> <div class="bottom_row"> <div class="upload_file" id="file_upload_container"> <label for="attachments_01" style="position:fixed; top:-500px; left:-500px; opacity: 0;" data-str_key="support_form_upload_file_label">Attach a screenshot</label> <div class="background_wrapper"> <ol> <li class="single_file"> <input type="file" name="attachments[]" id="attachments_01" accept="image/gif,image/jpeg,image/jpg,image/png" > </li> </ol> <a href="#" onclick="window.help_modal.add_another_photo(this); return false;" style="font-size: 10px; display: none;" data-str_key="support_form_upload_file_label">Add another photo.</a> </div> </div> <div class="form_controls"> <input id="support_form_submit" type="submit" class="chrome blue" style="margin: 0 6px 0 0;" value="Send" data-str_key="support_form_submit"> <input id="support_form_cancel" type="button" class="chrome clear" style="margin: 0;" value="Nevermind" onclick="help_modal.hide()" data-str_key="support_form_cancel"> </div> <div class="clearfix" style="clear:both;"></div> </div> </form> </div> <div class="success" id="inline_support_success"> </div> </div> <div class="clearfix" style="clear:both;"></div> </div> </div> ';
/* help_modal.js */
var PopoverAlert=function(b){var a=this;a.popover=b;a.on_show=function(){};a.on_hide=function(){};a.on_accept=function(){a.hide()};a.on_cancel=function(){};Event.observe(a.popover,"click",function(d){var c=d.element();if(c.id=="modal_alert_accept_button"){a.on_accept()}if(c.id=="modal_alert_cancel_button"){a.on_cancel()}})};PopoverAlert.prototype.show=function(){var a=this;Tumblr.Glass.show(null,"dark");a.popover.removeClassName("belowscreen").removeClassName("abovescreen").addClassName("up").addClassName("modal_is_visible");$(document.body).addClassName("popover_alert_active");a.on_show()};PopoverAlert.prototype.hide=function(){var a=this;Tumblr.Glass.hide();a.popover.addClassName("abovescreen").removeClassName("up").removeClassName("belowscreen").removeClassName("modal_is_visible");$(document.body).removeClassName("popover_alert_active");a.on_hide()};PopoverAlert.prototype.cancel=function(){var a=this;a.on_cancel()};var PopoverAlertWithForm=function(b){var a=this;a.on_submit=function(){};a.on_failure=function(){alert(l10n_str.ajax_error)};a.on_success=function(){a.hide()};a.form=b.querySelector("form");a.form.onsubmit=function(){a.on_submit();a.form.request({onFailure:function(){a.on_failure()},onSuccess:function(){a.on_success()}});return false};PopoverAlert.call(a,b);Event.observe(a.popover,"click",function(d){var c=d.element();if(c.id=="modal_alert_submit_button"){d.stop();a.form.onsubmit()}})};PopoverAlertWithForm.prototype=Object.create&&Object.create(PopoverAlert.prototype)||Object.extend({},PopoverAlert.prototype);PopoverAlertWithForm.prototype.constructor=PopoverAlertWithForm;document.observe("dom:loaded",function(){if(typeof(help_modal)=="undefined"){help_modal={}}window.help_modal.create=function(e){e=e||{};window.help_modal=new PopoverAlertWithForm((function(){document.body.insert($help_support.modal_html);var i=$("inline_support_modal_container");return i}()));var d=null;var g=function(){if(!d){return}d=null;window.help_modal.form.querySelector("#support_form_submit").enable();alert(l10n_str.ajax_error)};var f=function(){var i,j;if((i=$("inline_support_form"))){j=i.down("#support_form_target");j.stopObserving("load");j.observe("load",function(k){if(d){clearTimeout(d);d=null}try{if(window.help_modal.form.down("#support_form_target").contentWindow.document.body.id!="support_modal_response"){window.help_modal.form.querySelector("#support_form_submit").enable();alert(l10n_str.ajax_error)}}catch(l){d=setTimeout(g,3000)}})}};var h=window.help_modal;h.context=e.context||{};h.dont_show_on_create=e.dont_show_on_create||false;if(typeof(e.subject)!="undefined"){$("support_form_subject").value=e.subject}h.on_show=function(){Event.observe(document,"keydown",function(i){if(Event.KEY_ESC==i.keyCode){h.hide()}})};h.show=function(j){var k;var i=this;h.show_tos_after=false;if((k=$("popover_alert_tos_container"))&&typeof(LegalPrompts)!="undefined"&&LegalPrompts.popover_alert_tos.popover.hasClassName("modal_is_visible")){LegalPrompts.popover_alert_tos.hide();h.show_tos_after=true}j=j||{};if(j.type){window.help_modal.set_category(j.type)}setTimeout(function(){PopoverAlertWithForm.prototype.show.call(i)},1)};h.on_hide=function(){if(typeof(h.show_tos_after)!="undefined"&&h.show_tos_after){setTimeout(function(){LegalPrompts.popover_alert_tos.show.call(LegalPrompts.popover_alert_tos)},1)}};h.form.onsubmit=function(i){window.help_modal.form.target="support_form_target";window.help_modal.form.querySelector("#support_form_submit").disable();f()};h.set_category=function(i){if(i){window.help_modal.form.querySelector("input[name=support_type]").value=i}};var c=e.type||"";h.set_category(c);var b=document.createElement("input");h.use_placeholders=("placeholder" in b);h.localize=function(){var m=h.popover.querySelectorAll("*[data-str_key], input, select");var v,j,A,t,C,u=m.length;for(v=0;v<u;v+=1){j=m[v];A=j.getAttribute("data-str_key");t=help_modal.context[A];C=help_modal.context[j.id];if(t){if(j.hasAttribute("data-has_placeholder")){j.placeholder=t}else{if(j.tagName.toLowerCase()=="input"){j.value=t}else{j.innerHTML=t}}}if(C&&C.constructor==Array&&j.options){if(C.length){for(var s in C){if(C.hasOwnProperty(s)){j.options[j.options.length]=new Option(C[s],C[s])}}var q=document.getElementById("blog_container");if(q){q.style.display="block"}}}else{if(C){j.value=C}}}var y=$("inline_support_container").getLayout();var k=y.get("padding-box-width")-y.get("padding-left")-y.get("padding-right");var r;var B=$("inline_support_form_header");var o=0;var n,p;var z=$$("#inline_support_modal_container .resizeable_options label");var x=0;r=(B.getDimensions()).width;while(r>=k){n=parseInt(B.getStyle("letter-spacing").match(/[0-9]+/),10);p=parseInt(B.getStyle("font-size").match(/[0-9]+/),10);p-=1;n-=1;if(n<0){n=0}B.setStyle({"font-size":p+"px","letter-spacing":n+"px"});r=(B.getDimensions()).width;if(++o>15){break}}z.each(function(i){var l=(i.getDimensions()).width;if(l>x){x=l}});if(x<=71){return}z.each(function(i){var l=i.up("div");var w=l.down("input, textarea, select");l.setStyle({width:k+"px"});i.style.minWidth=null;r=(k-(i.getDimensions()).width);if(w.id=="support_form_body"){r-=10}w.setStyle({width:r+"px"})})};h.localize();h.add_another_photo=function(j){j=$(j);var k=j.up(".upload_file");var i=k.down(".single_file:last").clone(true);var l=i.down("input").getAttribute("id").substr[-2];l+=1;i.down("input").writeAttribute({id:"attachments_"+(l<10?"0"+l:l)});k.down("ol").insert({bottom:i})};var a=function(j){var i=$$("#error_"+j.target.name);i.invoke("removeClassName","is_error");setTimeout(function(){j.target.stopObserving("focus",a)},1);var k=$("support_form_error_container");if(!k.down(".is_error")){k.removeClassName("delay");k.removeClassName("has_errors")}};h.evaluate_response=function(n){clearTimeout(d);d=null;$("support_form_submit").enable();if(typeof(n.meta)=="undefined"||typeof(n.response)=="undefined"){alert(l10n_str.ajax_error)}if(n.meta.status==201||n.meta.status==200){$("inline_support_success").innerHTML=n.response.message;window.help_modal.show_success();return}var m,k,o,q=false;var p=n.response.errors;var j;var l=$("support_form_error_container").down("ul");while(l.hasChildNodes()){l.removeChild(l.lastChild)}if(!p.length){return}for(m=0,k=p.length;m<k;m+=1){j=$$(".support_form [name="+p[m].name+"]");if(j&&j.length){j=j.first()}else{q=true;break}j.observe("focus",a);o=new Element("li",{id:"error_"+p[m].name});o.innerHTML=p[m].error;o.addClassName("is_error");l.insert(o)}if(q){alert(l10n_str.ajax_error);return}$("support_form_error_container").addClassName("delay").addClassName("has_errors");$("inline_support_modal_container").addClassName("animated").addClassName("shake");setTimeout(function(){$("inline_support_modal_container").removeClassName("animated").removeClassName("shake")},1250)};h.show_success=function(i){help_modal.form.reset();$("inline_support_container").down(".enter_info").hide();$("inline_support_container").down(".success").show();setTimeout(function(){help_modal.hide()},3000)};h.form.observe("click",function(k){var j=this;var i=k.findElement(".upload_file");if(typeof(i)=="undefined"||i==document){i=j.down(".upload_file");i.setStyle({overflow:"hidden"});i.down(".background_wrapper").removeClassName("active")}else{i.down(".background_wrapper").addClassName("active");i.setStyle({overflow:"visible"})}});if(!h.dont_show_on_create){h.show()}};window.help_modal.show=function(a){window.help_modal.create(a)}});