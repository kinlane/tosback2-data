(function(a){var f=[];var g=false;var c=[];var j={screenLockerBackground:"#000",screenLockerOpacity:"0.5"};a.setupJMPopups=function(m){j=jQuery.extend(j,m);return this};a.openPopupLayer=function(m){if(typeof(m.name)!="undefined"&&!b(m.name)){m=jQuery.extend({width:"auto",height:"auto",parameters:{},target:"",success:function(){},error:function(){},beforeClose:function(){},afterClose:function(){},reloadSuccess:null,cache:false},m);e(m,true);return this}};a.closePopupLayer=function(n){if(n){for(var m=0;m<f.length;m++){if(f[m].name==n){var o=f[m];f.splice(m,1);o.beforeClose();a("#popupLayer_"+n).fadeOut(function(){a("#popupLayer_"+n).remove();c.pop();if(c.length>0){a(c[c.length-1]).focus()}o.afterClose();d(n)});break}}}else{if(f.length>0){a.closePopupLayer(f[f.length-1].name)}}return this};a.reloadPopupLayer=function(o,m){if(o){for(var n=0;n<f.length;n++){if(f[n].name==o){if(m){f[n].reloadSuccess=m}e(f[n],false);break}}}else{if(f.length>0){a.reloadPopupLayer(f[f.length-1].name)}}return this};function i(){if(g){a("#popupLayerScreenLocker").height(a(document).height()+"px");a("#popupLayerScreenLocker").width(a(document.body).outerWidth(true)+"px")}}function b(n){if(n){for(var m=0;m<f.length;m++){if(f[m].name==n){return true}}}return false}function l(){if(a("#popupLayerScreenLocker").length){if(f.length==1){g=true;i();a("#popupLayerScreenLocker").fadeIn()}if(a.browser.msie&&a.browser.version<7){a("select:not(.hidden-by-jmp)").addClass("hidden-by-jmp hidden-by-"+f[f.length-1].name).css("visibility","hidden")}a("#popupLayerScreenLocker").css("z-index",parseInt(f.length==1?999:a("#popupLayer_"+f[f.length-2].name).css("z-index"))+1)}else{a("body").append("<div id='popupLayerScreenLocker'><!-- --></div>");a("#popupLayerScreenLocker").css({position:"absolute",background:j.screenLockerBackground,left:"0",top:"0",opacity:j.screenLockerOpacity,display:"none"});l();a("#popupLayerScreenLocker").click(function(){a.closePopupLayer()})}}function d(m){if(f.length==0){screenlocker=false;a("#popupLayerScreenLocker").fadeOut()}else{a("#popupLayerScreenLocker").css("z-index",parseInt(a("#popupLayer_"+f[f.length-1].name).css("z-index"))-1)}if(a.browser.msie&&a.browser.version<7){a("select.hidden-by-"+m).removeClass("hidden-by-jmp hidden-by-"+m).css("visibility","visible")}}function h(p,m){if(p){if(p.width()<a(window).width()){var o=(document.documentElement.offsetWidth-p.width())/2}else{var o=document.documentElement.scrollLeft+5}if(p.height()<a(window).height()){var r=document.documentElement.scrollTop+(a(window).height()-p.height())/2}else{var r=document.documentElement.scrollTop+5}var q={left:o+"px",top:r+"px"};if(!m){p.css(q)}else{p.animate(q,"slow")}i()}else{for(var n=0;n<f.length;n++){h(a("#popupLayer_"+f[n].name),true)}}}function k(u,s,m){var n="popupLayer_"+u.name;if(s){l();a("body").append("<div id='"+n+"'><!-- --></div>");var v=parseInt(f.length==1?1000:a("#popupLayer_"+f[f.length-2].name).css("z-index"))+2}else{var v=a("#"+n).css("z-index")}var t=a("#"+n);t.css({visibility:"hidden",width:u.width=="auto"?"":u.width+"px",height:u.height=="auto"?"":u.height+"px",position:"absolute","z-index":v});var q="<a href='#' class='jmp-link-at-top' style='position:absolute; left:-9999px; top:-1px;'>&nbsp;</a><input class='jmp-link-at-top' style='position:absolute; left:-9999px; top:-1px;' />";var p="<a href='#' class='jmp-link-at-bottom' style='position:absolute; left:-9999px; bottom:-1px;'>&nbsp;</a><input class='jmp-link-at-bottom' style='position:absolute; left:-9999px; top:-1px;' />";t.html(q+m+p);h(t);t.css("display","none");t.css("visibility","visible");if(s){t.fadeIn()}else{t.show()}a("#"+n+" .jmp-link-at-top, #"+n+" .jmp-link-at-bottom").focus(function(){a(c[c.length-1]).focus()});var o=a("#"+n+" a:visible:not(.jmp-link-at-top, .jmp-link-at-bottom), #"+n+" *:input:visible:not(.jmp-link-at-top, .jmp-link-at-bottom)");if(o.length==0){var r="<a href='#' class='jmp-link-inside-popup' style='position:absolute; left:-9999px;'>&nbsp;</a>";t.find(".jmp-link-at-top").after(r);c.push(a(t).find(".jmp-link-inside-popup")[0])}else{o.each(function(){if(!a(this).hasClass("jmp-link-at-top")&&!a(this).hasClass("jmp-link-at-bottom")){c.push(this);return false}})}a(c[c.length-1]).focus();u.success();if(u.reloadSuccess){u.reloadSuccess();u.reloadSuccess=null}}function e(n,m){if(m){f.push(n)}if(n.target!=""){k(n,m,a("#"+n.target).html())}else{a.ajax({url:n.url,data:n.parameters,cache:n.cache,dataType:"html",method:"GET",success:function(o){k(n,m,o)},error:n.error})}}a(window).resize(function(){i();h()});a(document).keydown(function(m){if(m.keyCode==27){a.closePopupLayer()}})})(jQuery);