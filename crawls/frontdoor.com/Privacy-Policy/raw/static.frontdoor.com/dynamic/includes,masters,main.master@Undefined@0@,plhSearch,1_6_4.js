var $SearchForm=$(document.forms["searchform"]);var $SuggestContainer=$('#suggest', $SearchForm);var $OopsContainer=$('#oops_wrapper', $SearchForm);var $WebOopsContainer=$('#weboops_wrapper', $SearchForm);var $SearchBarType=$('#sb', $SearchForm);var txtSearchTextbox_Timer;var SearchTypeEnum={Sales : 'Sales',Rentals : 'Rentals',Content : 'Content',Agent : 'AgentDirectory'};var DefaultSearchText={Sales: 'Search for Address, City, State OR Zip Code',Rentals: 'Search for Address, City, State OR Zip Code',Content: 'Search for Articles & Videos',Agent: 'Search for City, State, Zip Code or Agent Name'}
$('body').live('click', function() {CloseSuggest(); OOpsClose();});function SetSearchVariables(e) {if(!e) e=window.event;var newFormId=$(e.target||e.srcElement).parents('form:first').attr('id');if($SearchForm.attr('id')!=newFormId){CloseSuggest(); OOpsClose();}
$SearchForm=$(document.forms[newFormId]);$SuggestContainer=$('#suggest', $SearchForm);$OopsContainer=$('#oops_wrapper', $SearchForm);$WebOopsContainer=$('#weboops_wrapper', $SearchForm);$SearchBarType=$('#sb', $SearchForm);}
function CheckText(ele) {if(trim(ele.value)==DefaultSalesSearchText) {ele.value="";}}
function FoeSearch(string) {$('#txtSearch', $SearchForm).val(string);}
function FoeContentSearch(string) {$('#txtContentSearch', $SearchForm).val(string);}
function ArticleSearch(term) {DoSearchContentSmall1(term);}
function ContentKeyDown(e, ele, CurrentSearchForm) {if(!(typeof(CurrentSearchForm)=='undefined'||CurrentSearchForm==null)) {$SearchForm=$(CurrentSearchForm);}
if($OopsContainer.is(':visible')) {return false;}
var val=ele.value;if(window.event) {keynum=e.keyCode;}
else if(e.which) {keynum=e.which;}
switch (keynum) {case 13:DoSearchContentSmall($SearchForm);break;default:return true;break;}}
function DoSearchContentSmall1(term) {if(trim(term).length<3) {var strURL=String.format("{0}Controls/AjaxCalls/GetTop10ArticleSearches.aspx", WebRoot);$AJAX.GetForDelegate(function(AjaxResponse) {OOps(String.format("<p class='top'>Please enter a term or phrase into the search field.</p><p class='b'>Top Searches:</p>{0}", AjaxResponse));}, strURL);}else{var strURL=String.format("{0}Controls/AjaxCalls/ContentSearchBar.aspx?N=0&Ntk=ArticleSearch&Ntt={1}&sid={2}",WebRoot,EncodeSearchString(escape(term)),sid);$AJAX.GetForDelegate(function(AjaxResponse) { eval(AjaxResponse); }, strURL);}}
function DoSearchContentSmall(theForm) {var term=$('#txtContentSearch', theForm).val();if(trim(term).length<3) {var strURL=String.format("{0}Controls/AjaxCalls/GetTop10ArticleSearches.aspx", WebRoot);$AJAX.GetForDelegate(function(AjaxResponse) {OOps(String.format("<p class='top'>Please enter a term or phrase into the search field.</p><p class='b'>Top Searches:</p>{0}", AjaxResponse));}, strURL);}else{var strURL=String.format("{0}Controls/AjaxCalls/ContentSearchBar.aspx?N=0&Ntk=ArticleSearch&Ntt={1}&sid={2}",WebRoot,EncodeSearchString(escape(term)),sid);$AJAX.GetForDelegate(function(AjaxResponse) { eval(AjaxResponse); }, strURL);}}
function DoSearchWebID(theForm) {var SearchType="sale";var NavQuery=new Array();NavQuery.push(saleID);var QueryString="N="+NavQuery.join("+");var txtSearch=$('#txtIDSearch', theForm).val();if(txtSearch==""||txtSearch=="Enter ID") {WebOOps("Please enter a Web ID into the mobile search field.");return false;}else{txtSearch=EncodeSearchString(txtSearch.replace(' ', ''));QueryString+=String.format("&Ntt={0}&Ntk=IdMLS&Ntx=mode matchall", txtSearch);var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?SearchType="+SearchType+"&txtIDSearch="+txtSearch+"&"+QueryString;}
var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {eval(AjaxResponse);}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function DoSearchSalesSmall(theForm) {var SearchType="sale";var beds="0";var pnum1=0;var pnum2=99000000;var txtSearch="";var qrystr="";var qryPrice="";var els=theForm.elements;txtSearch=EncodeSearchString(trim($('#txtSearch', theForm).val()));var sb=$('#sb', theForm).val();var NavQuery=new Array();NavQuery.push(saleID);CloseSuggest();if($('#EndecaId', theForm).val().length>0) {NavQuery.push($('#EndecaId', theForm).val());}
var QueryString="N="+NavQuery.join("+");txtSearch=trim(txtSearch);if(txtSearch==""||txtSearch=="City and State, Zip Code or Web Id"||txtSearch==DefaultSearchText.Sales) {OOps("<p class='top'>Please enter a city/state or a zip code into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li></ul>");return false;}
var RegExZip=txtSearch.replace(/[0-9]{5}/, '');if(RegExZip=='') {txtSearch=txtSearch.replace(' ', '');QueryString+=String.format("&Ntt={0}&Ntk=AddrZip&Ntx=mode matchall", txtSearch);}else{var IsWebId=txtSearch.replace(/[0-9]{7,10}/, '');if(IsWebId=='') {txtSearch=txtSearch.replace(' ', '');QueryString+=String.format("&Ntt={0}&Ntk=IdMLS&Ntx=mode matchall", txtSearch);}}
var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?submit=true&SearchType="+SearchType+"&sid="+sid+"&txtSearch="+txtSearch+"&sb="+sb+"&"+QueryString+qryPrice;var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {eval(AjaxResponse);if(AjaxResponse.indexOf("var webIdOops=true;")>-1) {}}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function DoSearchForRegion(theForm) {var SearchType="sale";var beds="0";var pnum1=0;var pnum2=99000000;var txtSearch="";var qrystr="";var qryPrice="";var els=theForm.elements;txtSearch=trim($('#txtSearch', theForm).val());var sb=$('#sb', theForm).val();var NavQuery=new Array();NavQuery.push(saleID);CloseSuggest();if($('#EndecaId', theForm).val().length>0) {NavQuery.push($('#EndecaId', theForm).val());}
var QueryString="N="+NavQuery.join("+");txtSearch=trim(txtSearch);if(txtSearch==""||txtSearch=="City and State, Zip Code or Web Id"||txtSearch==DefaultSearchText.Sales) {OOps("<p class='top'>Please enter a city/state or a zip code into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li></ul>");return false;}
var RegExZip=txtSearch.replace(/[0-9]{5}/, '');if(RegExZip=='') {txtSearch=txtSearch.replace(' ', '');QueryString+=String.format("&Ntt={0}&Ntk=AddrZip&Ntx=mode matchall", txtSearch);}
var strURL=WebRoot+"Controls/AjaxCalls/GetCityStateZip.aspx?SearchType="+SearchType+"&txtSearch="+txtSearch+"&sb="+sb+"&"+QueryString+qryPrice;var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {eval(AjaxResponse);}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function HGTVSearch(Searchterm) {var Search=Searchterm.split("=");var txtSearch=Search[1].replace(/\+/g, ' ');txtSearch=EncodeSearchString(txtSearch.replace('%2c', ','));if(txtSearch==""||txtSearch=="City and State, Zip Code of Web Id") {OOps("<p class='top'>Please enter a city/state or a zip code into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li></ul>");return false;}
var QueryString="";var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?sid="+sid+"&txtSearch="+txtSearch;var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {eval(AjaxResponse);}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function DoSearchSalesExpanded(theForm) {var SearchType="sale";var beds="0";var pnum1=0;var pnum2=99000000;var txtSearch="";var qrystr="";var qryPrice="";var els=theForm.elements;txtSearch=EncodeSearchString(trim($('#txtSearch', theForm).val()));var sb=$('#sb', theForm).val();var NavQuery=new Array();NavQuery.push(saleID);CloseSuggest();var isRefinementsSelected=false;if($('#EndecaId', theForm).val().length>0) {NavQuery.push($('#EndecaId', theForm).val());}
var bedslist=theForm.search_bedrooms;if(bedslist.selectedIndex>0) {NavQuery.push(bedslist[bedslist.selectedIndex].value);isRefinementsSelected=true;}
var bathslist=theForm.search_bathrooms.options;if(bathslist.selectedIndex>0) {NavQuery.push(bathslist[bathslist.selectedIndex].value);isRefinementsSelected=true;}
var ptypelist=theForm.search_propertytype.options;if(ptypelist.selectedIndex>0) {NavQuery.push(ptypelist[ptypelist.selectedIndex].value);isRefinementsSelected=true;}
var QueryString="N="+NavQuery.join("+");var minPrice=theForm.search_pricemin.options;var maxPrice=theForm.search_pricemax.options;if((minPrice.selectedIndex>0)||(maxPrice.selectedIndex>0)) {if((minPrice.selectedIndex>maxPrice.selectedIndex) && (maxPrice.selectedIndex!=0)) {OOps("<p id='price_error'>The minimum price must be less than the maximum price</p>");return false;}else{qryPrice=String.format("&Nf=Price_Sales|BTWN+{0}+{1}",minPrice[minPrice.selectedIndex].value,maxPrice[maxPrice.selectedIndex].value);isRefinementsSelected=true;}}else{qryPrice="";}
txtSearch=trim(txtSearch);if(txtSearch==""||txtSearch=="City and State, Zip Code or Web Id"||txtSearch==DefaultSearchText.Sales) {OOps("<p class='top'>Please enter a city/state or a zip code into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li></ul>");return false;}
var RegExZip=txtSearch.replace(/[0-9]{5}/, '');if(RegExZip=='') {txtSearch=txtSearch.replace(' ', '');if(isRefinementsSelected==true) {QueryString+=String.format("&Ntt={0}&Ntk=AddrZip&Ntx=mode matchall", txtSearch);}else{QueryString+=String.format("&Ntt={0}&Ntk=ZipRId&Ntx=mode matchall", txtSearch);}}else{var IsWebId=txtSearch.replace(/[0-9]{7,10}/, '');if(IsWebId=='') {txtSearch=txtSearch.replace(' ', '');QueryString+=String.format("&Ntt={0}&Ntk=IdMLS&Ntx=mode matchall", txtSearch);}}
var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?SearchType="+SearchType+"&txtSearch="+txtSearch+"&sid="+sid+"&sb="+sb+"&"+QueryString+qryPrice;var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {eval(AjaxResponse);if(AjaxResponse.indexOf("var webIdOops=true;")>-1) {}}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function PerformSalesSearch(theForm) {var PriceMin=$('#select_min_price option:selected').attr('id');var PriceMinSelectedIndex=parseInt($('#select_min_price option:selected').attr('pos'));var PriceMax=$('#select_max_price option:selected').attr('id');var PriceMaxSelectedIndex=parseInt($('#select_max_price option:selected').attr('pos'));var Bed=$('#select_bedrooms option:selected').attr('id');var BedSelectedIndex=parseInt($('#select_bedrooms option:selected').attr('pos'));var Bath=$('#select_bathrooms option:selected').attr('id');var BathSelectedIndex=parseInt($('#select_bathrooms option:selected').attr('pos'));var PropertyType=$('#select_property_type option:selected').attr('id');var PropertyTypeSelectedIndex=parseInt($('#select_property_type option:selected').attr('pos'));var SalesType=$('#select_sales_type option:selected').attr('id');var SalesTypeSelectedIndex=parseInt($('#select_sales_type option:selected').attr('pos'));var SearchType="sale";var beds="0";var pnum1=0;var pnum2=99000000;var txtSearch="";var qrystr="";var qryPrice="";var els=theForm.elements;txtSearch=EncodeSearchString(trim($('#txtSearch', theForm).val()));var sb=theForm.sb.value;var NavQuery=new Array();NavQuery.push(saleID);CloseSuggest();var isRefinementsSelected=false;if($('#EndecaId', theForm).val().length>0) {NavQuery.push($('#EndecaId', theForm).val());}
if(BedSelectedIndex!=0) {NavQuery.push(Bed);isRefinementsSelected=true;}
if(BathSelectedIndex!=0) {NavQuery.push(Bath);isRefinementsSelected=true;}
if(PropertyTypeSelectedIndex!=0) {NavQuery.push(PropertyType);isRefinementsSelected=true;}
if(SalesTypeSelectedIndex!=0) {NavQuery.push(SalesType);isRefinementsSelected=true;}
if(SalesTypeSelectedIndex==2) {NavQuery.push(newHomesID);}
if(SalesTypeSelectedIndex==3) {NavQuery.push(openHousesID);}
var QueryString="N="+NavQuery.join("+");if((PriceMinSelectedIndex>0)||(PriceMaxSelectedIndex>0)) {if((PriceMinSelectedIndex>PriceMaxSelectedIndex) && (PriceMaxSelectedIndex!=0)) {OOps("<p id='price_error'>The minimum price must be less than the maximum price</p>");return false;}else{qryPrice=String.format("&Nf=Price_Sales|BTWN+{0}+{1}",PriceMin,PriceMax);isRefinementsSelected=true;}}
txtSearch=trim(txtSearch);if(txtSearch==""||txtSearch=="City and State, Zip Code or Web Id"||txtSearch==DefaultSearchText.Sales) {OOps("<p class='top'>Please enter a city/state or a zip code into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li></ul>");$(theForm.txtSearch).focus();return false;}
var RegExZip=txtSearch.replace(/[0-9]{5}/, '');if(RegExZip=='') {if(SalesTypeSelectedIndex==1) {QueryString+=String.format("&Ntt={0}||F&Ntk=AddrZip||CodeListingType&Ntx=mode matchall", txtSearch);}else{QueryString+=String.format("&Ntt={0}&Ntk=AddrZip&Ntx=mode matchall", txtSearch);}}else{var IsWebId=txtSearch.replace(/[0-9]{7,10}/, '');if(IsWebId=='') {txtSearch=txtSearch.replace(' ', '');QueryString+=String.format("&Ntt={0}&Ntk=IdMLS&Ntx=mode matchall", txtSearch);}else{if(SalesTypeSelectedIndex==1) {QueryString+="&Ntt=F&Ntk=CodeListingType&Ntx=mode matchall";}}}
var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?submit=true&SearchType="+SearchType+"&endecaid="+$('#EndecaId', theForm).val()+"&txtSearch="+txtSearch+"&sid="+sid+"&sb="+sb+"&"+QueryString+qryPrice;var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {if(AjaxResponse.indexOf("location.href")>-1) {}
eval(AjaxResponse);if(AjaxResponse.indexOf("var webIdOops=true;")>-1) {}}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function PerformRentalsSearch(theForm) {var PriceMin=$('#select_min_price option:selected').attr('id');var PriceMinSelectedIndex=parseInt($('#select_min_price option:selected').attr('pos'));var PriceMax=$('#select_max_price option:selected').attr('id');var PriceMaxSelectedIndex=parseInt($('#select_max_price option:selected').attr('pos'));var Bed=$('#select_bedrooms option:selected').attr('id');var BedSelectedIndex=parseInt($('#select_bedrooms option:selected').attr('pos'));var Bath=$('#select_bathrooms option:selected').attr('id');var BathSelectedIndex=parseInt($('#select_bathrooms option:selected').attr('pos'));var PropertyType=$('#select_property_type option:selected').attr('id');var PropertyTypeSelectedIndex=parseInt($('#select_property_type option:selected').attr('pos'));var SalesType=$('#select_sales_type option:selected').attr('id');var SalesTypeSelectedIndex=parseInt($('#select_sales_type option:selected').attr('pos'));var SearchType="rental";var beds="0";var pnum1=0;var pnum2=99000000;var txtSearch="";var qrystr="";var qryPrice="";var els=theForm.elements;txtSearch=EncodeSearchString(trim($('#txtSearch', theForm).val()));var sb=theForm.sb.value;var NavQuery=new Array();NavQuery.push(rentalID);CloseSuggest();var isRefinementsSelected=false;if($('#EndecaId', theForm).val().length>0) {NavQuery.push($('#EndecaId', theForm).val());}
if(BedSelectedIndex!=0) {NavQuery.push(Bed);isRefinementsSelected=true;}
if(BathSelectedIndex!=0) {NavQuery.push(Bath);isRefinementsSelected=true;}
if(PropertyTypeSelectedIndex!=0) {NavQuery.push(PropertyType);isRefinementsSelected=true;}
if(SalesTypeSelectedIndex!=0) {NavQuery.push(SalesType);isRefinementsSelected=true;}
if(SalesTypeSelectedIndex==2) {NavQuery.push(newHomesID);}
if(SalesTypeSelectedIndex==3) {NavQuery.push(openHousesID);}
var QueryString="N="+NavQuery.join("+");if((PriceMinSelectedIndex>0)||(PriceMaxSelectedIndex>0)) {if((PriceMinSelectedIndex>PriceMaxSelectedIndex) && (PriceMaxSelectedIndex!=0)) {OOps("<p id='price_error'>The minimum price must be less than the maximum price</p>");return false;}else{qryPrice=String.format("&Nf=Price_Rentals|BTWN+{0}+{1}",PriceMin,PriceMax);isRefinementsSelected=true;}}
txtSearch=trim(txtSearch);if(txtSearch==""||txtSearch=="City and State, Zip Code or Web Id"||txtSearch==DefaultSearchText.Sales) {OOps("<p class='top'>Please enter a city/state or a zip code into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li></ul>");$(theForm.txtSearch).focus();return false;}
var RegExZip=txtSearch.replace(/[0-9]{5}/, '');if(RegExZip=='') {if(SalesTypeSelectedIndex==1) {QueryString+=String.format("&Ntt={0}||F&Ntk=AddrZip||CodeListingType&Ntx=mode matchall", txtSearch);}else{QueryString+=String.format("&Ntt={0}&Ntk=AddrZip&Ntx=mode matchall", txtSearch);}}else{var IsWebId=txtSearch.replace(/[0-9]{7,10}/, '');if(IsWebId=='') {txtSearch=txtSearch.replace(' ', '');QueryString+=String.format("&Ntt={0}&Ntk=IdMLS&Ntx=mode matchall", txtSearch);}else{if(SalesTypeSelectedIndex==1) {QueryString+="&Ntt=F&Ntk=CodeListingType&Ntx=mode matchall";}}}
var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?submit=true&SearchType="+SearchType+"&endecaid="+$('#EndecaId', theForm).val()+"&txtSearch="+txtSearch+"&sid="+sid+"&sb="+sb+"&"+QueryString+qryPrice;var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {if(AjaxResponse.indexOf("location.href")>-1) {}
eval(AjaxResponse);if(AjaxResponse.indexOf("var webIdOops=true;")>-1) {}}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
function PerformAgentSearch(theForm) {var specialization=$('#hdn_specialization_nvals', theForm).val();var SearchType="agent";var txtSearch="";var qrystr="";var els=theForm.elements;txtSearch=EncodeSearchString(trim($('#txtSearch', theForm).val()));var sb=theForm.sb.value;var NavQuery=new Array();NavQuery.push(agentID);CloseSuggest();if($('#EndecaId', theForm).val().length>0) {NavQuery.push($('#EndecaId', theForm).val());}
var QueryString="N="+NavQuery.join("+");txtSearch=trim(txtSearch);if((txtSearch==""||txtSearch==DefaultSearchText.Agent) && specialization=='') {OOps("<p class='top'>Please enter a city/state or a zip code, or Agent Name into the search field.  We recommend that you follow the following format:</p><ul><li>City, State (e.g.<a href=\"javascript:FoeSearch('San Francisco, CA');\">San Francisco, CA</a>)</li><li>Zip Code (e.g.<a href=\"javascript:FoeSearch('89148');\">89148</a>)</li><li>John Doe</li></ul>");$(theForm.txtSearch).focus();return false;}
var RegExZip=txtSearch.replace(/[0-9]{5}/, '');if(RegExZip=='') {QueryString+=String.format('&Nrs=collection()/record[(endeca:matches(.,"AgentAddressZip","{0}","all") or endeca:matches(.,"AgentSearch","{0}","al""))]', txtSearch);}
var strURL=WebRoot+"Controls/AjaxCalls/SearchBar.aspx?submit=true&SearchType="+SearchType+"&endecaid="+$('#EndecaId', theForm).val()+"&txtSearch="+txtSearch+"&specialization="+specialization+"&sid="+sid+"&sb="+sb+"&"+QueryString+"&searchform="+$(theForm).attr('name');var ResponseDelegate=function(AjaxResponse) {if(AjaxResponse.indexOf("var doEval=true;")>-1) {eval(AjaxResponse);}else{gE("searchformresult").innerHTML=AjaxResponse;}};$AJAX.GetForDelegate(ResponseDelegate, strURL);}
var AfterLoad=function() { void (null); };function SwitchSearch(type, state, Query, useDefaultSearchText, locationValue, shownLocation) {if(Query==undefined) {Query="";}
var UGen=new UrlGen(Query);if(state==undefined) {state="Small";}
if(type!='SalesHeaderExpanded'||type!='RentalsHeaderExpanded'||type=='AgentHeaderExpanded') {AfterLoad=function() { void (null); };}
UGen.RemoveParam("sb");UGen.AddParam("sb", type);if(useDefaultSearchText) {UGen.RemoveParam("UseDefaultSearchText");UGen.AddParam("UseDefaultSearchText", useDefaultSearchText);}
if(locationValue){UGen.RemoveParam("LocationValue");UGen.AddParam("LocationValue", locationValue);}
if(shownLocation) {UGen.RemoveParam("ShownLocation");UGen.AddParam("ShownLocation", shownLocation);}
UGen.RemoveParam("rnd");UGen.AddParam("rnd", (new Date()).getTime());var strURL=WebRoot+"Controls/AjaxCalls/GetSearchModule.aspx?"+UGen.ToString();$AJAX.GetForDelegate(function(AjaxResponse) {var $searchdiv=$SearchForm.parents('#searchbardiv');$searchdiv.html(AjaxResponse);$SearchForm=$('form', $searchdiv);InputTextInitializer();AfterLoad();if(jQuery.browser.msie && (type=='SalesHeaderExpanded'||type=='RentalsHeaderExpanded'||type=='AgentHeaderExpanded')) {$('#txtSearch', $SearchForm).focus();$('#txtSearch', $SearchForm).setCursorPosition(0);}}, strURL);}
function CloseExpandedSearch(Query, useDefaultSearchText, locationValue, shownLocation, searchBarType) {var $HeaderSearchForm=$(document.forms['headersearchform']);var isExpanded=$('#ExpandedSalesSearch', $HeaderSearchForm).length>0 ? true : false||$('#ExpandedSalesSearch', $HeaderSearchForm).length>0 ? true : false;if(isExpanded) {if(Query==undefined) {Query="";}
AfterLoad=function() { void (null); };var UGen=new UrlGen(Query);UGen.RemoveParam("sb");if(typeof (searchBarType)!='undefined') {UGen.AddParam("sb", searchBarType);}else{UGen.AddParam("sb", "SalesHeader");}
if(useDefaultSearchText) {UGen.RemoveParam("UseDefaultSearchText");UGen.AddParam("UseDefaultSearchText", useDefaultSearchText);}
if(locationValue) {UGen.RemoveParam("LocationValue");UGen.AddParam("LocationValue", locationValue);}
if(shownLocation) {UGen.RemoveParam("ShownLocation");UGen.AddParam("ShownLocation", shownLocation);}
UGen.RemoveParam("rnd");UGen.AddParam("rnd", (new Date()).getTime());var strURL=WebRoot+"Controls/AjaxCalls/GetSearchModule.aspx?"+UGen.ToString();$AJAX.GetForDelegate(function(AjaxResponse) {var $searchdiv=$HeaderSearchForm.parents('#searchbardiv');$searchdiv.html(AjaxResponse);InputTextInitializer();AfterLoad();}, strURL);}}
function GetC() {return 200;}
function SuggestDown(e, ele, CurrentSearchForm, CurrentSuggest) {clearTimeout(txtSearchTextbox_Timer);if(!(typeof (CurrentSearchForm)=='undefined'||CurrentSearchForm==null)) {$SearchForm=$(CurrentSearchForm);}
if(!(typeof (CurrentSuggest)=='undefined'||CurrentSuggest==null)) {$SuggestContainer=$(CurrentSuggest);}
if($OopsContainer.is(':visible')) {return false;}
var val=ele.value;if(window.event) {keynum=e.keyCode;}
else if(e.which) {keynum=e.which;}
switch (keynum) {case 9:if($SuggestContainer.is(':visible')) {CloseSuggest();StopProcessingEvents(e);$('.greytext', $SearchForm).val('');if(gE('select_min_price') && e.which){$('#select_min_price').focus();}}
return true;break;case 13:if($SuggestContainer.is(':visible')) {if(CurrentSuggestIndex()>-1) {AddSuggest(CurrentSuggestIndex());StopProcessingEvents(e);}}
if($SearchBarType!=null) {switch ($SearchBarType.val()) {case SearchTypeEnum.Agent:PerformAgentSearch(ele.form);break;case SearchTypeEnum.Rentals:PerformRentalsSearch(ele.form);break;default:PerformSalesSearch(ele.form);break;}}else{PerformSalesSearch(ele.form);}
break;case 27:CloseSuggest();ele.value=val;return false;break;default:$('#EndecaId', $SearchForm).val('');return true;break;}}
function SuggestUp(e, ele) {clearTimeout(txtSearchTextbox_Timer);if($OopsContainer.is(':visible')) {return false;}
var val=ele.value;if($('.greytext', $SearchForm).length>0 && val[val.length - 1]!=$('.greytext', $SearchForm).val()[val.length - 1]) {$('.greytext', $SearchForm).val('');}
if(window.event) {keynum=e.keyCode;}
else if(e.which) {keynum=e.which;}
switch (keynum) {case 9:if($SuggestContainer.is(':visible')) {CloseSuggest();StopProcessingEvents(e);$('.greytext', $SearchForm).val('');if(gE('select_min_price') && e.which){$('#select_min_price').focus();}}
return true;break;case 13:if($SuggestContainer.is(':visible')) {CloseSuggest();StopProcessingEvents(e);return false;}
return true;break;case 27:CloseSuggest();ele.value=val;return false;break;case 40:ShowSuggestContainer();SuggestSelect(CurrentSuggestIndex()+1);$('.greytext, .darktext', $SearchForm).val(GetSuggest(CurrentSuggestIndex()));break;case 36:case 37:case 38:case 39:ShowSuggestContainer();if(CurrentSuggestIndex()>=0) {SuggestSelect(CurrentSuggestIndex() - 1);}
else if(keynum==38){SuggestSelect(GetSuggestElementCount() - 1);}
if(CurrentSuggestIndex()!=-1)
$('.greytext, .darktext', $SearchForm).val(GetSuggest(CurrentSuggestIndex()));break;default:if(trim(ele.value).length>1) {var Query=String.format("{0}Controls/AjaxCalls/SuggestSearchModule.aspx?C={1}&term={2}", WebRoot, GetC(), EncodeSearchString(ReplacePotentiallyDangerous(ele.value)));txtSearchTextbox_Timer=setTimeout(function() { $AJAX.GetForDelegate(ShowSuggest, Query) }, 1000);}else{CloseSuggest();$('.greytext', $SearchForm).val('');}
break;}}
function EncodeSearchString(searchString) {var re=/[\&]/gi;return trim(searchString).replace(re, '%26');}
function StripIllegalCharFromSearchString(searchString) {return trim(searchString).replace(/[^a-zA-Z0-9-_,]/g, ' ').replace(/\s{2,}/g,' ');}
function ReplacePotentiallyDangerous(val) {var re=/[^a-z0-9\s-,()\/\:'\&]/gi;if(typeof (val)!='undefined' && val!=null) {return val.replace(re, '');}
return val;}
function StopProcessingEvents(e) {if(e && e.preventDefault) {e.preventDefault();}
else if(window.event && window.event.returnValue) {window.eventReturnValue=false;}}
function CurrentSuggestIndex() {var index=-1;$('div', $SuggestContainer).each(function(ix, elem) {if($(elem).hasClass('hot')) {index=ix;return false;}});return index;}
function GetSuggestElementCount() {return $('div', $SuggestContainer).size();}
function ScrollToItem(elepos) {var $eleE=$('#ila'+elepos, $SuggestContainer);var $eleS=$SuggestContainer;var Etop=$eleE.attr('offsetTop');var Stop=$eleS.scrollTop();if(Etop<$eleS.scrollTop()) {$SuggestContainer.scrollTop(Etop);}
else if((Etop+$eleE.attr('offsetHeight'))>(Stop+$eleS.attr('offsetHeight'))) {$SuggestContainer.scrollTop(Etop - $eleS.attr('offsetHeight')+$eleE.attr('offsetHeight'));}}
function SuggestSelect(index) {var itemindex=null;var $suggestArray=$('div', $SuggestContainer);$suggestArray.each(function(ix, elem) {if(index==ix) {$(elem).removeClass('non').addClass('hot');itemindex=ix;}else{$(elem).removeClass('hot').addClass('non');}});if(itemindex==null) {if(index>$suggestArray.length - 1) {itemindex=$suggestArray.length - 1;$($suggestArray[itemindex]).removeClass('non').addClass('hot');}else{itemindex=0;}}
if(itemindex>0) {ScrollToItem(itemindex);}}
function ShowSuggest(AjaxResponse) {if(trim(AjaxResponse).length>0) {if($SuggestContainer.is(':hidden')) {$SuggestContainer.show();}
OOpsClose();$SuggestContainer.html(AjaxResponse);if($('.greytext', $SearchForm) && $('.darktext', $SearchForm)){$('.greytext', $SearchForm).val($('.darktext', $SearchForm).val()+GetSuggest(0).substring($('.darktext', $SearchForm).val().length));}}else{CloseSuggest();}}
function ToggleSelects(visibility) {var Sel=document.getElementsByTagName("select");for (var x=0; x<Sel.length; x++) {Sel[x].style.visibility=visibility;}}
function CloseSuggest() {$SuggestContainer.hide();ToggleSelects("visible");$('.greytext').val('');}
function ShowSuggestContainer() {if($SuggestContainer.is(':hidden')) {$SuggestContainer.show();}}
function AddSuggest(index) {var EndecaId=$('#ila'+index, $SearchForm).attr('name');var LocationName=$('#ila'+index, $SearchForm).attr('rel');$('#txtSearch', $SearchForm).val(LocationName);$('#EndecaId', $SearchForm).val(EndecaId);}
function GetSuggest(index) {var LocationName="";if(index!=-1) {LocationName=$('#ila'+index, $SearchForm).attr('rel');}
return LocationName;}
function OOps(strMessage, strClassName, strTitle) {window.setTimeout(function () {if(strClassName==undefined) {strClassName="oops_wrapper clearfix";}
if(typeof (strTitle)!='undefined') {$("h3", $('#oops_wrapper_div', $OopsContainer)).html(strTitle);}
CloseSuggest();$OopsContainer.show();$OopsContainer.removeClass().addClass(strClassName);$('#oops_text', $OopsContainer).html(strMessage);}, 300);}
function WebOOps(strMessage, strClassName) {window.setTimeout(function() {if(strClassName==undefined) {strClassName="oops_wrapper";}
CloseSuggest();ToggleSelects("hidden");$WebOopsContainer.show();$WebOopsContainer.removeClass().addClass(strClassName);$('#weboops_text', $WebOopsContainer).html(strMessage);}, 300);}
function OOpsClose() {if($SuggestContainer.is(':hidden')) {ToggleSelects("visible");}
$("h3", $('#oops_wrapper_div', $OopsContainer)).html("Oops!");$OopsContainer.hide();}
function WebOopsClose() {$WebOopsContainer.hide();}
function SwitchSearchType(strStatus) {window.setTimeout(function() {if(strStatus==undefined) {if(gE("search_type_list").style.display!='block') {strStatus="open";}else{strStatus="close";}}
if(strStatus=="open") {if(BarStatus.value!=BevtQueue) {gE("txtSearch").blur();window.setTimeout(function() {SwitchSearchType(strStatus);}, 300);return;}
gE("search_type_list").style.display='block';gE("search_list_backOpen").style.display='block';var G=new GetWindowBunds();gE("search_list_backOpen").style.left="1px";gE("search_list_backOpen").style.top="1px";gE("search_list_backOpen").style.width=(G.VisibleWidth - 20)+"px";gE("search_list_backOpen").style.height=(G.PageHeight - 20)+"px";}else{gE("search_type_list").style.display="none";gE("search_list_backOpen").style.display="none";}}, 300);}
var BevtQueue="clicked off";function Bevt(e, searchBarType) {var IE=(navigator.appVersion.indexOf("MSIE")==-1) ? false : true;var theTarget;if(!e||IE) {e=window.event;e.cancelBubble=true;}else{e.stopPropagation();}
if(e.target) {theTarget=e.target;}
else if(e.srcElement) {theTarget=e.srcElement;}
if(theTarget.nodeType==3) {theTarget=theTarget.parentNode;}
switch (e.type) {case "focus":BarStatus.value="event: "+e.type+"\nTarget ID: "+theTarget.id;break;case "blur":BarStatus.value=BevtQueue;window.clearTimeout(BarStatus.timeout);BarStatus.timeout=window.setTimeout(function() {if(BarStatus.value==BevtQueue) {var $headerSearchForm=$(document.forms['headersearchform']);if(PageCache!=null) {CloseExpandedSearch(PageCache.QueryString, $('#UseDefaultSearchText', $headerSearchForm).val(), $('#LocationValue', $headerSearchForm).val(), $('#ShownLocationValue', $headerSearchForm).val(), searchBarType);}else{CloseExpandedSearch(DefaultQueryString, $('#UseDefaultSearchText', $headerSearchForm).val(), $('#LocationValue', $headerSearchForm).val(), $('#ShownLocationValue', $headerSearchForm).val(), searchBarType);}}}, 200);break;}}
function StopPropagation(e) {var IE=(navigator.appVersion.indexOf("MSIE")==-1) ? false : true;var theTarget;if(!e||IE) {e=window.event;e.cancelBubble=true;}else{e.stopPropagation();}}
var BarStatus=new BevtValue(BevtQueue);function BevtValue(Bevt) {this.value=Bevt;this.timeout=window.setTimeout(function() { void (null); }, 1);}
function BevtStasis(val) {window.setTimeout(function() {BarStatus.value=val;}, 100);}
function SelectMinPriceHP(id, selectedIndex) {$('#select_min_price', $SearchForm).blur();if($('#txtSearch', $SearchForm).val()!=$('#txtSearch', $SearchForm).attr('default_value')) {$('#txtSearch', $SearchForm).focus();}
switchSearchbarPrices();}
function SelectMaxPriceHP(id, selectedIndex) {$('#select_max_price', $SearchForm).blur();if($('#txtSearch', $SearchForm).val()!=$('#txtSearch', $SearchForm).attr('default_value')) {$('#txtSearch', $SearchForm).focus();}
switchSearchbarPrices();}
function switchSearchbarPrices(){var priceMin=$("#select_min_price").val().replace(/,/g,"");var priceMax=$("#select_max_price").val().replace(/,/g,"");var priceMinTemp=$("#select_min_price").val();var priceMaxTemp=$("#select_max_price").val();if(priceMin.indexOf("No Limit")==-1 && priceMax.indexOf("No Limit")==-1 && priceMin.indexOf("Any Price")==-1 && priceMax.indexOf("Any Price")==-1){if(priceMin.indexOf("Million")==-1 && priceMax.indexOf("Million")==-1){if(parseInt(priceMin)>parseInt(priceMax)){$("#select_max_price").val(priceMinTemp);$("#select_min_price").val(priceMaxTemp);}}
else{if(priceMin.indexOf("Million")!=-1 && priceMax.indexOf("Million")!=-1){if(parseInt(priceMin)>parseInt(priceMax)){$("#select_max_price").val(priceMinTemp);$("#select_min_price").val(priceMaxTemp);}}
else if(priceMin.indexOf("Million")!=-1 && priceMax.indexOf("Million")==-1){$("#select_max_price").val(priceMinTemp);$("#select_min_price").val(priceMaxTemp);}}}
else{if(priceMin.indexOf("No Limit")!=-1){$("#select_max_price").val(priceMinTemp);$("#select_min_price").val(priceMaxTemp);}}}
function SelectBed(id, selectedIndex) {$('#select_bedrooms', $SearchForm).blur();if($('#txtSearch', $SearchForm).val()!=$('#txtSearch', $SearchForm).attr('default_value')) {$('#txtSearch', $SearchForm).focus();}}
function SelectBath(id, selectedIndex) {$('#select_bathrooms', $SearchForm).blur();if($('#txtSearch', $SearchForm).val()!=$('#txtSearch', $SearchForm).attr('default_value')) {$('#txtSearch', $SearchForm).focus();}}
function SelectType(id, selectedIndex) {$('#select_property_type', $SearchForm).blur();if($('#txtSearch', $SearchForm).val()!=$('#txtSearch', $SearchForm).attr('default_value')) {$('#txtSearch', $SearchForm).focus();}}
function SelectSalesType(id, selectedIndex) {$('#select_sales_type', $SearchForm).blur();if($('#txtSearch', $SearchForm).val()!=$('#txtSearch', $SearchForm).attr('default_value')) {$('#txtSearch', $SearchForm).focus();}}
function openWebID() {gE("webID-exp").style.display="block";gE("webid_backClose").style.display="block";}
function closeWebID() {gE("webID-exp").style.display="none";gE("webid_backClose").style.display="none";}
function showWhite() {gE("priceminLI").style.background="FFFFFF";}
new function($) {$.fn.setCursorPosition=function(pos) {if($(this).get(0).setSelectionRange) {$(this).get(0).setSelectionRange(pos, pos);} else if($(this).get(0).createTextRange) {var range=$(this).get(0).createTextRange();range.collapse(true);range.moveEnd('character', pos);range.moveStart('character', pos);range.select();}}} (jQuery);var autoCloseSpecialization=null;function AttachSpecializationEvents() {$('a.btn', $SearchForm).click(function() {PopulateSpecializationBoxes();ShowSpecialization();if(autoCloseSpecialization) {window.clearTimeout(autoCloseSpecialization);}
autoCloseSpecialization=window.setTimeout(HideSpecialization, 5000);});$('#specialization :checkbox', $SearchForm).click(function() {window.clearTimeout(autoCloseSpecialization);});$('#close_spec', $SearchForm).click(function() {HideSpecialization();DeselectSpecialization();SetSpecializationDefault();});$('#submit_spec', $SearchForm).click(function() {HideSpecialization();SelectSpecialization();});$('body').click(function(e) {if(!($(e.target).is('a.btn', $SearchForm)) && !($(e.target).is('input.spec', $SearchForm)) && !($(e.target).is('.btn-submit-sm', $SearchForm)) && IsSpecializationOpen()) {HideSpecialization();};});}
function ShowSpecialization() {$('#specialization', $SearchForm).show();$('a.btn em', $SearchForm).addClass('active');}
function HideSpecialization() {$('#specialization', $SearchForm).hide();$('a.btn em', $SearchForm).removeClass('active');}
function SelectSpecialization() {var $items=$('#specialization :checkbox', $SearchForm);var result='';var resultNVals='';$.each($items, function(ix, obj) {if($(obj).is(':checked')==true) {result+=$(obj).attr('cb_val')+', '
resultNVals+=$(obj).attr('nval')+'+'}});if(result.length>0) {result=result.substring(0, result.length - 2);resultNVals=resultNVals.substring(0, resultNVals.length - 1);$('a.btn', $SearchForm).html(result+'<em>&nbsp;</em>');$('#hdn_specialization', $SearchForm).val(result);$('#hdn_specialization_nvals', $SearchForm).val(resultNVals);}else{SetSpecializationDefault();$('#hdn_specialization', $SearchForm).val('');$('#hdn_specialization_nvals', $SearchForm).val('');}}
function DeselectSpecialization() {var $items=$('#specialization :checkbox', $SearchForm);var result='';$.each($items, function(ix, obj) {if($(obj).is(':checked')==true) {$(obj).attr('checked', false);}});$('#hdn_specialization', $SearchForm).val('');$('#hdn_specialization_nvals', $SearchForm).val('');}
function SetSpecializationDefault() {$('a.btn', $SearchForm).html('Select a Specialization<em>&nbsp;</em>');}
function IsSpecializationDefault() {return $('#hdn_specialization', $SearchForm).val()=='';}
function IsSpecializationOpen() {return $('#specialization', $SearchForm).is(':visible');}
function PopulateSpecializationBoxes() {if(IsSpecializationDefault())
return;var specializations_array=$('#hdn_specialization', $SearchForm).val().split(', ');var $cb_items=$('#specialization :checkbox', $SearchForm);$cb_items.attr('checked', false);$.each($cb_items, function(ix, obj) {if($.inArray($(obj).attr('cb_val'), specializations_array)!=-1) {$(obj).attr('checked', true);}});};