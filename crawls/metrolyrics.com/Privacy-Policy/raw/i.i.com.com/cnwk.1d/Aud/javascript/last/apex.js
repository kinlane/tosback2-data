var AWS_COMMON=function(){var user,aStart,serv="apex",domain="last.fm",port="",params="",doCallback=true,maxTime=750,callTime=0,callStatus=1;var cbsiAdLocal={};var dvarsReturned="";function setStartCall(){aStart=(new Date()).getTime()}function setStatus(){if(callStatus===1){doCallback=false;callStatus=-1}}function jsAppend(scriptSrc){var insertionPoint=document.getElementsByTagName("body")[0],js=document.createElement("script");js.setAttribute("type","text/javascript");js.setAttribute("async","true");js.setAttribute("src",scriptSrc);insertionPoint.appendChild(js)}function setParams(cbsiGlobal,callback){var referrer=document.referrer;cbsiGlobal.REGSYS=(cbsiGlobal.REGSYS)?cbsiGlobal.REGSYS:cbsiGlobal.regSys;cbsiGlobal.REGID=(cbsiGlobal.REGID)?cbsiGlobal.REGID:cbsiGlobal.regId;cbsiGlobal.LGNSTS=(cbsiGlobal.LGNSTS)?cbsiGlobal.LGNSTS:cbsiGlobal.lgnSts;params="refUrl="+escape(referrer)+"&sId="+cbsiGlobal.SITE+"&ptId="+((cbsiGlobal.PTYPE)?cbsiGlobal.PTYPE:"0")+"&onId="+((cbsiGlobal.NODE)?cbsiGlobal.NODE:"0")+"&asId="+((cbsiGlobal.ASID)?cbsiGlobal.ASID:((cbsiGlobal.PID)?cbsiGlobal.PID:"0"))+"&cId="+((cbsiGlobal.CID)?cbsiGlobal.CID:"0")+"&pId="+((cbsiGlobal.PID)?cbsiGlobal.PID:"0")+"&nCat="+((cbsiGlobal.NCAT)?cbsiGlobal.NCAT:"")+"&edId="+((cbsiGlobal.EDITION_ID)?cbsiGlobal.EDITION_ID:"0")+"&regSys="+((cbsiGlobal.REGSYS)?cbsiGlobal.REGSYS:"0")+"&regId="+((cbsiGlobal.REGID)?cbsiGlobal.REGID:"0")+"&lgnSts="+((cbsiGlobal.LGNSTS)?cbsiGlobal.LGNSTS:"0")+"&t="+(new Date()).getTime()+((callback)?"&callback="+callback:"")}function startsWith(checkString,pattern){return(checkString.match("^"+pattern)==pattern)}function getData(timeout,serverPath){setStartCall();maxTime=((timeout)?timeout:maxTime);callTime=maxTime;jsAppend("http://"+serv+"."+domain+port+serverPath+params);setTimeout(function(){setStatus()},maxTime)}this.loadArrowData=function(cbsiGlobal,timeout){setParams(cbsiGlobal,"parseArrowResponse");getData(timeout,"/aws/rest/v1.0/arrowUser?")};this.getUser=function(){return user};this.getCallTime=function(){return callTime};this.parseArrowResponse=function(arrowResponse){if(doCallback){callTime=((new Date()).getTime()-aStart);user=eval(arrowResponse);if(user&&!user.Error){var len=user.userBuckets.length;var aIds="";for(var i=0;i<len;++i){var segId=user.userBuckets[i];if(startsWith(segId,"mad-")){if(aIds!==""){aIds+=";"}aIds+=segId.substr(4)}}dvarsReturned=aIds;if(typeof cbsiSetUserGroup==="function"){cbsiSetUserGroup(aIds)}else{var endsWithSemicolon=/.+;$/i;if(endsWithSemicolon.test(cbsiAdLocal.DVAR_USER_GROUP)){cbsiAdLocal.DVAR_USER_GROUP+=aIds}else{if(cbsiAdLocal.DVAR_USER_GROUP){cbsiAdLocal.DVAR_USER_GROUP+=";";cbsiAdLocal.DVAR_USER_GROUP+=aIds}else{cbsiAdLocal.DVAR_USER_GROUP=aIds}}}}callStatus=0}};this.getDVARsReturned=function(){return dvarsReturned};this.loadOfferData=function(cbsiGlobal,timeout){cbsiAdLocal=cbsiGlobal;setParams(cbsiGlobal,null);getData(timeout,"/aws/rest/v1.0/offerScript?");callTime=((new Date()).getTime()-aStart)};this.showOfferData=function(cbsiGlobal,offerIds,clgfId,regId,timeout){params="offerId="+offerIds+"&sId="+cbsiGlobal.SITE+"&ptId="+((cbsiGlobal.PTYPE)?cbsiGlobal.PTYPE:"0")+"&onId="+((cbsiGlobal.NODE)?cbsiGlobal.NODE:"0")+"&asId="+((cbsiGlobal.ASID)?cbsiGlobal.ASID:((cbsiGlobal.PID)?cbsiGlobal.PID:"0"))+"&cId="+((cbsiGlobal.CID)?cbsiGlobal.CID:"0")+"&pId="+((cbsiGlobal.PID)?cbsiGlobal.PID:"0")+"&nCat="+((cbsiGlobal.NCAT)?cbsiGlobal.NCAT:"")+"&edId="+((cbsiGlobal.EDITION_ID)?cbsiGlobal.EDITION_ID:"0")+"&t="+(new Date()).getTime()+((clgfId)?"&anonId="+encodeURIComponent(clgfId):"")+((regId)?"&regId="+regId:"")+((user&&!user.Error)?"&tsId="+encodeURIComponent(user.tempSessionId):"");getData(timeout,"/aws/offer/offerScript?");callTime=((new Date()).getTime()-aStart)};this.runApexTargets=function(cbsiGlobal,timeout){cbsiAdLocal=cbsiGlobal;setParams(cbsiGlobal,"parseArrowResponse");getData(timeout,"/aws/rest/v2.0/apexTarget?");callTime=((new Date()).getTime()-aStart)}};if(!window.cbsiApex){var cbsiApex=new AWS_COMMON();var parseArrowResponse=cbsiApex.parseArrowResponse;var cbsiGetApexUser=cbsiApex.getUser;var cbsiLoadApexData=cbsiApex.loadArrowData;var cbsiLoadOffer=cbsiApex.loadOfferData;var cbsiShowOffer=cbsiApex.showOfferData;var cbsiRunApexTargets=cbsiApex.runApexTargets;var cbsiApexCallTime=cbsiApex.getCallTime;var cbsiGetApexDVARs=cbsiApex.getDVARsReturned};