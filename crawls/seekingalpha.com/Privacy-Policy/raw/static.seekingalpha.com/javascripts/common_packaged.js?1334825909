var Prototype={Version:'1.6.1',Browser:(function(){var ua=navigator.userAgent;var isOpera=Object.prototype.toString.call(window.opera)=='[object Opera]';return{IE:!!window.attachEvent&&!isOpera,Opera:isOpera,WebKit:ua.indexOf('AppleWebKit/')>-1,Gecko:ua.indexOf('Gecko')>-1&&ua.indexOf('KHTML')===-1,MobileSafari:/Apple.*Mobile.*Safari/.test(ua)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var constructor=window.Element||window.HTMLElement;return!!(constructor&&constructor.prototype);})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=='undefined')
return true;var div=document.createElement('div');var form=document.createElement('form');var isSupported=false;if(div['__proto__']&&(div['__proto__']!==form['__proto__'])){isSupported=true;}
div=form=null;return isSupported;})()},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)
Prototype.BrowserFeatures.SpecificElementExtensions=false;var Abstract={};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break;}catch(e){}}
return returnValue;}};var Class=(function(){function subclass(){};function create(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))
parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0;i<properties.length;i++)
klass.addMethods(properties[i]);if(!klass.prototype.initialize)
klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}
function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length){if(source.toString!=Object.prototype.toString)
properties.push("toString");if(source.valueOf!=Object.prototype.valueOf)
properties.push("valueOf");}
for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames().first()=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments);};})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);}
this.prototype[property]=value;}
return this;}
return{create:create,Methods:{addMethods:addMethods}};})();(function(){var _toString=Object.prototype.toString;function extend(destination,source){for(var property in source)
destination[property]=source[property];return destination;}
function inspect(object){try{if(isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}catch(e){if(e instanceof RangeError)return'...';throw e;}}
function toJSON(object){var type=typeof object;switch(type){case'undefined':case'function':case'unknown':return;case'boolean':return object.toString();}
if(object===null)return'null';if(object.toJSON)return object.toJSON();if(isElement(object))return;var results=[];for(var property in object){var value=toJSON(object[property]);if(!isUndefined(value))
results.push(property.toJSON()+': '+value);}
return'{'+results.join(', ')+'}';}
function toQueryString(object){return $H(object).toQueryString();}
function toHTML(object){return object&&object.toHTML?object.toHTML():String.interpret(object);}
function keys(object){var results=[];for(var property in object)
results.push(property);return results;}
function values(object){var results=[];for(var property in object)
results.push(object[property]);return results;}
function clone(object){return extend({},object);}
function isElement(object){return!!(object&&object.nodeType==1);}
function isArray(object){return _toString.call(object)=="[object Array]";}
function isHash(object){return object instanceof Hash;}
function isFunction(object){return typeof object==="function";}
function isString(object){return _toString.call(object)=="[object String]";}
function isNumber(object){return _toString.call(object)=="[object Number]";}
function isUndefined(object){return typeof object==="undefined";}
extend(Object,{extend:extend,inspect:inspect,toJSON:toJSON,toQueryString:toQueryString,toHTML:toHTML,keys:keys,values:values,clone:clone,isElement:isElement,isArray:isArray,isHash:isHash,isFunction:isFunction,isString:isString,isNumber:isNumber,isUndefined:isUndefined});})();Object.extend(Function.prototype,(function(){var slice=Array.prototype.slice;function update(array,args){var arrayLength=array.length,length=args.length;while(length--)array[arrayLength+length]=args[length];return array;}
function merge(array,args){array=slice.call(array,0);return update(array,args);}
function argumentNames(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,'').replace(/\s+/g,'').split(',');return names.length==1&&!names[0]?[]:names;}
function bind(context){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=slice.call(arguments,1);return function(){var a=merge(args,arguments);return __method.apply(context,a);}}
function bindAsEventListener(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a);}}
function curry(){if(!arguments.length)return this;var __method=this,args=slice.call(arguments,0);return function(){var a=merge(args,arguments);return __method.apply(this,a);}}
function delay(timeout){var __method=this,args=slice.call(arguments,1);timeout=timeout*1000
return window.setTimeout(function(){return __method.apply(__method,args);},timeout);}
function defer(){var args=update([0.01],arguments);return this.delay.apply(this,args);}
function wrap(wrapper){var __method=this;return function(){var a=update([__method.bind(this)],arguments);return wrapper.apply(this,a);}}
function methodize(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){var a=update([this],arguments);return __method.apply(null,a);};}
return{argumentNames:argumentNames,bind:bind,bindAsEventListener:bindAsEventListener,curry:curry,delay:delay,defer:defer,wrap:wrap,methodize:methodize}})());Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+'-'+
(this.getUTCMonth()+1).toPaddedString(2)+'-'+
this.getUTCDate().toPaddedString(2)+'T'+
this.getUTCHours().toPaddedString(2)+':'+
this.getUTCMinutes().toPaddedString(2)+':'+
this.getUTCSeconds().toPaddedString(2)+'Z"';};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback();},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},execute:function(){this.callback(this);},stop:function(){if(!this.timer)return;clearInterval(this.timer);this.timer=null;},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false;}catch(e){this.currentlyExecuting=false;throw e;}}}});Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,(function(){function prepareReplacement(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};}
function gsub(pattern,replacement){var result='',source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern))
pattern=RegExp.escape(pattern);if(!(pattern.length||pattern.source)){replacement=replacement('');return replacement+source.split('').join(replacement)+replacement;}
while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}else{result+=source,source='';}}
return result;}
function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0)return match[0];return replacement(match);});}
function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this);}
function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);}
function strip(){return this.replace(/^\s+/,'').replace(/\s+$/,'');}
function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,'');}
function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');}
function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});}
function evalScripts(){return this.extractScripts().map(function(script){return eval(script)});}
function escapeHTML(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function unescapeHTML(){return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');}
function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});}
function toArray(){return this.split('');}
function succ(){return this.slice(0,this.length-1)+
String.fromCharCode(this.charCodeAt(this.length-1)+1);}
function times(count){return count<1?'':new Array(count+1).join(this);}
function camelize(){var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)
camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;}
function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();}
function underscore(){return this.replace(/::/g,'/').replace(/([A-Z]+)([A-Z][a-z])/g,'$1_$2').replace(/([a-z\d])([A-Z])/g,'$1_$2').replace(/-/g,'_').toLowerCase();}
function dasherize(){return this.replace(/_/g,'-');}
function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character];}
return'\\u00'+character.charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";}
function toJSON(){return this.inspect(true);}
function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,'$1');}
function isJSON(){var str=this;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);}
function evalJSON(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());}
function include(pattern){return this.indexOf(pattern)>-1;}
function startsWith(pattern){return this.indexOf(pattern)===0;}
function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;}
function empty(){return this=='';}
function blank(){return/^\s*$/.test(this);}
function interpolate(object,pattern){return new Template(this,pattern).evaluate(object);}
return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim?String.prototype.trim:strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,toJSON:toJSON,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate};})());var Template=Class.create({initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object){if(object&&Object.isFunction(object.toTemplateReplacements))
object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match){if(object==null)return(match[1]+'');var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null){var comp=match[1].startsWith('[')?match[2].replace(/\\\\]/g,']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function each(iterator,context){var index=0;try{this._each(function(value){iterator.call(context,value,index++);});}catch(e){if(e!=$break)throw e;}
return this;}
function eachSlice(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1)return array;while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);}
function all(iterator,context){iterator=iterator||Prototype.K;var result=true;this.each(function(value,index){result=result&&!!iterator.call(context,value,index);if(!result)throw $break;});return result;}
function any(iterator,context){iterator=iterator||Prototype.K;var result=false;this.each(function(value,index){if(result=!!iterator.call(context,value,index))
throw $break;});return result;}
function collect(iterator,context){iterator=iterator||Prototype.K;var results=[];this.each(function(value,index){results.push(iterator.call(context,value,index));});return results;}
function detect(iterator,context){var result;this.each(function(value,index){if(iterator.call(context,value,index)){result=value;throw $break;}});return result;}
function findAll(iterator,context){var results=[];this.each(function(value,index){if(iterator.call(context,value,index))
results.push(value);});return results;}
function grep(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(RegExp.escape(filter));this.each(function(value,index){if(filter.match(value))
results.push(iterator.call(context,value,index));});return results;}
function include(object){if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value){if(value==object){found=true;throw $break;}});return found;}
function inGroupsOf(number,fillWith){fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number)slice.push(fillWith);return slice;});}
function inject(memo,iterator,context){this.each(function(value,index){memo=iterator.call(context,memo,value,index);});return memo;}
function invoke(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});}
function max(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value>=result)
result=value;});return result;}
function min(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value<result)
result=value;});return result;}
function partition(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];}
function pluck(property){var results=[];this.each(function(value){results.push(value[property]);});return results;}
function reject(iterator,context){var results=[];this.each(function(value,index){if(!iterator.call(context,value,index))
results.push(value);});return results;}
function sortBy(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');}
function toArray(){return this.map();}
function zip(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))
iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});}
function size(){return this.toArray().length;}
function inspect(){return'#<Enumerable:'+this.toArray().inspect()+'>';}
return{each:each,eachSlice:eachSlice,all:all,every:all,any:any,some:any,collect:collect,map:collect,detect:detect,findAll:findAll,select:findAll,filter:findAll,grep:grep,include:include,member:include,inGroupsOf:inGroupsOf,inject:inject,invoke:invoke,max:max,min:min,partition:partition,pluck:pluck,reject:reject,sortBy:sortBy,toArray:toArray,entries:toArray,zip:zip,size:size,inspect:inspect,find:detect};})();function $A(iterable){if(!iterable)return[];if('toArray'in Object(iterable))return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
function $w(string){if(!Object.isString(string))return[];string=string.strip();return string?string.split(/\s+/):[];}
Array.from=$A;(function(){var arrayProto=Array.prototype,slice=arrayProto.slice,_each=arrayProto.forEach;function each(iterator){for(var i=0,length=this.length;i<length;i++)
iterator(this[i]);}
if(!_each)_each=each;function clear(){this.length=0;return this;}
function first(){return this[0];}
function last(){return this[this.length-1];}
function compact(){return this.select(function(value){return value!=null;});}
function flatten(){return this.inject([],function(array,value){if(Object.isArray(value))
return array.concat(value.flatten());array.push(value);return array;});}
function without(){var values=slice.call(arguments,0);return this.select(function(value){return!values.include(value);});}
function reverse(inline){return(inline!==false?this:this.toArray())._reverse();}
function uniq(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value:!array.include(value)))
array.push(value);return array;});}
function intersect(array){return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});}
function clone(){return slice.call(this,0);}
function size(){return this.length;}
function inspect(){return'['+this.map(Object.inspect).join(', ')+']';}
function toJSON(){var results=[];this.each(function(object){var value=Object.toJSON(object);if(!Object.isUndefined(value))results.push(value);});return'['+results.join(', ')+']';}
function indexOf(item,i){i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)
if(this[i]==item)return i;return-1;}
function lastIndexOf(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;}
function concat(){var array=slice.call(this,0),item;for(var i=0,length=arguments.length;i<length;i++){item=arguments[i];if(Object.isArray(item)&&!('callee'in item)){for(var j=0,arrayLength=item.length;j<arrayLength;j++)
array.push(item[j]);}else{array.push(item);}}
return array;}
Object.extend(arrayProto,Enumerable);if(!arrayProto._reverse)
arrayProto._reverse=arrayProto.reverse;Object.extend(arrayProto,{_each:_each,clear:clear,first:first,last:last,compact:compact,flatten:flatten,without:without,reverse:reverse,uniq:uniq,intersect:intersect,clone:clone,toArray:clone,size:size,inspect:inspect,toJSON:toJSON});var CONCAT_ARGUMENTS_BUGGY=(function(){return[].concat(arguments)[0][0]!==1;})(1,2)
if(CONCAT_ARGUMENTS_BUGGY)arrayProto.concat=concat;arrayProto.indexOf=indexOf;arrayProto.lastIndexOf=lastIndexOf;})();function $H(object){return new Hash(object);};var Hash=Class.create(Enumerable,(function(){function initialize(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object);}
function _each(iterator){for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}}
function set(key,value){return this._object[key]=value;}
function get(key){if(this._object[key]!==Object.prototype[key])
return this._object[key];}
function unset(key){var value=this._object[key];delete this._object[key];return value;}
function toObject(){return Object.clone(this._object);}
function keys(){return this.pluck('key');}
function values(){return this.pluck('value');}
function index(value){var match=this.detect(function(pair){return pair.value===value;});return match&&match.key;}
function merge(object){return this.clone().update(object);}
function update(object){return new Hash(object).inject(this,function(result,pair){result.set(pair.key,pair.value);return result;});}
function toQueryPair(key,value){if(Object.isUndefined(value))return key;return key+'='+encodeURIComponent(String.interpret(value));}
function toQueryString(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&typeof values=='object'){if(Object.isArray(values))
return results.concat(values.map(toQueryPair.curry(key)));}else results.push(toQueryPair(key,values));return results;}).join('&');}
function inspect(){return'#<Hash:{'+this.map(function(pair){return pair.map(Object.inspect).join(': ');}).join(', ')+'}>';}
function toJSON(){return Object.toJSON(this.toObject());}
function clone(){return new Hash(this);}
return{initialize:initialize,_each:_each,set:set,get:get,unset:unset,toObject:toObject,toTemplateReplacements:toObject,keys:keys,values:values,index:index,merge:merge,update:update,toQueryString:toQueryString,inspect:inspect,toJSON:toJSON,clone:clone};})());Hash.from=$H;Object.extend(Number.prototype,(function(){function toColorPart(){return this.toPaddedString(2,16);}
function succ(){return this+1;}
function times(iterator,context){$R(0,this,true).each(iterator,context);return this;}
function toPaddedString(length,radix){var string=this.toString(radix||10);return'0'.times(length-string.length)+string;}
function toJSON(){return isFinite(this)?this.toString():'null';}
function abs(){return Math.abs(this);}
function round(){return Math.round(this);}
function ceil(){return Math.ceil(this);}
function floor(){return Math.floor(this);}
return{toColorPart:toColorPart,succ:succ,times:times,toPaddedString:toPaddedString,toJSON:toJSON,abs:abs,round:round,ceil:ceil,floor:floor};})());function $R(start,end,exclusive){return new ObjectRange(start,end,exclusive);}
var ObjectRange=Class.create(Enumerable,(function(){function initialize(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive;}
function _each(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ();}}
function include(value){if(value<this.start)
return false;if(this.exclusive)
return value<this.end;return value<=this.end;}
return{initialize:initialize,_each:_each,include:include};})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')})||false;},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator);},register:function(responder){if(!this.include(responder))
this.responders.push(responder);},unregister:function(responder){this.responders=this.responders.without(responder);},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json]);}catch(e){}}});}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--},onTimeout:function(){}});Ajax.Base=Class.create({initialize:function(options){this.options={method:'post',asynchronous:true,contentType:'application/x-www-form-urlencoded',encoding:'UTF-8',parameters:'',evalJSON:true,evalJS:true,timeOut:null,onTimeout:null};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))
this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))
this.options.parameters=this.options.parameters.toObject();}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url);},request:function(url){this.url=url;this.method=this.options.method;var params=Object.clone(this.options.parameters);if(!['get','post'].include(this.method)){params['_method']=this.method;this.method='post';}
this.parameters=params;if(params=Object.toQueryString(params)){if(this.method=='get')
this.url+=(this.url.include('?')?'&':'?')+params;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))
params+='&_=';}
try{var response=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(response);Ajax.Responders.dispatch('onCreate',this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous)this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=='post'?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)
this.onStateChange();if(this.options.timeOut)setTimeout(function(){this.ProcessTimeout()}.bind(this),this.options.timeOut);}
catch(e){this.dispatchException(e);}},ProcessTimeout:function(){if(!this._complete){this.transport.onreadystatechange=Prototype.emptyFunction;delete this.transport.onreadystatechange;try{this.transport.abort();}
catch(e){}
this.transport=Prototype.emptyFunction;delete this.transport;if(this.options.onTimeout)this.options.onTimeout();}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete))
this.respondToReadyState(this.transport.readyState);},setRequestHeaders:function(){var headers={'X-Requested-With':'XMLHttpRequest','X-Prototype-Version':Prototype.Version,'Accept':'text/javascript, text/html, application/xml, text/xml, */*'};if(this.method=='post'){headers['Content-type']=this.options.contentType+
(this.options.encoding?'; charset='+this.options.encoding:'');if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)
headers['Connection']='close';}
if(typeof this.options.requestHeaders=='object'){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))
for(var i=0,length=extras.length;i<length;i+=2)
headers[extras[i]]=extras[i+1];else
$H(extras).each(function(pair){headers[pair.key]=pair.value});}
for(var name in headers)
this.transport.setRequestHeader(name,headers[name]);},success:function(){var status=this.getStatus();return!status||(status>=200&&status<300);},getStatus:function(){try{return this.transport.status||0;}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=='Complete'){try{this._complete=true;(this.options['on'+response.status]||this.options['on'+(this.success()?'Success':'Failure')]||Prototype.emptyFunction)(response,response.headerJSON);}catch(e){this.dispatchException(e);}
var contentType=response.getHeader('Content-type');if(this.options.evalJS=='force'||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
this.evalResponse();}
try{(this.options['on'+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch('on'+state,this,response,response.headerJSON);}catch(e){this.dispatchException(e);}
if(state=='Complete'){this.transport.onreadystatechange=Prototype.emptyFunction;}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return!m||(m[0]=='#{protocol}//#{domain}#{port}'.interpolate({protocol:location.protocol,domain:document.domain,port:location.port?':'+location.port:''}));},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null;}catch(e){return null;}},evalResponse:function(){try{return eval((this.transport.responseText||'').unfilterJSON());}catch(e){this.dispatchException(e);}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch('onException',this,exception);}});Ajax.Request.Events=['Uninitialized','Loading','Loaded','Interactive','Complete'];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON();}
if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON();}},status:0,statusText:'',getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||'';}catch(e){return''}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders();}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name);},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders();},_getHeaderJSON:function(){var json=this.getHeader('X-JSON');if(!json)return null;json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!='force'&&!(this.getHeader('Content-type')||'').include('application/json'))||this.responseText.blank())
return null;try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete))onComplete(response,json);}).bind(this);$super(url,options);},updateContent:function(responseText){var receiver=this.container[this.success()?'success':'failure'],options=this.options;if(!options.evalScripts)responseText=responseText.stripScripts();if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion);}
else options.insertion(receiver,responseText);}
else receiver.update(responseText);}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start();},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent();},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText;}
this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options);}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)
elements.push($(arguments[i]));return elements;}
if(Object.isString(element))
element=document.getElementById(element);return Element.extend(element);}
if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++)
results.push(Element.extend(query.snapshotItem(i)));return results;};}
if(!window.Node)var Node={};if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});}
(function(global){var SETATTRIBUTE_IGNORES_NAME=(function(){var elForm=document.createElement("form");var elInput=document.createElement("input");var root=document.documentElement;elInput.setAttribute("name","test");elForm.appendChild(elInput);root.appendChild(elForm);var isBuggy=elForm.elements?(typeof elForm.elements.test=="undefined"):null;root.removeChild(elForm);elForm=elInput=null;return isBuggy;})();var element=global.Element;global.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(SETATTRIBUTE_IGNORES_NAME&&attributes.name){tagName='<'+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes);}
if(!cache[tagName])cache[tagName]=Element.extend(document.createElement(tagName));return Element.writeAttribute(cache[tagName].cloneNode(false),attributes);};Object.extend(global.Element,element||{});if(element)global.Element.prototype=element.prototype;})(this);Element.cache={};Element.idCounter=1;Element.Methods={visible:function(element){return $(element).style.display!='none';},toggle:function(element){element=$(element);Element[Element.visible(element)?'hide':'show'](element);return element;},hide:function(element){element=$(element);element.style.display='none';return element;},show:function(element){element=$(element);element.style.display='';return element;},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element;},update:(function(){var SELECT_ELEMENT_INNERHTML_BUGGY=(function(){var el=document.createElement("select"),isBuggy=true;el.innerHTML="<option value=\"test\">test</option>";if(el.options&&el.options[0]){isBuggy=el.options[0].nodeName.toUpperCase()!=="OPTION";}
el=null;return isBuggy;})();var TABLE_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=typeof el.tBodies[0]=="undefined";el=null;return isBuggy;}}catch(e){return true;}})();var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=(function(){var s=document.createElement("script"),isBuggy=false;try{s.appendChild(document.createTextNode(""));isBuggy=!s.firstChild||s.firstChild&&s.firstChild.nodeType!==3;}catch(e){isBuggy=true;}
s=null;return isBuggy;})();function update(element,content){element=$(element);if(content&&content.toElement)
content=content.toElement();if(Object.isElement(content))
return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName==='SCRIPT'&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING){element.text=content;return element;}
if(SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY){if(tagName in Element._insertionTranslations.tags){while(element.firstChild){element.removeChild(element.firstChild);}
Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)});}
else{element.innerHTML=content.stripScripts();}}
else{element.innerHTML=content.stripScripts();}
content.evalScripts.bind(content).defer();return element;}
return update;})(),replace:function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts());}
element.parentNode.replaceChild(content,element);return element;},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))
insertions={bottom:insertions};var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){insert(element,content);continue;}
content=Object.toHTML(content);tagName=((position=='before'||position=='after')?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=='top'||position=='after')childNodes.reverse();childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer();}
return element;},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper))
$(wrapper).writeAttribute(attributes||{});else if(Object.isString(wrapper))wrapper=new Element(wrapper,attributes);else wrapper=new Element('div',wrapper);if(element.parentNode)
element.parentNode.replaceChild(wrapper,element);wrapper.appendChild(element);return wrapper;},inspect:function(element){element=$(element);var result='<'+element.tagName.toLowerCase();$H({'id':'id','className':'class'}).each(function(pair){var property=pair.first(),attribute=pair.last();var value=(element[property]||'').toString();if(value)result+=' '+attribute+'='+value.inspect(true);});return result+'>';},recursivelyCollect:function(element,property){element=$(element);var elements=[];while(element=element[property])
if(element.nodeType==1)
elements.push(Element.extend(element));return elements;},ancestors:function(element){return Element.recursivelyCollect(element,'parentNode');},descendants:function(element){return Element.select(element,"*");},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1)element=element.nextSibling;return $(element);},immediateDescendants:function(element){if(!(element=$(element).firstChild))return[];while(element&&element.nodeType!=1)element=element.nextSibling;if(element)return[element].concat($(element).nextSiblings());return[];},previousSiblings:function(element){return Element.recursivelyCollect(element,'previousSibling');},nextSiblings:function(element){return Element.recursivelyCollect(element,'nextSibling');},siblings:function(element){element=$(element);return Element.previousSiblings(element).reverse().concat(Element.nextSiblings(element));},match:function(element,selector){if(Object.isString(selector))
selector=new Selector(selector);return selector.match($(element));},up:function(element,expression,index){element=$(element);if(arguments.length==1)return $(element.parentNode);var ancestors=Element.ancestors(element);return Object.isNumber(expression)?ancestors[expression]:Selector.findElement(ancestors,expression,index);},down:function(element,expression,index){element=$(element);if(arguments.length==1)return Element.firstDescendant(element);return Object.isNumber(expression)?Element.descendants(element)[expression]:Element.select(element,expression)[index||0];},previous:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(element));var previousSiblings=Element.previousSiblings(element);return Object.isNumber(expression)?previousSiblings[expression]:Selector.findElement(previousSiblings,expression,index);},next:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.nextElementSibling(element));var nextSiblings=Element.nextSiblings(element);return Object.isNumber(expression)?nextSiblings[expression]:Selector.findElement(nextSiblings,expression,index);},select:function(element){var args=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(element,args);},adjacent:function(element){var args=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(element.parentNode,args).without(element);},identify:function(element){element=$(element);var id=Element.readAttribute(element,'id');if(id)return id;do{id='anonymous_element_'+Element.idCounter++}while($(id));Element.writeAttribute(element,'id',id);return id;},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name])return t.values[name](element,name);if(t.names[name])name=t.names[name];if(name.include(':')){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value;}}
return element.getAttribute(name);},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=='object')attributes=name;else attributes[name]=Object.isUndefined(value)?true:value;for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr])name=t.values[attr](element,value);if(value===false||value===null)
element.removeAttribute(name);else if(value===true)
element.setAttribute(name,name);else element.setAttribute(name,value);}
return element;},getHeight:function(element){return Element.getDimensions(element).height;},getWidth:function(element){return Element.getDimensions(element).width;},classNames:function(element){return new Element.ClassNames(element);},hasClassName:function(element,className){if(!(element=$(element)))return;var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)));},addClassName:function(element,className){if(!(element=$(element)))return;if(!Element.hasClassName(element,className))
element.className+=(element.className?' ':'')+className;return element;},removeClassName:function(element,className){if(!(element=$(element)))return;element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)"),' ').strip();return element;},toggleClassName:function(element,className){if(!(element=$(element)))return;return Element[Element.hasClassName(element,className)?'removeClassName':'addClassName'](element,className);},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue))
element.removeChild(node);node=nextNode;}
return element;},empty:function(element){return $(element).innerHTML.blank();},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition)
return(element.compareDocumentPosition(ancestor)&8)===8;if(ancestor.contains)
return ancestor.contains(element)&&ancestor!==element;while(element=element.parentNode)
if(element==ancestor)return true;return false;},scrollTo:function(element){element=$(element);var pos=Element.cumulativeOffset(element);window.scrollTo(pos[0],pos[1]);return element;},getStyle:function(element,style){element=$(element);style=style=='float'?'cssFloat':style.camelize();var value=element.style[style];if(!value||value=='auto'){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null;}
if(style=='opacity')return value?parseFloat(value):1.0;return value=='auto'?null:value;},getOpacity:function(element){return $(element).getStyle('opacity');},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=';'+styles;return styles.include('opacity')?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles)
if(property=='opacity')element.setOpacity(styles[property]);else
elementStyle[(property=='float'||property=='cssFloat')?(Object.isUndefined(elementStyle.styleFloat)?'cssFloat':'styleFloat'):property]=styles[property];return element;},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;return element;},getDimensions:function(element){element=$(element);var display=Element.getStyle(element,'display');if(display!='none'&&display!=null)
return{width:element.offsetWidth,height:element.offsetHeight};var els=element.style;var originalVisibility=els.visibility;var originalPosition=els.position;var originalDisplay=els.display;els.visibility='hidden';if(originalPosition!='fixed')
els.position='absolute';els.display='block';var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;els.display=originalDisplay;els.position=originalPosition;els.visibility=originalVisibility;return{width:originalWidth,height:originalHeight};},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,'position');if(pos=='static'||!pos){element._madePositioned=true;element.style.position='relative';if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0;}}
return element;},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right='';}
return element;},makeClipping:function(element){element=$(element);if(element._overflow)return element;element._overflow=Element.getStyle(element,'overflow')||'auto';if(element._overflow!=='hidden')
element.style.overflow='hidden';return element;},undoClipping:function(element){element=$(element);if(!element._overflow)return element;element.style.overflow=element._overflow=='auto'?'':element._overflow;element._overflow=null;return element;},cumulativeOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);},positionedOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(element.tagName.toUpperCase()=='BODY')break;var p=Element.getStyle(element,'position');if(p!=='static')break;}}while(element);return Element._returnOffset(valueL,valueT);},absolutize:function(element){element=$(element);if(Element.getStyle(element,'position')=='absolute')return element;var offsets=Element.positionedOffset(element);var top=offsets[1];var left=offsets[0];var width=element.clientWidth;var height=element.clientHeight;element._originalLeft=left-parseFloat(element.style.left||0);element._originalTop=top-parseFloat(element.style.top||0);element._originalWidth=element.style.width;element._originalHeight=element.style.height;element.style.position='absolute';element.style.top=top+'px';element.style.left=left+'px';element.style.width=width+'px';element.style.height=height+'px';return element;},relativize:function(element){element=$(element);if(Element.getStyle(element,'position')=='relative')return element;element.style.position='relative';var top=parseFloat(element.style.top||0)-(element._originalTop||0);var left=parseFloat(element.style.left||0)-(element._originalLeft||0);element.style.top=top+'px';element.style.left=left+'px';element.style.height=element._originalHeight;element.style.width=element._originalWidth;return element;},cumulativeScrollOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode;}while(element);return Element._returnOffset(valueL,valueT);},getOffsetParent:function(element){if(element.offsetParent)return $(element.offsetParent);if(element==document.body)return $(element);while((element=element.parentNode)&&element!=document.body)
if(Element.getStyle(element,'position')!='static')
return $(element);return $(document.body);},viewportOffset:function(forElement){var valueT=0,valueL=0;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body&&Element.getStyle(element,'position')=='absolute')break;}while(element=element.offsetParent);element=forElement;do{if(!Prototype.Browser.Opera||(element.tagName&&(element.tagName.toUpperCase()=='BODY'))){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0;}}while(element=element.parentNode);return Element._returnOffset(valueL,valueT);},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source);element=$(element);var delta=[0,0];var parent=null;if(Element.getStyle(element,'position')=='absolute'){parent=Element.getOffsetParent(element);delta=Element.viewportOffset(parent);}
if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}
if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:'class',htmlFor:'for'},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case'left':case'top':case'right':case'bottom':if(proceed(element,'position')==='static')return null;case'height':case'width':if(!Element.visible(element))return null;var dim=parseInt(proceed(element,style),10);if(dim!==element['offset'+style.capitalize()])
return dim+'px';var properties;if(style==='height'){properties=['border-top-width','padding-top','padding-bottom','border-bottom-width'];}
else{properties=['border-left-width','padding-left','padding-right','border-right-width'];}
return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10);})+'px';default:return proceed(element,style);}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==='title')return element.title;return proceed(element,attribute);});}
else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return $(document.body)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});$w('positionedOffset viewportOffset').each(function(method){Element.Methods[method]=Element.Methods[method].wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle('position')==='fixed')
offsetParent.setStyle({zoom:1});element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(proceed,element){try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
return proceed(element);});Element.Methods.getStyle=function(element,style){element=$(element);style=(style=='float'||style=='cssFloat')?'styleFloat':style.camelize();var value=element.style[style];if(!value&&element.currentStyle)value=element.currentStyle[style];if(style=='opacity'){if(value=(element.getStyle('filter')||'').match(/alpha\(opacity=(.*)\)/))
if(value[1])return parseFloat(value[1])/100;return 1.0;}
if(value=='auto'){if((style=='width'||style=='height')&&(element.getStyle('display')!='none'))
return element['offset'+style.capitalize()]+'px';return null;}
return value;};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,'');}
element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=='normal'))
element.style.zoom=1;var filter=element.getStyle('filter'),style=element.style;if(value==1||value===''){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute('filter');return element;}else if(value<0.00001)value=0;style.filter=stripAlpha(filter)+'alpha(opacity='+(value*100)+')';return element;};Element._attributeTranslations=(function(){var classProp='className';var forProp='for';var el=document.createElement('div');el.setAttribute(classProp,'x');if(el.className!=='x'){el.setAttribute('class','x');if(el.className==='x'){classProp='class';}}
el=null;el=document.createElement('label');el.setAttribute(forProp,'x');if(el.htmlFor!=='x'){el.setAttribute('htmlFor','x');if(el.htmlFor==='x'){forProp='htmlFor';}}
el=null;return{read:{names:{'class':classProp,'className':classProp,'for':forProp,'htmlFor':forProp},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute);},_getAttr2:function(element,attribute){return element.getAttribute(attribute,2);},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:"";},_getEv:(function(){var el=document.createElement('div');el.onclick=Prototype.emptyFunction;var value=el.getAttribute('onclick');var f;if(String(value).indexOf('{')>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;attribute=attribute.toString();attribute=attribute.split('{')[1];attribute=attribute.split('}')[0];return attribute.strip();};}
else if(value===''){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;return attribute.strip();};}
el=null;return f;})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null;},style:function(element){return element.style.cssText.toLowerCase();},title:function(element){return element.title;}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:'cellPadding',cellspacing:'cellSpacing'},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value;},style:function(element,value){element.style.cssText=value?value:'';}}};Element._attributeTranslations.has={};$w('colSpan rowSpan vAlign dateTime accessKey tabIndex '+'encType maxLength readOnly longDesc frameBorder').each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr;});(function(v){Object.extend(v,{href:v._getAttr2,src:v._getAttr2,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv});})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function _descendants(element){var nodes=element.getElementsByTagName('*'),results=[];for(var i=0,node;node=nodes[i];i++)
if(node.tagName!=="!")
results.push(node);return results;}
Element.Methods.down=function(element,expression,index){element=$(element);if(arguments.length==1)return element.firstDescendant();return Object.isNumber(expression)?_descendants(element)[expression]:Element.select(element,expression)[index||0];}})();}}
else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==='')?'':(value<0.00001)?0:value;return element;};}
else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;if(value==1)
if(element.tagName.toUpperCase()=='IMG'&&element.width){element.width++;element.width--;}else try{var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}
return element;};Element.Methods.cumulativeOffset=function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);};}
if('outerHTML'in document.documentElement){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element;}
content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next();var fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling)
fragments.each(function(node){parent.insertBefore(node,nextSibling)});else
fragments.each(function(node){parent.appendChild(node)});}
else element.outerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}
Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result;};Element._getContentFromAnonymousElement=function(tagName,html){var div=new Element('div'),t=Element._insertionTranslations.tags[tagName];if(t){div.innerHTML=t[0]+html+t[1];t[2].times(function(){div=div.firstChild});}else div.innerHTML=html;return $A(div.childNodes);};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element);},top:function(element,node){element.insertBefore(node,element.firstChild);},bottom:function(element,node){element.appendChild(node);},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling);},tags:{TABLE:['<table>','</table>',1],TBODY:['<table><tbody>','</tbody></table>',2],TR:['<table><tbody><tr>','</tr></tbody></table>',3],TD:['<table><tbody><tr><td>','</td></tr></tbody></table>',4],SELECT:['<select>','</select>',1]}};(function(){var tags=Element._insertionTranslations.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD});})();Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return!!(node&&node.specified);}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(div){if(!Prototype.BrowserFeatures.ElementExtensions&&div['__proto__']){window.HTMLElement={};window.HTMLElement.prototype=div['__proto__'];Prototype.BrowserFeatures.ElementExtensions=true;}
div=null;})(document.createElement('div'))
Element.extend=(function(){function checkDeficiency(tagName){if(typeof window.Element!='undefined'){var proto=window.Element.prototype;if(proto){var id='_'+(Math.random()+'').slice(2);var el=document.createElement(tagName);proto[id]='x';var isBuggy=(el[id]!=='x');delete proto[id];el=null;return isBuggy;}}
return false;}
function extendElementWith(element,methods){for(var property in methods){var value=methods[property];if(Object.isFunction(value)&&!(property in element))
element[property]=value.methodize();}}
var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=checkDeficiency('object');if(Prototype.BrowserFeatures.SpecificElementExtensions){if(HTMLOBJECTELEMENT_PROTOTYPE_BUGGY){return function(element){if(element&&typeof element._extendedByPrototype=='undefined'){var t=element.tagName;if(t&&(/^(?:object|applet|embed)$/i.test(t))){extendElementWith(element,Element.Methods);extendElementWith(element,Element.Methods.Simulated);extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()]);}}
return element;}}
return Prototype.K;}
var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||typeof element._extendedByPrototype!='undefined'||element.nodeType!=1||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();if(ByTag[tagName])Object.extend(methods,ByTag[tagName]);extendElementWith(element,methods);element._extendedByPrototype=Prototype.emptyFunction;return element;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated);}}});extend.refresh();return extend;})();Element.hasAttribute=function(element,attribute){if(element.hasAttribute)return element.hasAttribute(attribute);return Element.Methods.Simulated.hasAttribute(element,attribute);};Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)});}
if(arguments.length==2){var tagName=methods;methods=arguments[1];}
if(!tagName)Object.extend(Element.Methods,methods||{});else{if(Object.isArray(tagName))tagName.each(extend);else extend(tagName);}
function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName])
Element.Methods.ByTag[tagName]={};Object.extend(Element.Methods.ByTag[tagName],methods);}
function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value))continue;if(!onlyIfAbsent||!(property in destination))
destination[property]=value.methodize();}}
function findDOMClass(tagName){var klass;var trans={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(trans[tagName])klass='HTML'+trans[tagName]+'Element';if(window[klass])return window[klass];klass='HTML'+tagName+'Element';if(window[klass])return window[klass];klass='HTML'+tagName.capitalize()+'Element';if(window[klass])return window[klass];var element=document.createElement(tagName);var proto=element['__proto__']||element.constructor.prototype;element=null;return proto;}
var elementPrototype=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions){copy(Element.Methods,elementPrototype);copy(Element.Methods.Simulated,elementPrototype,true);}
if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass))continue;copy(T[tag],klass.prototype);}}
Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh)Element.extend.refresh();Element.cache={};};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()};},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);},getScrollHeight:function(){if(window.innerHeight&&window.scrollMaxY)return window.innerHeight+window.scrollMaxY;else if(document.body.scrollHeight>document.body.offsetHeight)return document.body.scrollHeight;else return document.body.offsetHeight;}};(function(viewport){var B=Prototype.Browser,doc=document,element,property={};function getRootElement(){if(B.WebKit&&!doc.evaluate)
return document;if(B.Opera&&window.parseFloat(window.opera.version())<9.5)
return document.body;return document.documentElement;}
function define(D){if(!element)element=getRootElement();property[D]='client'+D;viewport['get'+D]=function(){return element[property[D]]};return viewport['get'+D]();}
viewport.getWidth=define.curry('Width');viewport.getHeight=define.curry('Height');})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(element){if(!(element=$(element)))return;var uid;if(element===window){uid=0;}else{if(typeof element._prototypeUID==="undefined")
element._prototypeUID=[Element.Storage.UID++];uid=element._prototypeUID[0];}
if(!Element.Storage[uid])
Element.Storage[uid]=$H();return Element.Storage[uid];},store:function(element,key,value){if(!(element=$(element)))return;if(arguments.length===2){Element.getStorage(element).update(key);}else{Element.getStorage(element).set(key,value);}
return element;},retrieve:function(element,key,defaultValue){if(!(element=$(element)))return;var hash=Element.getStorage(element),value=hash.get(key);if(Object.isUndefined(value)){hash.set(key,defaultValue);value=defaultValue;}
return value;},clone:function(element,deep){if(!(element=$(element)))return;var clone=element.cloneNode(deep);clone._prototypeUID=void 0;if(deep){var descendants=Element.select(clone,'*'),i=descendants.length;while(i--){descendants[i]._prototypeUID=void 0;}}
return Element.extend(clone);}});var Selector=Class.create({initialize:function(expression){this.expression=expression.strip();if(this.shouldUseSelectorsAPI()){this.mode='selectorsAPI';}else if(this.shouldUseXPath()){this.mode='xpath';this.compileXPathMatcher();}else{this.mode="normal";this.compileMatcher();}},shouldUseXPath:(function(){var IS_DESCENDANT_SELECTOR_BUGGY=(function(){var isBuggy=false;if(document.evaluate&&window.XPathResult){var el=document.createElement('div');el.innerHTML='<ul><li></li></ul><div><ul><li></li></ul></div>';var xpath=".//*[local-name()='ul' or local-name()='UL']"+"//*[local-name()='li' or local-name()='LI']";var result=document.evaluate(xpath,el,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);isBuggy=(result.snapshotLength!==2);el=null;}
return isBuggy;})();return function(){if(!Prototype.BrowserFeatures.XPath)return false;var e=this.expression;if(Prototype.Browser.WebKit&&(e.include("-of-type")||e.include(":empty")))
return false;if((/(\[[\w-]*?:|:checked)/).test(e))
return false;if(IS_DESCENDANT_SELECTOR_BUGGY)return false;return true;}})(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return false;if(Selector.CASE_INSENSITIVE_CLASS_NAMES)return false;if(!Selector._div)Selector._div=new Element('div');try{Selector._div.querySelector(this.expression);}catch(e){return false;}
return true;},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m,len=ps.length,name;if(Selector._cache[e]){this.matcher=Selector._cache[e];return;}
this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){this.matcher.push(Object.isFunction(c[name])?c[name](m):new Template(c[name]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join('\n'));Selector._cache[this.expression]=this.matcher;},compileXPathMatcher:function(){var e=this.expression,ps=Selector.patterns,x=Selector.xpath,le,m,len=ps.length,name;if(Selector._cache[e]){this.xpath=Selector._cache[e];return;}
this.matcher=['.//*'];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){name=ps[i].name;if(m=e.match(ps[i].re)){this.matcher.push(Object.isFunction(x[name])?x[name](m):new Template(x[name]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.xpath=this.matcher.join('');Selector._cache[this.expression]=this.xpath;},findElements:function(root){root=root||document;var e=this.expression,results;switch(this.mode){case'selectorsAPI':if(root!==document){var oldId=root.id,id=$(root).identify();id=id.replace(/([\.:])/g,"\\$1");e="#"+id+" "+e;}
results=$A(root.querySelectorAll(e)).map(Element.extend);root.id=oldId;return results;case'xpath':return document._getElementsByXPath(this.xpath,root);default:return this.matcher(root);}},match:function(element){this.tokens=[];var e=this.expression,ps=Selector.patterns,as=Selector.assertions;var le,p,m,len=ps.length,name;while(e&&le!==e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){if(as[name]){this.tokens.push([name,Object.clone(m)]);e=e.replace(m[0],'');}else{return this.findElements(document).include(element);}}}}
var match=true,name,matches;for(var i=0,token;token=this.tokens[i];i++){name=token[0],matches=token[1];if(!Selector.assertions[name](element,matches)){match=false;break;}}
return match;},toString:function(){return this.expression;},inspect:function(){return"#<Selector:"+this.expression.inspect()+">";}});if(Prototype.BrowserFeatures.SelectorsAPI&&document.compatMode==='BackCompat'){Selector.CASE_INSENSITIVE_CLASS_NAMES=(function(){var div=document.createElement('div'),span=document.createElement('span');div.id="prototype_test_id";span.className='Test';div.appendChild(span);var isIgnored=(div.querySelector('#prototype_test_id .test')!==null);div=span=null;return isIgnored;})();}
Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:'/following-sibling::*',tagName:function(m){if(m[1]=='*')return'';return"[local-name()='"+m[1].toLowerCase()+"' or local-name()='"+m[1].toUpperCase()+"']";},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(m){m[1]=m[1].toLowerCase();return new Template("[@#{1}]").evaluate(m);},attr:function(m){m[1]=m[1].toLowerCase();m[3]=m[5]||m[6];return new Template(Selector.xpath.operators[m[2]]).evaluate(m);},pseudo:function(m){var h=Selector.xpath.pseudos[m[1]];if(!h)return'';if(Object.isFunction(h))return h(m);return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);},operators:{'=':"[@#{1}='#{3}']",'!=':"[@#{1}!='#{3}']",'^=':"[starts-with(@#{1}, '#{3}')]",'$=':"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",'*=':"[contains(@#{1}, '#{3}')]",'~=':"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",'|=':"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{'first-child':'[not(preceding-sibling::*)]','last-child':'[not(following-sibling::*)]','only-child':'[not(preceding-sibling::* or following-sibling::*)]','empty':"[count(*) = 0 and (count(text()) = 0)]",'checked':"[@checked]",'disabled':"[(@disabled) and (@type!='hidden')]",'enabled':"[not(@disabled) and (@type!='hidden')]",'not':function(m){var e=m[6],p=Selector.patterns,x=Selector.xpath,le,v,len=p.length,name;var exclusion=[];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){name=p[i].name
if(m=e.match(p[i].re)){v=Object.isFunction(x[name])?x[name](m):new Template(x[name]).evaluate(m);exclusion.push("("+v.substring(1,v.length-1)+")");e=e.replace(m[0],'');break;}}}
return"[not("+exclusion.join(" and ")+")]";},'nth-child':function(m){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",m);},'nth-last-child':function(m){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",m);},'nth-of-type':function(m){return Selector.xpath.pseudos.nth("position() ",m);},'nth-last-of-type':function(m){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",m);},'first-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-of-type'](m);},'last-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-last-of-type'](m);},'only-of-type':function(m){var p=Selector.xpath.pseudos;return p['first-of-type'](m)+p['last-of-type'](m);},nth:function(fragment,m){var mm,formula=m[6],predicate;if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';if(mm=formula.match(/^(\d+)$/))
return'['+fragment+"= "+mm[1]+']';if(mm=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(mm[1]=="-")mm[1]=-1;var a=mm[1]?Number(mm[1]):1;var b=mm[2]?Number(mm[2]):0;predicate="[((#{fragment} - #{b}) mod #{a} = 0) and "+"((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(predicate).evaluate({fragment:fragment,a:a,b:b});}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(m){m[3]=(m[5]||m[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(m);},pseudo:function(m){if(m[6])m[6]=m[6].replace(/"/g,'\\"');return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:'laterSibling',re:/^\s*~\s*/},{name:'child',re:/^\s*>\s*/},{name:'adjacent',re:/^\s*\+\s*/},{name:'descendant',re:/^\s/},{name:'tagName',re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:'id',re:/^#([\w\-\*]+)(\b|$)/},{name:'className',re:/^\.([\w\-\*]+)(\b|$)/},{name:'pseudo',re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:'attrPresence',re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:'attr',re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(element,matches){return matches[1].toUpperCase()==element.tagName.toUpperCase();},className:function(element,matches){return Element.hasClassName(element,matches[1]);},id:function(element,matches){return element.id===matches[1];},attrPresence:function(element,matches){return Element.hasAttribute(element,matches[1]);},attr:function(element,matches){var nodeValue=Element.readAttribute(element,matches[1]);return nodeValue&&Selector.operators[matches[2]](nodeValue,matches[5]||matches[6]);}},handlers:{concat:function(a,b){for(var i=0,node;node=b[i];i++)
a.push(node);return a;},mark:function(nodes){var _true=Prototype.emptyFunction;for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=_true;return nodes;},unmark:(function(){var PROPERTIES_ATTRIBUTES_MAP=(function(){var el=document.createElement('div'),isBuggy=false,propName='_countedByPrototype',value='x'
el[propName]=value;isBuggy=(el.getAttribute(propName)===value);el=null;return isBuggy;})();return PROPERTIES_ATTRIBUTES_MAP?function(nodes){for(var i=0,node;node=nodes[i];i++)
node.removeAttribute('_countedByPrototype');return nodes;}:function(nodes){for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=void 0;return nodes;}})(),index:function(parentNode,reverse,ofType){parentNode._countedByPrototype=Prototype.emptyFunction;if(reverse){for(var nodes=parentNode.childNodes,i=nodes.length-1,j=1;i>=0;i--){var node=nodes[i];if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}}else{for(var i=0,j=1,nodes=parentNode.childNodes;node=nodes[i];i++)
if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}},unique:function(nodes){if(nodes.length==0)return nodes;var results=[],n;for(var i=0,l=nodes.length;i<l;i++)
if(typeof(n=nodes[i])._countedByPrototype=='undefined'){n._countedByPrototype=Prototype.emptyFunction;results.push(Element.extend(n));}
return Selector.handlers.unmark(results);},descendant:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName('*'));return results;},child:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++){for(var j=0,child;child=node.childNodes[j];j++)
if(child.nodeType==1&&child.tagName!='!')results.push(child);}
return results;},adjacent:function(nodes){for(var i=0,results=[],node;node=nodes[i];i++){var next=this.nextElementSibling(node);if(next)results.push(next);}
return results;},laterSibling:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,Element.nextSiblings(node));return results;},nextElementSibling:function(node){while(node=node.nextSibling)
if(node.nodeType==1)return node;return null;},previousElementSibling:function(node){while(node=node.previousSibling)
if(node.nodeType==1)return node;return null;},tagName:function(nodes,root,tagName,combinator){var uTagName=tagName.toUpperCase();var results=[],h=Selector.handlers;if(nodes){if(combinator){if(combinator=="descendant"){for(var i=0,node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName(tagName));return results;}else nodes=this[combinator](nodes);if(tagName=="*")return nodes;}
for(var i=0,node;node=nodes[i];i++)
if(node.tagName.toUpperCase()===uTagName)results.push(node);return results;}else return root.getElementsByTagName(tagName);},id:function(nodes,root,id,combinator){var targetNode=$(id),h=Selector.handlers;if(root==document){if(!targetNode)return[];if(!nodes)return[targetNode];}else{if(!root.sourceIndex||root.sourceIndex<1){var nodes=root.getElementsByTagName('*');for(var j=0,node;node=nodes[j];j++){if(node.id===id)return[node];}}}
if(nodes){if(combinator){if(combinator=='child'){for(var i=0,node;node=nodes[i];i++)
if(targetNode.parentNode==node)return[targetNode];}else if(combinator=='descendant'){for(var i=0,node;node=nodes[i];i++)
if(Element.descendantOf(targetNode,node))return[targetNode];}else if(combinator=='adjacent'){for(var i=0,node;node=nodes[i];i++)
if(Selector.handlers.previousElementSibling(targetNode)==node)
return[targetNode];}else nodes=h[combinator](nodes);}
for(var i=0,node;node=nodes[i];i++)
if(node==targetNode)return[targetNode];return[];}
return(targetNode&&Element.descendantOf(targetNode,root))?[targetNode]:[];},className:function(nodes,root,className,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);return Selector.handlers.byClassName(nodes,root,className);},byClassName:function(nodes,root,className){if(!nodes)nodes=Selector.handlers.descendant([root]);var needle=' '+className+' ';for(var i=0,results=[],node,nodeClassName;node=nodes[i];i++){nodeClassName=node.className;if(nodeClassName.length==0)continue;if(nodeClassName==className||(' '+nodeClassName+' ').include(needle))
results.push(node);}
return results;},attrPresence:function(nodes,root,attr,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var results=[];for(var i=0,node;node=nodes[i];i++)
if(Element.hasAttribute(node,attr))results.push(node);return results;},attr:function(nodes,root,attr,value,operator,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var handler=Selector.operators[operator],results=[];for(var i=0,node;node=nodes[i];i++){var nodeValue=Element.readAttribute(node,attr);if(nodeValue===null)continue;if(handler(nodeValue,value))results.push(node);}
return results;},pseudo:function(nodes,name,value,root,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);if(!nodes)nodes=root.getElementsByTagName("*");return Selector.pseudos[name](nodes,value,root);}},pseudos:{'first-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.previousElementSibling(node))continue;results.push(node);}
return results;},'last-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.nextElementSibling(node))continue;results.push(node);}
return results;},'only-child':function(nodes,value,root){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
if(!h.previousElementSibling(node)&&!h.nextElementSibling(node))
results.push(node);return results;},'nth-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root);},'nth-last-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true);},'nth-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,false,true);},'nth-last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true,true);},'first-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,false,true);},'last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,true,true);},'only-of-type':function(nodes,formula,root){var p=Selector.pseudos;return p['last-of-type'](p['first-of-type'](nodes,formula,root),formula,root);},getIndices:function(a,b,total){if(a==0)return b>0?[b]:[];return $R(1,total).inject([],function(memo,i){if(0==(i-b)%a&&(i-b)/a>=0)memo.push(i);return memo;});},nth:function(nodes,formula,root,reverse,ofType){if(nodes.length==0)return[];if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';var h=Selector.handlers,results=[],indexed=[],m;h.mark(nodes);for(var i=0,node;node=nodes[i];i++){if(!node.parentNode._countedByPrototype){h.index(node.parentNode,reverse,ofType);indexed.push(node.parentNode);}}
if(formula.match(/^\d+$/)){formula=Number(formula);for(var i=0,node;node=nodes[i];i++)
if(node.nodeIndex==formula)results.push(node);}else if(m=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(m[1]=="-")m[1]=-1;var a=m[1]?Number(m[1]):1;var b=m[2]?Number(m[2]):0;var indices=Selector.pseudos.getIndices(a,b,nodes.length);for(var i=0,node,l=indices.length;node=nodes[i];i++){for(var j=0;j<l;j++)
if(node.nodeIndex==indices[j])results.push(node);}}
h.unmark(nodes);h.unmark(indexed);return results;},'empty':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(node.tagName=='!'||node.firstChild)continue;results.push(node);}
return results;},'not':function(nodes,selector,root){var h=Selector.handlers,selectorType,m;var exclusions=new Selector(selector).findElements(root);h.mark(exclusions);for(var i=0,results=[],node;node=nodes[i];i++)
if(!node._countedByPrototype)results.push(node);h.unmark(exclusions);return results;},'enabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(!node.disabled&&(!node.type||node.type!=='hidden'))
results.push(node);return results;},'disabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.disabled)results.push(node);return results;},'checked':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.checked)results.push(node);return results;}},operators:{'=':function(nv,v){return nv==v;},'!=':function(nv,v){return nv!=v;},'^=':function(nv,v){return nv==v||nv&&nv.startsWith(v);},'$=':function(nv,v){return nv==v||nv&&nv.endsWith(v);},'*=':function(nv,v){return nv==v||nv&&nv.include(v);},'~=':function(nv,v){return(' '+nv+' ').include(' '+v+' ');},'|=':function(nv,v){return('-'+(nv||"").toUpperCase()+'-').include('-'+(v||"").toUpperCase()+'-');}},split:function(expression){var expressions=[];expression.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(m){expressions.push(m[1].strip());});return expressions;},matchElements:function(elements,expression){var matches=$$(expression),h=Selector.handlers;h.mark(matches);for(var i=0,results=[],element;element=elements[i];i++)
if(element._countedByPrototype)results.push(element);h.unmark(matches);return results;},findElement:function(elements,expression,index){if(Object.isNumber(expression)){index=expression;expression=false;}
return Selector.matchElements(elements,expression||'*')[index||0];},findChildElements:function(element,expressions){expressions=Selector.split(expressions.join(','));var results=[],h=Selector.handlers;for(var i=0,l=expressions.length,selector;i<l;i++){selector=new Selector(expressions[i].strip());h.concat(results,selector.findElements(element));}
return(l>1)?h.unique(results):results;}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(a,b){for(var i=0,node;node=b[i];i++)
if(node.tagName!=="!")a.push(node);return a;}});}
function $$(){return Selector.findChildElements(document,$A(arguments));}
var Form={reset:function(form){form=$(form);form.reset();return form;},serializeElements:function(elements,options){if(typeof options!='object')options={hash:!!options};else if(Object.isUndefined(options.hash))options.hash=true;var key,value,submitted=false,submit=options.submit;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!='file'&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}
else result[key]=value;}}
return result;});return options.hash?data:Object.toQueryString(data);}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options);},getElements:function(form){var elements=$(form).getElementsByTagName('*'),element,arr=[],serializers=Form.Element.Serializers;for(var i=0;element=elements[i];i++){arr.push(element);}
return arr.inject([],function(elements,child){if(serializers[child.tagName.toLowerCase()])
elements.push(Element.extend(child));return elements;})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName('input');if(!typeName&&!name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name))
continue;matchingInputs.push(Element.extend(input));}
return matchingInputs;},disable:function(form){form=$(form);Form.getElements(form).invoke('disable');return form;},enable:function(form){form=$(form);Form.getElements(form).invoke('enable');return form;},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return'hidden'!=element.type&&!element.disabled;});var firstByIndex=elements.findAll(function(element){return element.hasAttribute('tabIndex')&&element.tabIndex>=0;}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return/^(?:input|select|textarea)$/i.test(element.tagName);});},focusFirstElement:function(form){form=$(form);form.findFirstElement().activate();return form;},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute('action')||'';if(action.blank())action=window.location.href;options.parameters=form.serialize(true);if(params){if(Object.isString(params))params=params.toQueryParams();Object.extend(options.parameters,params);}
if(form.hasAttribute('method')&&!options.method)
options.method=form.method;return new Ajax.Request(action,options);}};Form.Element={focus:function(element){$(element).focus();return element;},select:function(element){$(element).select();return element;}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair);}}
return'';},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element);},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element;},clear:function(element){$(element).value='';return element;},present:function(element){return $(element).value!='';},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!='input'||!(/^(?:button|reset|submit)$/i.test(element.type))))
element.select();}catch(e){}
return element;},disable:function(element){element=$(element);element.disabled=true;return element;},enable:function(element){element=$(element);element.disabled=false;return element;}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(element,value){switch(element.type.toLowerCase()){case'checkbox':case'radio':return Form.Element.Serializers.inputSelector(element,value);default:return Form.Element.Serializers.textarea(element,value);}},inputSelector:function(element,value){if(Object.isUndefined(value))return element.checked?element.value:null;else element.checked=!!value;},textarea:function(element,value){if(Object.isUndefined(value))return element.value;else element.value=value;},select:function(element,value){if(Object.isUndefined(value))
return this[element.type=='select-one'?'selectOne':'selectMany'](element);else{var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return;}}
else opt.selected=value.include(currentValue);}}},selectOne:function(element){var index=element.selectedIndex;return index>=0?this.optionValue(element.options[index]):null;},selectMany:function(element){var values,length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected)values.push(this.optionValue(opt));}
return values;},optionValue:function(opt){return Element.extend(opt).hasAttribute('value')?opt.value:opt.text;}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue();},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value;}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element);}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=='form')
this.registerFormCallbacks();else
this.registerCallback(this.element);},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value;}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this);},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case'checkbox':case'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;default:Event.observe(element,'change',this.onElementEvent.bind(this));break;}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element);}});(function(){var Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var docEl=document.documentElement;var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED='onmouseenter'in docEl&&'onmouseleave'in docEl;var _isButton;if(Prototype.Browser.IE){var buttonMap={0:1,1:4,2:2};_isButton=function(event,code){return event.button===buttonMap[code];};}else if(Prototype.Browser.WebKit){_isButton=function(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==1&&event.metaKey;default:return false;}};}else{_isButton=function(event,code){return event.which?(event.which===code+1):(event.button===code);};}
function isLeftClick(event){return _isButton(event,0)}
function isMiddleClick(event){return _isButton(event,1)}
function isRightClick(event){return _isButton(event,2)}
function element(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==='load'||type==='error'||(type==='click'&&currentTarget.tagName.toLowerCase()==='input'&&currentTarget.type==='radio'))
node=currentTarget;}
if(node.nodeType==Node.TEXT_NODE)
node=node.parentNode;return Element.extend(node);}
function findElement(event,expression){var element=Event.element(event);if(!expression)return element;var elements=[element].concat(element.ancestors());return Selector.findElement(elements,expression,0);}
function pointer(event){return{x:pointerX(event),y:pointerY(event)};}
function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||(event.clientX+
(docElement.scrollLeft||body.scrollLeft)-
(docElement.clientLeft||0));}
function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||(event.clientY+
(docElement.scrollTop||body.scrollTop)-
(docElement.clientTop||0));}
function stop(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true;}
Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m;});if(Prototype.Browser.IE){function _relatedTarget(event){var element;switch(event.type){case'mouseover':element=event.fromElement;break;case'mouseout':element=event.toElement;break;default:return null;}
return Element.extend(element);}
Object.extend(methods,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return'[object Event]'}});Event.extend=function(event,element){if(!event)return false;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y});return Object.extend(event,methods);};}else{Event.prototype=window.Event.prototype||document.createEvent('HTMLEvents').__proto__;Object.extend(Event.prototype,methods);Event.extend=Prototype.K;}
function _createResponder(element,eventName,handler){var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry)){CACHE.push(element);registry=Element.retrieve(element,'prototype_event_registry',$H());}
var respondersForEvent=registry.get(eventName);if(Object.isUndefined(respondersForEvent)){respondersForEvent=[];registry.set(eventName,respondersForEvent);}
if(respondersForEvent.pluck('handler').include(handler))return false;var responder;if(eventName.include(":")){responder=function(event){if(Object.isUndefined(event.eventName))
return false;if(event.eventName!==eventName)
return false;Event.extend(event,element);handler.call(element,event);};}else{if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(eventName==="mouseenter"||eventName==="mouseleave")){if(eventName==="mouseenter"||eventName==="mouseleave"){responder=function(event){Event.extend(event,element);var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode;}
catch(e){parent=element;}}
if(parent===element)return;handler.call(element,event);};}}else{responder=function(event){Event.extend(event,element);handler.call(element,event);};}}
responder.handler=handler;respondersForEvent.push(responder);return responder;}
function _destroyCache(){for(var i=0,length=CACHE.length;i<length;i++){Event.stopObserving(CACHE[i]);CACHE[i]=null;}}
var CACHE=[];if(Prototype.Browser.IE)
window.attachEvent('onunload',_destroyCache);if(Prototype.Browser.WebKit)
window.addEventListener('unload',Prototype.emptyFunction,false);var _getDOMEventName=Prototype.K;if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED){_getDOMEventName=function(eventName){var translations={mouseenter:"mouseover",mouseleave:"mouseout"};return eventName in translations?translations[eventName]:eventName;};}
function observe(element,eventName,handler){element=$(element);var responder=_createResponder(element,eventName,handler);if(!responder)return element;if(eventName.include(':')){if(element.addEventListener)
element.addEventListener("dataavailable",responder,false);else{element.attachEvent("ondataavailable",responder);element.attachEvent("onfilterchange",responder);}}else{var actualEventName=_getDOMEventName(eventName);if(element.addEventListener)
element.addEventListener(actualEventName,responder,false);else
element.attachEvent("on"+actualEventName,responder);}
return element;}
function stopObserving(element,eventName,handler){element=$(element);var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry))return element;if(eventName&&!handler){var responders=registry.get(eventName);if(Object.isUndefined(responders))return element;responders.each(function(r){Element.stopObserving(element,eventName,r.handler);});return element;}else if(!eventName){registry.each(function(pair){var eventName=pair.key,responders=pair.value;responders.each(function(r){Element.stopObserving(element,eventName,r.handler);});});return element;}
var responders=registry.get(eventName);if(!responders)return;var responder=responders.find(function(r){return r.handler===handler;});if(!responder)return element;var actualEventName=_getDOMEventName(eventName);if(eventName.include(':')){if(element.removeEventListener)
element.removeEventListener("dataavailable",responder,false);else{element.detachEvent("ondataavailable",responder);element.detachEvent("onfilterchange",responder);}}else{if(element.removeEventListener)
element.removeEventListener(actualEventName,responder,false);else
element.detachEvent('on'+actualEventName,responder);}
registry.set(eventName,responders.without(responder));return element;}
function fire(element,eventName,memo,bubble){element=$(element);if(Object.isUndefined(bubble))
bubble=true;if(element==document&&document.createEvent&&!element.dispatchEvent)
element=document.documentElement;var event;if(document.createEvent){event=document.createEvent('HTMLEvents');event.initEvent('dataavailable',true,true);}else{event=document.createEventObject();event.eventType=bubble?'ondataavailable':'onfilterchange';}
event.eventName=eventName;event.memo=memo||{};if(document.createEvent)
element.dispatchEvent(event);else
element.fireEvent(event.eventType,event);return Event.extend(event);}
Object.extend(Event,Event.Methods);Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving});Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving});Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,Event);else window.Event=Event;})();(function(){var timer;function fireContentLoadedEvent(){if(document.loaded)return;if(timer)window.clearTimeout(timer);document.loaded=true;document.fire('dom:loaded');}
function checkReadyState(){if(document.readyState==='complete'){document.stopObserving('readystatechange',checkReadyState);fireContentLoadedEvent();}}
function pollDoScroll(){try{document.documentElement.doScroll('left');}
catch(e){timer=pollDoScroll.defer();return;}
fireContentLoadedEvent();}
if(document.addEventListener){document.addEventListener('DOMContentLoaded',fireContentLoadedEvent,false);}else{document.observe('readystatechange',checkReadyState);if(window==top)
timer=pollDoScroll.defer();}
Event.observe(window,'load',fireContentLoadedEvent);})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content});},Top:function(element,content){return Element.insert(element,{top:content});},Bottom:function(element,content){return Element.insert(element,{bottom:content});},After:function(element,content){return Element.insert(element,{after:content});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(element,x,y){if(this.includeScrollOffsets)
return this.withinIncludingScrolloffsets(element,x,y);this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth);},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth);},overlap:function(mode,element){if(!mode)return 0;if(mode=='vertical')
return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight;if(mode=='horizontal')
return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth;},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element);},relativize:function(element){Position.prepare();return Element.relativize(element);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options);}};document.getElementsByClassName=function(className,parentElement){if(Prototype.BrowserFeatures.XPath){var q=".//*[contains(concat(' ', @class, ' '), ' "+className+" ')]";return document._getElementsByXPath(q,parentElement);}else{var children=($(parentElement)||document.body).getElementsByTagName('*');var elements=[],child;for(var i=0,length=children.length;i<length;i++){child=children[i];if(Element.hasClassName(child,className))
elements.push(Element.extend(child));}
return elements;}};Element.Methods.getElementsByClassName=function(element,className){return document.getElementsByClassName(className,element);}
Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element);},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0;})._each(iterator);},set:function(className){this.element.className=className;},add:function(classNameToAdd){if(this.include(classNameToAdd))return;this.set($A(this).concat(classNameToAdd).join(' '));},remove:function(classNameToRemove){if(!this.include(classNameToRemove))return;this.set($A(this).without(classNameToRemove).join(' '));},toString:function(){return $A(this).join(' ');}};Object.extend(Element.ClassNames.prototype,Enumerable);var SeekingAlpha={};SeekingAlpha.Initializer={PreLoadRepository:[],AfterLoadRepository:[],AfterAutoCompleteLoaded:[],Logger:[],Add:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);SeekingAlpha.Initializer.PreLoadRepository.push(Ref);},RunDelay:function(){SeekingAlpha.Initializer.PreLoadRepository.each(function(Ref,i){Ref();});},Run:function(){setTimeout(SeekingAlpha.Initializer.RunDelay,1);SeekingAlpha.Initializer.Add=SeekingAlpha.Initializer.LogAndRun;},LogAndRun:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);Ref();},AddAfterLoad:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);SeekingAlpha.Initializer.AfterLoadRepository.push(Ref);},RunAfterLoadDelay:function(){SeekingAlpha.Initializer.AfterLoadRepository.each(function(Ref,i){if(Ref)Ref();});},RunAfterLoad:function(){setTimeout(SeekingAlpha.Initializer.RunAfterLoadDelay,1);SeekingAlpha.Initializer.AddAfterLoad=SeekingAlpha.Initializer.LogAndRun;SeekingAlpha.Initializer.loaded=true;},AddAfterAutoCompleteLoaded:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);SeekingAlpha.Initializer.AfterAutoCompleteLoaded.push(Ref);},RunAfterAutoCompleteLoadedDelay:function(){SeekingAlpha.Initializer.AfterAutoCompleteLoaded.each(function(Ref,i){if(Ref)Ref();});},RunAfterAutoCompleteLoaded:function(){setTimeout(SeekingAlpha.Initializer.RunAfterAutoCompleteLoadedDelay,1);SeekingAlpha.Initializer.AddAfterAutoCompleteLoaded=SeekingAlpha.Initializer.LogAndRun;SeekingAlpha.Initializer.autoCompleteLoaded=true;},onDOMLoad:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);document.observe("dom:loaded",Ref);}}
window.undefined=window.undefined;var SA={};SA.Destructor=function(){try{SA=null;}catch(e){}}
SA.UsingNamespace=function(ns){var names=ns.split(".");var scope=this;for(var i=0;i<names.length;i++){var name=names[i];if((i==0)&&(name=="SA"))
continue;if(!scope[name])
scope[name]=new Object();scope=scope[name];}
return scope;}
Event.observe(window,'unload',SA.Destructor);if(!window.console)console={};console.log=console.log||function(){};console.warn=console.warn||function(){};console.error=console.error||function(){};console.info=console.info||function(){};(function(){var scope=SA.UsingNamespace("SA.Models");scope.PortfolioModel=function(args){var portfolioUri=null;var QuoteData=null;var slugs=null;var stocksNumber;var title;var _this=this;var TransactionValue={1:1,2:-1}
this.RemovePortfolioTagID=function(pTagId,oncomplete,onfailed){if(!pTagId)return;new Ajax.Request('/account/remove_slug_from_portfolio',{asynchronous:true,evalScripts:true,parameters:{portfolio_tag_id:pTagId,pu:portfolioUri},onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){SetQuoteData(response.portfolio_stocks);SetStocksNumber();if(oncomplete)oncomplete();return;}else{if(onfailed)onfailed(response.errors);else alert(response.errors);}}});}
this.addSymbols=function(symbols,oncomplete,onfailed,alerts){alerts=alerts||"";if(!symbols)return;new Ajax.Request('/account/add_symbols_to_portfolio',{asynchronous:true,evalScripts:true,parameters:{symbols:symbols,pu:portfolioUri,rta:alerts},onComplete:function(transport){var response;try{response=transport.responseText.evalJSON()}catch(e){}
if(transport.status==200&&response&&response.errors==null){SetQuoteData(response.portfolio_stocks);SetSlugs(symbols);SetStocksNumber();try{symbols.split(",").each(function(slug){slug=slug.toLowerCase().replace(/ /g,"");if(slug!="")addToCookie('user_watchlist_slugs',slug);});}catch(e){}
if(oncomplete){if(typeof(oncomplete)=='function')oncomplete(response);else eval(oncomplete);}
return;}else{if(onfailed){response=response||{errors:"Unknown error"};if(typeof(oncomplete)=='function')onfailed(response);else eval(onfailed);}else alert(response.errors)}}});var slugs=symbols?symbols.replace(/^(\s*,)+|(,\s*)+$|\s+/g,'').replace(/,+/g,','):'',count=(slugs?slugs.split(',').length:0);if(window.pageTracker)pageTracker._trackEvent('Add To Portfolio',SA.Utils.unifiedPath(),''+count);}
this.createPortfolio=function(name,stocks,oncomplete,onfailed,email_alerts,eventLabel){var val=scope.PortfolioModel.CheckingValidation({title:name,allowEmptyTitle:true});if(!eventLabel)eventLabel=SA.Utils.unifiedPath();if(val[0]){response={errors:val[1]};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}
var params={name:name,stocks:stocks,rta:email_alerts,source:eventLabel};if(!is_users_cookie_exists()){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];}else{var response={errors:"Invalid user"};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}}
new Ajax.Request('/account/add_new_portfolio',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(stocks&&stocks!="")
try{var slugs=stocks.toLowerCase().replace(/ /g,"");if(slugs!=""&&user_cookie){user_cookie.user_watchlist_slugs=((user_cookie.user_watchlist_slugs||'')+','+slugs).split(',').sort().uniq(true).join(',').replace(/^,/,'');}}catch(e){}
SetPortfolioUri(response.portfolio_uri);if(typeof(oncomplete)=='function')oncomplete(response);else if(oncomplete)eval(oncomplete);}else{if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);}},on500:function(){if(typeof(onfailed)=='function')onfailed();else if(onfailed)eval(onfailed);}});var slugs=stocks?stocks.replace(/^(\s*,)+|(,\s*)+$|\s+/g,'').replace(/,+/g,','):'',count=(slugs?slugs.split(',').length:0);SA.Stats.GA.event("Create Portfolio",eventLabel,''+count);}
this.GetTransactionValue=function(tran){return TransactionValue[tran];}
this.GetStocksNumber=function(){return stocksNumber;}
this.GetUri=function(){return portfolioUri;}
this.GetQuoteData=function(){return QuoteData;}
this.RedirectToPortfolioPage=function(){if(portfolioUri)location.href="/account/portfolio?pu="+portfolioUri;}
this.RedirectToHoldingsPage=function(){if(portfolioUri)location.href="/account/edit_holdings?pu="+portfolioUri}
this.Destroy=function(oncomplete,onfailed){if(!portfolioUri)return;new Ajax.Request('/account/destroy_portfolio',{asynchronous:true,evalScripts:true,parameters:{pu:portfolioUri},onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed();alert(response.errors);}}});}
this.SetRealTimeMarketCurrent=function(alert,oncomplete,onfailed,source){if(!portfolioUri||alert==null)return;new Ajax.Request('/account/set_real_time_market_current',{asynchronous:true,evalScripts:true,parameters:{pu:portfolioUri,alert:alert,source:source},onComplete:function(transport){var response;if(transport.status==200){try{response=transport.responseText.evalJSON();}catch(e){response={errors:"Unknown Error"};}}else{response={errors:"Unknown Error"};}
if(response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed(response.errors);}}});}
this.SetRealTimeArticles=function(alert,oncomplete,onfailed,source){if(!portfolioUri||alert==null)return;new Ajax.Request('/account/set_real_time_articles',{asynchronous:true,evalScripts:true,parameters:{pu:portfolioUri,alert:alert,source:source},onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed();alert(response.errors);}}});}
this.SetDailyPreMarketSummary=function(alert,oncomplete,onfailed,source){if(!portfolioUri||alert==null)return;var params={pu:portfolioUri,alert:alert,source:source};if(!is_users_cookie_exists()){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];}else{var response={errors:"Invalid user"};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}}
new Ajax.Request('/account/set_daily_pre_market_summary',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed();alert(response.errors);}}});}
this.GetSlugs=function(){return slugs;}
this.GetTitle=function(){return title;}
function SetPortfolioUri(uriName){portfolioUri=uriName;}
function SetSlugs(newSlugs){if(newSlugs)newSlugs=newSlugs.gsub(" ","");slugs=slugs?slugs+","+newSlugs:newSlugs;}
function Init(args){if(args){SetPortfolioUri(args.portfolioUri);SetQuoteData(args.quoteData);if(args.slugs)SetSlugs(args.slugs);else InitSlugs();if(args.title)SetTitle(args.title);SetStocksNumber();}}
function SetTitle(name){title=name;}
function SetStocksNumber(){var number=0;for(key in QuoteData){number=number+1}
stocksNumber=number;}
function SetQuoteData(data){QuoteData=data;}
function InitSlugs(){var s=[];for(q in QuoteData){s.push(QuoteData[q]["slug"]);}
SetSlugs(s.uniq().join(","));}
Init(args);}
scope.PortfolioModel.CheckingValidation=function(vars){var validations={};validations["title"]={reg:/^.{0,22}$/,msg:"Portfolio name can't be blank (maximum is 22 characters)",not_empty:!vars.allowEmptyTitle}
var validationErrors={};var bool=false
for(var validation in validations){if(!(validations[validation].reg.test(vars[validation]))||(validations[validation].not_empty&&vars[validation].trim().length==0)){validationErrors[validation]=validations[validation].msg;bool=true;}}
return[bool,validationErrors];}
scope.PortfolioModel.listPortfolios=function(onsuccess,onfailure,searchSymbol){var params={};if(searchSymbol)params['sym']=searchSymbol;new Ajax.Request('/account/get_portfolios_list',{asynchronous:true,parameters:params,onSuccess:function(response){if(onsuccess)try{var result=response.responseText.evalJSON();if(result.errors){if(onfailure)onfailure(result.errors);}else onsuccess(result);}catch(e){if(onfailure)onfailure("Invalid response");}},onFailure:function(){if(onfailure)onfailure("Unknown error");}});}
scope.PortfolioModel.maxStocks=50;scope.PortfolioModel.AddSymbolsWithAlertsToPortfolios=function(purisForSymbols,symbols,alerts,oncomplete,onfailed,eventSource){if(!symbols||(!purisForSymbols&&!alerts))return;var params={slugs:symbols,puris:purisForSymbols,rta:alerts};if(!is_users_cookie_exists()){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];}else{var response={errors:"Invalid user"};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}}
params.source=eventSource;new Ajax.Request('/account/add_symbols_with_alerts_to_portfolios',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response;try{response=transport.responseText.evalJSON();}catch(e){response={errors:"unknown error"};}
if(transport.status==200&&response&&response.errors==null){try{user_cookie.user_watchlist_slugs=((user_cookie.user_watchlist_slugs||'')+','+slugs).split(',').sort().uniq(true).join(',').replace(/^,/,'');}catch(e){}
if(oncomplete)oncomplete(response);}else{if(onfailed)onfailed(response);}}});}})();(function(){var scope=SA.UsingNamespace("SA.Models");scope.SubscriptionModel=function(args){}
scope.SubscriptionModel.subscribe=function(tag_ids,modes,source,onSuccess,onFailure){var params={tags:tag_ids,modes:modes,source:source};if(!SA.Data.User.loggedIn()&&!grAuth(params,onFailure))return;SA.Utils.ajax('/account/ajax_subscribe_to_tags',params,onSuccess,onFailure);}
scope.SubscriptionModel.unsubscribe=function(tag_ids,modes,onSuccess,onFailure){var params={tags:tag_ids,modes:modes};if(!SA.Data.User.loggedIn()&&!grAuth(params,onFailure))return;SA.Utils.ajax('/account/ajax_unsubscribe_from_tags',params,onSuccess,onFailure);}
var grAuth=function(params,onFailure){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];return true;}else{var response={errors:"Invalid user"};if(typeof(onFailure)=='function')onFailure(response);else if(onFailure)eval(onFailure);return false;}}})();(function(){var scope=SA.UsingNamespace("SA.Models");scope.StockTalkModel={}
scope.StockTalkModel.popUp=function(st){AlphaBox.Loading();scope.StockTalkModel.openPopUp=true;if(oRefresher){oRefresher.Clear();}
AlphaBox.onAfterClose=function(){SA.Models.StockTalkModel.openPopUp=false;if(oRefresher)oRefresher.Activate();}
AlphaBox.onBeforeClose=function(){SA.Models.StockTalkModel.openPopUp=false;if(oRefresher)oRefresher.Activate();}
var st_id=st.getAttribute("st_id");var params={id:st_id,page:1,limit:5};SA.Models.StockTalkModel.getStockTalksReplies({params:params,st:$$('#li_'+st_id)[0]},scope.StockTalkModel.renderPopUp);}
scope.StockTalkModel.renderPopUp=function(response,st){var h=[];h.push("<div class='replyPopup'>");h.push("<div onclick='AlphaBox.Close();' class='lightbox_x'></div>");h.push("<div class='top' realy_st='true'>");h.push(st.innerHTML);h.push("</div>");h.push("<div class='latest_stocktalks_snippet popup'>");h.push("<div  class='form_area'>");h.push("<ul replies_st='"+st.getAttribute("st_id")+"'>");var size=response.length;for(var i=0;i<size;i++){var ttt=SA.Models.StockTalkModel.renderSingleST(response[i],'small');h.push(ttt);}
h.push("</ul>");h.push("</div>");h.push(scope.StockTalkModel.replyTextArea(st.getAttribute("st_id")));h.push("<span class='close link' onclick='AlphaBox.Close();'>Close</span>");AlphaBox.AddHtml(h.join(" "));setTimeout(scope.StockTalkModel.addScrollerToPopup,100);}
scope.StockTalkModel.reportSpam=function(el){var st_id=el.getAttribute("st_id");report_spam(el,'StockTalk',st_id,function(){el.parentNode.parentNode.addClassName('reported')});}
var objDiv=document.getElementById("divExample");scope.StockTalkModel.addScrollerToPopup=function(el){var pop=$$('.replyPopup');var alphabox=$('alphabox-modal-window');if(!alphabox)return;var formArea=$$('.replyPopup .form_area')[0];alphabox.addClassName('getPosition');alphabox.style.marginTop=-(alphabox.getHeight()/2)+"px";if(pop.length==0)return;el=='newStock'?formArea.scrollTop=formArea.scrollHeight:formArea.scrollTop=0;if($$('.latest_stocktalks_snippet ul')[0].getHeight()>370){pop[0].addClassName('scroll');}
else{pop[0].removeClassName('scroll');}
if($$('.latest_stocktalks_snippet ul')[0].getHeight()<1){pop[0].addClassName('noStocks');}
else{pop[0].removeClassName('noStocks');}}
scope.StockTalkModel.btn=null;scope.StockTalkModel.getStockTalksOnScroll=function(args){if(!args.btn)return;scope.StockTalkModel.btn=args.btn;scope.StockTalkModel.btn.currentPage=2;scope.StockTalkModel.btn.container=args.container;scope.StockTalkModel.btn.stopGet=false;scope.StockTalkModel.btn.slugs=args.slugs;scope.StockTalkModel.btn.subjects=args.subjects;scope.StockTalkModel.btn.user_id=args.user_id;scope.StockTalkModel.btn.typeOf=args.typeOf;scope.StockTalkModel.btn.limit=args.limit;scope.StockTalkModel.btn.order_by_reply=args.order_by_reply;scope.StockTalkModel.btn.addOnComplete=function(response){scope.StockTalkModel.btn.children[0].className="older_archives";new Insertion.Bottom(scope.StockTalkModel.btn.container,response.html);scope.StockTalkModel.btn.currentPage+=1;if(scope.StockTalkModel.btn.currentPage>=response.total_pages){scope.StockTalkModel.btn.stopGet=true;scope.StockTalkModel.btn.remove();}}
if(args.onclick)
scope.StockTalkModel.btn.onclick=function(){if(scope.StockTalkModel.btn.stopGet)return;SA.Models.StockTalkModel.btn.children[0].className="loader";var params={page:scope.StockTalkModel.btn.currentPage,slugs:scope.StockTalkModel.btn.slugs,user_id:scope.StockTalkModel.btn.user_id,subjects:scope.StockTalkModel.btn.subjects,type_of:scope.StockTalkModel.btn.typeOf,limit:scope.StockTalkModel.btn.limit};if(scope.StockTalkModel.btn.order_by_reply)params.order_by_reply=1;SA.Models.StockTalkModel.getStockTalks(params,scope.StockTalkModel.btn.addOnComplete);}
else{SA.Utils.saScroll.add("st_getStockTalksOnScroll",function(){if(scope.StockTalkModel.btn.stopGet)return;if(!ScrollerCloseToElement(scope.StockTalkModel.btn,350))return;SA.Models.StockTalkModel.btn.children[0].className="loader";var params={page:scope.StockTalkModel.btn.currentPage,slugs:scope.StockTalkModel.btn.slugs,user_id:scope.StockTalkModel.btn.user_id,subjects:scope.StockTalkModel.btn.subjects,type_of:scope.StockTalkModel.btn.typeOf,limit:scope.StockTalkModel.btn.limit};if(scope.StockTalkModel.btn.order_by_reply)params.order_by_reply=1;SA.Models.StockTalkModel.getStockTalks(params,scope.StockTalkModel.btn.addOnComplete);});}}
scope.StockTalkModel.bInProcces={}
scope.StockTalkModel.getStockTalks=function(params,onComplete,onFailed){if(scope.StockTalkModel.bInProcces["getStockTalks"])return;scope.StockTalkModel.bInProcces["getStockTalks"]=true;if(!params)return;new Ajax.Request('/stock_talk/ajax_get_stocktalks',{asynchronous:true,parameters:params,onSuccess:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(onComplete)onComplete(response);}else{if(onFailed)onFailed(response.errors);}
SA.Models.StockTalkModel.initSt();socialSA.init();},onComplete:function(){SA.Models.StockTalkModel.bInProcces["getStockTalks"]=false;},on500:function(response){if(onFailed)onFailed(response.errors);},on502:function(response){if(onFailed)onFailed(response.errors);}});}
scope.StockTalkModel.enterText=function(el){if(!is_users_cookie_exists()){scope.StockTalkModel.openPopUp=false;open_header_log_in_popup_lightbox('login','publish StockTalks');return;}
SA.Models.StockTalkModel.showBtn(el);if(el.isFocuse)return;el.isFocuse=true;el=SA.Utils.Expansion.Input(el);el.addClassName('focus_lightbox');el.clearAll();el.Onfocus=function(self){if(self.HasFocused)return;self.HasFocused=false;if(oRefresher)oRefresher.Clear();var st_id=self.getAttribute("st_id");st_id=st_id?'_'+self.getAttribute("st_id"):'';$('char_counter'+st_id).style.display='block';SA.Models.StockTalkModel.realTime.stop();}
el.Onblur=function(){if(oRefresher)oRefresher.Activate();SA.Models.StockTalkModel.realTime.run();}
var tempEl=$("stock_talk_form");if(tempEl&&el.id=="stock_talk_textarea")tempEl.addClassName("focus");else el.style.height='40px';if(el)el.clearAll();SA.Models.StockTalkModel.realTime.stop();}
scope.StockTalkModel.getMoreReplies=function(st){var st_id=st.getAttribute("st_id");if(!st_id)return;var section=$$("[st_section_id="+st_id+"]");if(section.length>0)section[0].setAttribute("is_open","true")
if(scope.StockTalkModel.getMoreReplies.bInProcces[st_id])return;scope.StockTalkModel.getMoreReplies.bInProcces[st_id]=true;var args={}
args.params={id:st_id};args.st={id:st_id};scope.StockTalkModel.getStockTalksReplies(args,function(response,st){var el=$$("[older_replies_st="+st.id+"]")[0];if(!el)return;$$("[replies_bt="+st.id+"]")[0].hide();var h=[];var size=response.length;for(var i=0;i<size;i++){if($$("[st_id="+response[i].id+"]").length==0)
h.push(scope.StockTalkModel.renderSingleST(response[i],"stocktalk_message_plus_time"));}
el.innerHTML=h.join(" ");el.parentNode.style.display="block";},function(errors){scope.StockTalkModel.getMoreReplies.bInProcces[errors.st_id]=false;});}
scope.StockTalkModel.getMoreReplies.bInProcces={};scope.StockTalkModel.getStockTalksReplies=function(args,onComplete,onFailed){if(!args.params)return;new Ajax.Request('/stock_talk/ajax_get_replies',{asynchronous:true,parameters:args.params,onSuccess:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(onComplete)onComplete(response,args.st);}else{if(onFailed)onFailed(response.errors);}
SA.Models.StockTalkModel.initSt();socialSA.init();}});}
scope.StockTalkModel.renderOnlyOrigin=function(sTalks,source,ulID){var size=sTalks.size();if(size==0)return"";var h;if(ulID)h=["<ul id='"+ulID+"'>"];else h=["<ul>"]
for(var i=0;i<size;i++){h.push(SA.Models.StockTalkModel.renderSingleST(sTalks[i],"stocktalk_message_plus_time small",source));}
h.push=["</ul>"];return h.join(" ");}
scope.StockTalkModel.renderSingleST=function(st,cls,source){var is_origin=st.origin;var cls_origin=is_origin?"origin":"";var subject_id=st.subject_id?'subject_id="'+st.subject_id+'"':"";var real_st=st.not_real_st?"":'realy_st="true" poster="'+st.user_id+'"';source=source||"";if(is_users_cookie_exists())cls_origin+=" login";cls=cls?cls:"";var h=[];var url_prefix=st.author?'/author/'+st.author:'/user/'+st.user_id;h.push('<li '+subject_id+' '+real_st+' st_id="'+st.id+'" class="single_stocktalk '+cls_origin+'" id="li_'+st.id+'">');h.push('<a sasource="'+source+'_pic" class="user_image '+(st.author?"author":"")+'" href="'+url_prefix+(st.author?'':'/profile')+'"/>');h.push('<img src="'+st.user_image+'"/>');h.push('</a>');h.push('<div class="'+cls+'">');h.push('<a sasource="'+source+'_nick" href="'+url_prefix+'/stocktalk"/>'+st.nick+'</a>');h.push(st.content);h.push('<div class="time_wrapper">');h.push('<span class="time_ago">'+st.publish_on+'</span>');if(is_origin&&real_st!=""){var small=cls==""?"":"small='true'"
if(small!=true){h.push('<a href="<%=  st.uri %>" sasource="st_pl" class="st_permalink" ></a>');}
h.push('<div class="reply_cnt">');h.push('<span class="reply_st link" '+small+' st_id="'+st.id+'" onclick="SA.Models.StockTalkModel.enterReply(this)">Reply</span>');var replies_number='';if(st.replies&&st.replies>0)replies_number="("+st.replies+")";h.push('<span reply_numbers='+st.id+' class="num_of_reply_st link">'+replies_number+'</span>');h.push('</div>');}
if(real_st!=""){h.push('<div class="delete_wrapper" style="display:none" id="delete_'+st.id+'">');h.push('<span class="bull">&bull;</span>');h.push('<span class="commenter_abuse"><span onclick="SA.Models.StockTalkModel.reportSpam(this)" st_id="'+st.id+'" class="link report_abuse"><span class="punctuation">!</span>Report Abuse</span></span>');h.push('<a href='+st.uri+' class="link" style="display:none"></a>');h.push('</div>');}
h.push('</div>');h.push('</div>');h.push('</li>');return h.join(" ");}
scope.StockTalkModel.showBtn=function(stTextArea){if(stTextArea.btnShow)return;stTextArea.btnShow=true;var sub_id=stTextArea.getAttribute("subject_id");sub_id=sub_id?sub_id:"";var btns=$$("[st_btn"+sub_id+"]");var size=btns.length;for(var i=0;i<size;i++){btns[i].style.display="block";}}
scope.StockTalkModel.openPopUp=false;scope.StockTalkModel.enterReply=function(rp){if(rp.getAttribute("small")&&!scope.StockTalkModel.openPopUp){scope.StockTalkModel.popUp(rp);return;}
if(!is_users_cookie_exists()){scope.StockTalkModel.openPopUp=false;open_header_log_in_popup_lightbox('login','publish StockTalks');return;}
var id=rp.getAttribute("st_id");var fEl;if(id)fEl=$("stock_talk_textarea_"+id);if(fEl){if($('reply_wrap_'+id))$('reply_wrap_'+id).removeClassName('no_replies');fEl.focus();if((fEl.viewportOffset().top+fEl.getHeight()>document.viewport.getHeight()))
window.scrollTo(0,document.viewport.getScrollOffsets().top+75);}}
scope.StockTalkModel.replyTextArea=function(st_id){var h=[];h.push('<form method="post" id="stock_talk_form_'+st_id+'" onsubmit="return false;">');h.push(' <div class="feed_text_image_cnt">');var user_nick=readCookie('user_nick');if(is_users_cookie_exists()&&user_nick==null||user_nick=="")
h.push('  <div><fieldset class=\'choose_username_stocktalk\' id=\'choose_username_row_'+st_id+'\'><input type=\'text\' value="Please choose username:" title="Please choose username:" class=\'text nick\' name=\'nick\' id=\'input_nick\' maxlength=\'80\' onfocus=\'SA.Utils.Expansion.Input(this); this.clearAll();\'/></fieldset></div>');h.push('  <div class="feed_text_content">');h.push('      <textarea subject_id="'+st_id+'" name="stock_talk[content]" style="color:#959595" id="stock_talk_textarea_'+st_id+'" onKeyDown="return charCounter(this,\'_'+st_id+'\');" onKeyUp="return charCounter(this,\'_'+st_id+'\');" onfocus="SA.Models.StockTalkModel.enterText(this); if (this.clearAll) this.clearAll();" tabindex="99" title="Add a reply...">Add a reply...</textarea>');h.push('      <div id="st_text_'+st_id+'">');h.push('        <div st_btn'+st_id+'  style="display:none" class="right_content">');h.push('          <div  id="char_counter_'+st_id+'" class="characters">140 characters</div>');h.push('          <span class="gigyaSubmitCNT">');h.push('          <div  gigya_id="stocktalk_'+st_id+'" class="gigya_unit"></div>');h.push('          <input type="button" id="stocktalk_submit_button_'+st_id+'" tabindex="100" class="submit grad" value="Submit" onclick="ajax_submit_stock_talk(this, false, false, \'_'+st_id+'\');">');h.push('          </span>');h.push('        </div>');h.push('      </div>');h.push('  </div>');h.push(' </div>');h.push('</form>');return h.join(" ");}
scope.StockTalkModel.displayOptions=function(stElid,stocktalk_id,poster){var stEl=$(stElid);if(!(stEl))return;if(is_users_cookie_exists())stEl.addClassName("login");var permission_needed="spam fighter";var spam_fighter=readCookie('user_perm')&&readCookie('user_perm').indexOf(permission_needed)>-1
if(spam_fighter||(readCookie("user_id")==poster)){if(spam_fighter)
new Insertion.Top(stEl,'<div id="deletespan_'+stocktalk_id+'" onclick="delete_stocktalk(\''+stElid.id+'\',\''+stocktalk_id+'\',\'false\');" class="del_btn">&nbsp;</div>');else
new Insertion.Top(stEl,'<div st_id="'+stocktalk_id+'" onclick="SA.Models.StockTalkModel.Delete(this);" class="del_btn">&nbsp;</div>');}}
scope.StockTalkModel.Delete=function(el){var st_id=el.getAttribute("st_id");if(SA.Models.StockTalkModel.openPopUp){if(!confirm("Are you sure you want to remove this post?"))return;delete_stock_talk(null,st_id,false);}
else{var popup=["<div class='delete_lightbox'>"];popup.push("<h1>Are you sure you want to remove this post?</h1>");popup.push("<div class='grad close orange' id='deletespan_"+st_id+"' onclick='delete_stock_talk(this,\""+st_id+"\",false); AlphaBox.Close();'>Remove</div>");popup.push("<div class='grad close' onclick='AlphaBox.Close();'>Cancel</div>");popup.push("</div>");AlphaBox.Loading();AlphaBox.AddHtml(popup.join(" "));}}
scope.StockTalkModel.initSt=function(){var elements=$$('[realy_st=true]');var size=elements.length;for(var i=0;i<size;i++){scope.StockTalkModel.displayOptions(elements[i],elements[i].getAttribute("st_id"),elements[i].getAttribute("poster"));elements[i].setAttribute("realy_st",false);}}
scope.StockTalkModel.addNew=function(st_id,text){var el=$$("[replies_st="+st_id+"]");if(el.length>0){scope.StockTalkModel.fixReplyNumbers(st_id,1,"add");new Insertion.Bottom(el[0],text);}}
scope.StockTalkModel.minusOne=function(st_id){var el=$$("[replies_st="+st_id+"]");if(el.length>0)scope.StockTalkModel.fixReplyNumbers(st_id,-1,"add");}
scope.StockTalkModel.removeReply=function(reply){scope.StockTalkModel.minusOne(reply.getAttribute("subject_id"));reply.remove();}
scope.StockTalkModel.fixReplyNumbers=function(st_id,number,status){var el=$$("[reply_numbers="+st_id+"]");var size=el.length;if(size==0)return;var new_number=el[0].innerHTML.trim()!=""?parseInt(el[0].innerHTML.gsub(/\(|\)/,"")):0;switch(status){case"reset":new_number=number;break;case"add":new_number+=number;break;}
var comment_box=[];for(var i=0;i<size;i++){comment_box=$$("[st_section_id="+st_id+"] .add_reply_to_st_input_wrapper");if(new_number>0){el[i].innerHTML=el[i].getAttribute("without_closer")?new_number:"("+new_number+")";if(comment_box.length>0)comment_box[0].removeClassName('no_replies');}else{el[i].innerHTML="";if(comment_box.length>0)comment_box[0].addClassName('no_replies');}}}
scope.StockTalkModel.realTime=new function(){var self=this;this.bInProcces=false;this.sts={};this.lastUpdateTime=0;this.stIds=[];this.container;this.slugs;this.subjects;this.page_request;this.filter;this.interval;this.intervalTime=10000*9;this.posted=[];this.hasBeenInit=false;this.postedEl={};this.init=function(args){if(args.container)self.container=args.container;if(args.subjects)self.subjects=args.subjects;if(args.slugs)self.slugs=args.slugs;if(args.page_request)self.page_request=args.page_request;if(args.filter)self.filter=args.filter;self.order_by_reply=args.order_by_reply;self.hasBeenInit=true;self.collect();}
this.collect=function(){if(!self.hasBeenInit)return;var collected=$$("[st_section_id]");var size=collected.length;for(var i=0;i<size;i++){var st=collected[i];var id=st.getAttribute("st_section_id");self.addStId(id);self.sts[id]=self.getInfo(st);}
collected=$$("[posted_section_id]");size=collected.length;for(var i=0;i<size;i++){var id=collected[i].getAttribute("posted_section_id");self.posted.push(id);self.postedEl[id]=collected[i];}}
this.addStId=function(id){if(self.stIds.indexOf(id)==-1)self.stIds.push(id);}
this.getStIdString=function(){return self.stIds.join(",");}
this.getInfo=function(el){var hash={};hash.el=el;hash.replies={};hash.reply_ids=[];var st_id=el.getAttribute("st_section_id");var replies=el.select("[poster]");var size=replies.length;if(size>0){for(var i=0;i<size;i++){var re=replies[i];var r_id=re.getAttribute("st_id");if(r_id!=st_id){hash.reply_ids.push(r_id)
hash.replies[r_id]=re;}}}
return hash;}
this.update=function(data){scope.StockTalkModel.realTime.remove(data.deleted)
var updated=data.updated;for(st_id in updated){var replies=updated[st_id]["rep"];if(replies){var size=replies.length;for(var i=0;i<size;i++){var reply=replies[i];if(!self.sts[st_id].replies[reply.id]){var text=self.insertNewReply(reply);scope.StockTalkModel.addNew(st_id,text);self.sts[st_id].replies[reply.id]=$$("[st_id="+reply.id+"]")[0];self.sts[st_id].reply_ids.push(reply.id+"");var replies_number=self.sts[st_id].reply_ids.length;scope.StockTalkModel.fixReplyNumbers(st_id,updated[st_id]["reply_counts"],"reset");if(updated[st_id]["reply_counts"]>2&&!self.sts[st_id].el.getAttribute("is_open")){var remove_el_id=self.sts[st_id].reply_ids[0];self.sts[st_id].replies[remove_el_id].remove();self.sts[st_id].replies[remove_el_id]=false;self.sts[st_id].reply_ids=self.sts[st_id].reply_ids.slice(1,replies_number);if($$('[replies_bt='+st_id+']')[0])$$('[replies_bt='+st_id+']')[0].style.display="block";}}}}}
var latest=data.newset;for(st_id in latest){st=latest[st_id]
var nSt;if(!self.sts[st_id]&&st["st"]["is_just_a_stocktalk"]){nSt=['<ul st_section_id=\''+st_id+'\'>'];nSt.push(scope.StockTalkModel.renderSingleST(st["st"],"stocktalk_message_plus_time"));var showReplies="style='display:none'";if(st["st"].replies>2){showReplies="";}
nSt.push('<li replies_bt="'+st["st"].id+'" '+showReplies+' class="view_all_st_replies"><span st_id="'+st["st"].id+'" limit="'+st["st"].replies+'" onclick="SA.Models.StockTalkModel.getMoreReplies(this)">View all <span without_closer="true" reply_numbers="'+st["st"].id+'">'+st["st"].replies+'</span> replies</span></li>');nSt.push('<li><ul older_replies_st=\''+st["st"].id+'\'></ul></li>');var replies=st["replies"];if(replies){for(var i=0;i<replies.length;i++){nSt.push(scope.StockTalkModel.renderSingleST(replies[i],"stocktalk_message_plus_time"));}}
nSt.push('<li><ul replies_st=\''+st["st"].id+'\'></ul></li>');nSt.push('<li class=\'add_reply_to_st_input_wrapper'+(replies?"":" no_replies")+'\' >');nSt.push(scope.StockTalkModel.replyTextArea(st["st"].id));nSt.push('</li>');nSt.push('</ul>');new Insertion.Top(self.container,nSt.join(" "));}else{if(self.posted.indexOf(st_id)==-1&&!st["st"]["is_just_a_stocktalk"]){nSt=['<ul posted_section_id="'+st_id+'">'];st["st"]["not_real_st"]=true;nSt.push(scope.StockTalkModel.renderSingleST(st["st"],"stocktalk_message_plus_time"));nSt.push('</ul>');new Insertion.Top(self.container,nSt.join(" "));}}}
scope.StockTalkModel.initSt();socialSA.init();self.collect();}
this.insertNewReply=function(reply){return scope.StockTalkModel.renderSingleST(reply,"stocktalk_message_plus_time")}
this.run=function(){if(!self.hasBeenInit)return;self.collect();self.interval=setInterval(function(){self.getNew(self.update)},self.intervalTime);}
this.stop=function(){clearInterval(self.interval);}
this.remove=function(st_ids){var size=st_ids.length;if(size==0)return;for(var i=0;i<size;i++){var el=self.sts[st_ids[i]]
if(el){el.el.remove();}
el=self.postedEl[st_ids[i]];if(el)el.remove();el=$('li_'+st_ids[i]);if(el)scope.StockTalkModel.removeReply(el);}}
this.getNew=function(onComplete,onFailed){if(self.bInProcces)return false;self.bInProcces=true;var ids=self.getStIdString();var t=self.lastUpdateTime;var params={st_ids:ids,time:t,page_request:self.page_request,subjects:self.subjects,slugs:self.slugs,filter:self.filter};if(self.order_by_reply)params.order_by_reply=1;new Ajax.Request('/stock_talk/ajax_get_newest',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(onComplete)onComplete(response);}else{if(onFailed)onFailed(response.errors);}
SA.Models.StockTalkModel.realTime.bInProcces=false;}});}}})();function delete_stocktalk_and_block_user(row_id,stocktalk_id,need_refresh){if(!confirm("Are you sure you want to delete this StockTalk?"))return;new Ajax.Request('/moderator/ajax_delete_stocktalk_and_block_user',{asynchronous:true,evalScripts:true,parameters:"stocktalk_id="+stocktalk_id+"&refresh="+need_refresh,onComplete:function(transport){if(transport.status==200&&transport.responseText!="failed"){var temp=$$("[st_section_id="+stocktalk_id+"]");if(temp.length>0)temp[0].remove();else $(row_id).remove();}}});}
function delete_stocktalk(row_id,stocktalk_id,need_refresh){if(!confirm("Are you sure you want to delete this StockTalk?"))return;new Ajax.Request('/moderator/ajax_delete_stocktalk',{asynchronous:true,evalScripts:true,parameters:"stocktalk_id="+stocktalk_id+"&refresh="+need_refresh,onComplete:function(transport){if(transport.status==200&&transport.responseText!="failed"){var temp=$$("[st_section_id="+stocktalk_id+"]");if(temp.length>0){temp[0].remove();}
else{var el=$("li_"+stocktalk_id);if(el)SA.Models.StockTalkModel.removeReply(el);}}}});}
(function(){var scope=SA.UsingNamespace("SA.Models");scope.StockModel={}
scope.StockModel.reg=/\b[A-Z]+(?:\.[A-Z]+)?\b/g;scope.StockModel.isRealStock=function(stock){return symbols.indexOf("<"+stock.toUpperCase()+">")!=-1;}
scope.StockModel.stringToStocksString=function(stocks,sperator){sperator=sperator?sperator:",";return scope.StockModel.stringToStocksArray(stocks)[0].join(sperator);}
scope.StockModel.stringToStocksArray=function(stocks){var ar=stocks?stocks.toUpperCase().match(scope.StockModel.reg):null;var size=ar?ar.length:0;if(size==0)return[[],[]];var rec=[];var unrec=[];for(var i=0;i<size;i++)(scope.StockModel.isRealStock(ar[i]))?rec.push(ar[i]):unrec.push(ar[i]);return[rec,unrec];}
scope.StockModel.stringToSymbolLinkString=function(stocks,sperator,targetBlank){targetBlank=targetBlank||true
if(targetBlank)targetBlank="target='_blank'";sperator=sperator?sperator:",";var sym=scope.StockModel.stringToStocksArray(stocks)[0];var size=sym.length;var result=[];for(var i=0;i<size;i++){result.push("<a href='/symbol/"+sym[i].toLowerCase()+"' "+targetBlank+">"+sym[i].toUpperCase()+"</a>");}
return result.join(sperator)}
scope.isStockLink=function(string){return/\/symbol\/[a-zA-Z]{1,5}(\.[a-zA-Z]{1,2})?$/.test(string)}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Expansion=new function(){var OCOHandlers=[];this.Input=function(input,opt){var empty,error,emptyText,initVal,passwordObj=null,onEnterClb,focused=false;opt=opt||{};input=$(input);if(!input||input.SAExpanded)return input;input.onblur=function(){if(input.Empty()){empty=true;if(passwordObj){passwordObj.style.display='';input.style.display='none';}else{input.value=emptyText;input.addClassName('default_text');}}
input.style.color=empty?"#8D8D8D":"#000000";if(this.Onblur)this.Onblur(this);focused=false;};input.onfocus=function(){input.style.color="#000000";input.removeClassName('default_text');if(empty||error)input.value="";if(input.Onfocus)input.Onfocus(this);empty=error=false;focused=true;};input.clearAll=function(){this.style.color="#000000";this.value="";input.ClearErrorMode();};input.Reset=function(){input.value="";if(!focused)input.onblur();input.ClearErrorMode();};input.Focused=function(){return focused;}
input.resetInitVal=function(){initVal=input.value;}
input.Changed=function(){return(input.GetValue()!=initVal);};input.Empty=function(){return empty||input.value.trim()=='';}
input.GetValue=function(){return empty?'':input.value.trim();};input.SetValue=function(value){empty=!value||value.trim()=='';input.value=value;if(!focused)input.onblur();};input.SetError=function(text){input.style.color='#ff0000';input.value=text;error=true;}
input.Error=function(){return error;}
input.ErrorMode=function(){input.addClassName('input_error');if(passwordObj)passwordObj.addClassName('input_error');try{input.focus();}catch(e){};}
input.ClearErrorMode=function(){input.removeClassName('input_error');if(passwordObj)passwordObj.removeClassName('input_error');}
input.setOnEnterKey=function(clb){if(onEnterClb)input.stopObserving('keypress',onEnterClb);if(clb){onEnterClb=function(event){if(event.keyCode==13)clb(event);};input.observe('keypress',onEnterClb);}else onEnterClb=null;}
var hasEmpty=typeof(input.getAttribute('empty'))=="string"?input.getAttribute('empty'):null;if(!hasEmpty&&input.title==input.value)input.value='';emptyText=hasEmpty||input.title||'';initVal=input.value.trim();if(emptyText&&/password/i.test(input.type)){passwordObj=$(document.createElement('input'));passwordObj.value=emptyText;passwordObj.className=input.className+' default_text';for(var field in input.style)if(input.style[field])passwordObj.style[field]=input.style[field];passwordObj.style.color="#8D8D8D";passwordObj.style.display='none';input.parentNode.insertBefore(passwordObj,input);var focus=input.focus;input.focus=function(){input.style.display='';passwordObj.style.display='none';setTimeout(function(){focus.apply(input);},10);focused=true;}
passwordObj.onfocus=function(){input.focus();}}
if(document.activeElement!=input)input.onblur();input.autocomplete='off';if(opt.autocomplete){AutoCompleteSAConfig.Load('input_'+(input.id||''),{Input:input,AddAfterInput:true,Symbols:(opt.autocomplete.stocks||false),Authors:(opt.autocomplete.authors||false),MultipleInsert:true,AutoInsert:true,AfterSubmit:opt.onEnterKey});}else if(opt.onEnterKey)input.setOnEnterKey(opt.onEnterKey);input.SAExpanded=true;return input;}
this.setOnClickOutside=function(object,callback,skipCount){if((object=$(object))&&callback){var handler={obj:object,f:callback,skip:skipCount};for(var i=0;i<OCOHandlers.length;i++)if(OCOHandlers[i].obj==object){OCOHandlers[i]=handler;return;}
OCOHandlers.push(handler);}}
this.removeOnClickOutside=function(object){if((object=$(object)))for(var i=0;i<OCOHandlers.length;i++)if(OCOHandlers[i].obj==object){OCOHandlers.splice(i,1);return;}}
Event.observe(document,'click',function(event){var target=event.findElement(),len=OCOHandlers.length;for(var i=0;i<len;i++){var handler=OCOHandlers[i];if(handler.skip){handler.skip-=1;continue;}
if(target!=handler.obj&&!target.descendantOf(handler.obj)){try{handler.f(event);}catch(e){if(window.console)console.error("onClickOutside handler error: "+e.message);}}}});};scope.saScroll=new function(){this.func={};this.delay_func={};this.timeOut={};this.add=function(func_name,func_to_run){SA.Utils.saScroll.func[func_name]=function(){clearTimeout(SA.Utils.saScroll.timeOut[func_name]);SA.Utils.saScroll.timeOut[func_name]=setTimeout(SA.Utils.saScroll.delay_func[func_name],400);};SA.Utils.saScroll.delay_func[func_name]=function(){func_to_run();};Event.observe(window,"scroll",SA.Utils.saScroll.func[func_name]);}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Env=new function(){var _nonie6=((/MSIE/i.test(navigator.userAgent))&&((/MSIE 7/i.test(navigator.userAgent))||(/MSIE 8/i.test(navigator.userAgent))));this.isIE=/MSIE/i.test(navigator.userAgent);this.isIE6=(/MSIE 6/i.test(navigator.userAgent)&&!_nonie6);this.isIE7=/MSIE 7/i.test(navigator.userAgent);this.isIE8=(/MSIE 8/i.test(navigator.userAgent)||(this.isIE7&&/trident\/\d/i.test(navigator.userAgent)));this.isIE9=(/MSIE 9/i.test(navigator.userAgent)||(this.isIE7&&/trident\/\d/i.test(navigator.userAgent)));this.isFirefox=/Firefox/i.test(navigator.userAgent);this.isOpera=/Opera/i.test(navigator.userAgent);this.isWebkit=/Webkit/i.test(navigator.userAgent);this.isChrome=/Chrome/i.test(navigator.userAgent);this.isIPod=/iPod/i.test(navigator.userAgent);this.isIPhone=/iPhone/i.test(navigator.userAgent);this.isIPad=/iPad/i.test(navigator.userAgent);this.isIOS5=/(iPad|iPhone);.*CPU.*OS 5_\d/i.test(navigator.userAgent);this.mobileOS=typeof orientation!='undefined'?true:false;this.touchOS=('ontouchstart'in document.documentElement)?true:false;this.isAndroid=/android/i.test(navigator.userAgent);this.WebkitVersion=(this.isWebkit)?parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]):0;this.touchSupport=('ontouchstart'in window&&!this.isChrome);this.hasTouch=((this.isAndroid||this.isIPad||this.isIPhone||this.isIPod)&&this.touchSupport);this.isAppleDevice=(this.isIPad||this.isIPhone||this.isIPod);this.hasOrientationChange=('onorientationchange'in window);this.useLocalStorage=('localStorage'in window);this.isStrict=(document.compatMode=="CSS1Compat");this.isFixeSupport=!(this.isIE6||(this.touchSupport&&!this.isIOS5));};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Button=function(args){var ButtonElement=null;var onclick,loaderCls,loaderObj,locked=false;this.HideButton=function(){ButtonElement.style.visibility="hidden";}
this.ShowButton=function(){ButtonElement.style.visibility="visible";}
this.Lock=function(){locked=true;ButtonElement.onclick=null;if(loaderCls)ButtonElement.addClassName(loaderCls);else if(loaderObj)loaderObj.style.display='';}
this.UnLock=function(){locked=false;ButtonElement.onclick=onclick;if(loaderCls)ButtonElement.removeClassName(loaderCls);else if(loaderObj)loaderObj.style.display='none';}
this.Focus=function(){ButtonElement.focus();}
this.getElement=function(){return ButtonElement;}
this.SetClass=function(nClass){ButtonElement.className=nClass;}
this.ClassName=function(cName){ButtonElement.className=cName;}
this.GetElement=function(){return ButtonElement;}
this.SetOnclick=function(newOnclick){ButtonElement.onclick=onclick=newOnclick;}
this.click=function(){if(!locked)onclick();}
function Init(args){ButtonElement=$(args.element);ButtonElement.onclick=args.onclick;if(args.onclick)onclick=args.onclick;if(args.loaderObj)loaderObj=$(args.loaderObj);loaderCls=args.loaderCls;}
Init(args);};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Connection=new function(){this.Test=function(onsuccess){var c=document.createElement("img");c.onload=onsuccess;c.src="http://static1.seekingalpha.com/images/empty.gif?r"+(Math.round(100000*Math.random())+"="+(new Date()).getTime());}}})();(function(){SymbolData=new function(){var retries={},asset_hosts=null,script_container=null,symbols=[],refreshInterval=null,onBeforeLoadAll=null,_this=this,handleFunctions={},INDEX=0;this.Undefined=true;this.handle_data=function(symbol,data){var funcs=handleFunctions[symbol];if(!funcs)return;var len=funcs.length;for(var i=0;i<len;i++){if(funcs[i])funcs[i](symbol,data);}};this.handle_no_data=function(symbol){SymbolData.retry};this.AddHandleFunction=function(symbolArr,func){var len=symbolArr.length;for(var i=0;i<len;i++){var s=symbolArr[i].toUpperCase();if(!handleFunctions[s])handleFunctions[s]=[];if(handleFunctions[s].indexOf(func)==-1)handleFunctions[s].push(func);}}
this.load=function(symbol,no_asset_host){symbol=symbol.trim();var retry=retries[symbol];if(retry&&retry[1])clearInterval(retry[1]);if(symbol=='')return;var script=document.createElement('script');var host=(!no_asset_host&&asset_hosts)?asset_hosts[symbol.charCodeAt(0)%asset_hosts.length]:'';script.src=host+"/memcached2/portfolio_data/"+symbol.toLowerCase()+"?r="+Math.floor(Math.random()*10000);(script_container||document.body).appendChild(script);};this.retry=function(symbol){var retry=retries[symbol];if(!retry)retry=retries[symbol]=[0];if(retry[1]||retry[0]>=10)return;retry[0]++;retry[1]=setTimeout(function(){retry[1]=null;_this.load(symbol,retry[0]<4);},(retry[0]<4?1:10)*1000);};this.loadAll=function(){if(onBeforeLoadAll)onBeforeLoadAll();var len=symbols.length;for(var i=0;i<len;i++)_this.load(symbols[i]);};this.startRefresh=function(refresh_rate){_this.stopRefresh();if(refresh_rate)refreshInterval=setInterval(_this.loadAll,refresh_rate*1000);};this.stopRefresh=function(){if(refreshInterval)clearInterval(refreshInterval);refreshInterval=null;};this.setSymbols=function(list){symbols=list;}
this.NewSymbol=function(symbol,func){_this.addSymbols([symbol]);_this.AddHandleFunction([symbol],func);_this.load(symbol);}
this.addSymbols=function(lis){var ls=symbols.join(",").toUpperCase();var s=ls==""?lis.join(",").toUpperCase():symbols.join(",").toUpperCase()+","+lis.join(",").toUpperCase()
_this.setSymbols(s.split(",").uniq());}
this.getSymbols=function(){return symbols;}
this.config=function(opt){if(opt.script_container&&!(script_container&&!_this.Undefined))script_container=$(opt.script_container)
if(opt.asset_hosts&&!(asset_hosts&&!_this.Undefined))asset_hosts=opt.asset_hosts;if(opt.symbols)_this.addSymbols(opt.symbols);if(opt.onBeforeLoadAll&&!(onBeforeLoadAll&&!_this.Undefined))onBeforeLoadAll=opt.onBeforeLoadAll;if(opt.handle_data)_this.AddHandleFunction(opt.symbols,opt.handle_data);if(opt.handle_no_data&&!(_this.handle_no_data&&!_this.Undefined))_this.handle_no_data=opt.handle_no_data;if(opt.refresh_rate)_this.startRefresh(opt.refresh_rate);}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.QuotesOnPage=new function(){var symbols=[];var qTags={};var _this=this;var DOWN="down";var UP="up";var NOT_AVILABLE=["N/A",""];this.Init=function(asset_host,refresh_rate){var tags=$$("[sa_quote]");InitQTags(tags);if(SymbolData.Undefined)
SymbolData.config({handle_data:SA.Utils.QuotesOnPage.SetSymbolData,handle_no_data:SymbolData.retry,script_container:'symbol_data_script_container',refresh_rate:refresh_rate,asset_hosts:asset_host,symbols:symbols});else
SymbolData.AddHandleFunction(symbols,SA.Utils.QuotesOnPage.SetSymbolData);}
this.GetQTags=function(){return qTags;}
this.SetSymbolData=function(s,d){var qts=SA.Utils.QuotesOnPage.GetQTags()[s];if(qts){var len=qts.length;for(var i=0;i<len;i++)
SA.Utils.QuotesOnPage.SetValueByPut(qts[i],qts[i].getAttribute("put"),d);}}
this.SetValueByPut=function(t,p,d){var v;switch(p){case"per":v=CalPercent(d);break;case"last":v=CalLast(d);break;case"chg":v=CalChg(d);break;default:v=["-",""];break;}
t.innerHTML=v[0];t.className=v[1];}
function CalChg(d){if(d["last"]&&d["close"]){var v=NiceQuoteValue(d["last"]-d["close"]);return["$"+v,GetClass(v)];}
else
return NOT_AVILABLE;}
this.AddQTag=function(tag){var s=tag.getAttribute("s").toUpperCase();if(!qTags[s])qTags[s]=[];qTags[s].push(tag);AddSymbol(s);return s;}
function CalPercent(d){var v;if(d["last"]&&d["close"]){v=NiceQuoteValue(((d["last"]-d["close"])/d["close"])*100);return[v+"%",GetClass(v)]}
else
return NOT_AVILABLE;}
function CalLast(d){var v=d["last"];if(v)return["$"+NiceQuoteValue(v),""];else return NOT_AVILABLE;}
function GetClass(v){if(v<0)return DOWN;if(v>0)return UP;return"";}
function NiceQuoteValue(v){if((v>-1000)&&(v<1000))return v.toFixed(2);return v;}
function AddSymbol(s){if(symbols.indexOf(s)==-1)
symbols.push(s);}
function InitQTags(tags){var len=tags.length;var ns=[];for(var i=0;i<len;i++)ns.push(_this.AddQTag(tags[i]));SymbolData.addSymbols(ns);SymbolData.loadAll();}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.TopNavPopUp=function(link_id,container_id){var btn;var navPop;var visible=false;var self=this;this.Show=function(){navPop.style.display="block";btn.className='top_nav_arrow_up';visible=true;SA.Utils.Expansion.setOnClickOutside(navPop,self.Hide,1);}
this.Hide=function(){navPop.style.display="none";btn.className='top_nav_arrow_down';visible=false;}
this.Click=function(){if(!visible)self.Show();}
this.Init=function(link_id,container_id){if($(link_id)){btn=$(link_id);btn.onclick=self.Click;navPop=$(container_id);}}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Promotion=new function(){this.DefaultAlerts="rta_market_currents,rta_articles";};scope.Promotion.Shared=new function(){var popupContainer,prevEmail;var closePopup=function(){popupContainer.hide();popupContainer.innerHTML='';SA.Utils.Expansion.removeOnClickOutside(popupContainer);popupContainer=null;}
this.showRegisterPopup=function(container,symbol,dashboardId,dashboardTitle,initEventSource,events){var promoClass=dashboardId?SA.Utils.Promotion.Newsletter:SA.Utils.Promotion.Quote;events=events||{};if(!events.alreadySubscribed)events.alreadySubscribed=promoClass.AlreadySubscriberMsg;if(!events.registered)events.registered=promoClass.RegisterMsg;if(!events.forgotPassword)events.forgotPassword=promoClass.ForgotPasswordMsg;popupContainer=container=$(container);var tmp_text=['<div class="m_pop_inner">','<div class="m_pop_arrow"><span></span></div>','<div class="add_to_portfolio_area">',(dashboardId?'<div class="add_title">To get the <strong>'+dashboardTitle+'</strong><br/>newsletter simply fill in your email:</div>':'<div class="add_title">To get email alerts on <strong>'+symbol+'</strong><br/>simply fill in your email:</div>'),'<input id="promotion_box_email" class="promotion_box_email" spellcheck="false" />','<div class="promotion_box_login">','<div class="green">You\'re already registered with this email.</div>','<div class="pls_enter_pswd">Please enter your password to continue:</div>','<input type="password" id="promotion_box_password" class="promotion_box_password" />','</div>','<div class="m_pop_error" id="get_alerts_error" style="display:none"></div>','<div class="button_and_never_spam">','<div class="we_never_spam">(we never spam)</div>','<div class="cpb_get_alerts_btn" id="get_alerts_btn">'+(dashboardId?'Get Newsletter':'Get Alerts')+'</div>','<div style="float:right;margin:7px 5px 0 0;display:none;" id="get_alerts_loader"><img src="http://static.seekingalpha.com/images/loader.gif"></div>','<div class="cleaner"></div>','<div id="get_alerts_fp_btn" class="forgot_password">Forgot password?</div>','<div class="cleaner"></div>','</div>','</div>','<div class="promotion_box_close">X</div>','<div class="cleaner"></div>','</div>'];container.innerHTML=tmp_text.join("");container.style.display='block';container.down(".promotion_box_close").observe('click',closePopup);SA.Utils.Expansion.setOnClickOutside(container,closePopup,1);promoClass.trackEvent('Shown popup');var regClick=function(){if(email.Empty()){email_err.innerHTML="Fill your email to continue";email_err.show();email.focus();return;}
var emailValue=prevEmail=email.GetValue();email_err.hide();btn.Lock();promoClass.Register(emailValue,(dashboardId||symbol),function(response){btn.UnLock();if(response.message=='already_subscriber'&&events.alreadySubscribed)events.alreadySubscribed(response.slugs,emailValue);else if(events.registered)events.registered(emailValue);closePopup();},function(response){btn.UnLock();if(response.errors=='already_registered'){btn.SetOnclick(loginClick);forgotPassword=new SA.Utils.Button({element:$('get_alerts_fp_btn'),loaderObj:'get_alerts_loader',onclick:function(){email_err.hide();forgotPassword.Lock();promoClass.ForgotPassword(emailValue,function(response){closePopup();events.forgotPassword(emailValue);},function(response){forgotPassword.UnLock();var er={'invalid_email':'Invalid Email'}[response.errors]||"Unknown error";email_err.innerHTML=er;email_err.show();});}});password.Reset();popupContainer.addClassName("login_mode");email_err.hide();password.focus();}else{var er={'invalid_email':'Invalid Email'}[response.errors]||"Unknown error";email_err.innerHTML=er;email_err.show();}});};var loginClick=function(){var emailValue=email.GetValue();if(emailValue!=prevEmail){btn.SetOnclick(regClick);regClick();popupContainer.removeClassName("login_mode");return;}
email_err.hide();btn.Lock();promoClass.Login(emailValue,password.GetValue(),function(){btn.UnLock();promoClass.SetAutoPop(dashboardId?{tag_id:dashboardId,title:dashboardTitle}:{});location.reload();},function(response){btn.UnLock();var er={'invalid_email':'Invalid Email','empty_password':"Password shouldn't be empty",'login_failed':"Wrong password"}[response.errors]||"Unknown error";email_err.innerHTML=er;email_err.show();password.Reset();password.focus();});};var btn=new SA.Utils.Button({element:"get_alerts_btn",loaderObj:"get_alerts_loader",onclick:regClick}),email=SA.Utils.Expansion.Input('promotion_box_email',{onEnterKey:btn.click}),email_err=$('get_alerts_error'),password=SA.Utils.Expansion.Input('promotion_box_password',{onEnterKey:btn.click}),forgotPassword;popupContainer.removeClassName("login_mode");email.focus();return;}};scope.Promotion.Quote=new function(){var currentSymbol=null,portfolios={},popupContainer,showLocked=false,eventSource,registered_mail;var KEY="proQ"
var DEFAULT_ALERTS=SA.Utils.Promotion.DefaultAlerts;var self=this;var events={};var trackEvent=function(label,opt){opt=opt||{};SA.Stats.GA.event('RTA',opt.source||eventSource,label,opt.value);}
this.trackEvent=trackEvent;var trackPV=function(opt){opt=opt||{};SA.Stats.GA.event('RTA',opt.source||eventSource,'page views',opt.value,true);}
this.trackPV=trackPV;var setSubscribedCookie=function(){createCookie('hasrta','1',3500);}
this.setSubscribedCookie=function(){setSubscribedCookie();}
this.isEverSubscribed=function(){return cookieExists('hasrta');}
function displayPopup(){popupContainer.show();var loader=$('loader_while_fetch');if(loader)loader.remove();trackEvent('Shown popup');if(events.shownPopup)events.shownPopup();}
var fillPortfolios=function(pAr){var loader=$('promotion_box_loader');if(loader)loader.remove();var container=$('promotion_box_portfolios');if(!container)return;var tmp_text=[],canSubscribe=true,chk_selected=false,has_sym=false;if(pAr&&pAr.length>0){for(var i=0;i<pAr.length;i++){portfolios[pAr[i].puri]=new SA.Models.PortfolioModel({portfolioUri:pAr[i].puri});var param='';if(pAr[i].has_sym){param=' disabled="1" checked="1"';has_sym=true;}else{if(!pAr[i].has_sym)param+=' puri="'+pAr[i].puri+'"';if(!chk_selected){param+=' checked="1"';chk_selected=true;}}
tmp_text.push(['<li>','<input type="checkbox" id="port_chk_'+i+'"'+param+'/>','<label for="port_chk_'+i+'">'+dash(pAr[i].title,11)+'</label>','<div class="cleaner"></div>','</li>'].join(''));}
if(canSubscribe){container.innerHTML=tmp_text.join("");if(pAr.length!=1)container.show();}
tmp_text=[];tmp_text.push('<div style="color:red;margin:0 0 4px 18px;display:none;float:left;" id="get_alerts_error"></div>');tmp_text.push('<div class="cleaner"></div>');if(canSubscribe){var autoAdd=(pAr.length==1||has_sym);if(!autoAdd)displayPopup();tmp_text.push('<div class="cpb_get_alerts_btn" id="get_alerts_btn">Get alerts</div>');}else{displayPopup();tmp_text.push('<div class="already_subscribed">You are already subscribed to alerts on '+currentSymbol+'. Add other stocks <a href="/account/portfolio">here</a>.</div>');}}
if((pAr.length!=1&&pAr.length<14&&canSubscribe)||pAr.length==0){tmp_text.push('<div style="color:red;display:none" id="new_portfolio_error"></div>');tmp_text.push('<div class="cleaner"></div>');tmp_text.push('<div class="cpb_get_alerts_line">or <span class="link" id="new_portfolio_btn">create a new portfolio and get alerts</span></div>');}
var footer=$('promotion_box_footer');footer.innerHTML=tmp_text.join("");var actionBtn=$('get_alerts_btn'),alertsError=$('get_alerts_error');if(actionBtn){actionBtn=new SA.Utils.Button({element:actionBtn,loaderObj:'get_alerts_loader',onclick:function(){var ar=container.select('input'),puris=[];alertsError.style.display='none';if(!autoAdd||!has_sym)for(var i=0;i<ar.length;i++){if(ar[i].checked){var puri=ar[i].getAttribute('puri');if(puri)puris.push(puri);}}
if(puris.length>0||has_sym){actionBtn.Lock();SA.Models.PortfolioModel.AddSymbolsWithAlertsToPortfolios(puris.join(','),currentSymbol,DEFAULT_ALERTS,function(response){closePopup();if(!events.createdPortfolio||events.subscribed({stocks:response.stocks,stock_ids:response.stock_ids}))showSubscribedToAlertsMsg({addedTags:(response.stocks||[])});actionBtn.UnLock();setSubscribedCookie();},function(response){displayPopup();alertsError.innerHTML=response.errors||'Error occured';alertsError.style.display='block';actionBtn.UnLock();},eventSource);trackEvent('Added'+(autoAdd?' (auto)':''),{value:puris.uniq().length});}else{alertsError.innerHTML='* No change made';alertsError.style.display='block';}}});}
var newPortfoioBtn=$('new_portfolio_btn'),newPortfolioError=$('new_portfolio_error');if(newPortfoioBtn){newPortfoioBtn=new SA.Utils.Button({element:newPortfoioBtn,onclick:function(){newPortfolioError.style.display='none';newPortfoioBtn.Lock();new SA.Models.PortfolioModel().createPortfolio("",currentSymbol,function(response){closePopup();if(!events.createdPortfolio||events.createdPortfolio({stocks:response.stocks,stock_ids:response.stock_ids,reason:'button'}))showPortfolioCreatedMsg();newPortfoioBtn.UnLock();setSubscribedCookie();},function(response){alertsError.innerHTML=response.errors||'Error occured';alertsError.style.display='block';newPortfoioBtn.UnLock();},DEFAULT_ALERTS,eventSource);trackEvent('Create new: button');}});}
if(autoAdd)actionBtn.click();}
var fillErrors=function(errors){var loader=$('promotion_box_loader');if(loader)loader.remove();alert(errors);}
var closePopup=function(){popupContainer.style.display='none';popupContainer.innerHTML='';SA.Utils.Expansion.removeOnClickOutside(popupContainer);popupContainer=null;var loader=$('loader_while_fetch');if(loader)loader.remove();if(events.closedPopup)events.closedPopup();}
var hasPortfolios=function(){return cookieExists('user_watchlist_slugs');}
var showPortfolioCreatedMsg=function(opt){if(!opt)opt={};var aHTML=[];aHTML.push('<div class="customize_pop_bordeaux rta_welcome">');if(opt.welcomeBack)aHTML.push('<h1>Welcome back '+readCookie('user_nick')+',</h1>');aHTML.push('<h3 style="font-size:1em !important; padding-bottom:5px; font-weight:700;">You have successfully subscribed to real-time alerts!</h3>');aHTML.push('<div style="padding-bottom:10px;">A portfolio with your stocks is now available on your portfolio page.<br/>Add/Edit your stocks <a href="/account/portfolio" style="color:#024999 !important">here</a></div>');aHTML.push('<div class="emails_be_sent">Emails will be sent to <strong>'+readCookie('user_email').replace(/ /g,'+')+'</strong> <span class="update_email">[<a href="/account/account_preferences">Update email address</a>]</span></div>');aHTML.push('</div>');aHTML.push('<div class="close_pop_bordeaux" onclick="AlphaBox.Close();"></div>');aHTML.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(aHTML.join(" "));if(events.closedThankYouPopup)AlphaBox.onAfterClose=events.closedThankYouPopup;}
var showSubscribedToAlertsMsg=function(opt){if(!opt)opt={};var aHTML=[],addedTags=(opt.addedTags||[]);aHTML.push('<div class="customize_pop_bordeaux rta_pop">');aHTML.push('<h1>You have successfully subscribed to real-time alerts!</h1>');aHTML.push('<div>'+SA.Utils.joinWithAnd(addedTags)+(addedTags.length==1?' has':' have')+' been added to your portfolio. If you want to add/edit stocks <a href="/account/portfolio">visit your portfolio page</a></div>');aHTML.push('<div style="padding-top:10px">');aHTML.push('<div class="emails_be_sent">Emails will be sent to <strong>'+readCookie('user_email').replace(/ /g,'+')+'</strong> <span  class="update_email" style="color:#024999">[<a href="/account/account_preferences">Update email address</a>]</span></div>');aHTML.push('</div>');aHTML.push('</div>');aHTML.push('<div class="close_pop_bordeaux" onclick="AlphaBox.Close();"></div>');aHTML.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(aHTML.join(""));if(events.closedThankYouPopup)AlphaBox.onAfterClose=events.closedThankYouPopup;}
var symbolLinks=function(slugs){var ar=slugs||(currentSymbol||'').split(/,\s*/),links=[];for(var i=0;i<ar.length;i++)links.push('<a href="/symbol/'+ar[i].toLowerCase()+'" sasource="promo">'+ar[i].toUpperCase()+'</a>');return SA.Utils.joinWithAnd(links);}
this.show=function(container,symbol,initEventSource,_events){events=_events||{};if(popupContainer)closePopup();popupContainer=container=$(container);if(symbol)currentSymbol=symbol.replace(/\s+/g,'').replace(/^,+|,+$/g,'').replace(/,+/g,', ').toUpperCase();eventSource=initEventSource||SA.Utils.unifiedPath();if(!SA.Data.User.loggedIn()){SA.Utils.Promotion.Shared.showRegisterPopup(container,currentSymbol,null,null,eventSource,events);return;}
if(!hasPortfolios()){if(showLocked)return;showLocked=true;new SA.Models.PortfolioModel().createPortfolio("",currentSymbol,function(response){if(!events.createdPortfolio||events.createdPortfolio({stocks:response.stocks,stock_ids:response.stock_ids,reason:'no_portfolios'}))showPortfolioCreatedMsg();showLocked=false;setSubscribedCookie();},function(){showLocked=false;},DEFAULT_ALERTS,eventSource);trackEvent('Create new: no portfolios');return;}
var tmp_text=['<div class="m_pop_inner logged_in">','<div class="m_pop_arrow"><span></span></div>','<div class="add_to_portfolio_area">','<div class="add_title">Add '+currentSymbol+' to your portfolio:</div>','<div class="loader" id="promotion_box_loader" style="margin: 17px 0 20px 0;"><img src="http://static.seekingalpha.com/images/loader.gif" /> Loading...</div>','<ul id="promotion_box_portfolios" style="display:none"></ul>','</div>','<div id="promotion_box_footer"></div>','<div class="promotion_box_close">X</div>','</div>'];container.innerHTML=tmp_text.join("");container.insert({before:'<img id="loader_while_fetch" class="loader_while_fetch" style="margin-left:10px" src="http://static.seekingalpha.com/images/loader.gif" />'});container.down(".promotion_box_close").observe('click',closePopup);SA.Utils.Expansion.setOnClickOutside(container,closePopup,1);SA.Models.PortfolioModel.listPortfolios(fillPortfolios,fillErrors,currentSymbol);}
this.Register=function(email,slugs,success,failure,opt){opt=opt||{}
if(!rxEmail.test(email))return failure({errors:'invalid_email'});if(!slugs)return failure({errors:'no_slugs'});var source=(eventSource&&!/^\//.test(eventSource))?'source=pr_'+eventSource.replace(/(\w)\w*\s*/g,"$1").replace(/\W+/g,'_').replace(/^_/,''):null;var params={'user[email]':email,rta_slugs:slugs,id:'login',activity:'rta','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,''),rta_source:eventSource};if(!opt.noAlerts)params.rta_add_alerts=1;if(source)params.force_params=source;return SA.Utils.ajax("/authentication/registration",params,function(response){if(!response.registration){trackEvent('Reg err: '+response.message);failure({errors:response.message});}else{registered_mail=email;trackEvent('Registered'+(opt.noAlerts?' (w/o alerts)':''),{value:slugs.split(',').length});setSubscribedCookie();success(response);}},function(response){trackEvent('Reg err: '+response.errors);failure(response);});}
this.Login=function(email,password,success,failure,opt){opt=opt||{};if(!rxEmail.test(email))return failure({errors:'invalid_email'});if(!password)return failure({errors:'empty_password'});var params={'user[email]':email,'user[password]':password,id:'login',activity:'rta','function':'',rta_source:eventSource};if(opt.addStocks)params['rta_slugs']=opt.addStocks;if(opt.addRTA)params['rta_add_alerts']=1;return SA.Utils.ajax("/authentication/login",params,function(response){if(!response.login){trackEvent('Log err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Log err: '+response.errors);failure(response);});}
this.ForgotPassword=function(email,success,failure){if(!rxEmail.test(email))return failure({errors:'invalid_email'});return SA.Utils.ajax("/authentication/forgot_password",{'user[email]':email,id:'login',activity:'rta','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,'')},function(response){if(!response.forgot_password){trackEvent('Forgot Password err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Forgot Password err: '+response.errors);failure(response);});}
this.ForgotPasswordMsg=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>We've sent instructions on how to reset your password to your email inbox.</h3>");aHtml.push("<div class='cant_see_note'>(If you can't find it, please check your spam filter.)</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.RegisterMsg=function(email){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>Please confirm your registration by clicking the link in the email we've sent to "+(email||registered_mail)+" and start receiving real-time alerts on your stocks</h3>");aHtml.push("<div class='cant_see_note'>(If you can't see it, please check your junk mail folder)</div>");aHtml.push("</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.AlreadySubscriberMsg=function(slugs){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3 style='padding: 10px 0'>You have successfully added "+symbolLinks(slugs)+" to your real-time alerts.</h3>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.SetEventSource=function(newEventSource){eventSource=newEventSource;}
this.SetAutoPop=function(data){var defData={container:popupContainer?popupContainer.id:'',symbol:currentSymbol,scrollY:document.viewport.getScrollOffsets().top,source:eventSource}
var parent=popupContainer?popupContainer.parentNode:null;if(parent&&parent.style.position=='absolute')defData.parentPos={top:parent.style.top,left:parent.style.left};if(!data)data=defData;else for(var i in defData)if(data[i]==undefined)data[i]=defData[i];SA.Data.Cache.Set(KEY,Object.toJSON(data));}
this.GetAutoPop=function(clean){var json=SA.Data.Cache.Get(KEY);if(!json)return null;try{json=json.evalJSON();}catch(e){json=null;console.error("Error parsing AutoPop data");}
if(clean)self.CleanAutoPop();return json;}
this.CleanAutoPop=function(){SA.Data.Cache.Clean(KEY);}
this.CheckAutoPop=function(defContainer){var data=self.GetAutoPop(true);if(data){var autoPopSymbol=data.symbol,container=$(data.container||defContainer),scrollPosY=data.scrollY;eventSource=data.source||SA.Utils.unifiedPath();trackEvent('Auto Popup');if(hasPortfolios()){if(container){SA.Utils.Promotion.Quote.show(container,autoPopSymbol,eventSource);if(scrollPosY!=null)scrollTo(0,scrollPosY);else container.scrollIntoView();if(data.parentPos){var parent=container.parentNode;if(parent&&parent.style.position=='absolute')parent.setStyle(data.parentPos);}}}else{new SA.Models.PortfolioModel().createPortfolio("",autoPopSymbol,function(response){if(!events.createdPortfolio||events.createdPortfolio({stocks:response.stocks,stock_ids:response.stock_ids,reason:'no_portfolios',autoPop:true}))showPortfolioCreatedMsg({welcomeBack:true});setSubscribedCookie();},null,DEFAULT_ALERTS,eventSource);trackEvent('Create new: no portfolios');}}}
function logout(){var source=(eventSource&&!/^\//.test(eventSource))?'&source=pr_'+eventSource.replace(/(\w)\w*\s*/g,"$1").replace(/\W+/g,'_').replace(/^_/,''):'';Authentication.Authenticate("login","footer_login",{Login:"SA.Utils.Promotion.Quote.Login",Register:"SA.Utils.Promotion.Quote.Register",ForgotPassword:"FooterBar.ForgotPassword"},{Login:"subscribe to email alerts",Close:""},"","","promo=q@"+escape(currentSymbol)+source);trackEvent('Login popup');}}
scope.Promotion.Newsletter=new function(){var self=this;var KEY="proNL",eventSource="promotion_newsletter";var registered_mail;var curDashId,curDashTitle,lock;this.Register=function(email,tag_id,success,failure,opt){opt=opt||{}
if(!rxEmail.test(email))return failure({errors:'invalid_email'});var source=(eventSource&&!/^\//.test(eventSource))?'source=pr_'+eventSource.replace(/(\w)\w*\s*/g,"$1").replace(/\W+/g,'_').replace(/^_/,''):null;var params={'user[email]':email,newsletter:tag_id,id:'login',activity:'newsletter','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,''),nl_source:eventSource};if(source)params.force_params=source;return SA.Utils.ajax("/authentication/registration",params,function(response){if(!response.registration){trackEvent('Reg err: '+response.message);failure({errors:response.message});}else{registered_mail=email;trackEvent('Registered'+(opt.noAlerts?' (w/o alerts)':''));setSubscribedCookie();success(response);}},function(response){trackEvent('Reg err: '+response.errors);failure(response);});}
this.Login=function(email,password,success,failure){if(!rxEmail.test(email))return failure({errors:'invalid_email'});if(!password)return failure({errors:'empty_password'});return SA.Utils.ajax("/authentication/login",{'user[email]':email,'user[password]':password,id:'login',activity:'newsletter','function':''},function(response){if(!response.login){trackEvent('Log err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Log err: '+response.errors);failure(response);});}
this.ForgotPassword=function(email,success,failure){if(!rxEmail.test(email))return failure({errors:'invalid_email'});return SA.Utils.ajax("/authentication/forgot_password",{'user[email]':email,id:'login',activity:'newsletter','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,'')},function(response){if(!response.forgot_password){trackEvent('Forgot Password err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Forgot Password err: '+response.errors);failure(response);});}
this.ForgotPasswordMsg=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>We've sent instructions on how to reset your password to your email inbox.</h3>");aHtml.push("<div class='cant_see_note'>(If you can't find it, please check your spam filter.)</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.RegisterMsg=function(title,email){AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article thankyou">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="green_title">Thanks for subscribing for <strong>Seeking Alpha’s <span>'+(title||curDashTitle)+'</span> Newsletter</strong></div>');html.push('<p class="email_msg_popup">A confirmation email has been sent to <strong>'+(email||registered_mail)+'</strong>.</p>');html.push('<p class="last_p">Please confirm your registration by clicking the link in the email</p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.Subscribe=function(success,failure){return SA.Utils.ajax("/account/ajax_subscribe_newsletter",{tag_id:curDashId},function(response){setSubscribedCookie();if(response.msg=='already_signed_up'){trackEvent('Already Subscribed');if(!success||success(response)!=false)self.AlreadySubscribedMsg();}else{trackEvent('Subscribed');if(!success||success(response)!=false)self.SubscribedMsg();}},function(response){trackEvent('Reg err: '+response.errors);failure(response);});}
this.GetAutoPop=function(){return SA.Data.Cache.Get(KEY);}
this.AlreadySubscribedMsg=function(overrideTitle){AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article already_subscribed">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top" style="padding-bottom:20px">');html.push('<div class="green_title">Your are already subscribed to <strong>Seeking Alpha’s <span>'+(overrideTitle||curDashTitle)+'</span> Newsletter</strong></div>');html.push('<p class="email_msg_popup">Edit you email settings <a href="/email_preferences" style="color: #024999;">here</a>.</p>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.SubscribedMsg=function(overrideTitle){AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="green_title">Thanks for subscribing for <strong>Seeking Alpha’s <span>'+(overrideTitle||curDashTitle)+'</span> Newsletter</strong></div>');html.push('<p class="email_msg_popup">Emails will be sent to <strong>'+SA.Data.User.email()+'</strong>.</p>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('<div class="bottom_bg">');html.push('<p class="if_not_correct_email">If you would like to change your email address <a href="/account/account_preferences" sasource="newsl_subscr_thank">click here</a></p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.CheckAutoPop=function(success,failure){var json=SA.Data.Cache.Get(KEY);if(!json)return false;SA.Data.Cache.Clean(KEY);var data=json.evalJSON();if(data){var tag_id=data.tag_id
if(!tag_id)return false;trackEvent('Auto Popup');eventSource=data.source||SA.Utils.unifiedPath();self.setDashboard(tag_id,data.title);self.Subscribe(success,failure);return true;}
return false;}
this.SetAutoPop=function(data){data=data||{};data.source=data.source||eventSource;SA.Data.Cache.Set(KEY,Object.toJSON(data));}
var trackEvent=function(label,opt){opt=opt||{};SA.Stats.GA.event('RTA',opt.source||eventSource,label);}
this.trackEvent=trackEvent;var trackPV=function(opt){opt=opt||{};SA.Stats.GA.event('RTA',opt.source||eventSource,'page views',0,true);}
this.trackPV=trackPV;this.SetEventSource=function(newEventSource){eventSource=newEventSource;}
var setSubscribedCookie=function(){createCookie('hasnl','1',3500);}
this.isEverSubscribed=function(){return cookieExists('hasnl');}
this.setDashboard=function(dashId,dashTitle){curDashId=dashId;curDashTitle=dashTitle;}
this.show=function(container,dashboardId,dashboardTitle,initEventSource,opt){if(lock)return;opt=opt||{};var loader=opt.loader;eventSource=initEventSource||SA.Utils.unifiedPath();self.setDashboard(dashboardId,dashboardTitle);if(!SA.Data.User.loggedIn()){SA.Utils.Promotion.Shared.showRegisterPopup(container,null,dashboardId,dashboardTitle,eventSource);}else{lock=true;if(loader)loader.show();self.Subscribe(function(){lock=false;if(loader)loader.hide();},function(){lock=false;if(loader)loader.hide();});}}};scope.Promotion.Popup=new function(){var self=this;var emailInput,stocksInput,goBtn,error,loader,eventSource;var buildEventSource=function(unit){eventSource="sec popup";SA.Utils.Promotion.Quote.SetEventSource(eventSource);}
this.showOnSecondPage=function(){if(SA.Data.User.loggedIn())return;if(top.location.search=="?source=refreshed"||readCookie('_sasource')=='refreshed')return;if(top.location.href.match("source=themarkets"))return;if(/^(\/account\/|\/email_preferences)/.test(top.location.pathname))return;if(top.location.pathname=="/")return;if(navigator.userAgent.toLowerCase().indexOf('iphone')!=-1)return;var secPopCount=parseInt(SA.Data.Cache.Get('sec_pop'))||0;if(secPopCount<2){if(secPopCount==1){if(new ABTest("Sec popup",['old','rta']).value=='old'){open_header_log_in_popup_lightbox('login','');SA.Stats.GA.event('RTA','sec popup','page views (old popup)',0,true);}else{new Ajax.Request("/memcached2/email_subscr_count",{method:"GET",onSuccess:function(response){SA.Utils.Promotion.Popup.show(response.responseText);}});}}
SA.Data.Cache.Set('sec_pop',secPopCount+1);}}
this.show=function(numOfPeople){var html=[];html.push('<div class="rta_sec_popup">')
html.push('<div onclick="AlphaBox.Close()" class="close_pop"></div>')
html.push('<div class="title_wrap">')
html.push('  <h1>SEEKING ALPHA REAL-TIME EMAIL ALERTS</h1>')
html.push('  <h2>CRITICAL INFORMATION ON THE STOCKS YOU CARE ABOUT</h2>')
html.push('</div>')
html.push('<h3><span>'+numOfPeople+'</span> people already subscribed to seeking alpha alerts</h3>');html.push('<div class="bottom_wrap">');html.push('<input id="rta_popup_stocks" empty="Add stocks you care about (e.g. GOOG, AAPL)" title="Add stocks you care about">');html.push('<input id="rta_popup_email" style="margin-bottom:0;" empty="Fill in your email address" title="Fill in your email address">');html.push('<div id="rta_popup_error" style="display:none"></div>');html.push('<div id="rta_popup_go">Get Alerts</div>');html.push('<div id="rta_popup_loader" style="float:right;margin-top:20px;display:none"><img src="http://static.seekingalpha.com/images/loader.gif" alt="Loading..." /></div>');html.push('</div>');html.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(html.join(''));goBtn=new SA.Utils.Button({element:'rta_popup_go',onclick:self.go,loaderObj:'rta_popup_loader'});stocksInput=SA.Utils.Expansion.Input('rta_popup_stocks',{autocomplete:{stocks:true}});emailInput=SA.Utils.Expansion.Input('rta_popup_email',{onEnterKey:goBtn.click});error=$('rta_popup_error');loader=$('rta_popup_loader');buildEventSource();scope.Promotion.Quote.trackPV();}
var showErr=function(text,input){error.update(text).show();if(input)input.ErrorMode();}
var hideErr=function(){if(emailInput)emailInput.ClearErrorMode();if(stocksInput)stocksInput.ClearErrorMode();error.hide();}
this.go=function(){buildEventSource();hideErr();SA.Utils.Promotion.Quote.trackEvent('Clicked GO',{value:stocksInput.Empty()?0:(stocksInput.value.match(/[a-z.-]+/gi)||[]).length});if(stocksInput.Empty()){showErr('*Stock can\'t be blank',stocksInput)
SA.Utils.Promotion.Quote.trackEvent('Reg err: didn\'t fill stocks');return;}
var stocks=SA.Models.StockModel.stringToStocksArray(stocksInput.value);if(stocks[1].length>0||stocks[0].length==0){showErr("Symbol(s) not recognized: "+stocks[1].join(","))
stocksInput.value=stocks[0].join(",");SA.Utils.Promotion.Quote.trackEvent('Reg err: unrecognized stocks');return;}
if(stocks[0].length>SA.Models.PortfolioModel.maxStocks){showErr("*Please limit your portfolio to 50 symbols or less.",stocksInput)
SA.Utils.Promotion.Quote.trackEvent('Reg err: too many stocks');return;}
stocks=stocks[0].join(",");var email=emailInput.GetValue();var regSuccess=function(response){goBtn.UnLock();self.showThankYou(stocks,email);}
var regFailure=function(response){goBtn.UnLock();if(response.errors=='already_registered')self.showLogin(stocks,email);else{var er={'invalid_email':'Invalid Email'}[response.errors]||"Unknown error";showErr(er)
emailInput.ErrorMode();}}
if(emailInput.Empty()){showErr("*Fill your email to continue",emailInput);;SA.Utils.Promotion.Quote.trackEvent('Reg err: didn\'t fill email');return;}
goBtn.Lock();SA.Utils.Promotion.Quote.Register(email,stocks,regSuccess,regFailure);}
this.showLogin=function(stocks,email){var html=[];html.push('<div class="rta_pop_hp">');html.push('  <div class="rta_pop_hp_close" onclick="AlphaBox.Close()">X</div>');html.push('  <div class="rta_pop_hp_top">');html.push('    <div class="green_title">You\'re already registered with <span id="rta_popup_login_email_placeholder">&nbsp;</span> <div class="please_fill_password">Please fill in your password to continue.</div></div>');html.push('  </div>');html.push('  <div class="rta_pop_hp_bottom">');html.push('   <div class="input_wrapper">');html.push('     <input class="input_password" type="password" title="Password" empty="Password" id="rta_popup_password" />');html.push('     <div class="cleaner"></div>');html.push('     <div class="error" id="rta_popup_login_err"></div>');html.push('     <div class="forgot_password" id="rta_popup_login_fp">Forgot Password?</div>');html.push('   </div>');html.push('   <div class="cleaner"></div>');html.push('   <div class="save next" id="rta_popup_login_next">Next</div>');html.push('   <div style="float:left;margin:10px 0 0 10px;display:none" id="rta_popup_login_loader"><img src="http://static.seekingalpha.com/images/loader.gif" alt="Loading..." /></div>');html.push('   <div class="cleaner"></div>');html.push('  </div>');html.push('  <div class="cleaner"></div>');html.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(html.join('\n'));$('rta_popup_login_email_placeholder').update(email);var loginErr=$('rta_popup_login_err'),password=SA.Utils.Expansion.Input('rta_popup_password'),emailPlaceholder=$('rta_popup_login_email_placeholder'),loginContinue=new SA.Utils.Button({element:$('rta_popup_login_next'),onclick:function(){loginErr.style.display='none';loginContinue.Lock();SA.Utils.Promotion.Quote.Login(email,password.GetValue(),function(){loginContinue.UnLock();location.reload();},function(response){loginContinue.UnLock();var er={'invalid_email':'Invalid Email','empty_password':"Password shouldn't be empty",'login_failed':"Wrong password"}[response.errors]||"Unknown error";loginErr.innerHTML=er;loginErr.style.display='block';password.Reset();password.ErrorMode();},{addStocks:stocks,addRTA:true});},loaderObj:'rta_popup_login_loader'}),forgotPassword=new SA.Utils.Button({element:$('rta_popup_login_fp'),onclick:function(){loginErr.style.display='none';forgotPassword.Lock();SA.Utils.Promotion.Quote.ForgotPassword(email,function(response){forgotPassword.UnLock();if(AlphaBox.onBeforeClose)AlphaBox.onBeforeClose();SA.Utils.Promotion.Quote.ForgotPasswordMsg();},function(response){forgotPassword.UnLock();var er={'invalid_email':'Invalid Email'}[response.errors]||"Unknown error";loginErr.innerHTML=er;loginErr.style.display='block';});},loaderObj:'rta_popup_login_loader'});password.setOnEnterKey(loginContinue.click);loginErr.style.display='none';emailPlaceholder.innerHTML=email;setTimeout(function(){password.focus()},500);}
this.showThankYou=function(stocks,email){var html=[];html.push('<input type="hidden" id="rta_popup_stocks">');html.push('<div class="rta_pop_hp">');html.push('  <div class="rta_pop_hp_close" onclick="AlphaBox.Close()">X</div>');html.push('  <div class="rta_pop_hp_top">');html.push('    <div class="green_title">Thanks for registering for Seeking Alpha real-time email alerts</div>');html.push('    <p>A confirmation email has been sent to <strong id="rta_popup_email_placeholder">&nbsp</strong>.</p>');html.push('    <p class="last_p">Please confirm your registration by clicking the link in the email</p>');html.push('    <p class="if_not_correct_email" id="rta_popup_email_fix_lnk_container">If this isn\'t your correct email address please <span id="rta_popup_email_fix_lnk" class="link">click here</span></p>');html.push('    <div class="cleaner"></div>');html.push('  </div>');html.push('  <div class="rta_pop_hp_bottom" id="rta_popup_container_fix" style="display:none">');html.push('   <div class="input_wrapper">');html.push('     <input type="text" id="rta_popup_email" empty="Fill in your email address" />');html.push('     <div class="save" id="rta_popup_go">Save</div>');html.push('   <div style="float:left;margin:10px 0 0 10px;display:none" id="rta_popup_loader"><img src="http://static.seekingalpha.com/images/loader.gif" alt="Loading..." /></div>');html.push('     <div class="error" id="rta_popup_error"></div>');html.push('   </div>');html.push('   <div class="cleaner"></div>');html.push('  </div>');html.push('  <div class="cleaner"></div>');html.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(html.join('\n'));stocksInput=SA.Utils.Expansion.Input('rta_popup_stocks',{autocomplete:{stocks:true},onEnterKey:self.go});stocksInput.SetValue(stocks);emailInput=SA.Utils.Expansion.Input('rta_popup_email');$('rta_popup_email_placeholder').update(email);error=$('rta_popup_error');loader=$('rta_popup_loader');$('rta_popup_email_fix_lnk').observe('click',function(event){$('rta_popup_email_fix_lnk_container').hide();$('rta_popup_container_fix').show();goBtn=new SA.Utils.Button({element:'rta_popup_go',onclick:self.go});});}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Ads=new function(){var deltaInit=0;var self=this;this.List=[];function createIframeAdInEl(el,sizeXformat,src){if(/\/shark\//i.test(location)){return"";}
var sizeParts=sizeXformat.split("x")
var query=[];if(window.ms_slug)query.push("ms_slug="+window.ms_slug);if(window.article_dashboards)query.push("article_dashboards="+window.article_dashboards);if(window.article_sectors_themes)query.push("article_sectors_themes="+window.article_sectors_themes);var iframeFilePath="";if(location.host=="seekingalpha.com"){iframeFilePath="http://seekingalpha.com";}else if(location.host=="staging.seekingalpha.com"){iframeFilePath="http://staging.seekingalpha.com";}
var iframe=document.createElement("iframe");iframe.scrolling="no";iframe.height=sizeParts[1];iframe.width=sizeParts[0];iframe.marginWidth="0";iframe.marginHeight="0";iframe.frameBorder="0";iframe.vspace=0;iframe.hspace=0;iframe.style.border="0px none";iframe.src=iframeFilePath+'/adsframe.html#que='+encodeURIComponent(src)+(query.length?("&par="+encodeURIComponent(query.join("&"))):"");el.appendChild(iframe);}
this.add=function(info){self.List.push(info);}
this.run=function(){if(self.List.length>0)
SA.Utils.saScroll.add("ads_scroller",function(){SA.Utils.Ads.initAdsDelay()});}
this.run_mobile=function(){var size=self.List.length;for(var i=0;i<size;i++){var adInfo=self.List[i];if(typeof(adInfo)!='undefined'&&!adInfo.HadCreated){var el=adInfo.el;if(el){adInfo.HadCreated=true;createIframeAdInEl(el,adInfo.size,adInfo.info);}}}}
this.cleanAd=function(cb){var size=self.List.length;for(var i=0;i<size;i++){var adInfo=self.List[i];if(typeof(adInfo)!='undefined'&&adInfo.HadCreated&&!adInfo.OnceTime){var el=adInfo.el;if(el){el.innerHTML="";}}}
self.cleanList();if(cb)cb();}
this.cleanList=function(){self.List=[];}
this.setDelayInit=function(nDelay){deltaInit=nDelay;}
this.initAdsDelay=function(){var size=self.List.length;for(var i=0;i<size;i++){var adInfo=self.List[i];if(typeof(adInfo)!='undefined'&&!adInfo.HadCreated){var el=adInfo.el
if(el){if(ScrollerCloseToElement(el,adInfo.delta||deltaInit)){adInfo.HadCreated=true;createIframeAdInEl(el,adInfo.size,adInfo.info);if(!(/.*\/comments$/.test(location.pathname))){var ad=new stickyAd(el.id,{Height:250});ad.fixed_ads_init();}}}}}}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.joinWithAnd=function(ar,separator){if(!ar)return'';var len=ar.length;if(separator==undefined)separator=', ';if(len==0)return'';else if(len==1)return''+ar;else return ar.slice(0,len-1).join(separator||', ')+' and '+ar[len-1];};scope.unifiedPath=function(){var path=location.pathname;var m=path.match(/^\/(?:(author|user|symbol)\/(?:[^\/]+\/([^\/]+))?|(article|news-article|instablog))/);if(m){if(m[1]){if(m[2])path='/'+m[1]+'/*/'+m[2];else path='/'+m[1];}else if(m[3]){path='/'+m[3];}}
return path;};scope.stripper=function(text){var start=[['<br type="_moz" />',''],[(/&nbsp;/g),' '],[(/&(ndash|#150|#x2013|#8211|mdash|#151|#x2014|#8212);/g),'-'],[(/[“”]|&(ldquo|#147|#8220|rdquo|#148|#8221);/g),'"'],[(/[‘’]|&(lsquo|#145|#8216|rsquo|#146|#8217);/g),"'"],[(/<\/?span[^>]*>/gi),''],[(/<\/?div[^>]*>/gi),'<br/>']],repeat=[[(/(<(?!br|img)\w+[^>]*>)((?:\s|<br[^>]*>)+)|((?:\s|<br[^>]*>)+)(<\/\w+[^>]*>)/gi),'$2$1$4$3'],[(/<(?!t[dh])(\w+)\b[^>]*>\s*<\/\1\b[^>]*>/gi),'']],finish=[[(/\s*(?:<br[^>]*>\s*)*(<\/?(?:p|t[dh]|li|hr|blockquote)[^>]*>|^|$)\s*(?:<br[^>]*>\s*)*/gi),'$1'],[(/<sup[^>]*>([^<]*[^<0-9][^<]*)<\/sup[^>]*>/gi),'$1'],[(/(?:<br[^>]*>\s*){2,}/gi),'<p>'],[(/(\s)\s+/g),'$1']];var prevText='',i;for(i=0;i<start.length;i++)text=text.replace(start[i][0],start[i][1]);while(prevText!=text){prevText=text;for(i=0;i<repeat.length;i++)text=text.replace(repeat[i][0],repeat[i][1]);}
for(i=0;i<finish.length;i++)text=text.replace(finish[i][0],finish[i][1]);return text;}
scope.ajax=function(url,parameters,onSuccess,onFailure,opt){opt=opt||{};var loader=opt.loader?$(opt.loader):null;opt.parameters=parameters;opt.onSuccess=function(transport){if(loader)loader.style.display='none';var response={errors:'unknown'};try{response=transport.responseText.evalJSON();}catch(e){}
if(response.errors){if(onFailure)onFailure(response);}else{if(onSuccess)onSuccess(response);}};opt.onFailure=function(){if(loader)loader.style.display='none';if(onFailure)onFailure({errors:'unknown'});};if(loader)loader.style.display='block';return new Ajax.Request(url,opt);}
scope.timeStampHandler=new function(){this.addTimeStampMaxLastHour=function(upperHtml,lowerHtml){upperHtml=upperHtml?upperHtml:"";lowerHtml=lowerHtml?lowerHtml:"";var tStamps=$$("[timestamp]");var size=tStamps.length;for(var i=0;i<size;i++){var time=nice_time_ago(parseInt(tStamps[i].getAttribute("timestamp")));if(/Seconds|minute/.test(time))
tStamps[i].innerHTML=upperHtml+time+lowerHtml;}}
this.addTimeStampIntoMin=function(upperHtml,lowerHtml,onComplete){onComplete=onComplete||function(){};upperHtml=upperHtml?upperHtml:"";lowerHtml=lowerHtml?lowerHtml:"";var tStamps=$$("[timestamp]");var size=tStamps.length;for(var i=0;i<size;i++){var time=onlyMin(parseInt(tStamps[i].getAttribute("timestamp")));tStamps[i].innerHTML=upperHtml+time+lowerHtml;}
onComplete();}
function onlyMin(time){var distance_in_minutes=parseInt(((new Date()).getTime()/1000-time)/60);var msg;if(distance_in_minutes==0)
msg="Seconds ago";else if(distance_in_minutes<59)msg=distance_in_minutes+" minute"+(distance_in_minutes>1?"s":"");else{var hrs=Math.floor(distance_in_minutes/60);var mins=distance_in_minutes%60;msg=hrs+" hour"+(hrs>1?"s":"")+(mins>0?" "+mins+" minute"+(mins>1?"s":""):"");}
return msg;}}
scope.CopyFromInputToElement=function(fromInputElement,toElement,theString){if(fromInputElement&&toElement&&!theString){if(fromInputElement.capitalize)toElement.innerHTML=SA.Utils.String.Capitalize(fromInputElement.value);else toElement.innerHTML=fromInputElement.value;}
else toElement.innerHTML=theString;}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.IdleNotifier=function(){var timeoutElement=null;var idleTime=300*1000;var timerTime=new Date();var isActive=true;var isRunning=false;var activeCallback=null;var idleCallback=null;this.start=function(milisec,onActiveCallback,OnIdleCallback){if(isRunning)return;isRunning=true;activeCallback=onActiveCallback||new Function();idleCallback=OnIdleCallback||new Function();idleTime=milisec;for(var i=0,len=this.Events.length;i<len;i++)
Event.observe(window,this.Events[i],this.onInterrupt.bind(this));setTimer(this);}
this.isActive=function(){return isActive;}
this.getIdleTime=function(){return Math.round((new Date()-timerTime)/1000);}
this.onInterrupt=function(){if(!isActive){isActive=true;activeCallback(this.getIdleTime())}
setTimer(this);}
this.onIdle=function(){if(isActive){isActive=false;idleCallback()}}
function setTimer(instance){clearTimeout(timeoutElement);timerTime=new Date();timeoutElement=setTimeout(instance.onIdle.bind(instance),idleTime);}}
scope.IdleNotifier.prototype.Events=['mousemove','click','mouseup','mousedown','keydown','keypress','keyup','submit','change','mouseenter','scroll','resize','dblclick'];})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.PageRefresher=function(url,internal){var source='refreshed';var timeout=null;var idleNotifier=new SA.Utils.IdleNotifier();var isActive=true;var self=this;if(url.match(/[\?&]source=refreshed/)){source='refreshed';url=url.replace(/[\?&]source=refreshed/,'');}
this.start=function(){onIdleExec=doRefresh;idleNotifier.start(Math.max(2000,internal-2000),this.onActive,this.onIdle);setTimeout(onIdleExec,internal);}
this.Clear=function(){isActive=false;}
this.isActive=function(){return isActive;}
this.setExecFunction=function(func){onIdleExec=(typeof(func)=='function')?func:doRefresh;}
this.isIdle=function(){return!idleNotifier.isActive();}
this.onIdle=function(){}
this.onActive=function(){}
this.Activate=function(){isActive=true;}
function doRefresh(){if(!isActive){setTimeout(onIdleExec,internal);return;}
if(self.isIdle())
SA.Data.Cookies.set('_sasource',source,0.0007);SA.Utils.Connection.Test(function(){top.location.href=url;}.bind(self));}
setTimeout(this.start.bind(this),100);}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Time=new function(){this.uniqTTL=function(ttl){var now=new Date();var utc=Date.UTC(now.getFullYear(),now.getMonth(),now.getDay(),now.getMinutes(),now.getMinutes(),now.getSeconds());return Math.floor(utc/ttl);}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.String=new function(){this.LongStringByWideBreak=function(elementID,elementClass,elementFatherclass){var element=$(elementID);var elementWidth=element.offsetWidth;var tempDiv=document.createElement("div");tempDiv.innerHTML=element.innerHTML;var divWrapper;divWrapper=$$("."+elementFatherclass);tempDiv.style.display="inline";tempDiv.className=elementClass;divWrapper[0].appendChild(tempDiv);tempDiv.style.visibility="hidden";var string_long_name=new Array();for(i=0;i<tempDiv.innerHTML.length;i++){string_long_name[i]=tempDiv.innerHTML.charAt(i);}
if(tempDiv.offsetWidth>=elementWidth){tempDiv.innerHTML="";var temp;temp=tempDiv.innerHTML;for(i=0,len=string_long_name.length;i<len;i++){temp=temp+string_long_name[i];if(tempDiv.getWidth()>105){temp=temp.substring(0,temp.length-2)+" "+temp.substring(temp.length-2,temp.length)}
tempDiv.innerHTML=temp;}
$(elementID).innerHTML=tempDiv.innerHTML;}}
this.Capitalize=function(string){string=string.replace(/(^|\s|\(| \b|\")([a-z])/g,function(m,p1,p2){return p1+p2.toUpperCase();});var specialWords=['iPhone','iPad','iOS','eBay','mREIT','hhgreg'];var size=specialWords.length
for(var i=0;i<size;i++){var reg=new RegExp("\\W"+specialWords[i],'ig');var match=string.match(reg);if(match){var reg=new RegExp(specialWords[i],'ig');mSplit=match[0].split(reg);string=string.replace(match[0],mSplit[0]+specialWords[i]);}}
return string;}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.popUp=new function(){var popUpWrapper=$("pop_up_wrapper");var popUpTransparicy=$("pop_up_transparicy");this.closePopUpWithOpacity=function(){popUpWrapper.style.display="none";popUpWrapper.innerHTML='';popUpTransparicy.style.display="none";}
this.popUpWithOpacity=function(){if(popUpWrapper==null&&popUpTransparicy==null){popUpTransparicy=document.createElement("div");popUpTransparicy.id=("pop_up_transparicy");document.body.appendChild(popUpTransparicy);popUpWrapper=document.createElement("div");popUpWrapper.id=("pop_up_wrapper");document.body.appendChild(popUpWrapper);popUpWrapper.style.display="none";}
if(popUpWrapper.style.display=="none"){popUpWrapper.style.display="";popUpTransparicy.style.display="";popUpTransparicy.onclick=function(){SA.Utils.popUp.closePopUpWithOpacity();};}else{SA.Utils.popUp.closePopUpWithOpacity();}
return false;}
this.CreatepopUpWithOpacityInner=function(){SA.Utils.popUp.popUpWithOpacity();popUpWrapper.innerHTML='<div id="displaybox_inner"><h1>You have successfully subscribed to real-time alerts!</h1><div>GOOG has been added to your portfolio. If you want to add/edit stocks <a href="/account/portfolio">visit your portfolio page</a></div><div style="padding-top:10px"><div class="emails_be_sent">Emails will be sent to <strong>naomi@seekingalpha.com</strong> <span style="color:#024999">[<a href="/account/account_preferences">change email</a>]</span></div></div></div><div onclick="AlphaBox.Close();" class="close_pop_bordeaux"></div>';}}})();var rxEmail=/^\w[\w#$\%^&*'\/=?_`{|}~+-]*(\.[\w#$\%^&*'\/=?_`{|}~+-]+)*@(\w[\w-]*\.)+[a-z]{2,4}$/i;var rxWebsite=/^(https?:\/\/)?[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?$/i;var rxFeed=/^((https?|feed):\/\/)?[a-z0-9]+([-.]{1}[a-z0-9]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?$/i;var refresh_time_in_milliseconds=60000;String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"");};String.prototype.indexOfIgnoreCase=function(str){return this.toLowerCase().indexOf(str.toLowerCase());}
String.prototype.toRx=function(str){return this.replace(/(\(|\)|\{|\}|\[|\]|\:|\^|\$|\!|\=|\+|\*|\/|\,|\-|\||\?|\.)/g,"\\$1");}
String.prototype.rjust=function(n,c){var result=this;while(result.length<n){result=c+result;};return result;}
var refreshed_ads_slots=['HP_170x40_1','HP_170x40_2','HP_170x40_3','HomePage_728x90_leaderboard','HomePage_160x600','HomePage_300x250_top','QuotePage_300x250_top','QuotePage_728x90_leaderboard','ETFs_Quotepage_728x90_leaderboard','ETFs_QuotePage_728x90_leaderboard','ETFs_QuotePage_300x250_top','Common_300x250_top','Common_160x600','Common_728x90_leaderboard','Shp_ETFs_728x90_leaderboard','MacroViewDashboard_728x90_leaderboard','StocksSectorsDashboard_728x90_leaderboard','GlobalMarketsDashboard_728x90_leaderboard','ETFsDashboard_728x90_leaderboard','InvestingIdeasDashboard_728x90_leaderboard'];var bInProcees=false;var gTimeout;var oRefresher=null;var jspellRealtime=false;var jspellAutoAttach=false;var jspellShowOptionsMenu=false;var jspellIgnoreUpper=false;var user_following_users_from_cookie=readCookie('user_following_users');var user_watchlist_slugs_from_cookie=readCookie('user_watchlist_slugs');var wl_icon_html="<img src='http://static.seekingalpha.com/images/WL-Icon.gif?2' onmouseover='wl_icon_mouseover(this)' onmouseout='wl_icon_mouseout(this)' onclick='wl_icon_onclick(this)' class='wl_icon' title='This article is in your Watchlist'/>"
var isRefresh=(/source\=refreshed/i.test(top.location.href)||/_sasource=refreshed/i.test(document.cookie));var comment_edit_time=20;var NotificationCookiesExpiration=0.003;function getUserUri(){var userUri=null;if(is_users_cookie_exists()){var user_id=readCookie('user_id');var user_nick=readCookie('user_nick');if(user_nick==null||user_nick=="")user_nick="User "+user_id;if(readCookie('author_slug')==null||readCookie('author_slug')==''){userUri="/user/"+user_id;}else{userUri="/author/"+readCookie('author_slug');}}
return userUri;}
function isAuthor(){if(is_users_cookie_exists()&&!(readCookie('author_slug')==null||readCookie('author_slug')==''))return true;return false;}
function setHrefLink(aElement,dest){var userUri=getUserUri();aElement.href=userUri+"/"+dest;}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}else
var expires="";document.cookie=name+"="+value+expires+"; path=/";}
function createCookieTillSpecificUTC(name,value,utc){var date=new Date();date.setTime(utc);var expires="; expires="+date.toGMTString();document.cookie=name+"="+value+expires+"; path=/";}
function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return unescape(c.substring(nameEQ.length,c.length)).gsub(/\+/,' ');}
if(typeof(user_cookie)!="undefined"&&user_cookie[name])return''+user_cookie[name];return null;}
function eraseCookie(name){createCookie(name,"",-1);}
function cookieExists(cookie_name){return(readCookie(cookie_name)!=null&&readCookie(cookie_name)!='');}
function flush_cookies_by_prefix(prefix){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(prefix)==0){eraseCookie(c.substring(0,c.indexOf('=')));}}}
function flush_all_notice_cookies(){flush_cookies_by_prefix("notice_");return null;}
function flush_all_user_cookies(){flush_cookies_by_prefix("notice_");flush_cookies_by_prefix("user_");eraseCookie("watchlist_refresh_choose_password_after_authentication");eraseCookie('comments_rating');eraseCookie('author_slug');eraseCookie('last_comment');eraseCookie('last_comment_date');eraseCookie('mybbuser');eraseCookie('adminsid');return null;}
function logout(){logout_completly();}
function logout_completly(){flush_all_user_cookies();if(/\/account\//.test(top.location.href)){top.location.href='/';}else{top.location.reload();}}
AlphaCookie={days:60*60*24,_dataIndex:function(collection,varname){if(!collection)return-1;for(var i=0;i<collection.length;i++){var coll=collection[i].split("|");if(coll[0]==varname)return i;}
return-1;},_getDATA:function(dataString,varname){var collection=dataString.split("~");if((idx=this._dataIndex(collection,varname))!=-1){return collection[idx].split("|")[1];}
return null;},_setDATA:function(dataString,varname,value,expire){var collection=dataString?dataString.split("~"):[];if((idx=this._dataIndex(collection,varname))!=-1){collection[idx]=expire?[varname,value,expire].join("|"):[varname,value].join("|");return collection.join("~");}else{collection.push(expire?[varname,value,expire].join("|"):[varname,value].join("|"));return collection.join("~");}},_eraseDATA:function(dataString,varname){var collection=dataString.split("~");if((idx=this._dataIndex(collection,varname))!=-1){collection.splice(idx,1);return collection.join("~");}
return dataString;},_cleanExpired:function(dataString){var ac=dataString;if(!ac)return"";ac=ac.split("~");var clean=[];ac.each(function(coll){var tmpcoll=coll.split("|");if(!tmpcoll[2]||parseInt(tmpcoll[2])>(parseInt((new Date().getTime())/1000))){clean.push(coll);}});if(clean.length!=ac.length)createCookie("sac",clean.join("~"),3000);return clean.join("~");},set:function(name,value,expire){var ac=readCookie("sac");if(expire)expire=parseInt(new Date().getTime()/1000)+(expire*this.days);if(!ac)ac="";ac=this._cleanExpired(ac);createCookie("sac",this._setDATA(ac,name,value,expire),3000);},get:function(name){var ac=readCookie("sac");ac=this._cleanExpired(ac);if(!ac)return null;return this._getDATA(ac,name)},erase:function(name){var ac=readCookie("sac");if(!ac)return false;ac=this._cleanExpired(ac);var tmp=this._eraseDATA(ac,name);if(tmp)
createCookie("sac",tmp,3000);else
eraseCookie("sac");}}
function setSelRange(inputEl,selStart,selEnd){if(inputEl.setSelectionRange){inputEl.focus();inputEl.setSelectionRange(selStart,selEnd);}else if(inputEl.createTextRange){var range=inputEl.createTextRange();range.collapse(true);range.moveEnd('character',selEnd);range.moveStart('character',selStart);range.select();}}
function scroll_top(){window.scrollTo(0,0);document.body.scrollTop=0;}
function article_page_kind(){if(typeof(article_dashboards)=="undefined")return"";if(article_dashboards)
return((article_dashboards=='transcript')?"transcript":"article");else return"";}
function getDomain(){/https?:\/\/(.+?)(?:\/|\?|$)/.test(location.href);return RegExp.$1;}
function do_nothing_at_all(){void(0);}
function getURLParam(strParamName){var strReturn="";var strHref=window.location.href;if(strHref.indexOf("?")>-1){var strQueryString=strHref.substr(strHref.indexOf("?")+1);var aQueryString=strQueryString.split(/&|#/);for(var iParam=0;iParam<aQueryString.length;iParam++){if(new RegExp("^"+strParamName+"=").test(aQueryString[iParam])){var aParam=aQueryString[iParam].split("=");strReturn=aParam[1];break;}}}
return unescape(strReturn);}
function setURLParam(key,value){key=escape(key);value=escape(value);var s=document.location.search;var kvp=key+"="+value;var r=new RegExp("(&|\\?)"+key+"=[^\&]*");s=s.replace(r,"$1"+kvp);if(!RegExp.$1){s+=(s.length>0?'&':'?')+kvp;};document.location.search=s;}
function open_close_described_nav(obj_id){if($(obj_id).className=='described_nav'){$(obj_id).className+='_open';}else if($(obj_id).open!='true'){$(obj_id).className=$(obj_id).className.replace('_open','');}}
function dont_close_vocation_group(group_id){for(var i=1;i<10;++i){if($('group_'+i).open=="true"){$('group_'+i).open="false";$('group_'+i).className=$('group_'+i).className.replace('_open','');}}
$('group_'+group_id).open="true";}
function auto_open_vocation_group(group_id){var group=$('group_'+group_id)
if(group){group.open="true";group.className+='_open';}}
function user_picture(id,picture_size){string_id=id.rjust(9,"0");return"http://staticorigin.seekingalpha.com/images/users_profile/"+string_id.substr(0,3)+"/"+string_id.substr(3,3)+"/"+string_id.substr(6,3)+"/"+picture_size+"_pic.png?rand="+Math.random()*10000;}
function sendMessageWithLocation(id_coding){var location=top.location.href;var source;if(location.indexOf('/followers')>-1){source='Mouseover Popup Follower';}else if(location.indexOf('/following')>-1){source='Mouseover Popup Following';}else if(location.indexOf('/comments')>-1){source='Mouseover Popup All Comments';}else if(location.indexOf('/article/')>-1){source='Mouseover Popup Article';}else{source='Mouseover Popup Leaderboard';}
Messaging.sendMessage(id_coding,source);}
function change_wrapper_to_promote_image(path,promote_page){var img_width=(promote_page=='book'?100:145)
$('img_wrapper').innerHTML="";image=document.createElement('img');image.style.cssText="visibility:hidden;";image.setAttribute('image_width',img_width);image.onload=function(){if(this.width>img_width){this.style.cssText='display:block;width:'+this.getAttribute('image_width')+'px;visibility:visible;'}else{this.style.cssText='visibility:visible;'}}
image.src=path;$('img_wrapper').appendChild(image);$('has_logo_remove_button').style.display='block';$('need_to_remove_image').value='no'
if($('upload_msg'))$('upload_msg').style.display='none';if($('save_button')){$('save_button').disabled=false;$('save_button').className='submit';}}
function delete_promote_image(oBtn,UserId,PageName){$('need_to_remove_image').value='yes';$('has_logo_remove_button').style.display='none';oDiv=document.createElement('div');oDiv.className="no_img";oDiv.innerHTML="You haven't uploaded a book image yet"
$('img_wrapper').innerHTML="";$('img_wrapper').appendChild(oDiv);}
function note_promote_afer_published(deleted,type){if(deleted)$('promote_saved_message').innerHTML="Your "+type+" promotion details have been removed successfully. What would you like to do now:";else $('promote_saved_message').innerHTML="Your "+type+" promotion settings were saved. What would you like to do now:";$('promote_confirmation').style.display='block';$("promote_section_name").innerHTML="";if($("description_intersts_trading"))$("description_intersts_trading").innerHTML="";scroll_top();}
function notice_to_element(address,howto){if(readCookie('notice_'+address)!=null){switch(howto){case'update':$('notice_'+address).update(readCookie('notice_'+address));break;case'innerhtml':$('notice_'+address).innerHTML=readCookie('notice_'+address);break;case'value':$('notice_'+address).value=readCookie('notice_'+address);break;default:$('notice_'+address).update(readCookie('notice_'+address));}
eraseCookie('notice_'+address);}}
function handleInput(obj,action){switch(action){case'focus':if(obj.title==obj.value)obj.value="";break;case'blur':if(obj.value=="")obj.value=obj.title;break;}}
function link_over(e,clr){$(e).setStyle({cursor:'pointer',textDecoration:'underline',color:clr||'red'});}
function link_out(e,clr){$(e).setStyle({textDecoration:'none',color:clr||'blue'});}
function is_users_cookie_exists(){return(readCookie('user_id')!=null&&readCookie('user_id')!='');}
function set_login_and_registration_header(){if(is_users_cookie_exists()){$('header').className='';}}
function ajax_delete_notification(tracking_id,current_comments_count){var new_comments_count=(typeof(current_comments_count)!="undefined")?"&current_comments_count="+current_comments_count:"";new Ajax.Request('/user_comments_tracking/ajax_delete_notification',{asynchronous:true,evalScripts:true,parameters:"tracking_id="+tracking_id+new_comments_count});$('post_'+tracking_id).remove();}
function ajax_create_user_notification_cookie_and_update_tool_bar(user_id){new Ajax.Request('/user_comments_tracking/ajax_create_notification_cookies',{asynchronous:true,evalScripts:true,method:"get",parameters:"user_id="+user_id,onComplete:function(transport){if(transport.status==200&&transport.responseText!='failed')
parse_cookies_result_and_update_toolbar_html(transport.responseText);}});}
function parse_cookies_result_and_update_toolbar_html(cookies_vals_str){var notifications_arr=cookies_vals_str.split("@");var c_count=notifications_arr[0];var e_count=notifications_arr[1];var new_count=notifications_arr[2];if(isNaN(parseInt(c_count)))c_count=false;if(isNaN(parseInt(e_count)))e_count=false;if(isNaN(parseInt(new_count)))new_count=false;if(c_count&&e_count&&new_count){$('inbox_number').innerHTML=(e_count*1>0?'&nbsp;('+e_count+')':'');if($("unread_count"))$("unread_count").innerHTML=(e_count*1>0?'&nbsp;('+e_count+')':"");if(new_count!='0'){$('notifications_alert').innerHTML="";$('notifications_alert').insert(new_count);$('notifications_alert').style.display='block';}else{$('notifications_alert').style.display='none';}
createCookie('user_notifications',c_count+"|"+e_count+"|"+new_count);createCookie('user_update_note_cookies','true',NotificationCookiesExpiration);}}
function ajax_pop_notifications(user_id){if($('notify_popup_button').getAttribute('open')=="true")minimize_pop_notifications(user_id);else{new Ajax.Request('/user_comments_tracking/ajax_toolbar_show',{asynchronous:true,evalScripts:true,parameters:"user_id="+user_id,onComplete:function(transport){if(transport.status==200&&transport.responseText!='failed'){$('notifications_list').innerHTML="";$('notifications_list').insert(transport.responseText);$('notifications_alert').style.display='none';$('notify_popup_button').setAttribute('open','true');$('notificiations_popup').style.display='block';var n_cookie_str=readCookie('user_notifications');if(n_cookie_str=='undefined'||n_cookie_str==null)n_cookie_str='';var n_cookie_arr=n_cookie_str.split("|");var new_cookie_str=(n_cookie_arr.length==3)?(n_cookie_arr[0]+"|"+n_cookie_arr[1]+"|0"):"";createCookie('user_notifications',new_cookie_str);}}});}}
function minimize_pop_notifications(user_id){if($('notificiations_popup')){$('notifications_alert').style.display='none';$('notificiations_popup').style.display='none';$('notify_popup_button').setAttribute('open','false');$('notify_popup_button').disabled=false;}}
Event.observe(document,'keydown',function(e){if(e.keyCode==27){var user_id=readCookie('user_id');if(!isNaN(user_id))minimize_pop_notifications(user_id);}});function makeMaxLength(field,maxlength,Alert){if(field.value.length>maxlength){field.value=field.value.slice(0,maxlength);if(Alert)alert(Alert);}}
function submit_account_preferences(obj){if($('current_email_fieldset2').style.display=='block'){if(!validate_email('new_email','notice_account_preferences')==true)return false;}
if($('new_password_information').style.display=='block'){if(!validate_password('old_password','notice_account_preferences','Please enter your current password for verification.',1,80)==true)return false;if(!validate_password('new_password','notice_account_preferences','Please enter a password with 4 to 40 characters.',4,40)==true)return false;}
$('account_preferences').submit();}
function nick_was_taken_alert(){if(confirm('The username you chose had already been taken.\nDo you want to go to your account preferences to choose a different username?')){location.href='/account/edit_bio'}else{return false;}}
function nick_was_taken_alert_by_querystring(){if(getURLParam('nick_was_taken')=='true'){nick_was_taken_alert();}}
function link_edit_user_profile(){var user_id=readCookie('user_id');if(user_id!=null&&user_id!=''){var profiles=document.getElementsByClassName('edit_user_profile_'+user_id);if(profiles){profiles.each(function(item){item.innerHTML="<a href=\"/account/edit_bio\">Edit your profile</a>";item.style.display="";});}}}
function application_init(){nick_was_taken_alert_by_querystring();flush_all_notice_cookies();}
function page_load(){SeekingAlpha.Initializer.RunAfterLoad.call(SeekingAlpha.Initializer);}
function change_location(href){location.href=href;}
var too_much_share=0;function change_location_after_share(href){if(socialSA&&socialSA.now_posting>0&&too_much_share<20){setTimeout(function(){change_location_after_share(href)},500);too_much_share++;}else{location.href=href;}}
function submit_form_if_has_proper_value(oForm,field){if(field.value==""||field.value==field.title)return false;oForm.submit();}
function validate_and_refresh_cookie(){new Ajax.Request('/account/validate_and_refresh_cookie/',{method:'get'});}
function change_user(){$('user_email').style.width='285px';$('user_email').style.color='black';$('user_email').style.borderWidth='1px';$('user_email').style.borderStyle='solid';$('user_email').style.borderColor='#999999 #d3d3d3 #d3d3d3 #999999';$('user_email').style.marginLeft='12px';$('change_user_email').style.display='none';$('current_email_fieldset2').style.display='block';$('email_change_warning').style.display='block';}
function account_preferences_change_password(){$('old_password_stars').style.display='none';$('new_password_information').style.display='block';}
function validate_interests_section_in_promote_page(){var oObj,iInp,bCol1,bCol2,bCol3;for(iInp=0;oObj=document.forms["promote_form"]["vocation"][iInp];iInp++){if(oObj.checked)bCol1=true;}
for(iInp=0;oObj=document.forms["promote_form"]["user_interests[]"][iInp];iInp++){if(oObj.checked)bCol2=true;}
for(iInp=0;oObj=document.forms["promote_form"]["user_trading_frequence_tag_id"][iInp];iInp++){if(oObj.checked)bCol3=true;}
if(bCol1&&bCol2&&bCol3)
return"";else
return"Please complete this section";}
function ajax_submit_form(obj,location){submit_button=obj.getElementsByClassName('submit')[0];loader_button=obj.getElementsByClassName('loader')[0];new Ajax.Request(location,{asynchronous:true,evalScripts:true,parameters:Form.serialize(obj),onLoading:function(transport){if(submit_button){submit_button.disabled=true};if(loader_button){loader_button.style.display='inline'};},onComplete:function(transport){if(loader_button){loader_button.style.display='none'};if(submit_button){submit_button.disabled=false};}});return false;}
function check_length(str,min,max){return((str.length>=min)&&(str.length<=max));}
function validate_field_confirmation(field_name,snd_field_name,notice_name,msg){field=$(field_name);snd_field=$(snd_field_name);notice=$(notice_name);if(field.value!=snd_field.value){notice.innerHTML=msg;snd_field.focus();return false;}else{return true;}}
function validate_email_confirmation(field_name,snd_field_name,notice_name){return validate_field_confirmation(field_name,snd_field_name,notice_name,"Email does not match confirmation.")}
function validate_email(field_name,notice_name,notice_message){field=$(field_name);notice=$(notice_name);if((field.value.gsub(' ','')=='')||!rxEmail.test(field.value)){notice.innerHTML=notice_message||'<span class="\inner_notice\">Please enter a valid email address.</span>';field.focus();return false;}else{return true;}}
function validate_password(field_name,notice_name,notice_message,min,max){var field=$(field_name);var notice=$(notice_name);if(!check_length(field.value.gsub(' ',''),min,max)||field.value==field.title){notice.innerHTML=notice_message;field.focus();return false;}else{return true;}}
function validate_nick(field_name,notice_name,notice_message){var obj=$(field_name);if(obj.value.trim()==''||obj.value==obj.title){$(notice_name).innerHTML=notice_message;$(field_name).focus();return false;}
return true;}
function submit_orthodox_registration_form(obj){if($("I_agree_to_Terms").checked==false){$('notice_registration').innerHTML="Terms must be agreed in order to confirm registration";$('I_agree_to_Terms').focus();return false;}
if(!validate_email('register_user_email','notice_registration')==true)return false;if(!validate_password('register_user_password','notice_registration','Please enter a password with 4 to 40 characters.',4,40)==true)return false;if(!validate_password('register_user_nick','notice_registration','Please enter a longer username',2,80)==true)return false;if(obj)obj.disabled=true;$('orthodox_registration').submit();}
function submit_orthodox_login_form(){if(!validate_email('login_user_email','notice_login')==true)return false;if(!validate_password('login_user_password','notice_login','Please enter your password.',1,80)==true)return false;$('orthodox_login').submit();}
function submit_orthodox_forgot_password(){if(!validate_email('user_email','notice_forgot_password')==true)return false;$('submit_btn_id').disabled=true;$('orthodox_forgot_password').submit();}
function addSeekingAlphaToolBar(){try{window.external.AddSearchProvider("http://"+document.domain+"/javascripts/seeking.xml?e=1");}catch(eX){if(70==(eX.number&0xFFFF)){alert("For security reasons, you must use the mouse\n(or the Enter key) to click the Install button.");}else{alert("Unable to add search provider. The Create Your\nOwn tool requires Internet Explorer.   ["+(eX.number&0xFFFF)+"]");}}}
function KEY_FORM_PRESS(event,f){var key=event.which||event.keyCode;if(key==13)f();}
function kknd_user(user_id){if(confirm("Are you sure you want to delete this user and all the associated content? This CANNOT BE UNDONE.")){new Ajax.Request('/moderator/ajax_kknd_user',{asynchronous:true,evalScripts:true,parameters:"user_id="+user_id,onComplete:function(transport){if(transport.status==200&&transport.responseText!="failed"){alert('Data for this user were fully removed.')}}});}}
function InitSASource(){window._pageviewURL=location.pathname+location.search;var sasource=readCookie('_sasource');if(sasource){if(!/[?&]source=/i.test(location.search)){window._pageviewURL+=(location.search?'&':'?')+'source='+escape(sasource);window._saSource=sasource;}
eraseCookie('_sasource');}
if(!window._saSource)window._saSource=location.search.toQueryParams().source;if(!window._saSource){var r=/^#source=([^&]+)&?|&source=([^&]+)/,m=location.hash.match(r);if(m){window._saSource=m[1]||m[2];location.hash=location.hash.replace(r,'');}}
Event.observe(document,'click',function(e){var sasource=e.findElement().getAttribute('sasource');if(sasource)createCookie('_sasource',sasource,0.0007);});}
function remove_unneeded_article_from_article_more_box(id){if(obj=($('recent_article_'+id)||$$('li.last_recent_article')[0])){obj.style.display='none';}}
function FindSymbol(oForm,bFromBtn){var oAC=AutoCompleteSAConfig.Packages.transcript_symbol;if(bFromBtn&&oAC.State=='open')oAC.AutoInsert();if(oForm.symbol.value.trim()==""||oForm.symbol.value==oForm.symbol.title){alert("Please enter a symbol");return false;}
if(symbols.indexOf("<"+oForm.symbol.value.toUpperCase()+">")==-1){alert("This symbol does not exist");return false;}
urchinTracker('event/transcripts_center/search_box/symbol_transcript');location.href="/symbol/"+oForm.symbol.value.toLowerCase()+"/transcripts";return false;}
function symbolToName(symbol){var res="",symbol=symbol.toUpperCase();var search_this=new RegExp("<"+symbol+">(.*?)<");if(search_this.test(symbols))
res=RegExp.$1
return res;}
function cleanSymbolString(symbol_string){var symbol_string=symbol_string.split(",");var result=[];symbol_string.each(function(sym){if(symbolToName(sym.trim().toUpperCase()))result.push(sym.trim().toLowerCase());});if(result)result=result.join(",");return result||""}
function symbolLinkAddAltAndTitle(target){if(target.getAttribute("alt")&&target.getAttribute("title"))return;var symbol_name=symbolToName(target.innerHTML.trim()).unescapeHTML();target.setAttribute("alt",symbol_name);target.setAttribute("title",symbol_name);}
function FindTermInAllTranscripts(oForm,page_name){if(oForm.term.value.trim()==""||oForm.term.value=='e.g. "this quarter"'||oForm.term.value=='type an expression or a keyword here...'||oForm.term.value=='Search for products, companies, themes'){return false;}
urchinTracker('event/'+page_name+'/search_box/search_all_transcripts');order_param=((top.location.href.indexOf("order_by=relevance")>-1)?"&order_by=relevance":"");top.location.href="/search/transcripts?term="+encodeURIComponent(oForm.term.value)+order_param+"&all=true";return false;}
function FindTermInSymbolTranscripts(oForm,page_name){if(oForm.term.value.trim()==""){return false;}
urchinTracker('event/'+page_name+'/search_box/search_symbol_transcripts');location.href="/search/transcripts?symbol="+oForm.symbol.value+"&term="+encodeURIComponent(oForm.term.value);return false;}
var wl_icon_articles=[];var non_wl_icon_articles=[];function adding_wl_icon_for_watchlist_link(article_id,article_slugs,article_slugs_content,sasource){var element=$("article_"+article_id),symbols=$("article_symbols_"+article_id),wl_icon_granted=false,aSymbols;if(aSymbols=is_this_article_symbols_in_my_watchlist(article_slugs,article_slugs_content,sasource)){if(aSymbols.length){wl_icon_granted=true;if(symbols)symbols.innerHTML=aSymbols.join(", ");}}
if(!wl_icon_granted){non_wl_icon_articles.push(element)}}
function add_stats_to_wl_icons(){if(wl_icon_articles.length>0){wl_icon_articles.each(function(e){e.onclick=function(){var aImgs=e.getElementsByTagName('img');if(aImgs.length==2)
urchinTracker('event/'+getWLIconPageName()+'/wl_and_editors_icons/clicked');else
urchinTracker('event/'+getWLIconPageName()+'/wl_icon/clicked');}})
non_wl_icon_articles.each(function(e){e.onclick=function(){var aImgs=e.getElementsByTagName('img');if(aImgs.length==1)
urchinTracker('event/'+getWLIconPageName()+'/editors_icon/clicked');else
urchinTracker('event/'+getWLIconPageName()+'/no_icon/clicked');}})}}
function getWLIconPageName(){if(top.location.href.indexOf("/author/")>-1){return'author_page';}else if(top.location.href.indexOf("/dashboard/")>-1){return'dashboard_page';}else{return'sector_page'}}
function wl_icon_mouseover(img){var oLink=img.parentNode.getElementsByTagName('A')[0];oLink.className="wl_hover_link";}
function wl_icon_mouseout(img){var oLink=img.parentNode.getElementsByTagName('A')[0];oLink.className="dashboard_article_link";}
function wl_icon_onclick(img){var oLink=img.parentNode.getElementsByTagName('A')[0];if(oLink.click)oLink.click();else top.location.href=oLink.href;}
function is_this_article_symbols_in_my_watchlist(slugs,slugsContent,sasource){var articles_symbols_array=slugs,aSymbolsWL=[],aSymbols=[],sSlug;if(user_watchlist_slugs_from_cookie&&slugs.length){for(var i=0;sSlug=articles_symbols_array[i];i++){if((","+user_watchlist_slugs_from_cookie+",").indexOf(","+sSlug+",")>-1){aSymbolsWL.push("<a href='/symbol/"+sSlug+"' title='"+slugsContent[i]+"' class='symbol_in_portfolio'"+(sasource?" sasource='"+sasource+"'":'')+">"+sSlug.toUpperCase()+"</a>");}else{aSymbols.push("<a href='/symbol/"+sSlug+"' title='"+slugsContent[i]+"' class='dashboard_article_link'"+(sasource?" sasource='"+sasource+"'":'')+">"+sSlug.toUpperCase()+"</a>");}
if(aSymbolsWL.length==3)return aSymbolsWL;}
if(aSymbolsWL.length)aSymbolsWL=aSymbolsWL.concat(aSymbols.slice(0,3-aSymbolsWL.length));return aSymbolsWL.sort();}
return false;}
function display_results_order_by(order_by){if(order_by==""){location.href=location.href.gsub(/&order_by=.*(\?|\&|$)/i,"");}else if(location.href.indexOf('order_by')==-1){add_this="&order_by="+order_by;location.href=location.href+add_this;}}
function adslot_refreshination(slot){if((slot=="ETFs_Quotepage_728x90_leaderboard")&&isRefresh){slot="ETFs_QuotePage_728x90_leaderboard"};return(isRefresh&&(refreshed_ads_slots.indexOf(slot)!=-1))?slot+'_refreshed':slot;}
function GA_googleFillSlot_sa(slot){GA_googleFillSlot(adslot_refreshination(slot));}
function GA_googleAddSlot_sa(slot){GA_googleAddSlot("ca-pub-1420150919334552",adslot_refreshination(slot));}
function print_article(type){if(type=='no_comments')$('comments').className=$('comments').className.replace(' print_comments','');else if(type=='with_comments')$('comments').className=$('comments').className+' print_comments';urchinTracker('event/'+article_page_kind()+'_page/click_print/print_'+type);print();}
function GetArticleId(){var rx=/\/(?:news-)?article\/(\d+?)\-/;rx.test(top.location.href);return RegExp.$1;}
function a_or_an(str){return["a","e","i","u","o"].indexOf(str[0].toLowerCase())==-1?"a":"an";}
function dashboard_message(d_name,status){if(status=="new"){$('dashboard_advert_box_container').innerHTML="You have successfully signed-up for this email!";$('dashboard_advert_box_container').className="dashboard_message +d_name=='Long & Short Ideas'?'xxxx':'X'";}else{$('dashboard_advert_box').innerHTML='<div class="dashboard_message">You are already signed-up for this email</div>';}
$('dashboard_advert_box_container').style.display='inline';}
function ajax_dashboard_subscription_widget(dashboard_slug,d_name){new Ajax.Request("/account/ajax_dashboard_subscription_widget",{asynchronous:true,evalScripts:true,parameters:"dashboard_slug="+dashboard_slug+"&source=dashboards",onComplete:function(transport){if(transport.responseText=='success'){dashboard_message(d_name,"new");}else if(transport.responseText=='already_signed_up'){dashboard_message(d_name,"already_signed_up")}else if(transport.responseText=='unlogged'){top.location.href='/account/login?slugs='+dashboard_slug;}}});}
function change_vocation_id_to_ad_vocation_category(vocation_id){if(vocation_id){switch(vocation_id){case"11":return"other";case"7":case"25":return"bizExecutive";case"43":case"45":return"investor";case"9":case"46":return"retired";case"10":case"13":case"15":case"16":case"17":return"student";case"29":case"53":case"28":case"12":case"55":case"54":case"14":case"52":return"influential";case"38":return"ria";default:return"financePro";}}else{return"other";}}
function dart_my_vocation_and_profiles(){var add_to_ad_id=array_cp_profiles();if(cookieExists('u_voc')){add_to_ad_id.push("mv="+change_vocation_id_to_ad_vocation_category(readCookie('u_voc')));}
if(isRefresh){add_to_ad_id.push("r=t");}else{add_to_ad_id.push("r=f");}
if(has_etf_changed_hash){$H(has_etf_changed_hash).each(function(pair){if(pair.value=="true")add_to_ad_id.push("e="+pair.key);})}
if(cookieExists('xp')||cookieExists('xp_src')){add_to_ad_id.push("xp=t");}
if(cookieExists('tops')&&readCookie('tops')=='t'){add_to_ad_id.push("top=t");}
user_interests=","+readCookie('user_interests')+",";if(user_interests.match(/,13399,/i)){add_to_ad_id.push("tf=daily");}else if(user_interests.match(/,13400,/i)){add_to_ad_id.push("tf=weekly");}else if(user_interests.match(/,13401,/i)){add_to_ad_id.push("tf=monthly");}else if(user_interests.match(/,13402,/i)){add_to_ad_id.push("tf=infrequent");}
if(isAuthor()){add_to_ad_id.push("p=19");}
if((top.location.href.indexOf('/article/')>-1)&&(top.location.href.indexOf('source=email_rt_article')>-1)){add_to_ad_id.push("rta=t");}
add_to_ad_id=add_to_ad_id.join(";");if(add_to_ad_id!=""){add_to_ad_id+=";";}
if(typeof(quantSegs)!="undefined"){if(quantSegs&&quantSegs!=""){add_to_ad_id+=quantSegs;}}
return add_to_ad_id;}
function handle_tops_cookie(){if(is_users_cookie_exists()&&!cookieExists('tops')&&typeof(tops)!="undefined"){var reg_user_id=new RegExp(","+readCookie('user_id')+",");if((","+tops+",").match(reg_user_id)){createCookieTillSpecificUTC('tops','t',nextUpdate);}else{createCookieTillSpecificUTC('tops','f',nextUpdate);}}}
function is_subscribed_to_dashboard(dashboard_slug){return(readCookie('user_non_watchlist_slugs')&&readCookie('user_non_watchlist_slugs').split(",").indexOf(dashboard_slug)>-1);}
function init_dashboard_subscription_widget(dashboard_slug,d_name){if(is_users_cookie_exists()){if(readCookie("dashboard_email_alerts")){dashboard_message(d_name,readCookie("dashboard_email_alerts"));eraseCookie("dashboard_email_alerts");return;}
if(is_subscribed_to_dashboard(dashboard_slug))return false;$$('.btn_style_1')[0].onclick=function(){ajax_dashboard_subscription_widget(dashboard_slug,d_name)}
$('dashboard_advert_box_container').style.display='inline';}else{$$('.btn_style_1')[0].onclick=function(){Authentication.Authenticate(dashboard_slug,"dashboard",{Login:"sign_up_to_dashboard_email",Register:"FooterBar.Register",ForgotPassword:"FooterBar.ForgotPassword"},{Login:"subscribe to email alerts",Close:""},"","","dashboard_email_alerts");}
$('dashboard_advert_box_container').style.display='inline';}}
function sign_up_to_dashboard_email(){createCookie("dashboard_email_alerts","new")
location.reload();}
function checkSpelling(Suffix){var Sffix=Suffix||'';if(!window.jspellIsAttached)return;if(!jspellIsAttached()){$('jSpellReCheck'+Sffix).style.display='';$('jSpellDone'+Sffix).style.display='';$('jSpellCheck'+Sffix).style.display='none';}
jspellOnDemandCheck();}
function doneChecking(Suffix){var Sffix=Suffix||'';if(!window.jspellIsAttached)return;if(jspellIsAttached()){$('jSpellReCheck'+Sffix).style.display='none';$('jSpellDone'+Sffix).style.display='none';$('jSpellCheck'+Sffix).style.display='';jspellDetach();$('dmv').style.display='none';$('snv').style.display='none';$('dnv').style.display='none';if($("spell_buttons_wrapper"))$("spell_buttons_wrapper").removeClassName("split");}}
function jspellPostInit(){try{$('jSpellCheck').style.display='block';}catch(e){}};Event.observe(window,'load',function(){page_load();});function formulate_date(epoch_time,id){var month=["January","February","March","April","May","June","July","August","September","October","November","December"];var local=new Date();var now=new Date();local.setTime(epoch_time*1000);if(now.getFullYear()==local.getFullYear()){var theYear=' at'}else{var theYear=', '+local.getFullYear();}
var theHour=local.getHours();var ampm='am';if(theHour>12){theHour=theHour-12;ampm='pm';}else if(theHour==12){ampm='pm';}else if(theHour==0){theHour=12;}
var theMinutes=local.getMinutes();if(theMinutes<10){theMinutes='0'+theMinutes;}
var theTime=theHour+':'+theMinutes+ampm;var theMonth=month[local.getMonth()];var fullDate=theMonth+' '+local.getDate()+theYear+' '+theTime;$(id).innerHTML=fullDate;}
function nice_time_ago(time,target){var distance_in_minutes=parseInt(((new Date()).getTime()/1000-time)/60);var msg;if(distance_in_minutes==0)
msg="Seconds ago";else if(distance_in_minutes>=1&&distance_in_minutes<=59)
msg=distance_in_minutes+" minute"+(distance_in_minutes>1?"s":"")+" ago";else if(distance_in_minutes>=60&&distance_in_minutes<=1439)
msg=parseInt(distance_in_minutes/60)+" hour"+(distance_in_minutes>=120?"s":"")+" ago"
else{var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var publishTime=new Date(time*1000);var theHour=publishTime.getHours();var ampm='am';if(theHour>12){theHour=theHour-12;ampm='pm';}else if(theHour==12){ampm='pm';}else if(theHour==0){theHour=12;}
var theMinutes=publishTime.getMinutes();if(theMinutes<10){theMinutes='0'+theMinutes;}
var theTime=theHour+':'+theMinutes+ampm;msg=month[publishTime.getMonth()]+" "+publishTime.getDate()+", "+publishTime.getFullYear();if(target){msg=msg+", "+theTime;}}
if(target)
$(target).innerHTML=msg;else
return msg;}
function hp_nice_time_ago(time){var distance_in_minutes=parseInt(((new Date()).getTime()/1000-time)/60);var msg;if(distance_in_minutes>=0&&distance_in_minutes<=1439){var publishTime=new Date(time*1000);var theHour=publishTime.getHours();var ampm='AM';if(theHour>12){theHour=theHour-12;ampm='PM';}else if(theHour==12){ampm='PM';}else if(theHour==0){theHour=12;}
var theMinutes=publishTime.getMinutes();if(theMinutes<10)theMinutes='0'+theMinutes;msg=theHour+':'+theMinutes+' '+ampm;}else{var publishTime=new Date(time*1000);var currenYear=new Date().getFullYear()
var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(publishTime.getFullYear()<currenYear)
msg=month[publishTime.getMonth()]+" "+publishTime.getDate()+", "+publishTime.getFullYear();else
msg=month[publishTime.getMonth()]+" "+publishTime.getDate();}
return msg;}
var timeHide;function show_item(item_id){clearTimeout(timeHide);$(item_id).style.display="";}
function hide_item(item_id,delay){if(delay){var doThis=function(){$(item_id).style.display="none";};timeHide=setTimeout(doThis,1000*delay);}else{$(item_id).style.display="none";}}
function update_upload_text(text){$('goto_edit_picture').getElementsByTagName('SPAN')[0].innerHTML=text;}
function goto_update_picture(){location.href='/account/upload_picture';return false;}
var arrangePageElements=new Hash();var changedPageElements=0;function savePageElementsToDB(){if(changedPageElements==0){return false;}
var queryString="";arrangePageElements.each(function(pair,index){if(index>0){queryString+="&";}
queryString+="pageEls["+pair.key+"]="+pair.value;});var myAjax=new Ajax.Request('/users/ajax_save_placements',{method:'post',parameters:queryString,onSuccess:function(transport){if(transport.responseText=="true"){changedPageElements=0;}}});}
function savePageElementsToSyncDB(){if(changedPageElements==0){return;}
var params="";arrangePageElements.each(function(pair,index){if(index>0){params+="&";}
params+="pageEls["+pair.key+"]="+pair.value;});if(window.XMLHttpRequest){AJAX=new XMLHttpRequest();}else{AJAX=new ActiveXObject("Microsoft.XMLHTTP");}
if(AJAX){AJAX.open("POST",'/users/ajax_save_placements',false);AJAX.setRequestHeader("Content-type","application/x-www-form-urlencoded");AJAX.setRequestHeader("Content-length",params.length);AJAX.setRequestHeader("Connection","close");AJAX.send(params);}}
var isPeriodicalSaveInitiated=0;function savePageElementsPeriodically(){if(isPeriodicalSaveInitiated==0){new PeriodicalExecuter(savePageElementsToDB,40);window.onbeforeunload=savePageElementsToSyncDB;isPeriodicalSaveInitiated=1;}}
function savePageElements(containerElement){var arr=$(containerElement).immediateDescendants();var orderString="";arr.each(function(block,index){if(!(/no_dropdown/.test(block.id))){orderString+=block.id.replace("block_","");if($("content_"+block.id)&&$("content_"+block.id).style.display=='none'){if($(block.id).getAttribute('loading_by_server')!=1)
orderString+="|M";else
orderString+="|AM";}
if(index<arr.length-1){orderString+=",";}}});arrangePageElements.set(containerElement,orderString);changedPageElements++;}
function insert_dropdown_menues(insertClass){var arr=document.getElementsByClassName(insertClass);var elID="";arr.each(function(el){elID=el.id.replace("insert_","");var menuHTML=[];menuHTML.push("<div class=\"mini_category_options_popup\" id=\"menu_"+elID+"\" onclick=\"isOpenEvent();\"><span class=\"mini_category_options_popup_border\">");menuHTML.push("<div onclick=\"removeThisClass(this,'selected');return move_to_top('"+elID+"');\" class=\"mini_category_option_top\" onmouseover=\"addThisClass(this,'selected');\" onmouseout=\"removeThisClass(this,'selected');\">move&nbsp;to&nbsp;top</div>");menuHTML.push("<div onclick=\"removeThisClass(this,'selected');return move_up('"+elID+"');\" class=\"mini_category_option_up\" onmouseover=\"addThisClass(this,'selected');\" onmouseout=\"removeThisClass(this,'selected');\">move&nbsp;up</div>");menuHTML.push("<div onclick=\"removeThisClass(this,'selected');return move_down('"+elID+"');\" class=\"mini_category_option_down\" onmouseover=\"addThisClass(this,'selected');\" onmouseout=\"removeThisClass(this,'selected');\">move&nbsp;down</div>");menuHTML.push("<div onclick=\"removeThisClass(this,'selected');return toggle_content('"+elID+"');\" id=\"min_block_"+elID+"\" class=\"mini_category_option_minimize\" onmouseover=\"addThisClass(this,'selected');\" onmouseout=\"removeThisClass(this,'selected');\">minimize</div>");menuHTML.push("</span></div>");new Insertion.Top($('insert_'+elID),menuHTML.join(''));});}
var currenlyOpenMenu="";var openEvent=0;function submit_app(elID,appId){if(!elID||($("content_block_"+elID).style.display=="block"&&elID)){$('APP_'+appId).parentNode.style.height=$('APP_'+appId).getAttribute("original_height")+"px";writeToIframe('APP_'+appId,"");frameListeners[appId]=new iFrameListener("APP_"+appId,appId);setTimeout(function(){$('myForm_'+appId).submit();$("app_loading_"+appId).style.display="block";},50);}}
function isOpenEvent(){openEvent=1;}
function toggle_dropdown_menu(blockID){if($('dashboard_tip')&&$('dashboard_tip').style.display=='block'){$('dashboard_tip').style.display='none';AlphaCookie.set('dt','t');}
var menuID="menu_"+blockID;if($(menuID).style.display=='block'){$(menuID).style.display='none';currenlyOpenMenu="";}else{close_dropdown_menu(currenlyOpenMenu);$(menuID).style.display='block';currenlyOpenMenu=blockID;openEvent=1;}
return false;}
function close_dropdown_menu(blockID){var menuID="menu_"+blockID.replace('block_','');if($(menuID)&&$(menuID).style.display=='block'){$(menuID).style.display='none';currenlyOpenMenu="";}
return false;}
function toggle_content(blockID){blockID="block_"+blockID;var contentID="content_"+blockID;if($(contentID).style.display!='none'){$(contentID).style.display='none';$("min_"+blockID).innerHTML="show";}else{if(/app_big_(\d+)/.test(contentID)){if($("myForm_"+RegExp.$1))
{$("myForm_"+RegExp.$1).submit();}}
$(contentID).style.display='block';$("min_"+blockID).innerHTML="minimize";}
close_dropdown_menu(blockID);savePageElements($(blockID).parentNode.id);}
function move_to_top(blockID){blockID="block_"+blockID;blockClasses=($(blockID).className).replace(' first','').replace(' last','');if($(blockID).hasClassName('first')){return false;}
var container=$(blockID).parentNode;var arr=container.immediateDescendants();if(arr){arr.first().removeClassName('first');}
new Insertion.Top(container,"<div id='"+blockID+"' class='"+blockClasses+" first'>"+$(blockID).remove().innerHTML+"</div>");arr=container.immediateDescendants();if(arr){arr.last().addClassName('last');}
close_dropdown_menu(blockID);reset_app_menus();savePageElements(container.id);return false;}
function bounce_to_top(containerElement,blockID,toClose){blockID="block_"+blockID;if(!$(blockID)){return;}
blockClasses=($(blockID).className).replace(' first','').replace(' last','');var arr=$(containerElement).immediateDescendants();if(arr){arr.first().removeClassName('first');}
new Insertion.Top($(containerElement),"<div id='"+blockID+"' class='"+blockClasses+" first'>"+$(blockID).remove().innerHTML+"</div>");if(toClose=='M'){$("content_"+blockID).style.display="none";$("min_"+blockID).innerHTML="show";}
arr=$(containerElement).immediateDescendants();if(arr){arr.last().addClassName('last');}
return false;}
function move_up(blockID){blockID="block_"+blockID;blockClasses=($(blockID).className).replace(' first','').replace(' last','');var arr=$(blockID).previousSiblings();var extraClass="";if(arr.length){if(arr[0].hasClassName('first')){arr[0].removeClassName('first');extraClass=' first';}
if($(blockID).hasClassName('last')){arr[0].addClassName('last');}
new Insertion.Before(arr[0],"<div id='"+blockID+"' class='"+blockClasses+extraClass+"'>"+$(blockID).remove().innerHTML+"</div>");close_dropdown_menu(blockID);reset_app_menus();savePageElements($(blockID).parentNode.id);}
return false;}
function reset_app_menus(){setTimeout(function(){var arr=$$(".app_launch_options_bar");if(arr.length>0){arr.each(function(menu){menu.select("ul li").each(function(record){record.style.display="block"});});if(arr.first().select(".options_bar_move_top")&&arr.first().select(".options_bar_move_top")[0])arr.first().select(".options_bar_move_top")[0].style.display="none";if(arr.first().select(".options_bar_move_up")&&arr.first().select(".options_bar_move_up")[0])arr.first().select(".options_bar_move_up")[0].style.display="none";if(arr.last().select(".options_bar_move_down")&&arr.last().select(".options_bar_move_down")[0])arr.last().select(".options_bar_move_down")[0].style.display="none";}},10);}
function move_down(blockID){blockID="block_"+blockID;blockClasses=($(blockID).className).replace(' first','').replace(' last','');var arr=$(blockID).nextSiblings();var extraClass="";if(arr.length){if(arr[0].hasClassName('last')){arr[0].removeClassName('last');extraClass=' last';}
if($(blockID).hasClassName('first')){arr[0].addClassName('first');}
if(arr[0]&&arr[0].getAttribute("loading_by_server")&&arr[0].getAttribute("loading_by_server")==1){arr[0].setAttribute("loading_by_server",0);var intText=arr[0].select(".app_minimized_note .text")[0];if(intText)intText.innerHTML="";}
new Insertion.After(arr[0],"<div id='"+blockID+"' class='"+blockClasses+extraClass+"'>"+$(blockID).remove().innerHTML+"</div>");close_dropdown_menu(blockID);reset_app_menus();savePageElements($(blockID).parentNode.id);}
return false;}
function arrange_page_elements(containerElement,orderString){arrangePageElements.set(containerElement,orderString);var orderArr=orderString.split(",");orderArr.reverse().each(function(element){elementArr=element.split("|");bounce_to_top(containerElement,elementArr[0],elementArr[1]);});$(containerElement).style.display="";savePageElements(containerElement);changedPageElements=0;}
function arrange_minimize_minimized(orderString){if(orderString){var orderArr=orderString.split(",");orderArr.reverse().each(function(element){var elementArr=element.split("|");if((elementArr[1]=="M")&&(!(/app_big_(\d+)/.test(elementArr[0])))){var div=$("min_block_"+elementArr[0]);if(div)div.innerHTML="show";}
else if((elementArr[1]!="M")&&(elementArr[1]!='AM')&&(/app_big_(\d+)/.test(elementArr[0]))){if($("myForm_"+RegExp.$1))submit_app(false,RegExp.$1);}});}else{$$("form").each(function(form){if(/^myForm_(\d+)$/.test(form.id))
submit_app(false,RegExp.$1);});}}
function SeparatorNumber(number){var exp=/(\d+)(\d{3})/;number=number+"";while(exp.test(number)){number=number.replace(exp,'$1'+","+'$2');}
return number;}
function add_first_last(containerElement){var arr=$(containerElement).immediateDescendants();if(arr.length>0){arr.first().addClassName('first');arr.last().addClassName('last');if(arr.first().select(".options_bar_move_top")[0])arr.first().select(".options_bar_move_top")[0].style.display="none";if(arr.first().select(".options_bar_move_up")[0])arr.first().select(".options_bar_move_up")[0].style.display="none";if(arr.last().select(".options_bar_move_down")[0])arr.last().select(".options_bar_move_down")[0].style.display="none";}}
function addThisClass(el,addClass){var classes=(el.className).split(' ');if(classes.indexOf(addClass)==-1){classes.push(addClass);}
el.className=classes.join(' ');}
function removeThisClass(el,removeClass){var classes=(el.className).split(' ');if(classes.indexOf(removeClass)!=-1){classes[classes.indexOf(removeClass)]='';}
el.className=classes.join(' ');}
function replaceOldCPCookies(){var cp_cookie_exceptions=[1,3,12];for(var i=0;i<=18;i++){if(cp_cookie_exceptions.indexOf(i)==-1){if(readCookie('c_p'+i)=="1"){create_cp_cookie('c_p'+i,1,30);eraseCookie('c_p'+i);}}}}
function dottize(str,length){return(str.length>length?str.slice(0,length-3)+"...":str);}
function ieVersionOlderThan(ie_version){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var current_ieversion=new Number(RegExp.$1);return current_ieversion<=ie_version?true:false;}}
function isSmallScreen(good_width){try{good_width=good_width||$('main_container').getWidth();var viewport_width=document.viewport.getWidth();if(viewport_width<good_width)return true;return false;}catch(e){}
return false;}
function stickyAd(target,settings){this.ie6=navigator.appVersion.indexOf("MSIE 6.0")!=-1;this.Target=target;this.settings=settings||{};this.settings.Height=this.settings.Height!=null?this.settings.Height:600;this.settings.Width=this.settings.Width!=null?this.settings.Width:160;this.wrapper=null;this.settings.TopDistance=this.settings.TopDistance!=null?this.settings.TopDistance:45;this.settings.BottomDistance=this.settings.BottomDistance;this.fixed_ads_init=function(){if(SA.Utils.Env.touchSupport)return;this.Target=$(this.Target);if(this.Target){this.banner_top_range=Position.cumulativeOffset(this.Target)[1];this.wrapper=this.Target.parentNode;Event.observe(window,'scroll',function(){this.fixed_ads_scroll(this.banner_top_range);}.bind(this));}}
this.fixed_ads_scroll=function(){this.move_banner=function(){if(this.Target){if(isSmallScreen()){this.Target.style.position="static";this.Target.style.top="0px";this.Target.style.left="0px";return;}
var footer_top_range=null;if($("footer_container"))footer_top_range=Position.cumulativeOffset($("footer_container"))[1]
else if($("footer"))footer_top_range=Position.cumulativeOffset($("footer"))[1]
else if(this.settings.BottomDistance)footer_top_range=this.settings.BottomDistance;else return;var netoHeightFixedAdBottom=footer_top_range-this.settings.Height-10;if(this.wrapper)this.banner_top_range=Position.cumulativeOffset(this.wrapper)[1];var scroll_top=document.viewport.getScrollOffsets().top+this.settings.TopDistance;if((scroll_top>=this.banner_top_range)&&(scroll_top<=netoHeightFixedAdBottom)){if(this.ie6){var location=document.viewport.getScrollOffsets().top-this.banner_top_range;new Effect.Move(this.Target,{x:0,y:location+this.settings.TopDistance,mode:'absolute'});}else{this.Target.style.clear="both";this.Target.style.position="fixed";this.Target.style.top=this.settings.TopDistance+"px";this.Target.style.left="auto"}}
else if(scroll_top>netoHeightFixedAdBottom){if(this.ie6){var location=netoHeightFixedAdBottom-this.banner_top_range;new Effect.Move(this.Target,{x:0,y:location,mode:'absolute'});}else{this.Target.style.position="relative";this.Target.style.top=(netoHeightFixedAdBottom-this.banner_top_range)+"px";this.Target.style.left="0px";}}else{if(this.ie6){new Effect.Move(this.Target,{x:0,y:0,mode:'absolute'});}else{this.Target.style.position="static";this.Target.style.top="0px";this.Target.style.left="0px";}}}}.bind(this);if(this.ie6){clearTimeout(this.MoveTimeout);this.MoveTimeout=setTimeout(this.move_banner,200);}else{this.move_banner();}}
SeekingAlpha.Initializer.onDOMLoad(function(){this.fixed_ads_init()}.bind(this));}
Event.observe(document,'click',function(event){if(currenlyOpenMenu!=""&&openEvent==0){close_dropdown_menu(currenlyOpenMenu);}else if(openEvent==1){openEvent=0;}});function go_to_sort_page(profile_url,sort_by,follow_type,page){var strURL='/'+profile_url+'/'+follow_type;if(sort_by!="recent"){strURL+='/'+sort_by;}
var filter="";if($('only_contributors').checked==true){filter+="c";}
if(filter!=""){strURL+='/'+filter;}
if(page&&page>1){strURL+='/'+page;}
location.href=strURL;}
function load_remote_script(Url){var Script=document.createElement('script');Script.type="text/javascript";Script.src=Url;document.body.insertBefore(Script,document.body.firstChild);}
var captchas_hash=[];captchas_hash.push([0,'What is the opposite of "bad"?',4])
captchas_hash.push([1,'What is 20 divided by four (in words)?',4])
captchas_hash.push([2,'How much is 2 plus five (in words)?',5])
captchas_hash.push([3,'What is the first month of the year?',7])
captchas_hash.push([4,'How many minutes are in an hour (in numbers)?',2])
captchas_hash.push([5,'What is four plus 4 (in words)?',5])
captchas_hash.push([6,'What is twenty divided by 2 (in words)?',3])
captchas_hash.push([7,'What is two times 1 (in numbers)?',1])
captchas_hash.push([8,'How much is six plus 3 (in words)?',4])
captchas_hash.push([9,'What is two plus two (in numbers)?',1])
function email_story_to_friends_html(id,mail_to_uri,type){var koko=[];koko.push("<form id=\"email_to_a_friend\" method=\"post\" onsubmit=\"return false;\" onkeypress=\"KEY_FORM_PRESS(event,function () { validate_email_to_a_friend_popup('"+type+"') })\">")
koko.push("<div id=\"email_to_a_friend_popup\">");koko.push("<div style=\"font-size:0.8em;\"><strong style=\"font-size:18px; color: #891C0D;\">Send "+((type=='Article')||(type=='AcquireStory')?'Article':(type=='InstablogPost'?'Instablog Post':(type=='MarketCurrent'?'this News Item':'StockTalk!!')))+"</strong> or ");if(type=='InstablogPost'){koko.push("<a onclick=\"email_story_to_friends_log('"+type+"', 'open_client',"+id+");AlphaBox.Close();\" href=\"mailto:?body= I thought you might find this instablog post interesting: "+mail_to_uri+"?source=from_friend_client\">send it from your email program</a>");}else if(type=='StockTalk'){koko.push("<a onclick=\"email_story_to_friends_log('"+type+"', 'open_client',"+id+");AlphaBox.Close();\" href=\"mailto:?body= I thought you might find this StockTalk interesting: "+mail_to_uri+"?source=from_friend_client\">send it from your email program</a>");}else{koko.push("<a onclick=\"email_story_to_friends_log('"+type+"', 'open_client',"+id+");AlphaBox.Close();\" href=\"mailto:?body= I thought you might find this "+(type=='mc'?'news item':'article')+" on Seeking Alpha interesting: "+mail_to_uri+"?source=from_friend_client\">send it from your email program</a>");}
koko.push(" <span style=\"font-style:italic; color:grey;\">e.g. Outlook</span></div>")
koko.push("<div><strong>Send to (up to 5 recipients):</strong></div><div class=\"error_message\" style=\"display:none\" id=\"friend_emails_errors\"></div>");koko.push("<input type=\"text\" class=\"text\" id=\"friend_emails\" name=\"friend_emails\">");koko.push("<div class=\"note\">Enter the email address of the recipient. Separate multiple addresses with commas.</div>");koko.push("<div><strong>Add your own personal message:</strong></div>");koko.push("<textarea rows=\"5\" cols=\"20\" class=\"input_text_switcher2\ id=\"personal_message\" name=\"personal_message\" title=\"Enter some text here.\" onfocus=\"handleInput(this,'focus')\" onblur=\"handleInput(this,'blur')\" onkeypress=\"return imposeMaxLength(this, 200);\">Enter some text here.</textarea>");koko.push("<div><strong>Enter your email address: (required)</strong></div><div class=\"error_message\" style=\"display:none\" id=\"my_email_error\"></div>");koko.push("<input type=\"text\" class=\"text\" id=\"my_email\" name=\"my_email\">");koko.push("<div class=\"note\"><em>Note:</em> Your email address, and that of your recipients, will be used <em>only</em> in the case of transmission errors and to let the recipient know who sent the "+((type=='Article')||(type=='AcquireStory')?'article':(type=='InstablogPost'?'instablog post':(type=='MarketCurrent'?'market current':'StockTalk')))+".<br />The information will not be used for any other purpose.</div>");koko.push("<div class=\"alert\">To help us prevent spamming, please answer:</div>");koko.push("<div><strong><span id=\"captcha_question\"></span></strong></div><div class=\"error_message\" style=\"display:none\" id=\"answer_captcha_error\"></div>");koko.push("<input type=\"hidden\" name=\"captcha_id\" id=\"captcha_id\" />");koko.push("<input type=\"text\" class=\"text\" id=\"answer_captcha\" name=\"answer_captcha\">");koko.push("<input type=\"button\" id=\"email_to_a_friend_send_button\" class=\"button\" value=\"Send\" onclick=\"validate_email_to_a_friend_popup('"+type+"')\">");koko.push("<div class=\"loader\" id=\"email_to_a_friend_loader\" style=\"display:none; text-align:right;\"><img src=\"http://static.seekingalpha.com/images/loader.gif\" style=\"clear: both\"/></div>")
koko.push("<input type=\"hidden\" id=\"article_id\" name=\"article_id\" value=\""+id+"\">");koko.push("<span id=\"closeButton\" onclick=\"AlphaBox.Close()\">");koko.push("</div></form>");return koko.join("");}
function display_sent_story_to_friends_email_html(type,article_id,from,to,subject,text){var koko=[];koko.push("<div id='email_to_a_friend_success_screen'>")
koko.push("<div style='margin-top: 35px; font-size:1.6em; color:maroon;'>Success!</div>")
koko.push("<div style='color:green; font-weight:700; margin-bottom:30px;'>Your Message has been sent</div>")
koko.push("<div style='font-style:italic; color:gray; border-bottom:1px dashed gray; margin-bottom:17px; font-size:0.95em; padding-bottom:5px;'>Quoted message</div>")
koko.push("<div style='margin-bottom:5px; font-size:0.8em;'><strong>From: &nbsp;&nbsp;</strong><span>"+from+"</span></div>")
koko.push("<div style='margin-bottom:5px; font-size:0.8em;'><strong>To: &nbsp;&nbsp;</strong><span>"+to+"</span></div>")
koko.push("<div style='font-size:0.8em;'><strong>Subject: &nbsp;&nbsp;</strong><span>"+subject+"</span></div>")
koko.push("<div style='margin-top:20px; font-size:0.8em;'>"+text+"</div>")
koko.push("<div style='font-size:0.8em; border-top:1px dashed gray; padding-top:5px; margin-top:40px; color:gray;'>This page was sent using our Send-to-Friend service<br/>Your email address has not been added to any list of any sort,<br/>and has not been recorded at our site.</div>")
koko.push("<div style='font-size:0.8em; float:right; margin-top:10px; font-style:italic; color:gray;'>The Seeking Alpha Team.</div>")
koko.push("<span id=\"closeButton\" onclick=\"AlphaBox.Close()\">");koko.push("</div>")
return koko.join("");}
function captcha(captcha_id){return captchas_hash[captcha_id];}
function init_captcha(){captcha_id=Math.round(1000*Math.random())%(captchas_hash.size())
$('captcha_id').value=captcha_id;$('captcha_question').innerHTML=captcha(captcha_id)[1];}
function insert_my_email_if_logged_in(){if(is_users_cookie_exists()){$('my_email').value=readCookie('user_email');}}
function email_story_to_friends(type,article_id,mail_to_uri){$('comment_popup').innerHTML=email_story_to_friends_html(article_id,mail_to_uri,type);AlphaBox.Loading();insert_my_email_if_logged_in();init_captcha();AlphaBox.AddContent("comment_popup");email_story_to_friends_log(type,"start",article_id);}
function display_sent_story_to_friends_email(type,article_id,from,to,subject,text){$('alphabox-modal-window').innerHTML=display_sent_story_to_friends_email_html(type,article_id,from,to,subject,text);email_story_to_friends_log(type,"success",article_id,to.split(",").length);}
function validate_email_to_a_friend_popup(type){var form_is_ok=true;$$('div.error_message').each(function(obj,i){obj.innerHTML=""})
$$('div.error_message').each(function(obj,i){obj.style.display="none"})
if($("my_email").value.trim()==""){form_is_ok=false;$("my_email_error").innerHTML="Please provide an email address.";$("my_email_error").style.display="block";}else{if(rxEmail.test($("my_email").value)==false){form_is_ok=false;$("my_email_error").innerHTML="Please enter a valid email address.";$("my_email_error").style.display="block";}}
if($('friend_emails').value.trim()==""){form_is_ok=false;$("friend_emails_errors").innerHTML="Please provide an email address.";$("friend_emails_errors").style.display="block";}else{friend_emails=$('friend_emails').value.split(",");if(friend_emails.size()>5){form_is_ok=false;$("friend_emails_errors").innerHTML="Up to 5 recipients are allowed.";$("friend_emails_errors").style.display="block";}else{$("friend_emails_errors").innerHTML="Please correct these emails:";for(i=0;i<friend_emails.length;i++){if(rxEmail.test(friend_emails[i].trim())==false){form_is_ok=false;$("friend_emails_errors").innerHTML+=" "+friend_emails[i].trim();$("friend_emails_errors").style.display="block";}}}}
if($('answer_captcha').value.trim()==''){form_is_ok=false;$("answer_captcha_error").innerHTML="Please answer the security question.";$("answer_captcha_error").style.display="block";}else if($('answer_captcha').value.length!=captcha($('captcha_id').value)[2]){form_is_ok=false;email_story_to_friends_log(type,"captcha_error_js",$("article_id").value)
$("answer_captcha_error").innerHTML="Try again, the answer is incorrect.";$("answer_captcha_error").style.display="block";}
if(form_is_ok&&!$('email_to_a_friend_send_button').disabled){$('email_to_a_friend_send_button').disabled=true;ajax_email_to_a_friend(type);}
return false;}
function ajax_email_to_a_friend(type){btn_submit=$('email_to_a_friend_send_button');loader=$('email_to_a_friend_loader');var parameters_data=Form.serialize($('email_to_a_friend'))+'&item_name='+type
href='/form/ajax_send_item_to_friends';new Ajax.Request(href,{asynchronous:true,evalScripts:true,parameters:parameters_data,onLoading:function(transport){btn_submit.disabled=true;loader.style.display='block';},onComplete:function(transport){if(200==transport.status){if(transport.responseText=="captcha failed"){loader.style.display='none';$("answer_captcha_error").innerHTML="Try again, the answer is incorrect.";$("answer_captcha_error").style.display="block";email_story_to_friends_log(type,"captcha_error_server",$("article_id").value);btn_submit.disabled=false;}else{loader.style.display='none';email_params_array=transport.responseText.split("@@@");display_sent_story_to_friends_email(type,email_params_array[0],email_params_array[1],email_params_array[2],email_params_array[3],email_params_array[4]);}}else{alert("An error has occurred.");btn_submit.disabled=false;}}});}
function vanish(elem){var elem=$(elem);elem.style.overflow="hidden";elem.morph('height:0px',{afterFinish:function(){elem.style.display="none"}});}
function flip_html_attributes_order(parent_id){var parent_att=$(parent_id);if(parent_att){children_flipped_arr=parent_att.childElements().reverse();children_flipped_arr.each(function(child){parent_att.appendChild(child);})}}
var sprintf=(function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase();}
function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}
return output.join('');}
var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0]);}
return str_format.format.call(null,str_format.cache[arguments[0]],arguments);};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type='',arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==='string'){output.push(parse_tree[i]);}
else if(node_type==='array'){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw(sprintf('[sprintf] property "%s" does not exist',match[2][k]));}
arg=arg[match[2][k]];}}
else if(match[1]){arg=argv[match[1]];}
else{arg=argv[cursor++];}
if(/[^s]/.test(match[8])&&(get_type(arg)!='number')){throw(sprintf('[sprintf] expecting number but found %s',get_type(arg)));}
switch(match[8]){case'b':arg=arg.toString(2);break;case'c':arg=String.fromCharCode(arg);break;case'd':arg=parseInt(arg,10);break;case'e':arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case'f':arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case'o':arg=arg.toString(8);break;case's':arg=((arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg);break;case'u':arg=Math.abs(arg);break;case'x':arg=arg.toString(16);break;case'X':arg=arg.toString(16).toUpperCase();break;}
arg=(/[def]/.test(match[8])&&match[3]&&arg>=0?'+'+arg:arg);pad_character=match[4]?match[4]=='0'?'0':match[4].charAt(1):' ';pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):'';output.push(match[5]?arg+pad:pad+arg);}}
return output.join('');};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0]);}
else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push('%');}
else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==''){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else{throw('[sprintf] huh?');}}}
else{throw('[sprintf] huh?');}
match[2]=field_list;}
else{arg_names|=2;}
if(arg_names===3){throw('[sprintf] mixing positional and named placeholders is not (yet) supported');}
parse_tree.push(match);}
else{throw('[sprintf] huh?');}
_fmt=_fmt.substring(match[0].length);}
return parse_tree;};return str_format;})();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv);};function do_not_show_all_other_del_pops(){$$(".delete_edit_this_post_pop").each(function(e){e.style.display="none";});}
var yieldbot_ad_params={src:null,size:null}
function yieldbot_ad_call(src,size){yieldbot_ad_params.src=src;yieldbot_ad_params.size=size;var ybotq=window.ybotq||[];ybotq.push(['psn','aae8']);ybotq.push(function(){var slot=yieldbot.slot_available(yieldbot_ad_params.size);if(slot){yieldbot_ad_params.src=yieldbot_ad_params.src.replace(/(sz=)(.*?)(;|,)/,'ybot_ad=y;ybot_slot='+slot+';$1$2$3');}
document.write('<scr'+'ipt type="text/javascript" src="'+yieldbot_ad_params.src+'"></scr'+'ipt>');});if(!ybotq.framework){document.write('<scr'+'ipt type="text/javascript" src="http://cdn.yb0t.com/js/yieldbot.intent.js"></scr'+'ipt>');}}
function iframeAd(sizeXformat,src){if(/\/shark\//i.test(location)){return"";}
var sizeParts=sizeXformat.split("x")
var query=[];if(window.ms_slug)query.push("ms_slug="+window.ms_slug);if(window.article_dashboards)query.push("article_dashboards="+window.article_dashboards);if(window.article_sectors_themes)query.push("article_sectors_themes="+window.article_sectors_themes);var iframeFilePath="";if(/^(www\.)?seekingalpha.com/i.test(location.host)){iframeFilePath="http://seekingalpha.com";}else if(location.host=="staging.seekingalpha.com"){iframeFilePath="http://staging.seekingalpha.com";}
document.write('<iframe scrolling="no" height="'+sizeParts[1]+'" width="'+sizeParts[0]+'" marginwidth="0" marginheight="0" frameborder="0" vspace="0" hspace="0" style="border: 0px none;" src="'+iframeFilePath+'/adsframe.html#que='+encodeURIComponent(src)+(query.length?("&par="+encodeURIComponent(query.join("&"))):"")+'"></iframe>');}
function convert_author_name_to_slug(name){var reg=new RegExp("[a-z\-]*>"+name);if(authors.match(reg))
return authors.match(reg)[0].split(">")[0];return"";}
function setWildcardClasses(){var date=new Date();var month=(date.getUTCMonth()+1).toString();if(month.length==1){month="0"+month}
var daystamp=date.getUTCFullYear().toString()+month+date.getUTCDate().toString();document.write("<style>.unit-content .currtime {display:none;} .unit-content .t_"+daystamp+" .date {display:none;} .unit-content .t_"+daystamp+" .currtime {display:inline;}</style>");}
function sasource_extras(parent_id,value){$$('#'+parent_id+' a').each(function(el){if(source=el.getAttribute('sasource')){source+=value;el.setAttribute('sasource',source);}})}
function dash(str,limit,space){var word=[];space=space?space:" "
str.split(" ").collect(function(w){word.push(w.length>limit?w.substring(0,limit-1)+"-"+space+w.substring(limit,w.length):w)})
return word.join(" ");}
function trueOffset(obj){var curleft=curtop=0;if(obj.offsetParent){do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while(obj=obj.offsetParent);return[curleft,curtop];}}
if($("sticky_navigation")){new stickyAd("sticky_navigation");}
function page_forms_get_username(){if(!$('form_user_name'))return;if(!readCookie('user_id')){open_header_log_in_popup_lightbox('headtabs_login','');$('form_user_name').value="";$('form_user_name').setAttribute("value","");$('form_user_name').removeAttribute("readonly");}else{var user_nick=readCookie('user_nick')||"";$('form_user_name').value=user_nick;$('form_user_name').setAttribute("value",user_nick);if(user_nick==""){$('form_user_name').removeAttribute("readonly");}}}
function ScrollerCloseToElement(el,delta){var ep_y=Element.positionedOffset(el)[1];var vp_y=document.viewport.getScrollOffsets().top;var viewport=document.viewport.getDimensions();return(ep_y<vp_y+viewport.height+delta)}
function isWritePostNew(){if(write_post_new)return'_new';return'';}
if(!window.trackLink){function trackLink(){}}
function submission_tooltip(){$$('[tooltip]').each(function(item){if(item.readAttribute('tooltip').trim().length!=0){item.observe('mouseover',function(){showTooltip(this)});item.observe('mouseout',function(){hideTooltip(this)});}});}
function hideTooltip(item){item.removeChild(item.el)}
function showTooltip(item){var el=document.createElement("div");el.className="tooltip_wrapper";if(!item.toolTipEl)
item.toolTipEl="<div class='square_bubble_wrapper sToolTip'>"
+"<div class='left_bump'></div>"
+"<div class='square_bubble'>"
+"<div class='square_bubble_inner'>"
+item.readAttribute('tooltip')
+"</div>"
+"</div>"
+"</div>";el.innerHTML=item.toolTipEl;item.el=el;item.insert(el);var width=$$('.sToolTip')[0].getWidth()+30+"px";el.style.right="-"+width;}
function write_post_new(){return true;}
(function(){var scope=SA.UsingNamespace("SA.Stats");scope.Mafne=new function(){this.on_array=function(source,a_array,tag){var tag_param=tag?"tag="+tag+"&":'';a_array.each(function(e){e.onclick=function(){if(e.href.indexOf('mafne.html')==-1){var anew_li=e;while(!anew_li.id.match('anew_')){anew_li=anew_li.parentNode}
e.href="/mafne.html?"+tag_param+"source="+source+anew_li.id.gsub('anew_','&anew_id=')+"&url="+escape(e.href);}}})}}})();(function(){var scope=SA.UsingNamespace("SA.Stats");scope.GA=new function(){var queue=[],pageTracker=null;this.event=function(category,action,label,value,noninteraction){queue.push(['_trackEvent',category,action,label,value,noninteraction]);}
this.pv=function(url){queue.push(['_trackPageview',url]);}
this.init=function(){pageTracker=window.pageTracker;var queueBak=queue;queue={push:function(arg){if(pageTracker&&arg&&arg.length>0){var method=pageTracker[arg[0]];if(method)method.apply(pageTracker,arg.slice(1));}}};for(var i=0;i<queueBak.length;i++)queue.push(queueBak[i]);}
SeekingAlpha.Initializer.Add(this.init);}})();(function(){var scope=SA.UsingNamespace("SA.Data");scope.Cookies=new function(){this.set=function(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}
document.cookie=escape(name).replace('+','%2B')+"="+escape(value).replace('+','%2B')+expires+"; path=/";}
this.get=function(name){if(window.user_cookie&&user_cookie[name])return''+user_cookie[name];var escName=escape(name).replace('+','%2B').replace(/([.*?^=!:${}()|[\]\/\\])/g,'\\$1');var cookie=document.cookie.match(new RegExp('(?:^|;)\\s*'+escName+'=([^;]*)(?:;|$)'));if(cookie)return unescape(cookie[1]);return null;}
this.del=function(name){this.set(name,"",-1);}
this.exists=function(name){var val=this.get(name);return val!=null&&val!='';}}})();(function(){var scope=SA.UsingNamespace("SA.Data");scope.Cache=new function(){var version="1";function constructor(){try{if(window.localStorage){if(localStorage.getItem("/SA/Version")!=version){localStorage.clear();}
localStorage.setItem("/SA/Version",version);}}catch(e){}}
if(window.localStorage){this.Get=function(key){return localStorage.getItem(key);}
this.Set=function(key,data){try{localStorage.setItem(key,data);}catch(e){localStorage.clear();}}
this.Clean=function(key){if(key){key=key;var rkeys=[];for(var i=0,len=localStorage.length;i<len;i++){var ckey=localStorage.key(i);if(ckey.startsWith(key))
rkeys[rkeys.length]=ckey;}
for(var i=0,len=rkeys.length;i<len;i++){localStorage.removeItem(rkeys[i]);}}else{localStorage.clear();}}}else{this.Get=function(key){return SA.Data.Cookies.get(key);}
this.Set=function(key,data){SA.Data.Cookies.set(key,data,2)}
this.Clean=function(key){SA.Data.Cookies.del(key)}}
setTimeout(constructor,10);}})();(function(){var scope=SA.UsingNamespace("SA.Data");scope.Chartbeat=new function(args){var scriptContainer;var chartElements;var apiKey;var interval;var intervalTime=10000;var updateAt;this.init=function(apiKey){scriptContainer=$("symbol_data_script_container");chartElements=$$("[chart_beat]");updateAt=$('chartbeat_update_at');}
this.run=function(){if(interval)clearInterval(interval);SA.Data.Chartbeat.getInfo();interval=setInterval(function(){SA.Data.Chartbeat.getInfo();},intervalTime);}
this.render=function(info){var d=new Date();var H=d.getUTCHours(),h=(H==0?12:(H>12?H-12:H)),m=d.getUTCMinutes(),s=d.getUTCSeconds();updateAt.innerHTML="last updated:"+(h<10?'0'+h:h)+':'+(m<10?'0'+m:m)+':'+s+(H<12?" AM":" PM");var size=chartElements.length;for(var i=0;i<size;i++){var el=chartElements[i];var key=el.getAttribute("key");var nv=info[key]
if(key&&typeof(nv)!="undefined"){var pre=el.getAttribute("preval");var cls=getClass(pre,nv);el.innerHTML=nv;el.className=cls;el.setAttribute("preval",nv);}}}
this.getInfo=function(){var path=escape(location.href.split("/article/")[1]);if(!scriptContainer)return;var oncomplete="SA.Data.Chartbeat.render";var nScript=document.createElement("script");var src="http://api.chartbeat.com/quickstats/?r="+Math.round(100000*Math.random())+"&host=seekingalpha.com&keys=I,W,R,r,c&limit=20&apikey=8527bf1e596cbe22c45cff0765302eb2&path="+path+"&jsonp="+oncomplete;nScript.src=src;scriptContainer.appendChild(nScript);}
function getClass(pre,nv){if(!pre||!nv)return"";if(pre<nv)return"up";if(pre>nv)return"down";return"";}}}());var charbeatHasRan=false;function chartbeat_alpha(){if(charbeatHasRan)return;var el=$("ads_and_tools");if(!el)return;charbeatHasRan=true;var h=[];h.push("<style>.chartbeat.block{background:#fff; padding:6px; border:1px solid #ccc;margin-bottom:16px;} ");h.push(".red_title_text.chartbeat{float:none !important; font-size:12px !important; line-height:19px;} ");h.push(".chartbeat .sub_chart div{margin-left:6px; line-height:19px} ");h.push(".chartbeat .up{color:green; background:url('/images/universal/big_updown_arrows.png') no-repeat scroll 0 0px; padding-left:15px; } ");h.push(".chartbeat label{display:block; float:left; width:86px; } ");h.push(".chartbeat .sub_chart label{width:80px; } ");h.push(".chartbeat .down{color:red; background:url('/images/universal/big_updown_arrows.png') no-repeat scroll 0 -58px;padding-left:15px; } ");h.push("</style>");h.push('<div class="chartbeat block">');h.push('<div class="" style="">Page statistics</div><div style="float: right;" id="chartbeat_update_at"></div></div>');h.push("<div style='margin-left:10px'>");h.push('<div class="chartbeat red_title_text" title="The number of people reading (defined as actively moving around the page)."><label>Read:</label><span chart_beat key="read"></span></div>');h.push('<div class="chartbeat red_title_text" title="The total number of people."><label>People:</label><span chart_beat key="people"></span></div>');h.push("<div class='sub_chart' style='margin: 2px 0;'>");h.push('<div title="People coming directly to site."><label>Direct:</label><span chart_beat key="direct"></span></div>');h.push('<div title="People coming from internal links."><label>Internal:</label><span chart_beat key="internal"></span></div>');h.push('<div title="People coming from social links."><label>Social:</label><span chart_beat key="social"></span></div>');h.push('<div title="People coming from search."><label>Search:</label><span chart_beat key="search"></span></div>');h.push("</div>");h.push('<div class="chartbeat red_title_text" title="Number of users that are new"><label>New:</label><span chart_beat key="new"></span></div>');h.push('</div>');h.push('</div>');new Insertion.Top(el,h.join(" "));SA.Data.Chartbeat.init();SA.Data.Chartbeat.run();}
(function(){var scope=SA.UsingNamespace("SA.Data");scope.User=new function(){this.id=function(){return SA.Data.Cookies.get('user_id');}
this.nick=function(){return SA.Data.Cookies.get('user_nick').replace(/\+/gi,' ');}
this.email=function(){return SA.Data.Cookies.get('user_email');}
this.loggedIn=function(){return this.id()?true:false;}
this.uri=function(){var userUri=null,user_id=this.id();if(user_id){if(readCookie('author_slug')==null||readCookie('author_slug')==''){userUri="/user/"+user_id;}else{userUri="/author/"+readCookie('author_slug');}}
return userUri;}
this.authorSlug=function(){var slug=SA.Data.Cookies.get('author_slug');return slug==''?null:slug;}
this.isAuthor=function(){return(this.loggedIn()&&this.authorSlug()?true:false);}
this.setHref=function(aElement,dest){var userUri=getUserUri();aElement.href=userUri+"/"+dest;}
this.hasPortfolio=function(){return SA.Data.User.loggedIn()?SA.Data.Cookies.get('user_watchlist_slugs'):SA.Data.Cookies.get('temp_portfolio');}}})()
function ajax_submit_stock_talk(btn,display_delete,tag_condition_to_display,suffix,deduct_chars,must_have){var deduct_chars=deduct_chars||0;var must_have=must_have||'';var obj=$('stock_talk_form'+(suffix||''));var oTextarea=$('stock_talk_textarea'+(suffix||''));var subject_id=typeof(oTextarea.getAttribute("subject_id"))!="undifined"?oTextarea.getAttribute("subject_id"):false;var st_full_section=oTextarea.getAttribute("st_full_section");var oError=($('stocktalk_form_alert_add_stocktalk'+(suffix||''))||$('stocktalk_form_alert_add_stocktalk'));var oNick=($('input_nick'+(suffix||''))||$('input_nick'));var isSymbol=true;btn.blur();charCounter(oTextarea,suffix,deduct_chars);if(oTextarea.value.trim()==''||!is_users_cookie_exists()||oTextarea.value.trim()==oTextarea.title){return false;}
if(GetCountIgnoreLinks(oTextarea.value)>140){oError.innerHTML='You can write up to 140 characters';oError.style.display='';return false;}
if(must_have.length&&!new RegExp('(\\(|\\[| |^|\\,|\\.|\\\n)'+must_have.toRx().toUpperCase()+'(\\)|\\]| |$|\\,|\\.|\\\'|\\:|\\\n)').test(oTextarea.value)){if(oError){oError.innerHTML='You must include "'+must_have+'"';oError.style.display='';oError.style.color='red';}
if(oTextarea.getAttribute('keypressobserving')==null){oTextarea.observe('keypress',function(){this.style.display='none';}.bind(oError));oTextarea.setAttribute('keypressobserving',true);}
return false;}
if(oNick){adam=oError;if(!oNick.value.trim().length||oNick.value.trim()=='Please choose username'){oError.innerHTML='Please enter a Username.';oError.style.display='';oNick.focus();return false;}
if(oNick.value.length&&!validate_password(oNick.id,'stocktalk_form_alert_add_stocktalk'+(suffix||""),'Please enter a longer username.',2,80))return false;}
var form_parameter=Form.serialize(obj)+"&display_delete="+display_delete
if(oNick&&(!(/(?:^|&)nick=/).test(form_parameter))){form_parameter+="&nick="+oNick.value;}
if($('articles_st')){form_parameter+="&stocktalk_filter="+filter_stocktalk();}
if(tag_condition_to_display){form_parameter+="&tag_condition="+tag_condition_to_display;}
if(subject_id)form_parameter+="&subject_id="+subject_id;if(st_full_section)form_parameter+="&st_full_section=true";new Ajax.Request('/stock_talk/ajax_new_stock_talk',{asynchronous:true,evalScripts:true,parameters:form_parameter+'&suffix='+(suffix||''),onLoading:function(transport){btn.disabled=true;},onComplete:function(transport){if(transport.status==200&&transport.responseText.indexOf('<li')>-1){window.share_callback=function(){if(oError)oError.style.display='none';if(oNick){if($('my_details_info')){new Insertion.Top($('my_details_info'),'<strong><a href="'+st_profile_url()+'" class="name">'+oNick.value+'</a></strong>');}
oChooseNameRow=($('choose_username_row'+(suffix||''))||$('choose_username_row'))
oChooseNameRow.remove();oError.innerHTML='';oError.style.display='';SA.Navigation.Top.reset();}
oTextarea.value='';oTextarea.focus();$('char_counter'+(suffix||'')).innerHTML=(140-deduct_chars)+' characters left';if(transport.responseText!='<li>'){if(subject_id){SA.Models.StockTalkModel.addNew(subject_id,transport.responseText)}
else{new Insertion.Top($('stocktalk_list'+(suffix||'')),transport.responseText);if($('stocktalks_st')){$('stocktalks_st').checked=true;}
if($('my_empty_stocktalks'+(suffix||''))){$('my_empty_stocktalks'+(suffix||'')).remove();}
socialSA.init();}
SA.Models.StockTalkModel.initSt();SA.Models.StockTalkModel.realTime.collect();SA.Models.StockTalkModel.addScrollerToPopup("newStock");}}
pageTracker._trackEvent('Publish StockTalk',location.pathname);Mone.touch("stocktalk_sent");socialSA.share_post_object('stocktalk'+(suffix||''));}else if(transport.responseText=='moderated'){AlphaBox.Loading();AlphaBox.AddHtml(["<div class='thankYou_msg'>","<div class='msg'>Your StockTalk is being reviewed by our moderator and will be posted shortly.<br/>Thank you for your patience.</div>","<input type='button' onclick='AlphaBox.Close();' value='OK' class='btn'>","</div>"].join(""));var obj=$('stock_talk_textarea');if(obj)obj.value='';}else if(transport.responseText=='blocked_user'){var obj=$('stock_talk_textarea');if(obj)obj.value='';}else if(transport.responseText=='st_not_exists'){alert("Sorry, this StockTalk was deleted.");}else if(transport.responseText=='failed'){alert("An error has occurred.");}else{oError.style.display='';}
btn.disabled=false;}});return false;}
function st_profile_url(){if(readCookie('author_slug')==null||readCookie('author_slug')=='')return'/user/'+readCookie('user_id')+'/profile';else'/author/'+readCookie('author_slug');}
function get_stock_talks_page(filter){filter_page=filter;if(filter_page=="all_stocktalks")
top.location.href="/pages/stocktalks"
else
top.location.href="/account/my_feed?filter="+filter_page;}
function imposeMaxLength(Object,MaxLen){if(Object.value.length>MaxLen){Object.value=Object.value.substring(0,MaxLen);}}
function charCounter(Object,Sffix,deduct_chars){var deduct_chars=deduct_chars||0;var char_counter=140-deduct_chars-GetCountIgnoreLinks(Object.value);var oError=$('char_counter'+(Sffix||''));var oSubmit=$('stocktalk_submit_button'+(Sffix||''));if(char_counter<0){oError.innerHTML='<span>'+char_counter+' characters</span>';oSubmit.disabled=true;oSubmit.style.backgroundPosition="0px -53px";oSubmit.style.color='#959595';oSubmit.style.cursor='default';}else{oError.innerHTML=char_counter+' characters left';oSubmit.disabled=false;oSubmit.style.backgroundPosition="0 0";oSubmit.style.color='#090909';oSubmit.style.cursor='pointer';}}
function GetCountIgnoreLinks(Msg){var tiny_url_len=30,parsed_msg=Msg.replace(/\b(https?\:\/\/|\bwww\.)(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/gi,function($){return new Array(Math.min($.length,tiny_url_len)+1).join("0");});return parsed_msg.length;}
function change_bg(id){if($('deletespan_'+id)){$('deletespan_'+id).style.textDecoration="underline";$('deletespan_'+id).style.backgroundPosition="38px -17px";}}
function change_bg_out(id){if($('deletespan_'+id)){$('deletespan_'+id).style.textDecoration="none";$('deletespan_'+id).style.backgroundPosition="38px 3px";}}
function delete_stock_talk(btn,st_id,isSingle){new Ajax.Request('/stock_talk/delete_my_stock_talks',{asynchronous:true,evalScripts:true,parameters:"st_id="+st_id,onLoading:function(transport){},onComplete:function(transport){if(200==transport.status){if(transport.responseText!='failed'){if(isSingle)top.location.href=top.location.href.replace(/\/\d+?$/,'');var temp=$$("[st_section_id="+st_id+"]");if(temp.length>0){temp[0].remove();}
else{var el=$('li_'+st_id)
if(el)SA.Models.StockTalkModel.removeReply(el);}
$('stocktalk_count_menu').innerHTML=transport.responseText;$('stocktalk_count_archive').innerHTML=transport.responseText;}else{alert("You can only delete your own StockTalks.");}}}});}
function filter_stocktalk(){if($('articles_st')){var articles=$('articles_st').checked;var comments=$('comments_st').checked;var instablogs=$('instablogs_st').checked;var stocktalks=$('stocktalks_st').checked;var filter_result=[];if(articles||comments||instablogs||stocktalks){if(articles)filter_result.push('articles');if(comments)filter_result.push('comments');if(instablogs)filter_result.push('instablogs');if(stocktalks)filter_result.push('stocktalks');return filter_result.join("_")}else{return'do_nothing'}}else{return'articles_comments_instablogs_stocktalks';}}
function WriteStockTalkOn(slug){if(is_users_cookie_exists()){var user_id=readCookie('user_id');top.location.href='/user/'+user_id+'/stocktalk'}
else{Authentication.Authenticate(slug,"stocktalk",{Login:"WriteStockTalkOn.Login",Register:"Follow.Register",ForgotPassword:"Follow.ForgotPassword"},{Login:"publish StockTalks",Close:""});}}
WriteStockTalkOn.Login=function(slug){var user_id=readCookie('user_id');top.location.href='/user/'+user_id+'/stocktalk'}
function delete_post(post_id,isSingle){if(!confirm('Are you sure you want to delete this post?'))return false;obj=$('post_'+post_id)
if(obj.getAttribute('inProccess')==null){obj.setAttribute('inProccess',true);new Ajax.Request('/account/delete_instapost',{asynchronous:true,evalScripts:true,parameters:"post_id="+post_id,onComplete:function(transport){if(200==transport.status){if(transport.responseText=='failed'){alert('An error has occoured. Please try again.')
obj.removeAttribute('inProccess');}else{if(isSingle){if(readCookie('author_slug')==null||readCookie('author_slug')=='')top.location.href='/user/'+readCookie('user_id')+'/instablog';else top.location.href='/author/'+readCookie('author_slug')+'/instablog';}
obj.remove();if($('instablog_count_menu'))$('instablog_count_menu').innerHTML=transport.responseText;}}else{alert("An error has occurred.");obj.removeAttribute('inProccess');}}});}}
function WritePostOn(slug){trackLink('','Publishing Sources','Write a post on '+slug,location.pathname);if(is_users_cookie_exists()){if(slug){top.location.href='/account/write_post?publish_type=instablog&on_symbol='+slug}
else{top.location.href='/account/write_post?publish_type=instablog'}}else{Authentication.Authenticate(slug,"write_post",{Login:"WritePostOn.Login",Register:"Follow.Register",ForgotPassword:"Follow.ForgotPassword"},{Login:"set up an Instablog",Close:""});}}
WritePostOn.Login=function(slug){set_login_and_registration_header();if(slug)top.location.href='/account/write_post'+isWritePostNew()+'?on_symbol='+slug;else top.location.href='/account/write_post'+isWritePostNew();}
function generateUUID(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});}
function moneTracker(str){if(getDomain()=="seekingalpha.com"){random_suffix=Math.round(Math.random()*2147483647);img=document.createElement('img');img.src='http://mone.seekingalpha.com/'+escape(str)+'?rs='+random_suffix}}
function email_story_to_friends_log(type,popup_scenario,item_id,recipients){var log_line=''
if(type=='MarketCurrent'){log_line="event/market_current/email_market_current_to_friends/"+popup_scenario+"?market_current_id="+item_id;}else if(type=='InstablogPost'){log_line="event/instablog_post/email_post_to_friends/"+popup_scenario+"?post_id="+item_id;}else if(type=='StockTalk'){log_line="event/stocktalk/email_stocktalk_to_friends/"+popup_scenario+"?stocktalk_id="+item_id;}else if(type=='AcquireStory'){log_line="event/acquire_story/email_acquire_story_to_friends/"+popup_scenario+"?acquire_story_id="+item_id;}else{log_line="event/"+article_page_kind()+"/email_article_to_friends/"+popup_scenario+"?article_id="+item_id;}
if(recipients){log_line+="&number_of_recipients="+recipients}
moneTracker(log_line);urchinTracker(log_line);}
function advert_box_sign_up_log(advert_box_kind){var log_line=''
log_line="event/"+advert_box_kind+"/"+article_page_kind()+"/sign_up"
return log_line;}
var Mone={VERSION:1,other:"",sources:{"msn":["messages.finance.yahoo.com"],"yahoo":["messages.finance.yahoo.com"],"nasdaq":["www.wallstreet-online.de"],"motleyfool":["messages.finance.yahoo.com","boards.fool.com"],"etrade":["messages.finance.yahoo.com"],"reuters":[],"cnbc":[],"thestreet":["stockpickr.com"],"bloomberg":[],"themarkets":[],"marketwatch":[]},sourceDomains:["google.com","yahoo.com","bing.com","aol.com","msn.com","ask.com","ask.com","baidu.com"],noSourceDomains:["news.google.com","google.com/finance"],readUserCookie:function(){if(typeof(user_cookie)=="undefined")return"";var uCookie=[];uCookie.push('{'+(user_cookie.user_watchlist_slugs||"")+'}');uCookie.push('{'+(user_cookie.user_non_watchlist_slugs||"")+'}');uCookie.push('{'+(user_cookie.user_watchlist_authors||"")+'}');uCookie.push('{'+(user_cookie.user_following_users||"")+'}');return uCookie.join(";;;");},notWanted:/(^__)|(user_cookie_key=)|(user_perm=)|(machine_cookie=)|(session_cookie=)|(user_remember_token=)|(user_id=)|(user_nick=)|(user_email=)|(u_voc=)|(author_slug=)|(user_mywebsite_url=)|(gigya_notified_login=)|(user_gigya_settings=)|(gigya_post_object=)|(last_comment_date=)|(last_comment=)|(mc_ids=)|(session_referrer=)|(portfolio_popuped=)|(login_popuped=)|(user_notifications=)|(author_slug)|(first_page=)/,readOtherCookies:function(){var ca=document.cookie.split(';');rcookies=[]
for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(!Mone.notWanted.test(c)){rcookies.push(c);}}
rcookies=rcookies.join("; ");return unescape(rcookies);},readDocumentCookies:function(){var cookies=[];cookies.push(readCookie('user_id'));cookies.push(readCookie('user_nick'));cookies.push(readCookie('user_email'));cookies.push(readCookie('u_voc'));cookies.push(readCookie('author_slug'));cookies.push(readCookie('user_mywebsite_url'));cookies.push(readCookie('gigya_notified_login'));cookies.push(readCookie('user_gigya_settings'));return cookies.join(";;;");},touch:function(event_name){var sData=[];var tagData;var location_path=window.location.pathname;var href_params=window._pageviewURL?(_pageviewURL.match(/[^?#]+(\?[^#]+)?/)[1]||""):window.location.search;var saSource=window._saSource||(window.getURLParam&&getURLParam("source"));if(!cookieExists('machine_cookie')){user_value=Math.round((new Date).getTime()+Math.random()*1000000003366);createCookie('machine_cookie',user_value,2000);}
if(!cookieExists('session_cookie')||!isNaN(readCookie("session_cookie"))){GUID=generateUUID();createCookie('session_cookie',GUID+".0",1/48);createCookie('session_referrer',top.document.referrer,1/48);}else if((event_name==null)||event_name.match(/^mobile: #/)){ref_cook=readCookie('session_referrer');cook=readCookie('session_cookie');cook=cook.split(".");cook[1]=parseInt(cook[1])+1+'';createCookie('session_cookie',cook.join("."),1/48);createCookie('session_referrer',ref_cook,1/48);}
if(!cookieExists('pages_viewed')){createCookie('pages_viewed',1,2000);}else if((event_name==null)||event_name.match(/^mobile: #/)){var views=readCookie('pages_viewed');views=parseInt(views)+1;createCookie('pages_viewed',views,2000)}
if(!event_name||event_name.match(/^mobile: #/)){if(cookieExists('ref_partner')&&readCookie("ref_partner")!="other")
{createCookie('n_ref_partner',readCookie("ref_partner"),30);}
eraseCookie('ref_partner');if(saSource&&Mone.sources[saSource.toLowerCase().match(/^[a-z]+/)[0]]&&!cookieExists('n_ref_partner')){var denied_url=false;Mone.sources[saSource.toLowerCase().match(/^[a-z]+/)[0]].each(function(den_url){if(document.referrer.toLowerCase().match(new RegExp("^https?:\/\/"+den_url,"i")))denied_url=true;});if(!denied_url)createCookie('n_ref_partner',saSource.toLowerCase().match(/^[a-z]+/)[0],30);else createCookie('n_ref_partner',"other",30);}else if(cookieExists('n_ref_partner')){createCookie('n_ref_partner',readCookie("n_ref_partner"),30);}
else{var rgxp=new RegExp("("+Mone.sourceDomains.join("|").replace(/\./g,"\\.")+")");var noSourcergxp=new RegExp("("+Mone.noSourceDomains.join("|").replace(/\./g,"\\.").replace("/","\\/")+")");if(matched=document.referrer.toLowerCase().match(noSourcergxp))createCookie('n_ref_partner',"google.com",30);else if(matched=document.referrer.toLowerCase().match(rgxp))createCookie('n_ref_partner',"search|"+matched[0],30);else if(document.referrer=="")createCookie('n_ref_partner',"direct",30);else createCookie('n_ref_partner',"other",30);}}
if(location_path.match("/article/")&&(typeof(mone_article_tags)!='undefined')){tagData=mone_article_tags;}else if(location_path.match(/\/instablog\/\d+/)&&(typeof(mone_instapost_tags)!='undefined')){tagData=mone_instapost_tags;}
sData.push(Mone.VERSION);sData.push(top.document.referrer);sData.push(event_name);sData.push(location_path);sData.push(href_params);sData.push(readCookie('machine_cookie'));sData.push(readCookie('session_cookie'));sData.push(Mone.readDocumentCookies());sData.push(Mone.readUserCookie());sData.push(tagData);sData.push(Mone.readOtherCookies());Mone.moneTrackerPost(sData.join(";;;"));},moneTrackerPost:function(str){new Ajax.Request('/mone',{asynchronous:true,method:'post',postBody:"mone="+escape(str)});}}
function reply(div_id){remove_yellow_note();var comment_id=div_id.replace("comment_","");$('parent_id').value=comment_id;switch_reply_publish('reply');$$('.with_form').each(function(item){item.className=item.className.replace(' with_form','');})
new Insertion.After($('reply_comment_form_'+comment_id),($('comment_form_wrapper')));var content=$('comment_form_txtar');setSelRange(content,0,0);}
function open_immediate_comment_box(){switch_reply_publish(status);remove_yellow_note();$$('.with_form').each(function(item){item.className=item.className.replace(' with_form','');})
new Insertion.Before($('talkback_list'),($('comment_form_wrapper')));$('comment_form_txtar').focus();}
function report_spam(objLink,type,id,beforeAjax){if(!is_users_cookie_exists()){return false;}else{objLink.innerHTML='Reported<span class="punctuation">!</span>';objLink.className='report_abuse approve';objLink.setAttribute('onclick','return false;');if(beforeAjax)beforeAjax();new Ajax.Request('/account/ajax_report_spam',{asynchronous:true,evalScripts:true,parameters:'type='+type+'&id='+id,onLoading:function(transport){},onComplete:function(transport){if(200!=transport.status){alert("An error has occoured.");}}});return false;}}
function delete_instablog_comment(id){if(!is_users_cookie_exists()){return false;}else{new Ajax.Request('/account/ajax_delete_instablog_comment',{parameters:'id='+id,onLoading:function(transport){},onComplete:function(transport){if(200==transport.status){location.reload();}else{AlphaBox.Close();}}});$('delete_comment_bttn').onclick="";return false;}}
function delete_comment_pop(id){var boxHtml='<div class="del_comment_lightbox">';boxHtml+='  <div onclick="AlphaBox.Close();" class="close_button_gray_pop"></div>';boxHtml+='  <div class="dcl_t">Are you sure you want to delete this comment<br/>and any replies to it?</div>';boxHtml+='  <div class="dcl_btns">';boxHtml+='    <input type="button" id="delete_comment_bttn" class="grad orange" value="Delete" onclick="delete_instablog_comment('+id+');"/>';boxHtml+='    <input type="button" class="grad" value="Cancel" onclick="AlphaBox.Close();" />';boxHtml+='    <div class="cleaner"></div>';boxHtml+='  </div>';boxHtml+='</div>';AlphaBox.Loading();AlphaBox.AddHtml(boxHtml);}
var show_abuse_link=1;var commenter_abuse_html_article="<span class=\"report_abuse\" onmouseover=this.style.textDecoration=\"underline\" onmouseout=this.style.textDecoration=\"none\" onclick=\"report_spam(this, 'Comment', COMMENT_ID);\"><span>!&nbsp;</span>Report Abuse</span>";function writeReportAbuseArticle(id){if(is_users_cookie_exists()&&show_abuse_link){$("commenter_abuse_"+id).innerHTML=commenter_abuse_html_article.gsub("COMMENT_ID",id);}}
function deleteCommentOnMyPost(id,author_id){var this_user=readCookie('user_id');if(this_user!=null&&this_user==author_id){$("comment_delete_"+id).innerHTML="<span class=\"del_comment\" onmouseover=this.style.textDecoration=\"underline\" onmouseout=this.style.textDecoration=\"none\" onclick=\"delete_comment_pop("+id+");\">Delete Comment</span>";show_abuse_link=0;}}
function write_report_abuse_all_in_one(){if(is_users_cookie_exists()){if(all_comments=$$("span.commenter_abuse")){all_comments.each(function(e){e.innerHTML=commenter_abuse_html_article.sub("COMMENT_ID",e.id.sub("commenter_abuse_",""));});}}}
var Follow={}
Follow.user_sidebar__follow_button_initiator=function(user_id){$('follow_this_user').appendChild(Follow.add_the_right_follow_user_button(user_id,"follow","following"));}
Follow.author_sidebar__follow_button_initiator=function(slug){$('follow_this_user').appendChild(Follow.add_the_right_follow_author_button(slug,"follow","following"));}
Follow.author_on_top10_authors_page__follow_button_initiator=function(slug,container_id){container_id=container_id||'';$(slug.gsub("-","_")+'_follow'+container_id).appendChild(Follow.add_the_right_follow_author_button(slug,"follow","following_visited"));}
Follow.user_ff_page__follow_button_initiator=function(user_id){$(user_id+'_follow').appendChild(Follow.add_the_right_follow_user_button(user_id,"follow_small","following_visited"));}
Follow.author_ff_page__follow_button_initiator=function(slug){$(slug.gsub("-","_")+'_follow').appendChild(Follow.add_the_right_follow_author_button(slug,"follow_small","following_visited"));}
Follow.ff_page__remove_button_initiator=function(slug,type){$(slug.gsub("-","_")+'_remove').appendChild(Follow.remove_follow_from_account_button(type+'|'+slug));}
Follow.comment__follow_button_initiator=function(user_id,container_id){$('user_follow_'+container_id).appendChild(Follow.add_the_right_follow_user_button(user_id,"follow","following_icon"));}
Follow.author_on_top_authors_page__follow_button_initiator=function(slug,container_id){container_id=container_id||'';$(slug.gsub("-","_")+'_follow'+container_id).appendChild(Follow.add_the_right_follow_author_button(slug,"follow_small","following_visited"));}
Follow.user_on_top10_bloggers_page__follow_button_initiator=function(user_id,container_id){container_id=container_id||'';$(user_id+'_follow'+container_id).appendChild(Follow.add_the_right_follow_user_button(user_id,"follow","following_visited"));}
Follow.user_on_top_bloggers_page__follow_button_initiator=function(user_id,container_id){container_id=container_id||'';$(user_id+'_follow'+container_id).appendChild(Follow.add_the_right_follow_user_button(user_id,"follow_small","following_visited"));}
Follow.user_by_vocation_page__follow_button_initiator=function(user_id){$(user_id+'_follow').appendChild(Follow.add_the_right_follow_user_button(user_id,"follow_button","following_icon"));}
Follow.add_the_right_follow_author_button=function(slug,follow_class_name,following_class_name){if(readCookie('user_watchlist_authors')&&readCookie('user_watchlist_authors').split(",").indexOf(slug)!=-1){return Follow.already_follow_message(following_class_name);}else{return Follow.follow_this_author(slug,follow_class_name,following_class_name);}}
Follow.add_the_right_follow_user_button=function(user_id,follow_class_name,following_class_name){if(readCookie('user_following_users')&&readCookie('user_following_users').split(",").indexOf(user_id)!=-1){return Follow.already_follow_message(following_class_name);}else{return Follow.follow_this_user(user_id,follow_class_name,following_class_name);}}
Follow.remove_follow_from_account_button=function(TypeAndSlug){var remove_follow=document.createElement('div');remove_follow.innerHTML='<span onmouseover="$(this).addClassName(\'hover\')" onmouseout="$(this).removeClassName(\'hover\')" onclick="Follow.remove_follow_from_account_ajax(\''+TypeAndSlug+'\')">Stop Following</span>';return remove_follow;}
Follow.remove_follow_from_account_ajax=function(TypeAndSlug){if(!confirm('Are you sure you want to delete this user from your following list?'))return false;new Ajax.Request('/account/ajax_remove_my_following',{asynchronous:true,evalScripts:true,parameters:"type_and_info="+TypeAndSlug,onComplete:function(transport){if(200==transport.status){aRes=transport.responseText.split('|');aMe=TypeAndSlug.split("|")
if(aRes[0]=='failed'){alert('An error has occoured.');obj.removeAttribute('inProccess');}else{$(aMe[0]+'_'+aMe[1]).remove();Follow.change_ff_numbers_in_page(aRes[1],aMe[0],aMe[1]);Mone.touch("stop_follow_"+aMe[0]);obj.removeAttribute('inProccess');}}else{alert("An error has occurred.");obj.removeAttribute('inProccess');}}});}
Follow.already_follow_message=function(following_class_name){var already_follow_message=document.createElement('div');already_follow_message.innerHTML='<span class="'+following_class_name+'">Following</span>';if(following_class_name=="following"){already_follow_message.onclick=function(){clearTimeout(gTimeout);$('stop_follow').style.display='block';$('no_longer_follow').style.display='none';}}
return already_follow_message;}
Follow.follow_all_by_user_id=function(obj,user_id,following_class_name){arr=document.getElementsByClassName('user_follow_'+user_id);if(arr.length==0){$(obj.parentNode).insertBefore(Follow.already_follow_message(following_class_name),obj.nextSibling);$(obj).remove();}else{arr.each(function(obj){obj.innerHTML='';obj.appendChild(Follow.already_follow_message(following_class_name));});}}
Follow.follow_this_author=function(slug,follow_class_name,following_class_name){var follow_this_author_button=document.createElement('span');follow_this_author_button.id=slug.gsub("-","_")+'_watchlist_button';follow_this_author_button.className=follow_class_name;follow_this_author_button.innerHTML="Follow";follow_this_author_button.onclick=function(){Follow.follow_this_author_onclick(this,following_class_name);}
follow_this_author_button.setAttribute('slug',slug);return follow_this_author_button;}
Follow.follow_this_user=function(user_id,follow_class_name,following_class_name){var follow_this_user_button=document.createElement('span');follow_this_user_button.id=user_id+'_watchlist_button';follow_this_user_button.className=follow_class_name;follow_this_user_button.innerHTML='Follow';follow_this_user_button.onclick=function(){Follow.follow_this_user_onclick(this,following_class_name);}
follow_this_user_button.setAttribute('user_id',user_id);return follow_this_user_button;}
Follow.follow_this_author_onclick=function(obj,following_class_name){if($('no_longer_follow')){$('no_longer_follow').style.display='none';}
if(obj.getAttribute('inProccess')==null){obj.setAttribute('inProccess',true);if(is_users_cookie_exists()){Follow.ajax_logged_in_follow_new_author(obj,following_class_name);}else{Authentication.Authenticate('slug|'+obj.getAttribute('slug'),"follow_me",{Login:"Follow.Login",Register:"Follow.Register",ForgotPassword:"Follow.ForgotPassword"},{Login:"follow others",Close:""});obj.removeAttribute('inProccess');}}}
Follow.follow_this_user_onclick=function(obj,following_class_name){if($('no_longer_follow')){$('no_longer_follow').style.display='none';}
if(obj.getAttribute('inProccess')==null){obj.setAttribute('inProccess',true);if(is_users_cookie_exists()){Follow.ajax_logged_in_follow_new_user(obj,following_class_name);}else{Authentication.Authenticate('user_id|'+obj.getAttribute('user_id'),"follow_me",{Login:"Follow.Login",Register:"Follow.Register",ForgotPassword:"Follow.ForgotPassword"},{Login:"follow others",Close:""});obj.removeAttribute('inProccess');}}}
Follow.ajax_logged_in_follow_new_author=function(obj,following_class_name){var slug=obj.getAttribute('slug');new Ajax.Request('/account/ajax_logged_in_follow_new_user',{asynchronous:true,evalScripts:true,parameters:"slug="+slug+"&account_followers_page="+/\/account\/followers/.test(top.location.href),onComplete:function(transport){if(200==transport.status){aRes=transport.responseText.split('|');if(aRes[0]=='failed'){alert('An error has occoured.');obj.removeAttribute('inProccess');}else{addToCookie('user_watchlist_authors',slug);$(obj.parentNode).insertBefore(Follow.already_follow_message(following_class_name),obj.nextSibling);$(obj).remove();Follow.change_ff_numbers_in_page(aRes[1],'author',slug);obj.removeAttribute('inProccess');Mone.touch("follow_author");}}else{alert("An error has occurred.");obj.removeAttribute('inProccess');}}});}
Follow.ajax_logged_in_follow_new_user=function(obj,following_class_name){var user_id=obj.getAttribute('user_id');new Ajax.Request('/account/ajax_logged_in_follow_new_user',{asynchronous:true,evalScripts:true,parameters:"user_id="+user_id+"&account_followers_page="+/\/account\/followers/.test(top.location.href),onComplete:function(transport){aRes=transport.responseText.split('|');if(200==transport.status){if(aRes[0]=='failed'){alert('An error has occoured.');obj.removeAttribute('inProccess');}else{addToCookie('user_following_users',user_id);Follow.follow_all_by_user_id(obj,user_id,following_class_name);Follow.change_ff_numbers_in_page(aRes[1],'user',user_id);obj.removeAttribute('inProccess');Mone.touch("follow_user");}}else{alert("An error has occurred.");obj.removeAttribute('inProccess');}}});}
Follow.ajax_stop_follow_this_user=function(obj,follow_user_id){if(obj.getAttribute('inProccess')==null){obj.setAttribute('inProccess',true);new Ajax.Request('/account/ajax_stop_follow_this_user',{asynchronous:true,evalScripts:true,parameters:"follow_user_id="+follow_user_id,onComplete:function(transport){if(200==transport.status){aRes=transport.responseText.split('|');if(aRes[0]=='failed'){alert('An error has occoured.');obj.removeAttribute('inProccess');}else{$('follow_this_user').innerHTML="";$('follow_this_user').appendChild(Follow.follow_this_user(follow_user_id,"follow","following"));Follow.display_no_longer_follow_message();Follow.change_ff_numbers_in_page(aRes[1],'user',follow_user_id);obj.removeAttribute('inProccess');Mone.touch("stop_follow_user");}}else{alert("An error has occurred.");obj.removeAttribute('inProccess');}}});}}
Follow.ajax_stop_follow_this_author=function(obj,author_slug){if(obj.getAttribute('inProccess')==null){obj.setAttribute('inProccess',true);new Ajax.Request('/account/ajax_stop_follow_this_author',{asynchronous:true,evalScripts:true,parameters:"author_slug="+author_slug,onComplete:function(transport){if(200==transport.status){aRes=transport.responseText.split('|');if(aRes[0]=='failed'){alert('An error has occoured.');obj.removeAttribute('inProccess');}else{$('follow_this_user').innerHTML="";$('follow_this_user').appendChild(Follow.follow_this_author(author_slug,"follow","following"));Follow.display_no_longer_follow_message();obj.removeAttribute('inProccess');Follow.change_ff_numbers_in_page(aRes[1],'author',author_slug);Mone.touch("stop_follow_author");}}else{alert("An error has occurred.");obj.removeAttribute('inProccess');}}});}}
Follow.change_ff_numbers_in_page=function(ff_numbers,type,id){var ff_numbers=ff_numbers.split(",");reg=new RegExp(type+"\\/(.*?)(\\/|\\?|$)");reg.test(top.location.href)
if((RegExp.$1==id)||(/account/.test(top.location.href))){$$('.followers_number').each(function(obj){obj.innerHTML=SeparatorNumber(ff_numbers[0])});$$('.following_number').each(function(obj){obj.innerHTML=SeparatorNumber(ff_numbers[1])});}
if($('follow_numbers_top_'+id))$('follow_numbers_top_'+id).innerHTML=SeparatorNumber(ff_numbers[0]);if($('follow_numbers_fastest_climbers_'+id))$('follow_numbers_fastest_climbers_'+id).innerHTML=($('follow_numbers_fastest_climbers_'+id).innerHTML*1)+1;if($('follow_numbers_symbol_'+id))$('follow_numbers_symbol_'+id).innerHTML='('+SeparatorNumber(ff_numbers[0])+' follower'+(ff_numbers[0]>1?'s':'')+')';if($$('.followers_number_'+id)){$$('.followers_number_'+id).each(function(obj){obj.innerHTML=SeparatorNumber(ff_numbers[0])});$$('.following_number_'+id).each(function(obj){obj.innerHTML=SeparatorNumber(ff_numbers[1])});}}
Follow.stop_follow_mouseover=function(obj){obj.style.display='block';clearTimeout(gTimeout);}
Follow.stop_follow_mouseout=function(){gTimeout=setTimeout(function(){$('stop_follow').style.display='none';},400);}
Follow.display_no_longer_follow_message=function(){$('stop_follow').style.display="none"
$('no_longer_follow').style.display="block"}
Follow.ForgotPassword=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login'>");aHtml.push("<div class='email_sent'><h4>Email sent!</h4><div>We've sent instructions on how to reset your password to your email inbox.<br/>If you can't find it, please check your spam filter.</div></div>");aHtml.push("<div class='close_quickread_stretchable' onclick='AlphaBox.Close();'><span class='close_left'></span><span class='close_text'>Close</span><span class='close_right'></span></div>");aHtml.push("<br class='cleaner'/></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};}
Follow.Register=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>Please confirm your registration by clicking the link in the email we've sent to "+registered_mail+".</h3>");aHtml.push("<div class='cant_see_note'>(If you can't see it, please check your junk mail folder)</div>");aHtml.push("</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};}
Follow.RegisterBox=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>Please confirm your registration by clicking the link in the email we've sent to "+registered_mail+".</h3>");aHtml.push("<div class='cant_see_note'>(If you can't see it, please check your junk mail folder)</div>");aHtml.push("</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};$("register_box").innerHTML='';}
Follow.setFfToElements=function(e1,e2,uId){new Ajax.Request('/memcached/count_author_ff/'+uId,{method:'get',onSuccess:function(response){if(e1)e1.innerHTML=SeparatorNumber(response.responseText.split(",")[0]);if(e2)e2.innerHTML=SeparatorNumber(response.responseText.split(",")[1]);},onFailure:function(){}});}
Follow.Login=function(Id){window.location.href=window.location.href;}
String.prototype.parseColor=function(){var color='#';if(this.slice(0,4)=='rgb('){var cols=this.slice(4,this.length-1).split(',');var i=0;do{color+=parseInt(cols[i]).toColorPart()}while(++i<3);}else{if(this.slice(0,1)=='#'){if(this.length==4)for(var i=1;i<4;i++)color+=(this.charAt(i)+this.charAt(i)).toLowerCase();if(this.length==7)color=this.toLowerCase();}}
return(color.length==7?color:(arguments[0]||this));};Element.collectTextNodes=function(element){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:(node.hasChildNodes()?Element.collectTextNodes(node):''));}).flatten().join('');};Element.collectTextNodesIgnoreClass=function(element,className){return $A($(element).childNodes).collect(function(node){return(node.nodeType==3?node.nodeValue:((node.hasChildNodes()&&!Element.hasClassName(node,className))?Element.collectTextNodesIgnoreClass(node,className):''));}).flatten().join('');};Element.setContentZoom=function(element,percent){element=$(element);element.setStyle({fontSize:(percent/100)+'em'});if(Prototype.Browser.WebKit)window.scrollBy(0,0);return element;};Element.getInlineOpacity=function(element){return $(element).style.opacity||'';};Element.forceRerendering=function(element){try{element=$(element);var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}};var Effect={_elementDoesNotExistError:{name:'ElementDoesNotExistError',message:'The specified DOM element does not exist, but is required for this effect to operate'},Transitions:{linear:Prototype.K,sinoidal:function(pos){return(-Math.cos(pos*Math.PI)/2)+.5;},reverse:function(pos){return 1-pos;},flicker:function(pos){var pos=((-Math.cos(pos*Math.PI)/4)+.75)+Math.random()/4;return pos>1?1:pos;},wobble:function(pos){return(-Math.cos(pos*Math.PI*(9*pos))/2)+.5;},pulse:function(pos,pulses){return(-Math.cos((pos*((pulses||5)-.5)*2)*Math.PI)/2)+.5;},spring:function(pos){return 1-(Math.cos(pos*4.5*Math.PI)*Math.exp(-pos*6));},none:function(pos){return 0;},full:function(pos){return 1;}},DefaultOptions:{duration:1.0,fps:100,sync:false,from:0.0,to:1.0,delay:0.0,queue:'parallel'},tagifyText:function(element){var tagifyStyle='position:relative';if(Prototype.Browser.IE)tagifyStyle+=';zoom:1';element=$(element);$A(element.childNodes).each(function(child){if(child.nodeType==3){child.nodeValue.toArray().each(function(character){element.insertBefore(new Element('span',{style:tagifyStyle}).update(character==' '?String.fromCharCode(160):character),child);});Element.remove(child);}});},multiple:function(element,effect){var elements;if(((typeof element=='object')||Object.isFunction(element))&&(element.length))
elements=element;else
elements=$(element).childNodes;var options=Object.extend({speed:0.1,delay:0.0},arguments[2]||{});var masterDelay=options.delay;$A(elements).each(function(element,index){new effect(element,Object.extend(options,{delay:index*options.speed+masterDelay}));});},PAIRS:{'slide':['SlideDown','SlideUp'],'blind':['BlindDown','BlindUp'],'appear':['Appear','Fade']},toggle:function(element,effect,options){element=$(element);effect=(effect||'appear').toLowerCase();return Effect[Effect.PAIRS[effect][element.visible()?1:0]](element,Object.extend({queue:{position:'end',scope:(element.id||'global'),limit:1}},options||{}));}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(iterator){this.effects._each(iterator);},add:function(effect){var timestamp=new Date().getTime();var position=Object.isString(effect.options.queue)?effect.options.queue:effect.options.queue.position;switch(position){case'front':this.effects.findAll(function(e){return e.state=='idle'}).each(function(e){e.startOn+=effect.finishOn;e.finishOn+=effect.finishOn;});break;case'with-last':timestamp=this.effects.pluck('startOn').max()||timestamp;break;case'end':timestamp=this.effects.pluck('finishOn').max()||timestamp;break;}
effect.startOn+=timestamp;effect.finishOn+=timestamp;if(!effect.options.queue.limit||(this.effects.length<effect.options.queue.limit))
this.effects.push(effect);if(!this.interval)
this.interval=setInterval(this.loop.bind(this),15);},remove:function(effect){this.effects=this.effects.reject(function(e){return e==effect});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var timePos=new Date().getTime();for(var i=0,len=this.effects.length;i<len;i++)
this.effects[i]&&this.effects[i].loop(timePos);}});Effect.Queues={instances:$H(),get:function(queueName){if(!Object.isString(queueName))return queueName;return this.instances.get(queueName)||this.instances.set(queueName,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get('global');Effect.Base=Class.create({position:null,start:function(options){if(options&&options.transition===false)options.transition=Effect.Transitions.linear;this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state='idle';this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function dispatch(effect,eventName){if(effect.options[eventName+'Internal'])
effect.options[eventName+'Internal'](effect);if(effect.options[eventName])
effect.options[eventName](effect);}
return function(pos){if(this.state==="idle"){this.state="running";dispatch(this,'beforeSetup');if(this.setup)this.setup();dispatch(this,'afterSetup');}
if(this.state==="running"){pos=(this.options.transition(pos)*this.fromToDelta)+this.options.from;this.position=pos;dispatch(this,'beforeUpdate');if(this.update)this.update(pos);dispatch(this,'afterUpdate');}};})();this.event('beforeStart');if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).add(this);},loop:function(timePos){if(timePos>=this.startOn){if(timePos>=this.finishOn){this.render(1.0);this.cancel();this.event('beforeFinish');if(this.finish)this.finish();this.event('afterFinish');return;}
var pos=(timePos-this.startOn)/this.totalTime,frame=(pos*this.totalFrames).round();if(frame>this.currentFrame){this.render(pos);this.currentFrame=frame;}}},cancel:function(){if(!this.options.sync)
Effect.Queues.get(Object.isString(this.options.queue)?'global':this.options.queue.scope).remove(this);this.state='finished';},event:function(eventName){if(this.options[eventName+'Internal'])this.options[eventName+'Internal'](this);if(this.options[eventName])this.options[eventName](this);},inspect:function(){var data=$H();for(property in this)
if(!Object.isFunction(this[property]))data.set(property,this[property]);return'#<Effect:'+data.inspect()+',options:'+$H(this.options).inspect()+'>';}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(effects){this.effects=effects||[];this.start(arguments[1]);},update:function(position){this.effects.invoke('render',position);},finish:function(position){this.effects.each(function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');if(effect.finish)effect.finish(position);effect.event('afterFinish');});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(object,from,to){object=Object.isString(object)?$(object):object;var args=$A(arguments),method=args.last(),options=args.length==5?args[3]:null;this.method=Object.isFunction(method)?method.bind(object):Object.isFunction(object[method])?object[method].bind(object):function(value){object[method]=value};this.start(Object.extend({from:from,to:to},options||{}));},update:function(position){this.method(position);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});var options=Object.extend({from:this.element.getOpacity()||0.0,to:1.0},arguments[1]||{});this.start(options);},update:function(position){this.element.setOpacity(position);}});Effect.Move=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({x:0,y:0,mode:'relative'},arguments[1]||{});this.start(options);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle('left')||'0');this.originalTop=parseFloat(this.element.getStyle('top')||'0');if(this.options.mode=='absolute'){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(position){this.element.setStyle({left:(this.options.x*position+this.originalLeft).round()+'px',top:(this.options.y*position+this.originalTop).round()+'px'});}});Effect.MoveBy=function(element,toTop,toLeft){return new Effect.Move(element,Object.extend({x:toLeft,y:toTop},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(element,percent){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:'box',scaleFrom:100.0,scaleTo:percent},arguments[2]||{});this.start(options);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle('position');this.originalStyle={};['top','left','width','height','fontSize'].each(function(k){this.originalStyle[k]=this.element.style[k];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var fontSize=this.element.getStyle('font-size')||'100%';['em','px','%','pt'].each(function(fontSizeType){if(fontSize.indexOf(fontSizeType)>0){this.fontSize=parseFloat(fontSize);this.fontSizeType=fontSizeType;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=='box')
this.dims=[this.element.offsetHeight,this.element.offsetWidth];if(/^content/.test(this.options.scaleMode))
this.dims=[this.element.scrollHeight,this.element.scrollWidth];if(!this.dims)
this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];},update:function(position){var currentScale=(this.options.scaleFrom/100.0)+(this.factor*position);if(this.options.scaleContent&&this.fontSize)
this.element.setStyle({fontSize:this.fontSize*currentScale+this.fontSizeType});this.setDimensions(this.dims[0]*currentScale,this.dims[1]*currentScale);},finish:function(position){if(this.restoreAfterFinish)this.element.setStyle(this.originalStyle);},setDimensions:function(height,width){var d={};if(this.options.scaleX)d.width=width.round()+'px';if(this.options.scaleY)d.height=height.round()+'px';if(this.options.scaleFromCenter){var topd=(height-this.dims[0])/2;var leftd=(width-this.dims[1])/2;if(this.elementPositioning=='absolute'){if(this.options.scaleY)d.top=this.originalTop-topd+'px';if(this.options.scaleX)d.left=this.originalLeft-leftd+'px';}else{if(this.options.scaleY)d.top=-topd+'px';if(this.options.scaleX)d.left=-leftd+'px';}}
this.element.setStyle(d);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({startcolor:'#ffff99'},arguments[1]||{});this.start(options);},setup:function(){if(this.element.getStyle('display')=='none'){this.cancel();return;}
this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle('background-image');this.element.setStyle({backgroundImage:'none'});}
if(!this.options.endcolor)
this.options.endcolor=this.element.getStyle('background-color').parseColor('#ffffff');if(!this.options.restorecolor)
this.options.restorecolor=this.element.getStyle('background-color');this._base=$R(0,2).map(function(i){return parseInt(this.options.startcolor.slice(i*2+1,i*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(i){return parseInt(this.options.endcolor.slice(i*2+1,i*2+3),16)-this._base[i]}.bind(this));},update:function(position){this.element.setStyle({backgroundColor:$R(0,2).inject('#',function(m,v,i){return m+((this._base[i]+(this._delta[i]*position)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(element){var options=arguments[1]||{},scrollOffsets=document.viewport.getScrollOffsets(),elementOffsets=$(element).cumulativeOffset();if(options.offset)elementOffsets[1]+=options.offset;return new Effect.Tween(null,scrollOffsets.top,elementOffsets[1],options,function(p){scrollTo(scrollOffsets.left,p.round());});};Effect.Fade=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();var options=Object.extend({from:element.getOpacity()||1.0,to:0.0,afterFinishInternal:function(effect){if(effect.options.to!=0)return;effect.element.hide().setStyle({opacity:oldOpacity});}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Appear=function(element){element=$(element);var options=Object.extend({from:(element.getStyle('display')=='none'?0.0:element.getOpacity()||0.0),to:1.0,afterFinishInternal:function(effect){effect.element.forceRerendering();},beforeSetup:function(effect){effect.element.setOpacity(effect.options.from).show();}},arguments[1]||{});return new Effect.Opacity(element,options);};Effect.Puff=function(element){element=$(element);var oldStyle={opacity:element.getInlineOpacity(),position:element.getStyle('position'),top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};return new Effect.Parallel([new Effect.Scale(element,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:1.0,beforeSetupInternal:function(effect){Position.absolutize(effect.effects[0].element);},afterFinishInternal:function(effect){effect.effects[0].element.hide().setStyle(oldStyle);}},arguments[1]||{}));};Effect.BlindUp=function(element){element=$(element);element.makeClipping();return new Effect.Scale(element,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(effect){effect.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(element){element=$(element);var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makeClipping().setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(element){element=$(element);var oldOpacity=element.getInlineOpacity();return new Effect.Appear(element,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(effect){new Effect.Scale(effect.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned().setStyle({opacity:oldOpacity});}});}},arguments[1]||{}));};Effect.DropOut=function(element){element=$(element);var oldStyle={top:element.getStyle('top'),left:element.getStyle('left'),opacity:element.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(element,{x:0,y:100,sync:true}),new Effect.Opacity(element,{sync:true,to:0.0})],Object.extend({duration:0.5,beforeSetup:function(effect){effect.effects[0].element.makePositioned();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoPositioned().setStyle(oldStyle);}},arguments[1]||{}));};Effect.Shake=function(element){element=$(element);var options=Object.extend({distance:20,duration:0.5},arguments[1]||{});var distance=parseFloat(options.distance);var split=parseFloat(options.duration)/10.0;var oldStyle={top:element.getStyle('top'),left:element.getStyle('left')};return new Effect.Move(element,{x:distance,y:0,duration:split,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:distance*2,y:0,duration:split*2,afterFinishInternal:function(effect){new Effect.Move(effect.element,{x:-distance,y:0,duration:split,afterFinishInternal:function(effect){effect.element.undoPositioned().setStyle(oldStyle);}});}});}});}});}});}});};Effect.SlideDown=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().setStyle({height:'0px'}).show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.SlideUp=function(element){element=$(element).cleanWhitespace();var oldInnerBottom=element.down().getStyle('bottom');var elementDimensions=element.getDimensions();return new Effect.Scale(element,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:'box',scaleFrom:100,scaleMode:{originalHeight:elementDimensions.height,originalWidth:elementDimensions.width},restoreAfterFinish:true,afterSetup:function(effect){effect.element.makePositioned();effect.element.down().makePositioned();if(window.opera)effect.element.setStyle({top:''});effect.element.makeClipping().show();},afterUpdateInternal:function(effect){effect.element.down().setStyle({bottom:(effect.dims[0]-effect.element.clientHeight)+'px'});},afterFinishInternal:function(effect){effect.element.hide().undoClipping().undoPositioned();effect.element.down().undoPositioned().setStyle({bottom:oldInnerBottom});}},arguments[1]||{}));};Effect.Squish=function(element){return new Effect.Scale(element,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(effect){effect.element.makeClipping();},afterFinishInternal:function(effect){effect.element.hide().undoClipping();}});};Effect.Grow=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top-left':initialMoveX=initialMoveY=moveX=moveY=0;break;case'top-right':initialMoveX=dims.width;initialMoveY=moveY=0;moveX=-dims.width;break;case'bottom-left':initialMoveX=moveX=0;initialMoveY=dims.height;moveY=-dims.height;break;case'bottom-right':initialMoveX=dims.width;initialMoveY=dims.height;moveX=-dims.width;moveY=-dims.height;break;case'center':initialMoveX=dims.width/2;initialMoveY=dims.height/2;moveX=-dims.width/2;moveY=-dims.height/2;break;}
return new Effect.Move(element,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(effect){new Effect.Parallel([new Effect.Opacity(effect.element,{sync:true,to:1.0,from:0.0,transition:options.opacityTransition}),new Effect.Move(effect.element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition}),new Effect.Scale(effect.element,100,{scaleMode:{originalHeight:dims.height,originalWidth:dims.width},sync:true,scaleFrom:window.opera?1:0,transition:options.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(effect){effect.effects[0].element.setStyle({height:'0px'}).show();},afterFinishInternal:function(effect){effect.effects[0].element.undoClipping().undoPositioned().setStyle(oldStyle);}},options));}});};Effect.Shrink=function(element){element=$(element);var options=Object.extend({direction:'center',moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var oldStyle={top:element.style.top,left:element.style.left,height:element.style.height,width:element.style.width,opacity:element.getInlineOpacity()};var dims=element.getDimensions();var moveX,moveY;switch(options.direction){case'top-left':moveX=moveY=0;break;case'top-right':moveX=dims.width;moveY=0;break;case'bottom-left':moveX=0;moveY=dims.height;break;case'bottom-right':moveX=dims.width;moveY=dims.height;break;case'center':moveX=dims.width/2;moveY=dims.height/2;break;}
return new Effect.Parallel([new Effect.Opacity(element,{sync:true,to:0.0,from:1.0,transition:options.opacityTransition}),new Effect.Scale(element,window.opera?1:0,{sync:true,transition:options.scaleTransition,restoreAfterFinish:true}),new Effect.Move(element,{x:moveX,y:moveY,sync:true,transition:options.moveTransition})],Object.extend({beforeStartInternal:function(effect){effect.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(effect){effect.effects[0].element.hide().undoClipping().undoPositioned().setStyle(oldStyle);}},options));};Effect.Pulsate=function(element){element=$(element);var options=arguments[1]||{},oldOpacity=element.getInlineOpacity(),transition=options.transition||Effect.Transitions.linear,reverser=function(pos){return 1-transition((-Math.cos((pos*(options.pulses||5)*2)*Math.PI)/2)+.5);};return new Effect.Opacity(element,Object.extend(Object.extend({duration:2.0,from:0,afterFinishInternal:function(effect){effect.element.setStyle({opacity:oldOpacity});}},options),{transition:reverser}));};Effect.Fold=function(element){element=$(element);var oldStyle={top:element.style.top,left:element.style.left,width:element.style.width,height:element.style.height};element.makeClipping();return new Effect.Scale(element,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(effect){new Effect.Scale(element,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(effect){effect.element.hide().undoClipping().setStyle(oldStyle);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(element){this.element=$(element);if(!this.element)throw(Effect._elementDoesNotExistError);var options=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(options.style))this.style=$H(options.style);else{if(options.style.include(':'))
this.style=options.style.parseStyle();else{this.element.addClassName(options.style);this.style=$H(this.element.getStyles());this.element.removeClassName(options.style);var css=this.element.getStyles();this.style=this.style.reject(function(style){return style.value==css[style.key];});options.afterFinishInternal=function(effect){effect.element.addClassName(effect.options.style);effect.transforms.each(function(transform){effect.element.style[transform.style]='';});};}}
this.start(options);},setup:function(){function parseColor(color){if(!color||['rgba(0, 0, 0, 0)','transparent'].include(color))color='#ffffff';color=color.parseColor();return $R(0,2).map(function(i){return parseInt(color.slice(i*2+1,i*2+3),16);});}
this.transforms=this.style.map(function(pair){var property=pair[0],value=pair[1],unit=null;if(value.parseColor('#zzzzzz')!='#zzzzzz'){value=value.parseColor();unit='color';}else if(property=='opacity'){value=parseFloat(value);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout))
this.element.setStyle({zoom:1});}else if(Element.CSS_LENGTH.test(value)){var components=value.match(/^([\+\-]?[0-9\.]+)(.*)$/);value=parseFloat(components[1]);unit=(components.length==3)?components[2]:null;}
var originalValue=this.element.getStyle(property);return{style:property.camelize(),originalValue:unit=='color'?parseColor(originalValue):parseFloat(originalValue||0),targetValue:unit=='color'?parseColor(value):value,unit:unit};}.bind(this)).reject(function(transform){return((transform.originalValue==transform.targetValue)||(transform.unit!='color'&&(isNaN(transform.originalValue)||isNaN(transform.targetValue))));});},update:function(position){var style={},transform,i=this.transforms.length;while(i--)
style[(transform=this.transforms[i]).style]=transform.unit=='color'?'#'+
(Math.round(transform.originalValue[0]+
(transform.targetValue[0]-transform.originalValue[0])*position)).toColorPart()+
(Math.round(transform.originalValue[1]+
(transform.targetValue[1]-transform.originalValue[1])*position)).toColorPart()+
(Math.round(transform.originalValue[2]+
(transform.targetValue[2]-transform.originalValue[2])*position)).toColorPart():(transform.originalValue+
(transform.targetValue-transform.originalValue)*position).toFixed(3)+
(transform.unit===null?'':transform.unit);this.element.setStyle(style,true);}});Effect.Transform=Class.create({initialize:function(tracks){this.tracks=[];this.options=arguments[1]||{};this.addTracks(tracks);},addTracks:function(tracks){tracks.each(function(track){track=$H(track);var data=track.values().first();this.tracks.push($H({ids:track.keys().first(),effect:Effect.Morph,options:{style:data}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(track){var ids=track.get('ids'),effect=track.get('effect'),options=track.get('options');var elements=[$(ids)||$$(ids)].flatten();return elements.map(function(e){return new effect(e,Object.extend({sync:true},options))});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w('backgroundColor backgroundPosition borderBottomColor borderBottomStyle '+'borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth '+'borderRightColor borderRightStyle borderRightWidth borderSpacing '+'borderTopColor borderTopStyle borderTopWidth bottom clip color '+'fontSize fontWeight height left letterSpacing lineHeight '+'marginBottom marginLeft marginRight marginTop markerOffset maxHeight '+'maxWidth minHeight minWidth opacity outlineColor outlineOffset '+'outlineWidth paddingBottom paddingLeft paddingRight paddingTop '+'right textIndent top width wordSpacing zIndex');Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement('div');String.prototype.parseStyle=function(){var style,styleRules=$H();if(Prototype.Browser.WebKit)
style=new Element('div',{style:this}).style;else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';style=String.__parseStyleElement.childNodes[0].style;}
Element.CSS_PROPERTIES.each(function(property){if(style[property])styleRules.set(property,style[property]);});if(Prototype.Browser.IE&&this.include('opacity'))
styleRules.set('opacity',this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);return styleRules;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(element){var css=document.defaultView.getComputedStyle($(element),null);return Element.CSS_PROPERTIES.inject({},function(styles,property){styles[property]=css[property];return styles;});};}else{Element.getStyles=function(element){element=$(element);var css=element.currentStyle,styles;styles=Element.CSS_PROPERTIES.inject({},function(results,property){results[property]=css[property];return results;});if(!styles.opacity)styles.opacity=element.getOpacity();return styles;};}
Effect.Methods={morph:function(element,style){element=$(element);new Effect.Morph(element,Object.extend({style:style},arguments[2]||{}));return element;},visualEffect:function(element,effect,options){element=$(element);var s=effect.dasherize().camelize(),klass=s.charAt(0).toUpperCase()+s.substring(1);new Effect[klass](element,options);return element;},highlight:function(element,options){element=$(element);new Effect.Highlight(element,options);return element;}};$w('fade appear grow shrink fold blindUp blindDown slideUp slideDown '+'pulsate shake puff squish switchOff dropOut').each(function(effect){Effect.Methods[effect]=function(element,options){element=$(element);Effect[effect.charAt(0).toUpperCase()+effect.substring(1)](element,options);return element;};});$w('getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles').each(function(f){Effect.Methods[f]=Element[f];});Element.addMethods(Effect.Methods);var AlphaBox={options:{},show_appear_effects:true,Overlay:function(){var oDialog=$('alphabox-modal-overlay')||$(new Insertion.Top(document.body,this.OverlayHtml()).firstChild);$('alphabox-modal-loading').setStyle({'display':'block'});if(this.show_appear_effects){new Effect.Appear(oDialog,{duration:0.4,from:0.0,to:0.6,queue:{position:'end',scope:'alphabox'}});}else{oDialog.setStyle({'display':'block'});}
if(this.options.absolute)oDialog.setStyle({position:'absolute'});},OverlayHtml:function(){var aParams=['id="alphabox-modal-overlay"','class="alphabox-preload-modal"','allowTransparency="true"','frameborder="0"','style="display:none;"','onload="this.contentWindow.document.body.style.backgroundColor=\'transparent\';this.contentWindow.document.onclick=function () { AlphaBox.Close(); }"'];return'<iframe '+aParams.join(' ')+'>';},Loading:function(options){this.options=options||{};if(oRefresher)oRefresher.Clear();this.onAfterClose=this.options.onAfterClose;this.onBeforeClose=this.options.onBeforeClose;try{if(!SA.Utils.Env.isFixeSupport)this.options.absolute=true;}catch(e){}
var _Loading=$('alphabox-modal-loading'),oLoading=$(!_Loading?new Insertion.Top(document.body,this.LoadingHtml()).firstChild:_Loading);var top=(document.viewport.getHeight()-oLoading.getDimensions().height)/2+(this.options.absolute?document.viewport.getScrollOffsets().top:0);oLoading.setStyle({top:top+'px',left:(document.viewport.getWidth()-oLoading.getDimensions().width)/2+'px'});if(this.options.absolute)oLoading.setStyle({position:'absolute'});if(!this.resizeEventSet){Event.observe(window,'resize',function(){AlphaBox.ResetPosition()});this.resizeEventSet=true;}
this.WindowReset();this.Overlay();this.isOpen=true;},LoadingHtml:function(){var aParams=['id="alphabox-modal-loading"','class="alphabox-preload-loading"'];return'<div '+aParams.join(' ')+'>';},LoadingHide:function(){$('alphabox-modal-loading').setStyle({'display':'none'});},Window:function(e){var _Window=$('alphabox-modal-window'),oWindow=$(!_Window?new Insertion.Top(document.body,this.WindowHtml()).firstChild:_Window);while(oWindow.hasChildNodes()){oWindow.removeChild(oWindow.firstChild);}
return oWindow;},WindowHtml:function(){var aParams=['id="alphabox-modal-window"','class="alphabox-window"','style="display:none;"'];return'<div '+aParams.join(' ')+'>';},WindowReset:function(){var oWindow=$('alphabox-modal-window');if(oWindow)oWindow.update('').setStyle({'display':'none'});},AddContent:function(container,options){var oContent=$(container),oWindow=this.Window();if(options)for(var i in options)this.options[i]=options[i];this.LoadingHide();oWindow.setStyle({'display':'none'});while(oContent.hasChildNodes()){oWindow.appendChild(oContent.firstChild);}
if(this.show_appear_effects){new Effect.Appear(oWindow,{duration:0.4,from:0.0,to:1.0,queue:{position:'end',scope:'alphabox'},afterFinish:(this.options.onFinish||(function(){}))});}else{oWindow.setStyle({'display':'block'});}
this.ResetPosition();},ResetPosition:function(options){var oWindow=$('alphabox-modal-window');if(!oWindow)return;if(options)for(var i in options)this.options[i]=options[i];options=this.options;var top_margin,left_margin;if(options.top!=undefined)top_margin=options.top;else top_margin=(document.viewport.getHeight()-oWindow.getDimensions().height)/2+(options.absolute?document.viewport.getScrollOffsets().top:0);if(options.left!=undefined)left_margin=options.left;else left_margin=(document.viewport.getWidth()-oWindow.getDimensions().width)/2;oWindow.setStyle({top:(top_margin<0?0:top_margin+'px'),left:(left_margin<0?0:left_margin+'px')});if(options.absolute)oWindow.setStyle({position:'absolute'});},AddHtml:function(sHtml,options){var oWindow=this.Window();if(options)for(var i in options)this.options[i]=options[i];this.LoadingHide();oWindow.setStyle({'display':'none'});oWindow.update(sHtml);if(this.show_appear_effects)new Effect.Appear(oWindow,{duration:0.4,from:0.0,to:1.0,queue:{position:'end',scope:'alphabox'},afterFinish:(this.options.onFinish||(function(){}))});else oWindow.setStyle({'display':'block'});this.ResetPosition();},Close:function(){if(this.onBeforeClose){if(typeof(this.onBeforeClose)=='function'){if(this.onBeforeClose()===false)return;}else if(eval(this.onBeforeClose)===false)return;}
if(oRefresher)oRefresher.Activate();$('alphabox-modal-loading').setStyle({'display':'none'});if(this.show_appear_effects){if($('alphabox-modal-overlay'))new Effect.Fade('alphabox-modal-overlay',{duration:0.4});if($('alphabox-modal-window'))new Effect.Fade('alphabox-modal-window',{duration:0.4});}else{if($('alphabox-modal-overlay'))$('alphabox-modal-overlay').setStyle({'display':'none'});if($('alphabox-modal-window'))$('alphabox-modal-window').setStyle({'display':'none'});}
this.isOpen=false;if(this.onAfterClose){if(typeof(this.onAfterClose)=='function')this.onAfterClose();else eval(this.onAfterClose);}},CloseEsc:function(e){var iKey=window.event?event.keyCode:e.keyCode,iEsc=window.event?27:e.DOM_VK_ESCAPE;if(iKey==iEsc&&AlphaBox.isOpen){AlphaBox.Close();if(oRefresher){oRefresher.Activate()};window.event?event.returnValue=false:e.preventDefault();}},PageLoad:function(){this.PageLoaded=true;clearInterval(this.OverlayInterval);}}
var LightBox={Images:{Close:'http://static.seekingalpha.com/images/close.gif'},Init:function(){var aLightBoxes=[];$$('a').each(function(item){if(item.rel&&item.rel=="lightbox"){aLightBoxes.push(item);}})
aLightBoxes.each(function(oLink){if(oLink.href)oLink.onclick=function(){LightBox.Click.call(LightBox,this.href);return false;}});},LoadImage:function(sImg){var oImg=document.createElement('img');oImg.onload=function(){this.Envelope(oImg);}.bind(this);oImg.src=sImg;},Envelope:function(oImg){var oContainer=document.createElement('div'),oLightBox=document.createElement('div'),oCloseBtn=document.createElement('div'),oCloseLinkCont=document.createElement('div'),oCloseLink=document.createElement('span'),aHtml=[];oContainer.appendChild(oLightBox);oLightBox.appendChild(oImg);oLightBox.className="alpha_lightbox";oCloseBtn.className="close_button";oCloseBtn.onmouseover=function(){$(this).addClassName('close_button_over')};oCloseBtn.onmouseout=function(){$(this).removeClassName('close_button_over')};oCloseBtn.onclick=function(){AlphaBox.Close();};oLightBox.appendChild(oCloseBtn);oCloseLinkCont.className="close_link_cont";oLightBox.appendChild(oCloseLinkCont);oCloseLink.innerHTML='close window';oCloseLink.className='close_link';oCloseLink.onmouseover=function(){$(this).addClassName('close_link_over')};oCloseLink.onmouseout=function(){$(this).removeClassName('close_link_over')};oCloseLink.onclick=function(){AlphaBox.Close();};oCloseLinkCont.appendChild(oCloseLink);AlphaBox.AddContent(oContainer);},Click:function(sImg){AlphaBox.Loading();this.LoadImage(sImg);}}
Event.observe(document,'keydown',AlphaBox.CloseEsc.bind(AlphaBox));Event.observe(window,'load',AlphaBox.PageLoad.bind(AlphaBox));var RedBox={};RedBox.loading=AlphaBox.Loading;RedBox.addHiddenContent=AlphaBox.AddContent;RedBox.close=AlphaBox.Close;function toRx(s){return s.replace(/\\/gi,"\\\\").replace(/(\(|\)|\{|\}|\[|\]|\:|\^|\$|\!|\=|\+|\*|\/|\,|\-|\||\?|\.)/g,"\\$1");}
function toJs(s){return s.replace(/\\/g,"\\\\").replace(/\'/g,"\\\'").replace(/\"/g,"\\\"").replace(/\//g,"\/").replace(/\t/g,"\\t").replace(/\r?\n/g,"\\n");}
if(typeof(contacts)=='undefined'){var contacts="";}
if(typeof(authors)=='undefined'){var authors="";}
var AutoCompleteSAConfig={JavascriptLoaded:false,LoadingInstance:null,LoadJavascript:function(Instance){this.Packages[Instance].LoadingMessage();this.LoadingInstance=Instance;},Init:function(){authors.replace(/\&\#038\;/g,"&").replace(/\&amp\;/g,"&");symbols="<"+symbols.replace(/</g,'<<')+"<";authors="<"+authors.replace(/</g,'<<')+"<";contacts="<"+contacts.replace(/</g,'<<')+"<";this.JavascriptLoaded=true;SeekingAlpha.Initializer.RunAfterAutoCompleteLoaded();if(this.LoadingInstance)this.Packages[this.LoadingInstance].SearchAndDisplay();},Load:function(Instance,Params){this.Packages[Instance]=new AutoCompleteSA(Instance,Params);this.Packages[Instance].Init();return this.Packages[Instance];},Create:function(Instance,Params){this.Packages[Instance]=new AutoCompleteSA(Instance,Params);return this.Packages[Instance].CreateAutoCompleteHtml();},Packages:{},Route:function(Instance,sFunction,aArguments){var oPackage=this.Packages[Instance],oFunction=oPackage[sFunction],aArguments=aArguments||[];oFunction.apply(oPackage,aArguments);}};function AutoCompleteSA(Instance,Params){var _this=this;this.Params=Params||{};this.Params.Symbols=this.Params.Symbols!=null?this.Params.Symbols:true;this.Params.Contacts=this.Params.Contacts!=null?this.Params.Contacts:false;this.Params.Authors=this.Params.Authors!=null?this.Params.Authors:true;this.Params.Input=this.Params.Input!=null?this.Params.Input:null;this.Params.WriteToDocument=this.Params.WriteToDocument!=null?this.Params.WriteToDocument:true;this.Params.IframeCover=this.Params.IframeCover!=null?this.Params.IframeCover:false;this.Params.Ad=this.Params.Ad!=null?this.Params.Ad:false;this.Params.MultipleInsert=this.Params.MultipleInsert!=null?this.Params.MultipleInsert:false;this.Params.AutoInsert=this.Params.AutoInsert!=null?this.Params.AutoInsert:false;this.Params.LoadSearch=this.Params.LoadSearch!=null?this.Params.LoadSearch:false;this.Params.AfterInit=this.Params.AfterInit!=null?this.Params.AfterInit:null;this.Params.AfterInsert=this.Params.AfterInsert!=null?this.Params.AfterInsert:null;this.Params.AfterSubmit=this.Params.AfterSubmit!=null?this.Params.AfterSubmit:null;this.Instance=Instance;this.Input=this.Params.Input||'autocomplete_sa_'+this.Instance;this.State='close';this.CurrentResults=0;this.LastIndex=0;this.Timeout=null;this.active=true;this.Init=function(){if(this.Params.AddAfterInput)this.Params.WriteToDocument=false;var html=this.CreateAutoCompleteHtml();if(this.Params.AddAfterInput){var div=document.createElement('div'),input=$(this.Input);div.className="autocomp_container";input.parentNode.insertBefore(div,input.nextSibling);div.innerHTML=html;}
if(this.Params.LoadSearch)this.LoadSearchFromUrl();if(this.Params.AfterInit)this.Params.AfterInit.call(this);$(this.Input).observe('keydown',function(){_this.KEYPRESS.apply(_this,arguments);});$(this.Input).observe('keyup',function(){_this.KEYUP.apply(_this,arguments);});Event.observe(document.body,'click',function(){_this.Close.apply(_this,arguments);});}
this.KEYPRESS=function(event){var oInp=$(this.Input);switch(event.keyCode){case 9:if(this.Params.AutoInsert){if(this.State=="open")this.AutoInsert();}
if(this.State=="open")this.Close();break;case 27:setTimeout(function(){_this.Close.apply(_this,arguments)},500);break;case 38:if(this.State=="open")this.Set(this.LastIndex-1>-1?this.LastIndex-1:(this.Instance=='header'?0:(this.LastIndex==-1?this.CurrentResults-1:0)));Event.stop(event);break;case 40:if(this.State=="open")this.Set(this.LastIndex+1<this.CurrentResults?this.LastIndex+1:this.CurrentResults-1);Event.stop(event);break;case 13:if(this.Params.AutoInsert){if(this.State=="open")this.AutoInsert();}
if(this.Params.AfterSubmit){if(this.Params.MultipleInsert){if(this.State=="close")this.Params.AfterSubmit.call(this);}
else this.Params.AfterSubmit.call(this);}
if(this.State=="open")this.Close();break;}}
this.KEYUP=function(event){if(AutoCompleteSAConfig.JavascriptLoaded){if(event.keyCode!=38&&event.keyCode!=40&&event.keyCode!=13){if(this.Timeout)clearTimeout(this.Timeout);this.Timeout=setTimeout(function(){_this.SearchAndDisplay.call(_this);},300);}}
else AutoCompleteSAConfig.LoadJavascript(this.Instance);},this.MOUSEOVER=function(e){var oAutoComplete=$('autocomplete_container_sa_'+this.Instance),oLastOpt=$('sa_autocomplete_opt_'+this.Instance+'_'+this.LastIndex),index=e.getAttribute("index")*1;if(oLastOpt)oLastOpt.setStyle({backgroundColor:'#cdcdcd'});this.LastIndex=index;$(e).setStyle({backgroundColor:'#e9fcfd'});}
this.SearchAndDisplay=function(){if(this.active==false)return;var oAutoComplete=$('autocomplete_container_sa_'+this.Instance),oSymbolsBox=$('autocomplete_box_symbols_'+this.Instance),oAuthorsBox=$('autocomplete_box_authors_'+this.Instance),oContactsBox=$('autocomplete_box_contacts_'+this.Instance),oSymbolsCont=$('autocomplete_container_symbols_sa_'+this.Instance),oAuthorsCont=$('autocomplete_container_authors_sa_'+this.Instance),oContactsCont=$('autocomplete_container_contacts_sa_'+this.Instance),oIframeCover=$('autocomplete_iframe_cover_'+this.Instance),oLoadingBox=$('autocomplete_box_loading_'+this.Instance),oInput=$(this.Input),sPhrase=this.ParsePhrase(oInput.value.trim()),sSymbol,oDups={},aDisplaySymbols=[],aDisplayAuthors=[],aDisplayContacts=[],aHtmlSymbols=[],aHtmlAuthors=[],aHtmlContacts=[],aTemp,rxSymbol=/^[\w]{1,5}(?:\.[\w]{1,2})?$/i,rxSearch1,rxSearch2,rxSearch3,iMax=10,iFound=0,index=0;oAutoComplete.setStyle({display:'none'});oLoadingBox.setStyle({display:'none'});if(this.Params.Symbols)oSymbolsBox.setStyle({display:'none'});if(this.Params.Authors)oAuthorsBox.setStyle({display:'none'});if(this.Params.Contacts)oContactsBox.setStyle({display:'none'});if(this.Params.IframeCover)oIframeCover.setStyle({height:'0px',display:'none'});this.State="close";if(this.Params.Symbols)oSymbolsCont.update('');if(this.Params.Authors)oAuthorsCont.update('');if(this.Params.Contacts)oContactsCont.update('')
if(!sPhrase.length||/[<>]/.test(sPhrase))return;rxSearch1=new RegExp("<("+toRx(sPhrase)+".*?)<","gi");rxSearch2=new RegExp("<((?:[^><]+?)"+toRx(sPhrase)+"(?:[^>]*?)>(?:[^<]*?))<","gi");rxSearch3=new RegExp("<((?:[^><]*?)>(?:[^<]*?)"+toRx(sPhrase)+"(?:[^<]*?))<","gi");rxSearch4=new RegExp("<((?:[^><]*?)>"+toRx(sPhrase)+"(?:[^<]*?))<","gi");if(this.Params.Symbols){symbols.replace(rxSearch1,function(All,$1){if(aDisplaySymbols.length<10){aDisplaySymbols.push($1);}});if(aDisplaySymbols.length<10){symbols.replace(rxSearch2,function(All,$1){if(aDisplaySymbols.length<10){aDisplaySymbols.push($1);}});}
if(aDisplaySymbols.length<10){symbols.replace(rxSearch4,function(All,$1){if(aDisplaySymbols.length<10){aDisplaySymbols.push($1);}});}
if(aDisplaySymbols.length<10){symbols.replace(rxSearch3,function(All,$1){if(aDisplaySymbols.length<10){aDisplaySymbols.push($1);}});}
aDisplaySymbols=aDisplaySymbols.uniq();}
if(this.Params.Authors){authors.replace(rxSearch4,function(All,$1){if(aDisplayAuthors.length<10)aDisplayAuthors.push($1);});if(aDisplayAuthors.length<10){authors.replace(rxSearch3,function(All,$1){if(aDisplayAuthors.length<10)aDisplayAuthors.push($1);});}
aDisplayAuthors=aDisplayAuthors.uniq();}
if(this.Params.Contacts){contacts.replace(rxSearch4,function(All,$1){if(aDisplayContacts.length<10)aDisplayContacts.push($1);});if(aDisplayContacts.length<10){contacts.replace(rxSearch3,function(All,$1){if(aDisplayContacts.length<10)aDisplayContacts.push($1);});}
aDisplayContacts=aDisplayContacts.uniq();}
aTemp=aDisplayAuthors.slice(0,5);aDisplaySymbols=aDisplaySymbols.slice(0,10-aTemp.size());aDisplayContacts=aDisplayContacts.slice(0,10-aDisplaySymbols.size());if(aDisplaySymbols.size()+aTemp.size()+aDisplayContacts.size()<10)aDisplayAuthors=aDisplayAuthors.slice(0,10-aDisplaySymbols.size());else aDisplayAuthors=aTemp;if(true){aDisplaySymbols.each(function(cat){cat=cat.split(">");aHtmlSymbols.push('<div data="'+cat[0].toUpperCase()+'" id="sa_autocomplete_opt_'+_this.Instance+'_'+index+'" index="'+index+'" onmouseover="AutoCompleteSAConfig.Route(\''+_this.Instance+'\',\'MOUSEOVER\',[this])" onclick="AutoCompleteSAConfig.Route(\''+_this.Instance+'\',\'Insert\',[\''+toJs(cat[0].toUpperCase())+'\',true])"><span class="autocomplete_symbol_name">'+cat[0].toUpperCase().replace(new RegExp(toRx(sPhrase),"i"),'<b>'+sPhrase.toUpperCase()+'</b>')+'</span><span class="autocomplete_symbol_description">'+(new RegExp(toRx(sPhrase),"i").test(cat[0])?cat[1]:cat[1].replace(new RegExp("("+toRx(sPhrase)+")","i"),"<b>$1</b>"))+'</span></div>');index++;});aDisplayContacts.each(function(cat){cat=cat.split(">");aHtmlContacts.push('<div data="'+cat[1]+'" id="sa_autocomplete_opt_'+_this.Instance+'_'+index+'" index="'+index+'" onmouseover="AutoCompleteSAConfig.Route(\''+_this.Instance+'\',\'MOUSEOVER\',[this])" onclick="AutoCompleteSAConfig.Route(\''+_this.Instance+'\',\'Insert\',[\''+toJs(cat[1])+'\',true])">'+(cat[1].replace(new RegExp("("+toRx(sPhrase)+")","i"),'<b>$1</b>'))+'</div>');index++;});aDisplayAuthors.each(function(cat){cat=cat.split(">");aHtmlAuthors.push('<div data="'+cat[1]+'" id="sa_autocomplete_opt_'+_this.Instance+'_'+index+'" index="'+index+'" onmouseover="AutoCompleteSAConfig.Route(\''+_this.Instance+'\',\'MOUSEOVER\',[this])" onclick="AutoCompleteSAConfig.Route(\''+_this.Instance+'\',\'Insert\',[\''+toJs(cat[1])+'\',true])">'+(cat[1].replace(new RegExp("("+toRx(sPhrase)+")","i"),'<b>$1</b>'))+'</div>');index++;});if(this.Params.Symbols)oSymbolsCont.update(aHtmlSymbols.join(""));if(this.Params.Authors)oAuthorsCont.update(aHtmlAuthors.join(""));if(this.Params.Contacts)oContactsCont.update(aHtmlContacts.join(""));oAutoComplete.setStyle({display:'block'});if(aDisplaySymbols.size()&&this.Params.Symbols)oSymbolsBox.setStyle({display:'block'});if(aHtmlAuthors.size()&&this.Params.Authors)oAuthorsBox.setStyle({display:'block'});if(aHtmlContacts.size()&&this.Params.Contacts)oContactsBox.setStyle({display:'block'});this.State="open";this.LastIndex=-1;this.CurrentResults=aDisplaySymbols.size()+aDisplayAuthors.size()+aDisplayContacts.size();if(this.Params.IframeCover)oIframeCover.setStyle({height:oAutoComplete.offsetHeight+'px',width:oAutoComplete.offsetWidth+'px',display:'block'});}}
this.ParsePhrase=function(Phrase){if(this.Params.MultipleInsert){/([^\, ]+?)$/.test(Phrase);return RegExp.$1;}
else return Phrase;}
this.LoadingMessage=function(Instance){if(this.active==false)return;var oAutoComplete=$('autocomplete_container_sa_'+this.Instance),oLoadingBox=$('autocomplete_box_loading_'+this.Instance),oSymbolsBox=$('autocomplete_box_symbols_'+this.Instance),oAuthorsBox=$('autocomplete_box_authors_'+this.Instance),oContactsBox=$('autocomplete_box_contacts_'+this.Instance),oIframeCover=$('autocomplete_iframe_cover_'+this.Instance);if(this.Params.Symbols)oSymbolsBox.setStyle({display:'none'});if(this.Params.Authors)oAuthorsBox.setStyle({display:'none'});if(this.Params.Contacts)oContactsBox.setStyle({display:'none'});if(this.Params.IframeCover)oIframeCover.setStyle({height:'0px',display:'none'});oAutoComplete.setStyle({display:'block'});oLoadingBox.setStyle({display:'block'});}
this.Set=function(Index){var oOpt=$('sa_autocomplete_opt_'+this.Instance+'_'+Index),oLastOpt=$('sa_autocomplete_opt_'+this.Instance+'_'+this.LastIndex);if(oLastOpt)oLastOpt.setStyle({backgroundColor:'#cdcdcd'});oOpt.setStyle({backgroundColor:'#E9FCFD'});this.LastIndex=Index;this.Insert(oOpt.getAttribute("data"));}
this.Insert=function(Value,bFromClick){var oInp=$(this.Input);oInp.focus();oInp.value=this.Params.MultipleInsert?(oInp.value.replace(/\, +$/,"").replace(/([^\,]+)$/," "+Value+", ")).replace(/^ /,""):Value;if(bFromClick&&this.Params.AfterInsert)this.Params.AfterInsert.call(this);}
this.AutoInsert=function(){if(this.LastIndex==-1&&$('sa_autocomplete_opt_'+this.Instance+'_0'))this.Insert($('sa_autocomplete_opt_'+this.Instance+'_0').getAttribute('data'));}
this.Close=function(){var oAutoComplete=$('autocomplete_container_sa_'+this.Instance),oIframeCover=$('autocomplete_iframe_cover_'+this.Instance);try{oAutoComplete.setStyle({display:'none'});if(this.Params.IframeCover)oIframeCover.setStyle({display:'none'});this.LastIndex=null;this.State="close";}
catch(e){};}
this.CreateAutoCompleteHtml=function(){var aHtml=[];aHtml.push('<div id="autocomplete_container_sa_'+this.Instance+'" class="autocomplete_container_sa autocomplet_wrapper">');aHtml.push('<div id="autocomplete_box_loading_'+this.Instance+'" class="autocomplete_box_sa autocomplete_box_loading_style">');aHtml.push('Loading...');aHtml.push('</div>');if(this.Params.Symbols){aHtml.push('<div id="autocomplete_box_symbols_'+this.Instance+'" class="autocomplete_box_sa">');aHtml.push('<div class="autocomplete_box_title_sa">Symbols:</div>');aHtml.push('<div id="autocomplete_container_symbols_sa_'+this.Instance+'" class="autocomplete_box_result_sa autocomplete_container_symbols_sa"></div>');aHtml.push('</div>');}
if(this.Params.Authors){aHtml.push('<div id="autocomplete_box_authors_'+this.Instance+'" class="autocomplete_box_sa">');aHtml.push('<div class="autocomplete_box_title_sa">Authors:</div>');aHtml.push('<div id="autocomplete_container_authors_sa_'+this.Instance+'" class="autocomplete_box_result_sa autocomplete_container_authors_sa"></div>');aHtml.push('</div>');}
if(this.Params.Contacts){aHtml.push('<div id="autocomplete_box_contacts_'+this.Instance+'" class="autocomplete_box_sa">');aHtml.push('<div class="autocomplete_box_title_sa">Contacts:</div>');aHtml.push('<div id="autocomplete_container_contacts_sa_'+this.Instance+'" class="autocomplete_box_result_sa autocomplete_container_authors_sa"></div>');aHtml.push('</div>');}
if(this.Params.Ad)aHtml.push('<div class="autocomplete_box_ad">'+$('autocomplete_sa_ad_'+this.Instance).innerHTML+'</div>');aHtml.push('</div>');if(this.Params.IframeCover)aHtml.push('<iframe id="autocomplete_iframe_cover_'+this.Instance+'" class="autocomplete_iframe_cover" frameborder="0" scrolling="no"></iframe>');if(this.Params.WriteToDocument)document.write(aHtml.join(""));else return aHtml.join("");}
this.Find=function(){var oSearchForm=$('search_box_sa_'+this.Instance),oInp=$(this.Input),InpHidden=$('autocomplete_sa_hidden_'+this.Instance),sPhrase=oInp.value,rxIsAuthor=new RegExp("<(?:([^><]*?)>"+toRx(sPhrase)+" ?)<","gi");if(AutoCompleteSAConfig.JavascriptLoaded){InpHidden.value=new RegExp("<(?:([^><]*?)>"+toRx(sPhrase)+" ?)<","gi").test(authors)?RegExp.$1:sPhrase;}
else InpHidden.value=sPhrase;if(sPhrase.trim()!="")oSearchForm.submit();}
this.LoadSearchFromUrl=function(){var oInp=$(this.Input),rxQ=/\/search\/\?q\=(.*?)\&/;if(rxQ.test(top.location.href))oInp.value=unescape(RegExp.$1.replace(/\+/g," "));}}
var Authentication={};Authentication.Authenticate=function(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params){Authentication.Popup(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params);}
Authentication.Loginhtml=function(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params){var aPopup=[];aPopup.push("<div id='readlater_register_login' class='readlater_register_login "+(!Messages.Login?"no_text_box":"yes_text_box")+"'>");sendWordSearch(Messages);aPopup.push(joinUnit(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params));aPopup.push(signinUnit(Id,Activity,Funcs,Messages,Additional_Data,FocusOn));aPopup.push("<div class='close_pop' onclick='if (oRefresher) { oRefresher.Activate() };AlphaBox.Close();'></div>");aPopup.push("</div>");return aPopup.join("");}
Authentication.LoginhtmlSignInJoin=function(Id,Activity,Funcs,Messages,Additional_Data,FocusOn){var aPopup=[];aPopup.push("<div id='readlater_register_login' class='readlater_register_login "+(!Messages.Login?"no_text_box":"yes_text_box")+"'>");sendWordSearch(Messages);aPopup.push(signinUnit(Id,Activity,Funcs,Messages,Additional_Data,FocusOn));aPopup.push(joinUnit(Id,Activity,Funcs,Messages,Additional_Data,FocusOn));aPopup.push("</div>");return aPopup.join("");}
Authentication.SwitchHPLoginForm=function(action){var loginFormContainer=$('hp_login_form');if(!loginFormContainer||loginFormContainer==null)return;var index="";if(action=="disable"){$$('#hp_login_form [id]').each(function(item){if(item.id&&typeof(item.id)=="string"){item.id+="_disabled";if(index=item.getAttribute("tabIndex")){item.setAttribute("tabindex_disabled",index);item.removeAttribute("tabIndex");}}});}else{$$('#hp_login_form [id]').each(function(item){if(item.id&&typeof(item.id)=="string"){item.id=(item.id).replace("_disabled","");if(index=item.getAttribute("tabindex_disabled")){item.setAttribute("tabIndex",index);item.removeAttribute("tabindex_disabled");}}});}}
Authentication.WordsSearch=function(message){mone_action="";if(message.match(/follow/i))
mone_action="follow";else if(message.match(/stocktalk/i))
mone_action="stocktalk";else if(message.match(/comment/i))
mone_action="comment";else if(message.match(/portfolio/i))
mone_action="portfolio";else if(message.match(/instablog/i))
mone_action="instablog";else if(message.match(/message/i))
mone_action="message";else if(message.match(/alert/i))
mone_action="email_alert";else if(message.match(/hp_promotion/))
mone_action="hp_promotion";else mone_action="homepage";if(mone_action)
Mone.touch("log_reg_"+mone_action);}
Authentication.Popup=function(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params){Authentication.SwitchHPLoginForm("disable");if(Additional_Data){Additional_Data=Additional_Data.replace(/\'/g,"&#39;");}
loginhtml=Authentication.Loginhtml(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params);AlphaBox.Loading();var focusOn=FocusOn?FocusOn:"authentication_login_email";AlphaBox.AddHtml(loginhtml,{onFinish:function(){try{$(focusOn).focus()}catch(e){}}});AlphaBox.onBeforeClose=function(){Authentication.SwitchHPLoginForm("enable");};AlphaBox.onAfterClose=function(){AlphaBox.WindowReset();};}
Authentication.HpPromotion=function(){loginhtml=joinUnitForPromotion('promotion');return loginhtml;}
Authentication.Login=function(){var oLoginForm=$('authentication_login_form'),oError=$('authentication_login_notice'),oResponse;if(bInProcees)return;if(!validate_email('authentication_login_email','authentication_login_notice')||!validate_password('authentication_login_password','authentication_login_notice','Please enter your password.',1,80)){$('authentication_notices').setStyle({display:''});return;}
urchinTracker('event/logged_out/try_to_login');new Ajax.Request("/authentication/login",{asynchronous:true,parameters:Form.serialize(oLoginForm),method:'post',onLoading:function(){bInProcees=true;$('authentication_login_button').addClassName('disabled');$('login_loader').setStyle({display:''});},onComplete:function(transport){if(transport.status==200){eval('oResponse='+transport.responseText);if(oResponse.login){if(mone_action)Mone.touch("log_reg_"+mone_action+"_logged");Authentication.Extra=oResponse.extra;if(oResponse.writing_status)user_cookie.writing_status=oResponse.writing_status;if(oResponse['function']=="redirect_to"&&oResponse['comment_id']!=null&&oResponse['comment_id']!=""){createCookie("new_comment_id",oResponse['comment_id']);}
setTimeout(function(){eval(oResponse['function']+'("'+oResponse.id+'")');},500);}else{oError.innerHTML=Authentication.Messages[oResponse.message];$('authentication_notices').setStyle({display:''});}}
$('authentication_login_button').removeClassName('disabled');$('login_loader').setStyle({display:'none'});bInProcees=false;},onError:function(){$('authentication_login_button').removeClassName('disabled');$('login_loader').setStyle({display:'none'});bInProcees=false;}});}
Authentication.Register=function(suffix,regbox,onComplete){var oRegisterForm=$('authentication_register_form'+(suffix||'')),oError=$('authentication_register_notice'+(suffix||'')),oResponse;if(bInProcees)return;if(!regbox){if(!validate_nick('authentication_register_nick'+(suffix||''),'authentication_register_notice'+(suffix||''),'Please enter a username.')||!validate_email('authentication_register_email'+(suffix||''),'authentication_register_notice'+(suffix||''))||!validate_password('authentication_register_password'+(suffix||''),'authentication_register_notice'+(suffix||''),'Please enter a password with 4 to 40 characters.',4,40)){if($('authentication_notices'+(suffix||'')))$('authentication_notices'+(suffix||'')).setStyle({display:''});return;}}
if($("authentication_register_agree_to_terms"+(suffix||''))&&!$("authentication_register_agree_to_terms"+(suffix||'')).checked){$('authentication_notices'+(suffix||'')).setStyle({display:''});$('authentication_register_notice'+(suffix||'')).innerHTML="Terms must be agreed in order to confirm registration.";$('authentication_register_agree_to_terms'+(suffix||'')).focus();return;}
registered_mail=$('authentication_register_email'+(suffix||'')).value;urchinTracker('event/logged_out/try_to_register');new Ajax.Request("/authentication/registration",{asynchronous:true,parameters:Form.serialize(oRegisterForm),method:'post',onLoading:function(){bInProcees=true;$('authentication_register_button'+(suffix||'')).addClassName('disabled');$('register_loader'+(suffix||'')).setStyle({display:''});},onComplete:function(transport){if(transport.status==200){eval('oResponse='+transport.responseText);if(oResponse.registration){Authentication.Extra=oResponse.extra;eval(oResponse['function']+'("'+oResponse.id+'")');Authentication.SwitchHPLoginForm("enable");if(onComplete)onComplete();}
else{if(!regbox){oError.innerHTML=Authentication.Messages[oResponse.message];$('authentication_notices'+(suffix||'')).setStyle({display:''});}else{bInProcees=false;$(Authentication.MessagesRbox[oResponse.message][1]+(suffix||'')).next().innerHTML=Authentication.MessagesRbox[oResponse.message][0];$('authentication_notices'+(suffix||'')).setStyle({display:''});}}}
bInProcees=false;$('authentication_register_button'+(suffix||'')).removeClassName('disabled');$('register_loader'+(suffix||'')).setStyle({display:'none'});},onError:function(){bInProcees=false;$('authentication_register_button'+(suffix||'')).removeClassName('disabled');$('register_loader'+(suffix||'')).setStyle({display:'none'});}});}
Authentication.Forgot_Password=function(){var oForgotPasswordForm=$('authentication_forgot_password_form'),oError=$('authentication_login_notice'),oResponse;if(bInProcees)return;if(!validate_email('authentication_forgot_password_email','authentication_login_notice')){$('authentication_notices').setStyle({display:''});return;}
urchinTracker('event/logged_out/forgot_password');new Ajax.Request("/authentication/forgot_password",{asynchronous:true,parameters:Form.serialize(oForgotPasswordForm),method:'post',onLoading:function(){bInProcees=true;$('authentication_forgot_password_button').addClassName('disabled');$('forgot_password_loader').setStyle({display:''});},onComplete:function(transport){if(transport.status==200){eval('oResponse='+transport.responseText);if(oResponse.forgot_password){if(mone_action)Mone.touch("forgotpass_"+mone_action+"_sent");Authentication.Extra=oResponse.extra;eval(oResponse['function']+'("'+oResponse.id+'")');Authentication.SwitchHPLoginForm("enable");}
else{oError.innerHTML=Authentication.Messages[oResponse.message];$('authentication_notices').setStyle({display:''});}}
bInProcees=false;$('authentication_forgot_password_button').removeClassName('disabled');$('forgot_password_loader').setStyle({display:'none'});},onError:function(){bInProcees=false;$('authentication_forgot_password_button').removeClassName('disabled');$('forgot_password_loader').setStyle({display:'none'});}});}
Authentication.ParseParam=function(aParams){window[aParams[0]].call(this,aParams.pop());}
Authentication.changeTextPassword=function(input){input.parentNode.innerHTML="<input type = 'password' name='user[password]' autocorrect='off' style=\"color:#2d2d2d\" autocapitalize='off' id='"+input.id+"' tabindex='62' title='choose password' /><div class='error'></div>";setTimeout(function(){$(input.id).focus()},10);}
Authentication.RegisterBox=function(Id,Activity,Funcs,target,suffix){var aHTML=[];aHTML.push("<div class='register_login_snippet'>");aHTML.push("<div class='top_title_area'>")
aHTML.push("<div class='people_joined'><span class='free_regis'>Free Registration:</span><br/>Register below and get the most out of&nbsp;&nbsp;<span class='sa'>Seeking Alpha</span></div>");aHTML.push("</div>");aHTML.push("<form id='authentication_register_form"+(suffix||'')+"' class='readlater_register' onkeypress='KEY_FORM_PRESS(event,function(){Authentication.Register(\""+(suffix||'')+"\",true);})' onsubmit='return false;'>");aHTML.push("<input type='hidden' name='id' value='"+Id+"'>");aHTML.push("<input type='hidden' name='activity' value='"+Activity+"'>");aHTML.push("<input type='hidden' name='function' value='"+Funcs.Register+"'>");aHTML.push("<input type='hidden' name='url_source' value='"+top.location.href.replace(/\?.*?$/,'')+"'>");aHTML.push("<fieldset><input type='text' autocorrect='off' autocapitalize='off' spellcheck='false' id='authentication_register_nick"+(suffix||'')+"' maxlength='80' tabindex='60' value='choose username' title='choose username' onfocus=\"this.style.color='#2d2d2d';handleInput(this,'focus')\" onblur=\"this.style.color=this.value=='' ? '#b0b0b0' : '#2d2d2d';handleInput(this,'blur')\" name='user[nick]'/><div class='error'></div></fieldset>");aHTML.push("<fieldset><input name='user[email]' autocorrect='off' autocapitalize='off' spellcheck='false' id='authentication_register_email"+(suffix||'')+"' tabindex='61' type='text' value='email' title='email' onfocus=\"this.style.color='#2d2d2d';handleInput(this,'focus')\" onblur=\"this.style.color=this.value=='' ? '#b0b0b0' : '#2d2d2d';handleInput(this,'blur')\" /><div class='error'></div></fieldset>");aHTML.push("<fieldset><span><input name='user[password]' autocorrect='off' autocapitalize='off' id='authentication_register_password"+(suffix||'')+"' tabindex='62' value='choose password'  title='choose password' onfocus='Authentication.changeTextPassword(this)'/><div class='error'></div></span></fieldset>");aHTML.push("<input type='hidden' name='referrer' value='"+(readCookie('session_referrer')||"")+"'>");aHTML.push("<div class='readlater_login'>");aHTML.push("<div id='login_loader"+(suffix||'')+"' class='readlater_login_loader' style='display:none;'><img src='http://static.seekingalpha.com/images/loader.gif' /></div>");aHTML.push("<div id='forgot_password_loader"+(suffix||'')+"' class='readlater_login_submit_loader' style='display:none;'><img src='http://static.seekingalpha.com/images/loader.gif' /></div>");aHTML.push("</div>");aHTML.push("<div id='authentication_notices"+(suffix||'')+"' class='errors' style='display:none;'>");aHTML.push("<div id='authentication_register_notice"+(suffix||'')+"' class='error1'></div>");aHTML.push("<div id='authentication_login_notice"+(suffix||'')+"' class='error2' style='clear:both'></div>");aHTML.push("</div>");aHTML.push("<div class='dont_spam'>We don't spam or share your information with third parties<br/>By clicking 'Join now' below you confirm that<br/> you accept our <a href=\"/page/terms-of-use\" target=\"_blank\">Terms of Use</a></div>");aHTML.push("<div id='authentication_register_button"+(suffix||'')+"' class='register_button' onclick='if (Authentication.validateRegBox(\""+(suffix||'')+"\")) Authentication.Register(\""+(suffix||'')+"\",true);' tabindex='66'>Join now</div>");aHTML.push("<div id='register_loader"+(suffix||'')+"' class='readlater_register_loader' style='display:none;'><img src='http://static.seekingalpha.com/images/loader.gif' /></div>");aHTML.push("</form>");aHTML.push("<div class='already_joined'>Already a member? <span onclick='open_header_log_in_popup_lightbox(\"login\",\"\")' onmouseover='link_over(this, \"#024999\")' onmouseout='link_out(this, \"#024999\")'>Sign in here</span></div>");aHTML.push("<div class='cleaner'></div>");aHTML.push("</div>");$(target).innerHTML=aHTML.join("");}
Authentication.Messages={"login_failed":"Please check your email and password and try again.","blocked_user":"Login failed, please contact <a href='mailto:contact-website@seekingalpha.com'>contact-website@seekingalpha.com</a>","no_user":"Please check your email and try again.","missing_user_details":"Please check your email and password and try again.","already_registered":"You are already registered, please try the Member sign in.","Email is not valid":"Email is not valid, try again.","Nick is not valid":"Username is not valid, try again.","Username has been already taken":"Username has been already taken","Nick is too short (minimum is 2 characters)":"Nick is too short (minimum is 2 characters)"}
Authentication.MessagesRbox={"login_failed":["<span class=\"icon\"></span>Please check your email and password and try again.","authentication_register_notice"],"blocked_user":["<span class=\"icon\"></span>Login failed, please contact <a href='mailto:contact-website@seekingalpha.com'>contact-website@seekingalpha.com</a>","authentication_register_notice"],"no_user":["<span class=\"icon\"></span>Please check your email and try again.","authentication_register_email"],"missing_user_details":["<span class=\"icon\"></span>Please check your email and password and try again.","authentication_register_email"],"already_registered":["<span class=\"icon\"></span>You are already registered","authentication_register_notice"],"Email is not valid":["<span class=\"icon\"></span>Email is not valid, try again.","authentication_register_email"],"Nick is not valid":["<span class=\"icon\"></span>Sorry... this username is taken, please choose another one.","authentication_register_nick"],"Username has been already taken":["<span class=\"icon\"></span>Username has been already taken","authentication_register_nick"],"Nick is too short (minimum is 2 characters)":["<span class=\"icon\"></span>Nick is too short (minimum is 2 characters)","authentication_register_nick"]}
Authentication.validateRegBox=function(suffix){var nick_field=$('authentication_register_nick'+(suffix||''));var email_field=$('authentication_register_email'+(suffix||''));var pass_field=$('authentication_register_password'+(suffix||''));nick_field.next().innerHTML="";email_field.next().innerHTML="";pass_field.next().innerHTML="";$('authentication_register_notice'+(suffix||'')).innerHTML="";if(!validate_nick(nick_field,nick_field.next(),'<span class=\"icon\"></span>Username is not valid, try again.')||!validate_email(email_field,email_field.next(),"<span class=\"icon\"></span>Sorry... This is not a valid email address")||!validate_password(pass_field,pass_field.next(),'<span class=\"icon\"></span>Please enter a password with 4 to 40 characters.',4,40)){return false;}
return true;}
function signinUnit(Id,Activity,Funcs,Messages,Additional_Data,FocusOn){var aPopup=[];aPopup.push("<div class='readlater_login' id='readlater_login'>");aPopup.push("<form id='authentication_login_form' onkeypress='KEY_FORM_PRESS(event,Authentication.Login)' onsubmit='return false;'>");aPopup.push("<div class='sign_in_title'>Sign in:</div>");aPopup.push("<input type='hidden' name='id' value='"+Id+"'>");aPopup.push("<input type='hidden' name='activity' value='"+Activity+"'>");aPopup.push("<input type='hidden' name='function' value='"+Funcs.Login+"'>");if(Additional_Data)aPopup.push("<input type='hidden' name='additional_data' value='"+Additional_Data+"'>");aPopup.push("<h3>Member sign in:</h3>");aPopup.push("<fieldset><span>Email Address</span><input type='text' name='user[email]' id='authentication_login_email' autocorrect='off' autocapitalize='off' spellcheck='false' tabindex='50' /></fieldset>");aPopup.push("<fieldset><span>Password</span><div id='password_wrapper'><input type='password' name='user[password]' autocorrect='off' autocapitalize='off' id='authentication_login_password' tabindex='51' /></div>");aPopup.push("<div>");aPopup.push("<div class='hide_wrapper_around'>");aPopup.push("<div class='forgot_your_password' onmouseover='link_over(this,\"#024999\")' onmouseout='link_out(this,\"#024999\")' onclick='$(\"authentication_forgot_password_cont\").toggle();"+(mone_action?"Mone.touch(\"forgotpass_"+mone_action+"_logged\");":"")+"'>Forgot your password?</div>");aPopup.push("</div>");aPopup.push("<div id='login_loader' class='readlater_login_loader' style='display:none;float:left;margin:17px 0 0 1px'><img src='http://static.seekingalpha.com/images/loader.gif' /></div>");aPopup.push("<div id='authentication_login_button' class='login_button' onclick='Authentication.Login()'><span class='l'></span><input class='c' type='button' value='Sign in' tabindex='52' /><span class='r'></span></div>");aPopup.push("</div>");aPopup.push("</fieldset>");aPopup.push("</form>");aPopup.push("<form id='authentication_forgot_password_form' onkeypress='KEY_FORM_PRESS(event,Authentication.Forgot_Password)' onsubmit='return false;'>");aPopup.push("<input type='hidden' name='id' value='"+Id+"'>");aPopup.push("<input type='hidden' name='activity' value='"+Activity+"'>");aPopup.push("<input type='hidden' name='function' value='"+Funcs.ForgotPassword+"'>");aPopup.push("<input type='hidden' name='url_source' value='"+top.location.href.replace(/\?.*?$/,'')+"'>");if(Additional_Data)aPopup.push("<input type='hidden' name='additional_data' value='"+Additional_Data+"'>");aPopup.push("<div class='forgot'>");aPopup.push("<span id='authentication_forgot_password_cont' style='display:none;'><div class='please_enter'>Please enter your email address:</div>");aPopup.push("<fieldset><input id='authentication_forgot_password_email' name='user[email]' autocorrect='off' autocapitalize='off' spellcheck='false' type='text'/><div class=\"forget_password_submit_wrapper\"><div id='forgot_password_loader' class='readlater_login_submit_loader' style='display:none;'><img src='http://static.seekingalpha.com/images/loader.gif' /></div><div id='authentication_forgot_password_button' class='submit_button' onclick='Authentication.Forgot_Password();' onkeypress='return false;'><span class='r'></span><input class='c' type='button' value='Submit'/><span class='l'></span></div></div></fieldset></span>");aPopup.push("</div>");aPopup.push("</form>");aPopup.push("</div>");aPopup.push("<div id='authentication_notices' class='errors' style='display:none;'>");aPopup.push("<div id='authentication_register_notice' class='error1'></div>");aPopup.push("<div id='authentication_login_notice' class='error2'></div>");aPopup.push("</div>");aPopup.push("<div class='cleaner'></div>");return aPopup.join("");}
function joinUnit(Id,Activity,Funcs,Messages,Additional_Data,FocusOn,Force_Params){var aPopup=[]
aPopup.push("<div class='joinNow_content'>");if(Messages.CustomMessage){aPopup.push("<div class='top'>"+Messages.CustomMessage+"</div>");aPopup.push("<div class='top_title_area'>");}
else if(Messages.Login){aPopup.push("<div class='top'>You must be <strong>signed in</strong> to "+Messages.Login+":</div>");aPopup.push("<div class='top_title_area'>");}else{aPopup.push("<div class='top_title_area'>");}
aPopup.push("<div class='people_joined'><span class='num'>"+users_on_site+"</span> <span class='text'>people have already<br> joined Seeking Alpha<br> to track analysis of<br> stocks they follow and<br> exchange investment ideas.</span></div>");aPopup.push("</div>");aPopup.push("<form id='authentication_register_form' class='readlater_register' onkeypress='KEY_FORM_PRESS(event,Authentication.Register)' onsubmit='return false;'>");aPopup.push("<div class='authentication_register_form_cnt'>");aPopup.push("<input type='hidden' name='id' value='"+Id+"'>");aPopup.push("<input type='hidden' name='activity' value='"+Activity+"'>");aPopup.push("<input type='hidden' name='function' value='"+Funcs.Register+"'>");aPopup.push("<input type='hidden' name='url_source' value='"+top.location.href.replace(/\?.*?$/,'')+"'>");if(Additional_Data)aPopup.push("<input type='hidden' name='additional_data' value='"+Additional_Data+"'>");if(Force_Params)aPopup.push("<input type='hidden' name='force_params' value='"+Force_Params+"'>");aPopup.push("<h3>Join now (it's free):</h3>");aPopup.push("<fieldset><span>Choose Username</span><input type='text' id='authentication_register_nick' autocorrect='off' autocapitalize='off' spellcheck='false' maxlength='80' tabindex='39' name='user[nick]'/>");aPopup.push("<span class='gray_note'>you can use your real name</span>");aPopup.push("</fieldset>");aPopup.push("<fieldset><span>Email Address</span><input name='user[email]' autocorrect='off' autocapitalize='off' spellcheck='false' id='authentication_register_email' tabindex='40' type='text' /></fieldset>");aPopup.push("<fieldset><span>Create Password:</span><input name='user[password]' id='authentication_register_password' tabindex='41' type='password' autocorrect='off' autocomplete='off' autocapitalize='off' /></fieldset>");aPopup.push("<div class='agree'><input id='authentication_register_agree_to_terms' checked='checked' tabindex='44' type='checkbox'/>I agree to <a href='/page/terms-of-use' target='_blank'>Terms of Use</a> & <a href='/page/privacy' target='_blank'>Privacy Policy</a></div>");aPopup.push("<div style='margin:8px 0 0'><div id='authentication_register_button' class='register_button' onclick='Authentication.Register();' tabindex='45'><span class='l'></span><input class='c' type='button' value='Join'/><span class='r'></span></div><div id='register_loader' class='readlater_register_loader' style='display:none'><img src='http://static.seekingalpha.com/images/loader.gif' /></div></div>");aPopup.push("<input type='hidden' name='referrer' value='"+(readCookie('session_referrer')||"")+"'>");aPopup.push("</div>");aPopup.push("</form>");aPopup.push("<div  class='already_member'></div>");aPopup.push("</div>");return aPopup.join("");}
function joinUnitForPromotion(){var aPopup=[];sendWordSearch({CustomMessage:"hp_promotion"});aPopup.push("<div class='register_promotion_top'>");aPopup.push("<div class='top_title'>save your stocks for next time</div>");aPopup.push("<div class='register_promotion_top_sign'>Already a member? <span class='link' id='promotion_reg'>Sign in</span></div>");aPopup.push(" <form id='authentication_register_form_hp_promotion' onkeypress='KEY_FORM_PRESS(event,function(){Authentication.Register(\"_hp_promotion\",null,SA.Pages.HP.Promotion.cleanReg);})' onsubmit='return false;'>");aPopup.push("<input type='hidden' name='id' value='login'>");aPopup.push("<input type='hidden' name='activity' value='rta'>");aPopup.push("<input type='hidden' name='function' value='FooterBar.Register'>");aPopup.push("<input type='hidden' name='url_source' value='"+top.location.href.replace(/\?.*?$/,'')+"'>");aPopup.push("<input type='hidden' name='referrer' value='"+(readCookie('session_referrer')||"")+"'>");aPopup.push("   <fieldset>");aPopup.push("   <div id='authentication_register_notice_hp_promotion'></div>");aPopup.push("   <div id='authentication_notices_hp_promotion'></div>");aPopup.push("   </fieldset>");aPopup.push("   <fieldset><input type='text' id='authentication_register_nick_hp_promotion' autocorrect='off' autocapitalize='off' spellcheck='false' maxlength='80' empty='username' name='user[nick]'/></fieldset>");aPopup.push("   <fieldset>");aPopup.push("     <input name='user[email]' autocorrect='off' autocapitalize='off' spellcheck='false' id='authentication_register_email_hp_promotion' empty='email' type='text' />");aPopup.push("   </fieldset>");aPopup.push("   <fieldset><input name='user[password]' id='authentication_register_password_hp_promotion' type='password' autocorrect='off' empty='password' autocomplete='off' autocapitalize='off' /></fieldset>");aPopup.push("   <div class='agree' style='margin-top:-6px;'><input name='realtime_articles' checked='checked' type='checkbox' id='promotion_reg_rta_chk'/>Get email alerts with breaking news and articles on your stocks</div>");aPopup.push("   <div id='authentication_register_button_hp_promotion' class='register_button' onclick='Authentication.Register(\"_hp_promotion\",null,SA.Pages.HP.Promotion.cleanReg);' tabindex='45'>Save</div>");aPopup.push("   <div class='agree terms'><input style='display:none' id='authentication_register_agree_to_terms_hp_promotion' checked='checked' type='checkbox'/>By clicking &quot;save&quot; you agree to Seeking Alpha&#39;s  <a href='/page/terms-of-use' target='_blank'>Terms of Use</a></div>");aPopup.push(" </form>");aPopup.push("</div>");return aPopup.join("");}
function sendWordSearch(Messages){if(Messages.CustomMessage){Authentication.WordsSearch(Messages.CustomMessage);}
else if(Messages.Login){Authentication.WordsSearch(Messages.Login);}else{mone_action="login";Mone.touch("log_reg_"+mone_action);}}
function Ziignight(Type,Callback,Symbols,ObjectName,Target,SASource){var _this=this;this.JSON=[];this.WorkJSON=[];this.Target=Target;this.Type=Type;this.Callback=Callback;this.Symbols=Symbols;this.ObjectName=ObjectName;this.Refresh=true;this.Sorted=-1;this.reverse_sort=1;this.left_symbols="";this.timeOut;this.addETF=true;this.JsTimeOut;this.JsReload=false;this.JsResponded=false;this.loadedFirstTime=false;this.pageType="Unknown";this.sasource=SASource;this.User="shmueli@seekingalpha.com";this.Interval=120*1000;this.BroadBondIndexes="LAG,GBF,BSV,ITR,LWC";this.USGovernmentBonds="TLO,ITE,BIL,IPE";this.CorporateBonds="JNK,LQD,CLY,CIU,SCPB";this.InflationProtectedBonds="TIP";this.InternationalBonds="BWX,EMB,WIP,BWZ";this.USMunicipalBonds="CMF,TFI,ITM,MLN,SHM,NYF,VRD";this.MortgageBonds="MBG,CWB";this.CommoditiesMetals="GLD,PPLT,SLV,PALL";this.CommoditiesOil="OIL,GAZ";this.CommoditiesAgricultural="FUE,NIB,JO,CORN,BAL,JJG,COW,SGG";this.CommoditiesIndustrial="JJU,JJC,LD,JJN,JJT";this.CommoditiesBasket="JJA,GSC,JJE,JJM,WITE";this.Countries="EWA,EWO,EWK,EWZ,EWC,ECH,GXC,GXG,EGPT,EWQ,EWG,EWH,PIN,IDX,EIRL,EIS,EWI,JPP,EWM,EWW,EWN,EPU,PLND,RBL,EWS,EZA,EWY,EWP,EWD,EWL,EWT,THD,TUR,EWU,TMW,VNM,ENZL,NORW,EPHE,ARGT";this.CurrenciesSingle="FXA,BZF,FXB,FXC,CYB,FXE,ICN,FXY,BNZ,XRU,SZR,FXS,FXF";this.CurrenciesLeveraged="URR,DRR,YCL,YCS";this.CurrenciesStrategies="AYT,PGD,ICI,UUP,UDN,CEW";this.USMarketCapDividends="DLN,DON,DES,DTD,DTN";this.InternationalDividends="DWX,DTH,DOO,DOL,DIM,DLS";this.GlobalRegionsDividends="DEM,DGS,FDD,DFE,DXJ,DFJ,GULF,DND";this.Earnings="EPS,EZM,EES,EXT";this.Strategies="PKW,PGF,SDY,PFF,PFM,PID,FVD";this.MarketsRegions="BIK,GMM,GMF,GUR,ESR,GML,EWX,GAF,FRN,MES,ILF";this.MarketsCountries="EWZ,ECH,GXC,GXG,EWH,PIN,IDX,EIS,EWM,EWW,EPU,RBL,EWS,EZA,EWY,EWT,THD,TUR,VNM,ARGT";this.MarketsThemes="BRXX,CHXX,ECON,EMIF,INXX";this.MarketsSectors="OGEM,FGEM,EMMT,EMT";this.MarketsDividends="DEM,DGS,GULF,HILO";this.GlobalWorld="DGT,IOO,MDD,GWX,ACWI,GWL";this.GlobalEmerging="EFA,EFG,EFV,GMM,EWX";this.GlobalRegions="AIA,BIK,GMF,IEV,GUR,ESR,GML,GAF,EZU,FEU,FEZ,ILF,EPP";this.GrowthBroadMarkets="IWZ,IWW,EFG,EFV";this.GrowthDJIndexes="ELG,ELV,EMG,EMV,DSG,DSV";this.GrowthRussellIndexes="IWF,IWD,IWP,IWS,IWO,IWN";this.GrowthMorningstarIndexes="JKE,JKF,JKH,JKI,JKK,JKL";this.GrowthSPIndexes="SPYG,SPYV,MDYG,MDYV,SLYG,SLYV";this.MarketCapBroadMarkets="SCZ,EWX,MDD,GWX";this.MarketCapDJIndexes="ELR,EMM,FDM";this.MarketCapSPIndexes="SPY,MDY,IJR";this.MarketCapRussellIndexes="IWB,IWR,IWM,IWC";this.MarketCapMorningstarIndexes="JKD,JKG,JKJ";this.MarketCapWeightIndexes="RSP,QQEW";this.MarketCapSingleCountry="KROO,SKOR,TWON,EWZS,BRF,CNDA,HAO,ECNS,SCIN,SCIF,SCJ,JSC,DFJ,BRAZ,MEXS,RSXJ,GERJ,HKK,RSUN";this.RealEstateGlobal="IFAS,IFEU,IFNA,RWX,RWR,RWO";this.RealEstateUS="FIO,REM,REZ,RTL";this.RealEstateStrategies="XHB";this.SectorsUS="XLB,XLY,XLP,XLE,XLF,XLV,XLI,XLK,XLU";this.SectorsGlobal="MXI,RXI,KXI,IXC,IXG,IXJ,EXI,IXN,IXP,JXI";this.SectorsForeign="IRV,IPD,IPS,IPW,IPF,IRY,IPN,IPK,IST,IPU";this.StrategiesStrategies="PKW,BWV,CRO,GCE,DOD,EQL,QAI,MCRO,MNA,CSD,RYJ,CPI,PIZ,PIE,FPX,STH,FVL,SPHB,SPLV";this.AlternativeAssetClasses="ALT,HEDJ,VXX,VXZ";this.MixedFundamentals="PAF,PXF,PDN,PXH,PEF,PJO,PRF,PRFZ";this.StrategiesEarnings="EPS,EZM,EES,EXT";this.StrategiesRevenue="RWL,RWK,RWJ,RWW,RTR,RWV";this.AssetAllocation="AOA,AOK,AOR,AOM";this.SocialAndFaith="KLD,DSI";this.ThemesAlternativeEnergy="GRN,EVX,PKN,TAN,FAN";this.Consumer="BJK,PBJ,XHB,XRT,FISN,CARZ";this.Energy="XES,XOP";this.Financials="KBE,IAI,KCE,PSP,KIE,KME,KRE";this.Healthcare="XBI,IHF,IHI,XPH";this.Industrial="ITA,FAA,GII,PIO,IYT";this.Material="KOL,GDX,HAP,GDXJ,XME,SLX";this.Technology="IGN,XSD,IGV";this.KeyUSEquities="SPY,EMM,SLY,IWC,DIA";this.KeyUGlobalEquities="BIK,EFA,GMM,CWI,ACWI";this.KeyUBonds="LAG,JNK,BWX,IPE,TLT";this.KeyUCommodities="GLD,PTM,SLV,OIL,JJM,JJA";this.KeyUCurrencies="FXB,CYB,FXE,FXY";this.HpMarketPerformance="SPY,IJH,IJR,DIA,QQQ,EEM,ICF,GLD,SLV";this.CreateQuery=function(tag_list,custom_callback){var tag_array=tag_list.split(","),query,tagsquery=[];if(tag_array.length<=20){tag_array.each(function(tag,i){tagsquery.push("S"+(i+1)+"="+tag);});}else{for(var i=0;i<20;i++){tagsquery.push("S"+(i+1)+"="+tag_array[i]);}}
tagsquery="&"+tagsquery.join("&");function addDummies(start_num,num){var dummy=[];for(var i=0;i<num;i++){dummy.push("S"+(i+start_num)+"=DUMMY")}
if(num)
return("&"+dummy.join("&"));else
return"";}
if(tag_array.length==1){tagsquery=tagsquery;query="http://splices.xignite.com/seekingalpha_OneSymbolChangeReport.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks."+(custom_callback||_this.Callback)+tagsquery;}else if(tag_array.length<=5){tagsquery=tagsquery+addDummies(5-(5-tag_array.length)+1,5-tag_array.length);query="http://splices.xignite.com/seekingalpha_FiveSymbolsChangeReport.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks."+(custom_callback||_this.Callback)+tagsquery;}else if(tag_array.length<=10){tagsquery=tagsquery+addDummies(10-(10-tag_array.length)+1,10-tag_array.length);query="http://splices.xignite.com/seekingalpha_TenSymbolChangeReport.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks."+(custom_callback||_this.Callback)+tagsquery;}else if(tag_array.length<=15){tagsquery=tagsquery+addDummies(15-(15-tag_array.length)+1,15-tag_array.length);query="http://splices.xignite.com/seekingalpha_FifteenReportChange.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks."+(custom_callback||_this.Callback)+tagsquery;}else if(tag_array.length<=20){tagsquery=tagsquery+addDummies(20-(20-tag_array.length)+1,20-tag_array.length);query="http://splices.xignite.com/seekingalpha_TwentySymbolsChangeReport.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks."+(custom_callback||_this.Callback)+tagsquery;}else{_this.left_symbols=tag_array.slice(20).join(",");query="http://splices.xignite.com/seekingalpha_TwentySymbolsChangeReport.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks."+(custom_callback||_this.Callback)+tagsquery;}
return query;}
this.Urls={Multi:"http://splices.xignite.com/seekingalpha_GetBATSLastSales.json?Header_Username="+this.User+"&_callback=oZiignight.Callbacks."+Callback+"&Symbols=DIA%2cSPY%2c"+this.Symbols,Market:"http://splices.xignite.com/seekingalpha_GetBATSLastSales.json?Header_Username="+this.User+"&_callback=oZiignight.Callbacks."+Callback+"&Symbols=DIA%2cSPY",Year:"http://splices.xignite.com/seekingalpha_getOneYearChange.json?Header_Username="+this.User+"&_callback="+Callback+"&Identifier="+this.Symbols,Single:"http://splices.xignite.com/seekingalpha_GetBATSQuote.json?Header_Username="+this.User+"&Symbol="+this.Symbols+"&_callback=oZiignight.Callbacks."+Callback}
this.Init=function(Type){if(_this.Callback=="Symbol"&&_this.Type=="Single"&&this.Symbols.match(/(?:\.pk)|(?:.ob)/i))return;if(_this.Callback=="ETForETN"){this.Refresh=false;setTimeout(function(){this.RemoteJSON(_this.CreateQuery(_this[_this.Type]))}.bind(this),this.Interval);}else if(_this.Callback=="ETFDashboard"){}else if(_this.Callback=="SAlternative"){this.Refresh=false;this.RemoteJSON(_this.CreateQuery(_this.Symbols));}else if(_this.Callback=="Portfolio"){this.loadedFirstTime=true;if(getURLParam("bplan")!="true"){document.write("<scri"+"pt src='"+this.Urls[this.Type]+"'>"+"</scri"+"pt>");setTimeout(function(){this.JSON=[];this.ReloadJSON();}.bind(this),this.Interval);}else{this.RemoteJSON(this.Urls[this.Type]);}}else{this.RemoteJSON(this.Urls[this.Type]);}}
this.RemoteJSON=function(Url){setTimeout(function(){this.Script=document.createElement('script');this.Script.type="text/javascript";this.Script.src=Url;document.body.insertBefore(this.Script,document.body.firstChild);if(this.Refresh){setTimeout(function(){this.JSON=[];this.ReloadJSON();}.bind(this),this.Interval);}}.bind(this),10);}
this.ValidateJSLoad=function(){if(_this.Callback=="Portfolio"){if((_this.WorkJSON.length==0&&!_this.JsReload)||(_this.Callback=="Portfolio"&&!_this.JsResponded)){_this.JsReload=true;clearTimeout(_this.JsTimeOut);_this.JSON=[];_this.ReloadJSON();}}}
this.ReloadJSON=function(){if($(this.Script))$(this.Script).remove();if(_this.Callback=="ETForETN"){this.RemoteJSON(_this.CreateQuery(_this[_this.Type]));}else if((_this.Callback=="ETFDashboard")||(_this.Callback=="SAlternative")){_this.Symbols=_this.Symbols.split(",").uniq().join(",");this.RemoteJSON(_this.CreateQuery(_this.Symbols));}else{this.RemoteJSON(this.Urls[this.Type]);}}
this.InsertEtfAlternativeSymbol=function(symb){_this.Refresh=false;var request=true;_this.WorkJSON.each(function(json){if(symb.toUpperCase().indexOf(json.S.toUpperCase())!=-1){request=false;};});if(request){var query="http://splices.xignite.com/seekingalpha_OneSymbolChangeReport.json?Header_Username="+_this.User+"&_callback="+_this.ObjectName+".Callbacks.SAAlternativeUpdate&S1="+symb;_this.RemoteJSON(query);}}
this.InsertEtfAlternativeSymbols=function(symbs){_this.Refresh=false;symbs=cleanSymbolString(symbs);var tmpsymbs=symbs.toUpperCase().split(",");_this.WorkJSON.each(function(json){if(tmpsymbs.indexOf(json.S.toUpperCase())!=-1){tmpsymbs=tmpsymbs.without(json.S.toUpperCase())};});symbs=tmpsymbs.join(",");if(!symbs)return;var query=_this.CreateQuery(symbs,'SAAlternativeAddStocks');this.RemoteJSON(query);}
this.Callbacks={Portfolio:function(JSON){var oSymbolsPortfolio=$('SymbolData'),aHtml=[];_this.JsResponded=true;JSON.Q=JSON.Q.splice(2,JSON.Q.length).sort(function(a,b){if(a.S>b.S)return 1;if(b.S>a.S)return-1;return 0;});aHtml.push('<table>');aHtml.push('<tbody>');aHtml.push('<tr>');aHtml.push('<style></style>');aHtml.push('<th class="symbol">Symbol</th>');aHtml.push('<th class="last_trade" colspan="2">Last Trade</th>');aHtml.push('<th class="change" colspan="2">Change</th>');aHtml.push('<th></th>');aHtml.push('</tr>');JSON.Q.each(function(Q,i){if(Q.S.length){Q=_this.NotAvailable(Q);if(i%2){aHtml.push('<tr>');}
else{aHtml.push('<tr class="gray">');}
aHtml.push('<td class="symbol">'+'<a onmouseover="symbolLinkAddAltAndTitle(this)" sasource="portfolio_table" href="/symbol/'+Q.S.toLowerCase()+'">'+Q.S.toUpperCase()+'</a></td>');aHtml.push('<td class="last_trade">'+_this.FixHour(Q.T)+'</td>');aHtml.push('<td class="last_trade2">'+_this.FixDecimalPoint(Q.L)+'</td>');aHtml.push('<td class="number '+_this.GetClassName(_this.FixDecimalPoint(Q.C))+'"><span>'+_this.FixDecimalPoint(Q.C,false,true)+'</span></td>');aHtml.push('<td class="percent '+_this.GetClassName(_this.FixDecimalPoint(Q.P))+'"><span>'+_this.FixDecimalPoint(Q.P,false,true)+(Q.P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="more"><a href="/symbol/'+Q.S.toLowerCase()+'">more&nbsp;&raquo;</a></td>');aHtml.push('</tr>');}});aHtml.push('</tbody>');aHtml.push('</table>');if(_this.loadedFirstTime)
oSymbolsPortfolio.update(aHtml.join(''));else
document.write(aHtml.join(''));},Market:function(JSON){var oMarketDJIA_Percent=$('market_djia_percent'),oMarketSAP_Percent=$('market_sap_percent');oMarketDJIA_Percent.update(_this.FixDecimalPoint(JSON.Q[0].P)+"%").addClassName(_this.GetClassName(_this.FixDecimalPoint(JSON.Q[0].P)));oMarketSAP_Percent.update(_this.FixDecimalPoint(JSON.Q[1].P)+"%").addClassName(_this.GetClassName(_this.FixDecimalPoint(JSON.Q[1].P)));},Symbol:function(JSON){var oSymbol_Trade=$('symbol_last_trade'),oSymbol_Change=$('symbol_change'),oSymbol_Percent=$('symbol_procent_change'),oSymbol_Time=$('symbol_time');try{oSymbol_Trade.update(_this.FixDecimalPoint(JSON.Last));oSymbol_Change.update(_this.FixDecimalPoint(JSON.Change)).addClassName(_this.GetClassName(_this.FixDecimalPoint(JSON.Change))+'1');oSymbol_Percent.update(_this.FixDecimalPoint(JSON.PercentChange)+"%");oSymbol_Time.update(JSON.Date+" "+JSON.Time);}catch(err){}},ETForETN:function(JSON){for(var i=1;(i<=_this[_this.Type].split(",").length)&&(i<21);i++){if(JSON["Symbol"+i].S!="DUMMY"){JSON["Symbol"+i].realName=_this.DashboardRealNames[JSON["Symbol"+i].S.toUpperCase()]
_this.JSON.push(JSON["Symbol"+i]);}else
break;}
if(_this.left_symbols!=""){$(_this.Script).remove();var tempSymbols=_this.left_symbols;_this.left_symbols="";_this.RemoteJSON(_this.CreateQuery(tempSymbols));return;}else{_this.WorkJSON=[];_this.WorkJSON=_this.JSON.clone();_this.JSON=[];if(_this.timeOut)clearTimeout(_this.timeOut);_this.timeOut=setTimeout(function(){_this.ReloadJSON();},_this.Interval);}
if(_this.Sorted==-1)
_this.ETForETNPrint(4);else{_this.reverse_sort=_this.reverse_sort*-1;_this.ETForETNPrint(_this.Sorted);}},ETFDashboard:function(JSON){for(var i=1;(i<=_this.Symbols.split(",").length)&&(i<21);i++){if(JSON["Symbol"+i].S!="DUMMY"){JSON["Symbol"+i].realName=_this.DashboardSymbolToName[JSON["Symbol"+i].S.toUpperCase()]
_this.JSON.push(JSON["Symbol"+i]);}else
break;}
if(_this.left_symbols!=""){$(_this.Script).remove();var tempSymbols=_this.left_symbols;_this.left_symbols="";_this.RemoteJSON(_this.CreateQuery(tempSymbols));return;}else{_this.WorkJSON=[];_this.WorkJSON=_this.JSON.clone();_this.JSON=[];if(_this.timeOut)clearTimeout(_this.timeOut);}
if(_this.Sorted==-1)
_this.ETFDashboardPrint(0);else{_this.reverse_sort=_this.reverse_sort*-1;_this.ETFDashboardPrint(_this.Sorted);}},SAlternative:function(JSON){for(var i=1;(i<=_this.Symbols.split(",").length)&&(i<21);i++){if(JSON["Symbol"+i].S!="DUMMY"){_this.JSON.push(JSON["Symbol"+i]);}else
break;}
if(_this.left_symbols!=""){$(_this.Script).remove();var tempSymbols=_this.left_symbols;_this.left_symbols="";_this.RemoteJSON(_this.CreateQuery(tempSymbols));return;}else{_this.WorkJSON=[];_this.WorkJSON=_this.JSON.clone();_this.JSON=[];if(_this.timeOut)clearTimeout(_this.timeOut);}
if(_this.Sorted==-1)
_this.SAlternativePrint(-1);else{_this.reverse_sort=_this.reverse_sort*-1;_this.SAlternativePrint(_this.Sorted);}},SAAlternativeUpdate:function(JSON){if(top.location.pathname.match("/symbol/(.*?)(?:\/|$)")&&JSON["Symbol1"].S.toUpperCase()==top.location.pathname.match("/symbol/(.*?)(?:\/|$)")[1].toUpperCase()&&JSON["Symbol1"].S.match(/(?:\.pk)|(?:.ob)/i)){var oSymbol_Trade=$('symbol_last_trade'),oSymbol_Change=$('symbol_change'),oSymbol_Percent=$('symbol_procent_change');try{oSymbol_Trade.update(_this.FixDecimalPoint(JSON["Symbol1"].NOW_L));oSymbol_Change.update(_this.FixDecimalPoint(JSON["Symbol1"].NOW_C)).addClassName(_this.GetClassName(_this.FixDecimalPoint(JSON["Symbol1"].NOW_C))+'1');oSymbol_Percent.update(_this.FixDecimalPoint(JSON["Symbol1"].NOW_P)+"%");}catch(err){}}
var oSymbolLastTrade=$('symbol_last_trade');if(oSymbolLastTrade&&oSymbolLastTrade.innerHTML.length==0){$('qmQuoteChart').hide();}
_this.WorkJSON.unshift(JSON["Symbol1"]);_this.SAlternativePrint(2);},SAAlternativeAddStocks:function(JSON){for(var i=1;JSON["Symbol"+i];i++){if(JSON["Symbol"+i].S!="DUMMY"){_this.WorkJSON.push(JSON["Symbol"+i]);}else
break;}
_this.SAlternativePrint(-1);}}
this.ETFDashboardPrint=function(sorted){var aHtml=[];var oDashboard=_this.Target;var JSON=addRealNames(_this.WorkJSON,true);var sort_by;if(sorted==undefined)sorted=1;if(sorted){if(sorted==_this.Sorted)_this.reverse_sort=_this.reverse_sort*-1;else
_this.reverse_sort=1;_this.Sorted=sorted;}
switch(sorted){case 1:sort_by="realName";break;case 2:sort_by="NOW_P";break;case 3:sort_by="OYA_P";break;default:sort_by="realName";}
JSON=JSON.sort(function(a,b){if(a[sort_by]<b[sort_by])
return sort_by=="realName"?-1*_this.reverse_sort:1*_this.reverse_sort;if(b[sort_by]<a[sort_by])
return sort_by=="realName"?1*_this.reverse_sort:-1*_this.reverse_sort;return 0;});aHtml.push('<table style="border:1px solid #DBDBDB; border-top:none;">');aHtml.push('<tr>');aHtml.push(' <th class="eft_or_etn '+(_this.Sorted==1?"sorted ":"")+(_this.Sorted==1&&_this.reverse_sort==-1?"up":"")+'"><span>Popular ETFs</span></th>');aHtml.push(' <th class="today '+(_this.Sorted==2?"sorted ":"")+(_this.Sorted==2&&_this.reverse_sort==-1?"up":"")+'"><span><b onclick="'+(_this.Sorted==2&&_this.reverse_sort==1?"":_this.ObjectName+'.ETFDashboardPrint(2)')+'">Today</b></span></th>');aHtml.push(' <th class="last '+(_this.Sorted==3?"sorted ":"")+(_this.Sorted==3&&_this.reverse_sort==-1?"up":"")+'"><span><b onclick="'+(_this.Sorted==3&&_this.reverse_sort==1?"":_this.ObjectName+'.ETFDashboardPrint(3)')+'">1&nbsp;Yr</b></span></th>');aHtml.push('</tr>');var sasource_attr=_this.sasource?' sasource="'+_this.sasource+'"':'';JSON.each(function(Q,i){if(Q.S.length){Q=_this.NotAvailable(Q);if(i%2){aHtml.push('<tr class="gray">');}else{aHtml.push('<tr>');}
aHtml.push('<td class="eft_or_etn">'+_this.DashboardSymbolToName[Q.S.toUpperCase()]+'&nbsp;(<a onmouseover="symbolLinkAddAltAndTitle(this)" sasource="popular_etfs_table" href="/symbol/'+Q.S.toLowerCase()+'"'+sasource_attr+'>'+Q.S.toUpperCase()+'</a>)</td>');aHtml.push('<td class="today '+_this.GetClassName(_this.FixDecimalPoint(Q.NOW_P,1))+'"><span>'+_this.FixDecimalPoint(Q.NOW_P,1)+(Q.NOW_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="last '+_this.GetClassName(_this.FixDecimalPoint(Q.OYA_P,1))+'"><span>'+_this.FixDecimalPoint(Q.OYA_P,1)+(Q.OYA_P!='N/A'?'%':'')+'</span></td>');aHtml.push('</tr>');}});aHtml.push('</table>');$(oDashboard).update(aHtml.join(''));}
this.ETForETNPrint=function(sorted){var aHtml=[];var JSON=addRealNames(_this.WorkJSON);var sort_by;if(sorted==undefined)sorted=4;if(sorted){if(sorted==_this.Sorted)_this.reverse_sort=_this.reverse_sort*-1;else
_this.reverse_sort=1;_this.Sorted=sorted;}
switch(sorted){case 1:sort_by="realName";break;case 2:sort_by="NOW_P";break;case 3:sort_by="TMA_P";break;case 4:sort_by="OYA_P";break;case 5:sort_by="YTD_P";break;default:sort_by="realName";}
JSON=JSON.sort(function(a,b){if(a[sort_by]<b[sort_by])
return sort_by=="realName"?-1*_this.reverse_sort:1*_this.reverse_sort;if(b[sort_by]<a[sort_by])
return sort_by=="realName"?1*_this.reverse_sort:-1*_this.reverse_sort;return 0;});aHtml.push('<table>');aHtml.push('<tr>');aHtml.push(' <th class="eft_or_etn '+(_this.Sorted==1?"sorted ":"")+(_this.Sorted==1&&_this.reverse_sort==-1?"up":"")+'" onclick="'+_this.ObjectName+'.ETForETNPrint(1)"><span>ETF&nbsp;or&nbsp;ETN</span></th>');aHtml.push(' <th class="'+(_this.Sorted==2?"sorted ":"")+(_this.Sorted==2&&_this.reverse_sort==-1?"up":"")+'" onclick="'+_this.ObjectName+'.ETForETNPrint(2)"><span>Today</span></th>');aHtml.push(' <th class="'+(_this.Sorted==3?"sorted ":"")+(_this.Sorted==3&&_this.reverse_sort==-1?"up":"")+'" onclick="'+_this.ObjectName+'.ETForETNPrint(3)"><span>3&nbsp;Mths</span></th>');aHtml.push(' <th class="'+(_this.Sorted==4?"sorted ":"")+(_this.Sorted==4&&_this.reverse_sort==-1?"up":"")+'"  onclick="'+_this.ObjectName+'.ETForETNPrint(4)"><span>1&nbsp;Yr</span></th>');aHtml.push(' <th class="last '+(_this.Sorted==5?"sorted ":"")+(_this.Sorted==5&&_this.reverse_sort==-1?"up":"")+'" onclick="'+_this.ObjectName+'.ETForETNPrint(5)"><span>YTD</span></th>');aHtml.push('</tr>');JSON.each(function(Q,i){if(Q.S.length){Q=_this.NotAvailable(Q);if(i%2){aHtml.push('<tr class="gray">');}else{aHtml.push('<tr>');}
aHtml.push('<td class="eft_or_etn">'+_this.DashboardRealNames[Q.S.toUpperCase()]+'&nbsp;(<a onmouseover="symbolLinkAddAltAndTitle(this)" href="/symbol/'+Q.S.toLowerCase()+'">'+Q.S.toUpperCase()+'</a>)</td>');aHtml.push('<td class="'+_this.GetClassName(_this.FixDecimalPoint(Q.NOW_P,1))+'"><span>'+_this.FixDecimalPoint(Q.NOW_P,1)+(Q.NOW_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="'+_this.GetClassName(_this.FixDecimalPoint(Q.TMA_P,1))+'"><span>'+_this.FixDecimalPoint(Q.TMA_P,1)+(Q.TMA_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="'+_this.GetClassName(_this.FixDecimalPoint(Q.OYA_P,1))+'"><span>'+_this.FixDecimalPoint(Q.OYA_P,1)+(Q.OYA_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="last '+_this.GetClassName(_this.FixDecimalPoint(Q.YTD_P,1))+'"><span>'+_this.FixDecimalPoint(Q.YTD_P,1)+(Q.YTD_P!='N/A'?'%':'')+'</span></td>');aHtml.push('</tr>');}});aHtml.push('</table>');$(_this.Target).innerHTML=aHtml.join('');}
this.SAlternativePrint=function(sorted){var aHtml=[];var JSON=_this.WorkJSON;var sort_by;if(sorted==undefined)sorted=4;if(sorted){if(sorted==_this.Sorted)_this.reverse_sort=_this.reverse_sort*-1;else
_this.reverse_sort=1;_this.Sorted=sorted;}
switch(sorted){case 1:sort_by="S";break;case 2:sort_by="NOW_P";break;case 3:sort_by="TMA_P";break;case 4:sort_by="OYA_P";break;case 5:sort_by="YTD_P";break;default:sort_by="S";}
if(sorted!=-1){JSON=JSON.sort(function(a,b){if(a[sort_by]<b[sort_by])
return sort_by=="S"?-1*_this.reverse_sort:1*_this.reverse_sort;if(b[sort_by]<a[sort_by])
return sort_by=="S"?1*_this.reverse_sort:-1*_this.reverse_sort;return 0;});}
aHtml.push('<table>');aHtml.push('<tr>');aHtml.push(' <th class="eft_or_etn '+(_this.Sorted==1?"sorted ":"")+(_this.Sorted==1&&_this.reverse_sort==-1?"up":"")+'"><span>ETFs</span></th>');aHtml.push(' <th class="today '+(_this.Sorted==2?"sorted ":"")+(_this.Sorted==2&&_this.reverse_sort==-1?"up":"")+'"><span><b onclick="'+(_this.Sorted==2&&_this.reverse_sort==1?"":_this.ObjectName+'.SAlternativePrint(2)')+'">Today</b></span></th>');aHtml.push(' <th class="'+(_this.Sorted==3?"sorted ":"")+(_this.Sorted==3&&_this.reverse_sort==-1?"up":"")+'"><span><b onclick="'+(_this.Sorted==3&&_this.reverse_sort==1?"":_this.ObjectName+'.SAlternativePrint(3)')+'">3&nbsp;Mths</b></span></th>');aHtml.push(' <th class="'+(_this.Sorted==4?"sorted ":"")+(_this.Sorted==4&&_this.reverse_sort==-1?"up":"")+'"><span><b onclick="'+(_this.Sorted==4&&_this.reverse_sort==1?"":_this.ObjectName+'.SAlternativePrint(4)')+'">1&nbsp;Yr</b></span></th>');aHtml.push(' <th class="last '+(_this.Sorted==5?"sorted ":"")+(_this.Sorted==5&&_this.reverse_sort==-1?"up":"")+'"><span><b onclick="'+(_this.Sorted==5&&_this.reverse_sort==1?"":_this.ObjectName+'.SAlternativePrint(5)')+'">YTD</b></span></th>');aHtml.push('</tr>');JSON.each(function(Q,i){if(Q.S.length){Q=_this.NotAvailable(Q);var is_selected_row="";if(_this.selectedSymbol&&Q.S.toUpperCase()==_this.selectedSymbol.toUpperCase()){is_selected_row="etf_selected";}
if(i%2){aHtml.push('<tr class="gray '+is_selected_row+'">');}else{aHtml.push('<tr class="'+is_selected_row+'">');}
aHtml.push('<td class="eft_or_etn"><a onmouseover="symbolLinkAddAltAndTitle(this)" href="/symbol/'+Q.S.toLowerCase()+'" onclick="trackLink(this, \'ETF Alternatives\', \''+_this.pageType+'\', \''+Q.S.toUpperCase()+'\');">'+Q.S.toUpperCase()+'</a></td>');aHtml.push('<td class="today '+_this.GetClassName(_this.FixDecimalPoint(Q.NOW_P,1))+'"><span>'+_this.FixDecimalPoint(Q.NOW_P,1)+(Q.NOW_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="'+_this.GetClassName(_this.FixDecimalPoint(Q.TMA_P,1))+'"><span>'+_this.FixDecimalPoint(Q.TMA_P,1)+(Q.TMA_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="'+_this.GetClassName(_this.FixDecimalPoint(Q.OYA_P,1))+'"><span>'+_this.FixDecimalPoint(Q.OYA_P,1)+(Q.OYA_P!='N/A'?'%':'')+'</span></td>');aHtml.push('<td class="last '+_this.GetClassName(_this.FixDecimalPoint(Q.YTD_P,1))+'"><span>'+_this.FixDecimalPoint(Q.YTD_P,1)+(Q.YTD_P!='N/A'?'%':'')+'</span></td>');aHtml.push('</tr>');}});aHtml.push('</table>');if(_this.addETF){aHtml.push('<div class="data_currencies_table_inputs">');aHtml.push('<input type="text" class="text_input" id="autocomplete_sa_'+_this.ObjectName+'" value="Add stock or ETF" onblur="this.style.color=this.value==\'\' ? \'#8D8D8D\' : \'#000000\';handleInput(this,\'blur\')" onfocus="this.style.color=\'#000000\';this.style.fontStyle=\'normal\';handleInput(this,\'focus\')" title=\'Add stock or ETF\'/><input type="button" class="button_input" value="Compare" onclick="'+_this.ObjectName+'.InsertEtfAlternativeSymbols($(\'autocomplete_sa_'+_this.ObjectName+'\').value);$(\'autocomplete_sa_'+_this.ObjectName+'\').value=\'\';">');aHtml.push('<div id="'+_this.ObjectName+'_container"></div>');aHtml.push('</div>');}
$(_this.Target).innerHTML=aHtml.join('');if(_this.addETF){$(_this.ObjectName+'_container').innerHTML=AutoCompleteSAConfig.Create(_this.ObjectName,{Authors:false,AutoInsert:true,WriteToDocument:false,IframeCover:true,MultipleInsert:true});eval('AutoCompleteSAConfig.Packages.'+_this.ObjectName+'.Init()');}}
this.GetClassName=function(P){if(P<0)return'down';if(P>=0)return'up';return"";}
this.FixDecimalPoint=function(Int,Round,abs){if(Int=='N/A')return Int;Int=parseFloat(Int);if(abs)Int=Math.abs(Int);var res=(((""+Int).indexOf(".")>-1?Int+"00":""+Int)*1).toFixed(Round?1:2)
return res!=0?res:0;}
this.FixHour=function(Hour){if(Hour=='N/A')return Hour;else if(Hour==null)return'N/A';Hour=Hour.toLowerCase();var result=Hour.replace(/(\d+\:\d+)\:\d+\s(\w+)/g,"$1"+"$2"+"&nbsp;ET");return Hour!=0?result:0;}
this.NotAvailable=function(Q){return Q.L==0&&Q.C==0&&Q.P==0?{S:Q.S,L:'N/A',C:'N/A',P:'N/A'}:Q;}
function addRealNames(JSON,dashboard){if(JSON[0].realName)return JSON;JSON.each(function(Q){if(!dashboard){Q.realName=_this.DashboardRealNames[Q.S.toUpperCase()]}else{Q.realName=_this.DashboardSymbolToName[Q.S.toUpperCase()]}});return JSON;}}
Ziignight.prototype.PortfolioPreview=function(Symbols){var oSymbolsPortfolio=$('SymbolData'),aSymbols=Symbols.split(','),aHtml=[];aSymbols=aSymbols.sort(function(a,b){if(a>b)return 1;if(b>a)return-1;return 0;});aHtml.push('<table>');aHtml.push('<tbody>');aHtml.push('<tr>');aHtml.push('<th class="symbol">Symbol</th>');aHtml.push('<th colspan="2">Last Trade</th>');aHtml.push('<th colspan="3" class="change">Change</th>');aHtml.push('</tr>');aSymbols.each(function(Q,i){aHtml.push('<tr>');aHtml.push('<td class="symbol">'+'<a href="/symbol/'+Q.toLowerCase()+'">'+Q.toUpperCase()+'</a></td>');aHtml.push('<td class="last_trade loader" colspan="5">&nbsp;</td>');aHtml.push('</tr>');});aHtml.push('</tbody>');aHtml.push('</table>');oSymbolsPortfolio.update(aHtml.join(''));}
Ziignight.prototype.DashboardYearHash={};Ziignight.prototype.DashboardSymbolToName={"IWV":"Total U.S. Market","ICF":"U.S. Real Estate","TLT":"20+ Yr. Treasurys","LQD":"U.S. Corporate Bonds","HYG":"U.S. High Yield Bonds","IAU":"Gold","SLV":"Silver","GSG":"Commodities","IYM":"Basic Materials","IYK":"Consumer Goods","IYC":"Consumer Services","IYE":"Energy","IYG":"Financial","IYH":"Health Care","IYJ":"Industrial","IYW":"Technology","IDU":"Utilities","EEM":"Emerging Markets","EFA":"Developed Markets","ILF":"Latin America 40","FXI":"China","EWJ":"Japan","EWZ":"Brazil","EZU":"European Monetary Zone","EWW":"Mexico","EWT":"Taiwan","IJR":"Small Caps","IJH":"Mid Caps","IVV":"Large Caps","AGG":"Aggregate Bonds","ALT":"Alternative Assets","IGOV":"Int. Govt. Bonds","REZ":"Real Estate: Residential","DVY":"U.S. Dividend Stocks","IYR":"Real Estate: U.S.","IVE":"Large Cap Value","IJS":"Small Cap Value","SHY":"1-3 Yr Treasurys","IEF":"7-10 Yr Treasurys","TLH":"10-20 Yr Treasurys","TIP":"U.S. TIPs","MUB":"Municipal Bonds","WPS":"Real Estate: Foreign","IDV":"Int. Dividend Stocks","IWC":"U.S. Microcaps","PFF":"Preferred Stocks","EMB":"Emerging Mkt. Govt. Bonds","ITB":"Homebuilders","IWF":"Large Cap Growth","IWD":"Large Cap Value","IWP":"Mid Cap Growth","IWS":"Mid Cap Value","IWO":"Small Cap Growth","IWN":"Small Cap Value","XLK":"Tech Sector","XSD":"Semiconductors","IGV":"Software","TAN":"Solar","IGN":"Networking","XBI":"Biotech","XPH":"Pharmaceuticals","XLV":"U.S. Healthcare","IXJ":"Global Healthcare","IHI":"Medical Devices","IHF":"Healthcare Providers"};var socialSA={enabledProviders:["twitter","facebook","linkedin"],instances:{},gigya_units:[],in_progress:{},now_posting:0,init:function(){if(!is_users_cookie_exists())return;socialSA.gigya_units=$$(".gigya_unit");socialSA.gigya_units.each(function(unit){var instance_name=unit.getAttribute("gigya_id");socialSA.instances[instance_name]=new socialSAClass(unit);});},authenticate:function(network,unit_name){if(unit_name!='settings'&&readCookie(network+"_auth")>0){socialSA.set_checkbox_status(network,true);}else{if(unit_name=="settings"){createCookie('save_'+network,1,1);}
socialSA.in_progress['pop_'+network]=social_popup('/social/authenticate_'+network,network);}},disconnect:function(network){socialSA.in_progress[network]=1;new Ajax.Request('/social/disconnect',{parameters:{network:network},onComplete:function(transport){if(transport.status==200){socialSA.in_progress[network]=null;}}});},social_post:function(network,msg){socialSA.now_posting+=1;new Ajax.Request('/social/post_to_'+network,{method:'post',parameters:{msg:msg},onComplete:function(transport){socialSA.now_posting-=1;pageTracker._trackEvent(network.capitalize()+' Tracking','share',location.pathname);}});},set_checkbox_status:function(network,status){$$("."+network+" input").each(function(el){el.setAttribute("checked",status);el.checked=status;});},share_post_object:function(type){var post_object=readCookie('gigya_post_object');var socialSAObj=this.instances[type];if(post_object&&socialSAObj&&socialSAObj.selected_providers().length>0){socialSAObj.shareActivity(post_object);setTimeout(function(){if(window.share_callback)share_callback();window.share_callback=null;},3000);}else{if(window.share_callback)share_callback();window.share_callback=null;}
eraseCookie('gigya_post_object');},add:function(target,settings){if(!is_users_cookie_exists())return;target=$(target);var instance_name=target.getAttribute("gigya_id");socialSA.instances[instance_name]=new socialSAClass(target,settings);}}
function social_popup(url,network){socialSA.in_progress[network]=1;var popup=window.open(url,network+'_auth','width=500,height=300,resizable=yes');if(window.focus){popup.focus()}
socialSA.in_progress[network]=null;return popup;}
function socialSAClass(gigya_element,settings){var _this=this;this.element=gigya_element;this.name=gigya_element?gigya_element.getAttribute("gigya_id"):"dummy";this.settings=settings||{};var templates={"stocktalk":{prefix_html:"<div class=\"connect_text\">&nbsp;</div>",suffix_html:""},"settings":{prefix_html:"",suffix_html:""},"comment_yellow_note":{prefix_html:"",suffix_html:"<div class=\"add_btn_45\" onclick=\"socialSA.instances['comment_yellow_note'].shareActivity()\"><div class=\"l\"></div><div class=\"c\">Share</div><div class=\"r\"></div>"},"comment":{prefix_html:"<div class=\"connect_text\">&nbsp;</div>",suffix_html:""},"instablog":{prefix_html:"",suffix_html:""},"recommend":{prefix_html:"",suffix_html:""}}
var shareActivityTemplates={"comment_yellow_note":function(){if(_this.selected_providers().length==0){alert("On which network would you like to share your comment?");return;}
try{var commented_msg="Commented on: "+document.title.replace(/ -+ Seeking Alpha/,"");var url=$('short_url')?$('short_url').value:top.location.href.replace(/[\?|#].*$/,"");var msg=dottize(commented_msg,85)+" "+url;setTimeout(function(){$("yellow_edit_comment_2").update("Your comment has been shared"),_this.element.update("");},100);return msg;}catch(err){}},"recommend":function(){var target=$("recommend_txtarea");if(_this.selected_providers().length==0)return;var rMsg=target.value;var url=$('short_url')?$('short_url').value:top.location.href.replace(/[\?|#].*$/,"");rMsg=dottize(target.value,140-("I recommend "+url+" ").length);return"I recommend "+url+" "+rMsg;}}
var private_functions={boxesGenerator:function(settings){settings=settings||_this.settings;var showProviders=settings.showProviders||socialSA.enabledProviders;var autoCheck=(settings.autoCheck!=null?settings.autoCheck:true);function gen_onclick(){return"socialSA.instances."+_this.name+".checkbox_click(this)";}
function do_auto_check(network){return(connected_social.search(network)!=-1?"checked=\'1\'":"");}
var connected_social="";if(autoCheck&&user_cookie&&user_cookie.connected_social_accounts){connected_social=user_cookie.connected_social_accounts;}
var tmp_text=[];tmp_text.push('<div class="connected_and_approved">');if(templates[_this.name]&&templates[_this.name]["prefix_html"])tmp_text.push(templates[_this.name]["prefix_html"]);tmp_text.push("<span class='checkbox_wrapper'>");showProviders.each(function(network){tmp_text.push('<div class="'+network+'"><input type="checkbox" onclick="'+gen_onclick()+'"'+do_auto_check(network)+' /><span class="icon"></span></div>');});tmp_text.push("</span>");if(templates[_this.name]&&templates[_this.name]["suffix_html"])tmp_text.push(templates[_this.name]["suffix_html"]);tmp_text.push('</div>');return tmp_text.join(" ");}};this.selected_providers=function(){var result=[];if(this.element.getAttribute("disabled")=="true")return result;var checkboxes=this.element.select("input");checkboxes.each(function(checkbox){if(checkbox.checked){result.push(checkbox.parentNode.className);}});return result;}
this.checkbox_click=function(checkbox){var network=checkbox.parentNode.className;if(socialSA.in_progress[network]!=undefined||socialSA.in_progress[network]!=null){socialSA.set_checkbox_status(network,!checkbox.checked);return;}
if(socialSA.in_progress['pop_'+network]!=undefined&&socialSA.in_progress['pop_'+network].closed==false){socialSA.set_checkbox_status(network,!checkbox.checked);socialSA.in_progress['pop_'+network].focus();return;}
if(checkbox.checked){checkbox.checked=false;socialSA.authenticate(network,this.name);}else if(this.name=="settings"){socialSA.disconnect(network);}else{socialSA.set_checkbox_status(network,false);}}
this.shareActivity=function(msg,providers){if(shareActivityTemplates[this.name]){msg=shareActivityTemplates[this.name]();}
providers=this.selected_providers();if(providers.length>0&&msg){try{providers.each(function(provider){socialSA.social_post(provider,msg);});}catch(err){alert(err);}}}
if(this.element)this.element.innerHTML=private_functions.boxesGenerator();}
var Messaging={sendMessage:function(id_coding,source){pageTracker._trackEvent('Compose Direct Message',source);if(is_users_cookie_exists()){if(id_coding){top.location.href='/inbox/compose?to='+id_coding}else{top.location.href='/inbox/compose'}}else{Authentication.Authenticate(id_coding,"send_message",{Login:"Messaging.Login",Register:"Messaging.Register",ForgotPassword:"Messaging.ForgotPassword"},{Login:"send messages to others",Close:""});}},Login:function(id_coding){set_login_and_registration_header();if(id_coding)top.location.href='/inbox/compose?to='+id_coding;else top.location.href='/inbox/compose';},Register:function(){var aHtml=[];aHtml.push("<div id='readlater_register_login'>");aHtml.push("<div class='email_sent'><h4>Email sent!</h4><div>We've sent confirmation email to your inbox - it includes a link you should follow<br/>to activate your account. If you can't find it, please check your spam filter.</div></div>");aHtml.push("<div class='close_quickread_stretchable' onclick='AlphaBox.Close();'><span class='close_left'></span><span class='close_text'>Close</span><span class='close_right'></span></div>");aHtml.push("<br class='cleaner'/></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};},ForgotPassword:function(){var aHtml=[];aHtml.push("<div id='readlater_register_login'>");aHtml.push("<div class='email_sent'><h4>Email sent!</h4><div>We've sent instructions on how to reset your password to your email inbox.<br/>If you can't find it, please check your spam filter.</div></div>");aHtml.push("<div class='close_quickread_stretchable' onclick='AlphaBox.Close();'><span class='close_left'></span><span class='close_text'>Close</span><span class='close_right'></span></div>");aHtml.push("<br class='cleaner'/></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};}}
var LeaderBoard={}
LeaderBoard.popup_timeout;LeaderBoard.openPopupDelay_timeout;LeaderBoard.currently_open=null;LeaderBoard.loadAjaxPopup=function(user_id){clearTimeout(LeaderBoard.openPopupDelay_timeout);LeaderBoard.openPopupDelay_timeout=setTimeout(function(){LeaderBoard.loadAjaxPopup_Delayed(user_id)},300);}
LeaderBoard.loadAjaxPopup_Delayed=function(user_id){if(LeaderBoard.popup_timeout)clearTimeout(LeaderBoard.popup_timeout);if($("commenter_data_popup_"+LeaderBoard.currently_open))$("commenter_data_popup_"+LeaderBoard.currently_open).style.display="none";if($("leaderboard_open_popup_arrow_"+LeaderBoard.currently_open))$("leaderboard_open_popup_arrow_"+LeaderBoard.currently_open).style.display="none";if($('stop_following_person_'+user_id)){$('stop_following_person_'+user_id).style.display="block";}
if(user_id==0)return;$('leaderboard_open_popup_arrow_'+user_id).style.display="block";LeaderBoard.currently_open=user_id;var user_content_from_ajax=$("leader_"+user_id);if(user_content_from_ajax.getAttribute('refilled')=="false"){new Ajax.Request('/account/ajax_user_details',{asynchronous:true,parameters:"user_id="+user_id,onComplete:function(transport){if(transport.status==200&&transport.responseText!="failed"){user_content_from_ajax.setAttribute("refilled","true");user_content_from_ajax.update(transport.responseText.replace("user_follow_comment_id","user_follow_"+user_id));Follow.comment__follow_button_initiator(user_id,user_id);if(LeaderBoard.currently_open==user_id)$("commenter_data_popup_"+user_id).style.display="block";}else{$('commenter_data_popup_'+user_id).style.display="block";}}});}else{$('commenter_data_popup_'+user_id).style.display="block";}}
LeaderBoard.CloseAjaxPopup=function(user_id){if(user_id==0)return;LeaderBoard.popup_timeout=setTimeout(function(){$("commenter_data_popup_"+user_id).style.display="none";$('leaderboard_open_popup_arrow_'+user_id).style.display="none";if($('stop_following_'+user_id)){$('stop_following_'+user_id).style.display='none';}},2000);}
LeaderBoard.clearPopupTimeout=function(){if(LeaderBoard.popup_timeout)clearTimeout(LeaderBoard.popup_timeout);}
var brokers=["alpari.co.uk","alpari.ru","alpari.co.il","alpari-us.com","xforex.com","ac-markets.com","choicetrade.com","sharebuilder.com","eztrader.com","folioinvesting.com","gftforex.com","interactivebrokers.com","lightspeed.com","nobletrading.com","pfgbest.com","tradestation.com","usaa.com","just2trade.com","optionshouse.com","sogotrade.com","eoption.com","marscoinvestments.com","zecco.com","lowtrades.com","tradeking.com","mbtrading.com","izone.com","firstrade.com","wangvest.com","scottrade.com","terranovatrading.com","trademonster.com","mytradz.com","cobratrading.com","tradingdirect.com","thinkorswim.com","tdameritrade.com","zionsbank.com","investrade.com","marketrade.com","schwab.com","etrade.com","baisidirect.com","aosbroker.com","msiebert.com","jettrade.com","optionsxpress.com","placetrade.com","wallstreete.com","freedominvestments.com","cambridge-discount.com","fbrdirect.com","seaportonline.com","state-online.com","trutrade.com","usdb.com","jhdarbie.com","wrhambrecht.com","fidelity.com","civiliancapital.com","troweprice.com","wellsfargo.com","clarkfinancial.com","downstate.com","pncinvest.com","wsaccess.com","ameriprise.com","internettrading.com","mycititrade.com","vanguard.com","penntrade.com","mldirect.ml.com","benjaminandjerold.com","netvest.com"];var advanced_pages=['/dashboard/investing_ideas','/tag/transcripts','/dashboard/etfs','/currents/'];function advanced_trader(path){if(readCookie('c_p1')=='1')return true;if(is_users_cookie_exists()){createCookie('c_p1','1');return true;}
for(var i=0,len=advanced_pages.length;i<len;i++){if(path.match(advanced_pages[i])){createCookie('c_p1','1',2000);return true;}}
if(typeof(article_dashboards)!="undefined"){var dashboards=/@investing-ideas@|@etfs@|@transcript@/i
if(article_dashboards.match(dashboards)){createCookie('c_p1','1',2000);return true;}}
return false;}
function from_broker_urls(user_interests){var page_referrer=top.document.referrer;for(var i=0,len=brokers.length;i<len;i++){if(page_referrer.match(new RegExp(brokers[i],"i"))){createCookie('c_p2','1',30);return true;}}
if(user_interests.match(/,13399,/)){createCookie('c_p2','1',30);return true;}
return(readCookie('c_p2')=='1');}
function from_bloomberg(path_filter){if((/source=bloomberg/).test(path_filter)){createCookie('xp_src','bm',3000);return true;}}
function has_etf_on_portfolio(user_interests){if(is_users_cookie_exists()){if(user_interests.match(/,23,/)){createCookie('c_p12','1',1);return true;}
if((readCookie('c_p12')==null)||(readCookie('c_p12')=='')){var user_id=readCookie('user_id');new Ajax.Request('/users/ajax_has_etf_on_portfolio',{asynchronous:true,evalScripts:true,parameters:"user_id="+user_id,onComplete:function(transport){if(transport.status==200){if(transport.responseText=='true'){createCookie('c_p12','1',1);}else{createCookie('c_p12','0',1);}}}});}}
return true;}
function create_cp_cookie(name,value,days){var cookieStr="";if(cookieExists('c_p')){var cookieCont=readCookie('c_p');}else{var cookieCont="-------------------";}
var arr=cookieCont.split('-');var cookieIndex=name.replace("c_p","");var exdate=new Date();exdate.setDate(exdate.getDate()+days)
arr[cookieIndex]=exdate.getTime();createCookie('c_p',arr.join("-"),10000);}
function read_cp_cookie(name){if(!cookieExists('c_p')){create_cp_cookie('c_p0',1,0);}
var arr=readCookie('c_p').split('-');cookieIndex=name.replace("c_p","");if(arr[cookieIndex]==""||arr[cookieIndex]==null||arr[cookieIndex]==undefined){return null;}
var exdate=new Date();if(exdate.getTime()<arr[cookieIndex]){return 1;}
return null;}
var cp_cookie_exceptions=[1,3,12];function array_cp_profiles(){if(!readCookie('c_p')){create_cp_cookie('c_p0',1,0);}
var arr=readCookie('c_p').split('-');var res=[];var exdate=new Date();for(var i=0;i<arr.length;i++){if(cp_cookie_exceptions&&cp_cookie_exceptions.indexOf(i)!=-1){if(readCookie('c_p'+i)=="1"){res.push("p="+i);}}else{if(exdate.getTime()<arr[i]){res.push("p="+i);}}}
return res;}
function see_etf(path,user_interests,user_non_watchlist_slugs){if(path.match('/dashboard/etfs')||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@etfs@/i)))){create_cp_cookie('c_p4','1',30);return true;}
if(user_interests.match(/,23,/)||user_non_watchlist_slugs.match(/etf-content-once-daily-newsletter/i)){create_cp_cookie('c_p4','1',30);return true;}
if(read_cp_cookie('c_p4'))return true;}
function see_options(path_filter,user_interests,user_non_watchlist_slugs){if((/filters=.*?options/).test(path_filter)||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@options@/i)))){create_cp_cookie('c_p5','1',30);return true;}
if(user_interests.match(/,3081,/)||user_non_watchlist_slugs.match(/investing-ideas/i)){create_cp_cookie('c_p5','1',30);return true;}
if(read_cp_cookie('c_p5'))return true;}
function see_gold(path_filter,user_non_watchlist_slugs){if((/filters=.*?gold-and-precious-metals/).test(path_filter)||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@gold-and-precious-metals@/i)))){create_cp_cookie('c_p6','1',30);return true;}
if(user_non_watchlist_slugs.match(/stocks-sectors/i)){create_cp_cookie('c_p6','1',30);return true;}
if(read_cp_cookie('c_p6'))return true;}
function see_commodities(path_filter,user_non_watchlist_slugs){if((/filters=.*?commodities/).test(path_filter)||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@commodities@/i)))){create_cp_cookie('c_p7','1',30);return true;}
if(user_non_watchlist_slugs.match(/macro-view/i)){create_cp_cookie('c_p7','1',30);return true;}
if(read_cp_cookie('c_p7'))return true;}
function see_mutualfunds(user_interests){if(user_interests.match(/,13513,/)){create_cp_cookie('c_p8','1',30);return true;}
if(read_cp_cookie('c_p8'))return true;}
function has_etn_in_portfolio(){if(is_users_cookie_exists()&&readCookie('user_watchlist_slugs')){var etn_array=['aavx','adz','aga','agf','amj','ayt','bal','balc','barl','bbvx','bcm','bdcl','bdcs','bdd','bdg','blng','bom','bos','bunl','bunt','bwv','bxdb','bxdc','bxub','bxuc','cafe','carb','ccvx','choc','cny','cow','cowc','csls','csma','csmb','csmn','ctnn','cupm','cvol','dag','dcng','ddp','ddvx','dee','defl','dfvl','dfvs','dgaz','dgld','dgp','dgz','dirt','djci','djp','djpc','dlbl','dlbs','dod','doil','dpu','drgs','drr','dslv','dstj','dsxj','dto','dtul','dtus','dtyl','dtys','dwti','dyy','dzz','eeh','eevx','eipl','eipo','emlb','emsa','ero','ffvx','flat','foil','fud','fue','gaz','gazc','gbb','gce','grn','gru','grwn','gsc','gsp','gspc','gwo','hevy','ici','infl','inp','inr','ipal','iplt','itlt','itly','ivop','jem','jft','jgbd','jgbl','jgbs','jgbt','jja','jjac','jjc','jjcc','jje','jjec','jjg','jjgc','jjm','jjmc','jjn','jjnc','jjp','jjpc','jjs','jjsc','jjt','jjtc','jju','jjuc','jo','jyn','lbnd','lcpr','ld','ldc','ledd','lpal','lplt','lsc','lstk','mfla','mfsa','mlpg','mlpi','mlpl','mlpn','mlps','mlpw','mlpy','nib','nibc','nini','off','oil','oilc','olem','olo','ong','onn','pgd','pgm','plac','ptd','ptm','rja','rji','rjn','rjz','rola','rosa','rtla','rtsa','rwxl','sbnd','sbv','scpr','sfla','sfsa','sgar','sgg','spgh','ssdd','ssdl','stpp','szo','tbar','tndq','trnd','trnm','tvix','tviz','twti','uag','ubc','ubg','ubm','ubn','uci','udnt','ugaz','ugld','uoil','urr','uslv','usv','uupt','uwti','viix','viiz','vqt','vxaa','vxbb','vxcc','vxdd','vxee','vxff','vxx','vxz','vzzb','weet','wmw','xiv','xvix','xvz','xxv','ziv'];var portfolio_tags=readCookie('user_watchlist_slugs').split(",");if(portfolio_tags.intersect(etn_array).length>0){create_cp_cookie('c_p9','1',30);return true;}
if(read_cp_cookie('c_p9'))return true;}}
function see_retirement(user_interests){if(user_interests.match(/,866,/i)){createCookie('c_p10','1',30);return true;}
if(read_cp_cookie('c_p10'))return true;}
function see_ipo_scup_transcripts(path,path_filter){if(path.match(/transcripts/)||(/filters=.*?ipo-analysis/).test(path_filter)||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@transcripts@/i)||article_sectors_themes.match(/@ipo-analysis@/i)))){create_cp_cookie('c_p11','1',30);return true;}
if(read_cp_cookie('c_p11'))return true;}
function see_health_or_biotech(path_filter,user_interests,user_non_watchlist_slugs){if((/filters=.*?biotechnology/).test(path_filter)||(/filters=.*?healthcare/).test(path_filter)||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@biotechnology@/i)||article_sectors_themes.match(/@healthcare@/i)))){create_cp_cookie('c_p13','1',30);return true;}
if(user_interests.match(/,13499,/i)||user_non_watchlist_slugs.match(/stocks-sectors/i)){create_cp_cookie('c_p13','1',30);return true;}
if(read_cp_cookie('c_p13'))return true;}
function see_bonds(path_filter,user_interests){if(user_interests.match(/,528,/i)){createCookie('c_p14','1',30);return true;}
if(read_cp_cookie('c_p14'))return true;}
function see_fund_holdings(path_filter,user_non_watchlist_slugs){if((/filters=.*?fund-holdings/).test(path_filter)||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@fund-holdings@/i)))){create_cp_cookie('c_p16','1',10);return true;}
if(user_non_watchlist_slugs.match(/macro-view/i)){create_cp_cookie('c_p16','1',10);return true;}
if(read_cp_cookie('c_p16'))return true;}
function interest_in_gold(user_interests){if(user_interests.match(/,4600,/i)){create_cp_cookie('c_p17','1',30);return true;}
if(read_cp_cookie('c_p17'))return true;}
function see_etns(path){if(path.match('/tag/exchange-traded-notes')||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@exchange-traded-notes@/i)))){create_cp_cookie('c_p17','1',30);return true;}
if(read_cp_cookie('c_p17'))return true;}
function see_energy(path,user_interests,user_non_watchlist_slugs){if(path.match('/sector/energy')||((typeof(article_sectors_themes)!="undefined")&&(article_sectors_themes.match(/@energy@/i)))){create_cp_cookie('c_p18','1',30);return true;}
if(user_interests.match(/,13499,/i)||user_non_watchlist_slugs.match(/stocks-sectors|alternative-energy-once-daily-newsletter/i)){create_cp_cookie('c_p18','1',30);return true;}
if(read_cp_cookie('c_p18'))return true;}
function fp_logged_out_user(){if(location.search.toQueryParams().ifp=='1'){createCookie('xp','t',3000);}}
function user_profiles(){var path=top.location.pathname;var path_filter=top.location.search.toLowerCase()
var user_interests='';var user_non_watchlist_slugs='';if(is_users_cookie_exists()){user_interests=","+readCookie('user_interests')+",";user_non_watchlist_slugs=readCookie('user_non_watchlist_slugs')
if(!user_non_watchlist_slugs){user_non_watchlist_slugs='';}}
from_broker_urls(user_interests);from_bloomberg(path_filter);advanced_trader(path);see_etf(path,user_interests,user_non_watchlist_slugs);see_options(path_filter,user_interests,user_non_watchlist_slugs);see_gold(path_filter,user_non_watchlist_slugs);see_commodities(path_filter,user_non_watchlist_slugs);see_mutualfunds(user_interests);has_etn_in_portfolio();see_retirement(user_interests);see_ipo_scup_transcripts(path,path_filter);has_etf_on_portfolio(user_interests);see_health_or_biotech(path_filter,user_interests,user_non_watchlist_slugs);see_bonds(path_filter,user_interests);see_fund_holdings(path_filter,user_non_watchlist_slugs);interest_in_gold(user_interests);if(!cookieExists('c_p3')&&cookieExists('machine_cookie')){new Ajax.Request('/mone_pv',{asynchronous:true,method:'post',postBody:readCookie('machine_cookie')});}}
var start_p=location.hash.slice(1);var App_auth_timeout_array={};var AppAPI={sajs_receive:function(received_hash){var fields=received_hash.split("&&");fields.each(function(field){var fContent=decodeURIComponent(field.replace(/\w+\=/,""));this.func[field.split("=")[0]](fContent,received_hash);}.bind(this));},read_hash_param:function(param_name){return AppAPI.get_hash_param(location.hash,param_name)},get_hash_param:function(hash,param_name){if(hash.charAt(0)=="#")hash=hash.slice(1);var fields=hash.split("&&"),result="";fields.each(function(field){if(field.split("=")[0]==param_name){result=decodeURIComponent(field.replace(/\w+\=/,""));}});return result;},transmit_to_app:function(hostname,mytext,Iframe_Name){var hiddenDiv=document.getElementById("hiddenDiv");if(!hiddenDiv){hiddenDiv=document.createElement('DIV');hiddenDiv.id="hiddenDiv";document.body.appendChild(hiddenDiv);hiddenDiv.style.cssText="width:100%;height:50px;display:none";}
hiddenDiv.innerHTML="<iframe width='100%' name='SAPort' src='"+hostname+"/app_receiver.html#"+mytext+(Iframe_Name?"&&tar="+Iframe_Name:"")+"' height='500'></iframe>";},func:{af:function(fContent){fContent=fContent.split("|");var app_id=fContent[0];var price=fContent[1];var des=fContent[2];if(typeof(window.show_add_funds_popup)=="function")
show_add_funds_popup(app_id,price,des);},ss:function(fContent){var url=fContent;window.open(url,'_blank');},ess:function(fContent){fContent=fContent.split("|");var ssurl=fContent[0];var app_id=fContent[1];var key=fContent[2];var aHTML=[];aHTML=[];AlphaBox.Loading();aHTML.push("<div class='recommend_lightbox' id='readlater_register_login' style='float:left;position:relative'>");aHTML.push("<div class='x_button' onclick='AlphaBox.Close();'></div>")
aHTML.push("<div class='title'>Share This Image with your Friends</div>");aHTML.push("<img src='"+ssurl+"'/>");aHTML.push("<form id='form_send_email' method='post' action='/app_users/send_email_from_app'>");aHTML.push("<input type='hidden' name='app_id' value='"+app_id+"'/>");aHTML.push("<input type='hidden' name='key' value='"+key+"'/>");aHTML.push("<input type='hidden' name='img_src' value='"+ssurl+"'/>");aHTML.push("<div>Share with the following friends (email addresses):</div>");aHTML.push("<input type='text' name='email'/>");aHTML.push("<div>Message (optional):</div>");aHTML.push("<textarea name='content'></textarea>");aHTML.push("<div id='submit_button' onclick=\"insert_loader_to_element('submit_button','loader_support_app','/images/redbox_spinner.gif'); $('form_send_email').request({onComplete: function(){ AlphaBox.Close()}}); return false;\" class='stretch_bttn_33px'>");aHTML.push("  <div class='left'></div>");aHTML.push("  <div class='mid'>Submit</div>");aHTML.push("  <div class='right'></div>");aHTML.push("</div>");aHTML.push("<div onclick='AlphaBox.Close();' class='stretch_bttn_33px'>");aHTML.push("  <div class='left'></div>");aHTML.push("  <div class='mid'>Cancel</div>");aHTML.push("  <div class='right'></div>");aHTML.push("</div>");aHTML.push("</div>");aHTML.push("<div class='cleaner'></div></form>");aHTML.push("<div class='cleaner'></div>");AlphaBox.AddHtml(aHTML.join(""));},ib:function(fContent){fContent=fContent.split("|");var screenshotUrl=fContent[0];var app_id=fContent[1];var title=fContent[2];location="/account/write_post?screenshot="+encodeURI(screenshotUrl)+"&title="+encodeURI(title)+"&app_id="+encodeURI(app_id);},fts:function(fContent){fContent=fContent.split("|");var screenshotUrl=fContent[0];var app_id=fContent[1]
var aHtml=[]
aHtml.push("<div id='readlater_register_login' class='recommend_lightbox'>");aHtml.push("<div>");aHtml.push("<div class='done_area'>");aHtml.push("<div class='sharing_and_gigya'>");aHtml.push("<div class='gigya_place_holder'><div class=\"gigya_unit\" gigya_id=\"app_screenshot_share\" id=\"app_screenshot_share\"></div></div>");aHtml.push("<div class='strong_button'><div class='strong_button_left'></div><div class='strong_button_center' onclick='gigya_app_share_screenshot(\""+encodeURI(screenshotUrl)+"\","+app_id+")' >Done</div><div class='strong_button_right'></div></div>");aHtml.push("</div>");aHtml.push("<br><div style='color:red' id='share_box_error'></div>");aHtml.push("</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop' onclick='AlphaBox.Close();'></div>");aHtml.push("</div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));socialSA.add('app_screenshot_share');},p:function(fContent){if(top.location.pathname.match(/\/app_canvas\//)&&(fContent!="/"))
top.location.hash="p="+fContent;},r:function(fContent,received_hash){if(start_p&&(AppAPI.get_hash_param(start_p,"p")==AppAPI.get_hash_param(received_hash,"p")))start_p="";if(top.location.pathname.match(/\/app_canvas\//)&&start_p){AppAPI.transmit_to_app(fContent,"r="+AppAPI.get_hash_param(start_p,"p"));start_p="";}},resize:function(fContent){fContent=fContent.split("|");var app_id=fContent[0],height=fContent[1];if(height==0)return;if($("app_loading_"+app_id))$("app_loading_"+app_id).style.display="none";if(iApp=$("APP_"+app_id)){if((parseInt(iApp.getAttribute("original_height"))>height)){morph_with_parent(iApp,height);}
else{morph_with_parent(iApp,iApp.getAttribute("original_height"));}}else
if(iApp=$("APP")){if(parseInt(iApp.getAttribute("original_height"))<height){morph_with_parent(iApp,height);}
else{morph_with_parent(iApp,iApp.getAttribute("original_height"));}}},auth:function(fContent){if(isNaN(parseInt(fContent)))return false;clearTimeout(App_auth_timeout_array[fContent]);$("app_loading_"+fContent).style.display="none";},run_full_app:function(fContent){fContent=fContent.split("|");var app_id=fContent[0];var app_params=''
if(fContent[1]){app_params='?'
var count=fContent[1].split('&').length
fContent[1].split('&').each(function(el){el=el.split('=')
if(count>1)
app_params=app_params+"app_params["+el[0]+"]="+el[1]+"&";else
app_params=app_params+"app_params["+el[0]+"]="+el[1];count=count-1});}
location="/app_canvas/"+app_id+app_params;},upgrade_app:function(fContent){var app_id=fContent;location="/store/app/"+app_id+"/overview#upgrade";}}}
function share_add_zero_to_facebook(){fb_arr=[];$$('span').each(function(item){if(item.className=='fb_share_count_inner'){fb_arr.push(item);}})
if(fb_arr.size()>0){if(fb_arr[0]&&fb_arr[0].innerHTML.match("&nbsp;"))
fb_arr[0].innerHTML=0;if(fb_arr[1]&&fb_arr[1].innerHTML.match("&nbsp;"))
fb_arr[1].innerHTML=0;}}
var attempt_facebook_correction=0;function set_correct_likes(){if(attempt_facebook_correction>10){$$('.fb_share_count_inner').each(function(e){e.innerHTML="0";});return;}
try{if(FB&&FB.Share&&FB.Share.results[location.href]){$$('.fb_link_button_count','.fb_link_box_count').each(function(e){FB.Share.displayBox(e,FB.Share.pretty(e.fb_count));})}else{setTimeout(set_correct_likes,200);}}catch(e){setTimeout(set_correct_likes,200);}
attempt_facebook_correction++;}
popup_content="";function open_linked_in(){var linkedin=window.open("http://www.linkedin.com/shareArticle?mini=true&url="+escape(top.location.href)+"&title="+escape(document.title.replace("-- Seeking Alpha",""))+"&source="+escape("Seeking Alpha"),'LinkedIn',"width=520,height=570")
return;var hamus=[];if(socialSA.providers.indexOf("linkedin")==-1){hamus.push('<div id="readlater_register_login" class="make_sharing_lightbox">');hamus.push('<div>Make sharing easier by connecting your Linkedin and Seeking Alpha accounts:</div><br>')
hamus.push('<span class="connect_with_linkedin_button" onclick="gigyaSA.connectTo(\'linkedin\');AlphaBox.Close()"> </span>');hamus.push('<div class="no_thanks_exit_div"><span class="no_thanks_exit" onclick="if (oRefresher) { oRefresher.Activate() };AlphaBox.Close();"><span>[</span>No thanks<span>]</span></span></div>');hamus.push('<div class="cleaner"></div>');hamus.push('<div class="close_pop" onclick="if (oRefresher) { oRefresher.Activate() };AlphaBox.Close();"></div>');hamus.push('</div>');window.blur();popup_content=hamus.join("");Event.observe(window,'focus',popupOnWindowFocus);}}
function open_facebook(){return;var hamus=[];if(socialSA.providers.indexOf("facebook")==-1){hamus.push('<div id="readlater_register_login" class="make_sharing_lightbox">');hamus.push('<div>Make sharing easier by connecting your Facebook and Seeking Alpha accounts:</div><br/>')
hamus.push('<span class="connect_with_facebook_button" onclick="gigyaSA.connectTo(\'facebook\');AlphaBox.Close()"></span>');hamus.push('<div class="no_thanks_exit_div"><span class="no_thanks_exit" onclick="if (oRefresher) { oRefresher.Activate() };AlphaBox.Close();"><span>[</span>No thanks<span>]</span></span></div>');hamus.push('<div class="cleaner"></div>');hamus.push('<div class="close_pop" onclick="if (oRefresher) { oRefresher.Activate() };AlphaBox.Close();"></div>');hamus.push('</div>');window.blur();popup_content=hamus.join("");Event.observe(window,'focus',popupOnWindowFocus);}}
function init_facebook(){if(!$('fb-root')){var fb_root=document.createElement('div');fb_root.id="fb-root";document.body.appendChild(fb_root);}
(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=115634711798315";var runFun=bind_facebook_events
if(document.all){js.onreadystatechange=function(){if(js.readyState=='loaded'||js.readyState=='complete'){runFun();js.onreadystatechange="";}}}else{js.onload=runFun;}
fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));}
function init_linkedin(){var newIN=document.createElement('script');newIN.type='text/javascript';newIN.src='http://platform.linkedin.com/in.js';document.body.appendChild(newIN);}
function popupOnWindowFocus(){Event.stopObserving(window,'focus',popupOnWindowFocus);if(is_users_cookie_exists()){AlphaBox.Loading();AlphaBox.AddHtml(popup_content);}else{var full_message="<strong>Thanks for sharing!</strong><br>Now you can join Seeking Alpha to follow authors and contribute posts of you own."
Authentication.Authenticate('login',"footer_login",{Login:"FooterBar.Login",Register:"FooterBar.Register",ForgotPassword:"FooterBar.ForgotPassword"},{CustomMessage:full_message,Close:""});}}
function twittememeFrame(iSize){var iSize=iSize.split("x")
document.write('<iframe scrolling="no" height="'+iSize[1]+'" width="'+iSize[0]+'" marginwidth="0" marginheight="0" frameborder="0" vspace="0" hspace="0" src="/twittframe.html?que='+window.tweetmeme_style+'"></iframe>');}
var plusone_visited=0;function plusone_not_supported(){if(plusone_visited>0)return;plusone_visited++;$$('.plusone_wrap').each(function(e){Event.observe(e,'click',function(){alert('The feature you are trying to access is not supported by this browser.')});});}
function init_twitter(){!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");bind_twitter_events();}
var try_twitter_binding=0;function bind_twitter_events(){if(typeof(twttr)!="undefined"){twttr.events.bind('tweet',twitter_callback);twttr.events.bind('follow',twitter_callback);return;}
if(try_twitter_binding<20)setTimeout(bind_twitter_events,200);try_twitter_binding++;}
function bind_facebook_events(){FB.Event.subscribe('edge.create',function(h,w){facebook_callback('like',h,w)});FB.Event.subscribe('edge.remove',function(h,w){facebook_callback('unlike',h,w)});}
function init_plusone(){if(SA.Utils.Env.isIE7){var el=$$(".plusone");var size=el.length;for(var i=0;i<size;i++){el[i].remove();}
plusone_not_supported();return;}
var po=document.createElement('script');po.type='text/javascript';po.async=true;po.src='https://apis.google.com/js/plusone.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(po,s);}
function plusone_callback(e){var type=(e.state=="off")?"unlike":"like";pageTracker._trackEvent('Plusone Tracking',type,location.pathname);}
function twitter_callback(e){pageTracker._trackEvent('Twitter Tracking',e.type,location.pathname);}
function linkedin_callback(e){pageTracker._trackEvent('Linkedin Tracking','like',location.pathname);}
function facebook_callback(type,href,widget){if(widget._attr.ref!=undefined){type+=" "+widget._attr.ref;}
pageTracker._trackEvent('Facebook Tracking',type,location.pathname);}
function social_buttons_init(){if($$('.linkedin_share').length)init_linkedin();if($$('.facebook_share').length)init_facebook();if($$('.plusone_share').length)init_plusone();if($$('.twitter_share').length)init_twitter();}
ABTest=function(experiment,values){this.value=values[(ABTest.identity-1)%values.length];this.experiment=experiment;this.test=function(){sendEvent(this,'page views')
return this.value;}
this.convert=function(label){sendEvent(this,(label||'conversions'));}
var sendEvent=function(test,label){if(!test.notrack)SA.Stats.GA.event('AB-Testing: '+test.experiment,''+test.value,label,0,true);}}
ABTest.identity=parseInt(location.href.toQueryParams().abid);if(!ABTest.identity){ABTest.identity=parseInt(readCookie('machine_cookie'));if(!ABTest.identity){ABTest.identity=Math.round((new Date).getTime()+Math.random()*1000000003366);createCookie('machine_cookie',ABTest.identity,2000);}}
function open_header_log_in_popup_lightbox(Action,LoginMessage,FocusOn){Authentication.Authenticate(Action,"footer_login",{Login:"FooterBar.Login",Register:"FooterBar.Register",ForgotPassword:"FooterBar.ForgotPassword"},{Login:LoginMessage,Close:""},"",FocusOn?FocusOn:"");}
var FooterBar={};FooterBar.Login=function(Response){var sAction=Response.split('|')[0];if(location.href.match('/real-time-alerts'))sAction='email';switch(sAction){case'email':top.location.href='/account/email_preferences';break;case'portfolio':top.location.href='/account/portfolio';break;case'write_post':top.location.href='/account/write_post';break;case'stocktalk':var user_id=readCookie('user_id');top.location.href='/user/'+user_id+'/stocktalk';break;case'my_app':top.location.href='/store/my-applications';break;case'symbol_app':top.location.href='/symbol/'+Response.split('|')[1]+'/apps';break;case'login':case'headtabs_login':case'hp_login':case'abheadtabs_login':top.location.reload();break;}}
FooterBar.Register=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>Please confirm your registration by clicking the link in the email we've sent to "+registered_mail+".</h3>");aHtml.push("<div class='cant_see_note'>(If you can't see it, please check your junk mail folder)</div>");aHtml.push("</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};}
FooterBar.ForgotPassword=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>We've sent instructions on how to reset your password to your email inbox.</h3>");aHtml.push("<div class='cant_see_note'>(If you can't find it, please check your spam filter.)</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));if(oRefresher){oRefresher.Activate()};}
FooterBar.LoginAndRedirect=function(url){top.location.href=url;};(function(){var scope=SA.UsingNamespace("SA.Navigation");scope.Top=new function(){var user_id,user_nick,profile_href,author_slug,c_notifications='',e_notifications='',alert_notifications='',alert_link_color,update_cookies,menu,header_height,header;var availableABVersions={"alerts":['turquoise']};this.overrideABVersions=function(versions){availableABVersions=versions;}
this.init=function(){scope.Top.saveUserData();scope.Top.sticky();scope.Top.setTopMenuHovers();scope.Top.setAlertsLink();scope.Top.setUserDropdown();scope.Top.setWritingDropdown();scope.Top.setUserNotifications();var mobile_top=$$('.mobile_or_full_site');var extra=(mobile_top&&mobile_top.length>0)?mobile_top[0].getHeight():0;var headerNodeElement=$('header')
var navContainerWrapNodeElement=$('nav_container_wrap');header_height=(headerNodeElement&&navContainerWrapNodeElement)?Math.max(extra+headerNodeElement.getHeight()-navContainerWrapNodeElement.getHeight()-2,0):100;new SA.Utils.TopNavPopUp().Init('top_nav_arrow','user_settings_pop');new SA.Utils.TopNavPopUp().Init('instablog_pop_btn','instablog_nav_dropdown');}
this.reset=function(){if($('notificiations_popup'))$('notificiations_popup').remove();if($('notifications_alert'))$('notifications_alert').remove();if($('writing_menu'))$('writing_menu').remove();$$('.floating_message_li').each(function(e){e.remove();});scope.Top.init();}
this.saveUserData=function(){if(SA.Data.User.loggedIn()){user_id=SA.Data.User.id();user_nick=readCookie('user_nick');author_slug=SA.Data.User.authorSlug();if(user_nick==null||user_nick=="")user_nick="User "+user_id;profile_href=(author_slug==null||author_slug=='')?"/user/"+user_id+"/profile":"/author/"+author_slug;update_cookies=readCookie('user_update_note_cookies');var n_cookie_str=readCookie('user_notifications');if(update_cookies=='undefined'||update_cookies==null)update_cookies='';if(n_cookie_str=='undefined'||n_cookie_str==null)n_cookie_str='';var n_cookie_arr=n_cookie_str.split("|");if(n_cookie_arr.length==3){c_notifications=n_cookie_arr[0];e_notifications=n_cookie_arr[1];alert_notifications=n_cookie_arr[2];}}}
this.setAlertsLink=function(){var alerts=$$('#nav_container li[thistab=alerts] a');if(alerts.length==0)return;var alert_link=alerts[0];alert_link_color=new ABTest('Alerts Top Nav',availableABVersions["alerts"]);if(alert_link_color.value=='turquoise')alert_link.addClassName('turquoise');if(alert_link_color.value=='white')alert_link.addClassName('white');if(SA.Data.User.loggedIn())alert_link.href="/account/email_preferences";alert_link.setAttribute("sasource","headtabs_alerts_"+alert_link_color.value);}
this.setWritingDropdown=function(){if(!SA.Data.User.loggedIn()||typeof(user_cookie.writing_status)=="undefined")return;var aHtml=[];if(user_cookie.writing_status=="contributor"){aHtml.push('<li id="writing_menu" class="contributor_nav"><a href="/account/write_post_new">Contributor Center</a><span class="navi_right_corner">|</span></li>');}else if(user_cookie.writing_status=="instablogs"){aHtml.push('<li id="writing_menu" class="instablogs_nav">');aHtml.push('<span id="instablog_pop_btn" class="top_nav_arrow_down" style="cursor:pointer;">Instablog</span><span class="navi_right_corner">|</span>');aHtml.push('<ul id="instablog_nav_dropdown" style="display:none;">');aHtml.push('<li><a href="/user/'+user_id+'/instablog" onclick="trackLink(this,\'Instablog Menu Tracking\',\'View Instablog\',location.href);">View Instablog</a></li>');aHtml.push('<li><a href="/account/write_post_new?publish_type=instablog" onclick="trackLink(this,\'Instablog Menu Tracking\',\'Write Instablog Post\',location.href);">Write Instablog Post</a></li>');aHtml.push('<li><a href="/account/become_a_contributor" onclick="trackLink(this,\'Instablog Menu Tracking\',\'Become a Contributor\',location.href);">Become a Contributor</a></li>');aHtml.push('</ul>');aHtml.push('</li>');}
$('user_settings_wrapper').insert({before:aHtml.join("")});}
this.setTopMenuHovers=function(){var menu_items=$$('#nav_container li[thistab]');for(var i=0;i<menu_items.length;i++){if($('nav_container').getAttribute('headtab')==menu_items[i].getAttribute('thistab')){addThisClass(menu_items[i],'yes_selected_not_new');continue;}
menu_items[i].observe('mouseover',function(e){addThisClass(e.findElement('li'),'yes_selected_not_new');});menu_items[i].observe('mouseout',function(e){removeThisClass(e.findElement('li'),'yes_selected_not_new');});}}
this.sticky=function(){if(ieVersionOlderThan(6)||(SA.Utils.Env.touchSupport))return;menu=$('nav_container_wrap');header=$('header');if(!alwaysTopNav()){Event.observe(window,'scroll',function(){var scrollTop=get_window_Yscroll();if(scrollTop>header_height){menu.addClassName('top_nav_fixed');header.addClassName('sticky_nav');}else{menu.removeClassName('top_nav_fixed');header.removeClassName('sticky_nav');}});}
else{menu.addClassName('top_nav_fixed');header.addClassName('sticky_nav');}}
function alwaysTopNav(){var temp=$$('.author_board_header,.instablog_body');return temp.length>0;}
function get_window_Yscroll(){return window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0;}
this.setUserDropdown=function(){var aHtml=[];if(SA.Data.User.loggedIn()){aHtml.push('<div class="user_settings" id="user_settings">');aHtml.push('<span id="top_nav_arrow" class="top_nav_arrow_down" style="cursor:pointer;">'+(user_nick.length<11?user_nick:user_nick.slice(0,8)+"...")+'</span>');aHtml.push('<div class="user_settings_pop" id="user_settings_pop" onmouseover="show_item(\'user_settings_pop\');$(\'user_settings\').addClassName(\'up\')" style="display:none">');aHtml.push('<ul>');aHtml.push('<li><a href="/account/my-feed" onclick="trackLink(this,\'Menu Tracking\',\'My Feed\',location.href);">My Feed</a></li>');aHtml.push('<li class="floating_inbox_li"><a href="/inbox" onclick="trackLink(this,\'Menu Tracking\',\'Inbox\',location.href);">Inbox<span id="inbox_number">');if(e_notifications!=''&&e_notifications!='0')aHtml.push(' ('+e_notifications+')');aHtml.push('</span></a></li>');aHtml.push('<li><a href="'+profile_href+'" onclick="trackLink(this,\'Menu Tracking\',\'Profile\',location.href);">Profile</a></li>');if(user_cookie.writing_status=="contributor")aHtml.push('<li><a onclick="trackLink(this,\'Menu Tracking\',\'View Instablog\',location.href);" href="/user/'+user_id+'/instablog">View Instablog</a></li>');if(user_cookie.writing_status!="instablogs")aHtml.push('<li><a onclick="trackLink(this,\'Menu Tracking\',\'Write Instablog Post\',location.href);" href="/account/write_post_new?publish_type=instablog">Write Instablog Post</a></li>');aHtml.push('<li><a href="/account/edit_bio" onclick="trackLink(this,\'Menu Tracking\',\'My Settings\',location.href);">Settings</a></li>');aHtml.push('<li class="sign_out"><span onmouseover="link_over(this,\'#ff0000\')" onmouseout="link_out(this,\'#024999\')" onclick="trackLink(this,\'Menu Tracking\',\'Sign out\',location.href);logout();" class="logout_link">Sign Out</span></li>');aHtml.push('</ul>');aHtml.push('</div>');aHtml.push('</div>');}else{aHtml.push('<span style="cursor:pointer;" onclick="open_header_log_in_popup_lightbox(\'headtabs_login\',\'\'); return false">Sign in / Join Now</span>');}
$('user_settings_wrapper').innerHTML=aHtml.join("");}
this.setUserNotifications=function(){if(!SA.Data.User.loggedIn())return;$('user_settings_wrapper').insert({before:'<li class="floating_message_li" id="floating_message_li"><span type="button" id="notify_popup_button" class="floating_message_span" onclick="trackLink(this,\'Toolbar Tracking\',\'Notifications\',location.href);ajax_pop_notifications(\''+user_id+'\');" open="false"></span><span class="navi_right_corner">|</span></li>'});var aHtml=[];if(navigator.appVersion.match(/iPhone/)==null){aHtml.push('<div id="notificiations_popup" class="bar_notify" style="display:none;">');aHtml.push('<div class="bar_notify_top_decoration"></div>');aHtml.push('<div class="bar_notify_middle">');aHtml.push('<ul id="notifications_list"></ul>');aHtml.push('<div class="noti_links">Go to <a href="/inbox" sasource="top_nav">inbox</a> or <a href="/account/my-feed" sasource="top_nav">more notifications</a></div>');aHtml.push('</div>');aHtml.push('<div class="bar_notify_bottom_decoration"></div>');aHtml.push('</div>');aHtml.push('<div id="notifications_alert" class="bar_alert" onclick="ajax_pop_notifications(\''+user_id+'\')"');aHtml.push((alert_notifications=='0'||alert_notifications=='')?'style="display:none">':'>'+alert_notifications)
aHtml.push('</div>');}
$('floating_message_li').insert({bottom:aHtml.join("")});SA.Utils.Expansion.setOnClickOutside('notificiations_popup',function(e){minimize_pop_notifications(user_id)},1);var track_source=(top.location.href.indexOf('source=tracking')>-1);var track_or_inbox_page=(top.location.href.indexOf('/inbox')>-1)||(top.location.href.indexOf('/account/my-feed')>-1);var steps_pages=(top.location.href.indexOf('/account/step')>-1);if(!track_source&&!steps_pages&&(track_or_inbox_page||!update_cookies||alert_notifications==''||alert_notifications==0||!c_notifications||!e_notifications))ajax_create_user_notification_cookie_and_update_tool_bar(user_id);}}})();