(function(f,k,p){k.pin=function(r){function s(a){for(var c=null,h=null,g=f(l.divHeroSelector).find(l.imgHeroSubSelector),b=f(g).attr("data-modelId"),d=f(l.pinSelector),i=0;i<d.length;i++){var e="#"+d[i].id,j=n(e);if(j&&j.modelId==b){c=e;h=j;break}}if(c&&h){d=f(l.iconImgsSelector);b=f(g).attr("data-ipsid");i=p.location.protocol;e=g.attr("src").replace(m(b),m(b));e=i+e;for(j=0;j<d.length;j++)if(i=f(d).get(j),f(i).attr("data-skuid")==a){d=p.location.protocol;g=g.attr("src");i=f(i).attr("data-ipsid"); g=g.replace(m(b),m(i));e=d+g;break}h=f.extend({},h,{skuId:a,heroImage:e,description:PinPDPDescription[a]});o(c,h)}}function t(a,c,e,g){var b=f("#quickViewPinItButton"),d=n("#quickViewPinItButton");b.length&&d&&(b=c.AlternateColorImages[0].Ipsid,g=p.location.protocol+g.replace(m(b),m(b)),d=f.extend({},d,{skuId:a,heroImage:g,canonicalUrl:e,description:c.BrandName+" "+c.ModelName+" via eBags.com!"}),o("#quickViewPinItButton",d))}function u(a,c,e){var g=f("#quickViewPinItButton"),b=n("#quickViewPinItButton"); g.length&&b&&(b=f.extend({},b,{skuId:a.AlternateColorImages[0].SkuId,heroImage:e,canonicalUrl:c,description:a.BrandName+" "+a.ModelName+" via eBags.com!"}),o("#quickViewPinItButton",b))}function o(a,c){if(c){var h=c.canonicalUrl,g=c.heroImage,b=c.description;500<b.length&&(b=b.substring(0,500));var d=c.skuId;d&&(h=h+"?productid="+d);(d=c.sourceId)&&(h=h+"&sourceId="+d);d=c.countLayout;d!=v&&(d!=w&&d!=q)&&(d=q);h=escape(h);g=escape(g);b=b.replace(" &amp;","&amp;");b=b.replace("&amp; ","&amp;");b=b.replace("&amp;", " &amp; ");b=escape(b);f(a).html('<a href="'+("http://pinterest.com/pin/create/button/?url="+h+"&media="+g+"&description="+b)+'" class="pin-it-button" count-layout="'+d+'"><img border="0" src="http://assets.pinterest.com/images/PinExt.png" title="Pin It" /></a>');e.reparsePinterestButtons()}}function n(a){var c=null;a&&(a=f(a),a.length&&(a=a.attr("data-modelSettings"),a.length&&(c=JSON.parse(a))));return c}function m(a){var c=a.split("_");return"/im"+c[0].charAt(c[0].length-1)+"/"+a}var e={},l=f.extend({}, k.pin.defaults,r),v="horizontal",w="vertical",q="none";e.parsePinterestButtons=function(){var a=document.createElement("script");a.async=!0;a.src=document.location.protocol+"//assets.pinterest.com/js/pinit.js";var c=f(l.pinRootSelector);c.length&&c[0].appendChild(a)};e.reparsePinterestButtons=function(){var a=f(l.jsSourceSelector);a.length&&a.remove();e.parsePinterestButtons()};e.placePinterestButton=function(a){o(a,n(a))};e.init=function(){e.parsePinterestButtons();k.subscribe("/sku/change/PDP", s);k.subscribe("/sku/change/QuickView",t);k.subscribe("/product/change/QuickView",u);return e};return e};k.pin.defaults={iconImgsSelector:".iconImage",divHeroSelector:"#divHeroImage",imgHeroSubSelector:"img",pinRootSelector:"#pin-root",pinSelector:".pin-it",jsSourceSelector:'script[src*="assets.pinterest.com/js/pinit.js"]'}})(jQuery,eBags,window);