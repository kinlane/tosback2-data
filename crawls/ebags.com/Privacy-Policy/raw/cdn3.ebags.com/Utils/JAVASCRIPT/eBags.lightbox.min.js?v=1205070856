(function(a,d){function f(b){if(a.lightbox.settings.inited)return true;a.lightbox.settings.inited=true;a.lightbox.settings.self&&a.lightbox.settings.self.trigger("init.lightbox");b&&a.extend(a.lightbox.settings,b);a("body").append(a.lightbox.settings.html);var c=[new Image];c[0].src=a.lightbox.settings.closeImage;a("#lightbox").find(".lb-b:first, .lb-bl, .lb-br, .lb-tl, .lb-tr").each(function(){c.push(new Image);c.slice(-1).src=a(this).css("background-image").replace(/url\((.+)\)/,"$1")});a("#lightbox #lb-close").click(a.lightbox.close); a("#lightbox #lb-close-image").attr("src",a.lightbox.settings.closeImage)}function g(){var b;if(self.innerHeight)b=self.innerHeight;else if(document.documentElement&&document.documentElement.clientHeight)b=document.documentElement.clientHeight;else if(document.body)b=document.body.clientHeight;return b}function h(){if(a.lightbox.settings.overlay){a("#lb-overlay").length===0&&a("body").append('<div id="lb-overlay" class="lb-hide"></div>');a("#lb-overlay")[0].style.display!=="block"&&a("#lb-overlay").hide().addClass("lb-overlay-bg").css("opacity", a.lightbox.settings.opacity).click(function(){a.lightbox.close()}).fadeIn(a.lightbox.settings.fadeSpeed)}return false}function i(){a.lightbox.settings.overlay&&a("#lb-overlay").fadeOut(a.lightbox.settings.fadeSpeed,function(){a("#lb-overlay").removeClass("lb-overlay-bg").addClass("lb-hide").remove()});return false}a.lightbox=function(b,c){a.lightbox.loading(c);a.lightbox.show(b)};a.extend(a.lightbox,{settings:{opacity:0,overlay:true,bodyClickClose:true,fixed:true,closeImage:"",closeLink:"",fadeSpeed:200, windowLeft:0,initLeft:180,initHeight:100,initWidth:200,html:'<div id="lightbox" style="display:none;"><div class="lb-popup"><table id="lb-table"><tbody><tr><td class="lb-tl"/><td class="lb-b"/><td class="lb-tr"/></tr><tr><td class="lb-b">&nbsp;</td><td class="lb-body"><div class="lb-header"><a href="#" id="lb-close"><img title="close" id="lb-close-image" /></a></div><div id="lb-content" class="lb-content"></div></td><td class="lb-b">&nbsp;</td></tr><tr><td class="lb-bl"/><td class="lb-b"/><td class="lb-br"/></tr></tbody></table></div></div>'}, loading:function(b){this.settings.self=a(b);f();h();!this.settings.overlay&&this.settings.bodyClickClose&&a(document).bind("click",function(){a.lightbox.close();return true});a(document).bind("keydown.lightbox",function(c){c.keyCode==27&&a.lightbox.close();return true});this.settings.self.trigger("loading.lightbox")},show:function(b){this.settings.self.trigger("beforeShow.lightbox");a("#lb-content").empty();a("#lb-content").append(b);a("#lightbox").show();a("#lightbox .lb-body").length?a("#lightbox .lb-body").children().fadeIn("normal"): a("#lightbox").children().fadeIn("normal");this.settings.closeLink&&a(this.settings.closeLink,a("#lb-content")).css("cursor","pointer").click(a.lightbox.close);b=this.settings.windowWidth||a(window).width();var c=a("#lightbox").height(),e=a("#lightbox").width();c=a(window).scrollTop()+(g()/2-c/2);if(c<0)c=10;a("#lightbox").css({top:c,left:b/2-e/2+this.settings.windowLeft});!this.settings.overlay&&this.settings.bodyClickClose&&a("#lightbox").bind("click",function(j){j.stopPropagation()});this.settings.self.trigger("show.lightbox").trigger("afterShow.lightbox")}, close:function(){a(document).unbind("keydown.lightbox");a("#lightbox").fadeOut(function(){a("#lb-content").removeClass().addClass("lb-content");i()});a.lightbox.settings.self.trigger("close.lightbox");return false}});a.fn.lightbox=function(b){f(b);return this.click(function(){a.lightbox.loading(this);a.get(b.href,function(c){a.lightbox.show(c)});return false})};d.lightbox=function(b,c){var e=a.extend({},d.lightbox.defaults,c);return a(b).css("cursor","pointer").lightbox(e)};d.lightbox.defaults={fadeSpeed:300, windowLeft:130,opacity:0.6}})(jQuery,eBags);