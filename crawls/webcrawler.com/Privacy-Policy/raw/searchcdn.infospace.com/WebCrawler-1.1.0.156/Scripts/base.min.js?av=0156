wsNs.updateParameterInQueryString=function(itemName,itemValue,url){var qsIdx=url.indexOf('?');var urlPath=qsIdx>-1?url.substring(0,qsIdx):url;var qs=qsIdx>-1?url.substring(qsIdx+1):'';var qsVars=qs?qs.split('&'):[]
var newParm=encodeURIComponent(itemName)+'=';var parmIdx;for(parmIdx=0;parmIdx<qsVars.length;++parmIdx){if(qsVars[parmIdx].indexOf(newParm)>-1)break;}
qsVars[parmIdx]=newParm+encodeURIComponent(itemValue);qs=qsVars.join('&');return urlPath+'?'+qs;};String.prototype.updateParameterInQueryString=function(itemName,itemValue){return wsNs.updateParameterInQueryString(itemName,itemValue,this);};wsNs.logDeferredClick=function(element,callback){iclog.logClick(callback,$(element).attr(wsNs.constants.coidDeferAttribute),$(element).attr(wsNs.constants.copDeferAttribute));};wsNs.logClickAndNavigate=function(coid,cop,url){if(wsNs.constants.openInNewWindow){window.open(url);iclog.logClick(null,coid,cop);}
else{iclog.logClick(function(){window.location=url;},coid,cop);}}
wsNs.hideAdvSearch=function(form,link){form.slideToggle('slow',function(){$('input[name="q"]').attr('disabled',false).css('background-color','#fff');$('#topSearchSubmit').attr('disabled',false).css('cursor','pointer');});};wsNs.showAdvSearch=function(form,link){form.slideToggle('slow',function(){wsNs.logDeferredClick(link);$('input[name="q"]').attr('disabled',true).css('background-color','#ccc');$('#topSearchSubmit').attr('disabled',true).css('cursor','default');$('#qall').focus();});};wsNs.saveLocation=function(position){$.post(wsNs.constants.locationPost,{latitude:position.coords.latitude,longitude:position.coords.longitude});};wsNs.getLocation=function(callback){navigator.geolocation.getCurrentPosition(callback||wsNs.saveLocation);};(function(){var t;var d;wsNs.showOverlay=function(msg,dly){var f=function(){d=new Date().getTime();$('#overlayText').text(msg);$('#overlay, #overlayScreen').height($(window).height()).width($(window).width());$('#overlay').css('padding-top',(($('#overlay').height()-parseInt($('#overlayContent').css('height')))/2).toString()+'px').css('position','fixed').fadeIn('fast');};if(dly)t=setTimeout(f,dly);else f();};wsNs.hideOverlay=function(dur,cb){clearTimeout(t);var dif=new Date().getTime()-d;var f=function(){if(cb)cb();$('#overlay').fadeOut('fast',function(){$(this).css('position','static');});};if(dur&&dif<dur)setTimeout(f,dur-dif);else f();};})();wsNs.registerSearchHistory=function(){if(icl.ut.getCookie('__hideHistory')=='1'){$('#hideHistoryLink').hide();$('#searchHistoryContent').hide();}
else{$('#showHistoryLink').hide();}
$('#clearHistoryLink').click(function(){$('#searchHistoryContentAndLinks').hide();$('#searchHistoryCleared').show();icl.ut.writeCookie(wsNs.constants.historyCookie,'',wsNs.constants.historyCookieDomain,'/');return false;});$('#showHistoryLink').click(function(){$('#searchHistoryContent').show();$('#hideHistoryLink').show();$('#showHistoryLink').hide();icl.ut.writeCookie('__hideHistory','',wsNs.constants.historyCookieDomain,'/');return false;});$('#hideHistoryLink').click(function(){$('#searchHistoryContent').hide();$('#hideHistoryLink').hide();$('#showHistoryLink').show();icl.ut.writeCookie('__hideHistory','1',wsNs.constants.historyCookieDomain,'/');return false;});};wsNs.registerSort=function(){$('input:radio[name="'+wsNs.constants.sortParam+'"],select[name="'+wsNs.constants.sortParam+'"]').change(function(){var value=$(this).val();var coi=$(this).attr(wsNs.constants.coidAttribute);var cop=$(this).attr(wsNs.constants.copAttribute);var windowHref=window.location.href;windowHref=wsNs.updateParameterInQueryString(wsNs.constants.sortParam,value,windowHref);windowHref=wsNs.updateParameterInQueryString(wsNs.constants.pageIndex,1,windowHref);if(coi&&cop){iclog.logClick(function(){window.location.href=windowHref;},coi,cop);}
else{window.location.href=windowHref;}});};wsNs.registerAdvSearch=function(){var $advanceSearchPane=$('div.advancedSearchPane');var $advanceSearchLink=$('div.advancedSearchLink a');$advanceSearchPane.hide();$('body.bodyAdvancedSearch #header .advancedSearchPane').show();$('body.bodyAdvancedSearch input[name="q"]').attr('disabled',true);$('body.bodyAdvancedSearch input[id="topSearchSubmit"]').attr('disabled',true).css('cursor','default');if(wsNs.constants.isAdvSearchView)return;$advanceSearchLink.click(function(){if($advanceSearchPane.is(':visible')){wsNs.hideAdvSearch($advanceSearchPane,$advanceSearchLink);}else{wsNs.showAdvSearch($advanceSearchPane,$advanceSearchLink);}
return false;});var $advInputs=$('div.advancedSearchInputPane div.keywordInput input[type="text"]');var $qall=$('#qall');$('#topSearchTextBox').change(function(){$advInputs.val('');$qall.val($(this).val());});};wsNs.registerTabs=function(){if(wsNs.constants.categoryUrls){$('div.searchBoxCategories a').click(function(){var tabClass=$(this).parent().parent().attr('class');var tabUrls=wsNs.constants.categoryUrls[tabClass];$('div.searchBoxInput form').attr('action',tabUrls.catUrl);$('div.preferencesLink a').attr('href',tabUrls.prefUrl);$('div.advancedSearchLink a').attr('href',tabUrls.advUrl);$('div.searchBoxCategories a').removeClass('categoryLinkActive');$(this).addClass('categoryLinkActive');var $keywords=$('input.searchBoxTextInput');var $location=$('input.searchBoxLocationInput');var toggleISuggest=iSuggest&&typeof iSuggest.setActive==='function';if(tabClass=='categoryVideo'||tabClass=='categoryNews'||tabClass=='categoryLocal'){$('div.advancedSearchLink').hide();var $advanceSearchPane=$('div.advancedSearchPane');var $advanceSearchLink=$('div.advancedSearchLink a');if($advanceSearchPane.is(':visible')){wsNs.hideAdvSearch($advanceSearchPane,$advanceSearchLink);}
$('div.engineAttributionPane').hide();if(tabClass=='categoryLocal'){$location.val($location.attr('data-core-value')).show();$keywords.addClass('localSearchBoxTextInput');if(toggleISuggest){iSuggest.setActive(false);}}
else{if($location.val()){$location.attr('data-core-value',$location.val()).val('');}
$location.hide();$keywords.removeClass('localSearchBoxTextInput');if(toggleISuggest){iSuggest.setActive(true);}}}
else{$('div.advancedSearchLink').show();if($location.val()){$location.attr('data-core-value',$location.val()).val('');}
$location.hide();$keywords.removeClass('localSearchBoxTextInput');if(toggleISuggest){iSuggest.setActive(true);}
if(tabClass=='categoryWeb'){$('div.imageFilters').hide();$('div.webFilters').show();$('div.engineAttributionPane').show();}
else if(tabClass=='categoryImages'){$('div.webFilters').hide();$('div.imageFilters').show();$('div.engineAttributionPane').hide();}}
wsNs.logDeferredClick(this);return false;});}
else{$('#topSearchTextBox').change(function(){var $tabLinks=$('div.searchBoxCategories a');for(var i=0;i<$tabLinks.length;++i){var href=wsNs.updateParameterInQueryString(wsNs.constants.keywordQuery,$(this).val(),$tabLinks.get(i).href);$tabLinks.get(i).href=href;}});}};wsNs.registerClickableRegion=function(regionSelector,targetLinkAccessor){$(regionSelector).click(function(){var link=targetLinkAccessor(this);var coi=link.attr(wsNs.constants.coidAttribute);var cop=link.attr(wsNs.constants.copAttribute);if(wsNs.constants.openInNewWindow==true){window.open(link.attr('href'));}
else{window.location=link.attr('href');}
iclog.logClick(null,coi,cop);return false;})};wsNs.primeLocalListingPrintDialogContent=function(){var $printDialog=$('#localListingPrintDialog').clone();$printDialog.find('div.printDialogGeneral').append($('#resultsMain div.localListingResultInfo div.businessInfo').clone()).append($('#resultsMain div.localListingResultInfo div.localBusinessHours').clone()).find('div.businessWebsite').hide().end().end().find('div.printDialogMap').append('<img src="'+wsNs.staticMap+'" height="'+wsNs.staticMapHeight+'" width="'+wsNs.staticMapWidth+'" />').end().find('div.printDialogOverview').append($('#resultsMain div.localListingResultInfo div.localCategories').clone()).append($('#overView').clone()).find('span.localCategoriesMore').hide().end().find('#localCategoriesHidden').show().end().end().find('div.printDialogContent a').replaceWith(function(){return $('<span class="linkReplace"></span>').append($(this).contents());}).end().find('.ui-tabs-panel').removeClass('ui-tabs-panel ui-widget-content ui-corner-bottom').end().find('div.printLink a').click(function(){window.print();}).end().show().appendTo($('#printArea, #dialog').empty());return $printDialog;};wsNs.setCustomValidators=function(){$.validator.addMethod('requiredGroup',function(value,element){var $module=$(element).parents('form');return $module.find('input.requiredGroup:filled').length;},'');$.validator.addMethod('requiredIfVisible',function(value,element){return $(element).is(':not(:visible)')||value!='';},'');};wsNs.init=function(){wsNs.registerAdvSearch();wsNs.registerTabs();wsNs.registerSort();wsNs.registerSearchHistory();wsNs.setCustomValidators();if(iclog)iclog.registerLogClick($('a['+wsNs.constants.coidAttribute+']').get());$('#topSearchTextBox').focus();};$(function(){wsNs.init();});var ptTopSearchBox={};ptTopSearchBox.id='topSearchTextBox';ptTopSearchBox.callback=function(){$('#topSearchForm input[name="fcoid"]').val('114');$('#topSearchForm').attr(wsNs.constants.coidAttribute,'114');$('#topSearchForm').submit()};var ptBottomSearchBox={};ptBottomSearchBox.id='bottomSearchTextBox';ptBottomSearchBox.callback=function(){$('#bottomSearchForm input[name="fcoid"]').val('114');$('#bottomSearchForm').attr(wsNs.constants.coidAttribute,'114');$('#bottomSearchForm').submit()};ptBottomSearchBox.openOverSearchBox=true;var ispace_txtElements=[ptTopSearchBox,ptBottomSearchBox];