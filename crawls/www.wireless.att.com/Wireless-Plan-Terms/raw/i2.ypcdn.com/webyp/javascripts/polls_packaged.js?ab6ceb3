(function(d,s,id){$('body').prepend('<div id="fb-root"/>');window.fbAsyncInit=function(){FB.init({appId:Yacht.facebook.app_id,channelUrl:'//'+window.location.host+'/channel.html',status:true,cookie:true,xfbml:true});$('body').trigger('FB_loaded');};var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/all.js";fjs.parentNode.insertBefore(js,fjs);}(document,'script','facebook-jssdk'));window.VoteItUpHelper=window.VoteItUpHelper||{};VoteItUpHelper.location=(function(){var deserializeLocation=function(locationString){var locationArray=unescape(locationString).replace(/[+]/g," ").split("|");var locationObject={};for(var item in locationArray){locationObject[locationArray[item].toString().split(":")[0]]=locationArray[item].toString().split(":")[1];}
return locationObject;};var getLocation=function(){var locationObject=deserializeLocation($.cookie('location'));var tempLocation;if(typeof locationObject.city==="undefined"||locationObject.city==="undefined"){tempLocation=Yacht.location.split(", ");locationObject={"city":tempLocation[0],"state":tempLocation[1]};}else{locationObject={"city":locationObject.city,"state":locationObject.state};}
return locationObject;};var setLocation=function(geoSearchTerm){$.ajax({url:'/polls/update_location',type:'POST',cache:false,data:{change_geo:geoSearchTerm},success:function(html){window.location.reload();},error:function(){$('body').trigger('voteitup:locationUpdateError');}});};return{getLocation:function(){return getLocation();},setLocation:function(geoSearchTerm){setLocation(geoSearchTerm);}};})();(function($){var VoteItUpLeaderboard=function($elem,options){var config={};var seo_keyword;var callbackCounter=0;config=$.extend(config,options);var bindAllLeaderboard=function(){$('body').bind('voteitup:leaderboardWidgetLoaded',function(){callbackCounter+=1;if(callbackCounter===3){$elem.trigger('voteitup:leaderboardsWidgetLoaded');callbackCounter=0;};});};var leaderboardLoadedCallback=function(){$elem.trigger('voteitup:leaderboardWidgetLoaded');};var loadBoard=function($el,board_url){var currentLocationObj=VoteItUpHelper.location.getLocation();$el.load(board_url,$.param({city:currentLocationObj.city,state:currentLocationObj.state}),leaderboardLoadedCallback);};var loadCityBoard=function($el){var board_url='/polls/'+seo_keyword+'/city_leaders';loadBoard($el,board_url);};var loadStateBoard=function($el){var board_url='/polls/'+seo_keyword+'/state_leaders';loadBoard($el,board_url);};var loadNationalBoard=function($el){var board_url='/polls/'+seo_keyword+'/national_leaders';loadBoard($el,board_url);};var bindUpdateLocation=function(){$('body').bind('voteitup:locationUpdateSuccess',function(){});};var bindChangeLocation=function(){$elem.find('.change-link').live('click',function(e){e.preventDefault();$elem.find('form.choose-city').show();$elem.find('form.choose-city input:first').focus();});$elem.find('form.choose-city').live('submit',function(e){e.stopPropagation();e.preventDefault();var $this=$(this);var locationSearchTerm=$this.find('input[name=change-location]').val();if(locationSearchTerm!==''){VoteItUpHelper.location.setLocation(locationSearchTerm);}
$this.hide();});$elem.find('form.choose-city a.close-btn').live('click',function(e){e.preventDefault();$(this).parent().hide();})};var loadLeaderBoards=function(){var $city_board=$elem.find("#city-leader-board");var $state_board=$elem.find("#state-leader-board");var $national_board=$elem.find("#national-leader-board");seo_keyword=$elem.data('seo_keyword');loadCityBoard($city_board);loadStateBoard($state_board);loadNationalBoard($national_board);};loadLeaderBoards();bindUpdateLocation();bindChangeLocation();bindAllLeaderboard();};$.fn.voteItUpLeaderboard=function(options){return this.each(function(){var $elem,key;$elem=$(this);key='vote-it-up-leaderboard';if($elem.data(key))return;var widget=new VoteItUpLeaderboard($elem,options||{});$elem.data(key,widget);});};})(jQuery);(function($){var VoteItUpWidget=function($elem,options){var config={};var seo_keyword;var widget_type;config=$.extend(config,options);var bindYPLightbox=function(){$('body').bind('yplightbox_loaded',function(e,content,options){if((typeof options.source!=='undefined')&&(options.source.attr('id')===$elem.attr('id'))){$('.candidate-search .label label').inFieldLabels();$('.candidate-search input[type=text]:first').focus();$('.candidate-search label').click(function(){$(this).next().focus();});$(content).find("a.yp-auth").authLink();addOverlayToggleForLogin();var $root=$(content).find('.candidate-search-results-container');bindCastVote($root);}});};var bindUpdateLocation=function(){$('body').bind('voteitup:locationUpdateSuccess',function(){});};var bindChangeLocation=function(){$elem.find('.change-link').live('click',function(e){e.preventDefault();$elem.find('form.choose-city').show();$elem.find('form.choose-city input:first').focus();});$elem.find('form.choose-city').live('submit',function(e){e.stopPropagation();e.preventDefault();$('#voteitup_widget').append('<div class="poll-loading"></div>').find('.voteitup-widget').hide();var $this=$(this);var locationSearchTerm=$this.find('input[name=change-location]').val();if(locationSearchTerm!==''){VoteItUpHelper.location.setLocation(locationSearchTerm);}
$this.hide();});$elem.find('span.change-to-location').live('click',function(e){e.stopPropagation();e.preventDefault();if($(this).html()!==''){VoteItUpHelper.location.setLocation($(this).html());}})
$elem.find('form.choose-city a.close-btn').live('click',function(e){e.preventDefault();$(this).parent().hide();})};var loadPoll=function(){$elem.find('.poll-loading').fadeIn('fast');var currentLocationObj=VoteItUpHelper.location.getLocation();seo_keyword=$elem.data('seo_keyword');widget_type=$elem.data('page')?$elem.data('page'):"contest"
var poll_url='/polls/'+seo_keyword+'/widget';var $params=$.param({city:currentLocationObj.city,state:currentLocationObj.state,type:widget_type})
$elem.load(poll_url,$params,loadPollCallback);};var loadPollCallback=function(){$elem.find('.candidate-search-container').hide(0);$elem.find("a.yp-auth").authLink();$elem.find('.search-btn').ypLightbox({content:$elem.find('.candidate-search-container').html(),class_name:'polls-lightbox',source:$elem});addLockedMapClickHandler();bindCastVote($elem);Util.whenFacebookIsLoaded(function(FB){FB.XFBML.parse();});$('body').trigger('voteitup:pollLoaded',[$elem]);};var addLockedMapClickHandler=function(){$lockedMap=$('.map-container .closed-msg');$poll_tallying=$('.voteitup-widget .closed-msg');if($lockedMap.length&&!$poll_tallying.length){$($lockedMap).ypLightbox({content:$elem.find('.candidate-search-container').html(),class_name:'polls-lightbox',source:$elem});}};var addOverlayToggleForLogin=function(){$("a.yp-auth").click(function(){$('.yplightbox_overlay').css('z-index',1000);$('.yplightbox_screen').hide();});$('#fancybox-close').click(function(){$('.yplightbox_overlay').css('z-index',99999);$('.yplightbox_screen').show();});};var removeDefaultText=function(){$('#poll-search-results .candidate-search').remove();};var addLoginLink=function(){$("a.yp-auth").authLink();};$('form.candidate-search').live('submit',function(event){event.stopImmediatePropagation();event.preventDefault();var $form=$(this);var pollSearchUrl='/polls/'+seo_keyword+'/search';if($form.valid()){$('#poll-search-results .poll-loading').fadeIn('fast');var searchTerms=$form.find(':input[name=query]').val();var location=$form.find(':input[name=location]').val();Analytics.clicks.emit({click_id:1995,search_terms:searchTerms,geo_location_terms:location,feature_click:seo_keyword,module:'vote_it_up_search'});$('#poll-search-results .candidate-search-results-container').empty();$('#poll-search-results .candidate-search-results-container').load(pollSearchUrl,$.param({seo_keyword:seo_keyword,search_terms:searchTerms,location:location}),function(){$('#poll-search-results .poll-loading').hide();$('#poll-search-results .search-terms').html(searchTerms+' Near '+location);addLoginLink();addOverlayToggleForLogin();removeDefaultText();});}});var fetchPaginatedSearchResults=function(url){$('#poll-search-results .poll-loading').show();$('#poll-search-results .candidate-search-results-container').empty();$('#poll-search-results .candidate-search-results-container').load(url,$.param({}),function(){addLoginLink();addOverlayToggleForLogin();$('#poll-search-results .poll-loading').hide();});};$('.candidate-search-results-container .page-navigation a').live('click',function(event){event.preventDefault();event.stopImmediatePropagation();var url=$(event.target).data('url');fetchPaginatedSearchResults(url);});var bindCastVote=function($el){$el.delegate('.candidate .vote-button','click',function(e){e.stopImmediatePropagation();$('#poll-search-results .poll-loading').show();Analytics.clicks.emit({click_id:1940});var element=$(e.target).parent();$.ajax({url:"/polls/"+seo_keyword+"/vote",type:"POST",cache:false,data:{listing_id:$(element).data('ypid')},success:function(data){$('body').trigger('voteitup:voteSuccess',[$el,element]);var poll_landing_url="/best/"+seo_keyword;window.location.href=poll_landing_url;},error:function(){$('body').trigger('voteitup:voteError');$('#poll-search-results .poll-loading').hide();}});})};loadPoll();bindUpdateLocation();bindChangeLocation();bindYPLightbox();};$.fn.voteItUpWidget=function(options){return this.each(function(){var $elem,key;$elem=$(this);key='vote-it-up-widget';if($elem.data(key))return;var widget=new VoteItUpWidget($elem,options||{});$elem.data(key,widget);});};})(jQuery);jQuery(function(){$.ajaxSetup({cache:false});var $widget=$('#voteitup_widget');if($widget.length){$widget.voteItUpWidget();}
var $leaderboard=$('#leaderboard');var $leaderGroups=$('.leader-group');var $handle=$('.leaderboard-handle');if($leaderboard.length){$leaderboard.voteItUpLeaderboard();}
var toggleLeaders=function(){$leaderboard.find('.see-more').toggle();$leaderboard.find('.hide-leader').toggle();};$('#leaderboard .see-more').live('click',function(event){event.preventDefault();toggleLeaders();});$handle.bind('click',function(e){toggleLeaders();});$('body').bind('voteitup:leaderboardsWidgetLoaded',function(){$leaderGroups.each(function(){var leaders=$(this).find('.leader').slice(3);leaders.each(function(){$(this).addClass('hide-leader');});});$leaderboard.find('.leader-groups').removeClass('loading');$leaderboard.find('.poll-loading').hide();});$('body').bind('voteitup:locationUpdateSuccess',function(){});$.fn.start_poll_timer=function(){var $elem=$(this);var end_time=$elem.data('ends_at');$elem.ypCountdown({end_at:end_time,template:"<div class='ypCountdown'><h3 class='title'>Countdown to poll closing:</h3><ul><li class='days'><span></span><sup>d</sup>&nbsp;:&nbsp;</li><li class='hours'><span></span><sup>h</sup>&nbsp;:&nbsp;</li><li class='minutes'><span></span><sup>m</sup>&nbsp;:&nbsp;</li><li class='seconds'><span></span><sup>s</sup></li></ul></div>"});};var $timer_section=$('.date-time .counter');if($timer_section.length){$timer_section.start_poll_timer();}
$('body').bind('voteitup:voteSuccess',function(e,$elem,$vote){var geo=VoteItUpHelper.location.getLocation();geo=geo.city+", "+geo.state;var title=$elem.find('.poll-title:first').text().trim();var vertical=$vote.closest('#lightbox').length?'vote_it_up_search':'vote_it_up_module';Analytics.impressions.emit({vertical:vertical,geography:geo,events:'event27',feature_title:title});});Util.whenFacebookIsLoaded(function(FB){FB.Event.subscribe('edge.create',function(){Analytics.clicks.emit({click_id:1325,feature_impression_page:'vote_it_up_contest'});});});});