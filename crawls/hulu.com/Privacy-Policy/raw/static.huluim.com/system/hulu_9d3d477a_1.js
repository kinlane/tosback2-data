
var setLoggedIn,setLoggedOut;var Behaviors=Class.create();Object.extend(Behaviors,{cufonDisabled:false,openDropDown:null,in_browse:false,in_show_page:false,is_plus_only_video:false,is_video_previewable:false,is_auth_video:false,first_login:true,cramLoaded:false,hoa:false,hob:false,placeholderEmails:{},toggleFirstDescendant:function(cssRule,excludeClassName){if(Behaviors.in_browse)
return;var els=$$(cssRule);if(excludeClassName){els=els.reject(function(el){return el.hasClassName(excludeClassName);});}
els.each(this.toggleFirstDescendantForSingle);},toggleFirstDescendantForSingle:function(el){var target=el.down('a');if(Prototype.Browser.Opera){return;}
if(!/play/.test(target.className)){var targetPage="";if(target.getAttribute("target")){targetPage=target.getAttribute("target");}
var klass="play";if(target.hasClassName("linkRewritten"))klass+=" linkRewritten";var beaconClasses=[];target.classNames().each(function(className){if(/^beacon/.test(className)){klass+=' '+className;beaconClasses.push(className);}});var additional_attributes='';beaconClasses.each(function(attrName){if(target.readAttribute(attrName)){additional_attributes+=attrName+'="'+target.readAttribute(attrName)+'" ';}});var thumbnail=target.down('img');var width=Math.min(parseInt(thumbnail.getStyle('width')||thumbnail.width||145,10),145);var rheight=parseInt(thumbnail.getStyle('height')||thumbnail.height||80,10);var height=Math.min(rheight,80);if(/.*offsite.*/.test(el.className)){var url=target.readAttribute('offsiteinfohoverid');var data;data=InfoHover.cache[url];if(data===undefined)return;var btn_width=parseInt(width)+"px";var btn_height=parseInt(height)+"px";var btn_style="height:"+btn_height+"; width:"+btn_width+"; background-color:#000; opacity: 0.75; -moz-opacity:0.75; filter:alpha(opacity=75); text-align:center";var anchor_style="visibility: hidden; text-decoration:none; color:#fff; left:1px; top:1px; "+"height:"+btn_height+"; width:"+btn_width;new Insertion.Top(el,'<a href="'+target.href+'" target="'+targetPage+'" '+'class="'+klass+'" style="'+anchor_style+'">'+'<div style="'+btn_style+'"> <p style="padding:18px 1px 10px 1px; *cursor:pointer !important; line-height:1.5; font-size:12px">Watch at<br>'+data.site_source.truncate(21)+'</p></div>'+'</a>');}
else{var btn_width=parseInt(33*width/145)+"px";var btn_height=parseInt(32*height/80)+"px";var btn_left=parseInt(57*width/145)+"px";var btn_top=parseInt(27*height/80)+"px";var btn_style="height: "+btn_height+"; width: "+btn_width+";";var anchor_style="visibility: hidden; left: "+
btn_left+"; top: "+btn_top+";"+btn_style;new Insertion.Top(el,'<a href="'+target.href+'" target="'+targetPage+'" '+additional_attributes+'class="'+klass+'" style="'+anchor_style+'">'+'<img src="'+Base.imageURL('/images/btn-play-big.png')+'" border="0"'+' style="'+btn_style+'">'+'</a>');}
var showWatchOnHulu=el.down('a.watch-on-hulu')!=null&&Behaviors.isInCanvasApp();if(showWatchOnHulu){var preview=el.down('a.watch-on-hulu');var preview_height=parseInt(20*height/80);var preview_width=parseInt(112*width/145);var preview_left=(width-preview_width)/2+1;var preview_top=rheight-preview_height+1;var preview_style="height: "+preview_height+"px; width: "+preview_width+"px; left: "+preview_left+"px; top:"+preview_top+"px;";new Insertion.Top(preview,'<img src="'+Base.imageURL('/images/watch-on-hulu-banner.png?v1')+'" border="0" class="watch-on-hulu" style="z-index: 10; visibility: hidden; position: absolute;'+preview_style+'"/>');Event.observe(el,"mouseover",toggle_visible.bind(el,preview.down('img.watch-on-hulu')));Event.observe(el,"mouseout",toggle_invisible.bind(el,preview.down('img.watch-on-hulu')));}
var showWatchOnHuluBig=el.down('a.watch-on-hulu-big')!=null&&Behaviors.isInCanvasApp();if(showWatchOnHuluBig){var preview=el.down('a.watch-on-hulu-big');var preview_height=parseInt(20*height/80);var preview_width=parseInt(145*width/145);var preview_left=(width-preview_width)/2+1;var preview_top=rheight-preview_height+1;var preview_style="height: "+preview_height+"px; width: "+preview_width+"px; left: "+preview_left+"px; top:"+preview_top+"px;";new Insertion.Top(preview,'<img src="'+Base.imageURL('/images/watch-on-hulu-banner-big.png?v1')+'" border="0" class="watch-on-hulu-big" style="z-index: 10; visibility: hidden; position: absolute;'+preview_style+'"/>');Event.observe(el,"mouseover",toggle_visible.bind(el,preview.down('img.watch-on-hulu-big')));Event.observe(el,"mouseout",toggle_invisible.bind(el,preview.down('img.watch-on-hulu-big')));}
if(!Behaviors.isPlusUser()&&!showWatchOnHulu&&!showWatchOnHuluBig){var preview=el.down('a.plus-preview');if(preview){var preview_height=parseInt(20*height/80);var preview_width=parseInt(145*width/145);var preview_left=(width-preview_width)/2+1;var preview_top=rheight-preview_height+1;var preview_style="height: "+preview_height+"px; width: "+preview_width+"px; left: "+preview_left+"px; top:"+preview_top+"px;";new Insertion.Top(preview,'<img src="'+Base.imageURL('/images/plus-preview-banner.png?v2')+'" border="0" class="plus-preview" style="z-index: 10; visibility: hidden; position: absolute;'+preview_style+'"/>');Event.observe(el,"mouseover",toggle_visible.bind(el,preview.down('img.plus-preview')));Event.observe(el,"mouseout",toggle_invisible.bind(el,preview.down('img.plus-preview')));}}
var play=el.down('a.play');var expired=el.up('span');if(play&&!(target.hasClassName('link_disabled'))){if(!(expired&&expired.hasClassName('expired'))){Event.observe(el,"mouseover",toggle_visible.bind(el,play));Event.observe(el,"mouseout",toggle_invisible.bind(el,play));}
if(target.onclick){Event.observe(el.firstDescendant(),"click",target.onclick);}}}},toggleCurrentSeason:function(currentSeason){var cssRule=".popular-filter-nav li.season-list";var currentElementId="season-"+currentSeason;$$(cssRule).each(function(el){if(el.id==currentElementId){Element.addClassName(el,"current");}else{Element.removeClassName(el,"current");}});},applyActivatable:function(){$$('.activatable').each(function(el){Event.observe(el,"mouseover",function(){Element.addClassName(el,'active');});Event.observe(el,"mouseout",function(ev){var tg=ev.srcElement;var reltg=(ev.relatedTarget)?ev.relatedTarget:ev.toElement;if(reltg&&(typeof(reltg.up)=="function")&&(reltg.up('div.item')==el))return;if(tg&&reltg){while(reltg&&reltg!=tg&&reltg.nodeName!='BODY')
reltg=reltg.parentNode;if(reltg==tg)return;}
Element.removeClassName(el,'active');});el.removeClassName('activatable');});},applyCufon:function(){if(Behaviors.cufonDisabled){$$("html")[0].addClassname("cufon-ready");return false;}
Cufon.replace('h2.hoverable',{hover:true,fontFamily:'Futura'});Cufon.replace('h2.cufonable',{fontFamily:'Futura'});Cufon.replace('h3.cufonable',{fontFamily:'Futura'});Cufon.replace('a.default-avatar',{fontFamily:'Helvetica Neue LT Std'});Cufon.replace('h2.cufon-helvetica-neue',{fontFamily:'Helvetica Neue LT Std'});Cufon.replace('div.default-avatar',{fontFamily:'Helvetica Neue LT Std'});Cufon.replace('span.cufonable',{hover:true,fontFamily:'Futura'});Cufon.replace('a.cufonable',{fontFamily:'Futura',hover:true});Cufon.replace('ul.inbox-nav a.tab-cufonable, ul.inbox-nav li.nav-item',{fontFamily:'Futura',color:'#666',hover:{textShadow:'1px 1px #444',color:'#99CC33'}});Cufon.replace('ul.inbox-nav span.tab-cufonable-shadow, ul.inbox-nav li.nav-item.selected',{fontFamily:'Futura',textShadow:'1px 1px #000'});$$("h2").each(function(el){el.style.visibility="visible";});},logout:function(reload,nofb){new Ajax.Request("/logout",{asynchronous:true,evalScripts:true,onComplete:function(request){_gaq.push(['_setVar','anonymous']);var logout_final=(function(){if(Auth.authenticated()){if(document.location.href.match(/\/profile\/?/)||document.location.href.match(/\/favorites/i)||document.location.href.match(/\/screening_room/i)||document.location.href.match(/\/inbox/i)){Auth.offPageLogout("/");}else{Auth.offPageLogout(document.location.href);}}else{Behaviors.setLoggedOut(true);Behaviors.reloadPage(reload);}});if(Social.Common.fbDefined()&&FB.getAuthResponse()&&(nofb!==true)){FB.logout(function(response){logout_final();});}else{logout_final();}}});},logoutFromTop:function(){Behaviors.logout();},setLoggedIn:function(explicit_login){var uid=Behaviors.getUserId();var uname=Behaviors.getUsername();if(uid>0){if(setLoggedIn)setLoggedIn();document.fire("hulu:loggedIn");var el=$('user-greeting');if(el){uname=uname.substring(0,20).gsub(/\+/,' ');if(uname!="null"&&uname!="undefined"){el.update(uname.escapeHTML());Social.Common.getNotificationCounts();}
var elspan=$('profile-drop-down-span');var dropdown_cont=elspan.up();var cont_id=dropdown_cont.identify();var dropdown=null;var pointer=null;var body=$$("body");Behaviors.bound={upper:0,lower:0,left:0,right:0};if(dropdown_cont){dropdown=dropdown_cont.down(".profile-drop-down");pointer=dropdown_cont.down(".profile-drop-down-pointer");}
if(body)body=body[0];if(dropdown&&body&&Behaviors.first_login){Behaviors.first_login=false;Event.observe(elspan,"click",function(ev){if(dropdown.visible()){Behaviors.hideDropDown(ev,dropdown,pointer);}else{var placeholder=$('profile-drop-down-placeholder');var leftOffset=elspan.getWidth()-dropdown.getWidth()+8;if(($("black-header-bar")==null)&&Prototype.Browser.IE&&BrowserDetect.version>7){placeholder.style.top="0px";pointer.style.top="0px";dropdown.style.top="9px";}
dropdown.style.left=leftOffset+"px";placeholder.style.width=dropdown.getWidth()+2+'px';placeholder.style.left=leftOffset+"px";dropdown.style.left=leftOffset+"px";pointer.style.left=elspan.getWidth()-14+"px";dropdown.show();pointer.show();var iframe_id="profile-drop-down-iframe";if(!$(iframe_id)){new Insertion.After(dropdown,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:120;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');var left=dropdown.getStyle('left');var top=dropdown.getStyle('top');var height=dropdown.getDimensions().height+'px';var width=dropdown.getDimensions().width+'px';$(iframe_id).setStyle({left:left,top:top,height:height,width:width});dropdown.setStyle({zIndex:121});}
$(iframe_id).show();var hideFunction=function(){Behaviors.hideDropDown(ev,dropdown,pointer);};IframeHacker.hideWhenScroll(hideFunction,this);var xy=Position.cumulativeOffset(dropdown);Behaviors.bound.upper=xy[1];Behaviors.bound.lower=xy[1]+dropdown.getHeight();Behaviors.bound.left=xy[0];Behaviors.bound.right=xy[0]+dropdown.getWidth();}
Event.stop(ev);Social.TopNavControl.hide();Social.Facebook.hideTooltip();});Event.observe(body,"click",function(ev){Behaviors.hideDropDown(ev,dropdown,pointer);});}}
FloatingLoginForm.hide();Nav.loggedIn();Topic.getUserType();Behaviors.resetPlaylistLinks();Masthead.loggedIn();ContinuousPlay.loggedIn();Behaviors.loggedIn=true;if(explicit_login){UserHistory.clearHistory();}
if(Behaviors.isPlusUser()){if(Behaviors.getCookie("_hiu")==null&&(Math.random()<0.01)){JsonP.ajax("/users/get_payment_info",{"onSuccess":function(data){var responseJSON=data.responseText.evalJSON();if(responseJSON){Behaviors.setCookie("_hiu",responseJSON.hiu,30,Base.commonCookieDomain());}}});}}else{Behaviors.eraseCookie('_hiu',Base.commonCookieDomain());}}
else{Behaviors.setLoggedOut();}
document.fire("hulu:loginReady");},hideDropDown:function(ev,dropdown,pointer){var el=Event.element(ev);if(!el)return;if(dropdown&&dropdown.visible()){var y=Event.pointerY(ev);var x=Event.pointerX(ev);if(!Prototype.Browser.IE&&(document.body.getStyle("position")||"").toLowerCase()=="relative"){var offset=(parseInt(document.body.getStyle("margin-top"))||0)+(parseInt(document.body.getStyle("top"))||0);y=y-offset;}
var hide=y<(Behaviors.bound.upper-12)||y>(Behaviors.bound.lower-4)||x<=Behaviors.bound.left||x>=Behaviors.bound.right;var dropdown_container_id=dropdown.up().identify();el=(el.id==dropdown_container_id)?el:el.up("#"+dropdown_container_id);if((hide&&x>=0&&y>=0)||!el){var iframe_id="profile-drop-down-iframe";if($(iframe_id))$(iframe_id).hide();dropdown.hide();pointer.hide();}}},setLoggedOut:function(explicit_logout,keep_FB){if(explicit_logout){UserHistory.clearHistory();}
if(setLoggedOut)setLoggedOut();Behaviors.eraseCookie('_hulu_uid');Behaviors.eraseCookie('_hulu_qc');Behaviors.eraseCookie('_show_pl');if(Social.Common.fbDefined()&&FB.getAuthResponse()&&!keep_FB){FB.logout();}
Nav.loggedOut();document.fire("hulu:loggedOut");Behaviors.loggedIn=false;Login.email=null;FloatingLoginForm.hide();VideoRating.reenableAll();Masthead.loggedOut();ContinuousPlay.loggedOut();Behaviors.resetPlaylistLinks();},afterLogin:function(){Element.hide($('popup_frame'));this.setLoggedIn();Menu.hideAll();},afterLogout:function(){Element.hide($('popup_frame'));this.setLoggedOut();this.resetPlaylistLinks();Menu.hideAll();},loggedIn:false,onLoad:function(){this.ensureLogoState();this.toggleFirstDescendant(".play-button-hover","no-hover");this.enableUnobtrusiveJSLinks();if(!Behaviors.in_browse){this.applyActivatable();CheckboxPlus.applyCheckboxBehaviors();}
Event.observe(document.body,"click",this.closeDropDown.bindAsEventListener(this));Event.observe(document.body,"click",SuperPlus.out.bindAsEventListener(this));},ensureLogoState:function(){var logo=$('main-hulu-logo');if(logo){if(/screen_room/.test(logo.src)){return;}
else if((/plus/.test(logo.src))&&(!Behaviors.isPlusUser())){logo.hide();logo.src=Base.imageURL('/images/logo.jpg');logo.width=97;logo.up('li').style.width='120px';logo.show();}
else if(!(/plus/.test(logo.src))&&(Behaviors.isPlusUser())){logo.hide();logo.src=Base.imageURL('/images/logo-plus.jpg');logo.width=149;logo.up('li').style.width='171px';logo.show();}}},closeDropDown:function(ev){var el=Event.element(ev);if(this.openDropDown&&!el.hasClassName('cbx-choice')){this.openDropDown.closeDropDown();this.openDropDown=null;}
if($('privacy-select')&&!el.up('.cbx')&&!el.up('#privacy-select')){$$('#privacy-select .cbx-options').each(function(dd){dd.hide();});}},playlistInvalid:true,refreshingPlaylist:false,resetPlaylistLinks:function(){$$('.logged-in-remove').each(function(el){el.parentNode.removeChild(el);});$$('.logged-out-hide').each(function(el){el.removeClassName('logged-out-hide');});$$('.playlist-link').each(function(el){if(/-text$/.test(el.id)){el.hide();}
else{el.show();}});},onSubscribeSuccess:function(el){el=el.up('span');if(!el)return;if(Behaviors.loggedIn){Behaviors.updateLoggedInAction(el,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" title="You have subscribed to this title" />');}
else{Behaviors.updateLoggedInAction(el,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-warning.gif')+'" height="16" width="16" title="Please login first before subscribing to this title" />');ModalPopup.warn("Please login first before subscribing to this title");}},showPlusQueueWarning:function(el,pos,msg,from_check){el.writeAttribute('plus_avail',msg);var img=el.down('img',pos);if(!img)img=el;img.alt="";img.title="";img.addClassName('info_hover');img.addClassName('queue-add');if(from_check){if(Behaviors.in_browse)
InfoHover.observeLinkInBrowse(img);else
InfoHover.observeLinks();img.simulate('mouseover');}else{setTimeout(function(){img.simulate('mouseover');},100);setTimeout(function(){img.simulate('mouseout');},5000);}},checkAddQueue:function(el,plus_only,auth_valid){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if((plus_only&&!Behaviors.isPlusUser())&&!(auth_valid&&Behaviors.isAuthUser())){var msg='This video requires a Hulu Plus subscription. ';msg+='<a href="/plus" class="info-hover-tag">Learn more</a>';Behaviors.showPlusQueueWarning(el,0,msg,true);return false;}
return true;},getQueueCount:function(){var q_count=Behaviors.getCookie('_hulu_qc');if(q_count){q_count=parseInt(q_count);if(q_count>=0){return q_count;}}
return-1;},getAddQueueResponse:function(tv_valid,mobile_valid,multi){if(multi){if(Behaviors.isPlusUser()){return'You have added these videos to your queue &mdash; currently some episodes are available on web only.';}else{return'Some of these videos were not added to your queue since they require a Hulu Plus subscription. <a href="/plus" class="info-hover-tag">Learn more</a>';}}else{if(!Behaviors.isPlusUser()||(tv_valid&&mobile_valid))return null;var avail='computer'+(tv_valid?' and TV':mobile_valid?' and mobile':'');return"You have added this video to your queue &mdash; currently available on "+avail+" only.";}},onQueueSuccess:function(el,multiple,tv_valid,mobile_valid){if('SPAN'!=el.tagName)
el=$(el).up('span');if(!el)return;title=multiple?'these videos':'this video';if(Behaviors.loggedIn){var alt="You have queued "+title;var msg=Behaviors.getAddQueueResponse(tv_valid,mobile_valid);Behaviors.updateLoggedInAction(el,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" title="'+alt+'" />');Menu.hideAll();Behaviors.playlistInvalid=true;if(msg){Behaviors.showPlusQueueWarning(el,1,msg);}}
else{Behaviors.updateLoggedInAction(el,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-warning.gif')+'" height="16" width="16" title="Please login first before queuing '+title+'" />');ModalPopup.warn("Please login first before queuing "+title);}},requestPlusContent:function(el,show_id){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
new Ajax.Request('/plus/add_plus_content_request?show_id='+show_id,{onSuccess:function(){el.up('span').update('<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" style="position:relative;top:2px;" /> '+'Thanks for your interest. We will continue to try to obtain the rights to stream this program in Hulu Plus.');}});return false;},updateLoggedInAction:function(el,html){var a=el.down('a');if(a&&!a.hasClassName('logged-out-hide')){a.addClassName('logged-out-hide');new Insertion.Bottom(el,html);}},getCookie:function(name){var value=null;if(typeof(document.cookie)!='undefined'){$A(document.cookie.split(';')).each(function(v){var kv=v.split('=');if(name.toLowerCase()==kv[0].toLowerCase().strip()&&kv.length>1){value=kv[1].strip();throw $break;}});}
return value;},setSecureFBCookie:function(){if(!Social.Common.fbDefined())return;var key="fbsr_"+FB._apiKey;var value=Behaviors.getCookie(key);if(value!=null){Behaviors.setCookie(key,value,1.0/24,Base.commonCookieDomain());}},eraseSecureFBCookie:function(){if(!Social.Common.fbDefined())return;var key="fbsr_"+FB._apiKey;Behaviors.eraseCookie(key,Base.commonCookieDomain());},setCookie:function(name,value,days,domain){if(typeof(document.cookie)=='undefined')return;var expires=new Date();if(days){expires.setTime(expires.getTime()+(days*24*60*60*1000));}
else{expires.setMonth(expires.getMonth()+1);}
var encode=encodeURIComponent||escape;value=encode(name)+'='+encode(value);value+='; expires='+expires.toUTCString();value+='; path=/';if(domain!=null){value+='; domain='+domain;}else{document.cookie=encode(name)+'=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/';value+='; domain='+Base.commonCookieDomain();}
document.cookie=value;},eraseCookie:function(name,domain){if(domain!=null){Behaviors.setCookie(name,"",-1,domain);}else{Behaviors.setCookie(name,"",-1);}},cookiesEnabled:function(name){Behaviors.setCookie('_h_cookie_tester','foo',1);var enabled=Behaviors.getCookie('_h_cookie_tester')=='foo';Behaviors.eraseCookie('_h_cookie_tester');return enabled;},getFlashCookie:function(name){try{var swf=Behaviors.getCramSwf();if(swf==null){return null;}
return swf.get(name);}
catch(e){return null;}},setFlashCookie:function(name,value){try{var swf=Behaviors.getCramSwf();if(swf==null){return null;}
swf.set(name,value);}
catch(e){}},eraseFlashCookie:function(name){try{var swf=Behaviors.getCramSwf();if(swf==null){return null;}
swf.remove(name);}
catch(e){}},isFlashEnabled:function(){var swf=Behaviors.getCramSwf();return swf!=null&&(typeof cram.valid=='function')&&cram.valid()&&Behaviors.cramLoaded;},getCramSwf:function(){if(!cram){return null;}
var tmp=new cram.methods.flash();return document.getElementById('_cram_swf');},getUsername:function(){return Utf8.decode(unescape(Behaviors.getCookie('_hulu_uname')));},getUserId:function(){var value=Behaviors.getCookie('_hulu_uid');return value?parseInt(value):-1;},getUserFBId:function(){var value=Behaviors.getCookie('_fb_id');return value?parseInt(value):-1;},getUserEncryptedId:function(){var value=Behaviors.getCookie('_hulu_e_uid')||"";return value;},getAvatarUrl:function(){var fbId=Behaviors.getUserFBId();if(fbId!=-1){return"https://graph.facebook.com/"+fbId+"/picture?";}
var hId=Behaviors.getUserEncryptedId();if(hId!=""){var path="/users/picture/"+hId+"?cb=t.png";return path;}
return null;},getGUID:function(){var guid=Behaviors.getCookie("guid");if(guid==null){guid=Beacon.getNewGuid();}
Behaviors.setCookie("guid",guid,3650,Base.commonCookieDomain());return guid;},getABTestCohort:function(){var cohort="";var guid=Behaviors.getCookie("guid").toLowerCase();if(guid==null){guid=Beacon.getNewGuid().toLowerCase();}
if(/.*(a.|b[0-9])$/.test(guid)){cohort="B";}else if(/.*(c.|d[0-9])$/.test(guid)){cohort="C";}else{cohort="Control";}
return cohort;},getUserPlanId:function(){var value=Behaviors.getCookie('_hulu_plid');return value?parseInt(value):0;},getPgid:function(){if(Behaviors.getUserId()<=0)return 1;var value=Behaviors.getCookie('_hulu_pgid');value=value?parseInt(value):1;return value;},getFBBanner:function(){var value=Behaviors.getCookie(Social.Facebook.BANNER_COOKIE);return value?parseInt(value):0;},getSessionReferrer:function(update){var referrer=Behaviors.getCookie("_session_referrer");if(referrer==null||update){referrer=document.referrer.replace(document.location.protocol+"//","");referrer=referrer.substr(0,200);Behaviors.setCookie("_session_referrer",referrer,1/12);}
return referrer;},getCMPId:function(){var value=Behaviors.getCookie("_hulu_plus_cmp");return value?parseInt(value):"";},isAuthUser:function(){return(Behaviors.getPgid()&64)>0;},isPlusUser:function(){if(Behaviors.getUserId()<=0)return false;var pgid_value=Behaviors.getPgid();if(pgid_value){return((parseInt(pgid_value)&2)>0);}else{return false;}},enableVideoPreview:function(){if(Behaviors.is_video_previewable&&!(Behaviors.is_auth_video&&Auth.getCookie()['expires']>0)){return(!Behaviors.isLoggedIn()||!Behaviors.isPlusUser())}
return false;},clearPlus:function(){if(typeof(document.cookie)=='undefined')return;if(Behaviors.isPlusUser()){Behaviors.eraseCookie('_hulu_pgid',Base.commonCookieDomain());}},reloadPage:function(reload){if(reload===false)return;if(location.pathname.match(/^\/support\/article\/\d+/))return;if(document.location.href.match(/\/recommendations/)){location.reload();return;}
if(document.location.href.match(/\/profile\/?/)||document.location.href.match(/\/favorites/i)||document.location.href.match(/\/screening_room/i)||document.location.href.match(/\/inbox/i)){window.location="/";}else{Behaviors.reloadCurrentPage();}},reloadCurrentPage:function(reload){if(reload===false)return;try{recordStateBeforeRefresh(Behaviors.getUserId());}
catch(e){}
location.reload();},getEmailValidationStatus:function(){var value=Behaviors.getCookie('_hulu_evs');return value?parseInt(value):-1;},isLoggedIn:function(){var value=Behaviors.getCookie('_hulu_uid');Behaviors.loggedIn=(value!=null&&!value.blank()&&value>0);return Behaviors.loggedIn;},isHoa:function(){var value=Behaviors.getCookie('_hoa');Behaviors.hoa=(value!=null&&value=='true');return Behaviors.hoa;},isHob:function(){var value=Behaviors.getCookie('_hob');Behaviors.hob=(value!=null&&value=='true');return Behaviors.hob;},showSocialCommentPublishMessage:function(callback){var value=Behaviors.getCookie('_fb_pub_sc');var fbCheckCallback=function(){Social.Facebook.getPublishStreamPermission(function(perm){if(perm)callback();});};if(value==null){new Ajax.Request('/users/get_fb_pub_sc?cb='+(new Date).getTime(),{method:'get',onSuccess:function(transport){if(Behaviors.getCookie('_fb_pub_sc')=='true')fbCheckCallback();}});}else{if(value=='true')fbCheckCallback();}},isFacebookConnected:function(){var value=Behaviors.getCookie('_fb_connected');return Behaviors.isLoggedIn()&&(value=='1');},shouldShowRoadBlock:function(){var value=Behaviors.getCookie(Social.Facebook.SHOW_ROADBLOCK_COOKIE);return value=='1'&&Behaviors.isFacebookConnected();},hasAgreedSocial:function(){var value=Behaviors.getCookie(Social.Facebook.AGREE_ROADBLOCK_COOKIE);return value=='1'&&Behaviors.isFacebookConnected();},isSocialOn:function(){var value=Behaviors.getCookie(Social.Facebook.IS_SOCIAL_COOKIE);return value=='1'&&Behaviors.isFacebookConnected();},isSocialOff:function(){var value=Behaviors.getCookie(Social.Facebook.IS_SOCIAL_COOKIE);return value=='0'&&Behaviors.isFacebookConnected();},isCanvasConnected:function(canvas_status){return canvas_status&&typeof(canvas_status)!='undefined'&&(canvas_status=='fb_canvas_new'||canvas_status=='fb_canvas_merge');},isCanvasOnly:function(canvas_status){return canvas_status&&typeof(canvas_status)!='undefined'&&canvas_status=='fb_canvas_new';},fbNotifyShown:function(){var cookie=Behaviors.getCookie('_fb_notify');cookie=(cookie!=null&&!cookie.blank())
var cramCookieSet=false;var flashVal=Behaviors.getFlashCookie('_fb_notify');if(flashVal!=null){cramCookieSet=flashVal>new Date().getTime();}
return cookie||cramCookieSet;},isEmailValidated:function(){return Behaviors.getEmailValidationStatus()>0;},sendEmailValidation:function(callback,email_field,jump){var url="/account/send_email_validation";var params={jump:jump}
if(!Behaviors.isLoggedIn()){url="/account/send_new_email_validation";params["email"]=$(email_field).value;}
new Ajax.Request(url,{parameters:params,onSuccess:function(transport){var email=transport.responseText;callback(email);}});},showSubmitPermission:function(action){ModalPopup.warn("Newly created accounts may not "+action+" immediately. We apologize for the inconvenience.");},switchPersonalTab:function(el){$('personalized-container').select('div.tabs h2').each(function(h2){h2.removeClassName('active');});var span=el.up('span');span.down('h2').addClassName('active');},updateFooterLinks:function(){$$('.footer-link').each(function(link){link.href+='?src=footer';});},onFBLiked:function(url){try{var liked_type=Share.activity_data["item_type"];_gaq.push(['_trackEvent',"Facebook","like",liked_type]);}catch(e){}},isInCanvasApp:function(){return Beacon.COMMON_STANDARD_PARAMS.distroplatform.toLowerCase()=='edp'&&Beacon.COMMON_STANDARD_PARAMS.distro.toLowerCase()=='facebook';},hideIE6:function(){var ie6=$('no-ie6');if(ie6){ie6.hide();Behaviors.setCookie('_ie6_notice','off',30);}},showIE6:function(){if(/^\/signup/.exec(window.location.pathname))return;var ie6=$('no-ie6');if(ie6&&Behaviors.getCookie('_ie6_notice')!='off'){ie6.show();}},escapeForRegex:function(s){return s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");},addPlaceholderEmail:function(el,video_id){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return;}
url="/users/add_to_placeholder_notification?video_id="+encodeURIComponent(video_id);new Ajax.Request(url,{onSuccess:function(transport){Behaviors.placeholderEmails[video_id]=true;el.src=Base.imageURL('/images/icon-check.gif');el.title="You have requested to be notified by email when this video becomes available on Hulu";el.onmouseover="";el.onmouseout="";}});},enableUnobtrusiveJSLinks:function(){$$('a.report-link').each(function(el){el.observe('click',function(ev){var a=Event.element(ev);if(a&&!a.match('a'))a=a.up('a');if(!a)return;if(Behaviors.isLoggedIn()){var url=el.getAttribute('data-url');var after=el.getAttribute('data-after');if(url&&after){new Ajax.Request(url,{onComplete:function(){var p=a.up();p.update(after+' <img src="'+Base.imageURL('/images/icon-check.gif')+'" style="vertical-align: top"/>');}});}}
else{FloatingLoginForm.show(a);}});el.removeClassName('report-link');});$$('a.clips-collection-link').each(function(el){el.observe('click',function(ev){var a=Event.element(ev);if(a&&!a.match('a'))a=a.up('a');if(!a)return;var url=el.getAttribute('data-url');if(!url)return;showCollectionLoadingPopup();new Ajax.Request(url,{method:"get",onFailure:function(){ModalPopup.warn('Sorry, this collection is not available at the moment.');}});});el.removeClassName('clips-collection-link');});$$('a.notify-new-link').each(function(el){el.observe('click',function(ev){var a=Event.element(ev);if(a&&!a.match('a'))a=a.up('a');if(!a)return;if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(this);return;}
var type=el.getAttribute('data-type');var value=el.getAttribute('data-value');var name=el.getAttribute('data-name');if(!name)name=value;if(!value||!type)return;var url=null;switch(type){case'device':url="/plus/add_new_device_notification?device="+encodeURIComponent(value);break;case'live_event':$('schedule-id').value=value;if($('notify-email').innerHTML){FloatingDiv.show(a,$('notify-me'),330);return false;}
url="/users/get_email";break;default:url="/users/add_to_placeholder_notification?video_id="+encodeURIComponent(value);}
new Ajax.Request(url,{onSuccess:function(transport){var span=a.up('span');if(!span)return;if(type=="live_event"){var x=$('notify-email');if(x){x.update(transport.responseJSON.email);FloatingDiv.show(a,$('notify-me'),330);}}
else if(Behaviors.loggedIn){if(type=="device"){Behaviors.updateLoggedInAction(span,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" '+'title="We\'ll email you when Hulu Plus is available on '+name.escapeHTML()+'." />');}
else{Behaviors.updateLoggedInAction(span,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" title="You have requested to be notified by email when this video becomes available on Hulu" />');Menu.hideAll();Behaviors.playlistInvalid=true;}}
else{if(device=="video"){Behaviors.updateLoggedInAction(span,'<img class="logged-in-remove" src="'+Base.imageURL('/images/icon-warning.gif')+'" height="16" width="16" title="Please login first before requesting a notification email for this video" />');ModalPopup.warn("Please login first before requesting a notification email for this video");}}}});});el.removeClassName('notify-new-link');});}});var Utf8={decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}};Behaviors.applyCufon();document.observe("hulu:loggedIn",Behaviors.ensureLogoState);document.observe("hulu:loggedOut",Behaviors.ensureLogoState);document.observe("cram:load",function(){Behaviors.cramLoaded=true;});Ajax.Responders.register({onComplete:function(transport){Behaviors.onLoad();if(!Behaviors.in_browse){Behaviors.applyCufon();}
ThumbnailLazyLoad.init();Social.Common.populateAll(true);if(transport&&transport.url&&/add_to_playlist/.test(transport.url)){google_analytics_ajax(transport.url);}},onCreate:function(transport){if(transport.method.toLowerCase()=="get"){var pgid=Behaviors.getPgid();if(pgid>1){if(transport.url.indexOf("?")>=0){transport.url+="&pgid="+pgid;}else{transport.url+="?pgid="+pgid;}}}}});
var Beacon=Class.create();Object.extend(Beacon,{PRODUCTION_STANDARD_HOST:"http://t2.hulu.com",PRODUCTION_SECURE_STANDARD_HOST:"https://a248.e.akamai.net/t2.hulu.com",QA_STANDARD_HOST:"http://t2.huluqa.com",STANDARD_PREFIX:"/v3",REALTIME_PREFIX:"/beacon/v3",JAPAN_REGION_PREFIX:"/jp",TYPE_SITE:"sitetracking",TYPE_REVENUE:"revenue",TYPE_AD_INTERACTION:"adinteraction",TYPE_SEARCH_TRACKING:"searchtracking",TYPE_PLUS:"plustracking",EVENT_SESSION_START:"session",EVENT_PAGE_LOAD:"pageload",EVENT_THUMBNAIL_CLICK:"thumbnailclick",EVENT_CLICK:"click",EVENT_PAGE_INFO_LOAD:"pageinfo/load",EVENT_HOVER_OPEN:"hover/open",EVENT_SOCIAL_INTERACTION:"social/interaction",EVENT_COMMENT:"comment",EVENT_ASSET_IMPRESSION:"assetimpression",EVENT_PERFORMANCE_LOGO_OPEN:"perflogo/open",EVENT_PERFORMANCE_LOGO_CLOSE:"perflogo/close",EVENT_QUERY:"query",EVENT_AUTOCOMPLETE:"autocomplete",EVENT_PERF:"perf",EVENT_SIGNUP:"signup",EVENT_WATCH_TITLE:"watchtitle",EVENT_SHARE_SITE:"sharesite",EVENT_FACE_PILE:"facepile",EVENT_PUBLISH:"publish",EVENT_SIGNUP_FLOW:"flow",EVENT_SIGNUP_CONVERSION:"conversion",SOCIAL_IDENTITY_FACEBOOK_BEACON_ID:1,COMMON_STANDARD_PARAMS:{computerguid:null,userid:null,planid:null,sitesessionid:null,socialidentities:null,os:null,client:null,pageurl:null,referrerurl:null,siteversion:"1.0.0",distro:"hulu",distroplatform:"hulu"},production:false,region_prefix:'',fireSessionStart:Behaviors.getCookie("sid")==null,S4:function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);},getNewGuid:function(){return(Beacon.S4()+Beacon.S4()
+Beacon.S4()
+Beacon.S4()
+Beacon.S4()
+Beacon.S4()+Beacon.S4()+Beacon.S4()).toUpperCase();},sessionId:function(){var sid=Behaviors.getCookie("sid");if(sid==null){sid=Beacon.getNewGuid();Behaviors.getSessionReferrer(true);}
Behaviors.setCookie("sid",sid,1/12);return sid;},computerGUID:function(){return Behaviors.getGUID();},socialIdentityIds:function(){arr=[];var canvas_status=Behaviors.getCookie("_canvas_status");if(Behaviors.isFacebookConnected()||Behaviors.isCanvasConnected(canvas_status)){arr.push(Beacon.SOCIAL_IDENTITY_FACEBOOK_BEACON_ID);}
return arr;},getStandardHost:function(){if(/^https:/.test(document.location.href)){return Beacon.PRODUCTION_SECURE_STANDARD_HOST;}
else{return Beacon.production?Beacon.PRODUCTION_STANDARD_HOST:Beacon.QA_STANDARD_HOST;}},getBeaconAttribute:function(el,attr){var value='';if($(el).readAttribute(attr)!=null){value=$(el).readAttribute(attr);}
else if($(el).up('.'+attr)!=null&&$(el).up('.'+attr).readAttribute(attr)!=null){value=$(el).up('.'+attr).readAttribute(attr);}
return value;},send:function(url,useAjax){if(useAjax){new Ajax.Request(url+"&cb="+(new Date).getTime(),{asynchronous:false});}
else{pingImage(url+"&cb="+(new Date).getTime());}},trackStandardBeacon:function(type,event,data,useAjax){if(!Beacon.COMMON_STANDARD_PARAMS.computerguid){Beacon.COMMON_STANDARD_PARAMS.computerguid=Beacon.computerGUID();}
if(!Beacon.COMMON_STANDARD_PARAMS.userid){var user_id=Behaviors.getUserId();Beacon.COMMON_STANDARD_PARAMS.userid=user_id>0?user_id:0;}
if(!Beacon.COMMON_STANDARD_PARAMS.sitesessionid){var site_session_id=Beacon.sessionId();Beacon.COMMON_STANDARD_PARAMS.sitesessionid=site_session_id!=null&&site_session_id.length>0?site_session_id:'';}
if(!Beacon.COMMON_STANDARD_PARAMS.pageurl){try{Beacon.COMMON_STANDARD_PARAMS.pageurl=location.toString();}catch(e){}}
if(!Beacon.COMMON_STANDARD_PARAMS.pagetype){try{Beacon.COMMON_STANDARD_PARAMS.pagetype=Beacon.get_page_type();}catch(e){}}
if(!Beacon.COMMON_STANDARD_PARAMS.referrerurl){try{Beacon.COMMON_STANDARD_PARAMS.referrerurl=document.referrer;}catch(e){}}
if(!Beacon.COMMON_STANDARD_PARAMS.socialidentities){Beacon.COMMON_STANDARD_PARAMS.socialidentities=Beacon.socialIdentityIds().join(',');}
if(!Beacon.COMMON_STANDARD_PARAMS.planid){var plan_id=Behaviors.getUserPlanId();Beacon.COMMON_STANDARD_PARAMS.planid=plan_id>0?plan_id:0;}
if(!Beacon.COMMON_STANDARD_PARAMS.os||!Beacon.COMMON_STANDARD_PARAMS.client){Beacon.COMMON_STANDARD_PARAMS.os=[BrowserDetect.OS,BrowserDetect.OSVersion].join(' ');Beacon.COMMON_STANDARD_PARAMS.client=[BrowserDetect.browser,BrowserDetect.version].join(' ');}
var e=encodeURIComponent||escape;var params={};for(var commonKey in Beacon.COMMON_STANDARD_PARAMS){params[commonKey]=Beacon.COMMON_STANDARD_PARAMS[commonKey];}
if(data){for(var key in data){if(data[key]!=null){params[key.toString().toLowerCase()]=e(data[key]);}}}
var url=Beacon.getStandardHost()+Beacon.STANDARD_PREFIX+Beacon.region_prefix+'/'+type+'/'+event+'?'+$H(params).toQueryString();Beacon.send(url,useAjax);},trackSessionStart:function(){Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_SESSION_START);},trackPageLoad:function(){if(Beacon.fireSessionStart){Beacon.trackSessionStart();Beacon.fireSessionStart=false;}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_PAGE_LOAD);},trackThumbnailClick:function(el,delete1,delete2){var regionName=Beacon.getBeaconAttribute(el,'beaconregion');var zoneName=Beacon.getBeaconAttribute(el,'beaconzone');var beacontype=Beacon.getBeaconAttribute(el,'beacontype');var beaconid=Beacon.getBeaconAttribute(el,'beaconid');var hoverSocial=beacontype=='video'&&InfoHover.videoHoverWasSocial[beaconid]!=null&&InfoHover.videoHoverWasSocial[beaconid]==true;var hoverViewed=InfoHover.hoverTypeHash[beacontype]!=null&&InfoHover.hoverTypeHash[beacontype][beaconid]!=null;var position=-1;if(regionName!=null&&regionName!=''){TrackingSources.setComponent(regionName);var region;if($(el).readAttribute('beaconregion')!=null){region=$(el);}
else if($(el).up('.beaconregion')!=null&&$(el).up('.beaconregion').readAttribute('beaconregion')!=null){region=$(el).up('.beaconregion');}
if(region){var thumbs=region.getElementsByClassName('beaconid');var idsHash={};var counter=0;for(var x=0;x<thumbs.length;x++){if(thumbs[x].readAttribute('beaconid')!=null){var id=thumbs[x].readAttribute('beaconid');if(id==beaconid){position=counter;break;}
if(!idsHash[id]){idsHash[id]=true;counter++;}}}}}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_THUMBNAIL_CLICK,{type:beacontype,clickid:beaconid,hoverviewed:hoverViewed,hoversocial:hoverSocial,regionname:regionName,zone:zoneName,position:position});},trackPageInfoLoad:function(el){var regionName=Beacon.getBeaconAttribute(el,'beaconregion');var zoneName=Beacon.getBeaconAttribute(el,'beaconzone');var layout='';var thumbs=$(el).getElementsByClassName('beaconid');var typeHash={};for(var x=0;x<thumbs.length;x++){var type='';if(thumbs[x].readAttribute('beacontype')!=null){type=thumbs[x].readAttribute('beacontype');if(type.length>0){type=type.charAt(0).toLowerCase();}}
if(thumbs[x].readAttribute('beaconid')!=null){type+='-'+thumbs[x].readAttribute('beaconid');}
if(!typeHash[type]){layout+=type+'|';typeHash[type]=true;}}
if(layout.length>0){layout=layout.substring(0,layout.length-1);}
else{return;}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_PAGE_INFO_LOAD,{zone:zoneName,regionname:regionName,layout:layout});},trackHover:function(hoverType,hoverId,socialDataPresent){Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_HOVER_OPEN,{type:hoverType,hoverid:hoverId,socialdatapresent:socialDataPresent});},trackSocialInteraction:function(el,interactionType,forcedRegionName){var regionName='';if(el==null||forcedRegionName!=null){regionName=forcedRegionName}
else if(el!=null){regionName=Beacon.getBeaconAttribute(el,'beaconregion');}
data={type:interactionType,regionname:regionName}
var user_id=Behaviors.getUserId();if(user_id>0){data['user_id']=user_id;}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_SOCIAL_INTERACTION,data);},trackComment:function(fbSelected,twitterSelected,comment_length,content_id,start_time,drag_count){Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_COMMENT,{facebook:fbSelected,twitter:twitterSelected,commentlength:comment_length,contentid:content_id,starttime:start_time,dragcount:drag_count});},trackAssetImpression:function(placementId,creativeId){var params={placementid:placementId};if(creativeId!=null){params.creativeid=creativeId;}
Beacon.trackStandardBeacon(Beacon.TYPE_REVENUE,Beacon.EVENT_ASSET_IMPRESSION,params);},trackAdInteractionClick:function(type,placementId,creativeId){var params={type:type,placementid:placementId};if(creativeId!=null){params.creativeid=creativeId;}
Beacon.trackStandardBeacon(Beacon.TYPE_AD_INTERACTION,Beacon.EVENT_CLICK,params);},trackAdInteractionShareSite:function(site,ad_unit_id,placement_id,creative_id){var params={site:site,adunitid:ad_unit_id};if(placement_id)params.placementid=placement_id;if(creative_id)params.creativeid=creative_id;Beacon.trackStandardBeacon(Beacon.TYPE_AD_INTERACTION,Beacon.EVENT_SHARE_SITE,params);},trackSiteVideoPublish:function(contentId,target,cpIdentifier,packageId,packageAvailability,sessionGuid){Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_PUBLISH,{contentid:contentId,cpidentifier:cpIdentifier,packageid:packageId,packageavailability:packageAvailability,sessionguid:sessionGuid,publishtype:"manual-site",publisheditem:"video",publishtarget:target});},trackSiteUnpublish:function(publishedItem,contentId,force){var params={publishtype:"unpublish-site",publisheditem:publishedItem,publishtarget:"facebook"}
if(contentId){params["contentid"]=contentId}
if(force){params["publishtype"]="unpublish-force";}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_PUBLISH,params);},trackPreCancelClick:function(reasonMsg){var params={reason:reasonMsg};Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_CLICK,params);},trackPerformanceLogoOpen:function(placementId,creativeId){var params={placementid:placementId};if(creativeId!=null){params.creativeid=creativeId;}
Beacon.trackStandardBeacon(Beacon.TYPE_AD_INTERACTION,Beacon.EVENT_PERFORMANCE_LOGO_OPEN,params);},trackPerformanceLogoClose:function(placementId,creativeId){var params={placementid:placementId};if(creativeId!=null){params.creativeid=creativeId;}
Beacon.trackStandardBeacon(Beacon.TYPE_AD_INTERACTION,Beacon.EVENT_PERFORMANCE_LOGO_CLOSE,params);},trackSearch:function(data){var dataHash=$H(data);switch(dataHash.get("format")){case"on_search":Beacon.trackStandardBeacon(Beacon.TYPE_SEARCH_TRACKING,Beacon.EVENT_QUERY,data);break;case"on_click_serp":Beacon.trackStandardBeacon(Beacon.TYPE_SEARCH_TRACKING,Beacon.EVENT_CLICK,data);break;case"on_click_autocomplete":Beacon.trackStandardBeacon(Beacon.TYPE_SEARCH_TRACKING,Beacon.EVENT_AUTOCOMPLETE,data);break;default:}},trackSignUp:function(data,useAjax){data.sv="3";Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_SIGNUP,data,useAjax);},trackWatchTitle:function(type,rid){var data={type:type};if(rid.length>0){data.relatedid=rid;}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_WATCH_TITLE,data);},trackFacePile:function(type,rid,friendCount,hoverTransitionCount,clickTransitionCount,largestViewedIndex){var data={relatedtype:type,relatedid:rid,friendcount:friendCount,hovertransitioncount:hoverTransitionCount,clicktransitioncount:clickTransitionCount,largestviewedindex:largestViewedIndex}
Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_FACE_PILE,data);},STANDARD_ENDPOINT:"http://t2.hulu.com",SECURE_STANDARD_ENDPOINT:"https://a248.e.akamai.net/t2.hulu.com",REALTIME_ENDPOINT:"http://t.hulu.com",STANDARD_URL:"{endpoint}/v3/{beacon_name}/{event}?{common_params}&{specific_params}",REALTIME_URL:"{endpoint}/beacon/v2/{beacon_name}?event={event}&{common_params}&{specific_params}",FEATURED_ITEM_URL:"{endpoint}/v3/siteinteraction/{event}?{common_params}&salesforceid={sf_tag}&target={target}&param={param}&value={value}",MOVE_TEST_URL:"{endpoint}/beacon/v2/movetest?version={version}&browser={browser}&os={os}&username={username}",SEND_HULU_URL:"{endpoint}/v3/contentinteraction/{event}?{common_params}&client=plugin&embedurl={MD5}&packageid={packageid}&site={site}",user_params:{computerguid:null,userid:null,planid:null,os:null,client:null,distro:"Hulu",distroplatform:"Hulu"},features:{},init:function(){Try.these(function(){Beacon.populate_common_params();});if(Beacon.user_params.computerguid){$H(Beacon.features).each(function(feature){Beacon.send_featured_event('thumbnailload',feature[1]);});}},get_standard_endpoint:function(){if(/^https:/.test(document.location.href)){return Beacon.SECURE_STANDARD_ENDPOINT;}
else{return Beacon.STANDARD_ENDPOINT;}},get_realtime_endpoint:function(){return Beacon.REALTIME_ENDPOINT;},populate_common_params:function(){if(!Beacon.user_params.computerguid){try{Beacon.user_params.computerguid=Behaviors.getGUID();}catch(e){}}
if(!Beacon.user_params.userid){var user_id=Behaviors.getUserId();Beacon.user_params.userid=user_id>0?user_id:0;}
if(!Beacon.user_params.planid){plan_id=Behaviors.getUserPlanId();Beacon.user_params.planid=plan_id>0?plan_id:0;}
if((!Beacon.user_params.os)||(!Beacon.user_params.client)){Beacon.user_params.os=[BrowserDetect.OS,BrowserDetect.OSVersion].join(' ');Beacon.user_params.client=[BrowserDetect.browser,BrowserDetect.version].join(' ');}},get_page_type:function(){var path=document.location.pathname;var pageType=null;var whiteList=/^\/(watch\/|browse\/|favorites|inbox|blockbusters|labs|plus|profile|recommendations)/;if(whiteList.test(path)){pageType=whiteList.exec(path)[0].replace(/^\//,'').toLowerCase();}
if(pageType==null){if(_controllerName!=undefined&&_controllerName!=null){pageType=_controllerName;}
else{pageType="unknown";}}
return pageType;},get_common_params:function(){Beacon.populate_common_params();return Beacon.user_params;},feature_clicked:function(id){var feature=Beacon.features[id];if(feature){Beacon.send_featured_event('thumbnailclick',feature);}},feature_loaded:function(url,action,index,id){Beacon.features[id]={url:url,position:index,action:action,tag:arguments[4]||""};},send_event:function(name,ev,params){var e=encodeURIComponent||escape;var beacon_url=Beacon.STANDARD_URL.replace('{endpoint}',Beacon.get_standard_endpoint()).replace('{beacon_name}',e(name)).replace('{event}',e(ev)).replace('{common_params}',$H(Beacon.get_common_params()).toQueryString()).replace('{specific_params}',$H(params).toQueryString());Beacon.send(beacon_url);},send_realtime_event:function(){},send_move_test:function(version,username){var e=encodeURIComponent||escape;var ua=navigator.userAgent;var os=$A(['Windows','Macintosh','Linux','X11']).find(function(o){return ua.indexOf(o)>=0;});os=os||'Other';var browser=$A(['Safari','Chrome','AppleWebKit','Opera','Gecko']).find(function(b){return ua.indexOf(b)>=0;});browser=browser||'Other';Beacon.send(Beacon.MOVE_TEST_URL.replace('{endpoint}',Beacon.get_realtime_endpoint()).replace('{version}',e(version)).replace('{browser}',e(browser)).replace('{os}',e(os)).replace('{username}',e(username||ua)));},send_featured_event:function(ev,feature){var dict={target:feature.url,computer:Beacon.user_params.computerguid};var e=encodeURIComponent||escape;var url=Beacon.FEATURED_ITEM_URL.replace('{endpoint}',Beacon.get_standard_endpoint()).replace('{event}',e(ev)).replace('{common_params}',$H(Beacon.get_common_params()).toQueryString()).replace('{param}',e(feature.action)).replace('{value}',e(feature.position)).replace('{target}',e(feature.url)).replace('{sf_tag}',e(feature.tag));Beacon.send(url);},send_hulu_event:function(ev,site){Try.these(function(){Beacon.user_params.computerguid=Behaviors.getGUID();});if(Beacon.user_params.computerguid){var packageid=(Behaviors.isPlusUser())?1:0;var uid=Behaviors.getUserId();var e=encodeURIComponent||escape;uid=uid>0?uid:0;var url=Beacon.SEND_HULU_URL.replace('{endpoint}',Beacon.get_standard_endpoint()).replace('{event}',e(ev)).replace('{common_params}',$H(Beacon.get_common_params()).toQueryString()).replace('{MD5}',e(document.location)).replace('{packageid}',e(packageid)).replace('{site}',e(site));Beacon.send(url);}},encodeDict:function(dict){return encodeURIComponent($H(dict).map(function(kv){return[kv[0],encodeURIComponent(kv[1])].join(':');}).join(';'));}});
function sendCheckboxTracking(selectBox,beacontype,eventtype,userid,dstid,dstlist,filter,page,offset,location,sid,custom_option)
{if(typeof(_rTracking)!='undefined'&&_rTracking!=null)
{if(selectBox.checked==true)
_rTracking.send(beacontype,eventtype,userid,"1",dstid,dstlist,filter,page,offset,location,null,sid,custom_option);else
_rTracking.send(beacontype,eventtype,userid,"0",dstid,dstlist,filter,page,offset,location,null,sid,custom_option);}}
var RecommendTracking=Class.create();Object.extend(RecommendTracking.prototype,{delay:null,sessionId:'',computerguid:'',isInitialized:0,retry_count:0,pendingParams:[],query:null,beacon_name:"recommendationTracking",beacon_event:"tracking",rec_params:{recommendationtype:null,eventtype:null,srcid:null,dstid:null,dstlist:null,filter:null,page:null,offset:null,location:null,query:null,timestamp:null,sessionid:null},initialize:function(){this.sessionId=Beacon.sessionId();this.computerguid=Beacon.computerGUID();this.isInitialized=1;this.retry_count=0;},useCookieSend:function(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom){var cookiecontent=this.getCookieContent(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom);Behaviors.setCookie("_r_tracking_",$H(cookiecontent).toJSON(),5/60/24,Base.commonCookieDomain());},send:function(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom){if(this.computerguid==null&&this.retry_count<10)
{this.setDelay(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom);return;}
this.populateRecUrlParams(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom);Beacon.send_event(this.beacon_name,this.beacon_event,this.rec_params);this.query=null;},setDelay:function(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom){if(typeof(this.delay)!='undefined'&&this.delay!=null)
{this.pendingParams.push(this.getParamsArray(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom));return;}
this.pendingParams.push(this.getParamsArray(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom));this.delay=setInterval(function(){this.computerguid=Beacon.computerGUID();if(this.computerguid!=null||this.retry_count>=10)
{clearInterval(this.delay);this.pendingParams.each(function(p)
{this.populateRecUrlParams(p["beacontype"],p["eventtype"],p["userid"],p["srcid"],p["dstid"],p["dstlist"],p["filter"],p["page"],p["offset"],p["location"],p["cachebuster"],p["sid"],p['custom']);Beacon.send_event(this.beacon_name,this.beacon_event,this.rec_params);}.bind(this));this.pendingParams=[];}
this.retry_count+=1;}.bind(this),1000);},populateRecUrlParams:function(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom){if(beacontype!=null)
this.rec_params.recommendationtype=beacontype;if(eventtype!=null)
this.rec_params.eventtype=eventtype;if(srcid!=null)
this.rec_params.srcid=srcid;if(dstid!=null)
this.rec_params.dstid=dstid;if(dstlist!=null)
this.rec_params.dstlist=dstlist;if(filter!=null)
this.rec_params.filter=filter;if(page!=null)
this.rec_params.page=page;if(offset!=null)
this.rec_params.offset=offset;if(location!=null)
this.rec_params.location=location;if(this.query!=null)
this.rec_params.query=this.query;this.rec_params.timestamp=(new Date()).getTime();this.rec_params.sessionid=this.sessionId;},getParamsArray:function(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom){var p=new Array();p["beacontype"]=beacontype;p["eventtype"]=eventtype;p["userid"]=userid;p["srcid"]=srcid;p["dstid"]=dstid;p["dstlist"]=dstlist;p["filter"]=filter;p["page"]=page;p["offset"]=offset;p["location"]=location;p["cachebuster"]=cachebuster;p["sid"]=sid;p["custom"]=custom;return p;},getCookieContent:function(beacontype,eventtype,userid,srcid,dstid,dstlist,filter,page,offset,location,cachebuster,sid,custom){if(sid==null)
sid=this.sessionId;var importantTrackInfo={location:location,btype:beacontype,etype:eventtype,sid:sid,srcid:srcid,dstid:dstid,custom:custom};if(this.query){importantTrackInfo.filter=filter;importantTrackInfo.query=this.query;}
if(/^\/plus\/pre_cancel/.test(document.location.pathname)){importantTrackInfo.fromPreCancel="true";}
return importantTrackInfo;},loadCookieAndSend:function(cookieContent){var cookies=$A(cookieContent.split("|||"));var btype="";var etype="";var srcid="";var dstid="";var sid="";var userid="";var location="";var filter="";var custom="";if(typeof(Behaviors)!='undefined'&&Behaviors!=null)
userid=Behaviors.getUserId();for(var i=0;i<cookies.size();i++){var myCookie=cookies[i].evalJSON();if(myCookie)
{btype=myCookie.btype;etype=myCookie.etype;srcid=myCookie.srcid;dstid=myCookie.dstid;sid=myCookie.sid;location=myCookie.location;filter=myCookie.filter;this.query=myCookie.query;custom=myCookie.custom;}
this.send(btype,etype,userid,srcid,dstid,null,filter,null,null,location,null,sid,custom);if(myCookie.fromPreCancel&&myCookie.fromPreCancel=="true"){Beacon.trackPreCancelClick('Reason1');_gaq.push(['_trackEvent','PreCancel','ClickReason1']);}}}});var RelatedSearch=Class.create();Object.extend(RelatedSearch,{tracking:null,click:function(query,showid){try{if(RelatedSearch.tracking==null){RelatedSearch.tracking=new RecommendTracking();}
RelatedSearch.tracking.query=query;var userid=Behaviors.getUserId();var loc='searchpage';RelatedSearch.tracking.useCookieSend('RelatedSearch','click',userid,-1,showid,null,query,null,null,loc,null);}catch(ex){};},initLoadAndSend:function(query,node_id,show_ids){var el=$(node_id);if(!show_ids){var show_ids=[];$(node_id).childElements().each(function(node){show_ids.push(node.readAttribute("info"));});show_ids=show_ids.join("_");}
function load_and_show(ev){var _top=document.viewport.getScrollOffsets();_top=_top.top+document.viewport.getHeight();if(el){var elTop=el.cumulativeOffset().top+el.getHeight();if(_top>=(elTop-100)){Event.stopObserving(window,"scroll",load_and_show);Event.stopObserving(window,"resize",load_and_show);if(RelatedSearch.tracking==null){RelatedSearch.tracking=new RecommendTracking();}
try{RelatedSearch.tracking.query=query;var userid=Behaviors.getUserId();var loc='searchpage';RelatedSearch.tracking.send('RelatedSearch','showup',userid,-1,null,null,query,null,null,loc,null);RelatedSearch.tracking.query=query;RelatedSearch.tracking.send('RelatedSearch','dstlistchange',userid,-1,null,show_ids,query,null,null,loc,null);}catch(ex){}}}}
Event.observe(window,"scroll",load_and_show);Event.observe(window,"resize",load_and_show);load_and_show();}});var BookmarkTracking=Class.create();Object.extend(BookmarkTracking,{source:"http://t2.hulu.com/v3/steamboat/{EVENT}",fields:["event","action","source","curshowid","original_item_id","original_item_type","list","userid"],track:function(ev,options){var opts=[];options["event"]=options["event"]||ev;options["userid"]=options["userid"]||Behaviors.getUserId();BookmarkTracking.fields.each(function(f,i){opts.push(f+"="+(options[f]||""));});var url=BookmarkTracking.source.replace(/{EVENT}/,ev)+"?"+
opts.join("&");url+=("&timestamp="+(new Date()).getTime());pingImage(url);},trackToCram:function(ev,options){var _tracking=cram.get("bookmark_tracking");if(!_tracking)_tracking=[];_tracking.push({ev:ev,options:options});cram.set("bookmark_tracking",_tracking);},trackFromCram:function(){if(!cram.valid()){setTimeout(BookmarkTracking.trackFromCram,1000);return false;}
var _tracking=cram.get("bookmark_tracking");if(!_tracking)_tracking=[];for(var i=0;i<_tracking.length;i++){BookmarkTracking.track(_tracking[i].ev,_tracking[i].options);}
cram.remove("bookmark_tracking");}});var _rTracking=new RecommendTracking();
var SearchTracking={searchItem:null,resultSetId:'',sortBy:'relevance',pageNum:1,st:0,send:function(item,page_num,filter_type,filter_value,original_url,result_set_id,sort_by,ref,search_type,st){return true;var search_item,page_num,userId,searchUserId;var company_filter,type_filter,show_filter,special_feature_filter;search_item=item||this.getSearchItem();if(!search_item)
return true;this.searchItem=search_item;this.resultSetId=result_set_id||this.resultSetId;this.pageNum=page_num||this.pageNum;this.sortBy=sort_by||this.sortBy;this.st=st||this.getSt();userId=Behaviors.getUserId();searchUserId=this.getSearchUserId();if(filter_type=='All')
company_filter=type_filter='All';else{switch(filter_type){case'company':company_filter=filter_value;break;case'type':type_filter=filter_value;break;case'showname':show_filter=filter_value;break;case'special_feature':special_feature_filter=filter_value;break;}
company_filter=company_filter||this.getCompanyFilter();type_filter=type_filter||this.getTypeFilter();show_filter=show_filter||this.getShowFilter();special_feature_filter=special_feature_filter||this.getSpecialFeatureFilter();}
original_url=original_url||'';if(document.images){var url=encodeURIComponent||escape;var source="itemId="+url(this.guid())
+"&resultSetId="+url(this.resultSetId)
+"&userId="+url(userId)
+"&searchUserId="+url(searchUserId)
+"&searchItem="+url(search_item)
+"&page="+url(this.pageNum)
+"&company="+url(company_filter)
+"&type="+url(type_filter)
+"&show="+url(show_filter)
+"&special_feature="+url(special_feature_filter)
+"&sortBy="+url(this.sortBy)
+"&location="+url(original_url)
+"&ref="+url(ref)
+"&search_type="+url(search_type)
+"&st="+url(this.st);pingImage("http://208.91.157.18/SearchTracking/SearchItem.ashx?"+source);}
return true;},sendWhole:function(item,page_num,type_filter,show_filter,company_filter,spec_fitler,original_url,result_set_id,sort_by,ref,search_type,st,others){return true;this.searchItem=item;this.pageNum=page_num||this.pageNum;this.sortBy=sort_by||this.sortBy;this.st=st||this.getSt();if(document.images){var url=encodeURIComponent||escape;var source="itemId="+url(this.guid())
+"&resultSetId="+url(result_set_id)
+"&userId="+url(Behaviors.getUserId())
+"&searchUserId="+url(this.getSearchUserId())
+"&searchItem="+url(item)
+"&page="+url(page_num)
+"&company="+url(company_filter||'All')
+"&type="+url(type_filter||'All')
+"&show="+url(show_filter||'All')
+"&special_feature="+url(spec_fitler||'All')
+"&sortBy="+url(sort_by)
+"&location="+url(original_url)
+"&ref="+url(ref)
+"&search_type="+url(search_type)
+"&st="+url(this.st);if(others){try{source+="&"+$H(others).toSortedQueryString();}catch(e){}}
pingImage("http://208.91.157.18/SearchTracking/SearchItem.ashx?"+source);}},S4:function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);},guid:function(){return(this.S4()+this.S4()
+"-"+this.S4()
+"-"+this.S4()
+"-"+this.S4()
+"-"+this.S4()+this.S4()+this.S4()).toUpperCase();},getSearchItem:function(){if(this.searchItem!=null)return this.searchItem;var search_item=$('search-item');if(search_item){search_item=search_item.firstChild.href.split('=')[1].split("&");return search_item[0].replace(/\+/g,' ');}
var el=$('embed-search-bar-query');if(el)return el.value;return null;},getSt:function(){var url=window.location.href;var st;try{url.replace('?','?&').split('&').each(function(param){if(param.indexOf('st=')==0)
st=param.replace('st=','');});}catch(e){}
return st||this.st;},getCompanyFilter:function(){var company_filter=$('company-selected-item')||'All';return(company_filter=='All')?company_filter:company_filter.innerHTML;},getTypeFilter:function(){var type_filter=$('type-selected-item')||'All';return(type_filter=='All')?type_filter:type_filter.innerHTML;},getShowFilter:function(){var showname_filter=$('showname-selected-item')||'All';return(showname_filter=='All')?showname_filter:showname_filter.innerHTML;},getSpecialFeatureFilter:function(){var special_feature_filter=$('special_feature-selected-item')||'All';return(special_feature_filter=='All')?special_feature_filter:special_feature_filter.innerHTML;},getSearchUserId:function(){var value=Behaviors.getCookie('_hulu_su');if(!value)
{this.setSearchUserId();value=Behaviors.getCookie('_hulu_su');}
return value?value:-1;},setSearchUserId:function(){Behaviors.setCookie('_hulu_su',this.guid(),30);return true;},openFeedback:function(el){var menu=$('search-feedback');if(menu&&el){var xy=Position.positionedOffset(el);menu.style.top=(xy[1]-menu.getHeight()+el.getHeight())+'px';menu.style.left=(xy[0]-(menu.getWidth()/2))+'px';menu.show();var form=menu.down('form');if(form)Form.reset(form);}
return false;},trackSearchForm:function(form_id){var form=$(form_id);if(!form)return;var query=form.query.value;SearchTracking.setSearchUserId();if(form_id=="bottom_search_form")
SearchTracking.send(query,1,'All',null,null,null,null,"btm");else if(form_id=="advanced_search_form")
SearchTracking.send(query,1,'All',null,null,null,null,"adv");else
SearchTracking.send(query,1,'All',null,null);},tags_track:function(item,with_result){return true;if(document.images){var url=encodeURIComponent||escape;var source="scope=tags"
+"&item="+url(item)
+"&item_id="+url(SearchTracking.guid())
+"&with_result="+url(with_result);pingImage("http://208.91.157.18/SearchTracking/ChannelShow.ashx?"+source);}
return true;}};
var ChannelShowTracking={send_channel:function(item,channel,sub_channel,type,with_result){return true;if(document.images){var url=encodeURIComponent||escape;var source="scope=channel"
+"&item="+url(item)
+"&channel="+url(channel||"All")
+"&subChannel="+url(sub_channel||"All")
+"&type="+url(type)
+"&item_id="+url(SearchTracking.guid())
+"&with_result="+url(with_result);pingImage("http://208.91.157.18/SearchTracking/ChannelShow.ashx?"+source);}
return true;},send_show:function(item,show_id,show_name,place,with_result){return true;if(document.images){var url=encodeURIComponent||escape;var source="scope=show"
+"&item="+url(item)
+"&showId="+url(show_id)
+"&showName="+url(show_name)
+"&place="+url(place)
+"&item_id="+url(SearchTracking.guid())
+"&with_result="+url(with_result);pingImage("http://208.91.157.18/SearchTracking/ChannelShow.ashx?"+source);}
return true;}};
function overrideDocumentWrite(){var SourceMatch=new RegExp('<script[^>]+src="([^"]+)"',"im");document.write=function(){var str="";for(i=0;i<arguments.length;i++){str+=arguments[i];}
var matches=str.match(new RegExp(Prototype.ScriptFragment,"img"))||[];matches.each(function(frag){var src=frag.match(SourceMatch);if(src){delayedInclude(src[1],null,0);}
else{frag.evalScripts();}});var body=document.getElementsByTagName('body');if(body)body=body[0];if(body)new Insertion.Bottom(body,str);};}
function delayedInclude(src,afterInclude,timeout){setTimeout(function(){var delayed_container=$('delayed-js-container');if(delayed_container){var script=document.createElement('script');script.src=src;script.type='text/javascript';delayed_container.appendChild(script);if(afterInclude){setTimeout(afterInclude,1500);}}},timeout||500);}
function pingImage(url){if(window.location.protocol=="https:"&&!(/^https:\/\//.test(url)))return;var img=new Image();if(Prototype.Browser.IE){img.onload=function(){};}
img.src=url;return img;};function upid(url,cb){return url.replace("${upid}",cb);}
function reDirectWithPingImage(image,url){var cb=(new Date).getTime();pingImage(upid(image,cb));location.href=upid(url,cb);}
function installOpenSearch(){if((typeof window.external=="object")&&((typeof window.external.AddSearchProvider=="unknown")||(typeof window.external.AddSearchProvider=="function"))){window.external.AddSearchProvider("http://www.hulu.com/opensearch.xml");}else{ModalPopup.warn("This plugin requires a browser that supports OpenSearch.  Browsers that support OpenSearch include Firefox, Chrome and Internet Explorer.");}}
function toggle_visible(el){if(typeof($)=='undefined')return;var img=$(el);if(!img)return;img.style.visibility="visible";}
function toggle_invisible(el){if(typeof($)=='undefined')return;var img=$(el);if(!img)return;img.style.visibility="hidden";}
function google_analytics_ajax(path){if(typeof(_gaq)!='undefined'&&_gaq)_gaq.push(['_trackPageview',path]);}
function gaTrackForm(form,label){if((form=='plus-signup')&&window.location.pathname.match(/^\/plus\/signup/)){var category='form-tracking';var action='form:'+form;_gaq.push(['_trackEvent',category,action,label]);}}
Object.extend(Hash.prototype,(function(){function toQueryPair(key,value){if(Object.isUndefined(value))return key;return key+'='+encodeURIComponent(String.interpret(value));}
return{toSortedQueryString:function(){return this.keys().sort().inject([],function(results,key){var values=this.get(key);key=encodeURIComponent(key);if(values&&typeof values=='object'){if(Object.isArray(values))
return results.concat(values.map(toQueryPair.curry(key)));}
else{results.push(toQueryPair(key,values));}
return results;}.bind(this)).join('&');}};})());function _tol(s){return $R(0,Math.ceil(s.length/4)-1).map(function(i){return s.charCodeAt(i*4)+(s.charCodeAt(i*4+1)<<8)+(s.charCodeAt(i*4+2)<<16)+(s.charCodeAt(i*4+3)<<24);});}
function getViewportInfo(){var w=(window.innerWidth)?window.innerWidth:(document.documentElement&&document.documentElement.clientWidth)?document.documentElement.clientWidth:document.body.offsetWidth;var h=(window.innerHeight)?window.innerHeight:(document.documentElement&&document.documentElement.clientHeight)?document.documentElement.clientHeight:document.body.offsetHeight;return{width:w,height:h};}
function _dobfu(text){return text.slice(0,7)!='dobfu__'?text:$A(_tol(unescape(text.substring(7)))).map(function(i){i=0xfeedface^i;return String.fromCharCode(i&0xFF,i>>>8&0xFF,i>>>16&0xFF,i>>>24&0xFF);}).join('').replace(/\\0+$/,'');}
function sitePerformedInvite(id){var r=/(REMO_INVITE)=([^;]*)/gi.exec(document.cookie);return(r&&unescape(r[2]));}
function siteInvited(id){id!=undefined||(id='1');var ex=new Date(new Date().getTime()+(86400000*180));document.cookie='REMO_INVITE'+'='+escape(id)+((!ex||!(ex instanceof Date))?'':('; expires='+ex.toGMTString()))+';path=/; domain=Hulu.com';}
var RadioButton={toggle:function(el,group){if(!el||group=="")return false;if(!el.hasClassName('pressed')){var input=el.down('input');if(input)input.checked="true";var buttons=$$('a.'+group);buttons.each(function(b){b.removeClassName('pressed');});el.addClassName('pressed');}}};function toLocalTime(utc_time){d=new Date();localOffset=d.getTimezoneOffset()*60000;localTime=utc_time-localOffset;return new Date(localTime);}
var ModalPopup={previousContainer:null,hideCallback:null,defaultWidth:350,dismissable:true,modalClickEventHandler:function(event){if(event.element().id=='modal-popup'&&ModalPopup.dismissable==true){ModalPopup.hide();}
return false;},overlayClickEventHandler:function(event){if(ModalPopup.dismissable==true){ModalPopup.hide();}
return false;},init:function(){Event.observe(window,'load',function(){$$('.overlay-full').each(function(el){el.onclick=ModalPopup.overlayClickEventHandler;});if($('modal-popup'))$('modal-popup').observe('click',ModalPopup.modalClickEventHandler);});},hide:function(){$$('.overlay-full').each(function(el){el.hide();el.fire("hulu:overlayHidden");});if(ModalPopup.previousContainer){var content=$('modal-text').down('div.content');ModalPopup.previousContainer.appendChild(content);ModalPopup.previousContainer=null;}
$('modal-popup').hide();var player=$("player");if(player){player.style.visibility="visible";}
else if(Prototype.Browser.IE){var masthead=$("masthead");if(masthead)
masthead.style.visibility="visible";}
$w($('modal-popup').className).each(function(c){$('modal-popup').removeClassName(c);});if(ModalPopup.hideCallback){ModalPopup.hideCallback();ModalPopup.hideCallback=null;}},show:function(offsetBy,hideOverlay){if(arguments.length!=2)hideOverlay=false;var offset=document.viewport.getScrollOffsets();var popupTop=offset.top+((document.viewport.getHeight()-$('modal-popup').getHeight())/2);var player=$("player");if(player){try{player.pauseVideo();player.style.visibility="hidden";}catch(e){}}
else if(Prototype.Browser.IE){var masthead=$("masthead");if(masthead){masthead.style.visibility="hidden";}}
if(offsetBy!=null){$('modal-popup').style.top=offsetBy+"px";}
else{$('modal-popup').style.top=popupTop+"px";}
$('modal-popup').style.left=offset.left+"px";if(!hideOverlay){$$('.overlay-full').each(function(el){el.show();});}
$('modal-popup').show();},warn:function(warning,offset,hideOverlay){$('modal-popup-container').down('.popup-bar').show();$('close-popup').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('modal-popup-container').down('.popup-bar-19h').hide();$('modal-popup-container').down('.popup-bar-dark').hide();$('accept-popup').hide();$('reject-popup').hide();$('dismiss-popup').show();$('modal-text').hide();$('modal-question').innerHTML=warning;$('modal-question').show();$('modal-popup-container').style.width=ModalPopup.defaultWidth+"px";$('modal-popup-container').style.height="auto";this.show(offset,arguments.length==3&&hideOverlay);},ask:function(question,accept,reject){$('accept-popup').up('a').onclick=new Function("ModalPopup.hide(); "+accept+" return false;");if(arguments.length>=4&&'function'==typeof(arguments[3])){$('accept-popup').up('a').onclick=arguments[3];}
$('reject-popup').up('a').onclick=new Function("ModalPopup.hide(); "+reject+" return false;");$('modal-popup-container').down('.popup-bar').show();$('close-popup').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('modal-popup-container').down('.popup-bar-19h').hide();$('modal-popup-container').down('.popup-bar-dark').hide();$('dismiss-popup').hide();$('accept-popup').show();$('reject-popup').show();$('modal-text').hide();$('modal-question').innerHTML=question;$('modal-question').show();$('modal-popup-container').style.width=ModalPopup.defaultWidth+"px";this.show();},display:function(text,width,height,dismissable){if(arguments.length==3&&height)$('modal-popup-container').style.height=height+"px";if(arguments.length>=2&&width)$('modal-popup-container').style.width=width+"px";else $('modal-popup-container').style.width=ModalPopup.defaultWidth+"px";$('modal-popup-container').down('.popup-bar').show();$('close-popup').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('modal-popup-container').down('.popup-bar-19h').hide();$('modal-popup-container').down('.popup-bar-dark').hide();$('dismiss-popup').hide();$('accept-popup').hide();$('reject-popup').hide();$('modal-question').hide();$('modal-text').innerHTML=text;$('modal-text').show();ModalPopup.dismissable=(dismissable==null?true:dismissable);if(ModalPopup.dismissable==true){$('close-popup').show();}else{$('close-popup').hide();}
this.show();},display_thick:function(text,width,height){if(arguments.length==3)$('modal-popup-container').style.height=height+"px";if(arguments.length>=2)$('modal-popup-container').style.width=width+"px";else $('modal-popup-container').style.width=ModalPopup.defaultWidth+"px";$('modal-popup-container').down('.popup-bar-19h').show();$('close-popup-19h').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('modal-popup-container').down('.popup-bar').hide();$('modal-popup-container').down('.popup-bar-dark').hide();$('dismiss-popup').hide();$('accept-popup').hide();$('reject-popup').hide();$('modal-question').hide();$('modal-text').innerHTML=text;$('modal-text').show();this.show();},display_div:function(contentDiv,width,height,showDarkCloseButton,hideOverlay){if(arguments.length>=3)$('modal-popup-container').style.height=height+"px";if(arguments.length>=2)$('modal-popup-container').style.width=width+"px";else $('modal-popup-container').style.width=ModalPopup.defaultWidth+"px";if(arguments.length>=4&&showDarkCloseButton){$('modal-popup-container').down('.popup-bar-dark').show();$('modal-popup-container').down('.popup-bar').hide();}
else{$('modal-popup-container').down('.popup-bar').show();$('modal-popup-container').down('.popup-bar-dark').hide();}
$('close-popup').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('close-popup-dark').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('modal-popup-container').down('.popup-bar-19h').hide();$('dismiss-popup').hide();$('accept-popup').hide();$('reject-popup').hide();$('modal-question').hide();var content=contentDiv.down('div.content');ModalPopup.previousContainer=contentDiv;$('modal-text').innerHTML="";$('modal-text').appendChild(content);$('modal-text').show();this.show(null,arguments.length>=5&&hideOverlay);},display_div_thick:function(contentDiv,width,height){if(arguments.length==3)$('modal-popup-container').style.height=height+"px";if(arguments.length>=2)$('modal-popup-container').style.width=width+"px";else $('modal-popup-container').style.width=ModalPopup.defaultWidth+"px";$('modal-popup-container').down('.popup-bar-19h').show();$('close-popup-19h').up('a').onclick=new Function("ModalPopup.hide(); return false;");$('modal-popup-container').down('.popup-bar').hide();$('modal-popup-container').down('.popup-bar-dark').hide();$('dismiss-popup').hide();$('accept-popup').hide();$('reject-popup').hide();$('modal-question').hide();var content=contentDiv.down('div.content');ModalPopup.previousContainer=contentDiv;$('modal-text').innerHTML="";$('modal-text').appendChild(content);$('modal-text').show();this.show();}};ModalPopup.init();function timeAgoInWords(date_str){var time_formats=[[60,'just now','in a second'],[120,'1 minute ago','1 minute from now'],[3600,'minutes',60],[7200,'1 hour ago','1 hour from now'],[86400,'hours',3600],[172800,'yesterday','tomorrow'],[604800,'days',86400],[1209600,'last week','next week'],[2419200,'weeks',604800],[4838400,'last month','next month'],[29030400,'months',2419200],[58060800,'last year','next year'],[2903040000,'years',29030400],[5806080000,'last century','next century'],[58060800000,'centuries',2903040000]];var time=(''+date_str).replace(/-/g,"/").replace(/[TZ]/," ").replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(time.substr(time.length-4,1)==".")time=time.substr(0,time.length-4);var seconds=(new Date-new Date(time))/1000;var token='ago',list_choice=1;if(seconds<0){seconds=Math.abs(seconds);token='from now';list_choice=2;}
var i=0,format;while(format=time_formats[i++])
if(seconds<format[0]){if(typeof format[2]=='string')
return format[list_choice];else
return Math.floor(seconds/format[2])+' '+format[1]+' '+token;}
return time;};function idempotentize(fn){var called=false;return function(){if(called)return;called=true;fn.bind(this)();};}
function thumbnailLoadError(ev){var el=Event.element(ev);if(el.match('img'))el.src=Base.imageURL("/images/_.gif");}
function isScrolledIntoView(el){if(!el.visible())
return false;var elOffset=el.viewportOffset();if(elOffset.left<0||elOffset.top<0)
return false;var vp=document.viewport.getDimensions();if(elOffset.left>vp.width||elOffset.top>vp.height)
return false;return true;}
var TextArea={};TextArea.AutoGrowth=Class.create({initialize:function(el,charLimit){this.element=el;var current=this;this.element.observe('keydown',function(ev){if(typeof(charLimit)!="undefined"){var code=ev.keyCode||ev.which||0;if(current.element.value.length>=charLimit&&(code>46||code==9||code==13||code==32)){ev.preventDefault();return false;}}
current.resize();});},resize:function(){if(typeof(this.timeoutId)!="undefined"){clearTimeout(this.timeoutId);}
if(typeof(this.clone)=="undefined"){this.clone=this.element.clone().setStyle({position:'absolute',top:'0px',left:'-99999px',overflow:'hidden',padding:'0px',visibility:'hidden'});this.clone.disabled=true;this.element.getOffsetParent().appendChild(this.clone);}
var cl=this.clone;var el=this.element;this.timeoutId=setTimeout(function(){cl.value=el.value;el.setStyle({height:cl.scrollHeight+'px'});},75);}});
var Nav=Class.create();var Nav=Class.create();Object.extend(Nav,{HIDE_THRESHOLD:0.08,upperBound:0,lowerBound:0,leftBound:0,rightBound:0,snv_upperBound:0,snv_lowerBound:0,snv_leftBound:0,snv_rightBound:0,IEFIX_IFRAME_ID:"snv_iframe_iefix",processing:false,disableFade:typeof(navigator)!="undefined"&&navigator.appVersion.indexOf("Mac")>=0&&navigator.userAgent.indexOf("Firefox/2")>=0,init:function(){var snv=$$('ul.snv');if(!snv||snv.length<=0)return;snv=snv.first();snv.select('li a.menu-top').each(function(el){el.observe('mouseover',function(ev){if(Nav.processing)return;var element=Event.element(ev);var menu=element.up('li').down('div.nav-menus');Nav.showMenu(menu);});});snv.select('h2.menu-item a').each(function(el){el.observe('mouseover',function(ev){var element=Event.element(ev);element._title=element.title;element.title='';});el.observe('mouseout',function(ev){var element=Event.element(ev);element.title=element._title;});});snv.select('a.menu-top img').each(function(el){el.observe('mouseover',function(ev){var element=Event.element(ev);element._title=element.title;element.title='';});el.observe('mouseout',function(ev){var element=Event.element(ev);element.title=element._title;});});if($('player')){Nav.disableFade=true;}},visibleSnv:function(){var snv=$$('ul.snv');if(!snv||snv.length<=0)return;snv=snv.first();return snv.select('li').detect(function(el){var menu=el.down('div.nav-menus');return menu&&menu.visible();});},updateMenuBounds:function(snv){if(!snv)return;var menu=snv.down('div.nav-menus');if(!menu||!menu.visible())return;var xy=Position.cumulativeOffset(snv);Nav.snv_leftBound=xy[0]
Nav.snv_rightBound=xy[0]+snv.getWidth();Nav.snv_upperBound=xy[1];Nav.snv_lwerBound=xy[1]+snv.getHeight();xy=menu.cumulativeOffset();Nav.leftBound=xy[0];Nav.rightBound=xy[0]+menu.getWidth();if(Nav.rightBound-Nav.leftBound>800){Nav.leftBound-=100;Nav.rightBound+=100;}
Nav.upperBound=xy[1];Nav.lowerBound=Nav.upperBound+menu.getHeight();},activateSnv:function(snv){var menuTop=snv.down('a.menu-top');var css_sprite_el=menuTop.down('div');if(css_sprite_el.className.match(/-active/)){css_sprite_el.className=css_sprite_el.className.replace(/-active/g,'-over');menuTop.addClassName('active');}else{css_sprite_el.className=css_sprite_el.className.replace(/(-hover|-over)/g,'')+'-over';}},deactivateSnv:function(snv){var menuTop=snv.down('a.menu-top');var css_sprite_el=menuTop.down('div');if(menuTop.hasClassName('active')){css_sprite_el.className=css_sprite_el.className.replace(/-over/g,'-active');}else{css_sprite_el.className=css_sprite_el.className.replace(/(-hover|-over)/g,'');}},showMenu:function(menu){if(Prototype.Browser.WebKit&&Social.TopNavControl.shown)return;var lastSnv=Nav.visibleSnv();var thisSnv=null;if(menu)thisSnv=menu.up('li');if(lastSnv&&(!thisSnv||thisSnv.id!=lastSnv.id)){var lastMenu=lastSnv.down('div.nav-menus');if(lastMenu){Nav.hideIframe(lastMenu);lastMenu.hide();Nav.deactivateSnv(lastSnv);}}
if(thisSnv&&lastSnv&&(thisSnv.id==lastSnv.id))
return;if(menu){if(menu.hasClassName('requirelogin')&&!Behaviors.isLoggedIn()){return;}
Nav.showIframe(menu);IframeHacker.hideWhenScroll(Nav.hideMenu,Nav);if(BrowserDetect.browser=="Firefox"&&$('player')){menu.setStyle({border:"0px"});}
if(Nav.disableFade){menu.show();}
else{Nav.processing=true;new Effect.Appear(menu,{duration:0.2,afterFinish:function(){Nav.processing=false;}});}}},hideMenu:function(ev){var snv=Nav.visibleSnv();if(!snv)return;var y=Event.pointerY(ev);var x=Event.pointerX(ev);if(!Prototype.Browser.IE&&(document.body.getStyle("position")||"").toLowerCase()=="relative"){var offset=(parseInt(document.body.getStyle("margin-top"))||0)+(parseInt(document.body.getStyle("top"))||0);y=y-offset;}
Nav.updateMenuBounds(snv);var threshold=Nav.HIDE_THRESHOLD;var upper=Nav.upperBound;var lower=Nav.lowerBound;var left=Nav.leftBound;var right=Nav.rightBound;var inMenu=(y>upper*(1-threshold))&&(y<lower)&&(x>left)&&(x<right);var inSnv=(y>Nav.snv_upperBound)&&(y<Nav.snv_lowerBound*(1+threshold))&&(x>Nav.snv_leftBound)&&(x<Nav.snv_rightBound);if(!inMenu&&!inSnv&&(isNaN(x)||x>=0)&&(isNaN(y)||y>=0)){var menu=snv.down('div.nav-menus');Nav.hideIframe(menu);menu.hide();Nav.deactivateSnv(snv);}
if(inMenu){Nav.activateSnv(snv);}
Nav.processing=false;},showIframe:function(menu){var snv=menu.up('li');var iframe_id=Nav.IEFIX_IFRAME_ID;if(!$(iframe_id)){new Insertion.Bottom(document.body,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:1000;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');}
var xy=Position.cumulativeOffset(snv);var left=xy[0]+1+"px";var top=xy[1]+snv.getHeight()+"px";var height=(menu.getDimensions().height+1)+'px';var width="172px";if(menu.hasClassName('fullwidth')){left=xy[0]+parseFloat(menu.getStyle("left"))+"px";width="920px";}
$(iframe_id).setStyle({left:left,top:top,height:height,width:width});menu.setStyle({zIndex:1001});snv.up('ul.snv').up('div').setStyle({zIndex:2000});$(iframe_id).show();},hideIframe:function(menu){var snv=menu.up('li');var iframe_id=Nav.IEFIX_IFRAME_ID;if($(iframe_id)){$(iframe_id).hide();}
snv.up('ul.snv').up('div').setStyle({zIndex:0});},over:function(el){$(el).addClassName('hover');},out:function(el){$(el).removeClassName('hover');},updateAuxiliary:function(){var uid=Behaviors.getUserId();if($$('.queue-count').length<=0||uid<=0){Nav.updateQueueCountIndicators(0);}
else{var q_count=Behaviors.getCookie('_hulu_qc');if(q_count){q_count=parseInt(q_count);if(q_count>=0){Nav.updateQueueCountIndicators(q_count);}}
else{new Ajax.Request('/users/nav_auxiliary_info/'+uid,{method:'get',onSuccess:function(req){var res=req.responseText.split(",");var q_count=parseInt(res[0]);if(q_count>=0){Behaviors.setCookie('_hulu_qc',q_count,1.0/24,Base.commonCookieDomain());Nav.updateQueueCountIndicators(q_count);}}});}}},resetAuxiliary:function(){Nav.updateQueueCountIndicators(0);},updateQueueCountIndicators:function(q_count){var updated_count=q_count>=0?' ('+q_count+')':'';$$('.queue-count').each(function(el){el.update(el.innerHTML.replace(/( +\([0-9]+\))?$/,updated_count));});if(typeof(HeaderNew)!="undefined"){HeaderNew.renderQueue(q_count);}},loggedOut:function(){if(!$('logged-in-nav')||!$('logged-out-nav'))return;$('logged-in-nav').hide();$('logged-out-nav').show();Nav.resetAuxiliary();},loggedIn:function(){if(!$('logged-in-nav')||!$('logged-out-nav'))return;$('logged-in-nav').show();$('logged-out-nav').hide();Nav.updateAuxiliary();}});Event.observe(document,'dom:loaded',function(){var body=$$('body').first();if(body)Event.observe(body,'mouseout',Nav.hideMenu);Nav.init();});
var Login=Class.create();Object.extend(Login,{WORKING_IMAGE:'<img src="'+Base.imageURL('/images/loading-animated-circle.gif')+'" '+'width="16" height="16" border="0" class="login-'+'status-loading"/>',from_flf:false,action_elem:null,external_action:null,in_lightbox:false,target_form:null,setup:function(){$$('.dummy').each(function(el){Element.observe(el,"focus",Login.activate);Element.observe(el,"keypress",Login.handleKeys);Element.observe(el,"click",Login.activate);});this.clear();},setActionElement:function(el){Login.action_elem=el;Login.from_flf=true;},setInLightbox:function(from_lightbox){Login.in_lightbox=from_lightbox;},activate:function(ev){var el=Event.element(ev);if(el&&el.hasClassName("inactive")){var form=el.up();var dummies=$A(form.getElementsByClassName('dummy'));if(dummies)dummies.each(Element.remove);var login=form.down('.login');login.show();var password=form.down('.password');password.show();Event.observe(password,'keypress',Login.handleKeys);login.focus();}},handleKeys:function(ev){if(27==ev.keyCode){Login.cancel();}
if(13==ev.keyCode){Event.stop(ev);var el=Event.element(ev);if(el){if(!el.hasClassName('.login-form'))el=el.up('.login-form');var submit=el.down('.login-submit');submit.click();}}},clear:function(){$$('.inactive').each(function(el){el.value=el.hasClassName("login")?"email":"password";});},show:function(el){if(el){$$('.usernav').each(Element.hide);$$('.login-form').each(Element.hide);var warning=$('review-login-warning');if(warning)warning.show();FloatingLoginForm.hide();el.show();try{el.down('.login-status-img').hide();el.down('.login-status').hide();el.down('.login').activate();}
catch(e){}}
Login.from_flf=false;Login.action_elem=null;},submitted:false,submit:function(el,from){if(Login.submitted)return;Login.submitted=true;try{el=$(el);if(!el.hasClassName('login-form'))el=el.up('.login-form');if(el){Login.target_form=el;var status_img=el.down('.login-status-img');if(status_img){status_img.show();}}
var login=el.down('.login');var password=el.down('.password');if(login&&password&&!login.value.strip().blank()&&!password.value.blank()){Behaviors.setCookie('from',from);this.auth(login.value,password.value,from);}
else
this.onError("Please enter both your email and password.",from);}
catch(e){this.onError("There was an error: "+e.message,from);}
Login.submitted=false;},cancel:function(reload){FloatingLoginForm.hide();$$('.login-form').each(Element.hide);Login.from_flf=false;Login.action_elem=null;if(typeof(reload)!="undefined"){this.onComplete(reload);}else{this.onComplete();}},currentForm:function(){return Login.target_form;},showPrivacy:function(){if(Login.in_lightbox){Login.in_lightbox=false;Login.from_flf=false;Login.action_elem=null;}
this.onComplete();$('privacy-acceptance-loading').hide();$('accept-not-button').simulate('mouseout');ModalPopup.display_div($('accept-choice'),380);},showEmailValidation:function(do_what){if(Login.in_lightbox){Login.in_lightbox=false;Login.from_flf=false;Login.action_elem=null;}
if(!Login.email){new Ajax.Request('/users/get_email',{asynchronous:false,onSuccess:function(transport){var obj=transport.responseJSON;if(obj&&obj.email){Login.email=obj.email;}}});}
do_what=do_what||"posting";ModalPopup.ask("In our new efforts to combat spam on Hulu, we now require users to verify their email \
       addresses before "+do_what+" on Hulu.  Please first verify \
       your email address before continuing.<br/><br/>Would you like us to send a \
       verification request to "+Login.email+" now?","","",function(){$('accept-popup').up('a').insert({'before':"<span id='tmp-sent-success' style='vertical-align: top; padding: 2px 10px 0 0; position: relative; top: 2px;'>"+"<img src='"+Base.imageURL('/images/loading-animated-circle.gif')+"' style='vertical-align: top;' />"+"</span>"});new Ajax.Request('/account/send_email_validation',{onComplete:function(){$('tmp-sent-success').innerHTML="Sent. <img src='"+Base.imageURL('/images/icon-check-F5F5F5.gif')+"' style='vertical-align: top;' />";setTimeout(function(){ModalPopup.hide();$('tmp-sent-success').remove();},1000);}});return false;});},acceptPrivacy:function(){$('privacy-acceptance-loading').show();this.accept_privacy();},showDeny:function(){ModalPopup.hide();$('back-button').simulate('mouseout');$('ok-continue-button').simulate('mouseout');ModalPopup.display_div($('deny-choice'),380);},onError:function(error,from){var el=Login.currentForm();if(el){var s=el.down('.login-status-img');if(s)s.hide();}
if(el)el=el.down('.login-status');if(el){el.update(error);el.setStyle({color:'red'});el.show();el=Login.currentForm().down('.login');if(el)el.activate();}
if(from!='facebook-popup'){if(!Login.from_flf){Login.from_flf=false;Login.action_elem=null;}
FloatingLoginForm.updateIFrame();}},onComplete:function(reload,from,redirect_url){if(Behaviors.isLoggedIn()&&!Behaviors.isPlusUser()){_gaq.push(['_setVar','loggedin']);}
var rec_sup=false;if(Behaviors.isLoggedIn()&&(window.location.pathname.match(/^\/recommendation/))){var user_id=RecommendationHubSlider.getUserId();RecommendationHubSlider._rTracking.send('recommendationhub','login',user_id,null,null,null,null,null,null,null,null);if(!Login.from_flf){window.location.reload();}
var el=Login.currentForm();if(el&&el.hasClassName('.flf'))el.hide();Behaviors.setLoggedIn(true);if(Behaviors.isLoggedIn()&&Login.from_flf&&Login.action_elem){Login.action_elem=$(Login.action_elem);Login.action_elem.simulate('click');Login.from_flf=false;Login.action_elem=null;}
if(Behaviors.isLoggedIn()&&this.external_action){this.external_action();}
if(!Login.in_lightbox)
ModalPopup.hide();this.clear();RecommendationHubSlider.displayLoginText();return;}
if(from=='facebook-popup'||from=='canvas-merge-popup'){return;}
else if(from=='facebook-canvas'){var oauth=_hulu_fb_canvas_oauth;var uid=_hulu_fb_canvas_uid;Social.Facebook.merge({force:true,user_id:uid,oauth_token:oauth});return;}else if(reload===false){return;}
else if(Behaviors.isLoggedIn()&&(location.pathname.match(/^\/users\/find_account/)||location.pathname.match(/^\/account\/signin/))){if(typeof(redirect_url)!='undefined'){window.location=redirect_url;}
else{window.location="/";}}
else if(Behaviors.isLoggedIn()&&location.pathname.match(/^\/signup/)){try{SignUpTracking.leave_type="login";}
catch(e){}
if(typeof(redirect_url)!='undefined'){window.location=redirect_url;}
else{window.location="/";}}
else if(Behaviors.isPlusUser()){_gaq.push(['_setVar','plus']);if(window.location.pathname.match(/^\/plus\/signup/)||window.location.pathname.match(/^\/plus\/vip/))
{window.location="/";}else if(reload!==false&&!window.location.pathname.match(/^\/signup/)){Behaviors.reloadCurrentPage();}}
else{if(Behaviors.isLoggedIn()&&reload!==false&&!window.location.pathname.match(/^\/signup/)){Behaviors.reloadCurrentPage();}}},_addHiddenField:function(form,key,value){var field=document.createElement("input");field.setAttribute("type","hidden");field.setAttribute("name",key);field.setAttribute("value",value);form.appendChild(field);},heavyFormAuth:function(login,password,auth_url){var form=document.createElement("form");form.setAttribute("method","post");form.setAttribute("action",auth_url);Login._addHiddenField(form,"login",login);Login._addHiddenField(form,"password",password);var redirect_url=window.location.href;if(window.location.pathname.match(/^\/signup/)){redirect_url="/?from=signup";}
Login._addHiddenField(form,"redirect_to",redirect_url);var body=$$('body').first();if(body)body.appendChild(form);form.submit();}});
var IntWarning={skipWarning:false,skip:false,init:function(){if(/always-warn-jp/.test(location.hash))IntWarning.onGeoCheckResult({'JP':true,'US':false});else if(/always-warn/.test(location.hash))IntWarning.onGeoCheckResult(false);if(location.protocol=='https'||location.protocol=='https:')return;if(IntWarning.skip)return;IntWarning.runCheck();},show:function(stat){if(MobileDevice.flags.showWarning)return;$$('#player-container').each(function(el){var height=el.getHeight();el.update('<div class="flash-player-invalid" style="height:'+height+'px !important;"> </div>');el.id='';});$$('.overlay-full').each(Element.show);if(stat=='JP-valid'){$$('.int-warning-jp').each(Element.show);}else{$$('.int-warning').each(Element.show);}
if(Prototype.Browser.IE){var masthead=$("masthead");if(masthead)
masthead.style.visibility="hidden";}},submitOnEnter:function(ev){if(13==ev.keyCode)IntWarning.submit();},setHasChecked:function(value){var expires_at=new Date((new Date()).valueOf()+2*86400000);var cookie=document.cookie="hic=1"+"; expires="+expires_at.toGMTString()+"; path=/";},hasChecked:function(){return(/\bhic=1\b/.test(document.cookie));},runCheck:function(){var body=$$('body').first();if(body&&!IntWarning.hasChecked()){var script=document.createElement("script");script.type="text/javascript";var url="http://s.hulu.com/gc?";if(typeof(Behaviors)!="undefined"&&typeof(Behaviors.givlgivlgivl)!="undefined")
{url+='content_id='+(Behaviors.givlgivlgivl^0x67f86287).toString()+'&';}
url+="regions=US,JP&cb="+(new Date()).getTime();script.src=url;body.appendChild(script);}},onGeoCheckResult:function(passed){var stat="not-valid";if(typeof(passed)=='object'){if(passed.US)
stat="valid";else if(passed.JP)
stat="JP-valid";else
stat="not-valid";}else{stat=passed?"valid":"not-valid";}
IntWarning.passedGeoCheck(stat);},passedGeoCheck:function(stat){if("not-valid"==stat||"JP-valid"==stat){var body=$$("body").first();if(body)body.fire("intwarning:warn");if(typeof(Adzone)!='undefined')Adzone.State.canShowSponsorship=false;if(!IntWarning.hasChecked()&&!IntWarning.skipWarning){IntWarning.show(stat);Event.observe($('int-email'),'keydown',IntWarning.submitOnEnter);}}
IntWarning.setHasChecked();},hide:function(){$$('.overlay-full').each(Element.hide);$$('.int-warning').each(Element.hide);$$('.int-warning-jp').each(Element.hide);},submit:function(){var form=$('int-request');new Ajax.Request('/users/international',{parameters:form.serialize(),onComplete:IntWarning.showThanks});},showThanks:function(){$$('.int-form').each(Element.hide);$$('.int-thanks').each(Element.show);},cancel:function(){IntWarning.hide();if(Prototype.Browser.IE){var masthead=$("masthead");if(masthead)
masthead.style.visibility="visible";}}};Event.observe(window,'load',IntWarning.init);
var MobileDevice=Class.create();var MobilePopup=Class.create();Object.extend(MobilePopup,{previousContent:null,previousContianer:null,init:function(){try{$("mobile-popup").down(".mobile-overlay-full").onclick=function(){MobilePopup.acknowledge();};}
catch(e){}},display:function(container,width,height,nocenter){width=(width||600);height=(height||300);var popup=$("mobile-popup");var left=(popup.up().getWidth()-width)/2;var maxHeight=popup.up().getHeight();var top=(window.innerHeight-height)/2+window.scrollY;if(top<0)top=0;popup.down(".popup").setStyle({width:width+"px",height:height+"px",left:left+"px",top:top+"px"});popup.down(".mobile-overlay-full").setStyle({height:maxHeight+"px"});$("mobile-popup-content").innerHTML="";MobilePopup.previousContent=container.down(".content");MobilePopup.previousContainer=container;Element.insert($("mobile-popup-content"),container.down(".content"));if(MobileDevice.flags.isSupported){$$('.supported').each(Element.show);$$('.unsupported').each(Element.hide);$$('.really-unsupported').each(Element.hide);}
else if(MobileDevice.flags.isReallyUnsupported){$$('.supported').each(Element.hide);$$('.unsupported').each(Element.hide);$$('.really-unsupported').each(Element.show);}
else{$$('.supported').each(Element.hide);$$('.unsupported').each(Element.show);$$('.really-unsupported').each(Element.hide);}
$$('.platform-name').each(function(el){if(MobileDevice.platform!=null){el.innerHTML=MobileDevice.platform;}});$$('.platform-name-with-article').each(function(el){if(MobileDevice.platformWithArticle!=null){el.innerHTML=MobileDevice.platformWithArticle;}});if(MobileDevice.appLink){$$('.app-download-link').each(function(el){el.href=MobileDevice.appLink;});}
popup.show();},setSeen:function(){if(MobileDevice.flags.isSupported){Behaviors.setCookie("mobile_warning","1",2);}},acknowledge:function(){MobilePopup.setSeen();MobilePopup.hide();},hide:function(){$("mobile-popup").hide();if(MobilePopup.previousContent&&MobilePopup.previousContainer){Element.insert(MobilePopup.previousContainer,MobilePopup.previousContent);}}});Object.extend(MobileDevice,{deviceConfig:{"iOS":{cookie_name:"hulu_ios_app",watch_pattern:"hulu://w/#{vid}"},"android":{cookie_name:"hulu_android_app",watch_pattern:"http://www.hulu.com/watch/#{vid}.hulu?vid=#{vid}"},"GoogleTV":{cookie_name:"hulu_google_tv"},"BoxeeBox":{cookie_name:"hulu_boxee_box"},"skyfire":{cookie_name:"hulu_sf"},"blackberry":{cookie_name:"hulu_pbbb"}},deviceType:null,deviceVersion:0,warningEnabledForPage:true,getDeviceType:function(){return MobileDevice.deviceType;},blockPlayer:function(){var type=MobileDevice.getDeviceType();return(type&&type=="blackberry");},getDeviceVersion:function(){return MobileDevice.deviceVersion;},getCookieName:function(){var device=MobileDevice.getDeviceType();var device_config=MobileDevice.deviceConfig[device];if(!device_config)return"";return device_config.cookie_name;},platform:null,platformWithArticle:null,flags:{},init:function(){var ua=navigator.userAgent;if((/#ua-(.*)$/).test(window.location.hash)){Behaviors.eraseCookie("mobile_warning");ua=RegExp.$1;}
MobileDevice.flags.isSupported=false;MobileDevice.flags.isReallyUnsupported=false;MobileDevice.flags.useJavascriptMasthead=false;MobileDevice.flags.useWindowLoad=false;if((/(ipad|itouch|iphone)/i).test(ua)){MobileDevice.deviceType="iOS";MobileDevice.flags.showWarning=true;MobileDevice.flags.isSupported=true;MobileDevice.flags.useJavascriptMasthead=true;MobileDevice.platform=RegExp.$1;}
else if((/GoogleTV/i).test(ua)){MobileDevice.deviceType="GoogleTV";MobileDevice.flags.useWindowLoad=true;MobileDevice.flags.showWarning=true;MobileDevice.platform="Google TV";MobileDevice.platformWithArticle="the Google TV";}
else if((/Android.*Mobile/i).test(ua)){MobileDevice.deviceType="android";MobileDevice.flags.showWarning=true;MobileDevice.appLink="market://details?id=com.hulu.plus";var supported_devices=["DROIDX","DROID2","DROID3","DROID X2","DROID BIONIC","Nexus S","Nexus One","MB860","ADR6400L","PC36100","HTC-A9192","T-Mobile G2","myTouch4G","GT-I9100","VS910","LG-P999","HTC/Sensation","ADR6350","HTC Flyer","EVO 3D","T-Mobile G2","VTAB1008","Silk/","BNTV250"].collect(Behaviors.escapeForRegex).join("|");if(RegExp(supported_devices,"i").test(ua)){MobileDevice.flags.isSupported=true;}
MobileDevice.platform="Android";MobileDevice.platformWithArticle="this Android device";if((/Android([\s\d\.]+).*Mobile/i).test(ua)){MobileDevice.deviceVersion=parseFloat(RegExp.$1);if(MobileDevice.deviceVersion>=3.2){MobileDevice.flags.isSupported=true;}}}
else if((/Android/).test(ua)){MobileDevice.deviceType="android";MobileDevice.flags.showWarning=true;MobileDevice.appLink="market://details?id=com.hulu.plus";var supported_devices=["Xoom","A500","Transformer","XOOM 2","AT100","Transformer Prime"].collect(Behaviors.escapeForRegex).join("|");if(RegExp(supported_devices).test(ua)){MobileDevice.flags.isSupported=true;}
MobileDevice.platform="Android";MobileDevice.platformWithArticle="this Android device";if((/Android([\s\d\.]+)/).test(ua)){MobileDevice.deviceVersion=parseFloat(RegExp.$1);if(MobileDevice.deviceVersion>=3.2){MobileDevice.flags.isSupported=true;}}}
else if((/Boxee/i).test(ua)||typeof(boxee)!="undefined"){MobileDevice.deviceType="BoxeeBox";MobileDevice.flags.useWindowLoad=true;MobileDevice.flags.showWarning=true;MobileDevice.platform="Boxee Box";MobileDevice.platformWithArticle="the Boxee Box";}
else if((/Skyfire/i).test(ua)){MobileDevice.flags.isReallyUnsupported=true;MobileDevice.deviceType="skyfire";MobileDevice.flags.showWarning=true;MobileDevice.platform="Skyfire browser";MobileDevice.platformWithArticle="the Skyfire browser";}
else if((/(Playbook|BlackBerry);/i).test(ua)){MobileDevice.flags.isReallyUnsupported=true;MobileDevice.deviceType="blackberry";MobileDevice.flags.showWarning=true;MobileDevice.platform="BlackBerry browser";MobileDevice.platformWithArticle="the BlackBerry browser";}
else if((/Silk\//).test(ua)){MobileDevice.deviceType="kindle";MobileDevice.flags.showWarning=true;MobileDevice.flags.isSupported=true;MobileDevice.flags.useJavascriptMasthead=true;MobileDevice.platform="the Amazon Kindle Fire";}
else if((/BNTV250/i).test(ua)){MobileDevice.deviceType="nook";MobileDevice.flags.showWarning=true;MobileDevice.flags.isSupported=true;MobileDevice.flags.useJavascriptMasthead=true;MobileDevice.platform="the Barnes & Noble NOOK";}
if(MobileDevice.flags.isSupported){Ajax.Responders.register({onComplete:MobileDevice.rewriteHref});}
var redirect_whitelist=["(\\?|#|$)","watch\\/","plus(\\?|#|$)"].join("|");redirect_whitelist=RegExp("^\\/("+redirect_whitelist+")","");if((MobileDevice.flags.isSupported||MobileDevice.deviceType=='android')&&!(Behaviors.isLoggedIn()&&Behaviors.isPlusUser())&&!(Behaviors.getCookie("mobile_plus"))&&(redirect_whitelist.test(window.location.pathname))&&!(/plus_email/.test(window.location.search))){window.location.href='/plus/mobile'+window.location.search;}},checkFirstEntry:function(){var cookie_name=MobileDevice.getCookieName();if(!cookie_name)return;if(/plus_email/.test(window.location.search))MobileDevice.play();if(((!Behaviors.getCookie(cookie_name)&&/^\/?watch/.test(window.location.pathname))||!Behaviors.getCookie("mobile_warning"))&&!MobileDevice.flags.isSupported)
{var body=$$("body").first();if(body)body.fire("mobilewarning:warn");}
else if(Behaviors.getCookie(cookie_name)){MobileDevice.play();}},play:function(){if(/\/watch\/(\d+)/.test(window.location)){var vid=RegExp.$1;var device=MobileDevice.getDeviceType();var device_config=MobileDevice.deviceConfig[device];if(!device_config)return"";else{window.location=device_config.watch_pattern.interpolate({vid:vid});}}},setCookieAndPlay:function(){MobileDevice.play();var cookie_name=MobileDevice.getCookieName();if(!cookie_name)return;Behaviors.setCookie(cookie_name,"1",36500);},handleWarning:function(){document.observe("mobilewarning:warn",function(event){var el=$("mobile-first-entry");if(el&&MobileDevice.warningEnabledForPage){var ua=navigator.userAgent;if((/#ua-(.*)$/).test(window.location.hash)){Behaviors.eraseCookie("mobile_warning");ua=RegExp.$1;}
if(MobileDevice.flags.isSupported&&!(/ipad/.test(ua))){el.down(".content").addClassName('mobile-large');MobilePopup.display(el,800,400);}else{MobilePopup.display(el,600,300);}}});},checkVideoAvailable:function(id,href){var is_available=false;new Ajax.Request("/videos/check_plus_mobile/"+id,{asynchronous:false,method:"get",evalJSON:"force",onSuccess:function(transport){var available=transport.responseJSON.available;if(available){is_available=true;}else{MobilePopup.display($("mobile-video-unavailable"),500,200);}}});return is_available;},updateHref:function(el){var match=el.href.match(/.*\/watch\/(\d+)(\/.*)*/);if(el.hasClassName("info_hover")){el.removeClassName("info_hover");Element.stopObserving(el,"mouseover");Element.stopObserving(el,"click");}
var target=el.up(".play-button-hover");if(target){Element.stopObserving(target,"mouseover");Element.stopObserving(target,"mouseout");target.removeClassName("play-button-hover");}
if(match){var device=MobileDevice.getDeviceType();var device_config=MobileDevice.deviceConfig[device];if(!device_config)return;el.href=device_config.watch_pattern.interpolate({vid:match[1]});var onclick=el.onclick;var id=match[1];el.addClassName("mobile-href-observing");el.onclick=function(e){if(onclick){try{onclick(e);}catch(ex){}}
return MobileDevice.checkVideoAvailable(id,el.href);}}},rewriteHref:function(){$$("a:not(.mobile-href-observing)").each(function(el){MobileDevice.updateHref(el);});},modifySignupPage:function(){if(window.location.pathname.match(/^\/plus/)){$$("form.plus-trial-form").each(function(e){e.writeAttribute("action","/plus/mobile/signup");});}},onLoad:function(){if(MobileDevice.flags.isSupported){MobileDevice.rewriteHref();MobileDevice.modifySignupPage();}
if(!MobileDevice.flags.showWarning)return;MobilePopup.init();MobileDevice.checkFirstEntry();}});MobileDevice.init();var MobileMasthead=Class.create();Object.extend(MobileMasthead,{featured:[],ori_featured:[],beacon_params:[],currentId:null,width:0,locked:false,channel:false,type:"",setup:function(h,type){var container=$("masthead-container");MobileMasthead.type=type||"home";if(window.location.pathname.match(/^(.channels|.genres)/)){MobileMasthead.channel=true;}
if(container){if(!MobileMasthead.channel){container.innerHTML="<div class='mobile-masthead-featured' id='mobile-masthead-featured-container'><div id='mobile-masthead-featured'></div><div class='left-nav'></div><div class='right-nav'></div></div>"+"<div class='mobile-masthead-bottom' id='mobile-masthead-bottom'></div>";}
container.setStyle({height:h+"px"});MobileMasthead.init();}},init:function(){var update=Masthead.update;Masthead.update=function(featured){Masthead.featured=featured;var id=0;if(!MobileMasthead.channel){Masthead.featured.each(function(f){if(f.type=="default"){MobileMasthead.featured.push(MobileMasthead.formatFeatured(f,id));MobileMasthead.ori_featured.push(f);MobileMasthead.beacon_params.push([]);id+=1;}});MobileMasthead.initNav();if(MobileMasthead.featured.length>0){MobileMasthead.show(0);MobileMasthead.timeout=setInterval(MobileMasthead.next,6000);var container=$("mobile-masthead-featured-container");container.down(".left-nav").onclick=function(){MobileMasthead.prev();};container.down(".right-nav").onclick=function(){MobileMasthead.next();}}}
else{MobileMasthead.setupChannel(featured);}}},setupChannel:function(featured){var container=$("masthead-container");var ele=new Element("div");ele.addClassName("mobile-channel-masthead");for(var i=0;i<featured.length&&i<3;i++){var link=new Element("a");var img=new Element("img");var img_container=new Element("div");link.href=featured[i].link_url;img.src=featured[i].thumbnail_url;img_container.addClassName("channel-featured");if(i==0)img_container.addClassName("first");if(i==featured.length-1)img_container.addClassName("last");Element.insert(img_container,img);Element.insert(img_container,"<div class='title-banner'></div><div class='title'><span class='cufonable'>"+featured[i].title+"</span></div>");Element.insert(img_container,"<div class='explore'></div>");Element.insert(link,img_container);Element.insert(ele,link);}
Element.insert(container,ele);},prev:function(){var id=parseInt(MobileMasthead.currentId)-1;if(id<0)id=id+MobileMasthead.featured.length;MobileMasthead.show(id,"prev");},next:function(){var id=parseInt(MobileMasthead.currentId)+1;id=id%(MobileMasthead.featured.length);MobileMasthead.show(id,"next");},getWidth:function(){if(!MobileMasthead.width){MobileMasthead.width=$('mobile-masthead-featured-container').getWidth();}
return MobileMasthead.width;},show:function(id,dir){if(MobileMasthead.locked)return;id=id||0;if(MobileMasthead.currentId==id)return;if(MobileMasthead.currentId==null){Element.insert($('mobile-masthead-featured'),MobileMasthead.featured[id]);$$(".bottom-nav")[id].addClassName("selected");MobileMasthead.currentId=id;return;}
MobileMasthead.locked=true;if(dir=="next"||(dir!="prev"&&MobileMasthead.currentId<id)){Element.insert($("mobile-masthead-featured"),{bottom:MobileMasthead.featured[id]});var to=-MobileMasthead.getWidth();}
else{$("mobile-masthead-featured").setStyle({left:(-MobileMasthead.getWidth())+"px"});Element.insert($("mobile-masthead-featured"),{top:MobileMasthead.featured[id]});var to=0;}
$("bottom-nav-"+MobileMasthead.currentId).removeClassName("selected");$("bottom-nav-"+id).addClassName("selected");new Effect.Move($("mobile-masthead-featured"),{x:to,duration:0.4,mode:"absolute",afterFinish:function(){MobileMasthead.moveFinish(id);}});},moveFinish:function(id){$("featured-"+MobileMasthead.currentId).remove();$("mobile-masthead-featured").setStyle({left:"0px"});MobileMasthead.currentId=id;MobileMasthead.locked=false;},initNav:function(){var size=MobileMasthead.featured.length;var bottom=$("mobile-masthead-bottom");for(var i=0;i<size;i++){var ele=new Element("span");ele.id="bottom-nav-"+i;ele.addClassName("bottom-nav");ele.onclick=function(){if(!this.hasClassName("selected")){var curId=this.id.split("-")[2];MobileMasthead.show(curId);}}
Element.insert(bottom,ele);}},formatFeatured:function(feature,id){var ele=new Element("div");ele.id="featured-"+id;ele.setStyle({float:"left",width:MobileMasthead.getWidth()+"px",height:"100%",background:"url("+feature.backgroundUrl+") repeat-x"});var img_container=new Element("div");img_container.setStyle({margin:"auto",position:"relative",width:"800px"});var link=new Element("a");link.href=feature.linkUrl;MobileDevice.updateHref(link);var img=new Element("img");img.src=feature.imageUrl;Element.insert(img_container,link);Element.insert(link,img);Element.insert(ele,img_container);var logo_container=new Element("div");var logo_mask=new Element("div");logo_container.addClassName("logo-container");logo_mask.addClassName("logo-mask");var logo=new Element("img");logo.addClassName("logo");logo.src=feature.logoUrl;Element.insert(link,logo_mask);Element.insert(link,logo_container);Element.insert(logo_container,logo);if(feature.title){Element.insert(logo_container,"<div class='title'>"+feature.title+"</div>");}
if(feature.description){Element.insert(logo_container,"<div class='description'>"+feature.description+"</div>");}
Element.insert(logo_container,"<div class='watch-now'></div>");return ele;}});
var interval_backup,current_video_cid;function isIgnoredMasthead(link_url){return false;}
function getUserHistory(){return UserHistory.get_history();}
function getUserWatchedHistory(){return UserHistory.get_watched_history();}
function addUserHistory(content_id){content_id=parseInt(content_id.toString());if(content_id){UserHistory.add_history(content_id);}}
function onCommentMarkerSeek(seconds){FacebookCanvas.Comment.updateVideoMarker(seconds);}
function onCommentMarkerClose(){if($$('.comments-watch-page').length>0){FacebookCanvas.Comment.reset($$('.comments-watch-page')[0]);}}
function playerAdvertisingStart(){if(Behaviors.isInCanvasApp()){FacebookCanvas.Comment.disableWatchPageCommentForm();}}
function playerAdvertisingEnd(){if(Behaviors.isInCanvasApp()){FacebookCanvas.Comment.enableWatchPageCommentForm();}}
function continuousPlayCountdownStarted(){if(Behaviors.isInCanvasApp()){FacebookCanvas.Comment.disableWatchPageCommentForm();}}
function continuousPlayCountdownStopped(){if(Behaviors.isInCanvasApp()){FacebookCanvas.Comment.enableWatchPageCommentForm();}}
function showTab(show){if($('tab-container')){if(show){$('tab-container').style.height="";}
else{$('tab-container').style.height="28px";}
var lis=$('tab-container').childElements();if(lis&&lis.length){for(var i=0;i<lis.length;i++){if(lis[i].id){if(show){lis[i].show();}
else{lis[i].hide();}}}}}}
function playbackReady(){}
function getUserId(){return(Behaviors.isLoggedIn()?Behaviors.getUserId():-1);}
function getSiteSessionId(){return Beacon.sessionId();}
function getUserSocialIdentityIds(){return Beacon.socialIdentityIds();}
function getSocialPopupStatus(){if(Behaviors.fbNotifyShown()){if(Behaviors.isFacebookConnected()){return 1;}
else{return 2;}}
else{return 0;}}
function getUsername(){return Behaviors.getUsername();}
function getUserPlanId(){return Behaviors.getUserPlanId();}
function getChannel(){return/(\?|&)?c=([^&]+)/.test(location.search)?RegExp.$2:'';}
function getPlayerVersion(){return 0;}
var loadingQuickPlay=false
function channelQuickPlay(eid,center){if(loadingQuickPlay)return;loadingQuickPlay=true;var swfObject=new SWFObject("/embed/"+eid,"quickplay",896,504,"10.1.53.64");swfObject.addParam("allowFullScreen","true");swfObject.addParam("bgcolor","000000");swfObject.addParam("wmode","transparent");swfObject.addVariable("ap","1");swfObject.addVariable("pl",true);swfObject.write("channel-quickplay");if($('search-result'))$('search-result').hide();if(center==true){var viewdim=document.viewport.getDimensions();var scroll=document.viewport.getScrollOffsets();var top=scroll[1]+viewdim.height/2-252+'px';$("channel-quickplay-container").style.top=top;var left=scroll[0]+viewdim.width/2-448+'px';$("channel-quickplay-container").style.left=left;}
var newTop=$('overlay-bottom').cumulativeOffset().top;var db=document.body;var dde=document.documentElement;var docHeight=Math.max(db.scrollHeight,dde.scrollHeight,db.offsetHeight,dde.offsetHeight,db.clientHeight,dde.clientHeight);var newHeight=docHeight-newTop;$("overlay-bottom").style.height=newHeight+"px";$("overlay-bottom").setOpacity(0.0);$("overlay-bottom").style.display="block";new Effect.Opacity('overlay-bottom',{duration:0.5,from:0.0,to:0.7,afterFinish:function(){if(Prototype.Browser.IE)
$('overlay-bottom').style.filter="alpha(opacity=80)";if($('search-bar'))$('search-bar').style.zIndex=0;loadingQuickPlay=false;Element.show("channel-quickplay-container");Element.show("channel-quickplay");}.bind(this)});}
function hideChannelQuickPlay(){if(loadingQuickPlay)return;loadingQuickPlay=true;if($('channel-quickplay-container')&&$('channel-quickplay-container').visible()){$('channel-quickplay').hide();$('channel-quickplay-container').hide();$('quickplay').remove();if($('search-result'))$('search-result').hide();new Effect.Fade('overlay-bottom',{duration:0.5,afterFinish:function(){if(Prototype.Browser.IE)
$('overlay-bottom').style.filter="alpha(opacity=80)";if($('search-bar'))$('search-bar').style.zIndex=0;loadingQuickPlay=false;}.bind(this)});}}
function selectEmbed(){if($('player')){$('player').copyEmbedToClipboard();$('icon-checkbox').style.visibility="visible";}}
function focusPlayer(){if($('player')){$('player').focus();}}
function createCustomClip(){if($('player')){$('player').showEmbed();$('icon-checkbox').style.visibility="hidden";}}
var toggling_ad=false;function AdToggle(url,clickThru,width,height){if(toggling_ad)
return;toggling_ad=true;var image_creative=true;if(!url||url.indexOf("http")!=0)
url="";if(!clickThru||clickThru.indexOf("http")!=0)
clickThru="";if(url!="")
SWFAdContainer(url,clickThru,width,height);toggling_ad=false;var descriptionContent=$('description-content');if(descriptionContent!=null){descriptionContent.style.minHeight=((height||60)+45)+'px';}
if(url!="")
Element.show('banner-ad-container');else
Element.hide('banner-ad-container');}
function SWFAdContainer(creative,clickThru,width,height){var playerUrl=$('player').src||$('player').Movie;var playerBaseUrl=playerUrl.split("playerwrapper.swf")[0];if(playerUrl.indexOf("player102wrapper.swf")!=-1){playerBaseUrl=playerUrl.split("player102wrapper.swf")[0];}
width=width||300;height=height||60;var bannerUrl=playerBaseUrl+"banner.swf";var swfObject=new SWFObject(bannerUrl,"banner_c",width,height,"1");swfObject.addParam("allowScriptAccess","always");swfObject.addParam("bgcolor","#eeeeee");swfObject.addParam("wmode","transparent");swfObject.addVariable("href",escape(creative));swfObject.addVariable("clickThru",escape(clickThru));swfObject.addVariable("displayWidth",width);swfObject.addVariable("displayHeight",height);swfObject.write("banner-ad-container");}
function addBannerBorder(){if($('banner-ad-container').hasClassName("with-border")!=true)
$('banner-ad-container').addClassName("with-border");}
function onClickBanner(){if($('player'))
$('player').trackBannerClickThru();}
function onPlayerClicked(){var player=$('player');if(player)
player.simulate('click');}
var preloadedCanvas=new Array();var loadedCanvas=new Array();var hideCanvasTimeout=-1;function preloadCanvas(topBG,topBanner,isDefaultCanvas){var brandedCanvas=new BrandedCanvas(topBG,topBanner,isDefaultCanvas);preloadedCanvas.push(brandedCanvas);}
function showCanvas(){if(preloadedCanvas.length<1){return;}
if(hideCanvasTimeout>0){hideCanvasTimeout=-1;clearTimeout(hideCanvasTimeout);if(loadedCanvas.length>0){loadedCanvas[0].fadeOut();brandedCanvas_HiddenEvent();}};loadedCanvas.push(preloadedCanvas.shift());if(loadedCanvas.length>1){return;}
loadedCanvas[0].show();}
function hideCanvas(){if(loadedCanvas.length<1){return;}
loadedCanvas[0].hide(brandedCanvas_HiddenEvent);}
function showHeadDescription(isNotDefaultCanvas){var overlay=$('overlay-top');var container=$('description-container');if(container&&overlay){container.style.background=overlay&&"block"==overlay.style.display?"#333":null;if(isNotDefaultCanvas)
if($('description-content'))
Element.show('description-content');}
try{if($('bc_top'))$('bc_top').fadeOut();}catch(oError){}
try{if($('bc_bottom'))$('bc_bottom').fadeOut();}catch(oError){}}
function brandedCanvas_HiddenEvent(){if(loadedCanvas.length<1){showHeadDescription(true);return;}
loadedCanvas.shift();if(loadedCanvas.length>0){loadedCanvas[0].show();}}
function BrandedCanvas(topBG,topBanner,isDefaultCanvas){this.topBG=topBG;this.topBanner=topBanner;this.isDefaultCanvas=isDefaultCanvas;hideCanvasTimeout=-1;this.allowFadeoutPlayerBG=true;this.show=function(){var current=this;if(lights.maintenanceShowing()){$$('#maintenance').each(Element.hide);}
var cb="?cb="+(new Date()).getDay();el=$('branded-canvas-top');if(el){if(this.isDefaultCanvas)
el.style.zIndex=0;else
el.style.zIndex=50;var swfObject=null;if(/(collections)|(playlist)/.test(window.location))
swfObject=new SWFObject("http://ads.hulu.com/voltron/canvastop.swf"+cb,"bc_top","100%",180,"1");else
swfObject=new SWFObject("http://ads.hulu.com/voltron/canvastop.swf"+cb,"bc_top","100%",145,"1");swfObject.addParam("allowScriptAccess","always");swfObject.addParam("allowNetworking","all");swfObject.addParam("wmode","transparent");swfObject.addVariable("backgroundURL",this.topBG);swfObject.addVariable("bannerURL",this.topBanner);swfObject.write("branded-canvas-top");}
if(navigator.userAgent.indexOf("Chrome")==-1){this.fadeIn();}else{setTimeout(function(){current.fadeIn();},500);}
if(!this.isDefaultCanvas)
if($('description-content'))
Element.hide('description-content');};this.hide=function(hiddenEvent){var current=this;var hiddenEventFunc=hiddenEvent;showHeadDescription(!this.isDefaultCanvas);if(hideCanvasTimeout>0){hideCanvasTimeout=-1;clearTimeout(hideCanvasTimeout);this.fadeOut();hiddenEventFunc();};hideCanvasTimeout=setTimeout(function(){if(hideCanvasTimeout<0)return;hideCanvasTimeout=-1;current.fadeOut();hiddenEventFunc();},500);};this.fadeIn=function(){if($('branded-canvas-top'))Element.show('branded-canvas-top');};this.fadeOut=function(){if(this.allowFadeoutPlayerBG){this.allowFadeoutPlayerBG=false;if($('branded-canvas-top')){Element.hide('branded-canvas-top');$('branded-canvas-top').update('');}}
this.reset();};this.reset=function(){this.topBG="";this.topBanner="";this.allowFadeoutPlayerBG=true;};}
function AdToggleOverlay(url300,url,click_url,ad_id){AdToggle(url300,url,click_url,ad_id);}
function CFAdToggleOverlay(url300,url,click_url,ad_id){CFAdToggle(url300,url,click_url,ad_id);}
function CFAdToggle(url300,url,click_url,ad_id){return;}
function closeWindow(){self.close();}
function fullScreen(time){var url="/stand_alone/"+current_video_cid+"#"+time;var full=window.open(url,"stand_alone","toolbar=0,status=0,resizable=1,scrollbars=0,width="+screen.availWidth+",height="+screen.availHeight);if(full){if(navigator.userAgent.indexOf("Chrome")==-1)
full.moveTo(0,0);full.focus();}
else{alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
function toggleMoreOption(open){lights.adjustOverlayBottom(open);}
function playerLogin(){window.scrollTo(0,0);FloatingLoginForm.showTop($('login-link'));}
function popOut(time,lcname,inPlaylist,collection_id,continuous_play_mode,continuous_play_on,continuous_play_sort){popOutWithCid(current_video_cid,time,lcname,inPlaylist,collection_id,continuous_play_mode,continuous_play_on,continuous_play_sort);}
function popOutWithCid(cid,time,lcname,inPlaylist,collection_id,continuous_play_mode,continuous_play_on,continuous_play_sort){var url="/stand_alone/"+cid+"?";params=[];if(lcname){params.push("lcname="+lcname);}
try
{playlist_id=ContinuousPlay.getPlaylistId()
params.push("playlist_id="+playlist_id);}
catch(e){}
if(Playlist.current_item_id){params.push("playlist_item_id="+Playlist.current_item_id);}
if(typeof(continuous_play_mode)!="undefined"){params.push("continuous_play_mode="+continuous_play_mode);}
if((typeof(continuous_play_on)!="undefined")&&(continuous_play_on==1)){params.push("continuous_play=on");}
try
{continuous_play_sort=ContinuousPlay.getSort();params.push("continuous_play_sort="+continuous_play_sort);}
catch(e){}
if(params.length>0){url+=params.join('&');}
if(inPlaylist){url+="#in-playlist";}
else if(time){url+="#"+time;}
popOutUrl(url);}
function popOutUrl(url){var full=window.open(url,"stand_alone","toolbar=0,status=0,resizable=1,scrollbars=0,width=512,height=288");if(full){if(navigator.userAgent.indexOf("Chrome")==-1)
full.moveTo(0,0);full.focus();}
else{if(!Prototype.Browser.IE)
{var playerDiv=$('breakout-container');var minTop=playerDiv.cumulativeOffset().top+200;alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}
else{alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}}
function popOutLivePlayer(time,lcname){var eventName=arguments[2]||'state_of_the_union';if(typeof(liveEventName)!="undefined"&&liveEventName)
eventName=liveEventName;var url="/live/popout/"+eventName;if(lcname)url+="#"+lcname;var full=window.open(url,"stand_alone","toolbar=0,status=0,resizable=1,scrollbars=0,width=512,height=296");if(full){if(navigator.userAgent.indexOf("Chrome")==-1)
full.moveTo(0,0);full.focus();}
else{alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
function launchIICDLivePlayer(){var eventName=arguments[0]||'state_of_the_union';if(typeof(liveEventName)!="undefined"&&liveEventName)
eventName=liveEventName;var full=window.open("http://akamai.dl.ificandream.com/liveplayer7/hulu.html","iicdliveplayer","height=433,width=600");if(full){if(navigator.userAgent.indexOf("Chrome")==-1)
full.moveTo(0,0);full.focus();}
else{alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
function launchLivePlayer(){var eventName=arguments[0]||'state_of_the_union';if(typeof(liveEventName)!="undefined"&&liveEventName)
eventName=liveEventName;var url="/live/";var full=window.open(url,"live_player_window","toolbar=0,status=0,resizable=1,scrollbars=0,width=916,height=575");if(full){if(navigator.userAgent.indexOf("Chrome")==-1)
full.moveTo(0,0);full.focus();}
else{alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
function getScreenDimensions(){return[screen.width,screen.height];}
function showLink(url){var link=window.open(url);if(link){link.focus();}
else{alert("Your browser is blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
function updateFlashPlayer(){$("player-container").style.visibility="hidden";$("player-container").style.height="1px";Element.show("upgrade-container");$("upgrade-container").style.height="424px";var updateSWF=new SWFObject("/expressinstall.swf","updateSWF","790","367","10.1.53.64");updateSWF.useExpressInstall("/expressinstall.swf");updateSWF.addParam("allowScriptAccess","sameDomain");updateSWF.addParam("wmode","transparent");updateSWF.write("upgrade-container");}
function updateCancelled(){Element.hide("upgrade-container");$("player-container").style.height="425px";$("player-container").style.visibility="visible";$('player').cancelFlashUpdate();}
function addClipVariables(swfObject){var values=parseClipVariables();var st=values[0];var et=values[1];if(st>0||(st==0&&et>0))
swfObject.addVariable("st",st);if(et>0&&et>st)swfObject.addVariable("et",et);}
function parseClipVariables(){var st=0;var et=0;var hash=location.hash.substring(1);var qs=$H(location.search.toString().toQueryParams());if(qs.get("c")){hash=qs.get("c");}
if(/^([0-9]+)(:|%3a|%3A)([0-9]+)/.exec(hash)){st=parseInt(RegExp.$1);et=parseInt(RegExp.$3);}
else if(/^([0-9]+)/.exec(hash)){st=parseInt(RegExp.$1);}
return[st,et];}
function embedVideo(id,eid){var player_url="/playerembed.swf?referrer="+escape(location.href);if(navigator.appVersion.indexOf("Win")>=0&&navigator.userAgent.indexOf("Safari")>=0&&navigator.userAgent.indexOf("Chrome")==-1)
player_url="/playerembed.swf";var swfObject=new SWFObject(player_url,"player",512,296,"10.1.53.64");swfObject.useExpressInstall("/expressinstall.swf");swfObject.setAttribute("style","z-index:10;");swfObject.addParam("allowScriptAccess","always");swfObject.addParam("allowFullscreen","true");swfObject.addVariable("eid",eid);swfObject.addVariable("stage_width",512);swfObject.addVariable("stage_height",296);if(!VersionCheck.write(swfObject,id)){Element.show('flash-player-invalid');}}
function getUserAgent(){return navigator.userAgent;}
function playerName(){return"/player.swf";}
function switchFullscreen(){return'false';}
function isRequiredMissing(){return"false";var val="false";function _c(el){return!el||el.getStyle('display')=='none';}
if(Prototype.Browser.WebKit){var m=$A([$('banner-ad-container'),$$('.sponsorship-info').first()]).all(_c);m=m||$$('#home img').findAll(function(el){return el.src&&el.src.indexOf('logo.jpg')>=0}).all(_c);if(m){val="true";}}
return val;}
function cbString(){var d=new Date;return $A([d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours()]).join('-');}
function signOut(){Behaviors.setLoggedOut();}
function setOneShotBrandVar(brand){Behaviors.setCookie('_osbrandvar',brand,1.0/24);}
function getOneShotBrandVar(){brand=Behaviors.getCookie('_osbrandvar');if(brand==null){brand="";}
Behaviors.eraseCookie('_osbrandvar');return brand;}
var DescriptionAnimDetails={HEIGHT:145,effect:null,UP:"up",DOWN:"down",ANIMATING_UP:"animatingUp",ANIMATING_DOWN:"animatingDown",currentState:"down"};var skinRollOverSetup=false;var needs_animation=(navigator.userAgent.toLowerCase().indexOf('chrome')>-1||Prototype.Browser.IE);function hideDescriptionContainer(){runDescriptionUpAnim();if(needs_animation){$$("ul.snv li").each(function(el){Element.observe(el,'mouseover',topNavRollOver);})
$("player-container").observe('mouseover',playerRollOver);}}
function showDescriptionContainer(withTransition){runDescriptionDownAnim();if(needs_animation){$$("ul.snv li").each(function(el){Element.stopObserving(el,'mouseover',topNavRollOver);})
$("player-container").stopObserving('mouseover',playerRollOver);}}
function topNavRollOver(){runDescriptionDownAnim();}
function playerRollOver(){runDescriptionUpAnim();}
function runDescriptionUpAnim(){if(DescriptionAnimDetails.effect&&DescriptionAnimDetails.currentState!=DescriptionAnimDetails.ANIMATING_UP){DescriptionAnimDetails.effect.cancel();}
if(DescriptionAnimDetails.currentState!=DescriptionAnimDetails.ANIMATING_UP&&DescriptionAnimDetails.currentState!=DescriptionAnimDetails.UP){DescriptionAnimDetails.effect=new Effect.Tween('description-container',$('description-container').getHeight(),0,{duration:1.0,afterFinish:function(){DescriptionAnimDetails.effect=null;DescriptionAnimDetails.currentState=DescriptionAnimDetails.UP;}},function(p){$('description-container').setStyle({height:p+"px"});});DescriptionAnimDetails.currentState=DescriptionAnimDetails.ANIMATING_UP;}}
function runDescriptionDownAnim(){if(DescriptionAnimDetails.effect&&DescriptionAnimDetails.currentState!=DescriptionAnimDetails.ANIMATING_DOWN){DescriptionAnimDetails.effect.cancel();}
if(DescriptionAnimDetails.currentState!=DescriptionAnimDetails.ANIMATING_DOWN&&DescriptionAnimDetails.currentState!=DescriptionAnimDetails.DOWN){DescriptionAnimDetails.effect=new Effect.Tween('description-container',$('description-container').getHeight(),DescriptionAnimDetails.HEIGHT,{duration:0.4,afterFinish:function(){DescriptionAnimDetails.effect=null;DescriptionAnimDetails.currentState=DescriptionAnimDetails.DOWN;}},function(p){$('description-container').setStyle({height:p+"px"});});DescriptionAnimDetails.currentState=DescriptionAnimDetails.ANIMATING_DOWN;}}
function changePlayerHeight(h,sh,transition){if($('player')){var currentHeight=$('player').getHeight();var ratio=1;if(sh!=null&&sh!=0){ratio=currentHeight/sh;}
var newHeight=h*ratio;if($('player-container')){var container=$('player-container');container.setStyle({height:newHeight+'px'});if(container.style.width!="100%"){var newWidth=896*ratio;var rb=Math.abs(ratio-1)<0.01?10:0;container.setStyle({width:newWidth+'px'});container.setStyle({padding:"25px "+(rb)+"px "+(rb)+"px 23px"});}}
if(!transition){$('player').setStyle({height:newHeight+'px'});}else{new Effect.Tween('player',currentHeight,newHeight,function(p){$('player').setStyle({height:p+'px'});});}}}
function onBeforeUnloaded(ev){if($('player')){try{$('player').beforeClose();}
catch(e){}}}
Event.observe(window,'beforeunload',onBeforeUnloaded);function trackBannerLoaded(){if($('player')){try{$('player').trackBannerLoaded();}
catch(e){}}}
function trackBannerClickThru(){if($('player')){try{$('player').trackBannerClickThru();}
catch(e){}}}
function trackBannerError(){if($('player')){try{$('player').trackBannerError();}
catch(e){}}}
function trackCanvasLoaded(type){if($('player')){try{$('player').trackCanvasLoaded(type);}
catch(e){}}}
function trackCanvasClickThru(){if($('player')){try{$('player').trackCanvasClickThru();}
catch(e){}}}
function trackCanvasError(type){if($('player')){try{$('player').trackCanvasError(type);}
catch(e){}}}
PositionPinger=Class.create();Object.extend(PositionPinger.prototype,{initialize:function(){this.id=(new Date()).getTime();this.useImage=Prototype.Browser.IE;Event.observe(window,"load",this.onLoad.bind(this));Event.observe(window,"beforeunload",this.onUnload.bind(this));},onLoad:function(){if($('player')){this.player=$('player');}},onUnload:function(){if(!this._pinged){this._pinged=true;this.ping();}},nullOrEmpty:function(s){return(!s||s=="");},ping:function(){var positionBeaconURL="";var cselClearURL="";var qosBeaconURL="";var qosBeaconBody="";var result;try{if(this.player){result=this.player.closeApp();}else{result=$('player').closeApp();}}catch(e){result="";}
try{if(startLoadWrapperTime){var currntTime=new Date().valueOf();var userWaitTime=currntTime-startLoadWrapperTime;var state={state:"before_wrapper",subState:"before_wrapper",contentTime:-1,stateTime:-1,contentRatio:-1};var player=$("player");if(player&&player.getCurrentState){try{state=player.getCurrentState();}catch(e){}}
var userLeaveBeaconUrl=Beacon.getStandardHost()+Beacon.STANDARD_PREFIX+Beacon.region_prefix+'/playertracking/userleave?'+'beaconevent=userleave&region=US&language=en&wait='+userWaitTime+'&distro=hulu&distroplatform=hulu&computerguid='+Beacon.computerGUID()+'&sitesessionid='+Beacon.sessionId()+'&content_id='+content_id+'&userid='+getUserId()+'&state='+state.state+'&substate='+state.subState+'&contenttime='+
state.contentTime+'&statetime='+state.stateTime+'&contentratio='+state.contentRatio;if(Beacon.computerGUID()[0]=='0'){if(this.useImage){(new Image()).src=userLeaveBeaconUrl;}else{new Ajax.Request(userLeaveBeaconUrl,{asynchronous:false});}}}}
catch(e){}
if(result.hasOwnProperty("playbackBeacon")){positionBeaconURL=result["playbackBeacon"];cselClearURL=result["clearStreamCount"];qosBeaconURL=result["qosBeaconUrl"];qosBeaconBody=result['qosBeaconBody'];}else{positionBeaconURL=result;cselClearURL="";qosBeaconURL="";qosBeaconBody="";}
if(!this.nullOrEmpty(cselClearURL)){if(this.useImage){(new Image()).src=cselClearURL;}else{new Ajax.Request(cselClearURL,{asynchronous:false});}}
if(!this.nullOrEmpty(positionBeaconURL)){if(this.useImage){(new Image()).src=positionBeaconURL;}else{new Ajax.Request(positionBeaconURL,{asynchronous:false});}}
if(!this.nullOrEmpty(qosBeaconURL)){if(this.useImage){(new Image()).src=qosBeaconURL;}else{new Ajax.Request(qosBeaconURL,{asynchronous:false});}}
if(!this.nullOrEmpty(qosBeaconBody)){new Ajax.Request("/_qos/playback",{asynchronous:false,method:'POST',postBody:qosBeaconBody});}}});new PositionPinger();var playerLoadingStartTime=-1;function trackPlayerLoadingStart(){playerLoadingStartTime=(new Date()).getTime();}
function getPlayerLoadingTime(){if(playerLoadingStartTime>=0){return(new Date()).getTime()-playerLoadingStartTime;}
return 0;}
function handleUserClickRecommendation(showid){var userid=Behaviors.getUserId();var sponsor="Recommendation/Infiniti";var key="_user_recshow_sponsor";var value=[userid,showid,sponsor].join('_');var expire_day=2.0/24;Behaviors.setCookie(key,value,expire_day);}
function getOneShotSiteLocationVar(showid){var sponsor="";if(showid==undefined||showid<=0){return sponsor;}
var key="_user_recshow_sponsor";var value=Behaviors.getCookie(key);if(value==null){return sponsor;}
var fields=value.split('_');if(fields==null||fields.Length<3){return sponsor;}
var cookie_userid=-1;if(fields[0]!=null){cookie_userid=parseInt(fields[0]);}
var cookie_showid=-1;if(fields[1]!=null){cookie_showid=parseInt(fields[1]);}
var cookie_sponsor="";cookie_sponsor=fields[2];if(cookie_userid>0&&cookie_userid==Behaviors.getUserId()&&cookie_showid>0&&cookie_showid==showid&&cookie_sponsor!=null&&cookie_sponsor!=""){Behaviors.eraseCookie(key);return cookie_sponsor;}
return sponsor;}
function guidLoaded(){document.fire("guid:loaded");}
function playerReady(){document.fire("player:loaded");}
function trackGoogleConversionVideoComplete(){var iframe=document.createElement('iframe');iframe.style.width='0px';iframe.style.height='0px';document.body.appendChild(iframe);iframe.src='/google_conversion_video_view_tracking.html?2';iframe.style.cssText="position: absolute; top: -100px; left: -100px; width:0; height: 0;";}
function trackGoogleEventVideoViewthrough(video_id,progress_percent,progress_seconds){_gaq.push(['_trackEvent','video-progress',video_id.toString(),progress_percent.toString(),progress_seconds]);}
function toggleLights(isTurningOn){throw new Error("Need overrided by specific page!")}
var Masthead={isReady:false,featured:null,init:function(){var items_url=false;if($('channel-masthead')){var channel_info=window.location.pathname.split('/').slice(2,4).join('/');var qs=$H(location.search.toString().toQueryParams());var type=qs.get("type");items_url="/genres/masthead";if(!channel_info.blank()&&channel_info!='tv'&&channel_info!='movies'){items_url+='/'+channel_info;if(type){items_url+="?type="+type;}}
else{items_url+="?type="+(channel_info=="movies"?"movies":"tv");}}
if(items_url)
new Ajax.Request(items_url,{evalScripts:true,method:'get'});},getGAParam:function(index){var params={};params.login=Behaviors.isLoggedIn()?1:0;params.position=index;return params;},ready:function(){this.isReady=true;if(Behaviors.isLoggedIn()){this.loggedIn();}
if(this.featured!=null){this.update(this.featured);}},update:function(featured){if(this.isReady){var el=$('masthead')||$('channel-masthead');el.addCarouselItem(featured);}
else{this.featured=featured;}},loggedIn:function(){try{if($('masthead')&&$('masthead').userLogin&&this.isReady)
$('masthead').userLogin(Behaviors.getUserId());}catch(e){}},loggedOut:function(){try{if($('masthead')&&$('masthead').userLogin&&this.isReady)
$('masthead').userLogin(-1);}catch(e){}},writeSwf:function(sec_name){var swf='/masthead.swf?v3';var id='masthead';var height=377;var width="100%";if(window.location.pathname.match(/^(.channels|.genres)/)){swf='/channel-masthead.swf';id='channel-masthead';height=180;width=920;}
var sec=(/^\/(tv|movies|hd|trailers|collections|criterion|superbowl|adzone|spotlight|documentaries|labs|bec|playlists|latino|screening_room)/.test(window.location.pathname)?(RegExp.$1):'');if(sec_name)sec=sec_name;if(sec=="adzone")sec="superbowl";if(sec=="latino")sec="spanish";if(sec=='screening_room')sec="screenroom";if(MobileDevice.flags.useJavascriptMasthead){MobileMasthead.setup(height,sec);var items_url="/home/featured/"+sec;if(id!='masthead'){var channel_info=window.location.pathname.split('/').slice(2,4).join('/');items_url="/genres/masthead";if(!channel_info.blank())items_url+='/'+channel_info;}
new Ajax.Request(items_url,{evalScripts:true,method:'get'});return;}
var swfObject=new SWFObject(swf,id,width,height,"10.1.53.64");swfObject.useExpressInstall("/expressinstall.swf");swfObject.addParam("allowScriptAccess","always");swfObject.addParam("wmode","transparent");if(Prototype.Browser.IE){swfObject.addParam("wmode","window");if(swf.match("channel")){swfObject.addParam("wmode","transparent");}}else{swfObject.addParam("wmode","transparent");}
swfObject.addVariable("section",sec);swfObject.addVariable("useCerebro","true");var channel_info=window.location.pathname.split('/').slice(2,4).join('/');if(channel_info.blank()){swfObject.addVariable("show_title",1);swfObject.addVariable("scroll",1);}
if(!VersionCheck.write(swfObject,"masthead-container"))
Element.show("flash-player-invalid");else
TitleHack.fixOnFocus($(id));},delegateToSwf:function(block){var masthead=$('masthead')||$('channel-masthead');Try.these(function(){block(masthead);});},startAnimation:function(){Masthead.delegateToSwf(function(m){m.startAnimation();});},stopAnimation:function(){Masthead.delegateToSwf(function(m){m.stopAnimation();});}};var cf_begin=true;var cf_processing=false;function countdownFinished(){if(cf_processing)
return;cf_processing=true;var cf_chk="";if($('countdown'))
cf_chk=$('countdown').getEndTime();if(cf_chk==(Date.UTC(2009,6,13,23,0,0,0)/1000).toString()){if($('countdown'))
$('countdown').setEndTime(Date.UTC(2009,6,14,7,0,0,0)/1000);Element.update("commercial-free-description","until commercial-free ends");cf_begin=false;cf_processing=false;}else{Element.hide("commercial-free-before");Element.show("commercial-free-after");cf_processing=false;}}
function toggleCommercialHelp(){var help=$('wt-widget-help');if(help)help.toggle();}
function hideCommercialHelp(){var help=$('wt-widget-help');if(help)help.hide();}
var VideoSlider=Class.create();VideoSlider.SLIDERS=[];VideoSlider.SLIDER_OBJECTS=new Hash();VideoSlider.REWRITE_LINK_SLIDERS=[];Object.extend(VideoSlider,{_currentVideoId:-1,currentVideoId:function(){if(VideoSlider._currentVideoId!=-1)
return VideoSlider._currentVideoId;try{VideoSlider._currentVideoId=parseInt(window.location.pathname.split('/watch/')[1].split('/')[0]);}
catch(e){VideoSlider._currentVideoId=null;}
if(VideoSlider._currentVideoId==null){try{VideoSlider._currentVideoId=parseInt(window.location.pathname.split('/superbowl/')[1].split('/')[0]);}
catch(e){VideoSlider._currentVideoId=null;}}
return VideoSlider._currentVideoId;}});Object.extend(VideoSlider.prototype,{ELLIPSIS:'<li class="ellipsis">...</li>',initialize:function(id){var options=arguments[1]||{};this.sld=$(id);this.inr=this.sld.getElementsBySelector('ul').first();VideoSlider.SLIDERS.push(id);if(!options.dontRewriteLinks){VideoSlider.REWRITE_LINK_SLIDERS.push(id);this.index=VideoSlider.REWRITE_LINK_SLIDERS.length-1;}
VideoSlider.SLIDER_OBJECTS.set(id,this);this.url=options.url;this.urlOptions=options.urlOptions||{};this.seasonCounts=options.seasonCounts||{};this.seasonsQueued={};this.from=options.from||{};this.dontRewriteLinks=options.dontRewriteLinks;this.is_first_load=true;this.is_filter_click=false;this.check_out_show=options.check_out_show||-1;var delay=0;delay=setInterval(function(){clearInterval(delay);this.domSensitiveInit(id,options);}.bind(this),500);},domSensitiveInit:function(id,options){this.init(options);this.maxCount=options.maxCount||this.count;this.maxPages=Math.ceil(this.maxCount/this.perPageCount);if(this.from=='brand'){BrandedEntertainment.rearrange(this,1);return;}
this.absolutize(1);this.rewriteLinks(1);this.nav=$(id+'-nav');if(this.nav){this.next=this.nav.getElementsBySelector('.next').first();this.prev=this.nav.getElementsBySelector('.prev').first();this.first=this.nav.getElementsBySelector('.first').first();this.shownPageNumber=this.nav.getElementsBySelector('input').first();this.total=this.nav.getElementsBySelector('.total').first();Event.observe(this.next,"click",this.move.bindAsEventListener(this,"next"));Event.observe(this.prev,"click",this.move.bindAsEventListener(this,"prev"));Event.observe(this.first,"click",this.move.bindAsEventListener(this,"first"));Event.observe(this.total,"click",this.move.bindAsEventListener(this,"last"));if(!this.sld.hasClassName('lazy-load')&&this.urlOptions.type!='related')
{this.populateNav();}}
this.fb_nav_prev=$(id+'-fb-nav-prev');if(this.fb_nav_prev){this.prev=this.fb_nav_prev;Event.observe(this.prev,"click",this.move.bindAsEventListener(this,"prev"));}
this.fb_nav_next=$(id+'-fb-nav-next');if(this.fb_nav_next){this.next=this.fb_nav_next;Event.observe(this.next,"click",this.move.bindAsEventListener(this,"next"));}
if(this.fb_nav_prev&&this.fb_nav_next&&!this.sld.hasClassName('lazy-load')&&this.urlOptions.type!='related'){this.populateNav();}
if(this.sld.hasClassName('lazy-load')||this.urlOptions.type=='related')
{this.lazyLoad();}
this.more=$(id+'-more');if(this.more)
Event.observe(this.more,"click",this.updateMoreLink.bindAsEventListener(this,"more"));this.seasons=$(id+'-season');if(this.missingSeasonsFilter()){this.seasons.show();this.seasons=this.seasons.getElementsBySelector('ul').first();}
this.sorts=$(id+'-sort');if(this.sorts){this.sorts.show();this.sorts=this.sorts.getElementsBySelector('ul').first();this.repopulateSortsNav();}
this.types=$(id+'-type');if(this.types){this.types.show();this.types=this.types.getElementsBySelector('ul').first();}
$A([this.seasons,this.sorts,this.types]).each(this.ellipsize.bind(this));var opts=this.dehashifyOpts(location.hash);if(opts&&this.sld.id==opts.id){this.updateWithHashedOptions(opts)}},ellipsize:function(ul){if(null==ul)return;if(this.hasSeasonsClass(ul))return;var lis=ul.getElementsBySelector('li');var max=lis.length;if(max>6)this.repaginate(ul,max,max);lis.each(function(li,i){if(!/inactive/.test(li.className)){Event.observe(li,"click",this.filterClicked.bindAsEventListener(this,i+1,max));Event.observe(li,"mouseover",this.pageNumHover.bindAsEventListener(this));Event.observe(li,"mouseout",this.pageNumHover.bindAsEventListener(this));}}.bind(this));},filterClicked:function(ev,current,max){var el=Event.element(ev);var filter=false,name=false;if(/([^-]+)-([^-]+)$/.test(el.id)){filter=RegExp.$1;name=RegExp.$2;}
if(this.slideLock||!filter||!name)return;this.setSelected(el);this["switch"+filter.capitalize()](name);var ul=el.up('ul');if(max>6&&ul)this.repaginate(ul,current,max);},init:function(options){this.calculateItemWidth();this.pageWidth=this.sld.getWidth();this.perPageCount=options.perPageCount||Math.round(this.pageWidth/this.itemWidth);this.updateCounts();this.pagesLoaded=this.count>=this.perPageCount?[true]:[];},calculateItemWidth:function(){if(!this.itemWidth||this.itemWidth==0){var first=this.sld.getElementsBySelector('li').first();if(first&&first.hasClassName('ld')){first=first.next('li');}
this.itemWidth=first?first.getWidth()+
parseFloat(first.getStyle("margin-left"))+
parseFloat(first.getStyle("margin-right")):0;if(/MSIE 6/.test(navigator.userAgent)){this.itemWidth-=first?parseFloat(first.getStyle("padding-left"))+
parseFloat(first.getStyle("padding-right")):0;}}},repopulate:function(){this.pagesLoaded=[];this.inr.update("");this.updateCounts();this.move(null,1);},switchSort:function(sort){if(this.slideLock)return;this.urlOptions.sort=sort;this.is_filter_click=true;this.repopulate();},updateMoreLink:function(){link=this.more.getAttribute("url");if(this.urlOptions.sort.match(/released_at/)){link=link.replace(/popular/,"recent");link=link.replace(/\/today/,"");}
self.location=link;},addSeasonToPlaylist:function(el,type){if(!Behaviors.loggedIn)
FloatingLoginForm.show(el);else{url='/users/add_season_to_playlist?';params={};if(this.urlOptions["show_id"])
params["show_id"]=this.urlOptions["show_id"];if(this.urlOptions["season"]){season_name="season_number";if(this.urlOptions["group_by_game_season"])
season_name="game_season";params[season_name]=this.urlOptions["season"];}
if(this.urlOptions["cluster_id"]){params["cluster_id"]=this.urlOptions["cluster_id"];}
if(typeof(type)!="undefined"&&type=="clip")
params["video_type"]="clip";if(!this.urlOptions.season)
this.seasonsQueued["all"]=true;else
this.seasonsQueued[this.urlOptions.season]=true;new Ajax.Request(url+$H(params).toQueryString(),{onSuccess:function(req){var aw=req.responseText.evalJSON(true);var pdiv=el.up('.vslc');pdiv.select('.add-me a').each(function(a){});pdiv.down('a.season-playlist').hide();var sel=pdiv.down('span.season-playlist');sel.show();if(aw.avail_warning){Behaviors.showPlusQueueWarning(sel,0,Behaviors.getAddQueueResponse(null,null,true));}
Behaviors.playlistInvalid=true;}});}},switchSeason:function(season){if(this.slideLock)return;this.updateUrlOptionsWithSeason(season);this.repopulateNav();this.repopulate();},checkOffVideos:function(){if(this.urlOptions.type&&this.urlOptions.type=="episode"){span=$('episode-container').down('span.season-playlist');link=$('episode-container').down('a.season-playlist');if(!this.urlOptions.season&&!this.seasonsQueued["all"]&&!(this.seasons&&this.seasons.hasClassName('past-stream-filter'))){if(span){span.hide();}
if(link){link.show();}}else if(this.urlOptions.season&&!this.seasonsQueued[this.urlOptions.season]&&!this.seasonsQueued["all"]&&!this.seasons.hasClassName('past-stream-filter')){if(span){span.hide();}
if(link){link.show();}}else{$('episode-container').select('.add-me a').each(function(a){});}}},updateUrlOptionsWithSeason:function(season){var type=this.urlOptions.type;if(this.urlOptions.category&&this.urlOptions.category.match(/^(full )?episodes$/i)){type='episode';this.urlOptions.type='episode';}
if(!type)return;if("all"==season){delete this.urlOptions.season;this.maxCount=this.seasonCounts[type]['all'];}
else{var count=this.seasonCounts[type];count=count?count['s'+season]:0;if(count<=0)return;this.urlOptions.season=season;this.maxCount=count;}
if(this.maxCount)
this.maxPages=Math.ceil(this.maxCount/this.perPageCount);},switchType:function(type){if(this.slideLock)return;this.urlOptions.type=type;this.urlOptions.sort=this.firstSort();delete this.urlOptions.season;this.maxCount=this.seasonCounts[this.urlOptions.type]['all'];this.repopulateNav();this.repopulateSeasonsNav();this.repopulateSortsNav();this.repopulate();},missingSeasonsFilter:function(){return this.seasons&&!this.hasSeasonsClass(this.seasons);},hasSeasonsClass:function(obj){return obj.hasClassName('sports-season-filter')||obj.hasClassName('past-stream-filter')||obj.hasClassName('vsl-categories-filter');},updateWithHashedOptions:function(options){var page=options.page;delete options.page;delete options.id;Object.extend(this.urlOptions,options);this.updateUrlOptionsWithSeason(options.season);if(this.missingSeasonsFilter())
this.repopulateSeasonsNav();this.repopulateSortsNav();var season=parseInt(this.urlOptions.season);if(0<season&&this.missingSeasonsFilter()){var ul=this.seasons;var current=0;ul.getElementsBySelector('li.ellipsis').each(Element.remove);var lis=ul.getElementsBySelector('li');lis.each(function(li,i){if(parseInt(li.innerHTML.stripTags())==season)current=i+1;});var max=lis.length;if(ul&&max>0&&current>0)this.repaginate(ul,current,max);}
this.pagesLoaded=[];this.inr.update("");this.updateCounts();this.move(null,page);},setSelected:function(el){var active=el.up("ul").getElementsBySelector("li.active").first();if(active)active.removeClassName("active");el.addClassName("active");},updateCounts:function(){this.count=this.sld.getElementsBySelector('li').length;this.currentWidth=this.count*this.itemWidth;},move:function(ev,to){if(this.slideLock)return;var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;var slide=false;switch(to){case"prev":page=(page-1)<1?1:page-1;slide=true;if(this.prev.hasClassName('disabled'))
return false;break;case"next":page=(page+1)>this.maxPages?this.maxPages:page+1;slide=true;if(this.next.hasClassName('disabled'))
return false;break;case"first":page=1;if(this.first.hasClassName('disabled'))
return false;break;case"last":page=this.maxPages;break;case"input":if(isNaN(parseInt(this.shownPageNumber.value))){this.shownPageNumber.value=page;return false;}else
page=parseInt(this.shownPageNumber.value);if(page<=0)
page=1;else if(page>this.maxPages)
page=this.maxPages;break;default:page=to;break;}
if(this.urlOptions.type=='related')
{if(!this.is_filter_click)
{var user_id=Behaviors.getUserId();if(typeof(this.urlOptions.show_id)!='undefined')
{if(typeof(_rTracking)!='undefined'&&_rTracking!=null)
_rTracking.send("relatedshow","scroll",user_id,this.urlOptions.show_id,null,null,null,page,null,"show-page",null);}
if(typeof(this.urlOptions.video_id)!='undefined')
{if(typeof(_rTracking)!='undefined'&&_rTracking!=null)
_rTracking.send("relatedvideo","scroll",user_id,this.urlOptions.video_id,null,null,"sort:"+this.urlOptions.sort,page,null,"watch-page",null);}}
else
this.is_filter_click=false;}
to=-1*(page-1)*this.pageWidth;this.lockSlide();if(slide){new Effect.Move(this.inr,{x:to,mode:'absolute',duration:0.4,afterFinish:this.updateSelectedPage.bind(this)});}
else{this.inr.style.left=to+"px";this.updateSelectedPage();}},unlockSlide:function(){this.slideLock=false;this.loading=false;},lockSlide:function(){if(!this.slideLock)this.slideLock=true;},loadPage:function(page,afterLoaded){if(this.count>=this.maxCount||this.pagesLoaded[page-1]){this.sld.fire("video_slider:list_changed",{page:page,is_cached:true});afterLoaded();return;}
else{if(this.loading)return;this.loading=true;var params=Object.extend(this.urlOptions,{page:page});this.sld.fire("video_slider:page_load",{page:page,is_first_load:this.is_first_load});if(params.type=="home_recommend"){params=Object.extend(params,{history:UserHistory.get_history(),watched_history:UserHistory.get_watched_history(),guid:Beacon.computerGUID()});this.updateURL();}
if(params.type=='related'){params=Object.extend(params,{user_id:Behaviors.getUserId(),history:UserHistory.get_history(),watched_history:UserHistory.get_watched_history(),guid:Beacon.computerGUID()});if(this.is_first_load)
{var user_id=Behaviors.getUserId();if(typeof(params.show_id)!='undefined')
{loc="show-page";if(typeof(params.location)!='undefined'&&params.location!=null)
loc=params.location;if(typeof(_rTracking)!='undefined'&&_rTracking!=null)
_rTracking.send("relatedshow","showup",user_id,params.show_id,null,null,null,null,null,loc,null);}
if(typeof(params.video_id)!='undefined')
{if(typeof(_rTracking)!='undefined'&&_rTracking!=null)
_rTracking.send("relatedvideo","showup",user_id,params.video_id,null,null,null,null,null,"watch-page",null);}
this.is_first_load=false;}}
this.is_first_load=false;$$('.cached-lazy-slider').each(function(e){e.remove();});this.showLoading(page);this.loadPageUrl(page,params,afterLoaded);}},loadPageUrl:function(page,params,afterLoaded){var url=[this.url,$H(params).toSortedQueryString()].join('?')
new Ajax.Request(url,{method:'get',onSuccess:this.populatePage.bindAsEventListener(this,page),onComplete:function(){$$('.cp-'+VideoSlider.currentVideoId()).invoke("show");this.hideLoading();afterLoaded();this.checkOffVideos();if(this.urlOptions.quick_play){featureQuickplay.init();}}.bind(this)});},showLoading:function(page){new Insertion.Bottom(this.inr,'<li class="ld" '+'style="position:absolute;left:'+((page-1)*this.pageWidth)+'px;width:'+this.pageWidth+'px"></li>');},hideLoading:function(){var loader=this.inr.getElementsBySelector('.ld').first();if(loader)loader.remove();},populatePage:function(ev,page){this.hideLoading();new Insertion.Bottom(this.inr,ev.responseText);this.updateCounts();this.absolutize(page);this.pagesLoaded[page-1]=true;Behaviors.toggleFirstDescendant('#'+this.sld.id+' span.play-button-hover');this.rewriteLinks(page);this.sld.fire("video_slider:list_changed",{page:page,is_cached:false});},PARSE_CHANNEL_RX:/\bc=[a-zA-Z-]+(\/[a-zA-Z-]+)?/,rewriteLinks:function(page){if(this.dontRewriteLinks)return;var opts=Object.extend({page:page,id:this.sld.id},this.urlOptions);var hash=this.optsHashified(opts);var origHTML;var saveHTML=Prototype.Browser.IE;var channel_rx=this.PARSE_CHANNEL_RX;var channel=null;var match=window.location.search.match(channel_rx);if(match){channel=match[0];}
this.inr.getElementsBySelector("a").each(function(a){if(a.hasClassName('linkRewritten')||(!(/\/watch\//).test(a.href)&&!(/\/superbowl\//).test(a.href)))return;if(saveHTML)origHTML=a.innerHTML;if(channel){if(!channel_rx.test(a.href)){a.href=a.href.replace(/(\?|$)/,'?'+channel);}
else{a.href=a.href.replace(channel_rx,channel);}}
a.href=a.href.replace(/(#[^#]+)?$/,hash);a.addClassName('linkRewritten');if(saveHTML&&origHTML)a.update(origHTML);});},HASHIFIED_SORTS:{number_of_votes:"n",n:"number_of_votes",released_at:"r",r:"released_at",original_premiere_date:"o",o:"original_premiere_date",views:"a",a:"views",view_count_today:"t",t:"view_count_today",rating:"u",u:"rating",title:"i",i:"title",released_first:"f",f:"released_first"},optsHashified:function(opts){var a=[];if(opts.page)a.push('p'+opts.page);if(opts.season)a.push('n'+opts.season);if(opts.sort)a.push('s'+this.HASHIFIED_SORTS[opts.sort]);if(opts.id)a.push('i'+this.index);return'#s-'+a.join('-');},dehashifyOpts:function(hash){var opts={};if(hash.match(/^#?s-/)){$A(hash.replace(/^#?s-/,'').split('-')).each(function(v){var key=v.substring(0,1);var rest=v.substring(1);switch(key){case"p":opts.page=rest;break;case"n":opts.season=rest;break;case"s":opts.sort=this.HASHIFIED_SORTS[rest];break;case"i":opts.id=VideoSlider.REWRITE_LINK_SLIDERS[parseInt(rest)];break;}}.bind(this));}
return opts;},absolutize:function(page){if('function'==typeof Superbowl.rearrange&&this.urlOptions.items_per_line){Superbowl.rearrange(this,page);return;}
var lis=this.inr.getElementsBySelector("li");var current=0;var x=0,y=0;var itemHeight=0;var ipp=this.perPageCount;var ipl=Math.floor(this.pageWidth/this.itemWidth);if(ipl>ipp)ipl=ipp;var numberOfLines=1;lis.each(function(li,i){if(li.hasClassName('absolutized'))return;this.calculateItemWidth();Position.absolutize(li);x=(this.pageWidth*(page-1))+(current%ipl)*this.itemWidth;if(current<ipp&&li.getHeight()>itemHeight)itemHeight=li.getHeight();if(current>0&&current%ipl==0){y+=itemHeight;if(current<ipp)numberOfLines++;}
if(current%ipp==0){y=0;}
if(current%ipp==ipp-1){page++;}
li.style.top=y+"px";li.style.left=x+"px";li.addClassName('absolutized');current+=1;}.bind(this));lis.each(function(li,i){li.setStyle({height:itemHeight+'px'});});var newHeight=itemHeight*numberOfLines;if(newHeight>this.sld.getHeight()){this.sld.setStyle({minHeight:(itemHeight*numberOfLines)+"px"});}},updateSelectedPage:function(){var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;if(isNaN(page))page=1;page=Math.ceil(page);this.loadPage(page,this.unlockSlide.bind(this));if(this.nav){this.next.removeClassName("disabled");this.prev.removeClassName("disabled");this.first.removeClassName("disabled");if(page==1){this.first.addClassName("disabled");this.prev.addClassName("disabled");}
if(page==this.maxPages){this.next.addClassName("disabled");}
if(this.maxPages<3)
this.first.hide();else
this.first.show();if(this.maxPages<3&&!this.shownPageNumber.hasClassName('short')){this.shownPageNumber.removeClassName('long');this.shownPageNumber.addClassName('short');}else if(this.maxPages>=3&&!this.shownPageNumber.hasClassName('long')){this.shownPageNumber.removeClassName('short');this.shownPageNumber.addClassName('long');}
this.shownPageNumber.value=page;this.total.innerHTML=this.maxPages;this.nav.show();}
if(this.fb_nav_prev){this.prev.removeClassName("disabled");if(page==1){this.prev.addClassName("disabled");}}
if(this.fb_nav_next){this.next.removeClassName("disabled");if(page==this.maxPages){this.next.addClassName("disabled");}}},currentPos:function(){return parseInt(this.inr.getStyle("left").replace("px",""));},repopulateNav:function(){if(!this.nav)return;this.nav.hide();this.nav.getElementsBySelector('li.page-num').each(Element.remove);this.maxPages=Math.ceil(this.maxCount/this.perPageCount);this.populateNav();this.nav.show();},repopulateSortsNav:function(){if(!this.sorts)return;var lis=this.sorts.getElementsBySelector('li');if(lis.length>1){lis.each(function(li){if(/-([^-]+)$/.test(li.id)){var sort=RegExp.$1;if(sort==this.urlOptions.sort)
li.addClassName('active');else
li.removeClassName('active')}}.bind(this));}},firstSort:function(){var sorts=this.sorts.getElementsBySelector('li');var sort=sorts.first();if(sort&&/-([^-]+)$/.test(sort.id)){return RegExp.$1;}
return null;},repopulateSeasonsNav:function(){if(!this.seasons||(!this.seasonCounts&&!this.seasonCounts[this.urlOptions.type]))return;this.seasons.getElementsBySelector('li').each(Element.remove);var seasons=$H(this.seasonCounts[this.urlOptions.type]);seasons=seasons.keys().reject(function(s){return"all"==s||"s0"==s||seasons[s]<=0;});if(seasons.length>1){seasons=seasons.map(function(s){return parseInt(s.substring(1));});seasons=seasons.sortBy(function(n){return parseInt(n);});var prefix=this.sld.id+'-season-';seasons.each(function(season,i){new Insertion.Bottom(this.seasons,'<li id="'+prefix+season+'">'+season+"</li>");}.bind(this));}
new Insertion.Bottom(this.seasons,'<li id="'+prefix+'all" class="active">All</li>');this.ellipsize(this.seasons);},populateNav:function(){if(this.perPageCount<=0)return;this.updateSelectedPage();},pageNumHover:function(ev){Event.element(ev)[Event.element(ev).hasClassName('vslhover')?'removeClassName':'addClassName']('vslhover');},repaginate:function(ul,page,max,selector,ws){if(!ul)return;selector=selector||'li';ws=ws||1;if(ws%2!=0&&(max-ws*2)==2)ws+=2;ellipsize=max>ws*2+1;ul.getElementsBySelector('li.ellipsis').each(Element.remove);ul.getElementsBySelector(selector).each(function(el,i){i+=1;if(i==1||(page-ws<=i&&i<=page+ws)||i==max){el[i==page?'addClassName':'removeClassName']('active');if(ellipsize&&i!=1&&i!=max){if(i==page+ws)new Insertion.After(el,this.ELLIPSIS);if(i==page-ws)new Insertion.Before(el,this.ELLIPSIS);}
Element.show(el);}
else{Element.hide(el);}}.bind(this));},loadAndShow:function(ev){var el=this.container;var withinAnyPane=el.up(".pane-container");var withinSelectedPane=el.up(".pane-selected");if(el&&el.style.display!='none'&&(!withinAnyPane||withinSelectedPane))
{var top=document.viewport.getScrollOffsets();top=top.top+document.viewport.getHeight();var elTop=el.cumulativeOffset().top+el.getHeight();var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;if((this.count>=this.maxCount||this.pagesLoaded[page-1])&&this.reload_ratemore){elTop=100;}
if(top>=(elTop-100)){Event.stopObserving(window,"scroll",this.lazyLoader);Event.stopObserving(window,"resize",this.lazyLoader);Behaviors.applyCufon();this.updateSelectedPage();}}},stopObservingLazyLoad:function(){Event.stopObserving(window,"scroll",this.lazyLoader);Event.stopObserving(window,"resize",this.lazyLoader);},lazyLoad:function(){this.container=null;this.container=this.sld.up('.fluid');if(this.container){this.lazyLoader=this.loadAndShow.bindAsEventListener(this);Event.observe(window,"scroll",this.lazyLoader);Event.observe(window,"resize",this.lazyLoader);this.loadAndShow();return;}
this.populateNav();this.updateSelectedPage();},updateShownPageValue:function(){var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;if(page&&this.shownPageNumber){this.shownPageNumber.value=page;}
if(this.shownPageNumber&&isNaN(parseInt(this.shownPageNumber.value))){this.shownPageNumber.value=1;}}});Event.observe(window,"pageshow",function(){$A(VideoSlider.SLIDERS).each(function(slider){slider=VideoSlider.SLIDER_OBJECTS.get(slider);slider.updateShownPageValue();});});
var VideoExpander={working:false,moreEpisodesClicked:function(name,url){if(VideoExpander.working)return;var el=$(name);var loading=$(el).down('.srh-loading');if(loading)loading.show();VideoExpander.working=true;new Ajax.Request(url,{method:'get',onSuccess:function(){VideoExpander.working=false;}});},subheadingClicked:function(name,url){if(VideoExpander.working)return;var els=$$('.'+name);var el=$(name);if(els.length>0){els.each(Element.toggle)
VideoExpander.toggleArrow(el)}
else{var loading=$(el).down('.srh-loading');if(loading)loading.show();VideoExpander.working=true;new Ajax.Request(url,{method:'get',onSuccess:function(){VideoExpander.toggleArrow(el);if(loading)loading.hide();VideoExpander.working=false;}});}},toggleArrow:function(el){if(el){var r=/\bvex-up\b/.test(el.className)?'vex-up':'vex-down';var a=r=='vex-down'?'vex-up':'vex-down';el.removeClassName(r);el.addClassName(a)}},showLoading:function(id){var loader=$$('#'+id+'-nav div.pagination-loading').first();if(!loader&&$(id).up('.show-container'))
loader=$(id).up('.show-container').down('.loading');if(loader)loader.show();},hideLoading:function(id){var loader=$$('#'+id+'-nav div.pagination-loading').first();if(!loader)loader=$(id).up('.show-container').down('.loading');if(loader)loader.hide();},addSeasonToPlaylist:function(el,params){el=$(el);var show_id=params.show_id||0;var cluster_id=params.cluster_id||0;var season_number=params.season_number||0;if(!el||(show_id<=0&&cluster_id<=0)||season_number<=0||typeof(Behaviors)=='undefined')return;if(!Behaviors.loggedIn)
FloatingLoginForm.show(el);else{params="season_number="+season_number;if(show_id>0)
params+="&show_id="+show_id;if(cluster_id>0)
params+="&cluster_id="+cluster_id;new Ajax.Request('/users/add_season_to_playlist?'+params,{onSuccess:function(req){var aw=req.responseText.evalJSON(true)
el.up('.vex').select('.s-'+season_number+' .playlist-link').each(function(a){});var pel=el.up();pel.update('<img src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" '+'title="You have queued all episodes from this season" style="vertical-align:middle;"/>');if(aw.avail_warning){Behaviors.showPlusQueueWarning(pel,0,Behaviors.getAddQueueResponse(null,null,true));}
Behaviors.playlistInvalid=true;}});}},addToPlaylist:function(el,video_id,tv_valid,mobile_valid,plus_only,auth_valid){el=$(el);if(!el||video_id<=0||typeof(Behaviors)=='undefined')return;if(!Behaviors.checkAddQueue(el,plus_only,auth_valid)){return false;}
else{new Ajax.Request('/users/add_to_playlist?video_id='+video_id,{onSuccess:function(){var msg=Behaviors.getAddQueueResponse(tv_valid,mobile_valid);var pel=$(el).up();pel.update('<img src="'+Base.imageURL('/images/icon-check.gif')+'" height="16" width="16" '+'title="You have queued this video" style="vertical-align:middle;"/>');Behaviors.playlistInvalid=true;if(msg){Behaviors.showPlusQueueWarning(pel,0,msg);}}});}},hashOptions:function(sorts,defaults){if(location.hash.match(/^#?x-/)){var opts=$A(location.hash.replace(/^#?x-/,'').split(','));var sort=sorts[parseInt(opts[0])];var page=parseInt(opts[2]);var order=parseInt(opts[3])?"asc":"desc";var params=Object.extend(defaults,{sort:sort,page:page,order:order});var value=unescape(opts[1].substring(1));switch(opts[1].substring(0,1)){case'v':if(value!=defaults.video_type)return;params.video_type=value;break;case'c':var nil_cat=(defaults.category||'').blank();if(('Others'==value&&!nil_cat)||value!=defaults.category)return;if(!nil_cat)params.category=value;break;}
return params;}
return null;},_currentVideoId:-1,currentVideoId:function(){if(VideoExpander._currentVideoId!=-1)
return VideoExpander._currentVideoId;try{VideoExpander._currentVideoId=parseInt(window.location.pathname.split('/watch/')[1].split('/')[0]);}
catch(e){VideoExpander._currentVideoId=null;}
return VideoExpander._currentVideoId;},_highlighted:false,highlightCurrent:function(){var highlighted=false;$$('.vex a.show-thumb').each(function(el){if(/watch\/(\d+)/.test(el.href)&&RegExp.$1){var id=parseInt(RegExp.$1);if(id==VideoExpander.currentVideoId()){el.up('tr').addClassName('currently-playing');highlighted=true;throw $break;}}});VideoExpander._highlighted=highlighted;return highlighted;},_initialTrailerPage:0,setInitialTrailerPage:function(page){VideoExpander._initialTrailerPage=page;},setState:function(sorts,options){var defaults=Object.clone(options);var highlighted=VideoExpander.highlightCurrent();var hashOptions=VideoExpander.hashOptions(sorts,defaults);if(VideoExpander._initialTrailerPage&&!hashOptions&&options.video_type=="film_trailer"){hashOptions=Object.extend(defaults,{page:VideoExpander._initialTrailerPage});}
if(hashOptions!=null){if(hashOptions.video_type!=options.video_type)return;if(highlighted&&hashOptions.sort==options.sort&&hashOptions.order==options.order)return;if(hashOptions.sort=="season"&&hashOptions.video_type=="episode"){hashOptions=Object.extend(hashOptions,{current_video_id:VideoExpander.currentVideoId()});delete hashOptions['action'];Event.observe(window,"load",function(){VideoExpander._highlighted=false;new Ajax.Request('/videos/season_expander',{method:'get',evalScripts:true,parameters:hashOptions,onComplete:function(){if(!VideoExpander._highlighted){new Ajax.Request('/videos/season_expander',{method:'get',evalScripts:true,parameters:Object.extend(hashOptions,{more_episodes:1})});}}});});}
else{Event.observe(window,"load",function(){new Ajax.Request('/videos/expander',{method:'get',evalScripts:true,parameters:hashOptions});});}}},filter:function(id,url){this.showLoading(id);new Ajax.Request(url,{method:'get',evalScripts:true,asynchronous:true});}};
var Review={showReportMenu:function(el,id){if(READ_ONLY)return;if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
var menu=$$('.report-menu').first();if(menu&&el){var reportDiv=el.up('div.review-block-extras-container').adjacent('div.review-block-report-container')[0];$(reportDiv).appendChild(menu);menu.show();var form=menu.down('form');if(form)Form.reset(form);var applies_to=menu.down('.applies-to');if(applies_to){applies_to.update(id);}
else{new Insertion.Bottom(menu,'<div style="display:none" class="applies-to">'+id+'</div>');}}
return false;},hideReportMenu:function(el){$$('.report-menu').each(Element.hide);return false;},sendReport:function(){if(READ_ONLY)return;var menu=$$('.report-menu').first();var form=menu.down('form');var id=menu.down('.applies-to');if(id)id=parseInt(id.innerHTML);if(!menu||!form||!id||id<0){Review.hideReportMenu();return;}
new Ajax.Request('/reviews/report/'+id,{asynchronous:true,evalScripts:true,parameters:Form.serialize(form,true)});Review.hideReportMenu();reportExtrasDiv=menu.up('div.review-block-report-container').adjacent('div.review-block-extras-container')[0];reportExtrasDiv.update("Thank you for reporting.  <br/>We will review this as soon as possible.");reportExtrasDiv.up('div.item.review').addClassName('reported');},makeActive:function(review){if(!READ_ONLY){$(review).addClassName('active');}},makeInactive:function(review){$(review).removeClassName('active');},toggleStar:function(id){$$(".star-choosed").each(function(e){e.removeClassName('star-choosed');});if(id!=0){var el=$('r-'+id+'-star-class').down('a');el.addClassName("star-choosed");$('review-filter-header-all').down('a').removeClassName('nolink');$('review-filter-header-more').update(id+' Star Reviews');$('review-rating-head').style.display="block";}
else{$('review-filter-header-all').down('a').addClassName('nolink');$('review-filter-header-more').update('');$('review-rating-head').style.display="none";}},Event:{onFinishUpdating:function(){$('review-submit').disabled=false;},onFailure:function(){Element.update('new_review_form_errors','We are encountering some issues, please try to submit again.');Element.hide('create-review-loading-bar');$('review-submit').disabled=false;},onSubmit:function(){Element.update('new_review_form_errors','');Element.show('create-review-loading-bar');$('review-submit').disabled=true;}}};function clearReviewForm(){$("user_review_title").value="";$("user_review_message").value="";Element.update('new_review_form_errors','');if($('new_review_form'))$('new_review_form').hide();}
function openReview(el){if(READ_ONLY)return;if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
doOpenReview(el);}});return false;}
else{doOpenReview(el);}}
function doOpenReview(el){if($('new_review_form').style.display=='none'){new Ajax.Request("/users/permission_check",{asynchronous:true,method:"get",onComplete:function(request){info=request.responseText.evalJSON();if(info.permitted){$("user_review_title").value="";$("user_review_message").value="";$('new_review_form').show();$("user_review_title").focus();}
else
Behaviors.showSubmitPermission("review");}});}}
function incrementReviewCount(){clearReviewForm();if($('review-none-message'))$('review-none-message').hide();var curr=0;try{curr=parseInt($('review_count').innerHTML);$('review_count').update(curr+1);}
catch(e){}}
function reviewPopUp(url){var full=window.open(url,'review_stand_alone','width=940,height=600,resizable=1,toolbar=0,status=0,scrollbars=1');full.focus();}
var current_review_form_rating=-1;function restoreRating(){clickRating(current_review_form_rating);}
function clickRating(rating){updateRatingSelect(rating);current_review_form_rating=rating;}
function updateRating(rating){if(rating<0){try{$("rating-text").innerHTML="Select a star rating";for(var i=1;i<=5;i++)
$("rating-star-"+i).src=$("rating-star-"+i).src.replace(/rating_[^\.]+[\.]gif/,"rating_empty.gif");$("user_review_rating").value=-1;}
catch(e){}}else{try{$("rating-text").innerHTML=(["Hated it","Didn't like it","Thought it was OK","Liked it","Loved it"])[rating-1];for(var i=1;i<=5;i++)
$("rating-star-"+i).src=$("rating-star-"+i).src.replace(/rating_[^\.]+[\.]gif/,(i<=rating)?"rating_hover.gif":"rating_empty.gif");$("user_review_rating").value=rating;}
catch(e){}}}
function updateRatingSelect(rating){if(rating<0){try{$("rating-text").innerHTML="Select a star rating";for(var i=1;i<=5;i++)
$("rating-star-"+i).src=$("rating-star-"+i).src.replace(/rating_[^\.]+[\.]gif/,"rating_empty.gif");$("user_review_rating").value=-1;}
catch(e){}}else{try{$("rating-text").innerHTML=(["Hated it","Didn't like it","Thought it was OK","Liked it","Loved it"])[rating-1];for(var i=1;i<=5;i++)
$("rating-star-"+i).src=$("rating-star-"+i).src.replace(/rating_[^\.]+[\.]gif/,(i<=rating)?"rating_full.gif":"rating_empty.gif");$("user_review_rating").value=rating;}
catch(e){}}}
var Profile=Class.create();Object.extend(Profile,{WORKING_TAG:'<img '+'class="working" '+'src="'+Base.imageURL('/images/loading-animated-circle.gif')+'" '+'width="16" '+'height="16" '+'border="0" '+'/>',SUCCESS_TAG:'<img '+'class="success" '+'src="'+Base.imageURL('/images/icon-check.gif')+'" '+'width="16" '+'height="16" '+'border="0" '+'/>',workingOnQueue:false,showWorking:function(){$$('.save-cancel').each(Element.hide);$$('.working').each(Element.show);},hideWorking:function(){$$('.save-cancel').each(Element.show);$$('.working').each(Element.hide);},showSuccess:function(){$$('.success').each(Element.show);},hideSuccess:function(){$$('.success').each(Element.hide);},showErrors:function(errors){this.hideWorking();ModalPopup.warn("Please fix the following errors: <br/>"+
$A(errors).map(function(a){return Object.isArray(a)?a[1]:a;}).join("<br/>"),null,true);},settingsCancel:function(){window.location.hash="#settings-reset";window.location.reload();},showSettingsReset:function(){ModalPopup.warn("Your settings have been reset.",null,true);},hideErrors:function(){$$('.error-box').each(Element.hide);},hideUnowned:function(){$$('.owned').each(Element.hide);},toggleAlreadyWorking:function(el){var form=$(el).up('form');if(!form)return false;return!!form.down('img.working');},toggleShowWorking:function(el){var form=$(el).up('form');if(!form)return;var cbx=form.down('.cbx');if(!cbx)return;Profile.toggleRemoveSuccessTag(form);new Insertion.After(cbx,Profile.WORKING_TAG);},toggleStopWorking:function(el){if(!this.toggleAlreadyWorking(el))return;var form=$(el).up('form');if(!form)return;var cbx=form.down('.cbx');if(!cbx)return;var working=form.down('img.working');if(working&&working.parentNode)working.parentNode.removeChild(working);if('public'==eval(cbx.id+".value")){var tr=$(form).up('tr');if(tr)tr.removeClassName('hide-item');}
else{var tr=$(form).up('tr');if(tr)tr.addClassName('hide-item');}
Profile.toggleRemoveSuccessTag(form);new Insertion.After(cbx,Profile.SUCCESS_TAG);setInterval(function(){Profile.toggleRemoveSuccessTag(form);},1000);},toggleRemoveSuccessTag:function(form){var img=$(form).down('img.success');if(img&&img.parentNode)img.parentNode.removeChild(img);},toggleVisibility:function(el,id,type){if(!id||this.toggleAlreadyWorking(el))return;this.toggleShowWorking(el);new Ajax.Request(['/profile/toggle_visibility_of_list_item/',id,'?type=',type].join(''),{onComplete:function(){Profile.toggleStopWorking(el);}});},toggleQueueHelpHTML:function(el,show_expiring,html_format){if(typeof(html_format)!='undefined')
var html=html_format;else
var html=Form.Element.getValue($('user_queue_html_1'))=="1";if(typeof(show_expiring)!='undefined'){var queue=!show_expiring;var expiring=show_expiring;}else{var queue=Form.Element.getValue($('preference_notify_queue'))=="1";var expiring=Form.Element.getValue($('preference_notify_expiring'))=="1";if(!queue&&!expiring)
queue=expiring=true;}
if(html){var popup=$('popup_queue_help_html');}else{var popup=$('popup_queue_help_text');}
if(!popup)return;var wasHidden='none'==popup.style.display;Profile.hideQueueHelpHTML();if(!wasHidden||(!queue&&!expiring))return;if(queue)
popup.select('.added').each(Element.show);if(expiring)
popup.select('.expiring').each(Element.show);var dim=popup.getDimensions();var viewdim=document.viewport.getDimensions();var scroll=document.viewport.getScrollOffsets();popup.style.left=scroll[0]+viewdim.width/2-dim.width/2+'px';popup.style.top=scroll[1]+viewdim.height/2-dim.height/2-70+'px';popup.show();$$('.overlay-full').first().show();$$('.overlay-full').first().onclick=function(){Profile.hideQueueHelpHTML()};},hideQueueHelpHTML:function(el){$$('.popup.queue-help').each(function(el){el.select('.added').each(Element.hide);el.select('.expiring').each(Element.hide);el.hide();});$$('.overlay-full').first().hide();},hideQueueHelp:function(){$$('.queue-help').each(Element.hide);$$('select').each(function(el){el.style.visibility='visible';});$$('.overlay-full').first().hide();},toggleHelp:function(el){if(el.style.display=='none')
el.show();else
el.hide();},toggleAllCheckboxes:function(form,state){$$('#'+form.id+' input').each(function(input){if(input.type!='checkbox')return;input.checked=state;});},queueOrderUpdated:function(){var queue_positions=$$('#queue input');var i=Profile.firstQueuePosition;if(i==1){$$('div#queue tr.first').invoke('removeClassName','first');var tr=$$('div#queue tr.r').first();if(tr){tr.addClassName('first');}}
queue_positions.each(function(input){if(/^position_/.test(input.name)){input.value=i;i++;}});Profile.updateOrder();},updateFirstQueuePosition:function(){var el=$$('#queue input').find(function(input){return/^position_/.test(input.name);});if(el&&el.value>0){Profile.firstQueuePosition=el.value;}
if(Profile.firstQueuePosition!=1){$$('div#queue tr.first').invoke('removeClassName','first');}},firstQueuePosition:1,toggleInfoExpansion:function(el){if(el.hasClassName('collapsed')){el.removeClassName('collapsed');el.addClassName('expanded');$('info-expansion-arrow').src=Base.imageURL('/images/button-expand-hover.gif');}
else{el.removeClassName('expanded');el.addClassName('collapsed');$('info-expansion-arrow').src=Base.imageURL('/images/button-collapse-hover.gif');}},settingsChanged:false,replace_profile_cache:function(user_id,subaction){if(Behaviors.isLoggedIn()){var params=window.location.toString().split("?");var urlParams='';if(params.length==2){urlParams='?'+params[1];}
new Ajax.Request('/profiles/friend/'+user_id+"/"+subaction+urlParams,{asynchronous:true,evalScripts:true,method:'get',onComplete:function(request){$('profile-loading-container').hide();},onSuccess:function(request){$('cacheable_profile_update').update(request.responseText);Behaviors.applyCufon();},onFailure:function(request){Profile.show_public(false,subaction);}});}
else{Profile.show_public(false,subaction);}},perform_queue_action:function(confirm,url,self_queue_url,ievent){if(/__action__/.test(url)){var el=Event.element(ievent||window.event).up('form').down('.perform_queue_action');var action=(el?$(el).value:null)
url=url.replace('__action__',action);}else{var action=true;}
var params=Form.serialize($('queue_options'));if(/remove_queue_items/.test(url)&&!/selected/.test(params)){ModalPopup.warn('Please select an item to remove first.',null,true);return false;}
$$('.queue-actions .working').each(Element.show);if(action&&!Profile.workingOnQueue){if(confirm&&confirm!=''){if(/{COUNTED_ITEMS}/.test(confirm)){var count=-1;try{count=$('queue_options').serialize().toQueryParams()['selected[]'];if(typeof(count)=="string")count=1;else count=count.length;}
catch(e){}
var text='these queued items';if(count==0||count>1){text=''+count+' queued items';}
else if(count==1){text=''+count+' queued item';}
confirm=confirm.replace('{COUNTED_ITEMS}',text);}
ModalPopup.ask(confirm,"Profile.workingOnQueue = true; new Ajax.Request('"+url+"', { parameters: Form.serialize($('queue_options')), onComplete: function() { window.location = '"+self_queue_url+"';}});","$$('.working').each(Element.hide);");}else{Profile.workingOnQueue=true;new Ajax.Request(url,{parameters:params,onComplete:function(){window.location=self_queue_url;}});}}
else{$$('.queue-actions .working').each(Element.hide);}},show_public:function(owner_public_view,subaction){$('profile-loading-container').hide();$('hidden-'+subaction).style.visibility='';$('hidden-side-favorites').style.visibility='';},updateStatus:function(status,iconSrc){container=$('profile-status');if(container){container.down('div.message').update(status);if(iconSrc){var icon=container.down('div.icon img');if(icon){icon.writeAttribute('src',iconSrc)}}
container.show();}},redirectSuccess:function(anchor){window.location='/profile#'+anchor;},removeAllHistory:function(){new Ajax.Request('/profile/clear/history',{asynchronous:true,evalScripts:true,onComplete:function(request){window.location="/profile/history";}});},hideInvalidEmail:function(){$('invalid_email_warning').hide();Behaviors.setCookie('_invalid_email','1',60);},QueueSettings:{working:false,handleSubmit:function(form){if(Profile.QueueSettings.working)return;Profile.QueueSettings.working=true;new Ajax.Request('/profile/update_queue_settings',{asynchronous:true,evalScripts:true,parameters:Form.serialize(form),onComplete:Profile.QueueSettings.completeHandler(form)});},completeHandler:function(form){var checkbox=null,working=null;checkbox=form.down('input.cb');working=form.down('.working');return function(){Profile.QueueSettings.working=false;if(checkbox&&working){checkbox.show();working.hide();}};},handleClick:function(checkbox){if(Profile.QueueSettings.working)return;checkbox=$(checkbox);var form=checkbox.up('form'),working=null;if(form)working=form.down('.working');if(form&&form.onsubmit){if(checkbox&&working){checkbox.hide();working.show();}
form.onsubmit();}}},Editable:{curForm:null,activate:function(){document.observe("dom:loaded",Profile.Editable.activateEditButtons);},activateEditButtons:function(){$$(".edit").each(function(edit){if(!edit.hasClassName("activated")){Event.observe(edit,"click",Profile.Editable.editClicked);edit.addClassName("activated");}});},submit:function(form,url,csrf){var _submit=function(){Profile.showWorking();Profile.hideErrors();new Ajax.Request(url,{method:'post',parameters:Form.serialize(form)+'&csrf='+csrf,evalScripts:true,onSuccess:function(request){if(request.responseText.search("PayPalRedirect:")==0){window.location.href=request.responseText.replace("PayPalRedirect:","");return;}
Profile.Editable.finishedEditing(form);var msg="Your billing information has been successfully updated.";if(url.match("/plus/update"))
ModalPopup.warn(msg);},onFailure:function(request){var msg=request.responseText;if(msg.match(/please verify your password/)){Plus.VerifyPassword.verify({success:_submit,force:true});}else{if(msg.length<2)msg="Sorry we are having trouble updating your information. Please try again later.";ModalPopup.warn(msg,null,true);}},onComplete:function(request){Profile.settingsChanged=false;if(request.responseText.search("PayPalRedirect:")!=0){Profile.hideWorking();}}});}
Plus.VerifyPassword.verify({success:_submit});},subscriptionUpdated:function(subscription,refresh){for(var field in subscription){var el=$("s_"+field);if(el){if(field=="card_info"||field=="next_bill_info"){el.update(subscription[field]);}
else{el.update(subscription[field].escapeHTML());}}}
var el2=$("d_street2");if(el2){subscription["street2"]?el2.show():el2.hide();}
if(refresh){Behaviors.reloadCurrentPage();}},updated:function(user){for(var field in user){var el=$("u_"+field);if(el){el.update(user[field].stripTags());}}},changed:function(){Profile.settingsChanged=true;Profile.hideSuccess();},editClicked:function(ev,elem){var el=ev?Event.element(ev):elem;var display=null,edit=null,infosubs=null;if(el)display=el.up(".infosubs").down('.content');if(el)infosubs=el.up(".infosubs");if(display==null)display=infosubs;if(infosubs)edit=infosubs.next(".infoedit");if(edit&&display){if(Profile.Editable.curForm){Profile.Editable.finishedEditing(false);}
Profile.Editable.curForm=edit
display.hide();el.hide();edit.show();Profile.Editable.click_pay_method();};},cancel:function(ev){var el=Event.element(ev);if(el){var edit=el.up(".infoedit");if(edit){var form=edit.down("form");if(form){$$(".sec_code").each(Element.hide);Profile.Editable.observeCardNumber("card_number");var pay_rb_selected="pay_method_cc";form.getInputs("radio","pay_method").each(function(r){if(r.checked==true){pay_rb_selected=r.id;}})
form.reset();if($(pay_rb_selected)){$(pay_rb_selected).checked=true;}}}}
Profile.Editable.finishedEditing(el);},observeCardChange:function(id){var mask=$(id);if(!mask)return;var form=mask.up("form");if(!form)return;["card_type","expiration_month","expiration_year"].each(function(i){var el=form[i];if(el)Event.observe(el,"change",function(){mask.simulate('focus');});});},observeCardNumber:function(id){var mask=$(id);if(!mask)
return;var clearAndShowCode=function(ev){var el=Event.element(ev);Event.stopObserving(mask,"focus",clearAndShowCode);if(el)el.value="";$$(".sec_code").each(Element.show);};Event.observe(mask,"focus",clearAndShowCode);},mutuallyExclusiveShow:function(ctr1,ctr2,cls1,cls2,event){if(!ctr1||!ctr2||!cls1||!cls2||!event){return;}
Event.observe(ctr1,event,function(){$$('.'+cls1).each(Element.show);$$('.'+cls2).each(Element.hide);});Event.observe(ctr2,event,function(){$$('.'+cls1).each(Element.hide);$$('.'+cls2).each(Element.show);$(this.form["card_number"]).focus();});},click_pay_method:function(){$$('.pay_method_rb').each(function(x){if(x.checked==true){x.simulate("click");}});},finishedEditing:function(el){Profile.hideErrors();var display=null,edit=null,links;if(el){edit=el.up(".infoedit");}else if(el===false){edit=Profile.Editable.curForm;}
if(edit)display=edit.previous(".infosubs").down('.content');if(display==null)display=edit.previous(".infosubs");if(display)links=edit.previous(".infosubs").getElementsBySelector('.edit')
if(edit&&display){edit.hide();display.show();links.each(function(link){link.show();});Profile.Editable.curForm=null;}}},Settings:{initialize:function(form){var elements=form.elements;for(i=0;i<elements.length;i++){elements[i].onchange=function(){Profile.settingsChanged=true;Profile.Settings.submit();};}},submit:function(){var _submit=function(){Profile.showWorking();Profile.hideErrors();new Ajax.Request('/profile/update_settings',{method:'post',parameters:Form.serialize($('profile-settings-form')),evalScripts:true,onSuccess:function(request){Profile.hideWorking();Profile.settingsChanged=false;Profile.showSuccess();},onFailure:function(request){var ret=request.responseText.evalJSON();Profile.hideSuccess();if(ret.filter(function(x){return x.match(/please verify your password/)}).length>0){Plus.VerifyPassword.verify({success:_submit,force:true});}else{Profile.showErrors(ret);}},onComplete:function(){Profile.settingsChanged=false;Profile.hideWorking();}});}
Plus.VerifyPassword.verify({success:_submit});}},ParentalControls:{submit:function(){new Ajax.Request('/profile/update_parental_controls',{method:'post',parameters:Form.serialize($('parental-controls-form')),evalScripts:true,onSuccess:function(response){var ret=response.responseText;ModalPopup.hide();$$('div.profile-settings-errors').each(Element.hide);$$('div.parental-controls-current').each(function(elem){elem.update(ret);});},onFailure:function(response){var ret=response.responseText;if(ret.match(/token timed out/)){ModalPopup.hide();ModalPopup.display_div($('parental-controls-password'),430,180,false,false);$('parental-controls-token-error').show();}else if(ret.match(/invalid setting/)){$('parental-controls-setting-error').show();}else if(ret.match(/not old enough/)){$('parental-controls-age-error').show();}else{$('parental-controls-error').show();}}});},cancel:function(){new Ajax.Request('/profile/update_parental_controls',{method:'post',parameters:{cancel:'true'},evalScripts:true,onComplete:function(response){ModalPopup.hide();}});},submitPass:function(){new Ajax.Request('/users/verify_pass_parental',{method:'post',parameters:Form.serialize($('parental-controls-password-form')),evalScripts:true,onSuccess:function(response){$$('div.pass-error').each(Element.hide);$('parental-controls-password-form').reset();ModalPopup.hide();ModalPopup.display_div($('parental-controls'),430,300,false,false);},onFailure:function(response){$('parental-controls-password-form').reset();$('parental-controls-pass-error').show();}});}},LabSettings:{initialize:function(form){var elements=form.elements;for(i=0;i<elements.length;i++){elements[i].onchange=function(){Profile.settingsChanged=true;Profile.LabSettings.submit();};}},submit:function(){var _submit=function(){Profile.showWorking();Profile.hideErrors();new Ajax.Request('/profile/update_lab_settings',{method:'post',parameters:Form.serialize($('lab-settings-form')),evalScripts:true,onSuccess:function(request){Profile.hideWorking();Profile.settingsChanged=false;Profile.showSuccess();},onFailure:function(request){var msg=request.responseText;Profile.hideSuccess();if(msg.match(/please verify your password/)){Plus.VerifyPassword.verify({success:_submit,force:true});}else{if(msg.length<2)msg="Sorry we are having trouble updating your information. Please try again later.";Profile.showErrors(request);}},onComplete:function(){Profile.settingsChanged=false;Profile.hideWorking();}});}
Plus.VerifyPassword.verify({success:_submit});}},Bookmark:{remove:function(bookmark_id,bookmark_type,uid){new Ajax.Request("/profile/remove_bookmark",{parameters:{show_id:bookmark_id,show_type:bookmark_type},onComplete:function(){window.location.reload();}});BookmarkTracking.track('useraction',{event:'useraction',action:'delete',source:'mybookmarks',original_item_id:bookmark_id,original_item_type:bookmark_type,userid:uid});}},Login:{verify:function(path,csrf_value){var form=$("bi-login");if(form){new Ajax.Request(path,{parameters:Form.serialize(form)+'&csrf='+csrf_value,onSuccess:function(transport){form.hide();$("billinginfo").update(transport.responseText);Profile.Editable.activateEditButtons();},onFailure:function(transport){$("bi-login-error").update(transport.responseText.stripTags());}});}}},referral_show_delauth:function(provider){switch(provider){case"myspace":settings=Friend.MYSPACE_SETTINGS;break;case"windows":settings=Friend.WINDOWS_SETTINGS;break;case"google":settings=Friend.GOOGLE_SETTINGS;break;case"yahoo":settings=Friend.YAHOO_SETTINGS;break;default:return false;}
url="/profile/referrals_contact/"+provider;Profile.pop(url,settings);},popupWindow:'',popupWidth:0,pop:function(url,settings){if(!Profile.popupWindow.closed&&Profile.popupWindow.location){Profile.popupWindow.location.href=url;}
else{var width=settings[0];var height=settings[1];var left=(document.viewport.getWidth()-width)/2;var top=(document.viewport.getHeight()-100-height)/2;Profile.popupWidth=width;Profile.popupWindow=window.open(url,"friendpopup","toolbar=0,status=0,resizable=1,scrollbars=0"+",width="+width+",height="+height+",left="+left+",top="+top);if(Profile.popupWindow){if(!Profile.popupWindow.opener)
Profile.popupWindow.opener=self;}
else{ModalPopup.warn("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.",null,true);}}
if(window.focus)
Profile.popupWindow.focus();return false;},resize_pop:function(width,height){if(!window.opener||!window.opener.Profile)return;var dis=Math.abs(document.viewport.getWidth()-window.opener.Profile.popupWidth);if(dis<30){window.resizeTo(width,height);Profile.popupWidth=width;}},select_invite_emails:function(action){var table=$('invite-email-table')
table.select('input.invite-emails-check').each(function(el){if(!el.disabled){el.checked=action;}});$('invite-select-all').checked=action;},sendInviteEmails:function(el){var area=$('email-addresses');if(!area)
return;if($('sent-successfully')){$('sent-successfully').hide();}
var addresses=area.value;var error=area.up('div').down('#validation-error');var addressList=addresses.split(",");for(var i=0;i<addressList.length;i++){if(addressList[i].indexOf('@')<=0){if(error){error.update("The email address is invalid.");error.show();}
return;}}
if(error){error.hide();error.update("");}
var loading=area.up('div').down('#email-loading-icon');loading.show();new Ajax.Request("/profile/process_addresses_referrals/",{parameters:{"addresses":addresses},onSuccess:function(){loading.hide();$('sent-successfully').show();}});},toggleCheck:function(el){var input=el.up('tr').down('input');if(input&&'none'!=input.style.display)
input.checked^=true;},updateOrder:function(){$$('.update-order').each(function(el){el.style.visibility='visible';});}});
window["Profile"]=window["Profile"]?window["Profile"]:{};Profile.Playlist={Main:{toggle:function(el){container=$(el);if(!container.hasClassName('show-contianer')){container=container.up('.show-container');}
if(!container)return;if(container.hasClassName('open')){container.removeClassName('open');container.addClassName('closed');}
else{container.removeClassName('closed');container.addClassName('open');}}},Editor:{updateDescription:function(textarea,enable){if(enable){if(textarea.hasClassName("disabled")){textarea.removeClassName("disabled");textarea.value="";textarea.next('input.desc-submit').removeClassName('hidden');}}
else{if(!textarea.value||textarea.value.strip().blank()){textarea.value="Add a description";textarea.addClassName("disabled");}}},deletePlaylist:function(id,ajax){new Ajax.Request("/playlists/delete_playlist/"+id,{parameters:{ajax:ajax},method:'post',onSuccess:function(transport){if(!ajax){window.location="/profile/playlists";}},onComplete:function(transport){if(!$('playlist').down('.show-container')){window.location="/profile/playlists";}}});},askDeletePlaylist:function(id,ask,ajax){if(ask){ModalPopup.ask("Are you sure you want to delete this playlist?","Profile.Playlist.Editor.deletePlaylist("+id+","+ajax+");","");}else{Profile.Playlist.Editor.deletePlaylist(id,ajax);}},ask_public_verification:function(){Login.showEmailValidation('publishing playlists');},makePublic:function(id,pub){var cbx_span=$$('span.playlist-privacy-cbx.'+id).first();cbx_span.addClassName('loading');new Ajax.Request("/playlists/update_privacy/"+id,{parameters:{"privacy":(pub?"public":"private")},onFailure:function(transport){if(transport.status==403){Profile.Playlist.Editor.ask_public_verification();var value=!pub?"public":"private";eval("privacy_"+id+".changeValue('"+value+"')");}},onSuccess:function(transport){if(id=='all'){var value=pub?"public":"private";var cbs=$$(".cbx");cbs.each(function(cb){var pid=cb.id.gsub(/privacy_/,'');eval("privacy_"+pid+".changeValue('"+value+"')");});}},onComplete:function(){cbx_span.removeClassName('loading');}});},msgConfig:{"clear_list_items":"Are you sure you want to remove all expired items?","remove_list_items":"Are you sure you want to remove {COUNTED_ITEMS}?","move_list_item":null,"update_list_order":null},getParam:function(elements,without_description){var key,value=false;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!='file'&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}
else result[key]=value;}}
return result;});if("undefined"==(typeof without_description)||!without_description){$$("#sortable-playlist form.desc-edit").each(function(form){if(form.visible()&&!form["description"].hasClassName("disabled")){data["description"+"_"+form["playlist_item_id"].value]=form["description"].value;}});}
return data;},playlistId:0,performAction:function(){var self_playlist_url=window.location;var button=$(this);var url="/profile/{ACTION}?klass=Playlist&playlist_id={PLAYLIST_ID}";var action=button.readAttribute("pl_action");url=url.replace(/{ACTION}/,action).replace(/{PLAYLIST_ID}/,PPlaylist.Editor.playlistId);if(button.up('div.move-to-top')){url+=("&direction=top&playlist_item_id="+button.up('div.move-to-top').readAttribute('pl_item_id'));}
var params={};if(action=="set_list_cover"){params=PPlaylist.Editor.getParam($$("#sortable-playlist .item-data"),true);}else{params=PPlaylist.Editor.getParam($$("#sortable-playlist .item-data"));}
var params_str=Object.toQueryString(params);if("remove_list_items"==action&&!/selected/.test(params_str)){ModalPopup.warn('Please select an item to remove first.');return false;}
if("set_list_cover"==action&&!/selected/.test(params_str)){ModalPopup.warn('Please select an item to set first.');return false;}
$$(".playlist-actions .success").each(Element.hide);$$(".playlist-actions .working").each(Element.show);if(action&&!PPlaylist.workingOnPlaylist){var _confirm=PPlaylist.Editor.msgConfig[action];if(_confirm&&_confirm!=''){if(/{COUNTED_ITEMS}/.test(_confirm)){var count=-1;try{count=params['selected[]'];if(typeof(count)=="string")count=1;else count=count.length;}
catch(e){}
var text="these playlist items";if(count==0||count>1){text=''+count+' playlist items';}
else if(count==1){text=''+count+' playlist item';}
_confirm=_confirm.replace('{COUNTED_ITEMS}',text);}
ModalPopup.ask(_confirm,"PPlaylist.workingOnPlaylist = true; new Ajax.Request('"+url+"', { parameters: PPlaylist.Editor.getParam($$('#sortable-playlist .item-data')), onComplete: function() { window.location = '"+self_playlist_url+"';}});","$$('.working').each(Element.hide);");}else{PPlaylist.workingOnPlaylist=true;new Ajax.Request(url,{parameters:params,onComplete:function(){PPlaylist.workingOnPlaylist=false;if(action=="set_list_cover"){$$(".playlist-actions .working").each(Element.hide);$$(".playlist-actions .success").each(Element.show);setTimeout(function(){$$(".playlist-actions .success").each(Element.hide);},5000);}else{window.location=self_playlist_url;}}});}}else{$$(".playlist-actions .working").each(Element.hide);}},hideEditTitle:function(el){$(el).up('form.title-edit').hide();$(el).up('form.title-edit').previous('.title').show();},changeTitle:function(ev){var form=$(ev);var parms=form.serialize(true);var ta=form.down('input.title-edit');if(ta&&ta.hasClassName("disabled"))parms.title="";form.down('.loading').show();form.down('.playlist-create-error').hide();new Ajax.Request("/playlists/change_title",{parameters:parms,onSuccess:function(transport){var res=transport.responseText.evalJSON();var title=res.title
var special=res.special;if(ta){ta.value=title;}
if(!title.strip().blank()){var prev=form.previous("div.title");var span=prev.down('span');if(span){if(special){span.update('<h3 class="h2-equiv">'+title.escapeHTML()+'</h2>');}else{span.update('<h2 class="cufonable">'+title.escapeHTML()+'</h2>');Behaviors.applyCufon();}
prev.show();form.hide();}}
form.down('.loading').hide();},onFailure:function(transport){var error=transport.responseText.evalJSON();if(error&&error.error){form.down('.playlist-create-error').innerHTML=error.error;form.down('.playlist-create-error').show();}
form.down('.loading').hide();}});},changeDescription:function(ev,is_huluEditor){var form=$(this);var parms=form.serialize(true);var ta=form.down('textarea');if(ta&&ta.hasClassName("disabled"))parms.description="";form.down('.playlist-create-error').hide();new Ajax.Request("/playlists/change_description",{parameters:parms,onSuccess:function(transport){var desc_unescape=transport.responseText;var desc_escape=transport.responseText.escapeHTML();if(ta){ta.innerHTML=desc_escape;PPlaylist.Editor.updateDescription(ta,false);}
if(is_huluEditor){if(!desc_unescape.strip().blank()){var prev=form.previous("div.desc-container");if(prev){var span=prev.down("span");if(span)span.innerHTML=desc_unescape;prev.show();form.hide();}}}
else{if(!desc_escape.strip().blank()){var prev=form.previous("div.desc-container");if(prev){var span=prev.down("span");if(span)span.update(desc_escape);prev.show();form.hide();}}}},onFailure:function(transport){var error=transport.responseText.evalJSON();if(error&&error.error){form.down('.playlist-create-error').innerHTML=error.error;form.down('.playlist-create-error').show();}}});},playlistOrderUpdated:function(){var playlist_positions=$$('#sortable-playlist .position-container input');var i=PPlaylist.firstPlaylistPosition;if(i==1){$$('div#sortable-playlist tr.first').invoke('removeClassName','first');var tr=$$('div#sortable-playlist tr.r').first();if(tr){tr.addClassName('first');}}
playlist_positions.each(function(input){if(/^position_/.test(input.name)){input.value=i;i++;}});Profile.updateOrder();},updateFirstPlaylistPosition:function(){var el=$$('#sortable-playlist input').find(function(input){return/^position_/.test(input.name);});if(el&&el.value>0){PPlaylist.firstPlaylistPosition=el.value;}
if(PPlaylist.firstPlaylistPosition!=1){$$('div#sortable-playlist tr.first').invoke('removeClassName','first');}},firstPlaylistPosition:1,addActionButtonBehavior:function(el){el.select("img.action").each(function(button){button.observe("click",PPlaylist.Editor.performAction.bindAsEventListener(button));});},addCheckboxBehavior:function(el){el.observe("click",function(){Profile.toggleAllCheckboxes($('sortable-playlist'),$(el).checked);});},addBehavior:function(is_huluEditor){$$("textarea.desc-edit").each(function(el){PPlaylist.Editor.updateDescription(el);el.observe("focus",PPlaylist.Editor.updateDescription.curry(el,true));el.observe("blur",PPlaylist.Editor.updateDescription.curry(el,false));});$$("form.title-edit").each(function(form){var ta=form.down("input.title-edit");var prev=form.previous("div.title");if(prev){var a=prev.down("a");if(a){a.observe("click",function(){prev.hide();form.show();});}}});$$("form.desc-edit").each(function(form){var ta=form.down("textarea.desc-edit");var submit=form.down("input.desc-submit");if(ta&&submit){submit.observe("click",PPlaylist.Editor.changeDescription.bindAsEventListener(form,is_huluEditor));}
var prev=form.previous("div.desc-container");if(prev){var a=prev.down("a.desc-edit");if(a){a.observe("click",function(){prev.hide();form.show();});}}});$$(".playlist-actions,.move-to-top").each(PPlaylist.Editor.addActionButtonBehavior);$$(".item-select-all").each(PPlaylist.Editor.addCheckboxBehavior);document.observe("hulu:overlayHidden",function(){$$(".playlist-actions .working").each(Element.hide);});}}};window["PPlaylist"]=Profile.Playlist;
var VideoRating=Class.create();Object.extend(VideoRating,{FULL_WATCH:Base.imageURL('/images/watch/icon-star-general.png'),HOVER_WATCH:Base.imageURL('/images/watch/icon-star-rated.png'),HALF_WATCH:Base.imageURL('/images/watch/icon-star-general.png'),EMPTY_WATCH:Base.imageURL('/images/watch/icon-star-not-selected.png'),CHECK_WATCH:Base.imageURL('/images/watch/icon-check-d.gif'),WORKING_WATCH:'<img '+'src="'+Base.imageURL('/images/watch/activity-indicator-for-3c3c3c-bg.gif')+'"'+'width="16"'+'height="16"'+'border="0"'+'style="vertical-align:middle;" />',FULL:Base.imageURL('/images/rating_full.gif'),HOVER:Base.imageURL('/images/rating_hover.gif'),HALF:Base.imageURL('/images/rating_half.gif'),EMPTY:Base.imageURL('/images/rating_empty.gif'),CHECK:Base.imageURL('/images/icon-check.gif'),WORKING:'<img '+'src="'+Base.imageURL('/images/loading-animated-circle.gif')+'"'+'width="16"'+'height="16"'+'border="0"'+'style="vertical-align:middle;" />',FULL_D:Base.imageURL('/images/rating_d_full.gif'),HOVER_D:Base.imageURL('/images/rating_d_hover.gif'),HALF_D:Base.imageURL('/images/rating_d_half.gif'),EMPTY_D:Base.imageURL('/images/rating_d_empty.gif'),CHECK_D:Base.imageURL('/images/icon-check-d.gif'),WORKING_D:'<img '+'src="'+Base.imageURL('/images/loading-animated-circle-d.gif')+'"'+'width="16"'+'height="16"'+'border="0"'+'style="vertical-align:middle;" />',FULL_SHOWBAR:Base.imageURL('/images/showbar_rating_full.png'),HOVER_SHOWBAR:Base.imageURL('/images/showbar_rating_hover.png'),HALF_SHOWBAR:Base.imageURL('/images/showbar_rating_half.png'),EMPTY_SHOWBAR:Base.imageURL('/images/showbar_rating_empty.png'),CHECK_SHOWBAR:Base.imageURL('/images/icon-check-showbar.gif'),WORKING_SHOWBAR:'<img '+'src="'+Base.imageURL('/images/loading-animated-circle-showbar.gif')+'"'+'width="16"'+'height="22"'+'border="0"'+'style="vertical-align:middle;" />',DESCRIPTIONS:["Hated it","Didn't like it","It was OK","Liked it","Loved it"],INSTANCES:[],reenableAll:function(){$(VideoRating.INSTANCES).each(function(inst){inst.reenable()});},PRELOADED:false,preload:function(){if(VideoRating.PRELOADED)return;$A([VideoRating.FULL_D,VideoRating.HOVER_D,VideoRating.HALF_D,VideoRating.EMPTY_D]).each(function(src){pingImage(src);});$A([VideoRating.FULL_WATCH,VideoRating.HOVER_WATCH,VideoRating.HALF_WATCH,VideoRating.EMPTY_WATCH]).each(function(src){pingImage(src);});$A([VideoRating.FULL,VideoRating.HOVER,VideoRating.HALF,VideoRating.EMPTY]).each(function(src){pingImage(src);});$A([VideoRating.FULL_SHOWBAR,VideoRating.HOVER_SHOWBAR,VideoRating.HALF_SHOWBAR,VideoRating.EMPTY_SHOWBAR]).each(function(src){pingImage(src);});VideoRating.PRELOADED=true;},set_user_vote:function(video_id,rating){$(VideoRating.INSTANCES).each(function(inst){if(inst.video_id==video_id){inst.set_vote(rating);}});}});Object.extend(VideoRating.prototype,{initialize:function(id,video_id,value,defaultStatus,rateable_type,disable_after_rate,allow_reset,blankStatus,callback){this.el=$(id);this.video_id=video_id;this.rateable_type=rateable_type||'video';this.originalValue=value;this.value=value;this.disabled=false;this.USE_DARK=false;this.USE_SHOWBAR=false;this.USE_WATCH=false;this.user_voted=false;this.disable_after_rate=(disable_after_rate==false)?false:true;this.allow_reset=(allow_reset==true)?true:false;this.originalStatus=blankStatus||defaultStatus||'';this.dontShowStatus=defaultStatus==null?true:false;this.callback=callback||'';var status=defaultStatus||'';if(/-showbar$/.test(id)){this.USE_SHOWBAR=true;}
if(this.el.hasClassName("watchpage-rating-star")){this.USE_WATCH=true;}
if(status=='trailer'){this.defaultStatus='';this.USE_DARK=true;}
else if(status=='defaultdesc'){this.defaultStatus='Be the first to rate';}
else if(this.defaultStatus!=status){this.defaultStatus=status;}
this.newline=(arguments.length==4)?false:arguments[4];VideoRating.INSTANCES.push(this);this.init();VideoRating.preload();this.disabled=!(video_id>0);if(READ_ONLY){this.disable();}},init:function(){var str='';if(this.allow_reset)
{str+="<div class='reset'><img class='star reset-button' src='"+Base.imageURL('/images/btn-unrated.gif')+"' /> | </div>";}
var use_dark=this.USE_DARK;var use_showbar=this.USE_SHOWBAR;var use_watch=this.USE_WATCH;$R(1,5).each(function(rating){if(use_dark)
str+='<img src="'+VideoRating.EMPTY_D+'" ';else if(use_showbar)
str+='<img src="'+VideoRating.EMPTY_SHOWBAR+'" ';else if(use_watch){str+='<img src="'+VideoRating.EMPTY_WATCH+'" ';}else
str+='<img src="'+VideoRating.EMPTY+'" ';str+='class="star" ';if(use_watch){str+='width="16" ';str+='height="16" ';}else{str+='width="12" ';str+='height="11" ';}
str+='border="0" />';});if(this.newline==true)
str+='<br/><span></span>';else
str+='<span></span>';this.el.update(str);this.el.getElementsBySelector('img.star').each(function(img){Event.observe(img,"mouseover",this.hover.bindAsEventListener(this));Event.observe(img,"mouseout",this.reset_by_mouseout.bindAsEventListener(this));Event.observe(img,"click",this.submit.bindAsEventListener(this));}.bind(this));this.status=$A(this.el.getElementsBySelector('span')).first();this.status.update(this.defaultStatus);this.reset();},hover:function(ev){if(this.disabled)return;var me=Event.element(ev);var full=true;var use_dark=this.USE_DARK;var use_showbar=this.USE_SHOWBAR;var use_watch=this.USE_WATCH;this.el.getElementsBySelector('img.star').each(function(img,rating){if(img.hasClassName('reset-button'))
{if(img==me)img.src=Base.imageURL("/images/btn-unrated-hover.gif");}
else if(use_dark)
img.src=full?VideoRating.HOVER_D:VideoRating.EMPTY_D;else if(use_showbar)
img.src=full?VideoRating.HOVER_SHOWBAR:VideoRating.EMPTY_SHOWBAR;else if(use_watch)
img.src=full?VideoRating.HOVER_WATCH:VideoRating.EMPTY_WATCH;else
img.src=full?VideoRating.HOVER:VideoRating.EMPTY;if(img==me){if(!this.dontShowStatus)
this.status.update(img.hasClassName('reset-button')?"Reset":VideoRating.DESCRIPTIONS[rating-(this.allow_reset?1:0)]);full=false;}}.bind(this));},reset_by_mouseout:function(){if(this.disabled)return;this.reset();if(this.user_voted)
this.set_vote(this.value);},reset_by_submit:function(){if(this.disabled)return;this.reset();this.set_vote(this.value);this.set_title();var rateable_type=this.rateable_type;var video_id=this.video_id;var val=this.value;var el=this.el;$(VideoRating.INSTANCES).each(function(inst){if(inst.video_id==video_id&&inst.rateable_type==rateable_type&&inst.el!=el){inst.defaultStatus='';inst.enable();inst.set_vote(val);}});},reset:function(){if(this.disabled)return;var val=this.value;var usedark=false;var use_showbar=false;var use_watch=false;if(this.USE_DARK)usedark=true;if(this.USE_SHOWBAR)use_showbar=true;if(this.USE_WATCH)use_watch=true;var allow_reset=this.allow_reset;this.el.getElementsBySelector('img.star').each(function(img,rating){if(!allow_reset)rating++;if(img.hasClassName('reset-button'))
{img.src=Base.imageURL("/images/btn-unrated.gif");return;}
else if(usedark){img.src=rating<=Math.floor(val)?VideoRating.FULL_D:rating==Math.round(val)?VideoRating.HALF_D:VideoRating.EMPTY_D;}
else if(use_showbar){img.src=rating<=Math.floor(val)?VideoRating.FULL_SHOWBAR:rating==Math.round(val)?VideoRating.HALF_SHOWBAR:VideoRating.EMPTY_SHOWBAR;}
else if(use_watch){img.src=rating<=Math.floor(val)?VideoRating.FULL_WATCH:rating==Math.round(val)?VideoRating.HALF_WATCH:VideoRating.EMPTY_WATCH;}
else
{img.src=rating<=Math.floor(val)?VideoRating.FULL:rating==Math.round(val)?VideoRating.HALF:VideoRating.EMPTY;}});this.status.update(this.defaultStatus);},reenable:function(){if(READ_ONLY)return;this.disabled=false;this.value=this.originalValue;this.reset();},submit:function(ev){if(this.disabled)return;var me=Event.element(ev);var val=0;var allow_reset=this.allow_reset;this.el.getElementsBySelector('img.star').each(function(img,rating){val=allow_reset?rating:(rating+1);if(img==me)throw $break;});if(Behaviors.isLoggedIn()){this.newline=$A(this.el.getElementsBySelector('br')).first();if(this.newline)
{this.newline.remove();var notice=$A(this.el.getElementsBySelector('span')).first();notice.setStyle({'margin-left':'8px'});}
if(this.USE_DARK)
this.status.update(VideoRating.WORKING_D);else if(this.USE_SHOWBAR)
this.status.update(VideoRating.WORKING_SHOWBAR);else if(this.USE_WATCH)
this.status.update(VideoRating.WORKING_WATCH);else
this.status.update(VideoRating.WORKING);this.disabled=true;switch(this.rateable_type){case'offsite_video':vote_url='/offsite_videos/vote/'+this.video_id;break;case'show':vote_url='/shows/vote/'+this.video_id;break;case'customcluster':vote_url='/custom_clusters/vote/'+this.video_id
break;case'playlist':vote_url='/playlists/vote/'+this.video_id;break;default:vote_url='/videos/vote/'+this.video_id;}
new Ajax.Request(vote_url,{parameters:{up:val},onSuccess:function(req){this.disabled=false;if(req.responseText.match(/^OK/)){this.value=val;this.reset_by_submit();if(this.USE_DARK)
this.defaultStatus='<img width="16" height="16" title="Your vote has been saved" src="'+VideoRating.CHECK_D+'" style="vertical-align:middle;"/>';else if(this.USE_SHOWBAR)
this.defaultStatus='<img width="16" height="16" title="Your vote has been saved" src="'+VideoRating.CHECK_SHOWBAR+'" style="vertical-align:middle;"/>';else if(this.USE_WATCH)
this.defaultStatus='<img width="16" height="16" title="Your vote has been saved" src="'+VideoRating.CHECK_WATCH+'" style="vertical-align:middle;"/>';else
this.defaultStatus='<img width="16" height="16" title="Your vote has been saved" src="'+VideoRating.CHECK+'" style="vertical-align:middle;"/>';this.status.update(this.defaultStatus);if(!this.callback.blank()){eval(this.callback);}}
else{this.reset_by_submit();if(this.dontShowStatus){if(this.USE_DARK)
this.status.update('<img width="16" height="16" '+'title="Your vote has been saved" '+'src="'+VideoRating.CHECK_D+'" '+'style="vertical-align:middle;"/>');else if(this.USE_SHOWBAR)
this.status.update('<img width="16" height="16" '+'title="Your vote has been saved" '+'src="'+VideoRating.CHECK_SHOWBAR+'" '+'style="vertical-align:middle;"/>');else if(this.USE_WATCH)
this.status.update('<img width="16" height="16" '+'title="Your vote has been saved" '+'src="'+VideoRating.CHECK_WATCH+'" '+'style="vertical-align:middle;"/>');else
this.status.update('<img width="16" height="16" '+'title="Your vote has been saved" '+'src="'+VideoRating.CHECK+'" '+'style="vertical-align:middle;"/>');}
else{this.status.update(req.responseText.match(/can only vote once/)?"You've already voted.":"Error saving vote.");}}}.bind(this),onComplete:null});}
else{FloatingLoginForm.show(this.el);}},disable:function(){this.defaultStatus=(this.value==0)?this.originalStatus:VideoRating.DESCRIPTIONS[this.value-1];if(this.dontShowStatus)this.defaultStatus='';if(this.disable_after_rate==false)return;this.disabled=true;this.el.getElementsBySelector('img.star').each(function(img){img.style.cursor='default';});},enable:function(){this.disabled=false;this.reset();this.el.getElementsBySelector('img.star').each(function(img){img.style.cursor='';});},set_title:function(){var val=this.value;var rateable_type=this.rateable_type;this.el.getElementsBySelector('img.star').each(function(img,rating){var r=(rateable_type=="show"?"show":(rateable_type=="playlist"?"playlist":"video"));img.title="You've rated this "+r+" "+val+(val==1?" star.":" stars.");});},set_vote:function(val){this.value=val;this.user_voted=true;if(this.defaultStatus=='Be the first to rate'){this.defaultStatus='';this.status.update(this.defaultStatus);}
var rating=0;var rateable_type=this.rateable_type;var use_showbar=this.USE_SHOWBAR;var use_dark=this.USE_DARK;var use_watch=this.USE_WATCH;this.el.getElementsBySelector('img.star').each(function(img){var r=(rateable_type=="show"?"show":(rateable_type=="playlist"?"playlist":"video"));img.title="You've rated this "+r+" "+val+(val==1?" star.":" stars.");if(img.hasClassName('reset-button')){img.src=Base.imageURL("/images/btn-unrated.gif");return;}
rating++;if(use_dark){img.src=rating<=val?VideoRating.HOVER_D:VideoRating.EMPTY_D;}
else if(use_showbar){img.src=rating<=val?VideoRating.HOVER_SHOWBAR:VideoRating.EMPTY_SHOWBAR;}
else if(use_watch){img.src=rating<=val?VideoRating.HOVER_WATCH:VideoRating.EMPTY_WATCH;}
else{img.src=rating<=val?VideoRating.HOVER:VideoRating.EMPTY;}});}});
var FloatingDiv={DEFAULT_FARTHEST_RIGHT:920,previousContainer:null,handleclick:true,visible:function(){floatingContainer=$('floating-container');if(!floatingContainer)return false;return floatingContainer.visible();},hide:function(){floatingContainer=$('floating-container');if(!floatingContainer)return;if(FloatingDiv.previousContainer){content=floatingContainer.down('div.content');FloatingDiv.previousContainer.appendChild(content);FloatingDiv.previousContainer=null;}
floatingContainer.hide();Event.stopObserving(document,'click',FloatingDiv.onclick);},onclick:function(ev){if(!FloatingDiv.handleclick){FloatingDiv.handleclick=true;return;}
var el=Event.element(ev);if(!el)return;if(!FloatingDiv.visible())return;floatingContainer=$('floating-container');if(el==floatingContainer||el.up("#floating-container")==floatingContainer){}
else{FloatingDiv.hide();}},toggle:function(fromElement,contentDiv,targetWidth,options){floatingContainer=$('floating-container');if(!floatingContainer)return;if(floatingContainer.style.display!='none'&&FloatingDiv.previousContainer==contentDiv){FloatingDiv.hide();}else{FloatingDiv.show(fromElement,contentDiv,targetWidth,options)}},show:function(fromElement,contentDiv,targetWidth,options){if(arguments.length<4)options={};floatingContainer=$('floating-container');if(!floatingContainer)return;FloatingDiv.hide();if(targetWidth){floatingContainer.style.width=(targetWidth+'px');}
else{floatingContainer.style.width='';}
content=contentDiv.down('div.content');FloatingDiv.previousContainer=contentDiv;floatingContainer.appendChild(content);if(fromElement){var xy=[];var width=floatingContainer.getWidth();var height=floatingContainer.getHeight();if(fromElement==document){if(Prototype.Browser.IE&&$('masthead')){if((document.viewport.getScrollOffsets().top)<300){window.scrollTo(0,300);}}
var dim=document.viewport.getDimensions();xy=document.viewport.getScrollOffsets();var y=(dim.height-height)/2+10;if(y<0)y=10;xy[1]=xy[1]+y;var x=(dim.width-width)/2-6;if(x<0)x=0;xy[0]=xy[0]+x;}else{xy=Position.cumulativeOffset(fromElement);}
var x=xy[0];var rightmost;if(options['from_availability_notes'])rightmost=x+fromElement.getWidth()+6;else rightmost=FloatingDiv.getFarthestRight();if(width>0&&(x+width)>rightmost)
x=rightmost-width-15;floatingContainer.style.left=x+'px';if(options['from_availability_notes'])
floatingContainer.style.top=(xy[1]+25)+'px';else if(options['center-top'])
floatingContainer.style.top=(xy[1]-(height/2))+'px';else
floatingContainer.style.top=(xy[1]+20)+'px';}
floatingContainer.show();FloatingDiv.handleclick=false;Event.observe(document,'click',FloatingDiv.onclick);},getFarthestRight:function(){var body=$$('body')[0];if(!body)return this.DEFAULT_FARTHEST_RIGHT;var xy=Position.cumulativeOffset(body);return xy[0]+body.getWidth();}};
var FloatingWindow={cache:{},className:'',init:function(){var body=$$('body').first();if(body)
{Element.observe(body,'click',FloatingWindow.clickToClose);}},clickToClose:function(ev){var x=Event.pointerX(ev);var y=Event.pointerY(ev);var mainContainer=$('floating-window-container').down('div.main-container');if(Position.within(mainContainer.down('div.title-container'),x,y)||Position.within(mainContainer.down('div.division_line'),x,y)||Position.within(mainContainer.down('div.floating-window-content'),x,y))
return;FloatingWindow.close();},show:function(url,className,allowCache){var cache=FloatingWindow.cache;var obj=null;if(allowCache&&cache[url]){obj=cache[url];}
else{new Ajax.Request(url,{method:'get',onSuccess:function(trans){obj=trans.responseText;FloatingWindow.cache[url]=obj;}});}
FloatingWindow.className='type_'+className;$("floating-window-container").addClassName(FloatingWindow.className);FloatingWindow.className=className;if(obj)eval(obj);},close:function(){$("floating-window-container").hide();$("floating-window-container").removeClassName(FloatingWindow.className);},placeWindow:function(targetElement,position){position=position||'center';if(position=='center')
{var scrollOffsets=document.viewport.getScrollOffsets();var windowSize=$("floating-window-container").getDimensions();$("floating-window-container").setStyle({top:(scrollOffsets.top+document.viewport.getHeight()/2-windowSize.height/2)+'px'});}
else if(position=='afterElement')
{var offset=Element.cumulativeOffset(targetElement);$("floating-window-container").setStyle({top:(offset.top+targetElement.getHeight())+'px'});}}};
var FloatingLoginForm={DEFAULT_FARTHEST_RIGHT:920,topFixIE:false,_onDismiss:function(event){var rb=$$('.tflf').first();var el=event.findElement();if(el==rb||el.ancestors().indexOf(rb)>=0)return;FloatingLoginForm.hide();},hide:function(){Event.stopObserving(document,'mousedown',FloatingLoginForm._onDismiss);if(FloatingLoginForm.topFixIE){var iframe_id="tflf_iframe";if($(iframe_id)){$(iframe_id).hide();$(iframe_id).setStyle({zIndex:-10});}
FloatingLoginForm.topFixIE=false;}
$$('.flf').each(Element.hide);FloatingLoginForm.unhandleTab();FloatingLoginForm.hideBackground();},show:function(el,from_lightbox){if(arguments.length<2)from_lightbox=false;var flf=$$('.flf:not(.tflf)').first();if(flf){if(from_lightbox)
Login.setInLightbox(true);else
Login.setInLightbox(false);Login.cancel();var form=flf.down('div.login-form');if(form){form.show();Login.target_form=form;}
if(el){var xy=Position.cumulativeOffset(el);var off=document.viewport.getScrollOffsets();var x=xy[0];var width=flf.getWidth();var rightmost=FloatingLoginForm.getFarthestRight();if(width>0&&(x+width)>rightmost)
x=rightmost-width-10;flf.style.left=(off.left+x).toString()+'px';var height=flf.getHeight();var flfTop=0;if((xy[1]-height/2)>0)
flfTop=(xy[1]-height/2);var playerDiv=$('breakout-container');if(playerDiv&&playerDiv.down("#player-container")){playerDiv=playerDiv.down("#player-container");}
if(playerDiv){var minTop=playerDiv.cumulativeOffset().top+playerDiv.getHeight()+20;if(flfTop<minTop)flfTop=minTop;}
flf.style.top=flfTop+'px';Login.setActionElement(el);}
else{var offset=document.viewport.getScrollOffsets();var flfTop=offset.top+((document.viewport.getHeight()-flf.getHeight())/2);var flfLeft=offset.left+((document.viewport.getWidth()-flf.getWidth())/2);var playerDiv=$('breakout-container');if(playerDiv){var minTop=playerDiv.cumulativeOffset().top+playerDiv.getHeight()+20;if(flfTop<minTop)flfTop=minTop;}
flf.style.top=flfTop+"px";flf.style.left=flfLeft+"px";}
flf.show();FloatingLoginForm.handleTab();_gaq.push(['_trackEvent','fbconnect','loginmodal','prompt']);Try.these(function(){form.down('.login-status-img').hide();form.down('.login-status').update('');form.down('.login-status').hide();form.down('.login').activate();});}},showCenter:function(form_class){if(form_class!='.tflf'&&form_class!='.flf')return;FloatingLoginForm.showBackground();var fform=$$(form_class).first();if(fform){var form=fform.down('div.login-form');if(form){form.show();Login.target_form=form;}
var vpi=getViewportInfo();var ww=vpi.width;var wh=vpi.height;var fw=fform.getWidth();var fh=fform.getHeight();fform.style.top=((wh-fh)/2)+"px";fform.style.left=((ww-fw)/2)+"px";var iframe_id="tflf_iframe";var iframe=$(iframe_id);if(!FloatingLoginForm.topFixIE){new Insertion.After(fform,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:2000;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');FloatingLoginForm.topFixIE=true;iframe=$(iframe_id);}
var left=fform.getStyle('left');var top=fform.getStyle('top');var height=fform.getDimensions().height+2+'px';var width=fform.getDimensions().width+2+'px';iframe.setStyle({left:left,top:top,height:height,width:width});fform.setStyle({zIndex:2001});fform.setStyle({position:'fixed'});iframe.show();fform.show();Event.observe(document,'mousedown',FloatingLoginForm._onDismiss);_gaq.push(['_trackEvent','fbconnect','loginmodal','prompt']);}
Try.these(function(){form.down('.login-status-img').hide();form.down('.login-status').update('');form.down('.login-status').hide();form.down('.login').activate();});},showTop:function(el,email){var tflf=$$('.tflf').first();if(tflf){Login.cancel(false);var form=tflf.down('div.login-form');if(form){var login=form.down('input.active.login');if(email&&login){login.value=email;var inactive_login=form.down('input.inactive.login');if(inactive_login){inactive_login.simulate('click');}}
form.show();Login.target_form=form;}
if(el){var xy=Position.cumulativeOffset(el);var off=document.viewport.getScrollOffsets();var x=xy[0];var width=tflf.getWidth();var rightmost=FloatingLoginForm.getFarthestRight();if(width>0&&(x+width)>rightmost)
x=rightmost-width-10;else
x=x-50;tflf.style.left=(off.left+x).toString()+'px';var height=tflf.getHeight();if((xy[1]-height/2)>0)
tflf.style.top=(xy[1]-height/2)+'px';else
tflf.style.top='0px';var iframe_id="tflf_iframe";var iframe=$(iframe_id);if(!FloatingLoginForm.topFixIE){new Insertion.After(tflf,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:2000;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');FloatingLoginForm.topFixIE=true;}
tflf.setStyle({zIndex:2001});IframeHacker.hideWhenScroll(FloatingLoginForm.hide,FloatingLoginForm);}
tflf.show();FloatingLoginForm.handleTab();_gaq.push(['_trackEvent','fbconnect','loginmodal','prompt']);Try.these(function(){form.down('.login-status-img').hide();form.down('.login-status').update('');form.down('.login-status').hide();form.down('.login').activate();if(email){form.down('.active.password').focus();}});FloatingLoginForm.updateIFrame();}},updateIFrame:function(){var iframe=$("tflf_iframe");var tflf=$$('.tflf').first();if(!iframe||!tflf)return;var left=tflf.getStyle('left');var top=tflf.getStyle('top');var height=tflf.getDimensions().height+2+'px';var width=tflf.getDimensions().width+2+'px';iframe.setStyle({left:left,top:top,height:height,width:width});iframe.show();},bfx:null,handleTab:function(){FloatingLoginForm.bfx=FloatingLoginForm.handleTabEx.bindAsEventListener(FloatingLoginForm);Event.observe(window,'keydown',FloatingLoginForm.bfx);},handleTabEx:function(ev){if(9==ev.keyCode){el=$$('.flf').first().down('div.login-form').down('input.inactive,login');if(el)el.focus();}},unhandleTab:function(){if(FloatingLoginForm.bfx)Event.stopObserving(window,'keydown',FloatingLoginForm.bfx);FloatingLoginForm.bfx=null;},getFarthestRight:function(){var body=$$('body')[0];if(!body)return this.DEFAULT_FARTHEST_RIGHT;var xy=Position.cumulativeOffset(body);return xy[0]+body.getWidth();},showBackground:function(){var canvas=$('header-bg-canvas');if(!canvas)return;var w=1600;var h=1200;var body=$$('body');if(body.length>0){w=body[0].getWidth();h=body[0].getHeight();}
w=Math.max(Math.max(w,document.viewport.getWidth()),920);h=Math.max(h,document.viewport.getHeight());canvas.setStyle({backgroundColor:'#000000',width:w+"px",height:h+"px",opacity:0.6,filter:"alpha(opacity=60)",position:"absolute",zIndex:999,top:0,left:0});if(Prototype.Browser.IE){$A(["masthead","player"]).each(function(s){var el=$(s);if(el)el.style.visibility="hidden";});}},hideBackground:function(){var canvas=$('header-bg-canvas');if(!canvas)return;canvas.setStyle({backgroundColor:'#000000',width:"0px",height:"0px",opacity:1,filter:"alpha(opacity=100)",position:"absolute",zIndex:-10});if(Prototype.Browser.IE){$A(["masthead","player"]).each(function(s){var el=$(s);if(el)el.style.visibility="visible";});}}};
var FloatingSignUpForm={topFixIE:false,_onDismiss:function(event){var rb=$$('.fsf').first();var el=event.findElement();if(el==rb||el.ancestors().indexOf(rb)>=0)return;FloatingSignUpForm.cancel();},cancel:function(){Event.stopObserving(document,'mousedown',FloatingSignUpForm._onDismiss);if(FloatingSignUpForm.topFixIE){var iframe_id="fsf_iframe";if($(iframe_id)){$(iframe_id).hide();$(iframe_id).setStyle({zIndex:-10});}
FloatingSignUpForm.topFixIE=false;}
$$('.fsf').each(Element.hide);FloatingSignUpForm.hideBackground();},showCenter:function(){FloatingLoginForm.showBackground();var fform=$$('.fsf').first();if(fform){var form=fform.down('div.login-form');if(form){form.show();Login.target_form=form;}
var vpi=getViewportInfo();var ww=vpi.width;var wh=vpi.height;var fw=fform.getWidth();var fh=fform.getHeight();fform.style.top=(Math.max((wh-fh)/2,0))+"px";fform.style.left=(Math.max((ww-fw)/2,0))+"px";var iframe_id="fsf_iframe";var iframe=$(iframe_id);if(!FloatingSignUpForm.topFixIE){new Insertion.After(fform,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:1000;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');FloatingSignUpForm.topFixIE=true;iframe=$(iframe_id);}
var left=fform.getStyle('left');var top=fform.getStyle('top');var height=fform.getDimensions().height+2+'px';var width=fform.getDimensions().width+2+'px';iframe.setStyle({left:left,top:top,height:height,width:width});fform.setStyle({zIndex:1001});fform.setStyle({position:'fixed'});iframe.show();fform.show();Event.observe(document,'mousedown',FloatingSignUpForm._onDismiss);_gaq.push(['_trackEvent','fbconnect','signupmodal','prompt']);}},showBackground:function(){var canvas=$('header-bg-canvas');if(!canvas)return;var w="1600px";var h=1200;var body=$$('body');if(body.length>0){w="100%";h=body[0].getHeight();}
canvas.setStyle({backgroundColor:'#000000',width:w,height:String(h)+"px",opacity:0.6,position:'absolute',zIndex:999,top:0,left:0});if(Prototype.Browser.IE){$A(["masthead","player"]).each(function(s){var el=$(s);if(el)el.style.visibility="hidden";});}},hideBackground:function(){var canvas=$('header-bg-canvas');if(!canvas)return;canvas.setStyle({backgroundColor:'#000000',width:"0px",height:"0px",opacity:1,position:'absolute',zIndex:-10});if(Prototype.Browser.IE){$A(["masthead","player"]).each(function(s){var el=$(s);if(el)el.style.visibility="visible";});}}};
var Subscription={WORKING_TAG:Profile.WORKING_TAG,SUCCESS_SRC:Base.imageURL('/images/icon-check.gif'),LINK_CLASS:'.small-subscription',SHOWBAR_LINK_CLASS:'.showbar-subscription',show_ids:[],subscribed:null,callback:null,toggle_popup:function(el,show_name,show_url,show_id,has_episodes,callback){var ss_popup=$('subscription-popup');Subscription.callback=callback;if(ss_popup){if(Behaviors.isLoggedIn()){new Ajax.Request("/social/subscription_status",{parameters:{show_id:show_id,user_id:Behaviors.getUserId()},method:'get',onSuccess:function(transport){var sub=transport.responseJSON[show_id];var notify_queue=transport.responseJSON["notify_queue"];if(notify_queue)
$('ss-not-notify-queue').hide();else
$('ss-not-notify-queue').show();if(show_name=="Movie Trailers"){if(sub!=undefined){if(sub.trailers!="none"){$('ss-trailers-only').addClassName('pressed');$('ss-trailers-clips').removeClassName('pressed');}else{$('ss-trailers-only').removeClassName('pressed');$('ss-trailers-clips').addClassName('pressed');}}}
else{$('ss-episodes').removeClassName('checked');$('ss-clips').removeClassName('checked');$('ss-episodes-all').removeClassName('pressed');$('ss-episodes-first').removeClassName('pressed');if(sub!=undefined){if(sub.episodes!='none'||sub.clips!='none'){if(sub.episodes!="none"){$('ss-episodes').addClassName('checked');if(sub.episodes=="all"){$('ss-episodes-all').addClassName('pressed');$('ss-episodes-first').removeClassName('pressed');}
else{$('ss-episodes-all').removeClassName('pressed');$('ss-episodes-first').addClassName('pressed');}}
else{$('ss-episodes').removeClassName('checked');$('ss-episodes-all').removeClassName('pressed');$('ss-episodes-first').removeClassName('pressed');}
if(sub.clips=="all"){$('ss-clips').addClassName('checked');}
else{$('ss-clips').removeClassName('checked');}}}}},onComplete:function(){Subscription.show_popup(el,show_name,show_url,show_id,has_episodes);}});}else{FloatingLoginForm.show(el);}}
return false;},show_popup:function(el,show_name,show_url,show_id,has_episodes){var ss_popup=$('subscription-popup');$('ss-done').hide();var has_trailers=false;if(show_name=="Movie Trailers"){$('ss-has-clips').innerHTML="trailers";has_episodes=false;has_trailers=true;}else{$('ss-has-clips').innerHTML="clips";$('ss-clips').innerHTML="Clips";}
if(!has_episodes){$('ss-has-episodes').hide();$('ss-episodes').hide();$('ss-episodes-all').hide();$('ss-episodes-first').hide();$('ss-trailers-clips').hide();$('ss-trailers-only').hide();$$('.ss-options')[0].style.height="19px";if(has_trailers){$('ss-clips').hide();$('ss-trailers-clips').show();$('ss-trailers-only').show();}}else{$('ss-trailers-clips').hide();$('ss-trailers-only').hide();$('ss-has-episodes').show();$('ss-episodes').show();$('ss-clips').show();$('ss-show').hide();$('ss-episodes-all').show();$('ss-episodes-first').show();$$('.ss-options')[0].style.height="66px";}
var old_show_id=$('ss-show').value;$('ss-show-name').innerHTML='<a href="/'+show_url+'">'+show_name+'</a> ';$('ss-show').value=show_id;if(old_show_id==show_id){ss_popup.toggle();}
else{ss_popup.hide();var on_recommendation_hub=/^\/recommendation/.test(window.location.pathname);var link_coords=Element.cumulativeOffset(el);var calculated_left=link_coords.left+el.offsetWidth;calculated_left-=310;if(calculated_left<10)calculated_left=10;ss_popup.style.left=calculated_left+"px";if(/^.watch/.test(window.location.pathname)||/^.search/.test(window.location.pathname)||on_recommendation_hub)
{ss_popup.style.top=(link_coords.top+el.offsetHeight+5)+"px";}
else if(/^.profiles/.test(window.location.pathname)){ss_popup.style.top=(link_coords.top+el.offsetHeight-ss_popup.getHeight()/2)+"px";ss_popup.style.left=(calculated_left-130)+"px";}
else{ss_popup.style.top=(link_coords.top-el.offsetHeight-ss_popup.getHeight()-5)+"px";}
ss_popup.show();}},hide_popup:function(){var ss_popup=$('subscription-popup');if(ss_popup)ss_popup.hide();return false;},render_link:function(el,state){if(state=='favorite'){el.removeClassName('favorited');if(el.innerHTML=='&nbsp; mark as favorite'||el.innerHTML=='favorited'){el.innerHTML='&nbsp; mark as favorite';}else{el.innerHTML='add to favorites'}}else{el.addClassName('favorited');if(el.innerHTML=='&nbsp; mark as favorite'||el.innerHTML=='favorited'){el.innerHTML="favorited";}else if(el.down('img')){el.down('img').src="/images/icon-check-F5F5F5.gif";}else{el.innerHTML="added to your favorites"}}},setup_links:function(){var target_classes=Subscription.LINK_CLASS+','+Subscription.SHOWBAR_LINK_CLASS;if($$(target_classes).length==0||!Behaviors.isLoggedIn())
return;this.show_ids=$$(target_classes).map(function(el){return el.readAttribute('data-show-id');}).compact();if(this.show_ids.length==0)return;new Ajax.Request("/social/subscription_status",{parameters:{show_id:this.show_ids.join(','),user_id:Behaviors.getUserId()},method:'get',onSuccess:function(transport){var subscriptions=transport.responseJSON;$H(subscriptions).each(function(sub){$$("a[data-show-id='"+sub.key+"']").each(function(e){Subscription.render_link(e,sub.value.favorited?'favorited':'favorite');});});}});},click_to_hide:function(ev){var x=Event.pointerX(ev);var y=Event.pointerY(ev);var el=Event.element(ev);if(el.hasClassName('small-subscription')||el.up('.small-subscription')||Position.within($('subscription-popup'),x,y))
{return;}
Subscription.hide_popup();},toggle_input:function(name){var el=$(name);if(!el)return false;if(el.hasClassName('checked')){el.removeClassName('checked');if(name=='ss-episodes'){$('ss-episodes-all').removeClassName('pressed');$('ss-episodes-first').removeClassName('pressed');}}
else if(el.hasClassName('checkbox')&&!el.hasClassName('checked')){el.addClassName('checked');if(name=='ss-episodes'){$('ss-episodes-all').addClassName('pressed');}}
else if(el.hasClassName('radio')&&!el.hasClassName('pressed')){if(!$('ss-episodes').hasClassName('checked'))
$('ss-episodes').addClassName('checked');if(name=="ss-episodes-all"){$('ss-episodes-all').addClassName('pressed');$('ss-episodes-first').removeClassName('pressed');}
else if(name=="ss-trailers-only"||name=="ss-trailers-clips"){$('ss-episodes').removeClassName('checked');$('ss-clips').removeClassName('checked');$('ss-trailers-only').toggleClassName('pressed');$('ss-trailers-clips').toggleClassName('pressed');}
else{$('ss-episodes-all').removeClassName('pressed');$('ss-episodes-first').addClassName('pressed');}}
return false;},working:function(el){if(this.alreadyWorking(el))return;var img=$(el).down('img');img.hide();new Insertion.After(img,this.WORKING_TAG)},alreadyWorking:function(el){return!$(el).down('img.working');},stopWorking:function(el){if(!this.alreadyWorking(el))return;var img=$(el).down('img');img.show();var working=$(el).down('img.working');if(working&&working.parentNode)working.parentNode.removeChild(working);},submit_with_episodes_only:function(el,show_id){if(Behaviors.isLoggedIn()?true:(FloatingLoginForm.showCenter('.tflf'),false)){var url='/shows/subscribe/'+show_id+'?type=episodes&first_run_only=1';el.addClassName('loading');if(!el.hasClassName('showbar-subscription'))
el.removeClassName('favorited');new Ajax.Request(url,{asynchronous:true,evalScripts:true,onFailure:function(request){$$("a[data-show-id='"+show_id+"']").each(function(e){Subscription.render_link(e,'favorite');});},onSuccess:function(request){$$("a[data-show-id='"+show_id+"']").each(function(e){Subscription.render_link(e,'favorited');});},onComplete:function(){el.removeClassName('loading');}});}
return false;},submit_options:function(el){if($('ss-loading').style.display=="none"&&Behaviors.isLoggedIn()?true:(FloatingLoginForm.show(this),false)){var url='/shows/subscribe/',show_id=$('ss-show').value;url+=show_id+'?';var types='';if($('ss-trailers-clips').visible()){types=[($('ss-trailers-clips').hasClassName('pressed')?'clips':''),($('ss-trailers-only').hasClassName('pressed')?'trailers':'')].without('').join(',');}else{types=[($('ss-episodes').hasClassName('checked')?'episodes':''),($('ss-clips').hasClassName('checked')?'clips':'')].without('').join(',');}
if(types!=''&&types!=','){url+="type="+types;if($('ss-episodes').hasClassName('checked'))
url+="&first_run_only="+($('ss-episodes-first').hasClassName('pressed')?'1':'0');}
$('ss-loading').show();$('ss-done').hide();new Ajax.Request(url,{asynchronous:true,evalScripts:true,onComplete:function(request){$('ss-loading').hide();},onSuccess:function(request){$('ss-done').show();$$("a[data-show-id='"+show_id+"']").each(function(e){Subscription.render_link(e,'favorited');});Subscription.hide_popup();if(typeof(Subscription.callback)=='function'){Subscription.callback();}}});}
return false;},success:function(el){if(!this.alreadyWorking(el))return;var img=$(el).down('img');if(img){img.src=this.SUCCESS_SRC;img.onmouseover=function(){};img.onmouseout=function(){};}
if(Subscription.subscribed==null){Subscription.subscribed=true;}}};var SubscriptionCheckbox=Object.extend(Object.clone(Subscription),{isWorking:function(el){var box=el.up('div.subscription-box');var check=box.down('a.checkbox');var radio=box.down('a.radio');return(check&&check.hasClassName('working'))||(radio&&radio.hasClassName('working'))},working:function(el){var box=el.up('div.subscription-box');var check=box.down('a.checkbox');var radio=box.down('a.radio');if(check)
check.addClassName('working');else if(radio){radio.addClassName('working');}},stopWorking:function(el){var box=el.up('div.subscription-box');var check=box.down('a.checkbox');var radio=box.down('a.radio');if(check)
check.removeClassName('working');else if(radio){radio.removeClassName('working');}},checked:function(el){return el.hasClassName('checked')||el.hasClassName('pressed');},isRadio:function(el){return el.hasClassName('radio');},check:function(el,url){SubscriptionCheckbox.working(el);new Ajax.Request(SubscriptionCheckbox.requestUrl(el,url),{onSuccess:function(){SubscriptionCheckbox.success(el);},onComplete:function(){SubscriptionCheckbox.stopWorking(el);}})},setState:function(el,checked){var box=el.up('div.subscription-box');if(!box)return;if(this.isRadio(el)){if(box.down('.checkbox'))
box.down('.checkbox').addClassName('checked');else{var boxes=box.adjacent('div.subscription-box');boxes.each(function(ell){ell.down('.radio').removeClassName('pressed');});}}
var fro=box.getElementsBySelector('a.radio');if(fro&&fro.length>0){fro.each(function(radio){radio.removeClassName('pressed');});}
fro=box.getElementsBySelector('a.radio');if(checked&&el&&!this.isRadio(el)&&fro&&fro.length>0){fro.each(function(radio){if(radio.innerHTML=="all")
radio.addClassName('pressed');});}
var klass=(this.isRadio(el)?'pressed':'checked');(checked?el.addClassName(klass):el.removeClassName(klass));},requestUrl:function(el,subscribe){return this.checked(el)&&!this.isRadio(el)?subscribe.replace('/subscribe','/unsubscribe'):subscribe;},success:function(el){if(!this.alreadyWorking(el))return;var selected=!this.checked(el);if(el&&this.isRadio(el)){selected=true;}
this.setState(el,selected);}});Event.observe(window,"load",function(){Subscription.setup_links();if($('ss-show'))$('ss-show').value=0;});
var UserHistory={CAPACITY:20,CAPACITY_100:100,NOT_READY_DELAY:8000,add:function(cookieName,properName,contentId){var history=[];if(cram&&cram.valid()){history=cram.get(properName)||[];}
if($A(history).indexOf(contentId)>=0)return;history.unshift(contentId);var cramIt=function(){if(cram&&cram.valid()){history=cram.get(properName)||[];if($A(history).indexOf(contentId)>=0)return;history.unshift(contentId);var capacity=(cookieName=='_hulu_uh')?UserHistory.CAPACITY_100:UserHistory.CAPACITY;cram.set(properName,history.slice(0,capacity));}};if(cram&&cram.valid()){cramIt();}
else{setTimeout(cramIt,UserHistory.NOT_READY_DELAY);}},get:function(cookieName,properName){if(cram)return $A(cram.get(properName)).join('_');return null;},add_history:function(contentId){this.add('_hulu_uh','userHistory',contentId);},add_watched_history:function(contentId){this.add('_hulu_uwh','userWatchedHistory',contentId);},get_history:function(){return this.get('_hulu_uh','userHistory');},get_watched_history:function(){return this.get('_hulu_uwh','userWatchedHistory');},clearHistory:function(){if(cram){cram.remove('userHistory');cram.remove('userWatchedHistory');}}};
var Forum=Class.create();Object.extend(Forum,{default_text:'Enter keywords',clickSearchTerm:function(el,ev){if(ev.type=='click'&&el.value==Forum.default_text){el.value="";el.removeClassName('dormant');}
else if(ev.type=='blur'&&el.value==""){el.value=Forum.default_text;el.addClassName('dormant');}},toggleAdvancedPane:function(){$('f-search-advanced-pane').toggle();if($('f-search-advanced-pane').style.display=='none'){$('f-search-advanced-toggle').src=Base.imageURL('/images/button-collapse-hover.gif');$('forum_search_advanced').value=0;Forum.resetAdvancedOptions();}
else{$('f-search-advanced-toggle').src=Base.imageURL('/images/button-expand-hover.gif');$('forum_search_advanced').value=1;}},resetAdvancedOptions:function(){document.forum_search_form.search_type[0].selected="1";document.forum_search_form.search_recent_filter[1].selected="1";document.forum_search_form.search_posts_count.value=1;document.forum_search_form.search_special_posts[0].checked=false;}});
var Topic=Class.create();Object.extend(Topic,{singleSubmitLock:false,viewedTopics:new Array(),clearTopicForm:function(){$('t-form-subject').value='';$('t-form-body').value='';if($('topic_has_spoilers'))$('topic_has_spoilers').checked=false;Topic.singleSubmitLock=false;Element.update('t-form-errors','');if($('t-form-instance'))$('t-form-instance').hide();if($('t-error-container'))$('t-error-container').hide();},openTopicForm:function(el){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
Topic.doOpenTopicForm(el);}});return false;}
else{Topic.doOpenTopicForm(el);return false;}},doOpenTopicForm:function(el){if($('t-form-instance').style.display=='none'){new Ajax.Request("/users/permission_check",{asynchronous:true,method:"get",onComplete:function(request){info=request.responseText.evalJSON();if(info.permitted){$('t-form-subject').value='';$('t-form-body').value='';if($('topic_has_spoilers'))
$('topic_has_spoilers').checked=false;$('t-form-instance').show();$('t-form-subject').focus();}
else
Behaviors.showSubmitPermission("post");}});}},showSpoilers:function(){ssLength=document.styleSheets.length;activeSheet=document.styleSheets[ssLength-1];if(Prototype.Browser.IE){activeSheet.addRule(".p-item-s-spoiled .p-item-spoiled","display: none;");activeSheet.addRule(".p-item-s-spoiled .p-item-body","display: block;");activeSheet.addRule(".p-item-s-spoiled .p-replies-collapsed","display: block;");activeSheet.addRule(".p-item-s-spoiled .p-replies","display: block;");activeSheet.addRule(".p-item-s-spoiled .p-replies-preload","display: block;");activeSheet.addRule(".p-item-s-spoiled .p-content-flag","display: block;");activeSheet.addRule(".p-item-s-flagged .p-item-body","display: none;");activeSheet.addRule(".p-item-s-flagged .p-replies-collapsed","display: none;");activeSheet.addRule(".p-item-s-flagged .p-replies","display: none;");activeSheet.addRule(".p-item-s-flagged .p-replies-preload","display: none;");activeSheet.addRule(".t-preview .synopsis .text.spoiled","display: block;");activeSheet.addRule(".t-preview-item .text.spoiled","display: block;");activeSheet.addRule(".t-preview .synopsis .spoiler","display: none;");activeSheet.addRule(".t-preview-item .spoiler","display: none;");}
else
{activeSheet.insertRule(".p-item-s-spoiled .p-item-spoiled {display: none;}",activeSheet.cssRules.length);activeSheet.insertRule(".p-item-s-spoiled .p-item-body, .p-item-s-spoiled .p-replies-collapsed, .p-item-s-spoiled .p-replies, .p-item-s-spoiled .p-replies-preload {display: block;}",activeSheet.cssRules.length);activeSheet.insertRule(".p-item-s-flagged .p-item-body, .p-item-s-flagged .p-replies-collapsed, .p-item-s-flagged .p-replies, .p-item-s-flagged .p-replies-preload, .p-item-s-flagged .p-content-extras {display: none;}",activeSheet.cssRules.length);activeSheet.insertRule(".t-preview .synopsis .spoiler, .t-preview-item .spoiler {display: none;}",activeSheet.cssRules.length);activeSheet.insertRule(".t-preview .synopsis .text.spoiled, .t-preview-item .text.spoiled {display: block;}",activeSheet.cssRules.length);}},toggleTopic:function(topic_id,post_id,hideable,alwaysLoad){var posts_section_id='t-'+topic_id+'-p-0-posts';if(alwaysLoad||$(posts_section_id).hasClassName('p-preload')){$('t-'+topic_id+'-flags-loading').style.display='';params={};params['topic_id']=topic_id+'';params['post_id']=post_id+'';params['parent_id']='0';params['depth']='0';params['hideable']=hideable;new Ajax.Updater('t-'+topic_id+'-p-0-posts','/posts/list',{asynchronous:true,evalScripts:true,method:'get',parameters:params,onComplete:function(){$('t-'+topic_id+'-flags-loading').style.display='none';$('t-'+topic_id+'-button-expand').src=Base.imageURL('/images/button-forums-expand.gif');$('t-'+topic_id+'-button-expand').width=13;$('t-'+topic_id+'-button-expand').height=13;if(post_id>0){if($('p-'+post_id+'-body')){}}
else{}
$('t-'+topic_id+'-section').addClassName('expanded');$(posts_section_id).className='p-load-show';if(Prototype.Browser.IE6)
setTimeout("$('"+'t-'+topic_id+'-p-0-posts'+"').addClassName('ie6');",10);}});if(typeof(Topic.viewedTopics[topic_id])=='undefined'){new Ajax.Request('/topics/view/'+topic_id);Topic.viewedTopics[topic_id]=1;$('t-'+topic_id+'-view_count').visualEffect('appear',{duration:1.0,from:0.0,to:1.0});setTimeout("$('"+'t-'+topic_id+'-view_count'+"').style.opacity = 1;",1100);$('t-'+topic_id+'-view_count').innerHTML=parseInt($('t-'+topic_id+'-view_count').innerHTML)+1;}}
else if($(posts_section_id).hasClassName('p-load-show')){$(posts_section_id).className='p-load-hide';$('t-'+topic_id+'-button-expand').src=Base.imageURL('/images/button-forums-collapse-hover.gif');$('t-'+topic_id+'-section').removeClassName('expanded');}
else{$(posts_section_id).className='p-load-show';$('t-'+topic_id+'-button-expand').src=Base.imageURL('/images/button-forums-expand-hover.gif');$('t-'+topic_id+'-section').addClassName('expanded');}},sortTopics:function(css_id,topicable_type,topicable_id,sort_by,segregate_video,search_terms,updatepage)
{params={};params['topicable_type']=topicable_type;params['topicable_id']=topicable_id;params['sort']=sort_by;params['page']=1;params['segregate_video']=segregate_video;params['search_terms']=search_terms;var up=(typeof(updatepage)=="undefined")?false:updatepage;params['updatepage']=up;target=$('t-header-'+sort_by);if(target.hasClassName('selected')){if(target.hasClassName('inverted')){params['order']='DESC';}
else{params['order']='ASC';}}
else{params['order']='DESC';if(sort_by=='subject'){params['order']='ASC';}}
new Ajax.Updater(css_id,'/topics/update_page',{asynchronous:true,evalScripts:true,method:'get',parameters:params,onSuccess:function(resp){Topic.getUserType();}});},default_search_text:'Search within these discussions',clickSearchTerm:function(el,ev){if(ev.type=='click'&&el.value==Topic.default_search_text){el.value="";$(el).removeClassName('dormant');}
else if(ev.type=='blur'&&el.value==""){el.value=Topic.default_search_text;$(el).addClassName('dormant');}},toggleSegregateOption:function(css_id,topicable_id,topicable_type,sort,order){new Ajax.Updater(css_id,'/topics/update_page?'+'topicable_id='+topicable_id+'&topicable_type='+topicable_type+'&sort='+sort+'&order='+order+'&segregate_video='+document.t_videos_option.segregate.value,{asynchronous:true,evalScripts:true,method:'get'});return false;},hoverSticky:function(ev){var h=$('t-sticky-hover');if(ev.type=='mouseover'){var el=Event.element(ev);if(h&&el){var x=el.positionedOffset()[0];var y=el.positionedOffset()[1]+20;h.setStyle({top:y+"px",left:x+"px"});h.show();}}
else{h.hide();}},hoverSubscribe:function(ev){var h=$('t-subscribe-hover');if(ev.type=='mouseover'){var el=Event.element(ev);if(h&&el){var x=el.positionedOffset()[0];var y=el.positionedOffset()[1]+16;h.setStyle({top:y+"px",left:x+"px"});h.show();}}
else{h.hide();}},activateHovers:function(){$$('ul.t-preview div.title a').each(function(el){Element.observe(el,'mouseover',Topic.showPreviewSynopsis);});var ul=$$('ul.t-preview').first();if(ul){ul=ul.up('div.fixed-lg');var body=$$('body').first();if(body&&ul){Topic.previewBounds=InfoHover.getBounds(ul);Topic.previewBounds.top-=300;Topic.previewBounds.height+=300;Element.observe(body,'mouseout',Topic.hidePreviewSynopsis);}}},getCookieSubscribe:function(){return(Behaviors.getCookie("_hulu_subscribe_topic")=="true");},currentTimeout:null,showPreviewSynopsis:function(ev){var target=Event.element(ev);var hover=target.up('div.t-preview-item');if(hover){hover=hover.next('div');}
if(!hover||!target)return;var dim=hover.getDimensions();var bounds=InfoHover.getBounds(target);var viewport=Element.viewportOffset(target);viewport.left-=600;var loc=InfoHover.determineTailLocation(dim,bounds,viewport);var off=Position.cumulativeOffset(Element.getOffsetParent(hover));loc.y-=off[1];loc.x-=off[0];hover.style.top=loc.y+'px';hover.style.left=loc.x+'px';InfoHover.removeTailClassNames(hover);hover.addClassName(loc.className);$$('.synopsis-container').each(Element.hide);clearTimeout(Topic.currentTimeout);Topic.currentTimeout=setTimeout(function(){new Effect.Appear(hover,{duration:0.3,afterFinish:function(){Topic.currentTimeout=null;}});},700);return false;},hidePreviewSynopsis:function(ev){if(!Topic.previewBounds)return;var bounds=Topic.previewBounds;var y=Event.pointerY(ev);var x=Event.pointerX(ev);var hide=y<bounds.top||y>bounds.top+bounds.height||x<bounds.left||x>bounds.left+bounds.width;if(hide){$$('.synopsis-container').each(Element.hide);}
return false;},getUserType:function(){var url=document.location.pathname;if((Behaviors.isLoggedIn())&&(url.match('\/discussions\/.*'))){new Ajax.Request('/users/user_type/',{method:'get',onSuccess:function(req){var user_type=req.responseText;if(user_type=="hulu"){if($("create-new-topic")){$("create-new-topic").show();}}}});}}});Event.observe(window,'load',Topic.activateHovers);
var Post=Class.create();Object.extend(Post,{singleSubmitLock:false,openPostForm:function(post_id,topic_id,depth,last_item,el){if(READ_ONLY)return;if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
Post.doOpenPostForm(post_id,topic_id,depth,last_item,el);}});return false;}
else{Post.doOpenPostForm(post_id,topic_id,depth,last_item,el);}},doOpenPostForm:function(post_id,topic_id,depth,last_item,el){new Ajax.Request("/users/permission_check",{asynchronous:true,method:"get",onComplete:function(request){info=request.responseText.evalJSON();if(info.permitted){$$('.p-form-block').each(function(e1){e1.hide();});formDiv='t-'+topic_id+'-p-'+post_id+'-form';if($(formDiv)){$(formDiv).appendChild($('p-form-instance'));$('p-form-topic-id').value=topic_id;$('p-form-parent-id').value=post_id;$('p-form-depth').value=depth;$('p-form-last-item').value=last_item;if($('p-form-instance').style.display=='none')$('p-form-body').value="";if($('p-form-spoilers'))$('p-form-spoilers').checked=false;$('p-error-container').hide();$(formDiv).parentNode.style.display="";$(formDiv).style.display="";$('p-form-submit').src=Base.imageURL('/images/btn-forums-submit.gif');$('p-form-instance').show();$('p-form-body').focus();if(Prototype.Browser.IE){$(formDiv).removeClassName('ie6');$(formDiv).addClassName('ie6');}}}
else
Behaviors.showSubmitPermission("post");}});},closePostForm:function(){Element.update('p-form-errors','');$('p-form-body').value="";$('p-form-topic-id').value="";$('p-form-parent-id').value="";if($('p-form-spoilers'))$('p-form-spoilers').checked=false;$('p-form-instance').parentNode.parentNode.style.display="none";$('p-form-instance').parentNode.style.display="none";$('p-form-instance').hide();$('p-form-loading').hide();},updateState:function(id,state){itemDiv='p-'+id+'-item';$(itemDiv).removeClassName('p-item-s-default');$(itemDiv).removeClassName('p-item-s-spoiled');$(itemDiv).removeClassName('p-item-s-flagged');$(itemDiv).addClassName('p-item-s-'+state);},toggleReplies:function(params){var toggleDivName='p-'+params['parent_id']+'-replies-toggle';var postDivPrefix='t-'+params['topic_id']+'-p-'+params['parent_id'];if($(postDivPrefix+'-posts').className=='p-replies-preload')
{$('p-'+params['parent_id']+'-item-replies-loading').show();$(postDivPrefix+'-posts-toggle').src=Base.imageURL('/images/button-expand-hover.gif');$(postDivPrefix+'-posts').className='';new Ajax.Updater(postDivPrefix+'-posts','/posts/list',{asynchronous:true,evalScripts:true,parameters:params,method:'get',onComplete:function(){$(toggleDivName).className='p-replies-expanded';$('p-'+params['parent_id']+'-item-replies-loading').hide();$(postDivPrefix+'-formholder-expanded').style.display=$(postDivPrefix+'-formholder-collapsed').style.display;$(postDivPrefix+'-formholder-collapsed').style.display='none';$(postDivPrefix+'-formholder-expanded').appendChild($(postDivPrefix+'-form'));setTimeout("$('"+toggleDivName+"').addClassName('ie6');",10);}})}
else
{if($(postDivPrefix+'-posts').style.display==''){$(postDivPrefix+'-posts').style.display='none';$(toggleDivName).className='p-replies-collapsed';if(params['footer_collapse']==null){$(postDivPrefix+'-posts-toggle').src=Base.imageURL('/images/button-collapse-hover.gif');}
else{$(postDivPrefix+'-posts-toggle').src=Base.imageURL('/images/button-collapse.gif');}
$(postDivPrefix+'-formholder-collapsed').style.display=$(postDivPrefix+'-formholder-expanded').style.display;$(postDivPrefix+'-formholder-expanded').style.display='none';$(postDivPrefix+'-formholder-collapsed').appendChild($(postDivPrefix+'-form'));}
else{$(postDivPrefix+'-posts').style.display='';$(toggleDivName).className='p-replies-expanded';$(postDivPrefix+'-posts-toggle').src=Base.imageURL('/images/button-expand-hover.gif');$(postDivPrefix+'-formholder-expanded').style.display=$(postDivPrefix+'-formholder-collapsed').style.display;$(postDivPrefix+'-formholder-collapsed').style.display='none';$(postDivPrefix+'-formholder-expanded').appendChild($(postDivPrefix+'-form'));}}},hover:function(post_id,hoverOn){if(hoverOn&&!READ_ONLY)
$('p-'+post_id+'-item-container').addClassName("active");else
$('p-'+post_id+'-item-container').removeClassName("active");}});
var Tab=Class.create();var loadingImg='<img width="16" height="16" border="0" style="vertical-align: middle" src="'+Base.imageURL('/images/loading-animated-circle.gif')+'"/>'
Object.extend(Tab,{tabselect:function(tab){tablist=$('tab-container').getElementsByTagName('li');nodes=$A(tablist);nodes.each(function(node){if(node.id==tab.id){node.className='tab-selected';Tab.tab_image_disable($(node.id+'-img'));}else if(node.className=='tab-selected'){node.className='tab-unselected';Tab.tab_image_enable($(node.id+'-img'));};});},paneselect:function(pane){panelist=$('pane-container').getElementsByTagName('li');nodes=$A(panelist);nodes.each(function(node){if(node.id==pane.id){pane.className='pane-selected';}else if(node.className=='pane-selected'){node.className='pane-unselected';};});if(['captions','tag','widgets'].indexOf(pane.id.substring(5))!=-1){try{$('recommended-videos').hide();}catch(e){}}else{try{$('recommended-videos').show();}catch(e){}}},loadTab:function(name,src,alwaysReload,params,callback){tab=$('tab-'+name);pane=$('pane-'+name);if(alwaysReload||pane.className=='pane-preload'){Tab.tabselect(tab);new Ajax.Updater(pane,src,{asynchronous:true,evalScripts:true,parameters:params,method:'get',onCreate:function(){$('tab-loading').show();},onSuccess:function(){$('tab-loading').hide();Tab.paneselect(pane);if(typeof(callback)=="function"){callback();}},onComplete:function(){$$('.tab-loading-circle').each(Element.hide);}})}
else{Tab.tabselect(tab);Tab.paneselect(pane);$$('.tab-loading-circle').each(Element.hide);if(typeof(callback)=="function"){callback();}}},tab_image_disable:function(el){var img=$(el);if(!img)return;if(img.src.match(/-hover/)){img.src=img.src.replace('-hover','-disabled');}
else if(img.src.match(/-disabled/)){}
else if(img.src.match(/\.gif/)){img.src=img.src.replace('.gif','-disabled.gif');}},tab_image_enable:function(el){var img=$(el);if(!img)return;if(img.src.match(/-disabled/)){img.src=img.src.replace('-disabled','');}}});
var current_widget_type='';function toggleWidgetHelp(pos,id,type){var help=$('widget-help');if(help){help.setStyle({top:pos[1]+27+"px",left:190+"px"});$('show-widget-code').value='<object width="200" height="439"><param name="movie" value="http://www.hulu.com/widget/show/'+id+'/'+type+'s"></param><embed src="http://www.hulu.com/widget/show/'+id+'/'+type+'s" type="application/x-shockwave-flash" width="200" height="439"></embed></object>';Element.hide('copy-show-check-icon');help.toggle();if(current_widget_type!=type&&current_widget_type!='')
help.toggle();current_widget_type=type;}}
function hideWidgetHelp(){var help=$('widget-help');if(help){Element.hide('copy-show-check-icon');help.hide();current_widget_type='';}}
function getWidgetCode(){$('show-widget-code').select();Element.show('copy-show-check-icon');return $('show-widget-code').value;}
var wt_w=725;var wt_h=210;var wt_layout="Horizontal";var wt_num_thumbs=4;var wt_sort_order="recentlyadded";var wt_matrix=[[[392,210],[392,210],[560,210],[725,210]],[[210,320],[210,455],[210,590],[210,725]]]
var wt_show_name="";var wt_override="";function wt_set_show_name(sn){wt_show_name=sn;}
function wt_set_override(or){wt_override=or;}
function wt_copy_embed_code(){$('wt-embed-code-text').select();$('wt-copy-check-icon').style.visibility="visible";return $('wt-embed-code-text').value;}
function wt_copy_advanced_embed_code(){$('wt-advanced-widget-code').select();$('wt-copy-advanced-check-icon').style.visibility="visible";return $('wt-advanced-widget-code').value;}
function wt_choose(p){if((p=='wt-1-thumbs')&&(wt_layout=="Horizontal"))
return;$(p).checked=true;wt_update_config();}
function wt_update_config(){if($('wt-horizontal').checked){wt_layout="Horizontal";if(wt_num_thumbs==1){wt_num_thumbs=2;$('wt-1-thumbs').checked=false;$('wt-2-thumbs').checked=true;}
$('wt-1-thumbs').disabled=true;$('wt-1-thumbs-span').addClassName('disabled');}else{wt_layout="Vertical";$('wt-1-thumbs').disabled=false;$('wt-1-thumbs-span').removeClassName('disabled');}
if($('wt-1-thumbs').checked)
wt_num_thumbs=1;else if($('wt-2-thumbs').checked)
wt_num_thumbs=2;else if($('wt-3-thumbs').checked)
wt_num_thumbs=3;else if($('wt-4-thumbs').checked)
wt_num_thumbs=4;if($('wt-sort-order'))
wt_sort_order=$('wt-sort-order').value;else
wt_sort_order="recentlyadded";var ar=wt_matrix[wt_layout=="Horizontal"?0:1][wt_num_thumbs-1];wt_w=ar[0];wt_h=ar[1];wt_insert_params();}
function wt_insert_params(){var code="<object width=\""+wt_w+"\" height=\""+wt_h+"\"><param name=\"movie\" ";code+="value=\"http://www.hulu.com/widget/embed/videopanel\"></param><param name=\"bgcolor\" value=\"0x000000\" /><param name=\"wmode\" value=\"transparent\" /><param name=\"flashVars\" ";code+="value=\"partner=CSWidget&layout="+wt_layout+wt_num_thumbs+"Thumbs&watchOnHulu=true&searchEnabled=true&sortEnabled=true&sortDefault="+wt_sort_order+"&show="+wt_show_name+wt_override+"\"></param><embed ";code+="src=\"http://www.hulu.com/widget/embed/videopanel\" type=\"application/x-shockwave-flash\" flashVars=\"partner=CSWidget&layout="+wt_layout+wt_num_thumbs;code+="Thumbs&watchOnHulu=true&searchEnabled=true&sortEnabled=true&sortDefault="+wt_sort_order+"&show="+wt_show_name+wt_override+"\" wmode=\"transparent\" bgcolor=\"0x000000\" width=\""+wt_w+"\" height=\""+wt_h+"\"></embed></object>";$('wt-embed-code-text').value=code;var help=$('wt-widget-help');if(help){var advancedembedcode='';advancedembedcode+='<div id="huluPlayer" playermode="floating"></div>';advancedembedcode+='<div id="huluPanel1" panellayout="'+wt_layout+'" panelitems="'+wt_num_thumbs+'" panelautoplay="true" panelshow="'+wt_show_name+wt_override+'" panelsortdefault="'+wt_sort_order+'"></div>';advancedembedcode+='<script src="http://player.hulu.com/videopanel/js/huluVideoPanel.js?partner=CSWidget" id="HULU_VP_JS" type="text/javascript"></scr'+'ipt>';$('wt-advanced-widget-code').value=advancedembedcode;$('wt-copy-advanced-check-icon').style.visibility="hidden";}
$('wt-dimensions').innerHTML="Dimensions: "+wt_w+" x "+wt_h;$('wt-copy-check-icon').style.visibility="hidden";swfObject2=new SWFObject("http://www.hulu.com/widget/embed/videopanel","show_widget",wt_w,wt_h,"1");swfObject2.addParam("flashVars","partner=CSWidget&layout="+wt_layout+wt_num_thumbs+"Thumbs&watchOnHulu=true&searchEnabled=true&sortEnabled=true&sortDefault="+wt_sort_order+"&show="+wt_show_name+wt_override);swfObject2.addParam("allowScriptAccess","always");swfObject2.addParam("wmode","transparent");VersionCheck.write(swfObject2,"wt-widget");}
function wt_toggleWidgetHelp(){var help=$('wt-widget-help');if(help){var advancedembedcode='';advancedembedcode+='<div id="huluPlayer" playermode="floating"></div>';advancedembedcode+='<div id="huluPanel1" panellayout="'+wt_layout+'" panelitems="'+wt_num_thumbs+'" panelautoplay="true" panelshow="'+wt_show_name+wt_override+'" panelsortdefault="'+wt_sort_order+'"></div>';advancedembedcode+='<script src="http://player.hulu.com/videopanel/js/huluVideoPanel.js?partner=CSWidget" id="HULU_VP_JS" type="text/javascript"></scr'+'ipt>';$('wt-advanced-widget-code').value=advancedembedcode;$('wt-copy-advanced-check-icon').style.visibility="hidden";help.toggle();}}
function wt_hideWidgetHelp(){var help=$('wt-widget-help');if(help){$('wt-copy-advanced-check-icon').style.visibility="hidden";help.hide();}}
var Hover=Class.create();var HOVER_EXTENSION_RX=/(\.gif\??[0-9]*|\.jpg\??[0-9]*|\.png\?[0-9]*)$/;Object.extend(Hover,{init:function(){Event.observe(window,'load',function(){Hover.makeSandy();});Ajax.Responders.register({onComplete:Hover.makeSandy});},image_toggle_over:function(el){if(typeof($)=='undefined')return;var img=$(el);if(!img)return;if(!img.width&&!img.height){var dims=img.getDimensions();img.width=dims.width;img.height=dims.height;}
var extension=HOVER_EXTENSION_RX.exec(img.src);extension=extension&&extension.length>=1?extension[1]:false;if(!img.src.match(/-selected/)&&!img.src.match(/-disabled/)&&extension){if(!img.src.match(/-hover/))
img.src=img.src.replace(/(-hover|-over)/g,'').replace(HOVER_EXTENSION_RX,'-hover'+extension);else
img.src=img.src.replace(HOVER_EXTENSION_RX,extension);img.style.cursor="pointer";}else{img.style.cursor="default";img.alt="";}},image_toggle_out:function(el){var img=$(el);if(!img)return;if(!img.src.match(/-disabled/)&&img.src.match(HOVER_EXTENSION_RX)){if(img.src.match(/-hover/))
img.src=img.src.replace(/-hover/g,'');}},makeDivSandy:function(){$$(".div-hover-me").each(function(div){var img=div.up("div").down("img");if(img&&img.hasClassName("hover-me")){div.observe('mouseover',function(event){Hover.image_toggle_over(event.target.up("div.link-description-damnfirefox36").down("img").id);});div.observe('mouseout',function(event){Hover.image_toggle_out(event.target.up("div.link-description-damnfirefox36").down("img").id);});}
div.removeClassName("div-hover-me");});},makeSandy:function(){Hover.makeDivSandy();$$('.hover-me').each(function(el){var img=$(el);var extension=HOVER_EXTENSION_RX.exec(img.src);extension=extension&&extension.length>=1?extension[1]:false;if(!img.src.match(/-selected/)&&!img.src.match(/-disabled/)&&extension){pingImage(img.src.replace(HOVER_EXTENSION_RX,'-hover'+extension));if(img.up("a.menu-top")){pingImage(img.src.replace(HOVER_EXTENSION_RX,'-over'+extension));}}
img.observe('mouseover',function(event){Hover.image_toggle_over(Event.element(event).id);});img.observe('mouseout',function(event){Hover.image_toggle_out(Event.element(event).id);});img.removeClassName('hover-me');});}});Hover.init();
var PlayerLights=Class.create();PlayerLights.prototype={yPos:0,xPos:0,working:false,isOff:false,defaultOpacity:0.8,defaultDuration:0.5,onRestoreColor:"#eeeeee",oldDescriptionContainerBackground:false,oldBreakoutContainerBackground:false,initialize:function(){},maintenanceShowing:function(){var el=$('maintenance');return READ_ONLY&&el&&el.style.display!='none';},off:function(opacity,duration){InfoHover.executeHide();if(this.maintenanceShowing()){new Effect.SlideUp('maintenance',{duration:0.3,afterFinish:this.off.bind(this)});return;}
if(!this.working){this.working=true;var opacityOptions={duration:(duration!=void 0)?duration:this.defaultDuration,from:0.0,to:(opacity!=void 0)?opacity:this.defaultOpacity};if($('maintenance'))new Effect.SlideUp('maintenance');if($('overlay-top')){$("overlay-top").setOpacity(0.0);$("overlay-top").style.display="block";new Effect.Opacity('overlay-top',opacityOptions);}
var newTop=$('overlay-bottom').cumulativeOffset().top;var el=$('breakout-container');if(el){var xy=Position.cumulativeOffset(el);newTop=xy[1];$('overlay-bottom').style.top=newTop+"px";}
if($("collection-title-container"))
$("collection-title-container").style.visibility="hidden";var db=document.body;var dde=document.documentElement;var docHeight=Math.max(db.scrollHeight,dde.scrollHeight,db.offsetHeight,dde.offsetHeight,db.clientHeight,dde.clientHeight);var newHeight=docHeight-newTop;$("overlay-bottom").style.height=newHeight+"px";$("overlay-bottom").setOpacity(0.0);$("overlay-bottom").style.display="block";new Effect.Opacity('overlay-bottom',Object.extend(opacityOptions,{afterFinish:function(){this.working=false;this.isOff=true;if($('search-bar')&&$('search-result')&&$('search-result').visible()){var bar=$('search-bar');var result=$('search-result');var tDelta=(document.viewport.getHeight()-bar.getHeight()-result.getHeight())/2;tDelta=(tDelta<0?0:tDelta);new Effect.ScrollTo('search-bar',{offset:-tDelta,duration:0});}
else if($('hot-topic-search-result')&&$('hot-topic-search-result').visible()){var hot_topics_result=$('hot-topic-search-result');var hotDelta=(document.viewport.getHeight()-hot_topics_result.getHeight())/2;hotDelta=(hotDelta<0?0:hotDelta);new Effect.ScrollTo('hot-topic-search-result',{offset:-hotDelta,duration:0});}}.bind(this)}));if($('player')){try{$('player').lightStatusChanged("off");}
catch(e){}}}},on:function(){if(!this.working){this.working=true;if($('overlay-top')){new Effect.Fade('overlay-top',{duration:0.5,afterFinish:function(){if(Prototype.Browser.IE)
$('overlay-top').style.filter="alpha(opacity=80)";}});}
if($('search-result'))
$('search-result').hide();if($("collection-title-container"))
$("collection-title-container").style.visibility="visible";new Effect.Fade('overlay-bottom',{duration:0.5,afterFinish:function(){if(Prototype.Browser.IE)
$('overlay-bottom').style.filter="alpha(opacity=80)";if($('search-bar'))$('search-bar').style.zIndex=0;this.working=false;this.isOff=false;}.bind(this)});if($('player')){try{$('player').lightStatusChanged("on");}
catch(e){}}}},fixDescription:function(timeout,fn){if(timeout&&fn){setTimeout(function(){fn();},timeout);}
if($("star-rating-container"))
$("star-rating-container").style.visibility="hidden";$$('.cc-logo').each(function(el){el.style.visibility="hidden";});if($("show-title-container"))
$("show-title-container").removeClassName("show-title");if($("ext-company-logo-watch"))
$("ext-company-logo-watch").style.visibility="hidden";},unfixDescription:function(){if($("star-rating-container"))
$("star-rating-container").style.visibility="visible";$$('.cc-logo').each(function(el){el.style.visibility="visible";});if($("ext-company-logo-watch"))
$("ext-company-logo-watch").style.visibility="visible";if($("show-title-container"))
$("show-title-container").addClassName("show-title");},playerDeactivate:function(){if(this.isOff){this.on();}},adjustOverlayBottom:function(open){var el=$('breakout-container');if(el){var xy=Position.cumulativeOffset(el);var newTop=$('overlay-bottom').cumulativeOffset().top;newTop=xy[1]+$(el).getHeight();$('overlay-bottom').style.top=newTop+"px";}}}
var lights=new PlayerLights();
var Support=Class.create();var SupportPopulateSuccess=true;Object.extend(Support,{messages:{"valid":"It appears that you are being validated as within the US.  If you are experiencing difficulties viewing Hulu"+" and using an anonymous proxy tool, you will need to disable your anonymizer to access videos on Hulu."+" If you are not using an anonymous proxy tool but still unable to view Hulu videos,"+" please submit your information and a member of our staff will investigate.","unsupported_xff":"It appears that your ISP or Proxy is using a non-American IP address when forwarding your traffic."+" We currently cannot support custom configurations and this needs to be resolved with your ISP or"+" proxy.  Please ensure that the <b>X-Forwarded-For</b> header is removed by the ISP or Proxy, and"+" then you will be able to utilize Hulu's services.","not_in_us":"Multiple third party sources identify your location as being out of the U.S.  If you are within"+" the U.S., please submit your information and a member of our staff will re-evaluate your location.","retrieve_error":"There is an internal error in retrieving your data.  Please send us an email at"+" <a href=\"mailto:support@hulu.com\">support@hulu.com</a> with the details of your issue.  We"+" apologize for the inconvenience.","send_error":"There is an internal error in submitting your data.  Please send us an email at"+" <a href=\"mailto:support@hulu.com\">support@hulu.com</a> with the details of your issue.  We"+" apologize for the inconvenience.","submitted":"Your issue was successfully submitted along with your information.  We will investigate this"+" issue and will inform you of the resolution as soon as possible.  Thank you for your time.","bandwidth":"It appears that the bandwidth on the network does not meet Hulu's minimum requirements.  You can"+" review our minimum requirements at <a href=\"http://www.hulu.com/support/article/166380\">"+" http://www.hulu.com/support/article/166380</a> .  Network connections can sometimes fluctuate"+" at various times during the day, so we recommend checking your connection (or router) for optimal"+" speed. <br/><br/> You can also confirm your bandwidth at http://www.speedtest.net/ .  Please indicate"+" the speed displayed from SpeedTest using this form if you notice signficant discrepancy in your"+" bandwidth.  If SpeedTest also indicates less than 1000 kbps of bandwidht available, we will not be"+" able to assist you.  We apologize for the inconvenience and we are mindful of our users who may have"+" lower bandwidth than necessary, and we hope to solve this problem as we expand in our methods of"+" distribution.","missing_video_start":"Please play the above video before submitting.  If the video cannot be played, please send us"+" an email at <a href=\"mailto:support@hulu.com\">support@hulu.com</a> with the exact error message"+" you see.","missing_traceroute":"Please enter your traceroute information.","feedback":"Thanks for your feedback. We appreciate it.","bad_email":""},rfc822Email:/^[a-z0-9!#\$%&'\*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#\$%&'\*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,populateGeoFiltering:function(){if($('SupportObject'))$('SupportObject').populateGeoFilteringDetails();return false;},populateStreaming:function(){if($('SupportObject'))$('SupportObject').populateStreamingDetails();return false;},populateField:function(field,value){if(!($('SupportObject')))return;if(field=='time_started'){d=new Date();d.setTime(value);value=d.toUTCString();}
if((field=='video_id')||(field=='video_url')||(field=='time_started')){Support.buttonsEnable();if($('support_'+field).value!='')
return;}
$('support_'+field).value=value;},populateError:function(){$('support-submit-loading').hide();$('support-message').down('.message').innerHTML=Support.messages["retrieve_error"];$('support-message').down('.warning').show();$('support-message').show();},submitError:function(){$('support-message').down('.message').innerHTML=Support.messages["send_error"];$('support-message').down('.warning').show();$('support-message').show();},resetFields:function(type){$('support_name').clear();if(type=="feedback"||type=="support"){if($('support_email').up('tr').visible())
$('support_email').clear();$('support_description').clear();if(type=="support"){$('support_subject').clear();$('support_category').clear();}}else{$('support_email').clear();$('user-comment').clear();}
if(type=='geofiltering'||type=='streaming'){$('support_zipcode').clear();}else if(type=="desktop"){}},validateGeoCheck:function(){$('support-submit-loading').hide();if($('support_geocheck').value=='valid'){$('support-message').down('.message').innerHTML=Support.messages["valid"];$('support-message').down('.warning').show();$('support-message').show();Support.buttonsEnable();}
else if(($('support_geocheck').value=='not-valid')||($('support_geocheck').value=='invalid')){if($('support_http_xff').value!=''){$('support-message').down('.message').innerHTML=Support.messages["unsupported_xff"];$('support-message').down('.warning').show();$('support-message').show();}
if($('support_geolocation').value!='US'){$('support-message').down('.message').innerHTML=Support.messages["not_in_us"];$('support-message').down('.warning').show();$('support-message').show();Support.buttonsEnable();}
else{Support.buttonsEnable();}}
else{$('support-message').down('.message').innerHTML=Support.messages["retrieve_error"];$('support-message').down('.warning').show();$('support-message').show();}},validateStreaming:function(){$('support-submit-loading').hide();bandwidth=parseInt($('support_bandwidth').value);if((isNaN(bandwidth))||(bandwidth<1000)){$('support-message').down('.message').innerHTML=Support.messages["bandwidth"];$('support-message').down('.warning').show();$('support-message').show();return false;}
if(($('support_time_started').value=='')||(($('support_video_url').value==''))){$('support-message').down('.message').innerHTML=Support.messages["missing_video_start"];$('support-message').down('.warning').show();$('support-message').show();return false;}
if($('support_traceroute').value==''){$('support-message').down('.message').innerHTML=Support.messages["missing_traceroute"];$('support-message').down('.warning').show();$('support-message').show();return false;}
return true;},redirectForm:function(){var el=$('support_issue');if(el&&el[el.selectedIndex].value=="Geo-filtering")
window.location="http://www.hulu.com/support/geofilter_form";else if(el&&el[el.selectedIndex].value=="Streaming")
window.location="http://www.hulu.com/support/streaming_form";},beforeSubmit:function(type){$('support-message').down('.message').innerHTML='';$('support-message').down('.warning').hide();$('support-message').down('.info').hide();$('support-message').hide();if($('support_name').value==""){window.scrollTo(0,0);ModalPopup.warn("Please enter your name.");$('support_name').focus();return false;}
if(!Support.rfc822Email.test($('support_email').value)){window.scrollTo(0,0);ModalPopup.warn("Please provide a valid email address.");$('support_email').focus();return false;}
if(type=="desktop"&&$('user-comment').value==""){window.scrollTo(0,0);ModalPopup.warn("Please provide a description.");$('user-comment').focus();return false;}
if(type!="desktop"){zipcode_regex=/^\d{5}$/;if(!zipcode_regex.test($('support_zipcode').value)){window.scrollTo(0,0);ModalPopup.warn("Please provide a valid 5-digit zip code.");$('support_zipcode').focus();return false;}}
if(type=='geofiltering'){}
else if(type=='streaming'){}
return true;},onSubmitSuccess:function(){$('success-copy-support').show();$('support-form-success').show();$('support-message').down('.warning').hide();$('support-form-body').hide();},afterSubmit:function(){$('support-message').down('.warning').hide();$('support-message').down('.info').show();$('support-message').down('.message').innerHTML=Support.messages["submitted"];$('support-message').show();},afterSubmitFeedback:function(){$('support-message').down('.warning').hide();$('support-message').down('.info').show();$('support-message').down('.message').innerHTML=Support.messages["feedback"];$('support-message').show();},buttonsDisable:function(){$('support-submit').style.opacity=0.5;$('support-submit').disable();},buttonsEnable:function(){$('support-submit').style.opacity=1.0;$('support-submit').enable();},showLogin:function(node){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(node);}},loadPlus:function(){if(Behaviors.isLoggedIn()){Support.loadPlusEx();}},loadPlusEx:function(){new Ajax.Updater('support-form-plus-placeholder','/support/get_plus_contact',{method:'post',evalScripts:true});setTimeout("Support.loadPlusEx()",30000);},showNumber:function(){$('support-form-plus-placeholder').addClassName('show-number');$('support-form-plus-placeholder').removeClassName('hide-number');new Ajax.Request('/support/display_phone_number');},show_contact_link:function(){$('support-contact-link').hide();$('support-contact-info').show();new Ajax.Request('/support/display_phone_number');}});function isReady(){return true;};document.observe("dom:loaded",function(){Behaviors.eraseCookie('_hulu_over18',Base.commonCookieDomain());Behaviors.eraseCookie('_hulu_over21',Base.commonCookieDomain());Behaviors.eraseCookie('km_uq',Base.commonCookieDomain());Behaviors.eraseCookie('km_ai',Base.commonCookieDomain());Behaviors.eraseCookie('km_ni',Base.commonCookieDomain());Behaviors.eraseCookie('km_lv',Base.commonCookieDomain());});
var InfoHover={lastTarget:null,currentType:null,currentId:null,currentTimeout:null,currentTarget:null,currentEffect:null,currentBounds:{},contentBounds:null,showThumbnails:false,showSeasons:false,hideByClick:false,fadeDuration:0.4,offsitePlay:null,banner:null,cache:{},videoHoverWasSocial:{},hoverTypeHash:{},TAIL_WIDTH:22,TAIL_HEIGHT:23,TAIL_OFFSET:2,VERTICAL_OFFSET:8,init:function(){if($('info_hover')){InfoHover.observeLinks();var body=$$('body').first();if(body){Element.observe(body,'mouseout',InfoHover.out);Element.observe(body,'click',InfoHover.out);}}},observeLinks:function(){if(Behaviors.in_browse){Element.observe('info_hover','mouseover',InfoHover.over_info);return;}
$$('.info_hover').each(function(el){if(!el.hasClassName('observing')){if(el.hasClassName('click_to_popup')){Element.observe(el,'click',InfoHover.over);el.style.visibility='visible';}
else{Element.observe(el,'mouseover',InfoHover.over);}
el.addClassName('observing');if(el.hasClassName('link_disabled')){el.onclick=function(){return false;};el.setStyle({textDecoration:'none',color:'#4c4c4c'});}}});Element.observe('info_hover','mouseover',InfoHover.over_info);Element.observe('info_hover','click',InfoHover.click_out);},observeLinkInBrowse:function(el){if(!el.hasClassName('observing')){if(el.hasClassName('click_to_popup'))
{Element.observe(el,'click',InfoHover.over);el.style.visibility='visible';}
else{Element.observe(el,'mouseover',InfoHover.over);}
el.addClassName('observing');}
Element.observe('info_hover','mouseover',InfoHover.over_info);Element.observe('info_hover','click',InfoHover.click_out);},over_info:function(ev){var el=$('info_hover');if(!el.hasClassName('not-clickable')){if(InfoHover.currentEffect)InfoHover.currentEffect.cancel();new Effect.Appear($('info_hover'),{duration:InfoHover.fadeDuration});InfoHover.currentTarget=InfoHover.lastTarget;InfoHover.calculateBounds(el);}},over:function(ev){var el=Event.element(ev);if(!el)return false;if(el.readAttribute('offsiteinfohoverid')||el.up().readAttribute('offsiteinfohoverid')){var ihid=el.readAttribute('offsiteinfohoverid');if(!ihid)ihid=el.up().readAttribute('offsiteinfohoverid');var img=$$('.offsite-play a[offsiteinfohoverid]').find(function(e){return(e.readAttribute('offsiteinfohoverid')==ihid&&el.descendantOf(e.up(4)));}).up().down();toggle_visible(img);InfoHover.offsitePlay=img;InfoHover.banner=img.up().nextSiblings()[0];if(!InfoHover.banner){InfoHover.banner=img.up().up().nextSiblings()[0];}
toggle_invisible(InfoHover.banner);}
if(Behaviors.in_browse){var disableLoadDelay=true;var showThumbnails=!Browse.show_thumbnail;var showSeasons=el.hasClassName('show-seasons');}else{if(!el.hasClassName('info_hover')){el=el.up('.info_hover');if(!el)return false;}
var showThumbnails=el.hasClassName('show-thumb');var showSeasons=el.hasClassName('show-seasons');var disableLoadDelay=true;var img=el.down('img.thumbnail');if(img)el=img;}
if(InfoHover.currentTarget==el)
{if(el.hasClassName('click_to_popup'))InfoHover.executeHide();return;}
if(InfoHover.currentTarget&&InfoHover.hideByClick)
{if(ev.type=='click')
{InfoHover.executeHide();disableLoadDelay=false;}
else return;}
InfoHover.currentTarget=el;if(el.hasClassName('click_to_popup'))InfoHover.hideByClick=true;InfoHover.calculateBounds(el);if(disableLoadDelay&&InfoHover.hideByClick)InfoHover.load();else
{clearTimeout(InfoHover.currentTimeout);InfoHover.currentTimeout=null;InfoHover.showThumbnails=showThumbnails;InfoHover.showSeasons=showSeasons;InfoHover.currentTimeout=setTimeout(function(){SuperPlus.hide();if(el.hasClassName('not-clickable')&&$('info_hover'))$('info_hover').addClassName('not-clickable');InfoHover.load();},700);}
return false;},calculateBounds:function(el){InfoHover.currentBounds=InfoHover.getBounds(el);var content=el.down('div.content');if(content){InfoHover.contentBounds=InfoHover.getBounds(el);}
else{InfoHover.contentBounds=null;}},getBounds:function(el){var bounds={};var xy=Position.cumulativeOffset(el);bounds.left=xy[0];bounds.top=xy[1];xy=el.viewportOffset;bounds.vpleft=xy[0];bounds.vptop=xy[1];var dim=el.getDimensions();bounds.width=dim.width;bounds.height=dim.height;if(dim.height>26){var div=el.parentNode;if(div.hasClassName('recommend-reason'))
bounds.left=Position.cumulativeOffset(div)[0];}
return bounds;},load:function(){if(InfoHover.isQueueAdd()){var el=InfoHover.currentTarget;var d=el.readAttribute('plus_avail');if(!d){el=el.up();if(!el)return;d=el.readAttribute('plus_avail');}
if(!d)return;return InfoHover.show({"plus_avail":d});}
var url=InfoHover.parseUrl();if(!url)return;var cache=InfoHover.cache;InfoHover.fadeDuration=0.4;if(cache[url]){InfoHover.show(cache[url]);}
else if(url.match(/http:\/\/ib.huluim.com/i)){var video_id=url.substring(url.indexOf('&video_id=')+10);url={social_comment_thumbnail:url,video_id:video_id};InfoHover.cache[url]=url
InfoHover.show(url);}
else{new Ajax.Request(url,{method:'get',onSuccess:function(trans){var obj=eval('('+trans.responseText+')');InfoHover.cache[url]=obj;InfoHover.show(obj);}});}},click_out:function(ev){var mx=Event.pointerX(ev),my=Event.pointerY(ev);var bounds=InfoHover.contentBounds;if(!bounds)return;var inContent=bounds.left<=mx&&mx<=bounds.left+bounds.width&&bounds.top<=my&&my<=bounds.top+bounds.height;if(!inContent){InfoHover.executeHide();return true;}
return false;},out:function(ev){if(InfoHover.hideByClick)
{if(ev.type=='mouseout')return;if(Position.within($('info_hover').down('div.content'),Event.pointerX(ev),Event.pointerY(ev)))return;}
var bounds=InfoHover.currentBounds;var y=Event.pointerY(ev);var x=Event.pointerX(ev);var hide=y<bounds.top||y>bounds.top+bounds.height||x<bounds.left||x>bounds.left+bounds.width;if(hide){InfoHover.executeHide();}
return false;},executeHide:function(){InfoHover.lastTarget=InfoHover.currentTarget;InfoHover.currentTarget=null;InfoHover.currentBounds={};InfoHover.contentBounds=null;InfoHover.hideByClick=false;clearTimeout(InfoHover.currentTimeout);InfoHover.currentTimeout=null;InfoHover.currentEffect=new Effect.Fade($('info_hover'),{duration:0.3,afterFinish:function(){InfoHover.lastTarget=null;InfoHover.currentEffect=null;InfoHover.showWindowedControls();}});if(InfoHover.offsitePlay){if(InfoHover.offsitePlay.hasClassName('play')){toggle_invisible(InfoHover.offsitePlay);}
InfoHover.offsitePlay=null;}
if(InfoHover.banner){toggle_visible(InfoHover.banner);InfoHover.banner=null;}
if(InfoHover.copy_embed_clip){InfoHover.copy_embed_clip.hide();}},isQueueAdd:function(){var a=InfoHover.currentTarget;return(a&&a.hasClassName("queue-add"));},parseUrl:function(){var a=InfoHover.currentTarget;if(a&&'IMG'==a.tagName)
a=a.up(0);if(a&&'A'!=a.tagName){var el=a.up('a');if(!el)el=a.down('a');if(el)a=el;else return null;}
if(a.readAttribute('offsiteInfoHoverId')){return a.readAttribute('offsiteInfoHoverId');}
var link_ref=a.href
var path=link_ref?["",link_ref.replace(/^https?:\/\//i,"")]:[];if(path.length>1){path=path[1];}
else{path=link_ref;}
if(!path||path.blank())return null;if(a.readAttribute('fb_hover_url')&&!a.readAttribute('fb_hover_url').blank()){return a.readAttribute('fb_hover_url');}
else if(a.readAttribute('video_timestamp')&&!a.readAttribute('video_timestamp').blank()&&a.readAttribute('video_id')&&!a.readAttribute('video_id').blank()&&a.readAttribute('content_id')&&!a.readAttribute('content_id').blank()){var timestamp=parseInt(a.readAttribute('video_timestamp'));var path;if(timestamp<=10){path='http://ib.huluim.com/video/'+a.readAttribute('content_id')+'?size=145x80&video_id='+a.readAttribute('video_id');}
else{path='http://ib.huluim.com/thumb?size=145x80&s='+timestamp+'&id='+a.readAttribute('content_id')+'&video_id='+a.readAttribute('video_id');}
pingImage(path);return path;}
var s=path.split('/watch/');if(s.length<=1){s=path.split('/hd/');}
if(s.length<=1){s=path.split('/superbowl/');}
if(s.length<=1){s=path.split('/adzone/');}
if(s.length<=1){s=path.split('/nfl/');}
if(s.length<=1){s=path.split('/nhl/');}
if(s.length<=1){s=path.split('/bec/');}
if(s.length<=1){s=path.split('/screening_room/');}
if(s.length>1&&path.match(/\/screening_room\/show\//)){return['/shows','info_by_show_id',s[1].split('/')[1]].join('/');}
if(s.length>1&&path.match(/\/screening_room\/watch\//)){return['/videos','info',s[1].split('/')[0]].join('/');}
if(s.length>1&&path.match(/\/(nfl|nhl)\//))
return['/shows','info',s[1].split('/')[0]].join('/');if(path.indexOf('/adzone/')>0&&s.length>1&&s[1].indexOf('#')>0){return['/videos','info',s[1].split('/')[0].split('#')[1]].join('/');}
if(s.length>1){return['/videos','info',s[1].split('/')[0]].join('/');}
else if(path.split('/profiles/').length>1){if(path.split('/u/').length>1)
return['/users','info/u',path.split('/')[3].split('?')[0]].join('/');else
return['/users','info',path.split('/')[2].split('?')[0]].join('/');}
else if(path.split('/facebook_canvas/feed?user_id=').length>1){return['/users','info/u',path.split('/')[2].split('=')[1]].join('/');}
else if(a.readAttribute('collection_info_hover')&&!a.readAttribute('collection_info_hover').blank()){return a.readAttribute('collection_info_hover');}
else if(path.split('/collections/').length>1){if(path.split('/').length>3){return['/videos','info',path.split('/')[3].split('?')[0]].join('/');}
else{return['/collections','info',path.split('/')[2].split('?')[0]].join('/');}}
else if(a.readAttribute("pli_vi")&&!a.readAttribute("pli_vi").blank()){return['/videos','info',a.readAttribute("pli_vi")].join('/');}
else if(a.readAttribute('ci')&&!a.readAttribute('ci').blank()){return a.readAttribute('ci');}
else if(a.readAttribute('preview')&&!a.readAttribute('preview').blank()){return a.readAttribute('preview');}
else if(a.readAttribute('data-cname')&&!a.readAttribute('data-cname').blank()){return['/shows','info',a.readAttribute('data-cname')].join('/');}
else if(a.hasClassName('rec-hover')||a.up('.rec-hover')){var li=a.up('li');if(li&&li.readAttribute('si')>0){try{var obj=VideoSlider.SLIDER_OBJECTS.get(li.up("ul").up("div.vsl").id);var page=-1*(obj.currentPos()-obj.pageWidth)/obj.pageWidth;var loc=obj.getLoc();var user_id=RecommendationHubSlider.getUserId();RecommendationHubSlider._rTracking.send(obj.trackingType,'hover',user_id,null,li.getAttribute('si'),null,null,page,null,loc,null);}catch(ex){}}
return['/shows','info',path.split('/')[1].split('?')[0]].join('/');}
else{var span_el=a.up('span');if(span_el&&span_el.hasClassName('expired')){canonical_name=$w(span_el.className)[2];}
else{canonical_name=path.split('/')[1].split('?')[0];if(canonical_name=="search"){canonical_name=path.split('/')[1];start_index=canonical_name.indexOf("=");canonical_name=canonical_name.substring(start_index+1);}}
return['/shows','info',canonical_name].join('/');}
return null;},update:function(data){var hover_div=$$('div#info_hover').first();if(!hover_div)return;var content=hover_div.down('div.content');var updated_html="";hover_div.removeClassName('type_show');hover_div.removeClassName('type_video');hover_div.removeClassName('type_social_comment_thumbnail');hover_div.removeClassName('type_social_comment_thumbnail-small');hover_div.removeClassName('type_friends');hover_div.removeClassName('type_fb_friends');hover_div.removeClassName('type_user');hover_div.removeClassName('type_cast');hover_div.removeClassName('type_preview');hover_div.removeClassName('type_collection');hover_div.removeClassName('type_queue');if(data.show_name||data.title){hover_div.addClassName('type_video');updated_html=InfoHover.update_video(data);InfoHover.currentType='video';InfoHover.currentId=data.id;}
else if(data.plus_avail){hover_div.addClassName('type_queue');updated_html=InfoHover.update_addqueue(data);InfoHover.currentType='queue';InfoHover.currentId=data.user_id;}
else if(data.social_comment_thumbnail){hover_div.addClassName('type_social_comment_thumbnail');updated_html=InfoHover.update_social_comment_thumbnail(data);InfoHover.currentType='social_comment_thumbnail';InfoHover.currentId=data.video_id;}
else if(data.display_name){hover_div.addClassName('type_user');updated_html=InfoHover.update_user(data);InfoHover.currentType='user';InfoHover.currentId=data.user_id;}
else if(data.friends){hover_div.addClassName('type_fb_friends');updated_html=InfoHover.update_friends(data);InfoHover.currentType='friends';InfoHover.currentId=data.user_id;}
else if(data.recommend_info){hover_div.addClassName('type_recommend_show');updated_html=InfoHover.update_show(data);InfoHover.currentType='recommended_show';InfoHover.currentId=data.show.id;}
else{hover_div.addClassName('type_show');updated_html=InfoHover.update_show(data);InfoHover.currentType='show';InfoHover.currentId=data.id;}
content.update(updated_html);if(data.social_comment_thumbnail){var el=content.down("img.thumb");if(el.width>0&&el.width<110){hover_div.removeClassName('type_social_comment_thumbnail');hover_div.addClassName('type_social_comment_thumbnail-small');}}else if(data.previewable&&!Behaviors.isPlusUser()&&!(data.has_auth&&Auth.authenticated())){var el=content.down("img.thumb");if(el){new Insertion.After(el,'<img src="'+Base.imageURL('/images/plus-preview-banner.png?v2')+'" border="0" class="plus-preview" style="position: absolute; top: 71px; right: 15px;"/>');}}},update_video:function(data){InfoHover.videoHoverWasSocial[data.id]=false;if(InfoHover.hoverTypeHash['video']==null){InfoHover.hoverTypeHash['video']={};}
InfoHover.hoverTypeHash['video'][data.id]=true;var html="";var esc=InfoHover.cleanEscape;if(InfoHover.showThumbnails){html+='<img class="thumb" src="';html+=data.thumbnail_url;html+='" border="0" width="145" height="80" />';}
if(data.show_name==data.title){html+='<b>'+esc(data.show_name)+'</b><br/>';}
else if(data.show_name.replace(" ","").length==0){html+='<b>'+esc(data.title)+'</b><br/>';}
else{html+='<b>'+esc(data.show_name)+':</b> ';html+=esc(data.title)+"<br/>";}
var hasSeasonOrDuration=false;if((data.season_number>0&&data.episode_number>0)||data.programming_type){hasSeasonOrDuration=true;}
if(hasSeasonOrDuration){if(data.air_date){var label='Air date: ';if(data.media_type&&data.media_type=='Film'&&data.programming_type&&data.programming_type=='Trailer')
{label='In theaters ';}
html+=label+esc(data.air_date);}}
if(data.has_captions){html+=' &nbsp;|&nbsp; ';html+='<img class="cc" src="'+Base.imageURL('/images/icon-cc-gray.png')+'" border="0" width="17" height="12" />';}
if(data.content_rating){html+=' &nbsp;|&nbsp; ';html+='Rated: '+esc(data.content_rating);}
if(data.coming_soon||(!Behaviors.isPlusUser()&&data.has_auth&&!Auth.authenticated())){date=(Behaviors.isPlusUser()&&data.coming_soon)?data.plus_available_at:data.available_at;if(data.id in Behaviors.placeholderEmails){email_title='title="You have requested to be notified by email '+'when this video becomes available on Hulu" ';email_img='src="'+Base.imageURL('/images/icon-check.gif')+'" ';}else{email_title='title="Email me when this video becomes available" ';email_img='src="'+Base.imageURL('/images/icon-email.gif')+'" '+'onmouseover="this.src=\''+Base.imageURL('/images/icon-email-hover.gif')+'\';" '+'onmouseout="this.src=\''+Base.imageURL('/images/icon-email.gif')+'\';" ';}
embed_title='title="Click to copy the embed code to your clipboard" ';html+="<div>Available on Hulu.com: <b>"+esc(date)+"</b>";html+='<div class="info_hover_email_link"><img '+email_title+email_img+'onclick="Behaviors.addPlaceholderEmail(this,'+data.id+');"></img></div>';html+='<div class="info_hover_embed_link_container"><div id="info_hover_embed_link" '+'onmouseover="InfoHover.register_copy_embed_link(\''+data.embed_link+','+data.id+'\');" '+'class="info_hover_embed_link" style="z-index:400"></div></div></div>';html+='<div class="info_hover_tool_tip" id="info_hover_embed_tool_tip" style="display:none">'+'Click to copy the embed code to your clipboard</div>'}
var truncateLength=160;if(data.description){var desc=data.description.stripTags();if(desc.length>truncateLength){var temp=desc.substring(0,desc.substring(0,truncateLength).lastIndexOf(' '));temp+='<span id="video_hover_additional_friends">'+desc.substring(temp.length)+'</span>'
temp+='<span id="video_hover_ellipsis" style="display:none">&#8230;</span> ';temp+='<a id="video_hover_more_desc_link" class="fb_link" style="font-weight: normal; display:none" href="#" onclick="return InfoHover.clickMoreLink()">less</a>';desc=temp;}
html+='<div class="line"><span></span></div>';html+='<p>'+desc+'</p>';}
html+=InfoHover.getAvailability(data);html+='<div id="social_video_data"></div>';if(data.offsite_video_available_info!=undefined){html+='<div class="line"><span></span></div>';html+='<div style = "margin-top: 3px;"><img style="margin-bottom:-3px" src="'+Base.imageURL('/images/icon-warning.gif?v3')+'" border="0" /><span> '+data.offsite_video_available_info+'</span></div>';}
return html;},clickMoreLink:function(){var el=$('video_hover_additional_friends');if(!el)return;if(el.visible()){el.hide();$('video_hover_ellipsis').show();$('video_hover_more_desc_link').show();$('video_hover_more_desc_link').update('more');}else{el.show();$('video_hover_ellipsis').hide();$('video_hover_more_desc_link').update('less');}
return false;},copy_embed_clip:null,copy_embed_code:null,copy_embed_hover_timeout:null,register_copy_embed_link:function(link,video_id){InfoHover.copy_embed_code="<object width='512' height='296'><param name='movie' value='"+
link+"'></param><param name='allowFullScreen' value='true'></param>"+"<embed src='"+link+"' type='application/x-shockwave-flash' "+"allowFullScreen='true' width='512' height='296'></embed></object>";if(InfoHover.copy_embed_clip==null){ZeroClipboard.setMoviePath('zero_clipboard.swf');InfoHover.copy_embed_clip=new ZeroClipboard.Client();InfoHover.copy_embed_clip.setHandCursor(true);InfoHover.copy_embed_clip.setCSSEffects(true);InfoHover.copy_embed_clip.addEventListener('complete',function(client,text){google_analytics_ajax('/share/embed/video/'+video_id);$("info_hover_embed_link").addClassName('checked');$('info_hover_embed_tool_tip').innerHTML="You have copied the embed code to your clip board";});InfoHover.copy_embed_clip.addEventListener('mouseOver',function(client){InfoHover.copy_embed_hover_timeout=Element.show.delay(1,'info_hover_embed_tool_tip');});InfoHover.copy_embed_clip.addEventListener('mouseOut',function(client){window.clearTimeout(InfoHover.copy_embed_hover_timeout);$('info_hover_embed_tool_tip').hide();});InfoHover.copy_embed_clip.addEventListener('mouseDown',function(client){InfoHover.copy_embed_clip.setText(InfoHover.copy_embed_code);});InfoHover.copy_embed_clip.glue("info_hover_embed_link");}else{InfoHover.copy_embed_clip.reposition("info_hover_embed_link");InfoHover.copy_embed_clip.show();}},update_social_comment_thumbnail:function(data){return'<div style="height: 80px"><img class="thumb" src="'+data.social_comment_thumbnail+'" border="0" /></div>';},getAvailability:function(data,force_plus,is_show){var desc,devices=[],html='';if(data.has_plus_tv)devices.push('TV');if(data.has_plus_mobile)devices.push('mobile');if(Behaviors.isPlusUser()||data.plus_only||data.has_hd||force_plus)devices.push('computer');if((devices.length>1)&&!(data.has_auth&&Auth.authenticated()&&!Behaviors.isPlusUser())){html+='<div class="line"><span></span></div>';desc=devices.pop();if(devices.length>0)
desc=devices.pop()+' and '+desc;if(devices.length>0)
desc=devices.pop()+', '+desc;else
desc+=' devices'
desc=(data.has_hd?'in HD ':'')+'on your '+desc+'.';if(force_plus||Behaviors.isPlusUser()){var badge="";if(data.has_plus_tv||data.has_plus_mobile){badge='<p><img class="cc badge" src="'+Base.imageURL('/images/icon-hulu-plus-badge-light.gif')+'" border="0" />';}
desc=badge+'Available '+desc;if(force_plus){desc+=' <a href="/plus?src='+(Behaviors.isInCanvasApp()?'canvas':'site')+'#devices" class="info-hover-tag" target="'+(Behaviors.isInCanvasApp()?'_blank':'_self')+'">Details</a>';}
desc+='</p>';}else{html+='<p><img class="cc badge" src="'+Base.imageURL('/images/icon-hulu-plus-badge-light.gif')+'" border="0" />';if(is_show){desc='Subscribe to Hulu Plus to watch '+data.avail_note+' '+desc;}else if(data.previewable&&!(data.has_auth&&Auth.authenticated())){desc='Watch a free 90 second preview or subscribe to Hulu Plus to watch the entire video now '+desc;}else{desc='Subscribe to Hulu Plus to watch now '+desc;}
desc+=' <a href="/plus?src='+(Behaviors.isInCanvasApp()?'canvas':'site')+'" class="info-hover-tag" target="'+(Behaviors.isInCanvasApp()?'_blank':'_self')+'">Learn&#160;more</a></p>';}
html+=desc;}
if(!is_show&&(!Behaviors.isPlusUser()||!data.has_plus_mobile)&&data.has_auth&&!(Auth.authenticated())){html+='<div class="line"><span></span></div>';html+='<p><img class="cc badge" src="'+Base.imageURL('/images/auth/authentication.gif')+'" border="0" />';html+='The latest episode is available on the computer through participating TV providers. ';html+='<a href="/authenticate?src='+(Behaviors.isInCanvasApp()?'canvas':'show')+'&param='+data.show_id+'" class="info-hover-tag" target="'+(Behaviors.isInCanvasApp()?'_blank':'_self')+'">Learn more</a></p>';}
return html;},update_show:function(data){if(InfoHover.hoverTypeHash['show']==null){InfoHover.hoverTypeHash['show']={};}
InfoHover.hoverTypeHash['show'][data.id]=true;var html="";var esc=InfoHover.cleanEscape;if(InfoHover.showThumbnails){html+='<img class="thumb" src="';html+=data.thumbnail_url;html+='" border="0" width="145" height="80" />';}
html+='<b>'+esc(data.name)+'</b><br/>';if(InfoHover.currentTarget.up('span')&&InfoHover.currentTarget.up('span').hasClassName('expired')){html+="<span>Not available on Hulu</span><br/>";}
var genreName=null;if(/^\/genres\/[^\/]+/i.test(document.location.pathname)){var genreNode=$$('div.title h2.cufonable')[0];if(genreNode&&!genreNode.textContent.blank()&&genreNode.textContent!='Hulu Genres'){genreName=genreNode.textContent;}}
if(!genreName&&data.channel&&!data.channel.blank()){genreName=data.channel;}
if(genreName&&!genreName.blank()){html+='<span class="channel">Genre: '+esc(genreName)+'<br/></span>';}
if(data.film_date){html+='Premiere Date: '+esc(data.film_date)+'<br/>';}
var force_plus=InfoHover.currentTarget.hasClassName('force_plus')||InfoHover.currentTarget.parentNode.hasClassName('force_plus');var show_plus=Behaviors.isPlusUser()||force_plus;var film_cnt=show_plus?data.plus_web_films_count:data.films_count;var episode_cnt=show_plus?data.plus_web_episodes_count:data.episodes_count;var clip_cnt=show_plus?data.plus_web_clips_count:data.clips_count;var season_cnt=show_plus?data.plus_web_seasons_count:data.seasons_count;if(film_cnt||episode_cnt||clip_cnt||season_cnt){counts=[]
if(film_cnt){if(film_cnt==1)
str="Movie";else
str=film_cnt+" Movies";counts.push(str);}
if(season_cnt){str=season_cnt+" Season";if(season_cnt>1)str+="s";counts.push(str);}
if(episode_cnt){str=episode_cnt+" Episode";if(episode_cnt>1)str+="s";counts.push(str);}
if(clip_cnt){str=clip_cnt+" Clip";if(clip_cnt>1)str+="s";counts.push(str);}
if(counts.length>0){html+=counts.join(', ');}}
if(data.description)
html+='<div class="line"><span></span></div>';html+='<p>'+esc(data.description)+'</p>';if((data.episodes_plus_only&&!show_plus)||data.has_plus_tv||data.has_plus_mobile||data.has_hd){html+=InfoHover.getAvailability(data,force_plus,true);}
if(data.offsite_video_available_info!=undefined){html+='<div class="line"><span></span></div>';html+='<div style = "margin-top: 3px;"><img style="margin-bottom:-3px" src="'+Base.imageURL('/images/icon-warning.gif?v3')+'" border="0" /><span> '+data.offsite_video_available_info+'</span></div>';}
return html;},update_recommend_show:function(data){var html="";var esc=InfoHover.cleanEscape;var show=data.show;var reviews=data.reviews;if(InfoHover.hoverTypeHash['show']==null){InfoHover.hoverTypeHash['show']={};}
InfoHover.hoverTypeHash['show'][show.id]=true;html+='<b>'+esc(show.name)+'</b><br/>';var show_plus=Behaviors.isPlusUser();var obj=data.show;var film_cnt=show_plus?obj.plus_web_films_count:obj.films_count;var episode_cnt=show_plus?obj.plus_web_episodes_count:obj.episodes_count;var clip_cnt=show_plus?obj.plus_web_clips_count:obj.clips_count;var season_cnt=show_plus?obj.plus_web_seasons_count:obj.seasons_count;if(film_cnt||episode_cnt||clip_cnt||season_cnt){counts=[]
if(film_cnt){if(film_cnt==1)
str="Movie";else
str=film_cnt+" Movies";counts.push(str);}
if(season_cnt){str=season_cnt+" Season";if(season_cnt>1)str+="s";counts.push(str);}
if(episode_cnt){str=episode_cnt+" Episode";if(episode_cnt>1)str+="s";counts.push(str);}
if(clip_cnt){str=clip_cnt+" Clip";if(clip_cnt>1)str+="s";counts.push(str);}
if(counts.length>0){html+=counts.join(', ');html+="<br/>";}}
if(show.primary_channel){var channel=show.primary_channel.split('|')[0];if(!channel.blank()){html+='<span class="genre">Genre: '+esc(channel)+'</span>';}}
if(show.content_rating){html+=' &nbsp;|&nbsp; ';html+='Rated: '+esc(show.content_rating);}
if(show.company&&(show.company.name||show.company.short_name)){html+=' &nbsp;|&nbsp; ';html+='Network: '+esc(show.company.name||show.company.short_name);}
if(show.original_premiere_date){html+=' &nbsp;|&nbsp; ';html+='Year: '+show.original_premiere_date;if(show.content_age_group&&show.content_age_group=='Current'){html+=' - present';}else if(show.end_date&&show.original_premiere_date<show.end_date){html+=' - '+show.end_date;}}
if(show.description)
html+='<div class="line"><span></span></div>';html+='<p>'+esc(show.description)+'</p>';if(InfoHover.currentTarget){var li=InfoHover.currentTarget.up('li');var reasons=li.select('div.recommend-reason-hover');if(reasons.length>0){html+='<div class="line"><span></span></div>';html+='<p><b>Recommended because:</b></p>';html+='<ul class="reason">';reasons.each(function(rdiv){html+='<li>';html+=rdiv.innerHTML;html+='</li>';});html+='</ul>';}
if(reviews&&reviews.length>0){html+='<div class="line"><span></span></div>';html+='<p><b>Reviews ('+parseInt(show.reviews_count)+')</b></p>';reviews.each(function(review){html+='<div class="review-title">';if(1==parseInt(review.has_avatar)){html+='<div class="avatar">'+'<img class="avatar" src="';html+='http://assets.huluim.com/users/avatar_'+parseInt(review.user_id)+'.png';html+='"/></div>';}
html+='<div class="review-time">';html+='<span>'+InfoHover.starRating(review.vote)+'&nbsp;'+esc(review.title)+'</span><br/>';html+=esc(review.display_name)+' posted '+review.posted_at+' ago.';html+='</div><br style="clear:both;"/></div>';html+=esc(review.message);});}}
return html;},update_friends_and_comments:function(data){var friends_limit=12;var comments_limit=2;var esc=InfoHover.cleanEscape;var has_friends=data.friends.length>0;var html='';if(has_friends){friends_text=data.friends.length+' friend'+(data.friends.length==1?'':'s');html+='<div style="margin-top: 6px; margin-bottom: 2px; font-size: 12px;"><a href="#" onclick="Social.Common.showFriendsPopup(true, '+data.video_id+'); return false;" class="fb_link" style="font-size: 12px;">'
+friends_text+'</a> watched this video.</div>';var count=0;for(var x=0;x<data.friends.length&&count<friends_limit;x++){var user_id=data.friends[x]['user_id'];var profile_url=Behaviors.isInCanvasApp()?'/facebook_canvas/feed?user_id'+user_id:'/profiles/u/'+user_id;html+='<span style="padding-right: 3px"><a href="'+profile_url+'" onclick="Beacon.trackSocialInteraction(this, \'avatar\');">'+'<img width="26" height="26" border="0" src="/users/picture/'+user_id+'" title="'+esc(data.friends[x]['first_name']+' '+data.friends[x]['last_name'])+'"/></a></span>';count++;}}
if(data.comments.length>0){if(has_friends){html+='<br style="clear: both;"/>';}
html+='<span style="margin-top: '+(has_friends?'3':'6')+'px; margin-bottom: 1px; font-size: 12px; font-weight: normal; display: block;">Recent Comment'+(data.comments.length>1?'s':'')+'</span>';count=0;for(var x=0;x<data.comments.length&&count<comments_limit;x++){var user=data.comments[x]['user'];var comment=data.comments[x];var comment_style=comment['spoiler']?'color: #888;':'';var comment_text=comment['spoiler']?'Comment hidden to prevent spoilers.':esc(comment['text']);var top_padding=x==0?'':'padding-top: 10px;';var profile_url=Behaviors.isInCanvasApp()?'/facebook_canvas/feed?user_id'+user['id']:'/profiles/u/'+user['id'];html+='<div class="clearfix" style="'+top_padding+'"><span style="padding-right: 3px; padding-top: 1px; float: left;font-size: 11px;"><a href="'+
profile_url+'" onclick="Beacon.trackSocialInteraction(this, \'avatar\');"><img width="26" height="26" border="0" src="/users/picture/'+user['id']+'"/></a></span>';html+='<span style="float: right; width: 90%; margin-top: -3px; padding-bottom: 1px;font-size: 12px;">'+'<span style="line-height: 15px; margin-right: 10px;">'+'<a class="fb_link" style="font-weight: bold;" href="'+profile_url+'" onclick="Beacon.trackSocialInteraction(this, \'avatar\');">'+esc(user['first_name']+' '+user['last_name'])+'</a>'+'</span>'+'<div style="font-size: 11px; '+comment_style+'"><span style="font-weight: bold;">'+FacebookCanvas.Comment.friendlyTimeFormat(comment['start_at'])+'</span>&nbsp;"'+comment_text+'"'+'<span style="font-size: 11px; color: #959595; margin-left: 7px;">'+timeAgoInWords(comment['created_at'].replace('Z',' GMT'))+'</span></div>'+'</span></div>';;count++;}
if(data.comment_count>2){html+='<div style="clear: both; padding-top: 3px; float: left;"><a href="'+data.watch_link+'" class="fb_link" '+'target="'+(data.blank_target?'_blank':'_self')+'" onclick="Beacon.trackSocialInteraction(this, \'view_all_comments\');">View All '+data.comment_count+' Comments</a></div>';}}
if(html.length>0){InfoHover.videoHoverWasSocial[data.video_id]=true;html='<div class="line"><span></span></div><div class="beaconregion" beaconregion="hover">'+html+'</div>';}
return html;},update_friends:function(data){var esc=InfoHover.cleanEscape;var friends_limit=12;var comments_limit=2;var html='<div style="margin: 0 15px 5px 15px;">';for(var x=0;x<data.friends.length;x++){var user_id=data.friends[x]['user_id'];var first_name=data.friends[x]['first_name'];var last_name=data.friends[x]['last_name'];var href='/facebook_canvas/feed?user_id='+user_id
html+='<div style="padding: 9px 3px 0px 0px;"><span style="padding-right: 3px">';html+='<a href="'+href+'">'+'<img width="32" height="32" border="0" src="/users/picture/'+user_id+'"/></a></span>';html+='<div style="float: right; width: 82%; margin-top: -4px;"><div style="margin-bottom: 10px;"><a class="fb_link"  style="font-weight: bold; font-size: 12px;" href="'+href+'">'+esc(first_name+' '+last_name)+'</a></div>';html+='</div></div>';if(x<data.friends.length-1){html+='<div class="line"><span></span></div>';}}
html+='</div>';return html;},update_addqueue:function(data){return data.plus_avail;},update_collection:function(data){var html="";var esc=InfoHover.cleanEscape;html+='<p><b>'+esc(data[1])+'</b>';html+=' ('+data[3]+(parseInt(data[3])>1?" videos":" video")+") </p>";if(data[2]){html+='<div class="line"><span></span></div>';html+='<p>'+esc(data[2])+'</p>';}
return html;},update_user:function(data){var html="";var esc=InfoHover.cleanEscape;var user_id=data.user_id;var favorites_limit=5;var num_friends=parseInt(data.num_friends);var viewed_videos_count=parseInt(data.viewed_videos_count);var profile_url='/profiles/u/'+user_id;if(data.username){profile_url='/profiles/'+data.username;}
if(Behaviors.isInCanvasApp()){profile_url='/facebook_canvas/feed?user_id='+user_id;}
html+='<span style="float: left; padding-top: 5px;"><a href="'+profile_url+'"><img width="52" height="52" border="0" src="/users/picture/'+user_id+'"/></a></span>';html+='<div style="float: left; margin-left: 8px; font-size: 11px;"><a href="'+profile_url+'" class="fb_link" style="font-size: 12px;">'+esc(data.display_name)+'</a><br/>';if(data.location){html+=esc(data.location)+'<br/>';}
if(num_friends>0){html+=data.num_friends+' Friend'+(num_friends>1?'s':'')+'<br/>';}
if(viewed_videos_count>0){html+=data.viewed_videos_count+' Video'+(viewed_videos_count>1?'s':'')+' watched<br/>';}
html+='</div>';if(data.favorites.length>0){html+='<div class="line" style="margin-bottom: 6px; margin-top: 12px;"><span></span></div><div><span style="font-weight: bold;">Favorite Shows</span></br>';html+='<ol style="padding-top: 5px; margin-bottom: 1px;">';var count=0;for(var x=0;x<data.favorites.length&&count<favorites_limit;x++){html+='<li>'+esc(data.favorites[x]['name'])+'</li>';}
if(!Behaviors.isInCanvasApp()){html+='</ol><span><a href="/profiles/u/'+user_id+'/public_favorites" class="fb_link">see all</a></span></div>';}}
return html;},update_cast:function(data){var esc=InfoHover.cleanEscape;var roles=(data[1].length==0)?new Array():data[1].split(';');var episodeCount=data[2];var clipCount=data[3];var contentRating=data[4];html="";if(episodeCount>0)
html+='<div style="float:left;width:35%;text-align:right;padding-right: 8px;">Episodes:</div><div style="float:left;width:55%;">'+episodeCount+'</div>';if(clipCount>0)
html+='<div style="float:left;width:35%;text-align:right;padding-right: 8px;">Clips:</div><div style="float:left;width:55%;">'+clipCount+'</div>';html+='<div style="float:left;width:35%;margin-bottom:6px;text-align:right;padding-right: 8px;">Rating:</div><div style="float:left;width:55%;margin-bottom:6px;">'+contentRating+'</div>';for(i=0;i<roles.length;i++)
{if(roles[i].split(':')<2)continue;roleType=roles[i].split(':')[0];roleNames=roles[i].split(':')[1].split(',');if(roleNames.length>3)
{roleNames=roleNames.slice(0,3);roleNames.push('...');}
for(j=0;j<roleNames.length;j++)
{if(roleNames[j].length>14)
{names=roleNames[j].split(' ');if(names.length>1)names[1]=names[1].substring(0,1)+'.';roleNames[j]=names.join(' ');}}
roleNames=roleNames.join('<br/>');html+='<br/><div class="line" style="margin-bottom:6px;margin-top:5px;"><span></span></div>';html+='<div style="float:left;width:35%;margin-bottom:6px;text-align:right;padding-right: 8px;">'+esc(roleType)+':</div><div style="float:left;width:55%;margin-bottom:6px;">'+esc(roleNames)+'</div>';}
return html;},update_preview:function(data){InfoHover.fadeDuration=0.8;var esc=InfoHover.cleanEscape;var pid=data[1];var clickThrough=data[2];html="";html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="288" height="162" id="videoPreviewPlayer">'
html+='<param name="movie" value="/QuickPreviewPlayer.swf" />'
html+='<param name="flashvars" value="stageWidth=288&stageHeight=162&pid='+pid+'" />'
html+='<param name="quality" value="high" />'
html+='<param name="bgcolor" value="#999999" />'
html+='<param name="allowScriptAccess" value="always" />'
html+='<param name="wmode" value="transparent" />'
html+='<embed height="162" width="288" wmode="transparent" '
html+='flashvars="stageWidth=288&stageHeight=162&pid='+pid+'" quality="high" bgcolor="#999999" '
html+='name="videoPreviewPlayer"  src="/QuickPreviewPlayer.swf" type="application/x-shockwave-flash" '
html+='allowScriptAccess="always" swliveconnect="true"/>'
html+='</object>'
return html;},cleanEscape:function(s){return s?s.escapeHTML().replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"";},starRating:function(n){var stars="";n=parseFloat(n);var type;$R(1,5).each(function(rating){type=rating<=Math.floor(n)?'full':(rating==Math.round(n)?'half':'empty');stars+='<img src="';stars+=Base.imageURL('/images/rating_'+type+'.gif');stars+='" height="11" width="11" border="0" alt="Rating star" />';});return stars;},show:function(data){var hover=$('info_hover');if(hover&&hover.style.display=='none'){InfoHover.update(data);if(InfoHover.currentType=='video'&&/^\d+$/.test(data.id)){var url='/social/friends_and_comments_for_video?video_id='+data.id+'&in_canvas='+(Behaviors.isInCanvasApp()?1:0)+"&cb="+(new Date).getTime();if(InfoHover.cache[url]){InfoHover.updateVideoSocialData(InfoHover.cache[url]);InfoHover.displayHover();}
else{new Ajax.Request(url,{method:'get',onSuccess:function(trans){try{var obj=eval('('+trans.responseText+')');InfoHover.cache[url]=obj;InfoHover.updateVideoSocialData(obj);}
catch(e){}
InfoHover.displayHover();},onFailure:function(trans){InfoHover.displayHover();}});}}
else{InfoHover.displayHover();}}},updateVideoSocialData:function(obj){var social_video_data=$$('div#info_hover').first().down('div#social_video_data');var socialData=InfoHover.update_friends_and_comments(obj);if(!socialData.blank()){social_video_data.update(socialData);InfoHover.clickMoreLink();}},displayHover:function(){var hover=$('info_hover');if(hover&&hover.style.display=='none'){var dim=hover.getDimensions();var bounds=InfoHover.currentBounds;var viewport=Element.viewportOffset(InfoHover.currentTarget);var forcedYOffset=0;if($(InfoHover.currentTarget).up('.homepage_activity')!=null){forcedYOffset=-1*parseInt($(InfoHover.currentTarget).up('.homepage_activity').scrollTop);}else if($(InfoHover.currentTarget).up('.choose-shows-grid')!=null){forcedYOffset=-1*parseInt($(InfoHover.currentTarget).up('.choose-shows-grid').scrollTop);}
var loc=InfoHover.determineTailLocation(dim,InfoHover.currentBounds,viewport,forcedYOffset);hover.style.left=loc.x+'px';hover.style.top=loc.y+'px';InfoHover.removeTailClassNames(hover);hover.addClassName(loc.className);InfoHover.hideWindowedControls();InfoHover.currentEffect=new Effect.Appear(hover,{duration:InfoHover.fadeDuration,afterFinish:function(){if(InfoHover.currentType!=null&&InfoHover.currentId!=null){var socialDataPresent=InfoHover.currentType=='video'&&InfoHover.videoHoverWasSocial[InfoHover.currentId]!=null&&InfoHover.videoHoverWasSocial[InfoHover.currentId]==true;Beacon.trackHover(InfoHover.currentType,InfoHover.currentId,socialDataPresent);InfoHover.currentType=null;InfoHover.currentId=null;}
InfoHover.currentEffect=null;Hover.makeSandy();Cufon.replace('h3.cufonable',{fontFamily:'Futura'});}});}},removeTailClassNames:function(el){el.removeClassName('top-right');el.removeClassName('mid-right');el.removeClassName('bottom-right');el.removeClassName('top-left');el.removeClassName('mid-left');el.removeClassName('bottom-left');el.removeClassName('center-north');el.removeClassName('center-south');},determineTailLocation:function(hoverDim,target,viewport,forcedYOffset){var docViewport=document.viewport.getDimensions();var offset=InfoHover.TAIL_OFFSET;hoverDim.width+=InfoHover.TAIL_WIDTH;var lr="right";var x=target.left+target.width+offset;if(viewport.left+target.width+hoverDim.width>docViewport.width){lr="left";x=target.left-hoverDim.width-offset;}
var tmb="mid";var y=target.top+target.height/2-hoverDim.height/2-(InfoHover.VERTICAL_OFFSET*0.75);if(viewport.top+target.height/2-hoverDim.height/2+hoverDim.height>docViewport.height){tmb="bottom";y=target.top-hoverDim.height;try{if(Prototype.Browser.IE&&$('masthead')){var topLimit=Position.cumulativeOffset($('masthead-container'))[1]+383
if(y<topLimit){y=target.top+target.height/2-hoverDim.height/2-(InfoHover.VERTICAL_OFFSET*0.75);var tmb="mid";}}}
catch(e){tmb="bottom";y=target.top-hoverDim.height;}}
if(y<0||(viewport.top+target.height/2-hoverDim.height/2<0)){tmb="top";y=target.top+target.height;}
try{if($('player-container')){var topLimit=Position.cumulativeOffset($('player-container'))[1]+442;if(y<topLimit){y=target.top+target.height;tmb="top";}}}
catch(e){}
if(x<=0){if(viewport.top<hoverDim.height){lr="south";y=target.top+target.height+InfoHover.VERTICAL_OFFSET;}
else{lr="north";y=target.top-hoverDim.height-InfoHover.VERTICAL_OFFSET*2.5;}
tmb="center";x=target.left+target.width/2-hoverDim.width/2;}
if(forcedYOffset!=null){y+=forcedYOffset;}
var loc=[x,y,lr,tmb];loc.x=x;loc.y=y;loc.horiz=lr;loc.vert=tmb;loc.className=[loc.vert,loc.horiz].join('-');return loc;},showWindowedControls:function(){var hover_div=$$('div#info_hover').first();if(hover_div){hover_div.removeClassName('not-clickable');var content=hover_div.down('div.content');content.update('');}
if(!Prototype.Browser.IE6)return;if($('search-result')&&$('search-result').visible())return;$$('select').each(function(el){el.style.visibility='visible';});},hideWindowedControls:function(){if(!Prototype.Browser.IE6)return;if($('search-result')&&$('search-result').visible())return;$$('select').each(function(el){el.style.visibility='hidden';});},addInCache:function(objs){objs=$A(objs);for(var i=0;i<objs.size();i++){var obj=eval(objs[i]);InfoHover.cache[obj.url]=obj;}}};Ajax.Responders.register({onComplete:InfoHover.observeLinks});Event.observe(document,'dom:loaded',InfoHover.init);
var ThumbnailLazyLoad={thumbnails:[],disabled:false,updating:false,hiden:false,in_browse:false,num:0,init:function(){if(ThumbnailLazyLoad.disabled){$$('.thumbnail').each(function(img){if(img.getAttribute('data-src')!=null)
img.src=img.getAttribute('data-src');});return;}
if(ThumbnailLazyLoad.in_browse){var block=$('browse_table_'+Browse.block_num);if(!block||block.hasClassName('lazy-loaded'))return;block.addClassName('lazy-loaded');var thumbs=block.select('img.thumbnail');if(Browse.block_num==0){ThumbnailLazyLoad.num=0;ThumbnailLazyLoad.thumbnails=[];}}else{if($('lazy-load-0')!=null)return;ThumbnailLazyLoad.num=0;ThumbnailLazyLoad.thumbnails=[];var thumbs=$$('img.thumbnail');}
var thumbnails=[];var src;thumbs.each(function(img,i){src=img.getAttribute('data-src');if(src==null){if(ThumbnailLazyLoad.in_browse)
return;src=img.src;img.src=(img.height=="209"?Base.imageURL('/images/loading-trailer-thumbnail.gif'):Base.imageURL('/images/loading-thumbnail.gif'));img.setAttribute('data-src',src);}
img.id='lazy-load-'+ThumbnailLazyLoad.num;ThumbnailLazyLoad.num++;thumbnails.push({id:img.id,src:src});});ThumbnailLazyLoad.thumbnails=ThumbnailLazyLoad.thumbnails.concat(thumbnails);Event.observe(window,'scroll',ThumbnailLazyLoad.updateViewport);Event.observe(window,'resize',ThumbnailLazyLoad.updateViewport);ThumbnailLazyLoad.updateViewport();},updateViewport:function(){if(ThumbnailLazyLoad.updating||ThumbnailLazyLoad.hiden)return;if(ThumbnailLazyLoad.in_browse){ThumbnailLazyLoad.updateViewport_inbrowse();return;}
ThumbnailLazyLoad.updating=true;var top=document.viewport.getScrollOffsets();top=top.top+(document.viewport.getHeight()||document.documentElement.clientHeight);var thumbnails=$A(ThumbnailLazyLoad.thumbnails);thumbnails=thumbnails.select(function(info){var img=$(info.id);if(img){var offset=img.cumulativeOffset();if(top>=offset.top-20){img.src=info.src;return false;}}
return true;});if(thumbnails.length==0){Event.stopObserving(window,'scroll',ThumbnailLazyLoad.updateViewport);Event.stopObserving(window,'resize',ThumbnailLazyLoad.updateViewport);}
ThumbnailLazyLoad.thumbnails=thumbnails;ThumbnailLazyLoad.updating=false;},updateViewport_inbrowse:function(){ThumbnailLazyLoad.updating=true;var top=document.viewport.getScrollOffsets().top+document.viewport.getHeight();var top_off=top+20;var thumbnails=$A(ThumbnailLazyLoad.thumbnails);var size=thumbnails.length;var img,offset,i;for(i=0;i<size;i++){img=$(thumbnails[i].id);if(img){offset=img.cumulativeOffset().top;if(top_off>=offset){img.src=thumbnails[i].src;}else{break;}}}
if(i==size){Event.stopObserving(window,'scroll',ThumbnailLazyLoad.updateViewport);Event.stopObserving(window,'resize',ThumbnailLazyLoad.updateViewport);}
ThumbnailLazyLoad.thumbnails=thumbnails.slice(i);ThumbnailLazyLoad.updating=false;}};document.observe('dom:loaded',ThumbnailLazyLoad.init);
var Superbowl=Class.create();Object.extend(Superbowl,{curr:0,timer:null,playVideo:function(content_id){if(typeof(Adzone)!='undefined'){Adzone.playVideo(content_id);var swf=$(Adzone.State.swfId);if(swf.playbackStarted){swf.playbackStarted(Adzone.State.currentVideoId);}
return false;}
return true;},choose:function(el){if(!el.hasClassName('video-wrapper'))
el=el.up(".video-wrapper");if(el.hasClassName("washed-out"))
return;var id=el.id.substring(4);el.down('input.radio-button').checked=true;$$('.video-wrapper').each(function(el){el.removeClassName("selected");});$("vwr-"+id).addClassName("selected");Superbowl.curr=id;},submit_vote:function(){var slider=$('clip-voting-container').down('div.vsl')
$$('.video-wrapper').each(function(el){if(el.hasClassName("selected")){var id=el.id.substring(4);Superbowl.curr=id;var np=el.down('.currently-playing');if(np)np.hide();}});if(!Superbowl.curr||Superbowl.curr==0){$$('.error-message').invoke("show");}
else{var current_video=VideoSlider.currentVideoId()||0;var url=(document.domain.indexOf("huluqa.com")!=-1||document.domain.indexOf("localhost")!=-1?"track.qa":"t");pingImage("http://"+url+".hulu.com/beacon/v2/movetest?version="+Superbowl.curr+"&os="+(current_video==0?"sb":current_video)+"&browser="+Behaviors.getGUID()+"&cb="+(new Date).getTime());$$('.btn-vote').invoke("hide");$$('.error-message').invoke("hide");$$('.voting-pane .sort-filter').invoke("hide");$$('.thank-you-note').invoke("show");$$('#clip-voting-container input.radio-button').invoke("hide");$$('#clip-voting-container .video-wrapper').invoke("addClassName","washed-out");$$('#clip-voting-container .empty div').invoke("addClassName","washed-out");$('vwr-'+Superbowl.curr).addClassName("final");$('vwr-'+Superbowl.curr).removeClassName("selected");$('vwr-'+Superbowl.curr).removeClassName("washed-out");Superbowl.clearTimer();}},clearTimer:function(){if(Superbowl.timer){clearTimeout(Superbowl.timer);Superbowl.timer=null;}},setTimer:function(){Superbowl.timer=setTimeout('window.location.reload(true)',600000);},showPane:function(){document.observe('dom:loaded',Superbowl.loadPane);Event.observe(window,"load",Superbowl.loadPane);setTimeout(Superbowl.loadPane,500);setTimeout(Superbowl.loadPane,1000);setTimeout(Superbowl.loadPane,2500);setTimeout(Superbowl.ensureSlider,2500);},paneLoaded:false,paneLoading:false,sliderPage:-1,loadPane:function(){if(Superbowl.paneLoaded||Superbowl.paneLoading)return;Superbowl.paneLoading=true;new Ajax.Request('/adzone/pane',{method:'get',onSuccess:function(request){Superbowl.paneLoaded=true;Element.update('sb-voting-pane',request.responseText);Behaviors.applyCufon();Behaviors.toggleFirstDescendant('#sb-voting-pane span.play-button-hover');var klass='voteable-item-'+VideoSlider.currentVideoId();var els=$$('.video-wrapper');var selected=null;Superbowl.sliderPage=-1;els.find(function(el,i){if(el.hasClassName(klass)){selected=el;Superbowl.sliderPage=Math.floor(i/5)+1;throw $break;}});Superbowl.sliderPage=parseInt(Superbowl.sliderPage);setTimeout(function(){if(selected){Superbowl.choose(selected);}
Superbowl.moveSliderToPage();},500);},onComplete:function(){Superbowl.paneLoading=false;}});},sliderLoaded:false,moveSliderToPage:function(){if((/^#s-/).test(window.location.hash))return;if(Superbowl.sliderLoaded)return;if(superbowl_slider){var page=Superbowl.sliderPage>0?Superbowl.sliderPage:1;superbowl_slider.move(null,page);Superbowl.sliderLoaded=true;}},ensureSlider:function(){Superbowl.moveSliderToPage(1);},rearrange:function(slider,page){var lis=slider.inr.getElementsBySelector("li").partition(function(el){return!el.hasClassName('empty')});var rest=lis[0];var empties=lis[1];rest=$A(rest).partition(function(li){return!!li.down('div.selected');});lis=$A([rest[1],empties]).flatten();if(rest[0]&&rest[0][0])
lis.unshift(rest[0][0]);rest=null;empties=null;var current=0;lis.each(function(li,i){if(li.hasClassName('absolutized'))return;slider.calculateItemWidth();var y=0;var x=(this.pageWidth*(page-1))+current*this.itemWidth;var ipl=parseInt(this.urlOptions.items_per_line);if(current>=ipl){y=(current/ipl).floor()*160;x-=(current/ipl).floor()*this.itemWidth*ipl;}
li.style.position='absolute';li.style.top=y+"px";li.style.left=x+"px";li.addClassName('absolutized');current+=1;}.bind(slider));slider.sld.style.left='0px';},showResults:function(){document.observe('dom:loaded',Superbowl.loadResultsPane);Event.observe(window,"load",Superbowl.loadResultsPane);setTimeout(Superbowl.loadResultsPane,500);},resultsPaneLoaded:false,resultsPaneLoading:false,loadResultsPane:function(){if(Superbowl.resultsPaneLoaded||Superbowl.resultsPaneLoading)return;Superbowl.resultsPaneLoading=true;new Ajax.Request('/adzone/results_loader',{method:'get',onSuccess:function(request){Superbowl.resultsPaneLoaded=true;Element.update('sb-results-pane',request.responseText);Behaviors.applyCufon();Behaviors.toggleFirstDescendant('#sb-results-pane span.play-button-hover');},onComplete:function(){Superbowl.resultsPaneLoading=false;}});}});
var Friend=Class.create();Object.extend(Friend,{busy:false,added:{},publicFriends:{},FACEBOOK_SETTINGS:new Array(650,450,1),MYSPACE_SETTINGS:new Array(950,820,0),WINDOWS_SETTINGS:new Array(900,550,0),GOOGLE_SETTINGS:new Array(650,500,0),YAHOO_SETTINGS:new Array(825,655,1),popupWindow:'',facebookLogin:function(response){if(typeof(FB)!='undefined'){FB.login(function(response){if(response.authResponse){Friend.pop("/friends/facebook",Friend.FACEBOOK_SETTINGS);}});}},pop:function(url,settings){if(Friend.popupWindow&&!Friend.popupWindow.closed&&Friend.popupWindow.location){Friend.popupWindow.location.href=url;}
else{Friend.popupWindow=window.open(url,"friendpopup","toolbar=0,status=0,resizable=1,scrollbars="+settings[2]+",width="+settings[0]+",height="+settings[1]);if(Friend.popupWindow){if(!Friend.popupWindow.opener)
Friend.popupWindow.opener=self;}
else{ModalPopup.warn("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
if(window.focus)
Friend.popupWindow.focus();return false;},popdown:function(url){if(opener&&!opener.closed){opener.location.href=url;}
else{p=window.open(url,"_blank","toolbar=0,status=0,resizable=1,scrollbars=1,width=600,height=450");if(!p){ModalPopup.warn("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}},show_delauth:function(provider){switch(provider){case"facebook":settings=Friend.FACEBOOK_SETTINGS;break;case"myspace":settings=Friend.MYSPACE_SETTINGS;break;case"windows":settings=Friend.WINDOWS_SETTINGS;break;case"google":settings=Friend.GOOGLE_SETTINGS;break;case"yahoo":settings=Friend.YAHOO_SETTINGS;break;default:return false;}
if(provider=='facebook')
url="/friends/facebook_connect"
else
url="/friends/"+provider;Friend.pop(url,settings);},add_friend:function(target_id,add_friend_div){if(Friend.added[target_id])return;new Ajax.Request('/friends/add_friend',{parameters:{user_id:target_id},method:'post',onSuccess:function(req){Friend.added[target_id]=true;Friend.setPending(add_friend_div);},onFailure:function(req){$('add-friend-status').update('<img src="'+Base.imageURL('/images/icon-warning.gif')+'" style="padding-right: 4px; float: left;">'+'<div style="float: left; width: 280px; padding-bottom: 5px;">Oops!  Something went wrong. '+'Please contact <a href="mailto:support@hulu.com">support@hulu.com</a> if this issue persists.</div>'+'<br style="clear: both;"/>');}});},setPending:function(add_friend_div){$(add_friend_div).update('<img src="'+Base.imageURL('/images/icon-check.gif')+'" style="vertical-align: middle; padding-right: 5px;"><span style="color: #777; font-size: 11px;">Friend invitation sent.</span>');$(add_friend_div).show();},setFriend:function(add_friend_div,send_msg_div,allow_message){$(add_friend_div).hide();if(allow_message===true){$(send_msg_div).show();}
else{$(send_msg_div).hide();}},addPublicFriends:function(friend_id,add_friend_div,send_msg_dir,allow_message){if(Behaviors.getUserId()==friend_id){if($(add_friend_div)){$(add_friend_div).hide();}
if($(send_msg_dir)){$(send_msg_dir).hide();}}
else{Friend.publicFriends[friend_id]=[add_friend_div,send_msg_dir,allow_message];}},checkStatus:function(){if(!Behaviors.isLoggedIn())return;var friends=$H(Friend.publicFriends);if(friends.keys().length==0)return;var url="/social/friend_states";new Ajax.Request(url,{parameters:{"friend_ids":friends.keys().join(),"user_id":Behaviors.getUserId(),"cb":(new Date).getTime()},method:'get',onSuccess:function(transport){var results=transport.responseText.evalJSON();var friends=Friend.publicFriends;for(var friend_id in results){var add_friend_div=friends[friend_id][0];var send_msg_div=friends[friend_id][1];var allow_message=friends[friend_id][2];switch(results[friend_id]){case"friend":Friend.setFriend(add_friend_div,send_msg_div,allow_message);break;case"pending":Friend.setPending(add_friend_div);break;default:$(add_friend_div).show();}}}});},toggle_pending_list:function(action){if(action=='hide'){$('friends-pending-list-hide').hide();$('friends-pending-list-show').show();$('friends-pending-list').hide();}
else if(action=='show'){$('friends-pending-list-show').hide();$('friends-pending-list-hide').show();$('friends-pending-list').show();}},select_pending_list:function(action){if(action){$$('input.pending-friends-check').each(function(el){if(!el.disabled){el.checked=true;el.up('div.item').addClassName('selected');}});$('friends-pending-select').checked=true;}
else{$$('input.pending-friends-check').each(function(el){if(!el.disabled){el.checked=false;el.up('div.item').removeClassName('selected');}});$('friends-pending-select').checked=false;}},select_invite_emails:function(action){if(action){$$('input.invite-emails-check').each(function(el){if(!el.disabled){el.checked=true;el.up('div.item').addClassName('selected');}});$('friends-invite-emails-select').checked=true;}
else{$$('input.invite-emails-check').each(function(el){if(!el.disabled){el.checked=false;el.up('div.item').removeClassName('selected');}});$('friends-invite-emails-select').checked=false;}},process_pending:function(){$$('input.pending-friends-check').each(function(el){if((el.checked)&&(!el.disabled)){el.disabled=true;el.checked=false;el.up().addClassName('disabled');el.up().addClassName($('pending-action').value);el.up().removeClassName('selected');}});all_pending_finished=true;$$('input.pending-friends-check').each(function(el){if(!el.disabled){all_pending_finished=false;}});if(all_pending_finished){$('friends-pending-list').up('div.friends-pending').fade({duration:1.0});}
Pagination.loading($('friends-page-replace').down('.pagination-loading'));new Ajax.Updater('friends-page-replace','/friends/list?order=DESC&page=1&public=0&sort=updated_at&with_master=1&cb='+(new Date).getTime(),{asynchronous:true,evalScripts:true,method:'get',onComplete:function(request){Pagination.doneLoading($('friends-page-replace').down('.pagination-loading'));}});},validate_search_input:function(){var email=$('email').value.strip();var first_name=$('first_name').value.strip();var last_name=$('last_name').value.strip();if(email==''&&(first_name==''||last_name=='')){$('find-friends-error').update('Please type in an email address or full name.');return false;}
if(email!=''&&!Support.rfc822Email.test(email)){$('find-friends-error').update('Please provide a valid email address.');$('email').focus();return false;}
return true;},validate_invite_input:function(type){if(type=='invite'){var email=$('email').value.strip();if(email!=''&&!Support.rfc822Email.test(email)){$('invite-friends-error').update('Please provide a valid email address.');$('email').focus();return false;}}
else if(type=='request'){var valid=false;$$('input.pending-friends-check').each(function(el){if(!el.disabled&&el.checked){valid=true;}});if(!valid){$('invite-friends-error').update('Please select someone to invite.');return false;}}
return true;},process_search:function(){if($('search_action').value=='invite'){$('email').addClassName('disable');$('message').addClassName('disable');$('email').disable();$('message').disable();$('invite-friends-error').update('Thank you for inviting your friend to Hulu.');}
else{$$('input.pending-friends-check').each(function(el){if((el.checked)&&(!el.disabled)){el.disabled=true;el.checked=false;el.up().addClassName('disabled');el.up().addClassName('accept');el.up().removeClassName('selected');}});}},remove:function(el,id,confirmed){if(el){var source_input=el.down('input#friend-'+id+'-source');if(source_input&&source_input.value=='facebook'){ModalPopup.warn("Please manage your Facebook friend on Facebook.");return;}}
if(!confirmed){$('friend-remove-id').value=id;$('friend-remove-name').update($('friend-'+id+'-name').value);FloatingDiv.show(el,$('confirm-friend-remove'),400);}
else{FloatingDiv.hide();new Ajax.Request('/friends/remove_friend',{parameters:{user_id:id},method:'post',onSuccess:function(trans){$('friend-top-level-'+id).hide();$$('.friends-count-container .count').each(function(el){var current_count=parseInt(el.innerHTML.match(/[0-9]+/));if(current_count>0){var new_count=current_count-1;el.innerHTML='('+new_count.toString()+')';}});},onFailure:function(trans){var result=trans.responseText.evalJSON(true);if(result&&result.msg){ModalPopup.warn(result.msg);}}});}},disconnect_social:function(el,group,confirmed){if(!confirmed){FloatingDiv.show(el,$('confirm-social-remove-'+group),300);}
else{FloatingDiv.hide();$('social-remove-'+group).update('<span>[ Click to Disconnect ]</span>');sp=$('social-remove-'+group).down('span');sp.fade({duration:1.0});new Ajax.Request('/friends/remove_social_group',{parameters:{social_group:group},method:'post'});}}});
var Note=Class.create();Object.extend(Note,{singleSubmitLock:false,hover:function(note_id,hoverOn)
{if(hoverOn)
$('n-'+note_id+'-item-container').addClassName("active");else
$('n-'+note_id+'-item-container').removeClassName("active");},show:function(user_id,user_name){$('notes-form-body').value='';$('notes-form-user-id').value=user_id;$('notes-error-container').hide();Element.update('notes-form-errors','');Element.hide('notes-form-loading');Element.update('note-user-name','Send '+user_name.escapeHTML()+' a message');ModalPopup.display_div($('notes-modal-containter'),575,300);},submit:function(){if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
Note.doSubmit();}});return false;}
else{Note.doSubmit();}
return false;},doSubmit:function(){if(Note.singleSubmitLock)
return false;else
Note.singleSubmitLock=true;if($('notes-form-user-id').value==''){Note.singleSubmitLock=false;return false;}
Element.update('notes-form-errors','');Element.show('notes-form-loading');$('notes-error-container').hide();new Ajax.Request('/notes/new',{asynchronous:true,evalScripts:true,onFailure:function(request){$('notes-error-container').update("Oops!  Something went wrong.  Please contact <a href=\"mailto:support@hulu.com\">support@hulu.com</a> if \
             this issue persists.");$('notes-error-container').show();$('notes-form-loading').hide();},onComplete:function(request){Note.singleSubmitLock=false;},parameters:Form.serialize($('notes-form'))});return false;},hide:function(el,id,type){new Ajax.Request('/notes/hide/'+id,{asynchronous:true,evalScripts:true,method:'post'});el.blindUp({duration:0.3});}});
var Notification=Class.create();Object.extend(Notification,{hide:function(el,id,type){new Ajax.Request('/notifications/hide/'+id,{asynchronous:true,evalScripts:true,method:'post'});el.blindUp({duration:0.3});}});
var Activity=Class.create();Object.extend(Activity,{loading:false,current:'all',populateActivitiesFor:function(id,type,of_friends){new Ajax.Updater('activities-container','/activities/list'+'/default'+'/'+of_friends+'/'+id+'/'+type,{asynchronous:true,evalScripts:true,method:'get',onComplete:function(req){Activity.loading=false;$('activities-preview-loading').hide();}});},toggleSelection:function(selection,id,type){if(Activity.loading){return;}
Activity.loading=true;$('activities-preview-loading').show();if((Activity.current!='all')&&(selection=='all')){Activity.current='all';Activity.populateActivitiesFor(id,type,0);}
else if((Activity.current!='friends')&&(selection=='friends')){Activity.current='friends';Activity.populateActivitiesFor(id,type,1);}},createNewReview:function(el,reviewable_id,reviewable_type){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
Activity.doCreateNewReview(reviewable_id,reviewable_type);}});}
else{Activity.doCreateNewReview(reviewable_id,reviewable_type);}
return false;},doCreateNewReview:function(reviewable_id,reviewable_type){$('activities-preview-loading').show();var url='/reviews/tab_load?reviewable_id='+reviewable_id+'&reviewable_type='+reviewable_type+'&form_active=1';Tab.loadTab('reviews',url,true,null);window.scrollTo(0,400);return false;},createNewTopic:function(el,topicable_id,topicable_type){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
Activity.doCreateNewTopic(topicable_id,topicable_type);}});}
else{Activity.doCreateNewTopic(topicable_id,topicable_type);}
return false;},doCreateNewTopic:function(topicable_id,topicable_type){$('activities-preview-loading').show();var url='/topics/tab_load?topicable_id='+topicable_id+'&topicable_type='+topicable_type+'&form_active=1&segregate_video=false';Tab.loadTab('forums',url,true,null);window.scrollTo(0,400);return false;},hide:function(el,id,type){new Ajax.Request('/activities/hide?'+'related_id='+id+'&related_type='+type,{asynchronous:true,evalScripts:true,method:'post'});el.blindUp({duration:0.3});}});
var FriendSelector=Class.create(TextboxList,{loptions:$H({autocomplete:{'opacity':1.0,'maxresults':5,'minchars':1}}),initialize:function($super,element,autoholder,options,func){$super(element,options);this.data=[];this.autoholder=$(autoholder).setOpacity(this.loptions.get('autocomplete').opacity);this.autoholder.observe('mouseover',function(){this.curOn=true;}.bind(this)).observe('mouseout',function(){this.curOn=false;}.bind(this));this.autoresults=this.autoholder.select('ul').first();var children=this.autoresults.select('li');children.each(function(el){this.add({value:el.readAttribute('value'),name:el.innerHTML});},this);},autoShow:function(search){this.autoholder.setStyle({'display':'block'});this.autoholder.descendants().each(function(e){e.hide()});if(!search||!search.strip()||(!search.length||search.length<this.loptions.get('autocomplete').minchars))
{this.autoholder.select('.default').first().setStyle({'display':'block'});this.resultsshown=false;}else{this.resultsshown=true;this.autoresults.setStyle({'display':'block'}).update('');if(this.options.get('wordMatch'))
var regexp=new RegExp("(^|\\s)"+search,'i')
else
var regexp=new RegExp(search,'i')
var count=0;this.data.filter(function(str){return str?regexp.test(str.evalJSON(true).name):false;}).each(function(result,ti){count++;if(ti>=this.loptions.get('autocomplete').maxresults)return;var that=this;var el=new Element('li');el.observe('click',function(e){e.stop();that.autoAdd(this);}).observe('mouseover',function(){that.autoFocus(this);}).update(this.autoHighlight(result.evalJSON(true).name,search));var img=new Element('img',{'src':result.evalJSON(true).avatar,'class':'thumbnail'});el.insert({top:img});this.autoresults.insert(el);el.cacheData('result',result.evalJSON(true));if(ti==0)this.autoFocus(el);},this);}
if(count==0)this.autocurrent=false;if(count>this.loptions.get('autocomplete').maxresults)
this.autoresults.setStyle({'height':(this.loptions.get('autocomplete').maxresults*45)+'px'});else
this.autoresults.setStyle({'height':(count?(count*45):0)+'px'});return this;},autoHighlight:function(html,highlight){return html.gsub(new RegExp(highlight,'i'),function(match){return'<em>'+match[0]+'</em>';});},autoHide:function(){this.resultsshown=false;this.autoholder.hide();return this;},autoFocus:function(el){if(!el)return;if(this.autocurrent)this.autocurrent.removeClassName('auto-focus');this.autocurrent=el.addClassName('auto-focus');return this;},autoMove:function(direction){if(!this.resultsshown)return;this.autoFocus(this.autocurrent[(direction=='up'?'previous':'next')]());this.autoresults.scrollTop=this.autocurrent.positionedOffset()[1]-this.autocurrent.getHeight();return this;},autoFeed:function(text){if(this.data.indexOf(Object.toJSON(text))==-1)
this.data.push(Object.toJSON(text));return this;},autoAdd:function(el){var filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;current_value=$('maininput').value;if(filter.test(current_value)){this.add({'name':current_value,'value':current_value});}
else if(el&&el.retrieveData('result')){this.add(el.retrieveData('result'));delete this.data[this.data.indexOf(Object.toJSON(el.retrieveData('result')))];this.autoHide();}
else{this.add({'name':current_value,'value':'-1','className':'error'});}
var input=this.lastinput||this.current.retrieveData('input');input.clear().focus();return this;},createInput:function($super,options){var li=$super(options);var input=li.retrieveData('input');input.observe('keydown',function(e){this.dosearch=false;switch(e.keyCode){case Event.KEY_UP:e.stop();return this.autoMove('up');case Event.KEY_DOWN:e.stop();return this.autoMove('down');case Event.KEY_RETURN:case Event.KEY_TAB:case 186:case 188:if((e.keyCode==Event.KEY_TAB)&&($('maininput').value=='')){return true;}
else if($('maininput').value==''){e.stop();return false;}
e.stop();this.autoAdd(this.autocurrent);this.autocurrent=false;this.autoenter=true;return false;case Event.KEY_ESC:this.autoHide();if(this.current&&this.current.retrieveData('input'))
this.current.retrieveData('input').clear();break;default:this.dosearch=true;}}.bind(this));input.observe('keyup',function(e){switch(e.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:case Event.KEY_RETURN:case Event.KEY_ESC:break;default:if(!Object.isUndefined(this.options.get('fetchFile'))){new Ajax.Request(this.options.get('fetchFile'),{parameters:{keyword:input.value},onSuccess:function(transport){transport.responseText.evalJSON(true).each(function(t){this.autoFeed(t)}.bind(this));this.autoShow(input.value);}.bind(this)});}
else
if(this.dosearch)this.autoShow(input.value);}}.bind(this));input.observe(Prototype.Browser.IE?'keydown':'keypress',function(e){if(this.autoenter)e.stop();this.autoenter=false;}.bind(this));return li;},createBox:function($super,text,options){var li=$super(text,options);li.observe('mouseover',function(){this.addClassName('bit-hover');}).observe('mouseout',function(){this.removeClassName('bit-hover')});var a=new Element('a',{'href':'#','class':'closebutton'});src=null;if(text["avatar"]!=undefined)
src=text["avatar"];else
src=Base.imageURL('/images/stock-avatar-m.gif');var img=new Element('img',{'src':src,'class':'thumbnail'});li.insert({top:img});a.observe('click',function(e){e.stop();if(!this.current)this.focus(this.maininput);this.dispose(li);}.bind(this));li.insert(a).cacheData('text',Object.toJSON(text));return li;}});Element.addMethods({onBoxDispose:function(item,obj){obj.autoFeed(item.retrieveData('text').evalJSON(true));},onInputFocus:function(el,obj){obj.autoShow();},onInputBlur:function(el,obj){obj.lastinput=el;if(!obj.curOn){obj.blurhide=obj.autoHide.bind(obj).delay(0.1);}},filter:function(D,E){var C=[];for(var B=0,A=this.length;B<A;B++){if(D.call(E,this[B],B,this)){C.push(this[B]);}}return C;}});
function share_copy_embed_code(){var embedCode;if($('player'))
embedCode=$('player').getEmbedCode();if(typeof(embedCode)=='undefined'||embedCode=="undefined")
embedCode=failsafeEmbedCode;$('share-copy-check-icon').show();new Effect.Fade('share-copy-check-icon',{delay:2,duration:0.2});return embedCode;}
var Share=Class.create();Object.extend(Share,{activity_data:null,popup:function(url,sharable_type,sharable_id,opts){var popupWidth=900;var popupHeight=600;if(sharable_type&&sharable_id){var sites={'facebook':{name:'Facebook',width:640,height:360},'twitter':{name:'twitter',width:550,height:420},'digg':{name:'Digg'},'myspace':{name:'MySpace'},'profile.live':{name:'WindowsLive'},'del.icio.us':{name:'Delicious'},'reddit':{name:'Reddit'}};var site=($H(sites).find(function(s){return url.indexOf(s[0])>=0}))[1];var siteName=site.name;popupWidth=(site.width||popupWidth).toFixed(0);popupHeight=(site.height||popupHeight).toFixed(0);if(sharable_type=="ad"){opts=opts||{};Beacon.trackAdInteractionShareSite(siteName,sharable_id,opts.placement_id,opts.creative_id);}
else{Beacon.send_hulu_event('sharesite',siteName);}
google_analytics_ajax('/share/'+sharable_type+'/'+sharable_id);Share.sendEventTracking(sharable_type,siteName);}
var windowWidth=1024;var windowHeight=768;if(window.outerWidth!==undefined&&window.outerHeight!==undefined){windowWidth=window.outerWidth;windowHeight=window.outerHeight;}else if(document.documentElement&&document.documentElement.offsetWidth!==undefined&&document.documentElement.offsetWidth!==undefined){windowWidth=document.documentElement.offsetWidth;windowHeight=document.documentElement.offsetHeight;}else if(document.body&&document.body.offsetWidth!==undefined&&document.body.offsetHeight!==undefined){windowWidth=document.body.offsetWidth;windowHeight=document.body.offsetHeight;}
var screenTop=0;var screenLeft=0;if(window.screenLeft!==undefined&&window.screenTop!==undefined){screenTop=window.screenTop;screenLeft=window.screenLeft;}else if(window.screenX!==undefined&&window.screenY!==undefined){screenTop=window.screenY;screenLeft=window.screenX;}
var popupTop=(screenTop+(windowHeight/2)-popupHeight/2).toFixed(0);var popupLeft=(screenLeft+(windowWidth/2)-popupWidth/2).toFixed(0);popWindow=window.open(url,"_blank","toolbar=0,status=0,resizable=1,scrollbars=1,width="+popupWidth+",height="+popupHeight+",top="+popupTop+",left="+popupLeft);if(popWindow){popWindow.focus();}
else{ModalPopup.warn("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}},checkEmailShare:function(){var form=$('email-share-form');if(!form)return false;var valid=true;var email=$('email-addresses');if(!email||!email.value||email.value.blank())
valid=false;else{var valid_addresses="";var invalid_addresses="";email.value.split(',').each(function(e){var address=e.strip();if(address!=''){if(Support.rfc822Email.test(address))
valid_addresses+=address;else
invalid_addresses+=address;}});valid=(valid_addresses.length)>0&&(invalid_addresses.length)==0}
var error=form.down('span.error');var successMsg=form.down('span.success-msg');if(!valid){successMsg.hide();error.update('The email address is invalid.');error.show();}else{error.hide();form.down('img.loading').show();WatchTitle.trackEmailShare();}
return valid;},openEmailPopup:function(el){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else{Share.showEmailPopup();}}});}else{Share.showEmailPopup();}},showEmailPopup:function(){var popup=$('email-share-popup');if(!popup)
return;var offset=document.viewport.getScrollOffsets();var top=offset.top+130+'px';var left=offset.left+(document.viewport.getWidth()-popup.getWidth())/2+'px';popup.style.left=left;popup.style.top=top;popup.show();},trackEmailShare:function(sharable_type,sharable_id){google_analytics_ajax('/share/'+sharable_type+'/'+sharable_id);Share.sendEventTracking(sharable_type,'email');},afterEmailSent:function(){var emailForm=$('email-share-form');if(emailForm){emailForm.down('span.error').hide();emailForm.down('span.success-msg').show();setTimeout(function(){var popup=$('email-share-popup');if(popup)popup.hide()
emailForm.down('span.success-msg').hide();;},5000);}
if(activity_data){var id=activity_data["item_id"];var type=activity_data["item_type"];if(id&&type)
Share.trackEmailShare(type,id);}},sendEventTracking:function(sharable_type,network){_gaq.push(['_trackEvent',"Share",network,sharable_type]);}});
var SportsFilter=Class.create();Object.extend(SportsFilter.prototype,{initialize:function(owner,team,show,video){this.filter=$('sports-filter');this.teams=this.filter.select('li.team');this.info_hover=$('team-info-hover');this.owner=owner;this.team=team||"";this.show=show||"";this.video=video||"";this.teams.each(function(li){Event.observe(li,"click",this.setTeam.bindAsEventListener(this));Event.observe(li,"mouseover",this.teamHover.bindAsEventListener(this));Event.observe(li,"mouseout",this.teamHover.bindAsEventListener(this));}.bind(this));},origin:function(ev){var el=Event.element(ev);if(!el.hasClassName('team'))
el=el.up('li.team');return el;},teamHover:function(ev){var el=this.origin(ev);if(!el.hasClassName('selected')){el.toggleClassName('hover');if(!el.hasClassName('all-teams'))
this.toggleToolTip(el);}},toggleToolTip:function(el){if(!el.hasClassName('hover'))
this.info_hover.hide();else{this.info_hover.setStyle({left:(el.positionedOffset().left-57)+'px'});value=el.getAttribute('value');this.info_hover.down('span.conf-name').innerHTML=value.split('>')[0];this.info_hover.down('span.team-name').innerHTML=value.split('>')[1];this.info_hover.show();}},setTeam:function(ev){var el=this.origin(ev);var prev=el.up().down('.selected').removeClassName('selected');el.addClassName('selected');el.removeClassName('hover');this.toggleToolTip(el);this.team=""
if(el.getAttribute('value')!="all-teams")
this.team=el.id;var team_param=(this.team==""?"":("&team_id="+this.team));var show_param=(this.show==""?"":("&show_id="+this.show));this.update(team_param+show_param);},setShow:function(show){if(show==1||show=="1")
show="";this.show=show;if(this.team!=""){this.update("&team_id="+this.team+"&show_id="+show);}else
this.update("&show_id="+show);},update:function(params){$('twister').show();var margins={"show":60,"team":20,"video":90};var height=$('filters_and_presenters').getHeight()-20-margins[this.owner];$('twister').setStyle({height:height+'px',marginTop:margins[this.owner]+'px'});params="owner="+this.owner+params
if(this.video!="")
params+="&video_id="+this.video;new Ajax.Updater('filters_and_presenters',"/shows/filters_and_presenters?"+params,{method:'get',evalScripts:true});return false;}});var sportsFilter=null;
var CheckboxPlus=Class.create();Object.extend(CheckboxPlus,{applyCheckboxBehaviors:function(){$$('.cbp-container').each(function(el){el.cb=el.down('input.checkbox');el.cb.container=el;if(el.cb){Event.observe(el,"click",CheckboxPlus.containerSelect);Event.observe(el.cb,"click",CheckboxPlus.checkboxSelect);}
el.removeClassName('cbp-container');});},containerSelect:function(ev){cb=$(this).cb;if(!cb.disabled)cb.checked=!cb.checked;if(cb.checked)
$(this).addClassName('selected');else
$(this).removeClassName('selected');},checkboxSelect:function(ev){if(!ev)var ev=window.event;ev.cancelBubble=true;if(ev.stopPropagation)ev.stopPropagation();container=$(this).container;if($(this).disabled)return;if($(this).checked)
container.addClassName('selected');else
container.removeClassName('selected');}});
var ComboBox=Class.create();ComboBox.OBJECTS=new Hash();Object.extend(ComboBox.prototype,{initialize:function(id,params){this.cbx=$(id);this.choice=this.cbx.down('.cbx-choice');this.form_field=this.cbx.down('input');this.dropdown=this.cbx.down('.cbx-options');this.options=this.dropdown.select('li');ComboBox.OBJECTS.set(id,this);if(this.options.length>13)
this.cbx.addClassName('overflowed');this.value=this.getValue();this.onchangetxt=params.onchange||"";this.onchange=function(){eval(params.onchange)||"";};if(params.repeat){this.repeat=true;}
var delay=0;delay=setInterval(function(){clearInterval(delay);this.domSensitiveInit();}.bind(this),500);if(params.autosize||params.autosize_opts){maxchars=0;this.options.each(function(li){if(li.innerHTML.strip().length>maxchars)
maxchars=li.innerHTML.strip().length;});var width=5.5*(maxchars+5)+25;if((params.maxsize||0)>0)
width=Math.min(width,params.maxsize);if(params.autosize)
this.cbx.setStyle({width:width+'px'});else if(params.autosize_opts&&width>parseInt(this.cbx.getStyle('width')))
this.dropdown.setStyle({width:width+'px'});}
if(params.parent){this.parent=params.parent;}
if(params.choice_word_break){this.word_break=true;this.choice_word_break();}
if(params.choice_add_ellipsis){this.add_ellipsis=true;this.choice_add_ellipsis();}},domSensitiveInit:function(){Event.observe(this.choice,"click",this.toggleDropDown.bindAsEventListener(this));Event.observe(this.choice,"mouseover",this.choiceHover.bindAsEventListener(this));Event.observe(this.choice,"mouseout",this.choiceHoverOut.bindAsEventListener(this));this.options.each(function(li){li.removeClassName('cbxhover');li.removeClassName('selected-hover');Event.observe(li,"click",this.setValue.bindAsEventListener(this));Event.observe(li,"mouseover",this.optionHover.bindAsEventListener(this));Event.observe(li,"mouseout",this.optionHover.bindAsEventListener(this));}.bind(this));this.cbx.addClassName('zIndex10');this.choice.innerHTML=this.choice.innerHTML;this.cbx.removeClassName('zIndex10');},setValue:function(ev){var el=Event.element(ev);if(el.tagName!='LI')
el=el.up('li');if(!el)return;if(el.hasClassName('selected')&&!this.repeat)return;this.form_field.value=this.readValueAttribute(el);this.value=this.getValue();this.choice.innerHTML=el.innerHTML.strip();if(this.word_break)
this.choice_word_break();if(this.add_ellipsis)
this.choice_add_ellipsis();this.options.each(function(li){li.removeClassName("selected").removeClassName("selected-hover");});el.addClassName("selected").addClassName('selected-hover');this.toggleDropDown();this.onchange();},changeValue:function(value){var found=false;this.options.each(function(li){if(this.readValueAttribute(li)==value){found=true;throw $break;}}.bind(this));if(!found)return;this.options.each(function(li){li.removeClassName("selected");if(this.readValueAttribute(li)==value){li.addClassName("selected");this.choice.innerHTML=li.innerHTML.strip();if(this.word_break)
this.choice_word_break();if(this.add_ellipsis)
this.choice_add_ellipsis();this.form_field.value=this.readValueAttribute(li);this.value=this.getValue();}}.bind(this));},getValue:function(){return this.form_field.value;},readValueAttribute:function(el){if(el.readAttribute("value")&&el.readAttribute("value")!="|")
return el.readAttribute("value");return"";},optionHover:function(ev){var el=Event.element(ev);el.toggleClassName('cbxhover');if(el.hasClassName('selected'))
el.toggleClassName('selected-hover');},choiceHover:function(ev){if(!this.disabled())Event.element(ev).addClassName('cbx-hover');},choiceHoverOut:function(ev){if(!this.disabled())Event.element(ev).removeClassName('cbx-hover');},toggleDropDown:function(){if(this.disabled())return false;if(this!=Behaviors.openDropDown&&Behaviors.openDropDown!=null&&Behaviors.openDropDown.visible())
Behaviors.openDropDown.closeDropDown();if(this.visible()){this.closeDropDown();}
else{this.cbx.setStyle({zIndex:100});this.dropdown.show();Behaviors.openDropDown=this;}},closeDropDown:function(){if(this.visible()){this.dropdown.hide();this.cbx.setStyle({zIndex:1});Behaviors.openDropDown=null;}},visible:function(){return this.dropdown.visible();},disabled:function(){return this.cbx.hasClassName('disabled');},choice_word_break:function(){var len=parseInt(parseInt(this.cbx.getStyle('width'))/5.5-10);if(len<1)len=1;var content=this.choice.innerHTML.strip().unescapeHTML();var temp="";if(len<content.length)
{temp=content.substr(0,len)+"<wbr />";while(len<content.length)
temp+=content.substr(len++,1)+"<wbr />";this.choice.innerHTML=temp;}},choice_add_ellipsis:function(){var len=parseInt(parseInt(this.cbx.getStyle('width'))/5.5-7);if(len<1)len=1;var content=this.choice.innerHTML.strip().unescapeHTML();if(len<content.length)
{this.choice.innerHTML=content.substr(0,len)+"...";}}});
function _ABCFEP(){var aff='';var partner='hulu';var newWindow=function(C,J,D,A,H){var I=D||1000;var G=A||675;var E=H||0;var F=null;if((typeof(screen.availHeight)!="undefined"&&screen.availHeight<G+49)||(typeof(screen.availWidth)!="undefined"&&screen.availWidth<I+10)){E=1}var B="height="+G+",width="+I+",toolbar=0,scrollbars="+E+",location=0,statusbar=0,menubar=0,resizable=0,top=0,left=0";if(C){F=window.open(C,J,B)}return F}
var feppop=function(show,video){burl='http://dynamic.abc.go.com/fep/player';burl+='?aff='+aff;burl+='&partner='+partner;if(show!=null)burl+=('&show='+show);if(video!=null)burl+=('&episode='+video);rr=newWindow(burl,'player_window',1000,675,0);if(rr!=null&&typeof(rr)!="undefined"){try{rr.focus();}catch(e){}}else{alert('Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.');};return rr;}
this.openFEP=function(guid){var ids;if(guid){ids=guid.split('-');}else{ids='-';}
if(ids.length==2){result=feppop(ids[0],ids[1]);}else{result=feppop('','');}}}
ABCFEP=new _ABCFEP();function openABC_g(guid){ABCFEP.openFEP(guid)}
function openABC(channel,video){var popupWidth=1000;var popupHeight=675;var ifScrollBar=0;if((typeof(screen.availHeight)!="undefined"&&screen.availHeight<popupHeight+49)||(typeof(screen.availWidth)!="undefined"&&screen.availWidth<popupWidth+10)){ifScrollBar=1;}
var popupParams="height="+popupHeight+",width="+popupWidth+",toolbar=0,scrollbars="+ifScrollBar+",location=0,statusbar=0,menubar=0,resizable=0,top=0,left=0";var trackRedirect="http://transfer.go.com/cgi/transfer.dll?name=REMOTEPLAYERJS_PARTNER_HULU&srvc=abc&goto=";trackRedirect=trackRedirect+"http://dynamic.abc.go.com/streaming/player&rEnable=0&pl=mv&mk=20171845&channel="+channel+"&video="+video+"&raff=&partner=hulu&hostname="+document.location.hostname;var win=window.open(trackRedirect,'abcfesplayer_window',popupParams);if(win==null||typeof(win)=="undefined"){alert("Oops - your browser may be blocking this pop-up. Please disable your pop-up blocker before continuing.");}}
var FilterCache=Class.create();Object.extend(FilterCache.prototype,{cacheItems:{},get:function(key){return this.cacheItems[key];},set:function(key,value){this.cacheItems[key]=value;},remove:function(key){this.cacheItems[key]=null;},removeAll:function(){this.cacheItems={};},getSelectedValue:function(text){if(text.match(/<input[^>]*/)){match1=text.match(/<input[^>]*/)[0];if(match1.match(/value\=[\'\"]([^\'\"]*)/))
return match1.match(/value\=[\'\"]([^\'\"]*)/)[1];}
return-1;},revertContent:function(){$H(this.cacheItems).each(function(pair){if($(pair.key)&&pair.value){var combobox=$(pair.key).down(".cbx");if(this.getSelectedValue(pair.value)!=""){$(pair.key).innerHTML=pair.value;new ComboBox(combobox.id,{onchange:ComboBox.OBJECTS.get(combobox.id).onchangetxt});}}}.bind(this))}})
var mainFilterCache=new FilterCache();function mainSerpFilter(id,url,key,value){if(id&&id.startsWith("lazy_change")){var el=$(id);var html=el.innerHTML;mainFilterCache.removeAll();mainFilterCache.set(id,html);}
var icon=$("search-ajax-loading-icon");if(icon)icon.show();new Ajax.Request(url+"&ajax_call=1&"+encodeURIComponent(key)+"="+encodeURIComponent(value),{method:'get',onSuccess:function(transport){$("search-ajax-loading-icon").hide();}});}
function changeShowPage(el,params,params2){var dom_id=params.source_type+params.source_id;var page=$(dom_id);var url=["search/get_promo_collections",$H(params).toSortedQueryString()].join('?');var count=0;SearchTracking.send(null,null,null,null,'promo-panel',null,null,'tab');new Ajax.Request(url,{method:'get',onLoading:function(){$("search-ajax-loading-icon").show();count+=1;},onComplete:function(){count-=1;if(count==0){$("search-ajax-loading-icon").hide();}
Element.extend(el);el.up().childElements().each(function(e){e.removeClassName("selected");});el.addClassName("selected");page.up().childElements().each(function(e){e.hide();});page.show();$A($$(".episodes_unavailable")).each(function(e){e.hide();});el=$("promo-avail-note-"+dom_id);if(el)el.show();plus_promo=$("plus_promo_"+dom_id)
plus_promo.up().childElements().each(function(e){e.hide();});if(!plus_promo.empty()){plus_promo.show();}}});if(params2){params2.query=unescape(params2.query);params2.fs=TrackingUtility.getCookie("fs");var url=["search",$H(params2).toSortedQueryString()].join('?');new Ajax.Request(url,{method:'get',onLoading:function(){count+=1;$("search-ajax-loading-icon").show();},onComplete:function(){count-=1;if(count==0){$("search-ajax-loading-icon").hide();}}});}
return false;}
function letMeKnow(item,missed_show){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(item);return false;}
var self=this;new Ajax.Request('/users/register_for_missed_show?missed_show='+missed_show,{asynchronous:true,evalScripts:true,onSuccess:function(request){$("register_info").hide();$("registered_info").show();}});return false;}
function letHuluKnowAboutMissedShow(){var el=$('let_hulu_know_panel');el.show();Form.reset(el.down('form'));if(Behaviors.isLoggedIn()){new Ajax.Request('/users/info_with_id?id='+Behaviors.getUserId(),{asynchronous:true,method:"get",onComplete:function(request){info=request.responseText.evalJSON();$("useremail").value=info.email;}})}
return false;}
function letHuluKnowAboutMissedShowSubmit(missed_show){var menu=$('let_hulu_know_panel');if(!menu)return;var form=menu.down('form');if(!form)return;new Ajax.Request('/search/add_info_for_missed_show?missed_show='+missed_show,{asynchronous:true,evalScripts:true,parameters:Form.serialize(form,true),onComplete:function(request){menu.hide();$("notified_info").show();$("notify_info").hide();}});}
function showCollectionLoadingPopup(){if(!lights.isOff&&!lights.working){$$('#collection-popup').each(Element.hide);showAndAdjustCollectionPopup('collection-popup-loading');lights.off(0.7);}}
function showCollectionLoadingFailure(){$$('#collection-popup').each(Element.hide);$$('#collection-popup-loading').each(Element.hide);ModalPopup.warn('Sorry, this collection is not available at the moment.');}
function showCollectionPopup(){var visible=false;$$("#collection-popup-loading").each(function(node){if(node.visible()){visible=true;}});$$('#collection-popup-loading').each(Element.hide);if(visible||$$("#collection-popup-loading").length==0){showAndAdjustCollectionPopup('collection-popup');}}
function showAndAdjustCollectionPopup(element){element=$(element);if(element){var lDelta=(document.viewport.getWidth()-element.getWidth())/2;lDelta=(lDelta<0?0:lDelta);var tDelta=(document.viewport.getHeight()-element.getHeight())/2;tDelta=(tDelta<0?0:tDelta);var off=element.cumulativeScrollOffset();element.style.left=off.left+lDelta+'px';var minTop=document.body.offsetHeight-650;element.style.top=Math.min(minTop,off.top+tDelta)+'px';element.show();}}
function hideCollectionPopup(){if(lights.isOff&&!lights.working){try{$('collection-popup-loading').hide();}catch(ex){}
$('collection-popup').hide();try{closeToyotaAd();}catch(ex){}
lights.on();}}
function advancedSearch(){if($('advanced_search_form').query.value=='')return false;getFs('fsa');getSt('sta');sendAdvancedSearchTrackData();$('advanced_search_form').submit();}
function sendAdvancedSearchTrackData(){var query=$("generated-query").innerText;query=query.replace(/\'/g,"&#39;").replace(/\"/g,"&#34;").replace(/\+/g,"&#43;");var systemLevelData=TrackingUtility.prepareSystemLevelData();var data='{"sid": "'+systemLevelData["session_id"]+'", "data" : {"from": "advanced_search", "query": "'+query+'"}, "source": "serp"}'
TrackingUtility.appendCookie('_serp_',data,5);}
function toggleAdvancedSearch(){var el=$('search-ajax-loading-icon');if(el&&el.visible())return;el=$('advanced-search');if(el){if(el.visible())el.hide();else el.show();}
else{$('search-ajax-loading-icon').show();new Ajax.Request('/search/advanced_search_panel?query='+encodeURIComponent($('search_form').query.value),{method:'get',onSuccess:function(){$('search-ajax-loading-icon').hide();}});}}
var advSearchQueryDelayTimer;function updateAdvancedSearchQuery(timeout){if(timeout==void 0)timeout=100;clearTimeout(advSearchQueryDelayTimer);advSearchQueryDelayTimer=setTimeout(function(){var form=$('adv-search-query-form');var delimiters=/[_,\s]+/g;var comma=',';var toStrip=/\"|^[\"\s]+|[\"\s]+$/g;var non_num=/[^-,\d]+/g;var query=form.any.value;var t=form.all.value.split(delimiters).without('').join(' +');if(t!='')query+=' +'+t;t=form.exact.value.replace(toStrip,'');if(t!='')query+=' "'+t+'"';t=form.none.value.split(delimiters).without('').join(' -');if(t!='')query+=' -'+t;var opToken=function(op,v){return' '+op+':'+(v.match(/\s/)?'"'+v+'"':v);}
form.showname.value.split(comma).each(function(s){t=s.replace(toStrip,'');if(t!='')query+=opToken('show',t);});t=form.title.value.replace(toStrip,'');if(t!='')query+=opToken('title',t);t=form.description.value.replace(toStrip,'');if(t!='')query+=opToken('description',t);t=form.season_num.value.replace(/[,\s]+/g,comma).replace(non_num,'').replace(/^,|,$/g,'');if(t!='')query+=opToken('season',t);t=form.episode_num.value.replace(/[,\s]+/g,comma).replace(non_num,'').replace(/^,|,$/g,'');if(t!='')query+=opToken('episode',t);form.people.value.split(comma).each(function(s){t=s.replace(toStrip,'');if(t!='')query+=opToken('people',t);});t=form.type.value;if(t!='')query+=opToken('type',t);t=form.network.value;if(t!='')query+=opToken('network',t);t=form.channel.value;if(t!='')query+=opToken('channel',t);t=form.start_time.value;var t2=form.end_time.value;if(t!=''||t2!='')query+=opToken('date',[t,t2].join('-').replace(/^-|-$/g,''));if(form.hulu.checked)query+=' site:hulu';if(form.cc.checked)query+=' captions:yes';if(form.safe.checked)query+=' safe:yes';if(form.free){if(form.free.checked){query+=' free:yes';}}
query=query.replace(/^\s+/,'');$('advanced_search_form').query.value=query;var el=$('generated-query');el.innerText=el.textContent=query;},timeout);}
var embedFilterCache=new FilterCache();function embedSerpFilter(id,url,key,value){if(id&&id.startsWith("lazy_change")){var el=$(id);var html=el.innerHTML;embedFilterCache.removeAll();embedFilterCache.set(id,html);}
new Ajax.Request(url+"&"+encodeURIComponent(key)+"="+encodeURIComponent(value),{method:'get',onSuccess:function(transport){showSearchPopup();}});}
function searchInChannel(){if($F($('channel_search_form')['query']).blank())return false;$('channel_search_form').request({method:'get',onComplete:function(){showSearchPopup();}});return false;}
function SearchAjaxCall(url){new Ajax.Request(url,{method:'get',onSuccess:function(transport){showSearchPopup();}});}
function showRelatedTerms(){$('popular-terms').hide();$('channel_search_form').replaceChild($('new-related-terms'),$('related-terms'));$('new-related-terms').id='related-terms';$('related-terms').show();}
function hideRelatedTerms(){$('related-terms').hide();$('popular-terms').show();}
function showSearchPopup(){if(!lights.isOff&&!lights.working){$('search-bar').style.zIndex=250;if(Prototype.Browser.IE6)
$$('div.channels-top select, div#trailers select').each(function(el){el.style.visibility='hidden';});$('search-result').style.top=$('search-bar').positionedOffset().top+$('search-bar').getHeight()+"px";$('search-result').show();$('popup-close-button').show();lights.off(0.7);}}
function hideSearchPopup(){if(lights.isOff&&!lights.working&&$('search-result')&&$('search-result').visible()){if(Prototype.Browser.IE6)
$$('div.channels-top select, div#trailers select').each(function(el){el.style.visibility='visible';});$('search-result').hide();$('popup-close-button').hide();hideRelatedTerms();lights.on();}}
function supportSearch(){if($F($('support_search_form')['query']).blank())return false;$('support_search_form').request({method:'get'});return false;}
var ccFilterCache=new FilterCache();function ccSerpFilter(id,url,key,value){if(id&&id.startsWith('lazy_change')){var el=$(id);var html=el.innerHTML;ccFilterCache.removeAll();ccFilterCache.set(id,html);}
$('cc-serp-ajax-icon').show();new Ajax.Request(url+"&"+encodeURIComponent(key)+"="+encodeURIComponent(value),{method:'get',onSuccess:function(){$('cc-serp-ajax-icon').hide();}});}
function searchCaptions(is_ajax){if($F($('cc-search-form').query).blank())return false;if(is_ajax){$('cc-serp-ajax-icon').show();$('cc-search-form').request({method:'get',onSuccess:function(){$('cc-serp-ajax-icon').hide();}});return false;}
else{$('cc-search-form').submit();}}
var ccUpdateDelayTimer;function ccBrowseScroll(){clearTimeout(ccUpdateDelayTimer);var top=$('cc-browse').scrollTop;var bottom=top+$('cc-browse').getDimensions().height;var idx=parseInt(top/$('cc-chunk-0').getDimensions().height);var el=$('cc-chunk-'+idx);var start_time=el.readAttribute('t');var end_time=start_time;for(var i=1;true;++i){var ele=$('cc-chunk-'+(idx+i));if(!ele||ele.positionedOffset().top>bottom){break;}
end_time=ele.readAttribute('t');}
HeatMap.markRange(start_time,end_time);var start,stop;var loaded=function(e){if(!e)return false;return!e.down('div.cc_placeholder');};var update=true;if(!loaded(el)){stop=idx+10;for(var i=1;i<10;++i){var el=$('cc-chunk-'+(idx+i));if(!el||loaded(el)){stop=idx+i;break;}}
start=stop-12;for(var i=1;i<(idx-start+1);++i){var el=$('cc-chunk-'+(idx-i));if(!el||loaded(el)){start=idx-i+1;break;}}}else{for(var i=1;i<9;++i){var el=$('cc-chunk-'+(idx+i));if(!el||i==8){update=false;break;}
if(!loaded(el)){start=idx+i;break;}}
stop=start+12;}
ccUpdateDelayTimer=setTimeout(function(){for(var i=(idx>0?idx-1:0);i<idx+8;++i){var e=$('cc-chunk-'+i);if(!e)break;for(var j=0;j<3;++j){Captions.display(i*3+j);}}
if(update){ccBrowseUpdate(start,stop-start);}},300);}
function ccScopeForTracking(){var path=location.href.match(/hulu\.com\/([^\/]+)(\/|$)/);if(path){path=path[1];return'cc:'+(path=='watch'?'video':(path=='labs'?'all':'show'));}
return'cc:null';}
function ccBrowseTo(second,non_callback){if(!non_callback){var q=$('cc-search-form').query.value||' ';SearchTracking.send(q,null,null,null,'cc_heatmap_click',null,null,ccScopeForTracking());}
var idx=0;for(;true;++idx){var el=$('cc-chunk-'+idx);if(!el||parseInt(el.readAttribute('t'))>second){break;}}
ccShowBrowse();$('cc-browse').scrollTop=$('cc-chunk-'+(idx>0?idx-1:idx)).positionedOffset().top-10;}
function ccBrowseUpdate(idx,chunk_count,init){$('cc-browse-form').offset.value=idx*3;$('cc-browse-form').start_time.value=init?0:$('cc-chunk-'+idx).readAttribute('t');$('cc-browse-form').count.value=chunk_count*3;if(init){$('cc-browse-form').init.value=1;$('cc-serp-ajax-icon').show();$('cc-browse-form').request({method:'get',onSuccess:function(){$('cc-serp-ajax-icon').hide();}});}else{$('cc-browse-form').init.value='';$('cc-browse-form').request({method:'get'});for(var i=0;i<chunk_count;++i){var el=$('cc-chunk-'+(idx+i));if(!el){return;}
el=el.down('div.cc_placeholder');if(el){el.removeClassName('cc_placeholder');}}}}
function ccShowSearchResults(){var el=$('cc-browse');if(el)el.hide();$('cc-search-result').show();HeatMap.highlight();}
var removeDelayTimer;function ccShowBrowse(){$('cc-search-result').hide();$('cc-browse').show();HeatMap.markRange();var f=function(){var unitHeight=$('cc-chunk-0').getDimensions().height;var n=parseInt($('cc-listing').getDimensions().height/unitHeight);var v=parseInt($('cc-browse').scrollTop/unitHeight);for(var i=0;i<3*(v-2);++i){if(Captions.clear(i))break;}
for(var i=(n+1)*3;i>3*(v+7);--i){if(Captions.clear(i))break;}};clearInterval(removeDelayTimer);removeDelayTimer=setInterval(f,2000);ccBrowseScroll();}
function ccLineFocus(el,time){el=Element.extend(el);play_img=el.up('div.cc_line').down('img.cc_play');el=el.up('div.cc_thumbs').down('div.cc_preview');el.setAttribute('t',time);var link=el.down('a');link.href=link.href.replace(/#\d+$/,'#'+(time-5));var img=link.down('img');img.src=img.src.replace(/&s=\d+/,'&s='+time);play_img.show();HeatMap.hover(time);}
function ccLineUnfocus(el){el=Element.extend(el).up('div.cc_line').down('img.cc_play');el.hide();HeatMap.hover(-1);}
var previewDelayTimer;var currentPid;function quitPreview(){clearTimeout(previewDelayTimer);var el=$('preview-swf');if(el){try{var previewPlayer=$('preview-thumb');cselClearURL=previewPlayer.closeApp();}
catch(e){cselClearURL="";}
if(!cselClearURL||cselClearURL==""){}
else{if(Prototype.Browser.IE){(new Image()).src=cselClearURL;}
else{new Ajax.Request(cselClearURL,{asynchronous:true});}}
el.remove();}}
function previewThumb(el,pid,contentid,offset){clearTimeout(previewDelayTimer);el=Element.extend(el);if(el.down('#preview-swf'))return;previewDelayTimer=setTimeout(function(){quitPreview();var div=document.createElement('div');div.id='preview-swf';el.appendChild(div);var so=new SWFObject('/ccpreview.swf?v1','preview-thumb','145','80','10.1.53.64',true);so.addParam('allowScriptAccess','sameDomain');so.addParam('quality','high');so.addParam('wmode','transparent');if(Prototype.Browser.IE){so.addVariable('stageWidth',145);so.addVariable('stageHeight',80);}
so.addVariable('pid',pid);so.addVariable('contentid',contentid);so.addVariable('st',offset-5);SearchTracking.send($('cc-search-form').query.value||' ',null,null,null,'cc_preview',null,null,ccScopeForTracking());VersionCheck.write(so,'preview-swf');if(typeof(google_analytics_ajax)=='function'){google_analytics_ajax('/captions_preview/'+pid+'?st='+offset);}
try{$('player').pauseVideo();}catch(e){}},800);}
var ccUrlHash=new Hash();function ccNavigate(pid,t,non_callback){var position=($('cc-search-result').visible()?'cc_serp_click':'cc_browse_click');SearchTracking.send($('cc-search-form').query.value||' ',null,null,null,position,null,null,ccScopeForTracking());if(pid==currentPid&&$('player')&&$('player').seekAndPlay(t)){$('player').scrollTo();quitPreview();return false;}
if(non_callback){return true;}
location.href=(ccUrlHash.get(pid)+'?cc=1#'+t);}
var HeatMap={isReady:false,action:'',lang:'',range:'',highlighted:'',highlight:function(p){if(p!=void 0)
this.highlighted=p;else if(!this.highlighted)
return;this.action+="$('heatmap').highlight('"+this.highlighted+"');";this._exec();},markRange:function(p1,p2){if(p1!=void 0)
this.range=p1+","+p2;else if(!this.range)
return;this.action+="$('heatmap').markRange("+this.range+");";this._exec();},setLanguage:function(p){if(p==this.lang)return;this.lang=p;this.action+="$('heatmap').setLanguage('"+p+"');";this._exec();},hover:function(p){if(this.isReady)$('heatmap').hover(p);},ready:function(){this.isReady=true;this._exec();},zIndex:function(p){$('heatmap-container').setStyle({zIndex:p});},showHelp:function(){if($('heatmap-help').visible())
this.hideHelp();else
$('heatmap-help').show();},hideHelp:function(){$('heatmap-help').hide();},_exec:function(){if(!$('heatmap')&&this.action.length>2000){this.action='';return;}
if(this.isReady){eval(this.action);this.action='';}}};var Captions={isReady:false,lines:{},pendingLines:{},delay:null,display:function(id){var t=this.lines[id];if(!t)return;var e=$('cc-text-'+id);if(!e||e.innerHTML!='')return;e.innerHTML=$('ssc').decode(t).match(/.*span>/)[0];},clear:function(id){var t=this.lines[id];if(t){var e=$('cc-text-'+id);if(e&&e.innerHTML!=''){e.innerHTML='';return true;}}
return false;},add:function(id,p){if(this.isReady==true){this.lines[id]=p;this.display(id);}else{this.pendingLines[id]=p;}},setDelay:function(){this.delay=setInterval(function(){if($('ssc')!=null){if($('ssc').decode!=undefined){try{this.ready();clearInterval(this.delay);}catch(e){}}}}.bind(this),300);},ready:function(){this.isReady=true;this._exec();},_exec:function(){$H(this.pendingLines).each(function(pair){this.lines[pair.key]=pair.value;this.display(pair.key);}.bind(this));this.pendingLines={};},enableHovers:function(){$$(".cc_browse_line").each(function(el){if(!el.hasClassName("hoversEnabled")){el.identify();el.observe("mouseover",Captions.toggleCopyLink);el.observe("mouseout",Captions.toggleCopyLink);el.addClassName("hoversEnabled");}});},hoverElements:function(e,cssClass){var target=$(Event.element(e));target=target.hasClassName(cssClass)?target:target.up("."+cssClass);var relatedTarget=e.relatedTarget;if(!relatedTarget){relatedTarget=e.type=="mouseover"?e.fromElement:e.toElement;}
return[target,$(relatedTarget)];},setupBrowse:function(id){var browse=$(id);if(browse){var nop=function(){return false;};browse.ondragstart=nop;browse.onselectstart=nop;browse.onselect=nop;browse.oncopy=nop;browse.onbeforecopy=nop;browse.onmouseup=nop;browse.onscroll=ccBrowseScroll;Captions.clip=new CopyLink("cc-listing-container");}},toggleCopyLink:function(e){var lineRelated=Captions.hoverElements(e,"cc_browse_line");var line=lineRelated[0];var related=lineRelated[1];if(line&&related){if(e.type=="mouseover"){$$("div.cc_copy_link").each(Element.hide);var div=line.down("div.cc_copy_link");if(div){div.show();div.down("img").hide();if(Captions.clip){Captions.clip.position(div);Captions.clip.setURL(div.down("a").href);Captions.clip.setShowElement(div.down("img"));}}}
else{var targetLine=related.up(".cc_browse_line");if(Captions.clip&&Captions.clip.isOrContains(related))return;if(targetLine?targetLine.id!=line.id:related.id!=line.id){line.down("div.cc_copy_link").hide();}}}}};Captions.setDelay();LiveVideoDisplayer=Class.create();Object.extend(LiveVideoDisplayer.prototype,{initialize:function(containerId,startTime,stopTime){this.container=$(containerId);this.container=Element.extend(this.container);this.startTime=this.getUTCTime(startTime);this.stopTime=this.getUTCTime(stopTime);this.now=new Date();},draw:function(){var status=this.getStatus();if(status==-1)
this.drawBeforeState();if(status==0)
this.drawRunState();if(status==1)
this.drawAfterState();},drawBeforeState:function(){var r=this.getTimeRange(this.now,this.startTime);var day=r[0],hour=r[1],min=r[1];var text1="Live stream will be available in ";if(day>1)text1=text1+day+" days and ";if(day==1)text1=text1+day+" day and ";if(hour>1)text1=text1+hour+" hours";if(hour==1)text1=text1+hour+" hour";if(day==0){if(min>1)text1+=" and "+min+" minutes";else if(min==1)text1+=" and "+min+" minute";}
this.drawBase(text1);},drawRunState:function(){var time1=this.getTimeRange(this.startTime,this.now);time1=[this.formatInt(time1[1],2),this.formatInt(time1[2],2),this.formatInt(time1[3],2)].join(":");var time2=this.getTimeRange(this.startTime,this.stopTime);time2=[this.formatInt(time2[1],2),this.formatInt(time2[2],2),this.formatInt(time2[3],2)].join(":");var text1="The live stream is in progess "+"<span>("+time1+" / "+time2+")</span>";this.drawBase(text1)},drawAfterState:function(){var text1="This live stream has ended";this.drawBase(text1);if($('live_video_unavailable'))
$('live_video_unavailable').show();else
Event.observe(window,"load",function(){$('live_video_unavailable').show();});},drawBase:function(text1){var text2="Start time: "+this.formatTime(this.startTime);var div1=this.CreateDiv(text1,"live-video-status");var div2=this.CreateDiv(text2,"live-video-info");[div1,div2].each(function(div){this.container.appendChild(div);}.bind(this))},getStatus:function(){if(this.now<this.startTime){return-1;}else if(this.now>this.stopTime){return 1;}else{return 0;}},getUTCTime:function(utcString){nums=$A([]);utcString.split(/[: -]/).each(function(t){nums.push(parseInt(t));})
return new Date(Date.UTC(nums[0],nums[1]-1,nums[2],nums[3],nums[4],nums[5]))},getTimeRange:function(start,end){var millonSeconds=end-start;var second=parseInt(millonSeconds%(60*1000)/1000);var minute=parseInt(millonSeconds%(3600*1000)/(60*1000));var hour=parseInt(millonSeconds%(3600*1000*24)/(3600*1000));var day=parseInt(millonSeconds/(3600*1000*24));return[day,hour,minute,second];},TZ:/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,TZ_CLIP:/[^-+\dA-Z]/g,formatTime:function(date){var week=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Agu","Sep","Oct","Nov","Dec"];var hour=date.getHours();if(hour>12)hour-=12;var result=week[date.getDay()]+" "+
month[date.getMonth()]+" "+
date.getDate()+" "+
hour+":"+
this.formatInt(date.getMinutes(),2);if(date.getHours()>11)
result+=" PM";else
result+=" AM";try{result+=" "+(date.toString().match(this.TZ)||[""]).pop().replace(this.TZ_CLIP,"");}
catch(e){}
return result},formatInt:function(num,length){num=num+"";while(num.length<length){num="0"+num;}
return num;},CreateDiv:function(innerHTML,className){var myElement=document.createElement('div');Element.extend(myElement);myElement.addClassName(className);myElement.innerHTML=innerHTML;return myElement;}})
function showHotTopicPopup(){if(!lights.isOff&&!lights.working){showAndAdjustCollectionPopup('hot-topic-search-result');lights.off(0.7);}
setTimeout(_updateSERPTracking,1000);}
function hideHotTopicPopup(){if(lights.isOff&&!lights.working&&$('hot-topic-search-result')){$('hot-topic-search-result').hide();lights.on();}}
function HotTopicAjaxCall(url){new Ajax.Request(url,{method:'get',onSuccess:function(transport){showHotTopicPopup();}});}
var SERP=Class.create();Object.extend(SERP,{loading:false,next_page:2,initAutoScroll:function(){Event.observe(window,'scroll',SERP.autoPaginate);Event.observe(window,'resize',SERP.autoPaginate);SERP.next_page=2;SERP.loading=false;SERP.autoPaginate();},serpLoadMore:function(options){url='/search';options=$H(options).merge({page:SERP.next_page});var systemLevelData=TrackingUtility.prepareSystemLevelData();SERPTracking.SERPSendTrackInfo({"sid":systemLevelData["session_id"],"data":{"from":"autoscroll","query":queryForTracking,"page":SERP.next_page,"frontend_test":frontendTestForTracking},"source":"serp"});new Ajax.Request(url,{method:'get',parameters:options,onLoading:function(){$("serp-loading-icon").show();$("auto-scroll-text").update("Loading...");SERP.next_page=SERP.next_page+1;},onComplete:function(transport){$("serp-loading-icon").hide();$("auto-scroll-text").update("Load More");SERP.loading=false;setTimeout(_updateSERPTracking,100);if(SERP.next_page>options.get('total_page')){$("auto-scroll-btn").hide();Event.stopObserving(window,'scroll',SERP.autoPaginate);Event.stopObserving(window,'resize',SERP.autoPaginate);}}});},autoPaginate:function(){if(SERP.loading)return;if(SERP.next_page>3)return;SERP.loading=true;var top=document.viewport.getScrollOffsets();top=top.top+document.viewport.getHeight();var load_el=$("auto-scroll-marker");if(load_el){var offset=load_el.cumulativeOffset().top
if(top>=offset-20){if($("auto-scroll-btn")){$("auto-scroll-btn").simulate('click');}}else{SERP.loading=false;}}}});
Element.addMethods({purgeChildren:function(element){$A(element.childNodes).each(function(e){$(e).remove();});},build:function(element,type,options,style){var newElement=Element.buildAndAppend(type,options,style);element.appendChild(newElement);return newElement;}});Element.buildAndAppend=function(type,options,style)
{var e=$(document.createElement(type));$H(options).each(function(pair){e[pair.key]=pair.value});if(style)e.setStyle(style);return e;};nil=null;Date.one_day=24*60*60*1000;Date.weekdays=$w("S M T W T F S");Date.first_day_of_week=0;Date.months=$w("JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC");Date.monthsNumber=$w("1 2 3 4 5 6 7 8 9 10 11 12");Date.prototype.stripTime=function(){return new Date(this.getFullYear(),this.getMonth(),this.getDate());};Date.prototype.daysDistance=function(compare_date){return Math.round((compare_date-this)/Date.one_day);};Date.prototype.toFormattedString=function(){var hour,str;str=Date.monthsNumber[this.getMonth()]+"/"+this.getDate()+"/"+this.getFullYear();return str;};Date.parseFormattedString=function(string){return new Date(string);};window.f_height=function(){return([window.innerHeight?window.innerHeight:null,document.documentElement?document.documentElement.clientHeight:null,document.body?document.body.clientHeight:null].select(function(x){return x>0}).first()||0);};window.f_scrollTop=function(){return([window.pageYOffset?window.pageYOffset:null,document.documentElement?document.documentElement.scrollTop:null,document.body?document.body.scrollTop:null].select(function(x){return x>0}).first()||0);};DateComboBox=Class.create();DateComboBox.prototype={initialize:function(parent_element,values,html_options,style_options){if(html_options.className)
html_options.className+=" cbx";else
html_options.className="cbx";if(values.length>12)
html_options.className+=" overflowed";this.element=$(parent_element).build("div",html_options,style_options);this.populate(values);this.cbx=new ComboBox(html_options.id,{onchange:html_options.onchange,parent:html_options.parent});},populate:function(values){var selected=values[0];if(typeof(selected)!="object")
selected=[selected,selected];this.element.purgeChildren();this.element.build("input",{type:"hidden",autocomplete:"off",value:selected.first()});this.element.build("div",{className:"cbx-choice",innerHTML:selected.last()});this.div=this.element.build("div",{className:"cbx-options"},{display:"none"});this.list=this.div.build("ul");$A(values).each(function(pair){if(typeof(pair)!="object"){pair=[pair,pair];}
this.list.insert('<li value="'+pair[1]+'">'+pair[0]+'</li>');}.bind(this));},setValue:function(value){this.cbx.changeValue(value);},getValue:function(){return this.cbx.getValue();}}
CalendarDateSelect=Class.create();CalendarDateSelect.prototype={initialize:function(target_element,options){this.target_element=$(target_element);if(!this.target_element)return false;if(this.target_element.tagName!="INPUT")this.target_element=this.target_element.down("INPUT");this.target_element.calendar_date_select=this;this.options=$H({popup:nil,year_range:10,minute_interval:5,popup_by:this.target_element,onchange:this.target_element.onchange,valid_date_check:nil}).merge(options||{});this.initial_value=this.target_element.value;this.parseDate();this.callback("before_show")
this.initCalendarDiv();this.positionCalendarDiv()
Event.observe(document,"mousedown",this.closeIfClickedOut_handler=this.closeIfClickedOut.bindAsEventListener(this));Event.observe(document,"keypress",this.keyPress_handler=this.keyPress.bindAsEventListener(this));this.callback("after_show");},positionCalendarDiv:function(){var above=false;var c_pos=this.calendar_div.cumulativeOffset(),c_left=c_pos[0],c_top=c_pos[1],c_dim=this.calendar_div.getDimensions(),c_height=c_dim.height,c_width=c_dim.width;var w_top=window.f_scrollTop(),w_height=window.f_height();var e_dim=$(this.options.get("popup_by")).cumulativeOffset(),e_top=e_dim[1],e_left=e_dim[0],e_height=$(this.options.get("popup_by")).getDimensions().height,e_bottom=e_top+e_height;var e_width=$(this.options.get("popup_by")).getDimensions().width;if(((e_bottom+c_height)>(w_top+w_height))&&(e_bottom-c_height>w_top))above=true;var left_px=e_left-(180-e_width)/2+"px",top_px=(above?(e_top-c_height):(e_top+e_height)).toString()+"px";this.calendar_div.style.left=left_px;this.calendar_div.style.top=top_px;this.calendar_div.setStyle({visibility:""});if(navigator.appName=="Microsoft Internet Explorer")this.iframe=$(document.body).build("iframe",{src:"javascript:false",className:"ie6_blocker"},{left:left_px,top:top_px,height:c_height.toString()+"px",width:c_width.toString()+"px",border:"0px"})},initCalendarDiv:function(){var parent=document.body;var style={position:"absolute",visibility:"hidden",left:0,top:0};this.calendar_div=$(parent).build('div',{className:"calendar_date_select"},style);var that=this;$w("top header body").each(function(name){eval("var "+name+"_div = that."+name+"_div = that.calendar_div.build('div', { className: 'cds_"+name+"' }, { clear: 'left'} ); ");});this.initHeaderDiv();this.initCalendarGrid();this.refresh();},initHeaderDiv:function(){var header_div=this.header_div;this.next_month_button=header_div.build("a",{innerHTML:"<img src='"+Base.imageURL("/images/calendar_date_select/right.png")+"'  alt='&gt' />",href:"#",onclick:function(){this.navMonth(this.date.getMonth()+1);return false;}.bindAsEventListener(this),className:"next"});this.prev_month_button=header_div.build("a",{innerHTML:"<img src='"+Base.imageURL("/images/calendar_date_select/left.png")+"'  alt='&lt' />",href:"#",onclick:function(){this.navMonth(this.date.getMonth()-1);return false;}.bindAsEventListener(this),className:"prev"});this.month_select=new DateComboBox(header_div,$R(0,11).map(function(m){return[Date.months[m],m]}),{id:(this.target_element.id+"_month"),className:"month",onchange:"this.parent.navMonth(this.getValue())",parent:this});this.year_select=new DateComboBox(header_div,this.yearRange().toArray().reverse(),{id:(this.target_element.id+"_year"),className:"year",onchange:"this.parent.navYear(this.getValue())",parent:this});},initCalendarGrid:function(){var body_div=this.body_div;this.calendar_day_grid=[];var days_table=body_div.build("table",{cellPadding:"0px",cellSpacing:"0px",width:"100%"})
var weekdays_row=days_table.build("thead").build("tr");Date.weekdays.each(function(weekday){weekdays_row.build("th",{innerHTML:weekday});});var days_tbody=days_table.build("tbody")
var row_number=0,weekday;for(var cell_index=0;cell_index<42;cell_index++)
{weekday=(cell_index+Date.first_day_of_week)%7;if(cell_index%7==0)days_row=days_tbody.build("tr",{className:'row_'+row_number++});(this.calendar_day_grid[cell_index]=days_row.build("td",{calendar_date_select:this,onclick:function(){this.calendar_date_select.updateSelectedDate(this);},className:(weekday==0)||(weekday==6)?" weekend":""},{cursor:"pointer"})).build("div");this.calendar_day_grid[cell_index];}},refresh:function()
{this.refreshMonthYear();this.refreshCalendarGrid();this.setSelectedClass();},refreshCalendarGrid:function(){this.beginning_date=new Date(this.date).stripTime();this.beginning_date.setDate(1);this.beginning_date.setHours(12);var pre_days=this.beginning_date.getDay()
if(pre_days<3)pre_days+=7;this.beginning_date.setDate(1-pre_days+Date.first_day_of_week);var iterator=new Date(this.beginning_date);var this_month=this.date.getMonth();vdc=this.options.get("valid_date_check");for(var cell_index=0;cell_index<42;cell_index++)
{day=iterator.getDate();month=iterator.getMonth();cell=this.calendar_day_grid[cell_index];Element.remove(cell.childNodes[0]);div=cell.build("div",{innerHTML:day});if(month!=this_month)div.className="other";cell.day=day;cell.month=month;cell.year=iterator.getFullYear();if(vdc){if(vdc(iterator.stripTime()))cell.removeClassName("disabled");else cell.addClassName("disabled")};iterator.setDate(day+1);}},refreshMonthYear:function(){var m=this.date.getMonth();var y=this.date.getFullYear();this.month_select.setValue(m,false);var e=this.year_select.element;if(this.flexibleYearRange()&&(!(this.year_select.setValue(y,false))||e.selectedIndex<=1||e.selectedIndex>=e.options.length-2))this.populateYearRange();this.year_select.setValue(y);},populateYearRange:function(){this.year_select.populate(this.yearRange().toArray());},yearRange:function(){if(!this.flexibleYearRange())
return $R(this.options.get("year_range")[0],this.options.get("year_range")[1]);var y=this.date.getFullYear();return $R(y-this.options.get("year_range"),y+this.options.get("year_range"));},flexibleYearRange:function(){return(typeof(this.options.get("year_range"))=="number");},validYear:function(year){if(this.flexibleYearRange()){return true;}else{return this.yearRange().include(year);}},clearSelectedClass:function(){if(this.selected_cell)this.selected_cell.removeClassName("selected");},setSelectedClass:function(){if(!this.selection_made)return;this.clearSelectedClass()
if($R(0,42).include(days_until=this.beginning_date.stripTime().daysDistance(this.selected_date.stripTime()))){this.selected_cell=this.calendar_day_grid[days_until];this.selected_cell.addClassName("selected");}},reparse:function(){this.parseDate();this.refresh();},dateString:function(){if(this.date.getFullYear()!=this.selected_date.getFullYear()||this.date.getMonth()!=this.selected_date.getMonth()){this.selected_date=this.date;}
return this.selected_date.toFormattedString();},parseDate:function(){var value=$F(this.target_element).strip()
this.selection_made=(value!="");this.date=value==""?NaN:Date.parseFormattedString(this.options.get("date")||value);if(isNaN(this.date))this.date=new Date();if(!this.validYear(this.date.getFullYear()))this.date.setFullYear((this.date.getFullYear()<this.yearRange().start)?this.yearRange().start:this.yearRange().end);this.selected_date=new Date(this.date);},updateSelectedDate:function(partsOrElement){var parts=$H(partsOrElement);if((this.target_element.disabled||this.target_element.readOnly)&&this.options.get("popup")!="force")return false;if(parts.get("day")){var t_selected_date=this.selected_date,vdc=this.options.get("valid_date_check");for(var x=0;x<=3;x++)t_selected_date.setDate(parts.get("day"));t_selected_date.setFullYear(parts.get("year"));t_selected_date.setMonth(parts.get("month"));if(vdc&&!vdc(t_selected_date.stripTime())){return false;}
this.selected_date=t_selected_date;this.selection_made=true;}
this.setSelectedClass();this.close();},navMonth:function(month){target_date=new Date(this.date);if(this.options.get("default_to")=="last"){target_date.setMonth(parseInt(month)+1);target_date.setDate(0);}else{target_date.setMonth(month);target_date.setDate(1);}
return(this.navTo(target_date));},navYear:function(year){(target_date=new Date(this.date)).setFullYear(year);return(this.navTo(target_date));},navTo:function(date){if(!this.validYear(date.getFullYear()))return false;this.date=date;this.refresh();this.callback("after_navigate",this.date);return true;},updateValue:function(){this.target_element.value=this.dateString();},close:function(cancel){if(this.closed)return false;var vdc=this.options.get("valid_date_check");if((!vdc||vdc(this.date.stripTime()))&&!cancel&&this.initial_value==this.target_element.value)
this.updateValue();if(this.initial_value!=this.target_element.value)
this.callback("onchange");this.callback("before_close");this.target_element.calendar_date_select=nil;Event.stopObserving(document,"mousedown",this.closeIfClickedOut_handler);Event.stopObserving(document,"keypress",this.keyPress_handler);this.calendar_div.remove();this.closed=true;if(this.iframe)this.iframe.remove();if(this.target_element.type!="hidden"&&!this.target_element.disabled)this.target_element.focus();this.initial_value=nil;this.callback("after_close");},closeIfClickedOut:function(e){if(!$(Event.element(e)).descendantOf(this.calendar_div))this.close();},keyPress:function(e){if(e.keyCode==Event.KEY_ESC)this.close(true);if(e.keyCode==Event.KEY_RETURN)this.close();},callback:function(name,param){if(this.options.get(name)){this.options.get(name).bind(this.target_element)(param);}}}
var SearchPreview={findPlayButton:function(ev){var el=Event.findElement(ev);var play=el.hasClassName('inner')?el:el.up('.inner');if(play)play=play.down('a.play');return play;},over:function(ev){var el;if(el=SearchPreview.findPlayButton(ev)){$$('a.play').each(toggle_invisible);toggle_visible(el);}},out:function(ev){$$('a.play').each(toggle_invisible);},click:function(ev){var originatingElement=Event.findElement(ev);el=SearchPreview.findPlayButton(ev)
if(el&&originatingElement&&el!=originatingElement){window.open(el.href,"_blank");}},onLoad:function(){Behaviors.onLoad();$$('div.inner').each(function(el){Event.observe(el,'mouseover',SearchPreview.over);Event.observe(el,'mouseout',SearchPreview.out);Event.observe(el,'click',SearchPreview.click);});$$('a').each(function(a){a.target='_blank';});}};
var AvailabilityNotes=Class.create();Object.extend(AvailabilityNotes,{toggle_popup:function(el){if(FloatingDiv.visible())FloatingDiv.hide();else FloatingDiv.show(el,$('availability-container'),400,{'from_availability_notes':true});return false;},init:function(el,length){var get_text=function(node){if(node.innerText!=undefined){return node.innerText;}else{return node.textContent;}}
var trunc=function(node,len){var text=get_text(node).replace(/\s+/g," ");if(len>=text.length)return len-text.length;var i=0;for(i=0;i<node.childNodes.length;i++){if(node.childNodes[i].nodeType==3){var text=node.childNodes[i].nodeValue;text=text.replace(/\s+/g," ");if(text.length>len){while(len>=0&&!/\s/.test(text.charAt(len))){len--;}
if(len>0){node.childNodes[i].nodeValue=text.substr(0,len);i=i+1;}
while(i<node.childNodes.length){Element.remove(node.childNodes[i]);}
return-1;}else{len-=text.length;}}else{if(!$(node.childNodes[i]).hasClassName("availability-note-break")){len=trunc(node.childNodes[i],len);}
else{len=-1;i=i-1;}
if(len<0){i=i+1;while(i<node.childNodes.length){Element.remove(node.childNodes[i]);}
return-1;}}}
return 0;}
var e=el.cloneNode(true);e.id="availability-text-2";var len=trunc(e,length);if(len<0){e.innerHTML+="...";e.innerHTML+="<a href='javascript:void(0);' onclick='$(\"availability-text-2\").hide();$(\"availability-text-1\").show();' class='more'><div class='more'>more</div></a>";el.insert({before:e});e.show();}
else{el.show();}}});
var VideoList=Class.create();Object.extend(VideoList,{allLists:{},count:0,createLi:function(){var myElement=document.createElement('li');Element.extend(myElement);return myElement;},clearAllSelectedTerm:function(){$H(VideoList.allLists).each(function(pair){var videoList=pair.value;for(var i=0;i<videoList.elementToAddIn.childElements().size();i++){var element=videoList.elementToAddIn.childElements()[i];if(element.hasClassName('s')){element.removeClassName('s');}}})},setDataForVideoList:function(id,data){if(VideoList.allLists[id]){VideoList.allLists[id].displayCollection=eval(data);}},updateWithExtraFilters:function(params){if(typeof(params)!='object')return new Object();var filter_pane=$('filter-pane');if(filter_pane&&filter_pane.down('div.filters')){$w('captions huluplus hd free').each(function(type){var filter=filter_pane.down('div.filters').down('a.'+type);if(filter){checked=filter.hasClassName('checked');params["has_"+type]=checked?1:0;}});}
return params;},changeFilters:function(url){var query_string=url.match(/\?.*/);var path=url.split('?')[0];if(query_string)
query_string=query_string[0];else
query_string='';query_string=query_string.toQueryParams();query_string=VideoList.updateWithExtraFilters(query_string);query_string=$H(query_string);query_string.unset("ajax_call");query_string=Object.toQueryString(query_string);if(query_string&&query_string!='')
window.location.href=path+'?'+query_string;else
window.location.href=path;},changeExtraFilters:function(filter_type,ajax){var filter_pane=$('filter-pane');var checked=false;var loading=null;var clearall="all"==filter_type.toLowerCase();var ajax_call=(ajax!=null&&ajax==true);if(filter_pane&&filter_pane.down('div.filters')){var filter=filter_pane.down('div.filters').down('a.'+filter_type);if(clearall||filter){if(clearall)
filter_pane.down('div.filters').select("a.checked").each(function(el){el.removeClassName("checked");});else
filter.toggleClassName('checked');var ajax_params=window.location.search.toQueryParams();if(ajax_call){if($('profile-tabs-container')){loading=$('profile-tabs-container').down('img.loading');if(loading)
loading.show();}
ajax_params["ajax_call"]=1;}
$w('captions huluplus hd free').each(function(type){filter=filter_pane.down('div.filters').down('a.'+type);if(filter){checked=filter.hasClassName('checked');ajax_params["has_"+type]=checked?1:0;}});ajax_params=$H(ajax_params);ajax_params.unset('page');var ajax_url=window.location.pathname+'?'+Object.toQueryString(ajax_params);if(ajax_call){new Ajax.Updater($("videos-list").down('.videos-shows-container'),ajax_url,{method:'get',onComplete:function(){if(loading)
loading.hide();}});}else{window.location.href=ajax_url;}}}}});Object.extend(VideoList.prototype,{initializeCache:function(displayCollections){for(var i=0;i<displayCollections.size();i++){this.pageCache[i+1]=displayCollections[i];}},initialize:function(displayCollection,itemsPerPage,pageNumber,ajaxRequestUrl,ajaxParams,elementToAddIn,isHulu,autoPaint,pointToFirst,total_number,displayHorizontalPager,videos,ajax){this.displayCollection=eval(displayCollection);this.style=null;this.itemsPerPage=itemsPerPage;this.pageNumber=pageNumber;for(var i=0;i<this.displayCollection.size();i++){if(parseInt(this.displayCollection[i][0])>=1000){this.pageNumber=this.ceil(total_number*1.0/this.itemsPerPage);this.style={width:'32px'};this.displayCollection=this.displayCollection.splice(0,this.itemsPerPage);break;}}
this.currentPage=1;this.ajaxRequestUrl=ajaxRequestUrl;this.ajaxParams=ajaxParams;this.register();this.pageToAddIn=$(elementToAddIn+"p");this.elementToAddIn=$(elementToAddIn);this.isHulu=isHulu;this.pageCache={}
this.pageCache[this.currentPage]=this.displayCollection;this.displayHorizontalPager=displayHorizontalPager==true?true:false;if(typeof(pointToFirst)!='undefined'){this.pointToFirst=pointToFirst;}else{this.pointToFirst=false;}
if(this.pointToFirst==true){this.increase=1;}else{this.increase=-1;}
if(typeof(autoPaint)!='undefined'){this.autoPaint=autoPaint;}else{this.autoPaint=true;}
this.videos=videos;this.initialized=false;if(this.videos){if(ajax){}else{Event.observe(window,"load",function(){this.preload();}.bind(this));}}},preload:function(createVideo){var index=this.pointToFirst?0:this.displayCollection.length-1;var isHulu=this.displayCollection[index][4]=='1'?true:false;var id=(isHulu==true?"hulu":"offsite")+this.displayCollection[index][1];if(this.videos[id]!=null){if(createVideo)
this.createVideo(id);else
pingImage(this.videos[id].thumbnail_url);}
return true;},register:function(){this.id="VideoList"+VideoList.count;VideoList.count+=1;VideoList.allLists[this.id]=this;},mouseOverHandler:function(event){var element=Event.findElement(event);this.displayOneElement(element);if(typeof(_updateSERPTracking)!='undefined')_updateSERPTracking();},mouseClickHandler:function(event){var element=Event.findElement(event);var isHulu=element.getAttribute('flag')=='1'?true:false;var tracStr=isHulu?'hulu_':'offsite_';tracStr=tracStr+element.value+':-1';SearchTracking.send(null,null,null,null,tracStr,null,null,'number-in-promote-panel');if(isHulu){window.location.href=element.getAttribute('video_url');}else{window.open(element.getAttribute('video_url').unescapeHTML());}},displayList:function(){this.elementToAddIn.innerHTML="";if(this.pageToAddIn)
this.pageToAddIn.innerHTML="";if(this.pageNumber>1){var liFirst=VideoList.createLi();liFirst.addClassName("btn first");liFirst.innerHTML="&nbsp;";if(this.hasPreviousPage()){liFirst.addClassName("first-enabled");Event.observe(liFirst,"click",function(event){this.currentPage-=this.increase;if(this.currentPage<1)
this.currentPage=1;this.ajaxRequestForData();}.bind(this));}else{liFirst.addClassName("disabled");}
if(this.displayHorizontalPager)
this.elementToAddIn.appendChild(liFirst);else
this.pageToAddIn.appendChild(liFirst);}
for(var i=0;i<this.displayCollection.size();i++){var li=VideoList.createLi();li.innerHTML=this.displayCollection[i][0];if(!this.displayCollection[i][2].blank()){var hover_anchor=document.createElement('a');Element.extend(hover_anchor);hover_anchor.setAttribute("href",this.displayCollection[i][2]);if(this.displayCollection[i][4]=='0'){hover_anchor.setAttribute("offsiteInfoHoverId",this.displayCollection[i][1]);}
li.appendChild(hover_anchor);li.addClassName("info_hover");}
li.setAttribute("value",this.displayCollection[i][1]);li.setAttribute("video_url",this.displayCollection[i][2]);li.setAttribute("flag",this.displayCollection[i][4]);var offsitestr=this.isHulu?"":", isOffsite : true";li.setAttribute("tracking_repository","{'place' : 'selector', 'season' : "+this.ajaxParams["season_number"]+", 'episode' : "+this.displayCollection[i][0]+", 'id' : "+this.displayCollection[i][1]+offsitestr+"}");if(this.displayCollection[i][3]==1||this.displayCollection[i][5]==1){li.addClassName('coming-soon');}
if(this.style){li.setStyle(this.style);}
Event.observe(li,"mouseover",this.mouseOverHandler.bind(this));if(this.displayCollection[i][5]!=1){Event.observe(li,"click",this.mouseClickHandler.bind(this));}
this.elementToAddIn.appendChild(li);if((i==this.displayCollection.size()-1)&&(this.displayCollection[i][3]==0)&&(this.autoPaint==true)&&(this.pointToFirst==false)){this.displayOneElement(li);}
if((i==0)&&(this.autoPaint==true)&&(this.pointToFirst==true)){this.displayOneElement(li);}
if((i==this.displayCollection.size()-2)&&(this.displayCollection[i+1][3]==1)&&(this.autoPaint==true)){this.displayOneElement(li);}}
if(this.pageNumber>1){var liLast=VideoList.createLi();liLast.addClassName("btn last");liLast.innerHTML="&nbsp;";if(this.hasNextPage()){liLast.addClassName("last-enabled");Event.observe(liLast,"click",function(event){this.currentPage+=this.increase;if(this.currentPage>this.pageNumber)
this.currentPage=this.pageNumber;this.ajaxRequestForData();}.bind(this))}else{liLast.addClassName("disabled");}
if(this.displayHorizontalPager)
this.elementToAddIn.appendChild(liLast);else
this.pageToAddIn.appendChild(liLast);}},ajaxRequestForData:function(){var page=this.currentPage;if(page<1){page=1;}else{if(this.pageNumber>-1&&page>this.pageNumber){page=this.pageNumber;}}
if(this.pageCache[page]){this.displayCollection=this.pageCache[page];this.displayList();this.showVideoInfo();InfoHover.observeLinks();}else{this.ajaxParams.page=page;this.ajaxParams.id=this.id;this.ajaxParams.items_per_page=this.itemsPerPage;var url=[this.ajaxRequestUrl,$H(this.ajaxParams).toSortedQueryString()].join('?')
new Ajax.Request(url,{method:'get',onComplete:function(){this.currentPage=page;this.displayList();this.pageCache[this.currentPage]=this.displayCollection;this.showVideoInfo();InfoHover.observeLinks();}.bind(this)});}},showVideoInfo:function(){var elements=this.elementToAddIn.children;var count=elements.length;if(this.pointToFirst){elements[0].getAttribute("flag")?elements[0].simulate("mouseover"):elements[1].simulate("mouseover");}else{elements[count-1].getAttribute("flag")?elements[count-1].simulate("mouseover"):elements[count-2].simulate("mouseover");}},displayOneElement:function(element){if(this.initialized==false){$H(this.videos).each(function(video){pingImage(video[1].thumbnail_url);});this.initialized=true;}
VideoList.clearAllSelectedTerm();element.addClassName("s");var isHulu=element.getAttribute('flag')=='1'?true:false;var id=(isHulu==true?"hulu":"offsite")+element.value
if($(id)){}else{this.createVideo(id);}
$A($(id).up().childElements()).each(function(t){t.visible()?t.hide():null;});$(id).show();var parentEle=$(id).up();if(!parentEle.visible()){parentEle.show();}
if(SuperPlus){SuperPlus.hide();}},hasPreviousPage:function(){if(!this.pointToFirst){return(this.currentPage!=this.pageNumber)}else{return this.currentPage!=1;}},hasNextPage:function(){if(!this.pointToFirst){return(this.currentPage!=1)}else{return this.currentPage!=this.pageNumber;}},ceil:function(value){if(parseInt(value)!=value){return parseInt(value)+1;}else{return value;}},createVideo:function(id){if(this.videos[id]){VideoDisplayHelper.createVideo(this.videos[id]);var el=$(id).down(".play-button-hover");if(el){Behaviors.toggleFirstDescendantForSingle(el);}
var el=$(id).down(".info_hover");if(el){if(el.hasClassName('observing')){if(el.hasClassName('click_to_popup'))
{Element.observe(el,'click',InfoHover.over);el.style.visibility='visible';}
else{Element.observe(el,'mouseover',InfoHover.over);el=$(id).down(".show-title-gray");if(el){Element.observe(el,'mouseover',InfoHover.over);}}}}}}});var SeasonList=Class.create(VideoList);Object.extend(SeasonList,{allLists:{},count:0,clearAllSelectedTerm:function(){$H(SeasonList.allLists).each(function(pair){var videoList=pair.value;for(var i=0;i<videoList.elementToAddIn.childElements().size();i++){var element=videoList.elementToAddIn.childElements()[i];if(element.hasClassName('s')){element.removeClassName('s');}}})}});Object.extend(SeasonList.prototype,{ajaxRequestForData:function(){var page=this.currentPage;this.displayCollection=this.pageCache[page];this.displayList();this.interval=undefined;this.idToDisplay=undefined;},mouseOverHandler:function(event){},ajaxRequestForVideoList:function(id,season,element){this.ajaxParams.page=1;this.ajaxParams.items_per_page=20;this.ajaxParams.dom_id=id;this.ajaxParams.season_number=season;this.ajaxParams.create_video_list=1;var url=[this.ajaxRequestUrl,$H(this.ajaxParams).toSortedQueryString()].join('?')
new Ajax.Request(url,{method:'get',onSuccess:function(rtv){$(id).removeClassName("unload");eval(rtv.responseText);}.bind(this),onComplete:function(){this.displayVideoForSeason(id,element);}.bind(this)});},displayVideoForSeason:function(id,element){$(id).up().childElements().each(function(element){if(element.getAttribute("flag")=="1")element.hide();});var tmp=$(id);tmp.show();var left=Position.cumulativeOffset(tmp)[0]+"px";var top=Position.cumulativeOffset(tmp)[1]+"px";var width=tmp.getStyle("width");if($("mask")){$("mask").setStyle({"left":left,"top":top,"width":width,"height":"50px"});$("mask").show();Element.fade($("mask"),{"duration":0.5});}
this.idToDisplay="season"+element.getAttribute("value");var displayVideoForSeasonInternal=function(){var id=this.idToDisplay;var elements=$(id).children;var count=elements.length;if(count>0){if(this.interval){clearInterval(this.interval);this.interval=undefined;}
$A($("promo_videos").childElements()).each(function(f){if(f.visible()){f.hide();}});if(this.pointToFirst){elements[0].getAttribute("flag")?elements[0].simulate("mouseover"):elements[1].simulate("mouseover");}else{if(elements[count-1].getAttribute("flag")){if(elements[count-1].hasClassName("coming-soon")&&(count-2>0)){elements[count-2].simulate("mouseover");}else{elements[count-1].simulate("mouseover");}}else{elements[count-2].simulate("mouseover");}}}}.bind(this);if($(this.idToDisplay).children.length>0){displayVideoForSeasonInternal();}else{if(this.interval){clearInterval(this.interval);}
this.interval=setInterval(displayVideoForSeasonInternal,30);}
setTimeout(function(){InfoHover.observeLinks();},500);},mouseClickHandler:function(event){var element=Event.findElement(event);SeasonList.clearAllSelectedTerm();element.addClassName("s");var id="season"+element.getAttribute("value")+"u";if($(id).hasClassName("unload")){var season=element.innerHTML;this.ajaxRequestForVideoList(id,season,element);}else{this.displayVideoForSeason(id,element);}},displayOneElement:function(event){var elements=this.elementToAddIn.children;var count=elements.length;if(this.pointToFirst){elements[0].getAttribute("flag")?elements[0].simulate("click"):elements[1].simulate("click");}else{elements[count-1].getAttribute("flag")?elements[count-1].simulate("click"):elements[count-2].simulate("click");}},register:function(){this.id="SeasonList"+SeasonList.count;SeasonList.count+=1;SeasonList.allLists[this.id]=this;},fadeIn:function(element){var f=function(){}}});var VideoDisplayHelper=Class.create();Object.extend(VideoDisplayHelper,{createVideo:function(video){var parentElement=$("videos_for_season"+video.season_number);if(!parentElement){parentElement=VideoDisplayHelper.createElement("div");parentElement.setAttribute("id","videos_for_season"+video.season_number);$("promo_videos").appendChild(parentElement);}
var element=VideoDisplayHelper.createElement("div");var offsitestr=video.offsite?", 'isOffsite' : true":"";element.setAttribute("tracking_repository","{'place' : 'thumbnail', 'season' : "+video.season_number+", 'episode' : "+video.episode_number+", 'id' : "+video.id+offsitestr+"}");element.setStyle({overflow:"auto",marginTop:"20px"});element.setAttribute("id",video.gid);str='<div class="layout a-b-c" style="overflow:auto">';str+='<div class="gr a" style="overflow:auto; width:131px">';str+='<div class="home-thumb" style="overflow:hidden; min-height:75px; padding:0; width:auto; position:relative">';str+='<div class="home-play-container" style="height:71px; position:relative">';str+='<span style="overflow:hidden" class="play-button-hover small-hover-box '+(video.offsite?"offsite-play":"")+'">';str+=VideoDisplayHelper.thumbnailLink(video);if(video.coming_soon||video.auth_only)
str+=VideoDisplayHelper.comingSoonBanner(video,127);str+='</span>';str+='</div>';if(video.offsite){str+='<div class="callout-playlist-container" style="width:126px; top:57px">';str+='<span style="float:left; margin-left:3px">';str+='<a href="'+video.link_url+'" target="'+(video.is_javascript_link?'':'_blank')+'" class="offsite-link-container">Watch at '+video.site_source.truncate(11)+'</a>';str+='</span></div>';}
str+='</div></div>';str+='<div class="gr b" style="width:18px; margin:53px 2px 0 0">';if(!video.offsite){str+=VideoDisplayHelper.smallQueueLink(video);}
str+='</div>';str+='<div class="gr c" style="width:310px">';str+='<div class="show-title-container">';if(video.coming_soon)
str+='<div class="schedule"><a href="/coming-soon">Coming Soon: <span style="font-weight:normal">'+
video.available_at+'</span></a></div>';if(video.show_plus_sticker)
str+=VideoDisplayHelper.showPlusSticker(video);str+=video.link_html;str+=" </div>";str+=video.show_video_type;if(video.coming_soon||video.auth_only)
str+='<div style="margin:0 0 0 3px">'+video.small_email_link+'</div>';str+='</div></div>';element.innerHTML=str;parentElement.appendChild(element);},createElement:function(name){var myElement=document.createElement(name);Element.extend(myElement);return myElement;},linkToVideoThumbnail:function(video,size){},comingSoonBanner:function(video,size){var style="";var message="";if(size==127){style='style="top:51px; width:'+size+'px;"';message='<span style="padding-left:5px">Coming Soon</span>';return'<div class="coming-soon" '+style+'>'+message+'</div>';}
return"";},showPlusSticker:function(video){var src="<a href=\"/plus?src=sticker\">"
+"<img title=\"Available in HD on TV, mobile and web with a Hulu Plus subscription\""
+"src=\"http://static.huluim.com/images/icon-hulu-plus-badge-light.gif?1291277338\" class=\"hplus-sticker\""
+"alt=\"Available in HD on TV, mobile and web with a Hulu Plus subscription\"></a>";return src;},smallQueueLink:function(video){var plusOnly=video.plus_only?"true":"false";var authValid=video.has_auth?"true":"false";var src="<span class=\"add-me super_plus\"><a onclick=\"SuperPlus.show(window.event||event,{id:"+video.id+",plus_only:"+plusOnly+",auth_valid:"+authValid+"});return false;\" href=\"#\"><img border=\"0\" title=\"Add this video to your queue\" src=\"/images/icon-add.gif\" id=\"queue_img_73394\" class=\"hover-me\" alt=\"Add this video to your queue\"></a></span>";return src;},thumbnailLink:function(video){var gid=(video.offsite?"offsite_":"hulu_")+video.id;var thumbnailClickBeacon=video.content_id>0?"Beacon.trackThumbnailClick(this, 'video', "+video.id+");":'';var disable_link_css="";var disable_thumbnail="";var disable_click="";var href="href=\""+video.link_url+"\"";if(video.auth_only){disable_thumbnail="thumbnail_disabled";disable_link_css="link_disabled ";disable_click="return false; ";}
var str="<a onclick=\""+disable_click+thumbnailClickBeacon+" SearchTracking.send(null, null, null, null, '"+gid+":-1')\" class=\"info_hover "+disable_link_css+(video.previewable?"plus-preview":"")+" observing\""
+href+(video.offsite?(" target=\"_blank\" offsiteinfohoverid=\""+video.id+"\""):"")+"><img border=\"0\" width=\"127\" height=\"69\" style=\"width: 127px; height: 69px;\""
+"class=\""+disable_thumbnail+" thumbnail\""+" src=\""+video.thumbnail_url+"\" id=\"lazy-load-1\"></a>";return str;}});
var Comment=Class.create();Object.extend(Comment,{singleSubmitLock:false,openCommentForm:function(review_id,el,from_bottom,from_lightbox){if(READ_ONLY)return;if(!Behaviors.isLoggedIn()){if(from_lightbox)
FloatingLoginForm.show(el,true);else
FloatingLoginForm.show(el,false);return false;}
if(!Behaviors.isEmailValidated()){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:true,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated())
Login.showEmailValidation();else
Comment.doOpenCommentForm(review_id,el,from_bottom,from_lightbox);}});return false;}
else{Comment.doOpenCommentForm(review_id,el,from_bottom,from_lightbox);}
return false;},doOpenCommentForm:function(review_id,el,from_bottom,from_lightbox){new Ajax.Request("/users/permission_check",{asynchronous:true,method:"get",onComplete:function(request){info=request.responseText.evalJSON();if(info.permitted){$$('.c-form-block').each(function(e1){e1.hide();});formDiv='r-'+review_id;if(from_lightbox){formDiv+='-lightbox';}
formDiv+='-form';if(from_bottom){formDiv+='-bottom';}
if($(formDiv)){$(formDiv).appendChild($('c-form-instance'));$('c-form-commentable-id').value=review_id;if(from_lightbox){$('c-form-lightbox').value=true;}
else{$('c-form-lightbox').value=false;}
if($('c-form-instance').style.display=='none')$('c-form-body').value="";$('c-error-container').hide();$(formDiv).parentNode.style.display="";$(formDiv).style.display="";$('c-form-submit').src=Base.imageURL('/images/btn-forums-submit.gif');$('c-form-instance').show();$('c-form-body').focus();if(Prototype.Browser.IE){$(formDiv).removeClassName('ie6');$(formDiv).addClassName('ie6');}}}
else
Behaviors.showSubmitPermission("comment");}});},closeCommentForm:function(){Element.update('c-form-errors','');$('c-form-body').value="";$('c-form-commentable-id').value="";$('c-form-instance').parentNode.parentNode.style.display="none";$('c-form-instance').parentNode.style.display="none";$('c-form-instance').hide();$('c-form-loading').hide();},toggleComments:function(commentable_type,commentable_id,new_comment,from_lightbox){var comments_section_id;var toggle_section_id;var loading_section_id;if(from_lightbox){comments_section_id="r-"+commentable_id+"-lightbox-comments-area";toggle_section_id="r-"+commentable_id+"-lightbox-comments-toggle";loading_section_id="r-"+commentable_id+"-lightbox-comments-loading";}
else{comments_section_id="r-"+commentable_id+"-comments-area";toggle_section_id="r-"+commentable_id+"-comments-toggle";loading_section_id="r-"+commentable_id+"-comments-loading";}
if($(comments_section_id).className=='r-comments-preload'||new_comment)
{$(loading_section_id).show();$(toggle_section_id).src=Base.imageURL('/images/button-expand.gif');$(comments_section_id).className='';params={};params['commentable_id']=commentable_id+'';params['commentable_type']=commentable_type+'';if(new_comment){params['last_page']=true;}
if(from_lightbox){params['lightbox']=true;}
else{params['lightbox']=false;}
new Ajax.Updater(comments_section_id,'/comments/list',{asynchronous:true,evalScripts:true,parameters:params,method:'get',onComplete:function(){$(loading_section_id).hide();setTimeout("$('"+toggle_section_id+"').addClassName('ie6');",10);}});}
else
{if($(comments_section_id).style.display!='none'){$(comments_section_id).hide();$(toggle_section_id).src=Base.imageURL('/images/button-collapse-hover.gif');}
else{$(comments_section_id).show();$(toggle_section_id).src=Base.imageURL('/images/button-expand-hover.gif');}}},expandComments:function(commentable_type,commentable_id,from_lightbox){var comments_section_id;var toggle_section_id;if(from_lightbox){comments_section_id="r-"+commentable_id+"-lightbox-comments-area";toggle_section_id="r-"+commentable_id+"-lightbox-comments-toggle";}
else{comments_section_id="r-"+commentable_id+"-comments-area";toggle_section_id="r-"+commentable_id+"-comments-toggle";}
if($(comments_section_id).className=='r-comments-preload')
Comment.toggleComments(commentable_type,commentable_id,false,from_lightbox);else if($(comments_section_id).style.display=='none'){$(comments_section_id).show();$(toggle_section_id).src=Base.imageURL('/images/button-expand.gif');}}});
if(typeof Effect=='undefined')
throw("controls.js requires including script.aculo.us' effects.js library");var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(element,update,options){element=$(element);this.element=element;this.update=$(update);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions)
this.setOptions(options);else
this.options=options||{};this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(element,update){if(!update.style.position||update.style.position=='absolute'){update.style.position='absolute';Position.clone(element,update,{setHeight:false,offsetTop:element.offsetHeight});}
Effect.Appear(update,{duration:0.05});};this.options.onHide=this.options.onHide||function(element,update){new Effect.Fade(update,{duration:0.05})};if(typeof(this.options.tokens)=='string')
this.options.tokens=new Array(this.options.tokens);if(!this.options.tokens.include('\n'))
this.options.tokens.push('\n');this.observer=null;this.element.setAttribute('autocomplete','off');Element.hide(this.update);Event.observe(this.element,'blur',this.onBlur.bindAsEventListener(this));Event.observe(this.element,'keydown',this.onKeyPress.bindAsEventListener(this));},show:function(){if(Element.getStyle(this.update,'display')=='none')this.options.onShow(this.element,this.update);if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,'position')=='absolute')){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+'_iefix');}
if(this.iefix)setTimeout(this.fixIEOverlapping.bind(this),50);},fixIEOverlapping:function(){var p=this.update.cumulativeOffset();var d=this.update.getDimensions();this.iefix.setStyle({left:p.left,top:p.top,width:d.width,height:d.height});this.iefix.show();},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,'display')!='none')this.options.onHide(this.element,this.update);if(this.iefix)Element.hide(this.iefix);},startIndicator:function(){if(this.options.indicator)Element.show(this.options.indicator);},stopIndicator:function(){if(this.options.indicator)Element.hide(this.options.indicator);},onKeyPress:function(event){if(this.active)
switch(event.keyCode){case Event.KEY_RETURN:this.selectEntry();Event.stop(event);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(event);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(event);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(event);return;}
else
if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&event.keyCode==0))return;this.changed=true;this.hasFocus=true;if(this.observer)clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices();},onHover:function(event){var element=Event.findElement(event,'LI');if(this.index!=element.autocompleteIndex)
{this.index=element.autocompleteIndex;this.render();}
Event.stop(event);},onClick:function(event){var element=Event.findElement(event,'LI');this.index=element.autocompleteIndex;this.selectEntry();this.hide();},onBlur:function(event){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false;},render:function(){if(this.entryCount>0){for(var i=0;i<this.entryCount;i++)
this.index==i?Element.addClassName(this.getEntry(i),"selected"):Element.removeClassName(this.getEntry(i),"selected");if(this.hasFocus){this.show();this.active=true;}}else{this.active=false;this.hide();}},markPrevious:function(){if(this.index>0)this.index--;else this.index=this.entryCount-1;},markNext:function(){if(this.index<this.entryCount-1)this.index++;else this.index=0;},getEntry:function(index){return this.update.firstChild.childNodes[index];},getCurrentEntry:function(){if(this.index<0){return null;}
return this.getEntry(this.index);},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry());},updateElement:function(selectedElement){if(this.options.updateElement){this.options.updateElement(selectedElement);return;}
var value='';if(this.options.select){var nodes=$(selectedElement).select('.'+this.options.select)||[];if(nodes.length>0)value=Element.collectTextNodes(nodes[0],this.options.select);}else
value=Element.collectTextNodesIgnoreClass(selectedElement,'informal');var bounds=this.getTokenBounds();if(bounds[0]!=-1){var newValue=this.element.value.substr(0,bounds[0]);var whitespace=this.element.value.substr(bounds[0]).match(/^\s+/);if(whitespace)
newValue+=whitespace[0];this.element.value=newValue+value+this.element.value.substr(bounds[1]);}else{this.element.value=value;}
this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement)
this.options.afterUpdateElement(this.element,selectedElement);},updateChoices:function(choices){if(!this.changed&&this.hasFocus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=i;this.addObservers(entry);}}else{this.entryCount=0;}
this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide();}else{this.render();}}},addObservers:function(element){Event.observe(element,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(element,"click",this.onClick.bindAsEventListener(this));},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices();}else{this.active=false;this.hide();}
this.oldElementValue=this.element.value;},getToken:function(){var bounds=this.getTokenBounds();return this.element.value.substring(bounds[0],bounds[1]).strip();},getTokenBounds:function(){if(null!=this.tokenBounds)return this.tokenBounds;var value=this.element.value;if(value.strip().empty())return[-1,0];var diff=arguments.callee.getFirstDifferencePos(value,this.oldElementValue);var offset=(diff==this.oldElementValue.length?1:0);var prevTokenPos=-1,nextTokenPos=value.length;var tp;for(var index=0,l=this.options.tokens.length;index<l;++index){tp=value.lastIndexOf(this.options.tokens[index],diff+offset-1);if(tp>prevTokenPos)prevTokenPos=tp;tp=value.indexOf(this.options.tokens[index],diff+offset);if(-1!=tp&&tp<nextTokenPos)nextTokenPos=tp;}
return(this.tokenBounds=[prevTokenPos+1,nextTokenPos]);}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(newS,oldS){var boundary=Math.min(newS.length,oldS.length);for(var index=0;index<boundary;++index)
if(newS[index]!=oldS[index])
return index;return boundary;};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(element,update,url,options){this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url;},getUpdatedChoices:function(){this.startIndicator();var entry=encodeURIComponent(this.options.paramName)+'='+
encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams)
this.options.parameters+='&'+this.options.defaultParams;new Ajax.Request(this.url,this.options);},onComplete:function(request){this.updateChoices(request.responseText);}});
Ajax.HuluAutocompleter=Class.create(Ajax.Autocompleter,{initialize:function(element,update,url,options){options.frequency=options.frequency||0.08;if(!options.widthExpand){this.widthExpand=0;}else{this.widthExpand=options.widthExpand;}
this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url;this.displayUp=false;this.direction=null;this.options.onShow=function(element,update,direction){var candidateOffsetTop=element.offsetHeight;var offsetTop=Position.page(element)[1];var totalHeight=getViewportInfo().height;var height=Element.getDimensions(update).height;var width=Element.getDimensions(element).width-2+this.widthExpand+"px";if(direction=="up"||direction=="down"){if(direction=="up"){candidateOffsetTop=candidateOffsetTop-height-Element.getDimensions(element).height;}}else{if(offsetTop+height+30>totalHeight){candidateOffsetTop=candidateOffsetTop-height-Element.getDimensions(element).height;this.direction="up";}else{this.direction="down";}}
if(!update.style.position||update.style.position=='absolute'){update.style.position='absolute';if(Prototype.Browser.IE){position=element.cumulativeOffset();update.setStyle({left:position.left+"px",top:(position.top+candidateOffsetTop)+"px"});}else{Element.clonePosition(update,element,{setHeight:false,offsetTop:candidateOffsetTop});}}
update.addClassName('hulu_auto_completer');update.setStyle({width:width});Effect.Appear(update,{duration:0.05});if(this.options.afterAddressed){this.options.afterAddressed=this.options.afterAddressed.bind(this);this.options.afterAddressed(update,element);}}.bind(this);},show:function(){if(Element.getStyle(this.update,'display')=='none'){this.options.onShow(this.element,this.update);}else{this.options.onShow(this.element,this.update,this.direction);}
if(!this.iefix&&(Element.getStyle(this.update,'position')=='absolute')){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" '+'style="display:none;position:absolute;z-index:90;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+'_iefix');}
if(this.iefix)setTimeout(this.fixIEOverlapping.bind(this),50);},fixIEOverlapping:function(){var p=this.update.cumulativeOffset();var d=this.update.getDimensions();this.iefix.setStyle({left:p.left+"px",top:p.top+"px",width:d.width+"px",height:d.height+"px"});this.iefix.show();IframeHacker.hideWhenScroll(this.hide,this);},selectEntry:function(){this.active=false;var entry=this.getCurrentEntry();originalQuery=$(this.element).value;if(entry){if(entry.getAttribute("href")){var link=entry.getAttribute("href");var term=this.getEntry(0).innerHTML.replace(/<(.[^>]+)>/g,"");this.trackLink(link,term);if(this.options.trackLink)
this.options.trackLink(link,term);window.location.href=entry.getAttribute("href");return;}
this.updateElement(entry);if(this.options.onSelected&&!entry.getAttribute("href")){var term=entry.innerHTML.replace(/<(.[^>]+)>/g,"");this.trackEntry(entry,term);if(this.options.trackEntry)
this.options.trackEntry(entry,term);this.options.onSelected();return;}}else{this.options.onSelectNone();}},trackEntry:function(entry,term){SearchTracking.setSearchUserId();if(entry.getAttribute('type')=='related_term'){SearchTracking.send(term,1,'All',null,"also-try:"+term,null,null,"ac");}else{SearchTracking.send(term,1,'All',null,null,null,null,"ac");}},trackLink:function(link,term){SearchTracking.setSearchUserId();var lastEpisode="/(.*)/most_recent";var collections="/collections/.*";var fullMovie="/watch/(.*)";if(link.match(lastEpisode)||link.match(fullMovie)){SearchTracking.send(term,1,'All',null,"hulu_-1",null,null,"ac");}
else if(link.match(collections)){SearchTracking.send(term,1,'All',null,"collection-page",null,null,"ac");}
else{SearchTracking.send(term,1,'All',null,"show-page",null,null,"ac");}},getLiChildNodes:function(){var children=$A(this.update.firstChild.childNodes);var simplifiedChildren=new Array();for(var i=0;i<children.size();i++){if(children[i].tagName=="LI"){simplifiedChildren.push(children[i]);}}
return simplifiedChildren;},getEntry:function(index){return this.getLiChildNodes()[index];},updateElement:function(selectedElement){if(this.options.updateElement){this.options.updateElement(selectedElement);return;}
var value='';if(this.options.select){var nodes=$(selectedElement).select('.'+this.options.select)||[];if(nodes.length>0)value=Element.collectTextNodes(nodes[0],this.options.select);}else
value=Element.collectTextNodesIgnoreClass(selectedElement,'informal');this.element.value=value;},updateChoices:function(choices){if(!this.changed&&this.hasFocus){this.update.innerHTML=choices;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.getLiChildNodes().length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=i;this.addObservers(entry);}}else{this.entryCount=0;}
this.stopIndicator();this.index=-1;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide();}else{this.render();}}},onKeyPress:function(event){if(this.active)
switch(event.keyCode){case Event.KEY_RETURN:this.selectEntry();this.hide();this.active=false;Event.stop(event);stopSearchSubmit=true;return;case Event.KEY_ESC:this.hide();this.active=false;this.updateQuery();Event.stop(event);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();this.updateQuery();Event.stop(event);return;case Event.KEY_DOWN:this.markNext();this.render();this.updateQuery();Event.stop(event);return;}
else
if(event.keyCode==Event.KEY_TAB||event.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&event.keyCode==0))return;this.changed=true;this.hasFocus=true;if(this.observer)clearTimeout(this.observer);this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000);},updateQuery:function(){if(this.index>=0&&this.active){var current=this.getEntry(this.index);current=current.hasClassName("indent_item")?this.getEntry(0):current;this.element.value=Prototype.Browser.Gecko?current.textContent:current.innerText;}
else{this.element.value=this.oldElementValue;}},markPrevious:function(){if(this.index>-1)this.index--;else this.index=this.entryCount-1;},markNext:function(){if(this.index<this.entryCount-1)this.index++;else this.index=-1;}});function getPageInfo(){var path=(window.location+"").split("/")[3];return(path.match(/^(hd|watch)$/)&&!Prototype.Browser.IE)?"page=watchPage":"";}
var Tag=Class.create();var SuggestItems={};var _t_tag,_r_tag,_m_tag;Object.extend(Tag,{TaggedTags:{},LoadingTagged:false,LoadedTagged:false,LoadedTabs:[],HasTags:false,Taggable:{},AddQueue:null,More:function(node,tag_category){if(!node.hasClassName("more-tags"))node=node.up(".more-tags");if(!node)return;var more_tags=node.next(".more-tags-in-category");if(more_tags){TagTracking.track("more_click",tag_category,Tag.Taggable);more_tags.removeClassName("more-tags-in-category");Element.insert(more_tags,{after:node});}
if(!node.next(".more-tags-in-category")){node.hide();}},GetLoc:function(id){var locs={"m":"main","t":"tab","r":"review"};return locs[id[0]];},ShowLogin:function(el){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return false;}
return true;},PushTab:function(tag_tab){var idx=-1;Tag.LoadedTabs.each(function(tab,index){if(tab.prefix==tag_tab.prefix)idx=index;});if(idx<0){Tag.LoadedTabs.push(tag_tab);return tag_tab;}
else{return Tag.LoadedTabs[idx];}},ClearTagged:function(){$$(".tags-content-cell input").each(function(cb){cb.checked=false;});Tag.LoadedTabs.each(function(tag){tag.clear();tag.setLoaded();});Tag.LoadedTagged=false;Tag.HasTags=false},Reload:function(url){Tag.ClearTagged();Tag.LoadedTabs.each(function(tag){tag.setLoading();});Tag.LoadTagged(url);},LoadTagged:function(url,tab_tag){if(!tab_tag){if(Tag.LoadingTagged||Tag.LoadedTagged)return false;if(Tag.LoadedTabs.length==0)return false;Tag.LoadingTagged=true;new Ajax.Request(url,{method:"get",onSuccess:function(request){var tagged_tags=request.responseText.evalJSON();Tag.TaggedTags=new Hash(tagged_tags.tagged_tags);Tag.HasTags=tagged_tags.has_tags;Tag.LoadedTagged=true;Tag.LoadedTabs.each(function(tag){tag.setTagged(Tag.TaggedTags,Tag.HasTags);});if(Tag.AddQueue){Tag.Add(Tag.AddQueue.tag_name,Tag.AddQueue.tag_id);Tag.AddQueue=null;}},onComplete:function(){Tag.LoadingTagged=false;}});}else{if(Tag.LoadedTagged){tab_tag.setTagged(Tag.TaggedTags,Tag.HasTags);}else if(!Tag.LoadingTagged){Tag.LoadTagged(url);}}},LocalValidation:function(value,errorNode,node){value=value.strip();if(value.length>=1)
{var values=value.split(",");values.each(function(v){v=v.strip();});if(values.length>30){Tag.ShowErrorMsg(errorNode,"Please add no more than 30 tags each time.",node);return false;}
var long_values=values.find(function(v){return v.length>50;})
if(long_values){Tag.ShowErrorMsg(errorNode,"Please make sure tags are not longer than 50 characters.",node);return false;}}else{Tag.ShowErrorMsg(errorNode,"Please input a non-blank tag.",node);return false;}
return true;},AddSubmit:function(node,btn,errorNode,loading){Tag.HideErrorMsg(errorNode);var value=node.value;var is_duplicated=function(invalids){dup=true;invalids.each(function(tagging){if(typeof tagging.error=="object"&&tagging.error.error){var error=tagging.error.error;if((typeof error)=="string"&&tagging.error.error.indexOf("already been taken")>=0){return true;}}
dup=false;throw $break;});return dup;}
if(Tag.LocalValidation(value,errorNode,node)){if(Tag.ShowLogin(btn)){if(loading){loading.show();}
Tag.Add(value,null,{success:function(valids,invalids,msg,pending_review){var loc=Tag.GetLoc(node.id);if(valids.length>0){TagTracking.track_add(loc,Tag.Taggable,"input",valids.pluck("tag_name"));}
if(invalids.length>0){TagTracking.track_add_fail(loc,Tag.Taggable,"input",invalids.pluck("tag_name"));}
if(invalids.length>0){var invalid_names=invalids.pluck("tag_name");TagSuggest.hide_error=false;node.value=invalid_names.join(",");if(msg){var error_msg="Sorry, you have added too many tags on this "+
Tag.Taggable.type.toLowerCase()+".";}else if(pending_review){var error_msg="Due to a high volume of user reports on the submitted content, we are holding this submission pending review.";}
else if(is_duplicated(invalids)){if(invalids.length>1){var error_msg="You have already tagged with these tags.";}else{var error_msg="You have already tagged this "+
Tag.Taggable.type.toLowerCase()+' "'+
Tag.CleanEscape(invalids[0].tag_name)+'".';}}
else{var error_msg="Sorry, that term isn't permitted. Please review our <a href='javascript:void(0)' onclick='return toggle_tags_learn_more(this, true);'>tags policy</a> for guidelines."}
Tag.ShowErrorMsg(errorNode,error_msg,node);}
else{node.value="";Tag.HideErrorMsg(errorNode);}},failure:function(authed){if(!authed){Tag.ShowErrorMsg(errorNode,"Please log in first.",node);}else{Tag.ShowErrorMsg(errorNode,"Sorry, that term isn't permitted or you do not have the proper privileges to post. Please review our <a href='javascript:void(0)' onclick='return toggle_tags_learn_more(this, true);'>tags policy</a> for guidelines. If you feel this is an error please <a target=\"_blank\" href=\"/support/support_form?category=account\">contact support</a>.",node);}},complete:function(){if(loading)
loading.hide();}});}}},HideErrorMsg:function(errorNode){errorNode.hide();},ShowErrorMsg:function(errorNode,msg,node){var position=node.positionedOffset();position[0]+=node.getWidth()+80;position[1]+=2;errorNode.setStyle({left:position[0]+"px",top:position[1]+"px"})
var loading=$(errorNode).previous("#t_tag_add_loading");if(loading)loading.hide();errorNode.innerHTML=msg;errorNode.show();},OnClick:function(node,prefix,options){if(Behaviors.isLoggedIn()){options=options||{};var tag_id=options["tag_id"]||node.readAttribute("tid");var tag_name=options["tag_name"]||node.value;var tag_type_id=options["tag_type_id"];Tag.LoadedTabs.each(function(tag){tag.setTagLoading(tag_id,tag_type_id);});if(node.checked==true){node.checked=false;var input=$(prefix+"tagging_tag_name");var errorNode=$(prefix+"tags_error");Tag.Add(tag_name,tag_id,{setLoading:true,success:function(valids,invalids,msg,pending_review){var loc=Tag.GetLoc(prefix);if(valids.length>0){TagTracking.track_add(loc,Tag.Taggable,"check_box",valids.pluck("tag_name"));}
if(invalids.length>0){TagTracking.track_add_fail(loc,Tag.Taggable,"check_box",invalids.pluck("tag_name"));}
if(msg){Tag.ShowErrorMsg(errorNode,"You have added too many tags on this "+Tag.Taggable.type.toLowerCase()+".",input);}
else if(pending_review||invalids.length>0)
{Tag.ShowErrorMsg(errorNode,"Due to a high volume of user reports on the submitted content, we are holding this submission pending review.",input);}
else{node.checked=true;}},failure:function(authed){if(authed){Tag.ShowErrorMsg(errorNode,"Sorry, you do not have the proper privileges to post.  If you feel this is an error please <a target=\"_blank\" href=\"/support/support_form?category=account\">contact support</a>.",input);var img=$(node).up("span.tags-checkbox");if(img)img=img.next("img.check-box-loading");if(img)img.hide();img=$(node).up("span.tags-checkbox");if(img)img.show();node.disabled=true;}}});}else{Tag.Remove(tag_name,tag_id,{setLoading:true,success:function(){var loc=Tag.GetLoc(prefix);TagTracking.track("remove",loc,Tag.Taggable,[["loc","checkbox"],["tags",tag_name]]);}});}}
else{node.checked=false;Tag.ShowLogin(node);}},OnRemove:function(node,tag_name,tag_id){if(Behaviors.isLoggedIn()){node.hide();node.next(".remove-tag-loading").show();Tag.Remove(tag_name,tag_id,{success:function(){try{var loc=Tag.GetLoc(node.up(".tagged-tags-container").id)
TagTracking.track("remove",loc,Tag.Taggable,[["loc","click"],["tags",tag_name]]);}catch(ex){}}});}else{Tag.ClearTagged();}},Add:function(tag_name,tag_id,options){if(tag_id&&(!options||!options.setLoading)){Tag.LoadedTabs.each(function(tag){tag.setTagLoading(tag_id);});}
new Ajax.Request("/taggings/create",{parameters:{"tagging[taggable_id]":Tag.Taggable.id,"tagging[taggable_type]":Tag.Taggable.type,"tagging[tag_names]":tag_name},method:"post",onSuccess:function(request){var created_tags=request.responseText.evalJSON();created_tags.valid.each(function(created_tag){Tag.TaggedTags.set(created_tag.tag_id,created_tag);Tag.LoadedTabs.each(function(tag){tag.add(created_tag);});var key=created_tag.tag_name.substr(0,2);if(SuggestItems[key]){var item=SuggestItems[key].findAll(function(item){return(item[0]==created_tag.tag_name);});if(item&&item.length==1){item[0][2]++;}else{SuggestItems[key].push([created_tag.tag_name,created_tag.tag_id,1]);}}});if(options&&(typeof options.success)=="function"){options.success(created_tags.valid,created_tags.invalid,created_tags.reach_max,created_tags.pending_review);}},onFailure:function(request){if(options&&"function"==(typeof options.failure)){options.failure(request.status!=401);}},onComplete:function(){if(tag_id){Tag.LoadedTabs.each(function(tag){tag.setTagLoaded(tag_id);});}
if(options&&options.complete){options.complete();}}});},Remove:function(tag_name,tag_id,options){if(!options||!options.setLoading){Tag.LoadedTabs.each(function(tag){tag.setTagLoading(tag_id);});}
new Ajax.Request("/taggings/delete",{parameters:{"taggable_id":Tag.Taggable.id,"taggable_type":Tag.Taggable.type,"tag_name":tag_name},method:"post",onSuccess:function(request){var removed_tag=request.responseText.evalJSON();Tag.TaggedTags.unset(removed_tag.tag_id);Tag.LoadedTabs.each(function(tag){tag.remove(removed_tag);});if(options&&options.success){options.success();}},onComplete:function(request){Tag.LoadedTabs.each(function(tag){tag.setTagLoaded(tag_id);});}});},CleanEscape:function(s){return s?s.escapeHTML():"";}});Object.extend(Tag.prototype,{initialize:function(options){this.prefix=options.prefix||"t_";this.items_per_page=options.items_per_page||64;this.update_page=options.update_table||false;this.table_ready=false;this.in_pagination=false;this.no_count=options.no_count||false;this.total_count=options.total_count||0;this.tagged_span_html="<div class='tagged-tag'><span id='"+this.prefix+"span_tag_#{tag_id}'>"+"<a href=\"/search/search_tag?query=#{tag_name_encoded}\" >"+"#{tag_name}"+"</a></span>"+"<a class='tagged-tag-close'>[<b>x</b>]</a>"+'<span style="display:none;" class="remove-tag-loading">'+'<img height="16" border="0" width="16" style="vertical-align: middle;" src="'+Base.imageURL('/images/loading-animated-circle.gif')+'" alt="Loading-animated-circle"/>'+'</span>\n'+"</div>\n";this.tagged_tags_container=this.prefix+"tagged_tags_container";},getTagCell:function(tag_id,tag_type_id){var tag_cells=$$("#"+this.prefix+"content_table .tags-content-cell");var cells=tag_cells.findAll(function(e){return(e.readAttribute("tid")==tag_id)&&(!tag_type_id||e.readAttribute("cid")==tag_type_id);});return cells;},setLoading:function(){try{$(this.prefix+"tags_caption").hide();}catch(ex){}
$(this.prefix+'tags_content_loading').show();$(this.prefix+'tags_content_wrapper').hide();},setLoaded:function(){try{if($$("#"+this.prefix+"tags_content .tags-content-cell").length>0){$(this.prefix+"tags_caption").show();}}catch(ex){}
$(this.prefix+'tags_content_loading').hide();$(this.prefix+'tags_content_wrapper').show();},clear:function(){$(this.prefix+'your_tags').childElements().each(function(node){node.hide();});$(this.tagged_tags_container).innerHTML="";this.table_ready=false;this.in_pagination=false;try{$(this.prefix+"no_tags").show();}catch(ex){}},setTagged:function(tagged_taggings,has_tags){var tagged_tags_container=$(this.tagged_tags_container);if(tagged_taggings&&tagged_taggings.keys().length>0){tagged_tags_container.up("div").show();if($(this.prefix+"no_tags"))
$(this.prefix+"no_tags").hide();}
this.showYourTagsLink(has_tags);this.initTable();this.setLoaded();},showYourTagsLink:function(has_tags){if(has_tags){$$(".tagged-link-container").each(function(node){node.show();});}},initTable:function(){if(this.table_ready)return false;Tag.TaggedTags.each(function(pair){this.add(pair.value,true);}.bind(this));this.table_ready=true;var errorNode=$(this.prefix+"tags_error");Tag.HideErrorMsg(errorNode);},setTagLoading:function(tag_id){try{var tag_cells=this.getTagCell(tag_id);tag_cells.each(function(tag_cell){var chk=tag_cell.down(".tags-checkbox");chk.next(".check-box-loading").show();chk.hide();});}catch(ex){}},setTagLoaded:function(tag_id){try{var tag_cells=this.getTagCell(tag_id);tag_cells.each(function(tag_cell){var chk=tag_cell.down(".tags-checkbox");chk.next(".check-box-loading").hide();chk.show();});}catch(ex){}},toggleTagging:function(tagging,checked,updateCount){var tag_cells=this.getTagCell(tagging.tag_id,tagging.tag_type_id);tag_cells.each(function(cell){var check_box=cell.down("input[type=checkbox]");if(check_box){check_box.checked=checked;if(updateCount){this.updateCount(cell,tagging,checked?1:-1);}}}.bind(this));},add:function(tagging,first){if(!tagging.tag_id){return;}
this.toggleTagging(tagging,true,!first);this.showYourTagsLink(true);var span_html=this.tagged_span_html;var element=span_html.interpolate({tag_id:tagging.tag_id,tag_name:Tag.CleanEscape(tagging.tag_name),tag_name_encoded:encodeURIComponent(tagging.tag_name)});$(this.tagged_tags_container).insert(element);$(this.prefix+"span_tag_"+tagging.tag_id).next("a.tagged-tag-close").onclick=function(){Tag.OnRemove(this,tagging.tag_name,tagging.tag_id);}
$(this.tagged_tags_container).up("div").show();if($(this.prefix+"no_tags"))
$(this.prefix+"no_tags").hide();},remove:function(tagging){this.toggleTagging(tagging,false,!this.no_count);var span=$(this.prefix+"span_tag_"+tagging.tag_id);if(span)span.up(".tagged-tag").remove();var tagged_tags_container=$(this.tagged_tags_container);if(tagged_tags_container.childElements().length<1)
tagged_tags_container.up("div").hide();},updateCount:function(cell,tagging,delta){var count_span=cell.down(".tagging-count").down("span");if(count_span){var old_count=parseInt(count_span.innerHTML);var count=old_count+delta;if(count<0)
count=0;count_span.innerHTML=count;if(count==0&&old_count==1){this.total_count-=1;}
if(count==1&&old_count==0){this.total_count+=1;}
cell.down('.info_hover').writeAttribute({mt:"/tags/most_tagged_taggables/"+
tagging.tag_id+"?count="+count+"&name="+encodeURIComponent(tagging.tag_name)+"&taggable_type="+Tag.Taggable.type+"&taggable_id="+Tag.Taggable.id});}}});var TagLocal=Class.create(Tag,{initialize:function(options){this.prefix=options.prefix||"r_";this.items_per_page=options.items_per_page||16;this.update_page=options.update_table||false;this.table_ready=false;this.no_count=options.no_count||false;this.add_tag=function(tag_name,tag_id){this.add({tag_name:tag_name,tag_id:tag_id});}.bind(this);this.remove_tag=function(tag_name,tag_id){this.remove({tag_name:tag_name,tag_id:tag_id});}.bind(this);this.tagged_span_html="<div class='tagged-tag'><span id='"+this.prefix+"span_tag_#{tag_id}'>"+"#{tag_name_cleaned}"+"</span>"+"<a class='tagged-tag-close' href='javascript:void(0);'>"+"[x]"+"</a>\n"+"<input type='hidden' value='' name='taggings[tag_names][]' />"+"</div>\n";this.tagged_tags_container=this.prefix+"tagged_tags_container";},Track:function(inserted,deleted){TagTracking.track_add('review',Tag.Taggable,'review',inserted);TagTracking.track("remove","review",Tag.Taggable,[["loc","checkbox"],["tags",deleted.join(',')]]);},OnClick:function(node,tag_name,tag_id){if(node.checked){this.add({tag_name:tag_name,tag_id:tag_id});}else{this.remove({tag_name:tag_name,tag_id:tag_id});}},showYourTagsLink:function(){},setTagLoading:function(){},setTagLoaded:function(){},new_tag_id:0,clear:function(){$(this.tagged_tags_container).innerHTML="";this.table_ready=false;this.setLoaded();try{$(this.prefix+"no_tags").show();}catch(ex){}},addSubmit:function(){var tag_name=$(this.prefix+"tagging_tag_name");var error_node=$(this.prefix+"tags_error");var value=tag_name.value;if(Tag.LocalValidation(value,error_node,tag_name)){if(!this.add({"tag_name":tag_name.value})){tag_name.value='';}}},add:function(tagging,options){var tag_id=tagging.tag_id,tag_name=tagging.tag_name;if('string'==(typeof tag_id)||'number'==(typeof tag_id)){tagging['tag_name']=tag_name.strip();tagging['tag_id']=tag_id;if(tagging.tag_name.length<1||tagging.tag_name.length>50)
return false;if(tag_id==0){tagging['tag_id']=this.newTag({tag_name:tagging.tag_name});}else{tagging['tag_id']=this.newTag(tagging)}
if(!tagging.tag_id)return false;var tagged_tag=this.findTagged(tagging.tag_name);if(tagged_tag){if(tagging.tag_id[0]!='n'&&tagged_tag.down("span").id.split("_")[3]!=tagging.tag_id){tagged_tag.down("span").id=this.prefix+"span_tag_"+tagging.tag_id;}
return false;}
var span_html=this.tagged_span_html;var element=span_html.interpolate({tag_id:tagging.tag_id,tag_name_cleaned:Tag.CleanEscape(tagging.tag_name)});$(this.tagged_tags_container).insert(element);var span=$(this.prefix+"span_tag_"+tagging.tag_id);try{span.next('a').onclick=function(){this.remove_tag(tagging.tag_name,tagging.tag_id);}.bind(this);span.next('input').value=tagging.tag_name;}catch(ex){}
this.toggleTagging(tagging,true);$(this.prefix+"your_tags").childElements()[0].show();}else{var _taggings=tag_name.split(",");var taggings=[];_taggings.each(function(tagging){tagging=tagging.strip();if(!tagging.blank()&&!tagging.include('"')){taggings.push(tagging.toLowerCase());}});if(taggings.length>30){return false;}
taggings=taggings.uniq();taggings.each(function(tagging){this.add({tag_name:tagging,tag_id:0});}.bind(this));}},findTagged:function(tag_name){try{var tagged_tags=$(this.tagged_tags_container).childElements();for(var i=0;i<tagged_tags.length;i++){if(tagged_tags[i].down("input").value==tag_name)return tagged_tags[i];}
return false;}catch(ex){return false;}},newTag:function(tagging){try{var tag_name=tagging.tag_name;var prefix=this.prefix;var tag_node=$$("#"+this.prefix+"content_table .tags-content-cell").find(function(node){var n=node.down("input");if(n.value==tag_name){if(parseInt(tagging.tag_id)&&parseInt(tagging.tag_id)!=parseInt(node.readAttribute('tid'))){node.writeAttribute("tid",tagging.tag_id);}
return true;}});if(tag_node){return tag_node.readAttribute("tid");}else if(parseInt(tagging.tag_id)){return tagging.tag_id;}}catch(ex){}
this.new_tag_id+=1;return"n"+this.new_tag_id;}});var SuggestSelector=Class.create({initialize:function(searchElement,suggestElement,tagSuggest){this.searchElement=searchElement;this.suggestElement=suggestElement;this.tagSuggest=tagSuggest;this.visible=false;this.selected=-1;this.count=0;this.not_show=false;this.items=[];this.ori_value="";this.max_list=10;},initHover:function(){var $this=this;this.suggestElement.childElements().each(function(el,idx){el.observe("mouseover",function(ev){var highlighted=$$(".tags-suggestion-container li.highlight");if(highlighted.length>0)
highlighted[0].removeClassName("highlight");el.addClassName("highlight");$this.selected=idx;});el.observe("mouseout",function(ev){el.removeClassName("highlight");$this.selected=-1;});el.observe("mousedown",function(ev){$this.set();setTimeout(function(){$this.searchElement.focus();},100);setTimeout(function(){$this.not_show=false;},500);});});},show:function(items){if(items&&items.length>0){this.items=items;var list="";var max_list=this.max_list;items.each(function(item,idx){if(idx>=max_list)throw $break;list+="<li>"+Tag.CleanEscape(item[0]).truncate(35)+"</li>";});this.suggestElement.update(list);var position=this.searchElement.positionedOffset();var lp=position[0];var tp=position[1]+this.searchElement.getHeight();this.suggestElement.setStyle({"top":tp+"px","left":lp+"px"});this.count=(items.length<max_list?items.length:max_list);this.initHover();this.selected=-1;this.suggestElement.show();this.visible=true;this.ori_value=this.searchElement.value;}
else{this.hide();}},hide:function(){this.selected=-1;this.suggestElement.hide();this.visible=false;},highlight:function(i){var highlighted=$$(".tags-suggestion-container li.highlight");if(highlighted.length>0)
highlighted[0].removeClassName("highlight");if(i<-1)
i=this.count-1;if(i>=this.count)
i=-1;if(i>=0&&i<this.count){this.suggestElement.childElements()[i].addClassName("highlight");var value=this.getValue(i);if(this.searchElement.value!=value){this.not_show=true;this.searchElement.value=value;}}else{if(this.searchElement.value!=this.ori_value){this.not_show=true;this.searchElement.value=this.ori_value;}}
this.selected=i;return i;},getValue:function(i){var value=this.items[i][0];return value.strip();},set:function(i){i=i||this.selected;if(i>=0&&i<this.count){this.searchElement.value=this.getValue(i);this.not_show=true;}
this.hide();this.tagSuggest.selected=this.items[i];}});var TagSuggest=Class.create({initialize:function(searchElement,suggestElement,errorElement,tooltipElement,minChars,options){this.searchElement=searchElement;minChars=(minChars||2);var suggestSelector=new SuggestSelector(searchElement,suggestElement,this);this.minChars=minChars;this.suggestSelector=suggestSelector;this.selected=null;var $this=this;TagSuggest.hide_error=true;var getKey=function(value){return[value,value.substr(0,2)];}
var update=function(){var value=$this.searchElement.value;var values=getKey(value);var key=values[1];value=values[0];var items=[];if(SuggestItems[key]){items=SuggestItems[key].findAll(function(item){return(item[0].indexOf(value)==0);});}
suggestSelector.show(items);}
if(tooltipElement){searchElement.observe('focus',function(){if(errorElement)errorElement.hide();if(!tooltipElement.hasClassName("prompt-pos-fixed")){var position=searchElement.positionedOffset();position[0]+=searchElement.getWidth()+80;position[1]+=2;tooltipElement.setStyle({left:position[0]+"px",top:position[1]+"px"});}
tooltipElement.show();});searchElement.observe('blur',function(){tooltipElement.hide();});}
new Form.Element.Observer(searchElement,0.1,function(element,value){if(tooltipElement)tooltipElement.hide();if(suggestSelector.not_show||!TagSuggest.hide_error){suggestSelector.not_show=false;TagSuggest.hide_error=true;return;}
$this.selected=null;var values=getKey(value);var key=values[1]
if(errorElement&&!value.blank()){errorElement.hide();}
if(key.length<2||key.include(",")){suggestSelector.hide();}
else{if(!SuggestItems[key]){SuggestItems[key]=[];new Ajax.Request('/tags/suggest/'+encodeURIComponent(key),{method:'get',evalJSON:"force",onSuccess:function(resp){SuggestItems[key]=resp.responseJSON;update();},onFailure:function(){SuggestItems[key]=null;}});}
else{update();}}});searchElement.observe("keydown",function(ev){if(suggestSelector.visible){switch(ev.keyCode){case 38:var new_id=suggestSelector.selected-1;suggestSelector.highlight(new_id);ev.returnValue=false;break;case 40:var new_id=suggestSelector.selected+1;suggestSelector.highlight(new_id);ev.returnValue=false;break;case 13:if(suggestSelector.selected>=0){suggestSelector.set();}
break;}}
if(ev.keyCode==13){if(options&&options.enterCallback){return options.enterCallback(ev);}}});searchElement.observe("keyup",function(ev){switch(ev.keyCode){case 13:ev.returnValue=false;return false;break;}});searchElement.observe("blur",function(ev){suggestSelector.hide();});}});function toggle_tags_learn_more(el,scroll){el.addClassName("tags-learn-more");FloatingDiv.show(el,$('tags_learn_more'),700);if(scroll){try{$('tags-not-use').scrollIntoView();}catch(ex){}}
return false;}
var TagTracking=Class.create();Object.extend(TagTracking,{category:"tag",track:function(action,loc,taggable,opts){try{if(!_gaq)return;}catch(ex){return}
opts=opts||[];opts=[["type",taggable.type],["id",taggable.id]].concat(opts);if(opts){opts.each(function(opt,idx){_gaq.push(['_setCustomVar',idx+1,opt[0],opt[1],opt[2]||3]);});}
_gaq.push(['_trackEvent',TagTracking.category,action,loc]);if(opts){opts.each(function(opt,idx){_gaq.push(['_deleteCustomVar',idx+1]);});}},track_add:function(loc,taggable,add_type,tags){$A(tags).each(function(tag){TagTracking.track("add",loc,taggable,[["loc",add_type],["tag",tag]]);});},track_add_fail:function(action,loc,taggable,tags){$A(tags).each(function(tag){TagTracking.track("add_fail",loc,taggable,[["loc",add_type],["tag",tag]]);});}});
var MyTags=Class.create();Object.extend(MyTags,{auto_scroll:function(el,height){if(el.getHeight()>height-10){el.setStyle({height:height+"px"});}
if(el.scrollHeight-el.getHeight()>2){el.removeClassName("no-bottom-border");}else{el.setStyle({height:"auto"});el.addClassName("no-bottom-border");}},sort_by_name:function(el1,el2){var v1=el1.getAttribute('vl'),v2=el2.getAttribute('vl');return v1<v2?-1:(v1>v2?1:0);},sort_by_most_used:function(el1,el2){return parseInt(el2.getAttribute('cnt'))-parseInt(el1.getAttribute('cnt'));}});Object.extend(MyTags,{Sorted:'alpha',ContainerId:"my_tags",FilteredIds:[],UpdateSearchTag:function(val,node,opts){var container=$(MyTags.ContainerId);var els=container.childElements();var matched_count=0;val=val.strip().toLowerCase();try{container.down(".matched").removeClassName("matched");}catch(ex){}
els.each(function(li){if(li.readAttribute('vl').indexOf(val)==0){li.removeClassName("mismatched")
matched_count++;if(matched_count==1)
li.addClassName("matched");}else{li.addClassName("mismatched");}});if(opts){if(matched_count<=0){if(opts.no_match)opts.no_match();}
else{if(opts.match)opts.match();}}
MyTags.UpdateContainerStyle();},Select:function(id){if("string"==typeof(id)||"number"==typeof(id))MyTags.FilteredIds.push(parseInt(id))
else MyTags.FilteredIds=MyTags.FilteredIds.concat(id);MyTags.FilteredIds=MyTags.FilteredIds.uniq();MyTags.UpdateFiltered();},UnSelect:function(id){MyTags.FilteredIds=MyTags.FilteredIds.without(id);MyTags.UpdateFiltered();},ClearAll:function(){MyTags.FilteredIds=[];MyTags.UpdateFiltered();},UpdateFiltered:function(){var params=[];MyTags.FilteredIds.each(function(tag){params.push("tag_ids[]="+tag);});$('profile_tag_loading').show();new Ajax.Updater({success:'profile_tag_container'},"/profile/update_tags_filter",{evalScripts:true,method:"post",parameters:"sort="+MyTags.Sorted+"&"+params.join("&")});},UpdateContainerStyle:function(){MyTags.auto_scroll($(MyTags.ContainerId),500);},Clear:function(el){var container=$(MyTags.ContainerId);try{container.down(".matched").removeClassName("matched");}catch(ex){}
$$("li.mismatched").each(function(li){li.className="";});},Sort:function(sort,node){if(this.Sorted==sort)return;$$(".sorted-by").each(function(el){el.removeClassName("sorted-by");});node.addClassName("sorted-by");this.Sorted=sort;var els;var container=$(MyTags.ContainerId);if(this.Sorted=='alpha'){els=container.childElements().sort(MyTags.sort_by_name);}else{els=container.childElements().sort(MyTags.sort_by_most_used);}
els.each(function(el){container.insert({"bottom":el});});},Init:function(search_ele,form_id,loading_id,no_match_id){MyTags.UpdateContainerStyle();var loading=$(loading_id);var pos=$(form_id).positionedOffset();pos[0]+=$(form_id).getWidth()-20;if(Prototype.Browser.IE)pos[0]-=5;pos[1]-=16;if(Prototype.Browser.IE)pos[1]-=5;loading.setStyle({top:pos[1]+"px",left:pos[0]+"px",position:"absolute"});new Form.Element.Observer(search_ele,0.1,function(el,value){$(loading_id).show();setTimeout(function(){if(value&&value.length>0){MyTags.UpdateSearchTag(value,el,{no_match:function(){$(no_match_id).show();},match:function(){$(no_match_id).hide();}});}else{$(no_match_id).hide();MyTags.Clear(el);}
$(loading_id).hide();},10);});var container=$(MyTags.ContainerId);$(form_id).onsubmit=function(){var tag=$(MyTags.ContainerId).down(".matched");if(tag)tag.onclick();return false;}
$(search_ele).focus();}});
var Observer=Class.create();Object.extend(Observer.prototype,{initialize:function(observerFunction){this.objectToObserve=null;this.observerFunction=observerFunction;},observe:function(domElement,trackingTask,event){if(this.observerFunction){this.observerFunction(domElement,trackingTask,event);}}});var TrackingSystem=Class.create();Object.extend(TrackingSystem,{trackingSystemHash:{},searchTrackingSystem:function(name){return TrackingSystem.trackingSystemHash[name];},initializeTrackingSystem:function(code_block){Event.observe(window,'load',code_block);}});Object.extend(TrackingSystem.prototype,{initialize:function(name,callbackFunctions,withinSearchPage,source){this.name=name;this.allLists=new Array();if(source){this.source=source;}else{this.source="serp";}
this.systemLevelData={version:0,source:this.source};if(withinSearchPage){this.withinSearchPage=withinSearchPage;}else{this.withinSearchPage=true;}
if(callbackFunctions){this.callbackFunctions=callbackFunctions;}else{this.callbackFunctions={};}
if(this.callbackFunctions.afterInitialize){this.callbackFunctions.afterInitialize(this);}
TrackingSystem.trackingSystemHash[this.name]=this;},register:function(trackingTask){this.allLists.push(trackingTask);this.upgradeNofitication();},upgradeNofitication:function(){this.systemLevelData.version+=1;}});var TrackingTask=Class.create();Object.extend(TrackingTask,{iterate:function(element,methodToInvoke){element=$(element);if(element){methodToInvoke(element);element.descendants().each(methodToInvoke);}},searchRepository:function(element){if(element.readAttribute){if(element.readAttribute('tracking_repository')){return element.readAttribute('tracking_repository');}else{return TrackingTask.searchRepository(element.up());}}else{return"{}";}}});Object.extend(TrackingTask.prototype,{initialize:function(rootDomElement,ruleArray,activateAction,observerArray,trackingSystem,callbackFunctions,taskLevelData,commonData){this.taskLevelData={}
this.rootDomElement=$(rootDomElement);this.ruleArray=$A(ruleArray);this.activateAction=activateAction;this.observerArray=$A(observerArray);for(var i=0;i<this.observerArray.size();i++){this.observerArray[i].objectToObserve=this;}
if(trackingSystem.register){this.trackingSystem=trackingSystem;}else{this.trackingSystem=TrackingSystem.searchTrackingSystem(trackingSystem);}
if(taskLevelData){this.setTaskLevelData(taskLevelData);}
if(commonData){this.setCommonData(commonData);}
this.trackingSystem.register(this);this.eventHandlerArray=new Array();this.currentDomElement=null;this.registerTrackingAspect();if(callbackFunctions){this.callbackFunctions=callbackFunctions;}else{this.callbackFunctions={};}
if(this.callbackFunctions.afterInitialize){this.callbackFunctions.afterInitialize(this);}},registerTrackingAspect:function(){$A(this.ruleArray).each(function(rules){$A(rules).map($$).flatten().each(function(element){var handler=function(event){var element=Event.findElement(event);this.currentDomElement=element;if(this.callbackFunctions.beforeNotifyObserver){this.callbackFunctions.beforeNotifyObserver(this);}
for(var j=0;j<this.observerArray.size();j++){this.observerArray[j].observe(element,this,event);}
if(this.callbackFunctions.afterNotifyObserver){this.callbackFunctions.afterNotifyObserver(this);}
event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();}.bind(this);var event=Event.observe(element,this.activateAction,handler);this.eventHandlerArray.push([element,event,handler]);}.bind(this));}.bind(this));},unRegisterTrackingAspect:function(){for(var i=0;i<this.eventHandlerArray.size();i++){var handler=this.eventHandlerArray[i];Event.stopObserving(handler[0],handler[1],handler[2]);}},addObserver:function(observer){observer.objectToObserve=this;this.observerArray.push(observer);},getCurrentEventData:function(){var currentEventData=TrackingTask.searchRepository(this.currentDomElement).evalJSON();var commonData=this.getCommonData();if(commonData){for(var key in commonData){currentEventData[key]=commonData[key];}}
return currentEventData;},getTaskLevelData:function(){return this.taskLevelData;},setTaskLevelData:function(data){if(typeof(data)=="string"){data=data.evalJSON();}
this.taskLevelData=data;},getCommonData:function(){return this.commonData;},setCommonData:function(data){if(typeof(data)=="string"){data=data.evalJSON();}
this.commonData=data;},getSystemLevelData:function(systemLevelData){return this.trackingSystem.systemLevelData;},setRuleArray:function(ruleArray){this.unRegisterTrackingAspect();this.ruleArray=$A(ruleArray);this.registerTrackingAspect();}});var TrackingUtility=Class.create();Object.extend(TrackingUtility,{token:function(){return"|||";},S4:function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);},guid:function(){return(this.S4()+this.S4()
+"-"+this.S4()
+"-"+this.S4()
+"-"+this.S4()
+"-"+(Beacon.computerGUID()||"").substr(parseInt(Math.random()*16),12)).toUpperCase();},getCookie:function(name){var value=null;if(typeof(document.cookie)!='undefined'){$A(document.cookie.split(';')).each(function(v){var kv=v.split('=');if(name.toLowerCase()==kv[0].toLowerCase().strip()){value=kv[1].strip();throw $break;}});}
return value;},appendCookie:function(name,value,minutes){TrackingUtility.setCookie(name,value,minutes);},setCookie:function(name,value,minutes){if(typeof(document.cookie)=='undefined')return;var expires=new Date();if(minutes){if(minutes>0){expires.setTime(expires.getTime()+(minutes*60*1000));}else{expires=null;}}else{expires.setTime(expires.getTime()+(5*60*1000));}
var encode=encodeURIComponent||escape;value=encode(name)+'='+encode(value);if(expires){value+='; expires='+expires.toUTCString();}
value+='; path=/';document.cookie=value;},eraseCookie:function(name){Behaviors.setCookie(name,"",-1);},pingImage:function(url){pingImage(url);},getUserId:function(){return Behaviors.getUserId();},prepareSystemLevelData:function(source){var systemLevelData={time:(new Date()).toUTCString(),session_id:TrackingUtility.guid(),user_id:TrackingUtility.getUserId(),machine_id:Beacon.computerGUID(),source:source};return systemLevelData;},prepareBeaconData:function(dataHash){if(typeof dataHash.get('data')!='undefined'){var data=$H(dataHash.get('data'));var queryContextHash=$H(data.get('query_context'));var videoHash=$H(data.get('video'));dataHash.unset('data');dataHash=dataHash.merge(queryContextHash);dataHash=dataHash.merge(videoHash);}
if(typeof dataHash.get('id')!='undefined'){dataHash.set('contentid',dataHash.get('id'));}
dataHash.unset('machine_id');dataHash.unset('user_id');dataHash.unset('time');dataHash.unset('id');dataHash.each(function(pair){if(pair.value==null){dataHash.set(pair.key,"");}});return dataHash;}});var DYMTrackingTask=Class.create();Object.extend(DYMTrackingTask.prototype,{initialize:function(trackingSystem,callbackFunctions,orgQuery,newQuery,st){var data={orgQuery:orgQuery,newQuery:newQuery,st:st,type:"display"};this.taskLevelData=$H(data);if(trackingSystem.register){this.trackingSystem=trackingSystem;}else{this.trackingSystem=TrackingSystem.searchTrackingSystem(trackingSystem);}
if(callbackFunctions){this.callbackFunctions=callbackFunctions;}else{this.callbackFunctions={};}
if(this.callbackFunctions.afterInitialize){this.callbackFunctions.afterInitialize(this);}
DYMTrackingTask.sid=this.getSystemLevelData().session_id;DYMTrackingTask.version=this.getSystemLevelData().version;DYMTrackingTask.st=st;DYMTrackingTask.source=this.getSystemLevelData().source;DYMTrackingTask.orgQuery=orgQuery;DYMTrackingTask.newQuery=newQuery;this.addObserver();},getSystemLevelData:function(systemLevelData){return this.trackingSystem.systemLevelData;},getTaskLevelData:function(){return this.taskLevelData;},addObserver:function(){var dymHandler=function(event){var element=Event.findElement(event);if(element.readAttribute('style')){element=element.up();}
content=element.innerHTML;content=content.replace(/<span style="font-style: italic; font-weight: bold;">/g,"");content=content.replace(/<\/span>/g,"");var cookieContent={sid:DYMTrackingTask.sid,version:DYMTrackingTask.version,st:DYMTrackingTask.st,source:DYMTrackingTask.source,orgQuery:DYMTrackingTask.orgQuery,newQuery:DYMTrackingTask.newQuery,curQuery:content,type:"click"};TrackingUtility.appendCookie('_serp_',$H(cookieContent).toJSON(),5);};ruleArray=$A(['#didyoumean a','#didyoumean_bottom a']);for(var i=0;i<ruleArray.size();i++){$A($$(ruleArray[i])).each(function(ele){Event.observe(ele,'click',dymHandler);});}}});var SERPTracking=Class.create();Object.extend(SERPTracking,{SERPHotTopicRule:$A(['#search_result #embed_hot_topic_list a','#hot-topic-search-result a.news-link','#hot-topic-search-result #embed_hot_topics_bottom a','#hot_topics_video div.home-thumb a']),SERPRelatedRule:$A(['#search_result #didyoumean a','#search_result #didyoumean_bottom a']),SERPPromoteRule:$A(['#promote_list .callout-playlist-container .offsite-link-container','#promote_list div.show-title-container a.info_hover','#promote_list div.home-play-container a.observing','#promote_list div.home-play-container a.play','#promote_list .page-new .a-b-c div.gr.b li']),SERPVideoRule:$A(['#search_result span a.play','#search_result span a.observing','#search_result div.show-title-container a.show-title-gray','#search_result div.callout-playlist-container a.offsite-link-container','#search_result span.video-info a','#search_result span.add-me a','#search_result .search_bar_content a','#search_result .search_bar_content span a']),SERPTagRule:$A(['#search_result div a.play','#search_result div.home-play-container a.observing','#search_result h3 div a.observing','#search_result div.show-title-container a.show-title-gray']),SERPTrailerRule:$A(['table.trailers span a.play','table.trailers a.observing']),SERPFacebookRule:$A(['#results_list div.home-thumb div.home-play-container span.play-button-hover a.observing','#results_list div.home-thumb div.show-title-container a.observing']),SERPSupportRule:$A(['#support_search_list div.support-search-results-list a.support-search-result-item-title']),SERPSupportSuggestRule:$A(['#support-search-suggest ul li']),SupportCategoryNavigationRule:$A(['tr td div.section-header a','tr td div.support-link-container a']),SERPTrackingSystemCallBackFunctions:{afterInitialize:function(trackingSystem){trackingSystem.systemLevelData.session_id=TrackingUtility.guid();trackingSystem.systemLevelData.user_id=TrackingUtility.getUserId();trackingSystem.systemLevelData.machine_id=Beacon.computerGUID();if(TrackingUtility.getCookie("_serp_")){var cookieContent=unescape(TrackingUtility.getCookie("_serp_"));var cookies=$A(cookieContent.split(TrackingUtility.token()));for(var i=0;i<cookies.size();i++){var myCookie=cookies[i].evalJSON();if(myCookie){if(trackingSystem.withinSearchPage){trackingSystem.systemLevelData.fromSessionId=myCookie.sid;};var finalData=new Hash();finalData=finalData.merge($H(myCookie));SERPTracking.SERPSendTrackInfo(finalData);}}
TrackingUtility.eraseCookie("_serp_");}}},SERPTrackingTaskCallBackFunctions:{afterInitialize:function(trackingTask){var finalData=new Hash();finalData=finalData.merge($H({time:(new Date()).toUTCString()}));finalData=finalData.merge($H(trackingTask.getSystemLevelData()));finalData=finalData.merge($H(trackingTask.getTaskLevelData()));SERPTracking.SERPSendTrackInfo(finalData);},beforeNotifyObserver:null,afterNotifyObserver:null},SERPObserverFunction:function(domElement,trackingTask){if(domElement.up().tagName=="SPAN"&&domElement.up().hasClassName("add-me")&&domElement.tagType=="A"){if(Behaviors.isLoggedIn()){return;}}
var importantTrackInfo;if(trackingTask.getSystemLevelData().source!="facebook"){importantTrackInfo={sid:trackingTask.getSystemLevelData().session_id,version:trackingTask.getSystemLevelData().version,data:trackingTask.getCurrentEventData(),time:(new Date()).toUTCString(),st:trackingTask.getTaskLevelData().st,source:trackingTask.getSystemLevelData().source};}else{importantTrackInfo={session_id:trackingTask.getSystemLevelData().session_id,time:(new Date()).toUTCString(),user_id:trackingTask.getSystemLevelData().user_id,version:trackingTask.getSystemLevelData().version,data:trackingTask.getCurrentEventData(),format:"on_click_serp",source:trackingTask.getSystemLevelData().source};}
if(trackingTask.getCurrentEventData().isOffsite==true){SERPTracking.SERPSendTrackInfo(importantTrackInfo);}else if(trackingTask.getCurrentEventData().isAjax==true){SERPTracking.SERPSendTrackInfo(importantTrackInfo);}else{var cookieContent=importantTrackInfo;if(domElement.up().tagName=="SPAN"&&domElement.up().hasClassName("video-info")){if(domElement.hasClassName("observing")){cookieContent.track_type="show";}else{cookieContent.track_type="channel";}}
if(domElement.up().hasClassName("search_bar_content")){cookieContent.track_type="related";}
if(domElement.up().up().hasClassName("search_bar_content")){cookieContent.track_type="didyoumean";}
TrackingUtility.appendCookie('_serp_',$H(cookieContent).toJSON(),5);}},SERPSendTrackInfo:function(data){var dataHash=$H(data);var source=dataHash.get("source");if(source=="facebook"){var beaconDataHash=TrackingUtility.prepareBeaconData(dataHash);Beacon.trackSearch(beaconDataHash.toObject());}else if(source=="support"){}else if(source=="serp_new"){TrackingUtility.pingImage("http://208.91.157.113/searchtracking/oldautocomplete?"+"data="+escape(dataHash.toJSON())+"&source="+source);}else{TrackingUtility.pingImage(Beacon.getStandardHost()+"/v3/searchtrack/searchitem?"+"data="+escape(dataHash.toJSON())+"&source="+source);}}});
var ContinuousPlay=Class.create();Object.extend(ContinuousPlay,{PLAY_MODE_QUEUE:0,PLAY_MODE_COLLECTION:1,PLAY_MODE_QUEUED_SHOW:2,PLAY_MODE_RECOMMENDATION:4,PLAY_MODE_TRAILS_ONLY:10,PLAY_MODE_PLAYLIST:9999,THUMBNAIL_VIEW_HEIGHT_EXPANDED:172,THUMBNAIL_VIEW_HEIGHT_COLLAPSED:44,IS_TRAILER:false,lcid:null,collection:null,loggedIn:function(){if($('player')&&$('player').userLogin)
$('player').userLogin(Behaviors.getUserId());},loggedOut:function(){if($('player')&&$('player').userLogin)
$('player').userLogin(-1);},getLcid:function(){if(!ContinuousPlay.lcid)
ContinuousPlay.lcid='continuous_play_'+(new Date()).getTime();return ContinuousPlay.lcid;},toggleDropdown:function(expanded){if(expanded){setTimeout("ContinuousPlay.startObserveBodyClick();",100);$('continuousplay-swf-container').style.zIndex=100;}
else{ContinuousPlay.toggleDropdownCollapse();}},startObserveBodyClick:function(){document.body.observe('click',ContinuousPlay.toggleDropdownCollapse);},toggleDropdownCollapse:function(){document.body.stopObserving('click',ContinuousPlay.toggleDropdownCollapse);$('continuousplay-swf-container').style.zIndex=0;setTimeout("$('player').userActOutside();",50);},toggleThumbnailView:function(expanded){height=expanded?ContinuousPlay.THUMBNAIL_VIEW_HEIGHT_EXPANDED:ContinuousPlay.THUMBNAIL_VIEW_HEIGHT_COLLAPSED;$('continuousplay-container').style.height=height+'px';},expandThumbnailView:function(){$('player').expandThumbnailView();},collapseThumbnailView:function(){$('player').collapseThumbnailView();},isInPlaylist:function(){if(/play-queued-show/.test(window.location.hash)||(/continuous_play_mode=2/).test(window.location.search))
return true;if((/in-playlist/.test(window.location.hash))||(/play-queue/.test(window.location.hash)))
return true;return false;},hasInitOnOffSetting:function(){if(/continuous_play=on/.test(window.location)||/continuous_play=off/.test(window.location)||/\/playlist\//.test(window.location))
return true;else
return false;},getManualActivation:function(){if(/continuous_play=on/.test(window.location)||/\/playlist\//.test(window.location))
return true;else
return false;},getSort:function(){sort='';if((/by-([a-zA-z\-]+)/).test(window.location.hash))
sort=RegExp.$1;else if((/continuous_play_sort=([a-zA-z\-]+)/).test(window.location.search))
sort=RegExp.$1;return sort;},getModes:function(){play_modes=new Array();if(Behaviors.isLoggedIn())
play_modes.push(ContinuousPlay.PLAY_MODE_QUEUE);if(/play-queued-show/.test(window.location.hash)||(/continuous_play_mode=2/).test(window.location.search))
play_modes.push(ContinuousPlay.PLAY_MODE_QUEUED_SHOW);if(ContinuousPlay.IS_TRAILER)
play_modes.push(ContinuousPlay.PLAY_MODE_TRAILS_ONLY);if(/\/playlist\//.test(window.location)||(/continuous_play_mode=9999/).test(window.location.search))
play_modes.push(ContinuousPlay.PLAY_MODE_PLAYLIST);play_modes.push(ContinuousPlay.PLAY_MODE_RECOMMENDATION);return play_modes.join(',');},getInitMode:function(){if(/continuous_play_mode=([0-9]+)/.test(window.location))
return parseInt(RegExp.$1);if(/play-queued-show/.test(window.location.hash)||(/continuous_play_mode=2/).test(window.location.search))
return ContinuousPlay.PLAY_MODE_QUEUED_SHOW;if((/in-playlist/.test(window.location.hash))||(/play-queue/.test(window.location.hash)))
return ContinuousPlay.PLAY_MODE_QUEUE;if(/\/playlist\//.test(window.location)||(/continuous_play_mode=9999/).test(window.location.search))
return ContinuousPlay.PLAY_MODE_PLAYLIST;if(/play-all/.test(window.location.hash))
return ContinuousPlay.PLAY_MODE_RECOMMENDATION;if(/play-trailers-only/.test(window.location.hash))
return ContinuousPlay.PLAY_MODE_TRAILS_ONLY;return ContinuousPlay.PLAY_MODE_RECOMMENDATION;},getCollectionId:function(){return ContinuousPlay.collection.id;},getCollectionName:function(){return ContinuousPlay.collection.name;},getCollectionPlayingIndex:function(){return ContinuousPlay.collection.playingIndex;},getCollectionItems:function(){return ContinuousPlay.collection.items;},playCollectionItem:function(index){playLocation=ContinuousPlay.collection.items[index-1].location;window.location.href=playLocation;},getPlaylistId:function(){return ContinuousPlay.playlist.id;},getPlaylistName:function(){return ContinuousPlay.playlist.name;},getPlaylistPlayingIndex:function(){return ContinuousPlay.playlist.playingIndex;},getPlaylistItems:function(){return ContinuousPlay.playlist.items;},playPlaylistItem:function(index){playLocation=ContinuousPlay.playlist.items[index-1].location;window.location.href=playLocation;}});
if(typeof renderTwitters!='function')(function(){var browser=(function(){var b=navigator.userAgent.toLowerCase();return{webkit:/(webkit|khtml)/.test(b),opera:/opera/.test(b),msie:/msie/.test(b)&&!(/opera/).test(b),mozilla:/mozilla/.test(b)&&!(/(compatible|webkit)/).test(b)};})();var guid=0;var readyList=[];var isReady=false;var monthDict=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];window.ify=function(){var entities={'"':'&quot;','&':'&amp;','<':'&lt;','>':'&gt;'};return{"link":function(t){return t.replace(/[a-z]+:\/\/[a-z0-9-_]+\.[a-z0-9-_:~%&\?\/.=]+[^:\.,\)\s*$]/ig,function(m){return'<a href="'+m+'">'+((m.length>25)?m.substr(0,24)+'...':m)+'</a>';});},"at":function(t){return t.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(m,m1,m2){return m1+'<a class="twitter-anywhere-user" href="http://twitter.com/'+m2+'">@'+m2+'</a>';});},"hash":function(t){return t.replace(/(^|[^\w'"]+)\#([a-zA-Z0-9_]+)/g,function(m,m1,m2){return m1+'#<a href="http://search.twitter.com/search?q=%23'+m2+'">'+m2+'</a>';});},"clean":function(tweet){return this.hash(this.at(this.link(tweet)));}};}();window.renderTwitters=function(obj,options){function node(e){return document.createElement(e);}
function text(t){return document.createTextNode(t);}
var target=$(options.twitterTarget);var data=null;if(options.useSearchAPI)
obj=obj.results;var ul=node('ul'),li,statusSpan,timeSpan,i,max=obj.length;var approved=0;for(i=0;i<max&&approved<options.count&&obj[i];i++){data=getTwitterData(obj[i]);if(options.ignoreReplies&&obj[i].text.substr(0,1)=='@'){max++;continue;}
if(obj[i].text.match(/[\s]fuck|shit|cunt|dick|whore|bitch|nigger|sex[\s]/i)){continue;}else{approved++;}
li=node('li');if(options.template){li.innerHTML=options.template.replace(/%([a-z_\-\.]*)%/ig,function(m,l){var r=data[l]+""||"";if(l=='text'&&options.enableLinks)r=ify.clean(r);if(l=='from_user'&&options.useSearchAPI)r='<a class="twitter-anywhere-user '+l+'" href="http://twitter.com/'+r+'">'+r+'</a>';return r;});}else{statusSpan=node('span');statusSpan.className='twitterStatus';timeSpan=node('span');timeSpan.className='twitterTime';statusSpan.innerHTML=obj[i].text;if(options.enableLinks==true){statusSpan.innerHTML=ify.clean(statusSpan.innerHTML);}
timeSpan.innerHTML=relative_time(obj[i].created_at);if(options.prefix){var s=node('span');s.className='twitterPrefix';s.innerHTML=options.prefix.replace(/%(.*?)%/g,function(m,l){return obj[i].user[l];});li.appendChild(s);li.appendChild(text(' '));}
li.appendChild(statusSpan);li.appendChild(text(' '));li.appendChild(timeSpan);}
if(options.newwindow){li.innerHTML=li.innerHTML.replace(/<a href/gi,'<a target="_blank" href');}
ul.appendChild(li);}
if(options.clearContents){while(target.firstChild){target.removeChild(target.firstChild);}}
target.appendChild(ul);if(typeof options.callback=='function'){options.callback();}};window.getTwitters=function(target,id,count,options){guid++;if(typeof id=='object'){options=id;id=options.id;count=options.count;}
if(!count)count=1;if(options){options.count=count;}else{options={};}
if(!options.timeout&&typeof options.onTimeout=='function'){options.timeout=10;}
if(typeof options.clearContents=='undefined'){options.clearContents=true;}
if(options.withFriends)options.withFriends=false;options['twitterTarget']=target;if(typeof options.enableLinks=='undefined')options.enableLinks=true;window['twitterCallback'+guid]=function(obj){if(options.timeout){clearTimeout(window['twitterTimeout'+guid]);}
renderTwitters(obj,options);};ready((function(options,guid){return function(){if(!$(options.twitterTarget))return;if(options.useSearchAPI)
var url='http://search.twitter.com/search.json?callback=twitterCallback'+guid+'&q='+id+'&count=20&cb='+Math.random();else
var url='http://www.twitter.com/statuses/'+(options.withFriends?'friends_timeline':'user_timeline')+'/'+id+'.json?callback=twitterCallback'+guid+'&count=20&cb='+Math.random();if(options.timeout){window['twitterTimeout'+guid]=setTimeout(function(){if(options.onTimeoutCancel)window['twitterCallback'+guid]=function(){};options.onTimeout.call($(options.twitterTarget));},options.timeout*1000);}
var script=document.createElement('script');script.setAttribute('src',url);document.getElementsByTagName('head')[0].appendChild(script);};})(options,guid));};DOMReady();function getTwitterData(orig){var data=orig,i;for(i in orig.user){data['user_'+i]=orig.user[i];}
data.time=relative_time(orig.created_at);return data;}
function ready(callback){if(!isReady){readyList.push(callback);}else{callback.call();}}
function fireReady(){isReady=true;var fn;while(fn=readyList.shift()){fn.call();}}
function DOMReady(){if(document.addEventListener&&!browser.webkit){document.addEventListener("DOMContentLoaded",fireReady,false);}else if(browser.msie){document.write("<scr"+"ipt id=__ie_init defer=true src=//:><\/script>");var script=document.getElementById("__ie_init");if(script){script.onreadystatechange=function(){if(this.readyState!="complete")return;this.parentNode.removeChild(this);fireReady.call();};}
script=null;}else if(browser.webkit){var safariTimer=setInterval(function(){if(document.readyState=="loaded"||document.readyState=="complete"){clearInterval(safariTimer);safariTimer=null;fireReady.call();}},10);}}
function relative_time(time_value){var values=time_value.split(" ");if(time_value.match(/,/))
var parsed_date=Date.parse(values[2]+" "+values[1]+", "+values[3]+" "+values[4]);else
var parsed_date=Date.parse(values[1]+" "+values[2]+", "+values[5]+" "+values[3]);var date=new Date(parsed_date);var relative_to=(arguments.length>1)?arguments[1]:new Date();var delta=parseInt((relative_to.getTime()-parsed_date)/1000);var r='';function formatTime(date){var hour=date.getHours();var min=date.getMinutes()+"";var ampm='am';if(hour==0){hour=12;}else if(hour==12){ampm='pm';}else if(hour>12){hour-=12;ampm='pm';}
if(min.length==1){min='0'+min;}
return hour+':'+min+' '+ampm;}
function formatDate(date){var ds=date.toDateString().split(/ /),mon=monthDict[date.getMonth()],day=date.getDate()+'',dayi=parseInt(day),year=date.getFullYear(),thisyear=(new Date()).getFullYear(),th='th';if((dayi%10)==1&&day.substr(0,1)!='1'){th='st';}else if((dayi%10)==2&&day.substr(0,1)!='1'){th='nd';}else if((dayi%10)==3&&day.substr(0,1)!='1'){th='rd';}
if(day.substr(0,1)=='0'){day=day.substr(1);}
return mon+' '+day+th+(thisyear!=year?', '+year:'');}
delta=delta+(relative_to.getTimezoneOffset()*60);if(delta<5){r='less than 5 seconds ago';}else if(delta<30){r='half a minute ago';}else if(delta<60){r='less than a minute ago';}else if(delta<120){r='1 minute ago';}else if(delta<(45*60)){r=(parseInt(delta/60)).toString()+' minutes ago';}else if(delta<(2*90*60)){r='about 1 hour ago';}else if(delta<(24*60*60)){r='about '+(parseInt(delta/3600)).toString()+' hours ago';}else{if(delta<(48*60*60)){r=formatTime(date)+' yesterday';}else{r=formatTime(date)+' '+formatDate(date);}}
return r;}})();
var hTwitter=Class.create();Object.extend(hTwitter,{base_sharing_url:'http://twitter.com/share?',related_accounts:'hulu',init:function(username,container){this.username=username;this.refresh_feeds();twttr.anywhere(function(T){T(container).hovercards();});this.tweetbox=$('tweetbox');if(this.tweetbox){this.tweetbox.observe('focus',this.on_tweetbox_focus.bindAsEventListener(this));this.tweetbox.observe('keypress',this.on_tweetbox_change.bindAsEventListener(this));this.tweetbox.observe('keyup',this.on_tweetbox_change.bindAsEventListener(this));}},tweet_from_hulu:function(){if($('tweet-button').hasClassName('disabled')){return;}
this.share_in_popout($('tweetbox').value);},share_in_popout:function(text){var url_options=$H({url:window.location.href.split('?')[0],text:text,related:this.related_accounts});var url=this.base_sharing_url+url_options.toQueryString();var window_options=$H({width:550,height:450,personalbar:0,toolbar:0,scrollbars:1,resizable:1,top:0});window_options["left"]=Math.round((screen.width/2)-(window_options["width"]/2));if(screen.height>window_options["height"]){window_options["top"]=Math.round((screen.height/2)-(window_options["height"]/2))}
this.share_window=window.open(url,"twitter_tweet",window_options.toQueryString().gsub("&",","));if(this.share_window){this.share_window.focus();Event.observe(window,"focus",this.on_main_window_focus.bindAsEventListener(this))}},on_main_window_focus:function(){if(this.share_window){this.share_window=null;if(!this.tweetbox.hasClassName('unfocused')){this.tweetbox.addClassName('unfocused');this.tweetbox.value="What's happening?";$('char-count').innerHTML=140;}
this.refresh_feeds();}},refresh_feeds:function(){var working='<div style="text-align: center; margin: 10px 0px;">';working+='<img src="'+Base.imageURL('/images/loading-animated-circle-32x32.gif')+'" alt="Loading"></div>';var twitter_options=$H({count:5,enableLinks:true,clearContents:true,newwindow:true});posted_tweets=$('posted-tweets');tweets_received=$('tweets-received');if(posted_tweets)
$('posted-tweets').innerHTML=working;if(tweets_received)
$('tweets-received').innerHTML=working;if(posted_tweets){getTwitters('posted-tweets',twitter_options.merge({id:this.username,ignoreReplies:false,template:'%text% <span>%time%</span>',callback:function(){$$('#posted-tweets li').last().addClassName('last');}}).toObject());}
if(tweets_received){getTwitters('tweets-received',twitter_options.merge({id:'@'+this.username,useSearchAPI:true,ignoreReplies:false,template:'%from_user%: %text% <span>%time%</span>',callback:function(){$$('#tweets-received li').last().addClassName('last');}}).toObject());}},on_tweetbox_focus:function(){if(this.tweetbox.hasClassName('unfocused')){this.tweetbox.removeClassName('unfocused');this.tweetbox.value="";}},on_tweetbox_change:function(){var newCount=(140-$('tweetbox').value.length);$('char-count').innerHTML=newCount;if(newCount>=0&&newCount<=140){$('tweet-button').removeClassName('disabled');}else{$('tweet-button').addClassName('disabled');}}});
var AdFeedback=Class.create();var AdTailorTrack=Class.create();Object.extend(AdFeedback,{select:function(node,type){$('adtailor-nav-ul').down('.selected').removeClassName('selected');node.up("li").addClassName("selected");$('no_question_prompt').hide();var count=1;var total=0;switch(type){case'all':$$(".adtailor-question").each(function(n){n.down('.adtailor-questionseq').innerHTML=count+".";count+=1;n.show();});break;case"answered":$$(".adtailor-question").each(function(n){if(n.hasClassName("answer-cleared")){n.hide();}
else{n.down(".adtailor-questionseq").innerHTML=count+".";count+=1;n.show();}
total+=1;});node.innerHTML="Answered ("+(count-1)+")";$("unanswered").down("a").innerHTML="Unanswered ("+(total-count+1)+")";break;case"unanswered":$$(".adtailor-question").each(function(n){if(!n.hasClassName("answer-cleared")){n.hide();}
else{n.down(".adtailor-questionseq").innerHTML=count+".";count+=1;n.show();}
total+=1;});node.innerHTML="Unanswered ("+(count-1)+")";$("answered").down("a").innerHTML="Answered ("+(total-count+1)+")";break;}
if(count==1){$('no_question_prompt').down("td").innerHTML="You currently have no "+type+" questions.";$('no_question_prompt').show();}},checkboxBefore:function(position,obj){if(obj.hasClassName('checked'))
obj.className='checkbox';else
obj.className='checkbox checked';$('modify_time'+position).hide();$('saving'+position).show();},submitSuccess:function(position,obj,opts){var myDate=new Date();var hour=myDate.getHours();var minute=myDate.getMinutes();var mminute;opts=opts||{};cleared=false;if(opts.is_cleared){cleared=true;}else if(opts.checkbox){cleared=($("question"+position).down(".adtailor-answer").getElementsByClassName("checked").length==0);}
if(opts.question_id&&(opts.answer_id>0)){var ev='check';if(opts.checkbox&&!obj.hasClassName('checked')){ev='uncheck';}
AdTailorTrack.send_event(ev,{question_id:opts.question_id,answer_id:opts.answer_id});}
if(cleared){$('saving'+position).hide();$('modify_time'+position).show();$('modify_time'+position).innerHTML='Unanswered';var table=$('question'+position).up();$('question'+position).addClassName('answer-cleared');AdTailorTrack.send_event('clear',{question_id:opts.question_id});}
else{if(minute<10)
mminute='0'+minute;else
mminute=minute;$('saving'+position).hide();$('modify_time'+position).show();$('modify_time'+position).innerHTML="Last updated less than a minute ago"
$('question'+position).removeClassName('answer-cleared');}},radioBefore:function(position,obj){if(!obj.hasClassName('pressed'))
var sel_radio=obj.up(".adtailor-answer").getElementsByClassName('radio pressed')[0];if(sel_radio!=null)
sel_radio.className='radio';obj.className='radio pressed';$('modify_time'+position).hide();$('saving'+position).show();},selectOnchange:function(position,obj,question_id,answer_type){$('modify_time'+position).hide();$('saving'+position).show();var selected_value=obj.value;var ajaxurl='/profile/ad_tailor_update?answer_id='+
selected_value+'&question_id='+
question_id+'&answer_type='+
answer_type+'&is_checked=true';var opts={is_cleared:selected_value==-1,question_id:question_id,answer_id:selected_value};new Ajax.Request(ajaxurl,{asynchronous:true,evalScripts:true,onSuccess:function(request){AdFeedback.submitSuccess(position,obj,opts);}});},cleanAnswerBefore:function(position,obj){$('modify_time'+position).hide();$('saving'+position).show();$('question'+position).select('.pressed').each(function(x){x.removeClassName('pressed');});$('question'+position).select('.checked').each(function(x){x.removeClassName('checked');});if($('answers'+position)!=null)
$('answers'+position).options[0].selected=true;}});Object.extend(AdTailorTrack,{TRACKING_URL:"{endpoint}/v3/aftracking/surveyinteraction?sessionid={SESSIONID}&userid={USERID}&interaction={INTERACTION}&questionid={QUESTIONID}&answerid={ANSWERID}&page={PAGE}&timestamp={TIMESTAMP}&type={TYPE}",TYPE:"profile",user_id:null,session_id:null,init:function(user_id,question_answers){AdTailorTrack.session_id=Beacon.sessionId();AdTailorTrack.user_id=user_id;question_answers=question_answers||[];AdTailorTrack.send_event('pageload',{"question_answers":question_answers.join("_")});},send_event:function(ev,params){params=params||{};params['timestamp']=(new Date).getTime();var e=encodeURIComponent||escape;var url=AdTailorTrack.TRACKING_URL.replace('{endpoint}',Beacon.getStandardHost()).replace('{SESSIONID}',e(AdTailorTrack.session_id)).replace('{USERID}',e(AdTailorTrack.user_id)).replace('{INTERACTION}',e(ev)).replace('{QUESTIONID}',e(params['question_id']||'')).replace('{ANSWERID}',e(params['answer_id']||'')).replace('{PAGE}',e(params['page']||'')).replace('{TIMESTAMP}',e(params['timestamp']||'')).replace('{TYPE}',e(AdTailorTrack.TYPE));if(params["question_answers"]){url+=("&answers="+params["question_answers"]+"&val1=answers_"+params["question_answers"]);}
pingImage(url);}});
var Browse=Class.create();Object.extend(Browse,{show_thumbnail:true,block_num:0,updating:false,init:function(){ThumbnailLazyLoad.in_browse=true;Behaviors.in_browse=true;var showthumb=true;if(Behaviors.getCookie('_browse_thumb')=='1'){showthumb=false;}
Browse.block_num=0;Browse.view_thumbnail(showthumb,true);Browse.submitFilter();},initViewport:function(){Event.observe(window,'scroll',Browse.updateViewport);Event.observe(window,'resize',Browse.updateViewport);Browse.updating=false;Browse.updateViewport();},updateViewport:function(){if(Browse.updating)return;Browse.updating=true;var top=document.viewport.getScrollOffsets();top=top.top+document.viewport.getHeight();var load_el=$('browse-lazy-load');if(load_el&&load_el.style.display!='none'){var offset=load_el.cumulativeOffset().top
if(top>=offset-20){Browse.submitFilter(true);}else{Browse.updating=false;}}else{Event.stopObserving(window,'scroll',Browse.updateViewport);Event.stopObserving(window,'resize',Browse.updateViewport);}},submitFilter:function(lazy_load){if(lazy_load!=undefined&&lazy_load==true){Browse.block_num++;var load_el=$('browse-lazy-load');if(!load_el)return;}else{Browse.block_num=0;}
var view_as_thumbnail=Browse.show_thumbnail;var keyword_var=$('keyword').value;var alphabet_var=$('browse-alphabet-list').down('.browse-alphabet-td-selected').down('.browse-alphabet').getAttribute('value');var family_friendly_var=0;if($('family-friendly').hasClassName('checked')){family_friendly_var=1;}
var closed_captioned_var=0;if($('closed-caption').hasClassName('checked')){closed_captioned_var=1;}
var has_free=0;if($('has-free')&&$('has-free').hasClassName('checked')){has_free=1;}
var has_hd=0;if($('has-hd')&&$('has-hd').hasClassName('checked')){has_hd=1;}
var has_huluplus=0;if($('has-huluplus')&&$('has-huluplus').hasClassName('checked')){has_huluplus=1;}
var channel_var=$('channel').down("li.selected").getAttribute('value');var subchannel_var=$('subchannel').down("li.selected").getAttribute('value');if(subchannel_var=="All"){subchannel_var=""}
var network_var=$('network');if(network_var)network_var=network_var.down("li.selected").getAttribute('value');if(network_var&&network_var.substr(0,1)=='-')
network_var=network_var.substr(1,network_var.length-1);var content_rating=$('rating');if(content_rating){content_rating=content_rating.down("li.selected").getAttribute("value");if(content_rating&&content_rating.substr(0,1)=='-'){content_rating=content_rating.substring(1);}}
var display_var=$('display').down("li.selected").getAttribute('value');var decade_var=$('decade').down("li.selected").getAttribute('value');if(decade_var.substr(0,1)=='-')
decade_var=decade_var.substr(1,decade_var.length-1);var type_var=$('type').value;$('loading').removeClassName('browse-none-working');new Ajax.Request("/browse/search",{asynchronous:true,evalScripts:true,parameters:{keyword:keyword_var,alphabet:alphabet_var,family_friendly:family_friendly_var,closed_captioned:closed_captioned_var,has_free:has_free,has_huluplus:has_huluplus,has_hd:has_hd,channel:channel_var,subchannel:subchannel_var,network:network_var,rating:content_rating,display:display_var,decade:decade_var,type:type_var,view_as_thumbnail:view_as_thumbnail,block_num:Browse.block_num},method:'get',onComplete:function(request){if(keyword_var!="")
$('resetKeyword').show();else
$('resetKeyword').hide();Behaviors.applyCufon();$('loading').addClassName('browse-none-working');Browse.updating=false;ThumbnailLazyLoad.init();if(Browse.show_thumbnail)
Browse.updateViewport();}});},view_thumbnail:function(view_as_thumbnail,init){var thumbnail_filter_list=$('browse-thumbnail-filter-list');var thumbnail_filter_thumb=$('browse-thumbnail-filter-thumb');if(view_as_thumbnail!=undefined){if(view_as_thumbnail){thumbnail_filter_list.innerHTML='<a href="#" class="unchoice" onclick="Browse.view_thumbnail(false); Browse.submitFilter(false); return false;">List</a>';thumbnail_filter_thumb.innerHTML='Thumbnail';}else{thumbnail_filter_list.innerHTML='List';thumbnail_filter_thumb.innerHTML='<a href="#" class="unchoice" onclick="Browse.view_thumbnail(true); Browse.submitFilter(false); return false;">Thumbnail</a>';}}else{var list_a=thumbnail_filter_list.down('a');view_as_thumbnail=(list_a&&list_a.hasClassName('unchoice'))?true:false;}
if(view_as_thumbnail==true){ThumbnailLazyLoad.hiden=false;Browse.show_thumbnail=true;ThumbnailLazyLoad.updateViewport();Behaviors.eraseCookie('_browse_thumb');}else{ThumbnailLazyLoad.hiden=true;Browse.show_thumbnail=false;Behaviors.setCookie('_browse_thumb','1',365);}},alphabetFilter:function(obj){$('browse-alphabet-list').down('.browse-alphabet-td-selected').removeClassName('browse-alphabet-td-selected');obj.up().addClassName('browse-alphabet-td-selected');},resetOneCombox:function(combox_name){var firstoption=$(combox_name).getElementsByTagName('li')[0];$(combox_name).down('.cbx-choice').innerHTML=firstoption.innerHTML;$(combox_name).getElementsByTagName('input')[0].value=firstoption.getAttribute('value');$(combox_name).down('.selected').removeClassName('selected').removeClassName('selected-hover');firstoption.addClassName('selected');},resetFilter:function(){Browse.resetOneCombox('channel');Browse.resetOneCombox('subchannel');if($('network'))Browse.resetOneCombox('network');if($('rating'))Browse.resetOneCombox('rating');Browse.resetOneCombox('display');Browse.resetOneCombox('decade');$('family-friendly').removeClassName('checked');$('closed-caption').removeClassName('checked');if($('has-free')){$('has-free').removeClassName('checked');}
if($('has-hd')){$('has-hd').removeClassName('checked');}
if($('has-huluplus')){$('has-huluplus').removeClassName('checked');}
$('keyword').value="";Browse.submitFilter();}});
var Plus={};Plus.HandleIntWarning=function(){IntWarning.skipWarning=true;document.observe("intwarning:warn",function(event){$$(".hplus-int-warning").each(Element.show);});};Plus.quickPlay=function(eid){popupDiv=$('channel-quickplay-container');if(!popupDiv)return;var offset=document.viewport.getScrollOffsets();var popupTop=offset.top+((document.viewport.getHeight()-559)/2);var popupLeft=offset.left+((document.viewport.getWidth()-896)/2);popupDiv.style.top=popupTop+"px";popupDiv.style.left=popupLeft+"px";channelQuickPlay(eid);};Plus.Signup=Class.create();Object.extend(Plus.Signup.prototype,{initialize:function(form_id){this.form=$(form_id);this.currentStage=0;this.newUser=true;this.humanCodeDisabled=false;this.humanCodeRequired=false;this.addressTest=false;Event.observe(this.form,"submit",this.submit.bind(this));var cType=$('card_type_select');if(cType){Event.observe(cType,"change",function(){var cNumberRow=$('card_number_tr');var cSecurityRow=$('security_code_tr');var cExpirationRow=$('expiration_date_tr');if(cType.value=='paypal'){if(cNumberRow){cNumberRow.hide();}
if(cSecurityRow){cSecurityRow.hide();}
if(cExpirationRow){cExpirationRow.hide();}}
else{if(cNumberRow){cNumberRow.show();}
if(cSecurityRow){cSecurityRow.show();}
if(cExpirationRow){cExpirationRow.show();}}}.bind(this));}
var cNumber=$('card_number');var self=this;if(cNumber){Event.observe(cNumber,"change",function(){var cc_num=cNumber.value;if(cc_num.length==16){var params={"from":$(self.form["from"]).getValue(),"card_prefix":cc_num.substr(0,6)};params["plan_id"]=self.userData["plan_id"];new Ajax.Request("/account/credit_card_change",{parameters:params,onSuccess:function(transport){self.showCharge(transport.responseJSON);}});}});}
var el=$('disable-human-code');if(el){Event.observe(el,"click",function(){if(this.humanCodeRequired){$(this.form["from"]).setValue("");}
this.disableHumanCode(true);}.bind(this));}
$A(this.form["new_user"]).each(function(input){Event.observe(input,"click",this.toggleCurrentPassword.bind(this));}.bind(this));var date_year=$("date_year");if(date_year){Event.observe(date_year,"change",function(){var delta=((new Date()).getYear()+1900)-date_year.getValue();if(delta<=18){$("date_more").show();$('date_timestamp').selectedIndex=0;}
else{$("date_more").hide();$('date_timestamp').selectedIndex=1;}});}
this.form.focusFirstElement();this.validate.value=this.value.bind(this);},toggleCurrentPassword:function(){if(this.currentStage!=0)return;var current_password=$(this.form["current_password"]);if(this.isNewUser()){current_password.disable();}
else{current_password.enable();current_password.focus();}},isNewUser:function(){return this.value("new_user")=="1";},populateForm:function(data){var form=this.form;$H(data).each(function(kv){if(form[kv[0]]){form[kv[0]].value=kv[1];delete data[kv[0]];}});},showCharge:function(data,is_alert){if(data.charge_text){var img=(is_alert||this.humanCodeDisabled||data.show_alert)?Base.imageURL("/images/icon-orange-alert.gif"):Base.imageURL("/images/icon-warning.gif");var msg='<img alt="Icon-warning" src="'+img+'" style="margin: 0 5px 0 0;" />';msg+=data.charge_text.stripTags();$('cc-info').update(msg);if((/unable to offer you another free trial/).test(msg.toLowerCase())){_gaq.push(['_trackEvent','returning-sub','warning','cannot-offer-trial']);}}},disableHumanCode:function(reload){var el=$(this.form["human_code"]);if(el)el.setValue("");this.humanCodeDisabled=true;if(this.humanCodeRequired&&reload){this.requestSecondStage(this.assumeLoggedIn);}else{$('referral-section').hide();}},validate:{email:function(field){var value=this.value(field);return this.nonempty(field)&&Support.rfc822Email.test(value);},length:function(field,min,max){var value=this.value(field);return this.nonempty(field)&&value.length>=min&&value.length<=max},nonempty:function(field){var value=this.value(field);return value&&!value.blank();},luhn:function(field){var value=this.value(field);var sum=$A(value.split('')).reverse().inject(0,function(s,v,i){v=parseInt(v);return s+(i%2==0?v:(v<=4?2*v:2*v-9));});return sum&&sum%10==0;}},value:function(field){var el=this.form[field];if(el&&el.length){el=$A(el).find(function(input){return input.type=="radio"&&input.checked;});}
if(el){return $(el).getValue();}
else{return null;}},getStage1Errors:function(){if(!this.validate.email("email")){return{"email":"Please enter a valid email address."};}
return null;},loadNextStage:function(assumeLoggedIn){var self=this;var p={partner_code:this.value("partner_code"),vip_code:this.value("vip_code"),gift_code:this.value("gift_code"),referral_code:this.value("referral_code"),from:this.value("from"),login:this.value("email"),bestm:this.value("bestm"),human_code:this.value('human_code')};if(this.value("plan_id")){p["plan_id"]=this.value("plan_id");}
if(!assumeLoggedIn){var errors=this.getStage1Errors();if(errors!=null){this.showErrors(errors);this.setLoadingStatus(false);this.showFirstStage();return;}
if(this.isNewUser()){p.new_user=1;}
else{p.password=this.value("current_password");}}
$$('.ferror').each(function(e){e.update("");});$$('.fix-error').each(Element.hide);if($('signup-facebook-connect'))$('signup-facebook-connect').hide();new Ajax.Request("/account/s1",{parameters:p,onSuccess:function(transport){var data=transport.responseText.evalJSON(true);if(data.redeem_redirect!=undefined){window.location.href=data.redeem_redirect;return;}
if(1==data.new_user){$('new_user').setValue('1');}
self.userData={};Object.extend(self.userData,data);self.activate();self.showCharge(self.userData);if(data.ignore_payment_info){$$(".ignore-payment-info-hide").each(Element.hide);}
if(data.fast_track){$$(".fast-track-hide").each(Element.hide);$$(".fast-track-show").each(Element.show);$("fast_track").value=true;$("fast-track-charge-text").update(data.charge_text);$("fast-track-full-name").update(data.first_name+" "+data.last_name);$("fast-track-card-type").update(data.card_type);$("fast-track-card-mask").update(data.card_mask);$("fast-track-paypal").update(data.paypal_email);if(data.paypal_email&&data.paypal_email!=''){$("fast-track-card-type-tr").hide();$("fast-track-card-mask-tr").hide();$("fast-track-paypal-tr").show();$("fast-track-paypal-inst").show();if($("pay_method_paypal")!=null){$("pay_method_paypal").checked=true;}}
else{$("fast-track-card-type-tr").show();$("fast-track-card-mask-tr").show();$("fast-track-paypal-tr").hide();$("fast-track-paypal-inst").hide();}}
if(data.human_code){this.form["human_code"].value=data.human_code;delete self.userData["human_code"];$('referral-section').hide();}
this.humanCodeRequired=data.human_code_required;if(this.value('vip_code')||this.value('roku_key')||this.value('referral_code')||this.humanCodeDisabled){$('referral-section').hide();}
if(data.new_user==0){self.populateForm(self.userData);self.newUser=false;$(this.form["card_number"]).focus();}
else{$(this.form["email_confirmation"]).focus();}
if(data.show_mail_opt_in==1){$('mail_opt_in').show();}
if(data.clear_from_field){$(this.form["from"]).setValue("");}
self.runAddressTest();}.bind(this),onFailure:function(transport){if((/already a hulu plus subscriber/).test(transport.responseText.toLowerCase())){if(this.value("gift_code")){var obj={code:this.value('gift_code'),src:this.value('src')}
window.location="/plus/gifting_redeem?"+$H(obj).toQueryString();}else if(this.value("partner_code")){window.location="/plus/partner/"+this.value("partner_code");}else{this.hideSignupElements();var el=$("signup-stop-message");el.update(transport.responseText);el.show();}}else if(transport.responseText=="ITUNES_GIFTING_NOT_SUPPORTED"){NewModalPopup.init($("itunes-gifting-message"),function(){window.location='/profile';});NewModalPopup.showCenter(420,198);}else if(transport.responseText=="ITUNES_PROMO_NOT_SUPPORTED"){NewModalPopup.init($("itunes-promo-message"),function(){window.location='/profile';});NewModalPopup.showCenter(420,198);}else{var els=$$(".ferror.email");var err=transport.responseText;if("VERIFY_EDU_EMAIL"==err){Behaviors.sendEmailValidation(function(email){var el=$("signup-stop-message");el.update("Thanks for requesting for your 2-Week FREE trial of Hulu Plus, brought to "+"you by Capital One. There's just one more step before you can start the "+"signup process.<br/></br>"+"We've sent an email to you at <b>"+email.escapeHTML()+"</b> to verify "+"your email address. Please click on the link in this email to start your "+"2-Week FREE Trial. If you don't see an email from Hulu in your inbox within "+"15 minutes, please check your spam folder. Thanks!");el.show();},"email","plus-signup-edu");this.hideSignupElements();$('signup-header').update('Hulu Plus - Back to Campus Offer');Behaviors.applyCufon();$('signup-header').up('div').insert({bottom:"<img src='"+Base.imageURL('/images/pluslanding/cap_one_hulu_plus.png')+"' class='promo-banner'/>"});return;}else if("SHOW_PASSWORD"==err){if($('signup-facebook-connect'))$('signup-facebook-connect').show();$('password-container').removeClassName('hidden');if($('email_confirmation')&&$('email'))$('email_confirmation').value=$('email').value;$('new_user').setValue('0');self.newUser=false;}else if("EMAIL_USED"==err){var el=$("signup-stop-message");el.update("Your email is already registered on Hulu, please input another email address. Our current system does not allow the use of the same email address for services across different regions. Sorry for the inconvenience.");el.show();}else if(els){els.each(function(e){e.update(err);});}else{ModalPopup.warn(transport.responseText);}}
self.showFirstStage();}.bind(this),onComplete:function(){this.setLoadingStatus(false);}.bind(this)});},hideSignupElements:function(){if($('stage-1'))$('stage-1').hide();if($('fb-connected-user-info'))$('fb-connected-user-info').hide();$('plus-signup-header').hide();$$('.please-text').each(Element.hide);$$('.plusplus').each(Element.hide);$$('.subsection').each(Element.hide);if($('support-contact-link'))$('support-contact-link').hide();if($('support-contact-info'))$('support-contact-info').hide();},runAddressTest:function(){if(false){try{this.form.select(".address-test").each(Element.hide);this.form["street1"].value="123 Hulu Way";this.form["city"].value="Los Angeles";this.form["state"].value="CA";this.addressTest=true;}
catch(e){this.form.select(".address-test").each(Element.show);}}
_gaq.push(['_trackEvent','PlusAddressTest','Pre'+(this.addressTest?'Remove':'Keep')]);},activate:function(){this.form.select(".hidden").each(function(el){el.removeClassName("hidden");});this.form.select(".hideable").each(Element.hide);if(!this.isNewUser()){this.form.select(".new_user_only").each(Element.hide);}else{$('referral-title').hide();}
this.currentStage++;},isLoading:false,setLoadingStatus:function(isLoading){Plus.Signup.isLoading=isLoading;var fn=isLoading?Element.show:Element.hide;$$(".loading-circle").each(fn);},showErrors:function(errors){var msg=false;var popout=false;var scroll=false;var form=this.form;$$('.ferror').each(function(e){e.update("");});$$('.sponsor').each(Element.show);$$('.fix-error').each(Element.hide);$H(errors).each(function(tuple){$$('.sponsor').each(Element.hide);var els=$$(".ferror."+tuple.key);if(!tuple.key.blank()&&els&&els.length>0){scroll=true;els.each(function(e){e.update(tuple.value);});if((/passwords do not match/).test(tuple.value)){$(form["password"]).setValue("");$(form["password_confirmation"]).setValue("");$(form["password"]).focus();}}else{popout=true;if(!msg){msg=tuple.value;}else{msg="Please fix the following errors:<br/>\n - "+msg+"<br/>";msg+=" - "+tuple.value+"<br/>";}}});if(popout){if((/Since you've had a Hulu free trial in the past/).test(msg)){_gaq.push(['_trackEvent','returning-sub','popup','cannot-offer-trial']);var self=this;ModalPopup.ask('<b>'+msg+'</b>',"","",function(){ModalPopup.display('<div style="overflow:hidden;"><div style="float:left;"><img src="/images/loading-animated-circle.gif" /></div><div style="float:left;margin-left:5px;">Please wait while we process your subscription.</div></div>',null,null,false,true);self.submit();return false;});}else{ModalPopup.warn(msg);}}
else{ModalPopup.hide();}
if(scroll){$$('.fix-error').each(Element.show);Element.scrollTo($('plus-signup-header'));}},showFirstStage:function(){$('stage-1').removeClassName("hidden");},requestSecondStage:function(assumeLoggedIn){this.assumeLoggedIn=assumeLoggedIn;if(Plus.Signup.isLoading)return;this.setLoadingStatus(true);this.loadNextStage(assumeLoggedIn);},getSignupReferrer:function(){var c=Behaviors.getCookie("_hulu_plus_cmp_url");if(c&&!c.blank())return unescape(c);c=document.referrer;if(c&&!c.blank())return c;return document.location.href;},submit:function(){if(Plus.Signup.isLoading)return;this.setLoadingStatus(true);if(this.currentStage==0){this.loadNextStage();}
else{var body=this.form.serialize()+'&'+$H(this.userData).toQueryString()+'&'+$H({referrer_url:this.getSignupReferrer()}).toQueryString()+'&'+$H({signup_url:window.location.href}).toQueryString();if(Behaviors.getCookie("plroku")&&this.value('from')!='edu'){body+='&roku=1';}
new Ajax.Request("/account/s2",{postBody:body,onSuccess:function(transport){var json=transport.responseText.evalJSON();if(json&&json.redirect_location){window.location.href=json.redirect_location;return;}
_gaq.push(['_trackEvent','PlusAddressTest','Post'+(this.addressTest?'Remove':'Keep')]);var obj={sid:this.value('sid'),src:this.value('src'),param:this.value('param'),ts:this.value('ts')};var url=[];for(var key in obj){url.push(key+"="+escape(obj[key]));}
var query_params=[];if(this.value('from')!='')
query_params.push('from='+this.value('from'));if(Behaviors.getCookie("plroku")&&this.value('from')!='edu')
query_params.push('roku');if(json&&json.thanks_params)
query_params.push($H(json.thanks_params).toQueryString());var query_string=query_params.length>0?('?'+query_params.join('&')):'';window.location="http://"+window.location.host.replace(/secure/,"www")+'/plus/thanks'+query_string+'#'+url.join("&");}.bind(this),onFailure:function(transport){var errors=transport.responseText.evalJSON(true);Object.extend(this.userData,errors);if(errors.plan_id){var el=$(this.form["vip_code"]);if(el)el.setValue("");el=$(this.form["referral_code"]);if(el)el.setValue("");el=$(this.form["partner_code"]);if(el){var from_el=$(this.form["from"]);if(from_el&&(from_el.value=="partner")){from_el.setValue("");el.setValue("");}}
if(this.humanCodeRequired){$(this.form["from"]).setValue("");}
if(!errors.user_device){this.disableHumanCode(false);}}
if(errors.failed_chase){var self=this;NewModalPopup.init($("failed-chase-message"),function(type){if(type=="signup"){$(self.form["from"]).setValue("");Object.extend(self.userData,errors.optional_data);self.submit();}});NewModalPopup.showCenter(715,290);}
if($("fast_track").value=="true"){for(var key in errors.errors){if((key!="terms_of_service")&&(key!="human_code")){Plus.Signup.editInfo();break;}}}
this.showErrors(errors.errors);this.showCharge(errors,true);}.bind(this),onComplete:function(transport){var json=transport.responseText.evalJSON();if(json==null||json.redirect_location==null){this.setLoadingStatus(false);}}.bind(this)});}}});Plus.Signup.editInfo=function(){$$(".fast-track-hide").each(Element.show);$$(".fast-track-show").each(Element.hide);$("fast_track").value=false;}
Plus.RetryCharge={working:false,retry:function(path,csrf){if(Plus.RetryCharge.working)return;var _retry=function(){$('retry-loading').show();Plus.RetryCharge.working=true;new Ajax.Request(path,{parameters:{csrf:csrf},onSuccess:function(){window.location="/profile";},onFailure:function(transport){var error=transport.responseText;if(error.length<3)error='Sorry, your charge cannot be retried. Please <a class="blue-link" href="/support/support_form?category=account">contact support</a>.';$('retry-loading').hide();Plus.RetryCharge.working=false;if(error.match(/please verify your password/)){Plus.VerifyPassword.verify({success:_retry,force:true});}else{ModalPopup.warn(error);}}});}
Plus.VerifyPassword.verify({success:_retry});}}
Plus.Vacation={working:false,show:function(){var el=$('hplus-vacation-hold');var offset=document.viewport.getScrollOffsets();el.setStyle({top:offset.top+150+'px'});el.show();$$('.overlay-full').each(Element.show);},start:function(path,csrf,jsonp){var duration_weeks=$('vacation_hold_duration_weeks').value;if(Plus.Vacation.working)return;var _start_vacation=function(){Plus.Vacation.show();$('start-vacation-hold-loading').show();Plus.Vacation.working=true;var ajax_options={parameters:{duration_weeks:duration_weeks,csrf:csrf},onSuccess:function(){window.location="/profile";},onFailure:function(transport){var error=transport.responseText;if(error.length<3)error='Sorry, your subscription could not be placed on hold. Please <a class="blue-link" href="/support/support_form?category=account">contact support</a>.';$('start-vacation-hold-loading').hide();Plus.Vacation.working=false;if(error.match(/please verify your password/)){Plus.VerifyPassword.verify({success:_start_vacation,force:true,jsonp:jsonp});}else{$('hplus-vacation-hold').hide();ModalPopup.warn(error);}}};if(jsonp){JsonP.ajax(path,ajax_options);}else{new Ajax.Request(path,ajax_options);}}
_start_vacation();},stop:function(path,csrf,success_callback){if(Plus.Vacation.working)return;var _stop_vacation=function(){$('stop-vacation-hold-loading').show();Plus.Vacation.working=true;new Ajax.Request(path,{parameters:{csrf:csrf},onSuccess:function(){if(success_callback===undefined){window.location="/profile?stop-vacation-hold";}else{success_callback();}},onFailure:function(transport){var error=transport.responseText;if(error.length<3)error='Sorry, your subscription could not be resumed. Please <a class="blue-link" href="/support/support_form?category=account">contact support</a>.';Plus.Vacation.working=false;$('stop-vacation-hold-loading').hide();if(error.match(/please verify your password/)){Plus.VerifyPassword.verify({success:_stop_vacation,force:true});}else{ModalPopup.warn(error);}}});}
Plus.VerifyPassword.verify({success:_stop_vacation});}}
Plus.Cancel={canceling:false,reload:false,init:function(){$$(".overlay-full").each(function(e){e.observe('hulu:overlayHidden',function(){if(Plus.Cancel.reload)
Plus.Cancel.refresh();});});},refresh:function(){window.location="/profile";},cancel:function(path,csrf,jsonp){var _loadInfo=function(){if(Plus.Cancel.canceling)return;Plus.Cancel.canceling=true;$$(".loading-circle").each(Element.show);Plus.Cancel._doCancel(path,csrf,jsonp);}
_loadInfo();},showCanceledBox:function(info){$('plus-cancel-result').update(info);$$(".hplus-cancel-error").each(Element.hide);var offset=document.viewport.getScrollOffsets();$$(".hplus-cancel-popup").each(function(el){el.setStyle({top:offset.top+100+'px'});el.show();});$$('.overlay-full').each(Element.show);$$('.overlay-full').each(function(e){e.observe('click',function(){if(Plus.Cancel.reload)Plus.Cancel.refresh();});});},_doCancel:function(path,csrf,jsonp){var _cancel=function(){var parameters=$H({csrf:csrf}).toQueryString();var ajax_options={parameters:parameters,onSuccess:function(transport){var info=transport.responseText;Plus.Cancel.reload=true;Plus.Cancel.showCanceledBox(info);},onComplete:function(){Plus.Cancel.canceling=false;$$(".loading-circle").each(Element.hide);},onFailure:function(request){if(request.responseText.match(/please verify your password/)){Plus.Cancel.reload=false;Plus.VerifyPassword.verify({success:_cancel,force:true,jsonp:jsonp});}else{$$(".hplus-cancel-error").each(Element.show);if((request.responseText.length>5)&&!(request.responseText.match(/There was a problem canceling your subscription/))){$('hplus-cancel-error-message').update("Error Message: "+request.responseText.escapeHTML());}}}};if(jsonp){JsonP.ajax(path,ajax_options);}else{new Ajax.Request(path,ajax_options);}}
_cancel();},submitCancelReason:function(path,csrf,jsonp){var parameters=$('cancel-survey').serialize()+'&'+$H({csrf:csrf}).toQueryString();var ajax_options={parameters:parameters,onComplete:function(transport){Plus.Cancel.close();}};if(jsonp){JsonP.ajax(path,ajax_options);}else{new Ajax.Request(path,ajax_options);}},close:function(){if(Plus.Cancel.reload){Plus.Cancel.refresh();}
else{$$(".hplus-cancel-popup").each(Element.hide);$$('.overlay-full').each(Element.hide);$$('.hplus-popup').each(Element.hide);}},showCancelToday:function(show_itunes){if(show_itunes){$("standard-cancel-today-msg").hide();$("itunes-cancel-today-msg").show();}
var offset=document.viewport.getScrollOffsets();$("hplus-cancel-today").show().setStyle({top:offset.top+150+'px'});$$(".hplus-cancel-error").each(Element.hide);$$('.overlay-full').each(Element.show);Plus.Cancel.reload=false;},hideCancelToday:function(){$$(".overlay-full").hide();$('hplus-cancel-today').hide();},cancelToday:function(path,csrf){var _cancel_today=function(){new Ajax.Request(path,{parameters:{confirm_cancel:1,csrf:csrf},onSuccess:function(){Plus.Cancel.refresh();},onFailure:function(request){if(request.responseText.match(/please verify your password/)){Plus.VerifyPassword.verify({success:_cancel_today,force:true});}else{$$(".hplus-cancel-error").each(Element.show);}}});}
Plus.VerifyPassword.verify({success:_cancel_today});}};Plus.Landing={currentLetter:'all',currentSort:null,currentFaq:null,isLoggedIn:false,params:{},initForm:function(jsonp){$$('.trial-box-email').each(function(el){var email=window.location.href.toQueryParams()["email"];if(email){el.value=email;}else{new Watermark(el,el.getAttribute('watermark_text')||'Your Email');}});$$('form.human-code-form').each(function(form){form.observe('submit',function(e){Plus.Landing.beforeSubmit(this);if(this.down('input[name=human_code]')!=undefined){if(this.down('input.hidden-human-code')!=undefined){Plus.Landing.loadHumanCode(this);}
Plus.Landing.validate(this,function(f){f.submit();},jsonp);Event.stop(e);}});});},beforeSubmit:function(form){form.down(".plus-sid").setValue(Plus.Tracking.getSessionId());form.down(".plus-ts").setValue(Plus.Tracking.timestamp);return true;},validate:function(form,success,jsonp){var human_code_input=form.down('input[name=human_code]');var from_input=form.down('input[name=from]');if(human_code_input&&from_input){var human_code=human_code_input.value;if(human_code==human_code_input.getAttribute("watermark_text")){human_code="";}
var path='/plus/validate_promo_code';var ajax_options={method:'get',parameters:{human_code:human_code,from:from_input.value},onSuccess:function(transport){var response=transport.responseText.evalJSON();if(response.valid_code){success(form);}else{var message=response.message;ModalPopup.warn(message||'Please enter a valid code.');Watermark.reset(form,true);}}};if(jsonp){JsonP.ajax(path,ajax_options);}else{new Ajax.Request(path,ajax_options);}}},loadHumanCode:function(form){var code=HumanCode.getCode(form);if(code!=null){form.down('input.hidden-human-code').value=code;}},addPromotion:function(e){var form=$(e).up("form.human-code-form");var code;if(form.down('input.hidden-human-code')!=undefined){Plus.Landing.loadHumanCode(form);code=HumanCode.getCode(form);}else{code=form.down("input[name=human_code]").value;}
Plus.Landing.validate(form,function(f){window.location="/plus/redeem/"+code;});},updateLoggedState:function(){if(Behaviors.isLoggedIn()&&Behaviors.isPlusUser()){$$('#top-nv, #top-sec-nv, #footer').each(Element.show);$$('#plus-top-nav').each(Element.hide);}else{$$('#top-nv, #top-sec-nv, #footer').each(Element.hide);$$('#plus-top-nav').each(Element.show);}
Plus.Landing.updateTrialBox();},updateTrialBox:function(){var updateTrialBox=false;if(Behaviors.isLoggedIn()&&!Plus.Landing.isLoggedIn){Plus.Landing.isLoggedIn=true;$$('.trial-box-email').each(Element.hide);if(Behaviors.isPlusUser())updateTrialBox=true;}else if(!Behaviors.isLoggedIn()&&Plus.Landing.isLoggedIn){Plus.Landing.isLoggedIn=false;$$('.trial-box-email').each(Element.show);if(Behaviors.isPlusUser())updateTrialBox=true;}
if(updateTrialBox){$$(".plus-trial-box").each(function(el){var fn=el.hasClassName('plus-logged')?Element.show:Element.hide;fn(el.up('div'));});}},populateContent:function(){var params=Plus.Landing.params;var fields=["is_current","closed_captioned","has_hd"];fields.each(function(field){try{params[field]=($('plus_'+field).hasClassName('checked')?'1':'0')}catch(ex){}});var vft=$('video_type');if(vft)params["video_type"]=vft.value;if((Plus.Landing.currentSort=='alpha')&&(Plus.Landing.currentLetter!='all')){params["letter"]=Plus.Landing.currentLetter;}
params["sort"]=Plus.Landing.currentSort;new Ajax.Updater("hp-more-content","/plus/more_content",{method:"get",parameters:params,evalScripts:true,onComplete:function(){$('content-sort-loading').hide();}});},filterContent:function(filter){var f=$('plus_'+filter);if(f){if(f.hasClassName('checked'))f.removeClassName('checked');else f.addClassName('checked');}
$('filter-loading').show();Plus.Landing.populateContent();},changeSort:function(sort){Plus.Landing.currentSort=sort;$('content-sort-loading').show();Plus.Landing.populateContent();},clearAllFilter:function(){var fields=["is_current","closed_captioned","has_hd"];fields.each(function(field){try{$('plus_'+field).removeClassName('checked');}catch(ex){}});var vft=$('video_type');if(vft)vft.value="all";$('filter-loading').show();Plus.Landing.populateContent();},loadLetter:function(letter){Plus.Landing.currentLetter=letter;$('filter-loading').show();Plus.Landing.populateContent();},moreDevices:function(ael,device){var el=$("device-"+device+"-more");var offset=ael.cumulativeOffset();if(el){el.setStyle({top:offset.top-100+'px'});el.show();}},closeDevices:function(device){var el=$("device-"+device+"-more");if(el)el.hide();},popupHashes:{"plus-sample-shows":null,"plus-faq":"faq"},initPopup:function(){$H(Plus.Landing.popupHashes).keys().each(function(id){$(id).observe('click',function(event){if(event.element().id==id)
Plus.Landing.closePopup();return false;});});},loadSampleShows:function(feature){var params={feature:feature};$('plus-sample-shows-loading').show();$('plus-sample-shows-list').update("");Plus.Landing.showPopup("plus-sample-shows");new Ajax.Updater("plus-sample-shows-list","/plus/sample_shows",{method:"get",parameters:params,evalScripts:true,onComplete:function(){$('plus-sample-shows-loading').hide();}});},showPopup:function(popup_id){var offset=document.viewport.getScrollOffsets();var popupTop=offset.top+((document.viewport.getHeight()-$(popup_id).getHeight())/2);$(popup_id).style.top=popupTop+"px";$(popup_id).style.left=offset.left+"px";$$('.overlay-full').each(function(el){el.show();});$(popup_id).show();},showFaq:function(num){Plus.Landing.showPopup('plus-faq');var el=$('faq-'+num);if(el)Plus.Landing.openFaq(el,true);},openFaq:function(element,isOpen){var ans=element.up().down('.faq-answer');if(ans){var sameElement=(Plus.Landing.currentFaq==ans);if(Plus.Landing.currentFaq&&!(isOpen&&sameElement)){Plus.Landing.currentFaq.addClassName('hidden');}
if(!sameElement){Plus.Landing.currentFaq=ans;ans.removeClassName('hidden');}else if(!isOpen){Plus.Landing.currentFaq=null;}}},hidePopup:function(){$H(Plus.Landing.popupHashes).keys().each(function(n){$$("#"+n).each(Element.hide);});},closePopup:function(){$$('.overlay-full').each(function(el){el.onclick();});},updateCurrentTabFromHash:function(){var hsh=window.location.hash.substring(1);if(hsh=='devices'){window.location='/plus/devices';}else if(hsh=='content'){window.location='/plus/content';}
var popup_id=$H(Plus.Landing.popupHashes).index(hsh);if(popup_id){Plus.Landing.showPopup(popup_id);}},loadWarningMessages:function(){if(Behaviors.isLoggedIn()&&Behaviors.isPlusUser()){if(/from=existing-sub/.test(window.location)){ModalPopup.warn('Sorry, only new subscribers of the Hulu Plus service are eligible for this promotion.');}}},checkRewardZone:function(){var valid=false,bestm=window.location.search.toQueryParams()["m"];if(bestm){var i=0,sum=0;while(bestm.length<10){bestm="0"+bestm;}
var digits=bestm.split('').map(function(n){return parseInt(n);});for(i=0;i<9;i++){sum+=(i%2==0?3:1)*digits[i];}
sum=sum%10;if(sum!=0){sum=10-sum;}
valid=sum==digits[9];}
if(!valid){window.location.href="/plus?src=invalid-rewardzone"}}};Plus.BillHistory={current:-1,total:-1,itemPerPage:10,avaliable:false,show:function(path,csrf){$$(".hplus-popup").each(Element.hide);var offset=document.viewport.getScrollOffsets();$$(".hplus-billhistory-popup").each(function(el){el.setStyle({top:offset.top+150+'px'});el.show();});$$('.overlay-full').each(Element.show);$("billhistory").update('<div class="loading"><img src="'+Base.imageURL('/images/loading-animated-circle-32x32.gif')+'" width="32" height="32" /></div>');new Ajax.Request(path,{method:"get",parameters:{csrf:csrf},onSuccess:function(request){Plus.BillHistory.avaliable=true;$("billhistory").update(request.responseText);var trs=$("billhistory").down("tr").siblings();Plus.BillHistory.total=trs.length;Plus.BillHistory.onPage(1);},onFailure:function(transport){var txt=transport.responseText;if(txt.length<5){txt="There was an error getting your billing history. Please call support.";}
Plus.BillHistory.cancel();ModalPopup.warn(txt);}});},cancel:function(){ModalPopup.hide();},onPage:function(page){Plus.BillHistory.current=page;Plus.BillHistory.updatePageNumber();var zeroBasePage=Plus.BillHistory.current-1;var trs=$("billhistory").down("tr").siblings();for(var i=0;i<Plus.BillHistory.total;i++){trs[i].addClassName(i%2?"odd":"even");if(i<Plus.BillHistory.current*Plus.BillHistory.itemPerPage&&i>=zeroBasePage*Plus.BillHistory.itemPerPage){trs[i].show();}
else{trs[i].hide();}}},updatePageNumber:function(){tp=Math.ceil(Plus.BillHistory.total/Plus.BillHistory.itemPerPage);cp=Plus.BillHistory.current;if(!$('billhistory-page-number')){return;}
else{var pageNumber=$('billhistory-page-number');if(Plus.BillHistory.total<=Plus.BillHistory.itemPerPage){pageNumber.hide();return;}
pageNumber.select('[class="short"]')[0].innerHTML=cp;var last=pageNumber.select('[class="total"]')[0].down("a");last.innerHTML=tp;var first=pageNumber.select('[class="btn first"]')[0].down("a").down("img");var prev=pageNumber.select('[class="btn"]')[0].down("a").down("img");var next=pageNumber.select('[class="btn"]')[1].down("a").down("img");first.stopObserving("click");prev.stopObserving("click");next.stopObserving("click");last.stopObserving("click");if(cp==1){first.src="images/pagination-arrow-first-disabled.gif";first.stopObserving("click");prev.src="images/pagination-arrow-prev-disabled.gif";prev.stopObserving("click");}
else{first.src="images/pagination-arrow-first.gif";first.observe('click',function(){Plus.BillHistory.onPage(1)})
prev.src="images/pagination-arrow-prev.gif";prev.observe('click',function(){Plus.BillHistory.onPage(Plus.BillHistory.current-1)})}
if(cp==tp){next.src="images/pagination-arrow-next-disabled.gif";next.stopObserving("click");}
else{next.src="images/pagination-arrow-next.gif";next.observe('click',function(){Plus.BillHistory.onPage(Plus.BillHistory.current+1)})}
if(tp==1){last.stopObserving("click");}
else{last.observe('click',function(){Plus.BillHistory.onPage(tp)})}
pageNumber.show();}}};Plus.Hold={COOKIE:"_hulu_plholdignore",checkEnabled:true,hide:function(){$("plus-hold-banner").hide();},clear:function(){Plus.Hold.hide();if($("hold-icon"))$("hold-icon").hide();Behaviors.eraseCookie(Plus.Hold.COOKIE);},close:function(dismiss_days){Plus.Hold.hide();Behaviors.setCookie(Plus.Hold.COOKIE,1,dismiss_days);},show:function(type){var ignoreCookie=Behaviors.getCookie(Plus.Hold.COOKIE);var ignore=parseInt(ignoreCookie)==1;if(!ignore){new Ajax.Updater('plus-hold-banner','/plus/on_hold?feature='+type,{method:'get',onComplete:function(){var effects=[new Effect.SlideDown("plus-hold-banner",{sync:true})];if(type=='hold'){effects.push(new Effect.Appear("hold-icon",{sync:true}));}
new Effect.Parallel(effects,{duration:0.3});}});}
else{if(type=='hold'){new Effect.Appear("hold-icon");}}},checking:false,check:function(){if(Plus.Hold.checking)return;if(!Plus.Hold.checkEnabled)return;var uid=Behaviors.getUserId();if(uid>0&&(Behaviors.getCookie("_hulu_pgid"))){Plus.Hold.checking=true;var check_hold_url="/plus/check_hold/"+uid;var _check_hold_cache_cb=Behaviors.getCookie('_check_hold_cache_cb');if(_check_hold_cache_cb){check_hold_url+=("?cb="+_check_hold_cache_cb);}
new Ajax.Request(check_hold_url,{method:"get",onComplete:function(){Plus.Hold.checking=false;}});}},recheck:function(){Plus.Hold.clear();Plus.Hold.check();}};Plus.VerifyPassword={init:function(){$$(".overlay-full").each(function(e){e.observe('hulu:overlayHidden',function(){Plus.VerifyPassword.hide();});});},show:function(opts){opts=opts||{};$$('#hplus-verify-password-form').each(function(f){f.onsubmit=function(){var loading=$$("#hplus-verify-password-form .loading-circle");loading.each(Element.show);var path='/users/verify_pass';var ajax_options={parameters:f.serialize(),onSuccess:function(){Plus.VerifyPassword.hide();if('function'==(typeof opts['success'])){opts['success']();}},onFailure:function(){$$('.hplus-verify-password-error').each(Element.show);},onComplete:function(){loading.each(Element.hide);}};if(opts.jsonp){JsonP.ajax(path,ajax_options);}else{new Ajax.Request(path,ajax_options);}
return false;}});$$('.hplus-verify-password-error').each(Element.hide);var offset=document.viewport.getScrollOffsets();$$(".overlay-full").each(function(e){e.fire('hulu:overlayHidden');});$$("#hplus-verify-password").each(function(el){el.setStyle({top:offset.top+150+'px'});el.show();});$$('.overlay-full').each(Element.show);$$('#hplus-verify-password').each(Element.show);},hide:function(){$$('#hplus-verify-password').each(Element.hide);$$('.overlay-full').each(Element.hide);},verify:function(opts){opts=opts||{};if(opts["force"])Behaviors.eraseCookie("_p_edit_token");if(Behaviors.getCookie('_p_edit_token')){if('function'==(typeof opts["success"])){opts["success"]();}}else{Plus.VerifyPassword.show(opts);}}};Plus.Tracking={session_id:null,getSessionId:function(){if(!Plus.Tracking.session_id){Plus.Tracking.session_id=Beacon.sessionId();}
return Plus.Tracking.session_id;},timestamp:0,ts:0,setTimestamp:function(ts){ts=parseInt(ts)||0;if(ts>0){Plus.Tracking.timestamp=ts;Plus.Tracking.ts=(new Date()).getTime()-ts;}else{Plus.Tracking.timestamp=(new Date()).getTime();}
return ts;},getOptsFromHash:function(){var opts={};var hash=document.location.hash.replace(/^#/,"");$A(hash.split("&")).each(function(field){var splits=field.split("=");opts[splits[0]]=splits[1];});return opts;},getCommonPlusParams:function(){var plusTrackingParams={cmpid:Behaviors.getCMPId(),sessionreferrer:Behaviors.getSessionReferrer(),driverpage:Behaviors.getCookie('_driver_page'),drivertype:Behaviors.getCookie('_driver_type'),driverid1:Behaviors.getCookie('_driver_id_1'),driverid2:Behaviors.getCookie('_driver_id_2'),driverid3:""}
return plusTrackingParams;},trackFlowBeacon:function(landingPage){if(landingPage==1){var qs=window.location.search.toQueryParams();if(qs['driverpage']){Behaviors.setCookie('_driver_page',qs['driverpage']);Behaviors.setCookie('_driver_type',qs['drivertype']);Behaviors.setCookie('_driver_id_1',qs['driverid1']);Behaviors.setCookie('_driver_id_2',qs['driverid2']||"");}else if(Behaviors.getCookie("_driver_page")==null){if(Behaviors.getCookie("_hulu_plus_cmp")==null&&document.referrer!=""){setTimeout(function(){Plus.Tracking.trackFlowBeacon(landingPage);},1000);return;}
Behaviors.setCookie('_driver_page',"");Behaviors.setCookie('_driver_type',"");Behaviors.setCookie('_driver_id_1',Behaviors.getCMPId());Behaviors.setCookie('_driver_id_2',"");}}
var data=this.getCommonPlusParams();data['landingPage']=landingPage;Beacon.trackStandardBeacon(Beacon.TYPE_PLUS,Beacon.EVENT_SIGNUP_FLOW,data);},trackConversionBeacon:function(){var data=this.getCommonPlusParams();data['subscriberid']=Behaviors.getCookie('_subscriber_id');data['subscriptionid']=Behaviors.getCookie('_subscription_id');Beacon.trackStandardBeacon(Beacon.TYPE_PLUS,Beacon.EVENT_SIGNUP_CONVERSION,data);},fields:['event','src','param','referrer','sessionguid','ts','is_plus'].sort(),trackBeacon:function(options){var machine_id=Beacon.computerGUID();if(!machine_id){setTimeout(function(){Plus.Tracking.trackBeacon(options);},1000);return;}
var hash_options=Plus.Tracking.getOptsFromHash();options=options||{};options["is_plus"]=Behaviors.isPlusUser()?"1":"0";options["sessionguid"]=options["sessionguid"]||hash_options["sid"]||Plus.Tracking.getSessionId();options["referrer"]=document.referrer||"";options["ts"]=(Plus.Tracking.ts||"0");Plus.Tracking.fields.each(function(field){var hash_field=(field=="sessionguid"?"sid":field);options[field]=options[field]||hash_options[hash_field]||"";});Beacon.trackStandardBeacon('plustracking','plusconversion',options,false);},trackFromCram:function(options){if(!cram.valid()){setTimeout(function(){Plus.Tracking.trackFromCram(options);},1000);return false;}
var _obj=cram.get("plus_conversion_tracking");if(!_obj)_obj={}
_obj=Object.extend(_obj,options);Plus.Tracking.trackBeacon(_obj);cram.remove("plus_conversion_tracking");}};Plus.Gifting={userData:{purchase:false,order:""},isLoading:false,cardInfoLoaded:false,shownStep:'1',maxMessage:100,giftCode:'YOUR-GIFT-CODE',maxSteps:0,src:'',unitPrice:null,pending:false,init:function(src,unitPrice){$('gifting-s1').show();Plus.Gifting.initializePreview();Plus.Gifting.updateGiftingCard();Plus.Tracking.setTimestamp();Plus.Gifting.src=src;Plus.Gifting.unitPrice=unitPrice;Plus.Gifting.trackBeacon(1);window.onbeforeunload=Plus.Gifting.confirmLeave;},reset:function(){var msg=Plus.Gifting.confirmLeave();if(msg){if(!window.confirm(msg))return;}
Plus.Gifting.userData["purchase"]=false;Plus.Gifting.giftCode='YOUR-GIFT-CODE';Plus.Gifting.maxSteps=0;Plus.Gifting.setNewUser(false);Plus.Tracking.setTimestamp();Plus.Gifting.trackBeacon(1);Plus.Gifting.enableSteps([2,3,4],false);$$('.gifting-s3-purchase-prompt').each(Element.show);$('gifting-s4-email').show();$($('gifting-s4-email-form')['email']).setValue('');$('gifting-s4-sent').hide();Plus.Gifting.initializePreview(true);Plus.Gifting.updateGiftingCard();Plus.Gifting.switchStep('1');},confirmLeave:function(ev){var msg=null;if(Plus.Gifting.pending){if(Plus.Gifting.maxSteps==4){msg="Your gift purchase is completed, but you have not emailed or printed your gift card yet. Are you sure you want to leave this page?";}else{msg="You have not completed your gift purchase, are you sure you want to leave this page?";}}
if(msg&&!Prototype.Browser.IE){if(ev)ev.returnValue=msg;return msg;}},trackBeacon:function(step){if(step>=0&&step<=Plus.Gifting.maxSteps)return;var opts={src:Plus.Gifting.src};if(step==-1){opts["event"]="gifting_landing";}else{Plus.Gifting.maxSteps=step;if(step==4){var amount=Plus.Gifting.unitPrice*parseInt(Plus.Gifting.userData["quantity"]);opts["event"]="purchase_success";opts["param"]=amount;}else{opts["event"]="purchase_s"+step;}}
Plus.Tracking.trackBeacon(opts);},setNewUser:function(isNew){$A($('plus-gifting-login')['new_user']).each(function(el){if(el.value==(isNew?'yes':'no'))el.checked=true;});},isNewUser:function(){if(Behaviors.isLoggedIn())return false;var ret=true;$A($('plus-gifting-login')['new_user']).each(function(el){if(el.checked)ret=(el.value=='yes');});return ret;},enableSteps:function(steps,enabled){$A(steps).each(function(step){$('gifting-nav-s'+step).className=enabled?"gifting-step-enabled":"gifting-step-disabled";});},isStepEnabled:function(step){return($('gifting-nav-s'+step).className=='gifting-step-enabled');},switchStep:function(newStep,nav){if(Behaviors.isLoggedIn()&&newStep=='2a')newStep='2b';var lastId=parseInt(Plus.Gifting.shownStep);var newId=parseInt(newStep);if(nav&&!Plus.Gifting.isStepEnabled(newId))return;if(lastId==1&&!Plus.Gifting.populateGiftingDesign())return;Plus.Gifting.enableSteps([lastId],newId>lastId);$('gifting-nav-s'+newId).className="gifting-step-current";$('gifting-s'+Plus.Gifting.shownStep).hide();$('gifting-s'+newStep).show();if(Plus.Gifting.maxSteps>1&&Plus.Gifting.isNewUser()){$A([$('gifting-s2a'),$('gifting-s2b')]).each(newId==2?Element.show:Element.hide);}
Plus.Gifting.shownStep=newStep;Plus.Gifting.trackBeacon(newId);if(newId==4){Plus.Gifting.enableSteps([1,2],false);pingImage("https://ad.yieldmanager.com/pixel?id=1420100&t=2");}else if(newId==3&&lastId==4){Plus.Gifting.enableSteps([4],true);$$('.gifting-s3-purchase-prompt').each(Element.hide);}else if(newId==1){Plus.Gifting.enableSteps([2],false);Plus.Gifting.userData["order"]="";}},getDesignParams:function(){var form=$('plus-gifting-design');var design=null;$A(form['gifting_design']).each(function(el){if(el.checked)design=el.value;});var months=0;if(form['gifting_package']){$A(form['gifting_package']).each(function(el){if(el.checked)months=el.value;});if(months=='custom')months=form['gifting_package_months'].getValue();Plus.Gifting.userData["quantity"]=months;}
var ret={design:design,months:months,code:Plus.Gifting.giftCode};var im=$H({gifting_to_name:"to",gifting_from_name:"from",gifting_message:"message"});im.each(function(tuple){var el=$(tuple.key);ret[tuple.value]=el.hasClassName("gift-textbox-initial")?"":el.getValue();});return ret;},initializePreview:function(force){var im=$H({gifting_to_name:"Recipient Name",gifting_from_name:"Your Name",gifting_message:"Type your personal message here"});var initialized=false;im.keys().each(function(k){if($(k).getValue()!="")initialized=true;});if(initialized&&!force)return;im.each(function(tuple){var el=$(tuple.key);el.addClassName("gift-textbox-initial");el.setValue(tuple.value);});},focusField:function(el){if(!el.hasClassName('gift-textbox-initial'))return;el.removeClassName('gift-textbox-initial');el.value="";},durationMessage:function(design){var color=Plus.Gifting.durationColor[design];var ret=Plus.Gifting.userData["quantity"]+' Month Subscription';if(color)ret="<span style='color:#"+color+"'>"+ret+"</span>";return ret;},updateGiftingCard:function(field){var gp=Plus.Gifting.getDesignParams();var div=$('s1-preview');if((!field||field=='design')&&gp["design"]){div.down('.gifting-preview-img').src=Base.imageURL('/images/card-'+gp["design"]+'-mid.jpg');var f=$('gifting-s4-email-form');if(f){var d=new Date();f['delivery_date'].setValue(gp["design"]=='vday'?('2/14/'+d.getFullYear()):((d.getMonth()+1)+'/'+d.getDate()+'/'+d.getFullYear()));}}
if(!field||field=='duration'||field=='design')div.down('.gift-preview-duration').update(Plus.Gifting.durationMessage(gp["design"]));if(!field||field=='to')div.down('.gift-preview-to').update('<span class="gifting-preview-label">To:</span>'+gp["to"].escapeHTML());if(!field||field=='from')div.down('.gift-preview-from').update('<span class="gifting-preview-label">From:</span>'+gp["from"].escapeHTML());if(!field||field=='message'){div.down('.gift-preview-message').update(gp["message"].escapeHTML().gsub(/\n/,'<br/>'));var l=gp["message"].length;var msg="<b>"+l+"</b>";if(l>Plus.Gifting.maxMessage)msg="<span style='color: red'>"+msg+"</span>";msg+=" of "+Plus.Gifting.maxMessage+" (maximum characters)";$('gift-char-input').update(msg);}},populateGiftingDesign:function(s4Only){var gp=Plus.Gifting.getDesignParams();if(!s4Only){var msg=[];if(gp['months']==0)msg.push("Please select number of months for your gift.");if(gp["to"]=="")msg.push("Please enter recipient name.");if(gp["from"]=="")msg.push("Please enter your name.");if(gp["message"].length>Plus.Gifting.maxMessage){msg.push("Sorry, your message is too long.");}
if(msg.length!=0){ModalPopup.warn(msg.join("<br/>"));return false;}
if(gp["message"]=="")$('gifting_message').setValue('');}
if(gp["design"]){if(!s4Only){$('s3-preview-img').src=Base.imageURL('/images/card-'+gp["design"]+'-mid.jpg');}
$('s4-preview-img').src=Base.imageURL('/images/card-'+gp["design"]+'-lg.jpg');}
$$('.gifting_duration').each(function(el){el.update(Plus.Gifting.durationMessage(gp["design"]));});$$('.gifting_to').each(function(el){el.update('<span class="gifting-preview-label">To:</span>'+gp["to"].escapeHTML());});$$('.gifting_from').each(function(el){el.update('<span class="gifting-preview-label">From:</span>'+gp["from"].escapeHTML());});$$('.gifting_message').each(function(el){el.update(gp["message"].escapeHTML().gsub(/\n/,'<br/>'));});$$('.gifting_code').each(function(el){el.update('Gift Code: '+gp["code"].escapeHTML());});return true;},setLoadingStatus:function(isLoading){if(isLoading&&Plus.Gifting.isLoading)return false;Plus.Gifting.isLoading=isLoading;var fn=isLoading?Element.show:Element.hide;$$(".loading-circle").each(fn);return true;},getPostData:function(stage){var body=$H(Plus.Gifting.userData).toQueryString();var formNames=["plus-gifting-design","plus-gifting-login","plus-gifting-payment"];for(var i=0;i<stage;i++){var form=$(formNames[i]);body+='&'+form.serialize();}
return body;},showErrors:function(form,errors){var msg=false;var popout=false;$$('.ferror').each(function(e){e.update("");});$$('.fix-error').each(Element.hide);$H(errors).each(function(tuple){var els=form?form.select(".ferror."+tuple.key):null;if(!tuple.key.blank()&&els&&els.length>0){els.each(function(e){e.update(tuple.value);});}else{popout=true;if(!msg){msg=tuple.value;}else{msg="Please fix the following errors:<br/>\n - "+msg+"<br/>";msg+=" - "+tuple.value+"<br/>";}}});if(popout){ModalPopup.warn(msg);}},populateCardInfo:function(data){if(data.pluscardinfo){$('gifting-payment-selection').show();if(!Plus.Gifting.cardInfoLoaded)
$('gifting-payment-method-existing').checked=true;$('hplus-card-info').update(data.pluscardinfo);$('purchase-detail-paymentinfo').update(data.pluscardinfo);}else{$('gifting-new-card').show();if(!Plus.Gifting.cardInfoLoaded)
$('gifting-payment-method-new').checked=true;}
if(!Plus.Gifting.cardInfoLoaded){var form=$('plus-gifting-payment');$H(data).each(function(kv){if(form[kv[0]]){form[kv[0]].value=kv[1];}});}
Plus.Gifting.cardInfoLoaded=true;},submitDesign:function(){Plus.Gifting.pending=true;if(Behaviors.isLoggedIn()){Plus.Gifting.setNewUser(false);Plus.Gifting.login();}else{var fn=(Plus.Gifting.maxSteps>1&&Plus.Gifting.isNewUser())?Element.show:Element.hide;$('plus-gifting-login').select(".new_user_only").each(fn);Plus.Gifting.switchStep('2a');}},login:function(){if(!Plus.Gifting.setLoadingStatus(true))return;var form=$('plus-gifting-login');var body=Plus.Gifting.getPostData(2);new Ajax.Request("/account/gifting_login",{postBody:body,onSuccess:function(transport){var response=transport.responseText.evalJSON(true);Plus.Gifting.showErrors(form,{});if(response.next_stage){Plus.Gifting.populateCardInfo(response);Plus.Gifting.switchStep('2b');}else if(Plus.Gifting.isNewUser()){form.select(".new_user_only").each(Element.show);$$('.new_user_hide').each(Element.hide);$('s2-please-text').update('Please complete the form below to purchase your gift.');Plus.Gifting.populateCardInfo(response);Plus.Gifting.switchStep('2b');}else{$('password-container').show();}},onFailure:function(transport){var errors=transport.responseText.evalJSON(true);Plus.Gifting.showErrors(form,errors.errors);if(errors.switchExisting){$('new_user-no').checked=true;$('current_password').focus();}},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}})},s3Edit:function(){$('purchase-detail-desc').update('');$('s3-months-select').setValue(Plus.Gifting.userData["quantity"]);$('s3-months-edit').hide();$('s3-continue').hide();$('s3-months-save').show();},s3Save:function(){var months=$('s3-months-select').getValue();$('a-package-custom').checked=true;$('gifting_package_months').setValue(months);Plus.Gifting.userData["quantity"]=months;Plus.Gifting.populateGiftingDesign();Plus.Gifting.updateGiftingCard('duration');Plus.Gifting.submitPayment();},submitPayment:function(){if(!Plus.Gifting.setLoadingStatus(true))return;var form=$('plus-gifting-payment');Plus.Gifting.userData["purchase"]=false;var body=Plus.Gifting.getPostData(3);new Ajax.Request("/plus/gifting_purchase",{postBody:body,onSuccess:function(transport){var response=transport.responseText.evalJSON(true);Plus.Gifting.showErrors(form,{});Plus.Gifting.switchStep('3');$('s3-continue').show();$('s3-months-save').hide();$('s3-months-edit').show();$H(response).each(function(tuple){var el=$('purchase-detail-'+tuple.key);if(el)el.update(tuple.value);});},onFailure:function(transport){var errors=transport.responseText.evalJSON(true);Plus.Gifting.showErrors(form,errors.errors);},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}});},purchase:function(){if(!Plus.Gifting.setLoadingStatus(true))return;var form=$('plus-gifting-payment');Plus.Gifting.userData["computerguid"]=Behaviors.getGUID();Plus.Gifting.userData["purchase"]=true;var body=Plus.Gifting.getPostData(3);new Ajax.Request("/plus/gifting_purchase",{postBody:body,onSuccess:function(transport){var response=transport.responseText.evalJSON(true);Plus.Gifting.userData["order"]=response.order;Plus.Gifting.giftCode=response.code;$$('.gifting_code').each(function(el){el.update('Gift Code: '+response.code.escapeHTML());});Plus.Gifting.switchStep('4');var btn=$('gifting-print-btn');if(btn){btn.href="/plus/gifting_pdf?order="+Plus.Gifting.userData["order"];Event.observe(btn,"click",function(){Plus.Gifting.pending=false;});}},onFailure:function(transport){var errors=transport.responseText.evalJSON(true);Plus.Gifting.showErrors(null,errors.errors);Plus.Gifting.switchStep('2b');if(errors.order){Plus.Gifting.userData["order"]=errors.order;}},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}});},backEmail:function(){$('gifting-s4-email').show();$('gifting-s4-email-confirm').hide();$('gifting-s4-sent').hide();},emailConfirm:function(){var recipient=$('gifting-s4-email-form')['email'].value;var delivery_date=$('gifting-s4-email-form')['delivery_date'].value;if(!Support.rfc822Email.test(recipient)){ModalPopup.warn("Please enter a valid email address.");return;}
$('gifting-s4-email').hide();$('gifting-s4-email-confirm').show();$$('span.gifting-s4-sent-email').each(function(el){el.update(recipient.escapeHTML());});$$('span.gifting-s4-delivery-date').each(function(el){el.update(delivery_date.escapeHTML());});},email:function(){var recipient=$('gifting-s4-email-form')['email'].value;var delivery_date=$('gifting-s4-email-form')['delivery_date'].value;if(!Plus.Gifting.setLoadingStatus(true))return;var body=Plus.Gifting.getPostData(0);body+='&'+$H({recipient:recipient,delivery_date:delivery_date}).toQueryString();new Ajax.Request("/plus/gifting_email",{postBody:body,onSuccess:function(transport){$('gifting-s4-email-confirm').hide();$('gifting-s4-sent').show();Plus.Gifting.pending=false;},onFailure:function(transport){ModalPopup.warn(transport.responseText);},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}});},print:function(){var gp={"order":Plus.Gifting.userData["order"]};var form=document.createElement("form");form.setAttribute("method","GET");form.setAttribute("action","/plus/gifting_pdf");form.setAttribute("target","_blank");for(var key in gp){var hf=document.createElement("input");hf.setAttribute("type","hidden");hf.setAttribute("name",key);hf.setAttribute("value",gp[key]);form.appendChild(hf);}
document.body.appendChild(form);form.submit();Plus.Gifting.pending=false;},redeem:function(){var form=$("redeem-form");var body="";if(form.down(".codePart0")){var code=HumanCode.getCode(form);var data={"sid":Plus.Tracking.getSessionId(),"ts":Plus.Tracking.timestamp,"code":code};body=Object.toQueryString(data);}else{form.down(".plus-sid").setValue(Plus.Tracking.getSessionId());form.down(".plus-ts").setValue(Plus.Tracking.timestamp);body=form.serialize();}
if(!Plus.Gifting.setLoadingStatus(true))return;new Ajax.Request("/plus/gifting_redeem",{postBody:body,onSuccess:function(transport){var response=transport.responseText.evalJSON(true);window.location=response.url;},onFailure:function(transport){ModalPopup.warn(transport.responseText);},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}});},addItunesNotifcation:function(feature){if(Behaviors.loggedIn){var url="/plus/add_new_device_notification?device=itunes_"+feature;new Ajax.Request(url,{onSuccess:function(transport){$$(".itunes-feature-notify").each(function(e){e.hide();});$$(".itunes-feature-notified").each(function(e){e.show();});}});}}};Plus.Gifting.Reprint={order:"",shownStep:1,totalSteps:3,switchStep:function(newStep){if($('gifting-nav-s'+newStep).className!='gifting-step-enabled')return;for(var i=1;i<=Plus.Gifting.Reprint.totalSteps;i++){if(i<newStep){$('gifting-nav-s'+i).className="gifting-step-enabled";}else if(i==newStep){$('gifting-nav-s'+i).className="gifting-step-current";}else{$('gifting-nav-s'+i).className="gifting-step-disabled";}}
$('gifting-reprint-s'+Plus.Gifting.Reprint.shownStep).hide();$('gifting-reprint-s'+newStep).show();Plus.Gifting.Reprint.shownStep=newStep;},lookup:function(){if(!Plus.Gifting.setLoadingStatus(true))return;var form=$("gifting-order-form");new Ajax.Request("/plus/gifting_update",{postBody:form.serialize(),onSuccess:function(transport){var response=transport.responseText.evalJSON(true);var form=$("plus-gifting-design");Plus.Gifting.Reprint.order=response.order;form["gifting_to_name"].value=response.to.escapeHTML();form["gifting_from_name"].value=response.from.escapeHTML();form["gifting_message"].value=response.message.escapeHTML();var rb=$("a-design-"+response.design);if(rb)rb.checked=true;Plus.Gifting.giftCode=response.code;Plus.Gifting.userData["quantity"]=response.months;Plus.Gifting.updateGiftingCard();$$('.gifting_code').each(function(el){el.update('Gift Code: '+response.code);});$('gifting-nav-s2').className='gifting-step-enabled';Plus.Gifting.Reprint.switchStep(2);},onFailure:function(transport){ModalPopup.warn(transport.responseText);},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}});},save:function(){if(!Plus.Gifting.setLoadingStatus(true))return;var form=$("plus-gifting-design");form["gifting-order"].value=Plus.Gifting.Reprint.order;var msg=[];if(form["gifting_to_name"].value=="")msg.push("Please enter recipient name.");if(form["gifting_from_name"].value=="")msg.push("Please enter your name.");if(form["gifting_message"].value.length>Plus.Gifting.maxMessage){msg.push("Sorry, your message is too long.");}
if(msg.length!=0){ModalPopup.warn(msg.join("<br/>"));Plus.Gifting.setLoadingStatus(false);return;}
new Ajax.Request("/plus/gifting_update",{postBody:form.serialize(),onSuccess:function(transport){var form=$("plus-gifting-design");var design=form.down(':checked[name="gifting_design"]').value;$('s4-preview-img').src=Base.imageURL('/images/card-'+design+'-lg.jpg');$$('.gifting_duration').each(function(el){el.update(Plus.Gifting.durationMessage(design));});$$('.gifting_to').each(function(el){el.update('<span class="gifting-preview-label">To:</span>'+form["gifting_to_name"].value.escapeHTML());});$$('.gifting_from').each(function(el){el.update('<span class="gifting-preview-label">From:</span>'+form["gifting_from_name"].value.escapeHTML());});$$('.gifting_message').each(function(el){el.update(form["gifting_message"].value.escapeHTML().gsub(/\n/,'<br/>'));});$('gifting-nav-s3').className='gifting-step-enabled';Plus.Gifting.backEmail();Plus.Gifting.Reprint.switchStep(3);var btn=$('gifting-print-btn');if(btn)btn.href="/plus/gifting_pdf?order="+Plus.Gifting.Reprint.order;},onFailure:function(transport){ModalPopup.warn(transport.responseText);},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}});},email:function(){if(!Plus.Gifting.setLoadingStatus(true))return;new Ajax.Request("/plus/gifting_email",{postBody:$H({recipient:$('gifting-s4-email-form')['email'].value,delivery_date:$('gifting-s4-email-form')['delivery_date'].value,order:Plus.Gifting.Reprint.order}).toQueryString(),onSuccess:function(transport){$('gifting-s4-email-confirm').hide();$('gifting-s4-sent').show();},onFailure:function(transport){ModalPopup.warn(transport.responseText);},onComplete:function(){Plus.Gifting.setLoadingStatus(false);}})},print:function(){var form=$("gifting-print-form");form["gifting-order"].value=Plus.Gifting.Reprint.order;form.submit();}};document.observe("hulu:loggedIn",Plus.Hold.check);document.observe("hulu:loggedOut",Plus.Hold.clear);document.observe("hulu:overlayHidden",function(ev){$$(".hplus-popup").each(Element.hide);});
var Trailer=Class.create();Object.extend(Trailer,{popup:function(video_id,subtitle,offsite){var top=document.viewport.getScrollOffsets().top;if(top<=475){window.scrollTo(0,475);}
showCollectionLoadingPopup();new Ajax.Request('/videos/show_trailer?id='+video_id+'&subtitle='+encodeURIComponent(subtitle)+'&offsite='+offsite,{asynchronous:true,evalScripts:true,method:'get',onFailure:function(request){}});}});
var Home=Class.create();Object.extend(Home,{trackPlacementLoads:function(loc,ids){if((typeof(sample)!="undefined")&&(sample==0)){query="http://208.91.157.34/siteplacementstracking/SitePlacementsLoadsTracking.ashx?data="+loc+'|'+ids;pingImage(query);}},bindSalesForceTrack:function(){$$('div.featured-content-item').each(function(el){var link=el.down('td.thumb a');var desc=el.down('div.description');if(link&&desc){var onclick=link.getAttribute('onclick');if(onclick){desc.select('a').each(function(ell){ell.setAttribute('onclick',ell.getAttribute('onclick')+';'+onclick);});}}});},hoverArrow:function(arrow){if(arrow&&!arrow.src.match('-hover')){arrow.src=arrow.src.replace(/-active/,'').replace('.gif','-hover.gif');}},resetArrow:function(arrow){if(arrow&&(arrow.src.match('-hover')||arrow.src.match('-active'))){arrow.src=arrow.src.replace(/-hover/,'').replace('-active','');}},activeArrow:function(arrow){if(arrow&&!arrow.src.match('-active')){arrow.src=arrow.src.replace(/-hover/,'').replace('.gif','-active.gif');}},currentPage:function(){var page='home';var pathname=document.location.pathname;if(pathname.match(/movies/))
page='movies';else if(pathname.match('tv'))
page='tv';else if(pathname.match('documentaries'))
page='doc';return page;}});var HomeRecommendSlider=Class.create(VideoSlider,{isHome:true,moving_count:0,getLoc:function(){var recommend_for=this.urlOptions.recommend_for;var mapping=new Hash({"home":"homepage","tv":"homepage_show","movie":"homepage_movie","doc":"homepage_doc"})
var loc=mapping.get(recommend_for);return loc;},domSensitiveInit:function($super,id,options){this._rTracking=new RecommendTracking();this.last_page=1;var extra_tracking=options["extra_tracking_params"];var _rTracking=this._rTracking;this.sld.observe("video_slider:page_load",(function(ev){var user_id=Behaviors.getUserId();var loc=this.getLoc();if(ev.memo.is_first_load){try{_rTracking.send('personalizedshow','showup',user_id,null,null,null,null,null,null,loc,null);}catch(ex){}}
if(extra_tracking){try{_rTracking.send('personalizedshow','recommend_details',user_id,null,null,extra_tracking,null,null,null,loc,null);extra_tracking=null;}catch(ex){}}}).bind(this));this.sld.observe("video_slider:list_changed",(function(ev){var user_id=Behaviors.getUserId();var loc=this.getLoc();if(!ev.memo.is_cached){this.sld.getElementsBySelector(".recommend-item:not(.recommend-observing)").each(function(item){var si=item.up("li.absolutized").readAttribute("si");Event.observe(item,"click",function(){_rTracking.useCookieSend('personalizedshow','click',user_id,null,si,null,null,null,null,loc,null,_rTracking.sessionId);}.bind(this));item.addClassName('recommend-observing');}.bind(this));Beacon.trackPageInfoLoad($('home_recommend_slider'));}
try{var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;if(page>0&&this.last_page!=page){this.last_page=page;_rTracking.send("personalizedshow","scroll",user_id,null,null,null,null,page,null,loc,null);}}catch(ex){}
try{var dstlist=this.getCurrentItemIds();if(!dstlist)return;var no_track=false;if(this.last_dstlist&&this.last_dstlist.indexOf(dstlist)==0){if(this.las_dstlist[dstlist.length]==null||this.last_dstlist[dstlist.length]=="_"){no_track=true;}}
if(!no_track){_rTracking.send('personalizedshow','dstlistchange',user_id,null,null,dstlist,null,null,null,loc,null);}
if(this.last_dstlist!=dstlist){this.last_dstlist=dstlist;}}catch(ex){}}).bind(this));this.sld.observe("video_slider:remove_video",function(ev){var loc=this.getLoc();var user_id=Behaviors.getUserId();var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;try{_rTracking.send('personalizedshow',ev.memo.reason,user_id,1,ev.memo.show_id,null,null,page,null,loc,null);}catch(ex){}}.bind(this));$super(id,options);},removeVideo:function(node,reload_limit){var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;var next=node.next("li.absolutized");node.remove();var remained_li=this.inr.getElementsBySelector("li.absolutized");var max_count=this.maxCount<remained_li.length?this.maxCount:remained_li.length;if(typeof(reload_limit)!='number')reload_limit=this.perPageCount;if(max_count<reload_limit){var show_history=[];remained_li.each(function(li){show_history.push(li.readAttribute("si"));});this.urlOptions["show_history"]=show_history.join("_")
this.pagesLoaded=[];this.inr.update("");this.updateCounts();this.move(null,page);return;}
if(!next){this.updateMaxCount(max_count,page);}else{this.lockSlide();this.moving_count=0;while(next){to=parseInt(next.style.left)-this.itemWidth;this.moving_count+=1;new Effect.Move(next,{x:to,mode:'absolute',duration:0.4,afterFinish:this.moveFinished.bind(this,max_count)});next=next.next("li.absolutized");}}},moveFinished:function(max_count){this.moving_count-=1;if(this.moving_count==0){this.unlockSlide();this.updateMaxCount(max_count);}},updateMaxCount:function(max_count,page){this.maxCount=max_count;this.repopulateNav();if(page&&page>this.maxPages){this.move(null,this.maxPages);}},recommendFeedback:function(node,show_id,options,remove){node=node.up("li");options=options||{};var update_type=options["update_type"]||"add";var feedback_type=options["feedback_type"]||"HasWatchedShow";var reason=feedback_type.replace(/show$/i,"").toLowerCase();new Ajax.Request("/profile/recommend_feedback",{method:'post',parameters:{id:show_id,update_type:update_type,feedback_type:feedback_type},onSuccess:function(transport){if(remove==false){var fbdiv=node.down('.recommend-feedback');if(fbdiv)fbdiv.innerHTML='Thanks for your feedback!';}else{this.removeVideo(node,remove);}}.bind(this)});this.sld.fire("video_slider:remove_video",{show_id:show_id,reason:reason});},getCurrentItemIds:function(){var item_ids=[];var start=-parseInt(this.inr.getStyle("left"));var end=start+this.pageWidth;var lis=this.inr.getElementsBySelector("li.absolutized");lis.each(function(li){var pos=parseInt(li.getStyle("left"));if(pos>=start&&pos<end){item_ids.push(li.readAttribute('si'));}});return item_ids.join("_");},updateURL:function(){var user_id=Behaviors.getUserId();if(user_id>0){this.url=this.url.replace(/_ay$/,"");}else{this.url=this.url+"_ay";this.url=this.url.replace(/(_ay)+$/,"_ay");}}});Object.extend(HomeRecommendSlider,{LoggedIn:null,RecommendFeedback:function(node,show_id,options,remove){if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(node);return false;}
try{var obj=VideoSlider.SLIDER_OBJECTS.get(node.up("ul").up("div.vsl").id);obj.recommendFeedback(node,show_id,options,remove);}catch(ex){}},Repopulate:function(logged_in,css_id){if(logged_in==HomeRecommendSlider.LoggedIn){return;}else{HomeRecommendSlider.LoggedIn=logged_in;}
css_id=css_id||VideoSlider.SLIDERS[0];var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj&&obj.isHome&&!obj.is_first_load){obj._rTracking=new RecommendTracking();obj.repopulate();}},UpdateMaxCount:function(max_count,page,css_id,extra_tracking){css_id=css_id||VideoSlider.SLIDERS[0];var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj&&obj.isHome){obj.updateMaxCount(max_count,page);if(extra_tracking){var loc=obj.getLoc();var user_id=Behaviors.getUserId();try{obj._rTracking.send('personalizedshow','recommend_details',user_id,null,null,extra_tracking,null,null,null,loc,null);}catch(ex){}}}}});
var Social={};Social.Common=Class.create();Object.extend(Social.Common,{videoElements:{},videosForFriends:[],showElements:{},showsForFriends:[],favFriendElements:{},friendsForFavorites:[],fadeDuration:0.75,watchPagePrivacySnum:1,cache:{},iFrameId:'social-common-iframe',fbDefined:function(){return(typeof(FB)!='undefined')&&(typeof(FB.XFBML)!='undefined');},getSocialDataForShow:function(show_id,callback_fn){if(!Behaviors.isLoggedIn())return;var url="/social/friend_identities";var params={"uid":Behaviors.getUserId(),"show_ids":show_id,"cb":(new Date).getTime()};new Ajax.Request(url,{method:'get',parameters:params,onSuccess:function(request){var results=request.responseText.evalJSON();callback_fn(results);}});},showFacePileForShow:function(show_id,div_id){Social.Common.getSocialDataForShow(show_id,function(social_data){var esc=InfoHover.cleanEscape;var friends=social_data[show_id];if(friends.length>0){face_pile="<div id='face-pile-friends-id' style='float: right'><div class='display-friends'>";for(var i=0;i<friends.length&&i<5;i++){var user=friends[i].user;face_pile+="<a href='/profiles/u/"+user.user_id
+"' onclick='Beacon.trackSocialInteraction(this, \"avatar\");'><img class='"
+(i==friends.length-1||i==4?'last':'')
+"' src='/users/picture/"
+user.user_id+"' title='"
+esc(user.first_name)+" "
+esc(user.last_name)+"'/></a>";}
face_pile+="</div></div>";face_pile+="<div class='friends-count' style='float: right'><span style='color: #FFFFFF'>Favorite show for</span> <a href='#' onclick='Social.Common.showFriendsPopup(false,\""+show_id+"\"); return false;' style='font-weight: 700; color: #fff; text-decoration: underline;'>"+friends.length;if(friends.length==1){face_pile+=" friend</a></div>";}
else{face_pile+=" friends</a></div>";}
$(div_id).update(face_pile);}
else{$(div_id).hide();}});},getSocialDataForMastheadFooter:function(callback_fn){if(!Behaviors.isLoggedIn())return;var url="/social/connected_friends?uid="+Behaviors.getUserId()+'&cb='+(new Date).getTime();new Ajax.Request(url,{method:'get',onSuccess:function(request){var results=request.responseText.evalJSON();callback_fn(results);}});},showFacePileForMastheadFooter:function(div_id){Social.Common.getSocialDataForMastheadFooter(function(social_data){var esc=InfoHover.cleanEscape;var friends=social_data.sort(function(){return 0.5-Math.random();});if(friends.length>5){Banner.hide();face_pile="<div id='face-pile-friends-id'><div class='display-friends'>";for(var i=0;i<friends.length&&i<5;i++){var user=friends[i];face_pile+="<a href='/profiles/u/"+user.user_id
+"' onclick='Beacon.trackSocialInteraction(this, \"avatar\");'><img src='/users/picture/"
+user.user_id+"' title='"
+esc(user.first_name)+" "
+esc(user.last_name)+"'/></a>";}
face_pile+="</div></div>";face_pile+="<div class='masthead-footer-text'>";var displayed_count=0;var username_length=0;var MAX_USERNAME_LENGTH=30;for(var i=0;i<friends.length&&i<3;i++){var user=friends[i];username_length+=user.first_name.length;if(username_length<=MAX_USERNAME_LENGTH){if(i>0){face_pile+=", ";}
face_pile+=("<a href='/profiles/u/"+user.user_id+"' class='blue-link'>"+esc(user.first_name));if(i==2){face_pile+="</a> and ";}
else{face_pile+="</a>";}
displayed_count+=1;}else{face_pile+=" and ";}}
var other_friends=friends.length-displayed_count;face_pile+="<a href='/profile/friends' class='blue-link'>"+other_friends+" other friends</a> are connected on Hulu. See what they\'re watching and talking about.</div>";$(div_id).update(face_pile);$('social-banner').show();Beacon.trackPageInfoLoad($('social-banner'));}
else{$('social-banner').hide();$(div_id).hide();}});},getFriendsForVideos:function(video_id,el){Social.Common.videosForFriends.push(video_id);if(Social.Common.videoElements[video_id]==null){Social.Common.videoElements[video_id]=[];}
Social.Common.videoElements[video_id].push(el);},getFriendsForShows:function(show_id,el){Social.Common.showsForFriends.push(show_id);Social.Common.showElements[show_id]=el;},getFavoritesOverlapForFriends:function(friend_id,el){Social.Common.friendsForFavorites.push(friend_id);Social.Common.favFriendElements[friend_id]=el;},_renderFacepile:function(show_id,friends){var esc=InfoHover.cleanEscape;var friend_count=friends.length;if(friend_count>0){var display_friends="<div class='display-friends'>";for(var i=0;i<friend_count&&i<8;i++){var friend_fav=friends[i];var user=friend_fav.user;display_friends+="<a href='/profiles/u/"+user.user_id+"' onclick='Beacon.trackSocialInteraction(this, \"avatar\");'><img src='/users/picture/"+user.user_id+"' title='"+esc(user.first_name+" "+user.last_name)+"'/></a>";}
display_friends+="</div>";if(friend_count>8){display_friends+="<div style='padding-top: 5px;'><a href='#' class='fb_link' onclick='Social.Common.showFriendsPopup(false,\""+show_id+"\"); return false;'>See all "+friend_count+" friends</a></div>";}
return display_friends;}
else{return"";}},_renderFavoritesCommonality:function(result){var overlap_count=result.count;if(overlap_count>0){return"(You have <a href='/profiles/u/"+result.user_id+"/public_favorites' class='fb_link' style='font-weight: normal'>"+
overlap_count+" favorite"+(overlap_count>1?'s':'')+"</a> in common)";}else{return"";}},_showFavoritesCommonality:function(results){for(var friend_id in results){if(results.hasOwnProperty(friend_id)){friend_id=parseInt(friend_id);var el=Social.Common.favFriendElements[friend_id];if(el){el.update(Social.Common._renderFavoritesCommonality(results[friend_id]));new Effect.Appear(el,{duration:Social.Common.fadeDuration});}}}},_showFriendsForShows:function(results){for(var show_id in results){if(results.hasOwnProperty(show_id)){show_id=parseInt(show_id);var el=Social.Common.showElements[show_id];if(el){el.update(Social.Common._renderFacepile(show_id,results[show_id]));new Effect.Appear(el,{duration:Social.Common.fadeDuration});}}}},_showFriendsForVideos:function(results){for(var video_id in results){video_id=parseInt(video_id);for(var x=0;Social.Common.videoElements[video_id]!=null&&x<Social.Common.videoElements[video_id].length;x++){var el=Social.Common.videoElements[video_id][x];if(results.hasOwnProperty(video_id)&&el){var count=parseInt(results[video_id]);if(count>0){var span="<span class='friends_watched_icon info_hover'>"+count+"</span>";el.update(span);new Effect.Appear(el,{duration:Social.Common.fadeDuration});}}}}},populateFavoritesOverlapForFriends:function(){if(!Behaviors.isLoggedIn()||Social.Common.friendsForFavorites.length==0){return;}
var tmp=Social.Common.friendsForFavorites.slice(0);Social.Common.friendsForFavorites=[];var url='/social/friend_overlap_count_for_favorites?';var params={"uid":Behaviors.getUserId(),"friend_ids":tmp.join(','),"cb":(new Date).getTime()};url+=Object.toQueryString(params);var results=Social.Common.cache[url];if(results){Social.Common._showFavoritesCommonality(results);}else{new Ajax.Request(url,{method:'get',onSuccess:function(request){var results=request.responseText.evalJSON();Social.Common.cache[url]=results;Social.Common._showFavoritesCommonality(results);}});}},getNotificationCounts:function(){if(!Behaviors.isLoggedIn())return;var cached_count=Behaviors.getCookie('_inbox_count');if(cached_count){Social.Common.updateInboxCount(cached_count);}else if(location.pathname.match(/^\/(profile|inbox)/)){new Ajax.Request("/social/notification_counts?cb="+(new Date).getTime(),{method:'get',parameters:{uid:Behaviors.getUserId()},onSuccess:function(request){var resp=request.responseText.evalJSON();Behaviors.setCookie('_inbox_count',resp.total,1.0/24);Social.Common.updateInboxCount(resp.total);}});}},updateInboxCount:function(count){var inbox_link=$('inbox-link');if(inbox_link){var cufon_text=inbox_link.down("cufontext");var span=inbox_link.down("span");var anchor=inbox_link.down("a");var content="";if(cufon_text){if(span){inbox_link=span;}else if(anchor){inbox_link=anchor;}
content=cufon_text.innerHTML.strip();}else{content=inbox_link.innerHTML.strip();}
if(parseInt(count)>0){var inbox_count='('+count+')';var count_displayed=/\([0-9]+\)$/.test(content);if(count_displayed){content=content.replace(/\([0-9]+\)$/,inbox_count);}else{content=content+' '+inbox_count;}}else{content=content.replace(/( +\([0-9]*\))?$/,'');}
inbox_link.update(content);if(cufon_text){if(span){Cufon.replace('#inbox-link span',{fontFamily:'Futura',textShadow:'1px 1px #000'});}else if(anchor){Cufon.replace('#inbox-link a',{fontFamily:'Futura',color:'#666',hover:{textShadow:'1px 1px #444',color:'#99CC33'}});}else{Cufon.replace('#inbox-link');}}}},populateFriendsForShows:function(){if(!Behaviors.isLoggedIn()||Social.Common.showsForFriends.length==0){return;}
var tmp=Social.Common.showsForFriends.slice(0);Social.Common.showsForFriends=[];var url="/social/friend_identities";var params={"uid":Behaviors.getUserId(),"show_ids":tmp.join(","),"cb":(new Date).getTime()};var results=Social.Common.cache[url];if(results){Social.Common._showFriendsForShows(results);}else{new Ajax.Request(url,{method:'get',parameters:params,onSuccess:function(request){var results=request.responseText.evalJSON();Social.Common.cache[url]=results;Social.Common._showFriendsForShows(results);}});}},populateFriendsForVideos:function(){if(!Behaviors.isLoggedIn()||Social.Common.videosForFriends.length==0){return;}
var tmp=Social.Common.videosForFriends.slice(0);Social.Common.videosForFriends=[];var url='/social/friends_for_video_icon?video_ids='+tmp.join(',')+'&cb='+(new Date).getTime();var results=Social.Common.cache[url];if(results){Social.Common._showFriendsForVideos(results);}else{new Ajax.Request(url,{method:'get',onSuccess:function(request){var results=request.responseText.evalJSON();Social.Common.cache[url]=results;Social.Common._showFriendsForVideos(results);}});}},showFriendsPopup:function(forVideo,id){var url;var params;if(forVideo){url="/social/friends_for_video/"+id;}else{url="/social/friend_identities";params={"uid":Behaviors.getUserId(),"show_ids":id,"cb":(new Date).getTime()};}
new Ajax.Request(url,{method:'get',parameters:params,onSuccess:function(request){var esc=InfoHover.cleanEscape;var friends=forVideo?request.responseText.evalJSON()['friends']:request.responseText.evalJSON()[id];if(friends.length==1){friendLabel=' friend';}
else{friendLabel=' friends';}
var title=forVideo?'Friends Who Watched This ('+friends.length+')':'Favorite show for '+friends.length+friendLabel;var html='<div><div class="content" style="height: 316px;">';html+='<span class="friends_popup_title"><h3 class="cufonable">'+title+'</h3></span>';html+='<div class="line" style="margin-bottom: 8px"></div>';html+='<div class="friends_popup_content">';for(var x=0;x<friends.length;x++){var friend=forVideo?friends[x]:friends[x].user;html+='<div style="clear: both; padding-top: 10px;"><span style="padding-right: 3px; float: left;"><a href="/profiles/u/'+friend.user_id+'" onclick="Beacon.trackSocialInteraction(this, \'avatar\');"><img width="52" height="52" border="0" class="avatar" src="/users/picture/'+friend.user_id+'"/></a></span>';html+='<span style="float: right; width: 223px; margin-top: 19px; margin-right: 10px;">'+'<a class="fb_link" style="font-weight: bold; font-size: 12px;" href="/profiles/u/'+friend.user_id+'" onclick="Beacon.trackSocialInteraction(this, \'avatar\');">'+esc(friend.first_name+' '+friend.last_name)+'</a>'+'</span></div>';}
html+='</div></div></div>';$('friends_for_video_popup').update(html);Cufon.replace('h3.cufonable',{fontFamily:'Futura'});ModalPopup.display_div($("friends_for_video_popup"),333,350,false,false);$('modal-popup').addClassName('friends_popup');}});InfoHover.executeHide();return false;},showHomepageActivityFeed:function(el){if(!Behaviors.isFacebookConnected()||!$$('.activity_feed_container')){return;}
function lazyload(){Event.stopObserving(window,"scroll",lazyload);if(!el.visible()){el.show();$$('.top-ten-container')[0].hide();$$('.more-to-explore-container')[0].hide();new Ajax.Request('/social/activity_feed?cb='+(new Date).getTime(),{method:'get',onSuccess:function(request){$$('.homepage_activity_loading')[0].hide();el.replace(request.responseText);new Effect.Appear($$('.activity_feed_container')[0],{duration:Social.Common.fadeDuration,afterFinish:function(){Beacon.trackPageInfoLoad($$('.activity_feed_container')[0]);}});Cufon.replace('h2.cufonable',{fontFamily:'Futura'});}});}}
if(Behaviors.isLoggedIn()){if(isScrolledIntoView(el)){lazyload();}else{Event.observe(window,"scroll",lazyload);}}},hideHomepageActivityFeed:function(el){if(!$$('.activity_feed_container')[0])return;$$('.activity_feed_container')[0].hide();$$('.top-ten-container')[0].show();$$('.more-to-explore-container')[0].show();},hideActivity:function(l,is_watch){var el=l.up(".feed_item_with_comments");if(el){if(is_watch){try{el.down('.feed_item_pending_message').show();el.down('.feed_video_item').addClassName('pending_deletion');return;}catch(ex){}}
new Effect.Fade(el,{duration:0.5});}},showWatchPageData:function(video_id,forAds,forResize){if($('watch_page_social')){if(Behaviors.isFacebookConnected()){var url='/social/watch_page_data?video_id='+video_id+'&cb='+(new Date).getTime();if(forAds){url+='&ads=1';}
if(forResize){url+='&for_resize=1';}
if(location.toString().search(/ec=1/)!=-1){url+='&expand_comments=true'}
new Ajax.Request(url,{method:'get',onSuccess:function(request){$('watch_page_social').update(request.responseText);if(forResize){if($$('.comments-watch-page').length>0){$$('.comments-watch-page').first().enable();}}
new Effect.Appear($$('.watch_page_data')[0],{duration:Social.Common.fadeDuration,afterFinish:function(){new Effect.BlindDown($$('.comments_without_box').first(),{duration:2,afterFinish:function(){Cufon.replace('h2.cufonable',{fontFamily:'Futura'});if(!forAds&&!forResize){FacebookCanvas.Comment.showTooltip();}}});}});}});}
else{new Effect.Appear($$('.watch_page_data')[0],{duration:Social.Common.fadeDuration,afterFinish:function(){Hover.makeSandy();if(!forAds&&!forResize){FacebookCanvas.Comment.showTooltip();}}});}}},publishWatchActivity:function(publish,video_id){$('dont_publish_spinner').show();var url='/social/publish_watch?unpublish='+(publish?'0':'1')+'&video_id='+video_id+'&snum='+Social.Common.watchPagePrivacySnum++;new Ajax.Request(url,{method:'post',onComplete:function(request){$('dont_publish_spinner').hide();$(publish?'unpublish_text':'publish_text').hide();$(publish?'feed_publish_link':'feed_unpublish_link').hide();$(publish?'publish_text':'unpublish_text').show();$(publish?'feed_unpublish_link':'feed_publish_link').show();}});return false;},expandSectionClick:function(obj){$(this).getElementsBySelector('a').findAll(function(el){return el.visible();})[0].simulate('click');return false;},showIframe:function(popup){var iframe_id=Social.Common.iFrameId;if(!$(iframe_id)){new Insertion.Bottom(document.body,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:1000;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');}
var xy=Position.cumulativeOffset(popup);var left=xy[0]+"px";var top=xy[1]+"px";var height=popup.getDimensions().height+'px';var width=popup.getDimensions().width+'px';$(iframe_id).setStyle({left:left,top:top,height:height,width:width});$(iframe_id).show();},hideIframe:function(){var iframe_id=Social.Common.iFrameId;if($(iframe_id)){$(iframe_id).hide();}},populateAll:function(){try{if(Behaviors.isLoggedIn()){Social.Common.populateFriendsForVideos();Social.Common.populateFriendsForShows();Social.Common.populateFavoritesOverlapForFriends();$$('.man_tag').each(function(el){el.show();});}}catch(ex){};},hideAll:function(){$$('.man_tag').each(function(el){el.hide();});},morePendingInfo:function(id,video_id,content_id,style,on_success){var item=$(id);item.update("Deletion of this post is still pending. <a class='blue-link' href='#' onclick=\"Beacon.trackSiteUnpublish('video', "+content_id+", true); new Ajax.Request('/profile/remove_from_list/"+video_id+"?type=ViewedVideo', { onSuccess: function(transport) { "+on_success+" }.bind(this)}); return false;\">Click here</a> to remove it on Hulu now, then go to Facebook to delete there.");item.setStyle(style);},privacySettingsToggle:function(on){var on_btn=$('social_share_on');var off_btn=$('social_share_off');if(!on_btn||!off_btn)return;var on_img=$('privacy-social-on-img');var off_img=$('privacy-social-off-img');if(on){on_btn.checked=true;on_img.src=Base.imageURL("/images/social-ctrl-on-sel.png");off_img.src=Base.imageURL("/images/social-ctrl-unsel.png");$$(".social-on-hide").each(function(e){e.hide()});$$(".social-on-show").each(function(e){e.show()});}else{off_btn.checked=true;on_img.src=Base.imageURL("/images/social-ctrl-unsel.png");off_img.src=Base.imageURL("/images/social-ctrl-off-sel.png");$$(".social-on-show").each(function(e){e.hide()});$$(".social-on-hide").each(function(e){e.show()});}}});Social.TopNavControl=Class.create();Object.extend(Social.TopNavControl,{id:'social-ctrl-dropdown',highlight_id:'social-ctrl-topnav-highlight',topnav_id:'social-topnav-ctrl',feed_id:'social-top-nav-feed',shown:false,refresh:function(no_ajax){if(!Behaviors.isLoggedIn())return;var ison_cookie=Behaviors.getCookie(Social.Facebook.IS_SOCIAL_COOKIE);if(!ison_cookie){if(no_ajax){return;}
new Ajax.Request('/social/get_social_setting?cb='+(new Date).getTime(),{method:'get',onSuccess:function(request){Social.TopNavControl.refresh(true);}});return;}
var link=$('top-nav-social-ctrl');if(!link)return;var dropdown=$(Social.TopNavControl.id);if(!dropdown)return;var feed=$(Social.TopNavControl.feed_id);if(!feed)return;var on_img=$('social-ctrl-on-img');var off_img=$('social-ctrl-off-img');var on_link=on_img.up('a');if(Behaviors.isSocialOn()){link.update('Social On');if(on_img)on_img.src=Base.imageURL("/images/social-ctrl-on-sel.png");if(off_img)off_img.src=Base.imageURL("/images/social-ctrl-unsel.png");feed.childElements().each(function(e){e.removeClassName("social-off")});$$(".account-link").each(function(e){e.removeClassName("social-off")});Social.TopNavControl.update_activity_label('on');}else if(Behaviors.isSocialOff()){link.update('Social Off');if(on_img)on_img.src=Base.imageURL("/images/social-ctrl-unsel.png");if(off_img)off_img.src=Base.imageURL("/images/social-ctrl-off-sel.png");feed.childElements().each(function(e){e.addClassName("social-off")});$$(".account-link").each(function(e){e.addClassName("social-off")});Social.TopNavControl.update_activity_label('off');if(window.location.pathname.match(/^\/watch/)){Event.observe(on_link,'mouseover',function(e){Social.TopNavControl.show_item_hover_tooltip(on_link,3);});}}else if(Behaviors.isLoggedIn()){link.update('Social Off');if(on_img)on_img.src=Base.imageURL("/images/social-ctrl-unsel.png");if(off_img)off_img.src=Base.imageURL("/images/social-ctrl-off-sel.png");feed.childElements().each(function(e){e.addClassName("social-off")});$$(".account-link").each(function(e){e.addClassName("social-off")});Social.TopNavControl.update_activity_label('off');Event.observe(on_link,'mouseover',function(e){Social.TopNavControl.show_item_hover_tooltip(on_link,2);});}else{Event.stopObserving(link,'click',Social.TopNavControl.onClick);link.hide();return;}
$$('.footline').invoke('observe','mouseover',function(event){$('manage-link').setStyle({color:'#5588bb'});});$$('.footline').invoke('observe','mouseout',function(event){$('manage-link').setStyle({color:'whiteSmoke'});});var border_block=$('social-ctrl-border-block');var topnav=$(Social.TopNavControl.topnav_id);if(!border_block||!topnav)return;var topnav_width=topnav.getDimensions().width-2;if(topnav_width<10)topnav_width=21;border_block.setStyle({"width":topnav_width+'px'});Event.observe(link,'click',Social.TopNavControl.onClick);link.show();if(Behaviors.shouldShowRoadBlock()&&!location.pathname.match(/^\/plus/)&&!location.pathname.match(/^\/support\/article\//)){Social.Facebook.showPageRoadBlock();}},onClick:function(event){var dropdown=$(Social.TopNavControl.id);if(!dropdown)return;if(dropdown.visible()){Social.TopNavControl.hide();}else{Social.TopNavControl.show();}},show:function(){var dropdown=$(Social.TopNavControl.id);var topnav=$(Social.TopNavControl.topnav_id);var border_block=$('social-ctrl-border-block');if(!dropdown||!topnav||!border_block)return;nav=$('logged-in-nav');var nav_xy=Position.cumulativeOffset(nav);var nav_left=nav_xy[0]-((Prototype.Browser.IE&&BrowserDetect.version>8)?3:0);var nav_top=nav_xy[1];var nav_height=nav.getDimensions().height;var nav_width=nav.getDimensions().width;dropdown.setStyle({left:nav_left+nav_width-dropdown.getDimensions().width-2+'px',top:nav_top+nav_height+'px',zIndex:2500});topnav.addClassName("social-ctrl-topnav-highlight");border_block.setStyle({"width":topnav.getDimensions().width-2+'px'});Social.Facebook.hideTooltip();if(Behaviors.isFacebookConnected()){$$(".show-fb-connected").each(Element.show);$$(".hide-fb-connected").each(Element.hide);Social.TopNavControl.load_feed();}else{$$(".show-fb-connected").each(Element.hide);$$(".hide-fb-connected").each(Element.show);Social.TopNavControl.update_activity_label('on');}
dropdown.show();if(Behaviors.isFacebookConnected()){_gaq.push(['_trackEvent','socialshare','socialcontroller','prompt']);}else{_gaq.push(['_trackEvent','socialshare','socialcontrollerloggedout','prompt']);}
Event.observe($$('body').first(),'click',Social.TopNavControl._onClickOut);Social.Common.showIframe(dropdown);Social.TopNavControl.shown=true;},hide:function(){var dropdown=$(Social.TopNavControl.id);var topnav=$(Social.TopNavControl.topnav_id);if(!dropdown||!topnav)return;dropdown.setStyle({zIndex:-10});Event.stopObserving($$('body').first(),'click',Social.TopNavControl._onClickOut);dropdown.hide();topnav.removeClassName("social-ctrl-topnav-highlight");Social.Common.hideIframe();Social.TopNavControl.shown=false;},_onClickOut:function(event){var dropdown=$(Social.TopNavControl.id);var link=$('top-nav-social-ctrl');if(Social.Facebook._roadblock_is_visible)return;if(event.findElement().ancestors().indexOf(dropdown)<0&&event.findElement()!=link){Social.TopNavControl.hide();}},load_feed:function(){var feed=$(Social.TopNavControl.feed_id);var loading_img=$("social-top-nav-loading");new Ajax.Request("/social/personal_feed?cb="+(new Date).getTime(),{method:'get',onSuccess:function(data){if(loading_img)loading_img.remove();Social.TopNavControl.update_feed(data.responseJSON,feed);}});},update_feed:function(json,feed){var rec_item,cur_item,rec_id,cur_id;var current_items=feed.childElements();var received_items=json["items"].length;var empty_msg=$("empty-feed-message");var view_all=$$("#social-ctrl-dropdown .feed-view-all-link")[0];var i=0;var j=0;while((i<received_items)||(j<current_items.length)){rec_item=json["items"][i];cur_item=current_items[j];if(cur_item==undefined){feed.insert({bottom:rec_item["html"]});i+=1;}else if(rec_item==undefined){current_items[j].remove();j+=1;}else{cur_id=parseInt(cur_item.id.replace("feed_item_",""));rec_id=rec_item["id"];if(rec_id>cur_id){cur_item.insert({before:rec_item["html"]});i+=1;}else if(rec_id==cur_id){i+=1;j+=1;if(rec_item["privacy_state"]==3&&!cur_item.hasClassName("pending-deletion")){cur_item.replace(rec_item["html"]);}}else{cur_item.remove();j+=1;}}}
if(received_items==0){empty_msg.show();}else{empty_msg.hide();}
if(received_items==3){view_all.show();}else{view_all.hide();}},unpublish_item:function(id,params,del){new Ajax.Request("/social/unpublish_item?"+$H(params).toQueryString(),{onSuccess:function(data){if(del){$("feed_item_"+id).remove();}
Social.TopNavControl.load_feed();}});Social.TopNavControl.hide_item_hover_tooltip();},hide_item_hover_tooltip:function(){var el=$$(".social-ctrl-item-tooltip-hover");el.each(function(e){e.remove();});},show_item_hover_tooltip:function(element,typ){var hover=new Element("div",{"class":"social-ctrl-item-tooltip-hover","style":"display:none;"});var msg="Remove from Facebook and Hulu";if(typ==2){msg="Login with Facebook to turn your Social Sharing On";}else if(typ==3){msg="Turning on Social will take effect in the next video";}else{typ=1;}
hover.update(msg);var imgsrc=Base.imageURL("/images/social-ctrl-item-hover-arrow-up.png")
if(typ==1){imgsrc=Base.imageURL("/images/social-ctrl-delete-item-hover-arrow.png")}
var image=new Element("img",{"class":"social-ctrl-item-tooltip-hover-arrow","src":imgsrc});hover.insert({"bottom":image});document.body.insert({"bottom":hover});var elementPos=element.up().cumulativeOffset();var hoverSize=hover.getDimensions();var horizOffset=hoverSize.width/2;if(Prototype.Browser.IE||(window.location.pathname.match(/^\/watch/)&&Prototype.Browser.WebKit)){horizOffset=(typ==1)?hoverSize.width-18:hoverSize.width-60;}
var x=Math.round(Math.min(elementPos[0]-horizOffset,Math.max(document.viewport.getDimensions().width,920)-hoverSize.width))-2;var y=elementPos[1];if(typ==1){y=y-hoverSize.height-7;}else{y=y+hoverSize.height+7;}
var imgtop=image.height==0?-6:-(image.height);var imgleft=elementPos[0]-x+12;if(typ==1){imgtop=hoverSize.height;imgleft=elementPos[0]-x;}
hover.setStyle({"left":x+"px","top":y+"px"});image.setStyle({"left":imgleft+"px","top":imgtop+"px"});Element.show.delay(0.25,hover);var mouseoutHandler=function(){try{hover.remove();}catch(ex){}
Event.stopObserving(element,"mouseout",mouseoutHandler);};Event.observe(element,"mouseout",mouseoutHandler);},update_activity_label:function(option){var el=$$(".list-label");var msg="Shared Activity";if(option=='off'){msg="Previously Shared Activity";}
el.each(function(e){e.update(msg)});Behaviors.applyCufon();}});Social.Facebook=Class.create();Object.extend(Social.Facebook,{POPUP_ID:'facebook-connect-popup',FB_IFRAME_IEFIX_ID:'facebook-iframe-iefix',CCPOP_COOKIE:'_hulu_ccpop',BANNER_COOKIE:'_hulu_fb_banner',AGREE_ROADBLOCK_COOKIE:'_hulu_harb',IS_SOCIAL_COOKIE:'_hulu_ison',SHOW_ROADBLOCK_COOKIE:'_hulu_shrb',NOTIFY_TYPES:{"remind-me-later":7,"no-thanks":365},lastShowPopupName:'',_log_enabled:true,_is_logging_in:false,_is_connecting_canvas_user:false,_is_connecting:false,_is_banner_visible:false,_is_dismissing_roadblock:false,_roadblock_is_visible:false,timerId:'',clearPopupCookies:function(){Behaviors.eraseFlashCookie('_fb_notify');},setPopupWidth:function(width){var popup=Social.Facebook.popup();var width=parseInt(width);if(popup&&width>0){popup.style.width=width+"px";}},closePopup:function(notify_type,revoke){var popup=Social.Facebook.popup();if(!popup)
return;if(revoke==true){if(Social.Common.fbDefined()){FB.api({method:"auth.revokeAuthorization"},null);}}
if(!Prototype.Browser.IE){$$('.overlay-full')[0].hide();}
var expire_days=null;if(notify_type&&typeof(notify_type)!='undefined'&&Social.Facebook.NOTIFY_TYPES[notify_type]!=undefined){expire_days=Social.Facebook.NOTIFY_TYPES[notify_type];}
if(expire_days&&expire_days>0){var timestamp=new Date().getTime()+(expire_days*24*60*60*1000);Behaviors.setFlashCookie('_fb_notify',timestamp);}
Social.Facebook._is_connecting=false;if(location.pathname.match(/^\/watch\/[0-9]+/)){var player=$("player");if(player){player.style.visibility="visible";}}
if(Prototype.Browser.IE||location.pathname.match(/^\/watch\/[0-9]+/)){Social.Facebook.hideIframe(popup);}
popup.hide();},notMe:function(){Social.Facebook.clearPopupCookies();Social.Facebook.closePopup();var session=FB.getAuthResponse();if(Social.Common.fbDefined()&&session!=null){FB.logout(function(response){FB.api({method:"auth.revokeAuthorization"},function(resp){Social.Facebook.connect();});});var url="/social/not_me_alert?fuid="+session.userID+"&cb="+(new Date).getTime();new Ajax.Request(url,{method:'get',asynchronous:true});}else{Social.Facebook.connect();}},connect:function(redirect_url,authenticated_referral){if(FloatingSignUpForm){FloatingSignUpForm.cancel();}
if(FloatingLoginForm){FloatingLoginForm.hide();}
Social.Facebook.hideTooltip();Social.Facebook.hideTopBanner();if(Behaviors.isFacebookConnected()){_gaq.push(['_trackEvent','fbconnect','fbc','loginfbexisting']);Behaviors.reloadPage(true);return;}
if(!Social.Common.fbDefined())
return;if(Social.Facebook._is_connecting)
return;Social.Facebook._is_connecting_canvas_user=false;Behaviors.eraseCookie(Social.Facebook.CCPOP_COOKIE,Base.commonCookieDomain());Social.Facebook._is_connecting=true;if(authenticated_referral){var redirect_uri=document.URL;redirect_uri=redirect_uri.replace(/#.*/,"");redirect_uri=redirect_uri.replace(/\?code=.*?&/,"?");redirect_uri=redirect_uri.replace(/[?&]code=[^&]*/,"");new Ajax.Request("/social/facebook_authenticated",{method:'post',asynchronous:true,parameters:{from:"appcenter",redirect_uri:redirect_uri,code:document.URL.toQueryParams().code,_:new Date().getTime()}});}else{try{FB.login(function(response){if(response.authResponse){var url="/social/facebook_authenticated?fuid="+response.authResponse.userID+"&cb="+(new Date).getTime();if(typeof(redirect_url)!='undefined'){url+='&redirect_url='+redirect_url;}
new Ajax.Request(url,{method:'post',asynchronous:true});}else{Social.Facebook.closePopup("remind-me-later");}},{scope:"email,user_birthday,user_likes,publish_actions"});}catch(ex){Social.Facebook.closePopup("remind-me-later");}}},grantPublishStream:function(){FB.login(function(response){Behaviors.reloadCurrentPage(true);},{scope:"publish_stream"});},disconnect:function(el){var url="/social/disconnect/facebook";new Ajax.Request(url,{method:"post",onCreate:function(){el.up('div').down('.confirm-loading').show();},onComplete:function(){el.up('div').down('.confirm-loading').hide();window.location="/";}});},connectComplete:function(){Social.Facebook._is_connecting=false;Social.Facebook.closePopup('no-thanks');if(location.pathname.match(/^\/users\/find_account/)||location.pathname.match(/^\/signup/)||location.pathname.match(/^\/profile/)||location.pathname.match(/^\/account\/signin/)){window.location="/";}else{Behaviors.reloadCurrentPage(true);}},login:function(response){if(Social.Facebook._is_logging_in===true){return;}
Social.Facebook._is_logging_in=true;if(response.status=='connected'){FB.api({method:'fql_query',query:'SELECT email,user_birthday,user_likes FROM permissions WHERE uid = me()'},function(rows){if(rows[0].email=='1'&&rows[0].user_birthday=='1'&&rows[0].user_likes=='1'){var url="/social/facebook_login?fuid="+response.authResponse.userID+"&cb="+(new Date).getTime();new Ajax.Request(url,{asynchronous:true,method:'post',evalScripts:true,onComplete:function(){Social.Facebook._is_logging_in=false;}});}});}},getPublishStreamPermission:function(callback){if(!Behaviors.isFacebookConnected()){return callback(false);}
FB.api({method:'fql_query',query:'SELECT publish_stream FROM permissions WHERE uid = me()'},function(rows){var perm=false;try{perm=(rows[0]["publish_stream"]=='1');}catch(ex){}
callback(perm);});},loginCallback:function(response){return;},loggedInFromPopup:function(){if(Behaviors.isLoggedIn()){new Ajax.Request("/social/facebook_authenticated",{method:'post',asynchronous:true});}else{Social.Facebook.showIEWarning();}},showIEWarning:function(){var popup=Social.Facebook.popup();popup.hide();ModalPopup.warn("Sorry, we've run into an issue connecting your Hulu account to Facebook. Please click on the link below to sign-in to Hulu first, and then try connecting to Facebook again. <br/><br/><a class='utility-link', href='https://secure.hulu.com/account/signin?redirect_to="+encodeURIComponent(document.location.href)+"&fb_notify=1'>Sign into Hulu</a>");},logoutFromPopup:function(){Behaviors.logout(false);var popup=Social.Facebook.popup();popup.down('div.login-welcome').hide();popup.down('h2.title.plus').removeClassName('active').addClassName('inactive');popup.down('h2.title.classic').removeClassName('inactive').addClassName('active');popup.down('div.reason.plus').removeClassName('active').addClassName('inactive');popup.down('div.reason.classic').removeClassName('inactive').addClassName('active');popup.down('h2.active').down('span.username').update("");Behaviors.applyCufon();},logoutCallback:function(response){var func=function(nofb){Behaviors.eraseSecureFBCookie();Behaviors.eraseCookie("_fb_connected",Base.commonCookieDomain());Behaviors.logout(true,nofb);};if(Behaviors.isFacebookConnected()&&response){if(response.status!='connected'){func();}else if(response.authResponse&&response.authResponse.userID){new Ajax.Request("/users/connect_status?uid="+response.authResponse.userID+'&cb='+(new Date).getTime(),{method:"get",asynchronous:true,onSuccess:function(request){var result=request.responseText.evalJSON();if(response.authResponse.userID!=result.social_id){func(true);}}});}}},merge:function(options){if(!Behaviors.isLoggedIn()){Social.Facebook.showIEWarning();return;}
if(!options){options={};}
var path="/social/facebook_merge?";this.force=0;if(options.force!==undefined){this.force=1;path=path+"force=1&access_token="+options.oauth_token+"&fb_uid="+options.user_id;}
else{var session=FB.getAuthResponse();if(!session)return;path=path+"fuid="+session.userID+"&cb="+(new Date).getTime();}
new Ajax.Request(path,{method:'post',asynchronous:true,onSuccess:function(response){if(this.force===1){window.location='/facebook_canvas?from=connected';return;}}.bind(this)});},manageSettings:function(){new Ajax.Request("/social/manage_settings",{method:'post',asynchronous:true});},forceShowLogin:function(from){if(typeof from=='undefined'){from=''}
new Ajax.Request("/social/force_show_login",{method:'post',parameters:{'from':from},asynchronous:true});},onCreateNewError:function(error){var el=$('manage-settings');if(!el)return;el.down('div.actions').down('.confirm-loading').hide();el.down('span.error').update(error);el.down('span.error').show();},onSubmitSettings:function(from){var el=$('manage-settings');if(!el)return;if(el.down('div.actions').down('.confirm-loading').visible())
return;el.down('span.error').hide();var email=el.down('input.email').value;var password=el.down('input.password').value;var confirm_password=el.down('input.confirm_password').value;var birth_date='';var gender='';var message='';if(!Support.rfc822Email.test(email)){message="Please enter a valid email.";}
else if(password.strip().length==0){message="Please enter a password.";}
else if(password!=confirm_password){message='The passwords you entered do not match.';}
else{if(el.down('tr.birth_date').visible()){el.select('select').each(function(sel){if(sel.value.empty())
message="Please enter your birthdate";});}
if(message.empty()&&el.down('tr.gender').visible()){var checked=el.down('tr.gender').select('input').detect(function(rr){return rr.checked;});if(!checked){message="Please enter your gender.";}}
if(message.empty()){var month=el.down("select[name='date[month]']").value;var day=el.down("select[name='date[day]']").value;var year=el.down("select[name='date[year]']").value;birth_date=month+"/"+day+"/"+year;gender=el.down('tr.gender').select('input').detect(function(rr){return rr.checked;}).value;}}
if(!message.empty()){el.down('span.error').update(message);el.down('span.error').show();return false;}else{var privacy_radio_list=el.down('ul.privacy-radio-list');var privacy_level=2;if(privacy_radio_list){var privacy_level=parseInt(el.down('ul.privacy-radio-list').select('input').detect(function(r){return r.checked;}).value);}
var options={"email":email,"password":password,"confirm_password":confirm_password,"gender":gender,"birth_date":birth_date,"privacy_level":privacy_level};var session=FB.getAuthResponse();if(session)
options["fuid"]=session.userID;if(from=='connect_canvas'){options["action"]="connect_canvas";}
el.down('div.actions').down('.confirm-loading').show();Social.Facebook.submitSettings(options);}},popup:function(){if($(Social.Facebook.POPUP_ID))
return $(Social.Facebook.POPUP_ID);else
return null;},hidePopup:function(){var popup=Social.Facebook.popup();if(popup)popup.hide();},showPopup:function(forcePopup,forConfirmation){if(!Social.Common.fbDefined()){return;}
Social.Facebook.hideTooltip();if(forcePopup!==true){if(!(location.pathname.match(/^\/(tv|movies)*$/i)||location.pathname.match(/^\/watch\/[0-9]+/i)||Behaviors.in_show_page)||!Behaviors.isFlashEnabled()||Behaviors.fbNotifyShown()){return;}}
$$('div.flf.popup').each(Element.hide);if(!Prototype.Browser.IE){$$('.overlay-full')[0].show();if(forConfirmation){$$('.overlay-full')[0].observe('click',function(){Social.Facebook.connectComplete();});}
else{$$('.overlay-full')[0].observe('click',function(){Social.Facebook.closePopup('remind-me-later');});}}
if(forcePopup||!Behaviors.isLoggedIn()){this.renderPopup();}else{if(Behaviors.isFacebookConnected())return;this.updatePopup();this.renderPopup();}
if(location.pathname.match(/^\/watch\/[0-9]+/)){var player=$("player");if(player){try{if(typeof(player.pauseVideo)!='undefined'){player.pauseVideo();}
player.style.visibility="hidden";}catch(e){}}}
else if(Prototype.Browser.IE){var popup=this.popup();this.showIframe(popup);}
return;},renderPopup:function(){var popup=this.popup();if(popup==null)return;this.updatePopupPosition(popup);popup.show();},updatePopupPosition:function(el){if(el==null)return false;var popup=el;var offset=document.viewport.getScrollOffsets();var popupLeft=(document.viewport.getWidth()-popup.getWidth())/2;var popupTop=offset.top+(document.viewport.getHeight()-popup.getHeight())/2;popup.style.left=popupLeft+'px';popup.style.top=popupTop+'px';if(Prototype.Browser.IE){this.showIframe(popup);}},trackPopup:function(newPopupName){var eventType=Social.Facebook.lastShowPopupName+'---'+newPopupName;Beacon.trackSocialInteraction(null,eventType,'fb_connect_flow');Social.Facebook.lastShowPopupName=newPopupName;if(newPopupName=="confirmation"){try{SignUpTracking.leave_type="fb_success";}
catch(e){}}},onFBinit:function(){if(!Social.Common.fbDefined()){return;}
if(Behaviors.isLoggedIn()&&Behaviors.isFacebookConnected()){return;}
if(window.location.pathname.match(/^\/users\/find_account/)){return;}
FB.getLoginStatus(function(response){if(response&&response.status=='connected'){if(/fb_source=appcenter/.test(window.location.search)){if(!Behaviors.isFacebookConnected()){Social.Facebook.connect(undefined,response.authResponse);}}else{Social.Facebook.login(response);}}});},connectCanvasUser:function(){if(Behaviors.isFacebookConnected())return;if(Behaviors.getCookie(Social.Facebook.CCPOP_COOKIE)=="1")return;document.cookie=Social.Facebook.CCPOP_COOKIE+"=1; path=/; domain="+Base.commonCookieDomain();if(Social.Facebook._is_connecting_canvas_user===true)return;Social.Facebook._is_connecting_canvas_user=true;var url="/social/connect_canvas_user?cb="+(new Date).getTime();new Ajax.Request(url,{method:"post",asynchronous:true,evalScripts:true});},checkCanvasUser:function(){if(Behaviors.isFacebookConnected()||!Behaviors.isLoggedIn())return;var func=function(){Behaviors.setLoggedOut(false,true);Social.Facebook.connectCanvasUser();};FB.getLoginStatus(function(response){var canvas_status=Behaviors.getCookie("_canvas_status");if(Behaviors.isCanvasOnly(canvas_status)){func();}
else if(typeof(canvas_status)=='undefined'){new Ajax.Request("/users/connect_status?uid="+Behaviors.getUserId()+'&cb='+(new Date).getTime(),{method:"get",asynchronous:true,onSuccess:function(request){var result=request.responseText.evalJSON();if(Behaviors.isCanvasOnly(result.canvas_status))func();}});}});},mergeCanvasUser:function(){if(!Behaviors.isLoggedIn())return;var url="/social/merge_canvas_user?uid="+Behaviors.getUserId()+'&cb='+(new Date).getTime();new Ajax.Request(url,{method:"post",asynchronous:true});},confirmMergeStartWatching:function(){if(location.pathname.match(/^\/users\/find_account/)||location.pathname.match(/^\/signup/)||location.pathname.match(/^\/profile/)||location.pathname.match(/^\/account\/signin/)){window.location="/";}else{Behaviors.reloadCurrentPage(true);}},updatePopup:function(avatar){var popup=Social.Facebook.popup();var span=popup.down('span.username');if(!popup||!span)
return;if(Behaviors.isPlusUser()){popup.down('h2.title.classic').removeClassName('active').addClassName('inactive');popup.down('h2.title.plus').removeClassName('inactive').addClassName('active');popup.down('div.reason.classic').removeClassName('active').addClassName('inactive');popup.down('div.reason.plus').removeClassName('inactive').addClassName('active');}
var uname=Behaviors.getUsername();uname=uname.substring(0,20).gsub(/\+/,' ');if(/[^\u0000-\u00ff]/.test(uname)===false){popup.down('h2.active').down('span.username').update(uname+", ");Behaviors.applyCufon();}
popup.down('span.not-me-name').update("(Not "+uname+"?");popup.down('a.not-me').update(" Click here");popup.down('div.login-welcome').show();},showIframe:function(popup){var iframe_id=Social.Facebook.FB_IFRAME_IEFIX_ID;if($(Social.Facebook.POPUP_ID)){$$('.fb_corner, .fb_border_top, .fb_border_right, .fb_border_bottom, .fb_border_left').each(function(el){el.hide();});$(Social.Facebook.POPUP_ID).setStyle({border:'1px solid #aaa'});}
if(!$(iframe_id)){new Insertion.Bottom(document.body,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:1000;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');}
var xy=Position.cumulativeOffset(popup);var left=xy[0]+"px";var top=xy[1]+"px";var height=popup.getDimensions().height+'px';var width=popup.getDimensions().width+'px';$(iframe_id).setStyle({left:left,top:top,height:height,width:width});popup.setStyle({zIndex:3000});$(iframe_id).show();},hideIframe:function(popup){var iframe_id=Social.Facebook.FB_IFRAME_IEFIX_ID;if($(iframe_id)){$(iframe_id).hide();}
popup.setStyle({zIndex:'auto'});},showBannerOrTooltip:function(){if(!Behaviors.isFacebookConnected()&&!Behaviors.getFBBanner()){Social.Facebook.hideTopBanner();Social.Facebook.showTooltip();}
else if(!Behaviors.isFacebookConnected()&&Behaviors.getFBBanner()==1){Social.Facebook.hideTooltip();Social.Facebook.showTopBanner();}
else{Social.Facebook.hideTopBanner();Social.Facebook.hideTooltip();}},showTooltip:function(){var popup=this.popup();if(popup&&popup.visible())return;var tooltip=$$('.fbtt').first();if(tooltip){facepile=$$("div.fbtt-facepile").first();if(facepile){if(location.pathname.match(/^\/watch\/[0-9]+/)){facepile.hide();}else{facepile.setStyle({paddingTop:'40px'})
facepile.show();}}
var top=40;var right=1300;var width=tooltip.getWidth();var e1=$('logged-out-nav');var e2=$('logged-in-nav');var first_li=null;if(e1&&e1.cumulativeOffset()[0]>0&&e1.cumulativeOffset()[1]>0){var right=e1.cumulativeOffset()[0]+e1.getWidth();var top=e1.cumulativeOffset()[1]+e1.getHeight();var first_li=e1.down('li.first');}
else if(e2&&e2.cumulativeOffset()[0]>0&&e2.cumulativeOffset()[1]>0){var right=e2.cumulativeOffset()[0]+e2.getWidth();;var top=e2.cumulativeOffset()[1]+e2.getHeight();;var first_li=e2.down('li.first');}
var left=right-width;tooltip.style.left=left+'px';tooltip.style.top=top+'px';tooltip.setStyle({zIndex:2001,maxHeight:'270px'});setTimeout(function(){;if(facepile&&facepile.getHeight()>50&&!location.pathname.match(/^\/watch\/[0-9]+/)){facepile.setStyle({paddingTop:'0px'});tooltip.setStyle({maxHeight:'340px'});};},2000);tooltip.show();var iframe_id="fbtt_iframe";if(!$(iframe_id)){new Insertion.Bottom(document.body,'<iframe id="'+iframe_id+'" '+'style="display:none;position:absolute;z-index:100;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');}
var xy=Position.cumulativeOffset(tooltip);var left=xy[0];var top=xy[1];var height=tooltip.getDimensions().height;var width=tooltip.getDimensions().width;$(iframe_id).setStyle({left:left+"px",top:top+"px",height:height+"px",width:width+"px"});$(iframe_id).show();var pointer=$('fbtt-tooltip-pointer');if(pointer&&first_li){var ptop=top-9;var pleft=first_li.cumulativeOffset()[0]+first_li.getWidth()/2;pointer.setStyle({left:pleft+'px',top:ptop+'px',zIndex:2002});pointer.show();};tooltip.show();}},hideTooltip:function(permanent){if(permanent){Behaviors.setCookie(Social.Facebook.BANNER_COOKIE,1,365,Base.commonCookieDomain());}
var pointer=$('fbtt-tooltip-pointer');if(pointer){pointer.setStyle({zIndex:-15});pointer.hide();};var tooltip=$$('.fbtt').first();if(tooltip){tooltip.setStyle({zIndex:-20});tooltip.hide();}
var iframe_id="fbtt_iframe";var iframe=$(iframe_id);if($(iframe_id)){$(iframe_id).setStyle({left:'0px',top:'0px',height:'0px',width:'0px',zIndex:-10});iframe.hide();}},showTopBanner:function(slide_down){var banner=$('fb-connect-top-banner');if(banner&&!Social.Facebook._is_banner_visible){if(slide_down){Effect.SlideDown('fb-connect-top-banner');}else{banner.show();}
Social.Facebook._is_banner_visible=true;}},hideTopBanner:function(permanent){if(permanent){Behaviors.setCookie(Social.Facebook.BANNER_COOKIE,2,365,Base.commonCookieDomain());}
var banner=$('fb-connect-top-banner');if(banner){$('fb-connect-top-banner').hide();Social.Facebook._is_banner_visible=false;}},showPageRoadBlock:function(){var blocker=$$('.fbrb').first();var fb_friend_count=0;var player=$("player");if(player){try{player.pauseEverything();}catch(ex){};}
var _cleanup_facepile=function(){var facepile=$$("div.fbrb-facepile").first();if(facepile){if(facepile.getHeight()>=80){facepile.hide();}else{facepile.show();}}};var _show=function(){var vpi=getViewportInfo();var ww=vpi.width;var wh=vpi.height;var fw=blocker.getWidth();var fh=blocker.getHeight();blocker.style.top=String(Math.max((wh-fh)/2,0))+"px";blocker.style.left=String(Math.max((ww-fw)/2,0))+"px";Social.Facebook.showBackground();if(Prototype.Browser.WebKit)Social.TopNavControl.hide();blocker.show();Social.Facebook._roadblock_is_visible=true;Social.Facebook.showIframe(blocker);Event.observe(document,'mousedown',Social.Facebook._onRoadBlockDismiss);};if(blocker){var el_friend_count=blocker.down('a#fbrb-friend-count');if(el_friend_count){new Ajax.Request('/friends/count_by_source',{method:'get',parameters:{'source':'facebook'},onSuccess:function(request){var results=request.responseText.evalJSON();fb_friend_count=results.count;},onComplete:function(request){if(fb_friend_count==1){el_friend_count.update('There is '+fb_friend_count+' of them right now');}else{el_friend_count.update('There are '+fb_friend_count+' of them right now');}
_show();}});}else{_show();}
_gaq.push(['_trackEvent','fbconnect','modalroadblock','prompt']);}},hidePageRoadBlock:function(){Social.Facebook.hideBackground();var blocker=$$('.fbrb').first();if(blocker){blocker.hide();setTimeout(function(){Social.Facebook._roadblock_is_visible=false;},500);}
Social.Facebook.hideIframe(blocker);Event.stopObserving(document,'mousedown',Social.Facebook._onRoadBlockDismiss);},_onRoadBlockDismiss:function(event){Social.Facebook._is_dismissing_roadblock=true;var rb=$$('.fbrb').first();var el=event.findElement();if(el==rb||el.ancestors().indexOf(rb)>=0)return;Social.Facebook.updateSocialSetting(false,true,'page_roadblock');Social.Facebook.hidePageRoadBlock();Social.Facebook._is_dismissing_roadblock=false;_gaq.push(['_trackEvent','fbconnect','modalroadblock','sharexdismiss']);},updateSocialSetting:function(is_social,dismissed_page_roadblock,device){if(!Behaviors.isFacebookConnected()){if(is_social){_gaq.push(['_trackEvent','socialshare','socialcontrollerloggedout','shareontry']);}
return;}
Social.TopNavControl.hide_item_hover_tooltip();if(!is_social){if(Behaviors.isSocialOff()&&device!='page_roadblock')return;var player=$("player");if(player){try{player.socialOff();}catch(ex){};}}else{if(Behaviors.isSocialOn())return;if(!Behaviors.hasAgreedSocial()&&device!='page_roadblock'){Social.Facebook.showPageRoadBlock();return;}}
params={"is_social":is_social?'true':'false',"dismissed_page_roadblock":dismissed_page_roadblock?'true':'false',"device":device};new Ajax.Request('/social/update_is_social',{method:'post',parameters:params,onSuccess:function(){Social.TopNavControl.refresh(true);Social.Common.privacySettingsToggle(Behaviors.isSocialOn());}});if(device=="social_controller"){_gaq.push(['_trackEvent','socialshare','socialcontroller',is_social?'shareon':'shareoff']);}else if(device=="privacy_settings"){_gaq.push(['_trackEvent','socialshare','privacy',is_social?'shareon':'shareoff']);}
return;},showBackground:function(){var canvas=$('social-lightbox');if(!canvas)return;var w="1600px";var h=1200;var body=$$('body');if(body.length>0){w=body[0].getWidth();h=body[0].getHeight();}
canvas.setStyle({backgroundColor:'#000000',width:"100%",height:String(h)+"px",opacity:0.6,filter:"alpha(opacity=60)",position:"absolute",zIndex:999,top:0,left:0});if(Prototype.Browser.IE){var masthead=$("masthead");if(masthead){masthead.style.visibility="hidden";}}},hideBackground:function(){var canvas=$('social-lightbox');if(!canvas)return;canvas.setStyle({backgroundColor:'#000000',width:"0px",height:"0px",opacity:1,filter:"alpha(opacity=100)",position:"absolute",zIndex:-10});if(Prototype.Browser.IE){var masthead=$("masthead");if(masthead){masthead.style.visibility="visible";}}}});Event.observe(window,'resize',function(e){Social.TopNavControl.hide();clearTimeout(Social.Facebook.timerId);$$('.popup').each(function(e){if(e==null||!e.visible())return;else
{Social.Facebook.timerId=setTimeout(function(){Social.Facebook.updatePopupPosition(e);},100);}});});document.observe('dom:loaded',function(){Social.Common.populateAll();Social.TopNavControl.refresh();});document.observe("fb:init",Social.Facebook.checkCanvasUser);document.observe("hulu:loggedOut",Social.Common.hideAll);
var FacebookCanvas={contentId:-1,currentVideoId:-1,updateHeight:function(forceDelay){try{if(Social.Common.fbDefined()&&FB.Canvas!=null){if(forceDelay){setTimeout("FacebookCanvas.updateHeight()",300);}
else{FB.Canvas.setSize({height:Math.max(600,($$('body')[0].getHeight()+15))});}}}
catch(e){}},initPlayer:function(){var values=parseClipVariables();NewSite.videoPlayerComponent.playVideo(this.contentId,values[0],values[1]);FacebookCanvas.updateHeight();},like:function(el,like,url){var method=like?'post':'delete'
if(Social.Common.fbDefined()&&FB.api!=null){FB.api('/me/likes',method,{url:url},function(response){if(!response||response.error){}
else{}});if(like){$(el).update($(el).innerHTML.replace('Like','Unlike'));}
else{$(el).update($(el).innerHTML.replace('Unlike','Like'));}
Beacon.trackSocialInteraction(el,like?'like':'unlike');}},checkLikeStatus:function(){if(Social.Common.fbDefined()&&FB.api!=null){FB.api({method:'fql_query',query:'SELECT page_id, page_url FROM page WHERE page_id IN (SELECT page_id FROM page_fan WHERE uid = me())'},function(rows){elements={};$$('.fb_like_link').each(function(el){var like_url=el.readAttribute('like_url');if(like_url.indexOf('?')!=-1){like_url=like_url.substring(0,like_url.indexOf('?'));}
if(elements[like_url]){elements[like_url].push(el);}
else{elements[like_url]=[el];}});for(var x=0;x<rows.length;x++){var page_url=rows[x].page_url;if(page_url.indexOf('?')!=-1){page_url=page_url.substring(0,page_url.indexOf('?'));}
if(elements[page_url]!=null){elements[page_url].each(function(el){$(el).update($(el).innerHTML.replace('Like','Unlike'));});}}});}},showWatchPageData:function(video_id){if($('watch_page_social')){var url='/facebook_canvas/watch_page_data?video_id='+video_id+'&cb='+(new Date).getTime();if(location.toString().search(/ec=1/)!=-1){url+='&expand_comments=true';}
new Ajax.Request(url,{method:'get',onSuccess:function(request){$('watch_page_social').update(request.responseText);new Effect.Appear($('watch_page_data_container'),{duration:Social.Common.fadeDuration,afterFinish:function(){return;new Effect.BlindDown($$('.comments_without_box').first(),{duration:2,afterFinish:function(){Cufon.replace('h2.cufonable',{fontFamily:'Futura'});FacebookCanvas.Comment.showTooltip();FacebookCanvas.updateHeight();}});}});}});}
if($('watch_page_facepile_container')){var url='/facebook_canvas/watch_page_facepile?video_id='+video_id+'&cb='+(new Date).getTime();new Ajax.Request(url,{method:'get',onSuccess:function(request){$('watch_page_facepile_container').update(request.responseText);new Effect.Appear($('watch_page_facepile'),{duration:Social.Common.fadeDuration,afterFinish:function(){FacebookCanvas.updateHeight();}});}});}},populateFriendsForVideos:function(){var video_ids=[];var elements={}
$$('.lazy_load_canvas_friends').each(function(el){var video_id=el.readAttribute('video_id');video_ids.push(video_id);el.removeClassName('lazy_load_canvas_friends');if(elements[video_id]==null){elements[video_id]=[]}
elements[video_id].push(el);});if(video_ids.length>0){var url='/facebook_canvas/friends_for_video?video_ids[]='+video_ids.join(',')+'&cb='+(new Date).getTime();new Ajax.Request(url,{method:'get',onSuccess:function(request){var results=request.responseText.evalJSON();for(var video_id in results){video_id=parseInt(video_id);for(var x=0;elements[video_id]!=null&&x<elements[video_id].length;x++){var el=elements[video_id][x];if(results.hasOwnProperty(video_id)&&el){var count=results[video_id];var div='<div><a class="fb_link info_hover" fb_hover_url="/social/friends_for_video/'+video_id+'" href="#" onclick="InfoHover.currentTarget = $(this); InfoHover.load(); return false;" style="font-weight: normal;">'+count+' friend'+(count>1?'s':'')+'</a><span class="watched_text"> watched this</span></div>';el.update(div);new Effect.Appear(el,{duration:Social.Common.fadeDuration,afterFinish:function(){InfoHover.observeLinks();}});}}}}});}},showNowPlaying:function(){$$('.cp-'+FacebookCanvas.currentVideoId).invoke("show");},checkConnectStatus:function(){if(!Behaviors.isLoggedIn()||Behaviors.isFacebookConnected())return;var canvas_status=Behaviors.getCookie("_canvas_status");if(Behaviors.isCanvasOnly(canvas_status)){FacebookCanvas.showMergeButton();}
else if(typeof(canvas_status)=='undefined'){new Ajax.Request("/users/connect_status?uid="+Behaviors.getUserId()+'&cb='+(new Date).getTime(),{method:"get",asynchronous:true,onSuccess:function(request){var result=request.responseText.evalJSON();if(Behaviors.isCanvasOnly(result.canvas_status)){FacebookCanvas.showMergeButton();}}});}},showMergeButton:function(){FB.getLoginStatus(function(resp){FB.api("me",function(response){var innerHTML='<span style="float: left; ">';if(response&&response.id){innerHTML+='<img border="0" class="avatar" height="20" src="'+
document.location.protocol+'//graph.facebook.com/'+response.id+'/picture" width="20" /></span>';}
innerHTML+='<span style="float: left; padding-top: 2px; padding-left: 5px;"> '+'<a href="/?src=facebook-canvas" class="fb_link" style="font-size: 12px;" target="_blank">Team up your Hulu and Facebook accounts</a> '+'</span> ';$('connect_fb_account_btn').innerHTML=innerHTML;$('connect_fb_account_btn').show()});});}};FacebookCanvas.VideoGrid={filterVideos:function(url,value,for_search,query){try{$('video-type-sort-loading').show();new Ajax.Updater('fb-watchnow-grid',url+"?video_type="+encodeURIComponent(value)+"&for_search="+for_search+"&query="+encodeURIComponent(query),{asynchronous:true,evalScripts:true,method:'get',onComplete:function(request){FacebookCanvas.updateHeight();}});}catch(e){};},completeLoadVideo:function(el){try{FacebookCanvas.updateHeight(true);FacebookCanvas.populateFriendsForVideos();Beacon.trackPageInfoLoad($(el));}catch(e){}}};FacebookCanvas.Comment={defaultCommentText:'Write a comment...',watchPageText:'What are you thinking?',noReviewText:'Be the first of your friends to comment on this video...',adPlayingText:'Share your thoughts when your video resumes.',commentMarkerText:'Your comment starts here.',commentGhostText:'',commentCharLimit:140,videoStartMarker:null,videoMarkerChanged:false,submitInProgress:false,watchPageFormDisabled:false,commentMarkerAdjustment:-4,videoName:'',videoLink:'',videoDescription:'',videoContentId:-1,videoEmbedId:"",commentCount:0,allCommentDivIds:[],displayedIndex:[0,3],getPlayer:function(){if($('player')!=null){return $('player');}
else{return $('NS_FLASH_videoPlayerComponent');}},clickTextArea:function(el,ev,showMomentComment,forResize){var isMainCommentTextArea=el.hasClassName('comments-watch-page');FacebookCanvas.Comment.hideTooltip();if(FacebookCanvas.Comment.isCommentDefaultText(el.value)){FacebookCanvas.Comment.commentGhostText=el.value;el.value="";$(el).removeClassName('dormant');$(el).addClassName('');if(forResize){$(el).observe('paste',function(e){FacebookCanvas.Comment.updateTextPreview();});}
else{$(el).observe('paste',function(e){FacebookCanvas.Comment.updateCharCount(el);});}
var comments_footer=$(el).up('.comment_form_container').down('.comments_footer');if(isMainCommentTextArea){comments_footer.setStyle('visibility: visible;');FacebookCanvas.Comment.toggleCommentPublishText(true);if(forResize){el.setStyle({paddingLeft:null});}
try{var player=FacebookCanvas.Comment.getPlayer();if(player!=null&&showMomentComment&&(player.showCommentMarker||player.getCurrentTime)){if(Behaviors.isInCanvasApp()){FacebookCanvas.Comment.updateVideoMarker(player.showCommentMarker(FacebookCanvas.Comment.commentMarkerText,FacebookCanvas.Comment.commentMarkerAdjustment));}
else{FacebookCanvas.Comment.updateVideoMarker(player.getCurrentTime()/1000);}
FacebookCanvas.Comment.videoMarkerChanged=false;}
if(forResize&&(player==null||!player.getCurrentTime)&&showMomentComment){FacebookCanvas.Comment.updateVideoMarker(0);FacebookCanvas.Comment.videoMarkerChanged=false;}}
catch(e){}}
new Effect.Appear($(el).up('.comment_form_container').down('.comment_reset_button'),{duration:Social.Common.fadeDuration});new Effect.Appear($(el).up('.comment_form_container').down('.spoiler-check-box'),{duration:Social.Common.fadeDuration});}
else if(ev.type=='blur'&&el.value==""&&!isMainCommentTextArea){FacebookCanvas.Comment.reset(el);}},updateVideoMarker:function(startTime,endTime){if($$('.comment_start_timestamp').length>0){startTime=Math.max(0,startTime);FacebookCanvas.Comment.videoStartMarker=startTime;$$('.comment_start_timestamp')[0].update(FacebookCanvas.Comment.friendlyTimeFormat(startTime));new Effect.Appear($$('.comment_start_timestamp')[0],{duration:Social.Common.fadeDuration});FacebookCanvas.Comment.videoMarkerChanged=true;}},friendlyTimeFormat:function(time){var hours=Math.floor(time/3600);var minutes=Math.floor((time-(hours*3600))/60);var seconds=Math.floor(time-((hours*3600)+(minutes*60)));minutes+='';seconds+='';while(minutes.length<2){minutes='0'+minutes;}
while(seconds.length<2){seconds='0'+seconds;}
var time=(hours>0?hours+':':'')+minutes+':'+seconds;return Behaviors.isInCanvasApp()?'('+time+')':time;},updateCharCount:function(obj){var currentLength=obj.value.length;var $parent=$(obj).up('form');var img=$parent.down('.comment_submit');$parent.down('.chars_remaining').update(FacebookCanvas.Comment.commentCharLimit-currentLength);$parent.down('.valid_comment').hide();$parent.down('.submit_error').hide();if(FacebookCanvas.Comment.commentCharLimit>=currentLength){$parent.down('.too_long').hide();$parent.down('.chars_remaining').removeClassName('error_color');FacebookCanvas.Comment.enableSubmitButton(img,currentLength>0);FacebookCanvas.Comment.toggleCommentPublishText(true);}
else{$parent.down('.too_long').show();$parent.down('.chars_remaining').addClassName('error_color');FacebookCanvas.Comment.enableSubmitButton(img,false);FacebookCanvas.Comment.toggleCommentPublishText(false);}},updateTextPreview:function(){var textarea=$('unregistered_comments_box')||$('big_comments_box');FacebookCanvas.Comment.updateCharCount(textarea);text=$('spoiler-check').value==1?"SPOILER ":""
text+="("+FacebookCanvas.Comment.friendlyTimeFormat(FacebookCanvas.Comment.videoStartMarker)+") ";function escape(text){return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&#39;").replace(/\"/g,"&quot;").replace(/\n/g,"<br>");}
$('comment-text-preivew').innerHTML=text+escape(textarea.value);},toggleCommentPublishText:function(show){if($$('.comment_publish_text').length>0){Behaviors.showSocialCommentPublishMessage(function(){if($$('.published_to_fb_text').length>0&&$$('.published_to_fb_text')[0].visible()){return;}
if(show){$$('.comment_publish_text')[0].show();}
else{$$('.comment_publish_text')[0].hide();}});}},reset:function(el){FacebookCanvas.Comment.videoMarkerChanged=false;if(el.TextAreaAutoGrowth!=null){el.TextAreaAutoGrowth.resize();}
el.value=FacebookCanvas.Comment.commentGhostText;$(el).removeClassName('comment_text');$(el).addClassName('dormant');$(el).stopObserving('paste');var player=FacebookCanvas.Comment.getPlayer();if(el.hasClassName('comments-watch-page')&&player!=null&&Behaviors.isInCanvasApp()){player.hideCommentMarker();}
if(el.hasClassName('comments-watch-page')){$(el).up('.comment_form_container').down('.comments_footer').setStyle('visibility: hidden;');}
var $parent=$(el).up('form');$parent.down('.comment_reset_button').hide();if($parent.down('.comment-container')){$parent.down('.comment-container').down('.spoiler-check-box').hide();el.setStyle({paddingLeft:"10px"});}
$parent.down('.chars_remaining').update(FacebookCanvas.Comment.commentCharLimit);$parent.down('.submit_error').hide();$parent.down('.too_long').hide();$parent.down('.valid_comment').hide();$parent.down('.chars_remaining').removeClassName('error_color');FacebookCanvas.Comment.enableSubmitButton($parent.down('.comment_submit'),false);if($parent.down('.comment_start_timestamp')){$parent.down('.comment_start_timestamp').hide();}
if($('comment-text-preivew')){$('comment-text-preivew').innerHTML="";}
if(FacebookCanvas.Comment.watchPageFormDisabled){FacebookCanvas.Comment.disableWatchPageCommentForm();}},valid:function(obj){var text=$(obj).value.strip();var currentLength=text.length;if(currentLength>FacebookCanvas.Comment.commentCharLimit||FacebookCanvas.Comment.isCommentDefaultText(text)||FacebookCanvas.Comment.submitInProgress){return false;}
else if(currentLength<=0){FacebookCanvas.Comment.toggleCommentPublishText(false);$(obj).up('form').down('.too_long').hide();$(obj).up('form').down('.submit_error').hide();$(obj).up('form').down('.valid_comment').show();return false;}
var player=FacebookCanvas.Comment.getPlayer();if($(obj).hasClassName('comments-watch-page')&&player!=null&&Behaviors.isInCanvasApp()){player.hideCommentMarker();}
return true;},isCommentDefaultText:function(text){return text==FacebookCanvas.Comment.defaultCommentText||text==FacebookCanvas.Comment.watchPageText||text==FacebookCanvas.Comment.noReviewText||text==FacebookCanvas.Comment.adPlayingText;},updateWatchCommentsBorder:function(update){if(update){var comments=$$('.watch_comments .comments_without_box .comments').findAll(function(el){return el.visible()&&el.up().visible();});for(var x=0;x<comments.length;x++){if(x==comments.length-1){comments[x].setStyle('border-bottom: none');}
else{comments[x].setStyle('border-bottom: 1px solid #DCDCDC;');}}}
else{setTimeout("FacebookCanvas.Comment.updateWatchCommentsBorder(true)",500);}
return false;},remove:function(el_id,id,confirmed){var el=$('comment_'+el_id);if(!confirmed){FloatingDiv.show(el,$('confirm-comment-remove_'+el_id),350);}
else{FloatingDiv.hide();new Ajax.Request('/facebook_canvas/delete_comment',{parameters:{comment_id:id},method:'post',onSuccess:function(trans){var comments_container=el.up('.comments_container');var replies=$$('.reply_for_'+id);var totalCommentsRemoved=replies.length+1;if(el.hasClassName('reply'))el=el.up();el.remove();replies.invoke('remove');if(comments_container&&comments_container.select('.actual_comment').length==0){comments_container.hide();}
FacebookCanvas.Comment.commentCount-=totalCommentsRemoved;$('total-comments').innerHTML=FacebookCanvas.Comment.commentCount.toString()+" Comment"+(FacebookCanvas.Comment.commentCount==1?"":"s");if(FacebookCanvas.Comment.commentCount==0){$('total-comments').hide();}
var new_ids=[];var old_ids=FacebookCanvas.Comment.allCommentDivIds;for(var i=0;i<old_ids.length;++i){if($(old_ids[i])){new_ids.push(old_ids[i])}}
FacebookCanvas.Comment.allCommentDivIds=new_ids;FacebookCanvas.Comment.displayComments();try{if($$('.see_all_comments_link').length>0){var see_all_link=$$('.see_all_comments_link').first()
totalCount=parseInt(see_all_link.innerHTML.match(/[0-9]+/));if(totalCount-totalCommentsRemoved<=0){see_all_link.hide();if($$('.collapse_all_comments_link').length>0){$$('.collapse_all_comments_link').first().hide();}}
else{var content=see_all_link.innerHTML.replace(/[0-9]+/,totalCount-totalCommentsRemoved);see_all_link.update(content);}}}
catch(e){}},onFailure:function(trans){}});}},expandWatchPageComments:function(){try{new Effect.BlindDown('additional_watch_comments',{duration:Social.Common.fadeDuration,afterFinish:function(){FacebookCanvas.updateHeight(true);}});$('watch_view_comments_link').hide();$('watch_collapse_comments_link').show();if($$('.first_reply').length>0){$$('.first_reply')[0].removeClassName('show_border');}
if($$('.break_point').length>0){$$('.break_point')[0].addClassName('middle');}}
catch(e){}
return false;},collapseWatchPageComments:function(){try{new Effect.BlindUp('additional_watch_comments',{duration:Social.Common.fadeDuration});$('watch_collapse_comments_link').hide();$('watch_view_comments_link').show();FacebookCanvas.updateHeight(true);if($('player-container')){Effect.ScrollTo('player-container');}
else if($('videoPlayerComponent')){Effect.ScrollTo('videoPlayerComponent');}
if($$('.first_reply').length>0){$$('.first_reply')[0].addClassName('show_border');}
if($$('.break_point').length>0){$$('.break_point')[0].removeClassName('middle');}}
catch(e){}
return false;},toggleCommentForm:function(el,for_resize){var parent=$(el).up('.actual_comment');if(parent==null){parent=$(el).up('.feed_item_with_comments');}
var comment_div=parent.down('.comment_form_container');var wrapper=parent.down('.comment_form_wrapper');var comments_container=parent.down('.comments_container');if(comment_div.visible()&&(wrapper==null||(wrapper!=null&&wrapper.visible()))){comment_div.hide();if(wrapper){wrapper.hide();}
if(comments_container&&(comments_container.down('.with_children')==null||comments_container.select('.actual_comment').length==0)){comments_container.hide();}
el.update(for_resize?'reply':'Comment');FacebookCanvas.Comment.reset(parent.down('textarea'));}
else{if(wrapper){wrapper.show();}
if(comments_container){comments_container.show();}
comment_div.show();el.update(for_resize?'cancel':'Close');}
FacebookCanvas.updateHeight();},enableSubmitButton:function(img,enabled){if(enabled){if(img.src.match(/-disabled/i)){img.src=img.src.replace(/(-disabled)/g,'');}}
else{if(!img.src.match(/-disabled/i)){var extension=HOVER_EXTENSION_RX.exec(img.src);extension=extension&&extension.length>=1?extension[1]:false;img.src=img.src.replace(/(-hover)/g,'').replace(HOVER_EXTENSION_RX,'-disabled'+extension);}}},beforeCommentSubmit:function(el,start_at_id,sendBeacon){if(!FacebookCanvas.Comment.valid(el)){return false;}
var $parent=$(el).up('.comment_form_container');FacebookCanvas.Comment.submitInProgress=true;FacebookCanvas.Comment.enableSubmitButton($parent.down('.comment_submit'),false);if($(start_at_id)){$(start_at_id).value=FacebookCanvas.Comment.videoStartMarker;}
$parent.down('.submit_error').hide();$parent.down('.comment_submit_spinner').show();if($parent.down('.comment_reset_button')){$parent.down('.comment_reset_button').hide();}
if(sendBeacon){var fbSelected=true;var twitterSelected=false;FacebookCanvas.Comment.trackCommentBeacon(fbSelected,twitterSelected,$(el).value);}},trackCommentBeacon:function(fbSelected,twitterSelected,text){var dragCount=0;var player_instance=$('player');if(typeof(NewSite)!="undefined"){if(NewSite.videoPlayerComponent&&NewSite.videoPlayerComponent.getInstance){player_instance=NewSite.videoPlayerComponent.getInstance();}}
if(player_instance&&player_instance.commentDragCount){dragCount=player_instance.commentDragCount();}
Beacon.trackComment(fbSelected,twitterSelected,text.length,FacebookCanvas.Comment.videoContentId,FacebookCanvas.Comment.videoStartMarker,dragCount);},commentSubmitFailure:function(el,dontShowError){var $parent=$(el).up('.comment_form_container');$parent.down('.comment_submit_spinner').hide();if($parent.down('.comment_reset_button')){$parent.down('.comment_reset_button').show();}
FacebookCanvas.Comment.submitInProgress=false;FacebookCanvas.Comment.enableSubmitButton($parent.down('.comment_submit'),true);FacebookCanvas.Comment.toggleCommentPublishText(false);if(dontShowError==null||(true!==dontShowError)){$parent.down('.submit_error').show();}},commentSubmitted:function(el){FacebookCanvas.Comment.fireVideoMarkerChanged();FacebookCanvas.Comment.resetCommentLink(el);FacebookCanvas.Comment.submitInProgress=false;FacebookCanvas.updateHeight(true);},resetCommentLink:function(el){var parent=$(el).up('.actual_comment');if(parent==null){parent=$(el).up('.feed_item_with_comments');}
if(parent){var comment_link=parent.down('.cancel_comment_link');if(comment_link){comment_link.update('Comment');}}},fireVideoMarkerChanged:function(){if(FacebookCanvas.Comment.videoMarkerChanged){Beacon.trackSocialInteraction(null,'video_comment_marker_seeked','watch_page_footer');}
FacebookCanvas.Comment.videoMarkerChanged=false;FacebookCanvas.Comment.videoStartMarker=null;},disableWatchPageCommentForm:function(){if($$('.comments-watch-page').length>0){var comment_box=$$('.comments-watch-page').first();if(FacebookCanvas.Comment.isCommentDefaultText(comment_box.value)){comment_box.disable();FacebookCanvas.Comment.commentGhostText=comment_box.value;comment_box.value=FacebookCanvas.Comment.adPlayingText;FacebookCanvas.Comment.enableSubmitButton(comment_box.up('form').down('.comment_submit'),false);}
FacebookCanvas.Comment.watchPageFormDisabled=true;}},enableWatchPageCommentForm:function(){if($$('.comments-watch-page').length>0){var comment_box=$$('.comments-watch-page').first();if(FacebookCanvas.Comment.isCommentDefaultText(comment_box.value)){comment_box.value=FacebookCanvas.Comment.commentGhostText;comment_box.enable();FacebookCanvas.Comment.watchPageFormDisabled=false;}}},showPublishedToFbNotification:function(force){if($$('.published_to_fb_text').length>0){var callback=function(){new Effect.Appear($$('.published_to_fb_text')[0],{duration:Social.Common.fadeDuration,afterFinish:function(){setTimeout(function(){new Effect.Fade($$('.published_to_fb_text')[0],{duration:Social.Common.fadeDuration,afterFinish:function(){if($$('.comment_publish_text').length>0){new Effect.Appear($$('.comment_publish_text')[0],{duration:Social.Common.fadeDuration});}}});},3000);}});};if(force){callback();}
else{Behaviors.showSocialCommentPublishMessage(callback);}}},publishFacebookFeed:function(feed,showNotification){if(Social.Common.fbDefined()){FB.api("/me/feed","post",feed,function(response){FacebookCanvas.Comment.clearUnregisteredComment();if(!response||response.error){}
else{if(showNotification){FacebookCanvas.Comment.showPublishedToFbNotification(true);}}});}},publishTweet:function(url,text){var tweetUrl='https://twitter.com/intent/tweet?hashtags=hulu&url='+escape(url)+'&text='+text;window.open(tweetUrl,'Post to twitter','width=600,height=450');FacebookCanvas.Comment.showPublishedToFbNotification(true);FacebookCanvas.Comment.clearUnregisteredComment();},clearUnregisteredComment:function(){$('unregistered_comments').down('.comment_submit_spinner').hide();FacebookCanvas.Comment.commentSubmitted('unregistered_comments_box');FacebookCanvas.Comment.reset($('unregistered_comments_box'));},submitUnregisteredComment:function(){$('unregistered_comments').down('.no_networks').hide();FacebookCanvas.Comment.beforeCommentSubmit('unregistered_comments_box',null,false);var fbSelected,twitterSelected=false;fbSelected=true;if(!twitterSelected&&!fbSelected){$('unregistered_comments').down('.no_networks').show();FacebookCanvas.Comment.commentSubmitFailure('unregistered_comments_box',true);return;}
var text=$('unregistered_comments_box').value.strip();var timestamp_text=$('unregistered_comments').down('span.comment_start_timestamp').innerHTML;if(FacebookCanvas.Comment.videoStartMarker>0){text=timestamp_text+" "+text;}
var url=FacebookCanvas.Comment.videoLink+'?c='+FacebookCanvas.Comment.videoStartMarker;var thumb='http://ib.huluim.com/thumb?size=145x80&s='+FacebookCanvas.Comment.videoStartMarker+'&id='+FacebookCanvas.Comment.videoContentId;if(FacebookCanvas.Comment.videoStartMarker<=10){thumb='http://ib.huluim.com/video/'+FacebookCanvas.Comment.videoContentId+'?size=145x80';}
if($$('.published_to_fb_text').length>0){var postText='Your comment &ndash; and this scene &ndash; was posted to';if(fbSelected){postText+=' Facebook';}
if(twitterSelected){if(fbSelected){postText+=' and';}
postText+=' Twitter';}
$$('.published_to_fb_text')[0].update(postText);}
if(fbSelected){var feed={name:FacebookCanvas.Comment.videoName,caption:"hulu.com",message:text,picture:thumb,description:FacebookCanvas.Comment.videoDescription,link:url};FB.getLoginStatus(function(resp){if(resp&&resp.status=='connected'){FB.api({method:'fql_query',query:'SELECT publish_stream FROM permissions WHERE uid = me()'},function(rows){if(rows[0].publish_stream=='1'){FacebookCanvas.Comment.publishFacebookFeed(feed,!twitterSelected);if(twitterSelected){FacebookCanvas.Comment.publishTweet(url,text);}}else{FB.login(function(resp2){FacebookCanvas.Comment.publishFacebookFeed(feed,!twitterSelected);if(twitterSelected){FacebookCanvas.Comment.publishTweet(url,text);}},{scope:"publish_stream"});}});}
else{FB.login(function(resp3){FacebookCanvas.Comment.publishFacebookFeed(feed,!twitterSelected);if(twitterSelected){FacebookCanvas.Comment.publishTweet(url,text);}},{scope:"publish_stream"});}});}
FacebookCanvas.Comment.trackCommentBeacon(fbSelected,twitterSelected,text);return false;},showTooltip:function(){if(Behaviors.getFlashCookie('comment_tooltip_shown')==null){new Effect.Appear("watch_comment_tooltip",{duration:Social.Common.fadeDuration});Behaviors.setFlashCookie('comment_tooltip_shown',true);}},hideTooltip:function(){if($("watch_comment_tooltip")){$("watch_comment_tooltip").hide();}},toggleSpolierState:function(el,for_small){if(el.value==0){el.value=1;el.src="/images/watch/spoiler-icon.png?1";}
else{el.value=0;el.src="/images/watch/non-spoiler-icon.png?1";}
if(!for_small){FacebookCanvas.Comment.updateTextPreview();}},displayComments:function(start,end){start=start==undefined?FacebookCanvas.Comment.displayedIndex[0]:start;end=end==undefined?FacebookCanvas.Comment.displayedIndex[1]:end;for(var i=0;i<FacebookCanvas.Comment.allCommentDivIds.length;++i){var el=$(FacebookCanvas.Comment.allCommentDivIds[i]);if(!el)continue;if(start<=i&&i<end){el.show();}
else{el.hide();}}
if($('watch_last_comments_link')){if(start>0){$('watch_last_comments_link').show();}else{$('watch_last_comments_link').hide();}}
if($('watch_collapse_comments_link')){if(end>=FacebookCanvas.Comment.allCommentDivIds.length&&end>=FacebookCanvas.Comment.commentCount){$('watch_collapse_comments_link').hide();}
else{$('watch_collapse_comments_link').show();}}
FacebookCanvas.Comment.displayedIndex=[start,end];},showMoreComments:function(){var start=FacebookCanvas.Comment.displayedIndex[1];var end=start+3;FacebookCanvas.Comment.displayComments(start,end);},showLastComments:function(){var start=Math.max(FacebookCanvas.Comment.displayedIndex[0]-3,0);var end=start+3;FacebookCanvas.Comment.displayComments(start,end);},displayCommentsAfterInsert:function(new_ids){var start=FacebookCanvas.Comment.displayedIndex[0];var end=FacebookCanvas.Comment.displayedIndex[1];var old_ids=FacebookCanvas.Comment.allCommentDivIds;FacebookCanvas.Comment.allCommentDivIds=new_ids;for(var i=0;i<old_ids.length;++i){if($(old_ids[i])){$(old_ids[i]).hide();}}
for(var i=0;i<old_ids.length;++i){if(old_ids[i]!=new_ids[i]){break;}}
if(i>=end){++start;++end;}
FacebookCanvas.Comment.displayComments(start,end);}};FacebookCanvas.Header={setSelectedTab:function(el,url){try{$('fb-canvas-nav-loading').show();window.location=url;}catch(e){};}};FacebookCanvas.Feed={requestInProgress:false,lastRequest:new Date().getTime(),MIN_REQUEST_TIME:1000,initScroll:function(){FacebookCanvas.Feed.requestInProgress=false;},updateScroll:function(){var load_el=$('feed_expand_link');if(!Social.Common.fbDefined()||FB.Canvas==null||FacebookCanvas.Feed.requestInProgress||load_el==null||new Date().getTime()-FacebookCanvas.Feed.lastRequest<FacebookCanvas.Feed.MIN_REQUEST_TIME){return;}
FacebookCanvas.Feed.requestInProgress=true;var pageInfo=FB.Canvas.getPageInfo();var top=parseInt(pageInfo.clientHeight)+parseInt(pageInfo.scrollTop)+parseInt(pageInfo.offsetTop);var offset=load_el.cumulativeOffset().top;if(top>=offset-50){load_el.simulate('click');FacebookCanvas.Feed.lastRequest=new Date().getTime();}else{FacebookCanvas.Feed.requestInProgress=false;}},mouseOver:function(el){el.style.overflow='auto';if(typeof(el._originalScrollTop)!='undefined'){if(!Prototype.Browser.IE&&!Prototype.Browser.Gecko){el.scrollTop=0;}
el.scrollTop=el._originalScrollTop;}},mouseOut:function(el){el._originalScrollTop=el.scrollTop;el.style.overflow='hidden';}};document.observe("player:loaded",function(){if($$('.comments-watch-page').length>0){$$('.comments-watch-page').first().enable();}});
var Favorites=Class.create();Favorites.Picker=Class.create();Object.extend(Favorites.Picker,{recommendedClicked:function(){$('browse-grid').show();$('search-grid').hide();if($('recommended_shows'))
$('recommended_shows').show();$('popular_shows').hide();Favorites.Picker.selectRecommendedNavImage(true);Favorites.Picker.selectMostPopularNavImage(false);Favorites.Picker.selectSearchNavImage(false);},popularClicked:function(){$('browse-grid').show();$('search-grid').hide();if($('recommended_shows'))
$('recommended_shows').hide();$('popular_shows').show();Favorites.Picker.selectRecommendedNavImage(false);Favorites.Picker.selectMostPopularNavImage(true);Favorites.Picker.selectSearchNavImage(false);},searchResultsClicked:function(){$('browse-grid').hide();$('search-grid').show();Favorites.Picker.selectRecommendedNavImage(false);Favorites.Picker.selectMostPopularNavImage(false);Favorites.Picker.selectSearchNavImage(true);},selectRecommendedNavImage:function(select){if(!$('fav_recommended_nav'))return;if(select){$('fav_recommended_nav').src=Base.imageURL('/images/tab-favorites-recommended-selected.gif');}
else{$('fav_recommended_nav').src=Base.imageURL('/images/tab-favorites-recommended.gif');}
return false;},selectMostPopularNavImage:function(select){if(!$('fav_most_pop_nav'))return;if(select){$('fav_most_pop_nav').src=Base.imageURL('/images/tab-favorites-most-pop-selected.gif');}
else{$('fav_most_pop_nav').src=Base.imageURL('/images/tab-favorites-most-pop.gif');}
return false;},selectSearchNavImage:function(select){if(!$('fav_search_nav'))return;if(select){$('fav_search_nav').src=Base.imageURL('/images/tab-favorites-search-results-selected.gif');}
else if(!$('fav_search_nav').src.match(/-disabled/i)){$('fav_search_nav').src=Base.imageURL('/images/tab-favorites-search-results.gif');}
return false;},showAdded:function(show_id){$$('span.add_show_link[show_id="'+show_id+'"]').each(function(elem){if(elem.visible()){elem.hide();elem.insert({after:"<div class='added' show_id='"+show_id+"'><span style='float: left; color: #999;'>Show Added</span><span style='padding-left: 5px; float: left;'><img src='"+Base.imageURL("/images/icon-check.gif")+"'></span></div>"});}});},showRemoved:function(show_id){$$('a.add_show_link[show_id="'+show_id+'"]').each(function(elem){if(elem.visible()==false){elem.show();elem.next().remove();}});}});Object.extend(Favorites,{FAVORITE_NAV_ID:"snv-favorites",_ranked_show_ids:[],_order_dirty:false,_nav_current_page:0,_nav_prev_page:-1,_nav_max_page:0,_nav_page_limit:7,for_picker:false,loadNav:function(force){try{var first_snv=$$('ul.snv').first();var favorite_snv=$(Favorites.FAVORITE_NAV_ID);var left=Element.cumulativeOffset(first_snv).left-Element.cumulativeOffset(favorite_snv).left;favorite_snv.down('div.fullwidth').style.left=left+"px";if(force==true)Favorites.eraseCookie();var el_initial=$(Favorites.FAVORITE_NAV_ID).down('.favorites-loading');var el_updated=$("updated-fav-nav");if(!el_initial&&!el_updated)return;var el=el_initial||el_updated;if(Behaviors.isLoggedIn()){var last_timestamp=Favorites.getCookie()||0;var current_timestamp=new Date().getTime();var url='/favorites/favorites_nav?user_id='+Behaviors.getUserId()+'&fb_cb=';if(!last_timestamp||(current_timestamp-parseInt(last_timestamp)>30*60*1000)){Favorites.setCookie();}
url+=Favorites.getCookie();new Ajax.Request(url,{method:'get',onSuccess:function(request){el.replace(request.responseText);}});}else{el.replace($('initial-fav-nav').innerHTML);}}catch(ex){};},setCookie:function(){Behaviors.setCookie("_fb_nav",new Date().getTime(),1);},getCookie:function(){return Behaviors.getCookie("_fb_nav");},eraseCookie:function(){Behaviors.eraseCookie("_fb_nav");},navToPage:function(pageNum){this._nav_prev_page=this._nav_current_page;this._nav_current_page=pageNum;this._navPageUpdate();},navSave:function(length,curPage){this._nav_current_page=curPage;this._nav_max_page=Math.floor((length-1)/this._nav_page_limit);},navPrev:function(){this._nav_prev_page=this._nav_current_page;this._nav_current_page-=1;this._navPageUpdate();},navNext:function(){this._nav_prev_page=this._nav_current_page;this._nav_current_page+=1;this._navPageUpdate();},_navPageUpdate:function(){if(this._nav_prev_page!=-1){$$('.fav-nav-bubble')[this._nav_prev_page].show();}
var items=$$('.fav-nav-show');for(var i=0;i<items.length;i++){if(Math.floor(i/this._nav_page_limit)==this._nav_current_page){items[i].show();items[i].setStyle({display:"inline-block"});}else{items[i].hide();}}
var solid=$('static-bubble').remove();$$('.fav-nav-bubble')[this._nav_current_page].insert({before:solid});$$('.fav-nav-bubble')[this._nav_current_page].hide();$('fav_nav_arrow_left_link').setStyle('visibility: visible');$('fav_nav_arrow_right_link').setStyle('visibility: visible');if(this._nav_current_page==this._nav_max_page){$('fav_nav_arrow_right_link').setStyle('visibility: hidden');}
else if(this._nav_current_page==0){$('fav_nav_arrow_left_link').setStyle('visibility: hidden');}},getLength:function(){return this._ranked_show_ids.length;},storeRanked:function(ranked_show_ids){this._ranked_show_ids=ranked_show_ids.slice(0);return true;},getRanked:function(){return this._ranked_show_ids.slice();},saveOrder:function(options,spinner_id,callback){if(this._ranked_show_ids.length==0){return;}
$(spinner_id).setStyle('visibility: visible;');var explicitPositions=[];if($$('table.vt tr.r input.position-input').length>0){$$('table.vt tr.r input.position-input').each(function(elem,index){explicitPositions.push(elem.readAttribute('show_id')+':'+elem.getValue());});}
else{this._ranked_show_ids.each(function(show_id,index){explicitPositions.push(show_id+':'+index);});}
var params={positions:explicitPositions.join(',')};if($$('.fav_submit_error')){$$('.fav_submit_error').invoke('hide');}
new Ajax.Request("/favorites/save_ranking",{method:'post',parameters:params,onSuccess:function(request){Favorites.eraseCookie();$(spinner_id).setStyle('visibility: hidden;');},onFailure:function(req){if($$('.fav_submit_error')){$$('.fav_submit_error').invoke('show');}}});},remove:function(show_id,spinner_id){var index=this._ranked_show_ids.indexOf(show_id);if(index==-1){return;}
$(spinner_id).show();$(spinner_id).setStyle('visibility: visible;');new Ajax.Request('/favorites/remove_from_list?id='+show_id,{method:'post',onSuccess:function(response){Favorites.loadNav(true);Favorites._ranked_show_ids.splice(index,1);if(_removed){_removed(index);}
Favorites.Picker.showRemoved(show_id);if(Favorites._ranked_show_ids.length==0&&$('save_fav_order_btn')!=null){$('save_fav_order_btn').src=$('save_fav_order_btn').src.replace('.gif','-disabled.gif');}
$(spinner_id).hide();}});},moveUp:function(show_id,spinner_id){var index=this._ranked_show_ids.indexOf(show_id);if(index==-1){return;}
var temp=Favorites._ranked_show_ids[index-1];Favorites._ranked_show_ids[index]=temp;Favorites._ranked_show_ids[index-1]=show_id;if(_movedUp){_movedUp(index);}
Favorites.saveOrder({},spinner_id);},moveDown:function(show_id,spinner_id){var index=this._ranked_show_ids.indexOf(show_id);if(index==-1){return;}
var temp=this._ranked_show_ids[index+1];this._ranked_show_ids[index]=temp;this._ranked_show_ids[index+1]=show_id;if(_movedDown){_movedDown(index);}
Favorites.saveOrder({},spinner_id);},reorder:function(old_position,new_position,spinner_id){var show_id=this._ranked_show_ids.splice(old_position,1)[0];this._ranked_show_ids.splice(new_position,0,show_id);if(_reordered){_reordered(old_position,new_position);}
Favorites.saveOrder({},spinner_id);},add:function(show_id){if(this._ranked_show_ids.indexOf(show_id)!=-1){return;}
this._ranked_show_ids.push(show_id);var url='/favorites/add?show_id='+show_id;if(this.for_picker==true){url+="&for_picker=true";}
new Ajax.Request(url,{method:'post',onSuccess:function(response){Favorites.loadNav(true);if($('save_fav_order_btn')!=null){$('save_fav_order_btn').src=$('save_fav_order_btn').src.replace('-disabled','');}
if(_added){_added(response.responseText);}
Favorites.Picker.showAdded(show_id);}});},updateQueueSetting:function(){var div_id=this.toString();var text_css='favorites_options';var title='';if($('ss-trailers-clips').visible()){if($('ss-trailers-only').hasClassName('pressed')){title="Only trailers will be added";}
else{title="Trailers and clips will be added";}}
else{if($('ss-episodes-first').hasClassName('pressed')){title="Only new episodes";if($('ss-clips').hasClassName('checked')){title+=" and clips";}
title+=" will be added";}
else if($('ss-episodes').hasClassName('checked')){title="All episodes";if($('ss-clips').hasClassName('checked')){title+=" and clips";}
title+=" will be added";}
else if($('ss-clips').hasClassName('checked')){title="All clips will be added";}
else{title="No videos will be added to your queue"
text_css='favorites_ghost_text'}}
html='<div id="'+div_id+'" class="'+text_css+'">'+title+'</div>';$(div_id).replace(html);},showFavoritesInfoPopup:function(){var favorite_nav=$('snv-favorites');var popup=$('favorites-info-popup');var hide_fav_info=Behaviors.getCookie('_hide_fav_info');if(favorite_nav&&popup&&hide_fav_info==null){Behaviors.setCookie('_hide_fav_info','1',365);var overlay=$('overlay-favorites-bottom');var positions=Element.cumulativeOffset(favorite_nav);var left=positions[0]-300+"px";var top=positions[1]+33+"px";popup.setStyle({top:top,left:left});if(overlay){overlay_top=positions[1]+favorite_nav.getHeight()+"px";overlay_height=document.viewport.getHeight()+"px";overlay.setStyle({top:overlay_top,height:overlay_height,opacity:"0.7",display:"block"});popup.show();}}},closeFavoritesInfoPopup:function(){$('favorites-info-popup').hide();$('overlay-favorites-bottom').hide();}});document.observe("dom:loaded",function(){if($(Favorites.FAVORITE_NAV_ID)){Event.observe($(Favorites.FAVORITE_NAV_ID).down("a.menu-top").down('div'),"mouseover",Favorites.loadNav);}});
var Tracking=Class.create();Object.extend(Tracking,{retries:0,track_ga_event:function(category,action,label,custom){try{if(!_gaq)return false;}catch(ex){return false;}
custom=custom||[];for(var i=0;i<custom.length;i++){if(i<4){_gaq.push(['_setCustomVar',i+1,custom[i][0],custom[i][1],custom[i][2]||3]);}}
_gaq.push(['_trackEvent',category,action,label]);for(var i=0;i<custom.length;i++){_gaq.push(['_deleteCustomVar',i+1]);}
return true;},set_visitor_var:function(val){if(typeof(_gaq)=='undefined'||!_gaq)return;_gaq.push(['_setCustomVar',5,'VisitorClient',val,1]);},track_ga_event_to_cram:function(category,action,label,custom){var _tracking=cram.get("_tracking");if(!_tracking)_tracking=[];_tracking.push({category:category,action:action,label:label,custom:custom});cram.set("_tracking",_tracking);},track_ga_event_from_cram:function(){if(!cram.valid()){setTimeout(Tracking.track_ga_event_from_cram,1000);return false;}
var _tracking=cram.get("_tracking");if(!_tracking){_tracking=[];}
for(var i=0;i<_tracking.length;i++){var success=Tracking.track_ga_event(_tracking[i].category,_tracking[i].action,_tracking[i].label,_tracking[i].custom);if(i==0&&Tracking.retries<3&&!success){setTimeout(Tracking.track_ga_event_from_cram,1000);Tracking.retries+=1;return false;}}
cram.remove("_tracking");}});
var SuperPlus={current:null,playlists:null,callback:null,plusTitle:"Add to queue / playlist",Actions:{addToQueue:function(){var video=SuperPlus.currentVideo;if(!video)return;new Ajax.Request("/users/add_to_playlist",{parameters:{list_type:"queue",video_id:video.id,is_movie:video.is_movie},onSuccess:function(){if(SuperPlus.isHuluEditor())
SuperPlus.showComplete(video);if(typeof(SuperPlus.callback)=='function'){SuperPlus.callback();}}});},addToFavorites:function(){var video=SuperPlus.currentVideo;if(!video)return;new Ajax.Request("/users/add_to_playlist",{parameters:{list_type:"favorites",video_id:video.id},onSuccess:function(){SuperPlus.showComplete(video);if(typeof(SuperPlus.callback)=='function'){SuperPlus.callback();}}});},addToPlaylistId:function(id,name){var video=SuperPlus.currentVideo;var name=unescape(name);if(!video)return;new Ajax.Request("/playlists/add_video",{parameters:{playlist_id:id,video_id:video.id,is_movie:video.is_movie},onSuccess:function(){SuperPlus.showComplete(video,id,name);if(typeof(SuperPlus.callback)=='function'){SuperPlus.callback();}},onFailure:function(transport){var error="";var playlist_link=name.escapeHTML();try{error=(transport.responseText.evalJSON()).error;error=error.replace("PLAYLIST_LINK",playlist_link);}catch(ex){}
SuperPlus.showComplete(video,id,name,error);}});},addToPlaylist:function(){SuperPlus.updatePlaylistList();},addNewPlaylist:function(ev){if(SuperPlus.isCreatingPlaylist)return;var input=this['name'];if(input&&!input.hasClassName('disabled')){if(input.value.blank()){$$(".playlist-create-error").each(function(el){el.innerHTML="Please enter a playlist name.";el.show();});return;}
SuperPlus.isCreatingPlaylist=true;if(!input.hasClassName("add-pl-in-profile")){$$("#playlist-create-loading").each(Element.show);var video=SuperPlus.currentAddVideo;var params=this.serialize(true);if(video){params["video_id"]=video.id;params["is_movie"]=video.is_movie;}
new Ajax.Request("/playlists/create",{parameters:params,onSuccess:function(transport){if(SuperPlus.fromProfile){location.reload();return;}
if(typeof(SuperPlus.callback)=='function'){SuperPlus.callback();}
var playlist=transport.responseText.evalJSON();$$(".playlist-create-error").each(Element.hide);SuperPlus.playlists=SuperPlus.playlists||[];SuperPlus.playlists.push(playlist);$('playlist-create-table').hide();var html='<li>New playlist "'+input.value.escapeHTML()+'" created!</li>';html+='<li>Added this video to "'+input.value.escapeHTML()+'".</li>';$("playlist-create-success-text").innerHTML=html;$$(".playlist-create-success").each(Element.show);},onFailure:function(transport){var error=transport.responseText.evalJSON();if(error&&error.error){$$(".playlist-create-error").each(function(node){node.innerHTML=error.error;node.show();});}},onComplete:function(transport){$$("#playlist-create-loading").each(Element.hide);SuperPlus.isCreatingPlaylist=false;}});}
else{new Ajax.Request("/playlists/create",{parameters:{name:input.value},onSuccess:function(transport){location.reload();},onFailure:function(transport){var error=transport.responseText.evalJSON();if(error&&error.error){$$(".playlist-create-error").each(function(node){node.innerHTML=error.error;node.show();});}},onComplete:function(transport){SuperPlus.isCreatingPlaylist=false;}});}}}},updatePlaylistList:function(scroll_down){if(SuperPlus.playlists){var playlists=SuperPlus.playlists;var list=$$("#super_plus .playlists>div").first();if(list&&playlists){var items=$A(playlists).findAll(function(item){return!item.is_favorites;});if(items.length==0){list.up(".playlists").hide();}
else{list.up(".playlists").show();list.update(items.map(function(item){return('<div class="pl-item" id="pli-'+item.id+'" onclick="SuperPlus.Actions.addToPlaylistId('+item.id+',\''+escape(item.name)+'\')'+'"><ul><li>'+item.name.escapeHTML()+'</li></ul></div>');}).join("\n"));}
SuperPlus.setMenuState("add-to-playlist");if(scroll_down){var el=$$("#super_plus .playlists")[0];if(el)el.scrollTop=el.scrollHeight;}}}else{SuperPlus.setMenuState("loading");new Ajax.Request("/playlists/list",{method:"get",parameters:{format:"json",cb:new Date().getTime()},onSuccess:function(transport){SuperPlus.playlists=transport.responseText.evalJSON(true);SuperPlus.updatePlaylistList();}});}},resetSuperPlusFormBehavior:function(form){if(form){if(!form.hasClassName("behaviorized")){if(SuperPlus.inProfile){form.down("#create-new-playlist-submit").src=Base.imageURL("/images/btn-create-small.gif");}
form.observe("submit",SuperPlus.Actions.addNewPlaylist.bindAsEventListener(form));form.addClassName("behaviorized");}}},resetFormBehavior:function(form){if(form){var input=form.down("input");if(input){if(input.value.blank())
input.value="Create new playlist...";input.addClassName("disabled");}
if(!form.hasClassName("behaviorized")){if(input){input.observe("focus",function(){input.removeClassName("disabled");if(input.value=="Create new playlist...")
input.value="";});input.observe("blur",function(){if(input.value.blank()){input.value="Create new playlist...";input.addClassName("disabled");}});}
form.observe("submit",SuperPlus.Actions.addNewPlaylist.bindAsEventListener(form));form.addClassName("behaviorized");}}},setMenuState:function(state){var p=$('super_plus');if(p){p.removeClassName("complete");p.removeClassName("add-to-playlist");p.removeClassName("loading");if(state)p.addClassName(state);}},showComplete:function(video,playlist_id,name,error){var p=$('super_plus');if(playlist_id){if(!error){$$("#pli-"+playlist_id).each(function(el){el.addClassName("added");});setTimeout("SuperPlus.hide()",2000);}else{$$("#pli-"+playlist_id).each(function(el){el.removeClassName("added");el.addClassName("error");});var n=$("pli-"+playlist_id);if(n){var position=n.positionedOffset();$$('.playlist-add-error').each(function(el){var top=(position[1]-n.up('.playlists').scrollTop+n.getHeight());if(top>150)top=150;el.style.top=top+"px";el.style.left=position[0]+"px";el.style.width=(n.getWidth()-2)+"px";el.down('.playlist-add-error-content').innerHTML=error;n.title=error.unescapeHTML();if(SuperPlus.errorEffect){SuperPlus.errorEffect.cancel();el.style.opacity="";}
el.show();SuperPlus.errorEffect=new Effect.Fade(el,{duration:5});});}}}else{$('sp-add-to-queue').addClassName("added");}},isHuluEditor:function(){var hulu_id=(RAILS_ENV=="production")?20535891:2003130075;return(Behaviors.getUserId()==hulu_id);},show:function(ev,video,callback){var el=Event.element(ev);if(!el)return;if(!Behaviors.isLoggedIn()){FloatingLoginForm.show(el);return;}
if(!Behaviors.checkAddQueue(el,video.plus_only,video.auth_valid)){return false;}
SuperPlus.callback=callback;if(!el.hasClassName('super_plus')){el=el.up('.super_plus');if(!el)return;}
if(!SuperPlus.isHuluEditor()){el.update("<img src='/images/icon-check.gif?1231231' alt='' border='0'>");el.title="Added to Queue";SuperPlus.currentVideo=video;return SuperPlus.Actions.addToQueue();}
$$(".playlist-create-error").each(Element.hide);if(SuperPlus.current){var current=SuperPlus.current;SuperPlus.hide(function(){if(current!=el){SuperPlus.show(ev,video,callback);}});return;}
SuperPlus.currentVideo=video;SuperPlus.current=el;SuperPlus.setMenuState();SuperPlus.current.title="";var hover=$('super_plus');if(hover&&hover.style.display=='none'){hover.down("#sp-add-to-queue").removeClassName("added");var dim=hover.getDimensions();var viewport=Element.viewportOffset(el);var elbounds=InfoHover.getBounds(el);var loc=SuperPlus.determineLocation(dim,elbounds,viewport);hover.style.left=(loc.x+(loc.className=="spleft"?1:-1))+'px';hover.style.top=loc.y+'px';$A([el,hover]).each(function(e){e.removeClassName("spleft");e.removeClassName("spright");});el.addClassName(loc.className);hover.addClassName(loc.className);var bc=$$("#super_plus .border-cover").first();if(bc)bc.style.height=(elbounds.height-2)+"px";var plusc=$$("#super_plus .gra-plus-corner").first();var plush=$$("#super_plus .gra-plus").first();if(plusc&&plush){$A([plusc,plush]).each(function(e){e.style.height="";e.style.width="";e.style.top=elbounds.height+"px";});plush.style.width=(elbounds.width-12)+"px";if(loc.className=="spleft"){plusc.style.left="auto";plush.style.left="auto";plusc.style.right=(-1*elbounds.width)+"px";plush.style.right=(-1*(elbounds.width-12))+"px";}
else{plusc.style.right="auto";plusc.style.left=(-1*elbounds.width)+"px";plush.style.left=(-1*(elbounds.width-12))+"px";}}
SuperPlus._runEffect(hover,el,"show",function(){el.addClassName('plussed');});}},determineLocation:function(hoverDim,target,viewport){var docViewport=document.viewport.getDimensions();var offset=0;var lr=1;var x=target.left+target.width+offset;var y=target.top;var loc=[x,y];loc.x=x;loc.y=y;loc.className=lr==0?"spleft":"spright";return loc;},hide:function(after){var hover=$('super_plus');var plus=$$('.plussed');plus=(plus&&plus.length>0)?plus[0]:false;after=after?after:Prototype.K;if(SuperPlus.current){SuperPlus.current.title=SuperPlus.plusTitle;}
if(hover&&plus){SuperPlus._runEffect(hover,plus,"hide",function(){plus.removeClassName("plussed");SuperPlus.current=null;SuperPlus.currentVideo=null;after();});}
else{SuperPlus.current=null;SuperPlus.currentVideo=null;after();}},_runEffect:function(box,plus,action,after){var show=action=="show"?true:false;if(SuperPlus.currentEffect){box.hide();plus.removeClassName('plussed');after();}
else{var effectClass=show?Effect.Appear:Effect.Fade;var start=show?0:100;var end=show?100:0;SuperPlus.currentEffect=new Effect.Parallel([new effectClass(box,{sync:true}),new Effect.Tween(null,start,end,{sync:true},function(v){var n=parseInt(0xf4+11*(1-v/100));n=n.toString(16);if(show){plus.style.backgroundColor='#'+[n,n,n].join("");n=parseInt(0x66+(0xff-0x66)*(1-v/100));n=n.toString(16);n='#'+[n,n,n].join("");if(plus.hasClassName("spright")){plus.style.borderColor=[n,"transparent",n,n].join(" ");}
else{plus.style.borderColor=[n,n,n,"transparent"].join(" ");}}else{plus.style.backgroundColor='transparent';plus.style.borderColor='transparent';}})],{duration:0.2,afterFinish:function(){SuperPlus.currentEffect=null;after();}});}},out:function(ev){if($('super_plus')&&$('super_plus').visible()){var el=Event.element(ev);if(el.up("#super_plus"))return false;var bounds=InfoHover.getBounds($('super_plus'));var y=Event.pointerY(ev);var x=Event.pointerX(ev);var hide=y<bounds.top||y>bounds.top+bounds.height||x<bounds.left||x>bounds.left+bounds.width;if(hide){SuperPlus.hide();}
return false;}},showCreatePlaylist:function(el,from_profile){SuperPlus.resetSuperPlusFormBehavior($$(".super-plus-create-form form").first());if(!el)el=$('super_plus');$$('#playlist-create-table').each(Element.show);$$('.super-plus-create-form .playlist-create-success, .super-plus-create-form .playlist-create-error').each(Element.hide);$$('#playlist-create-loading').each(Element.hide);SuperPlus.currentAddVideo=SuperPlus.currentVideo;SuperPlus.hide();FloatingDiv.show(document,$('super-plus-create-form'),340);SuperPlus.isCreatingPlaylist=false;SuperPlus.fromProfile=from_profile;var name=$$('.super-plus-create-form input.pl-name').first();if(name){name.value="";var d=$$(".super-plus-create-form textarea").first();if(d)d.value="";name.focus();}},clearPlaylist:function(){SuperPlus.playlists=null;},init:function(){SuperPlus.clearPlaylist();}};document.observe("dom:loaded",SuperPlus.init);document.observe("hulu:loggedOut",SuperPlus.init);
var Playlist=Class.create();Object.extend(Playlist,{setPublic:null,current_id:null,current_item_id:null,play:function(playlist_absolute_id,playlist_item_id){if(Playlist.current_id!=playlist_absolute_id){document.location="/playlist/"+playlist_absolute_id+"#"+playlist_item_id;}else{$$("tr.playing").each(function(el){el.removeClassName("playing");});$$("tr#pli-"+playlist_item_id).each(function(el){el.addClassName("playing");});document.location.hash="#pli"+playlist_item_id;Playlist.current_item_id=playlist_item_id;}
var items=ContinuousPlay.getPlaylistItems();var eid="";for(var i=0;i<items.length;i++){if(items[i].playlistItemId==playlist_item_id){eid=items[i].eid;id=items[i].id;display_title=items[i].displayTitle;desc=items[i].desc;video_url=items[i].videoUrl;content_id=items[i].contentId;break;}}
Playlist.updateVideoInfo(id,display_title,desc,video_url,content_id,eid);},playItem:function(playlist_item_id,available){if(!available)return;var items=ContinuousPlay.getPlaylistItems();var eid="";for(var i=0;i<items.length;i++){if(items[i].playlistItemId==playlist_item_id){eid=items[i].eid;break;}}
if(eid){$('player').playVideo("e:"+eid);Playlist.play(Playlist.current_id,playlist_item_id);}},viewed:function(playlist_id,user_id){new Ajax.Request("/playlists/viewed?user_id="+user_id+"&id="+playlist_id);},updateFilter:function(filter,value){var loc=window.location.href;var regex=new RegExp(filter+"=([^&]*)","i");if(regex.test(loc)){loc=loc.replace(regex,filter+"="+escape(value));}else{if(loc.indexOf("?")>0){loc=loc+"&"+filter+"="+escape(value);}else{loc=loc+"?"+filter+"="+escape(value);}}
window.location=loc;},init:function(){if(!/\/playlist\//.test(document.location.pathname)){return;}
var hash=document.location.hash;if(/#pli(\d)+/.test(hash)){var retry=0;var pli_id=hash.replace(/#pli/,"");var play=function(){try{Playlist.playItem(pli_id,true);}catch(ex){if(retry<10){setTimeout(play,1000);}
retry+=1;}}
setTimeout(play,1000);}},updateVideoInfo:function(video_id,video_title,video_desc,video_url,video_content_id,video_eid){if(video_id){try{Social.Common.showWatchPageData(video_id,false,true);FacebookCanvas.Comment.videoName=video_title;FacebookCanvas.Comment.videoDescription=video_desc;FacebookCanvas.Comment.videoLink=video_url;FacebookCanvas.Comment.videoContentId=video_content_id;FacebookCanvas.Comment.videoEmbedId=video_eid;FacePile.updateVideo(video_id);}
catch(e){}}}});document.observe("dom:loaded",Playlist.init);
var RecommendationHubSlider=Class.create(VideoSlider,{channels:null,selectedGenres:[],arrowWidth:0,_rTracking:null,closed_captioned_var:0,has_free_var:0,has_hd_var:0,plus_only_var:0,video_type_var:"All",filter:"",reload_rechub:false,interactionType:null,node:null,show_id:null,options:null,interaction:"",remove:false,loadPage:function(page,afterLoaded){if(this.is_first_load){this.is_first_load=false;this.sld.fire("video_slider:page_load",{page:page,is_first_load:true});if(Behaviors.getCookie("_r_tracking_")){var cookieContent=unescape(Behaviors.getCookie("_r_tracking_"));if(typeof(_rTracking)!='undefined'&&_rTracking!=null)
_rTracking.loadCookieAndSend(cookieContent);Behaviors.eraseCookie("_r_tracking_",Base.commonCookieDomain());}}
if(!this.reload_ratemore&&(this.count>=this.maxCount||this.pagesLoaded[page-1])){this.sld.fire("video_slider:list_changed",{page:page,is_cached:true});afterLoaded();return;}else{if(this.loading)return;this.loading=true;var params=Object.extend(this.urlOptions,{page:page});if(!this.is_first_load){this.sld.fire("video_slider:page_load",{page:page,is_first_load:false});}
this.showLoading(page);this.loadPageUrl(page,params,afterLoaded);}
return;},loadPageUrl:function(page,params,afterLoaded){if(params.type=="recommend_hub_reload"){RecommendationHubSlider.reloadRecommendHub();return;}else if(this.url=='recommendation/genre_continue'){var drop=null;if(this.sld.up('div.vslc')){drop=this.sld.up('div.vslc').down('ul.dropdown-ul');}
if(drop){var li=drop.down('li.selected');if(li){RecommendationHubSlider.onLiClick(li,true);return;}}}
var url=[this.url,$H(params).toSortedQueryString()].join('?')
RecommendationHubSlider.updateFilter();new Ajax.Request(url,{method:'get',parameters:{closed_captioned:RecommendationHubSlider.closed_captioned_var,has_free:RecommendationHubSlider.has_free_var,has_hd:RecommendationHubSlider.has_hd_var,plus_only:RecommendationHubSlider.plus_only_var,video_type:RecommendationHubSlider.video_type_var},onSuccess:this.populatePage.bindAsEventListener(this,page),onComplete:function(transport){if("bookmark"==this.getLoc()){try{var lis=this.sld.select('li');var lists=lis.map(function(li){var cha=(li.getAttribute('cluster')=='1')?'c':'s';return cha+li.getAttribute('si');});var list=lists.join(',');BookmarkTracking.track("showup",{source:"rechub",list:list,userid:RecommendationHubSlider.getUserId()});}catch(ex){}
if(!this.sld.down('li')){this.sld.up('div.vslc').hide();}}
$$('.cp-'+VideoSlider.currentVideoId()).invoke("show");this.hideLoading();afterLoaded();this.checkOffVideos();}.bind(this)});},isRecommendationHub:true,moving_count:0,getLoc:function(){var genre_id=this.urlOptions.genre_id;switch(genre_id){case'top_recommendations':var loc='toprec';break;case'ratemore':var loc='ratemore';break;case'bookmark':var loc='bookmark';break;default:var loc='genre'+genre_id;}
return loc;},domSensitiveInit:function($super,id,options){this.trackingType=options.trackingType||'recommendationhub';this._rTracking=RecommendationHubSlider._rTracking||new RecommendTracking();this.last_page=1;var extra_tracking=options["extra_tracking_params"];var _rTracking=this._rTracking;this.sld.observe("video_slider:page_load",(function(ev){var user_id=RecommendationHubSlider.getUserId();var loc=this.getLoc();RecommendationHubSlider.updateFilter();if(ev.memo.is_first_load){try{_rTracking.send(this.trackingType,'showup',user_id,this.check_out_show,null,null,RecommendationHubSlider.filter,null,null,loc,null);}catch(ex){}}
if(extra_tracking){try{_rTracking.send(this.trackingType,'recommend_details',user_id,null,null,extra_tracking,null,null,null,loc,null);extra_tracking=null;}catch(ex){}}}).bind(this));this.sld.observe("video_slider:list_changed",(function(ev){var user_id=RecommendationHubSlider.getUserId();var loc=this.getLoc();try{var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;if(page>0&&this.last_page!=page){this.last_page=page;_rTracking.send(this.trackingType,"scroll",user_id,null,loc,null,null,page,null,loc,null);}}catch(ex){}
try{var dstlist=this.getCurrentItemIds();if(!dstlist)return;var no_track=false;if(this.last_dstlist&&this.last_dstlist.indexOf(dstlist)==0){if(this.las_dstlist[dstlist.length]==null||this.last_dstlist[dstlist.length]=="_"){no_track=true;}}
if(!no_track){_rTracking.send(this.trackingType,'dstlistchange',user_id,null,null,dstlist,null,null,null,loc,null);}
if(this.last_dstlist!=dstlist){this.last_dstlist=dstlist;}}catch(ex){}}).bind(this));this.sld.observe("video_slider:remove_video",function(ev){var loc=this.getLoc();var user_id=RecommendationHubSlider.getUserId();var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;try{var reason;var srcid=1;if(ev.memo.reason=='interested'){reason='dislike';srcid=0;}else if(ev.memo.reason=='notwatched'){reason='haswatched';srcid=0;}else{reason=ev.memo.reason;}
_rTracking.send(this.trackingType,reason,user_id,srcid,ev.memo.show_id,null,null,page,null,loc,null);}catch(ex){}}.bind(this));$super(id,options);},removeVideo:function(node,reload_limit){var page=-1*(this.currentPos()-this.pageWidth)/this.pageWidth;var next=node.next("li.absolutized");node.remove();var remained_li=this.inr.getElementsBySelector("li.absolutized");var max_count=this.maxCount<remained_li.length?this.maxCount:remained_li.length;if(typeof(reload_limit)!='number')reload_limit=this.perPageCount;if(max_count<reload_limit){var show_history=[];remained_li.each(function(li){show_history.push(li.readAttribute("si"));});this.urlOptions["show_history"]=show_history.join("_")
this.pagesLoaded=[];this.inr.update("");this.updateCounts();this.move(null,page);return;}
if(!next){this.updateMaxCount(max_count,page);}else{this.lockSlide();this.moving_count=0;while(next){to=parseInt(next.style.left)-this.itemWidth;this.moving_count+=1;new Effect.Move(next,{x:to,mode:'absolute',duration:0.4,afterFinish:this.moveFinished.bind(this,max_count)});next=next.next("li.absolutized");}}},moveFinished:function(max_count){this.moving_count-=1;if(this.moving_count==0){this.unlockSlide();this.updateMaxCount(max_count);}},updateMaxCount:function(max_count,page){this.maxCount=max_count;this.repopulateNav();if(page&&page>this.maxPages){this.move(null,this.maxPages);}},recommendFeedback:function(node,show_id,options,remove){node=node.up("li");options=options||{};var update_type=options["update_type"]||"add";var feedback_type=options["feedback_type"]||"HasWatchedShow";var reason=feedback_type.replace(/show$/i,"").toLowerCase();new Ajax.Request("/profile/recommend_feedback",{method:'post',parameters:{id:show_id,update_type:update_type,feedback_type:feedback_type},onSuccess:function(transport){if(remove!=false){this.removeVideos(node,remove);if(feedback_type=="NotWatchedShow"){this.removeVideo(node,remove);}}
if(feedback_type=="HasWatchedShow"){this.reloadRatemore();}}.bind(this)});this.sld.fire("video_slider:remove_video",{show_id:show_id,reason:reason});},removeVideos:function(node,remove){var show_id=node.readAttribute('si');var rechub=node.up('div#rec-hub-main');if(rechub){var css_string='li[si="'+show_id+'"]';var all_nodes=rechub.select(css_string);for(var index=0;index<all_nodes.length;++index){var item=all_nodes[index];if(!item.up('div#ratemore_ratemore_slider')){this.removeVideo(item,remove);}}}},reloadRatemore:function(){var css_id="ratemore_ratemore_slider";var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);obj.reload_ratemore=true;obj.sld.down('ul').innerHTML='';obj.lazyLoad();obj.reload_ratemore=false;},getCurrentItemIds:function(){var item_ids=[];var start=-parseInt(this.inr.getStyle("left"));var end=start+this.pageWidth;var lis=this.inr.getElementsBySelector("li.absolutized");lis.each(function(li){var pos=parseInt(li.getStyle("left"));if(pos>=start&&pos<end){item_ids.push(li.readAttribute('si'));}});return item_ids.join("_");}});Object.extend(RecommendationHubSlider,{initChannels:function(channels){RecommendationHubSlider.channels=new Hash(channels);Event.observe(document,'click',RecommendationHubSlider.onDocumentClick);if(Behaviors.loggedIn){var span=$('rec-hub-username').down('span');span.innerHTML=Behaviors.getUsername().escapeHTML();$('rec-hub-username').show();}
else{$('rec-hub-anonymous').show();}},initUl:function(){var lists=$$('.dropdown-lists');if(!lists)return;var keys=RecommendationHubSlider.channels.keys().sort();var half=Math.floor(keys.size()/2)+(keys.size()&1);lists.each(function(list){var ul=list.down('ul')
if(!ul||ul.hasClassName('inited'))return;for(var i=0;i<half;i++){RecommendationHubSlider.addLiToUl(ul,keys[i]);if(i+half<keys.size())
RecommendationHubSlider.addLiToUl(ul,keys[i+half]);}
ul.addClassName('inited');var arrow=ul.up('.vsltitle').down('.arrow');arrow.observe("mouseover",function(event){var arrow=Event.element(event);RecommendationHubSlider.onArrowHover(arrow);});arrow.observe("mouseout",function(event){var arrow=Event.element(event);RecommendationHubSlider.onArrowOut(arrow);});arrow.observe("click",function(event){var arrow=Event.element(event);RecommendationHubSlider.onArrowClick(arrow);});});},onArrowHover:function(arrow){var vslt=arrow.up('.vsltitle');var ar=vslt.down('.vl').down('img');vslt.addClassName('hovered');Home.hoverArrow(ar);},onArrowOut:function(arrow){var vslt=arrow.up('.vsltitle');var ar=vslt.down('.vl').down('img');if(vslt.hasClassName('expanded'))
Home.activeArrow(ar);else
Home.resetArrow(ar);vslt.removeClassName('hovered');},onArrowClick:function(arrow){var vslt=arrow.up('.vsltitle');var ar=vslt.down('.vl').down('img');if(vslt.hasClassName('expanded')){vslt.removeClassName('expanded');Home.resetArrow(ar);}else{RecommendationHubSlider.resetAll();RecommendationHubSlider.arrowWidth=ar.cumulativeOffset()[0]+15;vslt.addClassName('expanded');Home.activeArrow(ar);}
vslt.removeClassName('hovered');},resetAll:function(){$$('div.vsltitle.expanded').each(function(div){div.removeClassName('expanded');Home.resetArrow(div.down('.vl').down('img'));});},onDocumentClick:function(ev){var ex=$$('div.vsltitle.expanded').first();if(!ex)return;var xy=ex.cumulativeOffset();var exy=Event.pointer(ev);if(((exy.x<xy[0])||(exy.x>xy[0]+460)||(exy.y<xy[1])||(exy.y>xy[1]+260))||((exy.y>xy[1])&&(exy.y<xy[1]+30)&&(exy.x>RecommendationHubSlider.arrowWidth))){RecommendationHubSlider.resetAll();}},addLiToUl:function(ul,name){var el=$(document.createElement("li"));el.innerHTML=name;var gid=RecommendationHubSlider.channels.get(name);el.setAttribute('gid',gid);if(ul.getAttribute('gid')==gid){el.addClassName('selected');}
ul.appendChild(el);el.observe("mouseover",function(event){var element=Event.element(event);element.addClassName("hovered");});el.observe("mouseout",function(event){var element=Event.element(event);element.removeClassName("hovered");});el.observe("click",function(event){RecommendationHubSlider.onLiClick(Event.element(event));});},onLiClick:function(element,force){RecommendationHubSlider.resetAll();if(!element)return;var history=RecommendationHubSlider.getHistory();var uls=$('rec-hub-main').select('.dropdown-ul');uls.collect(function(u){return u.getAttribute('gid')});var genre_id=element.getAttribute('gid');var old_genre_id=element.up('ul').getAttribute('gid');var user_id=RecommendationHubSlider.getUserId();try{_rTracking.send('recommendationhub',"genrechange",user_id,old_genre_id,genre_id,null,RecommendationHubSlider.filter,null,null,null,null);}catch(ex){}
var vslc=element.up('div.vslc');var exist_genre=force?false:$('genre-'+genre_id+'-container');if(exist_genre){RecommendationHubSlider.swapNode(exist_genre,vslc);RecommendationHubSlider.saveSelectedGenres();}else{var genre_name=element.innerHTML;var eid=vslc.id;vslc.down('div.vsl').innerHTML='<div class="recommendation-vsl-lazy-load"></div>';var url='/recommendation/genre_change';if(!Behaviors.loggedIn&&history.h.blank()){url+='_ay';}
new Ajax.Request(url,{method:'get',asynchronous:true,parameters:{element:eid,h:history.h,wh:history.wh,guid:history.guid,genre_id:genre_id,genre_name:genre_name,closed_captioned:RecommendationHubSlider.closed_captioned_var,has_free:RecommendationHubSlider.has_free_var,has_hd:RecommendationHubSlider.has_hd_var,plus_only:RecommendationHubSlider.plus_only_var,video_type:RecommendationHubSlider.video_type_var,user_id:Behaviors.getUserId()},onComplete:function(){RecommendationHubSlider.initUl();RecommendationHubSlider.saveSelectedGenres();RecommendationHubSlider.processNoResult();}});}},swapNode:function(node1,node2){var _parent=node1.parentNode;var _t1=node1.next();var _t2=node2.next();if(_t1){_parent.insertBefore(node2,_t1);}else{_parent.appendChild(node2);}
if(_t2){_parent.insertBefore(node1,_t2);}else{_parent.appendChild(node1);}},saveGenres:function(select){if(!cram||!cram.valid()){setTimeout(function(){RecommendationHubSlider.saveGenres(select);},300);}else{cram.set('rec_genre_choice',select);}},saveSelectedGenres:function(){RecommendationHubSlider.getSelectedGenres();var select=RecommendationHubSlider.selectedGenres.join('_');if(Behaviors&&Behaviors.loggedIn){new Ajax.Request("/recommendation/save_selected_genres",{method:'post',parameters:{genre_choice:select}});}else{RecommendationHubSlider.saveGenres(select);}},getSelectedGenres:function(){var uls=$$('.dropdown-ul');RecommendationHubSlider.selectedGenres=uls.map(function(ul){return ul.getAttribute('gid');});return RecommendationHubSlider.selectedGenres;},processNoResult:function(){keys=RecommendationHubSlider.channels.keys();if(keys.length<4)return;var divs=$$('div.no-result-try');divs.each(function(div){var a=div.down('a');if(!a)return;var i,gid,name;do{i=Math.floor((Math.random()*keys.length));name=keys[i];gid=RecommendationHubSlider.channels.get(name);}while(RecommendationHubSlider.selectedGenres.indexOf(gid.toString())>=0||gid==17)
a.innerHTML=name;var li=div.up('div.vslc').down('ul.dropdown-ul').getElementsBySelector('[gid='+gid+']').first();if(li){a.observe("click",function(event){RecommendationHubSlider.onLiClick(li);});}
div.removeClassName('no-result-try');});},getHistory:function(){if(Behaviors&&Behaviors.loggedIn){var h=wh=guid="";}else{if(!cram||!cram.valid()){return false;}else{var h=UserHistory.get_history(),wh=UserHistory.get_watched_history();if(h.blank()){var guid="";}else{var guid=Behaviors.getGUID();}}}
var history=[h,wh,guid];history.h=h;history.wh=wh;history.guid=guid;return history;},reloadRecommendHub:function(){var h,wh,guid;var history=RecommendationHubSlider.getHistory();if(history==false){setTimeout(function(){RecommendationHubSlider.reloadRecommendHub();},300);return false;}
var genre_choice='';if(!Behaviors.loggedIn&&cram&&cram.valid()){genre_choice=cram.get('rec_genre_choice');}
var url='/recommendation/recommend_hub';if(!Behaviors.loggedIn&&history.h.blank()){url+='_ay';}
var check_out_show="";var search=window.location.search;var start_index=search.indexOf("check_out_show");if(start_index!=-1){var sub_string=search.substring(start_index,search.length);var end_index=sub_string.indexOf("&");if(end_index==-1){end_index=sub_string.length;}
check_out_show=sub_string.substring(15,end_index);}
new Ajax.Request(url,{method:'get',asynchronous:true,parameters:{h:history.h,wh:history.wh,guid:history.guid,genre_choice:genre_choice,check_out_show:check_out_show},onComplete:function(){RecommendationHubSlider.onPageLoad();}});},removeBookmark:function(node,bookmark_id,bookmark_type,uid){new Ajax.Request("/profile/remove_bookmark",{method:'post',parameters:{show_id:bookmark_id,show_type:bookmark_type},onSuccess:function(){try{var obj=VideoSlider.SLIDER_OBJECTS.get(node.up("ul").up("div.vsl").id);obj.removeVideo(node.up("li"),1);var page=-1*(obj.currentPos()-obj.pageWidth)/obj.pageWidth;var loc=obj.getLoc();var user_id=RecommendationHubSlider.getUserId();obj._rTracking.send(obj.trackingType,'deletebookmark',user_id,null,bookmark_id,bookmark_type,null,page,null,loc,null);BookmarkTracking.track('useraction',{event:'useraction',action:'delete',source:'rechub',original_item_id:bookmark_id,original_item_type:bookmark_type,userid:uid});}catch(ex){}}});},voteItem:function(css_id,show_id,vote){css_id=css_id||VideoSlider.SLIDERS[0];var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj&&obj.isRecommendationHub){var page=-1*(obj.currentPos()-obj.pageWidth)/obj.pageWidth;var loc=obj.getLoc();var user_id=RecommendationHubSlider.getUserId();try{obj._rTracking.send(obj.trackingType,'rate',user_id,null,show_id,vote,null,page,null,loc,null);}catch(ex){}}},clickedItem:function(css_id,show_id,show_type,watch_now){var beacon_name=(watch_now==true)?'watchnow':'click';RecommendationHubSlider.sendBeacon(beacon_name,css_id,show_id,show_type);var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);var loc=obj.getLoc();if('bookmark'==loc){try{BookmarkTracking.track('useraction',{event:'useraction',action:'gotopage',source:'rechub',original_item_id:show_id,original_item_type:show_type,userid:user_id});}catch(ex){}}},sendBeacon:function(event_type,css_id,id,type){css_id=css_id||VideoSlider.SLIDERS[0];var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj&&obj.isRecommendationHub){var page=-1*(obj.currentPos()-obj.pageWidth)/obj.pageWidth;var loc=obj.getLoc();var user_id=RecommendationHubSlider.getUserId();try{obj._rTracking.send(obj.trackingType,event_type,user_id,null,id,type,null,page,null,loc,null);}catch(ex){}}},subscribed:function(css_id,show_id,show_type){RecommendationHubSlider.sendBeacon('subscribe',css_id,show_id,show_type);var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);var loc=obj.getLoc();if(loc!='bookmark'){var li=this.up("li");if(!li)return;var fbdiv=li.down('.recommend-feedback');if(!fbdiv)return;if(fbdiv)fbdiv.innerHTML='Added to Your Favorites!';}else{try{BookmarkTracking.track('useraction',{event:'useraction',action:'subscribe',source:'rechub',original_item_id:show_id,original_item_type:show_type,userid:user_id});}catch(ex){}}},queued:function(css_id,show_id,show_type){RecommendationHubSlider.sendBeacon('queue',css_id,show_id,show_type);},Bookmark:function(css_id,show_id,show_type){RecommendationHubSlider.sendBeacon('bookmark',css_id,show_id,show_type);var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);var loc=obj.getLoc();var user_id=RecommendationHubSlider.getUserId();try{new Ajax.Request("/profile/add_bookmark",{method:'post',parameters:{show_id:show_id,show_type:show_type||'Show'},onSuccess:(function(){BookmarkTracking.track('useraction',{event:'useraction',action:'add_bookmark',source:'rechub',original_item_id:show_id,original_item_type:show_type,userid:user_id});this.reloadBookmark();}).bind(this)});}catch(ex){}},RecommendFeedback:function(node,show_id,options,remove){if(!Behaviors.isLoggedIn()){this.interactionType="RecommendFeedback";this.node=node;this.show_id=show_id;this.options=options;this.remove=remove;FloatingLoginForm.show(node);return false;}
else{if(node.title=="Yes"){node.up('div').toggle();node.up('div').next('div').toggle();node.up('div').previous('div').innerHTML='Would you like to?';}}
try{var obj=VideoSlider.SLIDER_OBJECTS.get(node.up("ul").up("div.vsl").id);obj.recommendFeedback(node,show_id,options,remove);}catch(ex){}
return false;},displayLoginText:function(){if(Behaviors.loggedIn){$('rec-hub-anonymous').hide();var login_text=$('rec-hub-username');login_text.down('.name').innerHTML=Behaviors.getUsername().escapeHTML();login_text.show();}},loaded:false,onPageLoad:function(){if(!RecommendationHubSlider._rTracking){RecommendationHubSlider._rTracking=_rTracking||new RecommendTracking();}
if(!RecommendationHubSlider.channels){setTimeout(RecommendationHubSlider.onPageLoad,100);}else{RecommendationHubSlider.initUl();RecommendationHubSlider.getSelectedGenres();RecommendationHubSlider.processNoResult();RecommendationHubSlider.loaded=true;}},Repopulate:function(css_id){css_id=css_id||VideoSlider.SLIDERS[0];var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj&&obj.isRecommendationHub&&!obj.is_first_load){obj._rTracking=RecommendationHubSlider._rTracking;obj.repopulate();}},UpdateMaxCount:function(max_count,page,css_id,extra_tracking){css_id=css_id||VideoSlider.SLIDERS[0];var obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj&&obj.isRecommendationHub){obj.updateMaxCount(max_count,page);if(extra_tracking){var loc=obj.getLoc();var user_id=RecommendationHubSlider.getUserId();try{obj._rTracking.send(obj.trackingType,'recommend_details',user_id,null,null,extra_tracking,null,null,null,loc,null);}catch(ex){}}}},reloadBookmark:function(){css_id='bookmark_bookmark_slider';obj=VideoSlider.SLIDER_OBJECTS.get(css_id);if(obj){obj.sld.up(0).removeClassName("bookmarks-hidden");obj.pageWidth=920;obj.sld.down('ul').innerHTML='';obj.count=0;obj.maxCount++;obj.inr.style.left='';obj.is_first_load=true;obj.last_page=0;obj.pagesLoaded=[];obj.loadPage(1,obj.unlockSlide.bind(obj));obj.sld.up(0).show();}},updateFilter:function(){RecommendationHubSlider.closed_captioned_var=0;if($('closed-caption').hasClassName('checked')){RecommendationHubSlider.closed_captioned_var=1;}
RecommendationHubSlider.has_free_var=0;if($('has-free')&&$('has-free').hasClassName('checked')){RecommendationHubSlider.has_free_var=1;}
RecommendationHubSlider.has_hd_var=0;if($('has-hd')&&$('has-hd').hasClassName('checked')){RecommendationHubSlider.has_hd_var=1;}
RecommendationHubSlider.plus_only_var=0;if($('plus-only')&&$('plus-only').hasClassName('checked')){RecommendationHubSlider.plus_only_var=1;}
RecommendationHubSlider.video_type_var=$('video_type').down("li.selected").getAttribute('value');RecommendationHubSlider.filter="close_caption:"+RecommendationHubSlider.closed_captioned_var+";has_free:"+RecommendationHubSlider.has_free_var+";has_hd:"+RecommendationHubSlider.has_hd_var+";plus_only:"+RecommendationHubSlider.plus_only_var+";type:"+RecommendationHubSlider.video_type_var;},submitFilter:function(){RecommendationHubSlider.updateFilter();RecommendationHubSlider.getSelectedGenres();var select=RecommendationHubSlider.selectedGenres.join('_');VideoSlider.SLIDER_OBJECTS.each(function(s){s[1].stopObservingLazyLoad();});$('rec-hub-main').innerHTML="<div id='recommendation-hub-lazy-load'></div>";new Ajax.Request("/recommendation/search",{asynchronouos:true,evalScripts:true,parameters:{closed_captioned:RecommendationHubSlider.closed_captioned_var,has_free:RecommendationHubSlider.has_free_var,has_hd:RecommendationHubSlider.has_hd_var,plus_only:RecommendationHubSlider.plus_only_var,video_type:RecommendationHubSlider.video_type_var,genre_choice:select},method:'get',onComplete:function(request){RecommendationHubSlider.initUl();RecommendationHubSlider.getSelectedGenres();RecommendationHubSlider.processNoResult();}});},getUserId:function(){var user_id=Behaviors.getUserId();return user_id>0?user_id:null;}});
var Criterion={addAllToQueue:function(el,type,item){if(!Behaviors.loggedIn){FloatingLoginForm.show(el);}
else{new Ajax.Request('/users/add_cr_videos_to_queue',{parameters:{type:type,item:item},onComplete:function(){var div=el.up('div.add-all');if(div)div.hide();div=div.next('div.added-all');if(div)div.show();}});}}};
var Channel=Class.create();Object.extend(Channel,{typeGroup:"",channels:null,arrowWidth:0,loaded:false,selectedGenre:"",onPageLoad:function(){if(!Channel.channels){setTimeout(Channel.onPageLoad,100);}
else{Channel.initUl();Channel.loaded=true;}},initChannels:function(channels,type){Channel.channels=new Hash(channels);Channel.typeGroup=type;Event.observe(document,'click',Channel.onDocumentClick);},initUl:function(){var list=$$('.dropdown-list')[0];if(!list)return;var keys=Channel.channels.keys();var col=Math.ceil(keys.size()/3);var ul=list.down('ul');if(!ul||ul.hasClassName('inited'))return;Channel.selectedGenre=Channel.channels.get(ul.getAttribute("name"));ul.setAttribute("gid",Channel.selectedGenre);for(var i=0;i<col;i++){Channel.addLiToUl(ul,keys[i]);Channel.addLiToUl(ul,keys[i+col]);Channel.addLiToUl(ul,keys[i+col+col]);}
ul.addClassName('inited');var arrow=ul.up('.gr.ptop.a').down('.arrow');arrow.observe("mouseover",function(event){var arrow=Event.element(event);Channel.onArrowHover(arrow);});arrow.observe("mouseout",function(event){var arrow=Event.element(event);Channel.onArrowOut(arrow);});arrow.observe("click",function(event){var arrow=Event.element(event);Channel.onArrowClick(arrow);});},onArrowHover:function(arrow){var gr=arrow.up('.gr.ptop.a');var ar=gr.down('.arrow').down('img');gr.addClassName('hovered');Home.hoverArrow(ar);},onArrowOut:function(arrow){var gr=arrow.up('.gr.ptop.a');var ar=gr.down('.arrow').down('img');if(gr.hasClassName('expanded'))
Home.activeArrow(ar);else
Home.resetArrow(ar);gr.removeClassName('hovered');},onArrowClick:function(arrow){var gr=arrow.up('.gr.ptop.a');var ar=gr.down('.arrow').down('img');if(gr.hasClassName('expanded')){gr.removeClassName('expanded');Home.resetArrow(ar);}
else{Channel.arrowWidth=ar.cumulativeOffset()[0]+15;gr.addClassName('expanded');Home.activeArrow(ar);}
gr.removeClassName('hovered');},onDocumentClick:function(ev){var ex=$$('div.gr.ptop.a.expanded')[0];if(!ex)return;var xy=ex.cumulativeOffset();var exy=Event.pointer(ev);if(((exy.x<xy[0])||(exy.x>xy[0]+590)||(exy.y<xy[1])||(exy.y>xy[1]+260))||((exy.y>xy[1])&&(exy.y<xy[1]+30)&&(exy.x>Channel.arrowWidth))){ex.removeClassName('expanded');Home.resetArrow(ex.down('.arrow').down('img'));}},addLiToUl:function(ul,name){if(name==null)
{var el=$(document.createElement("li"));el.innerHTML="More";el.setAttribute('style',"visibility: hidden");ul.appendChild(el);return;}
var el=$(document.createElement("li"));var gid=Channel.channels.get(name);el.setAttribute('gid',gid);if(ul.getAttribute('gid')==gid){el.addClassName('selected');}
var el_href=$(document.createElement("a"));el_href.innerHTML=name;var url="";if(name=="All")
url='/genres/'+Channel.typeGroup+'?src=topnav';else
url='/genres/'+name+'?type='+Channel.typeGroup;el_href.setAttribute("href",url);el.appendChild(el_href);ul.appendChild(el);el.observe("mouseover",function(event){var element=Event.element(event);element.addClassName("hovered");});el.observe("mouseout",function(event){var element=Event.element(event);element.removeClassName("hovered");});el.observe("click",function(event){var element=Event.element(event);Channel.onLiClick(element);});},onLiClick:function(element){var div=$$('div.gr.ptop.a.expanded')[0];div.removeClassName('expanded');Home.resetArrow(div.down('.arrow').down('img'));if(!element)return;}});
var Auth=Class.create();Object.extend(Auth,{PROVIDERS:{'Verizon':{'displayName':'Verizon','logoImage':Base.imageURL('/images/auth/authentication-logo-verizon.png'),'btnImage':Base.imageURL('/images/auth/auth-verizon-lg.gif'),'grayLogo':Base.imageURL('/images/auth/verizon-gray.png'),'resourceId':'FBC-FOX','supportMessage':'If you have any questions related to your account, contact '+'<a class="utility-link" target="_blank" href="http://www22.verizon.com/content/ContactUs" '+'>Verizon Support</a>.'},'Dish':{'displayName':'DISH','logoImage':Base.imageURL('/images/auth/authentication-logo-dish.png'),'btnImage':Base.imageURL('/images/auth/auth-dish-lg.gif'),'grayLogo':Base.imageURL('/images/auth/dish-gray.png'),'resourceId':'FBC-FOX','supportMessage':'If you have any questions related to your account, '+'<a class="utility-link" target="_blank" href="http://www.dishnetwork.com/customerservice/'+'contactus/live_chat/default.aspx?chat=tier2">chat now</a>'+' with a DISH agent.'},'CableOne':{'displayName':'Cable One','logoImage':Base.imageURL('/images/auth/authentication-logo-cable1.png'),'btnImage':Base.imageURL('/images/auth/auth-cable1-lg.gif'),'grayLogo':Base.imageURL('/images/auth/cable1-gray.png'),'resourceId':'FBC-FOX','supportMessage':'If you have any questions related to your account, check out '+'<a class="utility-link" target="_blank" href="http://www.cableone.net/Pages/tvefaqs.aspx"'+'>Cable One support</a>'}},auth_mvpd:'',swf_embedded:false,logging_in_as:'',_narrow:false,_ACTIONS:{LEARN_MORE:0,SIGN_OUT:1,REMOVE_LINK:2},embedSWF:function(){var so=new SWFObject('https://entitlement.auth.adobe.com/entitlement/AccessEnabler.swf','ae_swf','0','0','10.1.53');so.addParam('allowscriptaccess','always');var written=so.write('ae_alternative');if(written&&$('auth_loading')){$('auth_loading').style.display="block";}
Auth.swf_embedded=true;},registerCallbacks:function(){window.swfLoaded=function(){var swf=$('ae_swf');swf.setRequestor('HULU');swf.setProviderDialogURL('none');swf.checkAuthentication();}
window.setAuthenticationStatus=function(isAuthenticated,errorCode){var link=$('ae_link');var auth_msg=$('ae_user_authenticated');if($('auth_loading')){$('auth_loading').hide();}
if(isAuthenticated==1){var mvpd=$('ae_swf').getSelectedProvider();if(mvpd.AE_state!='User Not Authenticated'){if(mvpd.MVPD in Auth.PROVIDERS){Auth.auth_mvpd=mvpd.MVPD;auth_msg.innerHTML='You are signed in as a '+Auth.PROVIDERS[mvpd.MVPD].displayName+' subscriber.';link.innerHTML='disconnect';auth_msg.show();link.onclick=function(){Auth.linkAction(Auth._ACTIONS.SIGN_OUT);}
$('ae_swf').getAuthorization(Auth.PROVIDERS[mvpd.MVPD].resourceId);}}}
else{if(errorCode=='User Not Authenticated Error'){var cookie=Auth.getCookie();if(Auth._narrow){$('ae_auth_status').style.display='none';}else{auth_msg.innerHTML='Authenticate with my cable or satellite account.';auth_msg.show();}
link.innerHTML='learn more';link.onclick=function(){Auth.linkAction(Auth._ACTIONS.LEARN_MORE);}
$('ae_swf').getAuthentication();}else{}}}
window.displayProviderDialog=function(providers){var provider_list=$('ae_provider_list');var html="";var display_index=0;for(var index=0;index<providers.length;index++){var id=providers[index].ID;if(!(id in Auth.PROVIDERS))continue;var style="";if(display_index%2==0)style="margin-right: 14px;";display_index+=1;html+='<img class="auth-provider" src="'+Auth.PROVIDERS[id].btnImage+'" alt="'+
Auth.PROVIDERS[id].displayName+'" style="'+style+'" onclick="Auth.login(\''+id+'\');" />';}
provider_list.innerHTML=html;$$("img.auth-provider").each(function(img){img.observe('mouseover',function(event){img.src=img.src.replace(".gif","-hover.gif");});img.observe('mouseout',function(event){img.src=img.src.replace("-hover.gif",".gif");});});$('ae_provider_selector').show();}
window.setMetadataStatus=function(key,argument,value){Auth.setCookie(Auth.auth_mvpd,parseInt(value));Auth.setExpiresMessage();new Ajax.Request('/authenticate/authenticate_with_mvpd',{method:'post',parameters:{mvpd:Auth.auth_mvpd},onComplete:function(){document.fire('hulu:authCheckSuccessful');}});}
window.setToken=function(requestedResourceID,token){$('ae_swf').getMetadata('TTL_AUTHN');}
window.tokenRequestFailed=function(requestedResourceID,requestErrorCode,requestErrorDetails){if(requestErrorCode=='User not Authorized Error'){$('ae_link').hide();$('ae_authenticated_until').innerHTML='<br/>FOX content is not available with your '+
Auth.PROVIDERS[Auth.auth_mvpd].displayName+' subscription.'+'<br/><br/>'+Auth.PROVIDERS[Auth.auth_mvpd].supportMessage+'<br/><br/> <a class="utility-link" '+'onclick="Auth.linkAction(Auth._ACTIONS.SIGN_OUT);" '+'href="JavaScript:void(0);">disconnect</a>';}else{$('ae_swf').getMetadata('TTL_AUTHN');}}
window.createIFrame=function(inWidth,inHeight){var mvpddiv=$('ae_mvpddiv');$$('.overlay-full')[0].show();$$('.overlay-full')[0].observe('click',Auth.hideIFrame);mvpddiv.style.visibility='visible';mvpddiv.style.top='0px';mvpddiv.style.left=(900-inWidth)/2+'px';ifrm=document.createElement('IFRAME');ifrm.id='ae_mvpdframe';ifrm.style.width=inWidth+'px';ifrm.style.height=inHeight+'px';ifrm.name='mvpdframe';ifrm.style.frameborder='0';ifrm.style.border='0';if(Auth.logging_in_as=='Verizon'){ifrm.style.margin='20px 20px 0 20px';}
mvpddiv.appendChild(ifrm);window.frames['mvpdframe'].name='mvpdframe';}},removeSWF:function(id){var obj=document.getElementById(id);if(obj&&obj.nodeName=="EMBED"){if(Prototype.Browser.IE){obj.style.display="none";(function(){if(obj.readyState==4){Auth.removeObjectInIE(id);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.removeChild(obj);}}},removeObjectInIE:function(id){var obj=document.getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null;}}
obj.parentNode.removeChild(obj);}},reloadSWF:function(){var swf_obj=$('ae_swf');var new_div=document.createElement('div');new_div.id='ae_alternative';swf_obj.parentNode.insertBefore(new_div,swf_obj);Auth.removeSWF('ae_swf');Auth.embedSWF();},login:function(value){Auth.logging_in_as=value;$('ae_swf').setSelectedProvider(value);},linkAction:function(action){switch(action){case Auth._ACTIONS.SIGN_OUT:new Ajax.Request('/authenticate/unauthenticate_with_mvpd',{method:'post',onComplete:function(){Auth.setCookie('',0);$('ae_swf').logout();}});break;case Auth._ACTIONS.REMOVE_LINK:new Ajax.Request('/authenticate/unauthenticate_with_mvpd',{method:'post',onComplete:function(){Auth.setCookie('',0);window.location.href=window.location.href;}});break;case Auth._ACTIONS.LEARN_MORE:window.location='/authenticate';break;}},setCookie:function(mvpd,expires){Behaviors.setCookie('_hulu_auth',mvpd+'-'+expires,365,Base.commonCookieDomain());},getCookie:function(){var auth_cookie=Behaviors.getCookie('_hulu_auth');if(auth_cookie){auth_cookie=auth_cookie.split('-');if(auth_cookie.length==2){c={'mvpd':auth_cookie[0],'expires':parseInt(auth_cookie[1])};c['authenticated']=(c['mvpd']in Auth.PROVIDERS)&&(c['expires']>(new Date()).getTime());return c;}}
return{'mvpd':'','expires':0,'authenticated':false};},setExpiresMessage:function(){var auth_until=$('ae_authenticated_until');var auth_cookie=Auth.getCookie();var expires_date=new Date(auth_cookie['expires']);auth_until.innerHTML='You will need to reconnect on: <br/><b>'+
expires_date.toLocaleDateString()+'</b>';},hideIFrame:function(){$$('.overlay-full')[0].hide();$('ae_provider_selector').hide();$('ae_user_authenticated').innerHTML='';$('ae_link').innerHTML='';var mvpddiv=$('ae_mvpddiv');mvpddiv.style.visibility='hidden';var iframe=$('ae_mvpdframe');iframe.parentNode.removeChild(iframe);Auth.reloadSWF();},authenticated:function(){return Auth.getCookie()['authenticated'];},ensureStatus:function(){if(Auth.authenticated()){Auth.offPageLogout(window.location.href);}},offPageLogout:function(reloadURL){if(Auth.swf_embedded){Auth.removeSWF('ae_swf');}
var frame=document.createElement('iframe');frame.height=1;frame.width=1;frame.src='/authenticate/logout?reload='+encodeURIComponent(reloadURL);frame.height=1;frame.width=1;document.body.appendChild(frame);},setBrandingForAuthVideo:function(){if(!Behaviors.isPlusUser()&&Auth.authenticated()){var title_logo=$('auth-title-logo')
if(title_logo){title_logo.show();$$('.plus-availability-notes').each(Element.hide);var mvpd=Auth.getCookie()['mvpd'];if(mvpd in Auth.PROVIDERS){title_logo.down('span',1).style.background="url('"+Auth.PROVIDERS[mvpd]['grayLogo']+"') bottom left no-repeat";}}}},loadAuthProviderLogos:function(){var mvpd=Auth.getCookie()['mvpd'];if(mvpd in Auth.PROVIDERS){$$('img.auth-provider-logo').each(function(e){e.src=Auth.PROVIDERS[mvpd]['logoImage'];e.alt=Auth.PROVIDERS[mvpd]['displayName'];});$$('auth-grey-logo').each(function(e){e.style.background='url("'+Auth.PROVIDERS[mvpd]['greyLogo']+'")';});}}});document.observe('hulu:loggedOut',Auth.ensureStatus);document.observe('dom:loaded',Auth.loadAuthProviderLogos);
var Affiliate=Class.create();Object.extend(Affiliate,{path:window.location.pathname,query_params:window.location.search.toQueryParams(),cookies:{'partner':{name:'_hulu_plus_affiliate',ttl:30,url:true},'cmp':{name:'_hulu_plus_cmp',ttl:30,url:true},'product':{name:'_partner_product',ttl:30,url:false}},set_cookie:function(qs,val){if(val==undefined){val=Affiliate.query_params[qs];if(val==undefined)return;}
var cookie=Affiliate.cookies[qs];Behaviors.setCookie(cookie.name,val,cookie.ttl,Base.commonCookieDomain());if(cookie.url){var url=document.referrer;if(url==null||url.blank())url=document.location.href;Behaviors.setCookie(cookie.name+'_url',url,cookie.ttl,Base.commonCookieDomain());}},set_cookies:function(){Affiliate.set_cookie('partner');Affiliate.set_cookie('cmp');if(Affiliate.query_params['partner']=='cj'){var partner_product=['AID','PID','SHID'].map(function(k){return Affiliate.query_params[k];}).join('|');Affiliate.set_cookie('product',partner_product);}
else if(Affiliate.query_params['partner']=='trialpay'){var partner_product=Affiliate.query_params['subid'];Affiliate.set_cookie('product',partner_product);}
else if(Affiliate.query_params['partner']=='yidio'){var partner_product=Affiliate.query_params['aid'];Affiliate.set_cookie('product',partner_product);}}});Event.observe(window,"load",Affiliate.set_cookies);
var Banner=Class.create();Object.extend(Banner,{banner:null,image_tag:null,normal_image_path:'',hover_image_path:'',disable_promos:false,assets:[],assets_for_classic_users:[{filename:'banner-new-appletv.jpg?v5',href:'/plus/appletv?src=homepage-appletv',regionName:'ClassicAppleTV'},{filename:'banner-new-ps3.jpg?v2',href:'/plus?src=homepage-ps3',regionName:'ClassicPS3'},{filename:'banner-new-roku.jpg?v2',href:'/plus?src=homepage-roku',regionName:'ClassicRoku'},{filename:'banner-new-wii.jpg?v2',href:'/plus?src=homepage-wii',regionName:'ClassicWii'},{filename:'banner-new-xbox.jpg?v2',href:'/plus?src=homepage-xbox',regionName:'ClassicXbox'},{filename:'banner-new-new-girl.jpg?v5',href:'/plus?show=new-girl&src=homepage-new-girl',regionName:'ClassicNewGirl'},{filename:'banner-new-snl.jpg?v5',href:'/plus?show=saturday-night-live&src=homepage-snl',regionName:'ClassicSNL'}],assets_for_plus_users:[{filename:'plus-banner-referral.jpg',href:'/profile/referrals?src=homepage-referral',regionName:'PlusReferral',limiter:{max_views:1,expiration_cookie:"bex_referral",counter_cookie:"bsc_referral"}},{filename:'plus-banner-appletv.jpg?v5',href:'/plus/devices?src=homepage-appletv',regionName:'PlusAppleTV',limiter:{max_views:1,expiration_cookie:"bex_appletv",counter_cookie:"bsc_appletv"}},{filename:'plus-banner-ps3.jpg',href:'/plus/devices?src=homepage-ps3',regionName:'PlusPS3',limiter:{max_views:1,expiration_cookie:"bex_ps3",counter_cookie:"bsc_ps3"}},{filename:'plus-banner-roku.jpg',href:'/plus/devices?src=homepage-roku',regionName:'PlusRoku',limiter:{max_views:1,expiration_cookie:"bex_roku",counter_cookie:"bsc_roku"}},{filename:'plus-banner-wii.jpg',href:'/plus/devices?src=homepage-wii',regionName:'PlusWii',limiter:{max_views:1,expiration_cookie:"bex_wii",counter_cookie:"bsc_wii"}},{filename:'plus-banner-xbox.jpg',href:'/plus/devices?src=homepage-xbox',regionName:'PlusXbox',limiter:{max_views:1,expiration_cookie:"bex_xbox",counter_cookie:"bsc_xbox"}},{filename:'banner-gifting.jpg',href:'/plus/gifting?src=homepage',regionName:'PlusGifting',limiter:{max_views:1,expiration_cookie:"bex_gift",counter_cookie:"bsc_gift"}}],assets_for_latino_classic_users:[{filename:'banner-gifting-esp.jpg',href:'/plus/gifting?src=latino',regionName:'ClassicLatinoGifting'},{filename:'banner-ps3-esp.jpg',href:'/plus/latino?src=homepage-ps3-latino',regionName:'ClassicLatinoPS3'},{filename:'banner-roku-esp.jpg',href:'/plus/latino?src=homepage-roku-latino',regionName:'ClassicLatinoRoku'},{filename:'banner-wii-esp.jpg',href:'/plus/latino?src=homepage-wii-latino',regionName:'ClassicLatinoWii'},{filename:'banner-xbox-esp.jpg',href:'/plus/latino?src=homepage-xbox-latino',regionName:'ClassicLatinoXbox'}],assets_for_latino_plus_users:[{filename:'plus-banner-ps3-esp.jpg',href:'/plus/devices?src=homepage-ps3-latino',regionName:'PlusLatinoPS3',limiter:{max_views:1,expiration_cookie:"bex_ps3",counter_cookie:"bsc_ps3"}},{filename:'plus-banner-roku-esp.jpg',href:'/plus/devices?src=homepage-roku-latino',regionName:'PlusLatinoRoku',limiter:{max_views:1,expiration_cookie:"bex_roku",counter_cookie:"bsc_roku"}},{filename:'plus-banner-wii-esp.jpg',href:'/plus/devices?src=homepage-wii-latino',regionName:'PlusLatinoWii',limiter:{max_views:1,expiration_cookie:"bex_wii",counter_cookie:"bsc_wii"}},{filename:'plus-banner-xbox-esp.jpg',href:'/plus/devices?src=homepage-xbox-latino',regionName:'PlusLatinoXbox',limiter:{max_views:1,expiration_cookie:"bex_xbox",counter_cookie:"bsc_xbox"}}],getPromoAsset:function(){if(Banner.disable_promos)return null;return null;},init:function(){this.banner=$('footer-banner');if(!this.banner)return;var use_plus_assets=Behaviors.isLoggedIn()&&Behaviors.isPlusUser();var use_latino_assets=(window.location.pathname=="/latino");if(use_latino_assets){if(use_plus_assets){this.assets=this.assets_for_latino_plus_users;}else{this.assets=this.assets_for_latino_classic_users;}}else{if(use_plus_assets){this.assets=this.assets_for_plus_users;}else{this.assets=this.assets_for_classic_users;}}
if(this.assets.length==0)return;var banner_index=Math.floor(Math.random()*this.assets.length),asset=this.getPromoAsset()||this.assets[banner_index];if(asset.limiter!=undefined){var expiration_cookie=asset.limiter.expiration_cookie,counter_cookie=asset.limiter.counter_cookie,max_views=asset.limiter.max_views;if(Behaviors.getCookie(expiration_cookie)){if(Behaviors.getCookie(counter_cookie)){var view_count=parseInt(Behaviors.getCookie(counter_cookie));if(view_count<max_views){this.render(asset);Behaviors.setCookie(counter_cookie,++view_count,7);}}}else{this.render(asset);Behaviors.setCookie(counter_cookie,1,7);Behaviors.setCookie(expiration_cookie,1,7);}}else{this.render(asset);}},render:function(asset){var link_attrs='';if(asset.href!=undefined){link_attrs="href='"+asset.href+"' onclick='Beacon.trackThumbnailClick(this); _gaq.push([\"_trackEvent\", \"MastheadFooter\", \"MastheadFooterClick\", \""+asset.regionName+"\"]);' "+"class='beaconid beacontype' beaconid='"+asset.href+"' beacontype='link'";}else{return;}
var html="<a "+link_attrs+">"+"<img id='footer-banner-img' src='/images/banners/"+asset.filename+"' style='cursor: pointer;'>"+"</a>";this.banner.setAttribute('beaconregion',asset.regionName);this.banner.update(html);this.image_tag=this.banner.down('img');this.normal_image_path=this.image_tag.readAttribute('src');this.hover_image_path=this.normal_image_path.sub(/\/([\w\-]+)\.(jpg|png|gif(?:\?|$))/,function(match){return'/'+match[1]+'-hover.'+match[2];});this.banner.observe('mouseover',function(e){Banner.image_tag.writeAttribute('src',Banner.hover_image_path);});this.banner.observe('mouseout',function(e){Banner.image_tag.writeAttribute('src',Banner.normal_image_path);});this.banner.show();},show:function(){this.banner.show();},hide:function(){this.banner.hide();}});
var FindFriends=Class.create();Object.extend(FindFriends,{init:function(){FindFriends.EmailInvite.init();FindFriends.Importer.init();},validate:{email_format:function(value){return Support.rfc822Email.test(value);},presence:function(value){return!value.blank();}}});FindFriends.Importer=Class.create();Object.extend(FindFriends.Importer,{auth_urls:null,init:function(){FindFriends.Importer.setup_email_services();},reset_tab:function(li){li.removeClassName('selected');li.select('form li').each(function(form_li){form_li.removeClassName('error');});li.select('.inline-error').each(function(span){span.update('');});Watermark.reset(li.down('form'));new Effect.SlideUp(li.down('.accordian-content'),{duration:.1,queue:'start'});li.down('.auth-container').show();li.down('.accordian-tab').show();li.down('.call-to-action').show();var contacts_container=li.down('.contacts-container');if(contacts_container)contacts_container.hide();var no_contacts=li.down('.no-contacts');if(no_contacts)no_contacts.hide();var invites_container=li.down('.invites-container');if(invites_container)invites_container.hide();var no_invites=li.down('.no-invites');if(no_invites)no_invites.hide();$('find-friends-progress').removeClassName('add-friends').removeClassName('invite-friends');},fetch_auth_urls:function(){new Ajax.Request('/contact_lists/fetch_authentication_urls',{parameters:{services:'google,windows'},method:'get',onSuccess:function(transport){FindFriends.Importer.auth_urls=transport.responseText.evalJSON();}});},show_auth_popup:function(service){var settings='';var url='';switch(service){case"windows":settings=Friend.WINDOWS_SETTINGS;url=FindFriends.Importer.auth_urls.windows;break;case"google":settings=Friend.GOOGLE_SETTINGS;url=FindFriends.Importer.auth_urls.google;break;case"yahoo":settings=Friend.YAHOO_SETTINGS;url=FindFriends.Importer.auth_urls.yahoo;break;case"aol":settings=Friend.YAHOO_SETTINGS;url=FindFriends.Importer.auth_urls.aol;break;default:return false;}
Friend.pop(url,settings);},setup_email_services:function(){var ul=$('email-services');if(ul==null)return false;FindFriends.Importer.fetch_auth_urls();ul.select('form').each(function(form){form.observe('submit',function(e){var service=form.down('input[name=service]').value;FindFriends.Importer.show_auth_popup(service);form.request({onSuccess:function(transport){FindFriends.Importer.clear_inline_errors(form);}});Event.stop(e);});});},clear_inline_errors:function(form){form.select('.inline-error').each(function(inline_error){inline_error.update('');});form.select('li').each(function(li){li.removeClassName('error');});},add_friends_step:function(params){var service_container=$(params.s+'-container');var auth_container=service_container.down('.auth-container');var contacts_container=service_container.down('.contacts-container');auth_container.hide();service_container.down('.accordian-tab').hide();contacts_container.show();new Ajax.Request('/contact_lists/fetch_contacts',{parameters:params,method:'get',onSuccess:function(transport){var response=transport.responseText.evalJSON();$('find-friends-progress').addClassName('add-friends');FindFriends.Importer.render_contacts_list(contacts_container,response);}});},render_contacts_list:function(contacts_container,response){contacts_container.down('.contacts-header a.close-link').observe('click',function(e){FindFriends.Importer.reset_tab(contacts_container.up('li.service'));});var contact_ids=response.contact_ids.split('|').reject(function(cid){return cid==''});if(contact_ids.length>0){contacts_container.down('a.add-all-link').observe('click',function(e){FindFriends.Importer.add_friends(response.service,response.contact_ids,response.invite_users);Event.stop(e);});contacts_container.down('a.skip-link').observe('click',function(e){FindFriends.Importer.invite_friends_step(response.service,response.invite_users);Event.stop(e);});contacts_container.down('.contacts-list').update(response.list);contacts_container.down('.loading').hide();contacts_container.up('li.service').down('.accordian-tab').hide();contacts_container.up('li.service').down('.accordian-content').show();new Effect.BlindDown(contacts_container.down('.contacts-content'),{duration:.2,queue:'end'});}else{contacts_container.down('.no-contacts a.invite-friends-link').observe('click',function(e){FindFriends.Importer.invite_friends_step(response.service,response.invite_users);Event.stop(e);});contacts_container.down('.loading').hide();contacts_container.up('li.service').down('.accordian-tab').hide();contacts_container.down('.no-contacts').show();}},add_friends:function(service,contact_ids,invite_users){new Ajax.Request('/contact_lists/add_friends',{parameters:{contact_ids:contact_ids,service:service},onSuccess:function(transport){var service_container=$(service+'-container');var contact_ids_array=contact_ids.split('|');if(contact_ids_array.length>1){service_container.select('a.add-contact-link').each(function(a){a.replace("<span class='friend-added'>added</span>");});var invite_step=function(){FindFriends.Importer.invite_friends_step(service,invite_users);};setTimeout(invite_step,1000);}else{var add_contact_link=service_container.down('#contact-'+contact_ids_array[0]+' a.add-contact-link');add_contact_link.replace("<span class='friend-added'>added</span>");}}});},invite_friends_step:function(service,invite_users){$('find-friends-progress').removeClassName('add-friends').addClassName('invite-friends');FindFriends.Importer.render_invites_list(service,invite_users);},render_invites_list:function(service,invite_users){var service_container=$(service+'-container');service_container.down('.invites-header a.close-link').observe('click',function(e){FindFriends.Importer.reset_tab(service_container);Event.stop(e);});var invite_users_array=invite_users.split('|').reject(function(u){return u==''});if(invite_users_array.length>0){var html=invite_users_array.map(function(user){user=user.split(',');return"<li class='invite-user clearfix'>"+"<span class='name'>"+user[0]+"</span>"+"<span class='email'>"+user[1]+"</span>"+"<a class='invite-link' href='#' onclick=\"FindFriends.Importer.invite_friends(this, '"+service+"', '"+user[1]+"'); return false;\">invite</a>"+"</li>";}).join('');var invites_list=service_container.down('ul.invites-list');invites_list.update(html);var invite_emails=invite_users_array.map(function(user){user=user.split(',');return user[1];}).join('|');service_container.down('a.invite-all-link').observe('click',function(e){FindFriends.Importer.invite_friends(this,service,invite_emails);Event.stop(e);});service_container.down('.contacts-container').hide();service_container.down('.invites-container').show();new Effect.BlindDown(service_container.down('.invites-content'),{duration:.2,queue:'end'});}else{service_container.down('.contacts-container').hide();service_container.down('.invites-container').show();service_container.down('.no-invites').show();}},invite_friends:function(invite_link,service,invite_emails){new Ajax.Request('/contact_lists/invite_friends',{parameters:{invite_emails:invite_emails,service:service},onSuccess:function(transport){var service_container=$(service+'-container');var invite_emails_array=invite_emails.split('|');if(invite_emails_array.length>1){service_container.select('a.invite-link').each(function(a){a.replace("<span class='invite-sent'>invite sent</span>");});}else{invite_link.replace("<span class='invite-sent'>invite sent</span>");}}});}});FindFriends.EmailInvite=Class.create();Object.extend(FindFriends.EmailInvite,{init:function(){FindFriends.EmailInvite.setup_form();},setup_form:function(){var form=$('email-invites-form');if(form){var emails_field=form.down('#emails');if(emails_field){new Watermark(emails_field,"Friends' emails");}
form.observe('submit',function(e){var errors=$H();if(emails_field){var emails=emails_field.value;if(!FindFriends.validate.presence(emails_field.value)){errors=errors.merge({emails:'Please enter some email addresses'});}else{emails=emails.split("\n").without('').map(function(e){return e.strip();});emails.each(function(email){if(!FindFriends.validate.email_format(email)){errors=errors.merge({emails:'Email format is invalid'});}});}
if(errors.keys().length<=0){form.request({onSuccess:function(transport){var invite_notice=$$('#email-invite .notice').first();invite_notice.update('Invites sent');new Effect.BlindDown(invite_notice,{duration:0.2});setTimeout(function(){new Effect.BlindUp(invite_notice,{duration:1});},2000);form.down('.inline-error').update('');form.down('li').removeClassName('error');Watermark.reset(form);},onFailure:function(transport){ModalPopup.warn("There was a problem processing the email invites.");}});}else{errors.each(function(field){var li=form.down('li.'+field.key+'-field');if(li){li.addClassName('error');li.down('.inline-error').update(field.value).show();}});}}
Event.stop(e);});}}});var Watermark=Class.create();Object.extend(Watermark,{reset:function(form,soft){form.select('input[type=text], input[type=password], textarea').each(function(input){if(!(/password-default/).test(input.readAttribute('name'))){if(soft){input.simulate('blur');}else{input.clear().simulate('blur');}}});}});Object.extend(Watermark.prototype,{initialize:function(field,text){if(field==undefined||field==null)return false;this.input=field;this.text=text;this.dummy=null;this.apply();},apply:function(){if(this.input.readAttribute('type')=='password'){this.input.insert({before:"<input id='"+this.input.id+"-default' type='text' name='password-default' />"});this.input.hide();this.dummy=this.input.previous();this.dummy.value=this.text;this.dummy.setStyle({color:'#959595'});this.dummy.observe('focus',(function(e){this.dummy.hide();this.input.show();this.input.focus();}).bind(this));this.input.observe('blur',(function(e){if(this.input.value==''){this.input.hide();this.dummy.show();}}).bind(this));}else{this.input.value=this.text;this.input.setStyle({color:'#959595'});this.input.observe('focus',(function(e){if(this.input.value==this.text){this.input.clear();}
this.input.setStyle({color:'#000'});}).bind(this));this.input.observe('blur',(function(e){if(this.input.value==''){this.input.value=this.text;this.input.setStyle({color:'#959595'});}}).bind(this));}
var form=this.input.up('form');form.observe('submit',(function(e){if(this.input.value==this.text)this.input.clear();}).bind(this));}});
var LiveTweet=Class.create();Object.extend(LiveTweet,{watermark:'Ask the panel a question',hashtag:'hululive',char_limit:null,field:null,autogrowth:null,reset:false,init:function(){var container=$('live-tweet-container');if(container==null)return;var form=container.down('form');LiveTweet.field=form.down('textarea[name=tweet]');LiveTweet.setup_char_counter();new Watermark(LiveTweet.field,LiveTweet.watermark);LiveTweet.autogrowth=new TextArea.AutoGrowth(LiveTweet.field,LiveTweet.char_limit);container.appear({duration:.2});form.observe('submit',function(e){var tweet=LiveTweet.field.value;if(tweet==''){$('tweet-error').update('Please enter a tweet').addClassName('comment_error');$('tweet-meta').addClassName('error');LiveTweet.reset=true;}else{LiveTweet.tweet(tweet);}
Event.stop(e);});$$('a.reset-tweet-link').first().observe('click',function(e){LiveTweet.reset_form();Event.stop(e);});},setup_char_counter:function(){var hashtag_string=' #'+LiveTweet.hashtag;LiveTweet.char_limit=140-hashtag_string.length;$('remaining-chars').update(LiveTweet.char_limit);LiveTweet.field.observe('keyup',function(e){var tweet_error=$('tweet-error'),remaining_chars=LiveTweet.char_limit-LiveTweet.field.value.length;$('remaining-chars').update(remaining_chars);if(LiveTweet.reset)LiveTweet.reset_errors();if(tweet_error==undefined)return false;if(remaining_chars<0){tweet_error.update('Tweet is too long').addClassName('comment_error');$('tweet-meta').addClassName('error');}else{LiveTweet.reset_errors();}});},tweet:function(text){var tweetUrl='https://twitter.com/intent/tweet?hashtags='+LiveTweet.hashtag+'&text='+text;window.open(tweetUrl);var fbSelected=false,twitterSelected=true;Beacon.trackComment(fbSelected,twitterSelected,text.length,-1,0,0);LiveTweet.reset_form();},reset_form:function(){LiveTweet.field.clear();LiveTweet.autogrowth.resize();Watermark.reset(LiveTweet.field.up('form'));$('remaining-chars').update(LiveTweet.char_limit);LiveTweet.reset_errors();},reset_errors:function(){$('tweet-meta').removeClassName('error');$('tweet-error').update('').removeClassName('comment_error');}});
var Perf=Class.create();Object.extend(Perf,{startTime:null,domLoadedTime:null,windowLoadedTime:null,playingTime:null,init:function(){if(typeof(_startTime)=="undefined")return;Perf.startTime=_startTime;Event.observe(document,'dom:loaded',function(){if(Perf.startTime!=null){Perf.domLoadedTime=(new Date).getTime()-Perf.startTime;}
Perf.fireHomepageBeacon();});Event.observe(window,"load",function(){if(Perf.startTime!=null){Perf.windowLoadedTime=(new Date).getTime()-Perf.startTime;}
Perf.fireHomepageBeacon();});},fireHomepageBeacon:function(){if(window.location.pathname=='/'){if(Perf.isSampleUser()&&Perf.timeValid(Perf.domLoadedTime)&&Perf.timeValid(Perf.windowLoadedTime)){Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_PERF,{domloadtime:Perf.domLoadedTime,windowloadtime:Perf.windowLoadedTime});}}},timeValid:function(t){return(t!=null&&t>0);},isSampleUser:function(){if(Beacon.production){var guid=Behaviors.getGUID();return parseInt(guid.substr(0,4),16)%10==0;}
else{return true;}},setPlayingTime:function(){if(Perf.startTime!=null){Perf.playingTime=(new Date).getTime()-Perf.startTime;}
if(/^\/watch\/[0-9]+/.test(window.location.pathname)){if(Perf.isSampleUser()&&Perf.timeValid(Perf.domLoadedTime)&&Perf.timeValid(Perf.windowLoadedTime)&&Perf.timeValid(Perf.playingTime)){Beacon.trackStandardBeacon(Beacon.TYPE_SITE,Beacon.EVENT_PERF,{domloadtime:Perf.domLoadedTime,windowloadtime:Perf.windowLoadedTime,playingtime:Perf.playingTime});}}},validatePerf:function(){if(document.domain.indexOf("huluqa.com")!=-1){if((Perf.domLoadedTime>100000)||(Perf.windowLoadedTime>100000)||(Perf.playingTime>100000)){alert("We're tracking a bug and you have a repro! Please contact eusden@hulu.com if you see this message. startTime = "+
Perf.startTime+", domTime = "+Perf.domLoadedTime+", windowTime = "+Perf.windowLoadedTime+", playerTime = "+Perf.playingTime+".  If you're in Beijing, please don't close your browser.");}}}});Perf.init();
var CssHover=Class.create();Object.extend(CssHover,{init:function(){Event.observe(window,'load',function(){CssHover.makeSandy();});Ajax.Responders.register({onComplete:CssHover.makeSandy});},css_toggle_over:function(el){var css_sprite_el=$(el);if(!css_sprite_el)return;if(!css_sprite_el.className.match(/-hover/))
css_sprite_el.className=css_sprite_el.className.replace(/(-over)/g,'')+'-hover';},css_toggle_out:function(el){var css_sprite_el=$(el);if(!css_sprite_el)return;if(css_sprite_el.className.match(/-hover/))
css_sprite_el.className=css_sprite_el.className.replace(/-hover/g,'');},makeSandy:function(){$$('.css-hover-me').each(function(el){var css_sprite_el=$(el);css_sprite_el.removeClassName('css-hover-me');if(!css_sprite_el.style.width&&!css_sprite_el.style.height){var dims=css_sprite_el.getDimensions();css_sprite_el.style.width=dims.width+"px";css_sprite_el.style.height=dims.height+"px";}
css_sprite_el.observe('mouseover',function(event){CssHover.css_toggle_over(css_sprite_el);});css_sprite_el.observe('mouseout',function(event){CssHover.css_toggle_out(css_sprite_el);});});}});CssHover.init();
HumanCode={INVALID_CHARS_REGEX:/[^0-9A-KMNP-SU-Z]/i,SHOULD_BE_REGEXS:{"I":/[TL]/i,"Q":/[O]/i},instances:{},init:function(){$$('form.human-code-form').each(function(form){HumanCode.instances[form.id]={form:form,msg_element:form.down('.human-code-msg'),title_element:form.down('.human-code-title'),autoTab:false};});},getInstance:function(e){var target=(e.currentTarget)?e.currentTarget:e.srcElement;return HumanCode.getInstanceForForm($(target).up('form.human-code-form'));},getInstanceForForm:function(form){return(form.id in HumanCode.instances)?HumanCode.instances[form.id]:null;},limitInputChars:function(e,part,name){instance=HumanCode.getInstance(e);if(instance==null)return false;var character=String.fromCharCode(e.which==undefined?e.keyCode:e.which);var printable=/[\x20-\x7e]/.test(character)&&!e.ctrlKey&&!e.metaKey&&!e.altKey;var invalid_char=HumanCode.INVALID_CHARS_REGEX.test(character);var target=e.target?e.target:e.srcElement;var sel_start,sel_end;if(target.selectionStart==undefined){var bookmark=document.selection.createRange().getBookmark();var sel=target.createTextRange();var bfr=sel.duplicate();sel.moveToBookmark(bookmark);bfr.setEndPoint("EndToStart",sel);sel_start=bfr.text.length;sel_end=sel_start+sel.text.length;}else{sel_start=target.selectionStart;sel_end=target.selectionEnd;}
if(printable&&invalid_char){var msg="Sorry, the character '"+character+"' is invalid in a "+name+".";for(var c in HumanCode.SHOULD_BE_REGEXS){if(HumanCode.SHOULD_BE_REGEXS[c].test(character)){character=c;invalid_char=false;msg+=" Did you mean '<span style='font-family:monospace;'>"+c+"</span>'?";}}
if(instance.title_element!=null){instance.title_element.hide();}
instance.msg_element.innerHTML=msg;instance.msg_element.width="auto";instance.msg_element.show();}
if(printable){if(!invalid_char){if(sel_start!=sel_end||target.value.length<4){target.value=target.value.substring(0,sel_start)+character.toUpperCase()+
target.value.substring(sel_end);if(sel_start<target.value.length+1){var offset=sel_start+1;if(target.selectionStart==undefined){if(sel_start==sel_end){if(sel_start==0&&target.value.length>1){offset=1-target.value.length;}else if(target.value.length==4){offset=sel_start-3;}else if(target.value.length==3&&sel_start==1){offset=-1;}}
var sel=document.selection.createRange();sel.move("character",offset);sel.select();}else{target.selectionStart=offset;target.selectionEnd=offset;}}
if(part<2&&target.value.length==4&&sel_start==sel_end&&sel_start==3){instance.form.down(".codePart"+(part+1)).focus();instance.autoTab=true;}}}
return false;}else{return true;}},onInput:function(e,part){instance=HumanCode.getInstance(e);if(instance==null)return false;if(window.clipboardData!=undefined)return true;var target=e.target?e.target:e.srcElement;var val=target.value.toUpperCase();val=val.gsub(HumanCode.INVALID_CHARS_REGEX,'');HumanCode.setCode(e,val,part);return false;},onPaste:function(e,part){instance=HumanCode.getInstance(e);if(instance==null)return false;if(window.clipboardData==undefined)return true;var target=e.target?e.target:e.srcElement;var bookmark=document.selection.createRange().getBookmark();var sel=target.createTextRange();var bfr=sel.duplicate();sel.moveToBookmark(bookmark);bfr.setEndPoint("EndToStart",sel);var sel_start=bfr.text.length;var sel_end=sel_start+sel.text.length;var val=window.clipboardData.getData("Text").toUpperCase();var len=val.length;val=val.gsub(HumanCode.INVALID_CHARS_REGEX,'');val=target.value.substring(0,sel_start)+val+
target.value.substring(sel_end);HumanCode.setCode(e,val,part);return false;},keyDown:function(e){instance=HumanCode.getInstance(e);if(instance==null)return false;if(e.keyCode==Event.KEY_TAB){var target=e.target?e.target:e.srcElement;if(target.value.length==0&&instance.autoTab){instance.autoTab=false;return false;}}
instance.autoTab=false;return true;},setCode:function(e,value,part){instance=HumanCode.getInstance(e);if(instance==null)return false;if(part==undefined)part=0;for(var i=part;i<3;i++){var element=instance.form.down(".codePart"+i);if((part==i||element.value.length==0)&&value.length>0){element.value=value.substring(0,4);value=value.substring(4);element.focus();}else{break;}}},getCode:function(form){instance=HumanCode.getInstanceForForm(form);if(instance==null)return null;var value="";for(var i=0;i<3;i++){value+=instance.form.down(".codePart"+i).value;}
return value;}}
var AdZone=Class.create();Object.extend(AdZone,{Playlist:null,Video:null,player:null,pagers:[],playlists:[],first_video_content_id:null,current_playlist:null,current_video_index:null,next_video_index:null,state:null,debug:true,staging_env:true,page:null,video:null,init:function(first_video_content_id){AdZone.first_video_content_id=first_video_content_id;AdZone.staging_env=$('adzone-page').readAttribute('data-env')=='true'?true:false;AdZone.state=$('adzone-page').readAttribute('data-adzone-state');AdZone.mushy_mush=$('adzone-page').readAttribute('data-mushy-mush');AdZone.setup_player();AdZone.setup_playlists();AdZone.setup_first_playlist();AdZone.setup_discovery();Event.observe(window,'popstate',function(ev){if(ev&&ev.state!=null&&ev.state.type=='adzone'){if(AdZone.page==ev.state.page_data){AdZone.play_video(ev.state.video_data);new Effect.ScrollTo('adzone-page',{duration:0.1});}else{AdZone.change_discovery_page(ev.state.page_data,false);}
Event.stop(ev);}});},setup_player:function(){AdZone.player=AdZonePlayer.init('adzone-player',AdZone.staging_env,AdZone.state,AdZone.mushy_mush);AdZone.registerReady=function(){AdZone.play_first_video();AdZone.loadBanner();}},setup_playlists:function(){$$('.shelf, .grid, #leaderboard-container').each(function(container){AdZone.playlists.push(new AdZone.Playlist(container));});},setup_first_playlist:function(){AdZone.current_playlist=AdZone.playlists.first();},setup_discovery:function(){AdZone.setup_navigation();AdZone.setup_sort();AdZone.setup_pagination();AdZone.setup_thumbnails();AdZone.setup_add_to_favorites();if(AdZone.current_video_index!=null){var current_video=AdZone.current_playlist.videos[AdZone.current_video_index];if($$('.carousel[data-playlist-name='+AdZone.current_playlist.name+']').length>0){AdZone.mark_playing(current_video);}}},setup_navigation:function(){AdZone.page=$$('li.menu-item.selected').first().readAttribute('data-page');$$('ul.navigation li.menu-item a').each(function(a){a.observe('click',function(ev){var page_name=Event.element(ev).up('li.menu-item').readAttribute('data-page');AdZone.change_discovery_page(page_name,true);Event.stop(ev);});});},setup_pagination:function(){$$('.pagination').each(function(elem){AdZone.pagers.push(new Pager(elem));});},setup_thumbnails:function(){$$('li.video a').each(function(a){a.observe('click',function(ev){var playlist_name=a.up('.shelf, .grid, #leaderboard-container').readAttribute('data-playlist-name');var playlist=AdZone.playlists.find(function(pl){return pl.name==playlist_name;});var video_id=a.readAttribute('data-video-id');var video=playlist.videos.find(function(v){return v.video_id==video_id;});AdZone.play(video);new Effect.ScrollTo('adzone-page',{duration:0.1});Event.stop(ev);});});},setup_sort:function(){var li_video_template=new Template(['<li class="video">','<a href="#{href}" data-video-id="#{video_id}" data-content-id="#{content_id}" data-title="#{title}" data-thumbnail-url="#{thumbnail_url}" data-video-index="#{video_index}">','<span class="play-button"></span>','<img src="#{thumbnail_url}">','<span class="title">#{title}</span>','</a>','</li>'].join(""));$$('ul.sort-actions a').each(function(a){a.observe('click',function(ev){var sort_link=Event.element(ev),sort=sort_link.readAttribute('class'),sort_list=sort_link.readAttribute('data-sort-list').split(','),container=sort_link.up('.content-container').down('.carousel');container.select('.paged-content').each(function(div){div.hide();});container.down('.'+sort+'-sort').show();a.up('ul.sort-actions').select('li').each(function(li){li.removeClassName('selected');});a.up('li').addClassName('selected');var playlist_name=container.readAttribute('data-playlist-name');if(AdZone.current_playlist.name==playlist_name){AdZone.current_playlist.sort(sort_list);}
Event.stop(ev);});});$$('ul.sort-actions a').each(function(a){var container=a.up('.content-container').down('.carousel'),default_sort=container.readAttribute('data-sort'),sort=a.readAttribute('class'),sort_list=a.readAttribute('data-sort-list').split(',');if(a.hasClassName(default_sort)){a.up('li').addClassName('selected');}
if(default_sort==sort)return;var playlist_name=container.readAttribute('data-playlist-name'),playlist=AdZone.playlists.find(function(p){return p.name==playlist_name;}),videos=playlist.videos;var sorted_html=sort_list.eachSlice(20).map(function(page){var page_content=page.map(function(video_id,index){var video=playlist.videos.find(function(v){return v.video_id==video_id;});return li_video_template.evaluate(Object.extend(video));}).join('');return'<ol class="videos clearfix">'+page_content+'</ol>';}).join('');container.insert({top:"<div class='"+sort+"-sort paged-content clearfix' style='display:none;'>"+
sorted_html+"</div>"});});},setup_add_to_favorites:function(){if($('add-to-favorites-button')){$('add-to-favorites-button').observe('click',function(ev){var link=Event.element(ev);Subscription.toggle_popup(link,link.readAttribute('data-show-name'),link.readAttribute('data-show-canonical-name'),link.readAttribute('data-show-id'),true);});}},play:function(video){AdZone.play_video(video);AdZone.update_address_bar(false);},play_video:function(video){AdZone.video=video;AdZone.update_indices(video);AdZone.update_page_title(video);AdZone.update_video_title(video.title);AdZone.update_video_sharing(video);AdZone.update_fblike(video);AdZone.mark_playing(video);AdZone.player.send('playVideo',video.content_id);},update_indices:function(video){AdZone.current_playlist=AdZone.playlists.find(function(pl){return pl.name==video.playlist_name;});AdZone.current_video_index=AdZone.current_playlist.videos.indexOf(video);var incremented_video_index=AdZone.current_video_index+1,next_playlist_video_index=incremented_video_index.mod(AdZone.current_playlist.videos.length);if(next_playlist_video_index==0){AdZone.next_video_index=null;}else{AdZone.next_video_index=AdZone.current_playlist.videos.indexOf(AdZone.current_playlist.videos[next_playlist_video_index]);}},update_address_bar:function(first){if(history&&history.pushState){var data={type:'adzone',video_data:AdZone.video,page_data:AdZone.page};var href=AdZone.video.href.replace(/\/adzone\/([^\/]+\/)?watch/,'/adzone/'+AdZone.page+'/watch');href+=window.location.search;if(first&&history.replaceState){history.replaceState(data,'',href);}else if(history.pushState){history.pushState(data,'',href);}}else{window.location.hash=AdZone.video.video_id;}},update_page_title:function(video){document.title='Hulu - AdZone | '+video.title;},update_video_title:function(title){$$('#adzone-title h3').first().update(title);},update_video_sharing:function(video){var video_url='http://www.hulu.com'+video.href;$('tweet-video').stopObserving('click');$('tweet-video').observe('click',function(ev){var content_id=video.content_id;var mushy_mush_ids=AdZone.mushy_mush.split(',').map(function(id){return parseInt(id);});var tweet="Watch '"+video.title.truncate(60)+"' and more #SuperBowl Ads on @hulu #AdZone"+(mushy_mush_ids.include(content_id)?" #MushyMush":"")+".";var share_url='http://twitter.com/share?url='+encodeURIComponent(video_url)+'&text='+encodeURIComponent(tweet);Share.popup(share_url,'adzone','twitter');Event.stop(ev);});$('facebook-video').stopObserving('click');$('facebook-video').observe('click',function(ev){var share_url='http://www.facebook.com/share.php?u='+encodeURIComponent(video_url);Share.popup(share_url,'adzone','facebook');Event.stop(ev);});AdZone.show_video_sharing();},hide_video_sharing:function(){$('video-sharing').hide();},show_video_sharing:function(){$('video-sharing').show();},mark_playing:function(video){AdZone.hide_playing_indicator();var carousel=$$('div[data-playlist-name='+video.playlist_name+']').first();if(!carousel)return;carousel.select('.paged-content, #leaderboard').each(function(container){var video_link=container.down('li.video a[data-video-id='+video.video_id+']'),li=video_link.up('li.video'),now_playing="<span class='now-playing-indicator' style='display:none;'>Now playing</span>";if(container.readAttribute('id')=='leaderboard'){li.down('.title').insert({bottom:now_playing});}else{li.insert({bottom:now_playing});}
new Effect.Appear(li.down('.now-playing-indicator'),{duration:0.2});});},remove_playing_indicator:function(){$$('span.now-playing-indicator').each(function(el){el.remove();});},hide_playing_indicator:function(){$$('span.now-playing-indicator').each(function(el){new Effect.Fade(el,{duration:0.2,afterFinish:function(){el.remove();}});});},play_first_video:function(){var video_id=null;if(/\d+/.test(window.location.hash)){video_id=window.location.hash.gsub('#','');window.location='http://www.hulu'+(AdZone.staging_env?'qa':'')+'.com/adzone/watch/'+video_id;}else{if(/\/watch\/(\d+)/.test(window.location)){video_id=RegExp.$1;}
var video=null;if(video_id==null){video=AdZone.current_playlist.videos.first();}else{AdZone.playlists.each(function(playlist){video=playlist.videos.find(function(v){return v.video_id==video_id;});if(video)throw $break;});}
if(video){AdZone.play_video(video);AdZone.update_address_bar(true);}else if(AdZone.first_video_content_id){AdZone.player.send('playVideo',AdZone.first_video_content_id);}}},loadBanner:function(){var BANNER_FILENAME='http://player'+(AdZone.staging_env?'.qa':'')+'.hulu.com/videopanel/banner.swf',BANNER_HOLDER_ID='banner-ad-container',BANNER_AD_ID='banner-ad',BANNER_WIDTH=185,BANNER_HEIGHT=65,BANNER_AD_URL='http://www.huluad.com/toyota/adzone/toyota_banner_a.swf',REQ_SWF_VER='10.1.0';var swfobject=new SWFObject(BANNER_FILENAME,BANNER_AD_ID,BANNER_WIDTH,BANNER_HEIGHT,REQ_SWF_VER,'');var ad_url=BANNER_AD_URL+"?cb="+Math.random();swfobject.addParam('allowScriptAccess','always');swfobject.addParam('wmode','transparent');swfobject.addVariable('href',encodeURIComponent(ad_url));swfobject.addVariable('displayWidth',BANNER_WIDTH);swfobject.addVariable('displayHeight',BANNER_HEIGHT);swfobject.addVariable('adzone','true');swfobject.write(BANNER_HOLDER_ID);},center_fblike:function(){if(AdZone.votable_video()&&AdZone.state!='pre'&&$('adzone-vote')!=null){$$('#adzone-vote .cta').first().hide();$('fb-like-container').addClassName('centered');}else{$('adzone-vote').hide();}},update_fblike:function(video){if(typeof(FB)=='undefined')return;if(AdZone.votable_video()&&AdZone.state!='pre'&&$('adzone-vote')!=null){var like_container=$('fb-like-container');like_container.hide();like_container.removeClassName('centered');var video_url='http://www.hulu.com'+video.href;$('fb-like-container').innerHTML="<fb:like id='fb-like' href="+video_url+" layout='button_count'></fb:like>";FB.XFBML.parse(document.getElementById('fb-like-container'));$('adzone-vote').show();$$('#adzone-vote .cta').first().show();like_container.appear({duration:0.2});}else{$('adzone-vote').hide();}},change_discovery_page:function(page,record){AdZone.remove_playing_indicator();new Ajax.Request('/adzone/page/'+page+window.location.search,{method:'get',asynchronous:true,onSuccess:function(transport){$('discovery').innerHTML=transport.responseText;AdZone.setup_playlists();AdZone.setup_discovery();$$('.facebook-likes').each(function(e){FB.XFBML.parse(e);});twttr.widgets.load();AdZone.page=page;if(record){AdZone.update_address_bar(false);}}});},votable_video:function(){return(/most-liked|feature-list|2012|leaderboard/.test(AdZone.current_playlist.name));},playNextVideo:function(){if(AdZone.next_video_index){var next_video=AdZone.current_playlist.videos[AdZone.next_video_index];AdZone.play(next_video);}},getNextVideoInfo:function(){if(AdZone.next_video_index){var next_video=AdZone.current_playlist.videos[AdZone.next_video_index],title=next_video.title,thumbnail_url=next_video.thumbnail_url;return{title:title,thumbnailURL:thumbnail_url};}else{return null;}},endCardShown:function(){AdZone.update_video_title('');AdZone.hide_video_sharing();AdZone.center_fblike();AdZone.hide_playing_indicator();},updateCountdown:function(value){},replayVideo:function(content_id){var previous_video=AdZone.current_playlist.videos.find(function(video){return video.content_id==content_id;});AdZone.play(previous_video);},getRank:function(){var value="";new Ajax.Request('/adzone/rank/'+AdZone.video.video_id,{method:'get',asynchronous:false,onSuccess:function(transport){value=transport.responseText;}});return value;},needsRankingEndCard:function(){return AdZone.votable_video();}});AdZone.Playlist=Class.create({initialize:function(container){this.container=container;this.name=container.readAttribute('data-playlist-name');var videos=[];this.container.select('li.video a').each(function(a){videos.push(new AdZone.Video(container.readAttribute('data-playlist-name'),a.readAttribute('data-video-id'),a.readAttribute('data-content-id'),a.readAttribute('data-title'),a.readAttribute('data-thumbnail-url'),a.readAttribute('href')));});this.videos=videos;},sort:function(sorted_video_ids){var videos=this.videos,current_video=videos[AdZone.current_video_index];var sorted_videos=sorted_video_ids.map(function(video_id){var v=videos.find(function(video){return video.video_id==video_id;});return v;});this.videos=sorted_videos;AdZone.update_indices(current_video);}});AdZone.Video=Class.create({initialize:function(playlist_name,video_id,content_id,title,thumbnail_url,href){this.playlist_name=playlist_name;this.video_id=video_id;this.content_id=content_id;this.title=title;this.thumbnail_url=thumbnail_url;this.href=href;}});
var AdZonePlayer=Class.create();Object.extend(AdZonePlayer,{url:'',dom_object:null,init:function(swf_dom_name,staging_env,state,mushy_mush_content_ids){AdZonePlayer.url='http://player'+(staging_env?'.qa':'')+'.hulu.com/videopanel/panel_player.swf';var REQ_SWF_VER='10.1.0',SWF_DOM_TARGET='adzone-player-target',PLAYER_HEIGHT=504,PLAYER_WIDTH=896;var query=location.search.toQueryParams(),swfobject=new SWFObject(AdZonePlayer.url,swf_dom_name,PLAYER_WIDTH,PLAYER_HEIGHT,REQ_SWF_VER,'');swfobject.setAttribute('id',swf_dom_name);swfobject.setAttribute('name',swf_dom_name);swfobject.setAttribute('align','middle');swfobject.useExpressInstall('/expressinstall.swf');swfobject.addParam('quality','high');swfobject.addParam('allowScriptAccess','always');swfobject.addParam('allowFullscreen','true');swfobject.addParam('bgcolor','#000000');swfobject.addParam('wmode','transparent');swfobject.addVariable('divDisplayType','fixed-open');swfobject.addVariable('partner',query.partner||'hulu');swfobject.addVariable('adZonePhase',state);swfobject.addVariable('extContainer','AdZone');swfobject.addVariable('showMetaDataBar','false');swfobject.addVariable('playerWidth',PLAYER_WIDTH);swfobject.addVariable('playerHeight',PLAYER_HEIGHT);swfobject.addVariable('flaWidth',512);swfobject.addVariable('flaHeight',300);swfobject.addVariable('minWidth',PLAYER_WIDTH);swfobject.addVariable('minHeight',PLAYER_HEIGHT);swfobject.addVariable('mushyMushList',mushy_mush_content_ids);swfobject.write(SWF_DOM_TARGET);AdZonePlayer.dom_object=$(swf_dom_name);return this;},send:function(){var args=Array.prototype.slice.call(arguments),method=args.shift(),command=AdZonePlayer.dom_object[method];if(command!==undefined){try{command.apply(AdZonePlayer.dom_object,args);}catch(error){}}},trackBannerClickThru:function(type){AdZonePlayer.send('trackBannerClickThru',type);}});
Number.prototype.mod=function(n){return((this%n)+n)%n;}
var Pager=Class.create();Object.extend(Pager.prototype,{initialize:function(elem){this.prev=elem.down('a.prev');this.next=elem.down('a.next');this.current_page_elem=elem.down('.current-page');this.current_page=parseInt(this.current_page_elem.innerHTML);this.total_pages=parseInt(elem.down('.total-pages').innerHTML);this.containers=elem.up('.content-container').select('.paged-content');this.page_width=this.containers.last().down('ol').getWidth();elem.select('a.prev, a.next').each(function(a){a.observe('click',function(e){this.go(e.element().hasClassName('next')?'next':'prev');e.stop();}.bind(this));}.bind(this));var slider_width=this.total_pages*this.page_width;this.containers.each(function(container){container.setStyle({width:slider_width+'px'});});},go:function(direction){var page_index=this.current_page-1,adjusted_page_index=page_index+(direction=='next'?1:-1),new_page_index=adjusted_page_index.mod(this.total_pages);this.current_page=new_page_index+1;this.current_page_elem.update(this.current_page);var updated_index=(this.current_page-1)*this.page_width;this.containers.each(function(container){new Effect.Move(container,{x:-updated_index,y:0,mode:'absolute',duration:0.2,transition:Effect.Transitions.sinoidal});});}});
var Inbox=Object.extend(window["Inbox"]||{},{moreLink:function(ev){var el=Event.element(ev);var more=el.next('div.more');if(more){el.hide();more.show();}},deleteMessage:function(id){Inbox._deleteItem(id,"message");},deleteNotification:function(id){Inbox._deleteItem(id,"notification");},friendConnect:function(event,nid){Inbox._friendWorker(event,"/inbox/friend_connect",nid);},selectAll:function(el){$$('input.message-cbx').each(function(input){input.checked=el.checked;});return true;},friendIgnore:function(event,nid){Inbox._friendWorker(event,"/inbox/friend_ignore",nid);},_deleteItem:function(id,type){new Ajax.Request("/inbox/delete",{parameters:{type:type,id:id},onComplete:function(){window.location.reload();}});},_friendWorker:function(event,action,nid){var ev=event||window.event;var el=Event.element(ev);if(el)el=el.up('div.freq-item');if(el){new Ajax.Request(action,{parameters:{id:nid},onComplete:function(){var actionString=action.match('ignore')?'Friend Request Ignored':'Friend Confirmed';el.down('.confirm-deny').update("<div><span style='float: left; color: #999;'>"+actionString+"</span><span style='padding-left: 5px; float: left;'><img src='/images/icon-check.gif'></span></div>");$$('span.requests-count').each(function(container_elem){var count_elem=container_elem.down('cufontext');if(count_elem){var match_set=count_elem.innerHTML.match(/\d+/);if(match_set!=null){var new_count=parseInt(match_set.first())-1;if(new_count>0){Element.update(container_elem,'('+new_count.toString()+')');}else{Element.remove(container_elem);}}}});}});}}});
(function(){var descriptionAreas=["details","more","comment"];var classPrefix=".video-";var HOVER_EXTENSION_RX=/(\.gif\??[0-9]*|\.jpg\??[0-9]*|\.png\?[0-9]*)$/;var defaultSharedType=null;var defaultSharedId=null;var defaultSharedName=null;var isUsingShareDataFromPlayer=false;var slideTime=0.4;function updateEmailFormFields(shared_id,shared_type,shared_name,shared_url,shareData){var emailForm=$('email-share-form');if(emailForm){if(defaultSharedId==null){defaultSharedType=emailForm.down('input[name=shared_type]').readAttribute('value');defaultSharedId=emailForm.down('input[name=shared_id]').readAttribute('value');defaultSharedName=emailForm.down('#email-messages').innerHTML;}
var message="";if(arguments.length==0){shared_id=defaultSharedId;shared_type=defaultSharedType;message=defaultSharedName;}else{message=shared_name?"Check out "+shared_name+" on Hulu.":"message";if(shared_name){if(shared_type=="ad"){shared_url+="/"+shared_name.toLowerCase().replace(/ & /g," and ").replace(/\s+/g,"-").replace(/[^-\w]+/g,'');}
message+="\n( "+shared_url+" )";}}
WatchTitle.sharedTypeId=shared_type+"_"+shared_id;WatchTitle.shareData=shareData;emailForm.down('input[name=shared_type]').writeAttribute('value',shared_type);emailForm.down('input[name=shared_id]').writeAttribute('value',shared_id);emailForm.down('#email-messages').update(message);}}
var WatchTitle={init:function(rid,sharedType,commentSelector){WatchTitle.relatedId=rid;WatchTitle.sharedType=sharedType;WatchTitle.commentSelector=commentSelector;Event.observe(window,"load",function(){for(var i=0;i<descriptionAreas.length;i++){var img=$$('#description-switch a.toggle-w-'+descriptionAreas[i]+" img").first();if(img!=null){var extension=HOVER_EXTENSION_RX.exec(img.src);if(extension){pingImage(img.src.replace(HOVER_EXTENSION_RX,'-selected'+extension));}}}
if(commentSelector!=null){var commentLink=$$('#description-switch a.toggle-w-comment .link-description').first();if(commentLink!=null){var baseUrl="http://graph.facebook.com/fql?q=";var currentUrl=window.location.protocol+"//"+window.location.host+window.location.pathname;var fql="SELECT commentsbox_count FROM link_stat WHERE url='"+currentUrl+"'";JsonP.external({url:baseUrl+encodeURIComponent(fql),success:function(response){if(response&&response.data&&response.data.length>0){var commentCount=parseInt(response.data[0].commentsbox_count);if(!isNaN(commentCount)&&commentCount>0){var commentString=commentCount>1?"comments":"comment";commentLink.update(commentString+" ("+commentCount+")");}}}});}}});},toggleDetails:function(areaName){if(this._isInAnimation)return false;var currentLink=$$('#description-switch a.toggle-w-'+areaName).first();var isHiding=false;var lastVisibleArea=null;var descriptionContent=$('description-contents');var currentArea=descriptionContent.down(classPrefix+areaName);var isIE=Prototype.Browser.IE;var isOpenContents=(descriptionContent.style.display=="none");var _this=this;var effectOption={duration:slideTime,transition:Effect.Transitions.sinoidal,afterFinish:function(){_this._isInAnimation=false;}};if(isOpenContents||currentArea.style.display=="none"){if(areaName=="more"){var shareData=this.getShareDataFromPlayer();if(shareData!=null){updateEmailFormFields(shareData.id,shareData.type,shareData.title,shareData.url,shareData);isUsingShareDataFromPlayer=true;}else{updateEmailFormFields();isUsingShareDataFromPlayer=false;}}
var toClose=null;var toOpen=null;var isScrollDown=true;for(var i=0;i<descriptionAreas.length;i++){var area=descriptionContent.down(classPrefix+descriptionAreas[i]);if(descriptionAreas[i]==areaName){Beacon.trackWatchTitle("show"+areaName,WatchTitle.relatedId);toOpen=$(area);isScrollDown=(toClose!=null);}else if(area.style.display!="none"){toClose=$(area);lastVisibleArea=descriptionAreas[i];isScrollDown=(toOpen==null);}}
if(isOpenContents||isIE){toOpen.show();if(toClose!=null){toClose.hide();}}else if(isScrollDown){this._isInAnimation=true;new Effect.Parallel([new Effect.BlindDown(toOpen,{sync:true}),new Effect.SlideUp(toClose,{sync:true})],effectOption);}else{this._isInAnimation=true;new Effect.Parallel([new Effect.SlideDown(toOpen,{sync:true}),new Effect.BlindUp(toClose,{sync:true})],effectOption);}
if(isOpenContents){if(!isIE){this._isInAnimation=true;new Effect.BlindDown(descriptionContent,effectOption);}else{descriptionContent.show();}}}else{isHiding=true;Beacon.trackWatchTitle("hide"+areaName,WatchTitle.relatedId);if(!isIE){this._isInAnimation=true;new Effect.BlindUp(descriptionContent,effectOption);}else{descriptionContent.hide();}}
this._toggleLinkState(currentLink,isHiding,true);if(lastVisibleArea){this._toggleLinkState($$('#description-switch a.toggle-w-'+lastVisibleArea).first(),true);}
return false;},_toggleLinkState:function(link,isHiding,isHover){if(link){var linkDescription=link.down(".link-description");if(linkDescription){if(isHiding&&linkDescription.hasClassName("open")){linkDescription.removeClassName("open");}else if(!isHiding&&!linkDescription.hasClassName("open")){linkDescription.addClassName("open");}}
var img=link.down("img");if(img){var src=img.src;var extension=HOVER_EXTENSION_RX.exec(img.src);extension=extension&&extension.length>=1?extension[1]:false;if(extension){if(!isHiding){if(src.match(/-hover/)){src=src.replace(/-hover/g,'');}
img.src=src.replace(HOVER_EXTENSION_RX,'-selected'+extension);}else{if(src.match(/-selected/)){src=src.replace(/-selected/g,'');}
img.src=src.replace(HOVER_EXTENSION_RX,(isHover?'-hover':'')+extension);}}}}},showEmbedInPlayer:function(){var player=$('player');if(player&&player.showEmbed){player.showEmbed();window.scroll(window.screenX||window.screenLeft,0);Beacon.trackWatchTitle("embed",WatchTitle.relatedId);}},showPopOutPlayer:function(){var player=$('player');if(player&&player.popoutPlayer){player.popoutPlayer();Beacon.trackWatchTitle("popout",WatchTitle.relatedId);}},checkBeforeEmailShare:function(el){if(!Behaviors.isLoggedIn()){FloatingLoginForm.showTop(el);return false;}
var valid=Behaviors.isEmailValidated();if(!valid){new Ajax.Request('/users/'+Behaviors.getUserId()+'/email_validation_status',{asynchronous:false,evalScripts:true,onComplete:function(request){if(!Behaviors.isEmailValidated()){Login.showEmailValidation();}else{valid=true;}}});}
return valid;},getShareDataFromPlayer:function(siteName){var player=$('player');if(player&&player.getShareData){var shareData=null;try{shareData=player.getShareData(siteName);}catch(e){}
if(shareData!=null&&shareData.type!="ad"&&WatchTitle.sharedType!="playlist"){return shareData;}}
return null;},getShareFunctionFromPlayer:function(siteName,socialURL,isHuluOriginal){var shareData=this.getShareDataFromPlayer(siteName);if(shareData!=null){var shareURL=shareData.url;if(siteName==="twitter"&&socialURL&&isHuluOriginal){var contentTitle=shareData.title;var twitterText=shareData.url.toQueryParams().text;if(twitterText&&twitterText.indexOf(contentTitle)!==-1){shareURL=socialURL;}}
Share.popup(shareURL,shareData.type,shareData.id,shareData);if(shareData.contentId!=null){Beacon.trackSiteVideoPublish(shareData.contentId,siteName,shareData.cpIdentifier,shareData.packageId,shareData.packageAvailability,shareData.sessionGuid);}
return true;}
return false;},isUsingShareDataFromPlayer:function(){return isUsingShareDataFromPlayer;},setShowNameWidth:function(){if($("ext-company-logo-watch")){Event.observe($("ext-company-logo-watch"),"load",function(){$("show-name-watch-div").setStyle({width:(580-13-$("ext-company-logo-watch").getWidth())+"px"});WatchTitle.refreshTitleCufon();});}},refreshTitleCufon:function(){Cufon.replace('h2.cufonable-futura-light',{fontFamily:'Futura ND Light'});Cufon.replace('h2.cufonable-futura-light a',{fontFamily:'Futura'});Cufon.replace('h2.cufonable-futura-light span',{fontFamily:'Futura'});},trackEmailShare:function(){Beacon.trackWatchTitle("email",WatchTitle.sharedTypeId);var data=WatchTitle.shareData;if(WatchTitle.sharedType!="playlist"&&data!=null&&data.contentId!=null&&(data.type+"_"+data.id)==WatchTitle.sharedTypeId){Beacon.trackSiteVideoPublish(data.contentId,"email",data.cpIdentifier,data.packageId,data.packageAvailability,data.sessionGuid);}},goToComment:function(){if(WatchTitle.commentSelector!=null){var comment=$$(WatchTitle.commentSelector).first();if(comment!=null){$(comment).scrollTo();}}},updateDvdPromoLink:function(text,link){var copyrightDetails=$$("div.video-details div.video_copyright_details").first();if(copyrightDetails!=null){var dvdPromoLink=copyrightDetails.down("a.dvd-promo-link");if(dvdPromoLink!=null){if(dvdPromoLink.previous(0)!=null){dvdPromoLink.previous(0).remove();}
dvdPromoLink.remove();}
if(text!=null&&text!=""&&link!=null&&link!=""){if(copyrightDetails.innerHTML!=null&&copyrightDetails.innerHTML!=""){copyrightDetails.insert('<span class="details-spacer">|</span>')}
copyrightDetails.insert(new Element("a",{"class":"dvd-promo-link link-watchpage",href:link}).update(text.escapeHTML()));}}}};WatchTitle.Lights={_isIE7:Prototype.Browser.IE&&BrowserDetect.version==7,toggleLights:function(playerContainer,lightKeepElements,isTurningOn){if(this._working||playerContainer==null)return;var duration=0.8;var maskZIndex=150;this._working=true;try{if(this._lightMask==null){this._lightMask=new Element("div");this._lightMask.setStyle({position:"absolute",zIndex:maskZIndex,display:"none",width:"100%",backgroundColor:"black",top:"0px",left:"0px"});this._lightMask.setOpacity(0);$(document.body).insert(this._lightMask);}
if((this._lightMask.style.display=="none")==isTurningOn){return isTurningOn;}
if(this._lightMask.style.display=="none"){var db=document.body;var dde=document.documentElement;var docHeight=Math.max(db.scrollHeight,dde.scrollHeight,db.offsetHeight,dde.offsetHeight,db.clientHeight,dde.clientHeight);this._lightMask.style.height=docHeight+"px";this._lightMask.style.display="block";if(playerContainer){playerContainer.setStyle({zIndex:maskZIndex+1});if(this._isIE7){var container=playerContainer.up("#breakout-container");if(container){container.setStyle({position:"relative"});}}}
this._updateZIndex(lightKeepElements,maskZIndex+1);new Effect.Opacity(this._lightMask,{duration:duration,from:0,to:0.8,afterFinish:function(){this._working=false;}.bind(this)});return false;}else{new Effect.Opacity(this._lightMask,{duration:duration,from:0.8,to:0,afterFinish:function(){this._working=false;this._lightMask.style.display="none";if(playerContainer){playerContainer.setStyle({zIndex:0});if(this._isIE7){var container=playerContainer.up("#breakout-container");if(container){container.setStyle({position:""});}}}
this._updateZIndex(lightKeepElements,0);}.bind(this)});return true;}}
catch(e){this._working=false;throw e;}},_updateZIndex:function(elements,zIndex){if(elements!=null){for(var i=0;i<elements.length;i++){if(elements[i]!=null){$(elements[i]).setStyle({zIndex:zIndex,position:"relative"});}}}}}
window.WatchTitle=WatchTitle;window.Player=window.Player||{};window.Player.updateDvdPromoLink=WatchTitle.updateDvdPromoLink;}).call(this);
var IframeHacker=Class.create();IframeHacker.hideWhenScroll=function(hideFunc,funcCaller){};IframeHacker.setNeedHideWhenScroll=function(needHideWhenScroll){IframeHacker._needHideWhenScroll=needHideWhenScroll;};(function(){var scrollThreshold=50;var listners=[];var isInit=false;if(BrowserDetect.browser=="Chrome"&&BrowserDetect.OS=="Mac"){IframeHacker.hideWhenScroll=function(hideFunc,funcCaller){if(IframeHacker._needHideWhenScroll!=true){return;}
if(!isInit){Event.observe(window,"scroll",function(ev){if(listners.length==0)return;var currentScrollTop=document.body.scrollTop;for(var i=listners.length-1;i>=0;i--){var listner=listners[i];if(Math.abs(currentScrollTop-listner.scrollTop)>scrollThreshold){listner.hideFunc.call(listner.caller,ev);listners.splice(i,1);}}});isInit=true;}
listners.push({scrollTop:document.body.scrollTop,hideFunc:hideFunc,caller:funcCaller});}}}).call(this);Object.extend(IframeHacker.prototype,{initialize:function(element,customOffsetMethod){this.master=element;if(customOffsetMethod){this.offset=customOffsetMethod;}},show:function(){if(this.iframe_div==null){this.iframe_id="iframe-hacker"+Math.random();new Insertion.After(this.master,'<iframe id="'+this.iframe_id+'" '+'style="display:none;position:absolute;z-index:90;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iframe_div=$(this.iframe_id);}
this.updateSize();this.iframe_div.show();},updateSize:function(){var p=this.master.cumulativeOffset();var d=this.master.getDimensions();var o=this.offset();this.iframe_div.setStyle({left:(p.left+o.left)+"px",top:(p.top+o.top)+"px",width:(d.width+o.width)+"px",height:(d.height+o.height)+"px"});},offset:function(){return{left:0,top:0,width:0,height:0}},hide:function(){if(this.iframe_div){this.iframe_div.hide();}}});
(function(){AdPlayback={Skin:{inSkinState:false,isDedicatedSkin:null,setPlayerContainerHeight:function(p){$('player-container').setStyle({'height':Math.round(529+p*(AdPlayback.Skin.isDedicatedSkin?10:125))+'px'});},transitionToSkin:function(isDedicatedSkin){if(isDedicatedSkin===true)AdPlayback.Skin.isDedicatedSkin=true;if(AdPlayback.Skin.inSkinState)return;$('player-container').removeClassName("with-background");$('player-container').setStyle({'padding':'0px 0px '+(AdPlayback.Skin.isDedicatedSkin?0:10)+'px 0px','height':'529px','width':'100%'});$('player').setStyle({'height':'529px'});new Effect.Tween('player-container',0,1,{duration:0.4,afterFinish:function(){$('player').transitionToSkinFinished();$('player').setStyle({'height':(AdPlayback.Skin.isDedicatedSkin?539:654)+'px'});}},AdPlayback.Skin.setPlayerContainerHeight);AdPlayback.Skin.inSkinState=true;},transitionToNormal:function(){if(!AdPlayback.Skin.inSkinState)return;$('player').setStyle({'height':'529px'});new Effect.Tween('player-container',1,0,{duration:0.3,afterFinish:function(){AdPlayback.Skin.inSkinState=false;$('player-container').setStyle({'padding':'25px 10px 10px 23px','height':'504px','width':'896px'});$('player-container').addClassName("with-background");$('player').transitionToNormalFinished();$('player').setStyle({'height':'504px'});}},AdPlayback.Skin.setPlayerContainerHeight);},expandToSkin:function(isDedicatedSkin)
{var currentSkinSetting=AdPlayback.Skin.isDedicatedSkin;AdPlayback.Skin.isDedicatedSkin=isDedicatedSkin;if(AdPlayback.Skin.inSkinState&&AdPlayback.Skin.isDedicatedSkin===currentSkinSetting)
{$('player').transitionToSkinFinished();}
else
{$('player-container').setStyle({'padding':'0px 0px '+(AdPlayback.Skin.isDedicatedSkin?0:10)+'px 0px'});if(currentSkinSetting===null)
{$('player-container').removeClassName("with-background");$('player-container').setStyle({'height':'529px','width':'100%'});$('player').setStyle({'height':'529px'});}
new Effect.Tween('player-container',0,1,{duration:0.4,afterFinish:function(){$('player').transitionToSkinFinished();$('player').setStyle({'height':(AdPlayback.Skin.isDedicatedSkin?539:654)+'px'});}},AdPlayback.Skin.setPlayerContainerHeight);AdPlayback.Skin.inSkinState=true;}},collapseToNormal:function(){if(!AdPlayback.Skin.inSkinState){$('player').transitionToNormalFinished();}else{$('player').setStyle({'height':(AdPlayback.Skin.isDedicatedSkin?539:654)+'px'});new Effect.Tween('player-container',1,0,{duration:0.3,afterFinish:function(){AdPlayback.Skin.inSkinState=false;AdPlayback.Skin.isDedicatedSkin=null;$('player-container').setStyle({'padding':'25px 10px 10px 23px','height':'504px','width':'896px'});$('player-container').addClassName("with-background");$('player').transitionToNormalFinished();$('player').setStyle({'height':'504px'});}},AdPlayback.Skin.setPlayerContainerHeight);}}}};window.BrandedSkin={transitionToSkin:AdPlayback.Skin.transitionToSkin,transitionToNormal:AdPlayback.Skin.transitionToNormal};}).call(this);
var featureQuickplay={init:function(){$$('span.quickplay a').each(function(el){Element.observe(el,'click',featureQuickplay.targetParent);})
$$('a.quickplay').each(function(el){Element.observe(el,'click',featureQuickplay.targetSelf);})},targetParent:function(event){Event.stop(event);var element=Event.findElement(event,"span");var videoId=element.readAttribute('videoeid');Plus.quickPlay(videoId);},targetSelf:function(event){Event.stop(event);var element=Event.element(event);var videoId=element.readAttribute('videoeid');Plus.quickPlay(videoId);}};
(function(){var friendsForVideoUrl="/social/friends_for_videos?video_ids=";var friendsCache={};var visibleCount=3;var rotateDelta=8;var leftOffset=4;var topOffset=0;var hoverTime=0.8;var animTime=0.7;var fps=Prototype.Browser.IE?10:25;var isOldIE=Prototype.Browser.IE&&BrowserDetect.version<9;if(isOldIE){leftOffset=1;topOffset=-3;}
var generateFaceThumb=function(friend){var img=new Element("img",{"class":"face-pile-thumb","src":"/users/picture/"+friend.user_id,"width":48,"height":48});if(isOldIE){img.setStyle({backgroundColor:"#A0A0A0",border:"1px white solid"});}else{img.setStyle({background:"url(/images/face-pile-shadow.png)",padding:"5px"});}
img.setStyle({position:"absolute"});return img;}
var getName=function(friend){return friend["first_name"]+" "+friend["last_name"];}
var generateText=function(friends){if(friends==null||friends.length<1)return"";var text=getName(friends[0]);if(friends.length==2){text+=" and "+getName(friends[1]);}else if(friends.length==3){text+=", "+getName(friends[1])+", and "+getName(friends[2]);}else if(friends.length>3){text+=" and "+(friends.length-1)+" friends";}
if(friends.length>1){text+="<br/>"}
text+=" also watched this video";return text;}
FacePile=Class.create({_timer:null,_topIndex:0,_triggeredBy:"hover",_transitionCount:{hover:0,click:0},_largestViewedIndex:0,initialize:function(videoId,container){this._container=container;this._videoId=videoId;},show:function(){if(this._container==null)return;this._container.update("");if(friendsCache.hasOwnProperty(this._videoId)){var friends=friendsCache[this._videoId];this._update(friends);}else{var url=friendsForVideoUrl+this._videoId+"&cb="+(new Date).getTime();var _this=this;new Ajax.Request(url,{method:'get',onSuccess:function(request){if(_this._isDisposed==true)return;var results=request.responseText.evalJSON();var friends=results[_this._videoId];if(friends!=null&&friends.length>0){friends.sort(function(a,b){var timeA=parseInt(a["last_viewed_at"]);var timeB=parseInt(b["last_viewed_at"]);if(isNaN(timeA)){return 1;}
if(isNaN(timeB)){return-1;}
return timeB-timeA;});}
friendsCache[url]=friends;_this._update(friends);},onFailure:function(response){}});}},_update:function(friends){this._friends=friends;this._thumbs=[];if(this._thumbsContainer){Event.stopObserving(this._thumbsContainer,"mouseover");Event.stopObserving(this._thumbsContainer,"mouseleave");Event.stopObserving(this._thumbsContainer,"click");}
if(friends==null||friends.length==0){$(this._container).hide();}else{$(this._container).show();this._text=generateText(friends);this._currentTextElement=new Element("span").update(this._text);this._nextTextElement=new Element("span",{"style":"display:none;"});var textContainer=new Element("div",{"class":"face-text-container"});textContainer.insert(this._nextTextElement);textContainer.insert(this._currentTextElement);this._thumbsContainer=new Element("div",{"class":"face-thumb-container"});this._container.insert(textContainer);this._container.insert(this._thumbsContainer);this._thumbs.length=this._friends.length;var initLength=Math.min(visibleCount+1,this._friends.length);for(var i=0;i<initLength;i++){this._ensureThumb(i);}
this._thumbsContainer.style.cursor="pointer";this._thumbsContainer.observe("mouseover",this._onHover.bind(this));this._thumbsContainer.observe("mouseleave",this._onLeave.bind(this));this._thumbsContainer.observe("click",this._onClick.bind(this));}},_onClick:function(){this._triggeredBy="click";if(this._fadeAnim==null&&this._rotateAnim==null&&this._restoreAnim==null){this._transit(animTime/2);}else{this._endCurrentEffects();}},_onHover:function(){if(this._isHover==true)return;this._isHover=true;var _this=this;this._endCurrentEffects();this._clearHoverTimer();this._nextTextElement.update(getName(this._friends[0]));var delay=0.3;this._crossFadeText(hoverTime/2,null,null,delay);this._startHoverTimer(hoverTime+delay);},_startHoverTimer:function(length){length=length||hoverTime;if(this._timer!=null){clearTimeout(this._timer);}
if(this._topIndex>=this._friends.length-1)return;this._timer=setTimeout(function(){this._triggeredBy="hover";this._transit();}.bind(this),length*1000);},_onLeave:function(){this._isHover=false;this._clearHoverTimer();this._restore();},_clearHoverTimer:function(){if(this._timer!=null){clearTimeout(this._timer);}
this._timer=null;},_transit:function(duration){duration=duration||animTime;this._endCurrentEffects();this._clearHoverTimer();var topIndex=this._topIndex;var _this=this;if(topIndex<this._friends.length-1){var imgs=this._thumbs;this._nextTextElement.update(getName(this._friends[topIndex+1]));var onFinish=function(){this._topIndex++;this._largestViewedIndex=Math.max(this._largestViewedIndex,this._topIndex);this._transitionCount[this._triggeredBy]++;if(this._isHover){this._startHoverTimer();}}
this._crossFadeText(duration,[new Effect.Fade(imgs[topIndex],{sync:true})],onFinish);var effects=[];for(var i=topIndex+1;i<Math.min(topIndex+visibleCount,this._friends.length);i++){effects.push(new Effect.Rotate(imgs[i],(i-topIndex-1)*rotateDelta,{sync:true}));effects.push(new Effect.Move(imgs[i],{x:(i-topIndex-1)*leftOffset,y:(i-topIndex-1)*topOffset,mode:'absolute',sync:true}));}
this._rotateAnim=new Effect.Parallel(effects,{duration:duration/2,fps:fps,afterFinish:function(){_this._rotateAnim=null;}});var newFaceIndex=topIndex+visibleCount+1;if(newFaceIndex<this._friends.length){this._ensureThumb(newFaceIndex);}}},_ensureThumb:function(index){var img=this._thumbs[index];if(img==null){img=generateFaceThumb(this._friends[index]);this._thumbs[index]=img;this._thumbsContainer.insert({top:img});}
img.show();var delta=Math.min(index,visibleCount-1);var rotate=delta*rotateDelta;var left=delta*leftOffset;var top=delta*topOffset;img.setStyle({left:left+"px",top:top+"px"});new Effect.Rotate(img,rotate,{duration:0});return img;},_restore:function(){this._endCurrentEffects();this._clearHoverTimer();this._nextTextElement.update(this._text);var effects=[];if(this._topIndex>0){var i=0;var img;for(;i<visibleCount+1;i++){img=this._thumbs[i];if(img==null)break;if(img.style.display=="none"){effects.push(new Effect.Appear(img,{sync:true}));}
var delta=Math.min(i,visibleCount-1);effects.push(new Effect.Rotate(this._thumbs[i],delta*rotateDelta,{sync:true}));effects.push(new Effect.Move(this._thumbs[i],{x:delta*leftOffset,y:delta*topOffset,mode:'absolute',sync:true}));}
for(i=visibleCount+1;i<this._friends.length;i++){img=this._thumbs[i];if(img!=null&&img.style.display!="none"){if(isOldIE){img.setStyle({left:"0px",top:"0px"});}
effects.push(new Effect.Fade(img,{sync:true}));}}}
this._crossFadeText(hoverTime,effects,function(){this._topIndex=0;});},_crossFadeText:function(duration,extraEffects,onFinish,delay){duration=duration||(hoverTime/2);if(delay==undefined)delay=0;var effects=[new Effect.Fade(this._currentTextElement,{sync:true}),new Effect.Appear(this._nextTextElement,{sync:true})];if(extraEffects!=null&&extraEffects.length>0){effects=effects.concat(extraEffects);}
var _this=this;this._fadeAnim=new Effect.Parallel(effects,{duration:duration,delay:delay,fps:fps,afterFinish:function(){_this._fadeAnim=null;_this._onTextTransited();if(onFinish){onFinish.call(_this);}}});},_endCurrentEffects:function(){if(this._fadeAnim){this._finishEffect(this._fadeAnim);this._fadeAnim=null;}
if(this._rotateAnim){this._finishEffect(this._rotateAnim);this._rotateAnim=null;}
if(this._restoreAnim){this._finishEffect(this._restoreAnim);this._restoreAnim=null;}},_finishEffect:function(effect){effect.render(1.0);effect.cancel();effect.event('beforeFinish');effect.finish();effect.event('afterFinish');},_onTextTransited:function(){var temp=this._currentTextElement;this._currentTextElement=this._nextTextElement;this._nextTextElement=temp;},dispose:function(){this._isDisposed=true;this._endCurrentEffects();this._clearHoverTimer();if(this._thumbsContainer){this._thumbsContainer.stopObserving("mouseover");this._thumbsContainer.stopObserving("mouseleave");this._thumbsContainer.stopObserving("click");}
$(this._container).hide();if(this._friends!=null&&this._friends.length>0){Beacon.trackFacePile("video",this._videoId,this._friends.length,this._transitionCount.hover,this._transitionCount.click,this._largestViewedIndex);}
this._friends=null;}});FacePile.initialize=function(container,videoId){this._container=container;return this.updateVideo(videoId);}
FacePile.updateVideo=function(videoId){if(!this._container)return null;if(this._instance&&this._instance._videoId==videoId)return this._instance;if(this._instance){this._instance.dispose();}
this._instance=new FacePile(videoId,this._container);if(this._isLogin){this._onLogin();}
return this._instance;}
FacePile._onLogin=function(){this._isLogin=true;if(this._instance){this._instance.show();}}
FacePile._onLogout=function(){this._isLogin=false;if(this._instance){this._instance.dispose();this._instance=null;}}
FacePile._onPageUnload=function(){if(this._instance){this._instance.dispose();this._instance=null;}}
Effect.Rotate=function(element,to,options){var browser=$H(Prototype.Browser).find(function(f){return true==f[1]})[0];element=$(element);var deg2radians=Math.PI*2/360;var degree;var update;if(isOldIE){degree=element.degree?element.degree*1:0;element.setStyle({filter:"progid:DXImageTransform.Microsoft.Matrix(SizingMethod='auto expand')"});update=function(pos){this.degree=pos;var radian=pos*(Math.PI/180);var costheta=Math.cos(radian);var sintheta=Math.sin(radian);this.filters.item(0).M11=costheta;this.filters.item(0).M12=-sintheta;this.filters.item(0).M21=sintheta;this.filters.item(0).M22=costheta;}
if(options&&options.hasOwnProperty("duration")&&options["duration"]==0){update.call(element,to);return true;}else{return new Effect.Tween(element,degree,to,options,update);}}else{var rule=false;var getRule=false;switch(browser){case"Gecko":getRule=rule="-moz-transform";break;case"WebKit":getRule=rule="-webkit-transform";break;case"Opera":getRule=rule="-o-transform";break;case"IE":rule="-ms-transform";getRule="msTransform";break;default:break;}
if(rule){var transform=element.getStyle(getRule);degree=transform?transform.gsub(/[\(\)a-zA-Z:;\s]+/,'')*1:0;update=function(pos){this.setStyle(rule+": rotate("+pos+"deg);");}
if(options.hasOwnProperty("duration")&&options["duration"]==0){update.call(element,to);}else{return new Effect.Tween(element,degree,to,options,update);}}else{return false;}}
return true;};document.observe("hulu:loggedIn",FacePile._onLogin.bind(FacePile));document.observe("hulu:loggedOut",FacePile._onLogout.bind(FacePile));Event.observe(window,"unload",FacePile._onPageUnload.bind(FacePile));}).call(this);
var JsonP=Class.create();Object.extend(JsonP,{pendingAjaxRequests:{},externalCallbacks:{},secure_url_for:function(path){var new_path=path;if(/https?:\/\//.test(path)){new_path=path.replace("http:","https:").replace("www","secure");}else{if(/((www)|(new))\.hulu\.com/.test(window.location.host)){new_path="https://secure.hulu.com"+path;}else if(/((www)|(new))\.huluqa\.com/.test(window.location.host)){new_path="https://secure.huluqa.com"+path;}}
return new_path;},ajax:function(path,options){var request_id=Math.round(Math.random()*10000000000000000+1);var jsonp_path=JsonP.secure_url_for(path);if(jsonp_path.match(/\?/)){jsonp_path+="&jsonp_request_id="+request_id;}else{jsonp_path+="?jsonp_request_id="+request_id;}
var parameters=options["parameters"];if(typeof(parameters)=="object"){parameters=$H(parameters).toQueryString();}
var encode=encodeURIComponent||escape;var cookie="_jsonp_params="+encode(parameters)+";";cookie+=" path="+/(hulu(qa)?\.com|^)(\/[^?]*)/.exec(jsonp_path).last()+";";cookie+=" domain="+Base.commonCookieDomain()+";";var onSuccess=options["onSuccess"];var onFailure=options["onFailure"];var onComplete=options["onComplete"];JsonP.pendingAjaxRequests[request_id]={"onSuccess":onSuccess===undefined?function(){}:onSuccess,"onFailure":onFailure===undefined?function(){}:onFailure,"onComplete":onComplete===undefined?function(){}:onComplete,"cookie":cookie,"path":jsonp_path,"id":request_id};$(document.body).insert(new Element('script',{"id":"jsonp_stage_1_tag_"+request_id,"type":"text/javascript","src":jsonp_path+"&jsonp_stage=1"}));},external:function(options){var request_id=Math.round(Math.random()*10000000000000000+1);var callback="callback="+encodeURIComponent("JsonP.externalCallbacks["+request_id+"]");var url=options.url+(options.url.match(/\?/)?"&":"?")+callback;var success=options["success"];if(success===undefined){success=function(){};}
JsonP.externalCallbacks[request_id]=function(data){success(data);$("jsonp_external_tag_"+request_id).remove();delete JsonP.externalCallbacks[request_id];};$(document.body).insert(new Element('script',{"id":"jsonp_external_tag_"+request_id,"type":"text/javascript","src":url}));},ajaxStage1Callback:function(json){var request=JsonP.pendingAjaxRequests[json["request_id"]];if(request!==undefined){document.cookie=request.cookie;$(document.body).insert(new Element('script',{"id":"jsonp_stage_2_tag_"+request.id,"type":"text/javascript","src":request.path+"&jsonp_stage=2"}));$("jsonp_stage_1_tag_"+request.id).remove();}},ajaxStage2Callback:function(json){var request=JsonP.pendingAjaxRequests[json["request_id"]];if(request!==undefined){delete JsonP.pendingAjaxRequests[json["request_id"]];var response={"statusText":json["status"],"responseText":json["body"]};if(json["status"].match(/200/)){try{request.onSuccess(response);}catch(e){};}else{try{request.onFailure(response);}catch(e){};}
try{request.onComplete(response);}catch(e){};$("jsonp_stage_2_tag_"+request.id).remove();}}});
var TrackingSources=Class.create();Object.extend(TrackingSources,{getSources:function(){var sources=this._loadSources();return{r1:sources[2],c1:sources[3],r2:sources[4],c2:sources[5]}},onLoad:function(){var sources=this._loadSources();host=document.referrer?document.referrer.match(/:\/\/(.[^/?]+)/)[1]:null;if(!host){var r1=null;var c1=null;var r2=null;var c2=null;}
else if(!host.match(/\.hulu(qa)?\.com(:[0-9]+)?$/)){var r2=null;var c2=null;var normalized=host.match(/[^\.]+\.[^\.]+$/)[0];var r1=normalized;var c1="";query_params=loc.search.toQueryParams();if(query_params["fromsearch"]=="google"){c1="googlesem";}
else if(query_params["fromsearch"]=="yahoo"){c1="yahoosem";}
else if(query_params["ref"]!=undefined){c1=query_params["ref"].substr(0,30);}
else{c1="referral";}}
else{var r1=sources[0];var c1=sources[1];var r2=sources[2];var c2=sources[3];}
var r0=null;var c0=null;var path=window.location.pathname.match(/\/(.[^\/?]+)?/)[1];var pageType=Beacon.get_page_type();if(pageType!='unknown'){r0=pageType;}
else{r0=path?path:"home";}
r0=r0+"_h1o";sources=[r0,c0,r1,c1,r2,c2];this._saveSources(sources);},setComponent:function(component){var sources=this._loadSources();var c0=component;sources[1]=component;this._saveSources(sources);},_loadSources:function(){var _sources=unescape(Behaviors.getCookie("_rcsources"));var sources=_sources?_sources.split('|'):["","","","","",""];return sources;},_saveSources:function(sources){Behaviors.setCookie("_rcsources",sources.join('|'),1,Base.commonCookieDomain());}});Event.observe(window,"load",function(){TrackingSources.onLoad();});
var NewModalPopup={topFixIE:false,iframe_id:"nmp_iframe",div:null,content_div:null,init:function(content,closeCallback){NewModalPopup.div=$("new-modal-popup");NewModalPopup.content_div=$("new-modal-popup-content");NewModalPopup.content=content;NewModalPopup.canvas=$('header-bg-canvas');if(closeCallback){NewModalPopup.closeCallback=closeCallback;}else{NewModalPopup.closeCallback=function(){};}},_onDismiss:function(event){var el=event.findElement();if(el==NewModalPopup.div||el.ancestors().indexOf(NewModalPopup.div)>=0)return;NewModalPopup.cancel("outside");},cancel:function(type){Event.stopObserving(document,'mousedown',NewModalPopup._onDismiss);if(NewModalPopup.topFixIE){if($(NewModalPopup.iframe_id)){$(NewModalPopup.iframe_id).hide();$(NewModalPopup.iframe_id).setStyle({zIndex:-10});}
NewModalPopup.topFixIE=false;}
NewModalPopup.div.hide();NewModalPopup.content.hide();NewModalPopup.hideBackground();NewModalPopup.closeCallback(type);},showCenter:function(cwidth,cheight){NewModalPopup.showBackground();if(NewModalPopup.content){NewModalPopup.content_div.insert({top:NewModalPopup.content});var vpi=getViewportInfo();var ww=vpi.width;var wh=vpi.height;NewModalPopup.div.style.top=(Math.max((wh-cheight)/2,0))+"px";NewModalPopup.div.style.left=(Math.max((ww-cwidth)/2,0))+"px";NewModalPopup.div.style.width=cwidth+"px";NewModalPopup.div.style.height=cheight+"px";var iframe=$(NewModalPopup.iframe_id);if(!NewModalPopup.topFixIE){new Insertion.After(NewModalPopup.div,'<iframe id="'+NewModalPopup.iframe_id+'" '+'style="display:none;position:absolute;z-index:1000;" class="transparent-iframe" '+'src="javascript:false;" frameborder="0" scrolling="no"></iframe>');NewModalPopup.topFixIE=true;iframe=$(NewModalPopup.iframe_id);}
var left=NewModalPopup.div.getStyle('left');var top=NewModalPopup.div.getStyle('top');var height=NewModalPopup.div.getDimensions().height+2+'px';var width=NewModalPopup.div.getDimensions().width+2+'px';iframe.setStyle({left:left,top:top,height:height,width:width});NewModalPopup.div.setStyle({zIndex:1001,position:"fixed"});iframe.show();NewModalPopup.div.show();NewModalPopup.content.show();Event.observe(document,'mousedown',NewModalPopup._onDismiss);}},showBackground:function(){if(!NewModalPopup.canvas)return;NewModalPopup.canvas.setStyle({backgroundColor:'#000000',width:"100%",height:"100%",opacity:0.8,position:'fixed',zIndex:999,top:0,left:0});if(Prototype.Browser.IE){$A(["masthead","player"]).each(function(s){var el=$(s);if(el)el.style.visibility="hidden";});}},hideBackground:function(){if(!NewModalPopup.canvas)return;NewModalPopup.canvas.setStyle({backgroundColor:'#000000',width:"0px",height:"0px",opacity:1,position:'absolute',zIndex:-10});if(Prototype.Browser.IE){$A(["masthead","player"]).each(function(s){var el=$(s);if(el)el.style.visibility="visible";});}}};
var HeaderNew=Class.create();Object.extend(HeaderNew,{init:function(){if(!$('q')){return;}
this._renderSearchBar();this._renderBrowse();this._renderAccount();this._renderAvatar();},_renderAvatar:function(){if(Behaviors.isLoggedIn()){$('user-name').innerHTML=Behaviors.getUsername().escapeHTML();var avatarUrl=Behaviors.getAvatarUrl();if(avatarUrl!=null){var img=new Element('img',{className:'user-avatar',src:avatarUrl,onload:"this.style.display='block'; $('stock-avatar').hide();"});$('stock-avatar').insert({'before':img});}}},_renderSearchBar:function(){var input=$('q');input.observe('focus',(function(e){input.up().addClassName('focus');}).bind(this));input.observe('blur',(function(e){input.up().removeClassName('focus');}).bind(this));},_renderAccount:function(){this._accountDropdown=new DropdownNew({el:$('account-dropdown'),wrapper:$('drop-wrapper-account-dropdown'),button:$('account-button'),height:'81px'});},_renderBrowse:function(){this._browseDropdown=new DropdownNew({el:$('nav-panel-dropdown'),wrapper:$('drop-wrapper-nav-panel-dropdown'),button:$('browse-button'),height:'233px'});},renderQueue:function(queueCount){if(!Behaviors.isLoggedIn()){return;}
var queueButton=$('queue-button');if(!this._queueDropdown){this._queueDropdown=new DropdownNew({el:$('queue-link'),wrapper:$('drop-wrapper-queue-link'),button:queueButton,height:'22px'});}},_getFavoritesCount:function(){var count=Behaviors.getCookie('_hulu_fc');return(count?parseInt(count):0);},updateBanner:function(options){if(!(options&&options.controller&&options.action))return;if(options.controller=='live'&&options.action=='watch'){$('banner').className='stick-top show-extra-header';$('search-autocomplete').addClassName('stick-top');}}});var DropdownNew=Class.create();Object.extend(DropdownNew.prototype,{initialize:function(options){this._dropdown=options.el;this._wrapper=options.wrapper;this._button=options.button;this._height=options.height;this._disabled=options.disabled?options.disabled:false;this.attachEvents();},attachEvents:function(){this._button.observe('mouseenter',(function(e){if(!(this._disabled||this.isOpen())){this.open();}}).bind(this));this._dropdown.observe('mouseleave',(function(e){this.close();}).bind(this));},setDisabled:function(disabled){this._disabled=disabled;this.close();},setButtonChecked:function(checked){if(checked){this._button.addClassName('active');}else{this._button.removeClassName('active');}},isOpen:function(){return this._dropdown.hasClassName('open');},open:function(){this._dropdown.addClassName('open');this.setButtonChecked(true);this._wrapper.setStyle({'height':this._height});},close:function(){this._dropdown.removeClassName('open');this.setButtonChecked(false);this._wrapper.setStyle({'height':0});}});Event.observe(document,'dom:loaded',function(){HeaderNew.init();});
Ajax.HuluAutocompleterNew=Class.create(Ajax.HuluAutocompleter,{initialize:function(element,update,url,options){options.frequency=options.frequency||0.1;if(!options.widthExpand){this.widthExpand=0;}else{this.widthExpand=options.widthExpand;}
this.baseInitialize(element,update,options);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=url;this.displayUp=false;this.direction="down";this.options.onShow=function(element,update,direction){var candidateOffsetTop=-12;var candidateOffsetLeft=-45;var offsetTop=Position.page(element)[1];var totalHeight=getViewportInfo().height;var height=Element.getDimensions(update).height;var width=Element.getDimensions(element).width+this.widthExpand+"px";if(!update.style.position||update.style.position=='absolute'){update.style.position='absolute';if(Prototype.Browser.IE){position=element.cumulativeOffset();update.setStyle({left:(position.left+candidateOffsetLeft)+"px",top:(position.top+candidateOffsetTop)+"px"});}else{Element.clonePosition(update,element,{setHeight:false,offsetTop:candidateOffsetTop,offsetLeft:candidateOffsetLeft});}}
update.setStyle({width:width});Effect.Appear(update,{duration:0.05});if(this.options.afterAddressed){this.options.afterAddressed=this.options.afterAddressed.bind(this);this.options.afterAddressed(update,element);}}.bind(this);this.options.onHide=function(element,update){new Effect.Fade(update,{duration:0.05,afterFinish:function(){$('search-form').removeClassName('z-index-layer-5');}})};this.options.onResize=function(){if(Element.getStyle(this.update,'display')=='block'){this.show();}}.bind(this);Event.observe(window,'resize',this.options.onResize);},getLiChildNodes:function(){var children=$A(this.update.childNodes);var simplifiedChildren=new Array();for(var i=0;i<children.size();i++){if(children[i].tagName=="LI"){simplifiedChildren.push(children[i]);}}
return simplifiedChildren;},thumbUrl:function(prefix,obj_id,size){if(size=="1x1"){size="220x124";}else if(size=="2x2"){size="476x268";}
var kinko_base=(window.location.protocol=='https:')?'https://a248.e.akamai.net/ib.huluim.com/':'http://ib'+(obj_id%4+1)+'.huluim.com/';var url=kinko_base+prefix+"/"+obj_id+"?size="+size;return url;},renderItem:function(ul,item){var _assetHost=function(){return(window.location.protocol=='https:')?'https://a248.e.akamai.net/assets.huluim.com':'http://assets.huluim.com';};var _genreImageUrl=function(name){return _assetHost()+"/h2o/genre/"+name+"_220_124.jpg";};var inner=null;var type=item.type;var isEntity=(type!='term'&&type!='smart_start');if(isEntity){var imageUrl;if(type=='genre'){imageUrl=_genreImageUrl(item.url.replace(/^\/((tv|movies)\/)?genres\//,'').replace(/-/g,'_').replace(/\+/g,'-').toLowerCase());}else if(item.url=='/latino'){imageUrl=_genreImageUrl('latino');}else if(type=='spotlight'){imageUrl=_assetHost()+'/h2o/search/'+item.url.match(/^\/(\w+)/)[1]+'.png';}else{imageUrl=this.thumbUrl(type,item.id,'1x1');}
inner='<img src="'+imageUrl+'" onload="this.style.display=\'block\';" />';inner='<a class="thumbnail-link ui-corner-all">'+inner+'</a>';}else{inner='<span class="autocomp-query">'+item.label+'</span>';inner='<a class="ui-corner-all">'+inner+'</a>';}
var li=new Element('li',{className:'ui-menu-item',onclick:"$('search-autocomplete').writeAttribute('action', 'mouse')"});if(isEntity){li.writeAttribute({href:item.url});}
li.insert(inner);ul.insert(li);},updateChoices:function(items){if(!this.changed&&this.hasFocus){this.update.update();items=items.evalJSON();var self=this;var renderTip=true;var ul=self.update;items.each(function(item,index){if(item.type=='term'){if(renderTip){ul.insert('<div class="autocomp-query-tip">Search for</div>');renderTip=false;}}
self.renderItem(ul,item);});ul.writeAttribute({action:"keyboard",query:$(this.element).value.replace(/'|"/g,"")});$('search-form').addClassName('z-index-layer-5');if(this.update.childNodes){this.entryCount=this.getLiChildNodes().length;for(var i=0;i<this.entryCount;i++){var entry=this.getEntry(i);entry.autocompleteIndex=i;this.addObservers(entry);}}else{this.entryCount=0;}
this.stopIndicator();this.index=-1;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide();}else{this.render();}}},updateQuery:function(){if(this.index>=0&&this.active){var current=this.getEntry(this.index);if(current.hasAttribute("href")){this.element.value=this.oldElementValue;}else{this.element.value=Prototype.Browser.Gecko?current.textContent:current.innerText;}}
else{this.element.value=this.oldElementValue;}}});