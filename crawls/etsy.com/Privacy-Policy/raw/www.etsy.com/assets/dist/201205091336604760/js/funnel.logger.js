(function(d,c){c.FunnelEventLogger=function(){var a=c.__funnelQueue=c.__funnelQueue||[];if(a.length){var b=this;d.each(a,function(){b.log.apply(b,this)})}this.setLoggableEvents()};c.FunnelEventLogger.prototype={baseUrl:"/funnel/beacon.gif",getGlobalVars:function(){return{guid:c.EventLogger.getPageGuid(),referrer:document.referrer,uri:window.location.pathname+window.location.search}},getListingIDs:function(a){var b=[];if(a){var e=/listing_id/;d.each(a,function(f,g){if(f.match(e))if(d.isArray(g))b.concat(g);
else typeof g.split=="function"&&b.concat(g.split(","))})}b.length||d(".listing-card").each(function(){var f=d(this).attr("id").replace("lid","");f&&b.push(f)});if(b.length)return{listing_ids:b.join(",")};return{}},getAbMap:function(){var a=c.EventLogger.getDocumentVariable("php_ab_test_names"),b=c.EventLogger.getDocumentVariable("php_ab_variable_names");a=c.EventLogger.zip(a,b);return{ab_tests:JSON.stringify(a)}},log:function(a,b){var e=this.baseUrl;b=d.extend({name:a},this.getAbMap(),this.getListingIDs(b),
this.getGlobalVars(),b);if(b[".user_id"])b.user_id=b[".user_id"];d.each(b,function(f,g){e=c.EventLogger.addUrlParam(e,f,g)});(new Image).src=e},logPrimaryEvent:function(){var a=null,b=this;d.each(c.EventLoggerEvents||[],function(){var e=this.attributes;if(b.isPrimary(e)){a=e;return false}});a&&this.log(a.php_event_name,a)},isPrimary:function(a){return a&&a.primary_event},interceptEvent:function(a){var b=a.php_event_name||null;b&&this.isLoggableEvent(b)&&!this.isPrimary(a)&&this.log(b,a)},isLoggableEvent:function(a){return this.loggableEvents[a]===
true},setLoggableEvents:function(a){this.loggableEvents=a||{}}};c.funnelLogger=new c.FunnelEventLogger})(window.jQuery,window.Etsy);
