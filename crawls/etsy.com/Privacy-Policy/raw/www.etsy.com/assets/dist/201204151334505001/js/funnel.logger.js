(function(c,e){e.FunnelEventLogger=function(){var a;a=e.__funnelQueue=e.__funnelQueue||[];if(a.length){var b=this;c.each(a,function(){b.log.apply(b,this)})}this.setLoggableEvents()};e.FunnelEventLogger.prototype={baseUrl:"/funnel/beacon.gif",getGlobalVars:function(){return{guid:Etsy.eventLogger.getPageGuid(),referrer:document.referrer,uri:window.location.pathname+window.location.search}},getListingIDs:function(a){var b=[];if(a){var d=/listing_id/;c.each(a,function(f,g){if(f.match(d))if(c.isArray(g))b.concat(g);
else typeof g.split=="function"&&b.concat(g.split(","))})}b.length||c(".listing-card").each(function(){var f=c(this).attr("id").replace("lid","");f&&b.push(f)});if(b.length)return{listing_ids:b.join(",")};return{}},getAbMap:function(){var a=Etsy.eventLogger.getDocumentVariable("php_ab_test_names"),b=Etsy.eventLogger.getDocumentVariable("php_ab_variable_names");a=Etsy.eventLogger.zip(a,b);return{ab_tests:JSON.stringify(a)}},log:function(a,b){var d=this.baseUrl;b=c.extend({name:a},this.getAbMap(),this.getListingIDs(b),
this.getGlobalVars(),b);if(b[".user_id"])b.user_id=b[".user_id"];c.each(b,function(f,g){d=e.eventLogger.addUrlParam(d,f,g)});(new Image).src=d},logPrimaryEvent:function(){var a=null,b=this;c.each(Etsy.eventLoggerEvents||[],function(){var d=this.attributes;if(b.isPrimary(d)){a=d;return false}});a&&this.log(a.php_event_name,a)},isPrimary:function(a){if(a&&a.primary_event)return true;return false},interceptEvent:function(a){var b=a.php_event_name||null;b&&this.isLoggableEvent(b)&&!this.isPrimary(a)&&
this.log(b,a)},isLoggableEvent:function(a){return this.loggableEvents[a]===true},setLoggableEvents:function(a){this.loggableEvents=a||{}}};e.funnelLogger=new e.FunnelEventLogger})(window.jQuery,window.Etsy);
