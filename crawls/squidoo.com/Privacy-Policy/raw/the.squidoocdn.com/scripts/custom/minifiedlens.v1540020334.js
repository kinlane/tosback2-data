function previewRatingNew(index){clearRatingsNew();if(document.getElementById){for(var i=1;i<=index;i++){document.getElementById("myRatingStar"+i).src=stars_whole_your}}}function resetRatingsNew(){for(var i=1;i<=5;i++){document.getElementById("myRatingStar"+i).src=defaultStarsNew[i]}}function clearRatingsNew(){for(var i=1;i<=5;i++){document.getElementById("myRatingStar"+i).src=stars_empty}}var __savingRating=false;function saveRatingNew(index){if(!__savingRating){__savingRating=true;for(var i=1;i<=5;i++){defaultStarsNew[i]=document.getElementById("myRatingStar"+i).src}new Ajax.Updater("ratingDiv","/utility/rate_lens/"+theLensName,{asynchronous:true,method:"post",postBody:"rating="+index,onSuccess:function(){__savingRating=false}})}}function openFlagEdit(){document.getElementById("flagEditDiv").style.display="block";if(document.getElementById("comments")){document.getElementById("comments").select();document.getElementById("comments").focus()}}function closeFlagEdit(){document.getElementById("flagEditDiv").style.display="none";document.getElementById("default_onion").style.display="none"}function saveFlag(){if(!flagged){var myform=document.getElementById("flag_form");pass=$("reason").value==""?false:true;if(pass){var selects=myform.getElementsByTagName("select");var textareas=myform.getElementsByTagName("textarea");var postString=saveFields(selects);postString+=saveFields(textareas);var callbackFunction=function(response){if(response.responseText=="saved"){flagged=true;document.getElementById("flagResultsDiv").innerHTML="<p>You have successfully reported this lens. Thank you.</p>";setTimeout("closeFlagEdit()",3000)}else{var prettyResponseText="<strong>"+response.responseText+"</strong>";document.getElementById("flagResultsDiv").innerHTML=prettyResponseText}};new Ajax.Request("/utility/flag_lens/"+theLensName,{asynchronous:true,method:"post",postBody:postString,onSuccess:callbackFunction})}else{alert("Before continuing, please tell us why you are reporting this lens as inappropriate.");document.getElementById("comments").focus()}}else{document.getElementById("flagResultsDiv").innerHTML="<p>You have successfully reported this lens. Thank you.</p>";setTimeout("closeFlagEdit()",3000)}}function loadWorkshop(lens_name){jQuery("#default_onion").show();location.href="/lensmaster/workshop/"+lens_name}function plexConfirmation(){if(!$("loginLiteMessage")){setTimeout("plexConfirmation()",1000)}else{$("loginLiteMessage").innerHTML='<strong>Yippeee you voted!</strong> <p>Would you like to go back to <a href="'+plexBack+'">where you came from</a> or stick around and <a href="#" onclick="Element.hide(\'overlay\');Effect.Fade(\'loginLite\');">vote for more stuff</a>?</p>';Element.show("loginLite","overlay")}}plexBack=null;var ajaxRunning=false;function validateAfterAJAX(formName,errorElement){checkAvailability($("username"));validate($(formName),errorElement);waitForAJAX(formName,errorElement);return false}function checkAvailability(field){if(!ajaxRunning){ajaxRunning=true;$("regAjaxErrors").innerHTML="";new Ajax.Request("/utility/usernames/"+escapeForURL(field.value),{asynchronous:true,method:"post",postBody:"first_name=&"+"last_name=",onSuccess:function(response){ajaxRunning=false;if(response.responseText!=null&&response.responseText.replace(/[\r|\n]+/,"")!=""){if($("regErrors").style.display=="none"){$("regErrors").style.display="block"}if($("ajaxErrorText")&&$("ajaxErrorText").innerHTML.length){$("ajaxErrorText").innerHTML="- "+response.responseText}else{$("regErrors").innerHTML+=ajaxSpanStart+"- "+response.responseText+ajaxSpanEnd}$("regAjaxErrors").innerHTML=response.responseText;$("usernameRow").className+=" error";scrollToElement("regErrors")}else{if($("regErrors").style.display=="block"){if($("ajaxErrorText")){$("ajaxErrorText").innerHTML="";var regExp=new RegExp(ajaxSpanStart+ajaxSpanEnd,"g");$("regErrors").innerHTML=$("regErrors").innerHTML.replace(regExp,"");if(!$("regErrors").innerHTML.length){$("regErrors").style.display="none"}}}$("regAjaxErrors").innerHTML="";$("usernameRow").className=$("usernameRow").className.replace(/error/gi,"")}ajaxRunning=false}})}}lensLoveInit=false;function initLensLove(){if(window.isWorkshop||lensLoveInit){return false}lensLoveInit=true;loveSaveRating(0);for(var i=5;i>0;i--){$$(".wS"+i).each(function(item){item.src=defaultStarsNew[i];item.title=item.alt})}if(theLensName!=""){$$(".wMail").each(function(item){item.href="/utility/email_page?"+theLensName});$$(".wFave").each(function(item){item.href="/member/add_favorite/"+theLensName});$$(".wRoll").each(function(item){item.href="/lensmaster/lensroll/"+theLensName})}if(!isLoggedIn){$$(".wRating").each(function(item){item.innerHTML="<i>Login to rate this lens</i>"});$$(".wFave").each(function(item){item.href="http://addthis.com/bookmark.php"});$$(".wFave").each(function(item){item.innerHTML="Bookmark it &nbsp;"});$$(".wRoll").each(function(item){item.style.display="none"})}}function loveSaveRating(indx){var s0="http://cdn.squidoo.com/images/layout/star-sm-0.gif";var s1="http://cdn.squidoo.com/images/layout/star-sm-2.gif";if(indx>=1){$$(".wS1").each(function(item){item.src=s1})}else{$$(".wS1").each(function(item){item.src=s0})}if(indx>=2){$$(".wS2").each(function(item){item.src=s1})}else{$$(".wS2").each(function(item){item.src=s0})}if(indx>=3){$$(".wS3").each(function(item){item.src=s1})}else{$$(".wS3").each(function(item){item.src=s0})}if(indx>=4){$$(".wS4").each(function(item){item.src=s1})}else{$$(".wS4").each(function(item){item.src=s0})}if(indx>=5){$$(".wS5").each(function(item){item.src=s1})}else{$$(".wS5").each(function(item){item.src=s0})}if(indx>=1){saveRatingNew(indx)}}function setClickOutTracking(div){if(typeof div=="string"){var links=$(div).getElementsByTagName("a")}else{var links=document.getElementsByTagName("a")}for(var i=0;i<links.length;i++){var link=links[i];try{if(typeof link.hostname=="unknown"){continue}if(link.href=="javascript:void(0);"||link.href=="javascript:;"||link.href=="#"||!link.href){continue}if(link!=""&&link.hostname!=theRequestServerName&&link.hostname!=theServerName&&!link.hostname.match(/squidoo.com$/)){if(link.className.indexOf("googleUrl")!=-1||link.className.indexOf("googleClickout")!=-1){link.onclick=trackAdWordClick;if(!theWindowPref){link.target="_blank"}}else{link.onclick=trackClickWrapper;if(!theWindowPref){link.target="_blank"}}}}catch(ex){}}}function trackClickWrapper(){trackClick(this)}function trackClick(link){var url="/track/ajax_click?";url+="&lens_id="+theLensId;url+="&url="+escape(link.href);$J.get(url);if(evTrack!==undefined){evTrack("clickout",link.hostname,link.href)}}function trackAdWordClick(){var url="/track/ajax_ad_click?";url+="&lens_id="+theLensId;url+="&url="+escape(this.href);$J.get(url)}function fade(styleElement,color){return}function setLoadFunctions(){setTooltips();fade();if(window.setClickOutTracking){setClickOutTracking()}}if(pageLoadActions==undefined){var pageLoadActions=[]}pageLoadActions.push(setLoadFunctions);function setDisplay(elementId,newDisplay){if($(elementId)){var element=$(elementId);element.style.display=newDisplay}}function toggleDisplay(elementIdPrefix){var bodyId=elementIdPrefix+"Body";var headerId=elementIdPrefix+"Hdr";if($(bodyId)){var element=$(bodyId);var currentDisplay=element.style.display;var collapsed="collapse";var displayed="expanded";if(currentDisplay=="none"){setDisplay(bodyId,"block");addClass(headerId,displayed);desist(elementIdPrefix)}else{setDisplay(bodyId,"none");addClass(headerId,collapsed);persist(elementIdPrefix,collapsed)}}else{if($(elementIdPrefix)){var element=$(elementIdPrefix);var currentDisplay=element.style.display;var collapsed="collapse";var displayed="";if(currentDisplay=="none"){setDisplay(elementIdPrefix,"block")}else{setDisplay(elementIdPrefix,"none")}}}}function addClass(elementId,className){if($(elementId)){var element=$(elementId);var currentClass=element.className;element.className=className}}function persist(elementId,className){var expiration=new Date();expiration.setFullYear(expiration.getFullYear()+10);document.cookie=elementId+"="+className+"; path=/; expires="+expiration.toGMTString()}function desist(elementId){var expiration=new Date();expiration.setFullYear(expiration.getFullYear()-10);document.cookie=elementId+"=test; path=/; expires="+expiration.toGMTString()}function scheduleShow(){if(this.getElementsByTagName){setTipShow(this.getElementsByTagName("div"));setTipShow(this.getElementsByTagName("span"))}}function setTipShow(children){for(var i=0;i<children.length;i++){if(children[i].className.indexOf("toolTip")!=-1){children[i].mouseover=true;if(children[i].id){window.setTimeout('showTip("'+children[i].id+'")',250)}}}}function scheduleHide(){if(this.getElementsByTagName){setTipHide(this.getElementsByTagName("div"));setTipHide(this.getElementsByTagName("span"))}}var length=1000;function setTipHide(children){for(var i=0;i<children.length;i++){if(children[i].className.indexOf("toolTip")!=-1){children[i].mouseover=false;if(children[i].id){window.setTimeout('clearTip("'+children[i].id+'")',length)}}}}function showTip(id){var element=$(id);if(element.mouseover){element.style.display="block"}}function clearTip(id){var element=$(id);if(!element.mouseover){element.style.display="none"}else{window.setTimeout('clearTip("'+id+'")',1000)}}function recordParentMouseover(){this.parentNode.mouseover=true}function recordParentMouseout(){this.parentNode.mouseover=false}function setTooltips(elementType,newlength){if(newlength){length=newlength}if(!elementType){elementType="span"}if(document.getElementsByTagName){var spans=document.getElementsByTagName(elementType);for(var i=0;i<spans.length;i++){var span=spans[i];if(span.className.indexOf("moreInfo")!=-1){span.onmouseover=scheduleShow;span.onmouseout=scheduleHide;setEvents(span,"div");setEvents(span,"span")}}}}function setEvents(object,elementType){var divs=object.getElementsByTagName(elementType);for(var j=0;j<divs.length;j++){if(divs[j].className.indexOf("toolTip")!=-1){divs[j].onmouseover=recordParentMouseover;divs[j].onmouseout=recordParentMouseout}}}function swapDescriptions(link){var div=link.parentNode.parentNode;var ps=div.getElementsByTagName("p");for(var i=0;i<ps.length;i++){var p=ps[i];if(p.className.indexOf("productDescriptionExcerpt")>=0){p.style.display="none"}else{if(p.className.indexOf("productDescriptionFullText")>=0){p.style.display="block"}}}}function openLoginLite(msg,callback){if(jQuery("#loginLiteMessage").length==0){jQuery("#loginLite").load("/utility/loginlite",function(){openLoginLite(msg,callback)})}else{if(!msg){msg="<strong>Hey smarty!</strong>  To make your vote count, <a href=\"#\" onclick=\"jQuery('#login-option').show(); jQuery('#join-option').hide(); return false;\">login</a> or <a href=\"#\" onclick=\"jQuery('#login-option').hide(); jQuery('#join-option').show(); return false;\">join Squidoo</a> for free."}jQuery("#loginLiteMessage").html(msg);jQuery("#default_onion").show();jQuery("#loginLite").show();jQuery("#login_redirect").val("/"+theLensName);jQuery("#reg_redirect").val("/"+theLensName);window.scrollTo(0,0);if(callback){callback()}}}function openPlexSubmit(lmi,lensName,surfer){if(surfer){if(theMember){$J("#add-options"+lmi).show();$J("#bulkSurfer"+lmi).show();$J("#captcha_"+lmi).captcha();return false}}else{Element.show("bulk"+lmi)}}function plexSubmit(lmi,approval){var pass=null;myform=$("plexoForm"+lmi);pass=validate(myform);if(pass){var inputs=myform.getElementsByTagName("input");var textareas=myform.getElementsByTagName("textarea");postString=saveFields(inputs);postString+=saveFields(textareas);new Ajax.Request("/utility/plexo_submit/"+lmi,{asynchronous:true,method:"post",postBody:postString,onSuccess:function(response){if(response.responseText=="captcha_error"){alert("The security word you entered is incorrect. Please try again.")}else{if(response.responseText==null||response.responseText==""){if(approval=="manual"){$("add-options"+lmi).innerHTML='<div style="text-align: center; font-weight: bold; width: 80%; padding: 20px;"><img src="/images/btn-submitted.gif" alt="Submitted" style="text-align: center;" /> <br /><br />Thanks! Your item was submitted successfully, and is now pending approval from the lensmaster.</div>'}else{$("add-options"+lmi).innerHTML='<div style="text-align: center; font-weight: bold; width: 80%; padding: 20px;"><img src="/images/btn-submitted.gif" alt="Submitted" style="text-align: center;" /> <br /><br />Thanks! Your item was submitted successfully and will appear shortly. Don\'t forget to vote for it!</div>'}}else{alert("There was a problem saving your submission:\n\n"+response.responseText)}}}})}return false}function plexVote(lmi,lens_name,item_id,direction){if(window.theMember){member_id=theMember.id;new Ajax.Request("/utility/plexo_vote/"+item_id+"/"+direction,{onSuccess:function(response){if(response.responseText.indexOf("|")==0){var curPoints=response.responseText.substr(1);var children=$("plexItem"+item_id).getElementsByTagName("div");for(var i=0;i<children.length;i++){if(direction=="up"){if(children[i].className.indexOf("vote-up")>-1||children[i].className.indexOf("voted-up")>-1){children[i].className="voted-up"}else{if(children[i].className.indexOf("vote-down")>-1||children[i].className.indexOf("voted-down")>-1){children[i].className="vote-down"}}}else{if(direction=="down"){if(children[i].className.indexOf("vote-up")>-1||children[i].className.indexOf("voted-up")>-1){children[i].className="vote-up"}else{if(children[i].className.indexOf("vote-down")>-1||children[i].className.indexOf("voted-down")>-1){children[i].className="voted-down"}}}}}var newDisplay="";if(curPoints==-1||curPoints==1){newDisplay=curPoints+' point - <a href="javascript:window.location.reload();" title="refresh the page">refresh to rerank</a>'}else{newDisplay=curPoints+' points - <a href="javascript:window.location.reload()" title="refresh the page">refresh to rerank</a>'}var voteHistory=eval("voted"+lmi);if(!voteHistory[item_id]||voteHistory[item_id]!=direction){new Effect.Highlight("plexItem"+item_id);window.eval("voted"+lmi+"["+item_id+'] = "'+direction+'"')}$("pointsDisplay"+item_id).innerHTML=newDisplay}else{alert("There was a problem saving your vote. The problem was: "+"\n\n"+response.repsponseText)}},asynchronous:true,method:"post"});return false}else{return false}}function plexWidget(lmi,plex_id,size,num_results,link){if(link){contents='<div id="plex'+plex_id+'"><a href="'+link+'">Click through to see the plexo</a></div>'}else{contents='<div id="plex'+plex_id+'"></div>'}contents+='<script type="text/javascript" src="http://www.squidoo.com/scripts/plexo/syndicate.php?plex_id='+plex_id+'"><\/script>\n';contents+='<script type="text/javascript">\n';contents+="  openPlexo({\n";contents+='    "container" : "plex'+plex_id+'"';if(size=="sidebar"){contents+=',\n    "size" : "sidebar"\n'}if(num_results!=undefined){contents+=',\n    "num_results" : "'+num_results+'"\n'}contents+="  });\n";contents+="<\/script>";$("widget-code-box"+lmi).value=contents;Element.show("widget-code"+lmi)}function openHelper(lmi,url){var width=550;var height=420;var _left=((screen.width-width)>>1);var _top=((screen.height-height)>>1);myWin=eval("helperWindow"+lmi);myWin=window.open(url,"modules_id"+lmi+"_helper","status=yes,scrollbars=yes,resizable=yes,width="+width+",height="+height+",left="+_left+",top="+_top);if(myWin.opener==null){myWin.opener=window}myWin.opener.name="opener";myWin.focus()}function showItems(lmi,surfer,invalid){var surf="";if(surfer){surf="Surfer"}Element.show("plexSubmission"+surf+lmi);if(!invalid){Element.hide("bulk"+surf+lmi)}new Effect.Highlight("bulkList"+surf+lmi)}function hideToolbox(){$("toolbox-contents").hide();$("toggle-off").hide();$("toggle-on").show();var date=new Date();date.setTime(date.getTime()+(60*24*60*60*1000));var expires=date.toGMTString();document.cookie="hide_toolbox = true; expires="+expires+"; path=/";return false}function showToolbox(){$("toolbox-contents").show();$("toggle-off").show();$("toggle-on").hide();var date=new Date();date.setTime(date.getTime()+(-1*24*60*60*1000));var expires=date.toGMTString();document.cookie="hide_toolbox = true; expires="+expires+"; path=/";return false}function hideSquidUTips(){$("tip-squidu").hide();var date=new Date();date.setTime(date.getTime()+(60*24*60*60*1000));var expires=date.toGMTString();document.cookie="hide_squidu_tips = true; expires="+expires+"; path=/";return false}if(typeof Effect=="undefined"){var Effect=function(){return{Highlight:function(elem,options){try{if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).fadeIn("fast");jQuery("#"+elem).fadeOut("fast");jQuery("#"+elem).fadeIn("fast")}catch(ex){}},Fade:function(elem,options){try{var len="slow";if(typeof options=="object"){len=options*1000}if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).fadeOut(len)}catch(ex){}},Appear:function(elem,options){try{if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).show()}catch(ex){}},Pulsate:function(elem,options){try{if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).fadeIn("fast");jQuery("#"+elem).fadeOut("fast");jQuery("#"+elem).fadeIn("fast");jQuery("#"+elem).fadeOut("fast");jQuery("#"+elem).fadeIn("fast");jQuery("#"+elem).fadeOut("fast");jQuery("#"+elem).fadeIn("fast");jQuery("#"+elem).fadeOut("fast");jQuery("#"+elem).fadeIn("fast")}catch(ex){}},Grow:function(elem,options){try{if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).show()}catch(ex){}},BlindUp:function(elem,options){try{if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).slideUp("fast")}catch(ex){}},BlindDown:function(elem,options){try{if(typeof elem=="object"){elem=elem.id}jQuery("#"+elem).slideDown("fast")}catch(ex){}}}}()}if(pageLoadActions==undefined){var pageLoadActions=[];var loaded=false}onPageLoadHandler=function(){if(!loaded){for(iterator=0;iterator<pageLoadActions.length;iterator++){var fn=pageLoadActions[iterator];if(typeof fn=="function"){pageLoadActions[iterator]()}else{}}loaded=true}};function hasPageLoaded(){if(typeof(pageBottomLoaded)!="undefined"){onPageLoadHandler()}}jQuery(document).ready(onPageLoadHandler);window.setTimeout(hasPageLoaded,12000);var ajaxSpanStart='<span id="ajaxErrorText">';var ajaxSpanEnd="</span>";function validate(myform,errorElement){var result=true;if(typeof(myform)=="string"){myform=document.getElementById(myform)}if(errorElement==null){errorElement="errors"}var errors=$(errorElement);errors.style.display="none";errors.innerHTML="";inputresult=validateFields(myform,"input",errors);selectresult=validateFields(myform,"select",errors);textarearesult=validateFields(myform,"textarea",errors);ajaxresult=true;if($("ajaxErrors")&&$("ajaxErrors").innerHTML.length){ajaxresult=false}if(!ajaxresult){errors.innerHTML+=ajaxSpanStart+"- "+$("ajaxErrors").innerHTML+ajaxSpanEnd}result=inputresult&&selectresult&&textarearesult&&ajaxresult;if($("notSubmittable")){result=false;errors.innerHTML+=" - Your submission could not be processed. Please check the form for any remaining errors<br />"}if(!result){errors.style.display="block"}else{errors.style.display="none"}return result}function scrollToElement(id){var x=0;var y=0;var element=$(id);while(element){x+=element.offsetLeft;y+=element.offsetTop;element=element.offsetParent}window.scrollTo(x,y)}function waitForAJAX(formName,errorElement){if(!errorElement){errorElement="errors"}if(ajaxRunning){var ajaxTimer=setTimeout("waitForAJAX('"+formName+"', '"+errorElement+"')",500)}else{if(!$(errorElement).innerHTML.length){$(errorElement).style.display="none";$(formName).submit()}else{$(errorElement).style.display="block"}}}function validateFields(myform,tagname,errors){var fields=myform.getElementsByTagName(tagname);var pass=true;var message="";var errorsFound=new Array();for(var i=0;i<fields.length;i++){var fieldpass=true;var fieldvalue=fields[i].value;var fieldname=fields[i].name;var message_fieldname=fieldname.replace(/_/g," ");var themessage="";if(fields[i].getAttribute("maxlength")){var max=fields[i].getAttribute("maxlength");var value=fields[i].value;if(value.length>max){value=value.substr(0,max);fields[i].value=value}}var errormessage="";if(fields[i].getAttribute("errormessage")){errormessage=" - "+fields[i].getAttribute("errormessage")+"<br />"}if((!fields[i].getAttribute("ignore")||fields[i].getAttribute("ignore")==null)&&fields[i].getAttribute("required")){if(tagname!="select"&&fieldvalue==""){fieldpass=false;if(errormessage==""){themessage=" - Please enter your "+message_fieldname+"<br />"}else{themessage=errormessage}}if(fields[i].options){if(fields[i].selectedIndex<1){fieldpass=false;if(errormessage==""){themessage=" - Please select a "+message_fieldname+"<br />"}else{themessage=errormessage}}}if(fields[i].className.indexOf("radio")>=0){var buttons=document.getElementsByName(fieldname);fieldpass=false;for(var j=0;j<buttons.length;j++){if(buttons[j].checked){fieldpass=true}}if(!fieldpass){if(errormessage==""){themessage=" - Please select a "+message_fieldname+" value<br />"}else{themessage=errormessage}}}}else{if(!fields[i].getAttribute("ignore")&&fields[i].getAttribute("validate")&&fields[i].getAttribute("validate").length){var pattern=fields[i].getAttribute("validate");if(pattern=="email"){pattern="[\\_\\d\\w\\.'\\-]+@([\\d\\w'\\-]\\.?)+"}else{if(pattern=="url"){fieldvalue=fieldvalue.replace("http://http","http");fields[i].value=fieldvalue;pattern="^https?://([\\_\\d\\w\\-]+\\.)+[\\_\\d\\w\\-]+(:\\d+)?(/[^\\s]*)*$"}else{if(pattern=="feed"){pattern="^((https?://)|(feed:(//)?))([\\_\\d\\w\\-]+\\.)+[\\_\\d\\w\\-]+(:\\d+)?(/[^\\s]*)*$"}else{if(pattern=="password"){pattern="[\\S]{4,8}"}else{if(pattern=="tag"){pattern="^[^\\\\\\/\\!@#$%\\^\\?<>\\|\\{\\}\\[\\]=+~`&\\*\\(\\)]+$"}}}}}var re=new RegExp(pattern);if(!re.test(fieldvalue)){fieldpass=false;if(errormessage==""){themessage=" - Please make sure that you are entering your "+message_fieldname+" in the correct format<br />"}else{themessage=errormessage}}}}if(!fields[i].getAttribute("ignore")&&fields[i].getAttribute("confirms")){var confirmed_field=fields[i].getAttribute("confirms");if($(confirmed_field).value.toLowerCase()!=fieldvalue.toLowerCase()){fieldpass=false;if(errormessage==""){themessage=" - Please make sure that your "+confirmed_field.replace("_"," ")+" is entered correctly in both fields<br />"}else{themessage=errormessage}}}var mydiv=findParentDiv(fields[i]);var mydivClass=mydiv.className;if(!mydiv.getAttribute("classPristine")){mydiv.setAttribute("classPristine",mydivClass)}if(!fieldpass){pass=false;mydiv.className=mydivClass+" error";fields[i].setAttribute("error","true");var added=false;for(var j=0;j<errorsFound.length;j++){if(errorsFound[j]==themessage){added=true}}if(!added){errorsFound.push(themessage)}}else{if(fields[i].getAttribute("error")){mydiv.className=mydivClass.replace(" error","")}}}if(!pass&&errorsFound.length>0){errors.innerHTML+=errorsFound.join("\n")}return pass}function findParentDiv(element){var parent=element.parentNode;while(parent.tagName!="DIV"){parent=parent.parentNode}return parent}function saveFields(collection,lmi){var postString="";for(var i=0;i<collection.length;i++){var field=collection[i];var fieldId=field.id;var fieldName=field.name;var tempString="";if(field.type!="checkbox"&&field.type!="submit"&&field.type!="image"&&field.type!="select-one"&&field.type!="radio"){var value=field.value;var resultField=fieldId+"_value";if(fieldName.indexOf("[")>-1){resultField=fieldName.substr(0,fieldName.indexOf("["))+"_value"}if($(resultField)&&value!=""){if(fieldName.indexOf("[")>-1&&i>0){var current=$(resultField).innerHTML;if(current!=""){current=current+", "+escapeForDisplay(value,true)}else{current=escapeForDisplay(value)}$(resultField).innerHTML=current}else{$(resultField).innerHTML=escapeForDisplay(value,true)}}else{if($(resultField)&&value==""&&i==0){$(resultField).innerHTML=""}}if(fieldName.indexOf("[]")>0){var newFieldName=fieldName.replace("[]","");if(postString.indexOf(newFieldName+"=")>=0){var nameAt=postString.indexOf(newFieldName+"=");var ampersandAt=postString.indexOf("&",nameAt);var postSlice=postString.slice(nameAt,ampersandAt);var newSlice=postSlice+","+escapeForURL(value);postString=postString.substr(0,nameAt)+newSlice+postString.substr(ampersandAt)}else{postString+=newFieldName+"="+escapeForURL(value)+"&"}}else{postString+=fieldName+"="+escapeForURL(value)+"&"}}else{if(field.type=="checkbox"&&field.checked&&fieldName.indexOf("[]")<0){postString+=fieldName+"=1&"}else{if(field.type=="checkbox"&&field.checked&&fieldName.indexOf("[]")>0){var newFieldName=fieldName.replace("[]","");var value=field.value;if(postString.indexOf(newFieldName+"=")>=0){var nameAt=postString.indexOf(newFieldName+"=");var ampersandAt=postString.indexOf("&",nameAt);var postSlice=postString.slice(nameAt,ampersandAt);var newSlice=postSlice+","+escapeForURL(value);postString=postString.substr(0,nameAt)+newSlice+postString.substr(ampersandAt)}else{postString+=newFieldName+"="+escapeForURL(value)+"&"}}else{if(field.type=="select-one"){var value=field.options[field.selectedIndex].value;postString+=fieldName+"="+escapeForURL(value)+"&"}else{if(field.type=="radio"){if(field.checked=="1"){postString+=fieldName+"="+escapeForURL(field.value)+"&"}}}}}}}return postString}function escapeForDisplay(s,allowHTML){if(s!=null){var t=new String(s);t=t.replace(/&/g,"&amp;");if(!allowHTML){t=t.replace(/</g,"&lt;");t=t.replace(/>/g,"&gt;");t=t.replace(/\"/g,"&quot;")}t=t.replace(/\r/g,"");t=t.replace(/\n/g,"<br />\n");t=t.replace(/&amp;nbsp;/g,"&nbsp;");return t}else{return""}}function escapeForFormField(s){return escapeForDisplay(s)}function escapeForURL(s){if(s!=null){var t=new String(escape(s));t=t.replace(/\+/g,"%2B");return t}else{return""}}function stripTags(s){var regExp=/<\/?[^>]+>/gi;s=s.replace(regExp,"");return s}function makeTinyMce(elementId,force){var found=false;var isSafari=navigator.userAgent.indexOf("Safari")!=-1;if(elements){for(var i=0;i<elements.length;i++){if(elements[i].substr(0,elementId.length+1)==elementId+":"){found=true}}if(!isSafari&&(!found||force)){elements.push(elementId);tinyMCE.execCommand("mceAddControl",false,elementId)}}}function unMakeTinyMce(elementId){var found=false;var isSafari=navigator.userAgent.indexOf("Safari")!=-1;if(elements){for(var i=0;i<elements.length;i++){if(elements[i].substr(0,elementId.length+1)==elementId+":"){found=true}}if(!isSafari&&found){elements.pop(elementId);tinyMCE.execCommand("mceRemoveControl",false,elementId)}}}function checkTinyMceContent(myform){var textareas=myform.getElementsByTagName("textarea");for(var i=0;i<textareas.length;i++){var editorId="";var id=textareas[i].id;for(var j=0;j<elements.length;j++){if(textareas[i].id+":"==elements[j].substr(0,textareas[i].id.length+1)){editorId=elements[j].replace(textareas[i].id+":","")}}var instance=null;if(instance=tinyMCE.getInstanceById(editorId)){var markup=textareas[i].value;var tiny=instance.getBody().innerHTML;if(markup!=tiny){textareas[i].value=tiny}}}}var Facebook_SDK_Helper=function(){return{debug:false,login_cbs:[],logout_cbs:[],initialized:false,initializing:false,isMSIE:function(){return"\v"=="v"},hasActiveX:function(){try{versionString=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version");return true}catch(x){return false}return false},badMSIEActiveX:function(){if(this.isMSIE()){return !this.hasActiveX()}},log:function(){if(this.debug&&window.console){var msg,args=[];for(var i=0;i<arguments.length;i++){if(i==0){msg="Facebook_SDK_Helper::"+arguments[i]}else{args.push(arguments[i])}}console.log(msg,args)}},error:function(){if(this.debug&&window.console){var msg,args=[];for(var i=0;i<arguments.length;i++){if(i==0){msg="Facebook_SDK_Helper::"+arguments[i]}else{args.push(arguments[i])}}console.error(msg,args)}},isStageServer:function(){var result=location.host.indexOf("octosquid");return(result>-1)},init:function(){if(this.initialized){return false}this.initializing=true;this.log("init");var app_id=null,channel_url=null;if(this.isStageServer()){app_id="40817683610";channel_url="http://octosquid.squidoo.com:2000/utility/fb_custom_channel"}else{app_id="37459380049";channel_url="http://www.squidoo.com/utility/fb_custom_channel"}FB.init({appId:app_id,status:true,cookie:true,xfbml:true,channelUrl:channel_url});FB.Event.subscribe("auth.sessionChange",function(response){if(response.status=="connected"){Facebook_SDK_Helper.userIsLoggedIn(response.status,response.session)}else{if(response.status=="notConnected"||response.status=="unknown"){Facebook_SDK_Helper.userIsLoggedOut(response.status,response.session)}else{if(window.console){console.warn("Facebook_SDK_Helper::auth.sessionChange: user status ["+response.status+"] is unrecognized")}}}});this.initializing=false;this.initialized=true;this.updateLoginStatus()},login:function(){this.log("login");FB.login(function(response){if(response.session){Facebook_SDK_Helper.userIsLoggedIn(response.status,response.session);jQuery.post("/utility/fb_stash_profile_pic")}else{Facebook_SDK_Helper.userIsLoggedOut(response.status,null)}})},updateLoginStatus:function(){this.log("updateLoginStatus");FB.getLoginStatus(function(response){if(response.session){Facebook_SDK_Helper.userIsLoggedIn(response.status,response.session,response.perms);jQuery.post("/utility/fb_stash_profile_pic")}else{Facebook_SDK_Helper.userIsLoggedOut(response.status,null)}})},subscribe:function(login_cb,logout_cb){this.log("subscribe",login_cb,logout_cb);if(login_cb){this.login_cbs.push(login_cb)}if(logout_cb){this.logout_cbs.push(logout_cb)}},userIsLoggedIn:function(status,session,permissions){this.log("userIsLoggedIn",status,session,permissions);for(var i=0;i<this.login_cbs.length;i++){var cb=this.login_cbs[i];cb(status,session,permissions)}},userIsLoggedOut:function(status,session){this.log("userIsLoggedOut",status,session);for(var i=0;i<this.logout_cbs.length;i++){var cb=this.logout_cbs[i];cb(status,session)}},getPageStats:function(url,cb){this.log("getPageStats",url,cb);FB.api({method:"links.getStats",urls:url},function(response){if(cb){cb(response)}})},getUid:function(){this.log("getUid");if(FB._session&&FB._session.uid){return FB._session.uid}},makeShareButtons:function(){this.log("makeShareButtons");var page_url;if(typeof(theLensName)!="undefined"){page_url="http://www.squidoo.com/"+theLensName}else{page_url=location.href}this.getPageStats(page_url,function(stats){var markup=[];var count=0;if(stats){count=stats[0].total_count}markup.push('<span class="fb_share_size_Small ">');markup.push('<span class="FBConnectButton FBConnectButton_Small" style="cursor:pointer;">');markup.push('<span class="FBConnectButton_Text">Share</span></span>');markup.push('<span class="fb_share_count_nub_right "></span>');markup.push('<span class="fb_share_count  fb_share_count_right"><span class="fb_share_count_inner">'+count+"</span></span></span>");jQuery("a.fb_share").each(function(){var full_url=[];full_url.push("http://www.facebook.com/sharer.php?u=");full_url.push(Facebook_SDK_Helper.URLEncode("http://www.squidoo.com/"+theLensName));full_url.push("&t=");full_url.push(Facebook_SDK_Helper.URLEncode(jQuery(this).attr("title")));jQuery(this).html(markup.join("")).attr("style","text-decoration: none;").attr("href",full_url.join("")).bind("click",function(){var page=jQuery(this).attr("href");var count;_gaq.push(["_trackEvent","Share-Widgets","Facebook",theLensName]);window.open(page,"sharer","toolbar=0,status=0,width=626,height=436");jQuery(this).unbind("click");jQuery(this).bind("click",function(){return false});count=parseInt(jQuery(".fb_share_count_inner",jQuery(this)).html())+1;jQuery(".fb_share_count_inner",jQuery(this)).fadeOut("fast").html(count.toString()).fadeIn("fast");return false})})})},likeLens:function(url){this.log("likeLens",url);_gaq.push(["_trackEvent","Share-Widgets","Facebook-Like",theLensName]);SquidgamingJS.post("/utility/fb_like_count",{lens_id:theLensId})},sharePopup:function(url,title){this.log("sharePopup",url,title);var full_url=[];full_url.push("http://www.facebook.com/sharer.php?u=");full_url.push(Facebook_SDK_Helper.URLEncode(url));full_url.push("&t=");full_url.push(Facebook_SDK_Helper.URLEncode(title));window.open(full_url.join(""),"sharer","toolbar=0,status=0,width=626,height=436")},get_status:function(){this.log("get_status");try{this.safe_call(function(){FB.Connect.get_status().waitUntilReady(function(status){return status})})}catch(ex){this.log("Facebook_Helper::get_status "+ex.description)}return result},connect:function(cb_success,cb_fail){try{var status=this.get_status();if(status==FB.ConnectState.connected){if(cb_success){cb_success()}}else{this.safe_call(function(){Facebook_Helper.log("requireSession");FB.Connect.requireSession(function(){if(cb_success){Facebook_Helper.log("success connect");cb_success()}},function(){if(cb_fail){Facebook_Helper.log("fail connect");cb_fail()}})})}}catch(ex){this.error("connect",ex)}},logout:function(cb){this.log("logout",cb);try{this.safe_call(function(){FB.logout(function(response){cb(true)})})}catch(ex){this.error("logout",ex);cb(false)}},getFriends:function(cb){this.log("getFriends",cb);try{this.safe_call(function(){FB.Facebook.apiClient.friends_get(null,function(result){if(cb){cb(result)}})})}catch(ex){this.error("getFriends",ex)}},parseDomTree:function(){this.log("parseDomTree");try{this.safe_call(function(){FB.XFBML.Host.parseDomTree()})}catch(ex){this.error("parseDomTree",ex)}},promptPublishAll:function(cb){this.log("promptPublishAll",cb);try{this.safe_call(function(){FB.Connect.showPermissionDialog("publish_stream",cb,true)})}catch(ex){this.error("promptPublishAll",ex)}},promptPermission:function(permission,cb){this.log("promptPermission",permission,cb);try{this.safe_call(function(){FB.Facebook.apiClient.users_hasAppPermission(permission,function(result){if(result===0){FB.Connect.showPermissionDialog(permission,cb)}else{cb(true)}})})}catch(ex){this.log("promptPermssion",ex)}},checkAppPermission:function(permission,cb){this.log("checkAppPermission",permission,cb);try{this.safe_call(function(){FB.Facebook.apiClient.users_hasAppPermission(permission,function(result){cb(result)})})}catch(ex){this.log("Facebook_Helper::hasAppPermission",ex)}},URLEncode:function(c){var o="";var x=0;c=c.toString();var r=/(^[a-zA-Z0-9_.]*)/;while(x<c.length){var m=r.exec(c.substr(x));if(m!=null&&m.length>1&&m[1]!=""){o+=m[1];x+=m[1].length}else{if(c[x]==" "){o+="+"}else{var d=c.charCodeAt(x);var h=d.toString(16);o+="%"+(h.length<2?"0":"")+h.toUpperCase()}x++}}return o},URLDecode:function(s){var o=s;var binVal,t;var r=/(%[^%]{2})/;while((m=r.exec(o))!=null&&m.length>1&&m[1]!=""){b=parseInt(m[1].substr(1),16);t=String.fromCharCode(b);o=o.replace(m[1],t)}return o},dummy:function(){}}}();var Facebook_Helper=function(){return{init:function(){},get_uid:function(){Facebook_SDK_Helper.getUid()},dummy:function(){}}}();var Twitter_Helper=function(){return{cb:null,debug:false,log:function(msg){if(this.debug&&window.console){console.log(msg)}},track_event:function(type){var url="/track/ajax_click?";url+="&lens_id="+theLensId;url+="&url="+escape("http://twitter.com/"+type);$J.get(url)},popup:function(url,name,width,height,do_track){var left=(screen.width-width)/2;var top=(screen.height-height)/2;do_track=false;if(do_track){var postString="url="+escape(url)+"&lens_id="+theLensId;_gaq._trackEvent("twitter_helper",name,theLensName);var url="/track/ajax_click?";url+="&lens_id="+theLensId;url+="&url="+escape(url);$J.get(url)}window.open(url,name,"status=0,location=0,toolbar=0,resizable=1,scrollbars=1,height="+height.toString()+",width="+width.toString()+",left="+left.toString()+",top="+top.toString())},tweet:function(msg){var url="http://twitter.com/home?status="+msg;this.track_event("tweet");this.popup(url,"twitter",780,480,false)},retweet:function(twitter_username,msg,link){var url="http://twitter.com/home?status=RT+%40"+twitter_username+"%3A+"+msg.replace(/#/gi,"%23")+"+"+link;this.track_event("retweet");this.popup(url,"twitter",780,480,false)},reply:function(twitter_username,link){var url="http://twitter.com/home?status=%40"+twitter_username+"%3A+"+"+"+link;this.track_event("reply");this.popup(url,"twitter",780,480,false)},finalize:function(twitter_list_item_id,lmi,cb){new Ajax.Request("/utility/twitter_list_item_finalize",{postBody:"id="+twitter_list_item_id+"&lmi="+lmi,method:"post",asynchronous:true,onSuccess:function(response){var resp=response.responseText;if(resp=="ok"){if(cb){cb(true)}}else{if(cb){cb(false)}}}})},post:function(msg,lmi,cb){var max_len=110;if(msg.length>max_len){alert("The message you entered is too long. Please limit to "+max_len.toString()+" characters.")}else{if(msg.length==0){alert("You must enter a message.")}else{new Ajax.Request("/utility/twitter_list_post",{postBody:"msg="+msg+"&lmi="+lmi,method:"post",asynchronous:true,onSuccess:function(response){var resp=response.responseText.split("|");if(resp[0]=="ok"){if(cb){cb(true)}}else{Twitter_Helper.do_oauth(function(){Twitter_Helper.finalize(resp[1],lmi,cb)})}}})}}},do_oauth:function(callback_function){var height=380;var width=780;var left=(screen.width-width)/2;var top=(screen.height-height)/2;this.cb=callback_function;window.open("/utility/twitter_oauth","twitter_oauth","status=0,location=0,toolbar=0,resizable=0,scrollbars=0,height="+height.toString()+",width="+width.toString()+",left="+left.toString()+",top="+top.toString())},search:function(parameters,cb,cb_params){var post_body="";for(var prop in parameters){post_body+=prop+"="+parameters[prop]+"&"}new Ajax.Request("/utility/twitter_search",{postBody:post_body,method:"post",asynchronous:true,onSuccess:function(response){if(cb){if(cb_params){cb(response,cb_params)}else{cb(response)}}}})},add_search_item:function(id,lmi,tweet,tweet_time,tweet_user,cb){var post_body="";post_body="id="+id+"&lmi="+lmi+"&tweet="+tweet+"&tweet_time="+tweet_time+"&tweet_user="+tweet_user;new Ajax.Request("/utility/twitter_add_list_item",{postBody:post_body,method:"post",asynchronous:true,onSuccess:function(response){if(cb){cb()}}})},delete_list_item:function(id,lmi,cb){var post_body;post_body="id="+id+"&lmi="+lmi;new Ajax.Request("/utility/twitter_del_list_item",{postBody:post_body,method:"post",asynchronous:true,onSuccess:function(response){if(cb){cb()}}})},promote_user_item:function(id,lmi){var post_body;post_body="id="+id+"&lmi="+lmi;new Ajax.Request("/utility/twitter_promote_list_item",{postBody:post_body,method:"post",asynchronous:true,onSuccess:function(response){}})},get_screen_name:function(cb){new Ajax.Request("/utility/twitter_get_current_screen_name",{postBody:"",method:"post",asynchronous:true,onSuccess:function(response){if(cb){cb(response.responseText)}}})},_callback:function(){this.log("Twitter_OAuth._callback()");if(this.cb){this.cb()}}}}();var SquidooComments=function(){return{show_on_close_el:null,current_form:null,initial_type:"visitor",fb_available:false,captcha_loaded:false,debug:false,log:function(msg){if(this.debug&&window&&window.console){window.console.log(msg)}},setFocus:function(el){var comment_parent=el.parents("li:eq(0)");if(comment_parent.length==0){comment_parent=el.parents("div.module:eq(0)");if(comment_parent.length==0){return}}var off=comment_parent.offset();var y=off.top-0;el.focus();jQuery("html,body").animate({scrollTop:y},250)},display_tabs:function(display_params){var el_visitor=jQuery("li.gb_li_visitor",this.current_form);var el_squidoo=jQuery("li.gb_li_squidoo",this.current_form);var el_facebook=jQuery("li.gb_li_facebook",this.current_form);var el_twitter=jQuery("li.gb_li_twitter",this.current_form);var el_email_notify=jQuery("div.gb_email_check",this.current_form);if(display_params.visitor){el_visitor.show()}else{el_visitor.hide()}if(display_params.squidoo){el_squidoo.show()}else{el_squidoo.hide()}if(display_params.facebook){el_facebook.show()}else{el_facebook.hide()}if(display_params.twitter){el_twitter.show()}else{el_twitter.hide()}if(display_params.email_notify){el_email_notify.show()}else{el_email_notify.hide()}},new_form:function(lmi,blurb_type,insert_el,show_on_close_el,display_params){if(this.current_form){this.close()}var new_el=jQuery("#primary_comment_input").clone().removeAttr("id").appendTo(insert_el);jQuery("input[name='comment_lmi']",new_el).val(lmi);jQuery("input[name='blurb_type']",new_el).val(blurb_type);var text_area=jQuery("textarea",new_el);if(text_area){setTimeout(function(){SquidooComments.setFocus(text_area)},100)}new_el.show();this.switch_type(this.initial_type);this.show_on_close_el=show_on_close_el;this.current_form=new_el;this.display_tabs(display_params);return this},reply_form:function(lmi,blurb_type,parent_id,insert_el,display_params){evTrack("Guestbook","Reply");this.new_form(lmi,blurb_type,insert_el,null,display_params);jQuery("input[name='comment_parent_id']",this.current_form).val(parent_id);return this},close:function(){if(this.current_form){this.current_form.parent().empty();this.current_form=null;if(this.show_on_close_el){this.show_on_close_el.show();this.show_on_close_el=null}}},save:function(){var valid=true;this.hide_error();var the_comment=jQuery.trim(jQuery("textarea",this.current_form).val());if(the_comment==""){valid=false;message="Your comment cannot be blank. Please enter a comment and try again."}if(valid){var the_form=jQuery("form",this.current_form);var post_data=the_form.serialize();evTrack("Guestbook","Submit");jQuery.post("/utility/post_blurb",post_data,function(response){if(typeof(SquidgamingJS)=="object"){setTimeout(function(){SquidgamingJS.get("/utility/gaming_away_notice")},1000)}SquidooComments.post_save(response)})}else{this.show_error(message)}return false},setup_comment_button:function(button,newForm,display){if(!display.visitor&&!window.isLoggedIn){Squidoo.login(button.first(),function(logged_in,response){if(logged_in){newForm(button,display).switch_type("squidoo",response.member)}})}else{button.click(function(){newForm(button,display).switch_type((window.isLoggedIn?"squidoo":"visitor"),window.theMember);return false})}},show_error:function(msg){jQuery("#comment_error_message",this.current_form).html(msg).show();setTimeout(function(){SquidooComments.hide_error()},5000)},hide_error:function(){this.log("here");jQuery("#comment_error_message",this.current_form).fadeOut(2500)},load_more:function(replace_el,lmi,blurb_type,per_page,page,show_photos,strip_html){var post_data={lmi:lmi,blurb_type:blurb_type,per_page:per_page,page:page,show_photos:show_photos?"true":"false",strip_html:strip_html?"true":"false"};evTrack("Guestbook","LoadMore");jQuery.post("/utility/more_blurbs",post_data,function(response){if(response!="error"){jQuery(replace_el).parent().replaceWith(response)}})},cancel:function(){evTrack("Guestbook","Cancel");this.close()},switch_type:function(new_type,member){if(member==undefined){member=window.theMember}this.log("switch_type");var allowed=false;if(new_type=="facebook"){if(!this.fb_available){return this.switch_fb()}}this.log("setting type: "+new_type);this.log(this.current_form);jQuery("input[name='comment_type']",this.current_form).val(new_type);jQuery("#gb_type_"+new_type).attr("checked","checked");jQuery("ul.gb_select li",this.current_form).removeClass("gb_selected");jQuery("ul.gb_select li.gb_li_"+new_type,this.current_form).addClass("gb_selected");jQuery("div.gb_type_elements div",this.current_form).hide();jQuery("div.gb_type_elements div.gb_elements_"+new_type,this.current_form).show();if(new_type=="squidoo"&&member){jQuery(".gb_photo img",this.current_form).attr("src","/media/lensmaster/50/"+member.username);jQuery(".gb_btn_post_comment",this.current_form).text("Post as "+member.username)}if((new_type=="facebook")||(new_type=="twitter")||(new_type=="squidoo"&&member&&(member.roles.admin||member.roles.giant))){jQuery("div.gb_captcha",this.current_form).hide()}else{jQuery("div.gb_captcha",this.current_form).show();if(!this.captcha_loaded){jQuery.get("/utility/load_captcha/new",function(res){jQuery("div.gb_captcha").html(res);SquidooComments.captcha_loaded=true})}}jQuery("input[name='type']",this.current_form).val(new_type);this.initial_type=new_type;return true},set_initial_type:function(new_type){this.log("set_initial_type: "+new_type);this.initial_type=new_type;jQuery("#gb_type_"+new_type).attr("checked","checked")},set_fb_available:function(avail){this.fb_available=avail},post_save:function(response){var current_form_parent;var resp_obj=JSON.parse(response);this.captcha_loaded=false;if(this.current_form){current_form_parent=this.current_form.parent()}if(resp_obj.status=="success"){if(resp_obj.post_type=="facebook"){if(resp_obj.fb_data){var fb_data=resp_obj.fb_data;var media=null;if(fb_data.lens_image!=""){media=[{"type":"image","href":fb_data.module_url,"src":fb_data.lens_image}]}FB.ui({method:"stream.publish",message:fb_data.comment_body,attachment:{name:fb_data.module_title,caption:"{*actor*} just commented on "+fb_data.module_title,description:fb_data.module_abstract,href:fb_data.module_url,media:media},action_links:[{"text":"Join Discussion","href":fb_data.module_url},{"text":"View Lens","href":fb_data.lens_url}],user_message_prompt:"Invite your friends to join the discussion:"},function(response){if(response&&response.post_id){SquidooComments.log("Post was published.")}else{SquidooComments.log("Post was not published.")}})}}this.close();var new_el=jQuery('<div class="gb_notice">'+resp_obj.message+"</div>");current_form_parent.append(new_el);setTimeout(function(){new_el.hide()},5000)}else{this.show_error(resp_obj.message)}},xableFollowerEmail:function(checkbox_el){var checked=checkbox_el.attr("checked");var div_el=jQuery("div.gb_follower_email_div",this.current_form);if(window.theMember&&window.theMember.username){div_el.hide()}else{if(checked){div_el.show()}else{div_el.hide()}}},dummy:function(){}}}();if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var SquidgamingJS=function(){return{debug:false,windowActive:true,inInline:false,initCount:0,initCalled:false,blocked:window.block_squidgaming,log:function(what){if(this.debug&&"console" in window){console.log("SquidGaming: "+what)}},error:function(what){if(this.debug&&"console" in window){console.error("SquidGaming: "+what)}},post:function(url,data,callback,dataType){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=null}return jQuery.ajax({type:"POST",url:url,data:data,success:function(response){try{var passThru;passThru=SquidgamingJS.processAjaxResponse(response);if(callback){callback(passThru)}}catch(e){SquidgamingJS.error(e.message)}},error:function(XMLHttpRequest,textStatus,errorThrown){SquidgamingJS.error(textStatus)},dataType:"text"})},get:function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=null}var interuption=setInterval(function(){if(SquidgamingJS.blocked||jQuery(".squidoo_overlay:visible").size()||jQuery("#default_onion:visible").size()){if(SquidgamingJS.debug&&"console" in window){console.log("blocked...")}return}else{clearInterval(interuption)}jQuery.ajax({type:"GET",url:url,data:data,success:function(response){try{var passThru;passThru=SquidgamingJS.processAjaxResponse(response);if(callback){callback(passThru)}}catch(e){SquidgamingJS.error(e.message)}},error:function(XMLHttpRequest,textStatus,errorThrown){SquidgamingJS.error(textStatus)},dataType:"text"})},1000)},processAjaxResponse:function(val){var result=val;try{if(val.indexOf("||sg||")>-1){var parts=val.split("||sg||");var sgVal=jQuery.trim(parts[0]);result=jQuery.trim(parts[1]);this.handleSGInstructions(sgVal)}}catch(e){SquidgamingJS.error(e.message)}return result},handleSGInstructions:function(sgString){this.log("handleSGInstructions");if(!hasGaming){return}var o=this.parseJSON(sgString);if(SquidgamingJS.debug&&"console" in window){console.log("SquidgamingJS: sgString loaded",o)}if(o.levelNavDisplay){jQuery("#game_nav > li:eq(0)").html(o.levelNavDisplay)}if(o.pointsNavDisplay){jQuery("#game_nav > li:eq(1)").html(o.pointsNavDisplay)}if(o.trophiesNavDisplay){jQuery("#game_nav > li:eq(2)").html(o.trophiesNavDisplay)}if(o.uiInterruptions){var self=this;var interruptions=o.uiInterruptions;for(var i=0;i<interruptions.length;i++){var cur_int=interruptions[i];if(cur_int.type=="points_dismissable"){self.log("opening points_dismissable");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}else{if(cur_int.type=="points_simple"){self.log("opening points_simple");jQuery("#sg_container").html(cur_int.markup);self.autoSlideOverlay()}else{if(cur_int.type=="points_flash"){self.log("updating points_flash");self.pointsFlash(cur_int.markup)}else{if(cur_int.type=="away"){self.log("opening away");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}else{if(cur_int.type=="trophy"){self.log("opening trophy");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}else{if(cur_int.type=="level"){self.log("updating level");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}}}}}}}}},openOverlay:function(withOnion){this.windowActive=false;if(withOnion){jQuery("#gaming_onion").show()}jQuery("#sg_container > div").show()},closeOverlay:function(){jQuery("#sg_container > div").hide();jQuery("#gaming_onion").hide();this.windowActive=true},autoSlideOverlay:function(){jQuery("#sg_container > div").css("top","-140px").show().animate({top:"+=180"},"slow");setTimeout(function(){jQuery("#sg_container > div").fadeOut("fast")},4000)},pointsFlash:function(markup){var old_markup=jQuery("#game_nav > li:eq(1)").html();jQuery("#game_nav > li:eq(1)").addClass("pts_alert").html(markup);setTimeout(function(){jQuery("#game_nav > li:eq(1)").removeClass("pts_alert").html(old_markup)},6000)},checkAway:function(firstLoad){if(!this.windowActive){return}if(this.inInline){setTimeout(function(){SquidgamingJS.checkAway(false)},150000);return}var url="/utility/gaming_away_notice";if(firstLoad){url+="?lens=";url+=typeof(theLensId)!=="undefined"?1:0}SquidgamingJS.get(url);setTimeout(function(){SquidgamingJS.checkAway(false)},150000)},windowBlur:function(){this.windowActive=false},windowFocus:function(){this.windowActive=true;this.checkAway(false)},initHooks:function(){if(this.initCalled){return}this.initCalled=true;if(typeof hasGaming=="undefined"){if(this.initCount<10){this.initCount+=1;setTimeout(function(){SquidgamingJS.initHooks()},500*(this.initCount));return}}if(!hasGaming){return}jQuery("body").append('<div id="gaming_onion" class="default_onion" style="display: none;"></div>');window.onblur=function(){SquidgamingJS.windowBlur()};window.onfocus=function(){SquidgamingJS.windowFocus()};jQuery("#gaming_onion").bind("click",function(){SquidgamingJS.closeOverlay()});setTimeout(function(){SquidgamingJS.checkAway(true)},2000)},inlineInstructions:function(types){var self=this;var interuption=setInterval(function(){if(SquidgamingJS.blocked||jQuery(".squidoo_overlay:visible").size()||jQuery("#default_onion:visible").size()){if(SquidgamingJS.debug&&"console" in window){console.log("blocked...")}return}else{clearInterval(interuption)}self.inInline=true;if(jQuery("#game_nav_inline > li:eq(0)").length>0){jQuery("#game_nav > li:eq(0)").html(jQuery("#game_nav_inline > li:eq(0)").html())}if(jQuery("#game_nav_inline > li:eq(1)").length>0){jQuery("#game_nav > li:eq(1)").html(jQuery("#game_nav_inline > li:eq(1)").html())}if(jQuery("#game_nav_inline > li:eq(2)").length>0){jQuery("#game_nav > li:eq(2)").html(jQuery("#game_nav_inline > li:eq(2)").html())}for(var i=0;i<types.length;i++){var cur_int=types[i];if(cur_int=="points_dismissable"){self.log("opening points_dismissable");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}else{if(cur_int=="points_simple"){self.log("opening points_simple");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.autoSlideOverlay()}else{if(cur_int=="points_flash"){self.log("updating points_flash");self.pointsFlash(jQuery("#game_int_inline_"+cur_int).html())}else{if(cur_int=="away"){self.log("opening away");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}else{if(cur_int=="trophy"){self.log("opening trophy");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}else{if(cur_int=="level"){self.log("updating level");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}}}}}}}self.inInline=false},100)},sharePopup:function(url,name,width,height,do_track){var left=(screen.width-width)/2;var top=(screen.height-height)/2;if(do_track){evTrack("twitter_helper",name,theLensName);var url="/track/ajax_click?";url+="&lens_id="+theLensId;url+="&url="+escape(url);$J.get(url)}window.open(url,name,"status=0,location=0,toolbar=0,resizable=1,scrollbars=1,height="+height.toString()+",width="+width.toString()+",left="+left.toString()+",top="+top.toString())},moreActivities:function(start_num,filter){qloc=window.location.href.indexOf("?");qs=(qloc>-1)?window.location.href.slice(qloc):"";jQuery.post("/lensmaster/activity_ajax"+qs,{start_num:start_num},function(response){jQuery("ul.act_strm_ul li:last").after(response).hide();if(typeof(setupMXTracking)!=="undefined"){setupMXTracking()}})},parseJSON:function(str){str=str.replace(/\n/g," ");if((typeof JSON=="object")&&(typeof JSON.parse=="function")){return JSON.parse(str)}if(typeof(str)=="string"){return eval("("+str+")")}else{return str}},_d:null}}();jQuery(document).ready(function(){SquidgamingJS.initHooks()});if(typeof pageLoadActions!="undefined"){pageLoadActions.push(function(){SquidgamingJS.initHooks()})}window.block_squidgaming=true;(function(){var i=setInterval(function(){if(window.jQuery){clearInterval(i)}else{return}(function($){$(function(){$(".inline_input").focus(function(){$(this).addClass("inline_input_active")}).blur(function(){$(this).removeClass("inline_input_active")})});window.UnifiedLogin=function(){return{debug:false,captcha_loaded:false,is_registration:false,no_onion:false,reg_type:"standard",login_callback:null,initialized:false,unblock:function(){this.log("Unblocking SquidGaming service");window.block_squidgaming=false;if(window.SquidgamingJS){SquidgamingJS.blocked=false}},log:function(){if(this.debug&&"console" in window){var msg,args=[];for(var i=0;i<arguments.length;i++){if(i==0){msg="UnifiedLogin::"+arguments[i]}else{args.push(arguments[i])}}console.log(msg,args)}},error:function(){if(this.debug&&"console" in window){var msg,args=[];for(var i=0;i<arguments.length;i++){if(i==0){msg="UnifiedLogin::"+arguments[i]}else{args.push(arguments[i])}}console.error(msg,args)}},closeOverlays:function(hide_the_onion){if(hide_the_onion==null||hide_the_onion){$("#default_onion").hide()}$(".squidoo_overlay").hide()},showPage:function(selector,callback){this.log("showPage",selector);this.closeOverlays();if(!this.no_onion){$("#default_onion").show()}var self=this;var onModalLoaded=function(){window.scrollTo(0,0);$(selector).show();FB.XFBML.parse(document.getElementById(selector.substr(1)));if(callback){callback.call(self)}};if($("#lgn_login").length==0){var waitForOverlay=setInterval(function(){if(!$("#unified-login-overlay").size()){return}else{clearInterval(waitForOverlay)}$("#unified-login-overlay").load("/utility/unifiedlogin",function(){onModalLoaded()}).show()},100)}else{onModalLoaded()}},register:function(reg_type,cb){this.log("register",reg_type,cb);if(cb){this.login_callback=cb}if(Facebook_SDK_Helper.badMSIEActiveX()){document.location.href="/member/registration";return}if(reg_type){this.reg_type=reg_type}if(this.reg_type=="standard"){$("#lgn_register_complete a.btn_35").html("Build My First Page!").removeClass("btn_gray")}else{if(this.reg_type=="wizard"){$("#lgn_register_complete a.btn_35").html("Continue").removeClass("btn_gray")}else{if(this.reg_type=="quick"){$("#lgn_register_complete a.btn_35").html("Close").addClass("btn_gray")}}}if(!this.no_onion){$("#default_onion").show()}this.init();this.registerSquidoo()},registerSquidoo:function(){this.log("registerSquidoo");this.showPage("#lgn_reg_squidoo",function(){_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","View"]);$("#lgn_reg_squidoo div.gb_captcha",this.current_form).show();$("#lgn_register_sq_username").focus();if(!this.captcha_loaded){$.get("/utility/load_captcha/new",function(res){$("#lgn_reg_squidoo div.gb_captcha").html(res);UnifiedLogin.captcha_loaded=true})}})},login:function(cb){this.log("login");this.init();this.is_registration=false;if(cb){this.login_callback=cb}if(Facebook_SDK_Helper.badMSIEActiveX()){document.location.href="/member/login";return}$("button[type=submit]",$("#lgn_login")).removeClass("btn_gray").html("Login");if(!this.no_onion){$("#default_onion").show()}this.showPage("#lgn_login");$("#lgn_squidoo_email").focus();$.post("/utility/can_fb_login",function(response){var o=UnifiedLogin.parseJSON(response);if(FB.getSession()&&o.result){FB.api("/me",function(fb_user_object){$("#lgn_login form").hide();$("#lgn_login .need_account").hide();$(".fb_name").text(fb_user_object.name);$(".fb_profile_pic .wait").hide();$(".fb_profile_pic .pic").show();$(".from_facebook").show()})}})},init:function(){this.log("init");if(this.initialized){return false}Facebook_SDK_Helper.init();this.initialized=true},connect:function(){this.log("connect");this.showPage("#lgn_connect")},importFBProfile:function(){this.log("importFBProfile");this.init();this.is_registration=true;var import_profile=function(){$(".fb_profile_pic .wait").show();$(".fb_profile_pic .pic").hide();$.post("/utility/can_fb_login",function(response){var o=UnifiedLogin.parseJSON(response);if(o.result){FB.api("/me",function(fb_user_object){$("#lgn_login form").addClass("border_top");$(".fb_name").text(fb_user_object.name);UnifiedLogin.showPage("#lgn_login");$("#lgn_squidoo_email").focus();$(".fb_profile_pic .wait").hide();$(".fb_profile_pic .pic").show();$(".from_facebook").show()})}else{$("#alreadyConnectedForm").hide();$("#registrationForm").show();UnifiedLogin.getCurrentPermissions(function(has_all,perms){$("#lgn_reg_squidoo .lgn_fb_option").hide().after("<br />");FB.api("/me",function(fb_user_object){UnifiedLogin.log("importFBProfile::FB.api(/me)->",fb_user_object);var session=FB.getSession();$("#fb_access_token").val(session.access_token);$("#fb_expires").val(session.expires);$("#fb_secret").val(session.secret);$("#fb_session_key").val(session.session_key);$("#fb_sig").val(session.sig);$("#fb_uid").val(session.uid);$("#lgn_reg_fb_name").html(fb_user_object.name);$("#lgn_register_sq_first_name").val(fb_user_object.first_name);$("#lgn_register_sq_last_name").val(fb_user_object.last_name);UnifiedLogin.getUsername(fb_user_object,function(response){$("#lgn_register_sq_username").val(response.username).blur()});if(perms.email){UnifiedLogin.getEmailAddress(function(email_address){$("#lgn_register_sq_email").val(email_address).blur();$("#lgn_register_sq_password").focus();$(".fb_profile_pic .wait").hide();$(".fb_profile_pic .pic").show()})}})})}})};FB.getLoginStatus(function(response){if(!response.session){FB.login(function(response){if(response.session){import_profile()}},{perms:"email,publish_stream"})}else{import_profile()}})},getUsername:function(fb_user_object,cb){$.post("/utility/fb_user_username",fb_user_object,function(response){cb(UnifiedLogin.parseJSON(response))})},getExtendedPermissions:function(){FB.login(function(response){if(response.session){if(response.perms){UnifiedLogin.log(response)}else{UnifiedLogin.log(response)}}else{UnifiedLogin.log(response)}},{perms:"email,read_stream,publish_stream,offline_access"})},getCurrentPermissions:function(cb){var query="SELECT publish_stream, email FROM permissions WHERE uid="+FB.getSession().uid;UnifiedLogin.log(query);FB.api({method:"fql.query",query:query},function(response){if(response.length){var has_all=true;perms=response[0];has_all=has_all&&(perms.email==1);has_all=has_all&&(perms.publish_stream==1);cb(has_all,perms)}else{UnifiedLogin.log("No permissions returned at all");cb(false,perms)}})},getEmailAddress:function(cb){var query="SELECT uid, email FROM user WHERE uid="+FB.getSession().uid;UnifiedLogin.log(query);FB.api({method:"fql.query",query:query},function(response){UnifiedLogin.log(response);var email="";if(response.length){data=response[0];email=data.email}else{UnifiedLogin.log("No query data returned")}cb(email)})},connectAccount:function(the_form){$("div",the_form).removeClass("form_error");var email=$("#lgn_connect_email",the_form).val();var password=$("#lgn_connect_password",the_form).val();var valid=true;if($.trim(email)==""){valid=false;$("#lgn_connect_email_div",the_form).addClass("form_error")}if($.trim(password)==""){valid=false;$("#lgn_connect_password_div",the_form).addClass("form_error")}if(!valid){return false}$.post("/utility/fb_login_connect",the_form.serialize(),function(response){var o=UnifiedLogin.parseJSON(response);UnifiedLogin.log(o);if(o.status=="success"){UnifiedLogin.closeRefresh()}else{$("#lgn_connect_gen_err",the_form).html(o.reason);$("#lgn_connect_gen_div",the_form).addClass("form_error")}});return false},loginSquidoo:function(the_form){$("div",the_form).removeClass("form_error");var email=$("#lgn_squidoo_email",the_form).val();var password=$("#lgn_squidoo_password",the_form).val();var valid=true;if($.trim(email)==""){valid=false;$("#lgn_squidoo_email_div",the_form).addClass("form_error")}if($.trim(password)==""){valid=false;$("#lgn_squidoo_password_div",the_form).addClass("form_error")}if(!valid){return false}$("button[type=submit]",the_form).addClass("btn_gray").html("logging in");$.post("/utility/ajax_login",the_form.serialize(),function(response){var obj;UnifiedLogin.log(response);try{obj=UnifiedLogin.parseJSON(response)}catch(ex){UnifiedLogin.log(ex);obj={status:"fail",reason:"Login failed. Please try again."}}UnifiedLogin.log(obj);if(obj.status=="success"){if(UnifiedLogin.login_callback){try{UnifiedLogin.login_callback(obj.user_type)}catch(e){}}else{UnifiedLogin.closeRefresh()}}else{$("button[type=submit]",the_form).removeClass("btn_gray").html("Login");$("#lgn_squidoo_gen_err",the_form).html(obj.reason);$("#lgn_squidoo_gen_div",the_form).addClass("form_error")}});return false},validateAndRegister:function(reg_form){$("div",reg_form).removeClass("form_error");var tos_checked=$("#accept_lmtos",reg_form).attr("checked");var email=$("#lgn_register_email",reg_form).val();var username=$("#lgn_register_username",reg_form).val();var valid=true;if(!tos_checked){valid=false;$("#lgn_register_tos_div",reg_form).addClass("form_error")}if($.trim(email)==""){valid=false;$("#lgn_register_email_div",reg_form).addClass("form_error")}if($.trim(username)==""){valid=false;$("#lgn_register_username_div",reg_form).addClass("form_error")}if(!valid){return false}$.post("/utility/fb_login_register",reg_form.serialize(),function(response){var o=UnifiedLogin.parseJSON(response);UnifiedLogin.log(o);if(o.status=="fail"){var cur_field;for(var i=0;i<o.err_fields.length;i++){cur_field=o.err_fields[i];$("#lgn_register_"+cur_field+"_div",reg_form).addClass("form_error");if(cur_field=="email"){$("#lgn_register_email_err",reg_form).html(o.err_msgs.email).addClass("error_n")}if(cur_field=="username"){$("#lgn_register_username_err",reg_form).html(o.err_msgs.username).addClass("error_n")}if(cur_field=="tos"){$("#lgn_register_tos_err",reg_form).html(o.err_msgs.tos).addClass("error_n")}}}else{if(UnifiedLogin.reg_type=="wizard"||UnifiedLogin.reg_type=="quick"){UnifiedLogin.closeRegister()}else{UnifiedLogin.showPage("#lgn_register_complete")}}});return false},validateAndRegisterMadlibs:function(form){form=$(form);if(form.find(".input_red").size()){form.find(".input_red:first").focus();return false}var submit=form.find('button[type="submit"]');submit.addClass("btn_working");var form_data=form.serialize();if(LensGifting.gift_code){form_data+="&gift_code="+LensGifting.gift_code}$.post("/utility/fb_login_register",form_data,function(res){var res=UnifiedLogin.parseJSON(res);if(res.status=="fail"){_gaq.push(["_trackEvent","Sign Up","Modal - Madlibs 2","Invalid",res.err_fields.length]);var first_field=null;$.each(res.err_fields,function(i,field_name){var field=null;if(field_name=="captcha"){field=$("#_squidcap_e")}else{field=$("#lgn_register_sq_"+field_name)}if(!field.size()){if("console" in window){console.error("Field ["+field_name+"] does not exist")}}else{if(!first_field){first_field=field}field.addClass("input_red");field.data("error_msg",res.err_msgs[field_name])}});first_field.focus();submit.removeClass("btn_working")}else{_gaq.push(["_trackEvent","Sign Up","Modal - Madlibs 2","Success"]);if(UnifiedLogin.reg_type=="wizard"||UnifiedLogin.reg_type=="quick"){UnifiedLogin.closeRegister()}else{if(UnifiedLogin.reg_type=="giftlens"){LensGifting.claimGift(LensGifting.gift_code,LensGifting.lens_name)}else{UnifiedLogin.showPage("#lgn_register_complete")}}}});return false},validateAndRegisterSquidoo:function(reg_form){$("button[type=submit]",reg_form).addClass("btn_working").html("Working");$("div",reg_form).removeClass("form_error");$(".error_y",reg_form).html("").removeClass("error_y");$(".error_n",reg_form).html("").removeClass("error_n");var tos_checked=$("#lgn_register_sq_lmtos",reg_form).attr("checked");var email=$("#lgn_register_sq_email",reg_form).val();var username=$("#lgn_register_sq_username",reg_form).val();var password=$("#lgn_register_sq_password",reg_form).val();var verify=$("#lgn_register_sq_verify",reg_form).val();var valid=true;var invalid=0;if(!tos_checked){valid=false;invalid++;$("#lgn_reg_squidoo_tos_err").html("Please agree to the Terms of Service").removeClass("error_y").addClass("error_n").show()}if($.trim(email)==""){valid=false;invalid++;$("#email_address_err").html("Enter email address").removeClass("error_y").addClass("error_n").show();$("#email_address_err").closest("div.form_item").addClass("form_error")}if($.trim(username)==""){valid=false;invalid++;$("#desired_username_err").html("Enter username").removeClass("error_y").addClass("error_n").show();$("#desired_username_err").closest("div.form_item").addClass("form_error")}if($.trim(password)==""){valid=false;invalid++;$("#password_err").html("Enter password").removeClass("error_y").addClass("error_n").show();$("#password_err").closest("div.form_item").addClass("form_error")}if(password!=verify){valid=false;invalid++;$("#password_confirmation_err").html("Does not match password").removeClass("error_y").addClass("error_n").show();$("#password_confirmation_err").closest("div.form_item").addClass("form_error")}if(!valid){_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","Invalid",invalid]);$("button[type=submit]",reg_form).removeClass("btn_working").html("Join Now!");return false}var form_data=reg_form.serialize();if(LensGifting.gift_code){form_data+="&gift_code="+LensGifting.gift_code}$.post("/utility/fb_login_register",form_data,function(response){var o=UnifiedLogin.parseJSON(response);UnifiedLogin.log(o);if(o.status=="fail"){var cur_field;_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","Invalid",o.err_fields.length]);$("button[type=submit]",reg_form).removeClass("btn_working").html("Join Now!");for(var i=0;i<o.err_fields.length;i++){cur_field=o.err_fields[i];$("#lgn_register_"+cur_field+"_div",reg_form).addClass("form_error");if(cur_field=="email"){$("#email_address_err").html(o.err_msgs.email).removeClass("error_y").addClass("error_n").show();$("#email_address_err").closest("div.form_item").addClass("form_error")}if(cur_field=="username"){$("#desired_username_err").html(o.err_msgs.username).removeClass("error_y").addClass("error_n").show();$("#desired_username_err").closest("div.form_item").addClass("form_error")}if(cur_field=="tos"){$("#lgn_register_tos_err",reg_form).html(o.err_msgs.tos)}}}else{_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","Success"]);if(UnifiedLogin.reg_type=="wizard"||UnifiedLogin.reg_type=="quick"){UnifiedLogin.closeRegister()}else{if(UnifiedLogin.reg_type=="giftlens"){LensGifting.claimGift(LensGifting.gift_code,LensGifting.lens_name)}else{UnifiedLogin.showPage("#lgn_register_complete")}}}});return false},closeRefresh:function(){this.closeOverlays();document.location.reload()},closeRegister:function(){this.log(this.reg_type);this.closeOverlays();if(this.reg_type=="standard"){document.location="/wizard/start"}else{if(this.reg_type=="wizard"){document.location="/wizard/step1"}else{if(this.reg_type=="quick"){document.location="/build/quick"}else{if(this.reg_type=="cb"){try{if(this.login_callback){this.login_callback("new")}}catch(e){}}}}}},squidooLogoutRefresh:function(){$.get("/member/ajax_logout",function(){UnifiedLogin.closeOverlays();document.location.reload()})},fbLogoutRefresh:function(){FB.logout(function(){UnifiedLogin.closeOverlays();document.location.reload()})},refreshMadlibsError:function(field){field=$(field);var error=$("#signup_errors");var msg=field.data("error_msg");if(msg){if(!msg.match(/\.$/)){msg+="."}error.text(msg);error.data("field",field);error.addClass("error_n")}else{error.text("");error.removeClass("error_n")}},validateUsernameMadlibs:function(field,skip_if_empty,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!val&&skip_if_empty){field.removeClass("input_red");field.data("error_msg","");if(callback){return callback(true)}else{return true}}else{if(!val){field.addClass("input_red");field.data("error_msg","Username is required");if(callback){return callback(false)}else{return false}}}field.removeClass("input_red");field.data("error_msg","");$.post("/member/ajax_validate_registration",{data_type:"username",value:val},function(res){res=UnifiedLogin.parseJSON(res);if(res.result==true){field.removeClass("input_red");field.data("error_msg","")}else{field.addClass("input_red");field.data("error_msg",res.msg)}if(callback){callback(res.result)}});return false},validateCaptchaMadlibs:function(field,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());var valid=false;if(!val){field.data("error_msg","Please type the security word");valid=false}else{valid=true}if(valid){field.removeClass("input_red");field.data("error_msg","")}else{field.addClass("input_red")}if(callback){return callback(false)}else{return false}},validatePasswordMadlibs:function(field,skip_if_empty,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());var valid=false;if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!val&&skip_if_empty){valid=true}else{if(!val){field.data("error_msg","Password is required");valid=false}else{if(val.length<6){field.data("error_msg","Password is too short");valid=false}else{valid=true}}}if(valid){field.data("error_msg","");field.removeClass("input_red")}else{field.addClass("input_red")}if(callback){callback(valid)}else{return valid}},validatePasswordConfMadlibs:function(field,password,skip_if_empty,callback){field=$(field);var conf=$.trim(field.val());var password=$.trim($(password).val());var form=field.closest("form");var valid=false;if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!conf&&skip_if_empty){valid=true}else{if(!conf&&!password){valid=false;field.data("error_msg","Please confirm your password")}else{if((conf||password)&&conf!=password){valid=false;field.data("error_msg","Your passwords do not match")}else{valid=true}}}if(valid){field.data("error_msg","");field.removeClass("input_red")}else{field.addClass("input_red")}if(callback){callback(valid)}else{return valid}},validateEmailMadlibs:function(field,skip_if_empty,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!val&&skip_if_empty){field.removeClass("input_red");field.data("error_msg","");if(callback){return callback(true)}else{return true}}else{if(!val){field.addClass("input_red");field.data("error_msg","E-mail address is required");UnifiedLogin.refreshMadlibsError(field);if(callback){return callback(false)}else{return false}}}field.removeClass("input_red");field.data("error_msg","");$.post("/member/ajax_validate_registration",{data_type:"email_address",value:val},function(res){res=UnifiedLogin.parseJSON(res);if(res.result==true){field.removeClass("input_red");field.data("error_msg","")}else{field.addClass("input_red");field.data("error_msg",res.msg)}if(callback){callback(res.result)}});return false},usernameKeyUp:function(e){var charCode=(e.which)?e.which:e.keyCode;if((charCode==45)||(charCode==8)||(charCode==9)||(charCode==95)||((charCode>=97)&&(charCode<=122))||((charCode>=65)&&(charCode<=90))||((charCode>=48)&&(charCode<=57))){return true}return false},validateUsername:function(parent_el,skip_if_empty){var val=$("#lgn_register_sq_username").val();if(($.trim(val)=="")&&skip_if_empty){return}$("#desired_username_err").html("Checking...").removeClass("form_error").show();$.post("/member/ajax_validate_registration",{data_type:"username",value:val},function(res){var res_o=UnifiedLogin.parseJSON(res);if(res_o.result==true){$("#desired_username_err").html(res_o.msg).removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}else{$("#desired_username_err").html(res_o.msg).removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}})},validateEmail:function(parent_el,skip_if_empty){var val=$("#lgn_register_sq_email").val();if(($.trim(val)=="")&&skip_if_empty){return}$("#email_address_err").html("Checking...").removeClass("form_error").show();$.post("/member/ajax_validate_registration",{data_type:"email_address",value:val},function(res){var res_o=UnifiedLogin.parseJSON(res);if(res_o.result==true){$("#email_address_err").html(res_o.msg).removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}else{$("#email_address_err").html(res_o.msg).removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}})},validatePassword:function(parent_el,skip_if_empty){var val=$("#lgn_register_sq_password").val();if(($.trim(val)=="")&&skip_if_empty){return}if(val.length<6){$("#password_err").html("Password too short").removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}else{$("#password_err").html("OK").removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}},validatePasswordConf:function(parent_el,skip_if_empty){var pass=$("#lgn_register_sq_password").val();var pass_conf=$("#lgn_register_sq_verify").val();if(($.trim(pass_conf)=="")&&skip_if_empty){return}if(pass!=pass_conf){$("#password_confirmation_err").html("Passwords do not match").removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}else{$("#password_confirmation_err").html("OK").removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}},parseJSON:function(str){if(typeof(str)=="string"){return eval("("+str+")")}else{return str}}}}()})(jQuery)},500)})();(function(){var i=setInterval(function(){if(window.jQuery){clearInterval(i)}else{return}(function($){var self=window.LensGifting=$.extend(window.LensGifting,{track:function(action,label,value){if(!window._gaq){if(window.console){window.console.error("Google Analytics is not loaded.")}}var trackIt=function(){_gaq.push(["_trackEvent","Lens Gifting",action,label,value])};trackIt()},showMessage:function(){$("#default_onion").show();$("#gift_message").show()},closeMessage:function(){$("#default_onion").hide();$("#gift_message").hide()},cancel:function(lens_id,lm){if(confirm("Really? Are you sure you don't want to give this lens as a gift? If you click OK this lens will just become a regular old lens in your stable, not a specially wrapped gift for a friend.")){$.post("/lensmaster/cancel_gift",{lens_id:lens_id,lm:lm,ajax:true},function(response){if(response){alert(response)}else{window.location.reload()}})}},resendInvitation:function(lens_id,a){$.post("/lensmaster/resend_invitation",{lens_id:lens_id},function(response){$(a).fadeOut(function(){$(a).replaceWith('<span id="invite_sent_'+lens_id+'">Sent!</span>').show();setTimeout(function(){$("#invite_sent_"+lens_id).replaceWith(response)},2000)})})},showMessageForm:function(){$("#default_onion").show();$("#gift_message_form").show();$("#gift_message_recipient_name").focus()},hideMessageForm:function(){$("#default_onion").hide();$("#gift_message_form").hide()},claimGift:function(gift_code,lens_name){$.post("/lensmaster/claim_gift",{gift_code:gift_code},function(response){if(response=="success"){window.location="/lensmaster/workshop/"+lens_name}else{alert(response)}})},register:function(){Squidoo.register(function(){LensGifting.claimGift(LensGifting.gift_code,LensGifting.lens_name)})},hideGifterIntro:function(lens_id){$.post("/lensmaster/hide_gifter_intro",{lens_id:lens_id},function(){$("#gifter_intro").hide()})},hideRecipientIntro:function(lens_id){$.post("/lensmaster/hide_recipient_intro",{lens_id:lens_id},function(){$("#recipient_intro").hide()})},showGifterIntro:function(lens_name){$("#default_onion").show();$("#publish_result").addClass("overlay_wait").html("").fadeIn();$.post("/workshop/ajax_gift_giver_intro/"+lens_name,function(html){$("#publish_result").removeClass("overlay_wait").html(html)})},showRecipientIntro:function(lens_name){$("#default_onion").show();$("#publish_result").addClass("overlay_wait").html("").fadeIn();$.post("/workshop/ajax_gift_recipient_intro/"+lens_name,function(html){$("#publish_result").removeClass("overlay_wait").html(html)})}})})(jQuery)},500)})();(function($){window.ProgressBar={update:function(){var lens=(window.theLens)?theLens.lensName:theLensName;$.post("/workshop/ajax_progress_bar/"+lens,{show_progress_list:$("#progress-bar .progress_list:visible").size()},function(html){$("#progress-bar").html(html)})},init:function(){$(".progress_wrap_head").toggle(function(){$(".progress_list").slideDown();$(".progress_toggle").html("Hide your progress")},function(){$(".progress_list").slideUp();$(".progress_toggle").html("See your progress")});$(".quality_score.help_icon").each(function(i){var $this=$(this);var rel=$this.attr("rel");var $overlay=$("#progress_help_"+rel).first();if(!$this.closest("li").hasClass("completed")&&$overlay.length){$this.show().click(function(e){Squidoo.modal("#progress_help_"+rel);e.preventDefault();return false});$overlay.find(".close_bar a").first().click(function(e){$overlay.hide();$("#default_onion").hide();e.preventDefault();return false})}else{$this.hide()}});$("#dismiss_100_graphic").click(function(e){$container=$(this).closest(".progress_wrap");lens_id=$(this).attr("rel");$.get("/lensmaster/ajax_dismiss_graphic/"+lens_id,null,function(){$container.slideUp()});e.preventDefault();return false});if($(".progress_list").attr("rel")=="newbie"){$(".progress_toggle").trigger("click")}}};$(window).bind("afterSaveModule",ProgressBar.update);$(window).bind("afterEditLensTOC",ProgressBar.update);$(window).bind("afterResetWorkshop",ProgressBar.update)})(jQuery);