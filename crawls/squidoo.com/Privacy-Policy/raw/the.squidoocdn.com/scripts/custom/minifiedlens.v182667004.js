function previewRatingNew(a){clearRatingsNew();if(document.getElementById){for(var c=1;c<=a;c++){document.getElementById("myRatingStar"+c).src=stars_whole_your}}}function resetRatingsNew(){for(var a=1;a<=5;a++){document.getElementById("myRatingStar"+a).src=defaultStarsNew[a]}}function clearRatingsNew(){for(var a=1;a<=5;a++){document.getElementById("myRatingStar"+a).src=stars_empty}}var __savingRating=false;function saveRatingNew(a){if(!__savingRating){__savingRating=true;for(var c=1;c<=5;c++){defaultStarsNew[c]=document.getElementById("myRatingStar"+c).src}new Ajax.Updater("ratingDiv","/utility/rate_lens/"+theLensName,{asynchronous:true,method:"post",postBody:"rating="+a,onSuccess:function(){__savingRating=false}})}}function openFlagEdit(){document.getElementById("flagEditDiv").style.display="block";if(document.getElementById("comments")){document.getElementById("comments").select();document.getElementById("comments").focus()}}function closeFlagEdit(){document.getElementById("flagEditDiv").style.display="none";document.getElementById("default_onion").style.display="none"}function saveFlag(){if(!flagged){var f=document.getElementById("flag_form");pass=$("reason").value==""?false:true;if(pass){var e=f.getElementsByTagName("select");var a=f.getElementsByTagName("textarea");var d=saveFields(e);d+=saveFields(a);var c=function(h){if(h.responseText=="saved"){flagged=true;document.getElementById("flagResultsDiv").innerHTML="<p>You have successfully reported this lens. Thank you.</p>";setTimeout("closeFlagEdit()",3000)}else{var g="<strong>"+h.responseText+"</strong>";document.getElementById("flagResultsDiv").innerHTML=g}};new Ajax.Request("/utility/flag_lens/"+theLensName,{asynchronous:true,method:"post",postBody:d,onSuccess:c})}else{alert("Before continuing, please tell us why you are reporting this lens as inappropriate.");document.getElementById("comments").focus()}}else{document.getElementById("flagResultsDiv").innerHTML="<p>You have successfully reported this lens. Thank you.</p>";setTimeout("closeFlagEdit()",3000)}}function loadWorkshop(a){jQuery("#default_onion").show();location.href="/lensmaster/workshop/"+a}function plexConfirmation(){if(!$("loginLiteMessage")){setTimeout("plexConfirmation()",1000)}else{$("loginLiteMessage").innerHTML='<strong>Yippeee you voted!</strong> <p>Would you like to go back to <a href="'+plexBack+'">where you came from</a> or stick around and <a href="#" onclick="Element.hide(\'overlay\');Effect.Fade(\'loginLite\');">vote for more stuff</a>?</p>';Element.show("loginLite","overlay")}}plexBack=null;var ajaxRunning=false;function validateAfterAJAX(c,a){checkAvailability($("username"));validate($(c),a);waitForAJAX(c,a);return false}function checkAvailability(a){if(!ajaxRunning){ajaxRunning=true;$("regAjaxErrors").innerHTML="";new Ajax.Request("/utility/usernames/"+escapeForURL(a.value),{asynchronous:true,method:"post",postBody:"first_name=&last_name=",onSuccess:function(c){ajaxRunning=false;if(c.responseText!=null&&c.responseText.replace(/[\r|\n]+/,"")!=""){if($("regErrors").style.display=="none"){$("regErrors").style.display="block"}if($("ajaxErrorText")&&$("ajaxErrorText").innerHTML.length){$("ajaxErrorText").innerHTML="- "+c.responseText}else{$("regErrors").innerHTML+=ajaxSpanStart+"- "+c.responseText+ajaxSpanEnd}$("regAjaxErrors").innerHTML=c.responseText;$("usernameRow").className+=" error";scrollToElement("regErrors")}else{if($("regErrors").style.display=="block"){if($("ajaxErrorText")){$("ajaxErrorText").innerHTML="";var d=new RegExp(ajaxSpanStart+ajaxSpanEnd,"g");$("regErrors").innerHTML=$("regErrors").innerHTML.replace(d,"");if(!$("regErrors").innerHTML.length){$("regErrors").style.display="none"}}}$("regAjaxErrors").innerHTML="";$("usernameRow").className=$("usernameRow").className.replace(/error/gi,"")}ajaxRunning=false}})}}lensLoveInit=false;function initLensLove(){if(window.isWorkshop||lensLoveInit){return false}lensLoveInit=true;loveSaveRating(0);for(var a=5;a>0;a--){$$(".wS"+a).each(function(c){c.src=defaultStarsNew[a];c.title=c.alt})}if(theLensName!=""){$$(".wMail").each(function(c){c.href="/utility/email_page?"+theLensName});$$(".wFave").each(function(c){c.href="/member/add_favorite/"+theLensName});$$(".wRoll").each(function(c){c.href="/lensmaster/lensroll/"+theLensName})}if(!isLoggedIn){$$(".wRating").each(function(c){c.innerHTML="<i>Login to rate this lens</i>"});$$(".wFave").each(function(c){c.href="http://addthis.com/bookmark.php"});$$(".wFave").each(function(c){c.innerHTML="Bookmark it &nbsp;"});$$(".wRoll").each(function(c){c.style.display="none"})}}function loveSaveRating(d){var c="http://cdn.squidoo.com/images/layout/star-sm-0.gif";var a="http://cdn.squidoo.com/images/layout/star-sm-2.gif";if(d>=1){$$(".wS1").each(function(e){e.src=a})}else{$$(".wS1").each(function(e){e.src=c})}if(d>=2){$$(".wS2").each(function(e){e.src=a})}else{$$(".wS2").each(function(e){e.src=c})}if(d>=3){$$(".wS3").each(function(e){e.src=a})}else{$$(".wS3").each(function(e){e.src=c})}if(d>=4){$$(".wS4").each(function(e){e.src=a})}else{$$(".wS4").each(function(e){e.src=c})}if(d>=5){$$(".wS5").each(function(e){e.src=a})}else{$$(".wS5").each(function(e){e.src=c})}if(d>=1){saveRatingNew(d)}}function setClickOutTracking(f){if(typeof f=="string"){var a=$(f).getElementsByTagName("a")}else{var a=document.getElementsByTagName("a")}for(var d=0;d<a.length;d++){var e=a[d];try{if(typeof e.hostname=="unknown"){continue}if(e.href=="javascript:void(0);"||e.href=="javascript:;"||e.href=="#"||!e.href){continue}if(e!=""&&e.hostname!=theRequestServerName&&e.hostname!=theServerName&&!e.hostname.match(/squidoo.com$/)){if(e.className.indexOf("googleUrl")!=-1||e.className.indexOf("googleClickout")!=-1){e.onclick=trackAdWordClick;if(!theWindowPref){e.target="_blank"}}else{e.onclick=trackClickWrapper;if(!theWindowPref){e.target="_blank"}}}}catch(c){}}}function trackClickWrapper(){trackClick(this)}function trackAdWordClick(){var a="/track/ajax_ad_click?";a+="&lens_id="+theLensId;a+="&url="+escape(this.href);$J.get(a)}function fade(a,c){return}function setLoadFunctions(){setTooltips();fade();if(window.setClickOutTracking){setClickOutTracking()}}if(pageLoadActions==undefined){var pageLoadActions=[]}pageLoadActions.push(setLoadFunctions);function setDisplay(a,d){if($(a)){var c=$(a);c.style.display=d}}function toggleDisplay(a){var f=a+"Body";var d=a+"Hdr";if($(f)){var c=$(f);var h=c.style.display;var g="collapse";var e="expanded";if(h=="none"){setDisplay(f,"block");addClass(d,e);desist(a)}else{setDisplay(f,"none");addClass(d,g);persist(a,g)}}else{if($(a)){var c=$(a);var h=c.style.display;var g="collapse";var e="";if(h=="none"){setDisplay(a,"block")}else{setDisplay(a,"none")}}}}function addClass(a,e){if($(a)){var c=$(a);var d=c.className;c.className=e}}function persist(c,d){var a=new Date();a.setFullYear(a.getFullYear()+10);document.cookie=c+"="+d+"; path=/; expires="+a.toGMTString()}function desist(c){var a=new Date();a.setFullYear(a.getFullYear()-10);document.cookie=c+"=test; path=/; expires="+a.toGMTString()}function scheduleShow(){if(this.getElementsByTagName){setTipShow(this.getElementsByTagName("div"));setTipShow(this.getElementsByTagName("span"))}}function setTipShow(c){for(var a=0;a<c.length;a++){if(c[a].className.indexOf("toolTip")!=-1){c[a].mouseover=true;if(c[a].id){window.setTimeout('showTip("'+c[a].id+'")',250)}}}}function scheduleHide(){if(this.getElementsByTagName){setTipHide(this.getElementsByTagName("div"));setTipHide(this.getElementsByTagName("span"))}}var length=1000;function setTipHide(c){for(var a=0;a<c.length;a++){if(c[a].className.indexOf("toolTip")!=-1){c[a].mouseover=false;if(c[a].id){window.setTimeout('clearTip("'+c[a].id+'")',length)}}}}function showTip(c){var a=$(c);if(a.mouseover){a.style.display="block"}}function clearTip(c){var a=$(c);if(!a.mouseover){a.style.display="none"}else{window.setTimeout('clearTip("'+c+'")',1000)}}function recordParentMouseover(){this.parentNode.mouseover=true}function recordParentMouseout(){this.parentNode.mouseover=false}function setTooltips(a,f){if(f){length=f}if(!a){a="span"}if(document.getElementsByTagName){var d=document.getElementsByTagName(a);for(var c=0;c<d.length;c++){var e=d[c];if(e.className.indexOf("moreInfo")!=-1){e.onmouseover=scheduleShow;e.onmouseout=scheduleHide;setEvents(e,"div");setEvents(e,"span")}}}}function setEvents(d,a){var e=d.getElementsByTagName(a);for(var c=0;c<e.length;c++){if(e[c].className.indexOf("toolTip")!=-1){e[c].onmouseover=recordParentMouseover;e[c].onmouseout=recordParentMouseout}}}function swapDescriptions(c){var f=c.parentNode.parentNode;var e=f.getElementsByTagName("p");for(var a=0;a<e.length;a++){var d=e[a];if(d.className.indexOf("productDescriptionExcerpt")>=0){d.style.display="none"}else{if(d.className.indexOf("productDescriptionFullText")>=0){d.style.display="block"}}}}function openLoginLite(a,c){if(jQuery("#loginLiteMessage").length==0){jQuery("#loginLite").load("/utility/loginlite",function(){openLoginLite(a,c)})}else{if(!a){a="<strong>Hey smarty!</strong>  To make your vote count, <a href=\"#\" onclick=\"jQuery('#login-option').show(); jQuery('#join-option').hide(); return false;\">login</a> or <a href=\"#\" onclick=\"jQuery('#login-option').hide(); jQuery('#join-option').show(); return false;\">join Squidoo</a> for free."}jQuery("#loginLiteMessage").html(a);jQuery("#default_onion").show();jQuery("#loginLite").show();jQuery("#login_redirect").val("/"+theLensName);jQuery("#reg_redirect").val("/"+theLensName);window.scrollTo(0,0);if(c){c()}}}function openPlexSubmit(d,a,c){if(c){if(theMember){$J("#add-options"+d).show();$J("#bulkSurfer"+d).show();$J("#captcha_"+d).captcha();return false}}else{Element.show("bulk"+d)}}function plexSubmit(g,d){var e=null;var f=$J("#plexoForm"+g)[0];e=true;if(e){var c=f.getElementsByTagName("input");var a=f.getElementsByTagName("textarea");postString=saveFields(c);postString+=saveFields(a);new Ajax.Request("/utility/plexo_submit/"+g,{asynchronous:true,method:"post",postBody:postString,onSuccess:function(h){if(h.responseText=="captcha_error"){alert("The security word you entered is incorrect. Please try again.")}else{if(h.responseText==null||h.responseText==""){if(d=="manual"){$J("#add-options"+g).html('<p class="alert alert-info clear margin_top_10">Thanks! Your item was submitted successfully, and is now pending approval from the lensmaster.</p>')}else{$J("#add-options"+g).html('<p class="alert alert-info clear margin_top_10">Thanks! Your item was submitted successfully and will appear shortly. Don\'t forget to vote for it!</div>')}}else{alert("There was a problem saving your submission:\n\n"+h.responseText)}}}})}return false}function plexVote(lmi,lens_name,item_id,direction){if(window.theMember){member_id=theMember.id;new Ajax.Request("/utility/plexo_vote/"+item_id+"/"+direction,{onSuccess:function(response){if(response.responseText.indexOf("|")==0){var curPoints=response.responseText.substr(1);var children=$("plexItem"+item_id).getElementsByTagName("div");for(var i=0;i<children.length;i++){if(direction=="up"){if(children[i].className.indexOf("vote-up")>-1||children[i].className.indexOf("voted-up")>-1){children[i].className="voted-up"}else{if(children[i].className.indexOf("vote-down")>-1||children[i].className.indexOf("voted-down")>-1){children[i].className="vote-down"}}}else{if(direction=="down"){if(children[i].className.indexOf("vote-up")>-1||children[i].className.indexOf("voted-up")>-1){children[i].className="vote-up"}else{if(children[i].className.indexOf("vote-down")>-1||children[i].className.indexOf("voted-down")>-1){children[i].className="voted-down"}}}}}var newDisplay="";if(curPoints==-1||curPoints==1){newDisplay=curPoints+' point - <a href="javascript:window.location.reload();" title="refresh the page">refresh to rerank</a>'}else{newDisplay=curPoints+' points - <a href="javascript:window.location.reload()" title="refresh the page">refresh to rerank</a>'}var voteHistory=eval("voted"+lmi);if(!voteHistory[item_id]||voteHistory[item_id]!=direction){new Effect.Highlight("plexItem"+item_id);window.eval("voted"+lmi+"["+item_id+'] = "'+direction+'"')}$("pointsDisplay"+item_id).innerHTML=newDisplay}else{alert("There was a problem saving your vote. The problem was: \n\n"+response.repsponseText)}},asynchronous:true,method:"post"});return false}else{return false}}function plexWidget(f,e,c,a,d){if(d){contents='<div id="plex'+e+'"><a href="'+d+'">Click through to see the plexo</a></div>'}else{contents='<div id="plex'+e+'"></div>'}contents+='<script type="text/javascript" src="http://www.squidoo.com/scripts/plexo/syndicate.php?plex_id='+e+'"><\/script>\n';contents+='<script type="text/javascript">\n';contents+="  openPlexo({\n";contents+='    "container" : "plex'+e+'"';if(c=="sidebar"){contents+=',\n    "size" : "sidebar"\n'}if(a!=undefined){contents+=',\n    "num_results" : "'+a+'"\n'}contents+="  });\n";contents+="<\/script>";$("widget-code-box"+f).value=contents;Element.show("widget-code"+f)}function openHelper(lmi,url){var width=550;var height=420;var _left=((screen.width-width)>>1);var _top=((screen.height-height)>>1);myWin=eval("helperWindow"+lmi);myWin=window.open(url,"modules_id"+lmi+"_helper","status=yes,scrollbars=yes,resizable=yes,width="+width+",height="+height+",left="+_left+",top="+_top);if(myWin.opener==null){myWin.opener=window}myWin.opener.name="opener";myWin.focus()}function showItems(e,a,d){var c="";if(a){c="Surfer"}Element.show("plexSubmission"+c+e);if(!d){Element.hide("bulk"+c+e)}new Effect.Highlight("bulkList"+c+e)}function hideToolbox(){$("toolbox-contents").hide();$("toggle-off").hide();$("toggle-on").show();var c=new Date();c.setTime(c.getTime()+(60*24*60*60*1000));var a=c.toGMTString();document.cookie="hide_toolbox = true; expires="+a+"; path=/";return false}function showToolbox(){$("toolbox-contents").show();$("toggle-off").show();$("toggle-on").hide();var c=new Date();c.setTime(c.getTime()+(-1*24*60*60*1000));var a=c.toGMTString();document.cookie="hide_toolbox = true; expires="+a+"; path=/";return false}function hideSquidUTips(){$("tip-squidu").hide();var c=new Date();c.setTime(c.getTime()+(60*24*60*60*1000));var a=c.toGMTString();document.cookie="hide_squidu_tips = true; expires="+a+"; path=/";return false}if(typeof Effect=="undefined"){var Effect=function(){return{Highlight:function(d,a){try{if(typeof d=="object"){d=d.id}jQuery("#"+d).fadeIn("fast");jQuery("#"+d).fadeOut("fast");jQuery("#"+d).fadeIn("fast")}catch(c){}},Fade:function(e,c){try{var a="slow";if(typeof c=="object"){a=c*1000}if(typeof e=="object"){e=e.id}jQuery("#"+e).fadeOut(a)}catch(d){}},Appear:function(d,a){try{if(typeof d=="object"){d=d.id}jQuery("#"+d).show()}catch(c){}},Pulsate:function(d,a){try{if(typeof d=="object"){d=d.id}jQuery("#"+d).fadeIn("fast");jQuery("#"+d).fadeOut("fast");jQuery("#"+d).fadeIn("fast");jQuery("#"+d).fadeOut("fast");jQuery("#"+d).fadeIn("fast");jQuery("#"+d).fadeOut("fast");jQuery("#"+d).fadeIn("fast");jQuery("#"+d).fadeOut("fast");jQuery("#"+d).fadeIn("fast")}catch(c){}},Grow:function(d,a){try{if(typeof d=="object"){d=d.id}jQuery("#"+d).show()}catch(c){}},BlindUp:function(d,a){try{if(typeof d=="object"){d=d.id}jQuery("#"+d).slideUp("fast")}catch(c){}},BlindDown:function(d,a){try{if(typeof d=="object"){d=d.id}jQuery("#"+d).slideDown("fast")}catch(c){}}}}()}if(pageLoadActions==undefined){window.pageLoadActions=[];window.pageLoaded=false}onPageLoadHandler=function(){clearInterval(hasPageLoadedInterval);if(!window.pageLoaded){window.pageLoaded=true;var d=pageLoadActions;pageLoadActions={push:function(e){if(typeof e=="function"){e()}}};for(var a=0;a<d.length;a++){var c=d[a];if(typeof c=="function"){c()}else{console.error("Can't run pageLoadAction #"+a+": "+c)}}}};function hasPageLoaded(){if(document.getElementById("pageBottomLoaded")){onPageLoadHandler()}}jQuery(document).ready(onPageLoadHandler);var hasPageLoadedInterval=setInterval(hasPageLoaded,500);var hasPageLoadedTimeout=setTimeout(hasPageLoaded,12000);var ajaxSpanStart='<span id="ajaxErrorText">';var ajaxSpanEnd="</span>";function validate(d,c){var a=true;if(typeof(d)=="string"){d=document.getElementById(d)}if(c==null){c="errors"}var e=$(c);e.style.display="none";e.innerHTML="";inputresult=validateFields(d,"input",e);selectresult=validateFields(d,"select",e);textarearesult=validateFields(d,"textarea",e);ajaxresult=true;if($("ajaxErrors")&&$("ajaxErrors").innerHTML.length){ajaxresult=false}if(!ajaxresult){e.innerHTML+=ajaxSpanStart+"- "+$("ajaxErrors").innerHTML+ajaxSpanEnd}a=inputresult&&selectresult&&textarearesult&&ajaxresult;if($("notSubmittable")){a=false;e.innerHTML+=" - Your submission could not be processed. Please check the form for any remaining errors<br />"}if(!a){e.style.display="block"}else{e.style.display="none"}return a}function scrollToElement(e){var a=0;var d=0;var c=$(e);while(c){a+=c.offsetLeft;d+=c.offsetTop;c=c.offsetParent}window.scrollTo(a,d)}function waitForAJAX(d,c){if(!c){c="errors"}if(ajaxRunning){var a=setTimeout("waitForAJAX('"+d+"', '"+c+"')",500)}else{if(!$(c).innerHTML.length){$(c).style.display="none";$(d).submit()}else{$(c).style.display="block"}}}function validateFields(d,x,h){var l=d.getElementsByTagName(x);var a=true;var k="";var y=new Array();for(var s=0;s<l.length;s++){var B=true;var c=l[s].value;var z=l[s].name;var p=z.replace(/_/g," ");var w="";if(l[s].getAttribute("maxlength")){var r=l[s].getAttribute("maxlength");var o=l[s].value;if(o.length>r){o=o.substr(0,r);l[s].value=o}}var e="";if(l[s].getAttribute("errormessage")){e=" - "+l[s].getAttribute("errormessage")+"<br />"}if((!l[s].getAttribute("ignore")||l[s].getAttribute("ignore")==null)&&l[s].getAttribute("required")){if(x!="select"&&c==""){B=false;if(e==""){w=" - Please enter your "+p+"<br />"}else{w=e}}if(l[s].options){if(l[s].selectedIndex<1){B=false;if(e==""){w=" - Please select a "+p+"<br />"}else{w=e}}}if(l[s].className.indexOf("radio")>=0){var t=document.getElementsByName(z);B=false;for(var q=0;q<t.length;q++){if(t[q].checked){B=true}}if(!B){if(e==""){w=" - Please select a "+p+" value<br />"}else{w=e}}}}else{if(!l[s].getAttribute("ignore")&&l[s].getAttribute("validate")&&l[s].getAttribute("validate").length){var u=l[s].getAttribute("validate");if(u=="email"){u="[\\_\\d\\w\\.'\\-]+@([\\d\\w'\\-]\\.?)+"}else{if(u=="url"){c=c.replace("http://http","http");l[s].value=c;u="^https?://([\\_\\d\\w\\-]+\\.)+[\\_\\d\\w\\-]+(:\\d+)?(/[^\\s]*)*$"}else{if(u=="feed"){u="^((https?://)|(feed:(//)?))([\\_\\d\\w\\-]+\\.)+[\\_\\d\\w\\-]+(:\\d+)?(/[^\\s]*)*$"}else{if(u=="password"){u="[\\S]{4,8}"}else{if(u=="tag"){u="^[^\\\\\\/\\!@#$%\\^\\?<>\\|\\{\\}\\[\\]=+~`&\\*\\(\\)]+$"}}}}}var n=new RegExp(u);if(!n.test(c)){B=false;if(e==""){w=" - Please make sure that you are entering your "+p+" in the correct format<br />"}else{w=e}}}}if(!l[s].getAttribute("ignore")&&l[s].getAttribute("confirms")){var A=l[s].getAttribute("confirms");if($(A).value.toLowerCase()!=c.toLowerCase()){B=false;if(e==""){w=" - Please make sure that your "+A.replace("_"," ")+" is entered correctly in both fields<br />"}else{w=e}}}var v=findParentDiv(l[s]);var f=v.className;if(!v.getAttribute("classPristine")){v.setAttribute("classPristine",f)}if(!B){a=false;v.className=f+" error";l[s].setAttribute("error","true");var g=false;for(var q=0;q<y.length;q++){if(y[q]==w){g=true}}if(!g){y.push(w)}}else{if(l[s].getAttribute("error")){v.className=f.replace(" error","")}}}if(!a&&y.length>0){h.innerHTML+=y.join("\n")}return a}function findParentDiv(a){var c=a.parentNode;while(c.tagName!="DIV"){c=c.parentNode}return c}function saveFields(g,s){var q="";for(var f=0;f<g.length;f++){var k=g[f];var h=k.id;var p=k.name;var e="";if(k.type!="checkbox"&&k.type!="submit"&&k.type!="image"&&k.type!="select-one"&&k.type!="radio"){var l=k.value;var a=h+"_value";if(p.indexOf("[")>-1){a=p.substr(0,p.indexOf("["))+"_value"}if($(a)&&l!=""){if(p.indexOf("[")>-1&&f>0){var j=$(a).innerHTML;if(j!=""){j=j+", "+escapeForDisplay(l,true)}else{j=escapeForDisplay(l)}$(a).innerHTML=j}else{$(a).innerHTML=escapeForDisplay(l,true)}}else{if($(a)&&l==""&&f==0){$(a).innerHTML=""}}if(p.indexOf("[]")>0){var o=p.replace("[]","");if(q.indexOf(o+"=")>=0){var d=q.indexOf(o+"=");var n=q.indexOf("&",d);var r=q.slice(d,n);var c=r+","+escapeForURL(l);q=q.substr(0,d)+c+q.substr(n)}else{q+=o+"="+escapeForURL(l)+"&"}}else{q+=p+"="+escapeForURL(l)+"&"}}else{if(k.type=="checkbox"&&k.checked&&p.indexOf("[]")<0){q+=p+"=1&"}else{if(k.type=="checkbox"&&k.checked&&p.indexOf("[]")>0){var o=p.replace("[]","");var l=k.value;if(q.indexOf(o+"=")>=0){var d=q.indexOf(o+"=");var n=q.indexOf("&",d);var r=q.slice(d,n);var c=r+","+escapeForURL(l);q=q.substr(0,d)+c+q.substr(n)}else{q+=o+"="+escapeForURL(l)+"&"}}else{if(k.type=="select-one"){var l=k.options[k.selectedIndex].value;q+=p+"="+escapeForURL(l)+"&"}else{if(k.type=="radio"){if(k.checked=="1"){q+=p+"="+escapeForURL(k.value)+"&"}}}}}}}return q}function escapeForDisplay(c,d){if(c!=null){var a=new String(c);a=a.replace(/&/g,"&amp;");if(!d){a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\"/g,"&quot;")}a=a.replace(/\r/g,"");a=a.replace(/\n/g,"<br />\n");a=a.replace(/&amp;nbsp;/g,"&nbsp;");return a}else{return""}}function escapeForFormField(a){return escapeForDisplay(a)}function escapeForURL(c){if(c!=null){var a=new String(escape(c));a=a.replace(/\+/g,"%2B");return a}else{return""}}function stripTags(c){var a=/<\/?[^>]+>/gi;c=c.replace(a,"");return c}function makeTinyMce(a,f){var e=false;var d=navigator.userAgent.indexOf("Safari")!=-1;if(elements){for(var c=0;c<elements.length;c++){if(elements[c].substr(0,a.length+1)==a+":"){e=true}}if(!d&&(!e||f)){elements.push(a);tinyMCE.execCommand("mceAddControl",false,a)}}}function unMakeTinyMce(a){var e=false;var d=navigator.userAgent.indexOf("Safari")!=-1;if(elements){for(var c=0;c<elements.length;c++){if(elements[c].substr(0,a.length+1)==a+":"){e=true}}if(!d&&e){elements.pop(a);tinyMCE.execCommand("mceRemoveControl",false,a)}}}function checkTinyMceContent(c){var h=c.getElementsByTagName("textarea");for(var g=0;g<h.length;g++){var e="";var d=h[g].id;for(var f=0;f<elements.length;f++){if(h[g].id+":"==elements[f].substr(0,h[g].id.length+1)){e=elements[f].replace(h[g].id+":","")}}var k=null;if(k=tinyMCE.getInstanceById(e)){var l=h[g].value;var a=k.getBody().innerHTML;if(l!=a){h[g].value=a}}}}var Facebook_SDK_Helper=function(){return{debug:false,login_cbs:[],logout_cbs:[],initialized:false,initializing:false,isMSIE:function(){return"\v"=="v"},hasActiveX:function(){try{versionString=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version");return true}catch(a){return false}return false},badMSIEActiveX:function(){if(this.isMSIE()){return !this.hasActiveX()}},log:function(){if(this.debug&&window.console){var d,a=[];for(var c=0;c<arguments.length;c++){if(c==0){d="Facebook_SDK_Helper::"+arguments[c]}else{a.push(arguments[c])}}console.log(d,a)}},error:function(){if(this.debug&&window.console){var d,a=[];for(var c=0;c<arguments.length;c++){if(c==0){d="Facebook_SDK_Helper::"+arguments[c]}else{a.push(arguments[c])}}console.error(d,a)}},isStageServer:function(){var a=location.host.indexOf("octosquid");return(a>-1)},init:function(){if(this.initialized){return false}this.initializing=true;this.log("init");var a=null,c=null;if(this.isStageServer()){a="40817683610";c="http://octosquid.squidoo.com:2000/utility/fb_custom_channel"}else{a="37459380049";c="http://www.squidoo.com/utility/fb_custom_channel"}FB.init({appId:a,status:true,cookie:true,xfbml:true,channelUrl:c});FB.Event.subscribe("auth.sessionChange",function(d){if(d.status=="connected"){Facebook_SDK_Helper.userIsLoggedIn(d.status,d.session)}else{if(d.status=="notConnected"||d.status=="unknown"){Facebook_SDK_Helper.userIsLoggedOut(d.status,d.session)}else{if(window.console){console.warn("Facebook_SDK_Helper::auth.sessionChange: user status ["+d.status+"] is unrecognized")}}}});this.initializing=false;this.initialized=true;this.updateLoginStatus()},login:function(){this.log("login");FB.login(function(a){if(a.session){Facebook_SDK_Helper.userIsLoggedIn(a.status,a.session);jQuery.post("/utility/fb_stash_profile_pic")}else{Facebook_SDK_Helper.userIsLoggedOut(a.status,null)}})},updateLoginStatus:function(){this.log("updateLoginStatus");FB.getLoginStatus(function(a){if(a.session){Facebook_SDK_Helper.userIsLoggedIn(a.status,a.session,a.perms);jQuery.post("/utility/fb_stash_profile_pic")}else{Facebook_SDK_Helper.userIsLoggedOut(a.status,null)}})},subscribe:function(a,c){this.log("subscribe",a,c);if(a){this.login_cbs.push(a)}if(c){this.logout_cbs.push(c)}},userIsLoggedIn:function(c,f,e){this.log("userIsLoggedIn",c,f,e);for(var d=0;d<this.login_cbs.length;d++){var a=this.login_cbs[d];a(c,f,e)}},userIsLoggedOut:function(c,e){this.log("userIsLoggedOut",c,e);for(var d=0;d<this.logout_cbs.length;d++){var a=this.logout_cbs[d];a(c,e)}},getPageStats:function(c,a){this.log("getPageStats",c,a);FB.api({method:"links.getStats",urls:c},function(d){if(a){a(d)}})},getUid:function(){this.log("getUid");if(FB._session&&FB._session.uid){return FB._session.uid}},makeShareButtons:function(){this.log("makeShareButtons");var a;if(typeof(theLensName)!="undefined"){a="http://www.squidoo.com/"+theLensName}else{a=location.href}this.getPageStats(a,function(d){var c=[];var e=0;if(d){e=d[0].total_count}c.push('<span class="fb_share_size_Small ">');c.push('<span class="FBConnectButton FBConnectButton_Small" style="cursor:pointer;">');c.push('<span class="FBConnectButton_Text">Share</span></span>');c.push('<span class="fb_share_count_nub_right "></span>');c.push('<span class="fb_share_count  fb_share_count_right"><span class="fb_share_count_inner">'+e+"</span></span></span>");jQuery("a.fb_share").each(function(){var f=[];f.push("http://www.facebook.com/sharer.php?u=");f.push(Facebook_SDK_Helper.URLEncode("http://www.squidoo.com/"+theLensName));f.push("&t=");f.push(Facebook_SDK_Helper.URLEncode(jQuery(this).attr("title")));jQuery(this).html(c.join("")).attr("style","text-decoration: none;").attr("href",f.join("")).bind("click",function(){var h=jQuery(this).attr("href");var g;_gaq.push(["_trackEvent","Share-Widgets","Facebook",theLensName]);window.open(h,"sharer","toolbar=0,status=0,width=626,height=436");jQuery(this).unbind("click");jQuery(this).bind("click",function(){return false});g=parseInt(jQuery(".fb_share_count_inner",jQuery(this)).html())+1;jQuery(".fb_share_count_inner",jQuery(this)).fadeOut("fast").html(g.toString()).fadeIn("fast");return false})})})},likeLens:function(a){this.log("likeLens",a);_gaq.push(["_trackEvent","Share-Widgets","Facebook-Like",theLensName]);SquidgamingJS.post("/utility/fb_like_count",{lens_id:theLensId})},sharePopup:function(c,d){this.log("sharePopup",c,d);var a=[];a.push("http://www.facebook.com/sharer.php?u=");a.push(Facebook_SDK_Helper.URLEncode(c));a.push("&t=");a.push(Facebook_SDK_Helper.URLEncode(d));window.open(a.join(""),"sharer","toolbar=0,status=0,width=626,height=436")},get_status:function(){this.log("get_status");try{this.safe_call(function(){FB.Connect.get_status().waitUntilReady(function(c){return c})})}catch(a){this.log("Facebook_Helper::get_status "+a.description)}return result},connect:function(e,d){try{var a=this.get_status();if(a==FB.ConnectState.connected){if(e){e()}}else{this.safe_call(function(){Facebook_Helper.log("requireSession");FB.Connect.requireSession(function(){if(e){Facebook_Helper.log("success connect");e()}},function(){if(d){Facebook_Helper.log("fail connect");d()}})})}}catch(c){this.error("connect",c)}},logout:function(a){this.log("logout",a);try{this.safe_call(function(){FB.logout(function(d){a(true)})})}catch(c){this.error("logout",c);a(false)}},getFriends:function(a){this.log("getFriends",a);try{this.safe_call(function(){FB.Facebook.apiClient.friends_get(null,function(d){if(a){a(d)}})})}catch(c){this.error("getFriends",c)}},parseDomTree:function(){this.log("parseDomTree");try{this.safe_call(function(){FB.XFBML.Host.parseDomTree()})}catch(a){this.error("parseDomTree",a)}},promptPublishAll:function(a){this.log("promptPublishAll",a);try{this.safe_call(function(){FB.Connect.showPermissionDialog("publish_stream",a,true)})}catch(c){this.error("promptPublishAll",c)}},promptPermission:function(c,a){this.log("promptPermission",c,a);try{this.safe_call(function(){FB.Facebook.apiClient.users_hasAppPermission(c,function(e){if(e===0){FB.Connect.showPermissionDialog(c,a)}else{a(true)}})})}catch(d){this.log("promptPermssion",d)}},checkAppPermission:function(c,a){this.log("checkAppPermission",c,a);try{this.safe_call(function(){FB.Facebook.apiClient.users_hasAppPermission(c,function(e){a(e)})})}catch(d){this.log("Facebook_Helper::hasAppPermission",d)}},URLEncode:function(k){var j="";var e=0;k=k.toString();var g=/(^[a-zA-Z0-9_.]*)/;while(e<k.length){var a=g.exec(k.substr(e));if(a!=null&&a.length>1&&a[1]!=""){j+=a[1];e+=a[1].length}else{if(k[e]==" "){j+="+"}else{var i=k.charCodeAt(e);var f=i.toString(16);j+="%"+(f.length<2?"0":"")+f.toUpperCase()}e++}}return j},URLDecode:function(d){var f=d;var a,c;var e=/(%[^%]{2})/;while((m=e.exec(f))!=null&&m.length>1&&m[1]!=""){b=parseInt(m[1].substr(1),16);c=String.fromCharCode(b);f=f.replace(m[1],c)}return f},dummy:function(){}}}();var Facebook_Helper=function(){return{init:function(){},get_uid:function(){Facebook_SDK_Helper.getUid()},dummy:function(){}}}();var Twitter_Helper=function(){return{cb:null,debug:false,log:function(a){if(this.debug&&window.console){console.log(a)}},track_event:function(c){var a="/track/ajax_click?";a+="&lens_id="+theLensId;a+="&url="+escape("http://twitter.com/"+c);$J.get(a)},popup:function(d,c,f,a,i){var h=(screen.width-f)/2;var g=(screen.height-a)/2;i=false;if(i){var e="url="+escape(d)+"&lens_id="+theLensId;_gaq._trackEvent("twitter_helper",c,theLensName);var d="/track/ajax_click?";d+="&lens_id="+theLensId;d+="&url="+escape(d);$J.get(d)}window.open(d,c,"status=0,location=0,toolbar=0,resizable=1,scrollbars=1,height="+a.toString()+",width="+f.toString()+",left="+h.toString()+",top="+g.toString())},tweet:function(c){var a="http://twitter.com/home?status="+c;this.track_event("tweet");this.popup(a,"twitter",780,480,false)},retweet:function(d,e,c){var a="http://twitter.com/home?status=RT+%40"+d+"%3A+"+e.replace(/#/gi,"%23")+"+"+c;this.track_event("retweet");this.popup(a,"twitter",780,480,false)},reply:function(d,c){var a="http://twitter.com/home?status=%40"+d+"%3A++"+c;this.track_event("reply");this.popup(a,"twitter",780,480,false)},finalize:function(c,d,a){new Ajax.Request("/utility/twitter_list_item_finalize",{postBody:"id="+c+"&lmi="+d,method:"post",asynchronous:true,onSuccess:function(e){var f=e.responseText;if(f=="ok"){if(a){a(true)}}else{if(a){a(false)}}}})},post:function(c,e,a){var d=110;if(c.length>d){alert("The message you entered is too long. Please limit to "+d.toString()+" characters.")}else{if(c.length==0){alert("You must enter a message.")}else{new Ajax.Request("/utility/twitter_list_post",{postBody:"msg="+c+"&lmi="+e,method:"post",asynchronous:true,onSuccess:function(f){var g=f.responseText.split("|");if(g[0]=="ok"){if(a){a(true)}}else{Twitter_Helper.do_oauth(function(){Twitter_Helper.finalize(g[1],e,a)})}}})}}},do_oauth:function(f){var a=380;var c=780;var e=(screen.width-c)/2;var d=(screen.height-a)/2;this.cb=f;window.open("/utility/twitter_oauth","twitter_oauth","status=0,location=0,toolbar=0,resizable=0,scrollbars=0,height="+a.toString()+",width="+c.toString()+",left="+e.toString()+",top="+d.toString())},search:function(d,a,e){var c="";for(var f in d){c+=f+"="+d[f]+"&"}new Ajax.Request("/utility/twitter_search",{postBody:c,method:"post",asynchronous:true,onSuccess:function(g){if(a){if(e){a(g,e)}else{a(g)}}}})},add_search_item:function(h,g,e,f,d,a){var c="";c="id="+h+"&lmi="+g+"&tweet="+e+"&tweet_time="+f+"&tweet_user="+d;new Ajax.Request("/utility/twitter_add_list_item",{postBody:c,method:"post",asynchronous:true,onSuccess:function(i){if(a){a()}}})},delete_list_item:function(e,d,a){var c;c="id="+e+"&lmi="+d;new Ajax.Request("/utility/twitter_del_list_item",{postBody:c,method:"post",asynchronous:true,onSuccess:function(f){if(a){a()}}})},promote_user_item:function(d,c){var a;a="id="+d+"&lmi="+c;new Ajax.Request("/utility/twitter_promote_list_item",{postBody:a,method:"post",asynchronous:true,onSuccess:function(e){}})},get_screen_name:function(a){new Ajax.Request("/utility/twitter_get_current_screen_name",{postBody:"",method:"post",asynchronous:true,onSuccess:function(c){if(a){a(c.responseText)}}})},_callback:function(){this.log("Twitter_OAuth._callback()");if(this.cb){this.cb()}}}}();var SquidooComments=function(){return{show_on_close_el:null,current_form:null,initial_type:"visitor",fb_available:false,captcha_loaded:false,debug:false,log:function(a){if(this.debug&&window&&window.console){window.console.log(a)}},setFocus:function(a){var e=a.parents("li:eq(0)");if(e.length==0){e=a.parents("div.module:eq(0)");if(e.length==0){return}}var c=e.offset();var d=c.top-0;a.focus();jQuery("html,body").animate({scrollTop:d},250)},display_tabs:function(g){var d=jQuery("li.gb_li_visitor",this.current_form);var f=jQuery("li.gb_li_squidoo",this.current_form);var e=jQuery("li.gb_li_facebook",this.current_form);var c=jQuery("li.gb_li_twitter",this.current_form);var a=jQuery("div.gb_email_check",this.current_form);if(g.visitor){d.show()}else{d.hide()}if(g.squidoo){f.show()}else{f.hide()}if(g.facebook){e.show()}else{e.hide()}if(g.twitter){c.show()}else{c.hide()}if(g.email_notify){a.show()}else{a.hide()}},new_form:function(h,c,e,d,g){if(this.current_form){this.close()}var f=jQuery("#primary_comment_input").clone().removeAttr("id").appendTo(e);jQuery("input[name='comment_lmi']",f).val(h);jQuery("input[name='blurb_type']",f).val(c);var a=jQuery("textarea",f);if(a){setTimeout(function(){SquidooComments.setFocus(a)},100)}f.show();this.switch_type(this.initial_type);this.show_on_close_el=d;this.current_form=f;this.display_tabs(g);if(Squidoo.embedded){Squidoo.resetHeight(null,Squidoo.embedded)}return this},reply_form:function(f,a,d,c,e){evTrack("Guestbook","Reply");this.new_form(f,a,c,null,e);jQuery("input[name='comment_parent_id']",this.current_form).val(d);return this},close:function(){if(this.current_form){this.current_form.parent().empty();this.current_form=null;if(this.show_on_close_el){this.show_on_close_el.show();this.show_on_close_el=null}}},save:function(){var d=true;this.hide_error();var c=jQuery.trim(jQuery("textarea",this.current_form).val());if(c==""){d=false;message="Your comment cannot be blank. Please enter a comment and try again."}if(d){var a=jQuery("form",this.current_form);var e=a.serialize();evTrack("Guestbook","Submit");jQuery.post("/utility/post_blurb",e,function(f){if(typeof(SquidgamingJS)=="object"){setTimeout(function(){SquidgamingJS.get("/utility/gaming_away_notice")},1000)}SquidooComments.post_save(f)})}else{this.show_error(message)}return false},setup_comment_button:function(c,a,d){if(!d.visitor&&!window.isLoggedIn){Squidoo.login(c.first(),function(e,f){if(e){a(c,d).switch_type("squidoo",f.member)}})}else{c.click(function(){a(c,d).switch_type((window.isLoggedIn?"squidoo":"visitor"),window.theMember);return false})}},show_error:function(a){jQuery("#comment_error_message",this.current_form).html(a).show();setTimeout(function(){SquidooComments.hide_error()},5000)},hide_error:function(){this.log("here");jQuery("#comment_error_message",this.current_form).fadeOut(2500)},load_more:function(g,i,a,c,e,h,d){var f={lmi:i,blurb_type:a,per_page:c,page:e,show_photos:h?"true":"false",strip_html:d?"true":"false"};evTrack("Guestbook","LoadMore");jQuery.post("/utility/more_blurbs",f,function(j){if(j!="error"){jQuery(g).parent().replaceWith(j)}})},cancel:function(){evTrack("Guestbook","Cancel");this.close()},switch_type:function(c,d){if(d==undefined){d=window.theMember}this.log("switch_type");var a=false;if(c=="facebook"){if(!this.fb_available){return this.switch_fb()}}this.log("setting type: "+c);this.log(this.current_form);jQuery("input[name='comment_type']",this.current_form).val(c);jQuery("#gb_type_"+c).attr("checked","checked");jQuery("ul.gb_select li",this.current_form).removeClass("gb_selected");jQuery("ul.gb_select li.gb_li_"+c,this.current_form).addClass("gb_selected");jQuery("div.gb_type_elements div",this.current_form).hide();jQuery("div.gb_type_elements div.gb_elements_"+c,this.current_form).show();if(c=="squidoo"&&d){jQuery(".gb_photo img",this.current_form).attr("src","/media/lensmaster/50/"+d.username);jQuery(".gb_btn_post_comment",this.current_form).text("Post as "+d.username)}if((c=="facebook")||(c=="twitter")||(c=="squidoo"&&d&&(d.roles.admin||d.roles.giant))){jQuery("div.gb_captcha",this.current_form).hide()}else{jQuery("div.gb_captcha",this.current_form).show();if(!this.captcha_loaded){jQuery.get("/utility/load_captcha/new",function(e){jQuery("div.gb_captcha").html(e);SquidooComments.captcha_loaded=true})}}jQuery("input[name='type']",this.current_form).val(c);this.initial_type=c;return true},set_initial_type:function(a){this.log("set_initial_type: "+a);this.initial_type=a;jQuery("#gb_type_"+a).attr("checked","checked")},set_fb_available:function(a){this.fb_available=a},post_save:function(c){var a;var d=JSON.parse(c);this.captcha_loaded=false;if(this.current_form){a=this.current_form.parent()}if(d.status=="success"){if(d.post_type=="facebook"){if(d.fb_data){var g=d.fb_data;var f=null;if(g.lens_image!=""){f=[{type:"image",href:g.module_url,src:g.lens_image}]}FB.ui({method:"stream.publish",message:g.comment_body,attachment:{name:g.module_title,caption:"{*actor*} just commented on "+g.module_title,description:g.module_abstract,href:g.module_url,media:f},action_links:[{text:"Join Discussion",href:g.module_url},{text:"View Lens",href:g.lens_url}],user_message_prompt:"Invite your friends to join the discussion:"},function(h){if(h&&h.post_id){SquidooComments.log("Post was published.")}else{SquidooComments.log("Post was not published.")}})}}this.close();var e=jQuery('<div class="gb_notice">'+d.message+"</div>");a.append(e);setTimeout(function(){e.hide()},5000)}else{this.show_error(d.message)}},xableFollowerEmail:function(c){var d=c.attr("checked");var a=jQuery("div.gb_follower_email_div",this.current_form);if(window.theMember&&window.theMember.username){a.hide()}else{if(d){a.show()}else{a.hide()}}},dummy:function(){}}}();if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());var SquidgamingJS=function(){return{debug:false,windowActive:true,inInline:false,initCount:0,initCalled:false,blocked:window.block_squidgaming,log:function(what){if(this.debug&&"console" in window){console.log("SquidGaming: "+what)}},error:function(what){if(this.debug&&"console" in window){console.error("SquidGaming: "+what)}},post:function(url,data,callback,dataType,onError){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=null}return jQuery.ajax({type:"POST",url:url,data:data,beforeSend:function(xhr){xhr.setRequestHeader("X-CSRF",CSRF)},success:function(response){try{var passThru;passThru=SquidgamingJS.processAjaxResponse(response);if(callback){callback(passThru)}}catch(e){SquidgamingJS.error(e.message)}},error:function(xhr,textStatus,errorThrown){$Sq.notify.error("Oops! Something went wrong. Please try again later.",{hideAfter:3000});SquidgamingJS.error(textStatus);if(jQuery.isFunction(onError)){onError(xhr)}},dataType:"text"})},get:function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=null}var interuption=setInterval(function(){if(SquidgamingJS.blocked||jQuery(".squidoo_overlay:visible").size()||jQuery("#default_onion:visible").size()){if(SquidgamingJS.debug&&"console" in window){console.log("blocked...")}return}else{clearInterval(interuption)}jQuery.ajax({type:"GET",url:url,data:data,success:function(response){try{var passThru;passThru=SquidgamingJS.processAjaxResponse(response);if(callback){callback(passThru)}}catch(e){SquidgamingJS.error(e.message)}},error:function(XMLHttpRequest,textStatus,errorThrown){SquidgamingJS.error(textStatus)},dataType:"text"})},1000)},processAjaxResponse:function(val){var result=val;try{if(val.indexOf("||sg||")>-1){var parts=val.split("||sg||");var sgVal=jQuery.trim(parts[0]);result=jQuery.trim(parts[1]);this.handleSGInstructions(sgVal)}}catch(e){SquidgamingJS.error(e.message)}return result},handleSGInstructions:function(sgString){this.log("handleSGInstructions");if(!hasGaming){return}var o=this.parseJSON(sgString);if(SquidgamingJS.debug&&"console" in window){console.log("SquidgamingJS: sgString loaded",o)}if(o.levelNavDisplay){jQuery("#game_nav > li:eq(0)").html(o.levelNavDisplay)}if(o.pointsNavDisplay){jQuery("#game_nav > li:eq(1)").html(o.pointsNavDisplay)}if(o.trophiesNavDisplay){jQuery("#game_nav > li:eq(2)").html(o.trophiesNavDisplay)}if(o.uiInterruptions){var self=this;var interruptions=o.uiInterruptions;for(var i=0;i<interruptions.length;i++){var cur_int=interruptions[i];if(cur_int.type=="points_dismissable"){self.log("opening points_dismissable");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}else{if(cur_int.type=="points_simple"){self.log("opening points_simple");jQuery("#sg_container").html(cur_int.markup);self.autoSlideOverlay()}else{if(cur_int.type=="points_flash"){self.log("updating points_flash");self.pointsFlash(cur_int.markup)}else{if(cur_int.type=="away"){self.log("opening away");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}else{if(cur_int.type=="trophy"){self.log("opening trophy");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}else{if(cur_int.type=="level"){self.log("updating level");jQuery("#sg_container").html(cur_int.markup);self.openOverlay(true)}}}}}}}}},openOverlay:function(withOnion){this.windowActive=false;if(withOnion){jQuery("#gaming_onion").show()}jQuery("#sg_container > div").show()},closeOverlay:function(){jQuery("#sg_container > div").hide();jQuery("#gaming_onion").hide();this.windowActive=true},autoSlideOverlay:function(){jQuery("#sg_container > div").css("top","-140px").show().animate({top:"+=180"},"slow");setTimeout(function(){jQuery("#sg_container > div").fadeOut("fast")},4000)},pointsFlash:function(markup){var old_markup=jQuery("#game_nav > li:eq(1)").html();jQuery("#game_nav > li:eq(1)").addClass("pts_alert").html(markup);setTimeout(function(){jQuery("#game_nav > li:eq(1)").removeClass("pts_alert").html(old_markup)},6000)},checkAway:function(firstLoad){if(!this.windowActive){return}if(this.inInline){setTimeout(function(){SquidgamingJS.checkAway(false)},150000);return}var url="/utility/gaming_away_notice";if(firstLoad){url+="?lens=";url+=typeof(theLensId)!=="undefined"?1:0}SquidgamingJS.get(url);setTimeout(function(){SquidgamingJS.checkAway(false)},150000)},windowBlur:function(){this.windowActive=false},windowFocus:function(){this.windowActive=true;this.checkAway(false)},initHooks:function(){if(this.initCalled){return}this.initCalled=true;if(typeof hasGaming=="undefined"){if(this.initCount<10){this.initCount+=1;setTimeout(function(){SquidgamingJS.initHooks()},500*(this.initCount));return}}if(!hasGaming){return}jQuery("body").append('<div id="gaming_onion" class="default_onion" style="display: none;"></div>');window.onblur=function(){SquidgamingJS.windowBlur()};window.onfocus=function(){SquidgamingJS.windowFocus()};jQuery("#gaming_onion").bind("click",function(){SquidgamingJS.closeOverlay()});setTimeout(function(){SquidgamingJS.checkAway(true)},2000)},inlineInstructions:function(types){var self=this;var interuption=setInterval(function(){if(SquidgamingJS.blocked||jQuery(".squidoo_overlay:visible").size()||jQuery("#default_onion:visible").size()){if(SquidgamingJS.debug&&"console" in window){console.log("blocked...")}return}else{clearInterval(interuption)}self.inInline=true;if(jQuery("#game_nav_inline > li:eq(0)").length>0){jQuery("#game_nav > li:eq(0)").html(jQuery("#game_nav_inline > li:eq(0)").html())}if(jQuery("#game_nav_inline > li:eq(1)").length>0){jQuery("#game_nav > li:eq(1)").html(jQuery("#game_nav_inline > li:eq(1)").html())}if(jQuery("#game_nav_inline > li:eq(2)").length>0){jQuery("#game_nav > li:eq(2)").html(jQuery("#game_nav_inline > li:eq(2)").html())}for(var i=0;i<types.length;i++){var cur_int=types[i];if(cur_int=="points_dismissable"){self.log("opening points_dismissable");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}else{if(cur_int=="points_simple"){self.log("opening points_simple");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.autoSlideOverlay()}else{if(cur_int=="points_flash"){self.log("updating points_flash");self.pointsFlash(jQuery("#game_int_inline_"+cur_int).html())}else{if(cur_int=="away"){self.log("opening away");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}else{if(cur_int=="trophy"){self.log("opening trophy");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}else{if(cur_int=="level"){self.log("updating level");jQuery("#sg_container").html(jQuery("#game_int_inline_"+cur_int).html());self.openOverlay(true)}}}}}}}self.inInline=false},100)},sharePopup:function(url,name,width,height,do_track){var left=(screen.width-width)/2;var top=(screen.height-height)/2;if(do_track){evTrack("twitter_helper",name,theLensName);var url="/track/ajax_click?";url+="&lens_id="+theLensId;url+="&url="+escape(url);$J.get(url)}window.open(url,name,"status=0,location=0,toolbar=0,resizable=1,scrollbars=1,height="+height.toString()+",width="+width.toString()+",left="+left.toString()+",top="+top.toString())},moreActivities:function(start_num,filter){qloc=window.location.href.indexOf("?");qs=(qloc>-1)?window.location.href.slice(qloc):"";jQuery.post("/lensmaster/activity_ajax"+qs,{start_num:start_num},function(response){jQuery("ul.act_strm_ul li:last").after(response).hide();if(typeof(setupMXTracking)!=="undefined"){setupMXTracking()}})},parseJSON:function(str){str=str.replace(/\n/g," ");if((typeof JSON=="object")&&(typeof JSON.parse=="function")){return JSON.parse(str)}if(typeof(str)=="string"){return eval("("+str+")")}else{return str}},_d:null}}();if($J(window).width()>=990){jQuery(document).ready(function(){SquidgamingJS.initHooks()});if(typeof pageLoadActions!="undefined"){pageLoadActions.push(function(){SquidgamingJS.initHooks()})}}window.block_squidgaming=true;(function(){var i=setInterval(function(){if(window.jQuery){clearInterval(i)}else{return}(function($){$(function(){$(".inline_input").focus(function(){$(this).addClass("inline_input_active")}).blur(function(){$(this).removeClass("inline_input_active")})});window.UnifiedLogin=function(){return{debug:false,captcha_loaded:false,is_registration:false,no_onion:false,reg_type:"standard",login_callback:null,initialized:false,unblock:function(){this.log("Unblocking SquidGaming service");window.block_squidgaming=false;if(window.SquidgamingJS){SquidgamingJS.blocked=false}},log:function(){if(this.debug&&"console" in window){var msg,args=[];for(var i=0;i<arguments.length;i++){if(i==0){msg="UnifiedLogin::"+arguments[i]}else{args.push(arguments[i])}}console.log(msg,args)}},error:function(){if(this.debug&&"console" in window){var msg,args=[];for(var i=0;i<arguments.length;i++){if(i==0){msg="UnifiedLogin::"+arguments[i]}else{args.push(arguments[i])}}console.error(msg,args)}},closeOverlays:function(hide_the_onion){if(hide_the_onion==null||hide_the_onion){$("#default_onion").hide()}$(".squidoo_overlay").hide()},showPage:function(selector,callback){this.log("showPage",selector);this.closeOverlays();if(!this.no_onion){$("#default_onion").show()}var self=this;var onModalLoaded=function(){window.scrollTo(0,0);$(selector).show();FB.XFBML.parse(document.getElementById(selector.substr(1)));if(callback){callback.call(self)}};if($("#lgn_login").length==0){var waitForOverlay=setInterval(function(){if(!$("#unified-login-overlay").size()){return}else{clearInterval(waitForOverlay)}$("#unified-login-overlay").load("/utility/unifiedlogin",function(){onModalLoaded()}).show()},100)}else{onModalLoaded()}},register:function(reg_type,cb){this.log("register",reg_type,cb);if(cb){this.login_callback=cb}if(Facebook_SDK_Helper.badMSIEActiveX()){document.location.href="/member/registration";return}if(reg_type){this.reg_type=reg_type}if(this.reg_type=="standard"){$("#lgn_register_complete a.btn_35").html("Build My First Page!").removeClass("btn_gray")}else{if(this.reg_type=="wizard"){$("#lgn_register_complete a.btn_35").html("Continue").removeClass("btn_gray")}else{if(this.reg_type=="quick"){$("#lgn_register_complete a.btn_35").html("Close").addClass("btn_gray")}}}if(!this.no_onion){$("#default_onion").show()}this.init();this.registerSquidoo()},registerSquidoo:function(){this.log("registerSquidoo");this.showPage("#lgn_reg_squidoo",function(){_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","View"]);$("#lgn_reg_squidoo div.gb_captcha",this.current_form).show();$("#lgn_register_sq_username").focus();if(!this.captcha_loaded){$.get("/utility/load_captcha/new",function(res){$("#lgn_reg_squidoo div.gb_captcha").html(res);UnifiedLogin.captcha_loaded=true})}})},login:function(cb){this.log("login");this.init();this.is_registration=false;if(cb){this.login_callback=cb}if(Facebook_SDK_Helper.badMSIEActiveX()){document.location.href="/member/login";return}$("button[type=submit]",$("#lgn_login")).removeClass("btn_gray").html("Login");if(!this.no_onion){$("#default_onion").show()}this.showPage("#lgn_login");$("#lgn_squidoo_email").focus();$.post("/utility/can_fb_login",function(response){var o=UnifiedLogin.parseJSON(response);if(FB.getSession()&&o.result){FB.api("/me",function(fb_user_object){$("#lgn_login form").hide();$("#lgn_login .need_account").hide();$(".fb_name").text(fb_user_object.name);$(".fb_profile_pic .wait").hide();$(".fb_profile_pic .pic").show();$(".from_facebook").show()})}})},init:function(){this.log("init");if(this.initialized){return false}Facebook_SDK_Helper.init();this.initialized=true},connect:function(){this.log("connect");this.showPage("#lgn_connect")},importFBProfile:function(){this.log("importFBProfile");this.init();this.is_registration=true;var import_profile=function(){$(".fb_profile_pic .wait").show();$(".fb_profile_pic .pic").hide();$.post("/utility/can_fb_login",function(response){var o=UnifiedLogin.parseJSON(response);if(o.result){FB.api("/me",function(fb_user_object){$("#lgn_login form").addClass("border_top");$(".fb_name").text(fb_user_object.name);UnifiedLogin.showPage("#lgn_login");$("#lgn_squidoo_email").focus();$(".fb_profile_pic .wait").hide();$(".fb_profile_pic .pic").show();$(".from_facebook").show()})}else{$("#alreadyConnectedForm").hide();$("#registrationForm").show();UnifiedLogin.getCurrentPermissions(function(has_all,perms){$("#lgn_reg_squidoo .lgn_fb_option").hide().after("<br />");FB.api("/me",function(fb_user_object){UnifiedLogin.log("importFBProfile::FB.api(/me)->",fb_user_object);var session=FB.getSession();$("#fb_access_token").val(session.access_token);$("#fb_expires").val(session.expires);$("#fb_secret").val(session.secret);$("#fb_session_key").val(session.session_key);$("#fb_sig").val(session.sig);$("#fb_uid").val(session.uid);$("#lgn_reg_fb_name").html(fb_user_object.name);$("#lgn_register_sq_first_name").val(fb_user_object.first_name);$("#lgn_register_sq_last_name").val(fb_user_object.last_name);UnifiedLogin.getUsername(fb_user_object,function(response){$("#lgn_register_sq_username").val(response.username).blur()});if(perms.email){UnifiedLogin.getEmailAddress(function(email_address){$("#lgn_register_sq_email").val(email_address).blur();$("#lgn_register_sq_password").focus();$(".fb_profile_pic .wait").hide();$(".fb_profile_pic .pic").show()})}})})}})};FB.getLoginStatus(function(response){if(!response.session){FB.login(function(response){if(response.session){import_profile()}},{perms:"email,publish_stream"})}else{import_profile()}})},getUsername:function(fb_user_object,cb){$.post("/utility/fb_user_username",fb_user_object,function(response){cb(UnifiedLogin.parseJSON(response))})},getExtendedPermissions:function(){FB.login(function(response){if(response.session){if(response.perms){UnifiedLogin.log(response)}else{UnifiedLogin.log(response)}}else{UnifiedLogin.log(response)}},{perms:"email,read_stream,publish_stream,offline_access"})},getCurrentPermissions:function(cb){var query="SELECT publish_stream, email FROM permissions WHERE uid="+FB.getSession().uid;UnifiedLogin.log(query);FB.api({method:"fql.query",query:query},function(response){if(response.length){var has_all=true;perms=response[0];has_all=has_all&&(perms.email==1);has_all=has_all&&(perms.publish_stream==1);cb(has_all,perms)}else{UnifiedLogin.log("No permissions returned at all");cb(false,perms)}})},getEmailAddress:function(cb){var query="SELECT uid, email FROM user WHERE uid="+FB.getSession().uid;UnifiedLogin.log(query);FB.api({method:"fql.query",query:query},function(response){UnifiedLogin.log(response);var email="";if(response.length){data=response[0];email=data.email}else{UnifiedLogin.log("No query data returned")}cb(email)})},connectAccount:function(the_form){$("div",the_form).removeClass("form_error");var email=$("#lgn_connect_email",the_form).val();var password=$("#lgn_connect_password",the_form).val();var valid=true;if($.trim(email)==""){valid=false;$("#lgn_connect_email_div",the_form).addClass("form_error")}if($.trim(password)==""){valid=false;$("#lgn_connect_password_div",the_form).addClass("form_error")}if(!valid){return false}$.post("/utility/fb_login_connect",the_form.serialize(),function(response){var o=UnifiedLogin.parseJSON(response);UnifiedLogin.log(o);if(o.status=="success"){UnifiedLogin.closeRefresh()}else{$("#lgn_connect_gen_err",the_form).html(o.reason);$("#lgn_connect_gen_div",the_form).addClass("form_error")}});return false},loginSquidoo:function(the_form){$("div",the_form).removeClass("form_error");var email=$("#lgn_squidoo_email",the_form).val();var password=$("#lgn_squidoo_password",the_form).val();var valid=true;if($.trim(email)==""){valid=false;$("#lgn_squidoo_email_div",the_form).addClass("form_error")}if($.trim(password)==""){valid=false;$("#lgn_squidoo_password_div",the_form).addClass("form_error")}if(!valid){return false}$("button[type=submit]",the_form).addClass("btn_gray").html("logging in");$.post("/utility/ajax_login",the_form.serialize(),function(response){var obj;UnifiedLogin.log(response);try{obj=UnifiedLogin.parseJSON(response)}catch(ex){UnifiedLogin.log(ex);obj={status:"fail",reason:"Login failed. Please try again."}}UnifiedLogin.log(obj);if(obj.status=="success"){if(UnifiedLogin.login_callback){try{UnifiedLogin.login_callback(obj.user_type)}catch(e){}}else{UnifiedLogin.closeRefresh()}}else{$("button[type=submit]",the_form).removeClass("btn_gray").html("Login");$("#lgn_squidoo_gen_err",the_form).html(obj.reason);$("#lgn_squidoo_gen_div",the_form).addClass("form_error")}});return false},validateAndRegister:function(reg_form){$("div",reg_form).removeClass("form_error");var tos_checked=$("#accept_lmtos",reg_form).attr("checked");var email=$("#lgn_register_email",reg_form).val();var username=$("#lgn_register_username",reg_form).val();var valid=true;if(!tos_checked){valid=false;$("#lgn_register_tos_div",reg_form).addClass("form_error")}if($.trim(email)==""){valid=false;$("#lgn_register_email_div",reg_form).addClass("form_error")}if($.trim(username)==""){valid=false;$("#lgn_register_username_div",reg_form).addClass("form_error")}if(!valid){return false}$.post("/utility/fb_login_register",reg_form.serialize(),function(response){var o=UnifiedLogin.parseJSON(response);UnifiedLogin.log(o);if(o.status=="fail"){var cur_field;for(var i=0;i<o.err_fields.length;i++){cur_field=o.err_fields[i];$("#lgn_register_"+cur_field+"_div",reg_form).addClass("form_error");if(cur_field=="email"){$("#lgn_register_email_err",reg_form).html(o.err_msgs.email).addClass("error_n")}if(cur_field=="username"){$("#lgn_register_username_err",reg_form).html(o.err_msgs.username).addClass("error_n")}if(cur_field=="tos"){$("#lgn_register_tos_err",reg_form).html(o.err_msgs.tos).addClass("error_n")}}}else{if(UnifiedLogin.reg_type=="wizard"||UnifiedLogin.reg_type=="quick"){UnifiedLogin.closeRegister()}else{UnifiedLogin.showPage("#lgn_register_complete")}}});return false},validateAndRegisterMadlibs:function(form){form=$(form);if(form.find(".input_red").size()){form.find(".input_red:first").focus();return false}var submit=form.find('button[type="submit"]');submit.addClass("btn_working");var form_data=form.serialize();if(LensGifting.gift_code){form_data+="&gift_code="+LensGifting.gift_code}$.post("/utility/fb_login_register",form_data,function(res){var res=UnifiedLogin.parseJSON(res);if(res.status=="fail"){_gaq.push(["_trackEvent","Sign Up","Modal - Madlibs 2","Invalid",res.err_fields.length]);var first_field=null;$.each(res.err_fields,function(i,field_name){var field=null;if(field_name=="captcha"){field=$("#_squidcap_e")}else{field=$("#lgn_register_sq_"+field_name)}if(!field.size()){if("console" in window){console.error("Field ["+field_name+"] does not exist")}}else{if(!first_field){first_field=field}field.addClass("input_red");field.data("error_msg",res.err_msgs[field_name])}});first_field.focus();submit.removeClass("btn_working")}else{_gaq.push(["_trackEvent","Sign Up","Modal - Madlibs 2","Success"]);if(UnifiedLogin.reg_type=="wizard"||UnifiedLogin.reg_type=="quick"){UnifiedLogin.closeRegister()}else{if(UnifiedLogin.reg_type=="giftlens"){LensGifting.claimGift(LensGifting.gift_code,LensGifting.lens_name)}else{UnifiedLogin.showPage("#lgn_register_complete")}}}});return false},validateAndRegisterSquidoo:function(reg_form){$("button[type=submit]",reg_form).addClass("btn_working").html("Working");$("div",reg_form).removeClass("form_error");$(".error_y",reg_form).html("").removeClass("error_y");$(".error_n",reg_form).html("").removeClass("error_n");var tos_checked=$("#lgn_register_sq_lmtos",reg_form).attr("checked");var email=$("#lgn_register_sq_email",reg_form).val();var username=$("#lgn_register_sq_username",reg_form).val();var password=$("#lgn_register_sq_password",reg_form).val();var verify=$("#lgn_register_sq_verify",reg_form).val();var valid=true;var invalid=0;if(!tos_checked){valid=false;invalid++;$("#lgn_reg_squidoo_tos_err").html("Please agree to the Terms of Service").removeClass("error_y").addClass("error_n").show()}if($.trim(email)==""){valid=false;invalid++;$("#email_address_err").html("Enter email address").removeClass("error_y").addClass("error_n").show();$("#email_address_err").closest("div.form_item").addClass("form_error")}if($.trim(username)==""){valid=false;invalid++;$("#desired_username_err").html("Enter username").removeClass("error_y").addClass("error_n").show();$("#desired_username_err").closest("div.form_item").addClass("form_error")}if($.trim(password)==""){valid=false;invalid++;$("#password_err").html("Enter password").removeClass("error_y").addClass("error_n").show();$("#password_err").closest("div.form_item").addClass("form_error")}if(password!=verify){valid=false;invalid++;$("#password_confirmation_err").html("Does not match password").removeClass("error_y").addClass("error_n").show();$("#password_confirmation_err").closest("div.form_item").addClass("form_error")}if(!valid){_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","Invalid",invalid]);$("button[type=submit]",reg_form).removeClass("btn_working").html("Join Now!");return false}var form_data=reg_form.serialize();if(LensGifting.gift_code){form_data+="&gift_code="+LensGifting.gift_code}$.post("/utility/fb_login_register",form_data,function(response){var o=UnifiedLogin.parseJSON(response);UnifiedLogin.log(o);if(o.status=="fail"){var cur_field;_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","Invalid",o.err_fields.length]);$("button[type=submit]",reg_form).removeClass("btn_working").html("Join Now!");for(var i=0;i<o.err_fields.length;i++){cur_field=o.err_fields[i];$("#lgn_register_"+cur_field+"_div",reg_form).addClass("form_error");if(cur_field=="email"){$("#email_address_err").html(o.err_msgs.email).removeClass("error_y").addClass("error_n").show();$("#email_address_err").closest("div.form_item").addClass("form_error")}if(cur_field=="username"){$("#desired_username_err").html(o.err_msgs.username).removeClass("error_y").addClass("error_n").show();$("#desired_username_err").closest("div.form_item").addClass("form_error")}if(cur_field=="tos"){$("#lgn_register_tos_err",reg_form).html(o.err_msgs.tos)}}}else{_gaq.push(["_trackEvent","Sign Up","Modal - Original 2","Success"]);if(UnifiedLogin.reg_type=="wizard"||UnifiedLogin.reg_type=="quick"){UnifiedLogin.closeRegister()}else{if(UnifiedLogin.reg_type=="giftlens"){LensGifting.claimGift(LensGifting.gift_code,LensGifting.lens_name)}else{UnifiedLogin.showPage("#lgn_register_complete")}}}});return false},closeRefresh:function(){this.closeOverlays();document.location.reload()},closeRegister:function(){this.log(this.reg_type);this.closeOverlays();if(this.reg_type=="standard"){document.location="/wizard/start"}else{if(this.reg_type=="wizard"){document.location="/wizard/step1"}else{if(this.reg_type=="quick"){document.location="/build/quick"}else{if(this.reg_type=="cb"){try{if(this.login_callback){this.login_callback("new")}}catch(e){}}}}}},squidooLogoutRefresh:function(){$.get("/member/ajax_logout",function(){UnifiedLogin.closeOverlays();document.location.reload()})},fbLogoutRefresh:function(){FB.logout(function(){UnifiedLogin.closeOverlays();document.location.reload()})},refreshMadlibsError:function(field){field=$(field);var error=$("#signup_errors");var msg=field.data("error_msg");if(msg){if(!msg.match(/\.$/)){msg+="."}error.text(msg);error.data("field",field);error.addClass("error_n")}else{error.text("");error.removeClass("error_n")}},validateUsernameMadlibs:function(field,skip_if_empty,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!val&&skip_if_empty){field.removeClass("input_red");field.data("error_msg","");if(callback){return callback(true)}else{return true}}else{if(!val){field.addClass("input_red");field.data("error_msg","Username is required");if(callback){return callback(false)}else{return false}}}field.removeClass("input_red");field.data("error_msg","");$.post("/member/ajax_validate_registration",{data_type:"username",value:val},function(res){res=UnifiedLogin.parseJSON(res);if(res.result==true){field.removeClass("input_red");field.data("error_msg","")}else{field.addClass("input_red");field.data("error_msg",res.msg)}if(callback){callback(res.result)}});return false},validateCaptchaMadlibs:function(field,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());var valid=false;if(!val){field.data("error_msg","Please type the security word");valid=false}else{valid=true}if(valid){field.removeClass("input_red");field.data("error_msg","")}else{field.addClass("input_red")}if(callback){return callback(false)}else{return false}},validatePasswordMadlibs:function(field,skip_if_empty,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());var valid=false;if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!val&&skip_if_empty){valid=true}else{if(!val){field.data("error_msg","Password is required");valid=false}else{if(val.length<6){field.data("error_msg","Password is too short");valid=false}else{valid=true}}}if(valid){field.data("error_msg","");field.removeClass("input_red")}else{field.addClass("input_red")}if(callback){callback(valid)}else{return valid}},validatePasswordConfMadlibs:function(field,password,skip_if_empty,callback){field=$(field);var conf=$.trim(field.val());var password=$.trim($(password).val());var form=field.closest("form");var valid=false;if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!conf&&skip_if_empty){valid=true}else{if(!conf&&!password){valid=false;field.data("error_msg","Please confirm your password")}else{if((conf||password)&&conf!=password){valid=false;field.data("error_msg","Your passwords do not match")}else{valid=true}}}if(valid){field.data("error_msg","");field.removeClass("input_red")}else{field.addClass("input_red")}if(callback){callback(valid)}else{return valid}},validateEmailMadlibs:function(field,skip_if_empty,callback){field=$(field);var form=field.closest("form");var val=$.trim(field.val());if($.isFunction(skip_if_empty)){callback=skip_if_empty;skip_if_empty=false}if(!val&&skip_if_empty){field.removeClass("input_red");field.data("error_msg","");if(callback){return callback(true)}else{return true}}else{if(!val){field.addClass("input_red");field.data("error_msg","E-mail address is required");UnifiedLogin.refreshMadlibsError(field);if(callback){return callback(false)}else{return false}}}field.removeClass("input_red");field.data("error_msg","");$.post("/member/ajax_validate_registration",{data_type:"email_address",value:val},function(res){res=UnifiedLogin.parseJSON(res);if(res.result==true){field.removeClass("input_red");field.data("error_msg","")}else{field.addClass("input_red");field.data("error_msg",res.msg)}if(callback){callback(res.result)}});return false},usernameKeyUp:function(e){var charCode=(e.which)?e.which:e.keyCode;if((charCode==45)||(charCode==8)||(charCode==9)||(charCode==95)||((charCode>=97)&&(charCode<=122))||((charCode>=65)&&(charCode<=90))||((charCode>=48)&&(charCode<=57))){return true}return false},validateUsername:function(parent_el,skip_if_empty){var val=$("#lgn_register_sq_username").val();if(($.trim(val)=="")&&skip_if_empty){return}$("#desired_username_err").html("Checking...").removeClass("form_error").show();$.post("/member/ajax_validate_registration",{data_type:"username",value:val},function(res){var res_o=UnifiedLogin.parseJSON(res);if(res_o.result==true){$("#desired_username_err").html(res_o.msg).removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}else{$("#desired_username_err").html(res_o.msg).removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}})},validateEmail:function(parent_el,skip_if_empty){var val=$("#lgn_register_sq_email").val();if(($.trim(val)=="")&&skip_if_empty){return}$("#email_address_err").html("Checking...").removeClass("form_error").show();$.post("/member/ajax_validate_registration",{data_type:"email_address",value:val},function(res){var res_o=UnifiedLogin.parseJSON(res);if(res_o.result==true){$("#email_address_err").html(res_o.msg).removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}else{$("#email_address_err").html(res_o.msg).removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}})},validatePassword:function(parent_el,skip_if_empty){var val=$("#lgn_register_sq_password").val();if(($.trim(val)=="")&&skip_if_empty){return}if(val.length<6){$("#password_err").html("Password too short").removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}else{$("#password_err").html("OK").removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}},validatePasswordConf:function(parent_el,skip_if_empty){var pass=$("#lgn_register_sq_password").val();var pass_conf=$("#lgn_register_sq_verify").val();if(($.trim(pass_conf)=="")&&skip_if_empty){return}if(pass!=pass_conf){$("#password_confirmation_err").html("Passwords do not match").removeClass("error_y").addClass("error_n").show();$(parent_el).addClass("form_error")}else{$("#password_confirmation_err").html("OK").removeClass("error_n").addClass("error_y").show();$(parent_el).addClass("form_error")}},parseJSON:function(str){if(typeof(str)=="string"){return eval("("+str+")")}else{return str}}}}()})(jQuery)},500)})();(function(){var a=setInterval(function(){if(window.jQuery){clearInterval(a)}else{return}(function(d){var c=window.LensGifting=d.extend(window.LensGifting,{track:function(h,f,g){if(!window._gaq){if(window.console){window.console.error("Google Analytics is not loaded.")}}var e=function(){_gaq.push(["_trackEvent","Lens Gifting",h,f,g])};e()},showMessage:function(){d("#default_onion").show();d("#gift_message").show()},closeMessage:function(){d("#default_onion").hide();d("#gift_message").hide()},cancel:function(f,e){if(confirm("Really? Are you sure you don't want to give this lens as a gift? If you click OK this lens will just become a regular old lens in your stable, not a specially wrapped gift for a friend.")){d.post("/lensmaster/cancel_gift",{lens_id:f,lm:e,ajax:true},function(g){if(g){alert(g)}else{window.location.reload()}})}},resendInvitation:function(f,e){d.post("/lensmaster/resend_invitation",{lens_id:f},function(g){d(e).fadeOut(function(){d(e).replaceWith('<span id="invite_sent_'+f+'">Sent!</span>').show();setTimeout(function(){d("#invite_sent_"+f).replaceWith(g)},2000)})})},showMessageForm:function(){d("#default_onion").show();d("#gift_message_form").show();d("#gift_message_recipient_name").focus()},hideMessageForm:function(){d("#default_onion").hide();d("#gift_message_form").hide()},claimGift:function(f,e){d.post("/lensmaster/claim_gift",{gift_code:f},function(g){if(g=="success"){window.location="/lensmaster/workshop/"+e}else{alert(g)}})},register:function(){Squidoo.register(function(){LensGifting.claimGift(LensGifting.gift_code,LensGifting.lens_name)})},hideGifterIntro:function(e){d.post("/lensmaster/hide_gifter_intro",{lens_id:e},function(){d("#gifter_intro").hide()})},hideRecipientIntro:function(e){d.post("/lensmaster/hide_recipient_intro",{lens_id:e},function(){d("#recipient_intro").hide()})},showGifterIntro:function(e){d("#default_onion").show();d("#publish_result").addClass("overlay_wait").html("").fadeIn();d.post("/workshop/ajax_gift_giver_intro/"+e,function(f){d("#publish_result").removeClass("overlay_wait").html(f)})},showRecipientIntro:function(e){d("#default_onion").show();d("#publish_result").addClass("overlay_wait").html("").fadeIn();d.post("/workshop/ajax_gift_recipient_intro/"+e,function(f){d("#publish_result").removeClass("overlay_wait").html(f)})}})})(jQuery)},500)})();(function(a){window.ProgressBar={update:function(){var c=(window.theLens)?theLens.lensName:theLensName;a.post("/workshop/ajax_progress_bar/"+c,{show_progress_list:a("#progress-bar .progress_list:visible").size()},function(d){a("#progress-bar").html(d)})},init:function(){a(".progress_wrap_head").toggle(function(){a(".progress_list").slideDown();a(".progress_toggle").html("Hide your progress")},function(){a(".progress_list").slideUp();a(".progress_toggle").html("See your progress")});a(".quality_score.help_icon").each(function(e){var f=a(this);var d=f.attr("rel");var c=a("#progress_help_"+d).first();if(!f.closest("li").hasClass("completed")&&c.length){f.show().click(function(g){Squidoo.modal("#progress_help_"+d);g.preventDefault();return false});c.find(".close_bar a").first().click(function(g){c.hide();a("#default_onion").hide();g.preventDefault();return false})}else{f.hide()}});a("#dismiss_100_graphic").click(function(c){$container=a(this).closest(".progress_wrap");lens_id=a(this).attr("rel");a.get("/lensmaster/ajax_dismiss_graphic/"+lens_id,null,function(){$container.slideUp()});c.preventDefault();return false});if(a(".progress_list").attr("rel")=="newbie"){a(".progress_toggle").trigger("click")}}};a(window).bind("afterSaveModule",ProgressBar.update);a(window).bind("afterEditLensTOC",ProgressBar.update);a(window).bind("afterResetWorkshop",ProgressBar.update)})(jQuery);