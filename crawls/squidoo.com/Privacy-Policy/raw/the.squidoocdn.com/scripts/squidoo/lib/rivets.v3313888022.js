(function(){var f,h,a,e,c,b=function(i,j){return function(){return i.apply(j,arguments)}},g=[].slice,d=[].indexOf||function(m){for(var k=0,j=this.length;k<j;k++){if(k in this&&this[k]===m){return k}}return -1};f={};if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}f.Binding=(function(){function i(j,p,l,m,r){var n,o,q,k;this.el=j;this.type=p;this.model=l;this.keypath=m;this.options=r!=null?r:{};this.unbind=b(this.unbind,this);this.bind=b(this.bind,this);this.publish=b(this.publish,this);this.sync=b(this.sync,this);this.set=b(this.set,this);this.formattedValue=b(this.formattedValue,this);if(!(this.binder=f.binders[p])){k=f.binders;for(n in k){q=k[n];if(n!=="*"&&n.indexOf("*")!==-1){o=new RegExp("^"+(n.replace("*",".+"))+"$");if(o.test(p)){this.binder=q;this.args=new RegExp("^"+(n.replace("*","(.+)"))+"$").exec(p);this.args.shift()}}}}this.binder||(this.binder=f.binders["*"]);if(this.binder instanceof Function){this.binder={routine:this.binder}}this.formatters=this.options.formatters||[]}i.prototype.formattedValue=function(r){var p,s,j,n,q,o,m,l,k;o=this.formatters;for(n=0,q=o.length;n<q;n++){s=o[n];p=s.split(/\s+/);j=p.shift();s=this.model[j] instanceof Function?this.model[j]:((m=this.options)!=null?(l=m.bindingOptions)!=null?(k=l.formatters)!=null?k[j]:void 0:void 0:void 0) instanceof Function?this.options.bindingOptions.formatters[j]:f.formatters[j];if((s!=null?s.read:void 0) instanceof Function){r=s.read.apply(s,[r].concat(g.call(p)))}else{if(s instanceof Function){r=s.apply(null,[r].concat(g.call(p)))}}}return r};i.prototype.set=function(k){var j;k=k instanceof Function&&!this.binder["function"]?this.formattedValue(k.call(this.model)):this.formattedValue(k);return(j=this.binder.routine)!=null?j.call(this,this.el,k):void 0};i.prototype.sync=function(){return this.set(this.options.bypass?this.model[this.keypath]:f.config.adapter.read(this.model,this.keypath))};i.prototype.publish=function(){var o,r,j,q,m,p,n,l,k;q=e(this.el);n=this.formatters.slice(0).reverse();for(m=0,p=n.length;m<p;m++){r=n[m];o=r.split(/\s+/);j=o.shift();if((l=f.formatters[j])!=null?l.publish:void 0){q=(k=f.formatters[j]).publish.apply(k,[q].concat(g.call(o)))}}return f.config.adapter.publish(this.model,this.keypath,q)};i.prototype.bind=function(){var j,q,p,n,r,o,m,k,l;if((o=this.binder.bind)!=null){o.call(this,this.el)}if(this.options.bypass){this.sync()}else{f.config.adapter.subscribe(this.model,this.keypath,this.sync);if(f.config.preloadData){this.sync()}}if((m=this.options.dependencies)!=null?m.length:void 0){k=this.options.dependencies;l=[];for(n=0,r=k.length;n<r;n++){j=k[n];if(/^\./.test(j)){p=this.model;q=j.substr(1)}else{j=j.split(".");p=this.view.models[j.shift()];q=j.join(".")}l.push(f.config.adapter.subscribe(p,q,this.sync))}return l}};i.prototype.unbind=function(){var j,q,p,n,r,o,m,k,l;if((o=this.binder.unbind)!=null){o.call(this,this.el)}if(!this.options.bypass){f.config.adapter.unsubscribe(this.model,this.keypath,this.sync)}if((m=this.options.dependencies)!=null?m.length:void 0){k=this.options.dependencies;l=[];for(n=0,r=k.length;n<r;n++){j=k[n];if(/^\./.test(j)){p=this.model;q=j.substr(1)}else{j=j.split(".");p=this.view.models[j.shift()];q=j.join(".")}l.push(f.config.adapter.unsubscribe(p,q,this.sync))}return l}};return i})();f.View=(function(){function i(k,l,j){this.els=k;this.models=l;this.options=j;this.publish=b(this.publish,this);this.sync=b(this.sync,this);this.unbind=b(this.unbind,this);this.bind=b(this.bind,this);this.select=b(this.select,this);this.build=b(this.build,this);this.bindingRegExp=b(this.bindingRegExp,this);if(!(this.els.jquery||this.els instanceof Array)){this.els=[this.els]}this.build()}i.prototype.bindingRegExp=function(){var j;j=f.config.prefix;if(j){return new RegExp("^data-"+j+"-")}else{return/^data-/}};i.prototype.build=function(){var j,l,m,o,t,q,p,u,k,r,n,s=this;this.bindings=[];t=[];j=this.bindingRegExp();o=function(R){var K,G,H,O,A,S,J,C,T,F,P,E,M,U,N,Y,L,D,Q,y,w,v,V,X,W,I,B,z,x;if(d.call(t,R)<0){I=R.attributes;for(y=0,V=I.length;y<V;y++){K=I[y];if(j.test(K.name)){D=K.name.replace(j,"");if(!(H=f.binders[D])){B=f.binders;for(C in B){Q=B[C];if(C!=="*"&&C.indexOf("*")!==-1){Y=new RegExp("^"+(C.replace("*",".+"))+"$");if(Y.test(D)){H=Q}}}}H||(H=f.binders["*"]);if(H.block){z=R.getElementsByTagName("*");for(w=0,X=z.length;w<X;w++){P=z[w];t.push(P)}G=[K]}}}x=G||R.attributes;for(v=0,W=x.length;v<W;v++){K=x[v];if(j.test(K.name)){E={};if((s.options!=null)&&typeof s.options==="object"){E.bindingOptions=s.options}D=K.name.replace(j,"");N=(function(){var aa,ac,ab,Z;ab=K.value.split("|");Z=[];for(aa=0,ac=ab.length;aa<ac;aa++){U=ab[aa];Z.push(U.trim())}return Z})();A=(function(){var aa,ac,ab,Z;ab=N.shift().split("<");Z=[];for(aa=0,ac=ab.length;aa<ac;aa++){S=ab[aa];Z.push(S.trim())}return Z})();M=A.shift();L=M.split(/\.|:/);E.formatters=N;E.bypass=M.indexOf(":")!==-1;if(L[0]){F=s.models[L.shift()]}else{F=s.models;L.shift()}T=L.join(".");if(F){if(J=A.shift()){E.dependencies=J.split(/\s+/)}O=new f.Binding(R,D,F,T,E);O.view=s;s.bindings.push(O)}}}if(G){G=null}}};r=this.els;for(q=0,u=r.length;q<u;q++){l=r[q];o(l);n=l.getElementsByTagName("*");for(p=0,k=n.length;p<k;p++){m=n[p];if(m.attributes!=null){o(m)}}}};i.prototype.select=function(l){var o,n,k,m,j;m=this.bindings;j=[];for(n=0,k=m.length;n<k;n++){o=m[n];if(l(o)){j.push(o)}}return j};i.prototype.bind=function(){var n,m,k,l,j;l=this.bindings;j=[];for(m=0,k=l.length;m<k;m++){n=l[m];j.push(n.bind())}return j};i.prototype.unbind=function(){var n,m,k,l,j;l=this.bindings;j=[];for(m=0,k=l.length;m<k;m++){n=l[m];j.push(n.unbind())}return j};i.prototype.sync=function(){var n,m,k,l,j;l=this.bindings;j=[];for(m=0,k=l.length;m<k;m++){n=l[m];j.push(n.sync())}return j};i.prototype.publish=function(){var n,m,k,l,j;l=this.select(function(o){return o.binder.publishes});j=[];for(m=0,k=l.length;m<k;m++){n=l[m];j.push(n.publish())}return j};return i})();h=function(l,m,k,i){var j;j=function(n){return k.call(i,n)};if(window.jQuery!=null){l=jQuery(l);if(l.on!=null){l.on(m,j)}else{l.bind(m,j)}}else{if(window.addEventListener!=null){l.addEventListener(m,j,false)}else{m="on"+m;l.attachEvent(m,j)}}return j};c=function(j,k,i){if(window.jQuery!=null){j=jQuery(j);if(j.off!=null){return j.off(k,i)}else{return j.unbind(k,i)}}else{if(window.removeEventListener){return j.removeEventListener(k,i,false)}else{k="on"+k;return j.detachEvent(k,i)}}};e=function(k){var m,l,j,i;if(window.jQuery!=null){k=jQuery(k);switch(k[0].type){case"checkbox":return k.is(":checked");default:return k.val()}}else{switch(k.type){case"checkbox":return k.checked;case"select-multiple":i=[];for(l=0,j=k.length;l<j;l++){m=k[l];if(m.selected){i.push(m.value)}}return i;break;default:return k.value}}};f.binders={enabled:function(i,j){return i.disabled=!j},disabled:function(i,j){return i.disabled=!!j},checked:{publishes:true,bind:function(i){return this.currentListener=h(i,"change",this.publish)},unbind:function(i){return c(i,"change",this.currentListener)},routine:function(i,k){var j;if(i.type==="radio"){return i.checked=((j=i.value)!=null?j.toString():void 0)===(k!=null?k.toString():void 0)}else{return i.checked=!!k}}},unchecked:{publishes:true,bind:function(i){return this.currentListener=h(i,"change",this.publish)},unbind:function(i){return c(i,"change",this.currentListener)},routine:function(i,k){var j;if(i.type==="radio"){return i.checked=((j=i.value)!=null?j.toString():void 0)!==(k!=null?k.toString():void 0)}else{return i.checked=!k}}},show:function(i,j){return i.style.display=j?"":"none"},hide:function(i,j){return i.style.display=j?"none":""},html:function(i,j){return i.innerHTML=j!=null?j:""},value:{publishes:true,bind:function(i){return this.currentListener=h(i,"change",this.publish)},unbind:function(i){return c(i,"change",this.currentListener)},routine:function(j,r){var i,n,q,p,m,k,l;if(window.jQuery!=null){j=jQuery(j);if((r!=null?r.toString():void 0)!==((p=j.val())!=null?p.toString():void 0)){return j.val(r!=null?r:"")}}else{if(j.type==="select-multiple"){if(r!=null){l=[];for(n=0,q=j.length;n<q;n++){i=j[n];l.push(i.selected=(m=i.value,d.call(r,m)>=0))}return l}}else{if((r!=null?r.toString():void 0)!==((k=j.value)!=null?k.toString():void 0)){return j.value=r!=null?r:""}}}}},text:function(i,j){if(i.innerText!=null){return i.innerText=j!=null?j:""}else{return i.textContent=j!=null?j:""}},"on-*":{"function":true,routine:function(i,j){if(this.currentListener){c(i,this.args[0],this.currentListener)}return this.currentListener=h(i,this.args[0],j,this.model)}},"each-*":{block:true,bind:function(i,j){return i.removeAttribute(["data",f.config.prefix,this.type].join("-").replace("--","-"))},routine:function(k,v){var D,y,z,B,x,w,s,u,p,j,i,A,E,C,t,r,q,o,l;if(this.iterated!=null){t=this.iterated;for(p=0,A=t.length;p<A;p++){u=t[p];u.unbind();r=u.els;for(j=0,E=r.length;j<E;j++){y=r[j];y.parentNode.removeChild(y)}}}else{this.marker=document.createComment(" rivets: "+this.type+" ");k.parentNode.insertBefore(this.marker,k);k.parentNode.removeChild(k)}this.iterated=[];if(v){l=[];for(i=0,C=v.length;i<C;i++){z=v[i];D={};q=this.view.models;for(w in q){x=q[w];D[w]=x}D[this.args[0]]=z;B=k.cloneNode(true);s=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker;this.marker.parentNode.insertBefore(B,(o=s.nextSibling)!=null?o:null);u=new f.View(B,D);u.bind();l.push(this.iterated.push(u))}return l}}},"class-*":function(i,k){var j;j=" "+i.className+" ";if(!k===(j.indexOf(" "+this.args[0]+" ")!==-1)){return i.className=k?""+i.className+" "+this.args[0]:j.replace(" "+this.args[0]+" "," ").trim()}},"*":function(i,j){if(j){return i.setAttribute(this.type,j)}else{return i.removeAttribute(this.type)}}};f.config={preloadData:true};f.formatters={};a=function(i){i.binders=f.binders;i.formatters=f.formatters;i.config=f.config;i.configure=function(j){var l,k;if(j==null){j={}}for(l in j){k=j[l];f.config[l]=k}};return i.bind=function(l,m,k){var j;if(m==null){m={}}if(k==null){k={}}j=new f.View(l,m,k);j.bind();return j}};if(typeof exports==="object"){a(exports)}else{if(typeof define==="function"&&define.amd){define(["exports"],function(i){a(this.rivets=i);return i})}else{a(this.rivets={})}}}).call(this);