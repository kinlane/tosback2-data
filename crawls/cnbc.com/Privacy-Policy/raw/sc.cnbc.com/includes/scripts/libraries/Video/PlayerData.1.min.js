
var CNBC_PlayerData=function(){};(function($){CNBC_PlayerData.prototype.serviceUrl="http://www.cnbc.com/vapi/videoservice/rssvideosearch.do";CNBC_PlayerData.prototype.jsonpCallback='jsonPlayerData';CNBC_PlayerData.prototype.searchindex=1;CNBC_PlayerData.prototype._data={};CNBC_PlayerData.prototype.init=function(args){args=args||{};if(args.partnerId){this.partnerId=args.partnerId;this._setCallback(args);this._initData(args.vid);}};CNBC_PlayerData.prototype._setCallback=function(args){if(args.dataCompleteCallback&&args.callbackContext){this.cb_dataComplete=args.dataCompleteCallback;this.cb_context=args.callbackContext;}};CNBC_PlayerData.prototype.initPageSource=function(){var source="External";var ref=document.referrer;if(ref!=''){var internal_ref=ref.indexOf('.cnbc.com/');if(internal_ref!='-1'){source="Internal";}};this._setPageSource(source);};CNBC_PlayerData.prototype._setPageSource=function(source){this._source=source;};CNBC_PlayerData.prototype._initData=function(vid){var self=this;$.ajax({url:self.serviceUrl,data:{action:'videos',partnerId:self.partnerId,output:'jsonp',searchindex:self.searchindex,ids:vid},dataType:'jsonp',jsonpCallback:self.jsonpCallback,success:function(data){self.structureData(data)}});};CNBC_PlayerData.prototype._updateVideoJSONData=function(data){data=data||{};this.initPageSource();var id=data["metadata:id"]||"0000000000";var metaLink=this.setMetaData(data["metadata:formatLink"]);var extendedCatagories=this.setCategories();var dataObj=this.setData(data,id,metaLink,extendedCatagories);dataObj.relatedVideos=this.setRelatedVideos(dataObj);this.jsonVidObj=this.setVidJSON(this._source,"","",dataObj);return this.jsonVidObj;};CNBC_PlayerData.prototype.setMetaData=function(data){var metaLink=[];if(typeof data=="object"){var flinks=data;for(var j=0,len=flinks.length;j<len;++j){data=flinks[j];if(data.indexOf('mpeg4_500000_Streaming')!=-1){metaLink.push(data);}else if(data.indexOf('flv_500000_Streaming')!=-1){metaLink.push(data);};};}else if(typeof data=="string"){if(data.indexOf('mpeg4_500000_Streaming')!=-1){metaLink.push(data);}else if(data.indexOf('flv_500000_Streaming')!=-1){metaLink.push(data);};}
return metaLink;};CNBC_PlayerData.prototype.setCategories=function(data){data=data||{};return[{id:data.id||"",value:(data.content)?data.content.toUpperCase():"Keywords",truncatedValue:data.truncatedValue||"generic",type:data.type||"CNBC"}];};CNBC_PlayerData.prototype.setData=function(data,id,meta,categories){data=data||{};var dtProtectType=CNBC_domTools().protectType;return{title:dtProtectType(data.title,"string"),referer:window.location.href,pubDate:dtProtectType(data.pubDate,"string"),id:dtProtectType(id,"string"),show:(typeof data["metadata:show"]==="string")?data["metadata:show"].toUpperCase():'',viewmode:dtProtectType(data["metadata:viewmode"],"string"),network:this._getRegion(data["metadata:network"])||'',duration:dtProtectType(data["metadata:duration"],"string"),formatLink:meta.join(",")||'',link:dtProtectType(data.link,"string"),guid:dtProtectType(data.guid["content"],"string"),description:dtProtectType(data.description,"string"),largeThumbnailURL:dtProtectType(data["metadata:largeThumbnailURL"],"string"),thumbnail:dtProtectType(data["metadata:largeThumbnailURL"],"string"),smallThumbnailURL:dtProtectType(data["metadata:smallThumbnailURL"],"string"),categories:categories};};CNBC_PlayerData.prototype.setRelatedVideos=function(data){data=data||{};return[{id:data.id,pubDate:data.pubDate,title:data.title,largeThumbnailURL:data.largeThumbnailURL,smallThumbnailURL:data.smallThumbnailURL,link:data.link,description:data.description}];};CNBC_PlayerData.prototype.setVidJSON=function(source,keyword,ticker,data){return{pageSource:source,internalSearchKeyword:keyword||'',ticker:ticker||'',data:data||{}};};CNBC_PlayerData.prototype._getRegion=function(reg){var region='';switch(reg.toUpperCase()){case'CNBC US':region="us";break;case'CNBC ASIA':region="as";break;case'CNBC EUROPE':region="eu";break;default:region='us';break;};return region;};CNBC_PlayerData.prototype.structureData=function(results){var rss=(((results||{}).rss||{}).channel||{}).item||false;if(rss){this._data=this._updateVideoJSONData(rss);};this._dataComplete();};CNBC_PlayerData.prototype._dataComplete=function(){if(this.cb_dataComplete){this.cb_dataComplete.call(this.cb_context);}};CNBC_PlayerData.prototype.getData=function(){return this._data;};})(jQuery);