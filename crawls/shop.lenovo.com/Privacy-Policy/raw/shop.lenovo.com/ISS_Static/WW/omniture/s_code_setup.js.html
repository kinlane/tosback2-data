// s_code_setup.js
// Copyright 2012 Adobe Systems, Inc. All Rights Reserved.
// More info available at http://www.omniture.com
// UPDATED: 12-Nov-2012
var s_fileVer='121017c';

if(typeof window.lmd!='object')var lmd={};
s_def(window.location.href,'s_url');
var s_url=lmd.xDomainURL||lmd.URL||s_url;
var s_duplicateLoad=!!window.s_code_setup_ver&&window.s_urlsave&&window.s_urlsave==window.s_url;

if(!s_duplicateLoad){

	/************************** CONFIG SECTION **************************/

	s_def(false,'s_dev'); //use dev suite?
	if(window.location.hostname.indexOf('leni2')>-1)s_dev=true;

	/* Create Lenovo Meta Data Object if needed */
	s_def('',lmd,'teleAccount');
	s_def('',lmd,'teleCookieName');
	s_def('',lmd,'reportSuites');
	s_def('',lmd,'businessType');

	/* Assigned page URL */
	s_def(lmd.xDomainURL||lmd.URL||window.s_url||window.location.href,'s_url'); //nominal URL
	var s_urlsave=s_url; //used to detect duplicate loads of this file

	/* JS info */
	try{s_code_setup_ver=s_jsFileInfo('s_code_setup')||'s_code_setup';s_clog('page '+s_url);s_clog('s_code_setup '+s_code_setup_ver.ver+' '+s_code_setup_ver.url);}catch(e){}

	s_getLoadTime(); //used to calculate page load time

	/* Default Internal Filters List */
	s_def(s_linkInternalFilters= 'javascript:,lenovo.com,306.ibm.com/common/ssi/fcgi-bin/ssialias*appn,9.179.20.57/lenovoinfo,900.ibm.com/lenovoinfo,br.ibm.com/lenovoinfo/,caipsgws001.can.ibm.com,experiencelenovo.com,franklin-lenovo.staging,ibm.com/lenovoinfo/products/hardware/configur,icm1.teleweb.ca.ibm.com,insidelenovo.com,lenovo.co.,lenovovision.com,mkm.can.ibm.com/lenovoinfo/,phoenix1.br.ibm.com,service.pageshare.com,shoplenovo.i2.com,www-06.ibm.com,www-07.ibm.com/lenovoinfo,www-1.ibm.com/lenovoinfo,www-1.ibm.com/products/hardware/configurator,www-131.ibm.com,www-133.ibm.com,www-1test.ibm.com/lenovoinfo,www-307.ibm.com/pc/support,www-604.ibm.com,www-8.ibm.com,www-903.ibm.com/kr/support/pc,www.pc.ibm.com,www5.pc.ibm.com,zoomerang.com,opinionlab.com','s_linkInternalFilters');

	/* error page flags */
	s_def(lmd.pageType,'s_errorPage');
	s_def(lmd.errorReferrer,'s_errorRef');

	/* RSID vars */
	var mapFrCC='uk,af,bh,cy,eg,ps,ir,iq,kw,lb,ly,om,pk,qa,sa,sy,ae,ye,jo', //Country code mapping: Map from
			mapToCC='gb,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp,mp'; //Country code mapping: Map to
	var s_findCCadd='uk,mp'; //list of non ISO-standard country codes
	var s_ldtRSID='lenovouspubgomez'; //load test RSID

	var s_mapv=null; //To become url map object
	var s_P=null; //To become Pathing object

	/*************** DETERMINE S_ACCOUNT AND LOAD S_CODE ****************/

	if(!(window.s_map instanceof Array))makeMap();
	if(!window.s_duplicateLoad||typeof s_mapv!='object')setAcc();
	try{if(s_mapv.Ljs&&!window.s_code_lisa_ver)s_loadJS(s_mapv.Ljs)}catch(e){}
	try{if(s_mapv.sjs&&!window.s_code_section_ver)s_loadJS(s_mapv.sjs)}catch(e){}
	try{if(s_mapv.ljs&&!window.s_code_ver)s_loadJS(s_mapv.ljs)}catch(e){s_loadJS('//shop.lenovo.com/ISS_Static/WW/omniture/s_code_lenovo.js')}

}


/************************* CUSTOM FUNCTIONS *************************/

function makeMap(){

	try{
		var hn=s_parseUri(s_url).hostname,
			hnSp=hn.split('.'),
			pathJS='//shop.lenovo.com/ISS_Static/WW/omniture/',
			dotcHN='lenovo\\.com',
			outlRE='^outlet([a-zA-Z]{2})?\\.([a-zA-Z]{2}\\.)?'+dotcHN,
			dotcRE='^([^/]*)'+dotcHN,
			suppRE='^([^/]*)support\\.lenovo\\.com/',
			betaRE='^([^/]*)beta\\.lenovo\\.com/',
			newsRE='^([^/]*)news\\.lenovo\\.com/',
			lpneRE='^([^/]*)partnerinfo\\.lenovo\\.com/',
			shopRE='^shop(ap)?\\.lenovo\\.com',
			opslRE='^([^/]*)len[a-zA-Z0-9]+\\.com/[^?]*.*[?&]cid=ops_load';

		s_map=[

		/* start of URLs on lenovo.com subdomains */

		{ defaults:true,
			desc:'Defaults|',
			ljs:pathJS+'s_code_lenovo.js',
			Ljs:pathJS+'s_code_lisa.js',
			sjs:'',
			acc:'lenovo~pub',
			aFO:true,
			sec:'corporate'},

		{	desc:'OpsLoad|*len*.com*?cid=ops_load',
			urls:opslRE+'',
			acc:s_ldtRSID,
			sec:'loadtest'},

		{	desc:'Beta|*beta.lenovo.com*',
			urls:betaRE+'',
			acc:'lenovobeta',
			sec:'beta'},

		{	desc:'Products-2|shop[ap].lenovo.com/cc/products/*',
			urls:shopRE+'/([a-zA-Z]{2})/products/',
			sjs:pathJS+'s_code_section_learnshop.js',
			sec:'learn'},

		{	desc:'Products-3|shop[ap].lenovo.com/?????/cc/lc[/learn]/products*',
			urls:shopRE+'/[a-zA-Z]{5}/([a-zA-Z]{2})(/[a-zA-Z]{2})/(learn/|)products/',
			sjs:pathJS+'s_code_section_learnshop.js',
			sec:'learn'},

		{	desc:'Products-4|shop[ap].lenovo.com/cc/lc/products/*',
			urls:shopRE+'/([a-zA-Z]{2})(/[a-zA-Z]{2})/products/',
			sjs:pathJS+'s_code_section_learnshop.js',
			sec:'learn'},

		{	desc:'OVP-1|*ovp.lenovo.com/',
			urls:'^([^/]*)ovp\\.lenovo\\.com/',
			sjs:pathJS+'s_code_section_ovp.js',
			acc:'lenovoglobal',
			sec:'ovp'},

		{	desc:'Shop-1|shop[ap].lenovo.com/?????/cc/lc/*',
			urls:shopRE+'/[a-zA-Z]{5}/([a-zA-Z]{2})(/[a-zA-Z]{2})/',
			sjs:pathJS+'s_code_section_shop.js',
			sec:'shop'},

		{	desc:'Shop-2|shop[ap].lenovo.com/cc/*',
			urls:shopRE+'/([a-zA-Z]{2})/',
			sjs:pathJS+'s_code_section_shop.js',
			sec:'shop'},

		{	desc:'Shop-3|shop[ap].lenovo.com/SEUILibrary/controller/e/*/*Portal/lc_CC/*',
			urls:shopRE+'/SEUILibrary/controller/e/[^/]+/[a-zA-Z]+Portal/([a-zA-Z]{2})_([a-zA-Z]{2})/',
			sjs:pathJS+'s_code_section_shop.js',
			sec:'shop'},

		{	desc:'Support-1|*support.lenovo.com/',
			urls:suppRE,
			sec:'support'},

		{	desc:'News|*news.lenovo.com/',
			urls:newsRE,
			sjs:pathJS+'s_code_section_news.js',
			sec:'corporate'},

		{	desc:'LPN|*partnerinfo.lenovo.com/',
			urls:lpneRE,
			sjs:pathJS+'s_code_section_lpn.js',
			sec:'partner'},

		{	desc:'Outlet-3|outlet[ap].lenovo.com/*',
			urls:outlRE,
			sjs:pathJS+'s_code_section_shop.js',
			acc:'lenovo~outlet',
			sec:'outlet'},

		/* start of URLs on the lenovo.com domain */

		{	desc:'Shop-4|*lenovo.com/SEUILibrary/controller/e/*/*Portal/lc_CC/*',
			urls:dotcRE+'/SEUILibrary/controller/e/[^/]+/[^/]+/([a-zA-Z]{2})_([a-zA-Z]{2})/',
			sjs:pathJS+'s_code_section_shop.js',
			sec:'shop'},

		{	desc:'Products-1|*lenovo.com/products/cc/*',
			urls:dotcRE+'/products/([a-zA-Z]{2})/',
			sec:'learn'},

		{	desc:'Outlet-1|*lenovo.com/cc/outlet/*',
			urls:dotcRE+'/([a-zA-Z]{2})outlet/',
			sjs:pathJS+'s_code_section_shop.js',
			acc:'lenovo~outlet',
			cc:'$2',
			sec:'outlet'},

		{	desc:'Outlet-2|*lenovo.com/outlet_cc/*',
			urls:dotcRE+'[^?]*/outlet_([a-zA-Z]{2})/',
			sjs:pathJS+'s_code_section_shop.js',
			acc:'lenovo~outlet',
			cc:'$2',
			sec:'outlet'},

		{	desc:'Services-1|*lenovo.com[/lc]/services_warranty/',
			urls:dotcRE+'(/[a-zA-Z]{2})?/services_warranty/',
			sjs:pathJS+'s_code_section_services.js',
			sec:'services'},

		{	desc:'Services-2|*lenovo.com[/lc]/PremiumSupport/',
			urls:'^([^/]*)\\.lenovo\\.com(/[a-zA-Z]{2})?/PremiumSupport/',
			sjs:pathJS+'s_code_section_services.js',
			sec:'services'},

		{	desc:'Dotcom-1|*lenovo.com*',
			urls:dotcRE+'',
			sec:'corporate'},

		{	desc:'Microsite-1|(non-lenovo.com)',
			urls:'',
			sec:'microsite',
			msf:true}

		];

	}catch(e){s_map=[{ defaults:true,
			desc:'Defaults|',
			ljs:'//shop.lenovo.com/ISS_Static/WW/omniture/s_code_lenovo.js',
			Ljs:'//shop.lenovo.com/ISS_Static/WW/omniture/s_code_lisa.js',
			sjs:'',
			acc:'lenovo~pub',
			aFO:true,
			sec:'corporate'},
		
		{	desc:'Dotcom-1|*lenovo.com*',
			urls:'^([^/]*)lenovo\\.com',
			sec:'corporate'},
		]};
}

/*
 * Set s_account
 */
function setAcc(){

	var er=' ', //for error logging to console
		errRSID='lenovoglobalerrors', //error RSID
		devRSID='lenovoglobaldev', //default dev RSID
		devRSIDsfx='dev', //dev suffix
		outletFrRSID='lenovousoutlet,lenovogboutlet', //Outlet store: Map from
		outletToRSID='lenovoagoutlet,lenovoukoutlet', //Outlet store: Map to
		RSIDs='' //List of valid RSIDs
+'lenovo2008,lenovoaepub,lenovoagle,lenovoaglpn,lenovoagmidmkt,lenovoagoutlet,lenovoagpubsec,lenovoagsalesintranet,lenovoamericas,lenovoamericasdev,lenovoamericasmi,lenovoapaffinity,lenovoapepp,lenovoapesite,lenovoaple,lenovoaplpn,lenovoapmidmkt,lenovoappubsec,lenovoaraffinity,lenovoarepp,lenovoarpub,lenovoartele,lenovoatcepp,lenovoatctobp,lenovoatepp,lenovoatlpn,lenovoatpub,lenovoauaffinity,lenovoauepp,lenovoaulpn,lenovoaupub,lenovoautele,lenovobchannels,lenovobdpub,lenovobelpn,lenovobepub,lenovobeta,lenovobgpub,lenovoblogs,lenovobopub,lenovobraffinity,lenovobrepp,lenovobrlpn,lenovobrpub,lenovobrtele,lenovocaaffinity,lenovocaepp,lenovocaffinity,lenovocalpn,lenovocapub,lenovocatele,lenovochlpn,lenovochpub,lenovocislpn,lenovoclpub,lenovocnesupport,lenovocnpub,lenovocoaffinity,lenovocoepp,lenovoconsumeresupport,lenovocopub,lenovocotele,lenovocspub,lenovoculturecompass,lenovoczlpn,lenovoczpub,lenovodeaffinity,lenovodecepp,lenovodeepp,lenovodelpn,lenovodeoutlet,lenovodepub,lenovodklpn,lenovodkpub,lenovoecpub,lenovoedm,lenovoeelpn,lenovoemea,lenovoemeaaffinity,lenovoemeaepp,lenovoemeale,lenovoemealpn,lenovoemeamidmkt,lenovoemeapubsec,lenovoemergingmicro,lenovoemployeedirectory,lenovoeprizelpn,lenovoeslpn,lenovoespub,lenovoestacoeslenovobr,lenovoesupporten,lenovoesupportjp,lenovoesupportkr,lenovofilpn,lenovofipub,lenovoforums,lenovofraffinity,lenovofrcepp,lenovofrepp,lenovofrlpn,lenovofroutlet,lenovofrpub,lenovofunfactordev,lenovogbpub,lenovogbpubdev,lenovogbtele,lenovoglobal,lenovoglobaldev,lenovoglobalerrors,lenovogrpub,lenovohitecholympics,lenovohkepp,lenovohkpub,lenovohrpub,lenovohrsite,lenovohupub,lenovoidpub,lenovoieaffinity,lenovoiecepp,lenovoieepp,lenovoielpn,lenovoieoutlet,lenovoiepub,lenovoiepubdev,lenovoillpn,lenovoilpub,lenovoinepp,lenovoinpub,lenovointernalblogs,lenovoitlpn,lenovoitpub,lenovojpclub,lenovojpepp,lenovojplpn,lenovojpoutlet,lenovojppub,lenovojptele,lenovokrepp,lenovokrpub,lenovolapub,lenovole,lenovoledev,lenovolenovoegpub,lenovolenovomxepp,lenovolenovonecpub,lenovolenovonecpubdev,lenovolenovonecpubtele,lenovolenovospider,lenovolkpub,lenovolts,lenovoltsdev,lenovomalpn,lenovomelpn,lenovometrocompaniondev,lenovometroexperiencedev,lenovometrosupportdev,lenovomppub,lenovomxaffinity,lenovomxepp,lenovomxpub,lenovomxtele,lenovomypub,lenovonextjump,lenovonity,lenovonllpn,lenovonlpub,lenovonolpn,lenovonopub,lenovonzaffinity,lenovonzepp,lenovonzlpn,lenovonzpub,lenovoolympicportal,lenovoomnitureteststore,lenovopedia,lenovopepub,lenovophpub,lenovopllpn,lenovoplpub,lenovoptlpn,lenovoptpub,lenovopypub,lenovorel,lenovoropub,lenovorspub,lenovorulpn,lenovorupub,lenovosandbox,lenovosapub,lenovosbb,lenovosbpstore,lenovosbpstoredev,lenovoselpn,lenovosepub,lenovosgepp,lenovosgpub,lenovosimpletapdev,lenovosimpletapprod,lenovosipub,lenovoskpub,lenovosocialmonitoring,lenovospider,lenovotest2010,lenovotestalp20110929,lenovothpub,lenovotrlpn,lenovotrpub,lenovotvtlenovosolutionscenterprod,lenovotvtlenovowelcomeprod,lenovotwepp,lenovotwitter,lenovotwpub,lenovoualpn,lenovouapub,lenovoukaffinity,lenovoukbp,lenovoukcepp,lenovoukepp,lenovoukepp2,lenovouklpn,lenovoukoutlet,lenovoukpub,lenovous108375433,lenovousbp,lenovousbpstore,lenovousepp,lenovouslpn,lenovousmobile,lenovousorderstatus,lenovousoutbound,lenovouspersonalpages,lenovouspub,lenovouspubdev,lenovouspubgomez,lenovoustele,lenovouypub,lenovovepub,lenovovision,lenovovnpub,lenovow3,lenovow3emea,lenovowwintranet,lenovowwlpn,lenovowwlpndev,lenovowwmidmkt,lenovowwpub,lenovowwpubsec,lenovoxcpub,lenovoxepub,lenovoxmpub,lenovozapub';
	/* Determine if we're in a load test visit */
	var onLoadTest=function(){
		var r=0;
		if((s_account==s_ldtRSID)||(!s_getVisitStart()&&s_c_r('s_ldtv')=='T')){
			r=1;
			s_c_w('s_ldtv','T');
		}
		return r;
	};

	try{

		var sah=window.s_account?' >pg> '+s_account:''; //for console logging

		s_def('s_account');

		/* create map value object */
		s_mapv=s_mapURLs(s_map,s_url); //set s_mapv object from url lookup
		s_mapv.noT=window.s_noT||false; //no T call?
		s_mapv.Protocol=s_parseUri(s_url).protocol; //page's protocol

		/* (re)create Pathing object */
		if(window.s_P)delete window.s_P;
		s_P=new Object();

		/* Look for cc and lc in meta data */
		s_mapv.cc=s_LC(s_scrubWS(
				s_getHTMLtag('meta','name','Lenovo.Country','content')
			||s_getHTMLtag('meta','name','country','content')
			||s_getHTMLtag('meta','name','geo.region','content')
			||lmd.country));
		if(s_mapv.cc)s_mapv.cc=s_matchList(s_mapv.cc,mapFrCC,mapToCC); //map cc if needed
		s_mapv.lc=s_LC(s_scrubWS(
				s_getHTMLtag('meta','name','Lenovo.Language','content')
			||s_getHTMLtag('meta','name','DC.Language','content')
			||s_getHTMLtag('meta','name','language','content')
			||lmd.language));
		if(s_mapv.lc.length>2)s_mapv.lc=s_mapv.lc.substring(0,2);
		if(s_mapv.cc.length!=2)s_mapv.cc='';

		/* Look for cc and lc in url in case it wasn't in the meta data */
		pullLocaleFromPath(); //create s_P object, setting s_P.cc and s_P.lc from url if not found in meta data

		if(onErrorPage()){ //on error page?

			s_restoreAcc();
			s_account+=(s_account?',':'')+errRSID;
			sah+=' >err> '+s_account;

		}else if(lmd.xDomainAcc){ //cross-domain s_account?

			s_account=lmd.xDomainAcc;
			if(s_account)sah+=' >xd> '+s_account;

		}else{

			var bt=s_LC(lmd.businessType||''); //server-side business type, may be needed to set s_account
			if(!s_account||s_mapv.aFO){  //set s_account if not already set or force override true
				/* Handle special cases */
				if(lmd.teleAccount&&lmd.teleCookieName&&s_c_r(lmd.teleCookieName)){ //Telesales?
					s_account=lmd.teleAccount;
					sah+=' >tel> '+s_account;
				}else if(bt=='affinity'||bt=='epp'||bt=='le'||bt=='partner'||lmd.reportSuites.indexOf('lenovojpclub')>-1){ //Affinity, EPP, LE, BP, or JP Club?
					s_account=lmd.reportSuites;
					sah+=' >spc> '+s_account;
					s_mapv.sec=bt;
				}else if(bt=='largepartner'){
					s_account=errRSID;
				}else{ //Standard lookup
					s_account=s_LC(s_mapv.acc);
					sah+=' >'+s_mapv.Match+':'+s_mapv.desc+'> '+s_account;
					if(s_account.indexOf('~')>-1){
						s_account=s_account.replace(/~/g,s_mapv.cc);
						sah+=' >~cc> '+s_account;
					}
					var mr=s_matchList(s_account,outletFrRSID,outletToRSID);
					if(s_account!=mr){
						s_account=mr;
						sah+=' >mrs> '+s_account;
					}
				}
			}
		}

		/* remove secondary suites */
		if(s_account.indexOf(',')>-1){
			s_account=s_account.replace(/,.*/,'');
			sah+=' >xse> '+s_account;
		}

		/* dev? */
		if(s_dev){
		  if(devRSIDsfx&&s_account.indexOf(devRSIDsfx)<0)s_account=s_account.replace(/,/g,devRSIDsfx+',')+devRSIDsfx;
			sah+=' >dev> '+s_account;
			if(!s_matchList(s_account,RSIDs)){
				s_account=devRSID;
				sah+=' >idv> '+s_account;
			}
		}

		if(onLoadTest()){ //in a load test visit?
			s_account=s_ldtRSID;
			sah+=' >LTV> '+s_account;
		}

		/* valid rsid? */
		if(!s_account||!s_matchList(s_account,RSIDs)){
			s_account=errRSID;
			sah+=' >INV> '+s_account;
		}

	}catch(e){er='!'}
	try{s_clog(er+'s_mapv=',[s_mapv],'\n'+er,'s_account'+sah)}catch(e){s_clog(e.msg)}
	s_saveAcc();
}

/*
 * pullLocaleFromPath - Remove country code and locale from the path; set country code, language code, locale if needed
 */
function pullLocaleFromPath(){

	var CC='',LC='',u=s_url,path=s_P&&s_P.path?s_P.path:scrubPath(urlToPath(u));

	/* Set cc and lc from path if unknown; remove from path */
	var pathSp=s_split(path,':');

	for(var i=0,l=pathSp.length;i>=0&&i<l;i++){
		var j=i,k=i,cc='',lc='';
		cc=s_findCC(pathSp[i]);
		if(cc){ // look for cc:lc or lc:cc or cc
			cc=pathSp[i]=s_matchList(cc,mapFrCC,mapToCC); //map cc if needed
			lc=((i+1)<pathSp.length)?s_findLC(pathSp[i+1]):'';
			if(lc){ //if we found cc:lc
				k=i+2;
			}else{
				lc=(i>0)?s_findLC(pathSp[i-1]):'';
				if(lc){ //if we found lc and cc
					j=i-1;k=i+1;
				}else{ //we just have cc (or just lc)
					k=i+1;
				}
			}
		}else if(pathSp[i].length==5&&pathSp[i].substring(2,3)=='_'){ //if this could be cc_lc
			p1=pathSp[i].substring(0,2),p2=pathSp[i].substring(3,5); //split into p1 and p2
			/* Try to determine if we have cc_lc or lc_cc */
			if(s_findCC(p1)&&s_findLC(p2)){//if we have cc_lc...
				cc=s_matchList(p1,mapFrCC,mapToCC);
				lc=p2;
				k=i+1;
			}else if(s_findLC(p1)&&s_findCC(p2)){//if we have lc_cc...
				cc=s_matchList(p2,mapFrCC,mapToCC);
				lc=p1;
				k=i+1;
			}
		}else if(pathSp[i].length==5&&pathSp[i].substring(2,5)=='web'){ //if this could be CCweb
			p1=pathSp[i].substring(0,2);
			if(s_findCC(p1)){
				cc=s_matchList(p1,mapFrCC,mapToCC);
				k=i+1;
			}
		}
		if(!CC&&cc)CC=cc;
		if(!LC&&lc)LC=lc;
		if(j<k){ //if we need to remove field(s)
			for(m=n=0;n<pathSp.length;n++){
				if(m<j||n>=k){
					pathSp[m++]=pathSp[n];
				}
			}
			while(m<pathSp.length)
				pathSp[m++]='';
			l-=(k-j);
			i=j-1; //reset current index
		}
	}

	/* Use s_mapv.cc and s_mapv.lc if already set, otherwise try to set s_mapv.cc and s_mapv.lc */
	if(s_mapv){

		/* Set s_mapv.cc if needed */
		if(s_mapv.cc){ //if country code not set
			CC=s_mapv.cc;
		}else{
			/* if cc unknown, look in hostname */
			if(!CC){
				var uSp=s_split(s_parseUri(u).hostname,'.');
				for(i=0;!CC&&i<uSp.length;i++)
					CC=s_findCC(uSp[i]);
			}
			if(!CC)CC='us'; //default to U.S.
			s_mapv.cc=CC;
		}

		/* Set s_mpav.lc if needed */
		if(s_mapv.lc){
			LC=s_mapv.lc;
		}else{
			if(!LC)LC='en'; //default to English
			s_mapv.lc=LC;
		}

		if(!s_mapv.locale)s_mapv.locale=s_mapv.cc+'_'+s_mapv.lc;

		/* set s_P.locale, s_P.cc, s_P.lc */
		s_P.locale=s_mapv.cc+'_'+s_mapv.lc; //Set locale
		s_P.cc=s_mapv.cc;
		s_P.lc=s_mapv.lc;

	}

	if(!s_P.locale&&s_P.cc&&s_P.lc)s_P.locale=s_P.cc+'_'+s_P.lc;

	/* Rebuild path string */
	path='';
	for(i=0;i<pathSp.length;i++)
		path+=(path&&pathSp[i]?':':'')+pathSp[i];
	s_P.path=path;
	return s_P;
}

/*
 * Determine if we're on an error page
 */
function onErrorPage(){
	if(!s_errorPage){
		if(window.lenovoCommonErrorpagesStatus)s_errorPage=lenovoCommonErrorpagesStatus;
		if(window.lenovoCommonErrorpagesDesc=='string')s_errorPage+=(s_errorPage?' ':'')+lenovoCommonErrorpagesDesc;
	}
	if(!s_errorPage)s_errorPage=s_getQueryStr('reason');
	return s_errorPage;
}

/*
 * urlToPath - Convert url to path (replace "/" with ":", remove "index.html", etc.)
 */
function urlToPath(u){
	if(u.indexOf('//')<0)u='//'+u;
	if(!u)return '';
	var hn=s_getShortHn(u).replace(/.com$/,'').replace(/\.?lenovo$/,'');
	return s_LC(s_parseUri(u).pathname.replace(/\.html$/,'').replace(/\/index$/,'').replace(/\/$/,'').replace(/^\//,'').replace(/\//g,':'))
}

/*
 * scrubPath - Clean up path (remove spaces, empty fields, etc.)
 */
function scrubPath(path){
	if(!path)return '';
	return s_LC(path.replace(/\s+/g,' ').replace(/\s*:+\s*/g,':').replace(/^[\s:]+/,'').replace(/[\s:]+$/,'').replace(/^home:/,'').replace(/home$/,''));
}


/*
 * Utilities: preSlib v1.29
 */
function s_MC(a,c){try{if(typeof a==null)return a;a=String(a);a=c=='lc'?a.toLowerCase(a):c=='uc'?a.toUpperCase(a):a}catch(e){}return a}
function s_LC(a){return s_MC(a,'lc')}
function s_UC(a){return s_MC(a,'uc')}
function s_scrubWS(t){try{if(t==null)t='';t=t.replace(/^\s+/g,'').replace(/\s+$/g,'').replace(/\s+/g,' ')}catch(e){}return t}
function s_split(l,d){var i,x=0,a=new Array;if(!d)d=',';while(l){i=l.indexOf(d);i=i>-1?i:l.length;a[x++]=l.substring(0,i);l=l.substring(i+d.length)}return a}
function s_getHTMLtag(y){var a='',v='',g='',t='',f=null,c='lc',p=arguments,l=p.length,i;if(!y)return f;if(l>1){i=s_LC(p[l-1]);if(i=='uc'||i=='lc'||i=='mc'){c=i;l--}}y=s_LC(y);if(l==2){g=s_LC(p[1])}else if(l>=3){a=s_LC(p[1]);v=s_MC(p[2],c);if(l>=4)g=s_MC(p[3],c)}if(document.getElementsByTagName)t=document.getElementsByTagName(y);if(typeof t!='object')return f;for(i=0;!f&&i<t.length;i++){f=t[i];if(a&&v&&s_MC(f.getAttribute(a),c)!=v)f=null}if(!f||typeof f!='object'||!g)return f;if(g!='text')return f.getAttribute(g);f=f.innerText||f.textContent||'';f=f.replace(/\s*>\s*/g,'>').replace(/^>+/,'').replace(/>+$/,'');return f}
function s_parseUri(){var e,p,u=arguments.length==0?window.location.href:arguments[0],a={href:'',protocol:'',host:'',hostname:'',port:'',pathname:'',search:'',hash:''},h=document.createElement('a');h.setAttribute('href',u+'');for(e in a)a[e]=h[e]?h[e]:'';p=a.pathname;if(p&&p.indexOf('/')!=0)p='/'+p;a.pathname=p;return a}
function s_setIf(){var O='object',L=null,a=arguments,al=a.length,S='',i,z=0,n,o=window,l=0,c=0,d=0;try{if(typeof a[al-1]=='number'){n=a[--al];l=n&1;c=n&2;d=n&4}if(al>=2&&(typeof a[0]!=O||typeof a[1]==O))S=a[z++];if(!S&&!d)return L;if(S&&(l||c)){try{if(l)S=s_LC(S);if(c)S=s_scrubWS(S)}catch(e){}}if(typeof a[z]==O)o=a[z++];for(i=z;i<al;i++){n=a[i];if(typeof n=='string'&&((!d&&S)||(d&&!o[n]))){try{o[n]=S;L=S}catch(e){}}}}catch(e){}return L}
function s_def(){var a=arguments,b=new Array,i;for(i=0;i<a.length;i++)b.push.apply(b,[a[i]]);if(typeof b[i-1]=='number')b[i]|=4;else b.push.apply(b,[4]);return s_setIf.apply(this,b)}
function s_toNum(t,f,l){var v=NaN,k=1,i=0,c,o,D='0123456789',d=0,u=typeof t,m=f?1e306:1e14;if(u=='number')return t;if(u=='object')t+='';if(u!='string'||!t)return NaN;for(;l&&i<t.length;i++){c=t.substring(i,i+1);if(c>' ')break}c=t.substring(i,i+1);if(!d&&c=='+')i++;if(!d&&c=='-'){k=-1;i++}if(f&&!d&&c=='.'){d=1;i++}for(;i<t.length;i++){c=t.substring(i,i+1);o=D.indexOf(c);if(f&&c=='.'&&!d){d=1}else{if(o<0)return l?k*v:NaN;if(v>m)return NaN;if(isNaN(v))v=0;if(d){d=d/10;v=v+o*d}else v=10*v+o}}return k*v}
function s_toInt(t){var l=arguments.length>1&&!!arguments[1];return s_toNum(t,0,l)}
function s_toFloat(t){var l=arguments.length>1&&!!arguments[1];return s_toNum(t,1,l)}
function s_round(v,p,d,b){var N='number';if(typeof d!=N)d=NaN;if(typeof v!=N)v=s_toFloat(v);if(isNaN(v))return d;if(typeof p!=N||p<0)p=0;if(!b||typeof b!=N||b<2)b=10;p=Math.pow(b,isNaN(p)?0:p);return Math.floor(v*p+0.5)/p}
function s_getCharSet(){var v=s_getHTMLtag('meta','http-equiv','content-type','content'),i;if(!v)return'';i=v.indexOf('charset=');if(i==-1)return'';return s_UC(v.substring(i+8,99).replace(/[\'\";, ].*/,''))}
function s_callType(){var U='undefined',O='object',s=arguments[0]||window.s||'';if(typeof s!=O)return'';var a=typeof s.linkType,b=typeof s.lnk,c=typeof s.eo;if(a!=U&&a!=O)a=s.linkType;if(b!=U&&b!=O)b=s.lnk;if(c!=U&&c!=O)c=s.eo;if(a==U||(!a&&!c))return't';if(a)return a;return'+'}
function s_getQueryStr(n,u){var g,h,i,a='&',q=u||window.location.search,p=q.toLowerCase().replace(/\?/g,a)+a;n=a+n.toLowerCase();g=n+'=';h=p.indexOf(g);if(h>-1){i=h+g.length;return decodeURIComponent(q.substring(i,p.indexOf(a,i)).replace(/\+/g,' '))}g=n+a;return p.indexOf(g)>-1?' ':''}
function s_apl(l,v,d,u){var m=0;if(!l)l='';if(u){var i,n,a=s_split(l,d);for(i=0;i<a.length;i++){n=a[i];m=m||(u==1?(n==v):(s_LC(n)==s_LC(v)))}}if(!m)l=l?l+d+v:v;return l}
function s_getShortHn(){return s_LC(s_parseUri((arguments.length>0)?arguments[0]:window.location.href).hostname.replace(/^www-?[0-9]*\./i,''))}
function s_getOwnerHn(){return s_LC(s_parseUri((arguments.length>0)?arguments[0]:window.location.href).hostname.replace(/^www[0-9]*\./i,'').replace(/\.(gov|edu|com|mil|org|net|int).*/,'').replace(/\.[a-z][a-z]$/,'').replace(/.*\./,''))}
function s_getTLDlevels(){var h=s_parseUri(arguments.length>0?arguments[0]:window.location.href).hostname;return h.match(RegExp("\\.co\\..{2}$","i"))||h.match(RegExp("\\.(gov|edu|com|mil|org|net|int)\\..{2}$","i"))?3:2}
function s_getCookieDomain(){var h=s_parseUri((arguments.length>0)?arguments[0]:window.location.href).hostname,n=s_getTLDlevels(),a=s_split(h,'.'),i=a.length-n;for(h='';i<a.length;i++)h+='.'+a[i];return h}
function s_cEsc(t){var i=0,c,o='';t+='';for(;i<t.length;i++){c=t.substring(i,i+1);if(c==' ')o+='%20';else if(c==';')o+='%3B';else if(c==',')o+='%2C';else o+=c}return o}
function s_c_w(n,v){if(!n)return;if(!v)return s_c_d(n);var a=arguments,l=a.length,c=n+'='+s_cEsc(v)+(l>2?'; expires='+a[2].toGMTString():'')+'; path='+(l>3?a[3]:'/')+'; domain='+(l>4?a[4]:s_getCookieDomain())+(l>5?'; secure':'');document.cookie=c}
function s_c_r(n){if(!n)return'';var d='; ',e=';',q='=',a=d+document.cookie+d,b=d+n+q,c=a.indexOf(b);if(c<0){b=e+n+q;c=a.indexOf(b);if(c<0)return''}a=a.substring(c);a=a.substring(a.indexOf(q)+1);a=a.substring(0,a.indexOf(e));return unescape(a)}function s_c_d(n){if(!n)return'';var d=new Date,t=d.getTime(),p=new Date(t-3e10);if(s_c_r(n))s_c_w(n,'x',new Date(0))}
function s_c_d(n){if(!n)return'';var d=new Date,t=d.getTime(),p=new Date(t-3e10);if(s_c_r(n))s_c_w(n,'x',new Date(0))}
function s_findCode(a,c){var i=0,j;if(typeof a!='string')return'';for(a=s_LC(a);i<c.length;i+=2){j=c.substring(i,i+2);if(a==j)return j}return''}
function s_findCC(a){var c='adaeafagaialamanaoaqarasatauawaxazbabbbdbebfbgbhbibjblbmbnbobrbsbtbvbwbybzcacccdcfcgchcickclcmcncocrcucvcxcyczdedjdkdmdodzeceeegeheresetfifjfkfmfofrgagbgdgegfggghgiglgmgngpgqgrgsgtgugwgyhkhmhnhrhthuidieiliminioiqirisitjejmjojpkekgkhkikmknkpkrkwkykzlalblclilklrlsltlulvlymamcmdmemfmgmhmkmlmmmnmompmqmrmsmtmumvmwmxmymznancnenfngninlnonpnrnunzompapepfpgphpkplpmpnprpsptpwpyqarerorsrurwsasbscsdsesgshsisjskslsmsnsosrstsvsysztctdtftgthtjtktltmtntotrtttvtwtzuaugumusuyuzvavcvevgvivnvuwfwsyeytzazmzw';if(typeof s_findCCadd=='string')c+=s_findCCadd.replace(/,/g,'');return s_findCode(a,c)}
function s_findLC(a){var l='abaaaeafakamanarasavayazbabebgbhbibmbnbobrbscacechcocrcscucvcydadedvdzeeeleneoeseteufafffifjfofrfygagdglgngugvhahehihohrhthuhyhziaidieigiiikioisitiujajvkakgkikjkkklkmknkokrkskukvkwkylalblglilnloltlulvmgmhmimkmlmnmrmsmtmynanbndnengnlnnnonrnvnyocojomorospapiplpsptqurmrnrorurwsascsdsesgsiskslsmsnsosqsrssstsusvswtatetgthtitktltntotrtstttwtyugukuruzvevivowawoxhyiyozazhzu';return s_findCode(a,l)}
function s_matchList(v,l,m){var S='string',i=0;if(typeof l==S)l=s_split(l);if(typeof m==S)m=s_split(m);if(typeof m!='object')m='';if(typeof v==S){v=s_LC(v);for(;i<l.length;i++)if(v==l[i])return m?(m.length>i?m[i]:(m.length>0?m[m.length-1]:v)):true}return m?v:false}
function s_mapURLs(l){var O='object',U='undefined',S='string',g=function(p,t,v){var i,e,r,x,m,j=0,a,d=typeof v!=O,m,z,q;if(d)var v={Match:0};for(i in t){q=null;r=typeof t[i]==O?t[i]:{};if(typeof r.defaults==U)r.defaults=0;x=typeof r.urls==S?r.urls:'~';m=d?r.defaults:!r.defaults&&x=='';if(!m&&!d){try{q=new RegExp(x,'');m=q.test(p)}catch(z){}}if(m){if(!d)v.Match=j;for(e in r){if(e!='urls'&&e!='defaults'){z=r[e];if(!d&&x&&typeof z==S&&z.indexOf('$')>-1&&q){m=q.exec(p);if(m.length>1)z=m[0].replace(q,z);z=z.replace(/\$[0-9]/g,'')}v[e]=z}}return v}j++}return v},v=null,u=s_parseUri(arguments.length>1?arguments[1]:window.location.href),p=u.hostname+u.pathname+u.search;try{if(typeof l==O){v=g(p,l,0);v=g(p,l,v)}}catch(e){}if(typeof v!=O)v={Match:0};if(typeof v.Match!='number')v.Match=0;return v}
function s_intercept(f,n,c){var F='function',T='typeof ',O='object',o=c||'window',g='',r='';f=o+'.'+f;var r=f+'_orig';try{if(eval(T+o)==O&&eval(T+r)!=F&&eval(T+f)==F&&eval(T+n)==F){eval(r+'='+f+';'+f+'='+n);g=r}}catch(e){}return g}
function s_deintercept(f,c){var F='function',T='typeof ',O='object',o=c||'window',g='',r='';f=o+'.'+f;r=f+'_orig';try{if(eval(T+o)==O&&eval(T+r)==F&&eval(T+f)==F){eval(f+'='+r+';'+r+'=null');g=f}}catch(e){}return g}
function s_loadJS(p,a){try{if(p)if(a){var e=document.createElement('script');e.type='text/javascript';e.language='JavaScript';e.async=true;e.src=p;var j=document.getElementsByTagName('script')[0];j.parentNode.insertBefore(e,j)}else{document.write('<scr'+'ipt type="text/javascript" language="JavaScript" src="'+p+'"></sc'+'ript>')}}catch(e){}}
function s_clt(n){try{var p=typeof window.s=='object',o={linkTrackVars:p?s.linkTrackVars:'',linkTrackEvents:p?s.linkTrackEvents:'',events:p?(s.events||''):''};s=window.s_account?s_gi(s_account):0;s.events=o.events||'';if(s.events.toLowerCase=='none')s.events='';var r=true,a=arguments,l=a.length,t='o',i=1,v;if(typeof s!='object')return r;if(l&&a[1].length==1){t=a[1];i=2}while(i<l){v=a[i++].replace(/^v([0-9])$/,'eVar$1').replace(/^c([0-9])$/,'prop$1').replace(/^e([0-9])/,'event$1');if(v.indexOf('event')==0){s.linkTrackEvents=s.apl(s.linkTrackEvents,v,',',1);s.events=s.apl(s.events,v,',',1);v='events'}else if(i<l){o[v]=s[v]||'';s[v]=a[i++]}s.linkTrackVars=s.apl(s.linkTrackVars,v,',',1)}r=s.tl(1,t,n);for(i in o){s[i]=o[i]}}catch(e){s_clog('ERROR!')}return r}
function s_ta(){try{var i,b=('visitorID,pageURL,referrer,pageName,pageType,server,channel,hier1,hier2,hier3,hier4,hier5,list1,list2,list3,campaign,events,products,purchaseID,transactionID,zip,state').split(',');for(i=1;i<=75;i++)eval("s.prop"+i+"=s.eVar"+i+"=''");for(i in b)eval("s."+b[i]+"=''");s=s_gi(s_account);if(s&&typeof s=='object'){if(window.s_linkInternalFilters)s.linkInternalFilters=s_linkInternalFilters;if(window.s_linkTrackVars)s.linkTrackVars=s_linkTrackVars;if(window.s_linkTrackEvents)s.linkTrackEvents=s_linkTrackEvents;return s.t()}}catch(e){}return''}
function s_saveAcc(){if(window.s_account&&!window.s_errorPage){s_c_w('s_gpv_acc',s_account);s_c_w('s_gpv_url',window.location.href)}}
function s_restoreAcc(){if(typeof s=='undefined'){s_account='';var a=s_c_r('s_gpv_acc');if(a)s_account=a}if(!s_errorRef)s_errorRef=s_c_r('s_gpv_url')}
function s_jsFileInfo(m){if(!m)m='';var u,f,c,v,d,l,t,i,j,e,o;try{throw new RangeError('')}catch(z){e=z}u=f=c=v=d=l='';if(!m&&e&&e.fileName){u=e.fileName}else{t=document.getElementsByTagName('script');if(t){for(i=t.length;--i>=0;){u=t[i].src;if(u&&(m&&u.indexOf(m)>-1)||u.match(/\.js$/))break}if(!m&&i<0)i=t.length-1;u=i>=0?t[i].src:''}}f=typeof window.s_fileVer=='string'?s_fileVer:'';c=typeof window.s=='object'&&s.version?s.version:'';v=f+(c&&f?' ':'')+c;l=u+(u&&v?' ':'')+v;d=l.replace(/.*\//,'').replace(/\.js/,'');o={url:u,fver:f,cver:c,ver:v,desc:d,ldesc:l};return o}
function s_getLoadTime(){if(window.s_loadT)return s_loadT;var b=new Date().getTime(),a='';if(window.inHeadTS){a=inHeadTS;inHeadTS=0}else{var o=window.performance?performance.timing:null;if(o&&o.requestStart)a=o.requestStart}s_loadT=a?b-a:'';return s_loadT}
function s_clog(){try{var A='array',O='object',U='undefined',a=arguments,al=a.length,i,v,l='',o='',x=0,d=0,z=0,m=1<<16,g=function(v){v=v+'';var j,b,r,w,c,f=1;for(j=0;j<v.length;j++){b=v.substr(j,1);r=b=='\n';w=b<=' ';c=b<='A';if(r||(f&&c&&l.length>140)||(f&&l.length+v.substring(j).replace(/\n.*/,'').length>140)){o+=l;z+=o.length;if(o.length>2048){wl(o.replace(/^[ \t]*\n/,'').replace(/[ \t\n]*$/,''));o=''}else{o+='\n'}l=r?'':'  ';x=!r;f=0}if(!r&&(!x||!w)){l+=b;x=f=0}}},h=function(v,c,d){var t=typeof v,n,i=0,k=function(){if(z>=0&&!f)g(',');f=0;if(z>=0&&t==O)g(' '+n+':');if(z<m&&z>=0)h(v[n],c,d);if(z>=m){z=-1;g('...')}};d=d?d+1:1;switch(t){case'function':g(c&&z>=0?v:'function(){...}');break;case U:if(z>=0)g(t);break;case'string':if(z>=0)g("'"+v+"'");break;case O:if(v!=null){if(typeof v.length!=U)t=A;if(z>=0)g(t==A?'[':' {');var f=1;if(t=='array')for(n=0;n<v.length;n++)k();else for(n in v)k();g(t==A?']':' } ')}else{g('null')}break;default:if(z>=0)g(v);break}d--},wl=function(){try{if(!o)return;if(window.console&&console.log)console.log(o);if(window.s_debug||s_getQueryStr('s_debug')){if(!window.s_debugW)s_debugW=window.open('','_debugWin','height=600,width=900,toolbar=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes');if(s_debugW&&!window.s_debugD){s_debugD=s_debugW.document;if(s_debugD)s_debugD.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html><head><title>debugWin</title><style>* {font-family:Andale Mono,OCR A Extended,Consolas,monospace, serif;font-size:9pt;word-wrap:break-word;padding:0px} p {display:block;clear:both;margin:1px;width:100%;border:none;border-bottom:1px solid #dddddd;}</style></head><body>')}if(s_debugD){var i,a=arguments,t='';for(i=0;i<a.length;i++)t+=a[0];s_debugD.write('<p>'+t.replace(/\</gi,'&lt;').replace(/\>/gi,'&gt;').replace(/\n$/,'').replace(/\n/gi,'<br/>')+'</p>');s_debugW.scrollBy(0,100)}}}catch(e){}};for(i=0;i<al;i++){v=a[i];if(typeof v!=O)g(v);else for(var p in v){if(z<m&&z>=0){if(isNaN(p))g(p+(typeof v[p]==O?' ':'')+'=');h(v[p],v.code||0)}if(isNaN(p))g(' ')}}o+=l;o=o.replace(/^[ \t]*\n/,'').replace(/[ \t\n]*$/,'');if(o)wl(o)}catch(e){}}
function s_getVisitStart(c){var v=1,t=new Date;t.setTime(t.getTime()+1800000);if(!c)c='s_visit';if(s_c_r(c))v=0;if(!s_c_w(c,'1',t))s_c_w(c,'1');if(!s_c_r(c))v=0;return v}
function s_getVisitDuration(c){if(!c)c='s_dur';var M=60000,V=1800000,a=new Date(),t=a.getTime(),v=s_toInt(s_c_r(c)),d=0;if(isNaN(v)||(t-v)>V)v=t;d=t-v;a.setTime(t+1800000);s_c_w(c,v+'',a);c=s_c_r(c);return c?d/M:.77777}
function s_getVisitNum(p,a,b){var D=new Date,P,V,T=D.getTime(),d,i,t=0,k,o,y,H=1800000;if(!p)p='m';if(p=='m'||p=='w'||p=='d'){o=s_endof(p);y=o.getTime();D.setTime(y)}else{d=p*86400000;D.setTime(T+d)}if(!a)a='s_vnum';if(!b)b='s_invisit';P=s_c_r(a);if(P){i=P.indexOf('&vn=');t=s_toInt(P.substring(i+4,P.length));if(isNaN(t)||t<0)t=0}V=s_c_r(b);if(V){if(t){D.setTime(T+H);s_c_w(b,'Y',D)}return t}else{if(t){t++;k=P.substring(0,i);D.setTime(k);s_c_w(a,k+'&vn='+t,D);D.setTime(T+H);s_c_w(b,'true',D);return t}else{s_c_w(a,D.getTime()+'&vn=1',D);D.setTime(T+H);s_c_w(b,'Y',D);return 1}}}
function s_dimo(m,y){var d=new Date(y,m+1,0);return d.getDate()}
function s_endof(x){var t=new Date;t.setHours(0);t.setMinutes(0);t.setSeconds(0);if(x=='m'){d=s_dimo(t.getMonth(),t.getFullYear())-t.getDate()+1}else if(x=='w'){d=7-t.getDay()}else{d=1}t.setDate(t.getDate()+d);return t}
function s_getDaysSinceLastVisit(k,f){if(typeof k!='string'||!k){f=k?k:1;k=''}k=k||'s_lv';f=!!f;var M=60000,H=60*M,V=H/2,D=24*H,l=k+'_s',v=s_c_r(l),a=new Date(),b=0,t=a.getTime(),u=s_c_r(k),c=new Date(t+V),d=new Date(t+999*D),x=0,y='New';s_c_w(k,t,d);if(f){v=s_round(v,0,-1);if(v>730||v<0)v=-1}else{v=v?v:'Unknown'}u=s_toInt(u);if(!isNaN(u)){if(u>t){u=t-M}if(t-u>V){a=new Date(a.getFullYear(),a.getMonth(),a.getDate());t=a.getTime();b=new Date(u);b=new Date(b.getFullYear(),b.getMonth(),b.getDate());u=b.getTime();x=s_round((t-u)/D);if(x>730)y=f?999:'Unknown';else y=f?x:(x<7?'Less than '+(x<1?'1 day':'7 days'):'More than '+(x<30?'7':'30')+' days')}else{y=v}}else{y=f?-1:'First Visit'}s_c_w(l,y,c);return y}
// END preSlib
