
var totalContactCount='';var pageName='';$(document).ready(function(){if($('#frmIndividualContacts').length==1){InitIndividualContacts();EnableDisableActionLinks();}
loadOverlay('.chooseService',loadChooseService);$('.myGroupsList').find("input:checkbox").change(function(){ClearRadioSelection();});});function InitIndividuals(){$('.multipleSelector').bind('click.multipleSelected',function(){if($(this).hasClass('SelectAllLink')){$('.JQIsContactChecked').attr('checked','checked');EnableDisableActionLinks();}
else if($(this).hasClass('DeSelectAllLink')){$('.JQIsContactChecked').attr('checked','');EnableDisableActionLinks();}});$('.JQIsContactChecked').bind('click.selction',function(){EnableDisableActionLinks();});if($('#Contacts\\.StartIndex').val()==1&&$('#Contacts\\.EndIndex').val()==$('#Contacts\\.RecordCount').val()){$('.searchPaginationButton').closest('div').hide();}
else{$('.searchPaginationButton').unbind('click').bind('click.Pagination',function(event){if(($(event.currentTarget).hasClass('previous')&&$('#Contacts\\.StartIndex').val()==1)||($(event.currentTarget).hasClass('next')&&$('#Contacts\\.EndIndex').val()==$('#Contacts\\.RecordCount').val())){event.preventDefault();}});}
setTimeout(function(){$('#frmIndividualContacts .accordionHead').first().trigger('click');},1000);}
function InitIndividualContacts(){if($('#SelectedContactID').val().length>0){var selectedContactIDs=$('#SelectedContactID').val().split(',');var newselectedContactIDs='';for(var i=0;i<selectedContactIDs.length;i++){if($('#ContactDiv_'+selectedContactIDs[i]).length>0){$('#ContactDiv_'+selectedContactIDs[i]).find('.JQIsContactChecked').attr('checked','checked');}
else{newselectedContactIDs=newselectedContactIDs+selectedContactIDs[i]+',';}}
newselectedContactIDs=newselectedContactIDs.substr(0,newselectedContactIDs.length-1);$('#SelectedContactID').val(newselectedContactIDs);}}
function getSelectedContactIDs(){var Ids='';$('input:checked.JQIsContactChecked').each(function(){var parentDivID=$(this).closest('div').attr('id');Ids=Ids+parentDivID.substr(parentDivID.indexOf('_')+1,parentDivID.length)+',';});Ids=Ids.substr(0,Ids.length-1);if($('#SelectedContactID').val().length>0){$('#SelectedContactID').val($('#SelectedContactID').val()+',');$('input.JQIsContactChecked').each(function(){var divID=$(this).closest('div').attr('id');if(!($('#SelectedContactID').val().indexOf(divID.substr(divID.indexOf('_')+1,divID.length))==-1)){$('#SelectedContactID').val($('#SelectedContactID').val().replace(divID.substr(divID.indexOf('_')+1,divID.length)+',',''));}});Ids=$('#SelectedContactID').val()+Ids;}
return Ids;}
function EnableDisableActionLinks(){var relArray=new Array();if($('input:checked.JQIsContactChecked').length!=0){$('.JQDelete').removeClass('disabled');hallmarkBehaviors.hmkEnableButton($('.JQDelete'));$('.JQRequestAddressUpdate').removeClass('disabled');hallmarkBehaviors.hmkEnableButton($('.JQRequestAddressUpdate'));$('.JQAddToGroup').removeClass('disabled');hallmarkBehaviors.hmkEnableButton($('.JQAddToGroup'));$('.JQDelete, .JQRequestAddressUpdate, .JQAddToGroup').each(function(){if(typeof relArray[$(this).attr('id')]!="undefined"){$(this).attr('rel',relArray[$(this).attr('id')]);}
hallmarkBehaviors.hmkOverlay();});}
else{hallmarkBehaviors.hmkDisableButton($('.JQDelete'));$('.JQDelete').addClass('disabled',true);hallmarkBehaviors.hmkDisableButton($('.JQRequestAddressUpdate'));$('.JQRequestAddressUpdate').addClass('disabled',true);hallmarkBehaviors.hmkDisableButton($('.JQAddToGroup'));$('.JQAddToGroup').addClass('disabled',true);$('.JQDelete, .JQRequestAddressUpdate, .JQAddToGroup').each(function(){if(typeof $(this).attr('rel')!="undefined"&&$(this).attr('rel')!=''){relArray[$(this).attr('id')]=$(this).attr('rel');$(this).removeAttr('rel');}
$(this).removeAttr('onclick');$(this).parent().html($(this).parent().html());});}}
function ExportContacts(){SetOmnitureDataForPopUp('individuals','Export pop-up');GetTotalContactCount();InitiateExportContactRequest();}
function DeleteSelectedContacts(pageName){if(pageName=='I'){$("#frmIndividualContacts").attr("action","/ConnectionsAddressBook/DeleteContacts");$("#frmIndividualContacts").attr("method","POST");$("#frmIndividualContacts").submit();}
else if(pageName=='E')
{$("#frmAddEditContact").attr("action","/ConnectionsAddressBook/DeleteContacts");$("#frmAddEditContact").attr("method","POST");$("#frmAddEditContact").submit();}}
function DeleteSingleContact(contactID){$('#SelectedContactID').val(contactID);$('#IsDeleteSingleContact').val('true');DisplayDeleteContact();}
function DisplayDeleteContact(){SetOmnitureDataForPopUp('individuals','delete pop - up');if($('#IsDeleteSingleContact').val().toUpperCase()=='FALSE')
$('#SelectedContactID').val(getSelectedContactIDs());if($('#IsDeleteSingleContact').val().toUpperCase()=='FALSE'&&($("#SelectedContactID").val()=="")){msgDiv=$(getJQSelectorForID('msgDiv.'+errorPage));addErrorToCommonErrorDiv(msgDiv,'CommonError.DisplayDelete',deleteErrorMessage);}
else{clearAllErrorMessages();$("#DeleteContact").overlay({api:true,speed:200,expose:{maskId:'overlyMask',loadSpeed:800,opacity:0.9},onBeforeLoad:function(){var wrap=this.getContent().find("div.wrap");if(wrap.is(":empty")){wrap.load(this.getTrigger().attr("href"));}},onClose:function(){$("#DeleteContact.wrap").empty();$('#IsDeleteSingleContact').val('false');},closeOnClick:false}).load();setTimeout(function(){extendedBehaviors.hmkFormFocusOverlay($('#DeleteContact'));},1000);$(".close").click(function(){$("#DeleteContact").overlay().close();$('.JQDropdownOptions').attr('checked','');});}}
function PostIndividualsForm(pageNumber){$('#Contacts\\.CurrentPageNumber').val(pageNumber);$('#SelectedContactID').val(getSelectedContactIDs());$("#frmIndividualContacts").attr("action","/ConnectionsAddressBook/GetIndividualsPaged");$("#frmIndividualContacts").attr("method","POST");$("#frmIndividualContacts").submit();}
function PostFormAlphabet(alphabet){document.getElementById("Contacts.SortByContactInitials").value=alphabet.toUpperCase();PostIndividualsForm('1');}
function DisconnectContact(){document.forms["frmDisconnectContact"].action="/ConnectionsAddressBook/DisconnectContact";document.forms["frmDisconnectContact"].method="POST";document.forms["frmDisconnectContact"].submit();}
function DisplayDisconnectContact(){if($("#SelectedContactID").val()==""){msgDiv=$(getJQSelectorForID('msgDiv.'+errorPage));addErrorToCommonErrorDiv(msgDiv,'CommonError.DisplayDisconnect',errorMessage);}
else{clearAllErrorMessages();$("#DisconnectContact").overlay({api:true,speed:200,expose:{maskId:'overlyMask',loadSpeed:800,opacity:0.9},onBeforeLoad:function(){var wrap=this.getContent().find("div.wrap");if(wrap.is(":empty")){wrap.load(this.getTrigger().attr("href"));}},onClose:function(){$("#DisconnectContact.wrap").empty();},closeOnClick:false}).load();$(".close").click(function(){$("#DisconnectContact").overlay().close();$('.JQDropdownOptions').attr('checked','');});}}
function EditFlatContact(ID){window.location.href="/ConnectionsAddressBook/EditContact/"+ID+"/GAB/NOE";}
function EditConnectedContact(ID){window.location.href="/ConnectionsAddressBook/LoadEditConnectedContactDetails/"+ID+"/0";}
function GetContactDetails(ID,IsConnected){if(ID!=""){if(IsConnected=='False'){if(IsSavedFromPopUp=='true'){$("#closeAddEditContact").trigger('click');$(".EditContactHeader").show();$(".JQInPage").show();}else{window.location.href="/ConnectionsAddressBook/GetFlatContactDetails/"+ID+"/GAB/NOE";}}
else if(IsConnected=='True')
window.location.href="/ConnectionsAddressBook/GetConnectedContactDetails/"+ID+"/GAB/NOE";}
else{$("#closeAddEditContact").trigger('click');}}
function DeleteContact(){$("#frmRequestUpdateAddress").attr("action","/ConnectionsAddressBook/DeleteContacts");$("#frmRequestUpdateAddress").attr("method","POST");$("#frmRequestUpdateAddress").submit();}
function SeeMore(){$('#SeeLess').removeClass('hide');$('#SeeMore').addClass('hide');$('#Group20').removeClass('hide');}
function SeeLess(){$('#SeeLess').addClass('hide');$('#SeeMore').removeClass('hide');$('#Group20').addClass('hide');}
function NewRenderAddSelectedToGroups(){if(pageName!="ContactDetails")
$('#SelectedContactID').val(getSelectedContactIDs());var selectedContacts=$('#SelectedContactID').val().split(',');var contactName='';SetOmnitureDataForPopUp('individuals','add to group');contactName=$("#contactName").text();params="SelectedContactID="+$('#SelectedContactID').val();url="/ConnectionsAddressBook/RenderAddSelectedToGroups";method="GET";$.ajax({type:method,contentType:"application/x-www-form-urlencoded",url:url,data:params,dataType:'html',cache:false,error:function(e){},success:function(data){if(data!=""){$('#AddSelectedToGroupsOverlay').find('div.overlayWrap').html(data);extendedBehaviors.hmkFormFocus();extendedBehaviors.hmkEnterKeyFormSubmit();if(contactName!=''){$('#ContactName').html('<h4>'+contactName.trim()+'\'s groups </h4>');}
else{$('#ContactName').html('');}}
SetOmnitureDataForPopUp('individuals','add to group');}});}
function RenderAddSelectedToGroups(){SetOmnitureDataForPopUp('individuals','Add to group');if(pageName!="ContactDetails")
$('#SelectedContactID').val(getSelectedContactIDs());var selectedContacts=$('#SelectedContactID').val().split(',');var contactName='';if(selectedContacts.length==1&&pageName=="Individuals"){contactName=$('#individualContactName_'+selectedContacts).text().trim();}
else{contactName=$("#contactName").text();}
params="SelectedContactID="+$('#SelectedContactID').val();url="/ConnectionsAddressBook/RenderAddSelectedToGroups";method="GET";$.ajax({type:method,contentType:"application/x-www-form-urlencoded",url:url,data:params,dataType:'html',cache:false,error:function(e){},success:function(data){if(data!=""){$('#AddSelectedToGroupsOverlay').find('div.overlayWrap').html(data);extendedBehaviors.hmkFormFocus();extendedBehaviors.hmkEnterKeyFormSubmit();if(contactName!=''){$('#ContactName').html('<h4>'+contactName.trim()+'\'s groups </h4>');}
else{$('#ContactName').html('');}}}});}
function SaveAddSelectedToGroups(){var selectedGroupIDs='';$("#SelectedGroups .inviteMoreGroupID").each(function(){selectedGroupIDs=selectedGroupIDs+","+$.trim($(this).html());});params="SelectedContactID="+$('#SelectedContactID').val()+"&SelectedGroupIDs="+selectedGroupIDs;if(pageName=="Individuals"){url="/ConnectionsAddressBook/AddSelectedToGroups";datatype='json';}
else{url="/ConnectionsAddressBook/AddContactToGroups";datatype='html';}
$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:url,data:params,dataType:datatype,cache:false,error:function(e){},success:function(data){if(pageName=="Individuals"){if(null!=data.validationErrors&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,errorPage)
scrollToElement("msgDiv\\.AddSelectedToGroups");}
else{$('#AddSelectedToGroupsOverlay').find('div.close').trigger('click');}}
else{$("#GroupsSection").html($(data));$('#AddSelectedToGroupsOverlay').find('div.close').trigger('click');}}});}
function InitiateExportContactRequest(){clearAllErrorMessages();if(parseInt(totalContactCount,10)>0){$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded",url:"/ConnectionsAddressBook/InitiateExportContactRequest",dataType:"json",error:function(e){},success:function(data){if(data=="")
DisplayExportContactsOverlay();else{msgDiv=$(getJQSelectorForID('msgDiv.'+errorPage));addErrorToCommonErrorDiv(msgDiv,'CommonError.ExportContactsError',data);PostOmnitureData('My Accounts - Address Book- Export Contacts');}}});}
else{msgDiv=$(getJQSelectorForID('msgDiv.'+errorPage));addErrorToCommonErrorDiv(msgDiv,'CommonError.ExportContactsError',exportContactsError);}}
function loadChooseService(){$('#popupContainer2').removeClass('smallOverlay').addClass('mediumOverlay');this.getContent().find("div.JQolayContent").html(loadMsg);$.ajax({type:'GET',contentType:'application/x-www-form-urlencoded',url:'/ImportContacts/ChooseService',data:'',dataType:'html',cache:false,error:function(e){},success:function(data){if(data!=""){olay.getContent().find("div.JQolayContent").html(data);}}});olay=this;}
function InitAddSelectedContactsToGroups(){var seeMoreItem='<div class="pt-halfRow pb-halfRow prepend-halfcol mb-2 inviteMoreSeeMoreItem">'+'<ul>'+' <li class="algnMid"><a href="#" class="inviteMoreSeeMore">See More</a></li>'+'</ul>'+'</div>';var initContactEntry=function(jqObj){jqObj.unbind('click').click(function(){if($(this).hasClass('inviteMoreContactSelected')){$(this).removeClass('inviteMoreContactSelected');}
else{$(this).addClass('inviteMoreContactSelected');}});}
var initNewInviteAction=function(jqObj){jqObj.find('a').unbind('click').click(function(e){var curr=$(this).parent();curr.remove();$('.addToGroupExistingGroups').append(curr);curr.removeClass('remainder');curr.children('ul').removeClass('fltLeft');var deleteX=curr.children('a');deleteX.remove();var arr=$('.addToGroupExistingGroups').children(':not(.inviteMoreSeeMoreItem)').get();arr.sort(sortGroupName);$('.addToGroupExistingGroups').children(':not(.inviteMoreSeeMoreItem)').remove();for(i=0;i<arr.length;i++){if($('.addToGroupExistingGroups > .inviteMoreSeeMoreItem').length==0){$('.addToGroupExistingGroups').append(arr[i]);}
else{$('.addToGroupExistingGroups > .inviteMoreSeeMoreItem').before(arr[i]);}
initContactEntry($(arr[i]));}
e.stopPropagation();e.preventDefault();});}
$('.actionAdd').click(function(e){$('.inviteMoreContactSelected').each(function(){var curr=$(this);var deleteX=' <a class="remove fltRight" href="#"><span class="hidden">Delete</span></a>'
$(this).remove();curr.removeClass('inviteMoreContactSelected');curr.addClass('remainder');curr.children('ul').addClass('fltLeft');curr.append(deleteX);$('.addToGroupNewGroups').append(curr);});var arr=$('.addToGroupNewGroups').children(':not(.inviteMoreSeeMoreItem)').get();arr.sort(sortGroupName);$('.addToGroupNewGroups').children(':not(.inviteMoreSeeMoreItem)').remove();for(i=0;i<arr.length;i++){if($('.addToGroupNewGroups > .inviteMoreSeeMoreItem').length==0){$('.addToGroupNewGroups').append(arr[i]);}
else{$('.addToGroupNewGroups > .inviteMoreSeeMoreItem').before(arr[i]);}
initNewInviteAction($(arr[i]));}
resetFormFields();e.preventDefault();});var sortGroupName=function(a,b){var name1=$(a).find('li').eq(1).text().trim().toUpperCase();var name2=$(b).find('li').eq(1).text().trim().toUpperCase();return(name1<name2)?-1:(name1>name2)?1:0;};var resetFormFields=function(){$('.inviteIndividual').find('.inviteIndividualGroupName').val('');$('.inviteIndividual').find('.inviteIndividualLastName').val('');$('.inviteIndividual').find('.inviteIndividualEmail').val('');}
$('.addToGroupExistingGroups > div').each(function(){initContactEntry($(this));});$('.addToGroupNewGroups').each(function(){initNewInviteAction($(this));});$('.saveGroupData').click(function(){var arr=[];var inv=$('.addToGroupNewGroups');inv.children().each(function(i){arr[i]="{'personid' :'"+$(this).find('.customerPersonID').text()+"', "+"'groupid' :'"+$(this).find('.inviteMoreGroupID').text()+"' "+"}";});var jsonObj="{'group-list' : ["+listItems(arr)+"]}";$('#group-list').val(jsonObj);$('#saveGroupDataForm').submit();});var listItems=function(arr){var str="";for(var i=0;i<arr.length;i++){str+=arr[i];if(i<arr.length-1)
str+=", ";}
return str;}}
function GetGroupsForSelectedContactID(){var pageNumber=parseInt($('#SelectedGroups').find("#CurrentPageNumber_SelectedGroups").val(),10)+parseInt(1,10);var url="/ConnectionsAddressBook/GetGroupsForSelectedContactID"
$("#Groups\\.CurrentPageNumber").val(pageNumber);$('#SelectedGroups').find("#CurrentPageNumber_SelectedGroups").val(pageNumber);GetGroupsData(url,SuccessCallBackForGetGroupsForSelectedContactID)}
function GetGroupsExceptSelectedContactID(){var pageNumber=parseInt($('#ExistingGroups').find("#CurrentPageNumber_ExistingGroups").val(),10)+parseInt(1,10);var url="/ConnectionsAddressBook/GetGroupsExceptSelectedContactID"
$("#Groups\\.CurrentPageNumber").val(pageNumber);$('#ExistingGroups').find("#CurrentPageNumber_ExistingGroups").val(pageNumber);GetGroupsData(url,SuccessCallBackForGetGroupsExceptSelectedContactID)}
function GetGroupsData(url,successCallBack){var params="Groups.CurrentPageNumber="+$("#Groups\\.CurrentPageNumber").val()+"&SelectedContactID="+$('#SelectedContactID').val();$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:url,data:params,dataType:"html",cache:false,error:function(e){},success:successCallBack});}
function SuccessCallBackForGetGroupsForSelectedContactID(data){if(data!=""){$("#SelectedGroups .inviteMoreSeeMoreItem").remove();$('#SelectedGroups').append($(data));InitAddSelectedContactsToGroups();}}
function SuccessCallBackForGetGroupsExceptSelectedContactID(data){if(data!=""){$("#ExistingGroups .inviteMoreSeeMoreItem").remove();$('#ExistingGroups').append($(data));InitAddSelectedContactsToGroups();}}
function ClearRadioSelection(){$("input:radio").attr("checked",false);}
function CloseAddSelectedToContacts(){$("#AddSelectedToGroupsOverlay").find('.close').trigger('click');}