
var SelectedGroupID='';var DeselectedGroupID='';var droppedPersonID='';var droppedToGroupID='';var isMyGroups='';var isContactPresentInGroup='';var hideSeeMore=false;var callToActionMessage='';var connectionImagePath='';var selectedContactIDs=[];var deSelectedContactIDs=[];var sortContactsFirstName=function(a,b){var name1=$(a).find('li').eq(1).text().trim().toUpperCase();var name2=$(b).find('li').eq(1).text().trim().toUpperCase();return(name1<name2)?-1:(name1>name2)?1:0;};jQuery.fn.sortElements=(function(){var sort=[].sort;return function(comparator,getSortable){getSortable=getSortable||function(){return this;};var placements=this.map(function(){var sortElement=getSortable.call(this),parentNode=sortElement.parentNode,nextSibling=parentNode.insertBefore(document.createTextNode(''),sortElement.nextSibling);return function(){if(parentNode===this){throw new Error("You can't sort elements if any one is a descendant of another.");}
parentNode.insertBefore(this,nextSibling);parentNode.removeChild(nextSibling);};});return sort.call(this,comparator).each(function(i){placements[i].call(getSortable.call(this));});};})();function SortContacts(groupId){$('#'+groupId).parent().find('.JQcontactItem').sortElements(function(a,b){return $(a).find('.idLName').text()>$(b).find('.idLName').text()?1:-1;});}
function GetGroupsPaged(counter){$("a[rel]").removeAttr('rel');if(isMyGroups=="True"||isMyGroups=="true"){GetMyGroupsPaged(counter);}
else{GetSharedGroups(counter);}}
function GetMyGroupsPaged(counter){clearAllErrorMessages();var pageNumber;if(parseInt(0,10)!=parseInt(counter,10))
pageNumber=parseInt($("#Groups\\.CurrentPageNumber").val(),10)+parseInt(counter,10);else
pageNumber=parseInt(1,10);$("#Groups\\.CurrentPageNumber").val(pageNumber);$("#GroupMemberDetails").hide();if(pageNumber!=0&&pageNumber!=""){var params="AddressBookType="+$("#AddressBookType").val()+"&SelectionCriteria="
+$("#SelectionCriteria").val()+"&Groups.CurrentPageNumber="+pageNumber;$('#Loading').css('display','block');$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetGroupsPaged",data:params,dataType:"html",async:false,cache:false,error:function(e){},success:function(data){if(data!=""){$('#Loading').css('display','none');$('.accordionHead').unbind('click');$("#GroupsSection").html('');$("#GroupsSection").html(data);hallmarkBehaviors.hmkWidgets();hallmarkBehaviors.hmkOverlay();$('#ContactWidgt').show();$('#ContactWidgetHdr').show();}}});}}
function GetSharedGroups(counter){$("a[rel]").removeAttr('rel');clearAllErrorMessages();var pageNumber;PostOmnitureData('My Accounts -  Address Book - Groups - Shared Groups');if(parseInt(0,10)!=parseInt(counter,10))
pageNumber=parseInt($("#Groups\\.CurrentPageNumber").val(),10)+parseInt(counter,10);else
pageNumber=parseInt(1,10);$("#Groups\\.CurrentPageNumber").val(pageNumber);$("#GroupMemberDetails").hide();if(pageNumber!=0&&pageNumber!=""){var params="AddressBookType="+$("#AddressBookType").val()+"&SelectionCriteria="
+$("#SelectionCriteria").val()+"&Groups.CurrentPageNumber="+pageNumber;$('#Loading').css('display','block');$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetSharedGroups",data:params,dataType:"html",async:false,cache:false,error:function(e){},success:function(data){if(data!=""){$('#Loading').css('display','none');$("#GroupsSection").html('');$("#GroupsSection").html(data);$("#GroupsSection").find("#SharedGroups").html($("#GroupsSection").find("#MyGroups").html());$("#GroupsSection").find("#MyGroups").html('');$('.otherPeoplesGroups').show();$('.myGroupsList').hide();$('.accordionHead').unbind('click');hallmarkBehaviors.hmkWidgets();$('#ContactWidgt').hide();$('#ContactWidgetHdr').hide();GetContacts($('#SharedGroups .dropContainer div').first());$('#SharedGroups .dropContainer div').first().trigger('click');}}});}}
function GetFriendsSharedGroups(counter){clearAllErrorMessages();var pageNumber;PostOmnitureData('My Accounts -  Address Book - Groups - SharedGroups');if(parseInt(0,10)!=parseInt(counter,10))
pageNumber=parseInt($("#Groups\\.CurrentPageNumber").val(),10)+parseInt(counter,10);else
pageNumber=parseInt(1,10);$("#Groups\\.CurrentPageNumber").val(pageNumber);if(pageNumber!=0&&pageNumber!=""){var params="Groups.CurrentPageNumber="+pageNumber+"&SelectedContactID="+$("#PersonID").val();$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetConnectionsSharedGroups",data:params,dataType:"html",cache:false,error:function(e){},success:function(data){if(data!=""){$('#SharedGroupsTab').addClass('selected');$('#DetailsTab').removeClass('selected');$("#SharedGroupDetails").html(data);$(".sharedGroupDetails").show();$("#ContactDetails").html('');$("#ContactDetails").hide();$('.accordionHead').unbind('click');hallmarkBehaviors.hmkWidgets();}}});}}
function GetContacts(obj){if(isMyGroups=="True"||isMyGroups=="true"){GetContactsForGroup(obj);}
else{GetSharedGroupContactsByGroupID(obj);}}
function GetGroupsContactsPaged(obj){if(isMyGroups=="True"||isMyGroups=="true"){GetContactsPagedForGroup(obj);}
else{GetSharedGroupContactsPagedByGroupID(obj);}}
function GetContactsForGroup(obj){clearAllErrorMessages();if($(obj).hasClass('accSlideDownLeft')||$(obj).hasClass('removed')){if($(obj).hasClass('removed'))
$(obj).removeClass('removed');var id=$(obj).attr('id').split("_")[1];$("#CurrentPageNumber_"+id).val(1);$("#Contacts\\.CurrentPageNumber").val(1);$("#GroupMembers_"+id).html('');if($("#MoreFriends_"+id).hasClass('hide'))
$("#MoreFriends_"+id).removeClass('hide');DisplayContactsByGroupID(id,1,$('#GroupWidgetContactsPerPage').val(),SuccessCallBackGetContactsForGroup);$("#GroupMemberDetails").html(' <div class="selectedContactsWindow  mt-1row"><div><div class="contactDetailHdr">'+callToActionMessage+'</div></div></div>');$("#GroupMemberDetails").show();}
else{setTimeout(function(){if($("#GroupsSection").find('.accSlideUpLeft').length==0){$("#GroupMemberDetails").hide();}},100);}}
function GetContactsPagedForGroup(obj){clearAllErrorMessages();var pageNumber=parseInt($(obj).parent().find("input[name*=CurrentPageNumber_]").val(),10)+parseInt(1,10);$("#Contacts\\.CurrentPageNumber").val(pageNumber);$(obj).parent().find("input[name*=CurrentPageNumber_]").val(pageNumber);var id=$(obj).parent().find("input[name*=CurrentPageNumber_]").attr('name').split("_")[1];DisplayContactsByGroupID(id,pageNumber,$('#GroupWidgetContactsPerPage').val(),SuccessCallBackGetContactsPagedForGroup);}
function GetMoreContactsForAddGroups(obj){var pageNumber=parseInt($('#frmAddEditGroups').find("input[name*=CurrentPageNumber_]").val(),10)+parseInt(1,10);$("#Contacts\\.CurrentPageNumber").val(pageNumber);$('#frmAddEditGroups').find("input[name*=CurrentPageNumber_]").val(pageNumber);DisplayContactsByGroupID("-1",pageNumber,0,successCallBackForSeeMore)}
function GetMoreContactsForAddGroupsExceptSelected(obj){var pageNumber=parseInt($('#frmAddEditGroups').find("input[name*=CurrentPageNumber_]").val(),10)+parseInt(1,10);$("#Contacts\\.CurrentPageNumber").val(pageNumber);$('#frmAddEditGroups').find("input[name*=CurrentPageNumber_]").val(pageNumber);DisplayForAddGroupsExceptSelected($('#SelectedGroupID').val(),0,successCallBackForSeeMore);}
function DisplayForAddGroupsExceptSelected(id,ContactsCountRequired,successCallBack){var params="AddressBookType="+$("#AddressBookType").val()+"&SelectionCriteria="+$("#SelectionCriteria").val()
+"&Contacts.CurrentPageNumber="+$('#Contacts\\.CurrentPageNumber').val()+'&SelectedGroupID='+id
+"&Contacts.TotalRecordsPerPage="+ContactsCountRequired;$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetGroupAndContactsNotInGroup",data:params,dataType:"json",cache:false,error:function(e){},success:successCallBack});}
function GetMoreContactsForSelGrpID(obj){var pageNumber=parseInt($('#frmAddEditGroups').find("input[name*=SelectedGroupsContacts_CurrentPageNumber]").val(),10)+parseInt(1,10);$("#SelectedGroupsContacts\\.CurrentPageNumber").val(pageNumber);$('#frmAddEditGroups').find("input[name*=SelectedGroupsContacts_CurrentPageNumber]").val(pageNumber);DisplayMoreContactsForSelGrpID($('#SelectedGroupID').val(),0,pageNumber,successCallBackForSeeMoreForSelGrpID);}
function DisplayMoreContactsForSelGrpID(id,ContactsCountRequired,pageNumber,successCallBack){var params="AddressBookType="+$("#AddressBookType").val()+"&SelectionCriteria="+$("#SelectionCriteria").val()
+"&SelectedGroupsContacts.CurrentPageNumber="+pageNumber+'&SelectedGroupID='+id
+"&SelectedGroupsContacts.TotalRecordsPerPage="+ContactsCountRequired;$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetContactsInGroup",data:params,dataType:"json",cache:false,error:function(e){},success:successCallBack});}
function successCallBackForSeeMoreForSelGrpID(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");scrollToElement("msgDiv\\.AddEditGroups");}
else{var seeMoreItem='';MergeContactsForSelContacts(data,$('#targetDivForSelGrpID'),$('#sourceDivForSelGrpID'),'');InitAddEditGroups();var arr=$('.inviteMoreNewInvites').children().get();arr.sort(sortContactsFirstName);$('.inviteMoreNewInvites').children().remove();for(i=0;i<arr.length;i++){if($(arr[i]).hasClass('inviteMoreSeeMoreItem')){seeMoreItem=arr[i];}
else{$('.inviteMoreNewInvites').append(arr[i]);initNewInviteAction($(arr[i]));}}
$('.inviteMoreNewInvites').append(seeMoreItem);}}}
function successCallBackForSeeMore(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");scrollToElement("msgDiv\\.AddEditGroups");}
else{var seeMoreItem='';MergeContacts(data,$('#targetDiv'),$('#sourceDiv'),'');InitAddEditGroups();var arr=$('.inviteMoreContactList').children().get();arr.sort(sortContactsFirstName);$('.inviteMoreContactList').children().remove();for(i=0;i<arr.length;i++){if($(arr[i]).hasClass('inviteMoreSeeMoreItem')){seeMoreItem=arr[i];}
else{$('.inviteMoreContactList').append(arr[i]);}}
$('.inviteMoreContactList').append(seeMoreItem);$('.inviteMoreContactList').children(':not(.inviteMoreSeeMoreItem)').unbind('click').each(function(){initContactEntry($(this));});}}}
function initContactEntry(jqObj){jqObj.click(function(){if($(this).hasClass('inviteMoreContactSelected')){$(this).removeClass('inviteMoreContactSelected');}
else{$(this).addClass('inviteMoreContactSelected');}});}
function MergeContactsForSelContacts(data,targetDiv,sourceDiv,classes){seeMoreItem=$("#targetDivForSelGrpID .inviteMoreSeeMoreItem");$(targetDiv).remove(seeMoreItem);for(var i=0;i<data.SelectedGroupsContacts.length;i++){targetDiv.append(sourceDiv.html());$(targetDiv).find('.newDiv').find('.inviteMoreGroupID').html(data.SelectedGroupsContacts[i].RelatedPersonID);if(data.SelectedGroupsContacts[i].IsConnected){$(targetDiv).find('.newDiv').find('#ConnectionsInSelGrpID').removeClass('hide');$(targetDiv).find('.newDiv').find('#ConnectionsInSelGrpID').addClass('show');}
if(null!=data.SelectedGroupsContacts[i].DisplayName&&data.SelectedGroupsContacts[i].DisplayName!="")
$(targetDiv).find('.newDiv').find('.inviteMoreGroupName').html(data.SelectedGroupsContacts[i].DisplayName);else
$(targetDiv).find('.newDiv').find('.inviteMoreGroupName').html(data.SelectedGroupsContacts[i].ContactEmailAddress);$(targetDiv).find('.newDiv').removeClass('newDiv');}
$(targetDiv).append(seeMoreItem);if(data.IsLastPageForSelContacts=='hide')
$('#SelectedContactDiv').find('.inviteMoreSeeMoreItem').hide();}
function MergeContacts(data,targetDiv,sourceDiv,classes){seeMoreItem=$("#targetDiv .inviteMoreSeeMoreItem");$("#targetDiv").remove(seeMoreItem);for(var i=0;i<data.Contacts.length;i++){targetDiv.append(sourceDiv.html());$(targetDiv).find('.newDiv').find('.inviteMoreGroupID').html(data.Contacts[i].RelatedPersonID);if(data.Contacts[i].IsConnected){$(targetDiv).find('.newDiv').find('#ConnectionsInSourceDiv').removeClass('hide');$(targetDiv).find('.newDiv').find('#ConnectionsInSourceDiv').addClass('show');}
if(null!=data.Contacts[i].DisplayName&&data.Contacts[i].DisplayName!="")
$(targetDiv).find('.newDiv').find('.inviteMoreGroupName').html(data.Contacts[i].DisplayName);else
$(targetDiv).find('.newDiv').find('.inviteMoreGroupName').html(data.Contacts[i].ContactEmailAddress);initContactEntry($(targetDiv).find('.newDiv'));$(targetDiv).find('.newDiv').removeClass('newDiv');}
if(data.IsLastPage=='hide'){$('#mainDiv').find('.inviteMoreSeeMoreItem').hide();hideSeeMore=true;}
else{hideSeeMore=false;}
$('#targetDiv').append(seeMoreItem);}
function DisplayContactsByGroupID(id,currentPageNumber,ContactsCountRequired,successCallBack){var params="AddressBookType="+$("#AddressBookType").val()+"&SelectionCriteria="+$("#SelectionCriteria").val()
+"&Contacts.CurrentPageNumber="+currentPageNumber+'&SelectedGroupID='+id
+"&RecordsPerPage="+ContactsCountRequired;$('#Loading').css('display','block');$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetContactsByGroupID",data:params,dataType:"json",async:false,cache:false,error:function(e){},success:successCallBack});}
function SuccessCallBackGetContactsPagedForGroup(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');$('#Loading').css('display','none');}
else{$('#Loading').css('display','none');DisplayContacts(data,$('#itemContainerDiv'),$("#GroupMembers_"+data.SelectedGroupID),"contactItem");$("#GroupMembers_"+data.SelectedGroupID).find('.JQcontactItem').unbind();$("#GroupMembers_"+data.SelectedGroupID).find('.JQcontactItem').each(function(){$(this).click(function(e){GetGroupMemberDetails(e.currentTarget)});});$("#MoreFriends_"+data.SelectedGroupID).addClass(data.IsLastPage);}}
else
$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');}
function SuccessCallBackGetContactsForGroup(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');$('#Loading').css('display','none');}
else{$('#Loading').css('display','none');DisplayContacts(data,$('#itemContainerDiv'),$("#GroupMembers_"+data.SelectedGroupID),"contactItem");$("#GroupDiv_"+data.SelectedGroupID).find('#groupsCount').html('('+data.TotalContactCount+')');$("#GroupMembers_"+data.SelectedGroupID).find('.JQcontactItem').each(function(){$(this).click(function(e){GetGroupMemberDetails(e.currentTarget)});});if(data.Contacts==null||data.Contacts=="")
$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');else
$("#MoreFriends_"+data.SelectedGroupID).addClass(data.IsLastPage);}}}
function GetGroupMemberDetails(e){if($(e).find('.PersonTypeCode').html()=="C"){GetFlatContactGroupMemberDetails(e);}
else{GetConnectedContactDetails(e);}}
function GetFlatContactGroupMemberDetails(e){clearAllErrorMessages();var params='';var groupOwnerId=$(e).parent().parent().find("input[name*=GroupOwnerID_]").attr('name').split("_")[1];if(groupOwnerId!="0"&&groupOwnerId!="")
params="GroupID="+$(e).parent().attr('id').split("_")[1]+"&ID="+groupOwnerId+"&ContactID="+$(e).attr('id').split("_")[1];else
params="GroupID="+$(e).parent().attr('id').split("_")[1]+"&ID="+$(e).attr('id').split("_")[1];$('.contactDetail').html('');$('.contactDetailHdr').html('');$('#ContactInformationLoading').css('display','block');$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:"/ConnectionsAddressBook/DisplayGroupsFlatContactDetails",data:params,dataType:"html",cache:false,error:function(e){},success:function(data){if(data!=""){$('#ContactInformationLoading').css('display','none');$("#GroupMemberDetails").html('');$("#GroupMemberDetails").html($(data));hallmarkBehaviors.hmkOverlay();errorPage="Groups";}}});}
function GetConnectedContactDetails(e){clearAllErrorMessages();var params='';var groupOwnerId=$(e).parent().parent().find("input[name*=GroupOwnerID_]").attr('name').split("_")[1];if(groupOwnerId!="0"&&groupOwnerId!="")
params="GroupID="+$(e).parent().attr('id').split("_")[1]+"&ID="+groupOwnerId+"&ContactID="+$(e).attr('id').split("_")[1];else
params="GroupID="+$(e).parent().attr('id').split("_")[1]+"&ID="+$(e).attr('id').split("_")[1];AjaxCallForConnectionDetails(params);}
function GetGroupOwnerDetails(e){clearAllErrorMessages();var params='';var groupOwnerId=$(e).parent().parent().find("input[name*=GroupOwnerID_]").attr('name').split("_")[1];params="GroupID=-1"+"&ID="+groupOwnerId;AjaxCallForConnectionDetails(params);$("#ContactDetailFooter").hide();$("#GroupMemberDetails").show();}
function AjaxCallForConnectionDetails(params){$('.contactDetail').html('');$('#ContactInformationLoading').css('display','block');$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:"/ConnectionsAddressBook/DisplayGroupsConnectionDetails",data:params,dataType:"html",async:false,cache:false,error:function(e){},success:function(data){if(data!=""){$('#ContactInformationLoading').css('display','none');$("#GroupMemberDetails").html('');$("#GroupMemberDetails").html($(data));hallmarkBehaviors.hmkOverlay();errorPage="Groups";}}});}
function GetSharedGroupContactsByGroupID(obj){clearAllErrorMessages();if($(obj).hasClass('accSlideDownLeft')){var id=$(obj).attr('id').split("_")[1];var groupOwnerID=$(obj).parent().find("input[name*=GroupOwnerID_]").attr('name').split("_")[1];$("#CurrentPageNumber_"+id).val(1);$("#Contacts\\.CurrentPageNumber").val(1);$("#GroupMembers_"+id).html('');if($("#MoreFriends_"+id).hasClass('hide'))
$("#MoreFriends_"+id).removeClass('hide');DisplaySharedGroupContactsByGroupID(id,groupOwnerID,$('#GroupWidgetContactsPerPage').val(),SuccessCallBackGetSharedGroupContactsByGroupID);$("#GroupMemberDetails").html(' <div class="selectedContactsWindow  mt-1row"><div><div class="contactDetailHdr">'+callToActionMessage+'</div></div></div>');$("#GroupMemberDetails").show();}
else{setTimeout(function(){if($("#GroupsSection").find('.accSlideUpLeft').length==0){$("#GroupMemberDetails").hide();}},100);}}
function GetSharedGroupContactsPagedByGroupID(obj){clearAllErrorMessages();var pageNumber=parseInt($(obj).parent().find("input[name*=CurrentPageNumber_]").val(),10)+parseInt(1,10);$("#Contacts\\.CurrentPageNumber").val(pageNumber);$(obj).parent().find("input[name*=CurrentPageNumber_]").val(pageNumber);var id=$(obj).parent().find("input[name*=CurrentPageNumber_]").attr('name').split("_")[1];var groupOwnerID=$(obj).parent().find("input[name*=GroupOwnerID_]").attr('name').split("_")[1];DisplaySharedGroupContactsByGroupID(id,groupOwnerID,$('#GroupWidgetContactsPerPage').val(),SuccessCallBackGetSharedGroupContactsPagedByGroupID);}
function DisplaySharedGroupContactsByGroupID(id,groupOwnerID,ContactsCountRequired,successCallBack){var params="AddressBookType="+$("#AddressBookType").val()+"&SelectionCriteria="+$("#SelectionCriteria").val()
+"&Contacts.CurrentPageNumber="+$('#Contacts\\.CurrentPageNumber').val()+'&SelectedGroupID='+id
+"&Contacts.TotalRecordsPerPage="+ContactsCountRequired+"&SelectedContactID="+groupOwnerID;$('#Loading').css('display','block');$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetSharedGroupContactsByGroupID",data:params,dataType:"json",cache:false,error:function(e){},success:successCallBack});}
function SuccessCallBackGetSharedGroupContactsByGroupID(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');$('#Loading').css('display','none');}
else{$('#Loading').css('display','none');DisplayContacts(data,$('#itemContainerDiv'),$("#GroupMembers_"+data.SelectedGroupID),"contactItem");$("#GroupMembers_"+data.SelectedGroupID).find('.JQcontactItem').each(function(){$(this).click(function(e){GetGroupMemberDetails(e.currentTarget)});});$("#MoreFriends_"+data.SelectedGroupID).addClass(data.IsLastPage);}}
else
$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');}
function SuccessCallBackGetSharedGroupContactsPagedByGroupID(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');$('#Loading').css('display','none');}
else{$('#Loading').css('display','none');DisplayContacts(data,$('#itemContainerDiv'),$("#GroupMembers_"+data.SelectedGroupID),"contactItem");$("#GroupMembers_"+data.SelectedGroupID).find('.JQcontactItem').unbind();$("#GroupMembers_"+data.SelectedGroupID).find('.JQcontactItem').each(function(){$(this).click(function(e){GetGroupMemberDetails(e.currentTarget)});});if(data.Contacts==null||data.Contacts=="")
$("#MoreFriends_"+data.SelectedGroupID).addClass('hide');else
$("#MoreFriends_"+data.SelectedGroupID).addClass(data.IsLastPage);}}}
function DisplayContacts(data,sourceDiv,targetDiv,classes){var divID='';for(var i=0;i<data.Contacts.length;i++){divID='contact_'+data.Contacts[i].RelatedPersonID;sourceDiv.find('.JQcontactItem').attr('id',divID);targetDiv.append(sourceDiv.html());sourceDiv.find('.JQcontactItem').attr('id','');var firstName=data.Contacts[i].FirstName;var lastName=data.Contacts[i].LastName;var emailAddress=data.Contacts[i].ContactEmailAddress;var currentDiv=$(targetDiv).find(getJQSelectorForID(divID));if(null!=firstName&&firstName!=""&&firstName.length>10)
firstName=firstName.substring(0,10)+'..';if(null!=lastName&&lastName!=""&&lastName.length>10)
lastName=lastName.substring(0,10)+'..';if(null!=emailAddress&&emailAddress!=""&&emailAddress.length>10)
emailAddress=emailAddress.substring(0,10)+'..';currentDiv.find('.idFName').html(firstName);currentDiv.find('.idLName').html(lastName);currentDiv.find('.PersonTypeCode').html(data.Contacts[i].PersonTypeCode);currentDiv.find('.IsConnected').html(data.Contacts[i].IsConnected.toString());if(data.Contacts[i].IsConnected.toString()=="true")
currentDiv.find('.JQConnectedContact > img').attr('src',connectionImagePath);if(null!=data.Contacts[i].Asset.ImageUrl&&data.Contacts[i].Asset.ImageUrl!=""){currentDiv.find('.JQContact > img').attr('src',data.Contacts[i].Asset.PrefixImageUrl.replace("{0}",(data.Contacts[i].IsConnected.toString()=="true")?data.Contacts[i].RelatedPersonID:(isMyGroups=="True"?data.PersonID:(data.Contacts[i].RelatedPersonID==data.PersonID)?data.Contacts[i].RelatedPersonID:data.SelectedContactID))+data.Contacts[i].Asset.SuffixImageUrl+"_100S.jpg");}
else
currentDiv.find('.JQContact > img').attr('src',data.Contacts[i].Avatar.ImageURL+'.png');currentDiv.find('.JQContact > img').addClass('ui-draggable');currentDiv.find('.idEmail').html(emailAddress);if(firstName==""||firstName==null){currentDiv.find('.idFName').addClass("hide");currentDiv.find('.idLName').addClass("hide");}
else
currentDiv.find('.idEmail').addClass("hide");currentDiv.addClass(classes);}}
function PopulateContactsWidget(){clearAllErrorMessages();$('.contactWidgetContainer').hmkSlider2("destroy");$('.contactWidgetContainer').hmkSlider2({ajaxUrl:"/Group/GetContactsByGroupID/GAB/NOE/-1/",successCallBackMethod:successCallBackDisplayContacts,itemCountField:"TotalContactCount"});$("#ContactWidgt").trigger('click');}
function successCallBackDisplayContacts(container,data){if(data.Contacts!=null&&data.Contacts!=""){DisplayContacts(data,$('#itemContainerDiv'),container,'item contactItem');$('#ContactWidget_CurrentPageNo').val(data.ContactsCurrentPage);$("#ContactWidgt").find("#ContactsCount").text(data.TotalContactCount);$('.contactWidgetContainer').find('.loading').hide();hallmarkBehaviors.hmkTooltip();}
else{}
initDragNDrop();}
function AddContactToGroup(evt,ui,droppedPersonID,droppedToGroupID){clearAllErrorMessages();if($("#GroupDiv_"+droppedToGroupID).hasClass('accSlideDownLeft')){GetContactsForGroup($("#GroupDiv_"+droppedToGroupID));}
AddSelectedContactToGroup(droppedPersonID,droppedToGroupID);if(isContactPresentInGroup=="1"){$(evt.target).find('.groupMembers').append($(ui.draggable).closest('.JQcontactItem').clone());contactCount=parseInt(($(evt.target).find('.contactGroupHdr').find('span[id=groupsCount]').html().trim()).substr(1,1));$(evt.target).find('.contactGroupHdr').find('span[id=groupsCount]').html('('+(contactCount+1)+')');$(evt.target).find('.groupMembers').find(getJQSelectorForID('contact_'+droppedPersonID)).removeClass('item');$(evt.target).find('.groupMembers').find(getJQSelectorForID('contact_'+droppedPersonID)).addClass('contactItem');$(evt.target).find('.groupMembers').find(getJQSelectorForID('contact_'+droppedPersonID)).attr('style','');SortContacts($(evt.target).find('.contactGroupHdr').attr('id'));$("#GroupMembers_"+droppedToGroupID).find('.JQcontactItem').unbind();$("#GroupMembers_"+droppedToGroupID).find('.JQcontactItem').each(function(){$(this).click(function(e){GetGroupMemberDetails(e.currentTarget)});});}
else if(isContactPresentInGroup=="0"){$('#msgDiv\\.Groups').show();$('#errMsgHdr').show();$('#errMsgs').html('<li id="CommonError.SameContactInGroup">Same contact should not be added twice.</li>');}
else{$('#msgDiv\\.Groups').show();$('#errMsgHdr').show();$('#errMsgs').html('<li id="CommonError.SameContactInGroup">We are unable to process your request. Please try again later..</li>');}}
function AddSelectedContactToGroup(droppedPersonID,droppedToGroupID){$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/AddContactToGroup",data:{personID:droppedPersonID,groupID:droppedToGroupID},dataType:"text",async:false,cache:false,error:function(e){},success:SuccessCallBackAddSelectedContactToGroup});}
function SuccessCallBackAddSelectedContactToGroup(data){if(null!=data){isContactPresentInGroup=data;}}
function DeleteGroup(){clearAllErrorMessages();$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/DeleteGroup",data:{SelectedGroupID:$('#SelectedGroupID').val()},dataType:"json",cache:false,error:function(e){},success:function(data){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");$("#DeleteGroup").overlay().close();}
else{$("#Groups\\.CurrentPageNumber").val(1);GetMyGroupsPaged(0);$("#DeleteGroup").overlay().close();}}});}
function SetContactDetailsFooter(){if(isMyGroups=="True"||isMyGroups=="true"){$("#SendRequest").addClass("hide");$("#Gender").addClass("hide");}
else{$("#Details").addClass("hide");}}
function RemoveContactFromGroup(){clearAllErrorMessages();var groupID=$("#SelectedGroupID").val();$("#GroupDiv_"+groupID).addClass("removed");var params="SelectedGroupID="+$("#SelectedGroupID").val()+"&SelectedContactID="+$("#SelectedContactID").val()
+"&Contact.IsConnected="+$("#IsConnected").val();$.ajax({type:"POST",contenttype:"application/x-www-form-urlencoded",url:"/Group/DeleteContactFromGroup",data:params,dataType:"json",cache:false,error:function(e){},success:function(data){if(data!=""){if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,"Groups");$("#RemoveContactFromGroup").overlay().close();}
else{GetContactsForGroup($("#GroupDiv_"+groupID));$("#GroupMemberDetails").html(' <div class="selectedContactsWindow  mt-1row"><div><div class="contactDetailHdr">'+callToActionMessage+'</div></div></div>');$("#RemoveContactFromGroup").overlay().close();}}}});}
var initNewInviteAction=function(jqObj){var seeMoreItem='';jqObj.find('a').click(function(e){var curr=$(this).parent();var deselectedContact='';deselectedContact=curr.find('.inviteMoreGroupID').html();var index=$.inArray(deselectedContact,selectedContactIDs,0);(index!=-1)?selectedContactIDs.splice(index,1):deSelectedContactIDs.push(deselectedContact);curr.remove();$('.inviteMoreContactList').append(curr);curr.removeClass('remainder');curr.children('ul').removeClass('fltLeft');var deleteX=curr.children('a');deleteX.remove();var arr=$('.inviteMoreContactList').children().get();arr.sort(sortContactsFirstName);$('.inviteMoreContactList').children().remove();for(i=0;i<arr.length;i++){if($(arr[i]).hasClass('inviteMoreSeeMoreItem')){seeMoreItem=arr[i];}
else{$('.inviteMoreContactList').append(arr[i]);}}
$('.inviteMoreContactList').append(seeMoreItem);$('.inviteMoreContactList').children(':not(.inviteMoreSeeMoreItem)').each(function(){initContactEntry($(this));});e.stopPropagation();e.preventDefault();});}
function InitAddEditGroups(){var seeMoreItem='';$('.inviteMoreNewInvites').children(':not(#targetDivForSelGrpID .inviteMoreSeeMoreItem)').each(function(){initNewInviteAction($(this));});$('.addToGroup').click(function(e){$('.inviteMoreContactSelected').each(function(){var curr=$(this);var selectedContact='';selectedContact=curr.find('.inviteMoreGroupID').html();var index=$.inArray(selectedContact,deSelectedContactIDs,0);(index!=-1)?deSelectedContactIDs.splice(index,1):selectedContactIDs.push(selectedContact);var deleteX=' <a class="remove fltRight" href="javascript:void(0);"><span class="hidden">Delete</span></a>'
$(this).remove();curr.removeClass('inviteMoreContactSelected');curr.addClass('remainder');curr.children('ul').addClass('fltLeft');curr.append(deleteX);$('.inviteMoreNewInvites').append(curr);});var arr=$('.inviteMoreNewInvites').children().get();arr.sort(sortContactsFirstName);$('.inviteMoreNewInvites').children().remove();for(i=0;i<arr.length;i++){if($(arr[i]).hasClass('inviteMoreSeeMoreItem')){seeMoreItem=arr[i];}
else{$('.inviteMoreNewInvites').append(arr[i]);initNewInviteAction($(arr[i]));}}
$('.inviteMoreNewInvites').append(seeMoreItem);e.preventDefault();});}
function GetAddEditGroupsPaged(){$('#GroupsErrors').html('');var params=$('#groupPageNumber').attr('name')+'='+$('#groupPageNumber').val()+'&'+$('#groupRecsPerPage').attr('name')+'='+$('#groupRecsPerPage').val();params=params+'&'+$('#SelectionCriteria').attr('name')+'='+$('#SelectionCriteria').val()+'&SelectedGroupID='+$('#SelectedGroupID').val();viewName="AddEditGroups";$.ajax({type:'GET',contentType:"application/x-www-form-urlencoded",url:'/Group/RenderAddEditGroups',data:params,dataType:'html',cache:false,error:function(e){},success:function(data){if(data!=""){if(viewName=="AddEditGroups"){$('#AddEditGroupsOverlay').find('div.overlayWrap').html(data);$('#saving').hide();$('#saveCancel').show();$('#AddEditGroupsOverlay').find('div.close').show();hallmarkBehaviors.hmkCreateReminderClone();$('#JQclone').addClass('hide');extendedBehaviors.hmkFormFocus();extendedBehaviors.hmkEnterKeyFormSubmit();}}}});}
function EditGroup(groupID){SetOmnitureDataForPopUp('Groups','edit pop - up');$('a[rel]').removeAttr('rel');clearAllErrorMessages();viewName="EditGroups";IsAddOrEditGroups="EditGroups";$('#SelectedGroupID').val(groupID)
var params="SelectedGroupID="+groupID;$.ajax({type:"GET",contenttype:"application/x-www-form-urlencoded",url:"/Group/GetAllGroupDetails",data:params,dataType:"html",cache:false,error:function(e){},success:function(data){if(data!=""){$('a[rel]').removeAttr('rel');$('#EditGroupsSection').html(data);$("#header").html($('.EditGroupHeader').html());SetCloseAddOverlay('AddEditGroupsSection','EditGroupsSection');hallmarkBehaviors.hmkTooltip();extendedBehaviors.hmkEnterKeyFormSubmit();extendedBehaviors.hmkFormFocus();}}});}
function AddEditGroups(obj){$('#GroupsErrors').html('');clearAllErrorMessages();$('#SelectedContactIDs').val(selectedContactIDs.join(','));$('#DeSelectedContactIDs').val(deSelectedContactIDs.join(','));var grpType='';if($('#Private').attr('checked')==true){grpType=1;}
else{grpType=2;}
if(IsAddOrEditGroups=="AddGroups"){$('#SelectedGroupID').val("-1");$('#SelectedGroupIDs').val("-1");}
var params="Group.GroupName="+$("#GroupName").val()+"&Group.PrivacyLevel="
+grpType+"&SelectedContactIDs="+$('#SelectedContactIDs').val()+"&DeSelectedContactIDs="+$('#DeSelectedContactIDs').val()+"&SelectedGroupID="+$('#SelectedGroupID').val();$.ajax({type:'POST',contentType:"application/x-www-form-urlencoded",url:"/Group/SaveGroups",data:params,dataType:'json',cache:false,error:function(e){},success:function(data){if(null!=data.validationErrors&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,errorPage)
hallmarkBehaviors.hmkEnableButton('.JQDisableAction');scrollToElement("msgDiv\\.AddEditGroups");s.prop14=data.validationErrors[0].Message;evalOmniture();s.prop14='';}
else{if(data!=""){$('#groupPageNumber').val(data.Groups.CurrentPageNumber);if(data.validationErrors!=null&&data.validationErrors.length>0){displayErrorMessagesOnReLoad(data.validationErrors,errorPage);$('#AddEditGroupsOverlay').find('div.close').show();viewName="AddEditGroups";}
else{if(viewName=="AddEditGroups"){GetGroupsPaged();}
else if(viewName=="EditGroups"){viewName="AddressBook";window.location.reload();}
else{if($('div.secondLevel').find('.secHead_Groups').hasClass('selected')){window.location.reload();}
else{hallmarkBehaviors.hmkEnableButton('.JQDisableAction');$('#ShowAddEditContact').find('div.close').trigger('click');}}}}}}});}
function DisplayDeleteGroup(id){$('#SelectedGroupID').val(id);$('a[rel]').removeAttr('rel');hallmarkBehaviors.hmkOverlay();clearAllErrorMessages();$("#DeleteGroup").overlay({api:true,speed:200,expose:{maskId:'overlyMask',loadSpeed:800,opacity:0.9},onBeforeLoad:function(){var wrap=this.getContent().find("div.wrap");if(wrap.is(":empty")){wrap.load(this.getTrigger().attr("href"));}},onClose:function(){$("#DeleteGroup.wrap").empty();},closeOnClick:false}).load();setTimeout(function(){extendedBehaviors.hmkFormFocusOverlay($('#DeleteGroup'));},1000);$(".close").click(function(){$("#DeleteGroup").overlay().close();$('.JQDropdownOptions').attr('checked','');});}
function DisplayRemoveContactFromGroup(groupID,contactID){$("#SelectedGroupID").val(groupID);$("#SelectedContactID").val(contactID);clearAllErrorMessages();$("#RemoveContactFromGroup").overlay({api:true,speed:200,expose:{maskId:'overlyMask',loadSpeed:800,opacity:0.9},onBeforeLoad:function(){var wrap=this.getContent().find("div.wrap");if(wrap.is(":empty")){wrap.load(this.getTrigger().attr("href"));}},onClose:function(){$("#RemoveContactFromGroup.wrap").empty();},closeOnClick:false}).load();setTimeout(function(){extendedBehaviors.hmkFormFocusOverlay($('#DeleteGroup'));},1000);$(".close").click(function(){$("#RemoveContactFromGroup").overlay().close();$('.JQDropdownOptions').attr('checked','');});}