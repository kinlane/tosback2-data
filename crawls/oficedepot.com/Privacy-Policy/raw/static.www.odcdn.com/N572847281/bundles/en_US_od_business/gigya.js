var globalGigyaEventObj;var gigyaPrompt=false;var gigyaInit=false;$(document).ready(function(){$(document).on("click","#gigyaDisabledLink",function(a){a.preventDefault();$("div#gigyaDisabledMessage").show()});$(document).on("click","#gigyaLoginDiv",function(a){if(coreMetricsEnabled){cmCreateConversionEventTag("LOGGED IN GIGYA","1","ACCOUNT")}});$(document).on("click","#createAccount",function(a){if(!gigyaInit){return}a.preventDefault();$(".ui-dialog").remove();modalShippingInfo()});$(document).on("click","#retrieveLostPasswordLink",function(a){if(!gigyaInit){return}a.preventDefault();$(".ui-dialog").remove();showRetrieveLostPasswordModal()});$(document).on("click","#createNewAccount",function(a){if(!gigyaInit){return}a.preventDefault();common_uielements.showAjaxLoadingInsideElement("div#shippingContentBody");removeGigyaShippingErrorMessage();if(!validateShippingForm()){$(".loadingMoreResults").remove();return}$.ajax({url:"https://"+location.host+"/mobile/register.do",type:"post",crossDomain:true,dataType:"jsonp",data:$("#jqGigyaRegForm").serialize()})})});function buttonClicked(a){if(coreMetricsEnabled){cmCreateConversionEventTag("LOGGED IN GIGYA","1","ACCOUNT")}}function showGigyaShippingErrorMessage(a){displayCommonErrorMessage([a],"shippingGigyaErrors");$(".loadingMoreResults").remove()}function enforceNumeric(a){$(document).on("keyup",a,function(b){$(b.target).val($(b.target).val().replace(/[^0-9]+/g,""))})}function showRetrieveLostPasswordModal(){if(!$("#modalRetrieveLostPassword").exists()){$("#header").append('<div id="modalRetrieveLostPassword"></div>');$("#modalRetrieveLostPassword").hide();$("#modalRetrieveLostPassword").load(od_utils.appendSessionId("/ajaxhtml/gigyaRetrieveLostPasswordDisplayAjax.do"),function(b,a,c){if(a=="success"){modalRetrieveLostPassword("#gigyaLostPasswordDialog")}})}else{modalRetrieveLostPassword("#gigyaLostPasswordDialog")}}function showRetrieveLostPasswordSuccessModal(){if(!$("#modalRetrieveLostPasswordSuccess").exists()){$("#header").append('<div id="modalRetrieveLostPasswordSuccess"></div>');$("#modalRetrieveLostPasswordSuccess").hide();$("#modalRetrieveLostPasswordSuccess").load(od_utils.appendSessionId("/ajaxhtml/gigyaRetrieveLostPasswordDisplayAjax.do?cmd=sendSuccess"),function(b,a,c){if(a=="success"){modalRetrieveLostPasswordSuccess("#gigyaLostPasswordSuccessDialog")}})}else{modalRetrieveLostPasswordSuccess("#gigyaLostPasswordSuccessDialog")}}function modalRetrieveLostPasswordSuccess(b){var c=$(b+"Title").html();var a="<div id='retrieveLostPasswordSuccess'><div id='retrieveLostPasswordSuccessBody'>"+$(b+"Body").html()+"</div></div>";$(a).dialog({bgiframe:true,title:c,modal:true,resizable:false,draggable:false,position:"center",width:590,overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){},close:function(){$("#retrieveLostPasswordSuccess").remove()}});$(document).on("click","#sendPasswordSuccessLogin",function(d){d.preventDefault();$(".ui-dialog").remove();showLoginDialog()})}function modalRetrieveLostPassword(b){var c=$(b+"Title").html();var a="<div id='retrieveLostPassword'><div id='retrieveLostPasswordErrorMsgDiv'></div><div id='retrieveLostPasswordBody'>"+$(b+"Body").html()+"</div></div>";$(a).dialog({bgiframe:true,title:c,modal:true,resizable:false,draggable:false,position:"center",width:590,overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){$("#passwordReminderEmail").focus();enforceNumeric("#passwordReminderPhone0");enforceNumeric("#passwordReminderPhone1");enforceNumeric("#passwordReminderPhone2");$("#passwordReminderPhone0,#passwordReminderPhone1,#passwordReminderPhone2").keyup(function(d){nextInputFocus(this,d)})},close:function(){$("#retrieveLostPassword").remove()}});$(document).on("click","#sendPasswordSubmit",function(h){h.preventDefault();var g=$('input[name="passwordReminderEmail"]:visible').val();var f=$('input[name="addrsForm[0].phoneNumber1"]:visible').val();var d=$('input[name="addrsForm[0].phoneNumber2"]:visible').val();var i=$('input[name="addrsForm[0].phoneNumber3"]:visible').val();$.ajax({type:"POST",url:od_utils.appendSessionId("/mobile/gigya/retrieveLostPassword.do"),data:{email:g,phoneNumber:f+d+i},async:false,cache:false,dataType:"JSON",success:function(e){if(e.success){removeCommonErrorMessage("retrieveLostPasswordErrorMsgDiv");$(".ui-dialog").remove();showRetrieveLostPasswordSuccessModal()}else{if(e.errorMsg.length>0){displayCommonErrorMessage(e.errorMsg,"retrieveLostPasswordErrorMsgDiv")}}}})})}function showLoginDialog(){common_uielements.showModalLoginDialog("a.accountLogin","body","#accountLoginDialog",true)}function modalShippingInfo(){if(!$("#modalShipping").exists()){$("#header").append('<div id="modalShipping"></div>');$("#modalShipping").load(od_utils.appendSessionId("/ajaxhtml/gigyaRegistrationDisplayAjax.do"),function(b,a,c){if(a=="success"){modalShipping("#gigyaShippingDialog",true)}})}}function modalShipping(b,c){var a=$(b+"Title").html();var e="<div id='shippingContent'><div id='shippingContentBody'>"+$(b+"Body").html()+"</div></div>";if(c==true){removeGigyaShippingErrorMessage();var d=$(e).dialog({bgiframe:true,title:a,modal:true,resizable:false,draggable:false,position:"center",width:590,height:"auto",overlay:{opacity:0.5,background:"black"},hide:"fade",open:function(){$("#modalShipping").remove();$("#shippingContent input[name=shipToEmail]").focus();enforceNumeric("#shipToZip");enforceNumeric("#shipToPhone1");enforceNumeric("#shipToPhone2");enforceNumeric("#shipToPhone3");enforceNumeric("#shipToPhone4");populateGigyaFields()},close:function(){$("#modalShipping").remove()}})}}function displayCommonErrorMessage(d,a){var c='<ol><div class="moduleStruct errorStyle" id="error"><div class="moduleStructContent"><h3 class="errorHeader">Attention:</h3><ul class="errorList">';for(var b=0;b<d.length;b++){c+="<li>"+d[b]+"</li>"}c+="</ul></div></div>";$("#"+a).html(c)}function removeCommonErrorMessage(a){$("#"+a).html("")}function removeGigyaShippingErrorMessage(){$("#shippingGigyaErrors").html("")}function validateShippingForm(){var f=new RegExp("^\\(?(\\d{3})\\)?[-| ]?(\\d{3})[-| ]?(\\d{4})$");var l=new RegExp("^[_a-zA-Z0-9-']+(\\.[_a-zA-Z0-9-']+)*@{1}[a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+$");var x=/^\d{5}([\-]\d{4})?$/;var j=new RegExp("\\w+");var a=$("#firstName").val();var p=$("#lastName").val();var t=$("#shipToEmail").val();var s=$("#shipToPhone1").val();var r=$("#shipToPhone2").val();var q=$("#shipToPhone3").val();var o=$("#shipToPhone4").val();var k=$("#shipToZip").val();var w=$("#shipToLine1").val();var v=$("#shipToCity").val();var e=$("#shipToState").val();var i=false;if(!j.test(t)){var u=$("#shipToEmailError").val();i=true;$("#shipToEmail_error_msg").html(u).parents("li").addClass("gigya_error")}else{if(!l.test(t)){var c=$("#invalidShipToEmailError").val();i=true;$("#shipToEmail_error_msg").html(c).parents("li").addClass("gigya_error")}else{$("#shipToEmail_error_msg").html("").parents("li").removeClass("gigya_error")}}if(!j.test(a)){var n=$("#firstNameError").val();i=true;$("#firstName_error_msg").html(n).parents("li").addClass("gigya_error")}else{$("#firstName_error_msg").html("").parents("li").removeClass("gigya_error")}if(!j.test(p)){var d=$("#lastNameError").val();i=true;$("#lastName_error_msg").html(d).parents("li").addClass("gigya_error")}else{$("#lastName_error_msg").html("").parents("li").removeClass("gigya_error")}if(!j.test(w)){var y=$("#shipToLine1Error").val();i=true;$("#shipToLine1_error_msg").html(y).parents("li").addClass("gigya_error")}else{$("#shipToLine1_error_msg").html("").parents("li").removeClass("gigya_error")}if(!j.test(v)){var b=$("#shipToCityError").val();i=true;$("#shipToCity_error_msg").html(b).parents("li").addClass("gigya_error")}else{$("#shipToCity_error_msg").html("").parents("li").removeClass("gigya_error")}if(e==""){var h=$("#shipToStateError").val();i=true;$("#shipToState_error_msg").html(h).parents("li").addClass("gigya_error")}else{$("#shipToState_error_msg").html("").parents("li").removeClass("gigya_error")}if(!x.test(k)){var g=$("#invalidShipToZipError").val();i=true;$("#shipToZip_error_msg").html(g).parents("li").addClass("gigya_error")}else{$("#shipToZip_error_msg").html("").parents("li").removeClass("gigya_error")}if(!f.test(s+r+q)){var m=$("#invalidShipToPhoneError").val();i=true;$("#shipToPhone_error_msg").html(m).parents("li").addClass("gigya_error")}else{$("#shipToPhone_error_msg").html("").parents("li").removeClass("gigya_error")}if(i){displayCommonErrorMessage([$("#shippingErrorMessage").val()],"shippingGigyaErrors")}return !i}function numeric(a){a.value=a.value.replace(/[^0-9]+/g,"")}function onLoginHandler(c){var b;globalGigyaEventObj=c;if(c.user.isSiteUID){b=verifyTheSignature(c.UID,c.timestamp,c.signature,c.user.email,c.user.loginProvider,true,c.user.firstName,c.user.lastName);if(b.loginError){$("#modalLogin").remove();displayCommonErrorMessage([b.message],"loginGigyaErrors")}else{if(coreMetricsEnabled){cmCreateConversionEventTag("LOGGED IN GIGYA:"+c.user.loginProvider,"2","ACCOUNT")}var a=b.loginLocation;if(a.length>0){window.location=window.location.protocol+"//"+window.location.host+a}else{location.reload(true)}}}else{if($("#checkoutLogin").exists()||$("#registrationBody").exists()){gigyaPrompt=true;showLoginDialog()}else{modalLinkAccount()}}}function modalLinkAccount(){if(!$("#modalLink").exists()){$("#header").append('<div id="modalLink"></div>');$("#modalLink").load(od_utils.appendSessionId("/ajaxhtml/gigyaLinkAccountDisplayAjax.do"),function(b,a,c){if(a=="success"){populateLinkAccountForm("#gigyaLinkAccountModal")}})}}function populateLinkAccountForm(c){var b=verifyTheSignature(globalGigyaEventObj.UID,globalGigyaEventObj.timestamp,globalGigyaEventObj.signature,globalGigyaEventObj.user.email,globalGigyaEventObj.user.loginProvider,false,globalGigyaEventObj.user.firstName,globalGigyaEventObj.user.lastName);var d=$(c).html();$("#loginContentBody").html(d);$modalLinkAcctMsg=$("#loginContentBody").find("p#gigyaLinkAcctMsg");$modalExistingAcctMsg=$("#loginContentBody").find("p#gigyaExistingAcctMsg");$modalLinkAcctMsg.after('<p id="gigyaLinkAcctMsg2" style="display:none;"></p>');$("#loginContentBody").find("#gigyaLinkAcctMsg2").html($modalLinkAcctMsg.html());$modalLinkAcctMsg.remove();$modalExistingAcctMsg.after('<p id="gigyaExistingAcctMsg2" style="display:none;"></p>');$("#loginContentBody").find("#gigyaExistingAcctMsg2").html($modalExistingAcctMsg.html());$modalExistingAcctMsg.remove();$("#modalLink").remove();populateGigyaFields();if(b.loginFlag&&b.userID){var e=$("p#gigyaExistingAcctMsg2").html();if(globalGigyaEventObj.user.firstName){e=e.replace("Welcome!","Welcome "+globalGigyaEventObj.user.firstName+"!")}$("p#gigyaExistingAcctMsg2").html(e);$("#ui-dialog-title-loginContent").html($("#gigyaExistingAcctTitle").html());$("p#gigyaExistingAcctMsg2").show();$('input[name="loginName"]').val(b.userID)}else{var e=$("p#gigyaLinkAcctMsg2").html();if(globalGigyaEventObj.user.firstName){e=e.replace("Welcome!","Welcome "+globalGigyaEventObj.user.firstName+"!")}var a=globalGigyaEventObj.provider;if(a.length>1){a=a.charAt(0).toUpperCase()+a.slice(1)}e=e.replace("Facebook",a);$("p#gigyaLinkAcctMsg2").html(e);$("p#gigyaLinkAcctMsg2").show();$("#ui-dialog-title-loginContent").html($("#gigyaExistingAcctTitle").html())}}function populateGigyaFields(){if(!globalGigyaEventObj){return}$('input[name="gigyaUID"]').val(globalGigyaEventObj.UID);$('input[name="gigyaTimestamp"]').val(globalGigyaEventObj.timestamp);$('input[name="gigyaSignature"]').val(globalGigyaEventObj.signature);$('input[name="gigyaLoginProvider"]').val(globalGigyaEventObj.user.loginProvider)}function verifyTheSignature(a,e,b,f,d,g,h,i){encodedUID=encodeURIComponent(a);var c;$.ajax({type:"POST",url:od_utils.appendSessionId("/ajaxhtml/account/gigyaLoginAjax.do"),data:{UID:encodedUID,timestamp:e,signature:b,email:f,loginProvider:d,login:g,firstName:h,lastName:i},async:false,cache:false,success:function(j){c=$.parseJSON(j)}});return c}function gigyaRegisterCallback(a){var b=$.parseJSON(a);$(".loadingMoreResults").remove();if(b.success){if(b.errorMessages&&b.errorMessages.length>0){showGigyaShippingErrorMessage(b.errorMessages[0])}else{location.reload(true)}}else{showGigyaShippingErrorMessage(b.errorMessages[0])}};