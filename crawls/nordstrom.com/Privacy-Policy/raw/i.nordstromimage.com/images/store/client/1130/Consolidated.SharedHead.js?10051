
(function($){$.log=function(msg){if(typeof(console)!="undefined"){console.log("%s: %o",msg,this);}
return this;};$.log=function(message){if(typeof(console)!="undefined"){console.log(message);}};$.ajaxError=function(e,status,error){if(e.responseText.substr(0,5)=="<html"){document.open();document.write(e.responseText);document.close();}
else{var json;try{var json=$.parseJSON(e.responseText);}
catch(exception){$.log(e.responseText);return;}
if(json!==false&&json.errorUrl)
window.location.href=json.errorUrl;}};$.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',value,expires,path,domain,secure].join('');}else{if(undefined==name)
return;var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=cookie.substring(name.length+1);if(cookieValue.indexOf("&")>0)
cookieValue=$.unparam(cookieValue);else
cookieValue=decodeURIComponent(cookieValue);break;}}}
return cookieValue;}};$.setCookie=function(name,keyName,keyValue,daysUntilExpire){var cookie=$.cookie(name)||{};if(typeof(cookie)=="string")
cookie=$.unparam(cookie);cookie[keyName]=encodeURIComponent(keyValue);var cookieDomain=location.host.indexOf(".dev.")!=-1?".dev.nordstrom.com":".nordstrom.com";daysUntilExpire=daysUntilExpire||0;var options={"domain":cookieDomain,"path":"/"};if(daysUntilExpire!==0)
options.expires=daysUntilExpire;$.cookie(name,$.param(cookie),options);}
$.unparam=function(queryString){if(typeof(queryString)!=="string")
return queryString;var obj={};var vars=queryString.split("&");for(var i=0;i<vars.length;i++){var firstpos=vars[i].indexOf("=");var pair=[];pair[0]=vars[i].substring(0,firstpos);pair[1]=vars[i].substring(firstpos+1);pair[0]=decodeURIComponent(pair[0]);try{pair[1]=decodeURIComponent(pair[1]);}
catch(exception){pair[1]=pair[1];}
if(typeof obj[pair[0]]==="undefined"){obj[pair[0]]=pair[1];}else if(typeof obj[pair[0]]==="string"){var arr=[obj[pair[0]],pair[1]];obj[pair[0]]=arr;}else{obj[pair[0]].push(pair[1]);}}
return obj;};$.sprintf=function(format){var argv=Array.apply(null,arguments).slice(1);return format.replace($.sprintf.settings.re,$.sprintf.dispatch(argv));};$.vsprintf=function(format,data){return format.replace($.sprintf.settings.re,$.sprintf.dispatch(data));};$.sprintf.settings={formats:{'%':function(val){return'%';},'b':function(val){return parseInt(val,10).toString(2);},'c':function(val){return String.fromCharCode(parseInt(val,10));},'d':function(val){return parseInt(val,10)?parseInt(val,10):0;},'u':function(val){return Math.abs(val);},'f':function(val,p){return(p>-1)?Math.round(parseFloat(val)*Math.pow(10,p))/Math.pow(10,p):parseFloat(val);},'o':function(val){return parseInt(val,10).toString(8);},'s':function(val){return val;},'x':function(val){return(''+parseInt(val,10).toString(16)).toLowerCase();},'X':function(val){return(''+parseInt(val,10).toString(16)).toUpperCase();}},re:/%(?:(\d+)?(?:\.(\d+))?|\(([^)]+)\))([%bcdufosxX])/g};$.sprintf.dispatch=function(data){if(data.length==1&&typeof data[0]=='object'){data=data[0];return function(match,w,p,lbl,fmt,off,str){return $.sprintf.settings.formats[fmt](data[lbl]);};}else{var idx=0;return function(match,w,p,lbl,fmt,off,str){return $.sprintf.settings.formats[fmt](data[idx++],p);};}};$.getShopperFirstName=function(){var firstName=$.getShopperCookieValue('FIRSTNAME');if(firstName!=null)
return firstName.replace('+',' ');else
return'';};$.getShopperCookieValue=function(key){var cookieValue=null;if(PageParameters.nordstromCookie!=null){var nordstromCookie=$.cookie(PageParameters.nordstromCookie);if(nordstromCookie!=null){cookieValue=nordstromCookie[key.toUpperCase()];if(cookieValue==null)
cookieValue=nordstromCookie[key.toLowerCase()];}}
return cookieValue;};$.getShopperBagCount=function(){var bagCount=$.getShopperCookieValue('BAGCOUNT');if(bagCount!=null&&bagCount!='')
return parseInt(bagCount);else
return 0;};$.getBagCountMessage=function(bagCount){return bagCount;};$.getMiniBagHash=function(){var key="MiniBagHash",cookieName="minibag";var minibagCookie=$.cookie(cookieName);var currDate=new Date();if(minibagCookie!=null){return $.unparam(minibagCookie)[key];}
else{return new Date().getTime().toString();}}
$(document).ready(function(){var menuDiv=$("li:[id*='early'] > div.menu > ul");var eaNonQualifiedDiv=$("li:[id*='early'] > div.menu > div.EA-nonQualif-content");if(undefined!=PageParameters.shopperAttrEa){if((undefined!=PageParameters.segmentId&&PageParameters.segmentId=="50")||PageParameters.isPos){menuDiv.show();eaNonQualifiedDiv.hide();}
else{menuDiv.hide();eaNonQualifiedDiv.show();}}
else{menuDiv.show();eaNonQualifiedDiv.hide();}
if(PageParameters.categoryName=="Shipping Options"){cmCreatePageviewTag('Shipping Options','','/YOURACCOUNT/');}});$.registerShopperToPageParameters=function(){var shopperId=$.getShopperCookieValue('SHOPPERID');var val=(shopperId!=null)?shopperId:'';var firstName=$.getShopperCookieValue('FIRSTNAME');nameVal=(firstName!=null)?firstName.replace('+',' '):'';var shopperAttr=$.getShopperCookieValue('shopperattr');if(shopperAttr!=null&&shopperAttr!=undefined){var attributes=shopperAttr.split('|');var gender=(attributes[0]!=null&&attributes[0]!=undefined)?attributes[0]:"";var maxRewardsLevel=(attributes[1]!=null&&attributes[1]!=undefined)?attributes[1]:"";var isRegisterdForFitRecs=(attributes[2]!=null&&attributes[2]!=undefined)?attributes[2]:"";var hasMultipleRewardsLevel=(attributes[3]!=null&&attributes[3]!=undefined)?attributes[3]:"";var segmentId=(attributes[4]!=null&&attributes[4]!=undefined)?attributes[4]:"";}
var shopper={"id":val,"firstName":nameVal,"isLoggedIn":(nameVal.length>0),"gender":gender,"maxRewardsLevel":maxRewardsLevel,"isRegisterdForFitRecs":isRegisterdForFitRecs,"hasMultipleRewardsLevel":hasMultipleRewardsLevel,"segmentId":segmentId}
$.extend(PageParameters,{"shopper":shopper});$.extend(PageParameters,{"shopperId":val});$.extend(PageParameters,{"firstName":nameVal});$.extend(PageParameters,{"isLoggedIn":(nameVal.length>0)});$.extend(PageParameters,{"segmentId":segmentId});}();})(jQuery);﻿$(document).ready(function(){var personalizationCookie=$.cookie(window.PageParameters.personalizationCookie);var segmentPrefetched=false;var count=0;if(personalizationCookie!=null&&personalizationCookie!=undefined){count=personalizationCookie.ShopperSegmentPrefetchRetryCount;if(personalizationCookie.IsShopperSegmentPrefetched!=undefined&&personalizationCookie.IsShopperSegmentPrefetched=="True"){segmentPrefetched=true;}}
if(window.PageParameters.personalizedSortEnabled&&window.PageParameters.shopper.isLoggedIn==true&&segmentPrefetched==false){if(parseInt(count)<parseInt(window.PageParameters.maxNumberOfAhamSegmentRequest)){$.ajax({url:window.PageParameters.shopperSegmentPrefetchURL+window.PageParameters.shopper.id,type:"GET",dataType:"json",timeout:window.PageParameters.shopperSegmentPreFetchRequestTimeout||1000,success:function(result){$.log("Prefetched customer segment successfully.");},error:function(x,t,m){if(t==="timeout"){$.log("Prefetching of customer segment timed out.");}else{$.log("Prefetching of customer segment failed.");}}});}}});$.getShopperPersonalizedSortEligibility=function(){if(window.PageParameters.hasOwnProperty('personalizationCookie')){var personalizationCookie=$.cookie(window.PageParameters.personalizationCookie);if(personalizationCookie!=null&&personalizationCookie!=undefined)
$.extend(window.PageParameters,{"isShopperPersonalizedSortEligible":personalizationCookie.IsShopperEligible,"purchaseCount":personalizationCookie.NumberOfPurchases});}}();﻿
(function($,window){document.write("<style type='text/css'>div[data-content-source] { display:none;}</style>");window.TrialContent={dataSources:{},defaultSources:{},loadZoneSettingDefaults:{"enabledForIntlShipping":true},registerDataSource:function(name,data){this.dataSources[name]=data;$.log("TrialContent Info Log: registerDataSource invoked for "+name);},createMbox:function(name){if(window.mboxCreate&&PageParameters.trialContentEnabled&&!PageParameters.isPos){try{if(PageParameters.shopper!=null&&PageParameters.shopper!=undefined){var params=[name];params.push('shopperId='+PageParameters.shopper.id);params.push('isLoggedIn='+PageParameters.shopper.isLoggedIn);if(PageParameters.shopper.gender!=null&&PageParameters.shopper.gender!=undefined&&PageParameters.shopper.gender!='')
params.push('gender='+PageParameters.shopper.gender);if(PageParameters.shopper.maxRewardsLevel!=null&&PageParameters.shopper.maxRewardsLevel!=undefined&&PageParameters.shopper.maxRewardsLevel!='')
params.push('maxRewardsLevel='+PageParameters.shopper.maxRewardsLevel);if(PageParameters.shopper.hasMultipleRewardsLevel!=null&&PageParameters.shopper.hasMultipleRewardsLevel!=undefined&&PageParameters.shopper.hasMultipleRewardsLevel!='')
params.push('hasMultipleRewardsLevel='+PageParameters.shopper.hasMultipleRewardsLevel);if(PageParameters.shopper.isRegisterdForFitRecs!=null&&PageParameters.shopper.isRegisterdForFitRecs!=undefined&&PageParameters.shopper.isRegisterdForFitRecs!='')
params.push('isRegisterdForFitRecs='+PageParameters.shopper.isRegisterdForFitRecs);if(PageParameters.AvailableRecEngines!=null&&PageParameters.AvailableRecEngines!=undefined)
params.push('AvailableRecEngines='+PageParameters.AvailableRecEngines);if(PageParameters.keyword!=null&&PageParameters.keyword!=undefined)
params.push('Keyword='+PageParameters.keyword);if(PageParameters.IsNullSearch!=null&&PageParameters.IsNullSearch!=undefined)
params.push('IsNullSearch='+PageParameters.IsNullSearch);if(PageParameters.PersonalizedRecommendationEnabled!=null&&PageParameters.PersonalizedRecommendationEnabled!=undefined)
params.push('IsPersonalizedRecsEnabled='+PageParameters.PersonalizedRecommendationEnabled);if(PageParameters.isShopperPersonalizedSortEligible!=null&&PageParameters.isShopperPersonalizedSortEligible!=undefined)
params.push('isShopperPersonalizedSortEligible='+PageParameters.isShopperPersonalizedSortEligible);if(PageParameters.purchaseCount!=null&&PageParameters.purchaseCount!=undefined)
params.push('numberOfPurchases='+PageParameters.purchaseCount);if(window.PageParameters.isProdCatEnabledForCtlFromRR!=null&&window.PageParameters.isProdCatEnabledForCtlFromRR!=undefined)
params.push('isProdCatEnabledForCtlFromRR='+window.PageParameters.isProdCatEnabledForCtlFromRR);}
if(PageParameters.countryCode!=null&&PageParameters.countryCode!="US")
params.push('shipToCountry='+PageParameters.countryCode);if(PageParameters.productType!=null&&PageParameters.productType!=undefined){params.push('productType='+PageParameters.productType);params.push('parentProductType='+PageParameters.productType);}
if(PageParameters.productAgeGroup!=null&&PageParameters.productAgeGroup!=undefined&&(PageParameters.productAgeGroup.length>0))
params.push('productAgeGroup='+PageParameters.productAgeGroup);if(PageParameters.productGender!=null&&PageParameters.productGender!=undefined&&(PageParameters.productGender.length>0))
params.push('productGender='+PageParameters.productGender);if(PageParameters.SameDayDeliveryEligible!=null&&PageParameters.SameDayDeliveryEligible!=undefined)
params.push('sameDayShipping='+PageParameters.SameDayDeliveryEligible);if(PageParameters.ShopperIsPBPDQualified!=null&&PageParameters.ShopperIsPBPDQualified!=undefined)
params.push('shopperIsPBPDQualified='+PageParameters.ShopperIsPBPDQualified);if(PageParameters.PageType){if(PageParameters.PageType=="ProductPage"){if(PageParameters.styleNumber!=null&&PageParameters.styleNumber!=undefined){params.push('productId='+PageParameters.styleNumber);params.push('price='+0);}
if(PageParameters.productCategoryId!=null&&PageParameters.productCategoryId!=undefined)
params.push('categoryId='+PageParameters.productCategoryId);if(PageParameters.VideoAltsEnabled!=null&&PageParameters.VideoAltsEnabled!=undefined)
params.push('VideoAltsEnabled='+PageParameters.VideoAltsEnabled);if(PageParameters.ProductVideoAvailable!=null&&PageParameters.ProductVideoAvailable!=undefined)
params.push('ProductVideoAvailable='+PageParameters.ProductVideoAvailable);if(PageParameters.ProductVideoPlayed!=null&&PageParameters.ProductVideoPlayed!=undefined)
params.push('ProductVideoPlayed='+PageParameters.ProductVideoPlayed);}
if(PageParameters.PageType=="OutfitPage"){if(PageParameters.styleNumber!=null&&PageParameters.styleNumber!=undefined&&PageParameters.outfitStyles!=null&&PageParameters.outfitStyles!=undefined){params.push('productId='+PageParameters.styleNumber+'~'+PageParameters.outfitStyles);params.push('totalPrice='+0);}
if(PageParameters.productCategoryId!=null&&PageParameters.productCategoryId!=undefined)
params.push('categoryId='+PageParameters.productCategoryId);}
if(PageParameters.PageType=="ShoppingBagPage"){if(PageParameters.UserHasQualifiedItem!=null&&PageParameters.UserHasQualifiedItem!=undefined)
params.push('UserHasQualifiedItem='+PageParameters.UserHasQualifiedItem);if(PageParameters.UserHasSamples!=null&&PageParameters.UserHasSamples!=undefined)
params.push('UserHasSamples='+PageParameters.UserHasSamples);}
if(PageParameters.PageType=="SearchPage"){params.push('OutfitsInSearchResultsEnabled='+PageParameters.OutfitsInSearchResultsEnabled);params.push('PageNo=0');params.push('OutfitAvailable=false');params.push('Category360VideoEnabled='+PageParameters.Category360VideoEnabled);params.push('VideoonSearchBrowse='+false);}
if(PageParameters.PageType=="CategoryPage"){if(PageParameters.Category360VideoEnabled!=null&&PageParameters.Category360VideoEnabled!=undefined){params.push('Category360VideoEnabled='+PageParameters.Category360VideoEnabled);params.push('VideoonSearchBrowse='+false);}}}
if(PageParameters.templateName!=null&&PageParameters.templateName!=undefined)
params.push('TemplateName='+PageParameters.templateName);mboxCreate.apply(window,params);}
catch(err){$.log(err.description);}}},updateMbox:function(name,paramValues){if(window.mboxUpdate&&PageParameters.trialContentEnabled&&!PageParameters.isPos){try{var params=[name];if(PageParameters.PageType){if(!paramValues)
return;for(var param in paramValues){if(param)
params.push(param+'='+paramValues[param]);}}
if(params.length>0)
mboxUpdate.apply(window,params);}
catch(err){$.log(err.description);}}},loadZone:function(id,settings){$.log("TrialContent Info Log: loadZone invoked for "+id);var zoneContainer=$("#"+id);settings=$.extend({},this.loadZoneSettingDefaults,settings);if(!settings.enabledForIntlShipping){if(PageParameters.isInternationalShipEnabled==true&&(PageParameters.countryCode!=null&&PageParameters.countryCode!="US")){zoneContainer.css("display","block");return;}}
if(zoneContainer.length==0)
return;if(this.dataSources==undefined){zoneContainer.css("display","block");return;}
var dataSourceName=zoneContainer.attr("data-content-source");var dataSource=this.dataSources[dataSourceName];if(location.search.indexOf("cog=1")!=-1){if(this.defaultSources[dataSourceName]==undefined)
this.defaultSources[dataSourceName]={};this.defaultSources[dataSourceName][id]=zoneContainer.html();}
if(dataSource==undefined){zoneContainer.css("display","block");return;}
var parameterValues=dataSource[zoneContainer.attr("id")];if(parameterValues==undefined){zoneContainer.css("display","block");return;}
$.each(parameterValues,function(key,value){if(key==undefined||value==undefined)
return true;if(key=="content-version"){var syndicatedContainer=zoneContainer.attr("data-container");if(syndicatedContainer==undefined){return true;}
$.ajax({url:(window.location.host.split('shop').length>1)?"/TC":"/TemplateSyndicationProxy.axd",data:"ct=C&tn="+syndicatedContainer+"&version="+value,async:false,error:function(xhr,status,error){$.log(xhr.responseText);},success:function(results){zoneContainer.html(results);}});}
else{try{var id=key.split("-")[0];var attr=key.split("-")[1];var elem=zoneContainer.find("#"+id);if(elem==undefined||elem.length==0)
return true;switch(attr.toString().toLowerCase()){case"text":elem[0].innerText=value;break;case"style":case"href":elem.attr(attr,TrialContent.replaceParameterUrls(value));break;case"html":elem[0].innerHTML=TrialContent.replaceParameterUrls(value);break;case"src":elem.attr(attr,"");elem.attr(attr,TrialContent.replaceParameterUrls(value));break;default:elem.attr(attr,value);break;}
elem.addClass("TNTLoaded");}
catch(err){$.log(err.description);}}});zoneContainer.css("display","block");},replaceParameterUrls:function(value){return value.replace(/\[-% Secure %-]/g,PageParameters.secureUrl).replace(/\[-% Image %-]/g,PageParameters.imageUrl).replace(/\[-% Store %-]/g,PageParameters.storeUrl).replace(/\[-% About %-]/g,PageParameters.aboutUrl);},openAdmin:function(){window.open(PageParameters.cogUrl+"/cog.htm","ContentOfferGenerator","height=400,width=600,scrollbars=yes",true).focus();},toggleQueryString:function(queryString,e){browserURL=window.content.document.location.toString();if(browserURL.indexOf(queryString)>-1){browserURL=browserURL.replace(queryString+"&","");browserURL=browserURL.replace("?"+queryString,"");browserURL=browserURL.replace("&"+queryString,"");}
else{var queryDelimeter=(browserURL.indexOf("?")>-1)?"&":"?";browserURL+=queryDelimeter+queryString;}
window.content.document.location=browserURL;}};})(jQuery,window);if (PageParameters.isPos !== true) { var mboxCopyright = "Copyright 1996-2009. Adobe Systems Incorporated. All rights reserved"; mboxUrlBuilder = function (a, b) { this.a = a; this.b = b; this.c = new Array(); this.d = function (e) { return e; }; this.f = null; }; mboxUrlBuilder.prototype.addParameter = function (g, h) { var i = new RegExp('(\'|")'); if (i.exec(g)) { throw "Parameter '" + g + "' contains invalid characters"; } for (var j = 0; j < this.c.length; j++) { var k = this.c[j]; if (k.name == g) { k.value = h; return this; } } var l = new Object(); l.name = g; l.value = h; this.c[this.c.length] = l; return this; }; mboxUrlBuilder.prototype.addParameters = function (c) { if (!c) { return this; } for (var j = 0; j < c.length; j++) { var m = c[j].indexOf('='); if (m == -1 || m == 0) { continue; } this.addParameter(c[j].substring(0, m), c[j].substring(m + 1, c[j].length)); } return this; }; mboxUrlBuilder.prototype.setServerType = function (n) { this.o = n; }; mboxUrlBuilder.prototype.setBasePath = function (f) { this.f = f; }; mboxUrlBuilder.prototype.setUrlProcessAction = function (p) { this.d = p; }; mboxUrlBuilder.prototype.buildUrl = function () { var q = this.f ? this.f : '/m2/' + this.b + '/mbox/' + this.o; var r = document.location.protocol == 'file:' ? 'http:' : document.location.protocol; var e = r + "//" + this.a + q; var s = e.indexOf('?') != -1 ? '&' : '?'; for (var j = 0; j < this.c.length; j++) { var k = this.c[j]; e += s + encodeURIComponent(k.name) + '=' + encodeURIComponent(k.value); s = '&'; } return this.t(this.d(e)); }; mboxUrlBuilder.prototype.getParameters = function () { return this.c; }; mboxUrlBuilder.prototype.setParameters = function (c) { this.c = c; }; mboxUrlBuilder.prototype.clone = function () { var u = new mboxUrlBuilder(this.a, this.b); u.setServerType(this.o); u.setBasePath(this.f); u.setUrlProcessAction(this.d); for (var j = 0; j < this.c.length; j++) { u.addParameter(this.c[j].name, this.c[j].value); } return u; }; mboxUrlBuilder.prototype.t = function (v) { return v.replace(/\"/g, '&quot;').replace(/>/g, '&gt;'); }; mboxStandardFetcher = function () { }; mboxStandardFetcher.prototype.getType = function () { return 'standard'; }; mboxStandardFetcher.prototype.fetch = function (w) { w.setServerType(this.getType()); document.write('<' + 'scr' + 'ipt src="' + w.buildUrl() + '" language="JavaScript"><' + '\/scr' + 'ipt>'); }; mboxStandardFetcher.prototype.cancel = function () { }; mboxAjaxFetcher = function () { }; mboxAjaxFetcher.prototype.getType = function () { return 'ajax'; }; mboxAjaxFetcher.prototype.fetch = function (w) { w.setServerType(this.getType()); var e = w.buildUrl(); this.x = document.createElement('script'); this.x.src = e; document.body.appendChild(this.x); }; mboxAjaxFetcher.prototype.cancel = function () { }; mboxMap = function () { this.y = new Object(); this.z = new Array(); }; mboxMap.prototype.put = function (A, h) { if (!this.y[A]) { this.z[this.z.length] = A; } this.y[A] = h; }; mboxMap.prototype.get = function (A) { return this.y[A]; }; mboxMap.prototype.remove = function (A) { this.y[A] = undefined; }; mboxMap.prototype.each = function (p) { for (var j = 0; j < this.z.length; j++) { var A = this.z[j]; var h = this.y[A]; if (h) { p(A, h); } } }; mboxFactory = function (B, b, C) { this.D = false; this.B = B; this.C = C; this.E = new mboxList(); mboxFactories.put(C, this); this.F = typeof document.createElement('div').replaceChild != 'undefined' && (function () { return true; })() && typeof document.getElementById != 'undefined' && typeof (window.attachEvent || document.addEventListener || window.addEventListener) != 'undefined' && typeof encodeURIComponent != 'undefined'; this.G = this.F && mboxGetPageParameter('mboxDisable') == null; var H = C == 'default'; this.I = new mboxCookieManager('mbox' + (H ? '' : ('-' + C)), (function () { return mboxCookiePageDomain(); })()); this.G = this.G && this.I.isEnabled() && (this.I.getCookie('disable') == null); if (this.isAdmin()) { this.enable(); } this.J = mboxGenerateId(); this.K = mboxScreenHeight(); this.L = mboxScreenWidth(); this.M = mboxBrowserWidth(); this.N = mboxBrowserHeight(); this.O = mboxScreenColorDepth(); this.P = mboxBrowserTimeOffset(); this.Q = new mboxSession(this.J, 'mboxSession', 'session', 31 * 60, this.I); this.R = new mboxPC('PC', 1209600, this.I); this.w = new mboxUrlBuilder(B, b); this.S(this.w, H); this.T = new Date().getTime(); this.U = this.T; var V = this; this.addOnLoad(function () { V.U = new Date().getTime(); }); if (this.F) { this.addOnLoad(function () { V.D = true; V.getMboxes().each(function (W) { W.setFetcher(new mboxAjaxFetcher()); W.finalize(); }); }); this.limitTraffic(100, 10368000); if (this.G) { this.X(); this.Y = new mboxSignaler(function (Z, c) { return V.create(Z, c); }, this.I); } } }; mboxFactory.prototype.isEnabled = function () { return this.G; }; mboxFactory.prototype.getDisableReason = function () { return this.I.getCookie('disable'); }; mboxFactory.prototype.isSupported = function () { return this.F; }; mboxFactory.prototype.disable = function (_, ab) { if (typeof _ == 'undefined') { _ = 60 * 60; } if (typeof ab == 'undefined') { ab = 'unspecified'; } if (!this.isAdmin()) { this.G = false; this.I.setCookie('disable', ab, _); } }; mboxFactory.prototype.enable = function () { this.G = true; this.I.deleteCookie('disable'); }; mboxFactory.prototype.isAdmin = function () { return document.location.href.indexOf('mboxEnv') != -1; }; mboxFactory.prototype.limitTraffic = function (bb, _) { }; mboxFactory.prototype.addOnLoad = function (p) { if (window.addEventListener) { window.addEventListener('load', p, false); } else if (document.addEventListener) { document.addEventListener('load', p, false); } else if (document.attachEvent) { window.attachEvent('onload', p); } }; mboxFactory.prototype.getEllapsedTime = function () { return this.U - this.T; }; mboxFactory.prototype.getEllapsedTimeUntil = function (cb) { return cb - this.T; }; mboxFactory.prototype.getMboxes = function () { return this.E; }; mboxFactory.prototype.get = function (Z, db) { return this.E.get(Z).getById(db || 0); }; mboxFactory.prototype.update = function (Z, c) { if (!this.isEnabled()) { return; } if (this.E.get(Z).length() == 0) { throw "Mbox " + Z + " is not defined"; } this.E.get(Z).each(function (W) { W.getUrlBuilder().addParameter('mboxPage', mboxGenerateId()); W.load(c); }); }; mboxFactory.prototype.create = function (Z, c, eb) { if (!this.isSupported()) { return null; } var e = this.w.clone(); e.addParameter('mboxCount', this.E.length() + 1); e.addParameters(c); var db = this.E.get(Z).length(); var fb = this.C + '-' + Z + '-' + db; var gb; if (eb) { gb = new mboxLocatorNode(eb); } else { if (this.D) { throw 'The page has already been loaded, can\'t write marker'; } gb = new mboxLocatorDefault(fb); } try { var V = this; var hb = 'mboxImported-' + fb; var W = new mbox(Z, db, e, gb, hb); if (this.G) { W.setFetcher(this.D ? new mboxAjaxFetcher() : new mboxStandardFetcher()); } W.setOnError(function (ib, n) { W.setMessage(ib); W.activate(); if (!W.isActivated()) { V.disable(60 * 60, ib); window.location.reload(false); } }); this.E.add(W); } catch (jb) { this.disable(); throw 'Failed creating mbox "' + Z + '", the error was: ' + jb; } var kb = new Date(); e.addParameter('mboxTime', kb.getTime() - (kb.getTimezoneOffset() * 60000)); return W; }; mboxFactory.prototype.getCookieManager = function () { return this.I; }; mboxFactory.prototype.getPageId = function () { return this.J; }; mboxFactory.prototype.getPCId = function () { return this.R; }; mboxFactory.prototype.getSessionId = function () { return this.Q; }; mboxFactory.prototype.getSignaler = function () { return this.Y; }; mboxFactory.prototype.getUrlBuilder = function () { return this.w; }; mboxFactory.prototype.S = function (e, H) { e.addParameter('mboxHost', document.location.hostname).addParameter('mboxSession', this.Q.getId()); if (!H) { e.addParameter('mboxFactoryId', this.C); } if (this.R.getId() != null) { e.addParameter('mboxPC', this.R.getId()); } e.addParameter('mboxPage', this.J); e.addParameter('screenHeight', this.K); e.addParameter('screenWidth', this.L); e.addParameter('browserWidth', this.M); e.addParameter('browserHeight', this.N); e.addParameter('browserTimeOffset', this.P); e.addParameter('colorDepth', this.O); e.setUrlProcessAction(function (e) { e += '&mboxURL=' + encodeURIComponent(document.location); var lb = encodeURIComponent(document.referrer); if (e.length + lb.length < 2000) { e += '&mboxReferrer=' + lb; } e += '&mboxVersion=' + mboxVersion; return e; }); }; mboxFactory.prototype.mb = function () { return ""; }; mboxFactory.prototype.X = function () { document.write('<style>.' + 'mboxDefault' + ' { visibility:hidden; }</style>'); }; mboxFactory.prototype.isDomLoaded = function () { return this.D; }; mboxSignaler = function (nb, I) { this.I = I; var ob = I.getCookieNames('signal-'); for (var j = 0; j < ob.length; j++) { var pb = ob[j]; var qb = I.getCookie(pb).split('&'); var W = nb(qb[0], qb); W.load(); I.deleteCookie(pb); } }; mboxSignaler.prototype.signal = function (rb, Z) { this.I.setCookie('signal-' + rb, mboxShiftArray(arguments).join('&'), 45 * 60); }; mboxList = function () { this.E = new Array(); }; mboxList.prototype.add = function (W) { if (W != null) { this.E[this.E.length] = W; } }; mboxList.prototype.get = function (Z) { var sb = new mboxList(); for (var j = 0; j < this.E.length; j++) { var W = this.E[j]; if (W.getName() == Z) { sb.add(W); } } return sb; }; mboxList.prototype.getById = function (tb) { return this.E[tb]; }; mboxList.prototype.length = function () { return this.E.length; }; mboxList.prototype.each = function (p) { if (typeof p != 'function') { throw 'Action must be a function, was: ' + typeof (p); } for (var j = 0; j < this.E.length; j++) { p(this.E[j]); } }; mboxLocatorDefault = function (g) { this.g = 'mboxMarker-' + g; document.write('<div id="' + this.g + '" style="visibility:hidden;display:none">&nbsp;</div>'); }; mboxLocatorDefault.prototype.locate = function () { var ub = document.getElementById(this.g); while (ub != null) { if (ub.nodeType == 1) { if (ub.className == 'mboxDefault') { return ub; } } ub = ub.previousSibling; } return null; }; mboxLocatorDefault.prototype.force = function () { var vb = document.createElement('div'); vb.className = 'mboxDefault'; var wb = document.getElementById(this.g); wb.parentNode.insertBefore(vb, wb); return vb; }; mboxLocatorNode = function (xb) { this.ub = xb; }; mboxLocatorNode.prototype.locate = function () { return typeof this.ub == 'string' ? document.getElementById(this.ub) : this.ub; }; mboxLocatorNode.prototype.force = function () { return null; }; mboxCreate = function (Z) { var W = mboxFactoryDefault.create(Z, mboxShiftArray(arguments)); if (W) { W.load(); } return W; }; mboxDefine = function (eb, Z) { var W = mboxFactoryDefault.create(Z, mboxShiftArray(mboxShiftArray(arguments)), eb); return W; }; mboxUpdate = function (Z) { mboxFactoryDefault.update(Z, mboxShiftArray(arguments)); }; mbox = function (g, yb, w, zb, hb) { this.Ab = null; this.Bb = 0; this.gb = zb; this.hb = hb; this.Cb = null; this.Db = new mboxOfferContent(); this.vb = null; this.w = w; this.message = ''; this.Eb = new Object(); this.Fb = 0; this.yb = yb; this.g = g; this.Gb(); w.addParameter('mbox', g).addParameter('mboxId', yb); this.Hb = function () { }; this.Ib = function () { }; this.Jb = null; }; mbox.prototype.getId = function () { return this.yb; }; mbox.prototype.Gb = function () { if (this.g.length > 250) { throw "Mbox Name " + this.g + " exceeds max length of " + "250 characters."; } else if (this.g.match(/^\s+|\s+$/g)) { throw "Mbox Name " + this.g + " has leading/trailing whitespace(s)."; } }; mbox.prototype.getName = function () { return this.g; }; mbox.prototype.getParameters = function () { var c = this.w.getParameters(); var sb = new Array(); for (var j = 0; j < c.length; j++) { if (c[j].name.indexOf('mbox') != 0) { sb[sb.length] = c[j].name + '=' + c[j].value; } } return sb; }; mbox.prototype.setOnLoad = function (p) { this.Ib = p; return this; }; mbox.prototype.setMessage = function (ib) { this.message = ib; return this; }; mbox.prototype.setOnError = function (Hb) { this.Hb = Hb; return this; }; mbox.prototype.setFetcher = function (Kb) { if (this.Cb) { this.Cb.cancel(); } this.Cb = Kb; return this; }; mbox.prototype.getFetcher = function () { return this.Cb; }; mbox.prototype.load = function (c) { if (this.Cb == null) { return this; } this.setEventTime("load.start"); this.cancelTimeout(); this.Bb = 0; var w = (c && c.length > 0) ? this.w.clone().addParameters(c) : this.w; this.Cb.fetch(w); var V = this; this.Lb = setTimeout(function () { V.Hb('browser timeout', V.Cb.getType()); }, PageParameters.trialContentTimeout); this.setEventTime("load.end"); return this; }; mbox.prototype.loaded = function () { this.cancelTimeout(); if (!this.activate()) { var V = this; setTimeout(function () { V.loaded(); }, 100); } }; mbox.prototype.activate = function () { if (this.Bb) { return this.Bb; } this.setEventTime('activate' + ++this.Fb + '.start'); if (this.show()) { this.cancelTimeout(); this.Bb = 1; } this.setEventTime('activate' + this.Fb + '.end'); return this.Bb; }; mbox.prototype.isActivated = function () { return this.Bb; }; mbox.prototype.setOffer = function (Db) { if (Db && Db.show && Db.setOnLoad) { this.Db = Db; } else { throw 'Invalid offer'; } return this; }; mbox.prototype.getOffer = function () { return this.Db; }; mbox.prototype.show = function () { this.setEventTime('show.start'); var sb = this.Db.show(this); this.setEventTime(sb == 1 ? "show.end.ok" : "show.end"); return sb; }; mbox.prototype.showContent = function (Mb) { if (Mb == null) { return 0; } if (this.vb == null || !this.vb.parentNode) { this.vb = this.getDefaultDiv(); if (this.vb == null) { return 0; } } if (this.vb != Mb) { this.Nb(this.vb); this.vb.parentNode.replaceChild(Mb, this.vb); this.vb = Mb; } this.Ob(Mb); this.Ib(); return 1; }; mbox.prototype.hide = function () { this.setEventTime('hide.start'); var sb = this.showContent(this.getDefaultDiv()); this.setEventTime(sb == 1 ? 'hide.end.ok' : 'hide.end.fail'); return sb; }; mbox.prototype.finalize = function () { this.setEventTime('finalize.start'); this.cancelTimeout(); if (this.getDefaultDiv() == null) { if (this.gb.force() != null) { this.setMessage('No default content, an empty one has been added'); } else { this.setMessage('Unable to locate mbox'); } } if (!this.activate()) { this.hide(); this.setEventTime('finalize.end.hide'); } this.setEventTime('finalize.end.ok'); }; mbox.prototype.cancelTimeout = function () { if (this.Lb) { clearTimeout(this.Lb); } if (this.Cb != null) { this.Cb.cancel(); } }; mbox.prototype.getDiv = function () { return this.vb; }; mbox.prototype.getDefaultDiv = function () { if (this.Jb == null) { this.Jb = this.gb.locate(); } return this.Jb; }; mbox.prototype.setEventTime = function (Pb) { this.Eb[Pb] = (new Date()).getTime(); }; mbox.prototype.getEventTimes = function () { return this.Eb; }; mbox.prototype.getImportName = function () { return this.hb; }; mbox.prototype.getURL = function () { return this.w.buildUrl(); }; mbox.prototype.getUrlBuilder = function () { return this.w; }; mbox.prototype.Qb = function (vb) { return vb.style.display != 'none'; }; mbox.prototype.Ob = function (vb) { this.Rb(vb, true); }; mbox.prototype.Nb = function (vb) { this.Rb(vb, false); }; mbox.prototype.Rb = function (vb, Sb) { vb.style.visibility = Sb ? "visible" : "hidden"; vb.style.display = Sb ? "block" : "none"; }; mboxOfferContent = function () { this.Ib = function () { }; }; mboxOfferContent.prototype.show = function (W) { var sb = W.showContent(document.getElementById(W.getImportName())); if (sb == 1) { this.Ib(); } return sb; }; mboxOfferContent.prototype.setOnLoad = function (Ib) { this.Ib = Ib; }; mboxOfferAjax = function (Mb) { this.Mb = Mb; this.Ib = function () { }; }; mboxOfferAjax.prototype.setOnLoad = function (Ib) { this.Ib = Ib; }; mboxOfferAjax.prototype.show = function (W) { var Tb = document.createElement('div'); Tb.id = W.getImportName(); Tb.innerHTML = this.Mb; var sb = W.showContent(Tb); if (sb == 1) { this.Ib(); } return sb; }; mboxOfferDefault = function () { this.Ib = function () { }; }; mboxOfferDefault.prototype.setOnLoad = function (Ib) { this.Ib = Ib; }; mboxOfferDefault.prototype.show = function (W) { var sb = W.hide(); if (sb == 1) { this.Ib(); } return sb; }; mboxCookieManager = function mboxCookieManager(g, Ub) { this.g = g; this.Ub = Ub == '' || Ub.indexOf('.') == -1 ? '' : '; domain=' + Ub; this.Vb = new mboxMap(); this.loadCookies(); }; mboxCookieManager.prototype.isEnabled = function () { this.setCookie('check', 'true', 60); this.loadCookies(); return this.getCookie('check') == 'true'; }; mboxCookieManager.prototype.setCookie = function (g, h, _) { if (typeof g != 'undefined' && typeof h != 'undefined' && typeof _ != 'undefined') { var Wb = new Object(); Wb.name = g; Wb.value = escape(h); Wb.expireOn = Math.ceil(_ + new Date().getTime() / 1000); this.Vb.put(g, Wb); this.saveCookies(); } }; mboxCookieManager.prototype.getCookie = function (g) { var Wb = this.Vb.get(g); return Wb ? unescape(Wb.value) : null; }; mboxCookieManager.prototype.deleteCookie = function (g) { this.Vb.remove(g); this.saveCookies(); }; mboxCookieManager.prototype.getCookieNames = function (Xb) { var Yb = new Array(); this.Vb.each(function (g, Wb) { if (g.indexOf(Xb) == 0) { Yb[Yb.length] = g; } }); return Yb; }; mboxCookieManager.prototype.saveCookies = function () { var Zb = new Array(); var _b = 0; this.Vb.each(function (g, Wb) { Zb[Zb.length] = g + '#' + Wb.value + '#' + Wb.expireOn; if (_b < Wb.expireOn) { _b = Wb.expireOn; } }); var ac = new Date(_b * 1000); document.cookie = this.g + '=' + Zb.join('|') + '; expires=' + ac.toGMTString() + '; path=/' + this.Ub; }; mboxCookieManager.prototype.loadCookies = function () { this.Vb = new mboxMap(); var bc = document.cookie.indexOf(this.g + '='); if (bc != -1) { var cc = document.cookie.indexOf(';', bc); if (cc == -1) { cc = document.cookie.indexOf(',', bc); if (cc == -1) { cc = document.cookie.length; } } var dc = document.cookie.substring(bc + this.g.length + 1, cc).split('|'); var ec = Math.ceil(new Date().getTime() / 1000); for (var j = 0; j < dc.length; j++) { var Wb = dc[j].split('#'); if (ec <= Wb[2]) { var fc = new Object(); fc.name = Wb[0]; fc.value = Wb[1]; fc.expireOn = Wb[2]; this.Vb.put(fc.name, fc); } } } }; mboxSession = function (gc, hc, pb, ic, I) { this.hc = hc; this.pb = pb; this.ic = ic; this.I = I; this.jc = false; this.yb = typeof mboxForceSessionId != 'undefined' ? mboxForceSessionId : mboxGetPageParameter(this.hc); if (this.yb == null || this.yb.length == 0) { this.yb = I.getCookie(pb); if (this.yb == null || this.yb.length == 0) { this.yb = gc; this.jc = true; } } I.setCookie(pb, this.yb, ic); }; mboxSession.prototype.getId = function () { return this.yb; }; mboxSession.prototype.forceId = function (kc) { this.yb = kc; this.I.setCookie(this.pb, this.yb, this.ic); }; mboxPC = function (pb, ic, I) { this.pb = pb; this.ic = ic; this.I = I; this.yb = typeof mboxForcePCId != 'undefined' ? mboxForcePCId : I.getCookie(pb); if (this.yb != null) { I.setCookie(pb, this.yb, ic); } }; mboxPC.prototype.getId = function () { return this.yb; }; mboxPC.prototype.forceId = function (kc) { if (this.yb != kc) { this.yb = kc; this.I.setCookie(this.pb, this.yb, this.ic); return true; } return false; }; mboxGetPageParameter = function (g) { var sb = null; var lc = new RegExp(g + "=([^\&]*)"); var mc = lc.exec(document.location); if (mc != null && mc.length >= 2) { sb = mc[1]; } return sb; }; mboxSetCookie = function (g, h, _) { return mboxFactoryDefault.getCookieManager().setCookie(g, h, _); }; mboxGetCookie = function (g) { return mboxFactoryDefault.getCookieManager().getCookie(g); }; mboxCookiePageDomain = function () { var Ub = (/([^:]*)(:[0-9]{0,5})?/).exec(document.location.host)[1]; var nc = /[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/; if (!nc.exec(Ub)) { var oc = (/([^\.]+\.[^\.]{3}|[^\.]+\.[^\.]+\.[^\.]{2})$/).exec(Ub); if (oc) { Ub = oc[0]; } } return Ub ? Ub : ""; }; mboxShiftArray = function (pc) { var sb = new Array(); for (var j = 1; j < pc.length; j++) { sb[sb.length] = pc[j]; } return sb; }; mboxGenerateId = function () { return (new Date()).getTime() + "-" + Math.floor(Math.random() * 999999); }; mboxScreenHeight = function () { return screen.height; }; mboxScreenWidth = function () { return screen.width; }; mboxBrowserWidth = function () { return (window.innerWidth) ? window.innerWidth : document.documentElement ? document.documentElement.clientWidth : document.body.clientWidth; }; mboxBrowserHeight = function () { return (window.innerHeight) ? window.innerHeight : document.documentElement ? document.documentElement.clientHeight : document.body.clientHeight; }; mboxBrowserTimeOffset = function () { return -new Date().getTimezoneOffset(); }; mboxScreenColorDepth = function () { return screen.pixelDepth; }; if (typeof mboxVersion == 'undefined') { var mboxVersion = 39; var mboxFactories = new mboxMap(); var mboxFactoryDefault = new mboxFactory('nordstrominc.tt.omtrdc.net', 'nordstrominc', 'default'); }; if (mboxGetPageParameter("mboxDebug") != null || mboxFactoryDefault.getCookieManager().getCookie("debug") != null) { setTimeout(function () { if (typeof mboxDebugLoaded == 'undefined') { alert('Could not load the remote debug.\nPlease check your connection' + ' to Test&amp;Target servers'); } }, 60 * 60); document.write('<' + 'scr' + 'ipt language="Javascript1.2" src=' + '"http://admin5.testandtarget.omniture.com/admin/mbox/mbox_debug.jsp?mboxServerHost=nordstrominc.tt.omtrdc.net' + '&clientCode=nordstrominc"><' + '\/scr' + 'ipt>'); }; }