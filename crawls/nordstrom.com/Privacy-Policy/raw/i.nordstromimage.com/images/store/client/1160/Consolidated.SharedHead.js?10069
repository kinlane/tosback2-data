
(function($){$.log=function(msg){if(typeof(console)!="undefined"){console.log("%s: %o",msg,this);}
return this;};$.log=function(message){if(typeof(console)!="undefined"){console.log(message);}};$.ajaxError=function(e,status,error){if(e.responseText.substr(0,5)=="<html"){document.open();document.write(e.responseText);document.close();}
else{var json;try{var json=$.parseJSON(e.responseText);}
catch(exception){$.log(e.responseText);return;}
if(json!==false&&json.errorUrl)
window.location.href=json.errorUrl;}};$.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',value,expires,path,domain,secure].join('');}else{if(undefined==name)
return;var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=cookie.substring(name.length+1);if(cookieValue.indexOf("&")>0)
cookieValue=$.unparam(cookieValue);else
cookieValue=decodeURIComponent(cookieValue);break;}}}
return cookieValue;}};$.setCookie=function(name,keyName,keyValue,daysUntilExpire){var cookie=$.cookie(name)||{};if(typeof(cookie)=="string")
cookie=$.unparam(cookie);cookie[keyName]=encodeURIComponent(keyValue);var cookieDomain=location.host.indexOf(".dev.")!=-1?".dev.nordstrom.com":".nordstrom.com";daysUntilExpire=daysUntilExpire||0;var options={"domain":cookieDomain,"path":"/"};if(daysUntilExpire!==0)
options.expires=daysUntilExpire;$.cookie(name,$.param(cookie),options);}
$.unparam=function(queryString){if(typeof(queryString)!=="string")
return queryString;var obj={};var vars=queryString.split("&");for(var i=0;i<vars.length;i++){var firstpos=vars[i].indexOf("=");var pair=[];pair[0]=vars[i].substring(0,firstpos);pair[1]=vars[i].substring(firstpos+1);pair[0]=decodeURIComponent(pair[0]);try{pair[1]=decodeURIComponent(pair[1]);}
catch(exception){pair[1]=pair[1];}
if(typeof obj[pair[0]]==="undefined"){obj[pair[0]]=pair[1];}else if(typeof obj[pair[0]]==="string"){var arr=[obj[pair[0]],pair[1]];obj[pair[0]]=arr;}else{obj[pair[0]].push(pair[1]);}}
return obj;};$.sprintf=function(format){var argv=Array.apply(null,arguments).slice(1);return format.replace($.sprintf.settings.re,$.sprintf.dispatch(argv));};$.vsprintf=function(format,data){return format.replace($.sprintf.settings.re,$.sprintf.dispatch(data));};$.sprintf.settings={formats:{'%':function(val){return'%';},'b':function(val){return parseInt(val,10).toString(2);},'c':function(val){return String.fromCharCode(parseInt(val,10));},'d':function(val){return parseInt(val,10)?parseInt(val,10):0;},'u':function(val){return Math.abs(val);},'f':function(val,p){return(p>-1)?Math.round(parseFloat(val)*Math.pow(10,p))/Math.pow(10,p):parseFloat(val);},'o':function(val){return parseInt(val,10).toString(8);},'s':function(val){return val;},'x':function(val){return(''+parseInt(val,10).toString(16)).toLowerCase();},'X':function(val){return(''+parseInt(val,10).toString(16)).toUpperCase();}},re:/%(?:(\d+)?(?:\.(\d+))?|\(([^)]+)\))([%bcdufosxX])/g};$.sprintf.dispatch=function(data){if(data.length==1&&typeof data[0]=='object'){data=data[0];return function(match,w,p,lbl,fmt,off,str){return $.sprintf.settings.formats[fmt](data[lbl]);};}else{var idx=0;return function(match,w,p,lbl,fmt,off,str){return $.sprintf.settings.formats[fmt](data[idx++],p);};}};$.getShopperFirstName=function(){var firstName=$.getShopperCookieValue('FIRSTNAME');if(firstName!=null)
return firstName.replace('+',' ');else
return'';};$.getShopperCookieValue=function(key){var cookieValue=null;if(PageParameters.nordstromCookie!=null){var nordstromCookie=$.cookie(PageParameters.nordstromCookie);if(nordstromCookie!=null){cookieValue=nordstromCookie[key.toUpperCase()];if(cookieValue==null)
cookieValue=nordstromCookie[key.toLowerCase()];}}
return cookieValue;};$.getShopperBagCount=function(){var bagCount=$.getShopperCookieValue('BAGCOUNT');if(bagCount!=null&&bagCount!='')
return parseInt(bagCount);else
return 0;};$.getBagCountMessage=function(bagCount){return bagCount;};$.getMiniBagHash=function(){var key="MiniBagHash",cookieName="minibag";var minibagCookie=$.cookie(cookieName);var currDate=new Date();if(minibagCookie!=null){return $.unparam(minibagCookie)[key];}
else{return new Date().getTime().toString();}}
$(document).ready(function(){var menuDiv=$("li:[id*='early'] > div.menu > ul");var eaNonQualifiedDiv=$("li:[id*='early'] > div.menu > div.EA-nonQualif-content");if(undefined!=PageParameters.shopperAttrEa){if((undefined!=PageParameters.segmentId&&PageParameters.segmentId=="50")||PageParameters.isPos){menuDiv.show();eaNonQualifiedDiv.hide();}
else{menuDiv.hide();eaNonQualifiedDiv.show();}}
else{menuDiv.show();eaNonQualifiedDiv.hide();}
if(PageParameters.categoryName=="Shipping Options"){cmCreatePageviewTag('Shipping Options','','/YOURACCOUNT/');}});$.registerShopperToPageParameters=function(){var shopperId=$.getShopperCookieValue('SHOPPERID');var val=(shopperId!=null)?shopperId:'';var firstName=$.getShopperCookieValue('FIRSTNAME');nameVal=(firstName!=null)?firstName.replace('+',' '):'';var shopperAttr=$.getShopperCookieValue('shopperattr');if(shopperAttr!=null&&shopperAttr!=undefined){var attributes=shopperAttr.split('|');var gender=(attributes[0]!=null&&attributes[0]!=undefined)?attributes[0]:"";var maxRewardsLevel=(attributes[1]!=null&&attributes[1]!=undefined)?attributes[1]:"";var isRegisterdForFitRecs=(attributes[2]!=null&&attributes[2]!=undefined)?attributes[2]:"";var hasMultipleRewardsLevel=(attributes[3]!=null&&attributes[3]!=undefined)?attributes[3]:"";var segmentId=(attributes[4]!=null&&attributes[4]!=undefined)?attributes[4]:"";}
var shopper={"id":val,"firstName":nameVal,"isLoggedIn":(nameVal.length>0),"gender":gender,"maxRewardsLevel":maxRewardsLevel,"isRegisterdForFitRecs":isRegisterdForFitRecs,"hasMultipleRewardsLevel":hasMultipleRewardsLevel,"segmentId":segmentId}
$.extend(PageParameters,{"shopper":shopper});$.extend(PageParameters,{"shopperId":val});$.extend(PageParameters,{"firstName":nameVal});$.extend(PageParameters,{"isLoggedIn":(nameVal.length>0)});$.extend(PageParameters,{"segmentId":segmentId});}();})(jQuery);﻿$(document).ready(function(){var personalizationCookie=$.cookie(window.PageParameters.personalizationCookie);var shopperInfoPrefetched=false;var count=0;if(personalizationCookie!=null&&personalizationCookie!=undefined){count=personalizationCookie.ShopperInfoPrefetchRetryCount;if(personalizationCookie.IsShopperInfoPrefetched!=undefined&&personalizationCookie.IsShopperInfoPrefetched=="True"&&personalizationCookie.ShopperId==window.PageParameters.shopperId){shopperInfoPrefetched=true;}}
if((isShopperPersonalizedSortEligible()||isShopperPersonalizedSizeFitEligible())&&shopperInfoPrefetched==false){if(parseInt(count)<parseInt(window.PageParameters.shopperInfoPrefetchRetryCount)){$.ajax({url:window.PageParameters.shopperInfoPrefetchURL+"?segmentEngine="+window.PageParameters.segmentEngine,type:"GET",dataType:"json",timeout:window.PageParameters.shopperInfoPreFetchRequestTimeout||3000,success:function(result){if(typeof Storage!='undefined'&&localStorage){var sizeFit={};sizeFit.shopperId=window.PageParameters.shopper.id;sizeFit.supplierStandardizedSizeFitInfo=result.ShopperStandardSizeInfo;localStorage.setItem("SizeFitInfo",JSON.stringify(sizeFit));}
$.log("Prefetched shopper info successfully.");},error:function(x,t,m){if(t==="timeout"){$.log("Prefetch shopper info timed out.");}else{$.log("Prefetch shopper info failed with error : "+m);}}});}}
function isShopperPersonalizedSortEligible(){var isEligible=false;if(window.PageParameters.personalizedSortEnabled){switch(window.PageParameters.segmentEngine.toUpperCase()){case"CI":isEligible=(window.PageParameters.countryCode==null||window.PageParameters.countryCode=="US");break;case"AHAM":isEligible=window.PageParameters.shopper.isLoggedIn;break;default:}}return isEligible;}
function isShopperPersonalizedSizeFitEligible(){return(window.PageParameters.personalizedSizeFitEnabled&&window.PageParameters.shopper.isLoggedIn);}});﻿
(function($,window){document.write("<style type='text/css'>div[data-content-source] { display:none;}</style>");window.TrialContent={dataSources:{},defaultSources:{},loadZoneSettingDefaults:{"enabledForIntlShipping":true},registerDataSource:function(name,data){this.dataSources[name]=data;$.log("TrialContent Info Log: registerDataSource invoked for "+name);},createMbox:function(name){if(window.mboxCreate&&PageParameters.trialContentEnabled&&!PageParameters.isPos){try{if(PageParameters.shopper!=null&&PageParameters.shopper!=undefined){var params=[name];params.push('shopperId='+PageParameters.shopper.id);params.push('mbox3rdPartyId='+PageParameters.shopper.id);params.push('isLoggedIn='+PageParameters.shopper.isLoggedIn);if(PageParameters.shopper.gender!=null&&PageParameters.shopper.gender!=undefined&&PageParameters.shopper.gender!='')
params.push('gender='+PageParameters.shopper.gender);if(PageParameters.shopper.maxRewardsLevel!=null&&PageParameters.shopper.maxRewardsLevel!=undefined&&PageParameters.shopper.maxRewardsLevel!='')
params.push('maxRewardsLevel='+PageParameters.shopper.maxRewardsLevel);if(PageParameters.shopper.hasMultipleRewardsLevel!=null&&PageParameters.shopper.hasMultipleRewardsLevel!=undefined&&PageParameters.shopper.hasMultipleRewardsLevel!='')
params.push('hasMultipleRewardsLevel='+PageParameters.shopper.hasMultipleRewardsLevel);if(PageParameters.shopper.isRegisterdForFitRecs!=null&&PageParameters.shopper.isRegisterdForFitRecs!=undefined&&PageParameters.shopper.isRegisterdForFitRecs!='')
params.push('isRegisterdForFitRecs='+PageParameters.shopper.isRegisterdForFitRecs);if(PageParameters.AvailableRecEngines!=null&&PageParameters.AvailableRecEngines!=undefined)
params.push('AvailableRecEngines='+PageParameters.AvailableRecEngines);if(PageParameters.keyword!=null&&PageParameters.keyword!=undefined)
params.push('Keyword='+PageParameters.keyword);if(PageParameters.IsNullSearch!=null&&PageParameters.IsNullSearch!=undefined)
params.push('IsNullSearch='+PageParameters.IsNullSearch);if(PageParameters.PersonalizedRecommendationEnabled!=null&&PageParameters.PersonalizedRecommendationEnabled!=undefined)
params.push('IsPersonalizedRecsEnabled='+PageParameters.PersonalizedRecommendationEnabled);if(PageParameters.isShopperPersonalizedSortEligible!=null&&PageParameters.isShopperPersonalizedSortEligible!=undefined)
params.push('isShopperPersonalizedSortEligible='+PageParameters.isShopperPersonalizedSortEligible);if(PageParameters.purchaseCount!=null&&PageParameters.purchaseCount!=undefined)
params.push('purchaseCount='+PageParameters.purchaseCount);if(PageParameters.regionStyleMode!=null&&PageParameters.regionStyleMode!=undefined)
params.push('regionStyleMode='+PageParameters.regionStyleMode);if(PageParameters.shopperSegment!=null&&PageParameters.shopperSegment!=undefined)
params.push('shopperSegment='+PageParameters.shopperSegment);if(window.PageParameters.isProdCatEnabledForCtlFromRR!=null&&window.PageParameters.isProdCatEnabledForCtlFromRR!=undefined)
params.push('isProdCatEnabledForCtlFromRR='+window.PageParameters.isProdCatEnabledForCtlFromRR);}
if(PageParameters.countryCode!=null&&PageParameters.countryCode!="US")
params.push('shipToCountry='+PageParameters.countryCode);if(PageParameters.productType!=null&&PageParameters.productType!=undefined){params.push('productType='+PageParameters.productType);params.push('parentProductType='+PageParameters.productType);}
if(PageParameters.productAgeGroup!=null&&PageParameters.productAgeGroup!=undefined&&(PageParameters.productAgeGroup.length>0))
params.push('productAgeGroup='+PageParameters.productAgeGroup);if(PageParameters.productGender!=null&&PageParameters.productGender!=undefined&&(PageParameters.productGender.length>0))
params.push('productGender='+PageParameters.productGender);if(PageParameters.SameDayDeliveryEligible!=null&&PageParameters.SameDayDeliveryEligible!=undefined)
params.push('sameDayShipping='+PageParameters.SameDayDeliveryEligible);if(PageParameters.ShopperIsPBPDQualified!=null&&PageParameters.ShopperIsPBPDQualified!=undefined)
params.push('shopperIsPBPDQualified='+PageParameters.ShopperIsPBPDQualified);if(PageParameters.PageType){if(PageParameters.PageType=="ProductPage"){if(PageParameters.styleNumber!=null&&PageParameters.styleNumber!=undefined){params.push('productId='+PageParameters.styleNumber);params.push('price='+0);}
if(PageParameters.productCategoryId!=null&&PageParameters.productCategoryId!=undefined)
params.push('categoryId='+PageParameters.productCategoryId);if(name=="ProductPage"){if(PageParameters.VideoAltsEnabled!=null&&PageParameters.VideoAltsEnabled!=undefined)
params.push('VideoAltsEnabled='+PageParameters.VideoAltsEnabled);if(PageParameters.ProductVideoAvailable!=null&&PageParameters.ProductVideoAvailable!=undefined)
params.push('ProductVideoAvailable='+PageParameters.ProductVideoAvailable);if(PageParameters.ProductVideoPlayed!=null&&PageParameters.ProductVideoPlayed!=undefined)
params.push('ProductVideoPlayed='+PageParameters.ProductVideoPlayed);if(PageParameters.productPageRecommendationAddToBagEnabled!=null&&PageParameters.productPageRecommendationAddToBagEnabled!=undefined)
params.push('PPRecsAddToBag='+PageParameters.productPageRecommendationAddToBagEnabled);}}
if(PageParameters.PageType=="OutfitPage"){if(PageParameters.styleNumber!=null&&PageParameters.styleNumber!=undefined&&PageParameters.outfitStyles!=null&&PageParameters.outfitStyles!=undefined){params.push('productId='+PageParameters.styleNumber+'~'+PageParameters.outfitStyles);params.push('totalPrice='+0);}
if(PageParameters.productCategoryId!=null&&PageParameters.productCategoryId!=undefined)
params.push('categoryId='+PageParameters.productCategoryId);}
if(PageParameters.PageType=="ShoppingBagPage"){if(PageParameters.UserHasQualifiedItem!=null&&PageParameters.UserHasQualifiedItem!=undefined)
params.push('UserHasQualifiedItem='+PageParameters.UserHasQualifiedItem);if(PageParameters.UserHasSamples!=null&&PageParameters.UserHasSamples!=undefined)
params.push('UserHasSamples='+PageParameters.UserHasSamples);}
if(PageParameters.PageType=="SearchPage"){params.push('OutfitsInSearchResultsEnabled='+PageParameters.OutfitsInSearchResultsEnabled);params.push('PageNo=0');params.push('OutfitAvailable=false');params.push('Category360VideoEnabled='+PageParameters.Category360VideoEnabled);params.push('VideoonSearchBrowse='+false);}
if(PageParameters.PageType=="CategoryPage"){if(PageParameters.Category360VideoEnabled!=null&&PageParameters.Category360VideoEnabled!=undefined){params.push('Category360VideoEnabled='+PageParameters.Category360VideoEnabled);params.push('VideoonSearchBrowse='+false);}}}
if(PageParameters.Size3Qualified!=null&&PageParameters.Size3Qualified!=undefined)
params.push('Size3Qualified='+PageParameters.Size3Qualified);if(PageParameters.templateName!=null&&PageParameters.templateName!=undefined)
params.push('TemplateName='+PageParameters.templateName);if(name=="SearchPage"||name=="CategoryPage"){mboxDefine.apply(window,params);}
else{mboxCreate.apply(window,params);}}
catch(err){$.log(err.description);}}},updateMbox:function(name,paramValues){if(window.mboxUpdate&&PageParameters.trialContentEnabled&&!PageParameters.isPos){try{var params=[name];if(PageParameters.PageType){if(PageParameters.PageType=="ProductPage"||PageParameters.PageType=="OutfitPage"||PageParameters.PageType=="SearchPage"||PageParameters.PageType=="CategoryPage"){if(!paramValues)
return;for(var param in paramValues){if(param)
params.push(param+'='+paramValues[param]);}}
if(params.length>0)
mboxUpdate.apply(window,params);}}
catch(err){$.log(err.description);}}},loadZone:function(id,settings){$.log("TrialContent Info Log: loadZone invoked for "+id);var zoneContainer=$("#"+id);settings=$.extend({},this.loadZoneSettingDefaults,settings);if(!settings.enabledForIntlShipping){if(PageParameters.isInternationalShipEnabled==true&&(PageParameters.countryCode!=null&&PageParameters.countryCode!="US")){zoneContainer.css("display","block");return;}}
if(zoneContainer.length==0)
return;if(this.dataSources==undefined){zoneContainer.css("display","block");return;}
var dataSourceName=zoneContainer.attr("data-content-source");var dataSource=this.dataSources[dataSourceName];if(location.search.indexOf("cog=1")!=-1){if(this.defaultSources[dataSourceName]==undefined)
this.defaultSources[dataSourceName]={};this.defaultSources[dataSourceName][id]=zoneContainer.html();}
if(dataSource==undefined){zoneContainer.css("display","block");return;}
var parameterValues=dataSource[zoneContainer.attr("id")];if(parameterValues==undefined){zoneContainer.css("display","block");return;}
$.each(parameterValues,function(key,value){if(key==undefined||value==undefined)
return true;if(key=="content-version"){var syndicatedContainer=zoneContainer.attr("data-container");if(syndicatedContainer==undefined){return true;}
$.ajax({url:(window.location.host.split('shop').length>1)?"/TC":"/TemplateSyndicationProxy.axd",data:"ct=C&tn="+syndicatedContainer+"&version="+value,async:false,error:function(xhr,status,error){$.log(xhr.responseText);},success:function(results){zoneContainer.html(results);}});}
else{try{var id=key.split("-")[0];var attr=key.split("-")[1];var elem=zoneContainer.find("#"+id);if(elem==undefined||elem.length==0)
return true;switch(attr.toString().toLowerCase()){case"text":elem[0].innerText=value;break;case"style":case"href":elem.attr(attr,TrialContent.replaceParameterUrls(value));break;case"html":elem[0].innerHTML=TrialContent.replaceParameterUrls(value);break;case"src":elem.attr(attr,"");elem.attr(attr,TrialContent.replaceParameterUrls(value));break;default:elem.attr(attr,value);break;}
elem.addClass("TNTLoaded");}
catch(err){$.log(err.description);}}});zoneContainer.css("display","block");},replaceParameterUrls:function(value){return value.replace(/\[-% Secure %-]/g,PageParameters.secureUrl).replace(/\[-% Image %-]/g,PageParameters.imageUrl).replace(/\[-% Store %-]/g,PageParameters.storeUrl).replace(/\[-% About %-]/g,PageParameters.aboutUrl);},openAdmin:function(){window.open(PageParameters.cogUrl+"/cog.htm","ContentOfferGenerator","height=400,width=600,scrollbars=yes",true).focus();},toggleQueryString:function(queryString,e){browserURL=window.content.document.location.toString();if(browserURL.indexOf(queryString)>-1){browserURL=browserURL.replace(queryString+"&","");browserURL=browserURL.replace("?"+queryString,"");browserURL=browserURL.replace("&"+queryString,"");}
else{var queryDelimeter=(browserURL.indexOf("?")>-1)?"&":"?";browserURL+=queryDelimeter+queryString;}
window.content.document.location=browserURL;}};})(jQuery,window);var mboxCopyright = "Copyright 1996-2012. Adobe Systems Incorporated. All rights reserved."; mboxUrlBuilder = function (a, b) { this.a = a; this.b = b; this.c = new Array(); this.d = function (e) { return e; }; this.f = null; }; mboxUrlBuilder.prototype.addParameter = function (g, h) { var i = new RegExp('(\'|")'); if (i.exec(g)) { throw "Parameter '" + g + "' contains invalid characters"; } for (var j = 0; j < this.c.length; j++) { var k = this.c[j]; if (k.name == g) { k.value = h; return this; } } var l = new Object(); l.name = g; l.value = h; this.c[this.c.length] = l; return this; }; mboxUrlBuilder.prototype.addParameters = function (c) { if (!c) { return this; } for (var j = 0; j < c.length; j++) { var m = c[j].indexOf('='); if (m == -1 || m == 0) { continue; } this.addParameter(c[j].substring(0, m), c[j].substring(m + 1, c[j].length)); } return this; }; mboxUrlBuilder.prototype.setServerType = function (n) { this.o = n; }; mboxUrlBuilder.prototype.setBasePath = function (f) { this.f = f; }; mboxUrlBuilder.prototype.setUrlProcessAction = function (p) { this.d = p; }; mboxUrlBuilder.prototype.buildUrl = function () { var q = this.f ? this.f : '/m2/' + this.b + '/mbox/' + this.o; var r = document.location.protocol == 'file:' ? 'http:' : document.location.protocol; var e = r + "//" + this.a + q; var s = e.indexOf('?') != -1 ? '&' : '?'; for (var j = 0; j < this.c.length; j++) { var k = this.c[j]; e += s + encodeURIComponent(k.name) + '=' + encodeURIComponent(k.value); s = '&'; } return this.t(this.d(e)); }; mboxUrlBuilder.prototype.getParameters = function () { return this.c; }; mboxUrlBuilder.prototype.setParameters = function (c) { this.c = c; }; mboxUrlBuilder.prototype.clone = function () { var u = new mboxUrlBuilder(this.a, this.b); u.setServerType(this.o); u.setBasePath(this.f); u.setUrlProcessAction(this.d); for (var j = 0; j < this.c.length; j++) { u.addParameter(this.c[j].name, this.c[j].value); } return u; }; mboxUrlBuilder.prototype.t = function (v) { return v.replace(/\"/g, '&quot;').replace(/>/g, '&gt;'); }; mboxStandardFetcher = function () { }; mboxStandardFetcher.prototype.getType = function () { return 'standard'; }; mboxStandardFetcher.prototype.fetch = function (w) { w.setServerType(this.getType()); document.write('<' + 'scr' + 'ipt src="' + w.buildUrl() + '" language="JavaScript"><' + '\/scr' + 'ipt>'); }; mboxStandardFetcher.prototype.cancel = function () { }; mboxAjaxFetcher = function () { }; mboxAjaxFetcher.prototype.getType = function () { return 'ajax'; }; mboxAjaxFetcher.prototype.fetch = function (w) { w.setServerType(this.getType()); var e = w.buildUrl(); this.x = document.createElement('script'); this.x.src = e; document.body.appendChild(this.x); }; mboxAjaxFetcher.prototype.cancel = function () { }; mboxMap = function () { this.y = new Object(); this.z = new Array(); }; mboxMap.prototype.put = function (A, h) { if (!this.y[A]) { this.z[this.z.length] = A; } this.y[A] = h; }; mboxMap.prototype.get = function (A) { return this.y[A]; }; mboxMap.prototype.remove = function (A) { this.y[A] = undefined; }; mboxMap.prototype.each = function (p) { for (var j = 0; j < this.z.length; j++) { var A = this.z[j]; var h = this.y[A]; if (h) { var B = p(A, h); if (B === false) { break; } } } }; mboxFactory = function (C, b, D) { this.E = false; this.C = C; this.D = D; this.F = new mboxList(); mboxFactories.put(D, this); this.G = typeof document.createElement('div').replaceChild != 'undefined' && (function () { return true; })() && typeof document.getElementById != 'undefined' && typeof (window.attachEvent || document.addEventListener || window.addEventListener) != 'undefined' && typeof encodeURIComponent != 'undefined'; this.H = this.G && mboxGetPageParameter('mboxDisable') == null; var I = D == 'default'; this.J = new mboxCookieManager('mbox' + (I ? '' : ('-' + D)), (function () { return mboxCookiePageDomain(); })()); this.H = this.H && this.J.isEnabled() && (this.J.getCookie('disable') == null); if (this.isAdmin()) { this.enable(); } this.K(); this.L = mboxGenerateId(); this.M = mboxScreenHeight(); this.N = mboxScreenWidth(); this.O = mboxBrowserWidth(); this.P = mboxBrowserHeight(); this.Q = mboxScreenColorDepth(); this.R = mboxBrowserTimeOffset(); this.S = new mboxSession(this.L, 'mboxSession', 'session', 31 * 60, this.J); this.T = new mboxPC('PC', 1209600, this.J); this.w = new mboxUrlBuilder(C, b); this.U(this.w, I); this.V = new Date().getTime(); this.W = this.V; var X = this; this.addOnLoad(function () { X.W = new Date().getTime(); }); if (this.G) { this.addOnLoad(function () { X.E = true; X.getMboxes().each(function (Y) { Y.setFetcher(new mboxAjaxFetcher()); Y.finalize(); }); }); if (this.H) { this.limitTraffic(100, 10368000); this.Z(); this._ = new mboxSignaler(function (ab, c) { return X.create(ab, c); }, this.J); } } }; mboxFactory.prototype.forcePCId = function (bb) { if (this.T.forceId(bb)) { this.S.forceId(mboxGenerateId()); } }; mboxFactory.prototype.forceSessionId = function (bb) { this.S.forceId(bb); }; mboxFactory.prototype.isEnabled = function () { return this.H; }; mboxFactory.prototype.getDisableReason = function () { return this.J.getCookie('disable'); }; mboxFactory.prototype.isSupported = function () { return this.G; }; mboxFactory.prototype.disable = function (cb, db) { if (typeof cb == 'undefined') { cb = 60 * 60; } if (typeof db == 'undefined') { db = 'unspecified'; } if (!this.isAdmin()) { this.H = false; this.J.setCookie('disable', db, cb); } }; mboxFactory.prototype.enable = function () { this.H = true; this.J.deleteCookie('disable'); }; mboxFactory.prototype.isAdmin = function () { return document.location.href.indexOf('mboxEnv') != -1; }; mboxFactory.prototype.limitTraffic = function (eb, cb) { }; mboxFactory.prototype.addOnLoad = function (fb) { if (this.isDomLoaded()) { fb(); } else { var gb = false; var hb = function () { if (gb) { return; } gb = true; fb(); }; this.ib.push(hb); if (this.isDomLoaded() && !gb) { hb(); } } }; mboxFactory.prototype.getEllapsedTime = function () { return this.W - this.V; }; mboxFactory.prototype.getEllapsedTimeUntil = function (jb) { return jb - this.V; }; mboxFactory.prototype.getMboxes = function () { return this.F; }; mboxFactory.prototype.get = function (ab, kb) { return this.F.get(ab).getById(kb || 0); }; mboxFactory.prototype.update = function (ab, c) { if (!this.isEnabled()) { return; } if (!this.isDomLoaded()) { var X = this; this.addOnLoad(function () { X.update(ab, c); }); return; } if (this.F.get(ab).length() == 0) { throw "Mbox " + ab + " is not defined"; } this.F.get(ab).each(function (Y) { Y.getUrlBuilder().addParameter('mboxPage', mboxGenerateId()); Y.load(c); }); }; mboxFactory.prototype.create = function (ab, c, lb) { if (!this.isSupported()) { return null; } var e = this.w.clone(); e.addParameter('mboxCount', this.F.length() + 1); e.addParameters(c); var kb = this.F.get(ab).length(); var mb = this.D + '-' + ab + '-' + kb; var nb; if (lb) { nb = new mboxLocatorNode(lb); } else { if (this.E) { throw 'The page has already been loaded, can\'t write marker'; } nb = new mboxLocatorDefault(mb); } try { var X = this; var ob = 'mboxImported-' + mb; var Y = new mbox(ab, kb, e, nb, ob); if (this.H) { Y.setFetcher(this.E ? new mboxAjaxFetcher() : new mboxStandardFetcher()); } Y.setOnError(function (pb, n) { Y.setMessage(pb); Y.activate(); if (!Y.isActivated()) { X.disable(60 * 60, pb); window.location.reload(false); } }); this.F.add(Y); } catch (qb) { this.disable(); throw 'Failed creating mbox "' + ab + '", the error was: ' + qb; } var rb = new Date(); e.addParameter('mboxTime', rb.getTime() - (rb.getTimezoneOffset() * 60000)); return Y; }; mboxFactory.prototype.getCookieManager = function () { return this.J; }; mboxFactory.prototype.getPageId = function () { return this.L; }; mboxFactory.prototype.getPCId = function () { return this.T; }; mboxFactory.prototype.getSessionId = function () { return this.S; }; mboxFactory.prototype.getSignaler = function () { return this._; }; mboxFactory.prototype.getUrlBuilder = function () { return this.w; }; mboxFactory.prototype.U = function (e, I) { e.addParameter('mboxHost', document.location.hostname).addParameter('mboxSession', this.S.getId()); if (!I) { e.addParameter('mboxFactoryId', this.D); } if (this.T.getId() != null) { e.addParameter('mboxPC', this.T.getId()); } e.addParameter('mboxPage', this.L); e.addParameter('screenHeight', this.M); e.addParameter('screenWidth', this.N); e.addParameter('browserWidth', this.O); e.addParameter('browserHeight', this.P); e.addParameter('browserTimeOffset', this.R); e.addParameter('colorDepth', this.Q); e.addParameters(this.sb().split('&')); e.setUrlProcessAction(function (e) { e += '&mboxURL=' + encodeURIComponent(document.location); var tb = encodeURIComponent(document.referrer); if (e.length + tb.length < 2000) { e += '&mboxReferrer=' + tb; } e += '&mboxVersion=' + mboxVersion; return e; }); }; mboxFactory.prototype.sb = function () { window.ub = function (t) { if (!t) return false; var e = '', l = t.length, t = t.toUpperCase(); for (i = 0; i < l; i++) { e += t.charCodeAt(i) } return e }; window.Dc = function (t) { if (!t) return false; var d = "", l = t.length; for (i = 0; i < l; i++) { d += String.fromCharCode(t.charAt(i).toString() + t.charAt(i + 1).toString()); ++i } return d.toLowerCase() }; var pr = window.Dc(this.J.getCookie('profile')) || '', pa = '', q; if (location.search.length > 0) { q = unescape(location.search.substr(1)).split(';')[0].split('&'), _qlDP = q.length; for (i = 0; i < _qlDP; i++) { if (q[i].indexOf('mbxp._') > -1 && q[i].indexOf('=') != -1 && q[i].split('=')[1].length > 0) { pa += '&' + (q[i]).replace(/mbxp/gi, 'profile') } } } mboxUrlBuilder.prototype.oldURL = mboxUrlBuilder.prototype.buildUrl; mboxUrlBuilder.prototype.buildUrl = function () { var URL = this.oldURL(); if (URL.indexOf('/sc/') != -1) { var _prA = pr.split('&'), _pr = _prA.length, _paA = pa.substr(1).split('&'), _pa = _paA.length; for (i = 0; i < _pr; i++) { URL = URL.replace(_prA[i] + '&', '').replace(_prA[i], '') } for (i = 0; i < _pa; i++) { URL = URL.replace(_paA[i] + '&', '').replace(_paA[i], '') } } return URL }; if (pr != '') { pr = 'profile.' + pr.replace(/\-/g, '=').replace(/\+/g, '&profile.') } else { pa = pa.substr(1) }; return pr + pa; }; mboxFactory.prototype.Z = function () { document.write('<style>.' + 'mboxDefault' + ' { visibility:hidden; }</style>'); }; mboxFactory.prototype.isDomLoaded = function () { return this.E; }; mboxFactory.prototype.K = function () { if (this.ib != null) { return; } this.ib = new Array(); var X = this; (function () { var vb = document.addEventListener ? "DOMContentLoaded" : "onreadystatechange"; var wb = false; var xb = function () { if (wb) { return; } wb = true; for (var i = 0; i < X.ib.length; ++i) { X.ib[i](); } }; if (document.addEventListener) { document.addEventListener(vb, function () { document.removeEventListener(vb, arguments.callee, false); xb(); }, false); window.addEventListener("load", function () { document.removeEventListener("load", arguments.callee, false); xb(); }, false); } else if (document.attachEvent) { if (self !== self.top) { document.attachEvent(vb, function () { if (document.readyState === 'complete') { document.detachEvent(vb, arguments.callee); xb(); } }); } else { var yb = function () { try { document.documentElement.doScroll('left'); xb(); } catch (zb) { setTimeout(yb, 13); } }; yb(); } } if (document.readyState === "complete") { xb(); } })(); }; mboxSignaler = function (Ab, J) { this.J = J; var Bb = J.getCookieNames('signal-'); for (var j = 0; j < Bb.length; j++) { var Cb = Bb[j]; var Db = J.getCookie(Cb).split('&'); var Y = Ab(Db[0], Db); Y.load(); J.deleteCookie(Cb); } }; mboxSignaler.prototype.signal = function (Eb, ab) { this.J.setCookie('signal-' + Eb, mboxShiftArray(arguments).join('&'), 45 * 60); }; mboxList = function () { this.F = new Array(); }; mboxList.prototype.add = function (Y) { if (Y != null) { this.F[this.F.length] = Y; } }; mboxList.prototype.get = function (ab) { var B = new mboxList(); for (var j = 0; j < this.F.length; j++) { var Y = this.F[j]; if (Y.getName() == ab) { B.add(Y); } } return B; }; mboxList.prototype.getById = function (Fb) { return this.F[Fb]; }; mboxList.prototype.length = function () { return this.F.length; }; mboxList.prototype.each = function (p) { if (typeof p != 'function') { throw 'Action must be a function, was: ' + typeof (p); } for (var j = 0; j < this.F.length; j++) { p(this.F[j]); } }; mboxLocatorDefault = function (g) { this.g = 'mboxMarker-' + g; document.write('<div id="' + this.g + '" style="visibility:hidden;display:none">&nbsp;</div>'); }; mboxLocatorDefault.prototype.locate = function () { var Gb = document.getElementById(this.g); while (Gb != null) { if (Gb.nodeType == 1) { if (Gb.className == 'mboxDefault') { return Gb; } } Gb = Gb.previousSibling; } return null; }; mboxLocatorDefault.prototype.force = function () { var Hb = document.createElement('div'); Hb.className = 'mboxDefault'; var Ib = document.getElementById(this.g); Ib.parentNode.insertBefore(Hb, Ib); return Hb; }; mboxLocatorNode = function (Jb) { this.Gb = Jb; }; mboxLocatorNode.prototype.locate = function () { return typeof this.Gb == 'string' ? document.getElementById(this.Gb) : this.Gb; }; mboxLocatorNode.prototype.force = function () { return null; }; mboxCreate = function (ab) { var Y = mboxFactoryDefault.create(ab, mboxShiftArray(arguments)); if (Y) { Y.load(); } return Y; }; mboxDefine = function (lb, ab) { var Y = mboxFactoryDefault.create(ab, mboxShiftArray(mboxShiftArray(arguments)), lb); return Y; }; mboxUpdate = function (ab) { mboxFactoryDefault.update(ab, mboxShiftArray(arguments)); }; mbox = function (g, Kb, w, Lb, ob) { this.Mb = null; this.Nb = 0; this.nb = Lb; this.ob = ob; this.Ob = null; this.Pb = new mboxOfferContent(); this.Hb = null; this.w = w; this.message = ''; this.Qb = new Object(); this.Rb = 0; this.Kb = Kb; this.g = g; this.Sb(); w.addParameter('mbox', g).addParameter('mboxId', Kb); this.Tb = function () { }; this.Ub = function () { }; this.Vb = null; }; mbox.prototype.getId = function () { return this.Kb; }; mbox.prototype.Sb = function () { if (this.g.length > 250) { throw "Mbox Name " + this.g + " exceeds max length of " + "250 characters."; } else if (this.g.match(/^\s+|\s+$/g)) { throw "Mbox Name " + this.g + " has leading/trailing whitespace(s)."; } }; mbox.prototype.getName = function () { return this.g; }; mbox.prototype.getParameters = function () { var c = this.w.getParameters(); var B = new Array(); for (var j = 0; j < c.length; j++) { if (c[j].name.indexOf('mbox') != 0) { B[B.length] = c[j].name + '=' + c[j].value; } } return B; }; mbox.prototype.setOnLoad = function (p) { this.Ub = p; return this; }; mbox.prototype.setMessage = function (pb) { this.message = pb; return this; }; mbox.prototype.setOnError = function (Tb) { this.Tb = Tb; return this; }; mbox.prototype.setFetcher = function (Wb) { if (this.Ob) { this.Ob.cancel(); } this.Ob = Wb; return this; }; mbox.prototype.getFetcher = function () { return this.Ob; }; mbox.prototype.load = function (c) { if (this.Ob == null) { return this; } this.setEventTime("load.start"); this.cancelTimeout(); this.Nb = 0; var w = (c && c.length > 0) ? this.w.clone().addParameters(c) : this.w; this.Ob.fetch(w); var X = this; this.Xb = setTimeout(function () { X.Tb('browser timeout', X.Ob.getType()); }, 15000); this.setEventTime("load.end"); return this; }; mbox.prototype.loaded = function () { this.cancelTimeout(); if (!this.activate()) { var X = this; setTimeout(function () { X.loaded(); }, 100); } }; mbox.prototype.activate = function () { if (this.Nb) { return this.Nb; } this.setEventTime('activate' + ++this.Rb + '.start'); if (this.show()) { this.cancelTimeout(); this.Nb = 1; } this.setEventTime('activate' + this.Rb + '.end'); return this.Nb; }; mbox.prototype.isActivated = function () { return this.Nb; }; mbox.prototype.setOffer = function (Pb) { if (Pb && Pb.show && Pb.setOnLoad) { this.Pb = Pb; } else { throw 'Invalid offer'; } return this; }; mbox.prototype.getOffer = function () { return this.Pb; }; mbox.prototype.show = function () { this.setEventTime('show.start'); var B = this.Pb.show(this); this.setEventTime(B == 1 ? "show.end.ok" : "show.end"); return B; }; mbox.prototype.showContent = function (Yb) { if (Yb == null) { return 0; } if (this.Hb == null || !this.Hb.parentNode) { this.Hb = this.getDefaultDiv(); if (this.Hb == null) { return 0; } } if (this.Hb != Yb) { this.Zb(this.Hb); this.Hb.parentNode.replaceChild(Yb, this.Hb); this.Hb = Yb; } this._b(Yb); this.Ub(); return 1; }; mbox.prototype.hide = function () { this.setEventTime('hide.start'); var B = this.showContent(this.getDefaultDiv()); this.setEventTime(B == 1 ? 'hide.end.ok' : 'hide.end.fail'); return B; }; mbox.prototype.finalize = function () { this.setEventTime('finalize.start'); this.cancelTimeout(); if (this.getDefaultDiv() == null) { if (this.nb.force() != null) { this.setMessage('No default content, an empty one has been added'); } else { this.setMessage('Unable to locate mbox'); } } if (!this.activate()) { this.hide(); this.setEventTime('finalize.end.hide'); } this.setEventTime('finalize.end.ok'); }; mbox.prototype.cancelTimeout = function () { if (this.Xb) { clearTimeout(this.Xb); } if (this.Ob != null) { this.Ob.cancel(); } }; mbox.prototype.getDiv = function () { return this.Hb; }; mbox.prototype.getDefaultDiv = function () { if (this.Vb == null) { this.Vb = this.nb.locate(); } return this.Vb; }; mbox.prototype.setEventTime = function (ac) { this.Qb[ac] = (new Date()).getTime(); }; mbox.prototype.getEventTimes = function () { return this.Qb; }; mbox.prototype.getImportName = function () { return this.ob; }; mbox.prototype.getURL = function () { return this.w.buildUrl(); }; mbox.prototype.getUrlBuilder = function () { return this.w; }; mbox.prototype.bc = function (Hb) { return Hb.style.display != 'none'; }; mbox.prototype._b = function (Hb) { this.cc(Hb, true); }; mbox.prototype.Zb = function (Hb) { this.cc(Hb, false); }; mbox.prototype.cc = function (Hb, dc) { Hb.style.visibility = dc ? "visible" : "hidden"; Hb.style.display = dc ? "block" : "none"; }; mboxOfferContent = function () { this.Ub = function () { }; }; mboxOfferContent.prototype.show = function (Y) { var B = Y.showContent(document.getElementById(Y.getImportName())); if (B == 1) { this.Ub(); } return B; }; mboxOfferContent.prototype.setOnLoad = function (Ub) { this.Ub = Ub; }; mboxOfferAjax = function (Yb) { this.Yb = Yb; this.Ub = function () { }; }; mboxOfferAjax.prototype.setOnLoad = function (Ub) { this.Ub = Ub; }; mboxOfferAjax.prototype.show = function (Y) { var ec = document.createElement('div'); ec.id = Y.getImportName(); ec.innerHTML = this.Yb; var B = Y.showContent(ec); if (B == 1) { this.Ub(); } return B; }; mboxOfferDefault = function () { this.Ub = function () { }; }; mboxOfferDefault.prototype.setOnLoad = function (Ub) { this.Ub = Ub; }; mboxOfferDefault.prototype.show = function (Y) { var B = Y.hide(); if (B == 1) { this.Ub(); } return B; }; mboxCookieManager = function mboxCookieManager(g, fc) { this.g = g; this.fc = fc == '' || fc.indexOf('.') == -1 ? '' : '; domain=' + fc; this.gc = new mboxMap(); this.loadCookies(); }; mboxCookieManager.prototype.isEnabled = function () { this.setCookie('check', 'true', 60); this.loadCookies(); return this.getCookie('check') == 'true'; }; mboxCookieManager.prototype.setCookie = function (g, h, cb) { if (typeof g != 'undefined' && typeof h != 'undefined' && typeof cb != 'undefined') { var hc = new Object(); hc.name = g; hc.value = escape(h); hc.expireOn = Math.ceil(cb + new Date().getTime() / 1000); this.gc.put(g, hc); this.saveCookies(); } }; mboxCookieManager.prototype.getCookie = function (g) { var hc = this.gc.get(g); return hc ? unescape(hc.value) : null; }; mboxCookieManager.prototype.deleteCookie = function (g) { this.gc.remove(g); this.saveCookies(); }; mboxCookieManager.prototype.getCookieNames = function (ic) { var jc = new Array(); this.gc.each(function (g, hc) { if (g.indexOf(ic) == 0) { jc[jc.length] = g; } }); return jc; }; mboxCookieManager.prototype.saveCookies = function () { var kc = false; var lc = 'disable'; var mc = new Array(); var nc = 0; this.gc.each(function (g, hc) { if (!kc || g === lc) { mc[mc.length] = g + '#' + hc.value + '#' + hc.expireOn; if (nc < hc.expireOn) { nc = hc.expireOn; } } }); var oc = new Date(nc * 1000); document.cookie = this.g + '=' + mc.join('|') + '; expires=' + oc.toGMTString() + '; path=/' + this.fc; }; mboxCookieManager.prototype.loadCookies = function () { this.gc = new mboxMap(); var pc = document.cookie.indexOf(this.g + '='); if (pc != -1) { var qc = document.cookie.indexOf(';', pc); if (qc == -1) { qc = document.cookie.indexOf(',', pc); if (qc == -1) { qc = document.cookie.length; } } var rc = document.cookie.substring(pc + this.g.length + 1, qc).split('|'); var sc = Math.ceil(new Date().getTime() / 1000); for (var j = 0; j < rc.length; j++) { var hc = rc[j].split('#'); if (sc <= hc[2]) { var tc = new Object(); tc.name = hc[0]; tc.value = hc[1]; tc.expireOn = hc[2]; this.gc.put(tc.name, tc); } } } }; mboxSession = function (uc, vc, Cb, wc, J) { this.vc = vc; this.Cb = Cb; this.wc = wc; this.J = J; this.xc = false; this.Kb = typeof mboxForceSessionId != 'undefined' ? mboxForceSessionId : mboxGetPageParameter(this.vc); if (this.Kb == null || this.Kb.length == 0) { this.Kb = J.getCookie(Cb); if (this.Kb == null || this.Kb.length == 0) { this.Kb = uc; this.xc = true; } } J.setCookie(Cb, this.Kb, wc); }; mboxSession.prototype.getId = function () { return this.Kb; }; mboxSession.prototype.forceId = function (bb) { this.Kb = bb; this.J.setCookie(this.Cb, this.Kb, this.wc); }; mboxPC = function (Cb, wc, J) { this.Cb = Cb; this.wc = wc; this.J = J; this.Kb = typeof mboxForcePCId != 'undefined' ? mboxForcePCId : J.getCookie(Cb); if (this.Kb != null) { J.setCookie(Cb, this.Kb, wc); } }; mboxPC.prototype.getId = function () { return this.Kb; }; mboxPC.prototype.forceId = function (bb) { if (this.Kb != bb) { this.Kb = bb; this.J.setCookie(this.Cb, this.Kb, this.wc); return true; } return false; }; mboxGetPageParameter = function (g) { var B = null; var yc = new RegExp(g + "=([^\&]*)"); var zc = yc.exec(document.location); if (zc != null && zc.length >= 2) { B = zc[1]; } return B; }; mboxSetCookie = function (g, h, cb) { return mboxFactoryDefault.getCookieManager().setCookie(g, h, cb); }; mboxGetCookie = function (g) { return mboxFactoryDefault.getCookieManager().getCookie(g); }; mboxCookiePageDomain = function () { var fc = (/([^:]*)(:[0-9]{0,5})?/).exec(document.location.host)[1]; var Ac = /[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/; if (!Ac.exec(fc)) { var Bc = (/([^\.]+\.[^\.]{3}|[^\.]+\.[^\.]+\.[^\.]{2})$/).exec(fc); if (Bc) { fc = Bc[0]; } } return fc ? fc : ""; }; mboxShiftArray = function (Cc) { var B = new Array(); for (var j = 1; j < Cc.length; j++) { B[B.length] = Cc[j]; } return B; }; mboxGenerateId = function () { return (new Date()).getTime() + "-" + Math.floor(Math.random() * 999999); }; mboxScreenHeight = function () { return screen.height; }; mboxScreenWidth = function () { return screen.width; }; mboxBrowserWidth = function () { return (window.innerWidth) ? window.innerWidth : document.documentElement ? document.documentElement.clientWidth : document.body.clientWidth; }; mboxBrowserHeight = function () { return (window.innerHeight) ? window.innerHeight : document.documentElement ? document.documentElement.clientHeight : document.body.clientHeight; }; mboxBrowserTimeOffset = function () { return -new Date().getTimezoneOffset(); }; mboxScreenColorDepth = function () { return screen.pixelDepth; }; if (typeof mboxVersion == 'undefined') { var mboxVersion = 41; var mboxFactories = new mboxMap(); var mboxFactoryDefault = new mboxFactory('humanperformancenetw.tt.omtrdc.net', 'nordstrominc', 'default'); }; if (mboxGetPageParameter("mboxDebug") != null || mboxFactoryDefault.getCookieManager().getCookie("debug") != null) { setTimeout(function () { if (typeof mboxDebugLoaded == 'undefined') { alert('Could not load the remote debug.\nPlease check your connection' + ' to Test&amp;Target servers'); } }, 60 * 60); document.write('<' + 'scr' + 'ipt language="Javascript1.2" src=' + '"http://admin6.testandtarget.omniture.com/admin/mbox/mbox_debug.jsp?mboxServerHost=humanperformancenetw.tt.omtrdc.net' + '&clientCode=nordstrominc"><' + '\/scr' + 'ipt>'); }; var test_name = null; var tntRecipeName = null; var monthsPersistent = 6;
updateProfile = function (x) { if (typeof (mboxFactoryDefault) == 'undefined') return false; var a = x.toString().replace(/\||\#|\-|\+/g, '').split(','), l = a.length, u = false, p = Dc(mboxFactoryDefault.getCookieManager().getCookie('profile')) || '', pA = p.split('+'); for (i = 0; i < l; i++) { if (a[i].indexOf('profile._') > -1 && a[i].indexOf('=') > -1 && a[i].split('=')[1].length > 0) { u = true; var g = a[i].split('profile.')[1].split('=')[0], _val = a[i].split('=')[1]; if (p.indexOf(g) > -1) { p = pA.join('+'); p = p.replace(g + '-' + p.split(g + '-')[1].split('+')[0], g + '-' + _val); pA = []; pA = p.split('+') } else { pA.push(g + '-' + _val) } if (_val.toLowerCase() == 'remove!') { for (n = 0; n < pA.length; n++) { if (pA[n].indexOf(g + '-') > -1) { pA.splice(n--, 1) } } } } } if (p != '' || u) { mboxFactoryDefault.getCookieManager().setCookie('profile', ub(pA.join('+')), _persistDate) } }, xCr = mboxCreate, mboxCreate = function () { var a = Array.prototype.slice.call(arguments, 0); updateProfile(a.join(',')); xCr.apply({}, a) }, xUp = mboxUpdate, mboxUpdate = function () { var a = Array.prototype.slice.call(arguments, 0); updateProfile(a.join(',')); xUp.apply({}, a) }; var _persistDate = monthsPersistent * 30 * 24 * 60 * 60; if (location.search.length > 0) { updateProfile(unescape(location.search.substr(1)).split(';')[0].split('&').join(',').replace(/mbxp/gi, 'profile')) }; var mboxTrack = function (mbox, params) { var m, u, i, f = mboxFactoryDefault; if (f.isEnabled()) { if (f.getMboxes().length() > 0) { m = f.getMboxes().getById(0); u = m.getURL().replace("mbox=" + escape(m.getName()), "mbox=" + mbox).replace("/undefined", "/ajax").replace("mboxPage=" + f.getPageId(), "mboxPage=" + mboxGenerateId()) + '&' + params, i = new Image(); i.style.display = 'none'; i.src = u; document.body.appendChild(i) } else { mboxTrackDefer(mbox, params) } } }, mboxTrackDefer = function (mbox, params) { var f = mboxFactoryDefault; if (f.isEnabled()) { mboxFactoryDefault.getSignaler().signal(mbox, mbox + '&' + params) } }, mboxTrackLink = function (mbox, params, url) { mboxTrack(mbox, params); setTimeout("location='" + url + "'", 500) };