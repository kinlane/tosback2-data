
(function(window,$,undefined){'nord'in window||(window.nord={});$.extend(nord,{miniBag:{selectors:{section:"#mini-bag-section",editShoppingBagOrCheckout:".edit-shopping-bag-or-checkout",editShoppingBag:".edit-shopping-bag",emptyItem:'.empty-item',emptyItemTemplate:'#mini-bag-empty-item-template',item:'.mini-bag-item',itemImageContainer:'.item-image',itemName:'.item-name',itemSize:'.item-size',itemColor:'.item-color',itemQuantity:'.item-quantity',itemPrice:'.item-price',itemRemove:'#item-remove',shoppingBag:"a#mini-bag-shopping-bag",Subtotal:'.subtotal',subtotalSection:'.mini-bag-section-content-bottom',itemTemplate:'#mini-bag-item-template',subtotalTemplate:'#mini-bag-subtotal-template',minibagTabArea:"#mini-bag-section, #shopping-bag-copy",checkout:"a#mini-bag-checkout",checkoutFromHeader:'#chckt-from-header',closeLink:"a#mini-bag-close",closeImg:"#mini-bag-close img",icon:"#shopping-bag-copy",topSection:".mini-bag-section-content-top",messageContainer:".item-message",topMessageContainer:"#item-message"},messages:{itemAdded:"item has been added to your Shopping Bag",itemsAdded:"items have been added to your Shopping Bag",itemRemoved:"item has been removed from your Shopping Bag",itemsRemoved:"items have been removed from your Shopping Bag",itemInBag:"item in Shopping Bag",itemsInBag:"items in Shopping Bag"},init:function(){nord.miniBag.close();nord.miniBag.mouseEnterLeave();$(nord.miniBag.selectors.section).find(nord.miniBag.selectors.itemRemove).on('click',function(e){nord.miniBag.remove($(this));});$('.global-header, .main-content, body').bind('click',function(event){if(event.originalEvent&&$(event.target).closest('#mini-bag-section').length==0){nord.miniBag.closeMiniBag();}});nord.miniBag.showHideCheckoutOption();$(document).bind("N.UpdateMiniBag",function(event,json){nord.miniBag.refreshMiniBag(json);$(nord.miniBag.selectors.topMessageContainer).focus();nord.miniBag.openMiniBag();$('html, body').animate({scrollTop:0},0);event.stopPropagation();event.preventDefault();});nord.miniBag.reCalcMiniBagScrollHeight();},refreshMiniBag:function(jsonObj){$(nord.miniBag.selectors.section).find('ul').html("").prepend(Mustache.render($(nord.miniBag.selectors.itemTemplate).html(),jsonObj)).end().find(nord.miniBag.selectors.itemRemove).on('click',function(e){nord.miniBag.remove($(this));}).end()
$(nord.miniBag.selectors.subtotalSection).html("").html(Mustache.render($(nord.miniBag.selectors.subtotalTemplate).html(),jsonObj));$(nord.miniBag.selectors.checkout).on('click',function(e){cmCreateManualLinkClickTag($(this).attr('href'),'Checkout');});nord.miniBag.addItemAddedRemovedMsg(jsonObj,true);nord.miniBag.reCalcMiniBagScrollHeight();nord.miniBag.showHideCheckoutOption();console.log("add to minibag complete");},addItemAddedRemovedMsg:function(jsonObj,isAdded){if(!jsonObj.QtyAffected)
return;var message="";if(isAdded)
message=jsonObj.QtyAffected>1?nord.miniBag.messages.itemsAdded:nord.miniBag.messages.itemAdded;else
message=jsonObj.QtyAffected>1?nord.miniBag.messages.itemsRemoved:nord.miniBag.messages.itemRemoved;$(nord.miniBag.selectors.messageContainer).html([jsonObj.QtyAffected,message].join(' '));},addItemInBagMsg:function(bagCount){if($(nord.miniBag.selectors.messageContainer).closest(nord.miniBag.selectors.section).find(nord.miniBag.selectors.emptyItem).length>0)
return;var itemInBagMsg=[bagCount,nord.miniBag.messages.itemInBag].join(' ');var itemsInBagMsg=[bagCount,nord.miniBag.messages.itemsInBag].join(' ');bagCount==0||bagCount>1?$(nord.miniBag.selectors.messageContainer).html(itemsInBagMsg):$(nord.miniBag.selectors.messageContainer).html(itemInBagMsg);},close:function(){$(nord.miniBag.selectors.section).find(nord.miniBag.selectors.closeLink).on('click',function(e){e.preventDefault();nord.miniBag.closeMiniBag();}).end()
nord.miniBag.addItemInBagMsg($.getShopperBagCount());},reCalcMiniBagScrollHeight:function(){var items=$(nord.miniBag.selectors.section).find(nord.miniBag.selectors.item);items.filter(':last').addClass("last-item");items.length>2?$(".mini-bag-section-content-scroll").addClass("three-items"):$(".mini-bag-section-content-scroll").removeClass("three-items");},loadEmptyItemContent:function(){$(nord.miniBag.selectors.section).find(nord.miniBag.selectors.subtotalSection).empty().end().find('ul').html($(nord.miniBag.selectors.emptyItemTemplate).html()).end().find(nord.miniBag.selectors.messageContainer).empty();},updateBagCount:function(bagCount){$(nord.miniBag.selectors.icon).find('#shoppingBagCount').html(bagCount).end()},getMiniBagContent:function(){var getURL=PageParameters.storeUrl+"mb/Get",dataPram=$.getMiniBagHash();$.ajax({type:"GET",url:getURL,data:dataPram,success:function(response){if(!response.error){nord.miniBag.updateBagCount(response.ShoppingBagCount);

SetNordstromCookie(response.ShoppingBagCount);

if(response.Items!=null){nord.miniBag.refreshMiniBag(response);nord.miniBag.addItemInBagMsg(response.ShoppingBagCount);}
else{nord.miniBag.loadEmptyItemContent();}}}});},remove:function(clickedItem){var removeURL=PageParameters.storeUrl+"mb/Remove";var currentItem=clickedItem.closest('.mini-bag-item');$.ajax({type:"POST",url:removeURL,data:currentItem.data('value'),success:function(response){if(!response.error){currentItem.remove();nord.miniBag.updateBagCount(response.ShoppingBagCount);

SetNordstromCookie(response.ShoppingBagCount);

if(response.Items!=null){nord.miniBag.addItemAddedRemovedMsg(response,false);$(nord.miniBag.selectors.section).find(".subtotal b").html(response.SubTotal).end()}
else{nord.miniBag.loadEmptyItemContent();}
nord.miniBag.reCalcMiniBagScrollHeight();nord.miniBag.showHideCheckoutOption();cmCreateElementTag("Remove Item - Mini","Shopping Bag");}}});},openMiniBag:function(){$('#keywordSearchForm input[type=text]').blur();$(nord.miniBag.selectors.minibagTabArea).addClass("active");$(nord.miniBag.selectors.checkoutFromHeader).addClass("mini-bag-active");$(window).on('keydown.miniBagClose',function(e){if(e.keyCode==27){nord.miniBag.closeMiniBag();}});},closeMiniBag:function(){$(nord.miniBag.selectors.minibagTabArea).removeClass("active");$(nord.miniBag.selectors.checkoutFromHeader).removeClass("mini-bag-active");$(window).off('keydown.miniBagClose');nord.miniBag.addItemInBagMsg($.getShopperBagCount());},mouseEnterLeave:function(){$(nord.miniBag.selectors.minibagTabArea).mouseover(function(){nord.miniBag.openMiniBag();}).mouseleave(function(){nord.miniBag.closeMiniBag();nord.miniBag.addItemInBagMsg($.getShopperBagCount());});$(nord.miniBag.selectors.icon).mouseover(function(){cmCreateElementTag("Shopping Bag Expand Hover - Mini","Shopping Bag");})},showHideCheckoutOption:function(){if(PageParameters.eZCheckout==false||PageParameters.isPos==true){$(nord.miniBag.selectors.editShoppingBag).addClass('active');$(nord.miniBag.selectors.editShoppingBagOrCheckout).removeClass('active');}
else{$(nord.miniBag.selectors.editShoppingBag).removeClass('active');$(nord.miniBag.selectors.editShoppingBagOrCheckout).addClass('active');if($.getShopperBagCount()==0){$(nord.miniBag.selectors.editShoppingBagOrCheckout).addClass('disable-checkout');$(nord.miniBag.selectors.editShoppingBagOrCheckout).find(nord.miniBag.selectors.checkout).on('click',function(e){return false;});}
$(nord.miniBag.selectors.editShoppingBagOrCheckout).find(nord.miniBag.selectors.checkout).on('click',function(e){if($(this).closest(nord.miniBag.selectors.editShoppingBagOrCheckout).hasClass('disable-checkout'))
cmCreateElementTag("Checkout Button Disabled","Minibag");else
cmCreateElementTag("Checkout Button","Minibag");MiniBagCheckOut("Checkout Button Mini Bag");});$(nord.miniBag.selectors.editShoppingBagOrCheckout).find(nord.miniBag.selectors.shoppingBag).on('click',function(e){cmCreateElementTag("SB Button","Minibag");});}},checkoutFromHeader:function(){if(PageParameters.eZCheckoutHeader==true&&!PageParameters.isPos){$(".shopper-greeting").find('#chckt-from-header').addClass('active').on('click',function(e){MiniBagCheckOut("Checkout Button Global Header");}).end().find('#shopping-bag-copy, #mini-bag-section').addClass('chckt-header-on');}
else
$(".shopper-greeting").find('#chckt-from-header').removeClass('active').end().find('#shopping-bag-copy, #mini-bag-section').removeClass('chckt-header-on');},updateShoppingBagLink:function(){var shoppingBagLinkHtml=["<a href='",PageParameters.secureUrl,"shoppingbag.aspx?origin=tab' name='Shopping Bag icon'>Shopping Bag ","<b>[<span id='shoppingBagCount'></span>]</b></a>"].join('');$(".shopper-greeting").find("#shopping-bag").attr("id","shopping-bag-copy").html(shoppingBagLinkHtml).end().find('.last-separator').hide().end().find('#shoppingBagCount').html($.getShopperBagCount()).end()}}});$(function(){nord.miniBag.updateShoppingBagLink();nord.miniBag.checkoutFromHeader();if(PageParameters.miniBagFeatureEnabled==true)
nord.miniBag.init();else console.log("Minibag Feature is Off");});$(window).load(function(){if(PageParameters.miniBagFeatureEnabled==true){nord.miniBag.getMiniBagContent();}});})(window,jQuery);