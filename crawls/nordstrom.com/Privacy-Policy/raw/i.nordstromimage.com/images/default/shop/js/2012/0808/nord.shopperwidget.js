
(function(window,$,undefined){"use strict";'nord'in window||(window.nord={});$.extend(nord,{shopperWidget:{settings:{cssClass:{expanded:'expanded'},dataAttr:{stateKey:'data-state-key'},dataKey:{minHeight:'minHeight',restrictHeight:'restrictHeight',stateKey:'stateKey'},selector:{scrollContent:'.shopper-widget-scroll-content',scrollWrapper:'.shopper-widget-scroll-wrapper',widget:'#shopper-widget',widgetContent:'.shopper-widget-content',widgetContentInner:'.shopper-widget-content-inner',widgetSection:'.shopper-widget-section'},columnWidth:78,easing:'swing',maxWidth:248,minWidth:95,stateCookieName:'shopperWidgetState'},init:function(widget){this.widget=widget||$(this.settings.selector.widget);this.loadState();this._setupInteraction();},_setupInteraction:function(){var context=this;function onAccordionChange(element){var
stateKey=element.data('stateKey'),isExpanded=element.hasClass(context.settings.cssClass.expanded);context.saveState(stateKey,{"isExpanded":isExpanded});}
this.widget.nordAccordion({change:function(element){onAccordionChange(element);if($(element).hasClass(context.settings.cssClass.expanded)){cmCreatePageElementTag('Widget Expansion','Dressing Room Widget');}},easing:this.settings.easing,expandedCssClass:this.settings.cssClass.expanded,headerSelector:'#shopper-widget-handle',parentSelector:this.settings.selector.widget}).find(this.settings.selector.widgetContentInner).resizable({handles:'w',maxWidth:this.settings.maxWidth,minWidth:this.settings.minWidth,stop:function(e,ui){var
contentInner=ui.helper,stateKey=context.widget.data(context.settings.dataKey.stateKey);context.saveState(stateKey,{"width":contentInner.width()});}}).end().find(this.settings.selector.widgetSection).nordAccordion({change:onAccordionChange,easing:this.settings.easing,expandedCssClass:this.settings.cssClass.expanded,headerSelector:'h1',parentSelector:'section'}).end().find(this.settings.selector.scrollWrapper).resizable({handles:'s',start:function(e,ui){var
wrapper=ui.helper,scrollContent=wrapper.find(context.settings.selector.scrollContent),minHeight=scrollContent.data(context.settings.dataKey.minHeight),maxHeightInWindow=($(window).height()-((context.widget.outerHeight(true)-wrapper.outerHeight(true))+((parseInt(context.widget.css('top'),10)||0)*1.5)));if(!$.isNumeric(minHeight)){minHeight=0;}
wrapper.resizable({minHeight:minHeight,maxHeight:Math.max((wrapper.data(context.settings.dataKey.restrictHeight)===true?Math.min(scrollContent.outerHeight(true),maxHeightInWindow):maxHeightInWindow),minHeight)});},stop:function(e,ui){var
wrapper=ui.helper,stateKey=wrapper.closest(context.settings.selector.widgetSection).data(context.settings.dataKey.stateKey);context.saveState(stateKey,{"height":wrapper.height()});}}).end();},loadState:function(){var
cookieData=nord.utils.cookie.load(this.settings.stateCookieName),prop,element;if(!cookieData){this.widget.addClass(this.settings.cssClass.expanded);return;}
for(prop in cookieData){if(cookieData.hasOwnProperty(prop)){element=$('['+this.settings.dataAttr.stateKey+'='+prop+']');if(cookieData[prop].hasOwnProperty('isExpanded')){element.toggleClass(this.settings.cssClass.expanded,cookieData[prop].isExpanded);}
if(cookieData[prop].hasOwnProperty('height')){element.find(this.settings.selector.scrollWrapper).height(cookieData[prop].height);}
if(cookieData[prop].hasOwnProperty('width')){element.find(this.settings.selector.widgetContentInner).width(cookieData[prop].width);}}}},saveState:function(key,value){var
stateObj={},oldValue;if(!key){return;}
stateObj[key]=value;oldValue=nord.utils.cookie.load(this.settings.stateCookieName);if(oldValue){stateObj=$.extend(true,oldValue,stateObj);}
nord.utils.cookie.save(this.settings.stateCookieName,stateObj);}}});$(function(){var widget=$(nord.shopperWidget.settings.selector.widget);if(widget.length>0){nord.shopperWidget.init(widget);}});})(window,jQuery);