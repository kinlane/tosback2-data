/*
 * Copyright � 1999-2011 TeaLeaf Technology, Inc.
 * All rights reserved.
 *
 * THIS SOFTWARE IS PROVIDED BY TEALEAF ``AS IS''
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE DISCLAIMED.
 * IN NO EVENT SHALL TEALEAF BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @fileoverview
 * This is the configuration for the main UI Client Event Capture JavaScript.
 *
 * @version 2011.07.22.1
 *
 */
if (typeof TeaLeaf === "undefined") {
  TeaLeaf = {};
  TeaLeaf.Private = {};
  TeaLeaf.tlStartLoad = new Date();

  if (!TeaLeaf.Configuration) {
    TeaLeaf.Configuration = {
      "tlversion" :                 "2011.07.22.1",
      "tlinit" :                    false,
      "tlSDK" :                     false,

      "tlSetGUID":                  false,
      /* Sample GUID cookie config (only used when tlSetGUID is true) */
      "tlGUIDCookie":               {
                                      name: "TLGUID",
                                      // The following are optional
                                      valueLength: 32,
                                      valueSet: "0123456789ABCDEF",
                                      path: "",
                                      domain: "",
                                      expires: 0,    // minutes; 0 implies a session cookie
                                      secure: false
                                    },

      "tlurl":                      "/tealeaf.jsp",
      "tlsecureurl":                "/tealeaf.jsp",
      "xhrAsync":                   true,
      "xhrAsyncOnUnload":           true,

      "tlDisableIfInactive":        false,
      "tlActivityTimeout":          5,     // minutes, 0 = disable

      /* Cross-domain configuration (if any) */
      "xd_CommonDomain":            "",
      "xd_iframeID":                "",
      "xd_iframeSrcURL":            "",
      "xd_iframeSrcURLSecure":      ""
    };
  }
}
/*
 * Copyright � 1999-2011 TeaLeaf Technology, Inc.
 * All rights reserved.
 *
 * THIS SOFTWARE IS PROVIDED BY TEALEAF ``AS IS''
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE DISCLAIMED.
 * IN NO EVENT SHALL TEALEAF BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @fileoverview
 * Configuration file for TeaLeafEvent.js
 *
 * @version 2011.07.22.1
 *
 */

if (typeof TeaLeaf !== "undefined" &&
    ((typeof TeaLeaf.replay === "function") ? !TeaLeaf.replay() : !TeaLeaf.replay) &&
    !TeaLeaf.Event)
{
	//	Constructor for the Event
    TeaLeaf.Event = function(type, subtype, source) {    
	    this.date = new Date();
	    if( subtype ) {
		    this.EventType    = type;
		    this.EventSubType = subtype;
		    if( source ) {
			    this.EventSource = source;
		    }
		    else{
		        //default is empty string
		        this.EventSource ="";
		    }
	    }
	    else {
		    this.EventType    = "CUSTOM";
		    this.EventSubType = type;
	    }
    }
    
   if(typeof TeaLeaf.Event.Configuration == "undefined"){  
        TeaLeaf.Event.Configuration = {
            "tlinit"                    : false,
            "tlqueueevents"             : true,
            "tlqueueeventstimer"        : 300000,
            "tlqueueeventsmaxsz"        : 12492,
            "tlshowexceptions"          : false,
            "tleventcount"              : 0,
            "tlexceptioncount"          : 0,
            "tlpageid"                  : "", 
            "tlinitflag"                : false,
            "tlusetopqueue"             : false,
            "tllastdwelltime"           : "",
            "tlidoflastvisitedcontrol"  : "",
            "tlcatcherrors"             : true,
            /* tlcatchpopups
             * Set this to 'true' if you want the SDK to report on window.open() status.
             * Used to determine if popup windows were blocked on the client.
             */
            "tlcatchpopups"             : false,
            /* tlCatchAlerts
             * Set this to 'true' if you want the SDK to report on window.alert(),
             * window.confirm() and window.prompt() calls.
             */
            "tlCatchAlerts"             : false,
            "tlignoresendfailure"       : true,
            "tlasync"                   : true,
            "tlvisitorder"              : "",
            "t1970"                     : 0,
            "tlXP"                      : "",
		    "tlXPCount"                 : 0,
		    "tlXPTable"                 : "",
		    "tlmaxeventcount"           : 300,
		    "tlmaxeventexception"       : 10,


            tlResolution:[
                {"width": 799,       "height": 599,     "type": 0,  "displayText": "small"},
                {"width": 800,       "height": 600,     "type": 1,  "displayText": "800x600"},
                {"width": 1024,      "height": 760,     "type": 2,  "displayText": "1024x760"},
                {"width": 1280,      "height": 1024,    "type": 3,  "displayText": "1280x1024"},
                {"width": 1000000,   "height": 1000000, "type": 4,  "displayText": "large"}
            ],		             
            //This is the list of HTTP headers that are static and are
		    tlHTTPRequestHeadersSet:[
		        {"tlreqhttpheadername": "Content-Type",                     "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetContentType()"},
			    {"tlreqhttpheadername": "X-TeaLeafType",                    "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlEventType()"},
			    {"tlreqhttpheadername": "X-TeaLeafSubType",                 "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlEventSubType()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Url",               "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetUrlPath()"},
                {"tlreqhttpheadername": "X-TeaLeaf-UIEventCapture-Version", "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetJSVersion()"}
		    ],   
		    //This is the list of HTTP headers that have the eval value at the time of POST
		    tlHTTPRequestHeadersEvalInit:[
			    {"tlreqhttpheadername": "X-TeaLeaf-Screen-Res",         "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlResolutionType(screen.width ,screen.height)"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Browser-Res",        "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlResolutionTypeBrowser()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Render",        "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetRenderTime()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Objects",       "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetElementCount(\"object\")"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Img-Fail",      "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlBadImageCount()"}
		    ],  
		    tlHTTPRequestHeadersEvalBeforeUnload:[
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Cui-Events",    "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetEventCount()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Cui-Bytes",     "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Request.GetTotalDataLength()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Cui-Exceptions","tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetExceptionCount()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Alert-Count",        "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetAlertCount()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Dwell",         "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetDwellTime()"},
			    {"tlreqhttpheadername": "X-TeaLeaf-Page-Last-Field",    "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetLastVisitedElementID()"},   
			    {"tlreqhttpheadername": "X-TeaLeaf-Visit-Order",        "tlsethttpheader": true,    "tlreqhttpheadervalue": "TeaLeaf.Event.tlGetVisitOrder()"}   
		    ]   
        };  
    }   
}

/*
 * Copyright � 1999-2011 TeaLeaf Technology, Inc.
 * All rights reserved.
 *
 * THIS SOFTWARE IS PROVIDED BY TEALEAF ``AS IS''
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE DISCLAIMED.
 * IN NO EVENT SHALL TEALEAF BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @fileoverview
 * This is the configuration for TeaLeafEnv.js
 *
 * @version 2011.07.22.1
 *
 */
if (typeof TeaLeaf !== "undefined" &&
    ((typeof TeaLeaf.replay === "function") ? !TeaLeaf.replay() : !TeaLeaf.replay) &&
    !TeaLeaf.Env)
{
	TeaLeaf.Env = {};

    if(typeof TeaLeaf.Env.Configuration == "undefined"){
        TeaLeaf.Env.Configuration = {
            "tlinit" : false,
            "tlinitpost" : true,
            
            tlPlugins : [
		        {"tlIEplugin": "ShockwaveFlash.ShockwaveFlash.1",         "tlpluginname": "Shockwave Flash",      "tlversion":"1.0",    "tlenable": false},    
		        {"tlIEplugin": "MediaPlayer.MediaPlayer.1",               "tlpluginname": "Windows Media Player", "tlversion":"",    "tlenable": false},
		        {"tlIEplugin": "PDF.PdfCtrl.1",                           "tlpluginname": "Adobe Acrobat",        "tlversion":"",     "tlenable": false},
		        {"tlIEplugin": "QuickTimeCheckObject.QuickTimeCheck.1",   "tlpluginname": "QuickTime",            "tlversion":"",     "tlenable": false}
			]
        };
    }
}
/*
 * Copyright � 1999-2011 TeaLeaf Technology, Inc.
 * All rights reserved.
 *
 * THIS SOFTWARE IS PROVIDED BY TEALEAF ``AS IS''
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE DISCLAIMED.
 * IN NO EVENT SHALL TEALEAF BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @fileoverview
 * This is the configuration file for capturing Client Events that
 * happen on the rendered DOM. It proviedes the capabilty to block fields
 * and turn off an on events on the Window and Document object.
 *
 * @version 2011.07.22.1
 *
 */
if (typeof TeaLeaf !== "undefined" &&
    ((typeof TeaLeaf.replay === "function") ? !TeaLeaf.replay() : !TeaLeaf.replay) &&
    !TeaLeaf.Client)
{
    TeaLeaf.Client = {};

    if(typeof TeaLeaf.Client.Configuration == "undefined"){
	    TeaLeaf.Client.Configuration = {
	        "tlinit" : false,
		    "tlpassword"         : 1,		// 1 no capture, 2 don't send value
		    "tlsendfocus"        : false,
		    "tlsendblur"         : false,
		    "tlactiontype"       : "No Submit",
		    "tlcontrolsattached" : false,
		    "tlscanupdate"       : 0,
		    "tlIEhref"           : false,
		    "tlEnableAttr"       : true,
		    "tlDiscardInvalidXPath"  : false,
		    "tlUniqueIDCheckEnabled" : false,
		    "tlScrollOffsetX" : 0,
		    "tlScrollOffsetY" : 0,
		    "tlScrollX" : 0,
		    "tlScrollY" : 0,
		    "tlScrollXDirection" : 0,
		    "tlScrollYDirection" : 0,
		    "tlScrollDirection" : "",
		    "tlScrollDirectionOrig" : "",
		    "tlAndroidOrientation" : 0,

		    

		    //	tlScheduledScan controls whether or not to periodically scan the DOM
		    //	for changes (and tag the appropriate nodes) at the interval defined by
		    //	tlscanupdate
		    tlScheduledScan : false,

		    //  tlExcludeTags controls whether to explicitly exclude or include the
		    //  tags listed in tlNodeTags when attaching to descendent elements using
		    //  TeaLeaf.Client.tlProcessNode(). See TeaLeaf.Client.tlTagNameAllowed()
		    tlExcludeTags : true,

		    //	If events are being cancelled, the document object will not catch events
		    //	since they are not being bubbled up. In order to combat this, we can attach
		    //	to every relevant item (see tlExcludeTags and tlNodeTags), except this may
		    //	result in duplicate events being captured.
		    tlUniversalAttach : false,

		    //  Option to store the xml of queued events on a page unload in a cookie, so
		    //  that it may be sent up with the next page's events. Since this may interfere
		    //  with the existing cookies on the site, this is disabled by default.
		    tlStoreQueueInCookie : false,

        //	This is where input fields can be globally blocked.  A few examples are shown
        //	below. Add or remove fields as appropriate. The parameters are
        //    name and/or id: JavaScript regular expression to match against the name and/or id of the element
        //    className: JavaScript regular expression to match against the CSS class of the element
        //    attributeName: String indicating name of the custom attribute
        //    attributeValue: JavaScript regular expression to match against the value of the custom attribute
        //    caseinsensitive (optional): the above regex match will be case insensitive.
        //    exclude (optional): If true, no value is sent (equivalent to setting the EmptyMask)
        //    mask: Callback function used to mask the element value. This can be a 3rd party custom function.
        //          The following masking functions are provided by default:
        //            PreserveMask(): Preserves the character type and value length according to the tlPrivacyMask setting below.
        //            BasicMask(): Returns a fixed string "XXXXXX" regardless of the element value.
        //            EmptyMask(): Returns the empty string "" regardless of the element value.
        //
        //  Note: The block rules are applied in the order they appear in the tlFieldBlock array.
        tlFieldBlock:[
        /* Sample block rules:
          // Mask all elements that have "private" or "secure" as one of their CSS class using the PreserveMask() function.
          {"className": "private|secure", "caseinsensitive": true,  "exclude": false, "mask": function () { return TeaLeaf.Client.PreserveMask.apply(this, arguments); }}
          // Mask all field names that have "creditcard" or "password" substrings using the PreserveMask() function.
          {"name": "creditcard|password", "caseinsensitive": true,  "exclude": false, "mask": function () { return TeaLeaf.Client.PreserveMask.apply(this, arguments); }}
          // Mask all field ids that match pvt0, pvt1 ... pvt9 using the EmptyMask() function.
          {"id": "^pvt[0-9]$",           "caseinsensitive": true,  "exclude": false, "mask": function () { return TeaLeaf.Client.EmptyMask.apply(this, arguments); }}
          // Paranoid mode: Mask all name and id values with the BasicMask() function.
          {"id": ".*", "name": ".*",     "caseinsensitive": false, "exclude": true,  "mask": function () { return TeaLeaf.Client.BasicMask.apply(this, arguments); }}
          // Mask all elements that have a private attribute "myID" and value of "secret" using the BasicMask() function.
          {"attributeName": "myID", "attributeValue": "secret", "caseinsensitive": true,  "exclude": false, "mask": function () { return TeaLeaf.Client.PreserveMask.apply(this, arguments); }}
        */

          {"id": "password|new_pass|cvn|cardNum|creditcard|pwd", "name": "password|new_pass|cvn|cardNum|creditcard|pwd", "caseinsensitive": true,  "exclude": false, "mask": function () { return TeaLeaf.Client.PreserveMask.apply(this, arguments); }}
        ],


	      // The mask used by the PreserveMask() masking function.
		    tlPrivacyMask: {
		      "upperChar":   "X",
		      "lowerChar":   "x",
		      "numericChar": "9",
		      "symbolChar":  "#"
		    },
		
		    //	This is the list of events we catch off of the window object
		    tlWindowHandlers:[
			    {"domevent": "resize",          "load": false,  "tlhandler": "TeaLeaf.Client.tlQueueResize"},
			    {"domevent": "focus",           "load": true,  "tlhandler": "TeaLeaf.Client.tlSetFocusTime"},
			    {"domevent": "help",            "load": true,  "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "scroll",          "load": false,  "tlhandler": "TeaLeaf.Client.tlSendScroll"},
			    {"domevent": "beforeprint",     "load": false,  "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "afterprint",      "load": false,  "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    //Mobile events
                {"domevent": "devicemotion",    "load": false,  "tlhandler": "TeaLeaf.Client.tlMotionEvent"},
                {"domevent": "deviceorientation","load": false,  "tlhandler": "TeaLeaf.Client.tlDeviceOrientationEvent"},
                {"domevent": "orientationchange","load": false,  "tlhandler": "TeaLeaf.Client.tlOrientationChangeEvent"}
			    
		    ],

		    //	This is the list of events we catch off of the document object
		    tlDocumentHandlers:[
			    {"domevent": "click",        "load": true,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "dblclick",     "load": true,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "keyup",        "load": true,     "tlhandler": "TeaLeaf.Client.tlQueueKey"},
			    {"domevent": "mousedown",    "load": true,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "mouseup",      "load": false,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "mouseover",    "load": false,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domevent": "mouseout",     "load": false,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    //	This event is only caught once and turned off.  This is used to 
			    //	detect robots, since a robot will never have mouse movement.
			    {"domevent": "mousemove",    "load": false,     "tlhandler": "TeaLeaf.Client.tlUserMovement"},
			    {"domevent": "contextmenu",      "load": false,     "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    
			    //Mobile events:
			    {"domevent": "gesturestart",    "load": false,     "tlhandler": "TeaLeaf.Client.tlAddGestureEvent"},
                {"domevent": "gesturechange",   "load": false,     "tlhandler": "TeaLeaf.Client.tlAddGestureEvent"},
                {"domevent": "gestureend",      "load": false,     "tlhandler": "TeaLeaf.Client.tlAddGestureEvent"},
                {"domevent": "touchmove",       "load": false,     "tlhandler": "TeaLeaf.Client.tlAddTouchEvent"},
                {"domevent": "touchstart",      "load": false,     "tlhandler": "TeaLeaf.Client.tlAddTouchEvent"},
                {"domevent": "touchend",        "load": false,     "tlhandler": "TeaLeaf.Client.tlAddTouchEvent"},
                {"domevent": "touchcancel",     "load": false,     "tlhandler": "TeaLeaf.Client.tlAddTouchEvent"}
		    ],
		    
		    tlSingleAttach:[
			    {"domelementID": "",    "domevent": "mouseover",    "tlhandler": "TeaLeaf.Client.tlAddEvent"},
			    {"domelementID": "",    "domevent": "mouseout",     "tlhandler": "TeaLeaf.Client.tlAddEvent"}
		    ],

            tlAttributeCapture:[
                {"tltagname":"a", "tlattributename":"href", "tlevent":"click"},
                {"tltagname":"button", "tlattributename":"value", "tlevent":"click"}
            ],
            

            tlIDBlackList:[
                /* Insert blacklist strings (JavaScript regular expressions) as a comma
                 * separated list here. Leave this empty for default behavior.
                 *
                 * WARNING: Use the blacklist with caution as any id that is matched by
                 * the blacklist will be ignored!
                 * Example:
                "random",
                "jQuery",
                "^gwt",
                "^GWT"
                */
            ],

            tlIDWhiteList:[
                /* Insert whitelist strings (JavaScript regular expressions) as a comma
                 * separated list here. Leave this empty for default behavior.
                 *
                 * WARNING: Use the whitelist with caution as any id that is NOT matched by
                 * the whitelist will be ignored!
                 * Example:
                "static$",
                "^unique"
                */
            ],

		    /*  tlNodeTags by default includes a list of tag names that are "unimportant"
		     *  or not rendered. The associated true/false value is used in conjunction with
		     *  tlExcludeTags - e.g. if tlExcludeTags is true and a node tag is true, it will
		     *  be excluded; if tlExcludeTags is true and a node tag is false, the tag will be
		     *  included. Similarly if tlExcludeTags is false (meaning to explicitly include the
		     *  listed node tags, those with "true" with be excluded.
		     */
		    tlNodeTags : {
		        "APPLET"    : true,
		        "ATTRIBUTE" : true,
			"B"	    : true,
		        "BASE"      : true,
			"BODY"	    : true,
		        "BR"        : true,
		        "CENTER"    : true,
		        "COL"       : true,
		        "COLGROUP"  : true,
		        "COMMENT"   : true,
			"DIV"	    : true,
		        "DEFAULT"   : true,
		        "DEL"       : true,
		        "EVENT"     : true,
		        "FONT"      : true,
			"FORM"	    : true,
			"HEAD"	    : true,
		        "HISTORY"   : true,
		        "HR"        : true,
		        "HTML"      : true,
		        "I"         : true,
		        "INS"       : true,
		        "LINK"      : true,
		        "MAP"       : true,
		        "META"      : true,
		        "NAMESPACE" : true,
		        "NAVIGGATOR" : true,
		        "NOBR"      : true,
		        "OPTION"    : true,
		        "P"         : true,
		        "PARAM"     : true,
		        "S"         : true,
		        "SCRIPT"    : true,
		        "SMALL"     : true,
		        "STRIKE"    : true,
		        "STRONG"    : true,
		        "STYLE"     : true,
		        "SUB"       : true,
		        "SUP"       : true,
		        "TH"        : true,
		        "TITLE"     : true,
		        "THEAD"     : true,
		        "TFOOT"     : true,
		        "TR"        : true,
		        "U"         : true
		    },

		    /*  tlSpecialChildNodeTags represents tags with a special
		     *  situation where the event that fires is attached to a
		     *  non-visual item that is inside the actual UI element.
                 *  Example would be a menu with a <nobr> tag inside to
                 *  keep the visual text of the menu on one line. The <nobr>
                 *  fires the event when we really want the parent menu.
		     */

		    tlSpecialChildNodeTags : {
		        "NOBR" : true,
		        "P"    : true
		    }
	    };
	    	
	    TeaLeaf.Client.Configuration.tlIdCounter = [];
    }
}

if(typeof TeaLeaf!=="undefined"&&((typeof TeaLeaf.replay==="function")?!TeaLeaf.replay():!TeaLeaf.replay)&&TeaLeaf.Configuration&&!TeaLeaf.Configuration.tlinit){TeaLeaf.Configuration.tlinit=true;if(!TeaLeaf.tlBrowser){TeaLeaf.tlBrowser={UNKNOWN:true}}if(!TeaLeaf.$C){TeaLeaf.$C=function(a){return a}}if(!Array.prototype.push){Array.prototype.stackEnd=0;Array.prototype.push=function(a){this[this.stackEnd]=a;this.stackEnd++}}if(!Array.prototype.pop){Array.prototype.pop=function(a){this.stackEnd--;return this[this.stackEnd]}}TeaLeaf.XHRFactory=(function(){var a,b;b=30000;a=function(c){if((c>=200&&c<300)||c===304){return true}return false};return{createXHRObject:function(){var d,c,g;c=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP.6.0")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(d=0;d<c.length;d++){try{g=c[d]()}catch(f){continue}if(g){this.createXHRObject=c[d];return g}}return null},xhrRequest:function(h,l,c,j,o,m,n){var f,d;if(!h||!l){return null}h=h.toUpperCase();if(!n){n=this.createXHRObject()}if(!n){return null}if(o){n.onreadystatechange=function(){var p,r;try{switch(n.readyState){case 0:break;case 1:break;case 2:if(m&&m.loaded){try{p=n.status;r=n.statusText}catch(q){if(!p){p=0}if(!r){r="None"}}finally{m.loaded(p,r)}}break;case 3:break;case 4:if(a(n.status)){if(m&&m.success){m.success(n.responseText,n.responseXML)}}else{if(m&&m.failure){m.failure(n.status,n.statusText)}}break;default:break}}catch(q){}}}n.open(h,l,o);if(c){for(f=0;f<c.length;f++){n.setRequestHeader(c[f].name,c[f].value)}}if(h!=="POST"||!j){j=null}if(o){try{d=setTimeout(function(){TeaLeaf.XHRFactory.deleteXHRObj(n)},b);n.timeoutID=d}catch(g){}}n.send(j);return n},deleteXHRObj:function(c){if(c&&c.readyState!==4){if(c.abort){c.abort()}}if(c.timeoutID){clearTimeout(c.timeoutID);c.timeoutID=null}c.onreadystatechange=function(){};c=null}}})();TeaLeaf.Request=function(){var b,c,d,a;b=c=a=null;d="POST";this.getUrl=function(){var l,h,g,j,f;if(a){return a}l=TeaLeaf.Configuration;j=window.location;f=j.protocol;g=f+"//"+j.host;if(f=="http:"){h=l.tlurl}else{h=l.tlsecureurl}if(h.substr(0,1)=="/"){g+=h}else{g+=j.pathname.substr(0,j.pathname.lastIndexOf("/")+1)+h}return g};this.setUrl=function(f){a=f};this.getMethod=function(){return d};this.setMethod=function(f){d=f};this.getData=function(){return b};this.setData=function(f){var g;b=f;if(b){g=TeaLeaf.Request.totalDataLength||0;g+=b.length;TeaLeaf.Request.totalDataLength=g}};this.getHeaders=function(){return c};this.setHeaders=function(f){c=f};this.clear=function(){b=c=a=null}};TeaLeaf.Request.prototype={send:function(j){var a,c,b,d,h,g;h=TeaLeaf.Configuration;if(!h.xd_iframeID){g=TeaLeaf.XHRFactory.xhrRequest(this.getMethod(),this.getUrl(),this.getHeaders(),this.getData(),h.xhrAsync,j);if(!g){if(j&&j.failure){j.failure(0,"XHR request failed!")}return}}else{try{a=document.getElementById(h.xd_iframeID);if(!a||!a.contentWindow){if(j&&j.failure){j.failure(0,"Could not retrive cross-domain iframe target!")}return}c=a.contentWindow;if(c.postMessage&&window.JSON&&0){alert("Not implemented!")}else{d=c.TeaLeaf;if(d&&d.Request){b=new d.Request();b.clear();this.setUrl(b.getUrl());b.setHeaders(this.getHeaders());b.setData(this.getData());b.send(j)}}}catch(f){if(j&&j.failure){j.failure(0,(f.name?(f.name+": "+f.message):f.toString()))}return}}}};TeaLeaf.Request.GetTotalDataLength=function(){var a;a=TeaLeaf.Request.totalDataLength||0;return a};TeaLeaf.settlSDK=function(){TeaLeaf.Configuration.tlSDK=true};TeaLeaf.resettlSDK=function(){TeaLeaf.Configuration.tlSDK=false};TeaLeaf.tlSetPostURL=function(a){TeaLeaf.Configuration.tlurl=a};TeaLeaf.tlGetPostURL=function(){return TeaLeaf.Configuration.tlurl};TeaLeaf.makeRandomString=function(d,c){var b,a,f;if(!d||d<=0){return}if(!c){c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890~!@#$%^+-?"}f="";for(b=0;b<d;b++){a=Math.floor(Math.random()*c.length);f+=c.charAt(a)}return f};TeaLeaf.getNodeType=function(b){var c,a;if(!b){return""}c=b.nodeName?b.nodeName.toLowerCase():"";a="";if(c==="input"||c==="object"||c==="script"){a=b.type?b.type.toLowerCase():""}return a};TeaLeaf.tLoadObjs=[];TeaLeaf.addOnLoad=function(b,a){if(arguments.length===1){TeaLeaf.tLoadObjs.push(b)}else{if(arguments.length>1){TeaLeaf.tLoadObjs.push(b[a])}}};TeaLeaf.tlSetCookie=function(b,d,a,g,c,f){if(!b){return}document.cookie=b+"="+d+(a?(";expires="+a.toUTCString()):"")+";path="+(g?g:"/")+(c?(";domain="+c):"")+(f?";secure":"")};TeaLeaf.tlGetCookieValue=function(b){var d,a,l,f,g,h;h=b+"=";g=null;f=document.cookie.split(";");for(d=0;d<f.length;d++){l=f[d];for(a=0;l.charAt(a)==" ";a++){}if(a){l=l.substring(a,l.length)}if(l.indexOf(h)===0){g=l.substring(h.length,l.length);break}}return g};TeaLeaf.tlEraseCookie=function(b){var a;a=new Date(1970,1,1);TeaLeaf.tlSetCookie(b,"",a)};TeaLeaf.tlBrowserIsIE=function(){var a;a=TeaLeaf.tlBrowser;if(a){return !!a.MSIE}return false};TeaLeaf.tlBrowserIsMozilla=function(){var a;a=TeaLeaf.tlBrowser;if(a){return !!a.MOZILLA}return false};TeaLeaf.tlBrowserIsWebKit=function(){var a;a=TeaLeaf.tlBrowser;if(a){return !!a.WEBKIT}return false};TeaLeaf.tlBrowserIsOpera=function(){var a;a=TeaLeaf.tlBrowser;if(a){return !!a.OPERA}return false};TeaLeaf.tlBrowserIsUnknown=function(){var a;a=TeaLeaf.tlBrowser;if(a){return !!a.UNKNOWN}return false};(function(){var c,a,g,h,b,f,d;c=TeaLeaf;a=c.Client;h=c.Event;g=c.Configuration;b=null;d=false,f=true;c.tlDisable=function(){f=false;if(g.tlDisableIfInactive&&!d){try{h.tlFlushQueue(true);a.tlDetachFromAllControls();TeaLeaf.Event.tlRemoveHandler(window,"beforeunload",TeaLeaf.Event.tlBeforeUnload,false);TeaLeaf.Event.tlRemoveHandler(window,"unload",TeaLeaf.Event.tlUnload,false)}catch(j){}d=true}};c.activitySinceDisabled=function(){return f};c.tlKeepAlive=function(){if(b){window.clearTimeout(b);b=null}if(!d&&g.tlActivityTimeout){b=window.setTimeout(function(){c.tlDisable()},(g.tlActivityTimeout*60000))}if(!f){f=true}}})();TeaLeaf.PageSetup=function(){var f,n,c,j,m,b,d,l,h,a;if(document.readyState&&document.readyState!=="complete"){return}d=TeaLeaf;l=d.Configuration;h=l.tlGUIDCookie;if(d.PageSetup.Complete){return}d.PageSetup.Complete=true;if(d.PageSetup.Cleanup){d.PageSetup.Cleanup()}d.tlBrowser.UNKNOWN=false;a=navigator.userAgent.toLowerCase();if(/opera|presto/.test(a)){d.tlBrowser.OPERA=true}else{if(/(apple)?webkit|safari|chrome/.test(a)){d.tlBrowser.WEBKIT=true}else{if(/msie|trident/.test(a)){d.tlBrowser.MSIE=true}else{if(/^(?=.*?\b(mozilla|gecko|firefox)\b)((?!compatible).)*$/.test(a)){d.tlBrowser.MOZILLA=true}else{d.tlBrowser.UNKNOWN=true}}}}if(l.xd_CommonDomain){try{document.domain=l.xd_CommonDomain}catch(g){}}if(l.xd_iframeID){try{j=document.getElementById(l.xd_iframeID);if(!j){m=((window.location.protocol==="http:")?l.xd_iframeSrcURL:l.xd_iframeSrcURLSecure);if(m){j=document.createElement("IFRAME");if(j){j.id=l.xd_iframeID;j.src=m;j.style.display="none";j.style.visibility="hidden";document.body.appendChild(j)}}}}catch(g){}}if(l.tlSetGUID){if(!h||!h.name){}else{if(!h.valueLength){h.valueLength=32}if(!h.valueSet){h.valueSet="0123456789ABCDEF"}n=d.tlGetCookieValue(h.name);if(!n){b=new Date();n=d.makeRandomString(h.valueLength,h.valueSet);c=h.expires?new Date(b.getTime()+h.expires*60*1000):null;d.tlSetCookie(h.name,n,c,h.path,h.domain,h.secure)}}}if(!l.tlSDK){for(f=0;f<d.tLoadObjs.length;f++){d.tLoadObjs[f]()}}d.EndLoad=new Date()};if(document.readyState==="complete"){TeaLeaf.PageSetup()}else{if(document.addEventListener){document.addEventListener("DOMContentLoaded",TeaLeaf.PageSetup,false);window.addEventListener("load",TeaLeaf.PageSetup,false);TeaLeaf.PageSetup.Cleanup=function(){var a;a=TeaLeaf;document.removeEventListener("DOMContentLoaded",a.PageSetup,false);window.removeEventListener("load",a.PageSetup,false)}}else{if(document.attachEvent){document.attachEvent("onreadystatechange",TeaLeaf.PageSetup);window.attachEvent("onload",TeaLeaf.PageSetup);TeaLeaf.PageSetup.Cleanup=function(){var a;a=TeaLeaf;document.detachEvent("onreadystatechange",a.PageSetup);window.detachEvent("onload",a.PageSetup)}}else{if(typeof window.onload==="function"){TeaLeaf.OnLoad=window.onload}else{TeaLeaf.OnLoad=null}window.onload=function(){var a;a=TeaLeaf;a.PageSetup();window.onload=a.OnLoad;if(a.OnLoad){a.OnLoad()}}}}}}if(typeof TeaLeaf!=="undefined"&&((typeof TeaLeaf.replay==="function")?!TeaLeaf.replay():!TeaLeaf.replay)&&TeaLeaf.Event&&TeaLeaf.Event.Configuration){try{if(typeof TeaLeaf_PageID=="undefined"){TeaLeaf_PageID=null}}catch(e){TeaLeaf_PageID=null}TeaLeaf.Event.tlQueuedXML="";TeaLeaf.Event.tlQueuedXPXML="";TeaLeaf.Event.tlWindowObjects=[{tlWindowName:"",tlWindowObject:""}];TeaLeaf.Event.tlGetContentType=function(){var a="text/xml";return a};TeaLeaf.Event.tlGetTeaLeafXEvent=function(){var a=TeaLeaf.$C("ClientEvent");return a};TeaLeaf.Event.tlEventType=function(){var a;a=TeaLeaf.Event.SetType;TeaLeaf.Event.SetType="";return a};TeaLeaf.Event.tlEventSubType=function(){var a;a=TeaLeaf.Event.SetSubType;TeaLeaf.Event.SetSubType="";return a};TeaLeaf.Event.tlGetUrlPath=function(){var a=window.location.pathname;return a};TeaLeaf.Event.tlGetJSVersion=function(){return TeaLeaf.Configuration.tlversion};TeaLeaf.Event.tlResolutionType=function(d,a){var c=TeaLeaf.Event.Configuration.tlResolution;for(var b=0;b<c.length;b++){if(d<=c[b].width||a<=c[b].height){return c[b].type}}return c[c.length-1].type};TeaLeaf.Event.tlResolutionTypeBrowser=function(){var b=0;var a=0;if(window.innerWidth){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientWidth){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&document.body.clientWidth){b=document.body.clientWidth;a=document.body.clientHeight}else{var c=document.getElementsByTagName("body");if(c.length>0){b=c[0].clientWidth;a=c[0].clientHeight}}}}var d=TeaLeaf.Event.tlResolutionType(b,a);return d};TeaLeaf.Event.tlGetRenderTime=function(){return TeaLeaf.Event.PageLoadMilliSecs};TeaLeaf.Event.tlGetElementCount=function(a){return document.getElementsByName(a).length};TeaLeaf.Event.tlBadImageCount=function(){var c,f,d,a,b;f=0;d=document.images;b=d.length;for(c=0;c<b;c++){a=d[c];if((!a)||(typeof a.complete==="boolean"&&!a.complete)||(typeof a.naturalWidth!=="undefined"&&a.naturalWidth===0)){f++;continue}}return f};TeaLeaf.Event.tlFlashSend=function(c,b,f,a){var d=new TeaLeaf.Event(c,b);d.tlAddData(f.split(a));d.tlSend()};TeaLeaf.Event.tlShowFlashDebug=function(a,c){c+="<BR>";for(i=0;i<TeaLeaf.Event.tlWindowObjects.length;i++){if(TeaLeaf.Event.tlWindowObjects[i].tlWindowName==a){if(TeaLeaf.Event.tlWindowObjects[i].tlWindowObject.closed){TeaLeaf.Event.tlWindowObjects[i].tlWindowObject=window.open("",a,"width=600,height=300,scrollbars=yes,resizable=yes")}TeaLeaf.Event.tlWindowObjects[i].tlWindowObject.document.writeln(c.fontsize(2));TeaLeaf.Event.tlWindowObjects[i].tlWindowObject.scrollTo(0,50000);return}}var b=window.open("",a,"width=600,height=300,scrollbars=yes,resizable=yes");TeaLeaf.Event.tlWindowObjects.push({tlWindowName:a,tlWindowObject:b});b.document.writeln(c.fontsize(2))};TeaLeaf.Event.tlSetEventCount=function(a){TeaLeaf.Event.Configuration.tleventcount=a};TeaLeaf.Event.tlGetEventCount=function(){return TeaLeaf.Event.Configuration.tleventcount};TeaLeaf.Event.tlGetSendStringBytes=function(a){return a.length};TeaLeaf.Event.tlGetExceptionCount=function(){return(TeaLeaf.Event.Configuration.tlcatcherrors?TeaLeaf.Event.Configuration.tlexceptioncount:null)};TeaLeaf.Event.tlGetDwellTime=function(){return TeaLeaf.Event.tlDateDiff(TeaLeaf.tlStartLoad,TeaLeaf.Event.Configuration.tllastdwelltime)};TeaLeaf.Event.tlGetLastVisitedElementID=function(){return TeaLeaf.Event.Configuration.tlidoflastvisitedcontrol};TeaLeaf.Event.tlDateDiff=function(b,a){return Math.abs(b-a)};TeaLeaf.Event.tlGetVisitOrder=function(){return TeaLeaf.Event.Configuration.tlvisitorder};TeaLeaf.Event.tlFormatXML=function(a){if(a){if(a.replace){return a.replace(/&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return a}return""};TeaLeaf.Event.tlGetCookie=function(c){var b=document.cookie;var f=c+"=";var d=b.indexOf("; "+f);if(d==-1){d=b.indexOf(f);if(d!=0){return""}}else{d+=2}var a=document.cookie.indexOf(";",d);if(a==-1){a=b.length}return unescape(b.substring(d+f.length,a))};TeaLeaf.Event.tlGetHTTPHeaders=function(tlheaderconfig){var i,headers,value;headers=[];for(i=0;i<tlheaderconfig.length;i++){if(tlheaderconfig[i].tlsethttpheader){value=eval(tlheaderconfig[i].tlreqhttpheadervalue);if(value){headers.push({name:tlheaderconfig[i].tlreqhttpheadername,value:value})}}}return headers};TeaLeaf.Event.tlGetPageId=function(){if(TeaLeaf.Event.Configuration.tlpageid){return TeaLeaf.Event.Configuration.tlpageid}if(TeaLeaf_PageID){TeaLeaf.Event.Configuration.tlpageid=TeaLeaf_PageID;return TeaLeaf.Event.Configuration.tlpageid}TeaLeaf.Event.Configuration.tlpageid="ID"+TeaLeaf.tlStartLoad.getHours()+"H"+TeaLeaf.tlStartLoad.getMinutes()+"M"+TeaLeaf.tlStartLoad.getSeconds()+"S"+TeaLeaf.tlStartLoad.getMilliseconds()+"R"+Math.random();return TeaLeaf.Event.Configuration.tlpageid};TeaLeaf.Event.tlSendFailure=function(a,l,j){var d,g,b,c;g=new Date();d=Date.UTC(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate(),g.getUTCHours(),g.getUTCMinutes(),g.getUTCSeconds(),g.getUTCMilliseconds());if(TeaLeaf.tlStartLoad){c=TeaLeaf.Event.tlDateDiff(g,TeaLeaf.tlStartLoad)}TeaLeaf.Event.Configuration.tleventcount++;TeaLeaf.Event.Configuration.tlexceptioncount++;b="<"+TeaLeaf.$C("ClientEvent")+" "+TeaLeaf.$C("Count")+'="'+TeaLeaf.Event.Configuration.tleventcount+'" '+TeaLeaf.$C("Type")+'="'+TeaLeaf.$C("INFO")+'" '+TeaLeaf.$C("SubType")+'="'+TeaLeaf.$C("EXCEPTION")+'" '+TeaLeaf.$C("FailedUrl")+'="'+TeaLeaf.Event.tlFormatXML(l)+'" '+TeaLeaf.$C("Message")+'="'+TeaLeaf.Event.tlFormatXML(j)+'" '+TeaLeaf.$C("TimeDuration")+'="'+c+'" '+TeaLeaf.$C("DateSince1970")+'="'+d+'" '+TeaLeaf.$C("PageId")+'="'+TeaLeaf.Event.tlGetPageId()+'"  />\r\n';try{TeaLeaf.Event.Configuration.tlasync=true;var f=new TeaLeaf.Event(TeaLeaf.$C("INFO"),TeaLeaf.$C("EXCEPTION"));f.tlSendXML(b,true)}catch(h){if(TeaLeaf.Event.Configuration.tlshowexceptions){alert(h.name+": "+h.message+"\r\n\r\nPos 4")}}};TeaLeaf.Event.tlGetTransport=function(){var a;if(window.XMLHttpRequest){try{a=new XMLHttpRequest()}catch(b){a=null}}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){a=null}}}}return a};TeaLeaf.Event.TransportArray=[];TeaLeaf.Event.tlXMLHTTPObj=function(){var a=0;for(;a<TeaLeaf.Event.TransportArray.length;a++){if(TeaLeaf.Event.TransportArray[a]&&TeaLeaf.Event.TransportArray[a].readyState>0){if(TeaLeaf.Event.TransportArray[a].readyState==4){TeaLeaf.Event.TransportArray[a].abort();TeaLeaf.Event.TransportArray[a].onreadystatechange=new function(){};return TeaLeaf.Event.TransportArray[a]}}else{TeaLeaf.Event.TransportArray[a]=TeaLeaf.Event.tlGetTransport();return TeaLeaf.Event.TransportArray[a]}}TeaLeaf.Event.TransportArray[a]=TeaLeaf.Event.tlGetTransport();return TeaLeaf.Event.TransportArray[a]};TeaLeaf.Event.tlCleanXMLHTTPObj=function(b){var a=0;for(;a<TeaLeaf.Event.TransportArray.length;a++){if(b==TeaLeaf.Event.TransportArray[a]){TeaLeaf.Event.TransportArray[a]=null}}};TeaLeaf.Event.tlAddHandler=function(b,f,d,c){try{if(!b){return}if(b.addEventListener){b.addEventListener(f,d,c)}else{if(b.attachEvent){b.attachEvent("on"+f,d)}else{}}}catch(a){if(TeaLeaf.Event.Configuration.tlshowexceptions){alert(a.name+": "+a.message+"\r\n\r\nPos 4")}}};TeaLeaf.Event.tlRemoveHandler=function(b,f,d,c){try{if(!b){return}if(b.removeEventListener){b.removeEventListener(f,d,c)}else{if(b.detachEvent){b.detachEvent("on"+f,d)}}}catch(a){if(TeaLeaf.Event.Configuration.tlshowexceptions){alert(a.name+": "+a.message+"\r\n\r\nPos 5")}}};TeaLeaf.Event.tlFlushQueue=function(f){var h=null;var b=TeaLeaf.Event.Configuration.tlqueueeventstimer;var d=b*3;if(TeaLeaf.Event.Configuration.tlusetopqueue){var c=new Date();var g=(c-top.TeaLeaf.Event.TimeSent);if(top.TeaLeaf.Event.tlQueuedXML){if(f||g>=b){h=top.TeaLeaf.Event.tlQueuedXML;top.TeaLeaf.Event.tlQueuedXML="";top.TeaLeaf.Event.TimeSent=c}}if(!h){if(!f&&g<(b/2)){if(b>=d){b=d}else{b=(b*3)/2}}return b}}else{if(!TeaLeaf.Event.tlQueuedXML){return b}h=TeaLeaf.Event.tlQueuedXML;TeaLeaf.Event.tlQueuedXML=""}var a=new TeaLeaf.Event(TeaLeaf.$C("GUI"),TeaLeaf.$C("QUEUED"));a.tlSendXML(h);return b};TeaLeaf.Event.prototype.tlPushXML=function(a,c){if(!this.XMLStack){this.XMLStack=[]}if(c){}else{var b="  <"+a+" ";if(this.XMLData){this.XMLData+=b}else{this.XMLData=b}}};TeaLeaf.Event.prototype.tlPopXML=function(){if(this.XMLData){this.XMLData+="/>\r\n"}else{return false}};TeaLeaf.Event.prototype.tlAddData=function(a){var g="";if(this.XMLStack){for(var d=0;d<this.XMLStack.length;d++){g+="  "}}var f=[];for(var d=0;d<a.length;d+=2){var c=a[d];var b=TeaLeaf.Event.tlFormatXML(a[d+1]);if(c&&b){f[f.length]=g+c+'="'+b+'" '}}if(!this.XMLData){this.XMLData=""}this.XMLData+=f.join("");a=null};TeaLeaf.Event.prototype.tlSendXML=function(a,b){var m,c,g;try{g=new TeaLeaf.Request();if(!g){return}g.clear();var l=new Date();var d=Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate(),l.getUTCHours(),l.getUTCMinutes(),l.getUTCSeconds(),l.getUTCMilliseconds());var j="<"+TeaLeaf.$C("ClientEventSet")+" "+TeaLeaf.$C("PostTimeStamp")+'="'+d+'" >';a=j+a+"</"+TeaLeaf.$C("ClientEventSet")+">";TeaLeaf.Event.Configuration.tlignoresendfailure=b;g.setData(a);c=[{name:"X-TeaLeaf",value:"ClientEvent"}];c=c.concat(TeaLeaf.Event.tlGetHTTPHeaders(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersSet));if(TeaLeaf.Event.Configuration.tlinitflag&&!TeaLeaf.Event.InitHeadersSent){c=c.concat(TeaLeaf.Event.tlGetHTTPHeaders(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalInit));TeaLeaf.Event.InitHeadersSent=true}if(TeaLeaf.Event.SendUnloadHeaders&&!TeaLeaf.Event.UnloadHeadersSent){c=c.concat(TeaLeaf.Event.tlGetHTTPHeaders(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalBeforeUnload));TeaLeaf.Event.UnloadHeadersSent=true}g.setHeaders(c);m={loaded:function(n,o){if(TeaLeaf.tlGetCookieValue("tlQueuedXML")){TeaLeaf.tlEraseCookie("tlQueuedXML")}},failure:function(n,o){if(!TeaLeaf.Event.Configuration.tlignoresendfailure){TeaLeaf.Event.Configuration.tlignoresendfailure=true;TeaLeaf.Event.tlSendFailure(g.getUrl(),g.getUrl(),"Status "+n+": "+o)}},success:function(n,o){TeaLeaf.Event.Configuration.tlignoresendfailure=false}};g.send(m)}catch(h){var f;f=g?g.getUrl():"none";if(TeaLeaf.Event.Configuration.tlshowexceptions){if(h.name){alert(h.name+": "+h.message+"\r\n\r\nURL: "+f+"\r\n\r\nPos 3 ")}else{alert(h+"\r\n\r\nURL: "+f+"\r\n\r\nPos 3 ")}}if(!TeaLeaf.Event.Configuration.tlignoresendfailure){TeaLeaf.Event.Configuration.tlignoresendfailure=true;TeaLeaf.Event.tlSendFailure(f,f,h.name?(h.name+": "+h.message):h.toString())}}};TeaLeaf.Event.prototype.tlSend=function(a){TeaLeaf.tlKeepAlive();TeaLeaf.Event.Configuration.tleventcount++;if(this.XMLStack){while(this.XMLStack.length>0){this.tlPopXML()}}if(TeaLeaf.Event.Configuration.tleventcount>TeaLeaf.Event.Configuration.tlmaxeventcount){TeaLeaf.Event.tlFlushQueue();return}var b=Date.UTC(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate(),this.date.getUTCHours(),this.date.getUTCMinutes(),this.date.getUTCSeconds(),this.date.getUTCMilliseconds());sendStr="<"+TeaLeaf.$C("ClientEvent")+" "+TeaLeaf.$C("Count")+'="'+TeaLeaf.Event.Configuration.tleventcount+'" '+TeaLeaf.$C("Type")+'="'+this.EventType+'" '+TeaLeaf.$C("SubType")+'="'+this.EventSubType+'" ';if(this.EventSource){sendStr+=TeaLeaf.$C("Source")+'="'+this.EventSource+'" '}if(!a){sendStr+=this.XMLData}if(TeaLeaf.tlStartLoad){sendStr+=TeaLeaf.$C("TimeDuration")+'="'+TeaLeaf.Event.tlDateDiff(this.date,TeaLeaf.tlStartLoad)+'" '}sendStr+=TeaLeaf.$C("DateSince1970")+'="'+b+'" ';sendStr+=TeaLeaf.$C("PageId")+'="'+TeaLeaf.Event.tlGetPageId()+'" ';if(a){sendStr+=">\r\n"+this.XMLData+"</"+TeaLeaf.$C("ClientEvent")+">\r\n"}else{sendStr+="/>\r\n"}if(TeaLeaf.Event.Configuration.tlqueueevents){if(TeaLeaf.Event.Configuration.tlusetopqueue){if(top.TeaLeaf.Event.tlQueuedXML){top.TeaLeaf.Event.tlQueuedXML+=sendStr}else{top.TeaLeaf.Event.tlQueuedXML=sendStr}}else{if(TeaLeaf.Event.tlQueuedXML){TeaLeaf.Event.tlQueuedXML+=sendStr}else{TeaLeaf.Event.tlQueuedXML=sendStr}}if(TeaLeaf.Event.Configuration.tlqueueeventsmaxsz<TeaLeaf.Event.tlQueuedXML.length){TeaLeaf.Event.tlFlushQueue()}return}try{this.tlSendXML(sendStr);this.XMLData=""}catch(c){}this.XMLData=""};TeaLeaf.Event.tlXMLEncode=function(a){if(a==null){return a}a=a.replace(/&/g,"&#38;");a=a.replace(/"/g,"&#34;");a=a.replace(/'/g,"&#39;");a=a.replace(/:/g,"&#58;");return a};TeaLeaf.Event.tlXMLDecode=function(a){if(a==null){return a}a=a.replace(/&#58;/g,":");a=a.replace(/&#39;/g,"'");a=a.replace(/&#34;/g,'"');a=a.replace(/&#38;/g,"&");return a};TeaLeaf.Event.tlEnableAllHTTPHeaders=function(a){if(a){if(a=="info"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersSet,true,"all")}else{if(a=="init"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalInit,true,"all")}else{if(a=="beforeunload"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalBeforeUnload,true,"all")}}}}else{TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersSet,true,"all");TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalInit,true,"all");TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalBeforeUnload,true,"all")}};TeaLeaf.Event.tlEnableHTTPHeader=function(a,b){if(a=="info"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersSet,true,b)}else{if(a=="init"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalInit,true,b)}else{if(a=="beforeunload"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalBeforeUnload,true,b)}}}};TeaLeaf.Event.tlDisableAllHTTPHeaders=function(a){if(a){if(a=="info"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersSet,false,"all")}else{if(a=="init"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalInit,false,"all")}else{if(a=="beforeunload"){TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalBeforeUnload,false,"all")}}}}else{TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersSet,false,"all");TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalInit,false,"all");TeaLeaf.Event.tlEventJSONCfgUtil(TeaLeaf.Event.Configuration.tlHTTPRequestHeadersEvalBeforeUnload,false,"all")}};TeaLeaf.Event.tlEnableQueueEvents=function(){TeaLeaf.Event.Configuration.tlqueueevents=true};TeaLeaf.Event.tlDisableQueueEvents=function(){TeaLeaf.Event.Configuration.tlqueueevents=false};TeaLeaf.Event.tlEnableShowExceptions=function(){TeaLeaf.Event.Configuration.tlshowexceptions=true};TeaLeaf.Event.tlDisableShowExceptions=function(){TeaLeaf.Event.Configuration.tlshowexceptions=false};TeaLeaf.Event.tlSetQueueEventTime=function(a){TeaLeaf.Event.Configuration.tlqueueeventstimer=a};TeaLeaf.Event.tlGetQueueEventTime=function(){return TeaLeaf.Event.Configuration.tlqueueeventstimer};TeaLeaf.Event.tlSetQueueEventMaxSize=function(a){TeaLeaf.Event.Configuration.tlqueueeventsmaxsz=a};TeaLeaf.Event.tlGetQueueEventMaxSize=function(){return TeaLeaf.Event.Configuration.tlqueueeventsmaxsz};TeaLeaf.Event.tlGetAlertCount=function(){var b,c,a;b=TeaLeaf;c=b.Event;a=c.getAlertCount?c.getAlertCount():0;return a};TeaLeaf.Event.tlEventJSONCfgUtil=function(d,c,a){for(var b=0;b<d.length;b++){if(a=="all"){d[b].load=c}else{if(a==d[b].domevent){d[b].load=c}}}};TeaLeaf.Event.tlErrorHandler=function(d,c,a){TeaLeaf.Event.Configuration.tlexceptioncount++;if(TeaLeaf.Event.Configuration.tlexceptioncount>TeaLeaf.Event.Configuration.tlmaxeventexception){return}if((typeof d!=="string")&&!c){return false}var b=new Date();if(!a){a="-"}var g=new TeaLeaf.Event(TeaLeaf.$C("INFO"),TeaLeaf.$C("EXCEPTION"));var f=[TeaLeaf.$C("Message"),d,TeaLeaf.$C("URL"),escape(c),TeaLeaf.$C("Line"),a];g.tlAddData(f);TeaLeaf.Event.Configuration.tlasync=true;g.tlSend();TeaLeaf.Event.tlFlushQueue();return false};(function(){var f,h,a,d,j,g,c,b;f=TeaLeaf;h=f.Configuration;a=f.Client;d=a.Configuration;j=f.Event;g=j.Configuration;b=false;c=function(l){var o,p;if(b){return}if(!f.activitySinceDisabled()){return}if(d.tlIEhref){d.tlIEhref=false;return}b=true;if(!h.xhrAsyncOnUnload){h.xhrAsync=false}if(d.tlStoreQueueInCookie){var n=new Date();n.setTime(n.getTime()+300000);var m=j.tlQueuedXML.replace(/(\r|\n)/g,"").replace(/;/g,"%3B");f.tlSetCookie("tlQueuedXML",m,n,"/")}g.tllastdwelltime=new Date();p=new j(f.$C("PERFORMANCE"),l);j.SetType=p.EventType;if(!j.SetSubType){j.SetSubType=p.EventSubType}else{j.SetSubType+="; "+p.EventSubType}j.SendUnloadHeaders=true;o=[f.$C("MouseMove"),a.tlHasUserMovement?f.$C("True"):f.$C("False"),f.$C("Action"),d.tlactiontype,f.$C("VisitOrder"),g.tlvisitorder,f.$C("Alerts"),j.tlGetAlertCount()];p.tlAddData(o);p.tlSend();j.tlFlushQueue(true);setTimeout(function(){b=false;h.xhrAsync=true;j.SendUnloadHeaders=false},1000)};j.tlBeforeUnload=function(){c(f.$C("BeforeUnload"))};j.tlUnload=function(){a.tlDetachFromAllControls();c(f.$C("Unload"))}})();TeaLeaf.Event.EventSetup=function(){var b,f,d;b=TeaLeaf;f=b.Event;d=f.Configuration;if(d.tlCatchAlerts){(function(){var g,h,l,j;g=0;if(window.alert&&window.alert.apply){h=window.alert;window.alert=function(){var m;m=h.apply(window,arguments);g++;return m}}if(window.confirm&&window.confirm.apply){l=window.confirm;window.confirm=function(){var m;m=l.apply(window,arguments);g++;return m}}if(window.prompt&&window.prompt.apply){j=window.prompt;window.prompt=function(){var m;m=j.apply(window,arguments);g++;return m}}f.getAlertCount=function(){return g}})()}if(TeaLeaf.Event.Configuration.tlcatcherrors){if(typeof window.onerror!=="function"){window.onerror=TeaLeaf.Event.tlErrorHandler}}TeaLeaf.Event.tlAddHandler(window,"beforeunload",TeaLeaf.Event.tlBeforeUnload,false);TeaLeaf.Event.tlAddHandler(window,"unload",TeaLeaf.Event.tlUnload,false);if(TeaLeaf.Event.Configuration.tlqueueevents){TeaLeaf.Event.tlTimerRoutine=function(){var h=TeaLeaf.Event.Configuration.tlqueueeventstimer;try{h=TeaLeaf.Event.tlFlushQueue()}catch(g){if(TeaLeaf.Event.Configuration.tlshowexceptions){alert(g.name+": "+g.message+"\r\n\r\nPos 7")}}setTimeout("TeaLeaf.Event.tlTimerRoutine()",h)};setTimeout("TeaLeaf.Event.tlTimerRoutine()",TeaLeaf.Event.Configuration.tlqueueeventstimer)}var a=new Date();var c=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());TeaLeaf.Event.Configuration.t1970=c;TeaLeaf.Event.Loaded=true};TeaLeaf.Event.tlAddCustomEvent=function(b,d){var f,g,c,a,h;if(!b||typeof b!=="string"){b="custom"}if(!d||typeof d!=="object"){return}h=new TeaLeaf.Event(TeaLeaf.$C("UIEventAppInfo"),b);f=0;a=[];for(g in d){if(g&&d.hasOwnProperty(g)){if(typeof d[g]==="undefined"){c="undefined"}else{if(d[g]===null){c="null"}else{c=d[g].toString()}}a[f++]=TeaLeaf.Event.tlXMLEncode(g);a[f++]=c}}h.tlAddData(a);h.tlSend()};if(TeaLeaf.Event.Configuration.tlinit==false){TeaLeaf.Event.Configuration.tlinit=true;TeaLeaf.Event.prototype.XMLData="";TeaLeaf.addOnLoad(TeaLeaf.Event.EventSetup)}}if(typeof TeaLeaf!=="undefined"&&((typeof TeaLeaf.replay==="function")?!TeaLeaf.replay():!TeaLeaf.replay)&&TeaLeaf.Env&&TeaLeaf.Env.Configuration){TeaLeaf.Env.tlSendPageSummary=function(){var c,a,b,d,h,f,g;c=TeaLeaf;a=c.Configuration;b=c.Env;d=c.Event;h=b.Configuration;f=d.Configuration;if(a.tlSDK||!h.tlinitpost){return}h.tlinitpost=false;g=new d(c.$C("PERFORMANCE"),c.$C("INIT"));d.PageLoadMilliSecs=d.tlDateDiff(c.tlStartLoad,g.date);d.SetType=g.EventType;if(!d.SetSubType){d.SetSubType=g.EventSubType}else{d.SetSubType+="; "+g.EventSubType}f.tlinitflag=true;b.tlInfo(g);b.tlDOMDocumentInfo(g);b.tlDOMWindowInfo(g);b.tlDOMScreenInfo(g);b.tlPluginInfo(g);g.tlSend(true)};TeaLeaf.Env.tlInfo=function(b){b.tlPushXML(TeaLeaf.$C("Info"));var a=[TeaLeaf.$C("PageLoadMilliSecs"),TeaLeaf.Event.tlGetRenderTime(),TeaLeaf.$C("Version"),TeaLeaf.Event.tlGetJSVersion(),TeaLeaf.$C("TimezoneOffset"),b.date.getTimezoneOffset()];b.tlAddData(a);b.tlPopXML()};TeaLeaf.Env.tlDOMDocumentInfo=function(d){var c,b,a;a=TeaLeaf;d.tlPushXML(a.$C("Document"));c=[a.$C("Title"),document.title,a.$C("Referer"),document.referer,a.$C("ContentType"),document.contentType,a.$C("LastModified"),document.lastModified,a.$C("CharacterSet"),document.characterSet,a.$C("Height"),document.height,a.$C("Width"),document.width];d.tlAddData(c);b=[a.$C("Anchors"),document.anchors.length,a.$C("Applets"),document.applets.length,a.$C("Embeds"),(document.embeds?document.embeds.length:0),a.$C("Forms"),document.forms.length,a.$C("Images"),document.images.length,a.$C("BadImages"),(a.tlBrowserIsWebKit()?0:a.Event.tlBadImageCount()),a.$C("Links"),document.links.length,a.$C("Plugins"),(document.plugins?document.plugins.length:0)];d.tlAddData(b);d.tlPopXML()};TeaLeaf.Env.tlDOMWindowInfo=function(g){var b,f,c,a;b=TeaLeaf;g.tlPushXML(b.$C("Window"));f=[b.$C("WindowHref"),escape(window.location.href),b.$C("WindowProtocol"),window.location.protocol,b.$C("WindowHost"),window.location.host,b.$C("WindowHostName"),window.location.hostname,b.$C("WindowPort"),window.location.port,b.$C("WindowPathName"),window.location.pathname];g.tlAddData(f);if(window.innerHeight&&window.innerWidth){g.tlAddData([b.$C("ClientSize"),(window.innerWidth+"x"+window.innerHeight)])}else{if(document.body){if(document.body.clientWidth&&document.body.clientHeight){g.tlAddData([b.$C("ClientSize"),(document.body.clientHeight+"x"+document.body.clientWidth)])}}}c=[b.$C("FullScreen"),navigator.fullScreen,b.$C("Frames"),window.frames.length];if(typeof window.sessionStorage==="object"){try{a=window.sessionStorage.TLTWID;if(a==null){a=b.makeRandomString(6);window.sessionStorage.TLTWID=a}}catch(d){a=null}finally{g.tlAddData([b.$C("WindowId"),a])}}g.tlAddData(c);g.tlPopXML()};TeaLeaf.Env.tlDOMNavigatorInfo=function(b){b.tlPushXML(TeaLeaf.$C("Navigator"));var a=[TeaLeaf.$C("AppCodeName"),navigator.appCodeName,TeaLeaf.$C("AppName"),navigator.appName,TeaLeaf.$C("AppVersion"),navigator.appVersion,TeaLeaf.$C("BrowserLanguage"),navigator.browserLanguage,TeaLeaf.$C("CookieEnabled"),navigator.cookieEnabled,TeaLeaf.$C("CPUClass"),navigator.cpuClass,TeaLeaf.$C("Language"),navigator.language,TeaLeaf.$C("OSCPU"),navigator.oscpu,TeaLeaf.$C("Platform"),navigator.platform,TeaLeaf.$C("Product"),navigator.product,TeaLeaf.$C("SystemLanguage"),navigator.systemLanguage,TeaLeaf.$C("UserAgent"),navigator.userAgent,TeaLeaf.$C("UserLanguage"),navigator.userLanguage,TeaLeaf.$C("Vendor"),navigator.vendor,TeaLeaf.$C("VendorSub"),navigator.vendorSub];b.tlAddData(a);b.tlPopXML()};TeaLeaf.Env.tlDOMScreenInfo=function(b){b.tlPushXML(TeaLeaf.$C("Screen"));var a=[TeaLeaf.$C("AvailHeight"),screen.availHeight,TeaLeaf.$C("AvailLeft"),screen.availLeft,TeaLeaf.$C("AvailTop"),screen.availTop,TeaLeaf.$C("AvailWidth"),screen.availWidth,TeaLeaf.$C("BufferDepth"),screen.bufferDepth,TeaLeaf.$C("ColorDepth"),screen.colorDepth,TeaLeaf.$C("DeviceXDPI"),screen.deviceXDPI,TeaLeaf.$C("DeviceYDPI"),screen.deviceYDPI,TeaLeaf.$C("FontSmoothingEnabled"),screen.fontSmoothingEnabled,TeaLeaf.$C("Height"),screen.height,TeaLeaf.$C("Left"),screen.left,TeaLeaf.$C("LogicalXDPI"),screen.logicalXDPI,TeaLeaf.$C("LogicalYDPI"),screen.logicalYDPI,TeaLeaf.$C("Top"),screen.top,TeaLeaf.$C("UpdateInterval"),screen.updateInterval,TeaLeaf.$C("Width"),screen.width];b.tlAddData(a);b.tlPopXML()};TeaLeaf.Env.tlPluginInfo=function(l){if(window.ActiveXObject){for(var d=0;d<TeaLeaf.Env.Configuration.tlPlugins.length;d++){if(!TeaLeaf.Env.Configuration.tlPlugins[d].tlenable){continue}var b=TeaLeaf.Env.Configuration.tlPlugins[d].tlIEplugin;try{var a=new ActiveXObject(b);if(a){l.tlPushXML(TeaLeaf.$C("Plugin"));var h=[TeaLeaf.$C("Pluginname"),TeaLeaf.Env.Configuration.tlPlugins[d].tlpluginname,TeaLeaf.$C("Version"),TeaLeaf.Env.Configuration.tlPlugins[d].tlversion];l.tlAddData(h);l.tlPopXML()}}catch(g){}}}else{for(var d=0;d<navigator.plugins.length;d++){for(var c=0;c<TeaLeaf.Env.Configuration.tlPlugins.length;c++){if(!TeaLeaf.Env.Configuration.tlPlugins[c].tlenable){continue}var f=navigator.plugins[d].name.substr(0,TeaLeaf.Env.Configuration.tlPlugins[c].tlpluginname.length);if(f==TeaLeaf.Env.Configuration.tlPlugins[c].tlpluginname){TeaLeaf.Env.Configuration.tlPlugins[c].tlenable=false;l.tlPushXML(TeaLeaf.$C("Plugin"));var h=[TeaLeaf.$C("Pluginname"),TeaLeaf.Env.Configuration.tlPlugins[c].tlpluginname,TeaLeaf.$C("Version"),TeaLeaf.Env.Configuration.tlPlugins[c].tlversion];l.tlAddData(h);l.tlPopXML()}}}}};TeaLeaf.Env.CallInit=function(){TeaLeaf.addOnLoad(TeaLeaf.Env.tlSendPageSummary)};if(TeaLeaf.Env.Configuration.tlinit==false){TeaLeaf.Env.Configuration.tlinit=true;TeaLeaf.Env.CallInit()}}if(typeof TeaLeaf!=="undefined"&&((typeof TeaLeaf.replay==="function")?!TeaLeaf.replay():!TeaLeaf.replay)&&TeaLeaf.Client&&TeaLeaf.Client.Configuration){TeaLeaf.Client.tlTimeoutID=-1;TeaLeaf.Client.tlHasUserMovement=false;TeaLeaf.Client.tlUserMovement=function(){TeaLeaf.Client.tlHasUserMovement=true;TeaLeaf.Event.tlRemoveHandler(document,"mousemove",TeaLeaf.Client.tlUserMovement,false)};TeaLeaf.Client.EmptyMask=function(a){return""};TeaLeaf.Client.BasicMask=function(a){if(!a||!a.value){return null}return"XXXXXX"};TeaLeaf.Client.PreserveMask=function(b){var a,c;if(!b||!b.value){return null}a=TeaLeaf.Client.Configuration.tlPrivacyMask;c=b.value;c=c.replace(/[A-Z]/g,a.upperChar);c=c.replace(/[a-z]/g,a.lowerChar);c=c.replace(/[0-9]/g,a.numericChar);c=c.replace(/[^A-Za-z0-9]/g,a.symbolChar);return c};TeaLeaf.Client.getFieldBlockMatch=function(c){var b,f,d,a;d=TeaLeaf.Client.Configuration.tlFieldBlock;if(typeof c==="string"){c=document.getElementById(c)}if(!c){return null}for(b=0;b<d.length;b++){a=d[b];if(a.id){if(!a.idRE){a.idRE=new RegExp(a.id,(a.caseinsensitive?"i":""))}if(a.idRE.test(c.id)){return a}}if(a.name){if(!a.nameRE){a.nameRE=new RegExp(a.name,(a.caseinsensitive?"i":""))}if(a.nameRE.test(c.name)){return a}}if(a.className){if(!a.classRE){a.classRE=new RegExp(a.className,(a.caseinsensitive?"i":""))}if(a.classRE.test(c.className)){return a}}if(a.attributeName&&a.attributeValue){f=c.getAttribute(a.attributeName);if(f){if(!a.attributeRE){a.attributeRE=new RegExp(a.attributeValue,(a.caseinsensitive?"i":""))}if(a.attributeRE.test(f)){return a}}}}return null};TeaLeaf.Client.tlIsReplace=function(a){if(typeof a==="string"){a=document.getElementById(a)}if(!a){return false}if(TeaLeaf.Client.getFieldBlockMatch(a)){return true}if(TeaLeaf.getNodeType(a)==="password"){return TeaLeaf.Client.Configuration.tlpassword===2}return false};TeaLeaf.Client.tlReplaceValue=function(a){var b;if(typeof a==="string"){a=document.getElementById(a)}if(!a){return null}b=TeaLeaf.Client.getFieldBlockMatch(a);if(b){return b.mask(a)}return a.value};TeaLeaf.Client.tlIsExcluded=function(a){var b;if(typeof a==="string"){a=document.getElementById(a)}if(!a){return false}b=TeaLeaf.Client.getFieldBlockMatch(a);if(b){return b.exclude}if(TeaLeaf.getNodeType(a)==="password"){return TeaLeaf.Client.Configuration.tlpassword===2}return false};TeaLeaf.Client.tlGetName=function(c){if(c==null){return null}var b=c.id;if(b&&b!=""){return b}var a=c.name;if(a&&a!=""){return a}return null};TeaLeaf.Client.tlGetEventSource=function(b){var a;a=null;if(!b){return null}if(b.srcElement){a=b.srcElement}else{a=b.target;if(!a){a=b.explicitOriginalTarget}if(!a){a=b.originalTarget}}if(a&&a.tagName==="HTML"){return null}if(a&&!a.name){if(a.parentNode&&a.parentNode.tagName){if(a.parentNode.tagName=="A"||a.parentNode.tagName=="LINK"){a=a.parentNode}}}if(!a||!a.tagName){a=window.document.body}return a};TeaLeaf.Client.tlGetAnchor=function(c,b){if(c==null){return null}if(c.name&&c.name!=""){return null}var a;for(a=0;a<document.anchors.length;a++){if(document.anchors[a]==c){if(b){return"<AnchorElement>"+a+"</AnchorElement>\r\n"}else{return"Anchor-"+a}}}for(a=0;a<document.links.length;a++){if(document.links[a]==c){if(b){return"<LinkElement>"+a+"</LinkElement>\r\n"}else{return"Link-"+a}}}return null};TeaLeaf.Client.checkIsInput=function(a){if(typeof(a)=="string"){a=document.getElementById(a)}switch(a.tagName){case"INPUT":case"SELECT":case"TEXTAREA":return true}return false};TeaLeaf.Event.tlFormatXMLName=function(d){if(!d||d.length<=0){return null}var b="";if(!TeaLeaf.Event.tlNameStartChar(d.charCodeAt(0))){b="_"}var a=d.length;var c;for(c=0;c<a;c++){if(TeaLeaf.Event.tlNameChar(d.charCodeAt(c))){b=b+d.charAt(c)}else{b=b+"_"}}return b};TeaLeaf.Event.tlNameStartChar=function(a){return(a>=65&&a<=90)||a==95||(a>=97&&a<=122)||(a>=192&&a<=214)||(a>=216&&a<=246)||(a>=248&&a<=767)||(a>=880&&a<=893)||(a>=895&&a<=8191)||(a>=8204&&a<=8205)||(a>=8304&&a<=8591)||(a>=11264&&a<=12271)||(a>=12289&&a<=55295)||(a>=63744&&a<=64975)||(a>=65008&&a<=65533)};TeaLeaf.Event.tlNameChar=function(a){return TeaLeaf.Event.tlNameStartChar(a)||a==45||a==46||(a>=48&&a<=57)||a==183||(a>=768&&a<=879)||(a>=8255&&a<=8256)};TeaLeaf.Client.tlQueuedKeys="";TeaLeaf.Client.getNormalizedKeyCode=function(b){var a;if(!b||!b.keyCode||(b.keyCode<32&&b.keyCode!==8&&b.keyCode!==20)){return null}a="";if(b.ctrlKey){a+="c-"}if(b.altKey){a+="a-"}if(b.shiftKey){a+="s-"}if(!TeaLeaf.tlBrowserIsIE()){switch(b.keyCode){case 59:a+=186;break;default:a+=b.keyCode;break}}else{a+=b.keyCode}return a};TeaLeaf.Client.tlQueueKey=function(h){var f,d,g,c,a,b;c=TeaLeaf;a=c.Client;b=a.Configuration;a.tlSendResize();a.tlSendScroll(true);if(!h){h=window.event}if(!a.tlQueuedKeysCount){a.tlQueuedKeys=null;a.tlQueuedKeysCount=0}d=a.tlGetEventSource(h);if(!d){return}if(!d.TeaLeafFocusTime){d.TeaLeafFocusTime=new Date()}if(a.tlQueuedKeySource){if(a.tlQueuedKeySource!=d){if(a.tlQueuedKeys&&a.tlQueuedKeys.length>0){a.tlSendKeys()}a.tlQueuedKeySource=d}}else{a.tlQueuedKeySource=d}f=a.tlGetName(d);if(!f){f=a.tlGetXPathFromNode(d);if(!f){if(!a.tlGetAnchor(d,false)){a.tlQueuedKeySource=null}return}else{a.tlQueuedKeySource=d}}else{if(a.tlIsReplace(d)){a.tlQueuedKeysCount++;return}if(a.tlIsExcluded(d)){a.tlQueuedKeys=null;a.tlQueuedKeysCount++;return}}g=a.getNormalizedKeyCode(h);if(g){if(a.tlQueuedKeys&&a.tlQueuedKeys.length>0){a.tlQueuedKeys+=";"}a.tlQueuedKeys+=g}};TeaLeaf.Client.tlSendKeys=function(){var p=TeaLeaf.Client,g,f;if(!p.tlQueuedKeySource||(!p.tlQueuedKeys&&!p.tlQueuedKeysCount)){return}var d=p.tlQueuedKeySource;var l=p.tlQueuedKeys;var s=p.tlQueuedKeysCount;p.tlQueuedKeySource=null;p.tlQueuedKeys="";p.tlQueuedKeysCount=0;f=p.tlGetXPathFromNode(d);if(!f&&p.Configuration.tlDiscardInvalidXPath){return}var q,n;q=!!p.tlIsReplace(d);n=!!p.tlIsExcluded(d);if(q||n){l=null;s=0}var a=TeaLeaf.Client.tlGetName(d);var b=null;g=d.id;if(!TeaLeaf.Client.CheckIfIdValid(d)){g=""}var o=new TeaLeaf.Event(TeaLeaf.$C("GUI"),TeaLeaf.$C("KeyUp"));var m=[TeaLeaf.$C("Name"),d.name,TeaLeaf.$C("Id"),g,TeaLeaf.$C("Lev"),b,TeaLeaf.$C("ElementType"),TeaLeaf.getNodeType(d),TeaLeaf.$C("TagName"),d.tagName,TeaLeaf.$C("XPath"),f,TeaLeaf.$C("KeyCount"),s];o.tlAddData(m);if(n){o.tlAddData([TeaLeaf.$C("Excluded"),TeaLeaf.$C("True")])}else{if(q){var j=p.tlReplaceValue(d);var r=[TeaLeaf.$C("ValueIn"),a,a,j];o.tlAddData(r)}else{var c=TeaLeaf.Event.tlFormatXMLName(a);if(!c){c=f;c=TeaLeaf.Event.tlFormatXMLName(c)}var h=[TeaLeaf.$C("ValueIn"),c,c,d.value,TeaLeaf.$C("KeyCode"),l];o.tlAddData(h)}}o.tlSend()};TeaLeaf.Client.tlSendResize=function(){if(!TeaLeaf.Client.ResizeClientX&&!TeaLeaf.Client.ResizeClientY){return}var b=new TeaLeaf.Event(TeaLeaf.$C("GUI"),TeaLeaf.$C("Resize"));var a=[TeaLeaf.$C("ClientX"),TeaLeaf.Client.ResizeClientX,TeaLeaf.$C("ClientY"),TeaLeaf.Client.ResizeClientY,TeaLeaf.$C("ScreenX"),TeaLeaf.Client.ResizeScreenX,TeaLeaf.$C("ScreenY"),TeaLeaf.Client.ResizeScreenY];b.tlAddData(a);TeaLeaf.Client.ResizeClientX=null;TeaLeaf.Client.ResizeClientY=null;TeaLeaf.Client.ResizeScreenX=null;TeaLeaf.Client.ResizeScreenY=null;b.tlSend()};TeaLeaf.Client.tlQueueScroll=function(b){var a=true;if(!b){b=window.event}if(b.clientX){if(TeaLeaf.Client.ScrollClientX==b.clientX&&TeaLeaf.Client.ScrollClientY==b.clientY&&TeaLeaf.Client.ScrollScreenX==b.screenX&&TeaLeaf.Client.ScrollScreenY==b.screenY){a=false}else{TeaLeaf.Client.ScrollClientX=b.clientX;TeaLeaf.Client.ScrollClientY=b.clientY;TeaLeaf.Client.ScrollScreenX=b.screenX;TeaLeaf.Client.ScrollScreenY=b.screenY}}else{if(TeaLeaf.Client.ScrollHeight==b.target.scrollHeight&&TeaLeaf.Client.ScrollWidth==b.target.scrollWidth&&TeaLeaf.Client.ScrollTop==b.target.scrollTop&&TeaLeaf.Client.ScrollLeft==b.target.scrollLeft){a=false}else{TeaLeaf.Client.ScrollHeight=b.target.scrollHeight;TeaLeaf.Client.ScrollWidth=b.target.scrollWidth;TeaLeaf.Client.ScrollTop=b.target.scrollTop;TeaLeaf.Client.ScrollLeft=b.target.scrollLeft}}return a};TeaLeaf.Client.tlCheckScroll=function(){var a=TeaLeaf.Client.Configuration.tlWindowHandlers;for(var b=0;b<a.length;b++){if(a[b].domevent=="scroll"&&a[b].load){return true}}return false};TeaLeaf.Client.tlSendScroll=function(b){if(TeaLeaf.Client.tlCheckScroll()==false){return}var c=0,a=0;if(typeof(window.pageYOffset)=="number"){a=window.pageYOffset;c=window.pageXOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollTop;c=document.body.scrollLeft}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollTop;c=document.documentElement.scrollLeft}}}if(TeaLeaf.Client.Configuration.tlScrollOffsetX==0){TeaLeaf.Client.Configuration.tlScrollOffsetX=c}else{if(c>TeaLeaf.Client.Configuration.tlScrollOffsetX){TeaLeaf.Client.Configuration.tlScrollDirection="right"}else{if(c<TeaLeaf.Client.Configuration.tlScrollOffsetX){TeaLeaf.Client.Configuration.tlScrollDirection="left"}}}if(TeaLeaf.Client.Configuration.tlScrollOffsetY==0){TeaLeaf.Client.Configuration.tlScrollOffsetY=a}else{if(a>TeaLeaf.Client.Configuration.tlScrollOffsetY){TeaLeaf.Client.Configuration.tlScrollDirection="down"}else{if(a<TeaLeaf.Client.Configuration.tlScrollOffsetY){TeaLeaf.Client.Configuration.tlScrollDirection="up"}}}if(c>0){TeaLeaf.Client.Configuration.tlScrollX=c}if(a>0){TeaLeaf.Client.Configuration.tlScrollY=a}if(TeaLeaf.Client.Configuration.tlScrollOffsetX==TeaLeaf.Client.Configuration.tlScrollX&&TeaLeaf.Client.Configuration.tlScrollOffsetY==TeaLeaf.Client.Configuration.tlScrollY){return}if(b==true||(TeaLeaf.Client.Configuration.tlScrollDirectionOrig!=TeaLeaf.Client.Configuration.tlScrollDirection)){var f=new TeaLeaf.Event(TeaLeaf.$C("GUI"),TeaLeaf.$C("scroll"));var d=[TeaLeaf.$C("ClientX"),TeaLeaf.Client.ScrollClientX,TeaLeaf.$C("ClientY"),TeaLeaf.Client.ScrollClientY,TeaLeaf.$C("ScreenX"),TeaLeaf.Client.ScrollScreenX,TeaLeaf.$C("ScreenY"),TeaLeaf.Client.ScrollScreenY,TeaLeaf.$C("ScrollHeight"),TeaLeaf.Client.ScrollHeight,TeaLeaf.$C("ScrollWidth"),TeaLeaf.Client.ScrollWidth,TeaLeaf.$C("ScrollTop"),TeaLeaf.Client.ScrollTop,TeaLeaf.$C("ScrollLeft"),TeaLeaf.Client.ScrollLeft,TeaLeaf.$C("OrigX"),TeaLeaf.Client.Configuration.tlScrollOffsetX+"",TeaLeaf.$C("OrigY"),TeaLeaf.Client.Configuration.tlScrollOffsetY+"",TeaLeaf.$C("CurrX"),TeaLeaf.Client.Configuration.tlScrollX+"",TeaLeaf.$C("CurrY"),TeaLeaf.Client.Configuration.tlScrollY+"",TeaLeaf.$C("OrigDirection"),TeaLeaf.Client.Configuration.tlScrollDirectionOrig,TeaLeaf.$C("CurrDirection"),TeaLeaf.Client.Configuration.tlScrollDirection];f.tlAddData(d);f.tlSend()}TeaLeaf.Client.Configuration.tlScrollOffsetX=TeaLeaf.Client.Configuration.tlScrollX;TeaLeaf.Client.Configuration.tlScrollOffsetY=TeaLeaf.Client.Configuration.tlScrollY;TeaLeaf.Client.Configuration.tlScrollDirectionOrig=TeaLeaf.Client.Configuration.tlScrollDirection};TeaLeaf.Client.tlFindAncestorByTag=function(b,a){var c=b.parentNode;while(c&&c!=window.document){if(c.nodeType!=1){continue}if(c.tagName==a){break}else{c=c.parentNode}}return c};TeaLeaf.Client.tlCheckBlackList=function(a){var d,c,b;if(!TeaLeaf.Client.Configuration.tlIDBlackList||!TeaLeaf.Client.Configuration.tlIDBlackList.length){return false}if(a){for(d=0;d<TeaLeaf.Client.Configuration.tlIDBlackList.length;d++){b=new RegExp(TeaLeaf.Client.Configuration.tlIDBlackList[d],"g");c=a.match(b);if(c){return true}}}return false};TeaLeaf.Client.tlCheckWhiteList=function(a){var d,c,b;if(!TeaLeaf.Client.Configuration.tlIDWhiteList||!TeaLeaf.Client.Configuration.tlIDWhiteList.length){return true}if(a){for(d=0;d<TeaLeaf.Client.Configuration.tlIDWhiteList.length;d++){b=new RegExp(TeaLeaf.Client.Configuration.tlIDWhiteList[d],"g");c=a.match(b);if(c){return true}}}return false};TeaLeaf.Client.tlGetXPathFromNode=function(a){if(!a){return null}var g=[];var l=a;var h=null;var m=null;for(var f in TeaLeaf.Client.Configuration.tlSpecialChildNodeTags){if(l.tagName.toString()==f){l=l.parentNode}}var d=false;for(d=TeaLeaf.Client.CheckIfIdValid(l);l!=window.document&&(!d);d=TeaLeaf.Client.CheckIfIdValid(l)){h=null;m=null;switch(l.tagName){case"TD":if(m=TeaLeaf.Client.tlFindAncestorByTag(l,"TR")){h=m.cells}break;case"TR":if(m=TeaLeaf.Client.tlFindAncestorByTag(l,"TABLE")){h=m.rows}break;case"OPTION":if(m=TeaLeaf.Client.tlFindAncestorByTag(l,"SELECT")){h=m.options}break;default:m=l.parentNode;if(!m){m=window.document}h=m.childNodes;break}if(h==null){return null}var c=0;for(var f=0;f<h.length;f++){if(h[f].nodeType==1&&h[f].tagName==l.tagName){if(h[f]==l){g[g.length]=[l.tagName.toUpperCase(),c];break}c++}}l=m}if(d){g[g.length]=[l.id]}if(!g.length){return null}var b=[];for(var f=g.length-1;f>=0;f--){if(g[f].length>1){b[b.length]="['"+g[f][0]+"',"+g[f][1]+"]"}else{b[b.length]="['"+g[f][0].toString().replace(/'/g,"\\'")+"']"}}return"["+b.join(",")+"]"};TeaLeaf.Client.CheckIfIdValid=function(a){var c;if(!a||!a.id||typeof(a.id)!="string"){return false}if(TeaLeaf.Client.tlCheckBlackList(a.id)===true){return false}if(TeaLeaf.Client.tlCheckWhiteList(a.id)===false){return false}if(!TeaLeaf.Client.Configuration.tlUniqueIDCheckEnabled){return true}c=a.id;a.id=(new Date()).getTime()+"_TeaLeaf";try{if(!document.getElementById(c)){a.id=c;return true}else{a.id=c;return false}}catch(b){return false}finally{a.id=c}};TeaLeaf.Client.tlGetNodeFromXPath=function(path,decode){if(path==null){return null}if(decode){path=TeaLeaf.Event.tlXMLDecode(path)}var xpath=eval(path);if(xpath==null){return null}var cur_node=window.document;for(var i=0;i<xpath.length;i++){found=false;if(xpath[i].length==1){cur_node=document.getElementById(xpath[i]);if(cur_node==null){return null}}else{k=0;switch(cur_node.tagName){case"TABLE":children=cur_node.rows;break;case"TR":children=cur_node.cells;break;case"SELECT":children=cur_node.options;break;default:children=cur_node.childNodes;break}for(var j=0;j<children.length;j++){if(children[j].nodeType!=1){continue}if(children[j].tagName.toUpperCase()==xpath[i][0]){if(k==xpath[i][1]){cur_node=children[j];found=true;break}k++}}if(!found){return null}}}return cur_node};window.TeaLeaf_Client_tlGetNodeFromXPath=TeaLeaf.Client.tlGetNodeFromXPath;TeaLeaf.Private.tlPrevEvent;TeaLeaf.Private.setLastProcessedEvent=function(b){var c=TeaLeaf.Private,a;if(!b){return}if(!c.tlPrevEvent){c.tlPrevEvent={}}c.tlPrevEvent.type=b.type;c.tlPrevEvent.button=b.button;c.tlPrevEvent.clientX=b.clientX;c.tlPrevEvent.clientY=b.clientY;if(typeof b.keyCode!=="undefined"){c.tlPrevEvent.keyCode=b.keyCode}else{c.tlPrevEvent.keyCode=a}if(typeof b.charCode!=="undefined"){c.tlPrevEvent.charCode=b.charCode}else{c.tlPrevEvent.charCode=a}if(typeof b.timeStamp!=="undefined"){if(b.timeStamp.getTime){c.tlPrevEvent.timeStamp=b.timeStamp.getTime()}else{c.tlPrevEvent.timeStamp=b.timeStamp}}else{c.tlPrevEvent.timeStamp=new Date().getTime()}if(typeof b.target!=="undefined"){c.tlPrevEvent.target=b.target}else{c.tlPrevEvent.target=a}if(typeof b.srcElement!=="undefined"){c.tlPrevEvent.srcElement=b.srcElement}else{c.tlPrevEvent.srcElement=a}};TeaLeaf.Private.getLastProcessedEvent=function(){return TeaLeaf.Private.tlPrevEvent};TeaLeaf.Client.isDuplicateEvent=function(a){var d=TeaLeaf.Private,c=d.getLastProcessedEvent();if(!c||!a){d.setLastProcessedEvent(a);return false}if(typeof a.timeStamp!=="undefined"){var b=a.timeStamp.getTime?a.timeStamp.getTime():a.timeStamp;if(c.timeStamp!==b){d.setLastProcessedEvent(a);return false}}else{a.timeStamp=new Date().getTime();if(Math.abs(a.timeStamp-c.timeStamp)>300){d.setLastProcessedEvent(a);return false}}if(c.type!==a.type){d.setLastProcessedEvent(a);return false}if(c.target!==a.target){d.setLastProcessedEvent(a);return false}if(c.srcElement!==a.srcElement){d.setLastProcessedEvent(a);return false}if(c.button!==a.button){d.setLastProcessedEvent(a);return false}if(c.clientX!==a.clientX||c.clientY!==a.clientY){d.setLastProcessedEvent(a);return false}if(c.keyCode!==a.keyCode){d.setLastProcessedEvent(a);return false}d.setLastProcessedEvent(a);return true};TeaLeaf.Client.tlCheckAttributes=function(g,h){var c=[];var b=TeaLeaf.Client.Configuration.tlAttributeCapture;for(var d=0;d<b.length;d++){if(b[d].tlevent==h.type){var j=b[d].tltagname.toLowerCase();var f=g.tagName.toLowerCase();if(j==f){var a=g.getAttribute(b[d].tlattributename);if(a){c.push(b[d].tlattributename,escape(a))}}}}return c};TeaLeaf.Client.tlOrientationChangeEvent=function(h){var b=TeaLeaf,a=b.Client,f=a.Configuration,g,j,d;if(!h){h=window.event}j=new b.Event(b.$C("GUI"),h.type);if(navigator){var c=navigator.userAgent.toLowerCase()}if(c.indexOf("android")>-1){d=TeaLeaf.Client.Configuration.tlAndroidOrientation+window.orientation;if(d==270){d=-90;TeaLeaf.Client.Configuration.tlAndroidOrientation=90}else{if(d==360){d=0;TeaLeaf.Client.Configuration.tlAndroidOrientation=0}else{TeaLeaf.Client.Configuration.tlAndroidOrientation+=d}}}else{d=window.orientation}tlAddNameValueArray=[b.$C("ClientSize"),(window.innerWidth+"x"+window.innerHeight),"orientation",d];j.tlAddData(tlAddNameValueArray);j.tlSend()};TeaLeaf.Client.tlMotionEvent=function(f){var b=TeaLeaf,a=b.Client,c=a.Configuration,d,g;if(!f){f=window.event}g=new b.Event(b.$C("GUI"),f.type);tlAddNameValueArray=["acceleration",f.acceleration,"accelerationIncludingGravity",f.accelerationIncludingGravity,"interval",f.interval,"rotationRate",f.rotationRate];g.tlAddData(tlAddNameValueArray);g.tlSend()};TeaLeaf.Client.tlDeviceOrientationEvent=function(f){var b=TeaLeaf,a=b.Client,c=a.Configuration,d,g;if(!f){f=window.event}g=new b.Event(b.$C("GUI"),f.type);tlAddNameValueArray=["alpha",f.alpha,"beta",f.beta,"gamma",f.gamma];g.tlAddData(tlAddNameValueArray);g.tlSend()};TeaLeaf.Client.tlAddMobileEventRef=function(a,j){var g=TeaLeaf,f=g.Client,s=f.Configuration,q,r,c,m,n,h,p,t,l,d,b,u,o;if(!a){a=window.event}f.tlSendScroll(true);r=f.tlGetEventSource(a);if(!r){return}o=f.tlGetXPathFromNode(r);if(!o&&s.tlDiscardInvalidXPath){return}m=[];if(s.tlEnableAttr){m=f.tlCheckAttributes(r,a)}h=new g.Event(g.$C("GUI"),a.type);d=f.tlGetName(r);b=r.id;if(!f.CheckIfIdValid(r)){b=""}tlAddNameValueArray=[g.$C("Name"),r.name,g.$C("Id"),b,g.$C("ElementType"),g.getNodeType(r),g.$C("TagName"),r.tagName,g.$C("XPath"),o];h.tlAddData(tlAddNameValueArray);for(var q=0;q<j.length;q++){m.push(j[q])}if(m){h.tlAddData(m)}h.tlSend()};TeaLeaf.Client.tlAddTouchEvent=function(b){if(b.scale){var a=["cancelable",b.cancelable,"screenX",b.screenX,"screenY",b.screenY,"scale",b.scale,"rotation",b.rotation];TeaLeaf.Client.tlAddMobileEventRef(b,a)}};TeaLeaf.Client.tlAddGestureEvent=function(b){if(b.cancelable){var a=["cancelable",b.cancelable]}TeaLeaf.Client.tlAddMobileEventRef(b,a)};TeaLeaf.Client.tlAddEvent=function(b){var g=TeaLeaf,f=g.Client,u=f.Configuration,r,s,j,c,t,m,n,o,h,q,v,l,d,a,w,p;if(!b){b=window.event}s=f.tlGetEventSource(b);if(!s){return}if(b.type.toLowerCase()==="mousedown"&&s.tagName==="BODY"){return}j=g.getNodeType(s);p=f.tlGetXPathFromNode(s);if(!p&&u.tlDiscardInvalidXPath){return}n=[];if(u.tlEnableAttr){n=f.tlCheckAttributes(s,b)}f.tlSendKeys();f.tlSendResize();f.tlSendScroll(true);if(!s.TeaLeafFocusTime){switch(b.type.toLowerCase()){case"keyup":case"change":case"click":case"dblclick":case"mousedown":s.TeaLeafFocusTime=new Date();break}}if(b.type.toLowerCase()==="blur"&&j==="application/x-shockwave-flash"){return}if(b.type.toLowerCase()==="click"&&f.checkIsInput(s)){g.Event.Configuration.tlidoflastvisitedcontrol=f.tlGetName(s)}if(b.type.toLowerCase()==="click"&&(s.tagName.toUpperCase()==="A")&&g.tlBrowserIsIE()){u.tlIEhref=false;q=s.href;if(q==="#"){u.tlIEhref=true}else{v="javascript:";o=q.substr(0,v.length);if(o.toLowerCase()==v){u.tlIEhref=true}}}h=new g.Event(g.$C("GUI"),b.type);d=f.tlGetName(s);a=s.id;if(!f.CheckIfIdValid(s)){a=""}t=[g.$C("Name"),s.name,g.$C("Id"),a,g.$C("ElementType"),j,g.$C("TagName"),s.tagName,g.$C("AltKey"),b.altKey?g.$C("True"):null,g.$C("CtrlKey"),b.ctrlKey?g.$C("True"):null,g.$C("ShiftKey"),b.shiftKey?g.$C("True"):null,g.$C("XPath"),p];h.tlAddData(t);if(u.tlEnableAttr&&n&&n.length>0){h.tlAddData(n)}if(b.type.toLowerCase()==="blur"&&s.TeaLeafFocusTime){c=new Date();h.tlAddData([g.$C("TimeInControl"),g.Event.tlDateDiff(c,s.TeaLeafFocusTime)]);s.TeaLeafFocusTime=null}if(f.tlIsExcluded(s)){h.tlAddData([g.$C("Excluded"),g.$C("True")])}else{w=null;l=null;m=[];if(!s.value&&b.type.toLowerCase()==="change"&&s.tagName.toUpperCase()==="SELECT"){r=s.selectedIndex;if(r>=0&&r<s.options.length){w=escape(s.options[r].text)}}else{w=f.tlReplaceValue(s)}if(w){l=g.Event.tlFormatXMLName(d);if(!l){l=p;l=g.Event.tlFormatXMLName(l)}m=[g.$C("ValueIn"),l,l,w]}if(j==="checkbox"||j==="radio"){m.push(g.$C("Checked"),s.checked?g.$C("True"):g.$C("False"))}h.tlAddData(m)}h.tlSend()};TeaLeaf.Client.tlHandleFormSubmit=function(h){TeaLeaf.Client.Configuration.tlactiontype="Submit";TeaLeaf.Client.tlSendKeys();TeaLeaf.Client.tlSendResize();TeaLeaf.Client.tlSendScroll(true);if(!h){h=window.event}var j=TeaLeaf.Client.tlGetEventSource(h);if(!j){return}var l;if(!j.name){var a=document.forms;for(l=0;l<a.length;l++){if(a[l]==j){j.name="Ordinal-"+l;break}}}if(!j.name){return}if(TeaLeaf.Client.tlIsReplace(j)){var n=TeaLeaf.Client.tlReplaceValue(j);var b=TeaLeaf.Client.tlGetName(j);var q=[TeaLeaf.$C("ValueIn"),b,b,n];p.tlAddData(q)}var p=new TeaLeaf.Event(TeaLeaf.$C("GUI"),h.type);var o=[TeaLeaf.$C("Name"),j.name,TeaLeaf.$C("Id"),j.id,TeaLeaf.$C("ElementType"),TeaLeaf.getNodeType(j),TeaLeaf.$C("TagName"),j.tagName,TeaLeaf.$C("AltKey"),h.altKey?TeaLeaf.$C("True"):null,TeaLeaf.$C("CtrlKey"),h.ctrlKey?TeaLeaf.$C("True"):null,TeaLeaf.$C("ShiftKey"),h.shiftKey?TeaLeaf.$C("True"):null,TeaLeaf.$C("NodeName"),h.nodeName,TeaLeaf.$C("NodeValue"),h.nodeValue,TeaLeaf.$C("VisitOrder"),TeaLeaf.Event.Configuration.tlvisitorder];p.tlAddData(o);var f=j.getElementsByTagName("INPUT");p.tlAddData([TeaLeaf.$C("InputFieldCount"),f.length]);p.tlPushXML(TeaLeaf.$C("InputFields"));for(l=0;l<f.length;l++){var d=f[l];if(!d.name){continue}p.tlPushXML(TeaLeaf.$C("Field")+l);var c=[TeaLeaf.$C("Name"),d.name,TeaLeaf.$C("Id"),d.id,TeaLeaf.$C("ElementType"),TeaLeaf.getNodeType(d),TeaLeaf.$C("TagName"),d.tagName];p.tlAddData(c);if(TeaLeaf.Client.tlIsExcluded(b)){p.tlAddData([TeaLeaf.$C("Excluded"),TeaLeaf.$C("True")])}else{if(TeaLeaf.Client.tlIsReplace(d.name)){var n=TeaLeaf.Client.tlReplaceValue(d);var b=TeaLeaf.Client.tlGetName(d);var q=[TeaLeaf.$C("ValueIn"),b,b,n];p.tlAddData(q)}else{var g=TeaLeaf.Event.tlFormatXMLName(d.name);var m=[TeaLeaf.$C("ValueIn"),g,g,d.value];p.tlAddData(m)}}p.tlPopXML()}p.tlPopXML();p.tlSend();TeaLeaf.Event.Configuration.tlvisitorder=""};TeaLeaf.Client.tlQueueResize=function(a){TeaLeaf.Client.tlSendKeys();TeaLeaf.Client.tlSendScroll(true);if(!a){a=window.event}if(a.clientX){TeaLeaf.ResizeClientX=a.clientX;TeaLeaf.ResizeClientY=a.clientY;TeaLeaf.ResizeScreenX=a.screenX;TeaLeaf.ResizeScreenY=a.screenY}else{TeaLeaf.ResizeClientX=a.target.width;TeaLeaf.ResizeClientY=a.target.height}};TeaLeaf.Client.tlHandleFormReset=function(c){TeaLeaf.Client.tlSendKeys();TeaLeaf.Client.tlSendResize();TeaLeaf.Client.tlSendScroll(true);if(!c){c=window.event}var d=TeaLeaf.Client.tlGetEventSource(c);if(!d){return}var f;if(!d.name){var a=document.forms;for(f=0;f<a.length;f++){if(a[f]==d){d.name="Ordinal-"+f;break}}}if(!d.name){return}if(TeaLeaf.Client.tlIsReplace(d)){var g=TeaLeaf.Client.tlReplaceValue(d);var b=TeaLeaf.Client.tlGetName(d);var l=[TeaLeaf.$C("ValueIn"),b,b,g];j.tlAddData(l)}var j=new TeaLeaf.Event(TeaLeaf.$C("GUI"),c.type);var h=[TeaLeaf.$C("Name"),d.name,TeaLeaf.$C("Id"),d.id,TeaLeaf.$C("ElementType"),TeaLeaf.getNodeType(d),TeaLeaf.$C("TagName"),d.tagName,TeaLeaf.$C("AltKey"),c.altKey?TeaLeaf.$C("True"):null,TeaLeaf.$C("CtrlKey"),c.ctrlKey?TeaLeaf.$C("True"):null,TeaLeaf.$C("ShiftKey"),c.shiftKey?TeaLeaf.$C("True"):null,TeaLeaf.$C("NodeName"),c.nodeName,TeaLeaf.$C("NodeValue"),c.nodeValue,TeaLeaf.$C("VisitOrder"),TeaLeaf.Event.Configuration.tlvisitorder];j.tlAddData(h);j.tlSend();TeaLeaf.tlVisitOrder=""};TeaLeaf.Client.tlAttachToAllControls=function(){TeaLeaf.Client.Configuration.tlcontrolsattached=true;TeaLeaf.Client.tlAttachToControls(window);try{var a;for(a=0;a<window.frames.length;a++){if(window==window.frames[a]){continue}TeaLeaf.Client.tlAttachToControls(window.frames[a])}}catch(b){}};TeaLeaf.Client.tlSingleAttach=function(){var tldomsingleelements=TeaLeaf.Client.Configuration.tlSingleAttach;for(var i=0;i<tldomsingleelements.length;i++){if(tldomsingleelements[i].domelementID&&tldomsingleelements[i].domelementID!=""){var tlelement=document.getElementById(tldomsingleelements[i].domelementID);if(tlelement){var func=eval(tldomsingleelements[i].tlhandler);TeaLeaf.Event.tlAddHandler(tlelement,tldomsingleelements[i].domevent,func,false)}}}};TeaLeaf.Client.tlAttachToControls=function(win){try{var handlers=TeaLeaf.Client.Configuration.tlWindowHandlers;for(var i=0;i<handlers.length;i++){if(handlers[i].load){var func=eval(handlers[i].tlhandler);TeaLeaf.Event.tlAddHandler(win,handlers[i].domevent,func,false)}}handlers=TeaLeaf.Client.Configuration.tlDocumentHandlers;for(var i=0;i<handlers.length;i++){if(handlers[i].load){var func=eval(handlers[i].tlhandler);TeaLeaf.Event.tlAddHandler(win.document,handlers[i].domevent,func,false)}}TeaLeaf.Client.tlProcessNode(win.document.body)}catch(e){}};TeaLeaf.Client.tlCheckAttach=function(control){var i,handlers,item_name,lower_item_name;if(control.TeaLeaf||control.TeaLeafExclude){return}control.TeaLeaf=true;switch(control.tagName){case"INPUT":case"SELECT":case"TEXTAREA":TeaLeaf.Event.tlAddHandler(control,"focus",TeaLeaf.Client.tlSetFocusTime,false);TeaLeaf.Event.tlAddHandler(control,"blur",TeaLeaf.Client.tlHandleBlur,false);TeaLeaf.Event.tlAddHandler(control,"change",TeaLeaf.Client.tlAddEvent,false);break}if(TeaLeaf.Client.Configuration.tlUniversalAttach){handlers=TeaLeaf.Client.Configuration.tlDocumentHandlers;for(i=0;i<handlers.length;i++){if(handlers[i].load){TeaLeaf.Event.tlAddHandler(control,handlers[i].domevent,eval(handlers[i].tlhandler),false)}}}};TeaLeaf.Client.tlProcessNode=function(h,c){var f,b,d,a;if(typeof(h)==="string"){h=document.getElementById(h)}if(!h){h=window.document.body}try{switch(h.tagName){case"INPUT":case"SELECT":case"TEXTAREA":TeaLeaf.Client.tlCheckAttach(h);break;default:if(TeaLeaf.Client.Configuration.tlUniversalAttach&&TeaLeaf.Client.tlTagNameAllowed(h.tagName)){TeaLeaf.Client.tlCheckAttach(h)}break}if(!c){d=["INPUT","SELECT","TEXTAREA"];for(f=0;f<d.length;f++){a=h.getElementsByTagName(d[f]);for(b=0;b<a.length;b++){TeaLeaf.Client.tlCheckAttach(a[b])}}if(TeaLeaf.Client.Configuration.tlUniversalAttach){if(TeaLeaf.Client.Configuration.tlExcludeTags){a=h.getElementsByTagName("*");for(f=0;f<a.length;f++){if(TeaLeaf.Client.tlTagNameAllowed(a[f].tagName)){TeaLeaf.Client.tlCheckAttach(a[f])}}}else{for(f in TeaLeaf.Client.Configuration.tlNodeTags){a=h.getElementsByTagName(f);for(b=0;b<a.length;b++){TeaLeaf.Client.tlCheckAttach(a[b])}}}}}}catch(g){}};TeaLeaf.Client.tlSetFocusTime=function(c){var b,a;if(!c){c=window.event}b=TeaLeaf.Client.tlGetEventSource(c);a=TeaLeaf.getNodeType(b);if(!b||a==="application/x-shockwave-flash"){return}var b=TeaLeaf.Client.tlGetEventSource(c);if(!b){return}if(!b.TeaLeafFocusTime){b.TeaLeafFocusTime=new Date()}if(TeaLeaf.Client.Configuration.tlsendfocus){TeaLeaf.Client.tlAddEvent(c)}};TeaLeaf.Client.tlHandleBlur=function(c){var b,a;if(!c){c=window.event}b=TeaLeaf.Client.tlGetEventSource(c);a=TeaLeaf.getNodeType(b);if(!b||a==="application/x-shockwave-flash"){return}TeaLeaf.Client.tlEndVisit(b);if(TeaLeaf.Client.checkIsInput(b)){TeaLeaf.Event.Configuration.tlidoflastvisitedcontrol=TeaLeaf.Client.tlGetName(b)}if(TeaLeaf.Client.Configuration.tlsendblur){TeaLeaf.Client.tlAddEvent(c)}b.TeaLeafFocusTime=null};TeaLeaf.Client.tlEndVisit=function(c){if(c.TeaLeafFocusTime){var a=TeaLeaf.Client.tlGetName(c);if(!a){a=TeaLeaf.Client.tlGetAnchor(c,false);if(a){a="LEVEL"+a}else{a="unnamed"}}var d=TeaLeaf.Event.tlDateDiff(c.TeaLeafFocusTime,new Date());var b=a+":"+d;if(TeaLeaf.Event.Configuration.tlvisitorder!=""){TeaLeaf.Event.Configuration.tlvisitorder=TeaLeaf.Event.Configuration.tlvisitorder+";"+b}else{TeaLeaf.Event.Configuration.tlvisitorder=b}}};TeaLeaf.Client.tlDetachFromAllControls=function(){TeaLeaf.Client.Configuration.tlcontrolsattached=false;TeaLeaf.Client.tlDetachFromControls(window);try{var b;for(b=0;b<window.frames.length;b++){var a=window.frames[b];TeaLeaf.Client.tlDetachFromControls(a)}}catch(c){}};TeaLeaf.Client.tlDetachFromControls=function(win){try{var handlers=TeaLeaf.Client.Configuration.tlWindowHandlers;for(var i=0;i<handlers.length;i++){var func=eval(handlers[i].tlhandler);TeaLeaf.Event.tlRemoveHandler(win,handlers[i].domevent,func,false)}handlers=TeaLeaf.Client.Configuration.tlDocumentHandlers;for(var i=0;i<handlers.length;i++){var func=eval(handlers[i].tlhandler);TeaLeaf.Event.tlRemoveHandler(win.document,handlers[i].domevent,func,false)}var items=win.document.getElementsByTagName("INPUT");var i;for(i=0;i<items.length;i++){TeaLeaf.Event.tlRemoveHandler(items[i],"change",TeaLeaf.Client.tlAddEvent,false);TeaLeaf.Event.tlRemoveHandler(items[i],"blur",TeaLeaf.Client.tlHandleBlur,false);items[i].TeaLeaf=false}items=win.document.getElementsByTagName("SELECT");for(i=0;i<items.length;i++){TeaLeaf.Event.tlRemoveHandler(items[i],"change",TeaLeaf.Client.tlAddEvent,false);TeaLeaf.Event.tlRemoveHandler(items[i],"blur",TeaLeaf.Client.tlHandleBlur,false);items[i].TeaLeaf=false}}catch(e){}};TeaLeaf.Client.tlAttachToControl=function(domelement,eventtype,eventHandler){if(eventHandler){TeaLeaf.Event.tlAddHandler(domelement,eventtype,eventHandler,false)}else{TeaLeaf.Event.tlAddHandler(domelement,eventtype,eval(TeaLeaf.Client.tlAddEvent),false)}};TeaLeaf.Client.tlDetachFromControl=function(domelement,eventtype,eventHandler){if(eventHandler){TeaLeaf.Event.tlRemoveHandler(domelement,eventtype,eventHandler,false)}else{TeaLeaf.Event.tlRemoveHandler(domelement,eventtype,eval(TeaLeaf.Client.tlAddEvent),false)}};TeaLeaf.Client.tlScanForAdditions=function(){if(!TeaLeaf.Client.Configuration.tlScheduledScan){return}TeaLeaf.Client.tlProcessNode(document.body);try{for(var b=0;b<window.frames.length;b++){var a=window.frames[b];TeaLeaf.Client.tlProcessNode(a.document.body)}}catch(c){}window.clearTimeout(TeaLeaf.Client.tlTimeoutID);TeaLeaf.Client.tlTimeoutID=window.setTimeout(TeaLeaf.Client.tlScanForAdditions,TeaLeaf.Client.Configuration.tlscanupdate)};TeaLeaf.Client.tlTagNameAllowed=function(a){if(a==null){return false}var b=TeaLeaf.Client.Configuration.tlNodeTags[a];if(b==null){b=false}if(TeaLeaf.Client.Configuration.tlExcludeTags){return !b}else{return b}};TeaLeaf.Client.tlStartListeners=function(){TeaLeaf.Client.tlAttachToAllControls();TeaLeaf.Client.tlSingleAttach()};TeaLeaf.Client.tlEndListeners=function(){TeaLeaf.Event.tlFlushQueue(true);TeaLeaf.Client.tlDetachFromAllControls()};TeaLeaf.Client.tlSendValueChange=function(c,d){var j=new TeaLeaf.Event(TeaLeaf.$C("GUI"),d);var h=[TeaLeaf.$C("Name"),c.name,TeaLeaf.$C("Id"),c.id,TeaLeaf.$C("ElementType"),TeaLeaf.getNodeType(c)];j.tlAddData(h);var f=TeaLeaf.Client.tlGetName(c);var b=TeaLeaf.Event.tlFormatXMLName(f);var a=TeaLeaf.Client.tlReplaceValue(c);var g=[TeaLeaf.$C("ValueIn"),b,b,a];j.tlAddData(g);j.tlSend()};TeaLeaf.Client.tlSetup=function(){var a=TeaLeaf.tlGetCookieValue("tlQueuedXML");if(a){TeaLeaf.Event.tlQueuedXML+=a.replace(/%3B/g,";")}TeaLeaf.Client.tlAttachToAllControls();TeaLeaf.Client.tlSingleAttach();if(TeaLeaf.Event.Configuration.tlcatchpopups){TeaLeaf.SavedWindowOpen=window.open;window.open=function(b,c,f,g){var h="blocked";var d;if(typeof TeaLeaf.SavedWindowOpen=="function"){d=TeaLeaf.SavedWindowOpen.apply(this,arguments)}else{b=b?b:"";c=c?c:"";f=f?f:"";d=TeaLeaf.SavedWindowOpen(b,c,f,g)}try{if(!d.closed){h="visible"}}catch(m){if(TeaLeaf.Event.Configuration.tlshowexceptions){alert(m.name+": "+m.message+"\r\n\r\nPos 8")}}var l=new TeaLeaf.Event(TeaLeaf.$C("GUI"),TeaLeaf.$C("WindowOpen"));var j=[TeaLeaf.$C("Status"),h,TeaLeaf.$C("URL"),escape(b),TeaLeaf.$C("Name"),c,TeaLeaf.$C("Features"),f,TeaLeaf.$C("Replace"),g];l.tlAddData(j);l.tlSend();return d}}window.clearTimeout(TeaLeaf.Client.tlTimeoutID);if(TeaLeaf.Client.Configuration.tlscanupdate>0){TeaLeaf.Client.tlTimeoutID=window.setTimeout(TeaLeaf.Client.tlScanForAdditions,TeaLeaf.Client.Configuration.tlscanupdate)}};TeaLeaf.Client.CallInit=function(){TeaLeaf.addOnLoad(TeaLeaf.Client.tlSetup)};if(TeaLeaf.Client.Configuration.tlinit==false){TeaLeaf.Client.Configuration.tlinit=true;TeaLeaf.Client.CallInit()}};
var Prototype={Version:"1.7",Browser:(function(){var B=navigator.userAgent;var A=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!A,Opera:A,WebKit:B.indexOf("AppleWebKit/")>-1,Gecko:B.indexOf("Gecko")>-1&&B.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(B)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var A=window.Element||window.HTMLElement;return !!(A&&A.prototype)})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=="undefined"){return true}var C=document.createElement("div"),B=document.createElement("form"),A=false;if(C.__proto__&&(C.__proto__!==B.__proto__)){A=true}C=B=null;return A})()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(A){return A}};if(Prototype.Browser.MobileSafari){Prototype.BrowserFeatures.SpecificElementExtensions=false}var Abstract={};var Try={these:function(){var C;for(var B=0,D=arguments.length;B<D;B++){var A=arguments[B];try{C=A();break}catch(E){}}return C}};var Class=(function(){var D=(function(){for(var E in {toString:1}){if(E==="toString"){return false}}return true})();function A(){}function B(){var H=null,G=$A(arguments);if(Object.isFunction(G[0])){H=G.shift()}function E(){this.initialize.apply(this,arguments)}Object.extend(E,Class.Methods);E.superclass=H;E.subclasses=[];if(H){A.prototype=H.prototype;E.prototype=new A;H.subclasses.push(E)}for(var F=0,I=G.length;F<I;F++){E.addMethods(G[F])}if(!E.prototype.initialize){E.prototype.initialize=Prototype.emptyFunction}E.prototype.constructor=E;return E}function C(K){var G=this.superclass&&this.superclass.prototype,F=Object.keys(K);if(D){if(K.toString!=Object.prototype.toString){F.push("toString")}if(K.valueOf!=Object.prototype.valueOf){F.push("valueOf")}}for(var E=0,H=F.length;E<H;E++){var J=F[E],I=K[J];if(G&&Object.isFunction(I)&&I.argumentNames()[0]=="$super"){var L=I;I=(function(M){return function(){return G[M].apply(this,arguments)}})(J).wrap(L);I.valueOf=L.valueOf.bind(L);I.toString=L.toString.bind(L)}this.prototype[J]=I}return this}return{create:B,Methods:{addMethods:C}}})();(function(){var e=Object.prototype.toString,d="Null",P="Undefined",X="Boolean",F="Number",U="String",l="Object",V="[object Function]",a="[object Boolean]",G="[object Number]",L="[object String]",H="[object Array]",Z="[object Date]",I=window.JSON&&typeof JSON.stringify==="function"&&JSON.stringify(0)==="0"&&typeof JSON.stringify(Prototype.K)==="undefined";function K(p){switch(p){case null:return d;case (void 0):return P}var m=typeof p;switch(m){case"boolean":return X;case"number":return F;case"string":return U}return l}function b(m,p){for(var o in p){m[o]=p[o]}return m}function k(m){try{if(C(m)){return"undefined"}if(m===null){return"null"}return m.inspect?m.inspect():String(m)}catch(o){if(o instanceof RangeError){return"..."}throw o}}function f(m){return h("",{"":m},[])}function h(x,u,v){var w=u[x],t=typeof w;if(K(w)===l&&typeof w.toJSON==="function"){w=w.toJSON(x)}var p=e.call(w);switch(p){case G:case a:case L:w=w.valueOf()}switch(w){case null:return"null";case true:return"true";case false:return"false"}t=typeof w;switch(t){case"string":return w.inspect(true);case"number":return isFinite(w)?String(w):"null";case"object":for(var o=0,m=v.length;o<m;o++){if(v[o]===w){throw new TypeError()}}v.push(w);var r=[];if(p===H){for(var o=0,m=w.length;o<m;o++){var q=h(o,w,v);r.push(typeof q==="undefined"?"null":q)}r="["+r.join(",")+"]"}else{var y=Object.keys(w);for(var o=0,m=y.length;o<m;o++){var x=y[o],q=h(x,w,v);if(typeof q!=="undefined"){r.push(x.inspect(true)+":"+q)}}r="{"+r.join(",")+"}"}v.pop();return r}}function Y(m){return JSON.stringify(m)}function J(m){return $H(m).toQueryString()}function Q(m){return m&&m.toHTML?m.toHTML():String.interpret(m)}function T(m){if(K(m)!==l){throw new TypeError()}var o=[];for(var p in m){if(m.hasOwnProperty(p)){o.push(p)}}return o}function D(m){var o=[];for(var p in m){o.push(m[p])}return o}function c(m){return b({},m)}function W(m){return !!(m&&m.nodeType==1)}function M(m){return e.call(m)===H}var B=(typeof Array.isArray=="function")&&Array.isArray([])&&!Array.isArray({});if(B){M=Array.isArray}function E(m){return m instanceof Hash}function A(m){return e.call(m)===V}function O(m){return e.call(m)===L}function S(m){return e.call(m)===G}function g(m){return e.call(m)===Z}function C(m){return typeof m==="undefined"}b(Object,{extend:b,inspect:k,toJSON:I?Y:f,toQueryString:J,toHTML:Q,keys:Object.keys||T,values:D,clone:c,isElement:W,isArray:M,isHash:E,isFunction:A,isString:O,isNumber:S,isDate:g,isUndefined:C})})();Object.extend(Function.prototype,(function(){var K=Array.prototype.slice;function D(P,L){var O=P.length,M=L.length;while(M--){P[O+M]=L[M]}return P}function I(M,L){M=K.call(M,0);return D(M,L)}function G(){var L=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return L.length==1&&!L[0]?[]:L}function H(O){if(arguments.length<2&&Object.isUndefined(arguments[0])){return this}var L=this,M=K.call(arguments,1);return function(){var P=I(M,arguments);return L.apply(O,P)}}function F(O){var L=this,M=K.call(arguments,1);return function(Q){var P=D([Q||window.event],M);return L.apply(O,P)}}function J(){if(!arguments.length){return this}var L=this,M=K.call(arguments,0);return function(){var O=I(M,arguments);return L.apply(this,O)}}function E(O){var L=this,M=K.call(arguments,1);O=O*1000;return window.setTimeout(function(){return L.apply(L,M)},O)}function A(){var L=D([0.01],arguments);return this.delay.apply(this,L)}function C(M){var L=this;return function(){var O=D([L.bind(this)],arguments);return M.apply(this,O)}}function B(){if(this._methodized){return this._methodized}var L=this;return this._methodized=function(){var M=D([this],arguments);return L.apply(null,M)}}return{argumentNames:G,bind:H,bindAsEventListener:F,curry:J,delay:E,defer:A,wrap:C,methodize:B}})());(function(C){function B(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function A(){return this.toISOString()}if(!C.toISOString){C.toISOString=B}if(!C.toJSON){C.toJSON=A}})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(A){return String(A).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(B,A){this.callback=B;this.frequency=A;this.currentlyExecuting=false;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000)},execute:function(){this.callback(this)},stop:function(){if(!this.timer){return}clearInterval(this.timer);this.timer=null},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false}catch(A){this.currentlyExecuting=false;throw A}}}});Object.extend(String,{interpret:function(A){return A==null?"":String(A)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});Object.extend(String.prototype,(function(){var NATIVE_JSON_PARSE_SUPPORT=window.JSON&&typeof JSON.parse==="function"&&JSON.parse('{"test": true}').test;function prepareReplacement(replacement){if(Object.isFunction(replacement)){return replacement}var template=new Template(replacement);return function(match){return template.evaluate(match)}}function gsub(pattern,replacement){var result="",source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern)){pattern=RegExp.escape(pattern)}if(!(pattern.length||pattern.source)){replacement=replacement("");return replacement+source.split("").join(replacement)+replacement}while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result}function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0){return match[0]}return replacement(match)})}function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this)}function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?"...":truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this)}function strip(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")}function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")}function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,"img"),matchOne=new RegExp(Prototype.ScriptFragment,"im");return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||["",""])[1]})}function evalScripts(){return this.extractScripts().map(function(script){return eval(script)})}function escapeHTML(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function unescapeHTML(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match){return{}}return match[1].split(separator||"&").inject({},function(hash,pair){if((pair=pair.split("="))[0]){var key=decodeURIComponent(pair.shift()),value=pair.length>1?pair.join("="):pair[0];if(value!=undefined){value=decodeURIComponent(value)}if(key in hash){if(!Object.isArray(hash[key])){hash[key]=[hash[key]]}hash[key].push(value)}else{hash[key]=value}}return hash})}function toArray(){return this.split("")}function succ(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)}function times(count){return count<1?"":new Array(count+1).join(this)}function camelize(){return this.replace(/-+(.)?/g,function(match,chr){return chr?chr.toUpperCase():""})}function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()}function underscore(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()}function dasherize(){return this.replace(/_/g,"-")}function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character]}return"\\u00"+character.charCodeAt().toPaddedString(2,16)});if(useDoubleQuotes){return'"'+escapedString.replace(/"/g,'\\"')+'"'}return"'"+escapedString.replace(/'/g,"\\'")+"'"}function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,"$1")}function isJSON(){var str=this;if(str.blank()){return false}str=str.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");str=str.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");str=str.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(str)}function evalJSON(sanitize){var json=this.unfilterJSON(),cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(cx.test(json)){json=json.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}try{if(!sanitize||json.isJSON()){return eval("("+json+")")}}catch(e){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())}function parseJSON(){var json=this.unfilterJSON();return JSON.parse(json)}function include(pattern){return this.indexOf(pattern)>-1}function startsWith(pattern){return this.lastIndexOf(pattern,0)===0}function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.indexOf(pattern,d)===d}function empty(){return this==""}function blank(){return/^\s*$/.test(this)}function interpolate(object,pattern){return new Template(this,pattern).evaluate(object)}return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim||strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:NATIVE_JSON_PARSE_SUPPORT?parseJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate}})());var Template=Class.create({initialize:function(A,B){this.template=A.toString();this.pattern=B||Template.Pattern},evaluate:function(A){if(A&&Object.isFunction(A.toTemplateReplacements)){A=A.toTemplateReplacements()}return this.template.gsub(this.pattern,function(D){if(A==null){return(D[1]+"")}var F=D[1]||"";if(F=="\\"){return D[2]}var B=A,G=D[3],E=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;D=E.exec(G);if(D==null){return F}while(D!=null){var C=D[1].startsWith("[")?D[2].replace(/\\\\]/g,"]"):D[1];B=B[C];if(null==B||""==D[3]){break}G=G.substring("["==D[3]?D[1].length:D[0].length);D=E.exec(G)}return F+String.interpret(B)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function C(a,Z){var Y=0;try{this._each(function(c){a.call(Z,c,Y++)})}catch(b){if(b!=$break){throw b}}return this}function T(b,a,Z){var Y=-b,c=[],d=this.toArray();if(b<1){return d}while((Y+=b)<d.length){c.push(d.slice(Y,Y+b))}return c.collect(a,Z)}function B(a,Z){a=a||Prototype.K;var Y=true;this.each(function(c,b){Y=Y&&!!a.call(Z,c,b);if(!Y){throw $break}});return Y}function I(a,Z){a=a||Prototype.K;var Y=false;this.each(function(c,b){if(Y=!!a.call(Z,c,b)){throw $break}});return Y}function J(a,Z){a=a||Prototype.K;var Y=[];this.each(function(c,b){Y.push(a.call(Z,c,b))});return Y}function V(a,Z){var Y;this.each(function(c,b){if(a.call(Z,c,b)){Y=c;throw $break}});return Y}function H(a,Z){var Y=[];this.each(function(c,b){if(a.call(Z,c,b)){Y.push(c)}});return Y}function G(b,a,Z){a=a||Prototype.K;var Y=[];if(Object.isString(b)){b=new RegExp(RegExp.escape(b))}this.each(function(d,c){if(b.match(d)){Y.push(a.call(Z,d,c))}});return Y}function A(Y){if(Object.isFunction(this.indexOf)){if(this.indexOf(Y)!=-1){return true}}var Z=false;this.each(function(a){if(a==Y){Z=true;throw $break}});return Z}function S(Z,Y){Y=Object.isUndefined(Y)?null:Y;return this.eachSlice(Z,function(a){while(a.length<Z){a.push(Y)}return a})}function L(Y,a,Z){this.each(function(c,b){Y=a.call(Z,Y,c,b)});return Y}function X(Z){var Y=$A(arguments).slice(1);return this.map(function(a){return a[Z].apply(a,Y)})}function Q(a,Z){a=a||Prototype.K;var Y;this.each(function(c,b){c=a.call(Z,c,b);if(Y==null||c>=Y){Y=c}});return Y}function O(a,Z){a=a||Prototype.K;var Y;this.each(function(c,b){c=a.call(Z,c,b);if(Y==null||c<Y){Y=c}});return Y}function E(b,Z){b=b||Prototype.K;var a=[],Y=[];this.each(function(d,c){(b.call(Z,d,c)?a:Y).push(d)});return[a,Y]}function F(Z){var Y=[];this.each(function(a){Y.push(a[Z])});return Y}function D(a,Z){var Y=[];this.each(function(c,b){if(!a.call(Z,c,b)){Y.push(c)}});return Y}function M(Z,Y){return this.map(function(b,a){return{value:b,criteria:Z.call(Y,b,a)}}).sort(function(f,e){var d=f.criteria,c=e.criteria;return d<c?-1:d>c?1:0}).pluck("value")}function P(){return this.map()}function U(){var Z=Prototype.K,Y=$A(arguments);if(Object.isFunction(Y.last())){Z=Y.pop()}var a=[this].concat(Y).map($A);return this.map(function(c,b){return Z(a.pluck(b))})}function K(){return this.toArray().length}function W(){return"#<Enumerable:"+this.toArray().inspect()+">"}return{each:C,eachSlice:T,all:B,every:B,any:I,some:I,collect:J,map:J,detect:V,findAll:H,select:H,filter:H,grep:G,include:A,member:A,inGroupsOf:S,inject:L,invoke:X,max:Q,min:O,partition:E,pluck:F,reject:D,sortBy:M,toArray:P,entries:P,zip:U,size:K,inspect:W,find:V}})();function $A(C){if(!C){return[]}if("toArray" in Object(C)){return C.toArray()}var B=C.length||0,A=new Array(B);while(B--){A[B]=C[B]}return A}function $w(A){if(!Object.isString(A)){return[]}A=A.strip();return A?A.split(/\s+/):[]}Array.from=$A;(function(){var T=Array.prototype,M=T.slice,P=T.forEach;function B(Y,X){for(var W=0,Z=this.length>>>0;W<Z;W++){if(W in this){Y.call(X,this[W],W,this)}}}if(!P){P=B}function L(){this.length=0;return this}function D(){return this[0]}function G(){return this[this.length-1]}function I(){return this.select(function(W){return W!=null})}function V(){return this.inject([],function(X,W){if(Object.isArray(W)){return X.concat(W.flatten())}X.push(W);return X})}function H(){var W=M.call(arguments,0);return this.select(function(X){return !W.include(X)})}function F(W){return(W===false?this.toArray():this)._reverse()}function K(W){return this.inject([],function(Z,Y,X){if(0==X||(W?Z.last()!=Y:!Z.include(Y))){Z.push(Y)}return Z})}function Q(W){return this.uniq().findAll(function(X){return W.detect(function(Y){return X===Y})})}function S(){return M.call(this,0)}function J(){return this.length}function U(){return"["+this.map(Object.inspect).join(", ")+"]"}function A(Y,W){W||(W=0);var X=this.length;if(W<0){W=X+W}for(;W<X;W++){if(this[W]===Y){return W}}return -1}function O(X,W){W=isNaN(W)?this.length:(W<0?this.length+W:W)+1;var Y=this.slice(0,W).reverse().indexOf(X);return(Y<0)?Y:W-Y-1}function C(){var b=M.call(this,0),Z;for(var X=0,Y=arguments.length;X<Y;X++){Z=arguments[X];if(Object.isArray(Z)&&!("callee" in Z)){for(var W=0,a=Z.length;W<a;W++){b.push(Z[W])}}else{b.push(Z)}}return b}Object.extend(T,Enumerable);if(!T._reverse){T._reverse=T.reverse}Object.extend(T,{_each:P,clear:L,first:D,last:G,compact:I,flatten:V,without:H,reverse:F,uniq:K,intersect:Q,clone:S,toArray:S,size:J,inspect:U});var E=(function(){return[].concat(arguments)[0][0]!==1})(1,2);if(E){T.concat=C}if(!T.indexOf){T.indexOf=A}if(!T.lastIndexOf){T.lastIndexOf=O}})();function $H(A){return new Hash(A)}var Hash=Class.create(Enumerable,(function(){function E(Q){this._object=Object.isHash(Q)?Q.toObject():Object.clone(Q)}function F(S){for(var Q in this._object){var T=this._object[Q],U=[Q,T];U.key=Q;U.value=T;S(U)}}function J(Q,S){return this._object[Q]=S}function C(Q){if(this._object[Q]!==Object.prototype[Q]){return this._object[Q]}}function M(Q){var S=this._object[Q];delete this._object[Q];return S}function P(){return Object.clone(this._object)}function O(){return this.pluck("key")}function L(){return this.pluck("value")}function G(S){var Q=this.detect(function(T){return T.value===S});return Q&&Q.key}function I(Q){return this.clone().update(Q)}function D(Q){return new Hash(Q).inject(this,function(S,T){S.set(T.key,T.value);return S})}function B(Q,S){if(Object.isUndefined(S)){return Q}return Q+"="+encodeURIComponent(String.interpret(S))}function A(){return this.inject([],function(V,Y){var U=encodeURIComponent(Y.key),S=Y.value;if(S&&typeof S=="object"){if(Object.isArray(S)){var X=[];for(var T=0,Q=S.length,W;T<Q;T++){W=S[T];X.push(B(U,W))}return V.concat(X)}}else{V.push(B(U,S))}return V}).join("&")}function K(){return"#<Hash:{"+this.map(function(Q){return Q.map(Object.inspect).join(": ")}).join(", ")+"}>"}function H(){return new Hash(this)}return{initialize:E,_each:F,set:J,get:C,unset:M,toObject:P,toTemplateReplacements:P,keys:O,values:L,index:G,merge:I,update:D,toQueryString:A,inspect:K,toJSON:P,clone:H}})());Hash.from=$H;Object.extend(Number.prototype,(function(){function D(){return this.toPaddedString(2,16)}function B(){return this+1}function H(J,I){$R(0,this,true).each(J,I);return this}function G(K,J){var I=this.toString(J||10);return"0".times(K-I.length)+I}function A(){return Math.abs(this)}function C(){return Math.round(this)}function E(){return Math.ceil(this)}function F(){return Math.floor(this)}return{toColorPart:D,succ:B,times:H,toPaddedString:G,abs:A,round:C,ceil:E,floor:F}})());function $R(C,A,B){return new ObjectRange(C,A,B)}var ObjectRange=Class.create(Enumerable,(function(){function B(F,D,E){this.start=F;this.end=D;this.exclusive=E}function C(D){var E=this.start;while(this.include(E)){D(E);E=E.succ()}}function A(D){if(D<this.start){return false}if(this.exclusive){return D<this.end}return D<=this.end}return{initialize:B,_each:C,include:A}})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(A){this.responders._each(A)},register:function(A){if(!this.include(A)){this.responders.push(A)}},unregister:function(A){this.responders=this.responders.without(A)},dispatch:function(D,B,C,A){this.each(function(E){if(Object.isFunction(E[D])){try{E[D].apply(E,[B,C,A])}catch(F){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(A){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,A||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,B,A){$super(A);this.transport=Ajax.getTransport();this.request(B)},request:function(B){this.url=B;this.method=this.options.method;var D=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){D+=(D?"&":"")+"_method="+this.method;this.method="post"}if(D&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+D}this.parameters=D.toQueryParams();try{var A=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(A)}Ajax.Responders.dispatch("onCreate",this,A);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||D):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(C){this.dispatchException(C)}},onStateChange:function(){var A=this.transport.readyState;if(A>1&&!((A==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var E={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){E["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){E.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var C=this.options.requestHeaders;if(Object.isFunction(C.push)){for(var B=0,D=C.length;B<D;B+=2){E[C[B]]=C[B+1]}}else{$H(C).each(function(F){E[F.key]=F.value})}}for(var A in E){this.transport.setRequestHeader(A,E[A])}},success:function(){var A=this.getStatus();return !A||(A>=200&&A<300)||A==304},getStatus:function(){try{if(this.transport.status===1223){return 204}return this.transport.status||0}catch(A){return 0}},respondToReadyState:function(A){var C=Ajax.Request.Events[A],B=new Ajax.Response(this);if(C=="Complete"){try{this._complete=true;(this.options["on"+B.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(B,B.headerJSON)}catch(D){this.dispatchException(D)}var E=B.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&E&&E.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+C]||Prototype.emptyFunction)(B,B.headerJSON);Ajax.Responders.dispatch("on"+C,this,B,B.headerJSON)}catch(D){this.dispatchException(D)}if(C=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var A=this.url.match(/^\s*https?:\/\/[^\/]*/);return !A||(A[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(A){try{return this.transport.getResponseHeader(A)||null}catch(B){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(A){(this.options.onException||Prototype.emptyFunction)(this,A);Ajax.Responders.dispatch("onException",this,A)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(C){this.request=C;var D=this.transport=C.transport,A=this.readyState=D.readyState;if((A>2&&!Prototype.Browser.IE)||A==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(D.responseText);this.headerJSON=this._getHeaderJSON()}if(A==4){var B=D.responseXML;this.responseXML=Object.isUndefined(B)?null:B;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(A){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(A){return null}},getResponseHeader:function(A){return this.transport.getResponseHeader(A)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var A=this.getHeader("X-JSON");if(!A){return null}A=decodeURIComponent(escape(A));try{return A.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(B){this.request.dispatchException(B)}},_getResponseJSON:function(){var A=this.request.options;if(!A.evalJSON||(A.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(A.sanitizeJSON||!this.request.isSameOrigin())}catch(B){this.request.dispatchException(B)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,A,C,B){this.container={success:(A.success||A),failure:(A.failure||(A.success?null:A))};B=Object.clone(B);var D=B.onComplete;B.onComplete=(function(E,F){this.updateContent(E.responseText);if(Object.isFunction(D)){D(E,F)}}).bind(this);$super(C,B)},updateContent:function(D){var C=this.container[this.success()?"success":"failure"],A=this.options;if(!A.evalScripts){D=D.stripScripts()}if(C=$(C)){if(A.insertion){if(Object.isString(A.insertion)){var B={};B[A.insertion]=D;C.insert(B)}else{A.insertion(C,D)}}else{C.update(D)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,A,C,B){$super(B);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=A;this.url=C;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(A){if(this.options.decay){this.decay=(A.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=A.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});function $(B){if(arguments.length>1){for(var A=0,D=[],C=arguments.length;A<C;A++){D.push($(arguments[A]))}return D}if(Object.isString(B)){B=document.getElementById(B)}return Element.extend(B)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(F,A){var C=[];var E=document.evaluate(F,$(A)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var B=0,D=E.snapshotLength;B<D;B++){C.push(Element.extend(E.snapshotItem(B)))}return C}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(C){function D(F,E){if(F==="select"){return false}if("type" in E){return false}return true}var B=(function(){try{var E=document.createElement('<input name="x">');return E.tagName.toLowerCase()==="input"&&E.name==="x"}catch(F){return false}})();var A=C.Element;C.Element=function(G,F){F=F||{};G=G.toLowerCase();var E=Element.cache;if(B&&F.name){G="<"+G+' name="'+F.name+'">';delete F.name;return Element.writeAttribute(document.createElement(G),F)}if(!E[G]){E[G]=Element.extend(document.createElement(G))}var H=D(G,F)?E[G].cloneNode(false):document.createElement(G);return Element.writeAttribute(H,F)};Object.extend(C.Element,A||{});if(A){C.Element.prototype=A.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(B){var A=B._prototypeUID;if(A){Element.stopObserving(B);B._prototypeUID=void 0;delete Element.Storage[A]}};Element.Methods={visible:function(A){return $(A).style.display!="none"},toggle:function(A){A=$(A);Element[Element.visible(A)?"hide":"show"](A);return A},hide:function(A){A=$(A);A.style.display="none";return A},show:function(A){A=$(A);A.style.display="";return A},remove:function(A){A=$(A);A.parentNode.removeChild(A);return A},update:(function(){var D=(function(){var G=document.createElement("select"),H=true;G.innerHTML='<option value="test">test</option>';if(G.options&&G.options[0]){H=G.options[0].nodeName.toUpperCase()!=="OPTION"}G=null;return H})();var B=(function(){try{var G=document.createElement("table");if(G&&G.tBodies){G.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var I=typeof G.tBodies[0]=="undefined";G=null;return I}}catch(H){return true}})();var A=(function(){try{var G=document.createElement("div");G.innerHTML="<link>";var I=(G.childNodes.length===0);G=null;return I}catch(H){return true}})();var C=D||B||A;var F=(function(){var G=document.createElement("script"),I=false;try{G.appendChild(document.createTextNode(""));I=!G.firstChild||G.firstChild&&G.firstChild.nodeType!==3}catch(H){I=true}G=null;return I})();function E(K,L){K=$(K);var G=Element._purgeElement;var M=K.getElementsByTagName("*"),J=M.length;while(J--){G(M[J])}if(L&&L.toElement){L=L.toElement()}if(Object.isElement(L)){return K.update().insert(L)}L=Object.toHTML(L);var I=K.tagName.toUpperCase();if(I==="SCRIPT"&&F){K.text=L;return K}if(C){if(I in Element._insertionTranslations.tags){while(K.firstChild){K.removeChild(K.firstChild)}Element._getContentFromAnonymousElement(I,L.stripScripts()).each(function(O){K.appendChild(O)})}else{if(A&&Object.isString(L)&&L.indexOf("<link")>-1){while(K.firstChild){K.removeChild(K.firstChild)}var H=Element._getContentFromAnonymousElement(I,L.stripScripts(),true);H.each(function(O){K.appendChild(O)})}else{K.innerHTML=L.stripScripts()}}}else{K.innerHTML=L.stripScripts()}L.evalScripts.bind(L).defer();return K}return E})(),replace:function(B,C){B=$(B);if(C&&C.toElement){C=C.toElement()}else{if(!Object.isElement(C)){C=Object.toHTML(C);var A=B.ownerDocument.createRange();A.selectNode(B);C.evalScripts.bind(C).defer();C=A.createContextualFragment(C.stripScripts())}}B.parentNode.replaceChild(C,B);return B},insert:function(C,E){C=$(C);if(Object.isString(E)||Object.isNumber(E)||Object.isElement(E)||(E&&(E.toElement||E.toHTML))){E={bottom:E}}var D,F,B,G;for(var A in E){D=E[A];A=A.toLowerCase();F=Element._insertionTranslations[A];if(D&&D.toElement){D=D.toElement()}if(Object.isElement(D)){F(C,D);continue}D=Object.toHTML(D);B=((A=="before"||A=="after")?C.parentNode:C).tagName.toUpperCase();G=Element._getContentFromAnonymousElement(B,D.stripScripts());if(A=="top"||A=="after"){G.reverse()}G.each(F.curry(C));D.evalScripts.bind(D).defer()}return C},wrap:function(B,C,A){B=$(B);if(Object.isElement(C)){$(C).writeAttribute(A||{})}else{if(Object.isString(C)){C=new Element(C,A)}else{C=new Element("div",C)}}if(B.parentNode){B.parentNode.replaceChild(C,B)}C.appendChild(B);return C},inspect:function(B){B=$(B);var A="<"+B.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(F){var E=F.first(),C=F.last(),D=(B[E]||"").toString();if(D){A+=" "+C+"="+D.inspect(true)}});return A+">"},recursivelyCollect:function(A,C,D){A=$(A);D=D||-1;var B=[];while(A=A[C]){if(A.nodeType==1){B.push(Element.extend(A))}if(B.length==D){break}}return B},ancestors:function(A){return Element.recursivelyCollect(A,"parentNode")},descendants:function(A){return Element.select(A,"*")},firstDescendant:function(A){A=$(A).firstChild;while(A&&A.nodeType!=1){A=A.nextSibling}return $(A)},immediateDescendants:function(B){var A=[],C=$(B).firstChild;while(C){if(C.nodeType===1){A.push(Element.extend(C))}C=C.nextSibling}return A},previousSiblings:function(A,B){return Element.recursivelyCollect(A,"previousSibling")},nextSiblings:function(A){return Element.recursivelyCollect(A,"nextSibling")},siblings:function(A){A=$(A);return Element.previousSiblings(A).reverse().concat(Element.nextSiblings(A))},match:function(B,A){B=$(B);if(Object.isString(A)){return Prototype.Selector.match(B,A)}return A.match(B)},up:function(B,D,A){B=$(B);if(arguments.length==1){return $(B.parentNode)}var C=Element.ancestors(B);return Object.isNumber(D)?C[D]:Prototype.Selector.find(C,D,A)},down:function(B,C,A){B=$(B);if(arguments.length==1){return Element.firstDescendant(B)}return Object.isNumber(C)?Element.descendants(B)[C]:Element.select(B,C)[A||0]},previous:function(B,C,A){B=$(B);if(Object.isNumber(C)){A=C,C=false}if(!Object.isNumber(A)){A=0}if(C){return Prototype.Selector.find(B.previousSiblings(),C,A)}else{return B.recursivelyCollect("previousSibling",A+1)[A]}},next:function(B,D,A){B=$(B);if(Object.isNumber(D)){A=D,D=false}if(!Object.isNumber(A)){A=0}if(D){return Prototype.Selector.find(B.nextSiblings(),D,A)}else{var C=Object.isNumber(A)?A+1:1;return B.recursivelyCollect("nextSibling",A+1)[A]}},select:function(A){A=$(A);var B=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(B,A)},adjacent:function(A){A=$(A);var B=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(B,A.parentNode).without(A)},identify:function(A){A=$(A);var B=Element.readAttribute(A,"id");if(B){return B}do{B="anonymous_element_"+Element.idCounter++}while($(B));Element.writeAttribute(A,"id",B);return B},readAttribute:function(C,A){C=$(C);if(Prototype.Browser.IE){var B=Element._attributeTranslations.read;if(B.values[A]){return B.values[A](C,A)}if(B.names[A]){A=B.names[A]}if(A.include(":")){return(!C.attributes||!C.attributes[A])?null:C.attributes[A].value}}return C.getAttribute(A)},writeAttribute:function(E,C,F){E=$(E);var B={},D=Element._attributeTranslations.write;if(typeof C=="object"){B=C}else{B[C]=Object.isUndefined(F)?true:F}for(var A in B){C=D.names[A]||A;F=B[A];if(D.values[A]){C=D.values[A](E,F)}if(F===false||F===null){E.removeAttribute(C)}else{if(F===true){E.setAttribute(C,C)}else{E.setAttribute(C,F)}}}return E},getHeight:function(A){return Element.getDimensions(A).height},getWidth:function(A){return Element.getDimensions(A).width},classNames:function(A){return new Element.ClassNames(A)},hasClassName:function(A,B){if(!(A=$(A))){return}var C=A.className;return(C.length>0&&(C==B||new RegExp("(^|\\s)"+B+"(\\s|$)").test(C)))},addClassName:function(A,B){if(!(A=$(A))){return}if(!Element.hasClassName(A,B)){A.className+=(A.className?" ":"")+B}return A},removeClassName:function(A,B){if(!(A=$(A))){return}A.className=A.className.replace(new RegExp("(^|\\s+)"+B+"(\\s+|$)")," ").strip();return A},toggleClassName:function(A,B){if(!(A=$(A))){return}return Element[Element.hasClassName(A,B)?"removeClassName":"addClassName"](A,B)},cleanWhitespace:function(B){B=$(B);var C=B.firstChild;while(C){var A=C.nextSibling;if(C.nodeType==3&&!/\S/.test(C.nodeValue)){B.removeChild(C)}C=A}return B},empty:function(A){return $(A).innerHTML.blank()},descendantOf:function(B,A){B=$(B),A=$(A);if(B.compareDocumentPosition){return(B.compareDocumentPosition(A)&8)===8}if(A.contains){return A.contains(B)&&A!==B}while(B=B.parentNode){if(B==A){return true}}return false},scrollTo:function(A){A=$(A);var B=Element.cumulativeOffset(A);window.scrollTo(B[0],B[1]);return A},getStyle:function(B,C){B=$(B);C=C=="float"?"cssFloat":C.camelize();var D=B.style[C];if(!D||D=="auto"){var A=document.defaultView.getComputedStyle(B,null);D=A?A[C]:null}if(C=="opacity"){return D?parseFloat(D):1}return D=="auto"?null:D},getOpacity:function(A){return $(A).getStyle("opacity")},setStyle:function(B,C){B=$(B);var E=B.style,A;if(Object.isString(C)){B.style.cssText+=";"+C;return C.include("opacity")?B.setOpacity(C.match(/opacity:\s*(\d?\.?\d*)/)[1]):B}for(var D in C){if(D=="opacity"){B.setOpacity(C[D])}else{E[(D=="float"||D=="cssFloat")?(Object.isUndefined(E.styleFloat)?"cssFloat":"styleFloat"):D]=C[D]}}return B},setOpacity:function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;return A},makePositioned:function(A){A=$(A);var B=Element.getStyle(A,"position");if(B=="static"||!B){A._madePositioned=true;A.style.position="relative";if(Prototype.Browser.Opera){A.style.top=0;A.style.left=0}}return A},undoPositioned:function(A){A=$(A);if(A._madePositioned){A._madePositioned=undefined;A.style.position=A.style.top=A.style.left=A.style.bottom=A.style.right=""}return A},makeClipping:function(A){A=$(A);if(A._overflow){return A}A._overflow=Element.getStyle(A,"overflow")||"auto";if(A._overflow!=="hidden"){A.style.overflow="hidden"}return A},undoClipping:function(A){A=$(A);if(!A._overflow){return A}A.style.overflow=A._overflow=="auto"?"":A._overflow;A._overflow=null;return A},clonePosition:function(B,D){var A=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});D=$(D);var E=Element.viewportOffset(D),F=[0,0],C=null;B=$(B);if(Element.getStyle(B,"position")=="absolute"){C=Element.getOffsetParent(B);F=Element.viewportOffset(C)}if(C==document.body){F[0]-=document.body.offsetLeft;F[1]-=document.body.offsetTop}if(A.setLeft){B.style.left=(E[0]-F[0]+A.offsetLeft)+"px"}if(A.setTop){B.style.top=(E[1]-F[1]+A.offsetTop)+"px"}if(A.setWidth){B.style.width=D.offsetWidth+"px"}if(A.setHeight){B.style.height=D.offsetHeight+"px"}return B}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(D,B,C){switch(C){case"height":case"width":if(!Element.visible(B)){return null}var E=parseInt(D(B,C),10);if(E!==B["offset"+C.capitalize()]){return E+"px"}var A;if(C==="height"){A=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{A=["border-left-width","padding-left","padding-right","border-right-width"]}return A.inject(E,function(F,G){var H=D(B,G);return H===null?F:F-parseInt(H,10)})+"px";default:return D(B,C)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(C,A,B){if(B==="title"){return A.title}return C(A,B)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(A,B){A=$(A);B=(B=="float"||B=="cssFloat")?"styleFloat":B.camelize();var C=A.style[B];if(!C&&A.currentStyle){C=A.currentStyle[B]}if(B=="opacity"){if(C=(A.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(C[1]){return parseFloat(C[1])/100}}return 1}if(C=="auto"){if((B=="width"||B=="height")&&(A.getStyle("display")!="none")){return A["offset"+B.capitalize()]+"px"}return null}return C};Element.Methods.setOpacity=function(B,E){function F(G){return G.replace(/alpha\([^\)]*\)/gi,"")}B=$(B);var A=B.currentStyle;if((A&&!A.hasLayout)||(!A&&B.style.zoom=="normal")){B.style.zoom=1}var D=B.getStyle("filter"),C=B.style;if(E==1||E===""){(D=F(D))?C.filter=D:C.removeAttribute("filter");return B}else{if(E<0.00001){E=0}}C.filter=F(D)+"alpha(opacity="+(E*100)+")";return B};Element._attributeTranslations=(function(){var B="className",A="for",C=document.createElement("div");C.setAttribute(B,"x");if(C.className!=="x"){C.setAttribute("class","x");if(C.className==="x"){B="class"}}C=null;C=document.createElement("label");C.setAttribute(A,"x");if(C.htmlFor!=="x"){C.setAttribute("htmlFor","x");if(C.htmlFor==="x"){A="htmlFor"}}C=null;return{read:{names:{"class":B,className:B,"for":A,htmlFor:A},values:{_getAttr:function(D,E){return D.getAttribute(E)},_getAttr2:function(D,E){return D.getAttribute(E,2)},_getAttrNode:function(D,F){var E=D.getAttributeNode(F);return E?E.value:""},_getEv:(function(){var D=document.createElement("div"),F;D.onclick=Prototype.emptyFunction;var E=D.getAttribute("onclick");if(String(E).indexOf("{")>-1){F=function(G,H){H=G.getAttribute(H);if(!H){return null}H=H.toString();H=H.split("{")[1];H=H.split("}")[0];return H.strip()}}else{if(E===""){F=function(G,H){H=G.getAttribute(H);if(!H){return null}return H.strip()}}}D=null;return F})(),_flag:function(D,E){return $(D).hasAttribute(E)?E:null},style:function(D){return D.style.cssText.toLowerCase()},title:function(D){return D.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(A,B){A.checked=!!B},style:function(A,B){A.style.cssText=B?B:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(A){Element._attributeTranslations.write.names[A.toLowerCase()]=A;Element._attributeTranslations.has[A.toLowerCase()]=A});(function(A){Object.extend(A,{href:A._getAttr2,src:A._getAttr2,type:A._getAttr,action:A._getAttrNode,disabled:A._flag,checked:A._flag,readonly:A._flag,multiple:A._flag,onload:A._getEv,onunload:A._getEv,onclick:A._getEv,ondblclick:A._getEv,onmousedown:A._getEv,onmouseup:A._getEv,onmouseover:A._getEv,onmousemove:A._getEv,onmouseout:A._getEv,onfocus:A._getEv,onblur:A._getEv,onkeypress:A._getEv,onkeydown:A._getEv,onkeyup:A._getEv,onsubmit:A._getEv,onreset:A._getEv,onselect:A._getEv,onchange:A._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function A(E){var B=E.getElementsByTagName("*"),D=[];for(var C=0,F;F=B[C];C++){if(F.tagName!=="!"){D.push(F)}}return D}Element.Methods.down=function(C,D,B){C=$(C);if(arguments.length==1){return C.firstDescendant()}return Object.isNumber(D)?A(C)[D]:Element.select(C,D)[B||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1)?0.999999:(B==="")?"":(B<0.00001)?0:B;return A}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(A,B){A=$(A);A.style.opacity=(B==1||B==="")?"":(B<0.00001)?0:B;if(B==1){if(A.tagName.toUpperCase()=="IMG"&&A.width){A.width++;A.width--}else{try{var D=document.createTextNode(" ");A.appendChild(D);A.removeChild(D)}catch(C){}}}return A}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(C,E){C=$(C);if(E&&E.toElement){E=E.toElement()}if(Object.isElement(E)){C.parentNode.replaceChild(E,C);return C}E=Object.toHTML(E);var D=C.parentNode,B=D.tagName.toUpperCase();if(Element._insertionTranslations.tags[B]){var F=C.next(),A=Element._getContentFromAnonymousElement(B,E.stripScripts());D.removeChild(C);if(F){A.each(function(G){D.insertBefore(G,F)})}else{A.each(function(G){D.appendChild(G)})}}else{C.outerHTML=E.stripScripts()}E.evalScripts.bind(E).defer();return C}}Element._returnOffset=function(B,C){var A=[B,C];A.left=B;A.top=C;return A};Element._getContentFromAnonymousElement=function(E,D,F){var G=new Element("div"),C=Element._insertionTranslations.tags[E];var A=false;if(C){A=true}else{if(F){A=true;C=["","",0]}}if(A){G.innerHTML="&nbsp;"+C[0]+D+C[1];G.removeChild(G.firstChild);for(var B=C[2];B--;){G=G.firstChild}}else{G.innerHTML=D}return $A(G.childNodes)};Element._insertionTranslations={before:function(A,B){A.parentNode.insertBefore(B,A)},top:function(A,B){A.insertBefore(B,A.firstChild)},bottom:function(A,B){A.appendChild(B)},after:function(A,B){A.parentNode.insertBefore(B,A.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var A=Element._insertionTranslations.tags;Object.extend(A,{THEAD:A.TBODY,TFOOT:A.TBODY,TH:A.TD})})();Element.Methods.Simulated={hasAttribute:function(A,C){C=Element._attributeTranslations.has[C]||C;var B=$(A).getAttributeNode(C);return !!(B&&B.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(A){if(!Prototype.BrowserFeatures.ElementExtensions&&A.__proto__){window.HTMLElement={};window.HTMLElement.prototype=A.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}A=null})(document.createElement("div"));Element.extend=(function(){function C(G){if(typeof window.Element!="undefined"){var I=window.Element.prototype;if(I){var K="_"+(Math.random()+"").slice(2),H=document.createElement(G);I[K]="x";var J=(H[K]!=="x");delete I[K];H=null;return J}}return false}function B(H,G){for(var J in G){var I=G[J];if(Object.isFunction(I)&&!(J in H)){H[J]=I.methodize()}}}var D=C("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(D){return function(H){if(H&&typeof H._extendedByPrototype=="undefined"){var G=H.tagName;if(G&&(/^(?:object|applet|embed)$/i.test(G))){B(H,Element.Methods);B(H,Element.Methods.Simulated);B(H,Element.Methods.ByTag[G.toUpperCase()])}}return H}}return Prototype.K}var A={},E=Element.Methods.ByTag;var F=Object.extend(function(I){if(!I||typeof I._extendedByPrototype!="undefined"||I.nodeType!=1||I==window){return I}var G=Object.clone(A),H=I.tagName.toUpperCase();if(E[H]){Object.extend(G,E[H])}B(I,G);I._extendedByPrototype=Prototype.emptyFunction;return I},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(A,Element.Methods);Object.extend(A,Element.Methods.Simulated)}}});F.refresh();return F})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(A,B){return A.hasAttribute(B)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(C){var J=Prototype.BrowserFeatures,D=Element.Methods.ByTag;if(!C){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var B=C;C=arguments[1]}if(!B){Object.extend(Element.Methods,C||{})}else{if(Object.isArray(B)){B.each(H)}else{H(B)}}function H(F){F=F.toUpperCase();if(!Element.Methods.ByTag[F]){Element.Methods.ByTag[F]={}}Object.extend(Element.Methods.ByTag[F],C)}function A(M,L,F){F=F||false;for(var P in M){var O=M[P];if(!Object.isFunction(O)){continue}if(!F||!(P in L)){L[P]=O.methodize()}}}function E(O){var F;var M={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(M[O]){F="HTML"+M[O]+"Element"}if(window[F]){return window[F]}F="HTML"+O+"Element";if(window[F]){return window[F]}F="HTML"+O.capitalize()+"Element";if(window[F]){return window[F]}var L=document.createElement(O),P=L.__proto__||L.constructor.prototype;L=null;return P}var I=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(J.ElementExtensions){A(Element.Methods,I);A(Element.Methods.Simulated,I,true)}if(J.SpecificElementExtensions){for(var K in Element.Methods.ByTag){var G=E(K);if(Object.isUndefined(G)){continue}A(D[K],G.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(C){var H=Prototype.Browser,F=document,D,E={};function A(){if(H.WebKit&&!F.evaluate){return document}if(H.Opera&&window.parseFloat(window.opera.version())<9.5){return document.body}return document.documentElement}function G(B){if(!D){D=A()}E[B]="client"+B;C["get"+B]=function(){return D[E[B]]};return C["get"+B]()}C.getWidth=G.curry("Width");C.getHeight=G.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(B){if(!(B=$(B))){return}var A;if(B===window){A=0}else{if(typeof B._prototypeUID==="undefined"){B._prototypeUID=Element.Storage.UID++}A=B._prototypeUID}if(!Element.Storage[A]){Element.Storage[A]=$H()}return Element.Storage[A]},store:function(B,A,C){if(!(B=$(B))){return}if(arguments.length===2){Element.getStorage(B).update(A)}else{Element.getStorage(B).set(A,C)}return B},retrieve:function(C,B,A){if(!(C=$(C))){return}var E=Element.getStorage(C),D=E.get(B);if(Object.isUndefined(D)){E.set(B,A);D=A}return D},clone:function(C,A){if(!(C=$(C))){return}var E=C.cloneNode(A);E._prototypeUID=void 0;if(A){var D=Element.select(E,"*"),B=D.length;while(B--){D[B]._prototypeUID=void 0}}return Element.extend(E)},purge:function(C){if(!(C=$(C))){return}var A=Element._purgeElement;A(C);var D=C.getElementsByTagName("*"),B=D.length;while(B--){A(D[B])}return null}});(function(){function H(X){var W=X.match(/^(\d+)%?$/i);if(!W){return null}return(Number(W[1])/100)}function P(h,k,X){var a=null;if(Object.isElement(h)){a=h;h=a.getStyle(k)}if(h===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(h)){return window.parseFloat(h)}var c=h.include("%"),Y=(X===document.viewport);if(/\d/.test(h)&&a&&a.runtimeStyle&&!(c&&Y)){var W=a.style.left,g=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=h||0;h=a.style.pixelLeft;a.style.left=W;a.runtimeStyle.left=g;return h}if(a&&c){X=X||a.parentNode;var Z=H(h);var d=null;var b=a.getStyle("position");var f=k.include("left")||k.include("right")||k.include("width");var e=k.include("top")||k.include("bottom")||k.include("height");if(X===document.viewport){if(f){d=document.viewport.getWidth()}else{if(e){d=document.viewport.getHeight()}}}else{if(f){d=$(X).measure("width")}else{if(e){d=$(X).measure("height")}}}return(d===null)?0:d*Z}return 0}function G(W){if(Object.isString(W)&&W.endsWith("px")){return W}return W+"px"}function J(X){var W=X;while(X&&X.parentNode){var Y=X.getStyle("display");if(Y==="none"){return false}X=$(X.parentNode)}return true}var D=Prototype.K;if("currentStyle" in document.documentElement){D=function(W){if(!W.currentStyle.hasLayout){W.style.zoom=1}return W}}function F(W){if(W.include("border")){W=W+"-width"}return W.camelize()}Element.Layout=Class.create(Hash,{initialize:function($super,X,W){$super();this.element=$(X);Element.Layout.PROPERTIES.each(function(Y){this._set(Y,null)},this);if(W){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(X,W){return Hash.prototype.set.call(this,X,W)},set:function(X,W){throw"Properties of Element.Layout are read-only."},get:function($super,X){var W=$super(X);return W===null?this._compute(X):W},_begin:function(){if(this._prepared){return}var a=this.element;if(J(a)){this._prepared=true;return}var c={position:a.style.position||"",width:a.style.width||"",visibility:a.style.visibility||"",display:a.style.display||""};a.store("prototype_original_styles",c);var d=a.getStyle("position"),W=a.getStyle("width");if(W==="0px"||W===null){a.style.display="block";W=a.getStyle("width")}var X=(d==="fixed")?document.viewport:a.parentNode;a.setStyle({position:"absolute",visibility:"hidden",display:"block"});var Y=a.getStyle("width");var Z;if(W&&(Y===W)){Z=P(a,"width",X)}else{if(d==="absolute"||d==="fixed"){Z=P(a,"width",X)}else{var e=a.parentNode,b=$(e).getLayout();Z=b.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}a.setStyle({width:Z+"px"});this._prepared=true},_end:function(){var X=this.element;var W=X.retrieve("prototype_original_styles");X.store("prototype_original_styles",null);X.setStyle(W);this._prepared=false},_compute:function(X){var W=Element.Layout.COMPUTATIONS;if(!(X in W)){throw"Property not found."}return this._set(X,W[X].call(this,this.element))},toObject:function(){var W=$A(arguments);var X=(W.length===0)?Element.Layout.PROPERTIES:W.join(" ").split(" ");var Y={};X.each(function(Z){if(!Element.Layout.PROPERTIES.include(Z)){return}var a=this.get(Z);if(a!=null){Y[Z]=a}},this);return Y},toHash:function(){var W=this.toObject.apply(this,arguments);return new Hash(W)},toCSS:function(){var W=$A(arguments);var Y=(W.length===0)?Element.Layout.PROPERTIES:W.join(" ").split(" ");var X={};Y.each(function(Z){if(!Element.Layout.PROPERTIES.include(Z)){return}if(Element.Layout.COMPOSITE_PROPERTIES.include(Z)){return}var a=this.get(Z);if(a!=null){X[F(Z)]=a+"px"}},this);return X},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(Y){if(!this._preComputing){this._begin()}var W=this.get("border-box-height");if(W<=0){if(!this._preComputing){this._end()}return 0}var Z=this.get("border-top"),X=this.get("border-bottom");var b=this.get("padding-top"),a=this.get("padding-bottom");if(!this._preComputing){this._end()}return W-Z-X-b-a},width:function(Y){if(!this._preComputing){this._begin()}var X=this.get("border-box-width");if(X<=0){if(!this._preComputing){this._end()}return 0}var b=this.get("border-left"),W=this.get("border-right");var Z=this.get("padding-left"),a=this.get("padding-right");if(!this._preComputing){this._end()}return X-b-W-Z-a},"padding-box-height":function(X){var W=this.get("height"),Z=this.get("padding-top"),Y=this.get("padding-bottom");return W+Z+Y},"padding-box-width":function(W){var X=this.get("width"),Y=this.get("padding-left"),Z=this.get("padding-right");return X+Y+Z},"border-box-height":function(X){if(!this._preComputing){this._begin()}var W=X.offsetHeight;if(!this._preComputing){this._end()}return W},"border-box-width":function(W){if(!this._preComputing){this._begin()}var X=W.offsetWidth;if(!this._preComputing){this._end()}return X},"margin-box-height":function(X){var W=this.get("border-box-height"),Y=this.get("margin-top"),Z=this.get("margin-bottom");if(W<=0){return 0}return W+Y+Z},"margin-box-width":function(Y){var X=this.get("border-box-width"),Z=this.get("margin-left"),W=this.get("margin-right");if(X<=0){return 0}return X+Z+W},top:function(W){var X=W.positionedOffset();return X.top},bottom:function(W){var Z=W.positionedOffset(),X=W.getOffsetParent(),Y=X.measure("height");var a=this.get("border-box-height");return Y-a-Z.top},left:function(W){var X=W.positionedOffset();return X.left},right:function(Y){var a=Y.positionedOffset(),Z=Y.getOffsetParent(),W=Z.measure("width");var X=this.get("border-box-width");return W-X-a.left},"padding-top":function(W){return P(W,"paddingTop")},"padding-bottom":function(W){return P(W,"paddingBottom")},"padding-left":function(W){return P(W,"paddingLeft")},"padding-right":function(W){return P(W,"paddingRight")},"border-top":function(W){return P(W,"borderTopWidth")},"border-bottom":function(W){return P(W,"borderBottomWidth")},"border-left":function(W){return P(W,"borderLeftWidth")},"border-right":function(W){return P(W,"borderRightWidth")},"margin-top":function(W){return P(W,"marginTop")},"margin-bottom":function(W){return P(W,"marginBottom")},"margin-left":function(W){return P(W,"marginLeft")},"margin-right":function(W){return P(W,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(X){var Y=D(X.getOffsetParent());var Z=X.getBoundingClientRect(),W=Y.getBoundingClientRect();return(W.right-Z.right).round()},bottom:function(X){var Y=D(X.getOffsetParent());var Z=X.getBoundingClientRect(),W=Y.getBoundingClientRect();return(W.bottom-Z.bottom).round()}})}Element.Offset=Class.create({initialize:function(X,W){this.left=X.round();this.top=W.round();this[0]=this.left;this[1]=this.top},relativeTo:function(W){return new Element.Offset(this.left-W.left,this.top-W.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function T(X,W){return new Element.Layout(X,W)}function B(W,X){return $(W).getLayout().get(X)}function O(X){X=$(X);var b=Element.getStyle(X,"display");if(b&&b!=="none"){return{width:X.offsetWidth,height:X.offsetHeight}}var Y=X.style;var W={visibility:Y.visibility,position:Y.position,display:Y.display};var a={visibility:"hidden",display:"block"};if(W.position!=="fixed"){a.position="absolute"}Element.setStyle(X,a);var Z={width:X.offsetWidth,height:X.offsetHeight};Element.setStyle(X,W);return Z}function L(W){W=$(W);if(E(W)||C(W)||M(W)||K(W)){return $(document.body)}var X=(Element.getStyle(W,"display")==="inline");if(!X&&W.offsetParent){return $(W.offsetParent)}while((W=W.parentNode)&&W!==document.body){if(Element.getStyle(W,"position")!=="static"){return K(W)?$(document.body):$(W)}}return $(document.body)}function V(X){X=$(X);var W=0,Y=0;if(X.parentNode){do{W+=X.offsetTop||0;Y+=X.offsetLeft||0;X=X.offsetParent}while(X)}return new Element.Offset(Y,W)}function Q(X){X=$(X);var Y=X.getLayout();var W=0,a=0;do{W+=X.offsetTop||0;a+=X.offsetLeft||0;X=X.offsetParent;if(X){if(M(X)){break}var Z=Element.getStyle(X,"position");if(Z!=="static"){break}}}while(X);a-=Y.get("margin-top");W-=Y.get("margin-left");return new Element.Offset(a,W)}function A(X){var W=0,Y=0;do{W+=X.scrollTop||0;Y+=X.scrollLeft||0;X=X.parentNode}while(X);return new Element.Offset(Y,W)}function U(a){X=$(X);var W=0,Z=0,Y=document.body;var X=a;do{W+=X.offsetTop||0;Z+=X.offsetLeft||0;if(X.offsetParent==Y&&Element.getStyle(X,"position")=="absolute"){break}}while(X=X.offsetParent);X=a;do{if(X!=Y){W-=X.scrollTop||0;Z-=X.scrollLeft||0}}while(X=X.parentNode);return new Element.Offset(Z,W)}function S(W){W=$(W);if(Element.getStyle(W,"position")==="absolute"){return W}var a=L(W);var Z=W.viewportOffset(),X=a.viewportOffset();var b=Z.relativeTo(X);var Y=W.getLayout();W.store("prototype_absolutize_original_styles",{left:W.getStyle("left"),top:W.getStyle("top"),width:W.getStyle("width"),height:W.getStyle("height")});W.setStyle({position:"absolute",top:b.top+"px",left:b.left+"px",width:Y.get("width")+"px",height:Y.get("height")+"px"});return W}function I(X){X=$(X);if(Element.getStyle(X,"position")==="relative"){return X}var W=X.retrieve("prototype_absolutize_original_styles");if(W){X.setStyle(W)}return X}if(Prototype.Browser.IE){L=L.wrap(function(Y,X){X=$(X);if(E(X)||C(X)||M(X)||K(X)){return $(document.body)}var W=X.getStyle("position");if(W!=="static"){return Y(X)}X.setStyle({position:"relative"});var Z=Y(X);X.setStyle({position:W});return Z});Q=Q.wrap(function(Z,X){X=$(X);if(!X.parentNode){return new Element.Offset(0,0)}var W=X.getStyle("position");if(W!=="static"){return Z(X)}var Y=X.getOffsetParent();if(Y&&Y.getStyle("position")==="fixed"){D(Y)}X.setStyle({position:"relative"});var a=Z(X);X.setStyle({position:W});return a})}else{if(Prototype.Browser.Webkit){V=function(X){X=$(X);var W=0,Y=0;do{W+=X.offsetTop||0;Y+=X.offsetLeft||0;if(X.offsetParent==document.body){if(Element.getStyle(X,"position")=="absolute"){break}}X=X.offsetParent}while(X);return new Element.Offset(Y,W)}}}Element.addMethods({getLayout:T,measure:B,getDimensions:O,getOffsetParent:L,cumulativeOffset:V,positionedOffset:Q,cumulativeScrollOffset:A,viewportOffset:U,absolutize:S,relativize:I});function M(W){return W.nodeName.toUpperCase()==="BODY"}function K(W){return W.nodeName.toUpperCase()==="HTML"}function E(W){return W.nodeType===Node.DOCUMENT_NODE}function C(W){return W!==document.body&&!Element.descendantOf(W,document.body)}if("getBoundingClientRect" in document.documentElement){Element.addMethods({viewportOffset:function(W){W=$(W);if(C(W)){return new Element.Offset(0,0)}var X=W.getBoundingClientRect(),Y=document.documentElement;return new Element.Offset(X.left-Y.clientLeft,X.top-Y.clientTop)}})}})();window.$$=function(){var A=$A(arguments).join(", ");return Prototype.Selector.select(A,document)};Prototype.Selector=(function(){function A(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function C(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function D(K,L,H){H=H||0;var G=Prototype.Selector.match,J=K.length,F=0,I;for(I=0;I<J;I++){if(G(K[I],L)&&H==F++){return Element.extend(K[I])}}}function E(H){for(var F=0,G=H.length;F<G;F++){Element.extend(H[F])}return H}var B=Prototype.K;return{select:A,match:C,find:D,extendElements:(Element.extend===B)?B:E,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var Q=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,I=0,D=Object.prototype.toString,O=false,H=true;[0,0].sort(function(){H=false;return 0});var B=function(g,W,d,Y){d=d||[];var T=W=W||document;if(W.nodeType!==1&&W.nodeType!==9){return[]}if(!g||typeof g!=="string"){return d}var e=[],f,b,o,l,c,V,U=true,Z=P(W),k=g;while((Q.exec(""),f=Q.exec(k))!==null){k=f[3];e.push(f[1]);if(f[2]){V=f[3];break}}if(e.length>1&&J.exec(g)){if(e.length===2&&E.relative[e[0]]){b=F(e[0]+e[1],W)}else{b=E.relative[e[0]]?[W]:B(e.shift(),W);while(e.length){g=e.shift();if(E.relative[g]){g+=e.shift()}b=F(g,b)}}}else{if(!Y&&e.length>1&&W.nodeType===9&&!Z&&E.match.ID.test(e[0])&&!E.match.ID.test(e[e.length-1])){var p=B.find(e.shift(),W,Z);W=p.expr?B.filter(p.expr,p.set)[0]:p.set[0]}if(W){var p=Y?{expr:e.pop(),set:A(Y)}:B.find(e.pop(),e.length===1&&(e[0]==="~"||e[0]==="+")&&W.parentNode?W.parentNode:W,Z);b=p.expr?B.filter(p.expr,p.set):p.set;if(e.length>0){o=A(b)}else{U=false}while(e.length){var X=e.pop(),a=X;if(!E.relative[X]){X=""}else{a=e.pop()}if(a==null){a=W}E.relative[X](o,a,Z)}}else{o=e=[]}}if(!o){o=b}if(!o){throw"Syntax error, unrecognized expression: "+(X||g)}if(D.call(o)==="[object Array]"){if(!U){d.push.apply(d,o)}else{if(W&&W.nodeType===1){for(var h=0;o[h]!=null;h++){if(o[h]&&(o[h]===true||o[h].nodeType===1&&G(W,o[h]))){d.push(b[h])}}}else{for(var h=0;o[h]!=null;h++){if(o[h]&&o[h].nodeType===1){d.push(b[h])}}}}}else{A(o,d)}if(V){B(V,T,d,Y);B.uniqueSort(d)}return d};B.uniqueSort=function(U){if(C){O=H;U.sort(C);if(O){for(var T=1;T<U.length;T++){if(U[T]===U[T-1]){U.splice(T--,1)}}}}return U};B.matches=function(T,U){return B(T,null,null,U)};B.find=function(a,T,b){var Z,X;if(!a){return[]}for(var W=0,V=E.order.length;W<V;W++){var Y=E.order[W],X;if((X=E.leftMatch[Y].exec(a))){var U=X[1];X.splice(1,1);if(U.substr(U.length-1)!=="\\"){X[1]=(X[1]||"").replace(/\\/g,"");Z=E.find[Y](X,T,b);if(Z!=null){a=a.replace(E.match[Y],"");break}}}}if(!Z){Z=T.getElementsByTagName("*")}return{set:Z,expr:a}};B.filter=function(d,c,g,W){var V=d,k=[],a=c,Y,T,Z=c&&c[0]&&P(c[0]);while(d&&c.length){for(var b in E.filter){if((Y=E.match[b].exec(d))!=null){var U=E.filter[b],h,f;T=false;if(a==k){k=[]}if(E.preFilter[b]){Y=E.preFilter[b](Y,a,g,k,W,Z);if(!Y){T=h=true}else{if(Y===true){continue}}}if(Y){for(var X=0;(f=a[X])!=null;X++){if(f){h=U(f,Y,X,a);var e=W^!!h;if(g&&h!=null){if(e){T=true}else{a[X]=false}}else{if(e){k.push(f);T=true}}}}}if(h!==undefined){if(!g){a=k}d=d.replace(E.match[b],"");if(!T){return[]}break}}}if(d==V){if(T==null){throw"Syntax error, unrecognized expression: "+d}else{break}}V=d}return a};var E=B.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(T){return T.getAttribute("href")}},relative:{"+":function(a,T,Z){var X=typeof T==="string",b=X&&!/\W/.test(T),Y=X&&!b;if(b&&!Z){T=T.toUpperCase()}for(var W=0,V=a.length,U;W<V;W++){if((U=a[W])){while((U=U.previousSibling)&&U.nodeType!==1){}a[W]=Y||U&&U.nodeName===T?U||false:U===T}}if(Y){B.filter(T,a,true)}},">":function(Z,U,a){var X=typeof U==="string";if(X&&!/\W/.test(U)){U=a?U:U.toUpperCase();for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){var W=Y.parentNode;Z[V]=W.nodeName===U?W:false}}}else{for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){Z[V]=X?Y.parentNode:Y.parentNode===U}}if(X){B.filter(U,Z,true)}}},"":function(W,U,Y){var V=I++,T=S;if(!/\W/.test(U)){var X=U=Y?U:U.toUpperCase();T=M}T("parentNode",U,V,W,X,Y)},"~":function(W,U,Y){var V=I++,T=S;if(typeof U==="string"&&!/\W/.test(U)){var X=U=Y?U:U.toUpperCase();T=M}T("previousSibling",U,V,W,X,Y)}},find:{ID:function(U,V,W){if(typeof V.getElementById!=="undefined"&&!W){var T=V.getElementById(U[1]);return T?[T]:[]}},NAME:function(V,Y,Z){if(typeof Y.getElementsByName!=="undefined"){var U=[],X=Y.getElementsByName(V[1]);for(var W=0,T=X.length;W<T;W++){if(X[W].getAttribute("name")===V[1]){U.push(X[W])}}return U.length===0?null:U}},TAG:function(T,U){return U.getElementsByTagName(T[1])}},preFilter:{CLASS:function(W,U,V,T,Z,a){W=" "+W[1].replace(/\\/g,"")+" ";if(a){return W}for(var X=0,Y;(Y=U[X])!=null;X++){if(Y){if(Z^(Y.className&&(" "+Y.className+" ").indexOf(W)>=0)){if(!V){T.push(Y)}}else{if(V){U[X]=false}}}}return false},ID:function(T){return T[1].replace(/\\/g,"")},TAG:function(U,T){for(var V=0;T[V]===false;V++){}return T[V]&&P(T[V])?U[1]:U[1].toUpperCase()},CHILD:function(T){if(T[1]=="nth"){var U=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(T[2]=="even"&&"2n"||T[2]=="odd"&&"2n+1"||!/\D/.test(T[2])&&"0n+"+T[2]||T[2]);T[2]=(U[1]+(U[2]||1))-0;T[3]=U[3]-0}T[0]=I++;return T},ATTR:function(X,U,V,T,Y,Z){var W=X[1].replace(/\\/g,"");if(!Z&&E.attrMap[W]){X[1]=E.attrMap[W]}if(X[2]==="~="){X[4]=" "+X[4]+" "}return X},PSEUDO:function(X,U,V,T,Y){if(X[1]==="not"){if((Q.exec(X[3])||"").length>1||/^\w/.test(X[3])){X[3]=B(X[3],null,null,U)}else{var W=B.filter(X[3],U,V,true^Y);if(!V){T.push.apply(T,W)}return false}}else{if(E.match.POS.test(X[0])||E.match.CHILD.test(X[0])){return true}}return X},POS:function(T){T.unshift(true);return T}},filters:{enabled:function(T){return T.disabled===false&&T.type!=="hidden"},disabled:function(T){return T.disabled===true},checked:function(T){return T.checked===true},selected:function(T){T.parentNode.selectedIndex;return T.selected===true},parent:function(T){return !!T.firstChild},empty:function(T){return !T.firstChild},has:function(V,U,T){return !!B(T[3],V).length},header:function(T){return/h\d/i.test(T.nodeName)},text:function(T){return"text"===T.type},radio:function(T){return"radio"===T.type},checkbox:function(T){return"checkbox"===T.type},file:function(T){return"file"===T.type},password:function(T){return"password"===T.type},submit:function(T){return"submit"===T.type},image:function(T){return"image"===T.type},reset:function(T){return"reset"===T.type},button:function(T){return"button"===T.type||T.nodeName.toUpperCase()==="BUTTON"},input:function(T){return/input|select|textarea|button/i.test(T.nodeName)}},setFilters:{first:function(U,T){return T===0},last:function(V,U,T,W){return U===W.length-1},even:function(U,T){return T%2===0},odd:function(U,T){return T%2===1},lt:function(V,U,T){return U<T[3]-0},gt:function(V,U,T){return U>T[3]-0},nth:function(V,U,T){return T[3]-0==U},eq:function(V,U,T){return T[3]-0==U}},filter:{PSEUDO:function(Z,V,W,a){var U=V[1],X=E.filters[U];if(X){return X(Z,W,V,a)}else{if(U==="contains"){return(Z.textContent||Z.innerText||"").indexOf(V[3])>=0}else{if(U==="not"){var Y=V[3];for(var W=0,T=Y.length;W<T;W++){if(Y[W]===Z){return false}}return true}}}},CHILD:function(T,W){var Z=W[1],U=T;switch(Z){case"only":case"first":while((U=U.previousSibling)){if(U.nodeType===1){return false}}if(Z=="first"){return true}U=T;case"last":while((U=U.nextSibling)){if(U.nodeType===1){return false}}return true;case"nth":var V=W[2],c=W[3];if(V==1&&c==0){return true}var Y=W[0],b=T.parentNode;if(b&&(b.sizcache!==Y||!T.nodeIndex)){var X=0;for(U=b.firstChild;U;U=U.nextSibling){if(U.nodeType===1){U.nodeIndex=++X}}b.sizcache=Y}var a=T.nodeIndex-c;if(V==0){return a==0}else{return(a%V==0&&a/V>=0)}}},ID:function(U,T){return U.nodeType===1&&U.getAttribute("id")===T},TAG:function(U,T){return(T==="*"&&U.nodeType===1)||U.nodeName===T},CLASS:function(U,T){return(" "+(U.className||U.getAttribute("class"))+" ").indexOf(T)>-1},ATTR:function(Y,W){var V=W[1],T=E.attrHandle[V]?E.attrHandle[V](Y):Y[V]!=null?Y[V]:Y.getAttribute(V),Z=T+"",X=W[2],U=W[4];return T==null?X==="!=":X==="="?Z===U:X==="*="?Z.indexOf(U)>=0:X==="~="?(" "+Z+" ").indexOf(U)>=0:!U?Z&&T!==false:X==="!="?Z!=U:X==="^="?Z.indexOf(U)===0:X==="$="?Z.substr(Z.length-U.length)===U:X==="|="?Z===U||Z.substr(0,U.length+1)===U+"-":false},POS:function(X,U,V,Y){var T=U[2],W=E.setFilters[T];if(W){return W(X,V,U,Y)}}}};var J=E.match.POS;for(var L in E.match){E.match[L]=new RegExp(E.match[L].source+/(?![^\[]*\])(?![^\(]*\))/.source);E.leftMatch[L]=new RegExp(/(^(?:.|\r|\n)*?)/.source+E.match[L].source)}var A=function(U,T){U=Array.prototype.slice.call(U,0);if(T){T.push.apply(T,U);return T}return U};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(K){A=function(X,W){var U=W||[];if(D.call(X)==="[object Array]"){Array.prototype.push.apply(U,X)}else{if(typeof X.length==="number"){for(var V=0,T=X.length;V<T;V++){U.push(X[V])}}else{for(var V=0;X[V];V++){U.push(X[V])}}}return U}}var C;if(document.documentElement.compareDocumentPosition){C=function(U,T){if(!U.compareDocumentPosition||!T.compareDocumentPosition){if(U==T){O=true}return 0}var V=U.compareDocumentPosition(T)&4?-1:U===T?0:1;if(V===0){O=true}return V}}else{if("sourceIndex" in document.documentElement){C=function(U,T){if(!U.sourceIndex||!T.sourceIndex){if(U==T){O=true}return 0}var V=U.sourceIndex-T.sourceIndex;if(V===0){O=true}return V}}else{if(document.createRange){C=function(W,U){if(!W.ownerDocument||!U.ownerDocument){if(W==U){O=true}return 0}var V=W.ownerDocument.createRange(),T=U.ownerDocument.createRange();V.setStart(W,0);V.setEnd(W,0);T.setStart(U,0);T.setEnd(U,0);var X=V.compareBoundaryPoints(Range.START_TO_END,T);if(X===0){O=true}return X}}}}(function(){var U=document.createElement("div"),V="script"+(new Date).getTime();U.innerHTML="<a name='"+V+"'/>";var T=document.documentElement;T.insertBefore(U,T.firstChild);if(!!document.getElementById(V)){E.find.ID=function(X,Y,Z){if(typeof Y.getElementById!=="undefined"&&!Z){var W=Y.getElementById(X[1]);return W?W.id===X[1]||typeof W.getAttributeNode!=="undefined"&&W.getAttributeNode("id").nodeValue===X[1]?[W]:undefined:[]}};E.filter.ID=function(Y,W){var X=typeof Y.getAttributeNode!=="undefined"&&Y.getAttributeNode("id");return Y.nodeType===1&&X&&X.nodeValue===W}}T.removeChild(U);T=U=null})();(function(){var T=document.createElement("div");T.appendChild(document.createComment(""));if(T.getElementsByTagName("*").length>0){E.find.TAG=function(U,Y){var X=Y.getElementsByTagName(U[1]);if(U[1]==="*"){var W=[];for(var V=0;X[V];V++){if(X[V].nodeType===1){W.push(X[V])}}X=W}return X}}T.innerHTML="<a href='#'></a>";if(T.firstChild&&typeof T.firstChild.getAttribute!=="undefined"&&T.firstChild.getAttribute("href")!=="#"){E.attrHandle.href=function(U){return U.getAttribute("href",2)}}T=null})();if(document.querySelectorAll){(function(){var T=B,V=document.createElement("div");V.innerHTML="<p class='TEST'></p>";if(V.querySelectorAll&&V.querySelectorAll(".TEST").length===0){return}B=function(Z,Y,W,X){Y=Y||document;if(!X&&Y.nodeType===9&&!P(Y)){try{return A(Y.querySelectorAll(Z),W)}catch(a){}}return T(Z,Y,W,X)};for(var U in T){B[U]=T[U]}V=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var T=document.createElement("div");T.innerHTML="<div class='test e'></div><div class='test'></div>";if(T.getElementsByClassName("e").length===0){return}T.lastChild.className="e";if(T.getElementsByClassName("e").length===1){return}E.order.splice(1,0,"CLASS");E.find.CLASS=function(U,V,W){if(typeof V.getElementsByClassName!=="undefined"&&!W){return V.getElementsByClassName(U[1])}};T=null})()}function M(U,Z,Y,d,a,c){var b=U=="previousSibling"&&!c;for(var W=0,V=d.length;W<V;W++){var T=d[W];if(T){if(b&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=d[T.sizset];break}if(T.nodeType===1&&!c){T.sizcache=Y;T.sizset=W}if(T.nodeName===Z){X=T;break}T=T[U]}d[W]=X}}}function S(U,Z,Y,d,a,c){var b=U=="previousSibling"&&!c;for(var W=0,V=d.length;W<V;W++){var T=d[W];if(T){if(b&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=d[T.sizset];break}if(T.nodeType===1){if(!c){T.sizcache=Y;T.sizset=W}if(typeof Z!=="string"){if(T===Z){X=true;break}}else{if(B.filter(Z,[T]).length>0){X=T;break}}}T=T[U]}d[W]=X}}}var G=document.compareDocumentPosition?function(U,T){return U.compareDocumentPosition(T)&16}:function(U,T){return U!==T&&(U.contains?U.contains(T):true)};var P=function(T){return T.nodeType===9&&T.documentElement.nodeName!=="HTML"||!!T.ownerDocument&&T.ownerDocument.documentElement.nodeName!=="HTML"};var F=function(T,a){var W=[],X="",Y,V=a.nodeType?[a]:a;while((Y=E.match.PSEUDO.exec(T))){X+=Y[0];T=T.replace(E.match.PSEUDO,"")}T=E.relative[T]?T+"*":T;for(var Z=0,U=V.length;Z<U;Z++){B(T,V[Z],W)}return B.filter(X,W)};window.Sizzle=B})();(function(C){var D=Prototype.Selector.extendElements;function A(E,F){return D(C(E,F||document))}function B(F,E){return C.matches(E,[F]).length==1}Prototype.Selector.engine=C;Prototype.Selector.select=A;Prototype.Selector.match=B})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(A){A=$(A);A.reset();return A},serializeElements:function(H,D){if(typeof D!="object"){D={hash:!!D}}else{if(Object.isUndefined(D.hash)){D.hash=true}}var E,G,A=false,F=D.submit,B,C;if(D.hash){C={};B=function(I,J,K){if(J in I){if(!Object.isArray(I[J])){I[J]=[I[J]]}I[J].push(K)}else{I[J]=K}return I}}else{C="";B=function(I,J,K){return I+(I?"&":"")+encodeURIComponent(J)+"="+encodeURIComponent(K)}}return H.inject(C,function(I,J){if(!J.disabled&&J.name){E=J.name;G=$(J).getValue();if(G!=null&&J.type!="file"&&(J.type!="submit"||(!A&&F!==false&&(!F||E==F)&&(A=true)))){I=B(I,E,G)}}return I})}};Form.Methods={serialize:function(B,A){return Form.serializeElements(Form.getElements(B),A)},getElements:function(E){var F=$(E).getElementsByTagName("*"),D,A=[],C=Form.Element.Serializers;for(var B=0;D=F[B];B++){A.push(D)}return A.inject([],function(G,H){if(C[H.tagName.toLowerCase()]){G.push(Element.extend(H))}return G})},getInputs:function(G,C,D){G=$(G);var A=G.getElementsByTagName("input");if(!C&&!D){return $A(A).map(Element.extend)}for(var E=0,H=[],F=A.length;E<F;E++){var B=A[E];if((C&&B.type!=C)||(D&&B.name!=D)){continue}H.push(Element.extend(B))}return H},disable:function(A){A=$(A);Form.getElements(A).invoke("disable");return A},enable:function(A){A=$(A);Form.getElements(A).invoke("enable");return A},findFirstElement:function(B){var C=$(B).getElements().findAll(function(D){return"hidden"!=D.type&&!D.disabled});var A=C.findAll(function(D){return D.hasAttribute("tabIndex")&&D.tabIndex>=0}).sortBy(function(D){return D.tabIndex}).first();return A?A:C.find(function(D){return/^(?:input|select|textarea)$/i.test(D.tagName)})},focusFirstElement:function(B){B=$(B);var A=B.findFirstElement();if(A){A.activate()}return B},request:function(B,A){B=$(B),A=Object.clone(A||{});var D=A.parameters,C=B.readAttribute("action")||"";if(C.blank()){C=window.location.href}A.parameters=B.serialize(true);if(D){if(Object.isString(D)){D=D.toQueryParams()}Object.extend(A.parameters,D)}if(B.hasAttribute("method")&&!A.method){A.method=B.method}return new Ajax.Request(C,A)}};Form.Element={focus:function(A){$(A).focus();return A},select:function(A){$(A).select();return A}};Form.Element.Methods={serialize:function(A){A=$(A);if(!A.disabled&&A.name){var B=A.getValue();if(B!=undefined){var C={};C[A.name]=B;return Object.toQueryString(C)}}return""},getValue:function(A){A=$(A);var B=A.tagName.toLowerCase();return Form.Element.Serializers[B](A)},setValue:function(A,B){A=$(A);var C=A.tagName.toLowerCase();Form.Element.Serializers[C](A,B);return A},clear:function(A){$(A).value="";return A},present:function(A){return $(A).value!=""},activate:function(A){A=$(A);try{A.focus();if(A.select&&(A.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(A.type)))){A.select()}}catch(B){}return A},disable:function(A){A=$(A);A.disabled=true;return A},enable:function(A){A=$(A);A.disabled=false;return A}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function B(H,I){switch(H.type.toLowerCase()){case"checkbox":case"radio":return F(H,I);default:return E(H,I)}}function F(H,I){if(Object.isUndefined(I)){return H.checked?H.value:null}else{H.checked=!!I}}function E(H,I){if(Object.isUndefined(I)){return H.value}else{H.value=I}}function A(J,M){if(Object.isUndefined(M)){return(J.type==="select-one"?C:D)(J)}var I,K,O=!Object.isArray(M);for(var H=0,L=J.length;H<L;H++){I=J.options[H];K=this.optionValue(I);if(O){if(K==M){I.selected=true;return}}else{I.selected=M.include(K)}}}function C(I){var H=I.selectedIndex;return H>=0?G(I.options[H]):null}function D(K){var H,L=K.length;if(!L){return null}for(var J=0,H=[];J<L;J++){var I=K.options[J];if(I.selected){H.push(G(I))}}return H}function G(H){return Element.hasAttribute(H,"value")?H.value:H.text}return{input:B,inputSelector:F,textarea:E,select:A,selectOne:C,selectMany:D,optionValue:G,button:E}})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,A,B,C){$super(C,B);this.element=$(A);this.lastValue=this.getValue()},execute:function(){var A=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(A)?this.lastValue!=A:String(this.lastValue)!=String(A)){this.callback(this.element,A);this.lastValue=A}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(A,B){this.element=$(A);this.callback=B;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var A=this.getValue();if(this.lastValue!=A){this.callback(this.element,A);this.lastValue=A}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(A){if(A.type){switch(A.type.toLowerCase()){case"checkbox":case"radio":Event.observe(A,"click",this.onElementEvent.bind(this));break;default:Event.observe(A,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var e={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var F=document.documentElement;var f="onmouseenter" in F&&"onmouseleave" in F;var A=function(g){return false};if(window.attachEvent){if(window.addEventListener){A=function(g){return !(g instanceof window.Event)}}else{A=function(g){return true}}}var T;function c(h,g){return h.which?(h.which===g+1):(h.button===g)}var P={0:1,1:4,2:2};function a(h,g){return h.button===P[g]}function d(h,g){switch(g){case 0:return h.which==1&&!h.metaKey;case 1:return h.which==2||(h.which==1&&h.metaKey);case 2:return h.which==3;default:return false}}if(window.attachEvent){if(!window.addEventListener){T=a}else{T=function(h,g){return A(h)?a(h,g):c(h,g)}}}else{if(Prototype.Browser.WebKit){T=d}else{T=c}}function X(g){return T(g,0)}function V(g){return T(g,1)}function O(g){return T(g,2)}function D(k){k=e.extend(k);var h=k.target,g=k.type,l=k.currentTarget;if(l&&l.tagName){if(g==="load"||g==="error"||(g==="click"&&l.tagName.toLowerCase()==="input"&&l.type==="radio")){h=l}}if(h.nodeType==Node.TEXT_NODE){h=h.parentNode}return Element.extend(h)}function Q(h,k){var g=e.element(h);if(!k){return g}while(g){if(Object.isElement(g)&&Prototype.Selector.match(g,k)){return Element.extend(g)}g=g.parentNode}}function U(g){return{x:C(g),y:B(g)}}function C(k){var h=document.documentElement,g=document.body||{scrollLeft:0};return k.pageX||(k.clientX+(h.scrollLeft||g.scrollLeft)-(h.clientLeft||0))}function B(k){var h=document.documentElement,g=document.body||{scrollTop:0};return k.pageY||(k.clientY+(h.scrollTop||g.scrollTop)-(h.clientTop||0))}function S(g){e.extend(g);g.preventDefault();g.stopPropagation();g.stopped=true}e.Methods={isLeftClick:X,isMiddleClick:V,isRightClick:O,element:D,findElement:Q,pointer:U,pointerX:C,pointerY:B,stop:S};var Z=Object.keys(e.Methods).inject({},function(g,h){g[h]=e.Methods[h].methodize();return g});if(window.attachEvent){function I(h){var g;switch(h.type){case"mouseover":case"mouseenter":g=h.fromElement;break;case"mouseout":case"mouseleave":g=h.toElement;break;default:return null}return Element.extend(g)}var W={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}};e.extend=function(h,g){if(!h){return false}if(!A(h)){return h}if(h._extendedByPrototype){return h}h._extendedByPrototype=Prototype.emptyFunction;var k=e.pointer(h);Object.extend(h,{target:h.srcElement||g,relatedTarget:I(h),pageX:k.x,pageY:k.y});Object.extend(h,Z);Object.extend(h,W);return h}}else{e.extend=Prototype.K}if(window.addEventListener){e.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(e.prototype,Z)}function M(m,l,o){var k=Element.retrieve(m,"prototype_event_registry");if(Object.isUndefined(k)){E.push(m);k=Element.retrieve(m,"prototype_event_registry",$H())}var g=k.get(l);if(Object.isUndefined(g)){g=[];k.set(l,g)}if(g.pluck("handler").include(o)){return false}var h;if(l.include(":")){h=function(p){if(Object.isUndefined(p.eventName)){return false}if(p.eventName!==l){return false}e.extend(p,m);o.call(m,p)}}else{if(!f&&(l==="mouseenter"||l==="mouseleave")){if(l==="mouseenter"||l==="mouseleave"){h=function(q){e.extend(q,m);var p=q.relatedTarget;while(p&&p!==m){try{p=p.parentNode}catch(r){p=m}}if(p===m){return}o.call(m,q)}}}else{h=function(p){e.extend(p,m);o.call(m,p)}}}h.handler=o;g.push(h);return h}function H(){for(var g=0,h=E.length;g<h;g++){e.stopObserving(E[g]);E[g]=null}}var E=[];if(Prototype.Browser.IE){window.attachEvent("onunload",H)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var L=Prototype.K,G={mouseenter:"mouseover",mouseleave:"mouseout"};if(!f){L=function(g){return(G[g]||g)}}function Y(l,k,m){l=$(l);var h=M(l,k,m);if(!h){return l}if(k.include(":")){if(l.addEventListener){l.addEventListener("dataavailable",h,false)}else{l.attachEvent("ondataavailable",h);l.attachEvent("onlosecapture",h)}}else{var g=L(k);if(l.addEventListener){l.addEventListener(g,h,false)}else{l.attachEvent("on"+g,h)}}return l}function K(p,l,q){p=$(p);var k=Element.retrieve(p,"prototype_event_registry");if(!k){return p}if(!l){k.each(function(t){var r=t.key;K(p,r)});return p}var m=k.get(l);if(!m){return p}if(!q){m.each(function(t){K(p,l,t.handler)});return p}var o=m.length,h;while(o--){if(m[o].handler===q){h=m[o];break}}if(!h){return p}if(l.include(":")){if(p.removeEventListener){p.removeEventListener("dataavailable",h,false)}else{p.detachEvent("ondataavailable",h);p.detachEvent("onlosecapture",h)}}else{var g=L(l);if(p.removeEventListener){p.removeEventListener(g,h,false)}else{p.detachEvent("on"+g,h)}}k.set(l,m.without(h));return p}function b(l,k,h,g){l=$(l);if(Object.isUndefined(g)){g=true}if(l==document&&document.createEvent&&!l.dispatchEvent){l=document.documentElement}var m;if(document.createEvent){m=document.createEvent("HTMLEvents");m.initEvent("dataavailable",g,true)}else{m=document.createEventObject();m.eventType=g?"ondataavailable":"onlosecapture"}m.eventName=k;m.memo=h||{};if(document.createEvent){l.dispatchEvent(m)}else{l.fireEvent(m.eventType,m)}return e.extend(m)}e.Handler=Class.create({initialize:function(k,h,g,l){this.element=$(k);this.eventName=h;this.selector=g;this.callback=l;this.handler=this.handleEvent.bind(this)},start:function(){e.observe(this.element,this.eventName,this.handler);return this},stop:function(){e.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(h){var g=e.findElement(h,this.selector);if(g){this.callback.call(this.element,h,g)}}});function J(k,h,g,l){k=$(k);if(Object.isFunction(g)&&Object.isUndefined(l)){l=g,g=null}return new e.Handler(k,h,g,l).start()}Object.extend(e,e.Methods);Object.extend(e,{fire:b,observe:Y,stopObserving:K,on:J});Element.addMethods({fire:b,observe:Y,stopObserving:K,on:J});Object.extend(document,{fire:b.methodize(),observe:Y.methodize(),stopObserving:K.methodize(),on:J.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,e)}else{window.Event=e}})();(function(){var D;function A(){if(document.loaded){return}if(D){window.clearTimeout(D)}document.loaded=true;document.fire("dom:loaded")}function C(){if(document.readyState==="complete"){document.stopObserving("readystatechange",C);A()}}function B(){try{document.documentElement.doScroll("left")}catch(E){D=B.defer();return}A()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",A,false)}else{document.observe("readystatechange",C);if(window==top){D=B.defer()}}Event.observe(window,"load",A)})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,B){return Element.insert(A,{before:B})},Top:function(A,B){return Element.insert(A,{top:B})},Bottom:function(A,B){return Element.insert(A,{bottom:B})},After:function(A,B){return Element.insert(A,{after:B})}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C)}this.xcomp=A;this.ycomp=C;this.offset=Element.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth)},withinIncludingScrolloffsets:function(B,A,D){var C=Element.cumulativeScrollOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=Element.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth)},overlap:function(B,A){if(!B){return 0}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A)},relativize:function(A){Position.prepare();return Element.relativize(A)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(B,C,A){A=A||{};return Element.clonePosition(C,B,A)}};if(!document.getElementsByClassName){document.getElementsByClassName=function(B){function A(C){return C.blank()?null:"[contains(concat(' ', @class, ' '), ' "+C+" ')]"}B.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(C,E){E=E.toString().strip();var D=/\s/.test(E)?$w(E).map(A).join(""):A(E);return D?document._getElementsByXPath(".//*"+D,C):[]}:function(E,F){F=F.toString().strip();var G=[],H=(/\s/.test(F)?$w(F):null);if(!H&&!F){return G}var C=$(E).getElementsByTagName("*");F=" "+F+" ";for(var D=0,J,I;J=C[D];D++){if(J.className&&(I=" "+J.className+" ")&&(I.include(F)||(H&&H.all(function(K){return !K.toString().blank()&&I.include(" "+K+" ")})))){G.push(Element.extend(J))}}return G};return function(D,C){return $(C||document.body).getElementsByClassName(D)}}(Element.Methods)}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A)},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0})._each(A)},set:function(A){this.element.className=A},add:function(A){if(this.include(A)){return}this.set($A(this).concat(A).join(" "))},remove:function(A){if(!this.include(A)){return}this.set($A(this).without(A).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(A){this.expression=A.strip()},findElements:function(A){return Prototype.Selector.select(this.expression,A)},match:function(A){return Prototype.Selector.match(A,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(F,G){var A=Prototype.Selector.match,D=[];for(var C=0,E=F.length;C<E;C++){var B=F[C];if(A(B,G)){D.push(Element.extend(B))}}return D},findElement:function(F,G,B){B=B||0;var A=0,D;for(var C=0,E=F.length;C<E;C++){D=F[C];if(Prototype.Selector.match(D,G)&&B===A++){return Element.extend(D)}}},findChildElements:function(B,C){var A=C.toArray().join(", ");return Prototype.Selector.select(A,B||document)}})})();Object.extend(Class.Methods,{logMethods:function(B){var B=B||{},C=(B.id&&B.id+".")||"",D=!!B.trace,F=this.prototype;for(var E in F){var A=F.hasOwnProperty(E)?"":" (inherited)";if((D||!A)&&Object.isFunction(F[E])){F[E]=F[E].wrap(function(H,I,G){return function(J){(B.callback||log.info)(H+I+G);return J.apply(this,$A(arguments).slice(1))}}(C,E,A))}}}});Element.exception=undefined;Element.addMethods({getElementsByTagAndClass:function(B,C){var A=arguments[0];var B=arguments[1];var C=arguments[2];var D=A.getElementsByTagName(B);return $A(D).inject([],function(E,F){if(F.className.match(new RegExp("(^|\\s)"+C+"(\\s|$)"))){E.push(Element.extend(F))}return E})},getNthElementByClassName:function(){if(arguments.length<3){return Element.exception}var F=arguments[0];var H=arguments[1];var B=parseInt(arguments[2]);var E=(arguments[3]?arguments[3]:"*");if(isNaN(B)){return Element.exception}var G=$A((F||document.body).getElementsByTagName(E));if(B==0){return Element.exception}else{if(B<0){G.reverse(true);B=Math.abs(B)}}var C=0;var A=null;for(var D=0;D<G.length;D++){if(G[D].className.match(new RegExp("(^|\\s)"+H+"(\\s|$)"))){C++;if(C==B){A=Element.extend(G[D]);break}}}return A},getFirstElementByClassName:function(){var B=arguments[0];var C=arguments[1];var A=arguments[2];if(A){return B.getNthElementByClassName(C,1,A)}else{return B.getNthElementByClassName(C,1)}},getLastElementByClassName:function(){var B=arguments[0];var C=arguments[1];var A=arguments[2];if(A){return B.getNthElementByClassName(C,-1,A)}else{return B.getNthElementByClassName(C,-1)}},containsElementWithClassName:function(){if(arguments.length<2){return null}var C=arguments[0];var D=arguments[1];var B=arguments[2];var A=null;if(B){A=C.getNthElementByClassName(D,1,arguments[2])}else{A=C.getNthElementByClassName(D,1)}if(A){return true}else{return false}},getElementsByAttribute:function(){if(arguments.length<2){return null}var E=arguments[0];var F=arguments[1];if(F.toLowerCase()=="class"||F.toLowerCase()=="classname"){log.error("getElementsByAttribute does not support 'class' or 'className' as the attribute parameter");return null}var B=E.getElementsByTagName(arguments[2]||"*");var D=$A();var G=B.length;for(var C=0;C<G;C++){var A=B[C];if(A.getAttribute(F)){D.push(Element.extend(A))}}return D},getParentByTagName:function(){var B=$A(arguments),C=B.shift(),A=B[0].toUpperCase();while(C.parentNode){if(C.tagName==A){return Element.extend(C)}C=C.parentNode}return null},getParentByClassName:function(){var A=$A(arguments),B=A.shift(),C=A[0];while(B.tagName!="HTML"){if(B.hasClassName(C)){return Element.extend(B)}B=$(B.parentNode)}return null},getParentByAttribute:function(){var A=$A(arguments),B=A.shift(),C=A[0];while(B.tagName!="HTML"){if(B.hasAttribute(C)){return Element.extend(B)}B=$(B.parentNode)}return null},toggleClasses:function(D,C){var A=$A(arguments),B=A.shift();if(Element.hasClassName(B,A[0])){Element.removeClassName(B,A[0]),Element.addClassName(B,A[1])}else{if(Element.hasClassName(B,A[1])){Element.removeClassName(B,A[1]),Element.addClassName(B,A[0])}}},visibleByClass:function(){var B=arguments[0];var A=true;if(B.hasClassName("noneTableRow")||B.hasClassName("noneTableRowGroup")||B.hasClassName("noneBlock")||B.hasClassName("noneInlineBlock")||B.hasClassName("noneInline")||B.hasClassName("hidden")||(B.style.display=="none")||(B.style.visibility=="hidden")){A=false}return A},hideByClass:function(){for(var B=0;B<arguments.length;B++){var A=$(arguments[B]);if(A.visibleByClass()){if(A.hasClassName("tableRow")){A.removeClassName("tableRow");A.addClassName("noneTableRow")}else{if(A.hasClassName("tableRowGroup")){A.removeClassName("tableRowGroup");A.addClassName("noneTableRowGroup")}else{if(A.hasClassName("block")){A.removeClassName("block");A.addClassName("noneBlock")}else{if(A.hasClassName("inlineBlock")){A.removeClassName("inlineBlock");A.addClassName("noneInlineBlock")}else{if(A.hasClassName("inline")){A.removeClassName("inline");A.addClassName("noneInline")}else{if(A.hasClassName("visible")){A.removeClassName("visible");A.addClassName("hidden")}else{log.error("hideByClass(): missing required class for "+A)}}}}}}}}if(arguments.length==1){return $(arguments[0])}},showByClass:function(){for(var B=0;B<arguments.length;B++){var A=$(arguments[B]);if(!A.visibleByClass()){if(A.hasClassName("noneTableRow")){A.removeClassName("noneTableRow");A.addClassName("tableRow")}else{if(A.hasClassName("noneTableRowGroup")){A.removeClassName("noneTableRowGroup");A.addClassName("tableRowGroup")}else{if(A.hasClassName("noneBlock")){A.removeClassName("noneBlock");A.addClassName("block")}else{if(A.hasClassName("noneInlineBlock")){A.removeClassName("noneInlineBlock");A.addClassName("inlineBlock")}else{if(A.hasClassName("noneInline")){A.removeClassName("noneInline");A.addClassName("inline")}else{if(A.hasClassName("hidden")){A.removeClassName("hidden");A.addClassName("visible")}else{log.error("showByClass(): missing required class for "+A)}}}}}}}}if(arguments.length==1){return $(arguments[0])}},toggleByClass:function(){for(var B=0;B<arguments.length;B++){var A=$(arguments[B]);if(A.visibleByClass()){A.hideByClass()}else{A.showByClass()}}},getParams:function(){var result="null";var element=arguments[0];this.params=null;var attr=(arguments[1]||"params");if(typeof(element)=="object"&&element.getAttribute(attr)){var jsonRaw=element.getAttribute(attr);var convertedString=jsonRaw.unescapeJSON();try{result=eval("({"+convertedString+"})")}catch(error){Errors.capture(error,"Error converting attributes to json object  ["+convertedString+"]")}return result}},getAgents:function(){var A,D;var C=arguments[0];this.params=null;if(typeof(C)=="object"){D=C.getAttribute("data-agent")}if(D){var E="["+D.unescapeJSON()+"]";try{A=E.evalJSON()}catch(B){Errors.capture(B,"Error converting attributes to json object "+E)}return A}},getPosition:function(){var B=$(arguments[0]);var A=B.cumulativeOffset();var C=B.cumulativeScrollOffset();return{x:A[0]-C[0],y:A[1]-C[1],units:"px"}},getPositionOffset:function(A){return Position.delta(arguments[0],arguments[1])},destroy:function(){var A=$(arguments[0]);if(A){if(A.innerHTML){A.innerHTML=""}if(A.parentNode){A.parentNode.removeChild(A)}else{log.warning("Element.destroy(): no parent node - element not in DOM?")}}return null},updateAndFocus:function(B){log.debug("updateAndFocus - updating");var C=arguments[0];var E=arguments[1]?arguments[1]:1000;if(C){var A=function(){if(this&&this.parentNode&&(this.parentNode.nodeType===1)){log.debug("updateAndFocus - setting focus: "+this);this.focus()}else{log.warning("Element.updateAndFocus(): attempting to focus on a node that is not nodeType 1 (ELEMENT_NODE).Target of focus was probably removed from the document during the delay")}}.bind(C);if(window.virtualBufferManager){window.virtualBufferManager.update();clearTimeout(window.virtualBufferManager.timeout)}else{log.error("Element.updateAndFocus(): virtualBufferManager does not exist!")}var D=setTimeout(A,E);if(window.virtualBufferManager){window.virtualBufferManager.timeout=D}return D}else{log.error("Element.updateAndFocus must have an element to operate on!")}},isDOMReady:function(){var A=function(B){if(B.nextSibling){return true}else{if(B.nodeName=="HTML"){return false}else{return A(B.parentNode)}}};if(Page.isDOMReady){return true}else{return A(arguments[0])}},rendered:function(){var A=arguments[0];if(A.getStyle("display")=="none"){return false}else{if(A.tagName=="HTML"){return true}else{return A.up().rendered()}}},cumulativeOffset:function(C){var B=0,D=0;do{if(Element.getStyle(C,"position")=="fixed"){var A=Position.calculateScroll();B+=A.y+C.offsetTop;D+=A.x+C.offsetLeft;C=null}else{B+=C.offsetTop||0;D+=C.offsetLeft||0;C=$(C.offsetParent)}}while(C);return Element._returnOffset(D,B)}});String.prototype.unescapeJSON=function(){var A=this.toString();A=A.replace(/!#/,"{");A=A.replace(/#!/,"}");return A};String.prototype.escapeRegex=function(){return this.toString().replace(/([\[|\\|\^|\$|\.|\||\?|\*|\+|\(|\)])/gm,"\\$1")};Form.HiddenField={add:function(C,B,D){var A=document.createElement("INPUT");A.setAttribute("name",B);A.setAttribute("type","hidden");A.setAttribute("value",D);log.debug("adding hidden field:"+B+":"+D);C.appendChild(A)}};Form.Element.resetValue=function(C){var B=C.getElementsByTagName("select")[0];if(B){B.selectedIndex=0}var D=C.getElementsByTagName("input");if(D){for(var A=0;D[A];A++){switch(D[A].type){case"radio":case"checkbox":D[A].checked=false;break;case"text":case"password":D[A].value="";break}}}};Object.extend(String.prototype,{stripNoScripts:function(){return this.replace(new RegExp("(?:<noscript.*?>)((\n|\r|.)*?)(?:</noscript>)","img"),"")},upperCaseFirst:function(){var A=this.substr(0,1).toUpperCase();return this.substr(0,1).toUpperCase()+this.substr(1,this.length)}});Object.extend(Event,{onDOMReady:function onDOMReady(f){if(!onDOMReady._readyCallbacks){var domReady=(function(){if(onDOMReady.done){return}onDOMReady.done=true;if(onDOMReady._timer){clearInterval(onDOMReady._timer)}onDOMReady._readyCallbacks.each(function(f){f()});onDOMReady._readyCallbacks=null}).bind(this);if(document.addEventListener){document.addEventListener("DOMContentLoaded",domReady,false);
/*@cc_on @*/
/*@if (@_win32)
				  document.write("<script id=__ie_onload defer src=/cacheable/empty.js><\/script>");
				  document.getElementById("__ie_onload").onreadystatechange = function() {
					if (this.readyState == "complete") domReady();
				  };
				  /*@end @*/
}if(/WebKit/i.test(navigator.userAgent)){onDOMReady._timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){domReady()}},10)}Event.observe(window,"load",domReady);onDOMReady._readyCallbacks=[]}if(onDOMReady.done){f()}else{onDOMReady._readyCallbacks.push(f)}}});var Units={PX_TO_EM:12,EM_TO_PX:1/12,TYPE:"px"};Position.putInViewport=function(E,I){var D=Position.calculateViewport();var G=Position.calculateScroll();var C=Position.calculatePageHeight();I.dim=I.getDimensions();I.pos=I.getPosition();E.pos=Position.cumulativeOffset(E);E.dim=E.getDimensions();E.pos=E.getPosition();var A=E.pos.x-I.dim.width;if(E.pos.x+E.dim.width+I.dim.width<=D.width||A<=0){A=E.dim.width+E.pos.x}var H=(parseInt(G.x)+D.width-(A+I.dim.width)>=0);if(Units.TYPE=="em"){A=A/Units.PX_TO_EM}I.setStyle({left:A+Units.TYPE});D=Position.calculateViewport();var F=E.pos.y+(E.dim.height/2);if(D.height<I.dim.height||parseInt(G.y)-F>=0){F=parseInt(G.y)}else{if(F+I.dim.height>=parseInt(G.y)+D.height){F=F-(F+I.dim.height-(parseInt(G.y)+D.height))}}var B=(parseInt(G.y)+D.height-(F+I.dim.height)>=0);if(Units.TYPE=="em"){F=F/Units.PX_TO_EM}I.setStyle({top:F+Units.TYPE});return{x:A,y:F,inViewport:(H&&B),units:Units.TYPE}};Position.delta=function(B,A){B.pos=B.getPosition();A.pos=A.getPosition();return{x:(A.pos.x-B.pos.x),y:(A.pos.y-B.pos.y),units:"px"}};Position.calculatePageHeight=function(){var A=0;if(document.documentElement.scrollHeight>document.documentElement.offsetHeight){A=document.documentElement.scrollHeight}else{A=document.documentElement.offsetHeight}return{height:A,units:"px"}};Position.calculateScroll=function(){var A=0,B=0;if(window.pageYOffset&&window.pageXOffset){A=window.pageYOffset;B=window.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollTop){A=document.documentElement.scrollTop;B=document.documentElement.scrollLeft}else{if(document.body){A=document.body.scrollTop;B=document.body.scrollLeft}}}return{x:B,y:A,units:"px"}};Position.calculateViewport=function(){var C=document.documentElement;var B=window.innerHeight;var A=window.innerWidth;if(B!=null&&C.clientHeight!=null){B=(C.clientHeight<B&&C.clientHeight>0)?C.clientHeight:B;A=(C.clientWidth<window.innerWidth&&C.clientWidth>0)?C.clientWidth:A}else{if(C&&C.clientHeight){B=C.clientHeight;A=C.clientWidth}else{if(document.body){B=document.body.clientHeight;A=document.body.clientWidth}}}return{height:B,width:A,units:"px"}};Ajax.Request.prototype.abort=function(){this.transport.onreadystatechange=Prototype.emptyFunction;this.transport.abort();Ajax.activeRequestCount--};Ajax.PartialRequest=function(B,A){try{var D=function(){var F=B.split("?")[1];var E=A.parameters;if(typeof E!="undefined"&&typeof F!="undefined"){throw new Error("Cannot resolve both parameters and queryString in Ajax.PartialRequest. Must choose either parameters or querystring.")}if(typeof E=="undefined"&&typeof F=="undefined"){return""}return E||F}();if(!D.match(/req=partial/)){var D=D.split("&");D.push("rep=partial");D=D.join("&")}A.parameters=D;return new Ajax.Request(B.split("?")[0],A)}catch(C){Errors.capture(C)}};Ajax.PartialPage=Class.create(Ajax.Request,{formControls:["input","select","textarea"],initialize:function($super,B,A){A=Object.clone(A);var C=A.onSuccess;A.onSuccess=(function(D){this.processResponse(D);if(this.json&&Object.isFunction(C)){C(D,this.json)}else{if(!this.json&&Object.isFunction(A.onFailure)){A.onFailure(D)}}}).bind(this);$super(B,A)},processResponse:function(A){this.json=this.evalJSONResponse(A);if(this.json){this.updatePageWithJSON()}},evalJSONResponse:function(A){var B;try{B=A.responseText.evalJSON()}catch(C){log.error("Ajax.PartialPage: Invalid JSON.");return false}return B},updatePageWithJSON:function(){Page.addModuleCSS(this.json.css);this.updateErrors();for(var D in this.json.modules){var F=$$("."+D+"Mod","div[data-placeholder="+D+"]");for(var C=0;C<F.length;C++){var B=F[C];var E=this.json.modules[D][C];if(E!==null){var A=new Element("div");A.innerHTML=E;var G=A.down();if(!G){log.error("Ajax.PartialPage: No content for module '"+D+"'.");return false}this.updateModule(B,G,D)}}}if(this.json.tracking){document.fire("content:update",{webtrends:this.json.tracking})}},updateErrors:function(){var A=$("pageErrors");A.replace(this.json.errors).purge()},updateModule:function(A,D,C){var B=$(document.activeElement);log.info("Ajax.PartialPage: replacing module: "+C);A.replace(D).purge();Page.initializeDOMFragment(D,true);this.preserveFocus(D,B)},preserveFocus:function(D,B){if(B!=document.activeElement&&!B.descendantOf(document.documentElement)&&B.name){var A=B.nodeName.toLowerCase();if(this.formControls.include(A)){var E=D.select(A+"[name="+B.name+"]");var C=E.length>1?E.find(function(F){return B.value==F.value}):E[0];if(C){C.focus();B=C;C.value=B.value}}}}});Ajax.StreamingPartialPage=Class.create(Ajax.PartialPage,{initialize:function($super,B,A){$super(B,A)},updateErrors:function(){}});Ajax.CachedPartialPage=Class.create(Ajax.StreamingPartialPage,{initialize:function($super,B,A){$super(B,A)},updateModule:function(A,C,B){if(C.hasClassName("cached")){log.info("Ajax.CachedPartialPage: caching module: "+B);this.cachedModules=this.cachedModules||{};this.cachedModules[B]=this.cachedModules[B]||$A();this.cachedModules[B].push({origEl:A,newEl:C})}else{this.replaceModule(A,C,B)}},replaceModule:function(A,D,C){var B=$(document.activeElement);log.info("Ajax.CachedPartialPage: replacing module: "+C);A.replace(D).purge();Page.initializeDOMFragment(D,true);this.preserveFocus(D,B)},updateCachedModules:function(){if(this.cachedModules){Object.keys(this.cachedModules).each(function(B){var A=this.cachedModules[B];A.each(function(C){this.replaceModule(C.origEl,C.newEl,B)},this)},this);this.cachedModules=null}}});Ajax.IncrementalPartialPage=Class.create(Ajax.PartialPage,{updateModule:function($super,A,C){if(C.hasClassName("incremental")){var B=new Element("div");B.innerHTML=C.innerHTML;A.insert(B);Page.initializeDOMFragment(B,true)}else{$super(A,C)}}});var ManagedEventObservers=Class.create();ManagedEventObservers.prototype={initialize:function(){this.observers=$A()},add:function(C,B,D,A){if(arguments.length>=3){C=$(C);A=A||false;Event.observe(C,B,D,A);this.observers.push([C,B,D,A])}else{throw new Error("ManagedEventObservers.add(): too few parameters")}},getFirstTriggerElement:function(){if(this.observers[0]){return this.observers[0][0]}else{return null}},remove:function(B){if($(B)){for(var A=0;A<this.observers.length;A++){if(this.observers[A][0]==B){Event.stopObserving.apply(this,this.observers[A]);this.observers[A][0]=null;this.observers.splice(A)}}}},clear:function(){for(var A=0;A<this.observers.length;A++){Event.stopObserving.apply(this,this.observers[A]);this.observers[A][0]=null}this.observers.clear();return null},isWatchingElement:function(C){var B=false;if($(C)){for(var A=0;A<this.observers.length;A++){if(this.observers[A][0]==C){B=true}}}return B}};var virtualBufferManager={initialize:function(){var A=document.createElement("input");A.type="hidden";A.name="virtualBufferHiddenField";A.value="0";this.hiddenField=document.body.appendChild(A);log.debug("virtualBufferManager initialized")},update:function(){if(this.hiddenField){if(this.hiddenField.value==="0"){this.hiddenField.value="1"}else{this.hiddenField.value="0"}log.debug("virtualBufferManager.update: "+this.hiddenField.value)}else{log.error("virtualBufferManager has not been initialized, it should have been")}}};Event.onDOMReady(window.virtualBufferManager.initialize.bind(virtualBufferManager));String.prototype.parseColor=function(){var A="#";if(this.slice(0,4)=="rgb("){var C=this.slice(4,this.length-1).split(",");var B=0;do{A+=parseInt(C[B]).toColorPart()}while(++B<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var B=1;B<4;B++){A+=(this.charAt(B)+this.charAt(B)).toLowerCase()}}if(this.length==7){A=this.toLowerCase()}}}return(A.length==7?A:(arguments[0]||this))};Element.collectTextNodes=function(A){return $A($(A).childNodes).collect(function(B){return(B.nodeType==3?B.nodeValue:(B.hasChildNodes()?Element.collectTextNodes(B):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(A,B){return $A($(A).childNodes).collect(function(C){return(C.nodeType==3?C.nodeValue:((C.hasChildNodes()&&!Element.hasClassName(C,B))?Element.collectTextNodesIgnoreClass(C,B):""))}).flatten().join("")};Element.setContentZoom=function(A,B){A=$(A);A.setStyle({fontSize:(B/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return A};Element.getInlineOpacity=function(A){return $(A).style.opacity||""};Element.forceRerendering=function(A){try{A=$(A);var C=document.createTextNode(" ");A.appendChild(C);A.removeChild(C)}catch(B){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(A){return(-Math.cos(A*Math.PI)/2)+0.5},reverse:function(A){return 1-A},flicker:function(A){var A=((-Math.cos(A*Math.PI)/4)+0.75)+Math.random()/4;return A>1?1:A},wobble:function(A){return(-Math.cos(A*Math.PI*(9*A))/2)+0.5},pulse:function(B,A){return(-Math.cos((B*((A||5)-0.5)*2)*Math.PI)/2)+0.5},spring:function(A){return 1-(Math.cos(A*4.5*Math.PI)*Math.exp(-A*6))},none:function(A){return 0},full:function(A){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(A){var B="position:relative";if(Prototype.Browser.IE){B+=";zoom:1"}A=$(A);$A(A.childNodes).each(function(C){if(C.nodeType==3){C.nodeValue.toArray().each(function(D){A.insertBefore(new Element("span",{style:B}).update(D==" "?String.fromCharCode(160):D),C)});Element.remove(C)}})},multiple:function(B,C){var E;if(((typeof B=="object")||Object.isFunction(B))&&(B.length)){E=B}else{E=$(B).childNodes}var A=Object.extend({speed:0.1,delay:0},arguments[2]||{});var D=A.delay;$A(E).each(function(G,F){new C(G,Object.extend(A,{delay:F*A.speed+D}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(B,C,A){B=$(B);C=(C||"appear").toLowerCase();return Effect[Effect.PAIRS[C][B.visible()?1:0]](B,Object.extend({queue:{position:"end",scope:(B.id||"global"),limit:1}},A||{}))}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(A){this.effects._each(A)},add:function(B){var C=new Date().getTime();var A=Object.isString(B.options.queue)?B.options.queue:B.options.queue.position;switch(A){case"front":this.effects.findAll(function(D){return D.state=="idle"}).each(function(D){D.startOn+=B.finishOn;D.finishOn+=B.finishOn});break;case"with-last":C=this.effects.pluck("startOn").max()||C;break;case"end":C=this.effects.pluck("finishOn").max()||C;break}B.startOn+=C;B.finishOn+=C;if(!B.options.queue.limit||(this.effects.length<B.options.queue.limit)){this.effects.push(B)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(A){this.effects=this.effects.reject(function(B){return B==A});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var C=new Date().getTime();for(var B=0,A=this.effects.length;B<A;B++){this.effects[B]&&this.effects[B].loop(C)}}});Effect.Queues={instances:$H(),get:function(A){if(!Object.isString(A)){return A}return this.instances.get(A)||this.instances.set(A,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(A){if(A&&A.transition===false){A.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),A||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function B(D,C){if(D.options[C+"Internal"]){D.options[C+"Internal"](D)}if(D.options[C]){D.options[C](D)}}return function(C){if(this.state==="idle"){this.state="running";B(this,"beforeSetup");if(this.setup){this.setup()}B(this,"afterSetup")}if(this.state==="running"){C=(this.options.transition(C)*this.fromToDelta)+this.options.from;this.position=C;B(this,"beforeUpdate");if(this.update){this.update(C)}B(this,"afterUpdate")}}})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(C){if(C>=this.startOn){if(C>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var B=(C-this.startOn)/this.totalTime,A=(B*this.totalFrames).round();if(A>this.currentFrame){this.render(B);this.currentFrame=A}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(A){if(this.options[A+"Internal"]){this.options[A+"Internal"](this)}if(this.options[A]){this.options[A](this)}},inspect:function(){var A=$H();for(property in this){if(!Object.isFunction(this[property])){A.set(property,this[property])}}return"#<Effect:"+A.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(A){this.effects=A||[];this.start(arguments[1])},update:function(A){this.effects.invoke("render",A)},finish:function(A){this.effects.each(function(B){B.render(1);B.cancel();B.event("beforeFinish");if(B.finish){B.finish(A)}B.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(C,F,E){C=Object.isString(C)?$(C):C;var B=$A(arguments),D=B.last(),A=B.length==5?B[3]:null;this.method=Object.isFunction(D)?D.bind(C):Object.isFunction(C[D])?C[D].bind(C):function(G){C[D]=G};this.start(Object.extend({from:F,to:E},A||{}))},update:function(A){this.method(A)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var A=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(A)},update:function(A){this.element.setOpacity(A)}});Effect.Move=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(A)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(A){this.element.setStyle({left:(this.options.x*A+this.originalLeft).round()+"px",top:(this.options.y*A+this.originalTop).round()+"px"})}});Effect.MoveBy=function(B,A,C){return new Effect.Move(B,Object.extend({x:C,y:A},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(B,C){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:C},arguments[2]||{});this.start(A)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(B){this.originalStyle[B]=this.element.style[B]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var A=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(B){if(A.indexOf(B)>0){this.fontSize=parseFloat(A);this.fontSizeType=B}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(A){var B=(this.options.scaleFrom/100)+(this.factor*A);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*B+this.fontSizeType})}this.setDimensions(this.dims[0]*B,this.dims[1]*B)},finish:function(A){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(A,D){var E={};if(this.options.scaleX){E.width=D.round()+"px"}if(this.options.scaleY){E.height=A.round()+"px"}if(this.options.scaleFromCenter){var C=(A-this.dims[0])/2;var B=(D-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){E.top=this.originalTop-C+"px"}if(this.options.scaleX){E.left=this.originalLeft-B+"px"}}else{if(this.options.scaleY){E.top=-C+"px"}if(this.options.scaleX){E.left=-B+"px"}}}this.element.setStyle(E)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(A)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(A){return parseInt(this.options.startcolor.slice(A*2+1,A*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(A){return parseInt(this.options.endcolor.slice(A*2+1,A*2+3),16)-this._base[A]}.bind(this))},update:function(A){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(B,C,D){return B+((this._base[D]+(this._delta[D]*A)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(C){var B=arguments[1]||{},A=document.viewport.getScrollOffsets(),D=$(C).cumulativeOffset();if(B.offset){D[1]+=B.offset}return new Effect.Tween(null,A.top,D[1],B,function(E){scrollTo(A.left,E.round())})};Effect.Fade=function(C){C=$(C);var A=C.getInlineOpacity();var B=Object.extend({from:C.getOpacity()||1,to:0,afterFinishInternal:function(D){if(D.options.to!=0){return}D.element.hide().setStyle({opacity:A})}},arguments[1]||{});return new Effect.Opacity(C,B)};Effect.Appear=function(B){B=$(B);var A=Object.extend({from:(B.getStyle("display")=="none"?0:B.getOpacity()||0),to:1,afterFinishInternal:function(C){C.element.forceRerendering()},beforeSetup:function(C){C.element.setOpacity(C.options.from).show()}},arguments[1]||{});return new Effect.Opacity(B,A)};Effect.Puff=function(B){B=$(B);var A={opacity:B.getInlineOpacity(),position:B.getStyle("position"),top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};return new Effect.Parallel([new Effect.Scale(B,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(C){Position.absolutize(C.effects[0].element)},afterFinishInternal:function(C){C.effects[0].element.hide().setStyle(A)}},arguments[1]||{}))};Effect.BlindUp=function(A){A=$(A);A.makeClipping();return new Effect.Scale(A,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(B){B.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(B){B=$(B);var A=B.getDimensions();return new Effect.Scale(B,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:A.height,originalWidth:A.width},restoreAfterFinish:true,afterSetup:function(C){C.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(C){C.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(B){B=$(B);var A=B.getInlineOpacity();return new Effect.Appear(B,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(C){new Effect.Scale(C.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(D){D.element.makePositioned().makeClipping()},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned().setStyle({opacity:A})}})}},arguments[1]||{}))};Effect.DropOut=function(B){B=$(B);var A={top:B.getStyle("top"),left:B.getStyle("left"),opacity:B.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(B,{x:0,y:100,sync:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(C){C.effects[0].element.makePositioned()},afterFinishInternal:function(C){C.effects[0].element.hide().undoPositioned().setStyle(A)}},arguments[1]||{}))};Effect.Shake=function(D){D=$(D);var B=Object.extend({distance:20,duration:0.5},arguments[1]||{});var E=parseFloat(B.distance);var C=parseFloat(B.duration)/10;var A={top:D.getStyle("top"),left:D.getStyle("left")};return new Effect.Move(D,{x:E,y:0,duration:C,afterFinishInternal:function(F){new Effect.Move(F.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(G){new Effect.Move(G.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(H){new Effect.Move(H.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(I){new Effect.Move(I.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(J){new Effect.Move(J.element,{x:-E,y:0,duration:C,afterFinishInternal:function(K){K.element.undoPositioned().setStyle(A)}})}})}})}})}})}})};Effect.SlideDown=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""})}D.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"})},afterFinishInternal:function(D){D.element.undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A})}},arguments[1]||{}))};Effect.SlideUp=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""})}D.element.makeClipping().show()},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"})},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A})}},arguments[1]||{}))};Effect.Squish=function(A){return new Effect.Scale(A,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(B){B.element.makeClipping()},afterFinishInternal:function(B){B.element.hide().undoClipping()}})};Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:true,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:true,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A)}},B))}})};Effect.Shrink=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var F=C.getDimensions();var E,D;switch(B.direction){case"top-left":E=D=0;break;case"top-right":E=F.width;D=0;break;case"bottom-left":E=0;D=F.height;break;case"bottom-right":E=F.width;D=F.height;break;case"center":E=F.width/2;D=F.height/2;break}return new Effect.Parallel([new Effect.Opacity(C,{sync:true,to:0,from:1,transition:B.opacityTransition}),new Effect.Scale(C,window.opera?1:0,{sync:true,transition:B.scaleTransition,restoreAfterFinish:true}),new Effect.Move(C,{x:E,y:D,sync:true,transition:B.moveTransition})],Object.extend({beforeStartInternal:function(G){G.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(G){G.effects[0].element.hide().undoClipping().undoPositioned().setStyle(A)}},B))};Effect.Pulsate=function(C){C=$(C);var B=arguments[1]||{},A=C.getInlineOpacity(),E=B.transition||Effect.Transitions.linear,D=function(F){return 1-E((-Math.cos((F*(B.pulses||5)*2)*Math.PI)/2)+0.5)};return new Effect.Opacity(C,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(F){F.element.setStyle({opacity:A})}},B),{transition:D}))};Effect.Fold=function(B){B=$(B);var A={top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};B.makeClipping();return new Effect.Scale(B,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(C){new Effect.Scale(B,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(D){D.element.hide().undoClipping().setStyle(A)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(C){this.element=$(C);if(!this.element){throw (Effect._elementDoesNotExistError)}var A=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(A.style)){this.style=$H(A.style)}else{if(A.style.include(":")){this.style=A.style.parseStyle()}else{this.element.addClassName(A.style);this.style=$H(this.element.getStyles());this.element.removeClassName(A.style);var B=this.element.getStyles();this.style=this.style.reject(function(D){return D.value==B[D.key]});A.afterFinishInternal=function(D){D.element.addClassName(D.options.style);D.transforms.each(function(E){D.element.style[E.style]=""})}}}this.start(A)},setup:function(){function A(B){if(!B||["rgba(0, 0, 0, 0)","transparent"].include(B)){B="#ffffff"}B=B.parseColor();return $R(0,2).map(function(C){return parseInt(B.slice(C*2+1,C*2+3),16)})}this.transforms=this.style.map(function(G){var F=G[0],E=G[1],D=null;if(E.parseColor("#zzzzzz")!="#zzzzzz"){E=E.parseColor();D="color"}else{if(F=="opacity"){E=parseFloat(E);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(E)){var C=E.match(/^([\+\-]?[0-9\.]+)(.*)$/);E=parseFloat(C[1]);D=(C.length==3)?C[2]:null}}}var B=this.element.getStyle(F);return{style:F.camelize(),originalValue:D=="color"?A(B):parseFloat(B||0),targetValue:D=="color"?A(E):E,unit:D}}.bind(this)).reject(function(B){return((B.originalValue==B.targetValue)||(B.unit!="color"&&(isNaN(B.originalValue)||isNaN(B.targetValue))))})},update:function(A){var D={},B,C=this.transforms.length;while(C--){D[(B=this.transforms[C]).style]=B.unit=="color"?"#"+(Math.round(B.originalValue[0]+(B.targetValue[0]-B.originalValue[0])*A)).toColorPart()+(Math.round(B.originalValue[1]+(B.targetValue[1]-B.originalValue[1])*A)).toColorPart()+(Math.round(B.originalValue[2]+(B.targetValue[2]-B.originalValue[2])*A)).toColorPart():(B.originalValue+(B.targetValue-B.originalValue)*A).toFixed(3)+(B.unit===null?"":B.unit)}this.element.setStyle(D,true)}});Effect.Transform=Class.create({initialize:function(A){this.tracks=[];this.options=arguments[1]||{};this.addTracks(A)},addTracks:function(A){A.each(function(B){B=$H(B);var C=B.values().first();this.tracks.push($H({ids:B.keys().first(),effect:Effect.Morph,options:{style:C}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(A){var D=A.get("ids"),C=A.get("effect"),B=A.get("options");var E=[$(D)||$$(D)].flatten();return E.map(function(F){return new C(F,Object.extend({sync:true},B))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var B,A=$H();if(Prototype.Browser.WebKit){B=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';B=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(C){if(B[C]){A.set(C,B[C])}});if(Prototype.Browser.IE&&this.include("opacity")){A.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return A};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(B){var A=document.defaultView.getComputedStyle($(B),null);return Element.CSS_PROPERTIES.inject({},function(C,D){C[D]=A[D];return C})}}else{Element.getStyles=function(B){B=$(B);var A=B.currentStyle,C;C=Element.CSS_PROPERTIES.inject({},function(D,E){D[E]=A[E];return D});if(!C.opacity){C.opacity=B.getOpacity()}return C}}Effect.Methods={morph:function(A,B){A=$(A);new Effect.Morph(A,Object.extend({style:B},arguments[2]||{}));return A},visualEffect:function(C,E,B){C=$(C);var D=E.dasherize().camelize(),A=D.charAt(0).toUpperCase()+D.substring(1);new Effect[A](C,B);return C},highlight:function(B,A){B=$(B);new Effect.Highlight(B,A);return B}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(A){Effect.Methods[A]=function(C,B){C=$(C);Effect[A.charAt(0).toUpperCase()+A.substring(1)](C,B);return C}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(A){Effect.Methods[A]=Element[A]});Element.addMethods(Effect.Methods);if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(B,C,A){B=$(B);this.element=B;this.update=$(C);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(A)}else{this.options=A||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(D,E){if(!E.style.position||E.style.position=="absolute"){E.style.position="absolute";Position.clone(D,E,{setHeight:false,offsetTop:D.offsetHeight})}Effect.Appear(E,{duration:0.15})};this.options.onHide=this.options.onHide||function(D,E){new Effect.Fade(E,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(A){if(this.active){switch(A.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(A);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(A);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(A);return;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(A);return}}else{if(A.keyCode==Event.KEY_TAB||A.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&A.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(B){var A=Event.findElement(B,"LI");if(this.index!=A.autocompleteIndex){this.index=A.autocompleteIndex;this.render()}Event.stop(B)},onClick:function(B){var A=Event.findElement(B,"LI");this.index=A.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(A){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var A=0;A<this.entryCount;A++){this.index==A?Element.addClassName(this.getEntry(A),"selected"):Element.removeClassName(this.getEntry(A),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(A){return this.update.firstChild.childNodes[A]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(F){if(this.options.updateElement){this.options.updateElement(F);return}var D="";if(this.options.select){var A=$(F).select("."+this.options.select)||[];if(A.length>0){D=Element.collectTextNodes(A[0],this.options.select)}}else{D=Element.collectTextNodesIgnoreClass(F,"informal")}var C=this.getTokenBounds();if(C[0]!=-1){var E=this.element.value.substr(0,C[0]);var B=this.element.value.substr(C[0]).match(/^\s+/);if(B){E+=B[0]}this.element.value=E+D+this.element.value.substr(C[1])}else{this.element.value=D}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,F)}},updateChoices:function(C){if(!this.changed&&this.hasFocus){this.update.innerHTML=C;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;this.addObservers(B)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(A){Event.observe(A,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(A,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var A=this.getTokenBounds();return this.element.value.substring(A[0],A[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var E=this.element.value;if(E.strip().empty()){return[-1,0]}var F=arguments.callee.getFirstDifferencePos(E,this.oldElementValue);var H=(F==this.oldElementValue.length?1:0);var D=-1,C=E.length;var G;for(var B=0,A=this.options.tokens.length;B<A;++B){G=E.lastIndexOf(this.options.tokens[B],F+H-1);if(G>D){D=G}G=E.indexOf(this.options.tokens[B],F+H);if(-1!=G&&G<C){C=G}}return(this.tokenBounds=[D+1,C])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(C,A){var D=Math.min(C.length,A.length);for(var B=0;B<D;++B){if(C[B]!=A[B]){return B}}return D};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(C,D,B,A){this.baseInitialize(C,D,A);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=B},getUpdatedChoices:function(){this.startIndicator();var A=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,A):A;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(A){this.updateChoices(A.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(B,D,C,A){this.baseInitialize(B,D,A);this.options.array=C},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(A){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(B){var D=[];var C=[];var H=B.getToken();var G=0;for(var E=0;E<B.options.array.length&&D.length<B.options.choices;E++){var F=B.options.array[E];var I=B.options.ignoreCase?F.toLowerCase().indexOf(H.toLowerCase()):F.indexOf(H);while(I!=-1){if(I==0&&F.length!=H.length){D.push("<li><strong>"+F.substr(0,H.length)+"</strong>"+F.substr(H.length)+"</li>");break}else{if(H.length>=B.options.partialChars&&B.options.partialSearch&&I!=-1){if(B.options.fullSearch||/\s/.test(F.substr(I-1,1))){C.push("<li>"+F.substr(0,I)+"<strong>"+F.substr(I,H.length)+"</strong>"+F.substr(I+H.length)+"</li>");break}}}I=B.options.ignoreCase?F.toLowerCase().indexOf(H.toLowerCase(),I+1):F.indexOf(H,I+1)}}if(C.length){D=D.concat(C.slice(0,B.options.choices-D.length))}return"<ul>"+D.join("")+"</ul>"}},A||{})}});Field.scrollFreeActivate=function(A){setTimeout(function(){Field.activate(A)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(C,B,A){this.url=B;this.element=C=$(C);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(A);Object.extend(this.options,A||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(A){if(!this._editing||A.ctrlKey||A.altKey||A.shiftKey){return}if(Event.KEY_ESC==A.keyCode){this.handleFormCancellation(A)}else{if(Event.KEY_RETURN==A.keyCode){this.handleFormSubmission(A)}}},createControl:function(G,C,B){var E=this.options[G+"Control"];var F=this.options[G+"Text"];if("button"==E){var A=document.createElement("input");A.type="submit";A.value=F;A.className="editor_"+G+"_button";if("cancel"==G){A.onclick=this._boundCancelHandler}this._form.appendChild(A);this._controls[G]=A}else{if("link"==E){var D=document.createElement("a");D.href="#";D.appendChild(document.createTextNode(F));D.onclick="cancel"==G?this._boundCancelHandler:this._boundSubmitHandler;D.className="editor_"+G+"_link";if(B){D.className+=" "+B}this._form.appendChild(D);this._controls[G]=D}}},createEditField:function(){var C=(this.options.loadTextURL?this.options.loadingText:this.getText());var B;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){B=document.createElement("input");B.type="text";var A=this.options.size||this.options.cols||0;if(0<A){B.size=A}}else{B=document.createElement("textarea");B.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);B.cols=this.options.cols||40}B.name=this.options.paramName;B.value=C;B.className="editor_field";if(this.options.submitOnBlur){B.onblur=this._boundSubmitHandler}this._controls.editor=B;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var B=this;function A(D,E){var C=B.options["text"+D+"Controls"];if(!C||E===false){return}B._form.appendChild(document.createTextNode(C))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}A("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);A("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");A("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(A){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(A){Event.stop(A)}},enterHover:function(A){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML.unescapeHTML()},handleAJAXFailure:function(A){this.triggerCallback("onFailure",A);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(A){this.wrapUp();if(A){Event.stop(A)}},handleFormSubmission:function(D){var B=this._form;var C=$F(this._controls.editor);this.prepareSubmission();var E=this.options.callback(B,C)||"";if(Object.isString(E)){E=E.toQueryParams()}E.editorId=this.element.id;if(this.options.htmlResponse){var A=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(A,{parameters:E,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,A)}else{var A=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(A,{parameters:E,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,A)}if(D){Event.stop(D)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(A){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var A=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(A,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(C){this._form.removeClassName(this.options.loadingClassName);var B=C.responseText;if(this.options.stripLoadedTextTags){B=B.stripTags()}this._controls.editor.value=B;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,A)},postProcessEditField:function(){var A=this.options.fieldPostCreation;if(A){$(this._controls.editor)["focus"==A?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(A){Object.extend(this.options,A)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var A;$H(Ajax.InPlaceEditor.Listeners).each(function(B){A=this[B.value].bind(this);this._listeners[B.key]=A;if(!this.options.externalControlOnly){this.element.observe(B.key,A)}if(this.options.externalControl){this.options.externalControl.observe(B.key,A)}}.bind(this))},removeForm:function(){if(!this._form){return}this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(B,A){if("function"==typeof this.options[B]){this.options[B](this,A)}},unregisterListeners:function(){$H(this._listeners).each(function(A){if(!this.options.externalControlOnly){this.element.stopObserving(A.key,A.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(A.key,A.value)}}.bind(this))},wrapUp:function(A){this.leaveEditMode();this._boundComplete(A,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,C,B,A){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(C,B,A)},createEditField:function(){var A=document.createElement("select");A.name=this.options.paramName;A.size=1;this._controls.editor=A;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw ("Server returned an invalid collection representation.")}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(B){this._controls.editor.disabled=true;var A=this._controls.editor.firstChild;if(!A){A=document.createElement("option");A.value="";this._controls.editor.appendChild(A);A.selected=true}A.update((B||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var A=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(A,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(B){this._text=B.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,A)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(D){return 2===D.length?D:[D,D].flatten()});var B=("value" in this.options)?this.options.value:this._text;var A=this._collection.any(function(D){return D[0]==B}.bind(this));this._controls.editor.update("");var C;this._collection.each(function(E,D){C=document.createElement("option");C.value=E[0];C.selected=A?E[0]==B:0==D;C.appendChild(document.createTextNode(E[1]));this._controls.editor.appendChild(C)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(A){if(!A){return}function B(C,D){if(C in A||D===undefined){return}A[C]=D}B("cancelControl",(A.cancelLink?"link":(A.cancelButton?"button":A.cancelLink==A.cancelButton==false?false:undefined)));B("okControl",(A.okLink?"link":(A.okButton?"button":A.okLink==A.okButton==false?false:undefined)));B("highlightColor",A.highlightcolor);B("highlightEndColor",A.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(A){return Form.serialize(A)},onComplete:function(B,A){new Effect.Highlight(A,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(A){A.element.style.backgroundColor=A.options.highlightColor;if(A._effect){A._effect.cancel()}},onFailure:function(B,A){alert("Error communication with the server: "+B.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(A){A._effect=new Effect.Highlight(A.element,{startcolor:A.options.highlightColor,endcolor:A.options.highlightEndColor,restorecolor:A._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(B,A,C){this.delay=A||0.5;this.element=$(B);this.callback=C;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(A){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});Object.extend(Autocompleter.Base.prototype,{markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}}});Object.extend(Ajax.Autocompleter.prototype,{initialize:function(C,D,B,A){this.baseInitialize(C,D,A);this.options.asynchronous=true;this.options.onShow=this.onShow.bind(this);this.options.onSuccess=this.onSuccess.bind(this);this.options.onFailure=this.onFailure.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=B},onShow:function(B,C){if(!C.style.position||C.style.position=="absolute"){C.style.position="relative";var A=(this.options.cloneWidth==false)?false:true;Element.clonePosition(B,C,{setHeight:false,setWidth:A,offsetTop:B.offsetHeight});C.style.position="absolute";C.hide()}Effect.Appear(C,{duration:0.15})},onSuccess:function(A){this.updateChoices(A.responseText)},onFailure:function(A){log.error("Ajax.Autocompleter: request failed")},getUpdatedChoices:function(){this.startIndicator();var A=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,A):A;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}if(this.request&&(this.request.transport.readyState!=4)){this.request.abort()}this.request=new Ajax.Request(this.url,this.options)}});Ajax.AutocompleterJSON=Class.create(Ajax.Autocompleter,{onSuccess:function(E){try{var C=E.responseText.evalJSON(true);if(C.length>0){this.results=C}}catch(G){log.error("Ajax.Autocompleter: invalid response")}var A=new Element("div");var F=new Element("ul");A.appendChild(F);for(var B=0;B<C.length;B++){var D=new Element("li").update(C[B].suggestion);if(B%2==0){D.setAttribute("class","odd")}else{D.setAttribute("class","even")}F.appendChild(D)}if(this.options.transformResponse){F=this.options.transformResponse(F)}this.updateChoices(A.innerHTML)}});Effect.Transitions.easeFrom=function(A){return Math.pow(A,0.5)};Effect.Transitions.easeTo=function(A){return Math.pow(A,0.2)};Abstract.Agent=Class.create();Abstract.Agent.prototype={initialize:function(B,C){if(typeof(B)=="object"){try{Profiler.start(C.type);log.debug(C.type+".initialize() *");if(!C.params){C.params={}}Object.extend(this,C);this.element=$(B);this.initExtend(B,this.params);Profiler.stop(C.type)}catch(A){Errors.capture(A,"Initialization failure : "+C.type,"Source element : "+B)}}},initializeChildren:function(){var self=this;this.childAgents=[];Page.childAgents[self.type].each(function(child,index){eval("new "+child.agent.type+"(child.element,self)");Page.childAgents[self.type][index]=null});Page.childAgents[self.type]=Page.childAgents[self.type].compact()},initExtend:function(){}};Abstract.ChildAgent=Class.create();Abstract.ChildAgent.prototype={initialize:function(B,C){if(typeof(B)=="object"){try{this.parent=C;this.element=Element.extend(B);this.agent=this.element.getAgents()[0];Object.extend(this,this.agent);if(!this.params){this.params={}}Profiler.start(this.type);log.debug("child agent: "+this.agent.type+".initialize() *");this.initExtend.apply(this,arguments);C.childAgents.push(this);Profiler.stop(this.type)}catch(A){Errors.capture(A,"Initialization failure : "+this.agent.type,"Source element : "+B)}}},initExtend:function(){}};var Page={debug:false,prevNumTags:0,isDOMReady:false,onLoadFired:false,initializationComplete:false,initInterval:100,childAgents:[],hideRevealRadios:[],deferredAdverts:{ads:[],newAd:function(A){this.ads.push(A)},busy:false,populate:function(){if(Page.onLoadFired&&Page.initializationComplete){if(!this.busy){this.busy=true;var A=function(){var B=new Date();log.info("populating: "+this.ads.length+" deferred Adverts");while(this.ads.length>0){this.ads.pop().populate(B)}this.busy=false}.bind(this);window.setTimeout(A,0)}}}},init:function(){if(window.clientPerf){window.clientPerf.timestamp("jsRecd")}Profiler.start("Combined: Loading DOM + init");this.deferredAgents=[];this.domReadyAgents=[];this.processedElements=[];var C=function(){if(!this.isDOMReady){try{this.initPage()}catch(D){var E="beforeDOMReady init: "+D.name+": "+D.message;if(D.lineNumber){E+="; line "+D.lineNumber}log.error(E)}window.setTimeout(C.bind(this),this.initInterval)}};var A=function(){try{this.initPage(true)}catch(D){var E="onDOMReady init: "+D.name+": "+D.message;if(D.lineNumber){E+="; line "+D.lineNumber}log.error(E)}Profiler.stop("Combined: Loading DOM + init")};var B=function(){if(window.clientPerf){window.clientPerf.timestamp("domReady")}this.isDOMReady=true;log.info("DOM Ready");setTimeout(A.bind(this),0)};Event.onDOMReady(B.bind(this));C.call(this)},initAgent:function(B,C){try{var A=new (this.locateAgentClass(C.type))(B,C);var E=B.retrieve("_agents");if(E){E.push(A)}else{E=[A]}B.store("_agents",E)}catch(D){log.error("Error trying to instantiate agent of type "+C.type+". Error: \n\n"+D)}},initializeAjaxResponse:function(A){var B=$(document.createElement("DIV"));B.innerHTML=A;Page.initializeDOMFragment(B)},locateAgentClass:function(E){try{var B=E.split(".");var C=window;for(var A=0;A<B.length;A++){C=C[B[A]]}}catch(D){return}return C},initPage:function(J){Profiler.start("Page.init");if(!this.pageInitNum){this.pageInitNum=1}else{this.pageInitNum++}var O=0;var H=0;var P=document.getElementsByTagName("*");var G=P.length;if(G>this.prevNumTags||J){this.prevNumTags=G;var B=[];for(var F=0;F<G;F++){var Q=P[F];if(Q.getAttribute("data-agent")){if(this.processedElements.indexOf(Q)==-1&&$(Q).isDOMReady()){B.push(Q)}}}var L=B.length;for(var F=0;F<L;F++){var E=B[F];var A=E.getAgents();if(A){if(window.clientPerf&&window.clientPerf.agentsNotStarted){window.clientPerf.timestamp("agentsStart")}var M=A.length;for(var D=0;D<M;D++){var C=A[D];var I=this.locateAgentClass(C.type);if(!Object.isString(C.type)){log.error("Agent type is not a string for "+E.inspect().escapeHTML()+". Missing quotes in SystemText popup?")}else{if(!I){log.error("Agent '"+C.type+"' does not exist. Element: "+E.inspect().escapeHTML())}else{var K=I.prototype.beforeDOMReady;if(C.deferred=="true"){H++;this.deferredAgents.push({element:E,agent:C})}else{if(C.childOf){H++;if(!this.childAgents[C.childOf]){this.childAgents[C.childOf]=[]}this.childAgents[C.childOf].push({element:E,agent:C})}else{if(!K&&C.lazy!="true"){H++;this.domReadyAgents.push({element:E,agent:C})}else{if(C.lazy!="true"){O++;this.initAgent(E,C)}}}}}}}}else{log.error("Could not retrieve agents for "+E.inspect().escapeHTML())}}this.processedElements=this.processedElements.concat(B);if(J){this.pageInitNum=this.pageInitNum.toString()+" [final DOMReady initPage]"}log.info("Page.initPage() run: "+this.pageInitNum);if(J){if(window.clientPerf&&window.clientPerf.agentsNotStarted){window.clientPerf.timestamp("agentsStart")}for(var F=0;F<this.domReadyAgents.length;F++){this.initAgent(this.domReadyAgents[F].element,this.domReadyAgents[F].agent)}for(var F=0;F<this.deferredAgents.length;F++){this.initAgent(this.deferredAgents[F].element,this.deferredAgents[F].agent)}this.initializationComplete=true;if(window.clientPerf){window.clientPerf.timestamp("agentsFinish")}delete this.deferredAgents;delete this.domReadyAgents;delete this.processedElements;delete this.initInterval;this.deferredAdverts.populate();window.setTimeout((function(){if(this.onLoadFired){document.fire("page:complete")}else{Event.observe(window,"load",function(){window.setTimeout(function(){document.fire("page:complete")},0)})}}).bind(this),0)}}else{log.info("Page.initPage() run: "+this.pageInitNum+" [no new elements]")}Profiler.stop("Page.init")},initializeDOMFragment:function(F,K){Profiler.start("DOMFragment.init");F=Element.extend(F);var H=F.getElementsByAttribute("data-agent");if(K&&F.getAttribute("data-agent")){H.unshift(F)}var B=[];var J=$A();for(var G=0;H[G];G++){var L=H[G];var A=L.getAgents();for(var E=0;A[E];E++){var D=A[E];var I=this.locateAgentClass(D.type);if(!Object.isString(D.type)){log.error("Agent type is not a string for "+L.inspect().escapeHTML()+". Missing quotes in SystemText popup?")}else{if(!I){log.error("Agent '"+D.type+"' does not exist. Element: "+L.inspect().escapeHTML())}else{if(D.deferred=="true"){B.push({element:L,agent:D})}else{if(D.childOf!=""&&D.childOf!=undefined){if(this.childAgents[D.childOf]==null){this.childAgents[D.childOf]=[]}this.childAgents[D.childOf].push({element:L,agent:D})}else{if(D.lazy!="true"){this.initAgent(L,D)}}}}}}}for(var C=0;B[C];C++){this.initAgent(B[C].element,B[C].agent)}Page.deferredAdverts.populate();Profiler.stop("DOMFragment.init")},initializeLazyAgents:function(C){var A,D,E,B;B=C.getElementsByAttribute("data-agent");B.each(function(F){E=F.getAgents();if(E){E.each(function(G){if(G.lazy==="true"){this.initAgent(F,G)}}.bind(this))}}.bind(this))}};Event.observe(window,"load",function(){Page.onLoadFired=true;Page.deferredAdverts.populate()});var Profiler={items:{},start:function(A){this.items[A]=new Object();this.items[A].startTime=new Date()},stop:function(A){if(this.items[A]){this.items[A].endTime=new Date();this.log(A)}else{log.warning("No profiler of label: "+A+" was found")}},log:function(A){this.items[A].elapsedTime=((this.items[A].endTime-this.items[A].startTime)/1000);if(this.items[A].elapsedTime==undefined){this.items[A].elapsedTime=0}var B=(A+" elapsedTime: "+this.items[A].elapsedTime+" secs");if(this.items[A].elapsedTime>=0.1){log.warning(B)}else{log.debug(B)}},toString:function(){var A=["latency profile"];for(props in this.items){A.push(props+":"+Profiler.items[props].elapsedTime)}return A.join(",\n")}};var log=new function(){this.debug=function(){};this.info=function(){};this.warning=function(){};this.error=function(){}};var Errors={list:[],capture:function(B){var A=$A(arguments),E=A.shift();var F=["name","message","description","number","fileName","sourceURL","lineNumber","line"];var D=A;for(var C=0;C<F.length;C++){if(E[F[C]]!==undefined){D.push(F[C]+":"+E[F[C]])}}if(B.message&&B.message=="Object doesn't support this property or method"){log.error("If IE only, this error often means that you are trying to use prototype.js Element extensions (eg: .getElementByClassName) on a non-extended element")}this.list.push(D);log.error(""+D.join(",\n"))},toString:function(){if(this.list.length>0){var B=["JavaScript Error"];for(var A=0;A<this.list.length;A++){B.push(this.list[A])}return B.join("")}}};var Inspector={unpack:function(A){result=[];for(prop in A){result.push(prop+":"+A[prop])}return result.join("\n")}};var report=function(A){window.open("","report").document.write("<pre>"+A+"</pre>")};String.prototype.deleteQueryStringParam=function(D,A){var C=new RegExp("^&|&$","g");var B=new RegExp("&&","g");String.prototype.deleteQueryStringParam=function(H,F){var E=H+(F===true?"[^&]*":"=[^&]*");var G=new RegExp(E,"g");return this.replace(G,"").replace(B,"&").replace(C,"")};return this.deleteQueryStringParam(D,A)};var $QS=QueryString=function(A){A=A.replace(/&amp;/g,"&");var B=A.split("&");return{addParam:function(E){for(var D=0,C=arguments.length;D<C;D++){B.push(arguments[D])}B=B.uniq();return this},removeParam:function(E){for(var D=0,C=arguments.length;D<C;D++){B=B.without(arguments[D])}return this},toString:function(){return B.join("&")}}};(function(){var A={hashRegex:/^#/,ieHashPrefix:"/",ieHashPrefixRegex:/^\//,init:function(){this.lastHash="";var D=Prototype.Browser.IE&&(!document.documentMode||document.documentMode<8);if(D){var C=window.location.hash.replace(this.hashRegex,"");this.iframe=$(document.createElement("iframe"));this.iframe.src="javascript:false";this.iframe.addClassName("noneBlock");document.body.insertBefore(this.iframe,$("bodyWrapper"));this.iframe=this.iframe.contentWindow;if(C.search(this.ieHashPrefixRegex)==-1){C=this.ieHashPrefix+C;window.location.replace("#"+C)}this.updateIFrame(C);document.observe("click",(function(G){var F=G.findElement("a");if(F){if(F.href.split("#")[0]==window.location.href.split("#")[0]){var H=F.href.split("#")[1];var E=$(H);if(E&&!E.rendered()){G.preventDefault();window.location.href=F.href.replace("#","#"+this.ieHashPrefix)}}}}).bindAsEventListener(this))}if("onhashchange" in window&&!D){Event.observe(window,"hashchange",this.observeHash.bindAsEventListener(this))}else{window.setInterval(this.observeHash.bindAsEventListener(this),100)}document.observe("hash:check",(function(){document.fire("hash:change",{hash:this.iframe?this.lastHash.replace(this.ieHashPrefixRegex,""):this.lastHash})}).bindAsEventListener(this));this.observeHash(true)},observeHash:function(D){var E=window.location.hash.replace(this.hashRegex,"");if(this.iframe){var C=this.iframe.document.location.hash.replace(this.hashRegex,"");if(E!==this.lastHash){if(E.search(this.ieHashPrefixRegex)==-1){E=this.ieHashPrefix+E;window.location.replace("#"+E)}if(E!==C){this.updateIFrame(E)}}else{if(C!==this.lastHash){window.location.href=window.location.href.split("#")[0]+"#"+C}}}if(E!==this.lastHash||D){if(!this.iframe&&E.search(this.ieHashPrefixRegex)!=-1){E=E.replace(this.ieHashPrefixRegex,"");window.location.replace("#"+E)}this.lastHash=E;document.fire("hash:change",{hash:this.iframe?E.replace(this.ieHashPrefixRegex,""):E})}},updateIFrame:function(C){this.iframe.document.open().close();this.iframe.document.location.hash="#"+C}};document.observe("hash:check",function B(){document.stopObserving("hash:check",B);A.init.call(A)})})();(function(){var B={};this.processTemplate=function A(E,D){var C=!/\W/.test(E)?B[E]=B[E]||A(document.getElementById(E).innerHTML.split("\\").join("\\\\")):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+E.replace(/[\r\t\n]/g," ").replace(/'(?=[^~]*~>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<~=(.*?)~>/g,"',$1,'").split("<~").join("');").split("~>").join("p.push('")+"');}return p.join('');");return D?C(D):C}})();var Persist=(function(){var C=function(E){return JSON.stringify(E)},A=function(E){return JSON.parse(E)},D=(function(){try{return !!localStorage.getItem}catch(E){return false}})(),B=(function(){try{return !!sessionStorage.getItem}catch(E){return false}})();return{get:function(E,F){if(window.JSON){if(F&&D){return A(localStorage.getItem(E))}else{if(B){return A(sessionStorage.getItem(E))}}}else{return null}},set:function(E,F,G){if(window.JSON){if(G&&D){localStorage.setItem(E,C(F))}else{if(B){sessionStorage.setItem(E,C(F))}}}},remove:function(E,F){if(F&&D){localStorage.removeItem(E)}else{if(B){sessionStorage.removeItem(E)}}},clear:function(E){if(E&&D){localStorage.clear()}else{if(B){sessionStorage.clear()}}}}})();var DateUtils=(function(){return{formatDateAsString:function(C,F){if(C instanceof Date&&F.length>0){var H=$A();F.gsub(/[^a-z0-9]+|[a-z0-9]+/,function(I){H.push(I[0])});for(var D=0,A=H.length;D<A;D++){if(H[D].indexOf("y")!=-1){var E=C.getFullYear()+"";while(E.length>H[D].length){E=E.substr(1)}H[D]=E}else{if(H[D].indexOf("m")!=-1){var G=C.getMonth()+1+"";if(G.length!=2){G="0"+G}H[D]=G}else{if(H[D].indexOf("d")!=-1){var B=C.getDate()+"";if(B.length!=2){B="0"+B}H[D]=B}}}}return H.join("")}}}})();var Persistent={initPersistence:function(A){if(!A){return}this.persistenceId=A;this.persistenceStores={session:this.initPersistenceStore(),local:this.initPersistenceStore()}},initPersistenceStore:function(B){var A=null;if(this.persistenceId){A=Persist.get(this.persistenceId,B)}return(A===null)?{}:A},setPersistent:function(B,D,C){var A;if(this.persistenceId){A=C?this.persistenceStores.local:this.persistenceStores.session;A[B]=D;Persist.set(this.persistenceId,A,C)}},getPersistent:function(C,D){var B,A=null;if(this.persistenceId){B=Persist.get(this.persistenceId,D);if(B!==null){if(D){this.persistenceStores.local=B}else{this.persistenceStores.session=B}A=(B[C]!==undefined)?B[C]:null}}return A}};(function(){var D=2;var A=[],C=document.getElementsByTagName("head")[0];var B=function(){if(!A.length){return}var E=A.shift();var F=document.createElement("script");F.type="text/javascript";if(F.readyState){F.onreadystatechange=function(){if(F.readyState=="loaded"||F.readyState=="complete"){F.onreadystatechange=null;if(E.callback){E.callback()}B()}}}else{F.onload=function(){F.onload=null;if(E.callback){E.callback()}B()}}F.src=E.url;C.appendChild(F)};document.observe("page:complete",function(){A.sort(function(H,G){return H.priority-G.priority});var E=A.length;for(var F=0;F<E&&F<D;F++){B()}});Page.queue=function(E,F,G){F=window.parseFloat(F);if(!E||!window.isFinite(F)||F>1||F<0){log.error("Page.queue: Invalid argument");return}if(window.location.protocol=="https:"&&E.indexOf("http:")==0){log.error("Page.queue: Invalid protocol on secure page");return}A.push({callback:G,priority:F,url:E})}})();document.observe("dom:loaded",function(){var A={},B;(function(){var G=$$("style[data-module]");if(G.length){B=G[0];for(var E=0;E<G.length;E++){var D=G[E].readAttribute("data-module").strip().split(/\s+/);for(var C=0,F=D.length;C<F;C++){A[D[C]]=true}}}else{B=new Element("style",{"data-module":""});document.getElementsByTagName("head")[0].appendChild(B)}})();Page.addModuleCSS=function(F){var D="";var E=[];for(var C in F){if(!A[C]){E.push(C);A[C]=true;D+=F[C]}}D=D.strip();if(D){if(B.styleSheet&&B.styleSheet.cssText){B.styleSheet.cssText+=D}else{B.appendChild(document.createTextNode(D))}}if(E.length){E=B.readAttribute("data-module").strip().split(/\s+/).concat(E);B.writeAttribute("data-module",E.join(" "))}}});(function(G,H){var B,F,I,C;var E=function(O){var L,K;if(Object.isString(O)){K=O}else{L=O.content;K=O.url}if(!C){B=new Element("div",{id:"lightbox","class":I?"modal":"",role:I?"alertdialog":"dialog",tabindex:-1});G.body.appendChild(B).store("focus",G.activeElement);$(G.documentElement).addClassName("lb-active")}if(K){A(K)}else{D(L)}if(!I){(function(){if(B){B.on("click",function(P){if(this!=P.element()){return}G.fire("lightbox:close")})}}).delay(1);G.observe("keyup",function M(P){if(P.keyCode!=Event.KEY_ESC){return}G.stopObserving("keyup",M);G.fire("lightbox:close")})}G.observe("modal:close",J);G.observe("lightbox:close",J)};var A=function(K){var M,L;new Ajax.Request(K,{onSuccess:function(O){H.clearTimeout(L);if(M){M=null}D(O.responseText)},onFailure:function(){log.error("Lightbox: Request failed.");J()}});if(!C){M=new ProgressIndicator(B)}};var D=function(K){F=(new Element("div",{id:"lightbox-content"})).update(K);if(!C){F.setOpacity(0)}if(I){B.update((new Element("div",{id:"lightbox-center"})).update(F))}else{B.update(F)}Page.initializeDOMFragment(B);B.focus();if(!C){H.setTimeout(function(){F.setOpacity(1)},0)}};var J=function(){if(!B){return}var K=B.retrieve("focus");B.remove().purge();G.documentElement.removeClassName("lb-active");K.focus();G.stopObserving("lightbox:close",J);G.stopObserving("modal:close",J);I=C=B=F=null};G.observe("lightbox:open",function(K){I=false;C=!!B;E(K.memo)});G.observe("modal:open",function(K){I=true;C=!!B;E(K.memo)});Event.on(G,"click","a[rel~=lightbox]",function(L,K){I=false;C=!!B;E(K.readAttribute("data-href")||K.href);L.preventDefault()});Event.on(G,"click","a[rel~=modal]",function(L,K){I=true;C=!!B;E(K.readAttribute("data-href")||K.href);L.preventDefault()});Event.on(G,"click","a[rel~=close]",function(K){J();K.preventDefault()})})(document,window);var BazaarvoiceAPILoader=(function(){var A=function(D,E){var C=document.createElement("script");C.async=true;C.src=D;if(C.readyState){C.onreadystatechange=function(){if("loaded"===C.readyState||"complete"===C.readyState){if(E&&typeof E==="function"){C.onreadystatechange=null;B(E,"callback")}}}}else{C.onload=function(){if(E&&typeof E==="function"){B(E,"callback")}}}B(function(){document.getElementsByTagName("head")[0].appendChild(C)},"load")};var B=function(F,E){var D,C;D=new Date();F();C=new Date();new Ajax.Request("/helper/bvApiStats",{parameters:{type:E,timeElapsed:(C.getMilliseconds()-D.getMilliseconds())}})};return{load:function(C,D){if(Page.isDOMReady){A(C,D)}else{Event.observe(document,"dom:loaded",A(C,D))}}}})();var identifyCardByIIN=function(D,B){var F=D.replace(/[^0-9]+/g,"");if(F.length<6){return null}var A=null;var C=F.substring(0,6);var G=$H();IIN.each(function(H){if(H.value[0].test(C)){G.set(H.key,H.value)}});var E=0;if(G.size()>1){G.each(function(H){if(H.value[1]){E++;if(B){if(F.length==H.value[1]){A=H.key;return}}else{if(F.length>H.value[1]){G.unset(H.key)}}}})}if(!E||(E<G.size())){A=G.keys()[0]}return A};var IIN=$H({CB:[new RegExp("^30[0-5][0-9]{3}$")],DS:[new RegExp("^6(?:011[0-9]{2}|4[4-9][0-9]{3}|5[0-9]{4}|22(?:1(?:2[6-9]|[3-9][0-9])|[2-8][0-9]{2}|9(?:[01][0-9]|2[0-5])))$")],AX:[new RegExp("^3[47][0-9]{4}$")],CA:[new RegExp("^5[1-5][0-9]{4}$"),16],DC:[new RegExp("^(?:36|5[45])[0-9]{4}$"),14],VI:[new RegExp("^4[0-9]{5}$")]});var ProgressIndicator=Class.create();ProgressIndicator.prototype={count:12,initialize:function(G,I,J){log.debug("ProgressIndicator.initialize");this.spinnerElement=new Element("div",{"class":"progressIndicator visible",style:"position:relative;"});var D=J?J:"&#8226;";var A=I?I*0.75:0.75;this.spinners=$A();this.timeout=null;for(var E=0;E<this.count;E++){var H=((E+1)/this.count);var K=new Element("span").update(D).setOpacity(H);var C=(2*Math.PI*E)/this.count;var B=(Math.sin(C)*A).toFixed(3);var F=(Math.cos(C)*A).toFixed(3);K.setStyle({position:"absolute",top:B?B+"em":"0",left:F?F+"em":"0"});this.spinners.push(K);this.spinnerElement.appendChild(K)}if(G){G.appendChild(this.spinnerElement);this.start()}},step:function(){if(this.spinnerElement.descendantOf(document)){var A=1/this.count;this.spinners.each(function(D){var C=D.getOpacity();var B=C-A;if(B<A){B=1}D.setOpacity(B)});this.timeout=setTimeout(this.step.bind(this),(1000*A))}else{log.debug("stopping ProgressIndicator because it no longer appears to be in the DOM");this.stop()}},start:function(){this.spinnerElement.showByClass();if(!this.timeout){this.step()}},stop:function(){clearTimeout(this.timeout);this.timeout=null;this.spinnerElement.hideByClass()}};var FacebookSDK={session:null,callbacks:[],loading:false,initialized:false,initParams:{},load:function(F,D){if(F){this.callbacks.push(F)}if(this.loading){return}this.loading=true;this.initParams=D.params.initParams;var C=D.element;var B=document.createElement("div");B.id="fb-root";C.insert({top:B});var A=this.initParams.locale||"en_US";var E=document.createElement("script");E.async=true;E.src=document.location.protocol+"//connect.facebook.net/"+A+"/all.js";B.appendChild(E);fbAsyncInit=function(){this.initSdk()}.bind(this)},loaded:function(A){if(A){A()}},callback:function(){this.load=this.loaded;while(this.callbacks.length){(this.callbacks.shift())()}},initSdk:function(){if(this.initialized){return}var D=this.initParams;var E=window.location.protocol+"//"+window.location.host,B="/script/vendor/facebook/facebook-channel.htm",A="/script/vendor/facebook/facebook-channel-secure.htm",C=E+(document.location.protocol.toLowerCase()==="http:"?B:A);FB.init({appId:D.appId,status:true,cookie:true,channelUrl:C});this.initialized=true;this.callback()}};var GoogleMapAPILoader={callbacks:[],loading:false,load:function(E,A,D){if(E){this.callbacks.push(E)}if(this.loading){return}this.loading=true;var B=window.location.protocol+"//maps.googleapis.com/maps/api/js?client=gme-orbitz&sensor="+(D?true:false)+"&callback=GoogleMapAPILoader.callback&v=3.7&libraries=places&language="+A;var C=document.createElement("SCRIPT");C.type="text/javascript";C.src=B;document.getElementsByTagName("HEAD")[0].appendChild(C)},loaded:function(A){if(A){A()}},callback:function(){this.load=this.loaded;while(this.callbacks.length){(this.callbacks.shift())()}}};var GoogleMapControls={OutlierControl:function(B){var C={element:null,show:function(F,D){var E=this.position;if(!E){E=F.controls[D];E.push(this.element);this.position=E}},hide:function(){var E=this.position;if(E){var D=E.getArray();D.each(function(G,F){if(G===this.element){E.removeAt(F);$break}}.bind(this));delete this.position}}};if(!this.listener){function A(){if(!B.markers){return}var D=(function(){if(B.markerLevel=="location"){var H=B.markers,G=B.map.getBounds();for(var F=0;F<H.length;F++){if(!G.contains(H[F].getPosition())){return true}}}})();if(D){if(!this.element){this.element=function(){var G=new Element("div",{"class":"buttonControl"}),F=new Element("a",{"class":"link controlUI"}).update(B.params.outlierControlText);google.maps.event.addDomListener(F,"click",function(H){this.map.fitBounds(H);this.fireWebTrendsEvent("ViewAllAreas",{"DCSext.de_city":this.params.locationId})}.bind(B,B.bounds));G.appendChild(F);return G}.call(this)}this.show(B.map,google.maps.ControlPosition.TOP_CENTER)}else{var E=this;if(E&&E.position){E.hide(B.map)}}}this.listener=google.maps.event.addListener(B.map,"idle",A.bind(C));google.maps.event.addListener(B.map,"markersLoaded",A.bind(C))}}};var GoogleMapUtil={getStreetView:function(B,C){var A=new google.maps.StreetViewService();A.getPanoramaByLocation(B,50,function(E,D){if(D==google.maps.StreetViewStatus.OK){if(typeof C==="function"){C(E)}}else{if(D==google.maps.StreetViewStatus.ZERO_RESULTS){log.info("GoogleMapUtil: Streetview unavailable for this location")}else{if(D==google.maps.StreetViewStatus.UNKNOWN_ERROR){log.error("GoogleMapUtil: Streetview server error")}else{log.error("GoogleMapUtil: Streetview unknown error")}}}})},calculateBearing:function(B,A){var F=A.lat()-B.lat();var C=A.lng()-B.lng();var D=Math.atan2(C,F);var E=D*180/Math.PI;if(E<0){E+=360}return E}};var GooglePlusOneAPILoader={loading:false,load:function(D,A){if(this.loading){this.loaded(D);return}this.loading=true;var C=window.___gcfg={lang:A,parsetags:"explicit"};var B=document.createElement("script");B.type="text/javascript";B.src="https://apis.google.com/js/plusone.js";B.async=true;B.text=C;document.getElementsByTagName("HEAD")[0].appendChild(B);this.loaded(D)},loaded:function(B){var A=setInterval(function(){if(typeof gapi==="undefined"){return}else{clearInterval(A);if(B&&typeof B==="function"){B()}}},500)}};var DialogManager=Class.create({initialize:function(A){this.dialogs=$A();this.$element=Element.extend(A);this.openListener=this.dialogOpen.bindAsEventListener(this);this.$element.observe("dialog:dialogOpen",this.openListener)},close:function(){this.dialogs.each(function(A){A.close()});this.dialogs.clear()},dialogOpen:function(A){if(A&&A.memo&&A.memo.dialog){this.dialogs.push(A.memo.dialog)}},destroy:function(){this.close();this.dialogs=null;this.$element.stopObserving("dialog:dialogOpen",this.openListener);this.$element=null}});var Dialog={};Dialog.Base={version:"Dialog 1.5",setProperties:function(B,C,A){this.type=B;this.content=C;this.triggerContext;this.options={anchorName:"",triggerEvent:"click",closeLabel:"",dialogGroup:"",topBoundaryText:"",bottomBoundaryText:"",wrapLinkText:"",sessionTimeoutUrl:"",closeElements:$A(),classes:"",hasCustomPositioningContext:false,setUp:function(){},tearDown:function(){}};Object.extend(this.options,A||{});this.isOpen=false;this.activated=false;this.layoutBuilt=false;this.triggers=new ManagedEventObservers();this.managedEventObservers=new ManagedEventObservers();this.closeEventObservers=new ManagedEventObservers();if(this.options.dialogGroup){this.dialogGroup=this.options.dialogGroup;document.observe("dialog:dialogOpen",this.closeByGroup.bindAsEventListener(this))}},createMarkup:function(){log.error("You have not defined createMarkup() for your "+this.type+" object.")},showDialog:function(){log.error("You have not defined showDialog() for your "+this.type+" object.")},positionInViewport:function(){log.error("You have not defined positionInViewport() for your "+this.type+" object.")},open:function(A){log.error("You have not defined open() for your "+this.type+" object.")},close:function(A){log.error("You have not defined close() for your "+this.type+" object.")},closeByGroup:function(A){if(!A||!A.memo){return}if(A.memo.dialog.options.dialogGroup===this.dialogGroup&&this.isOpen){this.close()}},createDialogDivs:function(){log.debug("createDialogDivs");this.markup={dialogWrapper:new Element("div",{"class":"dialogWrapper "+this.type.toLowerCase()+" "+this.options.classes}),topBoundary:new Element("p",{"class":"offscreen"}),bottomBoundary:new Element("p",{"class":"offscreen"}),dialogAnchor:new Element("a",{"class":"dialogAnchor"}),top:new Element("div",{"class":"dialogTop"}),main:new Element("div",{"class":"dialogMain"}),bottom:new Element("div",{"class":"dialogBottom"}),topLeft:new Element("div",{"class":"dialogTopLeft"}),topRight:new Element("div",{"class":"dialogTopRight"}),topCloseLink:new Element("a",{"class":"dialogTopCloseLink dialogCloseLink",href:"javascript:void(0);",tabIndex:"-1"}),mainRight:new Element("div",{"class":"dialogMainRight"}),mainContent:new Element("div",{"class":"dialogMainContent"}),mainInfo:new Element("div",{"class":"dialogMainInfo"}),dialogTitle:new Element("div",{"class":"dialogTitle"}),dialogTitleH3:new Element("h3"),bottomContent:new Element("div",{"class":"dialogBottomContent"}),bottomLeft:new Element("div",{"class":"dialogBottomLeft"}),bottomRight:new Element("div",{"class":"dialogBottomRight"}),bottomCloseLink:new Element("a",{"class":"dialogBottomCloseLink dialogCloseLink offscreen",href:"javascript:void(0);",tabIndex:"-1"}),wrapLink:new Element("a",{"class":"dialogWrapLink offscreen"})};if(this.options.id){this.markup.dialogWrapper.id=this.options.id}this.markup.topCloseLink.innerHTML=this.options.closeLabel;this.options.closeElements.push(this.markup.topCloseLink);this.markup.bottomCloseLink.innerHTML=this.options.closeLabel;this.options.closeElements.push(this.markup.bottomCloseLink);this.markup.topBoundary.innerHTML=this.options.topBoundaryText;this.markup.dialogWrapper.appendChild(this.markup.topBoundary);if(this.options.anchorName!==""){this.markup.dialogAnchor.name="_"+this.options.anchorName;this.markup.dialogAnchor.tabIndex="-1";this.markup.dialogWrapper.appendChild(this.markup.dialogAnchor);this.markup.wrapLink.tabIndex="-1";this.markup.wrapLink.href="#"+this.markup.dialogAnchor.name;this.markup.wrapLink.innerHTML=this.options.wrapLinkText}this.markup.dialogWrapper.appendChild(this.markup.top);this.markup.dialogWrapper.appendChild(this.markup.main);this.markup.dialogWrapper.appendChild(this.markup.bottom);this.markup.dialogWrapper.appendChild(this.markup.wrapLink);this.markup.bottomBoundary.innerHTML=this.options.bottomBoundaryText;this.markup.dialogWrapper.appendChild(this.markup.bottomBoundary);this.markup.top.appendChild(this.markup.topLeft);this.markup.top.appendChild(this.markup.topRight);this.markup.main.appendChild(this.markup.mainRight);this.markup.mainRight.appendChild(this.markup.mainContent);this.markup.mainContent.appendChild(this.markup.topCloseLink);if(this.options.heading){this.markup.dialogTitleH3.innerHTML=this.options.heading;this.markup.dialogTitle.appendChild(this.markup.dialogTitleH3);this.markup.mainContent.appendChild(this.markup.dialogTitle);if(this.options.transparentHeading){this.markup.dialogTitle.addClassName("transparentHeading")}}this.markup.mainContent.appendChild(this.markup.mainInfo);this.markup.mainContent.appendChild(this.markup.bottomCloseLink);this.markup.bottom.appendChild(this.markup.bottomLeft);this.markup.bottom.appendChild(this.markup.bottomRight)},createShim:function(){if(navigator.userAgent.toLowerCase().indexOf("msie 6")!==-1){log.debug("is ie6, creating shim");this.markup.shim=this.markup.shim?this.markup.shim.destroy():null;this.markup.shim=Element.extend(document.createElement("div"));var E=Element.extend(document.createElement("iframe"));E.style.display="none";this.markup.shim.appendChild(E);this.markup.shim.className="dialogShim "+this.options.classes;E.src="/cacheable/empty.html";E.scrolling="no";E.frameBorder="0";this.triggerContext.activeDialogsContainer.insertBefore(this.markup.shim,this.markup.dialogWrapper);this.markup.shim.style.top=this.markup.dialogWrapper.style.top;this.markup.shim.style.left=this.markup.dialogWrapper.style.left;var C=this.markup.shim.currentStyle.paddingTop.replace("px","")*1;var D=this.markup.shim.currentStyle.paddingRight.replace("px","")*1;var A=this.markup.shim.currentStyle.paddingBottom.replace("px","")*1;var B=this.markup.shim.currentStyle.paddingLeft.replace("px","")*1;E.style.width=(this.dialogBoundingBox.x2-this.dialogBoundingBox.x1-D-B)+"px";E.style.height=(this.dialogBoundingBox.y2-this.dialogBoundingBox.y1-C-A)+"px";E.style.display="block"}},attachTriggers:function(A){if(Object.isArray(A)){if(this.triggers instanceof ManagedEventObservers){for(var B=0;A[B];B++){if(this.options.triggerEvent=="mouseover"){this.triggers.add(A[B],"mouseover",this.open.bindAsEventListener(this))}this.triggers.add(A[B],"click",this.open.bindAsEventListener(this))}log.debug("Dialog.Base triggers attached: "+A.length)}else{log.error("Dialog.Base.prototype.triggers not instance of ManagedEventObservers")}}else{log.error("newTriggers parameter either undefined, or is not an array")}},attachCloseListeners:function(C){if(this.options.closeElements){for(var A=0;this.options.closeElements[A];A++){if(!this.options.closeElements[A].isAttached){this.closeEventObservers.add(this.options.closeElements[A],"click",C);this.options.closeElements[A].isAttached=true}}}var B=this.markup.mainInfo.getElementsByClassName("closeListener");for(var A=0;B[A];A++){if(!B[A].isAttached){this.managedEventObservers.add(B[A],"click",C);B[A].isAttached=true}}},getTrigger:function(A){if(this.triggers.isWatchingElement(A)){this.trigger=$(A)}else{this.trigger=$(A).ancestors().find(function(B){return this.triggers.isWatchingElement(B)}.bind(this));if(!this.trigger){this.trigger=$(A)}}},inspectTrigger:function(A){this.getTrigger(A);this.trigger.pos=this.trigger.getPosition();this.trigger.dim=this.trigger.getDimensions();this.triggerContext={};if(this.options.hasCustomPositioningContext){this.triggerContext.element=this.trigger.up(".dialogPositioningContext")}else{this.triggerContext.element=this.trigger.up(".dialogWrapper, #bodyWrapper, body")}if(this.triggerContext.element===$(document.body)){this.triggerContext.pos={x:0,y:0}}else{this.triggerContext.pos=this.triggerContext.element.getPosition()}this.triggerContext.activeDialogsContainer=this.triggerContext.element.childElements().find(function(B){return B.hasClassName("activeDialogs")});if(!this.triggerContext.activeDialogsContainer){this.triggerContext.activeDialogsContainer=new Element("div",{"class":"activeDialogs","data-context":"activeDialogs"});this.triggerContext.element.appendChild(this.triggerContext.activeDialogsContainer)}log.debug("Dialog.Base.trigger: "+this.trigger.tagName+", pos: "+this.trigger.pos.x+", "+this.trigger.pos.y+" dim: "+this.trigger.dim.width+", "+this.trigger.dim.height+", triggerContext: "+this.triggerContext+", triggerContextPos: "+this.triggerContext.pos.x+", "+this.triggerContext.pos.y)},wrapFocus:function(A){A.preventDefault();this.focusCloseLink()},attachFocusWrapListeners:function(){this.managedEventObservers.add(this.markup.wrapLink,"click",this.wrapFocus.bindAsEventListener(this))},getContent:function(){if(this.response){log.debug("Dialog.Base.getContent: response");this.showDialog(this.response)}else{if(!this.content){log.debug("Dialog.Base.getContent: null")}else{if(this.content.domNode){this.content.domNode=$(this.content.domNode);log.debug("Dialog.Base.getContent - domNode: "+this.content.domNode);this.showDialog(this.content.domNode.cloneNode(true))}else{if(this.content.url){this.content.url=this.content.url.unescapeHTML();log.debug("Dialog.Base.getContent - url: "+this.content.url);this.request=new Ajax.Request(this.content.url,{method:(this.options.ajaxParameters)?"post":"get",parameters:(this.options.ajaxParameters)?this.options.ajaxParameters:"",onCreate:function(){if(!this.options.interstitial){this.showIntrastitial()}}.bind(this),onComplete:this.showDialog.bind(this),onSuccess:function(A){log.debug(A.status+": Dialog.Base.getContent() content.url successful");if(A.responseText.indexOf("<html")!=-1){if(this.options.sessionTimeoutUrl){this.sessionHasExpired=true;top.location.href=this.options.sessionTimeoutUrl}else{if(this.options.fallbackMessage){A.responseText=this.options.fallbackMessage}}}if(!this.options.interstitial){this.hideIntrastitial()}if(this.content.stripWhitespace){A.responseText=A.responseText.replace(/>[ \t\r\n\v\f]*</g,"><")}}.bind(this)})}else{if(this.content.string){log.debug("Dialog.Base.getContent - markup: "+this.content.string);this.showDialog(this)}else{if(this.content.jsTemplate){log.debug("Dialog.Base.getContent - jsTemplate: "+this.content.jsTemplate);this.showDialog(this)}else{log.error("Dialog.response is null and Dialog.content not a recognized type")}}}}}}},showIntrastitial:function(){this.pi=new ProgressIndicator();this.markup.mainInfo.addClassName("loadingContent");this.markup.mainInfo.insert(this.pi.spinnerElement);this.pi.start()},hideIntrastitial:function(){if(this.pi){this.pi.stop();this.markup.mainInfo.removeClassName("loadingContent");this.pi.spinnerElement.remove();delete this.pi}},populateDialog:function(){if(this.response){if(this.options.interstitial){this.markup.mainInfo.innerHTML=""}if(this.content.domNode){var E=$(this.content.domNode).immediateDescendants();log.debug("populateDialog: "+E.length+" nodes");for(var C=0;C<E.length;C++){this.markup.mainInfo.appendChild(E[C])}}else{if(this.content.url&&this.response.responseText){this.markup.mainInfo.update(this.response.responseText);Page.initializeDOMFragment(this.markup.mainInfo)}else{if(this.content.string){this.markup.mainInfo.update(this.content.string);Page.initializeDOMFragment(this.markup.mainInfo)}else{if(this.content.jsTemplate){log.debug("Dialog.populateDialog: jsTemplate - dataAttribute name: "+this.content.jsTemplate.dataAttributeName);try{if(this.content.jsTemplate.dataAttributeName){var A=this.trigger.readAttribute(this.content.jsTemplate.dataAttributeName)||this.trigger.getParentByAttribute(this.content.jsTemplate.dataAttributeName).readAttribute(this.content.jsTemplate.dataAttributeName);this.dataJSON=A.unescapeJSON().evalJSON()}else{if(this.content.jsTemplate.dataObj){this.dataJSON=this.content.jsTemplate.dataObj}}if(this.dataJSON.microContentHeading){this.resetHeading(this.dataJSON.microContentHeading)}else{var D=this.getHeadingElement().innerHTML.unescapeHTML();if(D){this.resetHeading(processTemplate(D,this.dataJSON))}else{this.resetHeading("")}}this.markup.mainInfo.update(processTemplate(this.content.jsTemplate.id,this.dataJSON))}catch(B){log.error("EXCEPTION: Dialog.populateDialog: unable process template - "+B.message)}Page.initializeDOMFragment(this.markup.mainInfo)}else{log.error("Dialog.populateDialog: unable to determine response type")}}}}this.markup.backToTopLink=this.markup.mainInfo.getLastElementByClassName("footnoteBackToTop","A");if(this.markup.backToTopLink){this.markup.backToTopLink.style.display="none"}}},setTemplateData:function(A){this.content.jsTemplate.dataObj=A},getTemplateData:function(A){return this.content.jsTemplate.dataObj},getContentElement:function(){return this.markup.mainInfo},depopulateDialog:function(){if(this.markup.backToTopLink){this.markup.backToTopLink.style.display="inline"}if(this.markup.mainInfo){if(this.content.domNode){var B=this.markup.mainInfo.immediateDescendants();for(var A=0;A<B.length;A++){this.content.domNode.appendChild(B[A])}}this.markup.mainInfo.innerHTML=""}},appendToDOM:function(){if(this.triggerContext.activeDialogsContainer){this.triggerContext.activeDialogsContainer.appendChild(this.markup.dialogWrapper);this.markup.dialogWrapper.setStyle({visibility:"hidden"})}else{log.error("Dialog.Base.appendToDOM: couldn't find 'triggerContext.activeDialogContainer' container to insert new dialog")}},_removeFromDOM:function(){log.debug("Dialog._removeFromDOM()");if(this.triggerContext){this.triggerContext.element=null;this.triggerContext.activeDialogsContainer=null;this.triggerContext=null}this.markup.backToTopLink=null;this.markup.shim=this.markup.shim?this.markup.shim.destroy():null;this.markup.bottomRight=this.markup.bottomRight?this.markup.bottomRight.destroy():null;this.markup.bottomLeft=this.markup.bottomLeft?this.markup.bottomLeft.destroy():null;this.markup.bottomContent=this.markup.bottomContent?this.markup.bottomContent.destroy():null;this.markup.bottomCloseLink=this.markup.bottomCloseLink?this.markup.bottomCloseLink.destroy():null;this.markup.mainInfo=this.markup.mainInfo?this.markup.mainInfo.destroy():null;this.markup.mainContent=this.markup.mainContent?this.markup.mainContent.destroy():null;this.markup.mainRight=this.markup.mainRight?this.markup.mainRight.destroy():null;this.markup.topCloseLink=this.markup.topCloseLink?this.markup.topCloseLink.destroy():null;this.markup.topRight=this.markup.topRight?this.markup.topRight.destroy():null;this.markup.topLeft=this.markup.topLeft?this.markup.topLeft.destroy():null;this.markup.dialogTitleH3=this.markup.dialogTitleH3?this.markup.dialogTitleH3.destroy():null;this.markup.dialogTitle=this.markup.dialogTitle?this.markup.dialogTitle.destroy():null;this.markup.wrapLink=this.markup.wrapLink?this.markup.wrapLink.destroy():null;this.markup.bottom=this.markup.bottom?this.markup.bottom.destroy():null;this.markup.main=this.markup.main?this.markup.main.destroy():null;this.markup.top=this.markup.top?this.markup.top.destroy():null;this.markup.dialogAnchor=this.markup.dialogAnchor?this.markup.dialogAnchor.destroy():null;this.markup.topBoundary=this.markup.topBoundary?this.markup.topBoundary.destroy():null;this.markup.dialogWrapper=this.markup.dialogWrapper?this.markup.dialogWrapper.destroy():null},focusCloseLink:function(){clearTimeout(this.focusTimeout);if(this.markup.topCloseLink){var A=this.markup.topCloseLink.updateAndFocus(1500);this.focusTimeout=A;var B=function(C){log.debug("Clearing close link focus timeout");clearTimeout(A);this.stopObserving("mousedown",B)};$("bodyWrapper").observe("mousedown",B)}},resetHeading:function(A){this.getHeadingElement().innerHTML=A},getHeadingElement:function(){return this.markup.dialogTitleH3}};var Microcontent=Class.create(Dialog.Base,{initialize:function(C,D,E){var A={triggerEvent:"mouseover",heading:null,triggerDelay:0,compact:false,displayBeak:true,preferredPosition:"bottomRight",debug:{enabled:false}};var C=$A(C);Object.extend(A,E||{});this.setProperties("Microcontent",D,A);this.attachTriggers(C);if(this.options.triggerEvent=="mouseover"){for(var B=0;C[B];B++){this.triggers.add(C[B],"mouseout",this.clearTriggerFocus.bindAsEventListener(this))}}else{if(this.options.triggerEvent=="click"){}else{log.error("Microcontent.options.triggerEvent: "+this.options.triggerEvent+" is not a recognized event type")}}this.focusListeners=new ManagedEventObservers();this.focusListenersAttached=false},createMarkup:function(){this.createDialogDivs();if(this.options.displayBeak){this.markup.beak=Element.extend(document.createElement("div"));this.markup.dialogWrapper.appendChild(this.markup.beak)}},showDialog:function(A){try{if(this.markup.dialogWrapper){$(this.trigger).fire("dialog:dialogOpen",{dialog:this});this.response=A;this.populateDialog();this.attachCloseListeners(this.close.bindAsEventListener(this));this.focusListenersAttached=this.attachFocusListeners();this.attachFocusWrapListeners();this.appendToDOM();this.buildLayout();this.positionInViewport();this.options.setUp();this.markup.dialogWrapper.setStyle({visibility:"visible"});this.focusCloseLink();this.manager=new DialogManager(this.markup.dialogWrapper);this.isOpen=true;window.setTimeout(function(){this.createShim()}.bind(this),0)}else{log.error("Microcontent.showDialog: markup.dialogWrapper doesn't exist")}}catch(B){log.error("EXCEPTION: Microcontent.showDialog: "+B.message)}finally{this.activated=false}},positionInViewport:function(){var Q={x1:this.trigger.pos.x-this.triggerContext.pos.x,y1:this.trigger.pos.y-this.triggerContext.pos.y,x2:this.trigger.pos.x-this.triggerContext.pos.x+this.trigger.dim.width,y2:this.trigger.pos.y-this.triggerContext.pos.y+this.trigger.dim.height};if(this.options.displayBeak){var K={x:Q.x1,y:Q.y1+(this.trigger.dim.height/2)};var J={x:Q.x2,y:Q.y1+(this.trigger.dim.height/2)}}else{var K={x:Q.x2,y:Q.y1+(this.trigger.dim.height/2)};var J={x:Q.x1,y:Q.y1+(this.trigger.dim.height/2)}}var S=this.markup.dialogWrapper.getDimensions();var a=function(){var m=0;var l=0;var g;var e;if(this.markup.main.currentStyle){if(this.options.displayBeak){var h=this.markup.beak.currentStyle;var m=(h.height.replace("px",""))*1;var l=(h.width.replace("px",""))*1}var k=this.markup.main.currentStyle;var f=this.markup.mainRight.currentStyle;var g=(k.paddingLeft.replace("px",""))*1;var e=(f.paddingRight.replace("px",""))*1}else{if(this.options.displayBeak){var h=document.defaultView.getComputedStyle(this.markup.beak,"");var m=(h.getPropertyValue("height").replace("px",""))*1;var l=(h.getPropertyValue("width").replace("px",""))*1}var k=document.defaultView.getComputedStyle(this.markup.main,"");var f=document.defaultView.getComputedStyle(this.markup.mainRight,"");var g=(k.getPropertyValue("padding-left").replace("px",""))*1;var e=(f.getPropertyValue("padding-right").replace("px",""))*1}if(this.options.displayBeak){this.offsets={top:(this.markup.bottom.dim.height+(m/2)),right:l-g,bottom:(0-this.markup.top.dim.height-(m/2)),left:(0-(l-e))}}else{this.offsets={top:this.markup.bottom.dim.height,right:0-g*2,bottom:0-this.markup.top.dim.height/2,left:e*2}}this.beakHeight=m}.bind(this);var G=function(){if(this.options.displayBeak){this.markup.beak.className="microcontentBeakRight";this.markup.beak.setStyle({left:S.width+"px"})}a()}.bind(this);var V=function(){if(this.options.displayBeak){this.markup.beak.className="microcontentBeakLeft";this.markup.beak.setStyle({left:"0"})}a()}.bind(this);V();var A={x1:J.x+this.offsets.right+this.triggerContext.pos.x,y1:J.y-S.height+this.offsets.top+this.triggerContext.pos.y,x2:J.x+S.width+this.offsets.right+this.triggerContext.pos.x,y2:J.y+this.offsets.top+this.triggerContext.pos.y};var Y={x1:J.x+this.offsets.right+this.triggerContext.pos.x,y1:J.y+this.offsets.bottom+this.triggerContext.pos.y,x2:J.x+S.width+this.offsets.right+this.triggerContext.pos.x,y2:J.y+S.height+this.offsets.bottom+this.triggerContext.pos.y};G();var I={x1:K.x-S.width+this.offsets.left+this.triggerContext.pos.x,y1:K.y-S.height+this.offsets.top+this.triggerContext.pos.y,x2:K.x+this.offsets.left+this.triggerContext.pos.x,y2:K.y+this.offsets.top+this.triggerContext.pos.y};var X={x1:K.x-S.width+this.offsets.left+this.triggerContext.pos.x,y1:K.y+this.offsets.bottom+this.triggerContext.pos.y,x2:K.x+this.offsets.left+this.triggerContext.pos.x,y2:K.y+S.height+this.offsets.bottom+this.triggerContext.pos.y};var c=Position.calculateViewport();var B=Position.calculateScroll();var F={x1:B.x,y1:B.y,x2:(B.x+c.width),y2:(B.y+c.height)};var O=(Y.x2<=F.x2)&&(Y.y2<=F.y2);var P=(X.x1>=F.x1)&&(X.y2<=F.y2);var E=(A.x2<=F.x2)&&(A.y1>=F.y1);var U=(I.x1>=F.x1)&&(I.y1>=F.y1);this.debugPosition({dialogWrapperDimensions:S,topRightBoundingBox:A,topLeftBoundingBox:I,bottomRightBoundingBox:Y,bottomLeftBoundingBox:X,bottomRightGood:O,bottomLeftGood:P,topRightGood:E,topLeftGood:U});var D=function(){G();this.markup.dialogWrapper.setStyle({left:((this.dialogBoundingBox.x1-this.triggerContext.pos.x)/Units.PX_TO_EM)+"em"})}.bind(this);var T=function(){V();this.markup.dialogWrapper.setStyle({left:((this.dialogBoundingBox.x1-this.triggerContext.pos.x)/Units.PX_TO_EM)+"em"})}.bind(this);var b=function(){if(this.options.displayBeak){this.markup.beak.setStyle({top:this.markup.top.dim.height+this.markup.main.dim.height-this.beakHeight+"px"})}this.markup.dialogWrapper.setStyle({top:((this.dialogBoundingBox.y1-this.triggerContext.pos.y)/Units.PX_TO_EM)+"em"})}.bind(this);var L=function(){if(this.options.displayBeak){this.markup.beak.setStyle({top:this.markup.top.dim.height+"px"})}this.markup.dialogWrapper.setStyle({top:((this.dialogBoundingBox.y1-this.triggerContext.pos.y)/Units.PX_TO_EM)+"em"})}.bind(this);var d=function(){this.dialogBoundingBox=Y;T();L()}.bind(this);var H=function(){this.dialogBoundingBox=A;T();b()}.bind(this);var W=function(){this.dialogBoundingBox=X;D();L()}.bind(this);var M=function(){this.dialogBoundingBox=I;D();b()}.bind(this);var C=d;var Z=false;if(this.options.preferredPosition=="bottomRight"){if(O){Z=true}C=d}else{if(this.options.preferredPosition=="topRight"){if(E){Z=true}C=H}else{if(this.options.preferredPosition=="bottomLeft"){if(P){Z=true}C=W}else{if(this.options.preferredPosition=="topLeft"){if(U){Z=true}C=M}}}}if(Z){C()}else{if(O){d()}else{if(E){H()}else{if(P){W()}else{if(U){M()}else{C()}}}}}},open:function(C,B){log.debug("Microcontent.open()");if(C){C.preventDefault()}if(this.isOpen){this.close(C)}if(this.isOpen==false&&this.activated==false){this.triggerFocused=true;this.dialogFocused=false;this.activated=true;var A=B||$(Event.element(C));this.inspectTrigger(A);if(!this.markup||!this.markup.dialogWrapper){this.createMarkup()}setTimeout(function(){if(this.triggerFocused){this.getContent()}}.bind(this),this.options.triggerDelay)}else{this.focusCloseLink();log.error("already open or activated: isOpen:"+this.isOpen+", activated:"+this.activated)}},close:function(A){if(!this.isOpen){return}log.debug("Microcontent.close()");if(A){A.preventDefault()}if(this.manager){this.manager.destroy();this.manager=null}this.focusListeners.clear();this.focusListenersAttached=false;this.managedEventObservers.clear();this.closeEventObservers.clear();if(this.options.tearDown){this.options.tearDown()}this.depopulateDialog();this.removeFromDOM();this.triggerFocused=false;this.dialogFocused=false;this.activated=false;if(this.trigger.type!=="mouseover"){this.trigger.updateAndFocus()}this.isOpen=false;this.cleanUpDebug()},attachFocusListeners:function(){if(this.focusListenersAttached==false&&this.options.triggerEvent!="click"){this.focusListeners.add(this.markup.dialogWrapper,"mouseover",this.setDialogFocus.bindAsEventListener(this));this.focusListeners.add(this.markup.dialogWrapper,"mouseout",this.clearDialogFocus.bindAsEventListener(this));return true}else{return false}},checkFocus:function(){setTimeout(function(){if(this.dialogFocused==false&&this.triggerFocused==false){this.close()}}.bind(this),200)},clearTriggerFocus:function(){log.debug("trigger mouse out");this.triggerFocused=false;this.checkFocus()},setDialogFocus:function(){log.debug("dialog mouseover");this.dialogFocused=true;this.triggerFocused=false},clearDialogFocus:function(){log.debug("dialog mouseout");this.dialogFocused=false;this.checkFocus()},buildLayout:function(){if(!this.layoutBuilt){if(this.options.compact){this.markup.dialogWrapper.addClassName("dialogCompact")}this.markup.bottom.removeClassName("dialogBottom");this.markup.bottom.addClassName("dialogBottomCompact");this.markup.top.dim=this.markup.top.getDimensions();this.markup.bottom.dim=this.markup.bottom.getDimensions();this.markup.main.dim=this.markup.main.getDimensions();this.layoutBuilt=true}},removeFromDOM:function(){this.markup.beak=this.markup.beak?this.markup.beak.destroy():null;this._removeFromDOM();this.layoutBuilt=false},destroy:function(){this.content=null;this.options=null;this.closeEventObservers=this.closeEventObservers.clear();for(var A=0;A<this.managedEventObservers.observers.length;A++){this.managedEventObservers.observers[A][0].isAttached=null}this.managedEventObservers=this.managedEventObservers.clear();this.focusListeners=this.focusListeners.clear()},inspectPositioningData:function(B,A,D){var C="Microcontent.inspectPositioningData:<br/>viewport.height: "+B.height+"<br/>scroll.y: "+A.y+"<br/>this.markup.dialogWrapper.dim: "+this.markup.dialogWrapper.dim.width+","+this.markup.dialogWrapper.dim.height+"<br/>this.markup.dialogWrapper.pos: "+this.markup.dialogWrapper.pos.x+","+this.markup.dialogWrapper.pos.y+"<br/>this.trigger: "+this.trigger+"<br/>this.trigger.pos: "+this.trigger.pos.x+","+this.trigger.pos.y+"<br/>this.trigger.dim: "+this.trigger.dim.width+","+this.trigger.dim.height+"<br/>"+log.info(C)},debugPosition:function(C){log.debug("bottomRightGood: "+C.bottomRightGood+", bottomLeftGood: "+C.bottomLeftGood+", topRightGood: "+C.topRightGood+", topLeftGood: "+C.topLeftGood);var G="border:3px solid green;";var E="border:3px dashed red;";var F="border:3px solid blue;";var D=C.topRightGood?G:E;var B=C.topLeftGood?G:E;var A=C.bottomRightGood?G:E;var H=C.bottomLeftGood?G:E;if(this.options.debug.enabled){this.options.debug.topRightDebugBox=new Element("div",{style:D+"z-index:40; top:"+C.topRightBoundingBox.y1+"px; left:"+C.topRightBoundingBox.x1+"px; width:"+(C.dialogWrapperDimensions.width-6)+"px; height:"+(C.dialogWrapperDimensions.height-6)+"px; position:absolute;"});this.options.debug.topLeftDebugBox=new Element("div",{style:B+"z-index:40; top:"+C.topLeftBoundingBox.y1+"px; left:"+C.topLeftBoundingBox.x1+"px; width:"+(C.dialogWrapperDimensions.width-6)+"px; height:"+(C.dialogWrapperDimensions.height-6)+"px; position:absolute;"});this.options.debug.bottomRightDebugBox=new Element("div",{style:A+"z-index:40; top:"+C.bottomRightBoundingBox.y1+"px; left:"+C.bottomRightBoundingBox.x1+"px; width:"+(C.dialogWrapperDimensions.width-6)+"px; height:"+(C.dialogWrapperDimensions.height-6)+"px; position:absolute;"});this.options.debug.bottomLeftDebugBox=new Element("div",{style:H+"z-index:40; top:"+C.bottomLeftBoundingBox.y1+"px; left:"+C.bottomLeftBoundingBox.x1+"px; width:"+(C.dialogWrapperDimensions.width-6)+"px; height:"+(C.dialogWrapperDimensions.height-6)+"px; position:absolute;"});this.options.debug.triggerDebugBox=new Element("div",{style:F+"z-index:40; top:"+(this.trigger.pos.y-this.triggerContext.pos.y)+"px; left:"+(this.trigger.pos.x-this.triggerContext.pos.x)+"px; width:"+(this.trigger.dim.width-6)+"px; height:"+(this.trigger.dim.height-6)+"px; position:absolute;"});$("bodyWrapper").appendChild(this.options.debug.topRightDebugBox);$("bodyWrapper").appendChild(this.options.debug.topLeftDebugBox);$("bodyWrapper").appendChild(this.options.debug.bottomRightDebugBox);$("bodyWrapper").appendChild(this.options.debug.bottomLeftDebugBox);$("bodyWrapper").appendChild(this.options.debug.triggerDebugBox)}},cleanUpDebug:function(){if(this.options.debug.enabled){this.options.debug.topRightDebugBox.remove();this.options.debug.topLeftDebugBox.remove();this.options.debug.bottomRightDebugBox.remove();this.options.debug.bottomLeftDebugBox.remove();this.options.debug.triggerDebugBox.remove()}}});var Lightbox=Class.create(Dialog.Base,{initialize:function(B,C,D){var A={triggerEvent:"click",interstitial:"",id:"",compact:false,openOnInit:false};Object.extend(A,D||{});this.setProperties("Lightbox",C,A);this.isFixedAtTop=null;this.isFixedAtBottom=null;this.positionFixedUnsupportedVal=null;this.attachTriggers(B);if(this.options.openOnInit){this.open()}},createMask:function(){var A=Position.calculatePageHeight();this.markup.mask=Element.extend(document.createElement("div"));this.markup.mask.className="dialogMask";this.markup.mask.style.height=A.height+A.units},createMarkup:function(){this.createDialogDivs();this.createMask()},showDialog:function(A){log.debug("Lightbox.showDialog()");if(!this.sessionHasExpired){this.displayContent(A);this.activated=false}},positionFixedUnsupported:function(){if(this.positionFixedUnsupportedVal==null){this.positionFixedUnsupportedVal=this.markup.dialogWrapper.getStyle("position")=="absolute"}return this.positionFixedUnsupportedVal},positionInViewport:function(){var B=Position.calculateViewport();var A=Position.calculateScroll();this.markup.dialogWrapper.dim=this.markup.dialogWrapper.getDimensions();if(this.positionFixedUnsupported()){this.markup.dialogWrapper.setStyle({top:A.y+"px"})}else{this.markup.dialogWrapper.setStyle({top:"0px"})}if(this.markup.dialogWrapper.dim.width<B.width){this.markup.dialogWrapper.setStyle({left:(B.width-this.markup.dialogWrapper.dim.width)/2+"px"})}this.isFixedAtTop=true;this.isFixedAtBottom=false;this.inspectScrollData(B,A,Position.calculatePageHeight())},open:function(B){if(this.isOpen==false&&this.activated==false){this.activated=true;if(B){var A=$(Event.element(B));this.inspectTrigger(A);this.options.setUp(B)}else{if(this.triggers&&this.triggers instanceof ManagedEventObservers){var A=this.triggers.getFirstTriggerElement();this.inspectTrigger(A)}this.options.setUp()}this.createMarkup();this.showMask();this.displayLightbox();setTimeout(this.getContent.bind(this),250)}else{this.focusCloseLink();log.error("isOpen: "+this.isOpen+", activated: "+this.activated+" either the lightbox is already open or activated, see Lightbox.open")}B.preventDefault()},close:function(A){A.preventDefault();if(this.request){log.debug("aborting request");this.request.abort();this.request=null}this.trigger.focus();if(this.markup.dialogWrapper){this.markup.dialogWrapper.style.visibility="hidden"}if(this.manager){this.manager.destroy();this.manager=null}this.managedEventObservers.clear();this.closeEventObservers.clear();this.depopulateDialog();this.hideMask();this.markup.mask=this.markup.mask?this.markup.mask.destroy():null;this.removeFromDOM();if(this.options.tearDown){this.options.tearDown()}window.virtualBufferManager.update();this.activated=false;this.isOpen=false;this.lastScroll=null;this.bottomOfDialog=null;this.dialogViewportDiff=null;this.isFixedAtBottom=false;this.isFixedAtTop=false;this.dialogSelects.clear()},showMask:function(){if(this.markup.mask){this.allSelects=$A(document.getElementsByTagName("select")).each(function(A){A.style.visibility="hidden";return Element.extend(A)});this.triggerContext.activeDialogsContainer.appendChild(this.markup.mask);this.options.closeElements.push(this.markup.mask);this.markup.mask.style.display="block";this.closeEventObservers.add(this.markup.mask,"click",this.close.bindAsEventListener(this))}else{log.error("this.markup.mask doesn't exist")}},hideMask:function(){if(this.markup.mask){this.markup.mask.style.display="none"}if(this.allSelects){this.allSelects.each(function(A){A.style.visibility="inherit"});this.allSelects.clear()}},resizeMask:function(){var A=Position.calculatePageHeight();this.markup.mask.dim=this.markup.mask.getDimensions();if(A.height>this.markup.mask.dim.height){this.markup.mask.setStyle({height:A.height+"px"})}},buildLayout:function(){if(!this.layoutBuilt){if(this.options.compact){this.markup.bottom.removeClassName("dialogBottom");this.markup.bottom.addClassName("dialogBottomCompact")}else{this.markup.bottomCloseLink.removeClassName("offscreen")}this.appendToDOM();this.markup.dialogWrapper.addClassName("fixed");this.layoutBuilt=true}},resize:function(){log.debug("Lightbox.resize");this.resizeMask();this.positionInViewport();this.isFixedAtBottom=false},attachResizeListeners:function(D,C){var B;if(arguments.length>1&&$(C).getElementsByClassName){B=$(C).getElementsByClassName("resizeListener")}else{B=this.markup.dialogWrapper.getElementsByClassName("resizeListener")}for(var A=0;B[A];A++){this.managedEventObservers.add(B[A],"click",D)}},displayLightbox:function(){if(this.content.url){this.markup.mainInfo.innerHTML=this.options.interstitial}this.buildLayout();this.onWindowScroll();this.managedEventObservers.add(window,"scroll",this.onWindowScroll.bindAsEventListener(this));this.managedEventObservers.add(window,"resize",this.onWindowResize.bindAsEventListener(this));this.attachCloseListeners(this.close.bindAsEventListener(this));this.attachFocusWrapListeners();this.positionInViewport();this.markup.dialogWrapper.style.visibility="visible";setTimeout(this.resize.bind(this),250);this.markup.dialogAnchor.updateAndFocus();$(this.trigger).fire("dialog:dialogOpen",{dialog:this});this.manager=new DialogManager(this.markup.dialogWrapper);this.isOpen=true;log.debug("end Lightbox.displayLightbox")},getCurrentDimensions:function(){return this.markup.dialogWrapper.getDimensions()},displayContent:function(A){this.response=A;this.populateDialog();this.dialogSelects=$A(this.markup.dialogWrapper.getElementsByTagName("select")).each(function(B){B.style.visibility="inherit";return Element.extend(B)});this.attachCloseListeners(this.close.bindAsEventListener(this));this.attachResizeListeners(this.onLightboxResize.bindAsEventListener(this));setTimeout(this.resize.bind(this),250);this.focusCloseLink()},replaceContent:function(A,C){if(this.isOpen==true&&this.activated==false){this.activated=true;this.response=null;this.managedEventObservers.clear();this.markup.mainInfo.innerHTML=this.options.interstitial;this.resize();var D=Position.calculatePageHeight();this.markup.mask.dim=this.markup.mask.getDimensions();if(D.height>this.markup.mask.dim.height){this.markup.mask.setStyle({height:D.height+"px"})}if(arguments.length>1){var B=$H(C).toQueryString()}if(A.indexOf("?")!=-1){this.content={url:A+"&"+B}}else{this.content={url:A+"?"+B}}this.focusCloseLink();this.getContent()}else{if(this.isOpen==false){log.error("called replaceContent on a Lightbox that was not open")}}},onWindowResize:function(){this.positionInViewport();var A=Position.calculateViewport()},onLightboxResize:function(){setTimeout(this.resize.bind(this),0)},onWindowScroll:function(){var B=Position.calculateViewport();var A=Position.calculateScroll();var C=Position.calculatePageHeight();this.markup.dialogWrapper.dim=this.markup.dialogWrapper.getDimensions();this.markup.dialogWrapper.pos=this.markup.dialogWrapper.getPosition();if(this.markup.dialogWrapper.dim.height<B.height){this.bottomOfDialog=null;this.dialogViewportDiff=null;this.markup.dialogWrapper.addClassName("fixed");this.isFixedAtTop=true;this.isFixedAtBottom=false;if(this.positionFixedUnsupported()){this.markup.dialogWrapper.setStyle({top:A.y+"px"})}else{this.markup.dialogWrapper.setStyle({top:"0px"})}}else{if(this.markup.dialogWrapper.dim.height>B.height){this.bottomOfDialog=this.markup.dialogWrapper.pos.y+this.markup.dialogWrapper.dim.height;this.dialogViewportDiff=this.markup.dialogWrapper.dim.height-B.height;if(this.markup.dialogWrapper.pos.y<A.y&&this.bottomOfDialog>(A.y+B.height)){this.isFixedAtTop=false;this.isFixedAtBottom=false;if(this.markup.dialogWrapper.hasClassName("fixed")){this.markup.dialogWrapper.setStyle({top:this.markup.dialogWrapper.pos.y+"px"});this.markup.dialogWrapper.removeClassName("fixed")}}if(this.lastScroll!=null){if(A.y>this.lastScroll.y){if(this.isFixedAtTop){this.markup.dialogWrapper.removeClassName("fixed");this.markup.dialogWrapper.setStyle({top:this.lastScroll.y+"px"});this.isFixedAtTop=false;this.bottomOfDialog=this.lastScroll.y+this.markup.dialogWrapper.dim.height}if((A.y+B.height)>this.bottomOfDialog){if(!this.isFixedAtBottom){this.markup.dialogWrapper.addClassName("fixed");this.isFixedAtBottom=true}if(this.positionFixedUnsupported()){this.markup.dialogWrapper.setStyle({top:(A.y-this.dialogViewportDiff)+"px"})}else{this.markup.dialogWrapper.setStyle({top:-(this.dialogViewportDiff)+"px"})}}}else{if(A.y<this.lastScroll.y){if(this.positionFixedUnsupported()&&A.y<=this.markup.dialogWrapper.pos.y){this.markup.dialogWrapper.setStyle({top:A.y+"px"})}else{if(this.isFixedAtBottom){this.markup.dialogWrapper.removeClassName("fixed");this.markup.dialogWrapper.setStyle({top:this.lastScroll.y-this.dialogViewportDiff+"px"});this.isFixedAtBottom=false}if(A.y<=this.markup.dialogWrapper.pos.y&&!this.isFixedAtTop){this.markup.dialogWrapper.addClassName("fixed");this.markup.dialogWrapper.setStyle({top:0});this.isFixedAtTop=true}}}}}}}this.lastScroll=A},inspectScrollData:function(B,A,D){var C="Lightbox.inspectScrollData:<br/>viewport.height: "+B.height+"<br/>scroll.y: "+A.y+"<br/>page.height: "+D.height+"<br/>this.markup.dialogWrapper.dim.height: "+this.markup.dialogWrapper.dim.height+"<br/>this.markup.dialogWrapper.pos.y: "+this.markup.dialogWrapper.pos.y+"<br/>this.markup.dialogWrapper.style.top: "+this.markup.dialogWrapper.style.top+"<br/>this.bottomOfDialog: "+this.bottomOfDialog+"<br/>this.dialogViewportDiff: "+this.dialogViewportDiff+"<br/>this.markup.dialogWrapper.className: "+this.markup.dialogWrapper.className+"<br/>this.isFixedAtTop: "+this.isFixedAtTop+"<br/>this.isFixedAtBottom: "+this.isFixedAtBottom+"<br/>this.positionFixedUnsupported: "+this.positionFixedUnsupported();if(this.lastScroll!=null){C="this.lastScroll.y: "+this.lastScroll.y+"<br/>"+C}log.info(C)},removeFromDOM:function(){this._removeFromDOM();this.layoutBuilt=false},destroy:function(){this.markup.mask.dim=null;this.markup.mask=this.markup.mask.destroy();this.removeFromDOM();this.closeEventObservers.clear();this.activated=null;this.isFixedAtBottom=null;this.isFixedAtTop=null;this.isOpen=null;this.lastScroll=null;this.managedEventObservers=null;this.options.closeLabel=null;this.options.heading=null;this.options.id=null;this.options.interstitial=null;this.options.sessionTimeoutUrl=null;this.options.triggerEvent=null;this.options.setUp=function(){};this.options.tearDown=function(){};this.positionFixedUnsupportedVal=null;this.layoutBuilt=null;this.content=null;this.response=null;this.triggers.clear()}});var ContainedLightbox=Class.create(Lightbox,{initialize:function($super,A,B,C){$super(A,B,C)},createMask:function(){var A=this.triggerContext.element.getHeight();this.markup.mask=Element.extend(document.createElement("div"));this.markup.mask.className="dialogMask";this.markup.mask.style.height=A+"px"},showMask:function(){if(this.markup.mask){this.allSelects=$A(this.triggerContext.element.getElementsByTagName("select")).each(function(C){C.style.visibility="hidden";return Element.extend(C)});this.triggerContext.activeDialogsContainer.appendChild(this.markup.mask);this.options.closeElements.push(this.markup.mask);this.markup.mask.style.display="block";for(var B=0,A=this.options.closeEvents.length;B<A;B++){this.closeEventObservers.add(document,this.options.closeEvents[B],this.close.bindAsEventListener(this))}this.closeEventObservers.add(this.markup.mask,"click",this.close.bindAsEventListener(this))}else{log.error("this.markup.mask doesn't exist")}},inspectTrigger:function(A){this.getTrigger(A);this.triggerContext={};this.triggerContext.element=this.trigger.up(this.options.container);this.triggerContext.activeDialogsContainer=new DialogPositioningContext(this.triggerContext.element).activeDialogContainer},positionInViewport:function(){var B=(this.markup.mask.getHeight()-this.markup.dialogWrapper.getHeight())/2;var A=(this.markup.mask.getWidth()-this.markup.dialogWrapper.getWidth())/2;this.markup.dialogWrapper.setStyle({top:B+"px",left:A+"px"})},resize:function(){this.positionInViewport()},appendToDOM:function($super){$super();var A=(this.triggerContext.element.getStyle("zIndex")||0);this.triggerContext.activeDialogsContainer.setStyle({zIndex:A+1});this.markup.mask.setStyle({zIndex:A+2});this.markup.dialogWrapper.setStyle({zIndex:A+3})},onWindowResize:function(){},onLightboxResize:function(){},onWindowScroll:function(){}});var ChangeSearchLightbox=Class.create(Lightbox,{initialize:function($super,A,B,C){$super(A,B,C);var D=this.content.url;if(D.indexOf("book")!=-1){this.content.url="/book/bookingpath"}else{this.content.url="/shop/searchForm"}D=D.substr(D.indexOf("?")+1);D=D.replace(/&amp(;|%3B)/g,"&");D=D.replace(/\+/g,"%20");D="changeSearch=true&"+D;this.options.ajaxParameters=D}});var DialogPositioningContext=Class.create({initialize:function(A){this.element=A;this.element.addClassName("dialogPositioningContext");this.activeDialogContainer=new Element("div",{"class":"activeDialogs"});this.element.appendChild(this.activeDialogContainer)}});var BaseOverlay=function(){BaseOverlay=function(){};BaseOverlay.prototype=Object.extend(new google.maps.OverlayView(),{getSize:function(){return new google.maps.Size(this.overlay.offsetWidth,this.overlay.offsetHeight)},getPixelBounds:function(D){var A=this.getProjection();if(A){var C=A[D?"fromLatLngToContainerPixel":"fromLatLngToDivPixel"](this.getPosition());var B=this.getSize();return{getNorthEast:function(){return this.getNorthEast(C,B)}.bind(this),getSouthWest:function(){return this.getSouthWest(C,B)}.bind(this),getCenter:function(){return this.getCenter(C,B)}.bind(this)}}},getBounds:function(){var A=this.getProjection();if(A){var B=this.getPixelBounds();return new google.maps.LatLngBounds(A.fromDivPixelToLatLng(B.getSouthWest()),A.fromDivPixelToLatLng(B.getNorthEast()))}},getNorthEast:function(B,A){return new google.maps.Point(B.x+(A.width/2),B.y-(A.height))},getSouthWest:function(B,A){return new google.maps.Point(B.x-(A.width/2),B.y)},getCenter:function(B,A){return new google.maps.Point(B.x,B.y-(A.height/2))},onAdd:function(){var A=this.getPane();A.insertBefore(this.overlay,A.firstChild);google.maps.event.trigger(this,"domready");return this},onRemove:function(){this.overlay.parentNode.removeChild(this.overlay);return this},draw:function(){if(!this.getPosition()){return}var B=this.getPixelBounds();if(B){var A=B.getSouthWest();this.overlay.style.left=A.x+"px";this.overlay.style.bottom=-A.y+"px"}return this},getDomListeners:function(){return this.domListeners||(this.domListeners=[])},addDomListener:function(C,A,B){if(/mouse(enter|leave)/.test(A)){var E=B;var D=this;B=function(F){Event.extend(F);if(F.relatedTarget===null||(C!==F.relatedTarget&&!Element.descendantOf(F.relatedTarget,C))){E.call(D,F)}};A=(A==="mouseenter")?"mouseover":"mouseout"}this.getDomListeners().push(google.maps.event.addDomListener(C,A,B))},clearListeners:function(){google.maps.event.clearInstanceListeners(this)},clearDomListeners:function(){var A=this.getDomListeners();while(A.length){google.maps.event.removeListener(A.shift())}},setPosition:function(A){this.set("position",A);return this},getPosition:function(){return this.get("position")},getVisible:function(){return this.get("visible")},setVisible:function(A){this.overlay.style.visibility=A?"visible":"hidden";this.set("visible",A);return this},addWebTrendsEventListener:function(B,A){B.writeAttribute("delegatedtracking","true");this.addDomListener(B,"click",function(C){google.maps.event.trigger(this,"webtrends",C)}.bind(this,A));return B},destroy:function(){this.clearListeners();this.clearDomListeners();this.setMap(null)}});return new BaseOverlay()};var MapInfoWindow=function(C,B){function A(D){Event.extend(D);D.stopPropagation()}MapInfoWindow=function(E,D){this.setProperties("MapInfoWindow",{},{closeLabel:D.closeLabel,heading:true});this.createDialogDivs();this.overlay=this.markup.dialogWrapper;this.overlay.appendChild(new Element("div",{"class":"microcontentBeakBottom"}));this.attachCloseListeners(this.close.bind(this));google.maps.event.addDomListener(this.overlay,"mousedown",A);google.maps.event.addDomListener(this.overlay,"mouseover",A);google.maps.event.addDomListener(this.overlay,"mouseout",A);this.content=D;this.setVisible(false);this.setMap(E);this.onAdd()};MapInfoWindow.prototype=Object.extend(new BaseOverlay(),Object.extend(Dialog.Base,{open:function(D,E){if(this.marker!==D){if(this.marker){google.maps.event.trigger(this,"marker_changed",this.marker)}this.setPosition(D.getPosition());this.marker=D;this.clearDomListeners();this.setHeader(E);this.populateInfoWindow(E);this.draw()}this.setVisible(true);this.getMap().panToBounds(this.getBounds())},close:function(){google.maps.event.trigger(this,"close");this.marker=null;this.setVisible(false)},setHeader:function(D){D.infoWindow.setHeader.call(this,D)},populateInfoWindow:function(D){D.infoWindow.populateInfoWindow.call(this,D)},enableStreetview:function(D){var E=new Element("li");var F=new Element("a",{"class":"link streetviewLink",href:"javascript:void(0);"}).update(this.content.streetviewLabel);this.addWebTrendsEventListener(F,"Streetview");this.markup.mainInfo.down(".infoWindowContent ul.pipedList").insert({bottom:E});E.insert({bottom:F});this.addDomListener(F,"click",function(){google.maps.event.trigger(this,"showStreetView",D)}.bind(this))},getPane:function(){return this.getPanes().floatPane},getNorthEast:function(F,E){if(this.marker){var D=this.marker.getPixelBounds();return new google.maps.Point(D.getCenter().x+(E.width/2),D.getNorthEast().y-(E.height))}return new google.maps.Point(0,0)},getSouthWest:function(F,E){if(this.marker){var D=this.marker.getPixelBounds();return new google.maps.Point(D.getCenter().x-(E.width/2),D.getNorthEast().y)}return new google.maps.Point(0,0)},destroy:function(){google.maps.event.clearInstanceListeners(this.overlay);this.closeEventObservers.clear();BaseOverlay.prototype.destroy.call(this)}}));return new MapInfoWindow(C,B)};var HotelMapInfoWindow={setHeader:function(D){var B=D.resultCardElement;this.markup.dialogTitle.innerHTML="";var A=new Element("h3");var E=B.down("a.hotelNameLink");if(E){this.addWebTrendsEventListener(A.appendChild(E.cloneNode(true)),"Hotel name");this.markup.dialogTitle.appendChild(A)}var C=B.down("img.stars");if(C){this.markup.dialogTitle.appendChild(C.cloneNode(true))}},populateInfoWindow:function(I){var G=I.resultCardElement;var J=new Element("div",{className:"infoWindowContent"});var F=new Element("div",{className:"price"});this.markup.mainInfo.innerHTML="";var D=G.down("a.thumbnail");if(D){this.addWebTrendsEventListener(this.markup.mainInfo.appendChild(D.cloneNode(true)),"Hotel photo")}var M=G.down("div.hotelPriceInfo");if(M){var K=$(M.cloneNode(true));var E=K.down(".totalPriceMicrocontentLink");if(E){E.replace(E.innerHTML)}F.appendChild(K)}var O=G.down("ul.hotelPriceDisclaimers");if(O){F.appendChild(O.cloneNode(true))}J.appendChild(F);var A=G.down(".hotelUserRatingsSummary");if(A){J.appendChild(A.cloneNode(true))}var L=new Element("UL",{"class":"pipedList"});var H=G.down("a.detailsLink");if(H){this.addWebTrendsEventListener(L.appendChild(new Element("LI").update(H.cloneNode(true))),"More hotel details")}J.appendChild(L);this.markup.mainInfo.appendChild(J);var C=G.down(".priceButtonLink");if(C){if(I.datedSearch){C=this.addWebTrendsEventListener(this.markup.mainInfo.appendChild(C.cloneNode(true)),(I.rate)?"Select":"Check rates")}else{C=this.addWebTrendsEventListener(this.markup.mainInfo.appendChild(C.cloneNode(true)),"Check availability")}var B=C.down("a[agent]");if(B){var P=B.getAgents()[0];if(P&&P.type=="MicrocontentAgent"){P.type="ContainedLightboxAgent";P.params.options.container=".resultsMap";P.params.options.closeEvents=["agent:updatingResults"];C.down("a[agent]").stopObserving();C.down("a[agent]").setAttribute("agent",Object.toJSON(P))}}}this.markup.mainInfo.descendants().each(function(Q){Q.removeAttribute("id")});Page.initializeDOMFragment(this.markup.mainInfo);GoogleMapUtil.getStreetView(this.getPosition(),this.enableStreetview.bind(this))}};var MapMarker=function(C){var A=new Element("DIV");var E=A.appendChild(new Element("DIV"));var B=E.appendChild(new Element("DIV"));var D=new Element("SPAN").setStyle({display:"none"});E.appendChild(new Element("DIV")).className="beakBorder";E.appendChild(new Element("DIV")).className="beak";A.className="mapMarker";E.className="content";B.className="label";A.style.position="absolute";MapMarker=function(F){if(arguments.length){this.init(F)}};MapMarker.prototype=Object.extend(new BaseOverlay(),{init:function(F){this.overlay=A.cloneNode(true);this.overlay.addClassName(F.type+"MapMarker");if(F.classes){this.overlay.addClassName(F.classes)}this.label=this.overlay.down("DIV.label");this.currentPageMarker=F.currentPage;this.type=F.type;if(F.label){this.setLabel(F.label)}else{if(!F.label&&(F.type==="Hotel"||F.type==="HpcHotel")){this.overlay.addClassName("marketMarker")}}this.setPosition(F.position);this.setMap(F.map);this.addDomListener(this.overlay,"mouseenter",function(G){G.stop();google.maps.event.trigger(this,"mouseover")}.bind(this));this.addDomListener(this.overlay,"mouseleave",function(G){G.stop();google.maps.event.trigger(this,"mouseout")}.bind(this));this.addDomListener(this.overlay,"click",function(G){google.maps.event.trigger(this,"click")}.bind(this))},getSize:function(){return this.size||(this.size=BaseOverlay.prototype.getSize.call(this))},setLabel:function(F){this.label.innerHTML=F},getPane:function(){return this.getPanes().overlayImage},focus:function(){if(this.focused){return}var F=this.getMap();mapDiv=F.getDiv();google.maps.event.addListener(F,"mousemove",function(){if(this.activeMarker){google.maps.event.trigger(this.activeMarker,"mouseout")}});D.style.left=this.overlay.style.left;D.style.bottom=this.overlay.style.bottom;this.getPane().replaceChild(D,this.overlay);mapDiv.parentNode.insertBefore(this.overlay,mapDiv);this.focused=true;var G=this.getPixelBounds(true);this.overlay.addClassName("mapMarkerHover");this.overlay.style.left=G.getSouthWest().x+"px";this.overlay.style.bottom=(mapDiv.offsetHeight-G.getSouthWest().y)+"px";F.activeMarker=this},blur:function(){if(!this.focused){return}var F=this.getMap();this.overlay.style.left=D.style.left;this.overlay.style.bottom=D.style.bottom;this.overlay.removeClassName("mapMarkerHover");this.getPane().replaceChild(this.overlay,D);this.focused=false;google.maps.event.clearListeners(F,"mousemove");F.activeMarker=null}});return new MapMarker(C)};var MarkerToolTip=function(C,A){var B=new Element("DIV");B.style.position="absolute";B.className="markerToolTip";MarkerToolTip=function(E,D){this.detailsLinkTemplate=D;this.overlay=B;this.setVisible(false);this.setMap(E);this.addDomListener(this.overlay,"mouseenter",function(F){F.stop();this.setVisible(true);this.marker.focus()}.bind(this));this.addDomListener(this.overlay,"mouseleave",function(F){F.stop();this.setVisible(false);this.marker.blur()}.bind(this));this.addDomListener(this.overlay,"click",function(F){google.maps.event.trigger(this.getMap(),"overlayClicked")}.bind(this))};MarkerToolTip.prototype=Object.extend(new BaseOverlay(),{open:function(D,E){this.marker=D;this.populateToolTip(E);this.setPosition(D.getPosition());this.draw();this.setVisible(true)},close:function(){this.setVisible(false)},populateToolTip:function(D){D.tooltip.populateToolTip.call(this,D)},getPane:function(){return this.getMap().getDiv().parentNode},getNorthEast:function(F,E){if(this.marker&&this.marker.getMap()){var D=this.marker.getPixelBounds();return new google.maps.Point(D.getNorthEast().x+E.width-5,D.getNorthEast().y-5)}return new google.maps.Point(0,0)},getSouthWest:function(F,E){if(this.marker&&this.marker.getMap()){var D=this.marker.getPixelBounds(true);return new google.maps.Point(D.getNorthEast().x-3,D.getNorthEast().y+(E.height-this.getMap().getDiv().offsetHeight-5))}return new google.maps.Point(0,0)}});return new MarkerToolTip(C,A)};var HotelMarkerToolTip={populateToolTip:function(B){if(!B.resultCardElement){var D=this.detailsLinkTemplate;var A=B.key?B.key:"";B.detailsURL=D.replace("<hid>",B.id).replace("<hkey>",A);B.agent=F?" data-agent ='"+F+"'":""}else{if(!B.name||!B.detailsURL){var E=B.resultCardElement.down("a.hotelNameLink");if(!B.detailsURL){B.detailsURL=E.href}var F=E.getAttribute("data-agent");B.agent=F?" data-agent ='"+F+"'":"";if(!B.name){B.name=E.innerHTML}}}var C='<strong class="name"><a href="'+B.detailsURL+'"'+B.agent+">"+B.name+"</a></strong>"+((B.stars)?'<img class="stars" src="/style/global/img/star'+B.stars+'.png" alt="'+B.stars+' stars" height="13" width="70" />':"")+((B.rating)?'<span class="rating"><strong><span>'+B.rating+"</span></strong></span>":"");this.overlay.update(C);Page.initializeDOMFragment(this.overlay)}};var LocationMarker=function(C){var A=new Element("DIV",{"class":"locationMapMarker"});var F=A.appendChild(new Element("DIV",{"class":"content"}));var B=F.appendChild(new Element("DIV",{"class":"label"}));B.innerHTML=C.label;var D=A.appendChild(new Element("DIV",{"class":"beak"}));A.style.position="absolute";var E=new Element("SPAN").setStyle({display:"none"});LocationMarker=function(G){this.init(G)};LocationMarker.prototype=Object.extend(new BaseOverlay(),{init:function(G){this.overlay=A.cloneNode(true);this.label=this.overlay.down(".label");this.setLabel(G.label);this.type=G.type;this.setPosition(G.position);this.setMap(G.map);this.addDomListener(this.overlay,"mouseenter",function(H){H.stop();google.maps.event.trigger(this,"mouseover")}.bind(this));this.addDomListener(this.overlay,"mouseleave",function(H){H.stop();google.maps.event.trigger(this,"mouseout")}.bind(this));this.addDomListener(this.overlay,"click",function(H){H.stop();google.maps.event.trigger(this,"click")}.bind(this))},getSize:function(){return this.size||(this.size=BaseOverlay.prototype.getSize.call(this))},getPane:function(){return this.getPanes().overlayImage},setLabel:function(G){this.label.innerHTML=G},focus:function(){if(this.focused){return}var G=this.getMap();mapDiv=G.getDiv();google.maps.event.addListener(G,"mousemove",function(){if(this.activeMarker){google.maps.event.trigger(this.activeMarker,"mouseout")}});E.style.left=this.overlay.style.left;E.style.bottom=this.overlay.style.bottom;this.getPane().replaceChild(E,this.overlay);mapDiv.parentNode.insertBefore(this.overlay,mapDiv);this.focused=true;var H=this.getPixelBounds(true);this.overlay.addClassName("locationMapMarkerHover");this.overlay.style.left=H.getSouthWest().x+"px";this.overlay.style.bottom=(mapDiv.offsetHeight-H.getSouthWest().y)+"px";G.activeMarker=this},blur:function(){if(!this.focused){return}var G=this.getMap();this.overlay.style.left=E.style.left;this.overlay.style.bottom=E.style.bottom;this.overlay.removeClassName("locationMapMarkerHover");this.getPane().replaceChild(this.overlay,E);this.focused=false;google.maps.event.clearListeners(G,"mousemove");G.activeMarker=null}});return new LocationMarker(C)};var LocationToolTip=function(B){var A=new Element("DIV");A.style.position="absolute";A.className="locationMarkerToolTip";LocationToolTip=function(C){this.overlay=A;this.setVisible(false);this.setMap(C);this.addDomListener(this.overlay,"mouseenter",function(D){D.stop();this.setVisible(true);this.marker.focus()}.bind(this));this.addDomListener(this.overlay,"mouseleave",function(D){D.stop();this.setVisible(false);this.marker.blur()}.bind(this));this.addDomListener(this.overlay,"click",this.clickEvent.bind(this));this.addDomListener(this.overlay,"click",function(D){google.maps.event.trigger(this.getMap(),"overlayClicked")}.bind(this))};LocationToolTip.prototype=Object.extend(new BaseOverlay(),{open:function(C,D){this.marker=C;this.populateToolTip(D);this.calculateSize();this.setPosition(C.getPosition());this.draw();this.setVisible(true)},close:function(){this.setVisible(false)},populateToolTip:function(C){C.tooltip.populateToolTip.call(this,C)},calculateSize:function(){var C=this.overlay.down(".ratings");if(C){var D=false;if(!this.overlay.parentNode||!this.overlay.parentNode.tagName){document.body.appendChild(this.overlay);D=true}this.overlay.style.width=C.offsetWidth+"px";if(D){document.body.removeChild(this.overlay)}}else{this.overlay.style.width=300+"px"}},clickEvent:function(){google.maps.event.trigger(this.marker,"click")},getPane:function(){return this.getMap().getDiv().parentNode},getNorthEast:function(E,D){if(this.marker&&this.marker.getMap()){var C=this.marker.getPixelBounds();return new google.maps.Point(C.getNorthEast().x+D.width-5,C.getNorthEast().y-5)}return new google.maps.Point(0,0)},getSouthWest:function(E,D){if(this.marker&&this.marker.getMap()){var C=this.marker.getPixelBounds(true);return new google.maps.Point(C.getCenter().x-(D.width/2),C.getNorthEast().y-this.getMap().getDiv().offsetHeight+3)}return new google.maps.Point(0,0)}});return new LocationToolTip(B)};var LocationMarkerToolTip={populateToolTip:function(D){var F="";if(D.locLongDesc){F='<div class="description">'+D.locLongDesc+"</div>";if(D.locTip){F+='<div class="locals"><div class="content">'+D.locTip+"</div></div>"}}if(D.ratingInfo&&D.ratingInfo.length){F+='<div class="ratings">';for(var E=0,A=D.ratingInfo.length;E<A;E++){var C=D.ratingInfo[E];var B="rating";if(E===0){B+=" first"}if(E===(A-1)){B+=" last"}F+='<div class="'+B+'">';F+=C.stars;if(C.rate){F+=C.rate}else{if(C.count){F+=D.hotelsText.replace("#",C.count)}else{F+="---"}}F+="</div>"}F+="</div>"}if(D.viewAllLinkText){F+='<div class="link"><a href="javascript:void();" class="viewAll">'+D.viewAllLinkText+"</a></div>"}this.overlay.update(F)}};var MapResultSetBase={load:function(){Event.observe(window,"load",function(){this.loadMap()}.bind(this));if(Page.onLoadFired){this.loadMap()}},commonInit:function(){this.resultCardsContainerId=(this.params.resultCardsContainerId?this.params.resultCardsContainerId:"main");this.resultSelectorForPopulatingMarker=(this.params.resultSelectorForPopulatingMarker?this.params.resultSelectorForPopulatingMarker:"div[data-map-info]");this.bigResultsMapContainerId=(this.params.bigResultsMapContainerId?this.params.bigResultsMapContainerId:"#main");Element.extend(document.body).down(this.bigResultsMapContainerId);this.disableInfoWindow=(this.params.disableInfoWindow?this.params.disableInfoWindow:false)},loadMap:function(){if(!this.loaded){this.loaded=true;GoogleMapAPILoader.load(this.mapLoadCallback.bind(this),this.params.locale)}},createMapMarkup:function(){},mapLoadCallback:function(){},getMapMarker:function(C){for(var B=0,A=this.data.length;B<A;B++){if(this.data[B].id==C){return this.markers[B]}}},getMainMarkerData:function(setBounds){var result;var bounds=new google.maps.LatLngBounds();var current=$(this.resultCardsContainerId).select(this.resultSelectorForPopulatingMarker).collect(function(el){var datum=el.getAttribute("data-map-info").evalJSON();datum.resultCardElement=el;datum.currentPage=true;if(setBounds){bounds.extend(new google.maps.LatLng(datum.lat,datum.lng))}return datum});if(setBounds){this.bounds=bounds}var extraMarkers=$("mapInfo");if(extraMarkers){current=current.concat(eval("(["+extraMarkers.innerHTML+"])"))}return current},clearMapMarkers:function(){var A=this.markers||[];while(A.length){A.shift().destroy()}if(this.tooltip){this.tooltip.marker=null;this.tooltip.destroy();this.tooltip=null}this.bounds=null;this.markers=null;this.data=null},resetMap:function(){if(this.infoWindowVisible){this.getInfoWindow().close()}if(this.streetViewVisible){this.hideStreetView()}if(this.tooltip){this.tooltip.close()}google.maps.event.trigger(this.map,"resize")},handleCloseZoom:function(){var A=this.map;google.maps.event.addListenerOnce(A,"bounds_changed",function(){if(A.getZoom()>17){A.setZoom(17)}})},onUnload:function(){if(this.infoWindow){this.infoWindow.destroy()}if(this.tooltip){this.tooltip.destroy()}this.clearMapMarkers()},getInfoWindow:function(){return this.infoWindow||(this.infoWindow=function(){var A=new MapInfoWindow(this.map,this.params.infoWindowData);google.maps.event.addListener(A,"showStreetView",this.showStreetView.bind(this));google.maps.event.addListener(A,"visible_changed",function(){this.infoWindowVisible=A.getVisible()}.bind(this));google.maps.event.addListener(A,"close",function(){this.marker.overlay.removeClassName("mapMarkerCurrent")});google.maps.event.addListener(A,"marker_changed",function(B){B.overlay.removeClassName("mapMarkerCurrent")});google.maps.event.addListener(A,"webtrends",function(B){this.fireWebTrendsEvent(B)}.bind(this));return A}.call(this))},getMarkerTooltip:function(){return this.tooltip||(this.tooltip=new MarkerToolTip(this.map,this.params.detailsLinkTemplate))},getStreetView:function(){return this.streetview||(this.streetview=function(){var A={panorama:this.map.getStreetView(),backToMapLink:new Element("A",{"class":"link backToMapLink",href:"javascript:void(0)"}).update(this.infoWindowData.switchToMapText).observe("click",function(){this.hideStreetView();this.fireWebTrendsEvent("Back to map")}.bind(this))};A.panorama.setOptions({enableCloseButton:false});google.maps.event.addListener(A.panorama,"visible_changed",function(){this.streetViewVisible=A.panorama.getVisible()}.bind(this));return A}.call(this))},hideStreetView:function(){var A=this.getStreetView();A.backToMapLink.remove();A.panorama.setVisible(false);A.panorama.setPosition(null);A.panorama.setPov(null)},showStreetView:function(C){var B=this.getStreetView();var A=B.panorama;this.headerWrapper.appendChild(B.backToMapLink);A.setPosition(C.location.latLng);A.setPov({heading:GoogleMapUtil.calculateBearing(C.location.latLng,this.getInfoWindow().getPosition()),pitch:3,zoom:1});A.setVisible(true)},markerClick:function(B,A){if(this.disableInfoWindow){return false}var C=this.data[B.id];this.getInfoWindow().open(B,C);B.overlay.addClassName("mapMarkerCurrent");if(this.tooltip){this.getMarkerTooltip().close()}if(A){this.fireWebTrendsEvent(C.type+" pin")}},markerMouseover:function(A){var B=this.data[A.id];A.overlay.addClassName("mapMarkerHover");if(this.getMarkerTooltip()){this.getMarkerTooltip().open(A,B)}},markerMouseout:function(A){A.overlay.removeClassName("mapMarkerHover");if(this.tooltip){this.getMarkerTooltip().close()}},markerVisited:function(A){A.overlay.addClassName("mapMarkerVisited")},fireWebTrendsEvent:function(B,A){var C={"DCSext.wtNav":"srmap","DCSext.srmap":1,"WT.dl":1,"WT.ti":B};Object.extend(C,A||{});this.element.fire("webtrends:multiTrackEvent",C)}};
/* unicode_hack.js
	Copyright (C) 2010-2012  Marcelo Gibson de Castro Gonçalves. All rights reserved.
	
	Copying and distribution of this file, with or without modification,
	are permitted in any medium without royalty provided the copyright
	notice and this notice are preserved.  This file is offered as-is,
	without any warranty.
*/
var UnicodeRegEx=(function(){var C={Pi:"[\u00ab\u2018\u201b\u201c\u201f\u2039\u2e02\u2e04\u2e09\u2e0c\u2e1c]",Sk:"[\u005e\u0060\u00a8\u00af\u00b4\u00b8\u02c2-\u02c5\u02d2-\u02df\u02e5-\u02ed\u02ef-\u02ff\u0374\u0375\u0384\u0385\u1fbd\u1fbf-\u1fc1\u1fcd-\u1fcf\u1fdd-\u1fdf\u1fed-\u1fef\u1ffd\u1ffe\u309b\u309c\ua700-\ua716\ua720\ua721\uff3e\uff40\uffe3]",Sm:"[\u002b\u003c-\u003e\u007c\u007e\u00ac\u00b1\u00d7\u00f7\u03f6\u2044\u2052\u207a-\u207c\u208a-\u208c\u2140-\u2144\u214b\u2190-\u2194\u219a\u219b\u21a0\u21a3\u21a6\u21ae\u21ce\u21cf\u21d2\u21d4\u21f4-\u22ff\u2308-\u230b\u2320\u2321\u237c\u239b-\u23b3\u23dc-\u23e1\u25b7\u25c1\u25f8-\u25ff\u266f\u27c0-\u27c4\u27c7-\u27ca\u27d0-\u27e5\u27f0-\u27ff\u2900-\u2982\u2999-\u29d7\u29dc-\u29fb\u29fe-\u2aff\ufb29\ufe62\ufe64-\ufe66\uff0b\uff1c-\uff1e\uff5c\uff5e\uffe2\uffe9-\uffec]",So:"[\u00a6\u00a7\u00a9\u00ae\u00b0\u00b6\u0482\u060e\u060f\u06e9\u06fd\u06fe\u07f6\u09fa\u0b70\u0bf3-\u0bf8\u0bfa\u0cf1\u0cf2\u0f01-\u0f03\u0f13-\u0f17\u0f1a-\u0f1f\u0f34\u0f36\u0f38\u0fbe-\u0fc5\u0fc7-\u0fcc\u0fcf\u1360\u1390-\u1399\u1940\u19e0-\u19ff\u1b61-\u1b6a\u1b74-\u1b7c\u2100\u2101\u2103-\u2106\u2108\u2109\u2114\u2116-\u2118\u211e-\u2123\u2125\u2127\u2129\u212e\u213a\u213b\u214a\u214c\u214d\u2195-\u2199\u219c-\u219f\u21a1\u21a2\u21a4\u21a5\u21a7-\u21ad\u21af-\u21cd\u21d0\u21d1\u21d3\u21d5-\u21f3\u2300-\u2307\u230c-\u231f\u2322-\u2328\u232b-\u237b\u237d-\u239a\u23b4-\u23db\u23e2-\u23e7\u2400-\u2426\u2440-\u244a\u249c-\u24e9\u2500-\u25b6\u25b8-\u25c0\u25c2-\u25f7\u2600-\u266e\u2670-\u269c\u26a0-\u26b2\u2701-\u2704\u2706-\u2709\u270c-\u2727\u2729-\u274b\u274d\u274f-\u2752\u2756\u2758-\u275e\u2761-\u2767\u2794\u2798-\u27af\u27b1-\u27be\u2800-\u28ff\u2b00-\u2b1a\u2b20-\u2b23\u2ce5-\u2cea\u2e80-\u2e99\u2e9b-\u2ef3\u2f00-\u2fd5\u2ff0-\u2ffb\u3004\u3012\u3013\u3020\u3036\u3037\u303e\u303f\u3190\u3191\u3196-\u319f\u31c0-\u31cf\u3200-\u321e\u322a-\u3243\u3250\u3260-\u327f\u328a-\u32b0\u32c0-\u32fe\u3300-\u33ff\u4dc0-\u4dff\ua490-\ua4c6\ua828-\ua82b\ufdfd\uffe4\uffe8\uffed\uffee\ufffc\ufffd]",Po:"[\u0021-\u0023\u0025-\u0027\u002a\u002c\u002e\u002f\u003a\u003b\u003f\u0040\u005c\u00a1\u00b7\u00bf\u037e\u0387\u055a-\u055f\u0589\u05be\u05c0\u05c3\u05c6\u05f3\u05f4\u060c\u060d\u061b\u061e\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964\u0965\u0970\u0df4\u0e4f\u0e5a\u0e5b\u0f04-\u0f12\u0f85\u0fd0\u0fd1\u104a-\u104f\u10fb\u1361-\u1368\u166d\u166e\u16eb-\u16ed\u1735\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u1805\u1807-\u180a\u1944\u1945\u19de\u19df\u1a1e\u1a1f\u1b5a-\u1b60\u2016\u2017\u2020-\u2027\u2030-\u2038\u203b-\u203e\u2041-\u2043\u2047-\u2051\u2053\u2055-\u205e\u2cf9-\u2cfc\u2cfe\u2cff\u2e00\u2e01\u2e06-\u2e08\u2e0b\u2e0e-\u2e16\u3001-\u3003\u303d\u30fb\ua874-\ua877\ufe10-\ufe16\ufe19\ufe30\ufe45\ufe46\ufe49-\ufe4c\ufe50-\ufe52\ufe54-\ufe57\ufe5f-\ufe61\ufe68\ufe6a\ufe6b\uff01-\uff03\uff05-\uff07\uff0a\uff0c\uff0e\uff0f\uff1a\uff1b\uff1f\uff20\uff3c\uff61\uff64\uff65]",Mn:"[\u0300-\u036f\u0483-\u0486\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u0615\u064b-\u065e\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0901\u0902\u093c\u0941-\u0948\u094d\u0951-\u0954\u0962\u0963\u0981\u09bc\u09c1-\u09c4\u09cd\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a70\u0a71\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3f\u0b41-\u0b43\u0b4d\u0b56\u0b82\u0bc0\u0bcd\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0cbc\u0cbf\u0cc6\u0ccc\u0ccd\u0ce2\u0ce3\u0d41-\u0d43\u0d4d\u0dca\u0dd2-\u0dd4\u0dd6\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032\u1036\u1037\u1039\u1058\u1059\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1dc0-\u1dca\u1dfe\u1dff\u20d0-\u20dc\u20e1\u20e5-\u20ef\u302a-\u302f\u3099\u309a\ua806\ua80b\ua825\ua826\ufb1e\ufe00-\ufe0f\ufe20-\ufe23]",Ps:"[\u0028\u005b\u007b\u0f3a\u0f3c\u169b\u201a\u201e\u2045\u207d\u208d\u2329\u2768\u276a\u276c\u276e\u2770\u2772\u2774\u27c5\u27e6\u27e8\u27ea\u2983\u2985\u2987\u2989\u298b\u298d\u298f\u2991\u2993\u2995\u2997\u29d8\u29da\u29fc\u3008\u300a\u300c\u300e\u3010\u3014\u3016\u3018\u301a\u301d\ufd3e\ufe17\ufe35\ufe37\ufe39\ufe3b\ufe3d\ufe3f\ufe41\ufe43\ufe47\ufe59\ufe5b\ufe5d\uff08\uff3b\uff5b\uff5f\uff62]",Cc:"[\u0000-\u001f\u007f-\u009f]",Cf:"[\u00ad\u0600-\u0603\u06dd\u070f\u17b4\u17b5\u200b-\u200f\u202a-\u202e\u2060-\u2063\u206a-\u206f\ufeff\ufff9-\ufffb]",Ll:"[\u0061-\u007a\u00aa\u00b5\u00ba\u00df-\u00f6\u00f8-\u00ff\u0101\u0103\u0105\u0107\u0109\u010b\u010d\u010f\u0111\u0113\u0115\u0117\u0119\u011b\u011d\u011f\u0121\u0123\u0125\u0127\u0129\u012b\u012d\u012f\u0131\u0133\u0135\u0137\u0138\u013a\u013c\u013e\u0140\u0142\u0144\u0146\u0148\u0149\u014b\u014d\u014f\u0151\u0153\u0155\u0157\u0159\u015b\u015d\u015f\u0161\u0163\u0165\u0167\u0169\u016b\u016d\u016f\u0171\u0173\u0175\u0177\u017a\u017c\u017e-\u0180\u0183\u0185\u0188\u018c\u018d\u0192\u0195\u0199-\u019b\u019e\u01a1\u01a3\u01a5\u01a8\u01aa\u01ab\u01ad\u01b0\u01b4\u01b6\u01b9\u01ba\u01bd-\u01bf\u01c6\u01c9\u01cc\u01ce\u01d0\u01d2\u01d4\u01d6\u01d8\u01da\u01dc\u01dd\u01df\u01e1\u01e3\u01e5\u01e7\u01e9\u01eb\u01ed\u01ef\u01f0\u01f3\u01f5\u01f9\u01fb\u01fd\u01ff\u0201\u0203\u0205\u0207\u0209\u020b\u020d\u020f\u0211\u0213\u0215\u0217\u0219\u021b\u021d\u021f\u0221\u0223\u0225\u0227\u0229\u022b\u022d\u022f\u0231\u0233-\u0239\u023c\u023f\u0240\u0242\u0247\u0249\u024b\u024d\u024f-\u0293\u0295-\u02af\u037b-\u037d\u0390\u03ac-\u03ce\u03d0\u03d1\u03d5-\u03d7\u03d9\u03db\u03dd\u03df\u03e1\u03e3\u03e5\u03e7\u03e9\u03eb\u03ed\u03ef-\u03f3\u03f5\u03f8\u03fb\u03fc\u0430-\u045f\u0461\u0463\u0465\u0467\u0469\u046b\u046d\u046f\u0471\u0473\u0475\u0477\u0479\u047b\u047d\u047f\u0481\u048b\u048d\u048f\u0491\u0493\u0495\u0497\u0499\u049b\u049d\u049f\u04a1\u04a3\u04a5\u04a7\u04a9\u04ab\u04ad\u04af\u04b1\u04b3\u04b5\u04b7\u04b9\u04bb\u04bd\u04bf\u04c2\u04c4\u04c6\u04c8\u04ca\u04cc\u04ce\u04cf\u04d1\u04d3\u04d5\u04d7\u04d9\u04db\u04dd\u04df\u04e1\u04e3\u04e5\u04e7\u04e9\u04eb\u04ed\u04ef\u04f1\u04f3\u04f5\u04f7\u04f9\u04fb\u04fd\u04ff\u0501\u0503\u0505\u0507\u0509\u050b\u050d\u050f\u0511\u0513\u0561-\u0587\u1d00-\u1d2b\u1d62-\u1d77\u1d79-\u1d9a\u1e01\u1e03\u1e05\u1e07\u1e09\u1e0b\u1e0d\u1e0f\u1e11\u1e13\u1e15\u1e17\u1e19\u1e1b\u1e1d\u1e1f\u1e21\u1e23\u1e25\u1e27\u1e29\u1e2b\u1e2d\u1e2f\u1e31\u1e33\u1e35\u1e37\u1e39\u1e3b\u1e3d\u1e3f\u1e41\u1e43\u1e45\u1e47\u1e49\u1e4b\u1e4d\u1e4f\u1e51\u1e53\u1e55\u1e57\u1e59\u1e5b\u1e5d\u1e5f\u1e61\u1e63\u1e65\u1e67\u1e69\u1e6b\u1e6d\u1e6f\u1e71\u1e73\u1e75\u1e77\u1e79\u1e7b\u1e7d\u1e7f\u1e81\u1e83\u1e85\u1e87\u1e89\u1e8b\u1e8d\u1e8f\u1e91\u1e93\u1e95-\u1e9b\u1ea1\u1ea3\u1ea5\u1ea7\u1ea9\u1eab\u1ead\u1eaf\u1eb1\u1eb3\u1eb5\u1eb7\u1eb9\u1ebb\u1ebd\u1ebf\u1ec1\u1ec3\u1ec5\u1ec7\u1ec9\u1ecb\u1ecd\u1ecf\u1ed1\u1ed3\u1ed5\u1ed7\u1ed9\u1edb\u1edd\u1edf\u1ee1\u1ee3\u1ee5\u1ee7\u1ee9\u1eeb\u1eed\u1eef\u1ef1\u1ef3\u1ef5\u1ef7\u1ef9\u1f00-\u1f07\u1f10-\u1f15\u1f20-\u1f27\u1f30-\u1f37\u1f40-\u1f45\u1f50-\u1f57\u1f60-\u1f67\u1f70-\u1f7d\u1f80-\u1f87\u1f90-\u1f97\u1fa0-\u1fa7\u1fb0-\u1fb4\u1fb6\u1fb7\u1fbe\u1fc2-\u1fc4\u1fc6\u1fc7\u1fd0-\u1fd3\u1fd6\u1fd7\u1fe0-\u1fe7\u1ff2-\u1ff4\u1ff6\u1ff7\u2071\u207f\u210a\u210e\u210f\u2113\u212f\u2134\u2139\u213c\u213d\u2146-\u2149\u214e\u2184\u2c30-\u2c5e\u2c61\u2c65\u2c66\u2c68\u2c6a\u2c6c\u2c74\u2c76\u2c77\u2c81\u2c83\u2c85\u2c87\u2c89\u2c8b\u2c8d\u2c8f\u2c91\u2c93\u2c95\u2c97\u2c99\u2c9b\u2c9d\u2c9f\u2ca1\u2ca3\u2ca5\u2ca7\u2ca9\u2cab\u2cad\u2caf\u2cb1\u2cb3\u2cb5\u2cb7\u2cb9\u2cbb\u2cbd\u2cbf\u2cc1\u2cc3\u2cc5\u2cc7\u2cc9\u2ccb\u2ccd\u2ccf\u2cd1\u2cd3\u2cd5\u2cd7\u2cd9\u2cdb\u2cdd\u2cdf\u2ce1\u2ce3\u2ce4\u2d00-\u2d25\ufb00-\ufb06\ufb13-\ufb17\uff41-\uff5a]",Lm:"[\u02b0-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ee\u037a\u0559\u0640\u06e5\u06e6\u07f4\u07f5\u07fa\u0e46\u0ec6\u10fc\u17d7\u1843\u1d2c-\u1d61\u1d78\u1d9b-\u1dbf\u2090-\u2094\u2d6f\u3005\u3031-\u3035\u303b\u309d\u309e\u30fc-\u30fe\ua015\ua717-\ua71a\uff70\uff9e\uff9f]",Lo:"[\u01bb\u01c0-\u01c3\u0294\u05d0-\u05ea\u05f0-\u05f2\u0621-\u063a\u0641-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u076d\u0780-\u07a5\u07b1\u07ca-\u07ea\u0904-\u0939\u093d\u0950\u0958-\u0961\u097b-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d28\u0d2a-\u0d39\u0d60\u0d61\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e45\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0edc\u0edd\u0f00\u0f40-\u0f47\u0f49-\u0f6a\u0f88-\u0f8b\u1000-\u1021\u1023-\u1027\u1029\u102a\u1050-\u1055\u10d0-\u10fa\u1100-\u1159\u115f-\u11a2\u11a8-\u11f9\u1200-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u1676\u1681-\u169a\u16a0-\u16ea\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17dc\u1820-\u1842\u1844-\u1877\u1880-\u18a8\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19a9\u19c1-\u19c7\u1a00-\u1a16\u1b05-\u1b33\u1b45-\u1b4b\u2135-\u2138\u2d30-\u2d65\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3006\u303c\u3041-\u3096\u309f\u30a1-\u30fa\u30ff\u3105-\u312c\u3131-\u318e\u31a0-\u31b7\u31f0-\u31ff\u3400\u4db5\u4e00\u9fbb\ua000-\ua014\ua016-\ua48c\ua800\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\uac00\ud7a3\uf900-\ufa2d\ufa30-\ufa6a\ufa70-\ufad9\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff66-\uff6f\uff71-\uff9d\uffa0-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]",Co:"[\ue000\uf8ff]",Nd:"[\u0030-\u0039\u0660-\u0669\u06f0-\u06f9\u07c0-\u07c9\u0966-\u096f\u09e6-\u09ef\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0be6-\u0bef\u0c66-\u0c6f\u0ce6-\u0cef\u0d66-\u0d6f\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f29\u1040-\u1049\u17e0-\u17e9\u1810-\u1819\u1946-\u194f\u19d0-\u19d9\u1b50-\u1b59\uff10-\uff19]",Lt:"[\u01c5\u01c8\u01cb\u01f2\u1f88-\u1f8f\u1f98-\u1f9f\u1fa8-\u1faf\u1fbc\u1fcc\u1ffc]",Lu:"[\u0041-\u005a\u00c0-\u00d6\u00d8-\u00de\u0100\u0102\u0104\u0106\u0108\u010a\u010c\u010e\u0110\u0112\u0114\u0116\u0118\u011a\u011c\u011e\u0120\u0122\u0124\u0126\u0128\u012a\u012c\u012e\u0130\u0132\u0134\u0136\u0139\u013b\u013d\u013f\u0141\u0143\u0145\u0147\u014a\u014c\u014e\u0150\u0152\u0154\u0156\u0158\u015a\u015c\u015e\u0160\u0162\u0164\u0166\u0168\u016a\u016c\u016e\u0170\u0172\u0174\u0176\u0178\u0179\u017b\u017d\u0181\u0182\u0184\u0186\u0187\u0189-\u018b\u018e-\u0191\u0193\u0194\u0196-\u0198\u019c\u019d\u019f\u01a0\u01a2\u01a4\u01a6\u01a7\u01a9\u01ac\u01ae\u01af\u01b1-\u01b3\u01b5\u01b7\u01b8\u01bc\u01c4\u01c7\u01ca\u01cd\u01cf\u01d1\u01d3\u01d5\u01d7\u01d9\u01db\u01de\u01e0\u01e2\u01e4\u01e6\u01e8\u01ea\u01ec\u01ee\u01f1\u01f4\u01f6-\u01f8\u01fa\u01fc\u01fe\u0200\u0202\u0204\u0206\u0208\u020a\u020c\u020e\u0210\u0212\u0214\u0216\u0218\u021a\u021c\u021e\u0220\u0222\u0224\u0226\u0228\u022a\u022c\u022e\u0230\u0232\u023a\u023b\u023d\u023e\u0241\u0243-\u0246\u0248\u024a\u024c\u024e\u0386\u0388-\u038a\u038c\u038e\u038f\u0391-\u03a1\u03a3-\u03ab\u03d2-\u03d4\u03d8\u03da\u03dc\u03de\u03e0\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03f9\u03fa\u03fd-\u042f\u0460\u0462\u0464\u0466\u0468\u046a\u046c\u046e\u0470\u0472\u0474\u0476\u0478\u047a\u047c\u047e\u0480\u048a\u048c\u048e\u0490\u0492\u0494\u0496\u0498\u049a\u049c\u049e\u04a0\u04a2\u04a4\u04a6\u04a8\u04aa\u04ac\u04ae\u04b0\u04b2\u04b4\u04b6\u04b8\u04ba\u04bc\u04be\u04c0\u04c1\u04c3\u04c5\u04c7\u04c9\u04cb\u04cd\u04d0\u04d2\u04d4\u04d6\u04d8\u04da\u04dc\u04de\u04e0\u04e2\u04e4\u04e6\u04e8\u04ea\u04ec\u04ee\u04f0\u04f2\u04f4\u04f6\u04f8\u04fa\u04fc\u04fe\u0500\u0502\u0504\u0506\u0508\u050a\u050c\u050e\u0510\u0512\u0531-\u0556\u10a0-\u10c5\u1e00\u1e02\u1e04\u1e06\u1e08\u1e0a\u1e0c\u1e0e\u1e10\u1e12\u1e14\u1e16\u1e18\u1e1a\u1e1c\u1e1e\u1e20\u1e22\u1e24\u1e26\u1e28\u1e2a\u1e2c\u1e2e\u1e30\u1e32\u1e34\u1e36\u1e38\u1e3a\u1e3c\u1e3e\u1e40\u1e42\u1e44\u1e46\u1e48\u1e4a\u1e4c\u1e4e\u1e50\u1e52\u1e54\u1e56\u1e58\u1e5a\u1e5c\u1e5e\u1e60\u1e62\u1e64\u1e66\u1e68\u1e6a\u1e6c\u1e6e\u1e70\u1e72\u1e74\u1e76\u1e78\u1e7a\u1e7c\u1e7e\u1e80\u1e82\u1e84\u1e86\u1e88\u1e8a\u1e8c\u1e8e\u1e90\u1e92\u1e94\u1ea0\u1ea2\u1ea4\u1ea6\u1ea8\u1eaa\u1eac\u1eae\u1eb0\u1eb2\u1eb4\u1eb6\u1eb8\u1eba\u1ebc\u1ebe\u1ec0\u1ec2\u1ec4\u1ec6\u1ec8\u1eca\u1ecc\u1ece\u1ed0\u1ed2\u1ed4\u1ed6\u1ed8\u1eda\u1edc\u1ede\u1ee0\u1ee2\u1ee4\u1ee6\u1ee8\u1eea\u1eec\u1eee\u1ef0\u1ef2\u1ef4\u1ef6\u1ef8\u1f08-\u1f0f\u1f18-\u1f1d\u1f28-\u1f2f\u1f38-\u1f3f\u1f48-\u1f4d\u1f59\u1f5b\u1f5d\u1f5f\u1f68-\u1f6f\u1fb8-\u1fbb\u1fc8-\u1fcb\u1fd8-\u1fdb\u1fe8-\u1fec\u1ff8-\u1ffb\u2102\u2107\u210b-\u210d\u2110-\u2112\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u2130-\u2133\u213e\u213f\u2145\u2183\u2c00-\u2c2e\u2c60\u2c62-\u2c64\u2c67\u2c69\u2c6b\u2c75\u2c80\u2c82\u2c84\u2c86\u2c88\u2c8a\u2c8c\u2c8e\u2c90\u2c92\u2c94\u2c96\u2c98\u2c9a\u2c9c\u2c9e\u2ca0\u2ca2\u2ca4\u2ca6\u2ca8\u2caa\u2cac\u2cae\u2cb0\u2cb2\u2cb4\u2cb6\u2cb8\u2cba\u2cbc\u2cbe\u2cc0\u2cc2\u2cc4\u2cc6\u2cc8\u2cca\u2ccc\u2cce\u2cd0\u2cd2\u2cd4\u2cd6\u2cd8\u2cda\u2cdc\u2cde\u2ce0\u2ce2\uff21-\uff3a]",Cs:"[\ud800\udb7f\udb80\udbff\udc00\udfff]",Zl:"[\u2028]",Nl:"[\u16ee-\u16f0\u2160-\u2182\u3007\u3021-\u3029\u3038-\u303a]",Zp:"[\u2029]",No:"[\u00b2\u00b3\u00b9\u00bc-\u00be\u09f4-\u09f9\u0bf0-\u0bf2\u0f2a-\u0f33\u1369-\u137c\u17f0-\u17f9\u2070\u2074-\u2079\u2080-\u2089\u2153-\u215f\u2460-\u249b\u24ea-\u24ff\u2776-\u2793\u2cfd\u3192-\u3195\u3220-\u3229\u3251-\u325f\u3280-\u3289\u32b1-\u32bf]",Zs:"[\u0020\u00a0\u1680\u180e\u2000-\u200a\u202f\u205f\u3000]",Sc:"[\u0024\u00a2-\u00a5\u060b\u09f2\u09f3\u0af1\u0bf9\u0e3f\u17db\u20a0-\u20b5\ufdfc\ufe69\uff04\uffe0\uffe1\uffe5\uffe6]",Pc:"[\u005f\u203f\u2040\u2054\ufe33\ufe34\ufe4d-\ufe4f\uff3f]",Pd:"[\u002d\u058a\u1806\u2010-\u2015\u2e17\u301c\u3030\u30a0\ufe31\ufe32\ufe58\ufe63\uff0d]",Pe:"[\u0029\u005d\u007d\u0f3b\u0f3d\u169c\u2046\u207e\u208e\u232a\u2769\u276b\u276d\u276f\u2771\u2773\u2775\u27c6\u27e7\u27e9\u27eb\u2984\u2986\u2988\u298a\u298c\u298e\u2990\u2992\u2994\u2996\u2998\u29d9\u29db\u29fd\u3009\u300b\u300d\u300f\u3011\u3015\u3017\u3019\u301b\u301e\u301f\ufd3f\ufe18\ufe36\ufe38\ufe3a\ufe3c\ufe3e\ufe40\ufe42\ufe44\ufe48\ufe5a\ufe5c\ufe5e\uff09\uff3d\uff5d\uff60\uff63]",Pf:"[\u00bb\u2019\u201d\u203a\u2e03\u2e05\u2e0a\u2e0d\u2e1d]",Me:"[\u0488\u0489\u06de\u20dd-\u20e0\u20e2-\u20e4]",Mc:"[\u0903\u093e-\u0940\u0949-\u094c\u0982\u0983\u09be-\u09c0\u09c7\u09c8\u09cb\u09cc\u09d7\u0a03\u0a3e-\u0a40\u0a83\u0abe-\u0ac0\u0ac9\u0acb\u0acc\u0b02\u0b03\u0b3e\u0b40\u0b47\u0b48\u0b4b\u0b4c\u0b57\u0bbe\u0bbf\u0bc1\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcc\u0bd7\u0c01-\u0c03\u0c41-\u0c44\u0c82\u0c83\u0cbe\u0cc0-\u0cc4\u0cc7\u0cc8\u0cca\u0ccb\u0cd5\u0cd6\u0d02\u0d03\u0d3e-\u0d40\u0d46-\u0d48\u0d4a-\u0d4c\u0d57\u0d82\u0d83\u0dcf-\u0dd1\u0dd8-\u0ddf\u0df2\u0df3\u0f3e\u0f3f\u0f7f\u102c\u1031\u1038\u1056\u1057\u17b6\u17be-\u17c5\u17c7\u17c8\u1923-\u1926\u1929-\u192b\u1930\u1931\u1933-\u1938\u19b0-\u19c0\u19c8\u19c9\u1a19-\u1a1b\u1b04\u1b35\u1b3b\u1b3d-\u1b41\u1b43\u1b44\ua802\ua823\ua824\ua827]"};var B={};for(var A in C){if(B[A[0]]){B[A[0]]=C[A].substring(0,C[A].length-1)+B[A[0]].substring(1)}else{B[A[0]]=C[A]}}for(var A in B){C[A]=B[A]}return function(E){var D="";if(E instanceof RegExp){D=(E.global?"g":"")+(E.ignoreCase?"i":"")+(E.multiline?"m":"");E=E.source}E=E.replace(/\\p\{(..?)\}/g,function(F,G){return C[G]||F});return new RegExp(E,D)}})();var OnlineOpinion=new Object();OnlineOpinion.util={SafeAddOnLoadEvent:function(B){if(!document.getElementById|!document.getElementsByTagName){return}var A=window.onload;if(typeof window.onload!="function"){window.onload=B}else{window.onload=function(){A();B()}}},SafeAddOnUnLoadEvent:function(A){if(!document.getElementById|!document.getElementsByTagName){return}var B=window.onunload;if(typeof window.onunload!="function"){window.onunload=A}else{window.onunload=function(){A();B()}}},popup:function(E,A,B){var D=window.open(E,A,B);if(typeof D=="undefined"){if(document.all){document.getElementById("test").href=E;document.getElementById("test").click()}else{var C=window.open(E,"_blank");C.focus()}}return false},walkAnchors:function(G,E,H,B){var F=1000;var D=0;while(G&&E>0){D++;if(D>=F){var A=function(){OnlineOpinion.util.walkAnchors(G,E,H,B)};setTimeout(A,50);return}if(G.tagName=="A"){if(H.test(G.href)){G.onmousedown=function(){B.Preferences.Plugins.Events.poX=0}}}if(G.tagName=="INPUT"){if(G.type=="submit"||G.type=="image"){G.onmousedown=function(){B.Preferences.Plugins.Events.poX=0}}}if(G.tagName=="FORM"){if(typeof G.onsubmit!="function"){G.onsubmit=function(){B.Preferences.Plugins.Events.poX=0}}else{var I=G.onsubmit;G.onsubmit=function(){B.Preferences.Plugins.Events.poX=0;I()}}}if(G.nodeType==1){var C=/^(script|style|textarea)/i;if(!C.test(G.tagName)&&G.childNodes.length>0){G=G.childNodes[0];E++;continue}}if(G.nextSibling){G=G.nextSibling}else{while(E>0){G=G.parentNode;E--;if(G==null){break}if(G.nextSibling){G=G.nextSibling;break}}}}}};OnlineOpinion.cookie=function(){this.cookie_name="oo_r";this.expiration=24*60*60*1000;this.rhex=function(num){var hex_chr="0123456789abcdef",_s="";for(var j=0;j<=3;j++){_s+=hex_chr.charAt((num>>(j*8+4))&15)+hex_chr.charAt((num>>(j*8))&15)}return _s};this.str2blks_MD5=function(_s){var nblk=((_s.length+8)>>6)+1,blks=new Array(nblk*16);var i=0;for(;i<nblk*16;i++){blks[i]=0}for(i=0;i<_s.length;i++){blks[i>>2]|=_s.charCodeAt(i)<<((i%4)*8)}blks[i>>2]|=128<<((i%4)*8);blks[nblk*16-2]=_s.length*8;return blks};this._fSa=function(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&65535)};this.rol=function(num,cnt){return(num<<cnt)|(num>>>(32-cnt))};this.cmn=function(q,a,b,x,s,t){return this._fSa(this.rol(this._fSa(this._fSa(a,q),this._fSa(x,t)),s),b)};this._fF=function(a,b,c,d,x,s){return this.cmn((b&c)|((~b)&d),a,0,x,s,0)};this._fG=function(a,b,c,d,x,s){return this.cmn((b&c)|(b&d)|(c&d),a,0,x,s,1518500249)};this._fH=function(a,b,c,d,x,s){return this.cmn(b^c^d,a,0,x,s,1859775393)};this._MD4=function(_s){var x=this.str2blks_MD5(_s),a=1732584193,b=-271733879,c=-1732584194,d=271733878;for(var i=0;i<x.length;i+=16){var olda=a,oldb=b,oldc=c,oldd=d;a=this._fF(a,b,c,d,x[i+0],3);d=this._fF(d,a,b,c,x[i+1],7);c=this._fF(c,d,a,b,x[i+2],11);b=this._fF(b,c,d,a,x[i+3],19);a=this._fF(a,b,c,d,x[i+4],3);d=this._fF(d,a,b,c,x[i+5],7);c=this._fF(c,d,a,b,x[i+6],11);b=this._fF(b,c,d,a,x[i+7],19);a=this._fF(a,b,c,d,x[i+8],3);d=this._fF(d,a,b,c,x[i+9],7);c=this._fF(c,d,a,b,x[i+10],11);b=this._fF(b,c,d,a,x[i+11],19);a=this._fF(a,b,c,d,x[i+12],3);d=this._fF(d,a,b,c,x[i+13],7);c=this._fF(c,d,a,b,x[i+14],11);b=this._fF(b,c,d,a,x[i+15],19);a=this._fG(a,b,c,d,x[i+0],3);d=this._fG(d,a,b,c,x[i+4],5);c=this._fG(c,d,a,b,x[i+8],9);b=this._fG(b,c,d,a,x[i+12],13);a=this._fG(a,b,c,d,x[i+1],3);d=this._fG(d,a,b,c,x[i+5],5);c=this._fG(c,d,a,b,x[i+9],9);b=this._fG(b,c,d,a,x[i+13],13);a=this._fG(a,b,c,d,x[i+2],3);d=this._fG(d,a,b,c,x[i+6],5);c=this._fG(c,d,a,b,x[i+10],9);b=this._fG(b,c,d,a,x[i+14],13);a=this._fG(a,b,c,d,x[i+3],3);d=this._fG(d,a,b,c,x[i+7],5);c=this._fG(c,d,a,b,x[i+11],9);b=this._fG(b,c,d,a,x[i+15],13);a=this._fH(a,b,c,d,x[i+0],3);d=this._fH(d,a,b,c,x[i+8],9);c=this._fH(c,d,a,b,x[i+4],11);b=this._fH(b,c,d,a,x[i+12],15);a=this._fH(a,b,c,d,x[i+2],3);d=this._fH(d,a,b,c,x[i+10],9);c=this._fH(c,d,a,b,x[i+6],11);b=this._fH(b,c,d,a,x[i+14],15);a=this._fH(a,b,c,d,x[i+1],3);d=this._fH(d,a,b,c,x[i+9],9);c=this._fH(c,d,a,b,x[i+5],11);b=this._fH(b,c,d,a,x[i+13],15);a=this._fH(a,b,c,d,x[i+3],3);d=this._fH(d,a,b,c,x[i+11],9);c=this._fH(c,d,a,b,x[i+7],11);b=this._fH(b,c,d,a,x[i+15],15);a=this._fSa(a,olda);b=this._fSa(b,oldb);c=this._fSa(c,oldc);d=this._fSa(d,oldd)}return this.rhex(a)+this.rhex(b)+this.rhex(c)+this.rhex(d)};this.read=function(n){var neq=n+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(neq)==0){return unescape(c.substring(neq.length,c.length))}}return null};this.write=function(n,v){document.cookie=n+"="+v+";path=/;expires="+(new Date((new Date()).getTime()+this.expiration)).toGMTString()};this.matchurl=function(u,type){var i=0,c=this.read(this.cookie_name);if(type=="domain"){u=/(:\/\/)[\w\d\:\.]+/g.exec(u)[0].replace("://","")}n=this._MD4(u);if(c==null){return false}while(i<c.length){j=i+n.length;if(c.substring(i,j)==n){return(unescape(c.substring(j+1,j+2))==1)}i++}return false};this.tagurl=function(u,type){if(type=="domain"){u=/(:\/\/)[\w\d\:\.]+/g.exec(u)[0].replace("://","")}var prev_val="";if(this.read(this.cookie_name)!=null){prev_val=this.read(this.cookie_name).replace(eval("/"+escape(this._MD4(u))+"~1:/g"),"")}this.write(this.cookie_name,prev_val+(prev_val!=""?":":"")+escape(this._MD4(u))+"~1")}};OnlineOpinion.ocode=function(name){this.name=name;function rematch(val,restr){var re=new RegExp(restr);var m=re.exec(val);if(m==null||m==""){return""}else{var s="";for(i=0;i<m.length;i++){s=s+m[i]}return s}}this._fC=function(_u){_aT=this._sp+",\\/,\\.,-,_,"+this._rp+",%2F,%2E,%2D,%5F";_aA=_aT.split(",");for(i=0;i<5;i++){eval("_u=_u.replace(/"+_aA[i]+"/g,_aA[i+5])")}return _u};this._browser=function(){this.engine=null;this.version=null;var useragent=navigator.userAgent.toLowerCase();if(window.ActiveXObject){this.engine="ie";this.version=rematch(useragent,"msie\\s[0-9].[0-9]+").replace("msie ","")}else{if(window.opera){this.engine="opera";this.version=rematch(useragent,"opera.[0-9].[0-9]+").replace("opera","").replace("/","")}else{if(document.childNodes&&!document.all&&!navigator.taintEnabled){if(rematch(useragent,"applewebkit/[0-9]+")!=null){this.engine="webkit";this.version=rematch(useragent,"applewebkit/[0-9]+").replace("applewebkit/","")}else{this.engine="khtml";this.version=rematch(useragent,"khtml/[0-9].[0-9].[0-9]+").replace("khtml/","")}}else{if(navigator.userAgent.match(/gecko/i)){this.engine="gecko";this.version=rematch(useragent,"gecko/[0-9]+").replace("gecko/","")}}}}};this.serialize=function(obj,option){var str_out="",inc=0;for(var i in obj){if(typeof obj[i]!="function"&&typeof obj[i]!="undefined"&&obj[i]!=null&&obj[i]!=""){if(option==0){str_out+=(inc==0?"":"&")+i+"="+escape(obj[i])}else{if(option==1){str_out+=(inc==0?"":"|")+escape(obj[i])}}inc++}}return str_out};this.Preferences=new Object();this.Preferences.Persistence={enabled:true,cookie_type:"page",cookie_name:"oo_r",expiration:24*60*60*1000};this.Preferences.Render={type:"floating",main_div_id:"oo_feedback_float",up_div_id:"olUp",over_div_id:"olOver",img_path:"onlineopinion/oo_black.gif",feedback_span_id:"fbText",feedback_html:"FEEDBACK",click_html:"Click here to<br>rate this page",ty_html:"",float_style:"fixed"};this.Metrics=new Object();this.Metrics.core={width:screen.width,height:screen.height,referer:window.location.href,prev:document.referrer,time1:(new Date()).getTime(),time2:null};this.Metrics.custom=new Object();this.Preferences.Plugins=new Object();this.Preferences.Plugins.Events={poE:0,poX:0,poC:{id:"",value:0},poWC:0};this.onEntry=function(){if(Math.random()>=1-this.Preferences.Plugins.Events.poE){this.show();this.Preferences.Plugins.Events.poX=0}};this.onExit=function(){if(Math.random()>=1-this.Preferences.Plugins.Events.poX){this.show()}};this.OnClick=function(){if(Math.random()>=1-this.Preferences.Plugins.Events.poC){this.show();this.Preferences.Plugins.Events.poX=0;this.Preferences.Plugins.Events.poC=0}};this.Preferences.Plugins.URLRewrite={active:false,regex_search_pattern:"",regex_replace_pattern:""};this.Preferences.Plugins.CardOnPage={enabled:false,div_id:"onlineopinion_cc_window",iframe_id:"onlineopinion_cc_frame"};this.init=function(){this.resetReferer();if(typeof OnlineOpinion.cookie!="undefined"&&this.Preferences.Persistence.cookie_type!=null){this.Cookie=new OnlineOpinion.cookie();if(typeof this.Preferences.Persistence.cookie_name!="undefined"){this.Cookie.cookie_name=this.Preferences.Persistence.cookie_name}this.Cookie.expiration=1000*this.Preferences.Persistence.expiration;if(this.Cookie.matchurl(this.Metrics.core.referer,this.Preferences.Persistence.cookie_type)==1){this.Preferences.Plugins.Events.poX=0;this.Preferences.Plugins.Events.poE=0;return false}}else{this.Cookie=null}return true};this.render=function(onclick_func){this.init();var b=new this._browser();var d=document;var de=d.documentElement;var db=d.body;var w=window;var divID=this.Preferences.Render.main_div_id;var bVersion=parseFloat(b.version);var compliant=d.compatMode=="CSS1Compat";var sObj=compliant?de:db;if(b.engine=="webkit"){sObj=db}if(b.engine==null||b.version==null||isNaN(parseInt(b.version,10))||(b.engine=="ie"&&parseFloat(b.version)<6)||(b.engine=="opera"&&parseInt(b.version,10)<8)||(b.engine=="gecko"&&parseInt(b.version,10)<20041107)){return false}var mainDivObj=d.getElementById(divID);if(mainDivObj==null){if(this.Preferences.Render.type=="floating"){mainDivObj=db.appendChild(d.createElement("div"));mainDivObj.id=divID}}if(mainDivObj.innerHTML==""){if(this.Preferences.Render.type=="floating"){if(this.Preferences.Persistence.enabled&&this.Preferences.Persistence.cookie_type!=null){if(this.Cookie.matchurl(this.Metrics.core.referer,this.Preferences.Persistence.cookie_type)==1){return false}}var olUpObj=mainDivObj.appendChild(d.createElement("div"));olUpObj.id=this.Preferences.Render.up_div_id;var olOverObj=mainDivObj.appendChild(d.createElement("div"));olOverObj.id=this.Preferences.Render.over_div_id;olOverObj.style.display="none";olUpObj.onmouseover=function(){d.getElementById(olOverObj.id).style.display="block";document.getElementById(olUpObj.id).style.display="none"};olOverObj.onmouseout=function(){d.getElementById(olOverObj.id).style.display="none";document.getElementById(olUpObj.id).style.display="block"};var ooImg=olUpObj.appendChild(d.createElement("img"));ooImg.src=this.Preferences.Render.img_path;var fbText=olUpObj.appendChild(d.createElement("span"));fbText.id=this.Preferences.Render.feedback_span_id;fbText.innerHTML=this.Preferences.Render.feedback_html;var feedback_text=null;if(this.Preferences.Render.div_alt_text){feedback_text=this.Preferences.Render.div_alt_text}else{if(document.all){feedback_text=fbText.innerText}else{feedback_text=fbText.textContent}}mainDivObj.alt=feedback_text;mainDivObj.title=feedback_text;olOverObj.innerHTML=this.Preferences.Render.click_html}if(this.Preferences.Render.type=="static"){mainDivObj.innerHTML=this.Preferences.Render.main_html}}if(this.Preferences.Render.type=="floating"){if(!this.Preferences.Render.float_style){this.Preferences.Render.float_style="fixed"}var mdoStyle=mainDivObj.style;var _this=this;if(this.Preferences.Render.float_style=="rightOfContent"){function getRightOfContent(){return contentDiv.offsetWidth+contentDiv.offsetLeft+1}var contentDiv=d.getElementById(_this.Preferences.Render.main_content_id||"content");if(contentDiv==null){contentDiv=db.firstChild;while(contentDiv&&contentDiv.nodeType!=Node.ELEMENT_NODE){contentDiv=contentDiv.nextSibling}}function fixBackground(){if(_this.Preferences.Render.fix_background){db.style.backgroundAttachment="scroll";var margin=null;if(document.defaultView&&document.defaultView.getComputedStyle){margin=parseInt(document.defaultView.getComputedStyle(contentDiv,null).getPropertyValue("margin-left"),10)}else{margin=parseInt(contentDiv.currentStyle.marginLeft,10)}if(isNaN(margin)||margin==0){margin=contentDiv.offsetLeft||0}db.style.backgroundPosition=(Math.floor(contentDiv.scrollWidth*-0.5)-2+margin)+"px 0"}}}var ieSix=function(e){if(_this.Preferences.Render.float_style=="fixed"){mdoStyle.left=sObj.scrollLeft+sObj.clientWidth-mainDivObj.clientWidth}else{if(_this.Preferences.Render.float_style=="rightOfContent"){mdoStyle.left=getRightOfContent()+"px"}}mdoStyle.top=sObj.scrollTop+sObj.clientHeight-mainDivObj.clientHeight;if(e==null||e.type=="load"){mdoStyle.visibility="visible"}if(e==null||e.type=="load"||e.type=="resize"){fixBackground()}};if(b.engine=="ie"&&(bVersion<7||!compliant)){mdoStyle.position="absolute";function mapEvents(target,events){for(var idx=0;idx<events.length;idx++){var curevent=events[idx];target.attachEvent("on"+curevent,ieSix)}}mapEvents(mainDivObj,["mouseover","mouseout"]);mapEvents(w,["resize","scroll","mousewheel","load"]);ieSix()}else{mdoStyle.position="fixed";if(this.Preferences.Render.float_style=="fixed"){mdoStyle.right="0px";mdoStyle.bottom="0px"}else{if(this.Preferences.Render.float_style=="rightOfContent"){var rightOfContent=getRightOfContent()-sObj.scrollLeft+"px";mdoStyle.bottom="0px";mdoStyle.left=rightOfContent;var gutter=d.createElement("div");db.replaceChild(gutter,mainDivObj);gutter.appendChild(mainDivObj);gutter.style.position="absolute";gutter.style.width=mainDivObj.offsetWidth+"px";gutter.style.left=rightOfContent;gutter.style.top="0px";gutter.style.height=sObj.scrollHeight+"px";fixBackground();var resizeMove=function(e){var right=getRightOfContent();mdoStyle.left=right-sObj.scrollLeft+"px";if(e.type=="resize"){gutter.style.left=right+"px";fixBackground()}};if(b.engine=="ie"){w.attachEvent("onresize",resizeMove);w.attachEvent("onscroll",resizeMove)}else{w.addEventListener("resize",resizeMove,false);w.addEventListener("scroll",resizeMove,false)}}}mainDivObj.style.visibility="visible"}}mainDivObj.onclick=onclick_func;try{if(this.Preferences.Plugins.CardOnPage.enabled==true){var onPageCCdiv=db.appendChild(d.createElement("div"));onPageCCdiv.id=this.Preferences.Plugins.CardOnPage.div_id;var onPageCCiframe=onPageCCdiv.appendChild(d.createElement("iframe"));onPageCCiframe.id=this.Preferences.Plugins.CardOnPage.iframe_id;var W=(b.engine=="webkit")?w.innerWidth:(b.engine=="opera"?db.clientWidth:de.clientWidth);var H=(b.engine=="webkit")?w.innerHeight:(b.engine=="opera"?db.clientHeight:de.clientHeight);var wx=585,hy=400;onPageCCdiv.style.left=parseInt((W-wx)/2,10)+"px";onPageCCdiv.style.top=parseInt((H-hy)/2,10)+"px";if(b.engine=="ie"&&bVersion<7){onPageCCdiv.style.position="absolute"}}}catch(e){}return true};this.launchCC=function(){try{if(this.Cookie.matchurl(this.Metrics.core.referer,this.Preferences.Persistence.cookie_type)!=1){if(this.Preferences.Plugins.CardOnPage.enabled==true){document.getElementById(this.Preferences.Plugins.CardOnPage.iframe_id).src="https://secure.opinionlab.com/ccc01/comment_card.asp?"+(this.Preferences.Render.type=="asm"?"asm=1&":"")+"static=1&"+this.serialize(this.Metrics.core,0)+"&custom_var="+this.serialize(this.Metrics.custom,1);document.getElementById(this.Preferences.Plugins.CardOnPage.div_id).style.display="block"}else{OnlineOpinion.util.popup("https://secure.opinionlab.com/ccc01/comment_card.asp?"+(this.Preferences.Render.type=="asm"?"asm=1&":"")+this.serialize(this.Metrics.core,0)+"&custom_var="+this.serialize(this.Metrics.custom,1),"OnlineOpinion","resizable=yes,copyhistory=yes,scrollbars="+(this.Preferences.Render.type=="asm"?"yes":"no")+",location=no,status=no,fullscreen=no,width=545,height=200,top="+parseInt((this.Metrics.core.height-200)/2,10)+",left="+parseInt((this.Metrics.core.width-545)/2,10))}}}catch(e){OnlineOpinion.util.popup("https://secure.opinionlab.com/ccc01/comment_card.asp?"+(this.Preferences.Render.type=="asm"?"asm=1&":"")+this.serialize(this.Metrics.core,0)+"&custom_var="+this.serialize(this.Metrics.custom,1),"OnlineOpinion","resizable=yes,copyhistory=yes,scrollbars="+(this.Preferences.Render.type=="asm"?"yes":"no")+",location=no,status=no,fullscreen=no,width=545,height=200,top="+parseInt((this.Metrics.core.height-200)/2,10)+",left="+parseInt((this.Metrics.core.width-545)/2,10))}};this.show=function(){this.Metrics.core.time2=(new Date()).getTime();this.launchCC();if(this.Preferences.Persistence.enabled){document.getElementById(this.Preferences.Render.main_div_id).style.display="none"}if(this.Cookie!=null&&this.Preferences.Persistence.cookie_type!=null){this.Cookie.tagurl(this.Metrics.core.referer,this.Preferences.Persistence.cookie_type)}this.resetReferer()};this.resetReferer=function(alt_referer){var location=window.location.href;if(alt_referer){location=alt_referer}var rewriter=this.Preferences.Plugins.URLRewrite;if(rewriter&&rewriter.active==true){this.Metrics.core.referer=location.replace(rewriter.regex_search_pattern,rewriter.regex_replace_pattern)}else{this.Metrics.core.referer=location}};this.post=function(){this.Metrics.core.time2=(new Date()).getTime();var mainDivObj=document.getElementById(this.Preferences.Render.main_div_id);var JSONP=mainDivObj.appendChild(document.createElement("script"));var odata=this.serialize(this.Metrics.core,0)+"&custom_var="+this.serialize(this.Metrics.custom,1);var elements=document.forms[this.Preferences.Render.main_div_id+"_form"].elements;var formdata=[];for(idx=0;idx<elements.length;idx++){var curElement=elements[idx];try{var name=curElement.name;if(name!=undefined&&curElement.value!=undefined){switch(curElement.type){case"radio":if(curElement.checked){formdata.push(curElement.name+"="+encodeURIComponent(curElement.value))}break;case"checkbox":if(curElement.checked){formdata.push(curElement.name+"="+encodeURIComponent(curElement.value))}break;default:formdata.push(curElement.name+"="+encodeURIComponent(curElement.value))}}}catch(e){}}var cdata=formdata.join("&");var osignature=this.Cookie!=null?this.Cookie._MD4(odata):"";JSONP.src="https://secure.opinionlab.com/rate36s.asp?"+odata+"&"+cdata+"&signature="+osignature;if(this.Preferences.Persistence.enabled){var mainFormDiv=document.getElementById(this.Preferences.Render.main_div_id+"_form");mainFormDiv.style.display="none"}if(this.Preferences.Render.ty_html!=""){var TYDivObj=document.getElementById(this.Preferences.Render.ty_div_id);TYDivObj.innerHTML=this.Preferences.Render.ty_html;TYDivObj.style.display="block"}if(this.Cookie!=null&&this.Preferences.Persistence.cookie_type!=null){this.Cookie.tagurl(this.Metrics.core.referer,this.Preferences.Persistence.cookie_type)}this.resetReferer()}};var mboxCopyright="Copyright 1996-2009. Adobe Systems Incorporated. All rights reserved";mboxUrlBuilder=function(B,A){this.a=B;this.b=A;this.c=new Array();this.d=function(C){return C};this.f=null};mboxUrlBuilder.prototype.addParameter=function(F,E){var D=new RegExp("('|\")");if(D.exec(F)){throw"Parameter '"+F+"' contains invalid characters"}for(var C=0;C<this.c.length;C++){var B=this.c[C];if(B.name==F){B.value=E;return this}}var A=new Object();A.name=F;A.value=E;this.c[this.c.length]=A;return this};mboxUrlBuilder.prototype.addParameters=function(C){if(!C){return this}for(var B=0;B<C.length;B++){var A=C[B].indexOf("=");if(A==-1||A==0){continue}this.addParameter(C[B].substring(0,A),C[B].substring(A+1,C[B].length))}return this};mboxUrlBuilder.prototype.setServerType=function(A){this.o=A};mboxUrlBuilder.prototype.setBasePath=function(A){this.f=A};mboxUrlBuilder.prototype.setUrlProcessAction=function(A){this.d=A};mboxUrlBuilder.prototype.buildUrl=function(){var E=this.f?this.f:"/m2/"+this.b+"/mbox/"+this.o;var D=document.location.protocol=="file:"?"http:":document.location.protocol;var F=D+"//"+this.a+E;var C=F.indexOf("?")!=-1?"&":"?";for(var B=0;B<this.c.length;B++){var A=this.c[B];F+=C+encodeURIComponent(A.name)+"="+encodeURIComponent(A.value);C="&"}return this.t(this.d(F))};mboxUrlBuilder.prototype.getParameters=function(){return this.c};mboxUrlBuilder.prototype.setParameters=function(A){this.c=A};mboxUrlBuilder.prototype.clone=function(){var B=new mboxUrlBuilder(this.a,this.b);B.setServerType(this.o);B.setBasePath(this.f);B.setUrlProcessAction(this.d);for(var A=0;A<this.c.length;A++){B.addParameter(this.c[A].name,this.c[A].value)}return B};mboxUrlBuilder.prototype.t=function(A){return A.replace(/\"/g,"&quot;").replace(/>/g,"&gt;")};mboxStandardFetcher=function(){};mboxStandardFetcher.prototype.getType=function(){return"standard"};mboxStandardFetcher.prototype.fetch=function(A){A.setServerType(this.getType());document.write('<script src="'+A.buildUrl()+'" language="JavaScript"><\/script>')};mboxStandardFetcher.prototype.cancel=function(){};mboxAjaxFetcher=function(){};mboxAjaxFetcher.prototype.getType=function(){return"ajax"};mboxAjaxFetcher.prototype.fetch=function(A){A.setServerType(this.getType());var B=A.buildUrl();this.x=document.createElement("script");this.x.src=B;document.body.appendChild(this.x)};mboxAjaxFetcher.prototype.cancel=function(){};mboxMap=function(){this.y=new Object();this.z=new Array()};mboxMap.prototype.put=function(B,C){if(!this.y[B]){this.z[this.z.length]=B}this.y[B]=C};mboxMap.prototype.get=function(B){return this.y[B]};mboxMap.prototype.remove=function(B){this.y[B]=undefined};mboxMap.prototype.each=function(E){for(var C=0;C<this.z.length;C++){var B=this.z[C];var D=this.y[B];if(D){E(B,D)}}};mboxFactory=function(G,A,F){this.D=false;this.B=G;this.C=F;this.E=new mboxList();mboxFactories.put(F,this);this.F=typeof document.createElement("div").replaceChild!="undefined"&&(function(){return true})()&&typeof document.getElementById!="undefined"&&typeof(window.attachEvent||document.addEventListener||window.addEventListener)!="undefined"&&typeof encodeURIComponent!="undefined";this.G=this.F&&mboxGetPageParameter("mboxDisable")==null;var E=F=="default";this.I=new mboxCookieManager("mbox"+(E?"":("-"+F)),(function(){return mboxCookiePageDomain()})());this.G=this.G&&this.I.isEnabled()&&(this.I.getCookie("disable")==null);if(this.isAdmin()){this.enable()}this.J=mboxGenerateId();this.K=mboxScreenHeight();this.L=mboxScreenWidth();this.M=mboxBrowserWidth();this.N=mboxBrowserHeight();this.O=mboxScreenColorDepth();this.P=mboxBrowserTimeOffset();this.Q=new mboxSession(this.J,"mboxSession","session",31*60,this.I);this.R=new mboxPC("PC",2592000,this.I);this.w=new mboxUrlBuilder(G,A);this.S(this.w,E);this.T=new Date().getTime();this.U=this.T;var D=this;this.addOnLoad(function(){D.U=new Date().getTime()});if(this.F){this.addOnLoad(function(){D.D=true;D.getMboxes().each(function(B){B.setFetcher(new mboxAjaxFetcher());B.finalize()})});this.limitTraffic(100,10368000);if(this.G){this.X();this.Y=new mboxSignaler(function(B,C){return D.create(B,C)},this.I)}}};mboxFactory.prototype.isEnabled=function(){return this.G};mboxFactory.prototype.getDisableReason=function(){return this.I.getCookie("disable")};mboxFactory.prototype.isSupported=function(){return this.F};mboxFactory.prototype.disable=function(A,B){if(typeof A=="undefined"){A=60*60}if(typeof B=="undefined"){B="unspecified"}if(!this.isAdmin()){this.G=false;this.I.setCookie("disable",B,A)}};mboxFactory.prototype.enable=function(){this.G=true;this.I.deleteCookie("disable")};mboxFactory.prototype.isAdmin=function(){return document.location.href.indexOf("mboxEnv")!=-1};mboxFactory.prototype.limitTraffic=function(B,A){};mboxFactory.prototype.addOnLoad=function(A){if(window.addEventListener){window.addEventListener("load",A,false)}else{if(document.addEventListener){document.addEventListener("load",A,false)}else{if(document.attachEvent){window.attachEvent("onload",A)}}}};mboxFactory.prototype.getEllapsedTime=function(){return this.U-this.T};mboxFactory.prototype.getEllapsedTimeUntil=function(A){return A-this.T};mboxFactory.prototype.getMboxes=function(){return this.E};mboxFactory.prototype.get=function(B,A){return this.E.get(B).getById(A||0)};mboxFactory.prototype.update=function(A,B){if(!this.isEnabled()){return}if(this.E.get(A).length()==0){throw"Mbox "+A+" is not defined"}this.E.get(A).each(function(C){C.getUrlBuilder().addParameter("mboxPage",mboxGenerateId());C.load(B)})};mboxFactory.prototype.create=function(A,I,H){if(!this.isSupported()){return null}var G=this.w.clone();G.addParameter("mboxCount",this.E.length()+1);G.addParameters(I);var L=this.E.get(A).length();var C=this.C+"-"+A+"-"+L;var K;if(H){K=new mboxLocatorNode(H)}else{if(this.D){throw"The page has already been loaded, can't write marker"}K=new mboxLocatorDefault(C)}try{var D=this;var F="mboxImported-"+C;var B=new mbox(A,L,G,K,F);if(this.G){B.setFetcher(this.D?new mboxAjaxFetcher():new mboxStandardFetcher())}B.setOnError(function(M,O){B.setMessage(M);B.activate();if(!B.isActivated()){D.disable(60*60,M);window.location.reload(false)}});this.E.add(B)}catch(J){this.disable();throw'Failed creating mbox "'+A+'", the error was: '+J}var E=new Date();G.addParameter("mboxTime",E.getTime()-(E.getTimezoneOffset()*60000));return B};mboxFactory.prototype.getCookieManager=function(){return this.I};mboxFactory.prototype.getPageId=function(){return this.J};mboxFactory.prototype.getPCId=function(){return this.R};mboxFactory.prototype.getSessionId=function(){return this.Q};mboxFactory.prototype.getSignaler=function(){return this.Y};mboxFactory.prototype.getUrlBuilder=function(){return this.w};mboxFactory.prototype.S=function(B,A){B.addParameter("mboxHost",document.location.host).addParameter("mboxSession",this.Q.getId());if(!A){B.addParameter("mboxFactoryId",this.C)}if(this.R.getId()!=null){B.addParameter("mboxPC",this.R.getId())}B.addParameter("mboxPage",this.J);B.addParameter("screenHeight",this.K);B.addParameter("screenWidth",this.L);B.addParameter("browserWidth",this.M);B.addParameter("browserHeight",this.N);B.addParameter("browserTimeOffset",this.P);B.addParameter("colorDepth",this.O);B.setUrlProcessAction(function(D){D+="&mboxURL="+encodeURIComponent(document.location);var C=encodeURIComponent(document.referrer);if(D.length+C.length<2000){D+="&mboxReferrer="+C}D+="&mboxVersion="+mboxVersion;return D})};mboxFactory.prototype.mb=function(){return""};mboxFactory.prototype.X=function(){document.write("<style>.mboxDefault { visibility:hidden; }</style>")};mboxFactory.prototype.isDomLoaded=function(){return this.D};mboxSignaler=function(B,E){this.I=E;var C=E.getCookieNames("signal-");for(var D=0;D<C.length;D++){var F=C[D];var G=E.getCookie(F).split("&");var A=B(G[0],G);A.load();E.deleteCookie(F)}};mboxSignaler.prototype.signal=function(B,A){this.I.setCookie("signal-"+B,mboxShiftArray(arguments).join("&"),45*60)};mboxList=function(){this.E=new Array()};mboxList.prototype.add=function(A){if(A!=null){this.E[this.E.length]=A}};mboxList.prototype.get=function(C){var D=new mboxList();for(var B=0;B<this.E.length;B++){var A=this.E[B];if(A.getName()==C){D.add(A)}}return D};mboxList.prototype.getById=function(A){return this.E[A]};mboxList.prototype.length=function(){return this.E.length};mboxList.prototype.each=function(B){if(typeof B!="function"){throw"Action must be a function, was: "+typeof(B)}for(var A=0;A<this.E.length;A++){B(this.E[A])}};mboxLocatorDefault=function(A){this.g="mboxMarker-"+A;document.write('<div id="'+this.g+'" style="visibility:hidden;display:none">&nbsp;</div>')};mboxLocatorDefault.prototype.locate=function(){var A=document.getElementById(this.g);while(A!=null){if(A.nodeType==1){if(A.className=="mboxDefault"){return A}}A=A.previousSibling}return null};mboxLocatorDefault.prototype.force=function(){var A=document.createElement("div");A.className="mboxDefault";var B=document.getElementById(this.g);B.parentNode.insertBefore(A,B);return A};mboxLocatorNode=function(A){this.ub=A};mboxLocatorNode.prototype.locate=function(){return typeof this.ub=="string"?document.getElementById(this.ub):this.ub};mboxLocatorNode.prototype.force=function(){return null};mboxCreate=function(B){var A=mboxFactoryDefault.create(B,mboxShiftArray(arguments));if(A){A.load()}return A};mboxDefine=function(B,C){var A=mboxFactoryDefault.create(C,mboxShiftArray(mboxShiftArray(arguments)),B);return A};mboxUpdate=function(A){mboxFactoryDefault.update(A,mboxShiftArray(arguments))};mbox=function(D,A,B,C,E){this.Ab=null;this.Bb=0;this.gb=C;this.hb=E;this.Cb=null;this.Db=new mboxOfferContent();this.vb=null;this.w=B;this.message="";this.Eb=new Object();this.Fb=0;this.yb=A;this.g=D;this.Gb();B.addParameter("mbox",D).addParameter("mboxId",A);this.Hb=function(){};this.Ib=function(){};this.Jb=null};mbox.prototype.getId=function(){return this.yb};mbox.prototype.Gb=function(){if(this.g.length>250){throw"Mbox Name "+this.g+" exceeds max length of 250 characters."}else{if(this.g.match(/^\s+|\s+$/g)){throw"Mbox Name "+this.g+" has leading/trailing whitespace(s)."}}};mbox.prototype.getName=function(){return this.g};mbox.prototype.getParameters=function(){var C=this.w.getParameters();var B=new Array();for(var A=0;A<C.length;A++){if(C[A].name.indexOf("mbox")!=0){B[B.length]=C[A].name+"="+C[A].value}}return B};mbox.prototype.setOnLoad=function(A){this.Ib=A;return this};mbox.prototype.setMessage=function(A){this.message=A;return this};mbox.prototype.setOnError=function(A){this.Hb=A;return this};mbox.prototype.setFetcher=function(A){if(this.Cb){this.Cb.cancel()}this.Cb=A;return this};mbox.prototype.getFetcher=function(){return this.Cb};mbox.prototype.load=function(C){if(this.Cb==null){return this}this.setEventTime("load.start");this.cancelTimeout();this.Bb=0;var B=(C&&C.length>0)?this.w.clone().addParameters(C):this.w;this.Cb.fetch(B);var A=this;this.Lb=setTimeout(function(){A.Hb("browser timeout",A.Cb.getType())},15000);this.setEventTime("load.end");return this};mbox.prototype.loaded=function(){this.cancelTimeout();if(!this.activate()){var A=this;setTimeout(function(){A.loaded()},100)}};mbox.prototype.activate=function(){if(this.Bb){return this.Bb}this.setEventTime("activate"+(++this.Fb)+".start");if(this.show()){this.cancelTimeout();this.Bb=1}this.setEventTime("activate"+this.Fb+".end");return this.Bb};mbox.prototype.isActivated=function(){return this.Bb};mbox.prototype.setOffer=function(A){if(A&&A.show&&A.setOnLoad){this.Db=A}else{throw"Invalid offer"}return this};mbox.prototype.getOffer=function(){return this.Db};mbox.prototype.show=function(){this.setEventTime("show.start");var A=this.Db.show(this);this.setEventTime(A==1?"show.end.ok":"show.end");return A};mbox.prototype.showContent=function(A){if(A==null){return 0}if(this.vb==null||!this.vb.parentNode){this.vb=this.getDefaultDiv();if(this.vb==null){return 0}}if(this.vb!=A){this.Nb(this.vb);this.vb.parentNode.replaceChild(A,this.vb);this.vb=A}this.Ob(A);this.Ib();return 1};mbox.prototype.hide=function(){this.setEventTime("hide.start");var A=this.showContent(this.getDefaultDiv());this.setEventTime(A==1?"hide.end.ok":"hide.end.fail");return A};mbox.prototype.finalize=function(){this.setEventTime("finalize.start");this.cancelTimeout();if(this.getDefaultDiv()==null){if(this.gb.force()!=null){this.setMessage("No default content, an empty one has been added")}else{this.setMessage("Unable to locate mbox")}}if(!this.activate()){this.hide();this.setEventTime("finalize.end.hide")}this.setEventTime("finalize.end.ok")};mbox.prototype.cancelTimeout=function(){if(this.Lb){clearTimeout(this.Lb)}if(this.Cb!=null){this.Cb.cancel()}};mbox.prototype.getDiv=function(){return this.vb};mbox.prototype.getDefaultDiv=function(){if(this.Jb==null){this.Jb=this.gb.locate()}return this.Jb};mbox.prototype.setEventTime=function(A){this.Eb[A]=(new Date()).getTime()};mbox.prototype.getEventTimes=function(){return this.Eb};mbox.prototype.getImportName=function(){return this.hb};mbox.prototype.getURL=function(){return this.w.buildUrl()};mbox.prototype.getUrlBuilder=function(){return this.w};mbox.prototype.Qb=function(A){return A.style.display!="none"};mbox.prototype.Ob=function(A){this.Rb(A,true)};mbox.prototype.Nb=function(A){this.Rb(A,false)};mbox.prototype.Rb=function(B,A){B.style.visibility=A?"visible":"hidden";B.style.display=A?"block":"none"};mboxOfferContent=function(){this.Ib=function(){}};mboxOfferContent.prototype.show=function(A){var B=A.showContent(document.getElementById(A.getImportName()));if(B==1){this.Ib()}return B};mboxOfferContent.prototype.setOnLoad=function(A){this.Ib=A};mboxOfferAjax=function(A){this.Mb=A;this.Ib=function(){}};mboxOfferAjax.prototype.setOnLoad=function(A){this.Ib=A};mboxOfferAjax.prototype.show=function(A){var B=document.createElement("div");B.id=A.getImportName();B.innerHTML=this.Mb;var C=A.showContent(B);if(C==1){this.Ib()}return C};mboxOfferDefault=function(){this.Ib=function(){}};mboxOfferDefault.prototype.setOnLoad=function(A){this.Ib=A};mboxOfferDefault.prototype.show=function(A){var B=A.hide();if(B==1){this.Ib()}return B};mboxCookieManager=function mboxCookieManager(B,A){this.g=B;this.Ub=A==""||A.indexOf(".")==-1?"":"; domain="+A;this.Vb=new mboxMap();this.loadCookies()};mboxCookieManager.prototype.isEnabled=function(){this.setCookie("check","true",60);this.loadCookies();return this.getCookie("check")=="true"};mboxCookieManager.prototype.setCookie=function(C,B,A){if(typeof C!="undefined"&&typeof B!="undefined"&&typeof A!="undefined"){var D=new Object();D.name=C;D.value=escape(B);D.expireOn=Math.ceil(A+new Date().getTime()/1000);this.Vb.put(C,D);this.saveCookies()}};mboxCookieManager.prototype.getCookie=function(A){var B=this.Vb.get(A);return B?unescape(B.value):null};mboxCookieManager.prototype.deleteCookie=function(A){this.Vb.remove(A);this.saveCookies()};mboxCookieManager.prototype.getCookieNames=function(A){var B=new Array();this.Vb.each(function(C,D){if(C.indexOf(A)==0){B[B.length]=C}});return B};mboxCookieManager.prototype.saveCookies=function(){var B=new Array();var A=0;this.Vb.each(function(D,E){B[B.length]=D+"#"+E.value+"#"+E.expireOn;if(A<E.expireOn){A=E.expireOn}});var C=new Date(A*1000);document.cookie=this.g+"="+B.join("|")+"; expires="+C.toGMTString()+"; path=/"+this.Ub};mboxCookieManager.prototype.loadCookies=function(){this.Vb=new mboxMap();var E=document.cookie.indexOf(this.g+"=");if(E!=-1){var G=document.cookie.indexOf(";",E);if(G==-1){G=document.cookie.indexOf(",",E);if(G==-1){G=document.cookie.length}}var A=document.cookie.substring(E+this.g.length+1,G).split("|");var C=Math.ceil(new Date().getTime()/1000);for(var B=0;B<A.length;B++){var F=A[B].split("#");if(C<=F[2]){var D=new Object();D.name=F[0];D.value=F[1];D.expireOn=F[2];this.Vb.put(D.name,D)}}}};mboxSession=function(D,E,C,A,B){this.hc=E;this.pb=C;this.ic=A;this.I=B;this.jc=false;this.yb=typeof mboxForceSessionId!="undefined"?mboxForceSessionId:mboxGetPageParameter(this.hc);if(this.yb==null||this.yb.length==0){this.yb=B.getCookie(C);if(this.yb==null||this.yb.length==0){this.yb=D;this.jc=true}}B.setCookie(C,this.yb,A)};mboxSession.prototype.getId=function(){return this.yb};mboxSession.prototype.forceId=function(A){this.yb=A;this.I.setCookie(this.pb,this.yb,this.ic)};mboxPC=function(C,A,B){this.pb=C;this.ic=A;this.I=B;this.yb=typeof mboxForcePCId!="undefined"?mboxForcePCId:B.getCookie(C);if(this.yb!=null){B.setCookie(C,this.yb,A)}};mboxPC.prototype.getId=function(){return this.yb};mboxPC.prototype.forceId=function(A){if(this.yb!=A){this.yb=A;this.I.setCookie(this.pb,this.yb,this.ic);return true}return false};mboxGetPageParameter=function(B){var D=null;var A=new RegExp(B+"=([^&]*)");var C=A.exec(document.location);if(C!=null&&C.length>=2){D=C[1]}return D};mboxSetCookie=function(C,B,A){return mboxFactoryDefault.getCookieManager().setCookie(C,B,A)};mboxGetCookie=function(A){return mboxFactoryDefault.getCookieManager().getCookie(A)};mboxCookiePageDomain=function(){var B=(/([^:]*)(:[0-9]{0,5})?/).exec(document.location.host)[1];var C=/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/;if(!C.exec(B)){var A=(/([^\.]+\.[^\.]{3}|[^\.]+\.[^\.]+\.[^\.]{2})$/).exec(B);if(A){B=A[0]}}return B?B:""};mboxShiftArray=function(B){var C=new Array();for(var A=1;A<B.length;A++){C[C.length]=B[A]}return C};mboxGenerateId=function(){return(new Date()).getTime()+"-"+Math.floor(Math.random()*999999)};mboxScreenHeight=function(){return screen.height};mboxScreenWidth=function(){return screen.width};mboxBrowserWidth=function(){return(window.innerWidth)?window.innerWidth:document.documentElement?document.documentElement.clientWidth:document.body.clientWidth};mboxBrowserHeight=function(){return(window.innerHeight)?window.innerHeight:document.documentElement?document.documentElement.clientHeight:document.body.clientHeight};mboxBrowserTimeOffset=function(){return -new Date().getTimezoneOffset()};mboxScreenColorDepth=function(){return screen.pixelDepth};if(typeof mboxVersion=="undefined"){var mboxVersion=39;var mboxFactories=new mboxMap();var mboxFactoryDefault=new mboxFactory("orbitz.tt.omtrdc.net","orbitz","default")}if(mboxGetPageParameter("mboxDebug")!=null||mboxFactoryDefault.getCookieManager().getCookie("debug")!=null){setTimeout(function(){if(typeof mboxDebugLoaded=="undefined"){alert("Could not load the remote debug.\nPlease check your connection to Test&amp;Target servers")}},60*60);document.write('<script language="Javascript1.2" src="http://admin16.testandtarget.omniture.com/admin/mbox/mbox_debug.jsp?mboxServerHost=orbitz.tt.omtrdc.net&clientCode=orbitz"><\/script>')}var mboxUtils={cookieName:"myTests",getCookie:function(){var A=document.cookie.match("(^|;) ?"+this.cookieName+"=([^;]*)(;|$)");if(A){return decodeURIComponent(A[2]).split("|")}return null},checkMyTests:function(){var D=/:[1-9]+[0-9]*$/;var B=this.getCookie();for(var C=0,A=B.length;C<A;C++){if(B[C].search(D)!=-1){return true}}return false},updateMyTests:function(I,A){var D=28;var H=new Date();H.setTime(H.getTime()+(D*86400000));var B="expires="+H.toGMTString();var C=this.getCookie();var G=I+":";var J=A;for(var E=0,F=C.length;E<F;E++){if(C[E].indexOf(G)==0){C[E]=G+J;break}}document.cookie=this.cookieName+"="+C.join("|")+"; "+B+"; path=/"}};(function(){var A=function(B){if(window.mboxUpdate&&window.mboxFactoryDefault&&B){if(B.indexOf(",")==-1){log.error("mboxUpdate failed: mbox data incorrectly formatted.");return}var C=B.split(",");var D=C[0];if(window.mboxFactoryDefault.get(D)){window.mboxUpdate.apply(null,C)}}};document.observe("click",function(B){var C=B.findElement("*[data-mbox-update]");if(C){A(C.readAttribute("data-mbox-update"))}});document.observe("mbox:update",function(B){A(B.memo.mboxData)})})();function dcsCookie(){if(typeof(dcsOther)=="function"){dcsOther()}else{if(typeof(dcsPlugin)=="function"){dcsPlugin()}else{if(typeof(dcsFPC)=="function"){dcsFPC(gTimeZone)}}}}function dcsGetCookie(B){var D=document.cookie.indexOf(B+"=");if(D!=-1){var C=D+B.length+1;var A=document.cookie.indexOf(";",C);if(A==-1){A=document.cookie.length}return unescape(document.cookie.substring(C,A))}return null}function dcsGetCrumb(D,C){var B=dcsGetCookie(D).split(":");for(var E=0;E<B.length;E++){var A=B[E].split("=");if(C==A[0]){return A[1]}}return null}function dcsGetIdCrumb(C,B){var E=dcsGetCookie(C);var F=E.substring(0,E.indexOf(":lv="));var A=F.split("=");for(var D=0;D<A.length;D++){if(B==A[0]){return A[1]}}return null}function dcsFPC(G){if(typeof(G)=="undefined"){return}if(document.cookie.indexOf("WTLOPTOUT=")!=-1){return}var A=gFpc;var K=new Date();var I=(K.getTimezoneOffset()*60000)+(G*3600000);K.setTime(K.getTime()+I);var E=new Date(K.getTime()+315360000000);var J=new Date(K.getTime());if(document.cookie.indexOf(A+"=")==-1){if((typeof(gWtId)!="undefined")&&(gWtId!="")){WT.co_f=gWtId}else{if((typeof(gTempWtId)!="undefined")&&(gTempWtId!="")){WT.co_f=gTempWtId;WT.vt_f="1"}else{WT.co_f="2";var L=K.getTime().toString();for(var H=2;H<=(32-L.length);H++){WT.co_f+=Math.floor(Math.random()*16).toString(16)}WT.co_f+=L;WT.vt_f="1"}}if(typeof(gWtAccountRollup)=="undefined"){WT.vt_f_a="1"}WT.vt_f_s="1";WT.vt_f_d="1";WT.vt_f_tlh=WT.vt_f_tlv="0"}else{var B=dcsGetIdCrumb(A,"id");var D=parseInt(dcsGetCrumb(A,"lv"));var M=parseInt(dcsGetCrumb(A,"ss"));if((B==null)||(B=="null")||isNaN(D)||isNaN(M)){return}WT.co_f=B;var F=new Date(D);WT.vt_f_tlh=Math.floor((F.getTime()-I)/1000);J.setTime(M);if((K.getTime()>(F.getTime()+1800000))||(K.getTime()>(J.getTime()+28800000))){WT.vt_f_tlv=Math.floor((J.getTime()-I)/1000);J.setTime(K.getTime());WT.vt_f_s="1"}if((K.getDay()!=F.getDay())||(K.getMonth()!=F.getMonth())||(K.getYear()!=F.getYear())){WT.vt_f_d="1"}}WT.co_f=escape(WT.co_f);WT.vt_sid=WT.co_f+"."+(J.getTime()-I);DCSext.wsid=getSessionID("JSESSIONID");if(document.cookie.indexOf("anon")!=-1){DCSext.avid=dcsGetCookie("anon")}var C="; expires="+E.toGMTString();document.cookie=A+"=id="+WT.co_f+":lv="+K.getTime().toString()+":ss="+J.getTime().toString()+C+"; path=/"+(((typeof(gFpcDom)!="undefined")&&(gFpcDom!=""))?("; domain="+gFpcDom):(""));if(document.cookie.indexOf(A+"=")==-1){WT.co_f=WT.vt_sid=WT.vt_f_s=WT.vt_f_d=WT.vt_f_tlh=WT.vt_f_tlv="";WT.vt_f=WT.vt_f_a="2"}}function dcsEvt(B,A){var C=B.target||B.srcElement;while(C.tagName&&(C.tagName!=A)){C=C.parentElement||C.parentNode}return C}function dcsBind(B,A){if((typeof(window[A])=="function")&&document.body){if(document.body.addEventListener){document.body.addEventListener(B,window[A],true)}else{if(document.body.attachEvent){document.body.attachEvent("on"+B,window[A])}}}}function dcsET(){var A=(navigator.appVersion.indexOf("MSIE")!=-1)?"click":"mousedown";dcsBind(A,"dcsDownload");dcsBind(A,"dcsFormButton");dcsBind("keypress","dcsFormButton");dcsBind(A,"dcsImageMap")}function dcsMultiTrack(){if(arguments.length%2==0){for(var B=0;B<arguments.length;B+=2){if(arguments[B].indexOf("WT.")==0){WT[arguments[B].substring(3)]=arguments[B+1]}else{if(arguments[B].indexOf("DCS.")==0){DCS[arguments[B].substring(4)]=arguments[B+1]}else{if(arguments[B].indexOf("DCSext.")==0){DCSext[arguments[B].substring(7)]=arguments[B+1]}}}}var A=new Date();DCS.dcsdat=A.getTime();dcsFunc("dcsCookie");dcsCustom();dcsTag()}}function dcsSetVar(){if((arguments.length%2==0)&&(navigator.appVersion.indexOf("MSIE")!=-1)){for(var A=0;A<arguments.length;A+=2){if(arguments[A].indexOf("WT.")==0){WT[arguments[A].substring(3)]=arguments[A+1]}else{if(arguments[A].indexOf("DCS.")==0){DCS[arguments[A].substring(4)]=arguments[A+1]}else{if(arguments[A].indexOf("DCSext.")==0){DCSext[arguments[A].substring(7)]=arguments[A+1]}}}}}}function dcsSetVarCap(E){var F=E.onclick.toString();var A=F.substring(F.indexOf("dcsSetVar(")+10,F.length);var C=A.substring(0,A.indexOf(");")).replace(/\s"/gi,"").replace(/"/gi,"");var D=C.split(",");if(D.length!=-1){for(var B=0;B<D.length;B+=2){if(D[B].indexOf("WT.")==0){WT[D[B].substring(3)]=D[B+1]}else{if(D[B].indexOf("DCS.")==0){DCS[D[B].substring(4)]=D[B+1]}else{if(D[B].indexOf("DCSext.")==0){DCSext[D[B].substring(7)]=D[B+1]}}}}}}function dcsNavigation(A){try{var C=0;while(C!=1){if(A.parentNode.tagName!="DIV"){A=A.parentNode}if(A.parentNode.tagName=="DIV"){if((A.parentNode.getAttribute("id"))||(A.parentNode.className)){DCSext.wtNav=A.parentNode.getAttribute("id")||A.parentNode.className;C=1}else{A=A.parentNode}}}}catch(B){}}function dcsDownload(A){A=A||(window.event||"");if(A){var E=dcsEvt(A,"A");if(E){if(E.href&&E.hostname&&E.protocol&&(E.protocol.indexOf("http")!=-1)){if(E.getAttribute("delegatedtracking")=="true"){}else{dcsNavigation(E);if((navigator.appVersion.indexOf("MSIE")==-1)&&(E.onclick)){dcsSetVarCap(E)}var D=E.pathname?((E.pathname.indexOf("/")!=0)?"/"+E.pathname:E.pathname):"/";if(E.hasAttribute("data-wt-ti")){var B=E.getAttribute("data-wt-ti")}else{if(document.all){var B=E.innerText||E.innerHTML||""}else{var B=E.textContent.replace(/^\s+/,"").replace(/\s+$/,"")||E.innerHTML||""}}var C="";if(E.hasAttribute("data-wt-mt")){C=E.getAttribute("data-wt-mt")}var F=["DCS.dcssip",E.hostname,"DCS.dcsuri",D,"DCS.dcsqry",E.search||"","WT.ti","Link:"+B,"WT.dl","1","WT.ad","","WT.mc_id","","WT.sp",""];if(C){F=F.concat(C.split(/\s*,\s*/))}dcsMultiTrack.apply(undefined,F);DCS.dcssip=DCS.dcsuri=DCS.dcsqry=WT.ti=WT.dl=B=D=""}}}}}function dcsImageMap(A){A=A||(window.event||"");if(A){var B=dcsEvt(A,"AREA");if(B){if(B.href&&B.hostname&&B.protocol&&(B.protocol.indexOf("http")!=-1)){dcsNavigation(B);var C=B.pathname?((B.pathname.indexOf("/")!=0)?"/"+B.pathname:B.pathname):"/";dcsMultiTrack("DCS.dcssip",B.hostname,"DCS.dcsuri",C,"DCS.dcsqry",B.search||"","WT.ti","Link:Image Map","WT.dl","1","WT.ad","","WT.mc_id","","WT.sp","");DCS.dcssip=DCS.dcsuri=DCS.dcsqry=WT.ti=WT.dl=""}}}}function dcsFormButton(K){K=K||(window.event||"");if(K){var J="INPUT,BUTTON,SPAN";var B=J.toUpperCase().split(",");for(var G=0;G<B.length;G++){var H=dcsEvt(K,B[G]);var I=H.type||"";if(I&&((I=="submit")||(I=="image")||(I=="button")||(I=="reset"))||((I=="text")&&((K.which||K.keyCode)==13))){var F=gTitle=gMethod=qry="";dcsNavigation(H);if(H.form){F=H.form.action||window.location.pathname;gTitle=H.form.id||H.form.className||H.form.name||H.name||"Unknown";gMethod=H.form.method||"Unknown"}else{F=window.location.pathname;gTitle=H.name||H.id||H.className||"Unknown";gMethod="Input"}if(H.hasAttribute("data-wt-ti")){gTitle=H.getAttribute("data-wt-ti")}if((F!="")&&(gTitle!="")&&(gMethod!="")&&(K.keyCode!=9)){if(F.indexOf("?")!=-1){var D=F.split("?");F=D[0];qry=D[1]}if(F.indexOf("http://")!=-1||F.indexOf("https://")!=-1){var C=F.substr(7).split("/");F="";for(var G=1;G<C.length;G++){F+="/"+C[G]}}var E="";if(H.hasAttribute("data-wt-mt")){E=H.getAttribute("data-wt-mt")}var A=["DCS.dcssip",H.hostname||window.location.host||"","DCS.dcsuri",F,"DCS.dcsqry",qry,"WT.ti","FormButton:"+gTitle,"WT.dl","2","WT.fm",gMethod,"WT.ad","","WT.mc_id","","WT.sp",""];if(E){A=A.concat(E.split(/\s*,\s*/))}dcsMultiTrack.apply(undefined,A)}DCS.dcsuri=DCS.dcsqry=qry=WT.ti=WT.dl=WT.fm=""}}}}function dcsAdSearch(){if(document.links){for(var C=0;C<document.links.length;C++){var A=document.links[C].href+"";var F=A.toUpperCase().indexOf("WT.AC=");if(F!=-1){var E=F+6;var B=A.indexOf("&",E);var D=A.substring(E,(B!=-1)?B:A.length);WT.ad=WT.ad?(WT.ad+";"+D):D}}}}function dcsCleanUp(){_DCS=new Object();_WT=new Object();_DCSext=new Object();_WT.co_f=WT.co_f;_WT.vt_sid=WT.vt_sid;_WT.Site=WT.Site;_DCSext.hostname=DCSext.hostname;_DCSext.pos=DCSext.pos;_DCSext.tld=DCSext.tld;_DCSext.b=DCSext.b;_DCSext.wtEvtSrc=DCSext.wtEvtSrc;_DCSext.owwPage=DCSext.owwPage;if(arguments.length%2==0){for(var A=0;A<arguments.length;A+=2){if(arguments[A].indexOf("WT.")==0){_WT[arguments[A].substring(3)]=arguments[A+1]}else{if(arguments[A].indexOf("DCS.")==0){_DCS[arguments[A].substring(4)]=arguments[A+1]}else{if(arguments[A].indexOf("DCSext.")==0){_DCSext[arguments[A].substring(7)]=arguments[A+1]}}}}}DCS=_DCS;WT=_WT;DCSext=_DCSext}function dcsAdv(){if((typeof(gTrackEvents)!="undefined")&&gTrackEvents){WT.wtsv=1;if(typeof(WT.sp)!="undefined"){WT.sv_sp=WT.sp}}dcsFunc("dcsCookie");dcsFunc("dcsAdSearch");var B=document.getElementsByName("WT.ti");for(var A=0;A<B.length;A++){if(B[A].tagName==="META"){DCSext.wtEvtSrc=B[A].content;break}}}function dcsVar(){var B=new Date();DCSext.hostname=window.location.hostname;WT.Site=DCSext.hostname;WT.tz=B.getTimezoneOffset()/60*-1;if(WT.tz==0){WT.tz="0"}WT.bh=B.getHours();WT.ul=navigator.appName=="Netscape"?navigator.language:navigator.userLanguage;if(typeof(screen)=="object"){WT.cd=navigator.appName=="Netscape"?screen.pixelDepth:screen.colorDepth;WT.sr=screen.width+"x"+screen.height}if(typeof(navigator.javaEnabled())=="boolean"){WT.jo=navigator.javaEnabled()?"Yes":"No"}if(document.title){WT.ti=gI18n?dcsEscape(dcsEncode(document.title),I18NRE):document.title}WT.js="Yes";WT.jv=dcsJV();if(document.body&&document.body.addBehavior){document.body.addBehavior("#default#clientCaps");if(document.body.connectionType){WT.ct=document.body.connectionType}document.body.addBehavior("#default#homePage");WT.hp=document.body.isHomePage(location.href)?"1":"0"}if(parseInt(navigator.appVersion)>3){if((navigator.appName=="Microsoft Internet Explorer")&&document.body){WT.bs=document.body.offsetWidth+"x"+document.body.offsetHeight}else{if(navigator.appName=="Netscape"){WT.bs=window.innerWidth+"x"+window.innerHeight}}}WT.fi="No";if(window.ActiveXObject){for(var E=10;E>0;E--){try{var C=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+E);WT.fi="Yes";WT.fv=E+".0";break}catch(G){}}}else{if(navigator.plugins&&navigator.plugins.length){for(var E=0;E<navigator.plugins.length;E++){if(navigator.plugins[E].name.indexOf("Shockwave Flash")!=-1){WT.fi="Yes";WT.fv=navigator.plugins[E].description.split(" ")[2];break}}}}if(gI18n){WT.em=(typeof(encodeURIComponent)=="function")?"uri":"esc";if(typeof(document.defaultCharset)=="string"){WT.le=document.defaultCharset}else{if(typeof(document.characterSet)=="string"){WT.le=document.characterSet}}}WT.dl="0";DCS.dcsdat=B.getTime();DCS.dcssip=window.location.hostname;DCS.dcsuri=window.location.pathname;DCSext.owwPage=window.location.pathname;if(window.location.search){DCS.dcsqry=window.location.search;if(gQP.length>0){for(var E=0;E<gQP.length;E++){var H=DCS.dcsqry.indexOf(gQP[E]);if(H!=-1){var F=DCS.dcsqry.substring(0,H);var A=DCS.dcsqry.substring(H+gQP[E].length,DCS.dcsqry.length);DCS.dcsqry=F+A}}}}if((window.document.referrer!="")&&(window.document.referrer!="-")){var D=window.document.referrer;if(D.split("?")[0].indexOf(window.location.hostname)!=-1){D=D.split("?")[0]}if(!(navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)<4)){DCS.dcsref=gI18n?dcsEscape(D,I18NRE):D}}}function dcsA(B,A){return"&"+B+"="+dcsEscape(A,RE)}function dcsEscape(A,C){if(typeof(C)!="undefined"){var B=new String(A);for(R in C){B=B.replace(C[R],R)}return B}else{return escape(A)}}function dcsEncode(A){return(typeof(encodeURIComponent)=="function")?encodeURIComponent(A):escape(A)}function dcsCreateImage(A){if(document.images){gImages[gIndex]=new Image;gImages[gIndex].src=A;gIndex++}else{document.write('<IMG ALT="" BORDER="0" NAME="DCSIMG" WIDTH="1" HEIGHT="1" SRC="'+A+'">')}}function dcsMeta(){var A;if(document.all){A=document.all.tags("meta")}else{if(document.documentElement){A=document.getElementsByTagName("meta")}}if(typeof(A)!="undefined"){for(var B=1;B<=A.length;B++){var C=A.item(B-1);if(C.name){if(C.name.indexOf("WT.")==0){WT[C.name.substring(3)]=(gI18n&&(C.name.indexOf("WT.ti")==0))?dcsEscape(dcsEncode(C.content),I18NRE):C.content}else{if(C.name.indexOf("DCSext.")==0){DCSext[C.name.substring(7)]=C.content}else{if(C.name.indexOf("DCS.")==0){DCS[C.name.substring(4)]=(gI18n&&(C.name.indexOf("DCS.dcsref")==0))?dcsEscape(C.content,I18NRE):C.content}}}}}}}function dcsTag(){if(document.cookie.indexOf("WTLOPTOUT=")!=-1){return}var A="http"+(window.location.protocol.indexOf("https:")==0?"s":"")+"://"+gDomain+(gDcsId==""?"":"/"+gDcsId)+"/dcs.gif?";for(N in WT){if(WT[N]){A+=dcsA("WT."+N,WT[N])}}for(N in DCSext){if(DCSext[N]){A+=dcsA(N,DCSext[N])}}for(N in DCS){if(DCS[N]){A+=dcsA(N,DCS[N])}}if(A.length>2048&&navigator.userAgent.indexOf("MSIE")>=0){A=A.substring(0,2040)+"&WT.tu=1"}dcsCreateImage(A)}function dcsJV(){var B=navigator.userAgent.toLowerCase();var I=parseInt(navigator.appVersion);var H=(B.indexOf("mac")!=-1);var M=((B.indexOf("mozilla")!=-1)&&(B.indexOf("compatible")==-1));var C=(M&&(I==4));var L=(M&&(I>=5));var A=((B.indexOf("msie")!=-1)&&(B.indexOf("opera")==-1));var D=(A&&(I==4)&&(B.indexOf("msie 4")!=-1));var E=(A&&!D);var G=(B.indexOf("opera")!=-1);var K=(B.indexOf("opera 5")!=-1||B.indexOf("opera/5")!=-1);var J=(B.indexOf("opera 6")!=-1||B.indexOf("opera/6")!=-1);var F=(G&&!K&&!J);var O="1.1";if(L||F){O="1.5"}else{if((H&&E)||J){O="1.4"}else{if(E||C||K){O="1.3"}else{if(D){O="1.2"}}}}return O}function dcsFunc(A){if(typeof(window[A])=="function"){window[A]()}}function dcsUnQry(A){var B=DCS.dcsqry.indexOf(A);if(B!=-1){var E=DCS.dcsqry.substring(0,B);var F=DCS.dcsqry.substring(B+A.length+1);var C="";var D;if(F.indexOf("&")==-1){D=F}else{D=F.substring(0,F.indexOf("&"));C=F.substring(D.length+1)}if(A.substring(0,3)=="WT."){WT[A.substring(3)]=D}else{if(A.substring(0,4)=="DCS."){DCS[A.substring(4)]=D}else{DCSext[A]=D}}DCS.dcsqry=E+C}}function dcsCustom(){if(DCS.dcsqry){dcsUnQry("WT.mc_id");dcsUnQry("gcid");var C=DCSext.gcid;if(C){var A=C.indexOf("-");var B=C.substring(A+1,A+3);if(B=="CY"||B=="DN"||B=="OG"){DCSext.gcid=C.substring(0,A)}WT.mc_id=DCSext.gcid}}}function wtInit(){gService=true;gTimeZone=-6;hostName=window.location.hostname;indexOfDot=hostName.indexOf(".");lengthOfHostName=hostName.length;if(indexOfDot==-1){gFpcDom=hostName}else{gFpcDom=hostName.slice(indexOfDot,lengthOfHostName)}gImages=new Array;gIndex=0;DCS=new Object();WT=new Object();DCSext=new Object();gQP=new Array();gI18n=false;if(window.RegExp){RE={"%09":/\t/g,"%20":/ /g,"%23":/\#/g,"%26":/\&/g,"%2B":/\+/g,"%3F":/\?/g,"%5C":/\\/g};I18NRE={"%25":/\%/g}}dcsVar();dcsMeta();if((typeof(gTrackEvents)!="undefined")&&gTrackEvents){dcsET()}dcsFunc("dcsAdv");dcsCustom();dcsTag();dcsCleanUp()}function getSessionID(E){var C=document.cookie;var B=C.lastIndexOf(E+"=");if(B==-1){return null}var D=C.substring(B+E.length+1);var A=D.indexOf(";");if(A==-1){A=D.length}D=D.substring(0,A);D=D.split("|")[0];return D}var BrTrk={getTracker:function(B,A){return(new BrTrkClass(B,A))}};var BrUtils={returnObjById:function(A){if(document.getElementById){var B=document.getElementById(A)}else{if(document.all){var B=document.all[A]}else{if(document.layers){var B=document.layers[A]}}}return B},isValid:function(A){return(A!=null)},addEvent:function(A,B,C){if(A.addEventListener){A.addEventListener(B,C,true)}else{if(A.attachEvent){A.attachEvent("on"+B,C)}else{A["on"+B]=C}}},onLoadHandler:function(B,A){if(B.addEventListener){B.addEventListener("DOMContentLoaded",A,false)}else{if(B.attachEvent){B.attachEvent("onreadystatechange",function(){if(B.readyState==="complete"){A()}})}}}};function BrTrkClass(Aa,Y){var AA="http://lb-static1-1568763564.us-east-1.elb.amazonaws.com/pix.gif";var At="https://cdns.brsrvr.com/pix.gif";var Av="_br_uid_1";var X="_br_uid_2";var AR=undefined;var Ap=undefined;var Aw=undefined;var AM=undefined;var AG=[5000,25000,75000,150000];var AJ=undefined;var Ay=undefined;var Au=undefined;this.version=Aa;this.data=Y;function Al(){if(typeof br_related_rid!="undefined"&&BrUtils.isValid(br_related_rid)){Aw=br_related_rid}}function Ao(A){var C=[];for(var B in A){C.push(B+"="+encodeURIComponent(A[B]))}return C.join("&")}function Ax(C){var B=C.split(".");var A=B.length;if(A<=2){return C}if(B[A-1].length<=2&&B[A-2].length<=3){return B[A-3]+"."+B[A-2]+"."+B[A-1]}else{return B[A-2]+"."+B[A-1]}}function AE(A,C,B){var E=new Date();E.setDate(E.getDate()+365*100);var D=A+"="+escape(C)+"; expires="+E.toGMTString()+"; path=/";if(BrUtils.isValid(B)){D=D+"; domain="+B}document.cookie=D}function AL(A){if(BrUtils.isValid(document.cookie)&&(document.cookie.length>0)){var C=document.cookie.indexOf(A+"=");if(C!=-1){C=C+A.length+1;var B=document.cookie.indexOf(";",C);if(B==-1){B=document.cookie.length}return unescape(document.cookie.substring(C,B))}}return""}function AF(D,B){var C=B.split("_");for(var A in C){if(C[A]==D){return true}}return false}function Ak(){var B=AL(Av);if(BrUtils.isValid(B)&&B.length>0){AR=B;return}var A=Math.round(Math.random()*10000000000000);AR="uid="+A+":";AE(Av,AR);AR=AL(Av)}function Af(){var D=AL(Av);var E=AL(X);var A=false;if(BrUtils.isValid(D)&&D.length>0){AR=D;A=true}var B=(BrUtils.isValid(E)&&E.length>0);var C=Math.round(Math.random()*10000000000000);if(!A){AR="uid="+C+":";AE(Av,AR);AR=AL(Av)}if(!B){E=AR+":"}else{if(!AF(AR,E)){E=E+"_"+AR}}if(E!=Ap&&E.length<1000){var F=Ax(document.domain);AE(X,E,F);Ap=AL(X)}}function An(B,C,D){for(var A=0;A<B.length;A++){if(BrUtils.isValid(B[A].getAttribute("name"))){if(B[A].getAttribute("name").toLowerCase()==C){return B[A].getAttribute("content").substr(0,D)}}if(BrUtils.isValid(B[A].getAttribute("NAME"))){if(B[A].getAttribute("NAME").toLowerCase()==C){return B[A].getAttribute("CONTENT").substr(0,D)}}}return""}function Ag(B){var A=document.getElementsByTagName("meta");if(!BrUtils.isValid(A)||A.length==0){A=document.getElementsByTagName("META")}B.mk=An(A,"keywords",200);B.md=An(A,"description",200);return B}function AC(B){var J=document.getElementsByTagName("img");if(!BrUtils.isValid(J)){return B}var M=[];var C={};var K=0;for(var H=0;H<J.length;H++){var E=5;var A=5;if(BrUtils.isValid(J[H].width)){A=J[H].width;if(A<=10){continue}}if(BrUtils.isValid(J[H].height)){E=J[H].height;if(E<=10){continue}}if(BrUtils.isValid(J[H].getAttribute("src"))){var D=J[H].getAttribute("src");if(!BrUtils.isValid(D)){continue}if(!(D in C)){M[K++]=J[H];C[D]=1}}}M.sort(function(P,Q){var O=0;if(BrUtils.isValid(Q.height)&&BrUtils.isValid(Q.width)){O=Q.height*Q.width}var S=0;if(BrUtils.isValid(P.height)&&BrUtils.isValid(P.width)){S=P.height*P.width}return(O-S)});var I=[];var L=5;if(L>M.length){L=M.length}var G=0;var F=0;for(var H=0;H<L;H++){if(BrUtils.isValid(M[H].getAttribute("src"))){F=F+M[H].getAttribute("src").length;if(F>500){break}I[G++]=M[H].getAttribute("src")}}B.briu=I.join(":::");return B}function Az(){var A=Y;A.version=Aa;A.url=location.href;if(Y.explicit_referrer&&Y.explicit_referrer!=""){A.ref=Y.explicit_referrer}else{A.ref=document.referrer}if(A.acct_id=="4024"&&(!A.ref||A.ref=="")){if(s.referrer){A.ref=s.referrer}}A.sid=Aw;A.cookie=AR;A.cookie2=Ap;A.rand=Math.random();return A}function Ar(B){var A=Ao(B);var D=new Image();if(A.length>1900){A=A.substr(0,1900)+"&tr=1"}var C=("https:"==document.location.protocol)?At:AA;D.src=C+"?"+A}function AP(){var A=Az();A.type="pageview";if(BrUtils.isValid(document.title)){A.title=document.title.substr(0,200)}AB();if(BrUtils.isValid(AJ)){A.fbappid=AJ;A.fbacctok=Au;A.fbuid=Ay}if(Y.acct_id=="4041"){Ag(A)}if(Y.acct_id=="4041"||Y.acct_id=="4014"||Y.acct_id=="4034"){AC(A)}Ar(A)}function Am(){var A=Az();A.type="showclick";Ar(A)}function Ah(){var A=Az();A.type="hideclick";Ar(A)}function AK(){var A=BrUtils.returnObjById("br_show_id");if(!BrUtils.isValid(A)){setTimeout(function(){AK()},1000);return}BrUtils.addEvent(A,"mousedown",function(){Am()})}function Ai(){var A=BrUtils.returnObjById("br_hide_id");if(!BrUtils.isValid(A)){setTimeout(function(){Ai()},1000);return}BrUtils.addEvent(A,"mousedown",function(){Ah()})}function Aq(A){var B=Az();B.type="linkclick";B.link=A;if(BrUtils.isValid(this.startTime)){B.time=(new Date()).getTime()-this.startTime}Ar(B)}function AI(A){if(BrUtils.isValid(A)&&BrUtils.isValid(A.href)){BrUtils.addEvent(A,"mousedown",function(){Aq(A.href)})}}function AH(A){if(!BrUtils.isValid(A)){return}var C=A.getElementsByTagName("a");if(!BrUtils.isValid(C)){return}for(var B=0;B<C.length;++B){AI(C[B])}}function As(B){var A=BrUtils.returnObjById("br-related-searches-widget");if(!BrUtils.isValid(A)&&B){BrUtils.onLoadHandler(document,function(){As(false)});return}AH(A)}function AN(B){var A=Az();A.type="sitetime";A.time=AG[B];Ar(A)}function AQ(){for(var A=0;A<AG.length;++A){(function(B){setTimeout(function(){AN(B)},AG[B])})(A)}}function Ac(){if(Y.acct_id=="4024"&&(!Y.explicit_referrer||Y.explicit_referrer=="")&&(!document.referrer||document.referrer=="")){setTimeout(function(){AP()},1000)}else{AP()}As(true);if(Y.acct_id=="4035"){AQ()}if(Y.acct_id=="4041"){AK();Ai();Z()}}function Ab(){BrUtils.onLoadHandler(document,function(){AH(document)})}function Ae(){this.startTime=(new Date()).getTime();Af();Al()}function Z(){if(typeof FB==="undefined"){setTimeout(Z,1000);return}Aj()}function AD(A){var B=Az();B.type="fblikebtnclick";B.link=A;AB();if(BrUtils.isValid(AJ)){B.fbappid=AJ;B.fbacctok=Au;B.fbuid=Ay}if(BrUtils.isValid(this.startTime)){B.time=(new Date()).getTime()-this.startTime}Ar(B)}function Aj(){AO()}function AO(){FB.Event.subscribe("edge.create",function(A){AD(A)})}function AB(){var C=Ad();for(key in C){if(key.indexOf("fbs_")==0){AJ=key.split("_")[1];var D=C[key].replace(/^"+|"+$/g,"");var B=D.split("&");for(i=0;i<B.length;i++){var A=B[i].split("=");if(A[0]=="access_token"){Au=A[1]}else{if(A[0]=="uid"){Ay=A[1]}}}}}}function Ad(){var G=[];if(BrUtils.isValid(document.cookie)&&(document.cookie.length>0)){var F=document.cookie.replace(/,/g,";");var E=F.split(";");for(i=0;i<E.length;i++){var D=E[i].replace(/^\s+|\s+$/g,"");var C=D.indexOf("=");var A=D.substring(0,C);var B=D.substring(C+1).replace(/^"+|"+$/g,"");G[A]=B}}return G}this.enableTracking=Ac;this.logPageView=AP;this.enableLinkTracking=As;this.enableTimeTracking=AQ;this.enableFullLinkTracking=Ab;this.enableFBLikeButtonClickTracking=Aj;this.enableShowTracking=AK;this.enableHideTracking=Ai;Ae()}var resizeIFrameToContents=function(B,A){if(arguments.length<1||!B||B.tagName!=="IFRAME"){log.error("Advert: resizeIFrameToContents() requires an IFRAME argument");return}new function(){this.debug=false;this.resizerTimeout=window.setTimeout(function(){window.clearInterval(this.resizerInterval);if(this.debug){log.debug("Advert: resizer timed-out after "+A+"ms")}this.resizerInterval=null}.bind(this),A);this.repairBadUrlTargets=function(){var G=$A(this.iframe.contentWindow.document.getElementsByTagName("A"));var E=$A(this.iframe.contentWindow.document.getElementsByTagName("AREA"));var D=G.concat(E);for(var F=0;F<D.length;F++){if(Element.hasAttribute(D[F],"href")){var H=D[F].target.toLowerCase();if(H===""||(H!=="_blank"&&H!=="_parent"&&H.indexOf("_")==0)){if(H===""){H="undeclared"}if(this.debug){log.debug("Advert: repairing link target: "+H+" -&gt; _parent")}D[F].target="_parent"}}}};var C=function(){contentWindow=this.iframe.contentWindow;contentBody=contentWindow.document.body;if(contentBody){var E=contentBody.scrollWidth;var G=contentBody.scrollHeight;this.iframe.width="0px";this.iframe.height="0px";var D=contentBody.scrollWidth;var F=contentBody.scrollHeight;if(D>0&&F>0){window.clearInterval(this.resizerInterval);window.clearTimeout(this.resizerTimeout);this.resizerInterval=null;this.resizerTimeout=null;this.iframe.width=D+"px";this.iframe.height=F+"px";this.iframe.style.visibility="visible";contentWindow.resized=true;this.repairBadUrlTargets();if(this.debug){log.debug("Advert: resized: "+D+"px x "+F+"px")}}else{this.iframe.width=E+"px";this.iframe.height=G+"px"}}}.bind(this);this.iframe=B;this.resizerInterval=window.setInterval(C,100)}};var Advert=Class.create(Abstract.Agent,{beforeDOMReady:true,TIMEOUT:10000,initExtend:function(){this.deferred=this.params.deferred;if(this.deferred){Page.deferredAdverts.newAd(this)}else{this.populate()}},populate:function(){this.element.oww_adURL=unescape(this.params.adURL);this.element.contentWindow.location.replace("/cacheable/ad.html");var A=function(){if(!this.element.contentWindow.adLoaded){window.setTimeout(A,100)}else{this.displayPopulatedAd()}}.bind(this);A()},displayPopulatedAd:function(){resizeIFrameToContents(this.element,this.TIMEOUT)}});var AirResultsCard=Class.create();AirResultsCard.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initExtend:function(){if(!this.params.swapLink){log.error("AirResultsCard: Missing required param");return}this.element.observe("click",this.swap.bindAsEventListener(this))},swap:function(B){if(this.swapped===undefined){this.link=$(this.element.getElementsByTagName("A")[0]);this.swapLink=(new Element("div")).update(this.params.swapLink).down();this.swapLink.addClassName("hideLink hidden");this.link.insert({after:this.swapLink});this.link.addClassName("visible");this.content=$(this.element.up(".resultsCardPanelAir").getElementsByClassName("airItinerary")[0].getElementsByClassName("summary")[0]);this.url=this.swapLink.href;var A=new Ajax.Request(this.url,{method:"get",onSuccess:function(E){var G=$((new Element("div")).update(E.responseText).getElementsByClassName("details")[0]);if(G){this.swapContent.replace(G);this.pi.stop();this.pi=null;this.swapContent=G;Page.initializeDOMFragment(this.swapContent);new Effect.Morph(this.itinerary,{style:"height: "+this.swapContent.getHeight()+"px",duration:0.3,afterFinish:function(){this.itinerary.setStyle({height:"",overflow:""})}.bind(this)})}else{var H=$A((new Element("div")).update(E.responseText).getElementsByClassName("error"));if(H.length!=0){var C=this.swapContent.up(".resultsCardPanelAir");C.setStyle({position:"relative"});var D=new Element("div",{"class":"resultMask"});D.setOpacity(0.8);D.setStyle({width:C.getWidth()+"px",height:C.getHeight()+"px",top:"0px"});var F=$(new Element("div"));F.addClassName("airResultsError");H.each(function(I){F.insert({bottom:I})});C.insert({bottom:D});C.insert({bottom:F});F.setStyle({width:C.getWidth()+"px",marginTop:(((C.getHeight()-F.getHeight())/2))+"px",top:"0px"})}else{log.error("No flight details content and no errors were found. Returning summary.");this.swapLink.hideByClass();this.link.showByClass();this.element.stopObserving("click")}this.swapContent.replace(this.content);this.pi.stop();this.pi=null}}.bind(this)});this.itinerary=this.content.up(".airItinerary");this.itinerary.setStyle({height:this.itinerary.getHeight()+"px",overflow:"hidden"});this.pi=new ProgressIndicator();this.swapContent=this.pi.spinnerElement}if(this.swapped){this.swapLink.hideByClass();this.link.showByClass();if(this.swapContent){this.swapContent.replace(this.content)}}else{this.link.hideByClass();this.swapLink.showByClass();if(this.swapContent){this.content.replace(this.swapContent)}}this.swapped=!this.swapped;B.preventDefault()}});var AjaxRequestOnEvent=Class.create(Abstract.Agent,{initExtend:function(){if(!this.params.url){log.error("Required param 'url' missing for agent AjaxRequestOnEvent.");return}this.options=this.params.options||{method:"get"};if(this.params.redirect){for(var A in this.params.redirect){this.options[A]=this.redirect(this.params.redirect[A]||this.element.readAttribute("href"))}}this.element.on(this.params.event||"click",this.request.bind(this))},request:function(A){if(this.params.preventDefault){A.preventDefault()}new Ajax.Request(this.params.url,this.options)},redirect:function(A){return function(){window.location.href=A}}});var AjaxStatusFlagManager=Class.create();AjaxStatusFlagManager.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){document.observe("contentUpdate:started",this.ajaxStarted.bindAsEventListener(this));document.observe("contentUpdate:succeeded",this.ajaxSucceeded.bindAsEventListener(this));this.element.value="true"},ajaxStarted:function(A){log.debug("setting ajax response status to false");this.element.value="false"},ajaxSucceeded:function(A){log.debug("setting ajax response status to true");this.element.value="true"}});var AnyCheckbox=Class.create();AnyCheckbox.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){var A=new Template('<label class="control checkbox anyCheckbox">			<input name="" value="ANY" type="checkbox" />			<span class="labelText">#{label}</span>		</label>');A=A.evaluate({label:this.params.label});this.checkboxes=this.element.select("input[type=checkbox]");if(!this.checkboxes||this.checkboxes.length<2){log.error("AnyCheckbox: Could not find checkboxes");return}this.checkboxes[0].up("label").insert({before:A});this.anyCheckbox=this.element.select("input[type=checkbox]")[0];if(this.shouldCheckAny()){this.checkAny()}this.element.observe("click",this.checkStatus.bindAsEventListener(this))},checkStatus:function(B){var A=B.element();if(A==this.anyCheckbox){if(A.checked){this.checkAny()}else{this.uncheckOthers()}}else{if(this.shouldCheckAny()){this.checkAny()}else{this.uncheckAny()}}},shouldCheckAny:function(){var B=this.checkboxes.length;var C=this.checkboxes[0].checked;for(var A=1;A<B;A++){if(this.checkboxes[A].checked!=C){return false}}return true},checkAny:function(){this.anyCheckbox.checked=true;this.anyCheckbox.disabled=true;this.uncheckOthers()},uncheckAny:function(){this.anyCheckbox.disabled=false;this.anyCheckbox.checked=false},uncheckOthers:function(){this.checkboxes.each(function(A){A.checked=false})}});var AutoSubmitter=Class.create();AutoSubmitter.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){setTimeout(function(){this.element.click()}.bind(this),500)}});var Autocomplete=Class.create();Autocomplete.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(!this.params.url){log.error("Autocomplete: No 'url' parameter was passed to agent");return}this.input=this.element.getElementsByTagName("input")[0];if(!this.input){log.error("Autocomplete: No input found inside element");return}$(this.input).writeAttribute("autocomplete","off");this.suggestions=new Element("div",{className:"smartFill"});this.element.parentNode.insertBefore(this.suggestions,this.element.nextSibling);this.params.parameters=Object.toQueryString(this.params.parameters);if(this.params.highlightMatches){this.params.transformResponse=this.highlightMatches.bind(this)}this.autocompleter=new Ajax.AutocompleterJSON(this.input,this.suggestions,this.params.url,this.params);if(this.params.additionalInfoInputName){this.additionalInfo=new Element("input",{type:"hidden",name:this.params.additionalInfoInputName,value:this.params.additionalInfoInputValue||""});this.element.parentNode.insertBefore(this.additionalInfo,this.element.nextSibling);new ClearValueOnChange(this.element,{type:"ClearValueOnChange",params:{inputToClearName:this.params.additionalInfoInputName,inputToClearValue:this.params.additionalInfoInputValue||null}});Event.observe(this.element.form,"submit",this.matchResults.bindAsEventListener(this))}},nonWord:UnicodeRegEx(/[^\p{L}\p{M}\p{N}]+/),highlightMatches:function(C){var D=this.input.value.escapeRegex().toLowerCase().split(this.nonWord).sort();for(var A=0;A<D.length;A++){while(D[A].length==0||A<D.length-1&&D[A]==D[A+1].substr(0,D[A].length)){D.splice(A,1)}}var B=new RegExp("\\b("+D.join("|")+")","ig");$(C).select("li").each(function(E){E.cleanWhitespace();$A(E.childNodes).each(function(F){if(F.nodeName=="#text"){var G=F.nodeValue.replace(B,'<span class="match">$1</span>');E.replaceChild(new Element("span").update(G),F)}})});return C},matchResults:function(){if(this.autocompleter.results){var A=this.input.value.strip().toLowerCase();var C=this.autocompleter.results;for(var B=0;B<C.length;B++){if(A==C[B].suggestion.toLowerCase()){this.additionalInfo.value=C[B].additionalInfo;break}}}}});var AirSmartFill=Class.create(Autocomplete,{initExtend:function($super){Object.extend(this.params,{url:"/helper/airSmartfill",frequency:0.25,highlightMatches:true,paramName:"searchedText",cloneWidth:false});$super()}});var CCSpecialFields=Class.create();CCSpecialFields.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.container=this.element.getParentByClassName("editBillingProfileInclude");this.targetFields=$A(this.container.getElementsByClassName(this.params.targetClassname));this.cardIDsRequiringFields=[];this.params.cardIDs.each(function(A){log.info("Adding "+A.code+" to special card array for "+this.params.targetClassname+" classed objects.");this.cardIDsRequiringFields[A.code]=true}.bind(this));$A(this.element.getElementsByTagName("input")).each(function(A){if(A.type=="radio"){Event.observe(A,"click",this.showHideFields.bindAsEventListener(this))}}.bind(this))},showHideFields:function(B){var A=Event.element(B).value;if(this.cardIDsRequiringFields[A]){this.targetFields.each(function(C){C.showByClass()}.bind(this))}else{this.targetFields.each(function(C){C.hideByClass()}.bind(this))}}});var CCVImage=Class.create();CCVImage.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.creditCardList=this.params.cardsInList;this.image=Element.extend(this.element.parentNode).getFirstElementByClassName("ccvImg");this.textBlock=Element.extend(this.element.parentNode).getFirstElementByClassName("ccvText");this.displayBlock=Element.extend(this.element.parentNode).getFirstElementByClassName("ccvDisplay");this.content3DSBlock=$A(this.element.parentNode.getElementsByClassName("cc3DSContent"));this.display3DSBlock=Element.extend(this.element.parentNode).getFirstElementByClassName("cc3DSDisplay");$A(this.element.getElementsByTagName("input")).each(function(A){if(A.type=="radio"){if(this.image!=null){Event.observe(A,"click",this.swapCCVImage.bindAsEventListener(this))}if(this.content3DSBlock!=null&&this.content3DSBlock.length>=3){Event.observe(A,"click",this.swap3DSContent.bindAsEventListener(this))}}}.bind(this));this.swapCCVImage();this.swap3DSContent()},swapCCVImage:function(A){for(i=0;i<this.creditCardList.length;i++){if(this.creditCardList[i].code==Event.element(A).value){this.image.innerHTML=this.creditCardList[i].img;if(this.creditCardList[i].img==""){this.displayBlock.hideByClass()}else{this.displayBlock.showByClass()}this.textBlock.innerHTML=this.creditCardList[i].text;break}}},swap3DSContent:function(E){for(i=0;i<this.creditCardList.length;i++){if(this.creditCardList[i].code==Event.element(E).value){var D=Element.extend(this.content3DSBlock[1]).getElementsBySelector(".cc3DSContentItem");var C=this.creditCardList[i].secureLogoCode;var A="cc3DSContentItem"+C;for(var B=0;B<D.length;B++){if(A.match(D[B].id)){D[B].showByClass()}else{D[B].hideByClass()}}this.content3DSBlock[0].hideByClass();this.content3DSBlock[2].innerHTML="<p>"+this.creditCardList[i].securetext+"</p>";this.content3DSBlock[2].showByClass();if(this.creditCardList[i].securetext){this.display3DSBlock.showByClass()}else{this.display3DSBlock.hideByClass()}break}}}});var CalendarUtils={daysPerMonth:[31,28,31,30,31,30,31,31,30,31,30,31],getDaysInMonth:function(D,B){var A=this.daysPerMonth[D];if(D==1){var C=((B%4==0&&B%100!=0)||B%400==0);return(C?A+1:A)}else{return A}},cloneDateObject:function(A){return new Date(A.getFullYear(),A.getMonth(),A.getDate())}};var DatePickerWidget=Class.create(CalendarUtils,{initialize:function(A){log.info("initializing DatePickerWidget for input "+A.dateInputIndex);this.initialized=false;this.params=A;this.today=A.today;this.minDate=this.cloneDateObject(this.today);this.maxDate=A.maxDate;this.isFirstDate=A.dateInputIndex===0;this.target=$(A.dateInput);this.calContainer=A.hideMainContent?$(document.body):A.container;this.container=$(A.dateInput.parentNode);this.buildMarkup();document.observe("datePicker:updated",this.updateSelects.bindAsEventListener(this));document.observe("calendar:selectDate",this.updateSelectsFromCalendar.bindAsEventListener(this));if(A.hideMainContent){document.observe("calendar:hidden",function(){$("content").show();$$("div.footerStandardMod")[0].show();$$("div.pageHeader")[0].show()})}},buildMarkup:function(){var A=new Element("div");this.monthSelect=new Element("select").addClassName("datePicker");this.updateMonths();this.dateSelect=new Element("select").addClassName("datePicker");this.updateDays();Event.observe(this.monthSelect,"change",this.updateDays.bindAsEventListener(this));Event.observe(this.monthSelect,"change",this.setDate.bindAsEventListener(this));Event.observe(this.dateSelect,"change",this.setDate.bindAsEventListener(this));var B=new Element("a").addClassName("calIcon").update(this.params.calendarImage);Event.observe(B,"click",this.showCalendar.bindAsEventListener(this));this.target.hide();A.appendChild(this.monthSelect);A.appendChild(this.dateSelect);A.appendChild(B);this.container.appendChild(A);this.setDate()},showCalendar:function(B){if(!this.calContainer.calendarWidget){var C={today:this.today,maxDate:this.maxDate,container:this.calContainer,previous:this.params.previous,next:this.params.next,days:this.params.days,months:this.params.months,firstDayOfWeekIndex:this.params.firstDayOfWeekIndex,close:this.params.close,hideMainContent:this.params.hideMainContent,monthsToDisplay:this.params.monthsToDisplay,fullScreenView:true};this.calContainer.calendarWidget=new CalendarWidget(C)}document.fire("calendar:hide");if(this.params.hideMainContent){$("content").hide();$$("div.footerStandardMod")[0].hide();$$("div.pageHeader")[0].hide()}var A={rootEvent:B,minDate:this.isFirstDate?null:this.minDate,maxDate:this.maxDate,targetInput:this.target,container:this.calContainer,validateDate:this.params.validateDate};document.fire("calendar:showAndPosition",A)},updateMonths:function(){var D,A=this.isFirstDate?this.cloneDateObject(this.today):this.cloneDateObject(this.params.validateDate(this.params.dateInputArray[this.params.dateInputIndex-1].value));if(this.params.selectedDate!=null){D=this.params.selectedDate.getMonth()}this.minDate=this.cloneDateObject(A);this.monthSelect.innerHTML="";A.setDate(1);this.initialized=false;while(A<=this.maxDate){var E=A.getMonth();var C=A.getFullYear();var B=new Element("option").update(this.params.abbrMonths[E]+" "+C);B.setAttribute("value","["+E+","+C+"]");if(E==D){B.setAttribute("selected","selected")}this.monthSelect.appendChild(B);A.setMonth((E+1))}},updateDays:function(){var monthSelectValue=eval(this.monthSelect.options[this.monthSelect.selectedIndex].value);var month=monthSelectValue[0],year=monthSelectValue[1],selectedDay,startDate=this.minDate,day=startDate.getMonth()===month?startDate.getDate():1;this.dateSelect.innerHTML="";if(this.params.selectedDate!=null){selectedDay=this.params.selectedDate.getDate()}var operatingDate=new Date(year,month,day,0,0,0);var isLeapYear=((year%4==0&&year%100!=0)||year%400==0);var normalDays=this.daysPerMonth[month];var daysInMonth=month==1&&isLeapYear?normalDays+1:normalDays;for(var i=day;i<=daysInMonth;i++){operatingDate.setDate(i);if(operatingDate.getTime()>this.maxDate.getTime()){return}var option=new Element("option");option.setAttribute("value",i);var dayOfWeek=operatingDate.getDay();option.update(i+" "+this.params.abbrDays[dayOfWeek]);if(i===selectedDay||(!this.isFirstDate&&!this.initialized&&i===day+1)){option.setAttribute("selected","selected");this.initialized=true}this.dateSelect.appendChild(option)}},setDate:function(){var monthSelectValue=eval(this.monthSelect.options[this.monthSelect.selectedIndex].value);var daySelectValue=this.dateSelect.options[this.dateSelect.selectedIndex].value;var date=monthSelectValue[1]+"-"+(monthSelectValue[0]+1)+"-"+daySelectValue;document.fire("calendar:selectDate",{selectedDate:date,dateInputIndex:this.params.dateInputIndex});document.fire("datePicker:updated",{updatedIndex:this.params.dateInputIndex})},updateSelects:function(A){if(A.memo.updatedIndex<this.params.dateInputIndex){this.updateMonths();this.updateDays();this.setDate()}},updateSelectsFromCalendar:function(B){if(this.hideMainContent){$("content").show()}if(B.memo.dateInputIndex==this.params.dateInputIndex){var A=this.params.validateDate(this.params.formatDateString(B.memo.selectedDate));this.params.selectedDate=A;this.updateMonths();this.updateDays();document.fire("datePicker:updated",{updatedIndex:this.params.dateInputIndex})}}});var CalendarWidget=Class.create(CalendarUtils,{NUM_WEEKS:6,initialize:function(A){log.info("initializing CalendarWidget");this.params=A;this.fullScreenView=A.fullScreenView;this.monthsToDisplay=Number(A.monthsToDisplay);this.today=A.today;this.numberOfMonths=12;this.positionOffsetMonth=A.today.getMonth();this.positionOffsetYear=A.today.getFullYear();this.maxBookableDate=A.maxDate;this.earliestAvailableMonthIndex=0;this.container=$(A.container)||$(document.body);this.days=this.buildMarkupWithObservers();document.observe("calendar:showAndPosition",this.showAndPosition.bindAsEventListener(this));document.observe("calendar:hide",this.hideCalendar.bindAsEventListener(this));document.observe("calendar:setMonthsToDisplay",this.setMonthsToDisplay.bindAsEventListener(this))},setMonthsToDisplay:function(C){var A=Number(C.memo.mtd);if(!(A==1||A==2)){return}if(A==this.monthsToDisplay){return}this.monthsToDisplay=A;var B=this.element;if(B){if(A==1&&B.hasClassName("twoMonth")){B.removeClassName("twoMonth");B.addClassName("oneMonth")}else{if(A==2&&B.hasClassName("oneMonth")){B.removeClassName("oneMonth");B.addClassName("twoMonth")}}document.fire("calendar:completedMonthChange",{success:true})}},buildMarkupWithObservers:function(){var P="calendar "+(this.monthsToDisplay==2?"twoMonth":"oneMonth");var g=new Element("div",{"class":P,"data-context":"calendar"});this.previousArrow=new Element("span",{"class":"arrow arrowPrev visible"}).update(this.params.previous);this.nextArrow=new Element("span",{"class":"arrow arrowNext visible"}).update(this.params.next);g.insert(this.previousArrow);g.insert(this.nextArrow);this.calBody=new Element("div",{"class":"calendarBody"});this.monthTables=$H();this.monthKeyIndexes=$A();var b=new Element("table",{display:"none"});var U=new Element("thead");var L=new Element("tr");var o=new Element("th",{colspan:this.params.days.length,"class":"monthName"});L.update(o);U.update(L);b.update(U);var Q=L.clone();var f=L.clone();for(var l=0;this.params.days[l];l++){var X=(l+Number(this.params.firstDayOfWeekIndex))%this.params.days.length;var D=new Element("th").update(new Element("span").update(this.params.days[X]));var H=new Element("td").update(new Element("span").update("&nbsp;"));Q.insert(D);f.insert(H)}var e=new Element("tbody");e.insert(Q);for(var h=0;h<this.NUM_WEEKS;h++){var B=f.cloneNode(true);e.insert(B)}b.insert(e);var O=this.cloneDateObject(this.today);O.setDate(1);var A=O.getDay()-Number(this.params.firstDayOfWeekIndex);var T=(A<0?A+7:A);var p=1000*60*60*24;var M=Math.abs(this.maxBookableDate-this.today)-p;var E=Math.round(M/p);var c=this.today.getMonth();var K=this.today.getFullYear();var m=this.cloneDateObject(this.today);m.setDate(1);var a=$A();for(var Z=0,Y=c,S=K;Z<E;Y++){var G=$(b.cloneNode(true));var k=Y<12?Y:Y-12;if(k==0&&Z>0){S++;m.setFullYear(S)}m.setMonth(k);G.down("th.monthName").update(this.params.months[k]+" "+S);var I=G.select("td>span");var A=m.getDay()-Number(this.params.firstDayOfWeekIndex);var T=(A<0?A+7:A);var F=this.today.getDate();var J=this.getDaysInMonth(k);for(var d=1;d<=J;d++){var W=I[d+T-1];W.update(d);if((Y==c&&S==K&&d<F)||(Z>E)){W.addClassName("inactive unavailable")}else{if(Y==c&&S==K&&d==F){W.addClassName("today")}var k=Y>11?(Y-12):Y;var C=[new Date(S,k,d,0,0,0),W];W.setAttribute("data-date",S+"-"+(k+1)+"-"+d);W.setAttribute("data-dateIndex",Z);a.push(C);Z++}}var V=this.getDateKeyFromMonthAndYear(k,S);this.monthTables.set(V,G);this.monthKeyIndexes.push(V);this.numberOfMonths=Y-c+1}g.insert(this.calBody).hide();this.calBody.on("mouseover",this.highlight.bind(this));this.calBody.on("mouseout",this.clearHighlight.bind(this));if(this.monthsToDisplay>this.numberOfMonths){this.monthsToDisplay=this.numberOfMonths}this.close=new Element("div",{"class":"closeBar"}).update(new Element("span").update(this.params.close));g.insert(this.close);g.on("click",this.delegateEvent.bind(this));g.on(("ontouchstart" in document)?"touchstart":"mousedown",function(){this.calendarFocused=true}.bind(this));this.nextArrow.on("click",this.moveOneMonthForward.bind(this));this.previousArrow.on("click",this.moveOneMonthBack.bind(this));this.close.down("span").on("click",this.hideCalendar.bind(this));this.data={displayedMonths:$A(),pSelected:null,selected:null,rHighlight:$A(),inactive:$A()};this.element=g;return a},delegateEvent:function(B){this.calendarFocused=true;var A=B.element();if(A.hasClassName("inactive")){B.stop();return}if(A.hasAttribute("data-date")){this.selectDate(B);return}B.stop()},positionCalendar:function(){var B=this.eventElement;var G=B.positionedOffset();var J=B.cumulativeOffset();var I=$(document.viewport);var K=I.getDimensions();var D=I.getScrollOffsets();if(!this.widgetDimensions){this.widgetDimensions=this.element.getDimensions()}var H=J[0]-G[0],C=J[1]-G[1];var A={top:D.top-C,right:K.width+D.left-this.widgetDimensions.width-H,bottom:K.height+D.top-this.widgetDimensions.height-C,left:D.left-H};var F=B.getDimensions();var E=Math.floor(0.37*this.widgetDimensions.height);var L={x:G[0]+F.width,y:G[1]-E};if(L.y>A.bottom){L.y=A.bottom}if(L.y<A.top){L.y=A.top}if(L.x>A.right){if(G[0]<A.right){L.x=G[0]}else{L.x=A.right}L.y=G[1]+F.height}if(L.x<A.left){L.x=A.left;L.y=G[1]+F.height}this.element.setStyle({left:L.x+"px",top:L.y+"px"})},showAndPosition:function(F){if(this.container!==F.memo.container){return}var E=F.memo.validateDate;this.calendarFocused=false;var B=this.eventElement;this.eventElement=F.memo.targetInput?F.memo.targetInput:Event.element(F.memo.rootEvent);if(B!=this.eventElement||!this.element.visible()){if(this.element.visible()){this.element.hide()}this.maxBookableDate=F.memo.maxDate;var C=F.memo.minDate;this.earliestAvailableMonthIndex=C?this.getMonthIndexFromDate(C):0;var A=E(this.eventElement.value);if(A&&C&&C>A){A=null}this.dateInCurrentInput=A;var D=true;if(C==null){C=this.today;D=false}this.setFirstDisplayMonthIndex(C);this.updateCalendarHighlights(C,D);this.showMonthsFromStartIndex();this.container.insert(this.element);if(!this.fullScreenView){this.positionCalendar()}if(!this.element.visible()){this.element.show()}}if(!F.memo.targetInput){this.eventElement.select()}},updateCalendarHighlights:function(K,L){this.previousSelectedDateIndex=this.days.length;var Q=function(U,V,T){if(T){U.addClassName(V)}else{if(U.hasClassName(V)){U.removeClassName(V)}}};if(this.data.pSelected){Q(this.data.pSelected,"pSelected",false);this.data.pSelected=null}var O=this.data.rHighlight.length;for(var G=0;G<O;G++){Q(this.data.rHighlight[G],"rHighlight",false)}this.data.rHighlight=$A();if(this.data.selected){Q(this.data.selected,"selected",false);this.data.selected=null}var D=this.data.inactive.length;for(var G=0;G<D;G++){Q(this.data.inactive[G],"inactive",false)}this.data.inactive=$A();var F=K.getTime(),H=this.dateInCurrentInput?this.dateInCurrentInput.getTime():null;if(H||L){var M=this.getMonthIndexFromDate(K);var I=this.days.length;for(var G=M;G<I;G++){var J=this.days[G];var C=J[0],E=J[1];var B=C.getTime();var S=L&&(F==B);var A=(B==H);var P=L&&H&&(B>F&&B<H);if(S){this.data.pSelected=E;Q(E,"pSelected",true);this.previousSelectedDateIndex=G}if(P){this.data.rHighlight.push(E);Q(E,"rHighlight",true)}if(A){this.data.selected=E;Q(E,"selected",true);break}if(C<K){this.data.inactive.push(E);Q(E,"inactive",true)}}}},clearInsertedMonths:function(){var B=this.data.displayedMonths.length;if(B>0){for(var C=B;C>0;C--){var A=this.data.displayedMonths[(C-1)];this.monthTables.set(A[0],A[1].remove())}this.data.displayedMonths=$A()}},moveOneMonthForward:function(A){this.calendarFocused=true;this.currentStartIndex++;this.showMonthsFromStartIndex();A.stop()},moveOneMonthBack:function(A){this.calendarFocused=true;this.currentStartIndex--;this.showMonthsFromStartIndex();A.stop()},showMonthsFromStartIndex:function(){this.clearInsertedMonths();var C,A;for(var B=0;B<this.monthsToDisplay;B++){C=this.monthKeyIndexes[(this.currentStartIndex+B)];A=this.monthTables.get(C);this.calBody.insert(A);this.data.displayedMonths.push([C,A])}if(this.currentStartIndex<=this.earliestAvailableMonthIndex){this.previousArrow.hide()}else{this.previousArrow.show()}if((this.currentStartIndex+this.monthsToDisplay)>=this.numberOfMonths){this.nextArrow.hide()}else{this.nextArrow.show()}},setFirstDisplayMonthIndex:function(B){var F=this.monthsToDisplay;var C=this.getMonthIndexFromDate(B);var D=this.monthKeyIndexes.size()-F;var A=this.dateInCurrentInput?this.getMonthIndexFromDate(this.dateInCurrentInput):0;var E=A-F+1;if(E<C){E=C}if(E>D){E=D}this.currentStartIndex=E},getDateKeyFromMonthAndYear:function(C,B){var A=B+"-"+(C+1);return A},getDateKeyFromDate:function(A){var B=A.getFullYear()+"-"+(A.getMonth()+1);return B},getMonthIndexFromDate:function(B){if(!B){return 0}var A=this.monthKeyIndexes.indexOf(this.getDateKeyFromDate(B));if(A<0){return 0}return A},selectDate:function(F){var E=F.element();if(E.hasClassName("inactive")){return}var C=E.getAttribute("data-date");F.stop();if(C){document.fire("calendar:selectDate",{selectedDate:C,dateInputIndex:this.eventElement.index});var B=this.days.length;for(var D=0;D<B;D++){var A=this.days[D][1];if(A.hasClassName("highlight")){A.removeClassName("highlight")}}}},hideCalendar:function(A){if(!this.element||!this.eventElement||!this.element.parentNode){return}document.fire("calendar:hidden");this.eventElement.blur();this.element.hide();if(this.element.getStyle("position")=="fixed"){this.element.setStyle({position:"absolute"})}Event.stopObserving(this.scrollableAncestor,"scroll",this.scrollHandler);this.clearInsertedMonths();this.element=this.element.remove();this.calendarFocused=false;if(A){A.stop()}},highlight:function(D){this.highlightEndIndex=0;if(Event.element){var B=D.findElement("td span");if(B&&B!=document&&!B.hasClassName("inactive")){if(this.previousSelectedDateIndex!=this.days.length){this.highlightEndIndex=B.getAttribute("data-dateIndex");for(var C=this.highlightEndIndex;C>this.previousSelectedDateIndex;C--){var A=this.days[C][1];if(!A.hasClassName("pSelected")){A.addClassName("highlight")}}}else{if(B.hasAttribute("data-date")){B.addClassName("highlight")}}}}},clearHighlight:function(C){if(Event.element){var A=C.findElement("td span");if(A&&A!=document&&A!=this.selectionElement&&!A.hasClassName("inactive")){if(this.previousSelectedDateIndex!=this.days.length){for(var B=A.getAttribute("data-dateIndex");B>this.previousSelectedDateIndex;B--){this.days[B][1].removeClassName("highlight")}}else{A.removeClassName("highlight")}}}}});var DateInputManager=Class.create(Abstract.Agent,CalendarUtils,{initExtend:function(){this.container=$(this.element.up("form").parentNode);var B=new Date(this.params.today);this.today=new Date(B.getFullYear(),B.getMonth(),B.getDate(),0,0,0);this.maxDate=new Date(this.params.maxDate);this.pattern={string:this.params.pattern.toLowerCase(),localisedString:this.params.localisedPattern};if(this.pattern.string.length!=0){this.pattern.patternArray=$A();this.pattern.string.gsub(/[^a-z0-9]+|[a-z0-9]+/,function(G){this.pattern.patternArray.push(G[0])}.bind(this));for(var D=0,A=this.pattern.patternArray.length;D<A;D++){if(this.pattern.patternArray[D].indexOf("y")!=-1){this.pattern.yearStringLength=this.pattern.patternArray[D].length;this.pattern.yearPosition=D}if(this.pattern.patternArray[D].indexOf("m")!=-1){this.pattern.monthPosition=D}if(this.pattern.patternArray[D].indexOf("d")!=-1){this.pattern.dayPosition=D}}var F=this.pattern.patternArray.clone();F[this.pattern.dayPosition]="\\d{1,2}";F[this.pattern.monthPosition]="\\d{1,2}";F[this.pattern.yearPosition]="\\d{1,"+this.pattern.yearStringLength+"}";var C=F.join("");this.pattern.regExpPattern=new RegExp(C)}var E=true;if(!this.pattern.string){E=false;log.warning("Calendar: unsupported date format or date separator pattern supplied.")}if(this.params.months.length!==12){E=false;log.warning("Calendar: twelve (12) month names not defined")}if(this.params.days.length!==7){E=false;log.warning("Calendar: seven (7) day names not defined")}if(this.pattern.string.length===0){E=false;log.warning("Calendar: invalid date format pattern")}if(E){this.isFirstDate=null;this.formatDateObserver=this.formatDate.bind(this);document.observe("calendar:formatDate",this.formatDateObserver);this.selectObserver=this.selectDate.bind(this);document.observe("calendar:selectDate",this.selectObserver);if(this.params.parentClass){this.ancestor=this.element.up("."+this.params.parentClass)}else{if(this.params.parentTag){this.ancestor=this.element.up(this.params.parentTag)}else{this.ancestor=$$("body")}}this.addInputObservers()}else{log.error("Calendar: initialization failed due to calendarRules model")}},formatDateString:function(B){var D=B.split("-");var F=D[0]+"";if(F.length!=this.pattern.yearStringLength){while(F.length>this.pattern.yearStringLength){F=F.substr(1)}}var A=D[1]+"";if(A.length!=2){A="0"+A}var E=D[2]+"";if(E.length!=2){E="0"+E}var C=this.pattern.patternArray.clone();C[this.pattern.dayPosition]=E;C[this.pattern.monthPosition]=A;C[this.pattern.yearPosition]=F;C=C.join("");return C},addInputObservers:function(){this.dateInputArray=$A();if(this.params.selectors){this.selectors=this.params.selectors.split(",");for(var F=0;this.selectors[F];F++){var G=this.ancestor.getElementsBySelector(this.selectors[F]);for(var E=0;G[E];E++){var B=G[E];var H=G[E].getElementsByTagName("input");for(var D=0;H[D];D++){var A=$(H[D]);A.datePairParent=B;A.index=D+E;this.dateInputArray.push(A);var I=null;if(A.value.length==0){A.value=this.pattern.localisedString}else{I=this.validateDate(A.value)}if(this.params.enableDatePicker){var J={today:this.today,maxDate:this.maxDate,container:this.container,previous:this.params.previous,next:this.params.next,days:this.params.days,months:this.params.months,firstDayOfWeekIndex:this.params.firstDayOfWeekIndex,close:this.params.close,dateInputArray:this.dateInputArray,calendarImage:this.params.calendarImage,abbrMonths:this.params.abbrMonths,abbrDays:this.params.abbrDays,dateInput:A,dateInputIndex:(this.dateInputArray.length-1),selectedDate:I,formatDateString:this.formatDateString.bind(this),validateDate:this.validateDate.bind(this),hideMainContent:this.params.hideMainContent,monthsToDisplay:this.params.monthsToDisplay};A.datePickerWidget=new DatePickerWidget(J)}}if(this.dateInputArray.length==2){this.computeDuration(B)}}}for(var F=0;this.dateInputArray[F];F++){if(!this.params.enableDatePicker){this.dateInputArray[F].parentNode.appendChild(new Element("div").addClassName("secondaryDate"));document.fire("calendar:formatDate",{dateInputIndex:F,callback:this.setSecondaryDate.bind(this,F)})}Event.observe(this.dateInputArray[F],"focus",this.showWidget.bindAsEventListener(this));Event.observe(this.dateInputArray[F],"blur",this.setInputBlur.bindAsEventListener(this,F));if(this.dateInputArray[F].form){var C=this.dateInputArray[F].form.getInputs("submit");for(var E=0;C[E];E++){Event.observe(C[E],"click",this.clearField.bindAsEventListener(this,this.dateInputArray[F]));document.observe("dateInput:clearField",this.clearField.bindAsEventListener(this,this.dateInputArray[F]))}}}}document.observe("page:complete",this.createWidget.bind(this))},createWidget:function(){if(!this.container.calendarWidget){var A={today:this.today,maxDate:this.maxDate,container:this.container,previous:this.params.previous,next:this.params.next,days:this.params.days,months:this.params.months,firstDayOfWeekIndex:this.params.firstDayOfWeekIndex,close:this.params.close,hideMainContent:this.params.hideMainContent,monthsToDisplay:this.params.monthsToDisplay};this.container.calendarWidget=new CalendarWidget(A)}},showWidget:function(F){this.createWidget();this.eventElement=Event.element(F);this.inputHasFocus=true;this.isFirstDate=true;var D=null;for(var C=1,B=this.dateInputArray.length;C<B;C++){if(this.dateInputArray[C]==this.eventElement){var E=null;var G=C-1;while(E==null&&G>=0){E=this.validateDate(this.dateInputArray[G].value);G--}D=E;this.isFirstDate=false;break}}var A={rootEvent:F,minDate:D,maxDate:this.maxDate,container:this.container,validateDate:this.validateDate.bind(this)};document.fire("calendar:showAndPosition",A)},validateDate:function(H){var C=null;var A=true;var B=(H==undefined?$F(this.eventElement):H);if(this.pattern.regExpPattern.test(B)){var G=$A();B.gsub(/[^a-z0-9]+|[a-z0-9]+/,function(J){G.push(J[0])});var D=G[this.pattern.dayPosition];var F=G[this.pattern.monthPosition];var E=G[this.pattern.yearPosition];if(E.length==2){E="20"+E}if(D<1||D>this.getDaysInMonth((F-1),E)){A=false}if(A&&(F<1||F>12)){A=false}if(A){var I=new Date(E,F-1,D,0,0,0);if(I<=this.maxDate&&I>=this.today){C=I}}}return C},selectDate:function(B){var A=B.memo.dateInputIndex;if(!this.dateInputArray[A]){return}this.eventElement=this.dateInputArray[A];if(!this.eventElement.descendantOf(document)){document.stopObserving("calendar:selectDate",this.selectObserver);return}this.eventElement.value=this.formatDateString(B.memo.selectedDate);this.computeDuration(this.eventElement.datePairParent);document.fire("calendar:hide");document.fire("calendar:formatDate",{dateInputIndex:A,callback:this.setSecondaryDate.bind(this,A)});document.fire("secondaryDate:changeDate",{index:A});this.eventElement.blur()},computeDuration:function(B){if(this.dateInputArray.length==2){var C=this.validateDate(this.dateInputArray[0].value);var A=this.validateDate(this.dateInputArray[1].value);if(C!=null&&A!=null){B.tripDuration=Math.round((A-C)/86400000);DateDuration.prototype.updateDuration(B)}}},setInputBlur:function(B,A){this.inputHasFocus=false;document.fire("calendar:formatDate",{dateInputIndex:A,callback:this.setSecondaryDate.bind(this,A)});window.setTimeout(this.getFocus.bind(this),100)},setSecondaryDate:function(A,B){if(!this.params.enableDatePicker){$(this.dateInputArray[A].parentNode).down(".secondaryDate").update(B)}},getFocus:function(){var A=this.container.calendarWidget;if(this.inputHasFocus==false&&A.calendarFocused==false&&A.element.visibleByClass()){document.fire("calendar:hide")}},clearField:function(B,A){if(A.value==this.pattern.localisedString){A.value=""}},formatDate:function(C){if(!this.dateInputArray[C.memo.dateInputIndex]){return}if(!this.dateInputArray[C.memo.dateInputIndex].descendantOf(document)){document.stopObserving("calendar:selectDate",this.formatDateObserver);return}var A=this.validateDate(this.dateInputArray[C.memo.dateInputIndex].value);var B="";if(A!=null){var B=this.params.abbrFullDatePattern;B=B.replace(/\bd{1,}\b/,A.getDate()).replace(/\bE{3,}\b/,this.params.abbrDays[A.getDay()]).replace(/\bM{1,}\b/,this.params.abbrMonths[A.getMonth()]).replace(/\by{2,}\b/,A.getFullYear())}C.memo.callback(B)}});var BookerEmailAddress=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var A=this.element.down("input");var B=function(C){document.fire("bookerEmailAddress:changed",{emailAddress:A.value})};A.on("change",B)}});var CareAlertsEmailAddress=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var A=this.element.down("input");var C=function(D){A.value=D.memo.emailAddress.strip()};var B=function(D){document.stopObserving("bookerEmailAddress:changed")};document.on("bookerEmailAddress:changed",C);A.on("change",B)}});var CarXSellMatrixDetails=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){$("bodyWrapper").observe("click",this.onClick.bindAsEventListener(this));this.dialog=new Microcontent([],{string:""},{triggerEvent:"click",compact:true,classes:"carXSellMatrixDetails",closeLabel:this.params.closeLabel,topBoundaryText:this.params.topBoundaryText,bottomBoundaryText:this.params.bottomBoundaryText,wrapLinkText:this.params.wrapLinkText})},onClick:function(C){var B=C.findElement();if(this.dialog.markup&&this.dialog.markup.dialogWrapper&&B.descendantOf(this.dialog.markup.dialogWrapper)){return}else{this.dialog.close()}var A=B.tagName=="TD"?B:B.up("TD");if(A&&A.hasAttribute("data-carDetails")){this.dialog.content.string=A.getAttribute("data-carDetails");this.dialog.open(C,A.down("A")||A)}}});
/*CAROUSEL CLASS


Copyright (c) 2009 Victor Stanciu - http://www.victorstanciu.ro

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

Agent: Carousel
	adapted from http://code.google.com/p/prototype-carousel/

	I have kept this class mostly unchanged.  Only changes are changing first method name, and removing their forcing of "circular" to true
	for effect type fade
*/
var Carousel=Class.create(Abstract.Agent,{setup:function(A,D,B,C){this.scrolling=false;this.scroller=$(A);this.slides=D;this.controls=B;this.options=Object.extend({duration:1,auto:false,frequency:5,initial:0,visibleSlides:1,controlClassName:"carousel-control",jumperClassName:"carousel-jumper",disabledClassName:"carousel-disabled",selectedClassName:"carousel-selected",circular:false,wheel:true,effect:"scroll",transition:"sinoidal"},C||{});this.slides.each(function(F,G){F._index=G});if(this.controls){this.controls.invoke("observe","click",this.click.bind(this))}if(this.options.wheel){this.scroller.observe("mousewheel",this.wheel.bindAsEventListener(this)).observe("DOMMouseScroll",this.wheel.bindAsEventListener(this))}if(this.options.auto){this.start()}if(this.options.initial){var E=this.slides.indexOf($(this.options.initial));if(E>(this.options.visibleSlides-1)&&this.options.visibleSlides>1){if(E>this.slides.length-(this.options.visibleSlides+1)){E=this.slides.length-this.options.visibleSlides}}this.moveTo(this.slides[E])}},click:function(event){this.stop();var element=event.findElement("a");if(!element.hasClassName(this.options.disabledClassName)){if(element.hasClassName(this.options.controlClassName)){eval("this."+element.rel+"()")}else{if(element.hasClassName(this.options.jumperClassName)){this.moveTo(element.rel);if(this.options.selectedClassName){this.controls.invoke("removeClassName",this.options.selectedClassName);element.addClassName(this.options.selectedClassName)}}}}this.deactivateControls();event.stop()},moveTo:function(B){if(this.options.beforeMove&&(typeof this.options.beforeMove=="function")){this.options.beforeMove()}this.previous=this.current?this.current:this.slides[0];this.current=$(B);var C=this.scroller.cumulativeOffset();var A=this.current.cumulativeOffset();if(this.scrolling){this.scrolling.cancel()}switch(this.options.effect){case"fade":this.scrolling=new Effect.Opacity(this.scroller,{from:1,to:0,duration:this.options.duration,afterFinish:(function(){this.scroller.scrollLeft=A[0]-C[0];this.scroller.scrollTop=A[1]-C[1];new Effect.Opacity(this.scroller,{from:0,to:1,duration:this.options.duration,afterFinish:(function(){if(this.controls){this.activateControls()}if(this.options.afterMove&&(typeof this.options.afterMove=="function")){this.options.afterMove()}}).bind(this)})}).bind(this)});break;case"scroll":default:var D;switch(this.options.transition){case"spring":D=Effect.Transitions.spring;break;case"sinoidal":default:D=Effect.Transitions.sinoidal;break}this.scrolling=new Effect.SmoothScroll(this.scroller,{duration:this.options.duration,x:(A[0]-C[0]),y:(A[1]-C[1]),transition:D,afterFinish:(function(){if(this.controls){this.activateControls()}if(this.options.afterMove&&(typeof this.options.afterMove=="function")){this.options.afterMove()}this.scrolling=false}).bind(this)});break}return false},prev:function(){if(this.current){var A=this.current._index;var B=(A==0)?(this.options.circular?this.slides.length-1:0):A-1}else{var B=(this.options.circular?this.slides.length-1:0)}if(B==(this.slides.length-1)&&this.options.circular&&this.options.effect!="fade"){this.scroller.scrollLeft=(this.slides.length-1)*this.slides.first().getWidth();this.scroller.scrollTop=(this.slides.length-1)*this.slides.first().getHeight();B=this.slides.length-2}this.moveTo(this.slides[B])},next:function(){if(this.current){var B=this.current._index;var A=(this.slides.length-1==B)?(this.options.circular?0:B):B+1}else{var A=1}if(A==0&&this.options.circular&&this.options.effect!="fade"){this.scroller.scrollLeft=0;this.scroller.scrollTop=0;A=1}if(A>this.slides.length-(this.options.visibleSlides+1)){A=this.slides.length-this.options.visibleSlides}this.moveTo(this.slides[A])},first:function(){this.moveTo(this.slides[0])},last:function(){this.moveTo(this.slides[this.slides.length-1])},toggle:function(){if(this.previous){this.moveTo(this.slides[this.previous._index])}else{return false}},stop:function(){if(this.timer){clearTimeout(this.timer)}},start:function(){this.periodicallyUpdate()},pause:function(){this.stop();this.activateControls()},resume:function(A){if(A){var B=A.relatedTarget||A.toElement;if(!B||(!this.slides.include(B)&&!this.slides.any(function(C){return B.descendantOf(C)}))){this.start()}}else{this.start()}},periodicallyUpdate:function(){if(this.timer!=null){clearTimeout(this.timer);this.next()}this.timer=setTimeout(this.periodicallyUpdate.bind(this),this.options.frequency*1000)},wheel:function(A){A.cancelBubble=true;A.stop();var B=0;if(!A){A=window.event}if(A.wheelDelta){B=A.wheelDelta/120}else{if(A.detail){B=-A.detail/3}}if(!this.scrolling){this.deactivateControls();if(B>0){this.prev()}else{this.next()}}return Math.round(B)},deactivateControls:function(){this.controls.invoke("addClassName",this.options.disabledClassName)},activateControls:function(){this.controls.invoke("removeClassName",this.options.disabledClassName)}});Effect.SmoothScroll=Class.create();Object.extend(Object.extend(Effect.SmoothScroll.prototype,Effect.Base.prototype),{initialize:function(B){this.element=$(B);var A=Object.extend({x:0,y:0,mode:"absolute"},arguments[1]||{});this.start(A)},setup:function(){if(this.options.continuous&&!this.element._ext){this.element.cleanWhitespace();this.element._ext=true;this.element.appendChild(this.element.firstChild)}this.originalLeft=this.element.scrollLeft;this.originalTop=this.element.scrollTop;if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(A){this.element.scrollLeft=this.options.x*A+this.originalLeft;this.element.scrollTop=this.options.y*A+this.originalTop}});var ChangeSearch=Class.create();ChangeSearch.prototype=Object.extend(new Abstract.Agent("ChangeSearch"),{initExtend:function(){this.visible=false;Event.observe(this.element,"click",this.requestForm.bindAsEventListener(this))},showSelectBoxes:function(){var A=$A(document.getElementsByTagName("select"));A.each(function(B){B.style.visibility="visible"})},hideSelectBoxes:function(){var A=$A(document.getElementsByTagName("select"));A.each(function(B){B.style.visibility="hidden"})},requestForm:function(B){Event.stop(B);this.getPageDimensionsAndScroll();this.hideSelectBoxes();this.visible=true;this.modalDiv=document.createElement("div");this.modalDiv.className="modal";this.bodyWrapper=$("bodyWrapper");this.bodyWrapper.appendChild(this.modalDiv);this.modalDiv.style.height=this.pageHeight+"px";this.modalDiv.style.width=this.pageWidth+"px";this.modalDiv.style.filter="alpha(opacity=50)";this.modalDiv.style.opacity=0.5;this.modalDiv.style.MozOpacity=0.5;this.agentDiv=Element.extend(document.createElement("div"));this.bodyWrapper.appendChild(this.agentDiv);this.agentDiv.update(this.params.markup);this.closeWindowLink=this.agentDiv.getFirstElementByClassName("closeWindowLink");Event.observe(this.closeWindowLink,"click",this.close.bindAsEventListener(this));this.changeSearchDiv=this.agentDiv.getFirstElementByClassName("changeSearch");this.changeSearchDivHeight=this.changeSearchDiv.getHeight();this.changeSearchDivWidth=this.changeSearchDiv.getWidth();this.changeSearchDivTopMargin=0;if(this.changeSearchDivHeight<this.windowHeight){this.changeSearchDivTopMargin=(this.windowHeight-this.changeSearchDivHeight)*0.5}this.changeSearchDiv.style.marginTop=this.yScroll+this.changeSearchDivTopMargin+"px";this.changeSearchDivLeftMargin=0;if(this.changeSearchDivWidth<this.windowWidth){this.changeSearchDivLeftMargin=(this.windowWidth-this.changeSearchDivWidth)*0.5}this.changeSearchDiv.style.marginLeft=this.xScroll+this.changeSearchDivLeftMargin+"px";var C="";if(this.params.url){C=this.params.url;C="&"+C.substr(C.indexOf("?")+1)}else{C="&"+location.search.substring(1)}if(this.params.url&&this.params.url.indexOf("book")!=-1){C=C.replace("&amp%3B","&");C=C.replace("&amp;","&");var A=new Ajax.Request("/book/bookingpath",{parameters:"changeSearch=true"+C,onSuccess:this.success.bind(this),onFailure:this.failure})}else{var A=new Ajax.Request("/shop/searchForm",{parameters:"changeSearch=true"+C,onSuccess:this.success.bind(this),onFailure:this.failure})}},getPageDimensionsAndScroll:function(){if(window.innerHeight&&window.scrollMaxY){this.yScroll=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){this.yScroll=document.body.scrollHeight}else{this.yScroll=document.body.offsetHeight}}if(self.innerHeight){this.windowHeight=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){this.windowHeight=document.documentElement.clientHeight}else{if(document.body){this.windowHeight=document.body.clientHeight}}}if(this.yScroll<this.windowHeight){this.pageHeight=this.windowHeight}else{this.pageHeight=this.yScroll}if(self.pageYOffset){this.yScroll=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){this.yScroll=document.documentElement.scrollTop}else{if(document.body){this.yScroll=document.body.scrollTop}}}if(window.innerWidth&&window.scrollMaxX){this.xScroll=window.innerWidth+window.scrollMaxX}else{if(document.body.scrollWidth>document.body.offsetWidth){this.xScroll=document.body.scrollWidth}else{this.xScroll=document.body.offsetWidth}}if(self.innerWidth){this.windowWidth=self.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){this.windowWidth=document.documentElement.clientWidth}else{if(document.body){this.windowWidth=document.body.clientWidth}}}if(this.xScroll<this.windowWidth){this.pageWidth=this.windowWidth}else{this.pageWidth=this.xScroll}if(self.pageXOffset){this.xScroll=self.pageXOffset}else{if(document.documentElement&&document.documentElement.scrollLeft){this.xScroll=document.documentElement.scrollLeft}else{if(document.body){this.xScroll=document.body.scrollLeft}}}},close:function(A){Event.stop(A);this.visible=false;this.bodyWrapper.removeChild(this.modalDiv);this.bodyWrapper.removeChild(this.agentDiv);this.showSelectBoxes()},success:function(B){log.info("Response received from /shop/searchForm");if(this.visible){var A=this.agentDiv.getFirstElementByClassName("intrastitial");A.removeClassName("intrastitial");A.update(B.responseText);Page.initializeDOMFragment(A.parentNode.parentNode)}},failure:function(){log.error("No response from /shop/searchForm")}});var ChangeSearchLightboxAgent=Class.create(Abstract.Agent,{beforeDOMReady:false,initialize:function(A,B){Object.extend(this,B);this.element=Element.extend(A);this.dialogObject=new ChangeSearchLightbox([this.element],B.params.content,B.params.options)}});var ChangeShippingAddress=Class.create();ChangeShippingAddress.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){var A=$A(this.element.getElementsByTagName("input"));this.radios=$A();A.each(function(B){if(B.type=="radio"){this.radios.push(B)}}.bind(this));this.newAddressForm=this.element.getElementsBySelector(".profileAddressNew .editShipping");this.useBillingAddressSelected=true;this.useNewAddressSelected=false;this.radios.each(function(B){if(Element.extend(B.parentNode.parentNode).hasClassName("useBillingAddress")){if(!B.checked){this.useBillingAddressSelected=false}Event.observe(B,"click",this.useBillingAddress.bindAsEventListener(this))}}.bind(this));this.radios.each(function(B){if(Element.extend(B.parentNode.parentNode).hasClassName("profileAddressNew")){if(this.useBillingAddressSelected){B.checked=false}if(B.checked){this.useNewAddressSelected=true}Event.observe(B,"click",this.useNewAddress.bindAsEventListener(this))}else{if(Element.extend(B.parentNode.parentNode).hasClassName("profileAddress")){if(this.useBillingAddressSelected){B.checked=false}Event.observe(B,"click",this.useOtherAddress.bindAsEventListener(this))}}}.bind(this));this.existingAddressAlert=this.element.getElementsByClassName("existingAddressAlert")[0];if(this.useNewAddressSelected){this.useNewAddress()}},useNewAddress:function(){this.showNewAddress();this.radios.each(function(A){if(Element.extend(A.parentNode.parentNode).hasClassName("useOtherAddress")){A.checked=true;throw $break}})},useOtherAddress:function(){this.hideNewAddress();this.radios.each(function(A){if(Element.extend(A.parentNode.parentNode).hasClassName("useOtherAddress")){A.checked=true;throw $break}})},useBillingAddress:function(){this.hideNewAddress();this.radios.each(function(A){if(Element.extend(A.parentNode.parentNode).hasClassName("profileAddress")){A.checked=false}})},showNewAddress:function(){this.newAddressForm.each(function(A){A.showByClass()}.bind(this));if(this.existingAddressAlert){this.existingAddressAlert.hideByClass()}},hideNewAddress:function(){this.newAddressForm.each(function(A){A.hideByClass()}.bind(this));if(this.existingAddressAlert){this.existingAddressAlert.showByClass()}}});var CheckboxListFilter=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.checkboxes=this.element.select(".checkbox input");if(!this.checkboxes){log.error("No checkboxes found for CheckboxListFilter");return}if(this.params.anyCheckbox){this.element.insert({top:this.params.anyCheckbox});this.anyCheckbox=this.element.down("input")}if(this.params.toggleLinks){this.element.insert({top:this.params.toggleLinks})}this.paramName=this.checkboxes[0].readAttribute("name");this.hiddenInput=this.element.down("input[name='_"+this.paramName+"']");if(this.params.csvInput){if(this.hiddenInput){this.hiddenInput.remove()}this.element.insert({top:this.params.csvInput});this.csvInput=this.element.down("input");this.paramName=this.csvInput.readAttribute("name");var C=[];var D=this.csvInput.value;if(D&&D!="ALL"){C=(D.indexOf(",")>=0)?D.split(","):[D]}var B=C.length;if(this.anyCheckbox){this.anyCheckbox.writeAttribute("name","");if(B==0){this.checkAny();C.push("ALL")}}this.checkboxes.each(function(F){if(B==0&&!this.anyCheckbox){F.checked=true;C.push(F.value)}else{F.checked=(C.indexOf(F.value)>=0)}F.writeAttribute("name","")},this);this.setValues(C)}else{if(this.anyCheckbox){var E=null;var A=true;this.checkboxes.each(function(F){if(E===null){E=F.checked}else{if(E!=F.checked){A=false}}});if(A){this.checkAny();this.checkboxes.each(function(F){F.checked=false})}}}this.element.on("click","a",this.handleLinkClicked.bind(this));this.element.on("click",".checkbox input",this.handleCheckboxClicked.bind(this))},handleLinkClicked:function(D,C){var A=C.readAttribute("href").toQueryParams();if(Object.keys(A).length<=0){return}var B=[];var E=A[this.paramName];this.checkboxes.each(function(F){var G=F.readAttribute("value");if(!F.readAttribute("disabled")){if(E==="ALL"||E==G){F.checked=true}else{if(E==="NONE"||!this.anyCheckbox){F.checked=false}}if(F.checked){B.push(G)}}},this);if(this.anyCheckbox){this.uncheckAny()}if(this.csvInput){this.setValues(B);this.fireFilterEvent()}else{this.fireFilterEvent(B)}D.preventDefault()},handleCheckboxClicked:function(B,C){if(C.readAttribute("disabled")){return}var A=[];this.checkboxes.each(function(D){if(C==this.anyCheckbox){D.checked=false}else{if(D.checked){A.push(D.value)}}},this);if(this.anyCheckbox){if(C==this.anyCheckbox||A.length==0){this.checkAny();A.push("ALL")}else{this.uncheckAny()}}if(this.csvInput){this.setValues(A)}this.fireFilterEvent(A)},fireFilterEvent:function(A){var B={};if(this.csvInput){B[this.csvInput.name]=this.csvInput.value}else{if(this.hiddenInput){B[this.hiddenInput.readAttribute("name")]=this.hiddenInput.value}B[this.paramName]=A}this.element.fire("agent:filter",{params:B});if(this.params.webtrendsLabel){this.element.fire("webtrends:multiTrackEvent",{"DCSext.fctkw":this.params.webtrendsLabel})}},setValues:function(A){if(A.length==0){this.csvInput.value="NONE"}else{this.csvInput.value=A.join(",")}},checkAny:function(){this.anyCheckbox.checked=true;this.anyCheckbox.disabled=true},uncheckAny:function(){this.anyCheckbox.disabled=false;this.anyCheckbox.checked=false}});var ClearValueOnChange=Class.create();ClearValueOnChange.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.inputToWatch=$(this.element.getElementsByTagName("input")[0]);if(!this.params.inputToClearName){log.error("ClearValueOnChange: No 'inputToClearName' parameter was passed to agent");return}this.inputToClearElement=this.inputToWatch.form[this.params.inputToClearName];if(this.inputToClearElement){this.inputToClearElement.value=this.params.inputToClearValue||this.inputToClearElement.value}else{log.error("ClearValueOnChange: No input with name '"+this.params.inputToClearName+"' was found in base element's parent form.");return}this.attachChangeListener()},attachChangeListener:function(){this.changeListener=function(A){this.inputToClearElement.value="";this.inputToWatch.stopObserving("change",this.changeListener);this.changeListener=null}.bindAsEventListener(this);this.inputToWatch.observe("change",this.changeListener)}});var ContainedLightboxAgent=Class.create(Abstract.Agent,{beforeDOMReady:false,initialize:function(A,B){Object.extend(this,B);this.element=Element.extend(A);this.dialogObject=new ContainedLightbox([this.element],B.params.content,B.params.options)}});var ContentRotator=Class.create(Carousel,{initExtend:function(){var B=this.element.select(".editorialItem");var A=Object.extend({auto:true,initial:0,duration:0.5,frequency:5,circular:true,wheel:false,effect:"fade"},this.params.options||{});if(A.circular&&A.effect!="fade"){var C=B[0].clone(true);this.element.down("ul").appendChild(C);B.push(C)}this.element.scrollLeft=0;this.element.scrollTop=0;this.element.observe("mouseover",this.stop.bindAsEventListener(this));this.setup(this.element,B,$A(),A);this.navigatorInitialize()},setup:function($super,A,D,B,C){$super(A,D,B,C);if(!this.options.auto){this.current=this.slides[0]}},moveTo:function($super,A,B){$super(A);if(B===false){this.stop()}this.navigatorUpdate(A)},next:function($super){if(this.current){var B=this.current._index;var A=(this.slides.length-1===B)?(this.options.circular?0:B):B+1}else{var A=1}if(B===(this.slides.length-1)&&this.options.circular&&this.options.effect!="fade"){this.scroller.scrollLeft=0;this.scroller.scrollTop=0;A=1}if(A>this.slides.length-(this.options.visibleSlides+1)){A=this.slides.length-this.options.visibleSlides}if(B===(this.slides.length-1)&&!this.options.circular){this.stop()}else{$super()}},navigatorInitialize:function(){var C,D,A;if(this.options.circular&&this.options.effect!="fade"){var E=this.slides.length-1}else{var E=this.slides.length}C=new Element("ul",{"class":"navigator"});for(var B=0;B<E;B++){D=new Element("a");A=new Element("li").update(D);$(A).childElements().invoke("observe","click",this.navigatorClick.bind(this));$(C).insert({bottom:A})}this.element.up(0).insert({bottom:C});this.navigators=$(C).childElements();var F=this.options.initial;this.navigators.each(function(H,G){H._index=G;if(F===G){H.addClassName("active")}})},navigatorClick:function(C){C.stop();var B=($(Event.element(C).up(0)));var A=this.navigators.indexOf(B);if(this.current._index!==A){this.moveTo(this.slides[A],false)}},navigatorUpdate:function(D){if(this.current){var A=this.current._index}var C=this.slides.length-1;if(this.options.circular&&this.options.effect!="fade"){var B=true}var E=this.navigators[0];this.navigators.each(function(G,F){G.removeClassName("active");if((A===C)&&(B)){E.addClassName("active")}else{if(A===F){$(G).addClassName("active")}}})}});var CountdownTimer=Class.create();CountdownTimer.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){var F=new Date();var C=new Date(0);C.setUTCHours(this.params.hours);C.setUTCMinutes(this.params.minutes);C.setUTCSeconds(this.params.seconds);var A=this.element.rows[0].cells[0];var E=this.element.rows[0].cells[1];var B=this.element.rows[0].cells[2];(function D(){var H=new Date();var I=C-(H-F);if(I<0){I=0}I=new Date(I);var G=((I.getUTCDate()-1)*24+I.getUTCHours()).toPaddedString(2);A.innerHTML=(G>99)?99:G;E.innerHTML=":"+I.getUTCMinutes().toPaddedString(2)+":";B.innerHTML=I.getUTCSeconds().toPaddedString(2);if(I>0){window.setTimeout(D,250)}})()}});var identifyCardTypeOnInput=function(D,C){var B=C.length;var A=null;if(D.type=="keyup"&&B>=8){A=identifyCardByIIN(C,false)}else{if((D.type=="blur"&&B>=8)||(D.type=="click"&&D.findElement("input[type=submit]"))){A=identifyCardByIIN(C,true)}}return A};var CreditCardAutoDetectOldDesign=Class.create();CreditCardAutoDetectOldDesign.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.ccNumber=this.element.down(".cardField input");this.cardRadioButtons=this.element.select('input[type="radio"]');for(var A=0;A<this.cardRadioButtons.length;A++){this.cardRadioButtons[A]={input:this.cardRadioButtons[A],label:this.cardRadioButtons[A].up()};this.cardRadioButtons[A].input.addClassName("noneBlock");if(this.cardRadioButtons[A].input.checked){this.selectedCardRadio=this.cardRadioButtons[A].input}}if(!this.selectedCardRadio){this.selectedCardRadio=this.element.down('input[value="none"]')}this.ccNumber.on("blur",this.identify.bind(this));this.ccNumber.on("keyup",this.identify.bind(this));var B=this.ccNumber.form.select('input[type="submit"]');B.each(function(C){C.on("click",this.identify.bind(this))}.bind(this))},identify:function(B){var A=identifyCardTypeOnInput(B,$F(this.ccNumber));if(this.selectedCardRadio&&$F(this.selectedCardRadio)==A){return}if(A){this.selectedCardRadio=this.element.down('input[value="'+A+'"]');if(!this.selectedCardRadio){this.clearCreditCardSelection();return}this.selectedCardRadio.checked=true;this.selectedCardRadio.click();this.cardRadioButtons.each(function(C){if($F(C.input)==A){C.label.setOpacity(1)}else{C.label.setOpacity(0.2)}})}else{this.clearCreditCardSelection()}},clearCreditCardSelection:function(){if(this.selectedCardRadio!=this.element.down('input[value="none"]')){this.cardRadioButtons.each(function(A){A.input.checked=false;A.label.setOpacity(1)});$(this.element.parentNode).getFirstElementByClassName("ccvDisplay").hideByClass();this.selectedCardRadio=this.element.down('input[value="none"]');this.selectedCardRadio.checked=true;this.updateRightRail()}},updateRightRail:function(){document.fire("contentUpdate:started");var A=this.selectedCardRadio.form;var C=Form.serialize(A).deleteQueryStringParam("_eventId",true)+"&_eventId_updateRightRail=true";var B=new Ajax.Request(A.action,{method:"post",parameters:C,onSuccess:function(D){document.fire("content:update",D.responseText.unescapeJSON().evalJSON())},onFailure:function(){log.error("ElementUpdateTrigger: No response from application for Element Updates")}})}});var CreditCardType=Class.create();CreditCardType.prototype=Object.extend(new Abstract.Agent(),{cardIcons:[],cardTypes:[],initExtend:function(){this.cardTypeField=this.element.down("select");this.previousType=null;if(!this.params.autoDetectEnabled){this.cardTypeField.on("change",function(){$(document.body).fire("creditCardType:change",{type:$F(this.cardTypeField)})}.bind(this))}$A(this.cardTypeField.options).each(function(B){this.cardTypes.push(B.value)}.bind(this));var A=this.element.select(".cardLogos img");A.each(function(C){var B=C.className.match(/\bcardIcon[\w]+/)[0].slice(-2);this.cardIcons.push({icon:C,type:B});if(!this.params.autoDetectEnabled){C.setStyle({cursor:"pointer"});C.on("click",function(E,F,D){this.cardTypeField.setValue(E);$(document.body).fire("creditCardType:change",{type:E})}.bind(this,B))}}.bind(this));this.onCardTypeChange();$(document.body).on("creditCardType:detected",this.onCardTypeDetected.bind(this));$(document.body).on("creditCardType:change",this.onCardTypeChange.bind(this))},onCardTypeDetected:function(B){if(this.params.autoDetectEnabled){var A=!B.memo.type?"none":B.memo.type;if(this.cardTypes.include(A)){log.debug("card type match: "+A);this.cardTypeField.setValue(A)}else{log.debug("unsupported card type: "+A);this.cardTypeField.setValue("none")}$(document.body).fire("creditCardType:change",{type:$F(this.cardTypeField)})}},onCardTypeChange:function(){var B=$F(this.cardTypeField);if(this.previousType!==B){log.debug("cardTypeChange: "+this.previousType+" > "+B);var A=false;for(var C=0;C<this.cardIcons.length;C++){if(this.cardIcons[C].type==B){A=true}}for(var C=0;C<this.cardIcons.length;C++){if(!A||this.cardIcons[C].type==B){this.cardIcons[C].icon.setOpacity(1)}else{this.cardIcons[C].icon.setOpacity(0.25)}}this.updateRightRail();this.previousType=B}else{log.debug("cardTypeChange: no change")}},updateRightRail:function(){document.fire("contentUpdate:started");var B=Form.serialize(this.cardTypeField.form).deleteQueryStringParam("_eventId",true)+"&_eventId_updateRightRail=true";var A=new Ajax.Request(this.cardTypeField.form.action,{method:"post",parameters:B,onSuccess:function(C){document.fire("content:update",C.responseText.unescapeJSON().evalJSON())},onFailure:function(){log.error("ElementUpdateTrigger: No response from application for Element Updates")}})}});var CreditCardAutoDetectNewDesign=Class.create();CreditCardAutoDetectNewDesign.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){this.cardType=null;this.cardTypeField=this.element.down("select");this.cardNumberField=this.element.down(".cardField input");this.cardNumberField.on("blur",this.identify.bind(this));this.cardNumberField.on("keyup",this.identify.bind(this));var B=this.cardTypeField.form.select('input[type="submit"]');for(var A=0;A<B.length;A++){B[A].on("click",this.identify.bind(this))}},identify:function(B){var A=identifyCardTypeOnInput(B,$F(this.cardNumberField));if(A!=this.cardType){$(document.body).fire("creditCardType:detected",{type:A})}this.cardType=A}});var CCVInstruction=Class.create();CCVInstruction.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,instructions:[],initExtend:function(){this.instructions=this.element.select("*[data-cctype]");$(document.body).on("creditCardType:change",this.updateDisplay.bind(this))},updateDisplay:function(A){this.instructions.each(function(B){if(B.getAttribute("data-cctype")==A.memo.type){B.showByClass()}else{B.hideByClass()}})}});var CustomerAddressForm=Class.create();CustomerAddressForm.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initExtend:function(){this.countryInput=null;this.countrySelect=null;this.countryWrapper=this.element.getFirstElementByClassName("addressCountryField");this.cityWrapper=this.element.getFirstElementByClassName("addressCityField");if(this.countryWrapper.getElementsByTagName("input").length>0){this.countryInput=this.element.getElementsByTagName("input")[0]}if(this.countryWrapper.getElementsByTagName("select").length>0){this.countrySelect=this.element.getElementsByTagName("select")[0]}this.stateProvince=this.element.getFirstElementByClassName("stateProvince");this.initialHTML=this.stateProvince.innerHTML;this.initialValue="";this.stateProvince.hasError=Element.extend(this.stateProvince.getElementsByTagName("label")[0]).hasClassName("error");if(this.stateProvince.getElementsByTagName("input").length>0){this.initialValue=this.stateProvince.getElementsByTagName("input")[0].value}if(this.stateProvince.getElementsByTagName("select").length>0){this.initialValue=this.stateProvince.getElementsByTagName("select")[0][this.stateProvince.getElementsByTagName("select")[0].selectedIndex].value}this.postalCodeWrapper=this.element.getFirstElementByClassName("postalCode");this.countriesWithoutPostalCode=$A(this.params.countriesWithoutPostalCode.split(","));this.getListAjax();this.setPostalCode();if(this.countrySelect!=null){Event.observe(this.countrySelect,"change",this.getListAjax.bindAsEventListener(this));Event.observe(this.countrySelect,"change",this.setPostalCode.bindAsEventListener(this))}},setPostalCode:function(){var A=null;if(this.countryInput!=null){A=this.countryInput.value}if(this.countrySelect!=null){A=this.countrySelect[this.countrySelect.selectedIndex].value}var B=false;for(i=0;i<this.countriesWithoutPostalCode.length;i++){if(this.countriesWithoutPostalCode[i]==A){B=true;break}}if(B){this.postalCodeWrapper.hideByClass()}else{this.postalCodeWrapper.showByClass()}},getListAjax:function(){this.stateProvince.addClassName("intrastitial");var A=null;if(this.countryInput!=null){A=this.countryInput.value}if(this.countrySelect!=null){A=this.countrySelect[this.countrySelect.selectedIndex].value}var B=new Ajax.Request("/helper/populateStateList",{parameters:"models[countryCode].countryCode="+A,onSuccess:this.success.bind(this),onFailure:this.failure.bind(this),onException:this.failure.bind(this)})},success:function(A){log.info("Response recieved from stateProvince AJAX");this.fillDiv(A.responseText);this.stateProvince.removeClassName("intrastitial")},failure:function(A){log.error("No response from stateProvince AJAX");this.initialFill(this.initialHTML);this.stateProvince.removeClassName("intrastitial")},fillDiv:function(C){var F="";var E=new RegExp('name="[^"]*"');F=C.replace(E,'name="'+this.params.stateProvinceBindNode+'"');var A=new RegExp('value="[^"]*"');F=F.replace(A,'value="'+this.initialValue+'"');this.stateProvince.update(F);Page.initializeDOMFragment(this.stateProvince);if(this.stateProvince.hasError){this.stateProvince.getElementsByTagName("label")[0].addClassName("error")}if(this.stateProvince.getElementsByTagName("select").length>0){var D=this.stateProvince.getElementsByTagName("select")[0];for(var B=0;D.options[B];B++){if(D.options[B].value==this.initialValue){D.selectedIndex=B}}}},initialFill:function(A){this.stateProvince.innerHTML=A}});var DateDuration=Class.create();DateDuration.prototype=Object.extend(new Abstract.Agent(),{initialized:false,initExtend:function(){var B=this.element;var A=document.createElement("label");A.className="control textInput textInput-large durationLabel";A.innerHTML=this.params.labelContent;B.appendChild(A);if(B.tripDuration){this.updateDuration(B)}},updateDuration:function(B){if(B.tripDuration||B.tripDuration===0){var A=B.getFirstElementByClassName("durationLabel","label");if(A){var C=A.getFirstElementByClassName("readOnlyValue","span");C.innerHTML=B.tripDuration}}}});var DeferredImages={viewportScroll:0,documentHeight:0,create:function(){Event.observe(window,"resize",DeferredImages.viewportResize);Event.observe(window,"scroll",DeferredImages.scroll);DeferredImages.cache=$A();DeferredImages.calculateViewport()},destroy:function(){delete DeferredImages.cache;Event.stopObserving(window,"resize",DeferredImages.viewportResize);Event.stopObserving(window,"scroll",DeferredImages.scroll)},isInViewport:function(C){var B=700;var A=C.totalOffset-DeferredImages.viewportScroll;if(A<(DeferredImages.viewportHeight+B)&&A>-(C.height+B)){return true}return false},isInDocument:function(A){var C=A.parentNode,B=false;while(C){B=(C==document);C=C.parentNode}return B},calculateViewport:function(){DeferredImages.viewportHeight=document.viewport.getHeight();DeferredImages.viewportScroll=document.viewport.getScrollOffsets().top},calculateImages:function(){DeferredImages.cache.each(function(B){var A=B.el;A.totalOffset=Element.cumulativeOffset(A).top})},loadImages:function(){if(DeferredImages.documentHeight!==document.body.offsetHeight){DeferredImages.documentHeight=document.body.offsetHeight;DeferredImages.calculateImages()}DeferredImages.cache=DeferredImages.cache.reject(DeferredImages.loadImage);if(DeferredImages.cache.length===0){DeferredImages.destroy()}},loadImage:function(B){var A=B.el;if(A.totalOffset>0||DeferredImages.isInDocument(A)){if(DeferredImages.isInViewport(A)){var C=A.src;Event.observe(A,"error",function(){log.warning("Request for "+B.src+" timed out");A.src=C});A.removeAttribute("height");A.removeAttribute("width");A.src=B.src;return true}return false}else{return true}},scroll:function(){Event.stopObserving(window,"scroll",DeferredImages.scroll);var A=100;DeferredImages.viewportScroll=document.viewport.getScrollOffsets().top;DeferredImages.loadImages();if(DeferredImages.cache){setTimeout(function(){DeferredImages.loadImages();if(DeferredImages.viewportScroll===document.viewport.getScrollOffsets().top){if(DeferredImages.cache){Event.observe(window,"scroll",DeferredImages.scroll)}}else{DeferredImages.viewportScroll=document.viewport.getScrollOffsets().top;if(DeferredImages.cache){setTimeout(arguments.callee,A)}}},A)}},viewportResize:function(){if(DeferredImages.viewportHeight!==document.viewport.getHeight()){DeferredImages.calculateViewport();DeferredImages.loadImages()}}};var DeferredImage=Class.create();DeferredImage.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){if(this.params.src){if(this.element.naturalWidth>0||this.element.complete){if(!DeferredImages.cache){DeferredImages.create()}this.element.totalOffset=Element.cumulativeOffset(this.element).top;var A={el:this.element,src:this.params.src};if(!DeferredImages.loadImage(A)){DeferredImages.cache.push(A)}}else{this.element.src=this.params.src}}}});var DelayedContent=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.container=Element.extend(this.element);this.url=this.params.ajaxUrl||document.location.href;this.latency=this.params.latency;this.busy=false;this.delay=this.retrieve.bind(this).delay(this.latency)},retrieve:function(){if(!this.busy){this.busy=true;log.debug("loading content from: "+this.url);var A=new Ajax.Request(this.url,{method:"get",onSuccess:(function(C){var B=C.responseText;log.info(B);this.updateContent(B);this.busy=false;document.fire("agent:resultsUpdated")}).bind(this),onFailure:(function(){log.error("DelayedContent: No response from application for Element Updates")})})}},updateContent:function(A){var B=Element.update(this.container,A);Page.initializeDOMFragment(this.container)},cleanup:function(){window.clearTimeout(this.delay)}});var DetailsToggle=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.element.on("click",this.toggleContent.bind(this))},toggleContent:function(B){var A=this.element;if(!this.container){this.container=this.params.parentSelector?A.up(this.params.parentSelector):$(document.body)}if(!this.targets){this.targets=this.container.select(this.params.selectors)}B.preventDefault();this.targets.each(function(C){if(C.visibleByClass()){A.removeClassName("actionCollapse");A.addClassName("actionExpand");C.hideByClass()}else{A.removeClassName("actionExpand");A.addClassName("actionCollapse");C.showByClass()}})}});var DialogPositioningContextAgent=Class.create();DialogPositioningContextAgent.prototype=Object.extend(new Abstract.Agent(),{initialize:function(A,B){Object.extend(this,B);this.element=Element.extend(A);this.dialogPositioningContextObject=new DialogPositioningContext(this.element)}});var DisableContactTypes=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){var B=this.element.down("input",1);var A=function(C){this.element.select("input","select").each(function(D){if(B.checked){D.enable()}else{D.disable()}B.enable()})};B.on("click",A.bind(this))}});var DropDownList=Class.create(Abstract.Agent,{initExtend:function(){this.trigger.writeAttribute("tabindex","0");this.wrapper.addClassName("dropDown");this.trigger.addClassName("trigger");this.content.addClassName("content");this.toggleObserver=this.toggle.bindAsEventListener(this);this.trigger.observe("click",this.toggleObserver);this.trigger.observe("keypress",this.toggleObserver)},toggle:function(A){if(A.type==="keypress"&&A.keyCode!==Event.KEY_RETURN){return}this.wrapper.hasClassName("opened")?this.hide():this.show()},show:function(){this.wrapper.addClassName("opened");this.content.toggleClassName("noneBlock");window.setTimeout(this.attachBodyListeners.bind(this),0)},hide:function(){this.wrapper.removeClassName("opened");this.content.toggleClassName("noneBlock");this.wrapper.setStyle({height:""});this.trigger.setStyle({width:""});this.detachBodyListeners()},attachBodyListeners:function(){document.observe("click",this.toggleObserver);document.observe("keypress",this.toggleObserver)},detachBodyListeners:function(){document.stopObserving("click",this.toggleObserver);document.stopObserving("keypress",this.toggleObserver)}});var DropDownFromSelect=Class.create(DropDownList,{beforeDOMReady:true,initExtend:function($super){var B=this.element.down("select"),A=new Element("ul");this.wrapper=new Element("div",{"class":"dropDown fromSelect"});this.trigger=new Element("div");this.content=new Element("div",{"class":"noneBlock"});this.wrapper.insert(this.trigger).insert(this.content);B.hide();if(this.params.parentWidth){Element.extend(this.element.parentNode).setStyle({width:this.params.parentWidth})}B.select("option").each(function(D){if(D.selected){this.trigger.update("<div>"+D.text+"</div>")}else{var C,E=new Element("a").update(D.text);E.href="#";C=new Element("li").update(E);E.observe("click",function(){D.selected=true;B.form.submit()});A.insert(C)}}.bind(this));this.element.insert(this.wrapper);this.content.update(A);$super()},show:function($super){$super();var D=this.trigger.getLayout();var A=this.content.getLayout();var B=D.get("padding-left")+D.get("padding-right");if(!this.menuWidth){if(D.get("padding-box-width")>A.get("padding-box-width")){this.menuWidth=D.get("padding-box-width")}else{this.menuWidth=A.get("padding-box-width")}}var C=D.get("border-box-height")+A.get("border-box-height");this.trigger.setStyle({width:(this.menuWidth-B)+"px"});this.content.setStyle({width:this.menuWidth+"px"});this.wrapper.setStyle({height:C+"px"})}});var DropDownFromDocument=Class.create(DropDownList,{beforeDOMReady:true,initExtend:function($super){this.wrapper=this.element;this.trigger=this.element.down(this.params.triggerElement);this.content=this.element.down(this.params.contentElement);this.content.setStyle({minWidth:(this.trigger.getLayout().get("padding-box-width"))+"px"});$super()}});var DropDownMenu=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.showMenuClass=this.params.showMenuClass;this.showClass=this.params.showClass;this.menuLinkClass=this.params.menuLinkClass;if(!this.showClass||!this.menuLinkClass){log.error(this.type+": Required param undefined");return}this.element.addClassName(this.showMenuClass);this.element.observe("click",this.toggleMenu.bind(this));document.observe("click",this.closeMenu.bind(this))},toggleMenu:function(C){var B=C.element();var A=B.up();if(B.hasClassName(this.menuLinkClass)||A.hasClassName(this.menuLinkClass)){C.stop();if(A.hasClassName(this.menuLinkClass)){A=A.up()}this.activeMenu==A?this.closeMenu():this.openMenu(A)}},openMenu:function(A){this.closeMenu();this.activeMenu=A.addClassName(this.showClass)},closeMenu:function(){this.activeMenu&&this.activeMenu.removeClassName(this.showClass);this.activeMenu=null}});var ElementUpdater=Class.create();ElementUpdater.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){document.observe("content:update",this.updateContent.bindAsEventListener(this))},updateContent:function(A){if(this.params.sourceKey in A.memo){this.hideContent(this.element,function(){try{this.element.update(A.memo[this.params.sourceKey]);Page.initializeDOMFragment(this.element);document.fire("contentUpdate:succeeded")}catch(B){log.error("ElementUpdater: Error");Errors.capture(B)}this.showContent(this.element)}.bind(this))}},hideContent:function(A,B){document.body.style.cursor="wait";new Effect.Fade(A,{duration:0.2,to:0.2,afterFinish:B})},showContent:function(A){new Effect.Appear(A,{duration:0.2,from:0.2,to:1});document.body.style.cursor="default"}});var ElementUpdateTrigger=Class.create();ElementUpdateTrigger.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){var A=this.params.event?this.params.event:"click";this.control=this.element.getElementsByTagName("input")[0]||this.element.getElementsByTagName("select")[0];Event.observe(this.control,A,this.updateSummary.bindAsEventListener(this))},updateSummary:function(C){document.fire("contentUpdate:started");var A=this.control.form;var D=Form.serialize(A).deleteQueryStringParam("_eventId",true)+"&"+this.params.eventId+"=true";var B=new Ajax.Request(A.action,{method:"post",parameters:D,onSuccess:function(E){document.fire("content:update",E.responseText.unescapeJSON().evalJSON())},onFailure:function(){log.error("ElementUpdateTrigger: No response from application for Element Updates")}})}});var SubmitUpdateTrigger=Class.create();SubmitUpdateTrigger.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){var A=this.params.event?this.params.event:"click";this.control=this.element;Event.observe(this.control,A,this.updateSummary.bindAsEventListener(this))},updateSummary:function(C){C.preventDefault();document.fire("contentUpdate:started");var A=this.control.form;var D=Form.serialize(A).deleteQueryStringParam("_eventId",true)+"&"+this.params.eventId+"=true";var B=new Ajax.Request(A.action,{method:"post",parameters:D,onSuccess:function(E){document.fire("content:update",E.responseText.unescapeJSON().evalJSON())},onFailure:function(){log.error("SubmitUpdateTrigger: No response from application for Element Updates")}})}});var ExpandCollapse=Class.create(Abstract.Agent,Persistent,{beforeDOMReady:true,initExtend:function(){this.initPersistence(this.params.persistenceId);try{this.opened=this.getPersistent("opened")}catch(A){this.opened=null;log.error("ExpandCollapse: get persistence failed: "+A)}if(this.opened===null){this.opened=(this.params.collapseState==="opened")}this.target=this.element.down(this.params.targetSelector);this.expandCollapseLink=new Element("a");this.expandCollapseLink.addClassName("collapseLink");this.expandCollapseLink.href="#";this.element.insert({top:this.expandCollapseLink});this.element.addClassName("collapsible");this.expandLink=this.params.expandText;this.collapseLink=this.params.collapseText;this.updateContent(true);this.expandCollapseLink.on("click",this.toggleCollapse.bind(this))},updateContent:function(A){if(this.opened){this.target.showByClass();if(A){this.expandCollapseLink.insert(this.collapseLink)}else{this.expandCollapseLink.update(this.collapseLink)}this.expandCollapseLink.addClassName("expanded");this.element.removeClassName("collapsed")}else{this.target.hideByClass();if(A){this.expandCollapseLink.insert(this.expandLink)}else{this.expandCollapseLink.update(this.expandLink)}this.expandCollapseLink.removeClassName("expanded");this.element.addClassName("collapsed")}},toggleCollapse:function(A){A.preventDefault();this.opened=!(this.opened);try{this.setPersistent("opened",this.opened)}catch(B){log.error("ExpandCollapse: set persistence failed: "+B)}this.updateContent()}});var FacebookXFBMLParse=Class.create();FacebookXFBMLParse.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initExtend:function(){var A=function(){if(this.params.markup){this.element.insert(this.params.markup)}FB.XFBML.parse(this.element)}.bind(this);FacebookSDK.load(A,this)}});var FacebookLoader=Class.create();FacebookLoader.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(!this.params.url){log.error("FaceBookLoader: A required parameter was not passed to agent");return}var A=this.params.locale||"en_US";var B=function(){var D="http://www.facebook.com/plugins/like.php?href="+encodeURIComponent(this.params.url)+"&locale="+A+"&layout=button_count&show_faces=true&width=90&action=like&colorscheme=light&height=21";var C=new Element("iframe",{src:D});C.frameBorder=0;C.scrolling="no";this.element.insert({bottom:C})};if(Page.onLoadFired){B.call(this)}else{Event.observe(window,"load",B.bind(this))}}});var FeaturedHotelLightbox=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){document.fire("lightbox:open",{content:this.params.content.string});var A=$("lightbox-content");var B=(this.params.options.classes)?this.params.options.classes:"";if(A){A.addClassName(B)}}});var Filter=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.mainLayoutElement=$("main");this.intrastitialMessage=this.params.intrastitialMessage||"";if(this.intrastitial==null){this.intrastitial=new Intrastitial(this.intrastitialMessage,this.mainLayoutElement,true)}this.mostRecentRequest=null;this.element.observe("click",this.processEvent.bindAsEventListener(this,"click"));this.element.observe("agent:filter",this.processEvent.bindAsEventListener(this,"agent:filter"));var B=(this.element.tagName.toLowerCase()=="form")?this.element:this.element.up("form");if(B){B.stopObserving("submit");B.observe("submit",this.processEvent.bindAsEventListener(this,"submit"));this.lastQuery=B.serialize()}var A=this.element.select("select");for(i=0;i<A.length;i++){Event.observe(A[i],"change",function(D){var C=$(Event.findElement(D,"form"));this.fetch(C.action,C.serialize())}.bind(this))}},processEvent:function(D,B){var A=Event.element(D);if((B=="agent:filter"&&!D.memo.url)||(B=="submit")||(A.tagName.toLowerCase()=="input"&&A.getAttribute("type")=="checkbox")){if(A.className=="agentCtrl"){return}var C=$(Event.findElement(D,"form"));if(!C){return}this.fetch(C.action,C.serialize())}else{if(B=="agent:filter"&&D.memo.url){this.fetch(D.memo.url)}}if(B=="submit"){D.preventDefault()}},fetch:function(A,B){if(B&&B==this.lastQuery){return}this.lastQuery=B;document.fire("agent:updatingResults");B=B?B+"&":"";new Ajax.Request(A,{method:"get",parameters:B+"rep=partial",onCreate:(function(C){if(!this.mostRecentRequest){this.intrastitial.show()}this.mostRecentRequest=C.transport}).bind(this),onSuccess:(function(C){if(C.transport==this.mostRecentRequest){Page.initializeAjaxResponse(C.responseText);this.intrastitial.hide();this.mostRecentRequest=null;document.fire("agent:resultsUpdated")}}).bind(this),onFailure:(function(C){if(C.transport==this.mostRecentRequest){this.intrastitial.hide();this.mostRecentRequest=null;window.location.reload()}}).bind(this)})}});var FilterOnLinkClick=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.element.observe("click",this.callFilter.bindAsEventListener(this));if(this.params.hiddenInput){this.hiddenInput=(new Element("div")).update(this.params.hiddenInput).childElements()[0];this.element.insert({bottom:this.hiddenInput})}},callFilter:function(B){var A=B.findElement("a");if(A){if(this.hiddenInput){this.hiddenInput.value=A.href.toQueryParams()[this.hiddenInput.name]||"";this.element.fire("agent:filter")}else{this.element.fire("agent:filter",{url:A.href})}B.preventDefault()}if(this.params.webtrendsLabel){this.element.fire("webtrends:multiTrackEvent",{"DCSext.fctkw":this.params.webtrendsLabel})}}});var FilterLinksToggleState=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.className="selected";if(this.params.className){this.className=this.params.className}this.element.observe("click",this.toggleState.bindAsEventListener(this))},toggleState:function(C){var B=C.findElement("a");if(B){var A=B.up("li");if(A){var D=B.down("img");if(D){A.removeClassName(this.className);B.addClassName("offscreen")}else{A.addClassName(this.className);A.siblings().each(function(E){if(E.hasClassName(this.className)){E.removeClassName(this.className);if(E.down("a img")){E.down("a").remove()}}}.bind(this))}}else{log.error("FilterLinksToggleState : listItem undefined")}}}});var FilterRequestManager=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.mainLayoutElement=$("main");this.intrastitialMessage=this.params.intrastitialMessage||"";this.rep=this.params.rep||"filter";this.mostRecentRequest=null;this.element.on("agent:filter",this.processEvent.bind(this));this.element.stopObserving("submit");this.element.on("submit",this.processEvent.bind(this));var B=this.params.url.unescapeHTML();var A=B.toQueryParams();this.query={};Object.keys(A).each(function(C){if(C.startsWith("models['searchView']")){this.query[C]=A[C];delete A[C]}},this);this.url=B.split("?")[0]+"?"+Object.toQueryString(A)},processEvent:function(A){if(A.memo&&A.memo.params){Object.extend(this.query,A.memo.params);this.fetch(this.url,this.query)}else{if(A.memo&&A.memo.url){this.fetch(A.memo.url)}else{this.fetch(this.url,this.query);A.preventDefault()}}},fetch:function(A,B){var C="";if(B){C=Object.toQueryString(B)}if(C&&C==this.lastQuery){return}this.lastQuery=C;var C=Object.toQueryString(B);if(this.request){this.request.abort()}document.fire("agent:updatingResults");this.request=new Ajax.PartialPage(A,{method:"get",parameters:C+"&rep="+this.rep,onCreate:(function(D){if(!this.mostRecentRequest){if(!this.intrastitial){this.intrastitial=new Intrastitial(this.intrastitialMessage,this.mainLayoutElement,true);if(this.params.intrastitialClassName){this.intrastitial.mask.addClassName(this.params.intrastitialClassName)}}this.intrastitial.show()}this.mostRecentRequest=D.transport}).bind(this),onSuccess:(function(D){if(D.transport==this.mostRecentRequest){this.intrastitial.hide();this.mostRecentRequest=null;document.fire("agent:resultsUpdated")}}).bind(this),onFailure:(function(D){log.error("FilterRequestManager: filter request failed.");if(D.transport==this.mostRecentRequest){this.mostRecentRequest=null}}).bind(this)})}});var Fixed=Class.create();Fixed.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initExtend:function(){var C=this.params.minimumScreenHeight;if(C!==undefined&&screen.height<=C){return}var A=this.createFixedElement();if(!A){return}if(this.params.hideLinkMarkup&&Persist){var B=Persist.get("fixedAgent",true);if(!B||!B.expires||!(new Date().getTime()-B.expires<0)){this.show()}}else{this.show()}this.element.on("agent:fixedContentChanged",this.onContentChanged.bind(this))},onContentChanged:function(A){if(this.isHidden()){return}this.calcLowerBound();if(this.dockedBottom){this.dockToBottom()}if(A.memo&&A.memo.focusRequested){if(!this.fixedState&&this.isOffscreen()){this.element.scrollTo()}}},isOffscreen:function(){var F,E,C,B,D,A;C=document.viewport.getScrollOffsets();B=document.viewport.getHeight();D=this.element.cumulativeOffset();A=this.element.getHeight();F=D.top<C.top;E=(D.top+A)>(C.top+B);return F||E},createFixedElement:function(){this.fixedElement=new Element("div",{"class":"fixedAgentLocked"});this.fixedElement.hide();document.body.appendChild(this.fixedElement);if(this.fixedElement.getStyle("position")=="static"){this.fixedElement.remove();return false}this.fixedElement.remove();this.fixedElement.show();return true},show:function(){this.fixedElement.setStyle({height:this.element.getHeight()+"px",width:this.element.getWidth()+"px"});this.fixedElement.appendChild(new Element("div",{"class":"fixedShadow "+this.params.shadowExtendClass}));if(this.params.hideLinkMarkup){var A=new Element("div",{"class":"hideTab"}).insert(this.params.hideLinkMarkup);this.fixedElement.appendChild(A);A.down("a").observe("click",function(B){B.preventDefault();this.disable();if(Persist){Persist.set("fixedAgent",{expires:new Date().getTime()+604800000},true)}}.bind(this))}this.placeHolder=$(this.element.cloneNode(false));if(this.placeHolder.hasAttribute("id")){this.placeHolder.removeAttribute("id")}if(this.placeHolder.hasAttribute("data-agent")){this.placeHolder.removeAttribute("data-agent")}this.placeHolder.setStyle({borderWidth:0,padding:0});this.calcUpperBound();this.boundsContainer=this.element.up(this.params.boundsSelector||"body");this.calcLowerBound();this.fixedState=false;this.dockedBottom=false;this.scrollingState=false;this.observer=this.testModeChange.bind(this);this.clickObserver=(function(){setTimeout(this.testModeChange.bind(this),0)}).bind(this);if(!this.params.startDisabled){if(this.params.adjustScrollForAnchoredPageLoads){this.adjustScroll=true}this.enable();this.adjustScroll=false}if(this.params.enableMVT){this.mvtListener=(function(B){document.stopObserving("mvt:HOTEL200_stalkbar",this.mvtListener);if(B.memo=="disable"){this.disable()}else{if(B.memo=="toggle"){if(this.enabled){this.disable()}else{this.enable()}}}this.mvtListener=null}).bindAsEventListener(this);document.observe("mvt:HOTEL200_stalkbar",this.mvtListener);this.element.fire("mvt:HOTEL200_stalkbar-ready")}},calcUpperBound:function(){var A=this.element.cumulativeOffset();this.initialYPos=A.top;this.initialXPos=A.left},calcLowerBound:function(){this.initialBoundsYPos=this.boundsContainer.cumulativeOffset().top;this.initialBoundsHeight=this.boundsContainer.getHeight();this.maxYPos=this.initialBoundsYPos+this.initialBoundsHeight-this.element.getHeight();this.bottomDockYOffset=this.initialBoundsHeight-this.element.getHeight()},boundsChanged:function(){var B=this.boundsContainer.cumulativeOffset().top;var A=this.boundsContainer.getHeight();return(B!=this.initialBoundsYPos||A!=this.initialBoundsHeight)},isHidden:function(){return this.element.getHeight()>0?false:true},enable:function(){if(this.enabled){return}this.testModeChange();Event.observe(window,"scroll",this.observer);document.observe("click",this.clickObserver);this.enabled=true},disable:function(){if(!this.enabled){return}Event.stopObserving(window,"scroll",this.observer);document.stopObserving("click",this.clickObserver);this.unlock();this.enabled=false},testModeChange:function(){this.calcLowerBound();var A=document.viewport.getScrollOffsets();if(!this.fixedState){var B=this.element.cumulativeOffset().top;if(A.top>this.initialYPos&&A.top<=this.maxYPos){this.lock()}}else{if(this.fixedState&&(A.top<this.initialYPos||A.top>=this.maxYPos)){this.unlock()}else{this.fixPosition()}}},fixPosition:function(){if(this.fixedState){this.horizontalDistance=this.initialXPos-document.viewport.getScrollOffsets().left;this.fixedElement.style.left=this.horizontalDistance+"px"}else{this.fixedElement.style.left=0}},lock:function(){if(this.fixedState||this.isHidden()){return}var A=this.element.cumulativeOffset().top;if(!this.dockedBottom&&A!=this.initialYPos){this.initialYPos=A;this.testModeChange()}else{if(this.dockedBottom&&this.boundsChanged()){this.testModeChange()}else{this.fixedState=true;this.fixPosition();this.dockedBottom=false;this.element.setStyle({position:"static",top:""});var B=this.element.getDimensions();this.placeHolder.setStyle({height:B.height+"px",width:B.width+"px"});if(this.adjustScroll&&document.viewport.getScrollOffsets().top>this.initialYPos+B.height){this.adjustScroll=false;if(document.body&&document.body.scrollTop){document.body.scrollTop=document.body.scrollTop+B.height}else{if(document.documentElement&&document.documentElement.scrollTop){document.documentElement.scrollTop=document.documentElement.scrollTop-B.height}}}this.element.insert({before:this.fixedElement});this.fixedElement.insert({top:this.element});this.fixedElement.insert({after:this.placeHolder})}}},unlock:function(){if(!this.fixedState){return}if(this.boundsChanged()){this.calcLowerBound();this.testModeChange()}else{var A=document.viewport.getScrollOffsets();if(A.top>=this.maxYPos){this.dockToBottom()}else{this.dockToTop()}this.placeHolder.remove();this.fixedElement.insert({after:this.element});this.fixedElement.remove();this.fixedState=false;this.fixPosition()}},dockToTop:function(){this.element.setStyle({position:"relative",top:"0px"});this.dockedBottom=false},dockToBottom:function(){this.element.setStyle({position:"relative",top:this.bottomDockYOffset+"px"});this.dockedBottom=true}});var FlexHotelResults=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.results=this.element.down(".hotelResults");$(this.element).down(".select select").observe("change",this.submit.bindAsEventListener(this));this.intrastitial=new GenericIntrastitial(this.element,"intrastitialOverlay",this.params.message)},submit:function(B){B.preventDefault();var A=B.element().form;var C=$(A).serialize()+"&ajax=true";this.intrastitial.show();new Ajax.PartialRequest(A.action,{parameters:C,method:"get",onSuccess:function(D){this.results.update(D.responseText);Page.initializeDOMFragment(this.results);this.intrastitial.hide()}.bind(this),onFailure:function(D){this.intrastitial.hide()}.bind(this)})}});var flexWidth=Class.create(Abstract.Agent,{initExtend:function(){this.resizeElement();Event.observe(window,"resize",this.resizeElement.bindAsEventListener(this))},resizeElement:function(){var B=$(this.element.parentNode);var A=document.documentElement.clientWidth;if(A<B.getWidth()&&A>0){this.element.style.width=(A-this.params.offSet)+"px"}else{this.element.style.width=""}}});var FlexHotelResultsLinkFilter=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.element.insert({top:this.params.filterMarkup});this.elementToUpdate=this.element.up(this.params.elementToUpdate);this.attachEventHandlersToTriggers();this.intrastitial=new GenericIntrastitial(this.element.up(),"intrastitialOverlay",this.params.message)},handleLinkClick:function(D){var C,A;if(this.params.triggerType=="link"){C=D.element().href}else{if(this.params.triggerType=="formControl"){var B=D.element().form;C=B.action;A=$(B).serialize()+"&ajax=true"}}this.intrastitial.show();new Ajax.PartialRequest(C,{method:"get",parameters:A,onSuccess:function(E){this.elementToUpdate.update(E.responseText);Page.initializeDOMFragment(this.elementToUpdate);this.intrastitial.hide()}.bind(this),onFailure:function(E){this.intrastitial.hide()}.bind(this)});D.preventDefault()},attachEventHandlersToTriggers:function(){var A=$(this.element).select(".filterTrigger");for(i=0;i<A.length;i++){if(this.params.triggerType=="link"){A[i].observe("click",this.handleLinkClick.bindAsEventListener(this))}else{if(this.params.triggerType=="formControl"){A[i].down("select").observe("change",this.handleLinkClick.bindAsEventListener(this))}}}}});var flexMiniAirForm=Class.create();flexMiniAirForm.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(this.params.setUpDefaults){this.params.mcOptions.setUp=function(){var B=this.dialogObject.markup.mainInfo.down("form");var A=this.element.readAttribute("data-mini-air-form");var C=A.unescapeJSON().evalJSON();if(C.defaultStartDate&&C.defaultEndDate){B.elements["ar.rt.leaveSlice.date"].value=C.defaultStartDate;B.elements["ar.rt.returnSlice.date"].value=C.defaultEndDate}if(C.origin&&C.destination){B.elements["ar.rt.leaveSlice.orig.key"].value=C.origin;B.elements["ar.rt.leaveSlice.dest.key"].value=C.destination}this.dialogObject.markup.mainContent.down("h3").innerHTML=C.microContentHeading}.bind(this)}this.dialogObject=new Microcontent(this.element.select(".miniAirFormTrigger a"),{url:"/helper/flexMiniSearch?type=air"},this.params.mcOptions)}});var FlexMiniHotelForm=Class.create();FlexMiniHotelForm.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(this.params.setUpDefaults){this.params.mcOptions.setUp=function(){var B=this.dialogObject.markup.mainInfo.down("form");var A=this.element.select(this.params.identifier);var D=A[0].readAttribute("data-mini-hotel-form");var F=D.unescapeJSON().evalJSON();for(var C=0;C<F.availabilityCheckParams.length;++C){var E=new Element("input",{type:"hidden",name:F.availabilityCheckParams[C].key,value:F.availabilityCheckParams[C].value});B.insert({top:E})}}.bind(this)}this.dialogObject=new Microcontent(this.element.select(this.params.identifier),{url:"/helper/flexMiniSearch?type=hotel"},this.params.mcOptions)}});var FormValidator=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){if(["highlight-only","submit-message","submit-blocked"].include(this.params.mode)){if(this.params.mode!=="highlight-only"){this.microcontent=new FormValidatorMicrocontent()}this.submitBlocked=this.params.mode=="submit-blocked"?true:false}else{return}log.debug("FormValidator mode: "+this.params.mode);this.firstErrorAnchor=new Element("a",{id:"firstError"});this.highestEditedField=this.findFields()[0];this.formClickListener=this.element.on("click",this.findFields.bind(this))},watchField:function(A){if(A.type=="submit"&&A.up("#main .submit")){A.on("click",this.onSubmitClick.bind(this))}else{if(A.type=="radio"||A.type=="checkbox"){A.on("click",this.onDataEntry.bind(this))}else{A.on("change",this.onDataEntry.bind(this))}}A.store("FormValidator_watching",true);A.store("FormValidator_passed",false)},findFields:function(){if(this.formClickListener){this.formClickListener.stop()}var A=this.element.getElements();this.lastSubmitButton=null;for(var B=0;B<A.length;B++){var C=A[B];if(!C.retrieve("FormValidator_watching",false)&&!(C.tagName==="INPUT"&&C.type==="submit")){this.watchField(C)}if(C.tagName==="INPUT"&&C.type==="submit"&&C.up("#main .submit")){this.lastSubmitButton=C}}if(!this.lastSubmitButton.retrieve("FormValidator_watching",false)){this.watchField(this.lastSubmitButton)}return A},onDataEntry:function(A){var B=A.findElement();setTimeout(this.applyValidations.bind(this,B,false),0)},enableDisableSubmits:function(C){var A=this.element.select("#main .submit input");for(var B=0;B<A.length;B++){if(C){A[B].removeClassName("disabled")}else{A[B].addClassName("disabled")}}},onSubmitClick:function(B){var A=false;if(this.microcontent){A=true;if(this.microcontent.isOpen&&!this.submitBlocked){A=false}}var C=this.applyValidations(this.element.getElements().pop(),true);if(!C&&A){B.preventDefault()}},updateDisplay:function(A,G,B,H){var E=null;for(var C=0;C<A.length;C++){var D=A[C];var F=D.up("label");var J=D.up("fieldset");if(D.retrieve("FormValidator_passed")){if(F){F.removeClassName("notValid");if(D===G){F.removeClassName("error")}}if(J){var I=J.select(".notValid, .error");if(I.length==0){J.removeClassName("notValid");if(D===G){J.removeClassName("error")}}}}else{if(F){F.addClassName("notValid")}if(J){J.addClassName("notValid")}if(E==null){E=D;if(J){J.insert({before:this.firstErrorAnchor})}else{if(F){F.insert({before:this.firstErrorAnchor})}}}}}if(B==0&&this.firstErrorAnchor.parentNode){this.firstErrorAnchor=this.firstErrorAnchor.remove()}if(this.submitBlocked){this.enableDisableSubmits(B==0)}if(this.microcontent){if(B==0){this.microcontent.close()}else{if(B==1){this.microcontent.singleError(this.lastSubmitButton,H)}else{this.microcontent.multipleErrors(this.lastSubmitButton,H)}}}},applyValidations:function(L,P){var D=this.findFields();var K=this.element.serialize(true);var I=null;var F=null;for(var H=0;H<D.length;H++){var J=D[H];if(this.highestEditedField===J){I=H}if(L&&L===J){F=H}if(I!==null&&F!==null){break}}if(I===null||F>I){I=F;this.highestEditedField=D[F]}var A=[];var B=0;for(var H=0;H<=I;H++){var J=D[H];var E=[];var Q=J.up("label");if(Q!==undefined&&Q.down(".requiredFieldIndicator")!==undefined){E=["required"]}if(J.type=="radio"&&!K[J.name]){if(!E.include("required")){E=["required"]}}var C=true;for(var O=0;O<E.length;O++){var M=E[O];if(this.fieldValidators[M]){var G=this.fieldValidators[M].call(this,J,K);if(!G){C=false;B++;break}}else{log.error("no such validator: "+M)}}J.store("FormValidator_passed",C);A.push(J)}this.updateDisplay(A,L,B,P);log.info("FormValidator: checked "+A.length+" out of "+D.length+" fields - "+B+" failed");return B==0},isAvailableToUser:function(C){if(!C.disabled&&!C.readOnly){if(C.getStyle("visibility")==="hidden"){return false}var B=[C].concat(C.ancestors());for(var A=0;A<B.length;A++){if(B[A].getStyle("display")==="none"){return false}}return true}else{return false}},fieldValidators:{required:function(B,A){if(B.tagName==="INPUT"){if(B.type==="text"||B.type==="money"||B.type==="password"||B.type==="email"||B.type==="tel"){if(B.value.strip()===""&&this.isAvailableToUser(B)){return false}else{return true}}else{if(B.type==="checkbox"){if(!B.checked&&this.isAvailableToUser(B)){return false}else{return true}}else{if(B.type==="radio"){if(!A[B.name]&&this.isAvailableToUser(B)){return false}else{return true}}}}}else{if(B.tagName==="TEXTAREA"){if(B.value.strip()===""&&this.isAvailableToUser(B)){return false}else{return true}}else{if(B.tagName==="SELECT"){if(B.options[0].selected&&this.isAvailableToUser(B)){return false}else{return true}}}}},example:function(B,A){}}});var FormValidatorMicrocontent=Class.create(Microcontent,{initialize:function($super){var A={triggerEvent:"",closeLabel:"",topBoundaryText:"",bottomBoundaryText:"",classes:"validatorWarning"};$super([],{},A)},createMarkup:function($super){$super();this.markup.topBoundary.remove();this.markup.bottomBoundary.remove();this.markup.topCloseLink.remove();this.markup.bottomCloseLink.remove();this.markup.wrapLink.remove();this.markup.mainInfo.tabIndex=0},onPageHeightChange:function(){},singleError:function(B,A){this.focusCloseLink=A?this.focus:function(){};var C='<p>Please fill in the <a href="#firstError">required field above</a>.</p>';this.onPageHeightChange=function(){this.focusCloseLink=function(){};this.openMicrocontent(C,B)}.bind(this);this.openMicrocontent(C,B)},multipleErrors:function(B,A){this.focusCloseLink=A?this.focus:function(){};var C='<p>Please fill in the <a href="#firstError">required fields above</a>.</p>';this.onPageHeightChange=function(){this.focusCloseLink=function(){};this.openMicrocontent(C,B)}.bind(this);this.openMicrocontent(C,B)},openMicrocontent:function(C,B){if(this.markup&&this.markup.mainInfo){this.markup.mainInfo.update("")}var A=new Element("div");A.innerHTML=C;var D=A.down("a");D.on("click",this.focusOnError);this.content.domNode=A;var E=document.body.offsetHeight;this.open(null,B);if(this.pageHeightChangeInterval!=null){window.clearInterval(this.pageHeightChangeInterval);this.pageHeightChangeInterval=null}this.pageHeightChangeInterval=window.setInterval(function(){if(document.body.offsetHeight!=E){this.onPageHeightChange()}}.bind(this),250)},focusOnError:function(E){E.preventDefault();window.location.hash="firstError";var D=$("firstError");if(D){var B=D.next();B=B.tagName==="FIELDSET"?B:null;var C=B?B.down(".notValid"):D.next(".notValid")}if(C){var A=C.down("input, select, textarea");if(A){A.focus()}}},focus:function(){this.markup.mainInfo.focus()},close:function(){if(this.isOpen){window.clearInterval(this.pageHeightChangeInterval);this.pageHeightChangeInterval=null;this.depopulateDialog();this.removeFromDOM();this.activated=false;this.isOpen=false;this.cleanUpDebug()}},attachFocusListeners:function(){return false},attachCloseListeners:function(){},attachFocusWrapListeners:function(){},createShim:function(){}});var ConditionallyRequiredFields=Class.create(Abstract.Agent,{beforeDOMReady:false,requiredClassName:"requiredFieldIndicator",unRequiredClassName:"unRequiredFieldIndicator",initExtend:function(){this.parentElement=this.element.up(this.params.parentSelector);this.radio=this.element.down('input[type="radio"]');if(this.radio){this.eventName="ConditionallyRequiredFields:"+this.radio.name;this.updateFieldStates();this.radio.on("click",this.onClick.bind(this));document.on(this.eventName,this.updateFieldStates.bind(this))}else{log.error("ConditionallyRequiredFields: agent not attached to a radio button")}},onClick:function(){document.fire(this.eventName)},updateFieldStates:function(){if(this.radio.checked){this.requireFields()}else{this.unRequireFields()}},unRequireFields:function(){var A=this.parentElement.select("."+this.requiredClassName);for(var B=0;B<A.length;B++){A[B].removeClassName(this.requiredClassName);A[B].addClassName(this.unRequiredClassName)}},requireFields:function(){var A=this.parentElement.select("."+this.unRequiredClassName);for(var B=0;B<A.length;B++){A[B].removeClassName(this.unRequiredClassName);A[B].addClassName(this.requiredClassName)}}});var GenericIntrastitial=Class.create();GenericIntrastitial.prototype={initialize:function(B,A,C){this.spinner=new ProgressIndicator();this.overlayClass=A;this.wrapper=new Element("div",{style:"position: relative;"});$(B).insert({before:this.wrapper});this.msgContainer=(new Element("div",{"class":"message"})).insert(this.spinner.spinnerElement).insert(new Element("div").innerHTML=C);this.overlay=(new Element("div",{"class":A+" visible"})).insert(this.msgContainer).setOpacity(0.8);this.wrapper.insert($(B).remove()).insert(this.overlay);this.hide()},hide:function(){this.spinner.stop();this.overlay.hideByClass()},show:function(){this.spinner.start();this.overlay.showByClass()}};var GoogleCSESearchBox=Class.create(Abstract.Agent,{initExtend:function(){this.element.insert(this.params.markup);Event.observe(this.element.down("form"),"submit",this.handleSubmit.bind(this))},handleSubmit:function(C){var B=this.element.down("input.searchBox");var D=this.element.down("input.searchValue");var A=(B)?B.value:"";A=A.replace(/^\s+/,"");A=A.replace(/\s+$/,"");if(D){D.value=A}if(A==""){if(C){Event.stop(C)}return false}}});var GoogleMap=Class.create();GoogleMap.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(!this.params.location||isNaN(this.params.location.latitude)||isNaN(this.params.location.longitude)){log.error("GoogleMap: Location missing or invalid");return}if(isNaN(this.params.zoom)){log.error("GoogleMap: Zoom missing or invalid");return}if(this.params.map===undefined||(!this.params.map&&!this.params.streetview)){this.params.map=true}this.element.update();this.element.removeClassName("staticMap");this.element.addClassName("dynamicMap");this.element.addClassName("intrastitial");if(!this.pi){this.pi=new ProgressIndicator(this.element)}GoogleMapAPILoader.load(this.initMap.bind(this),this.params.locale)},initMap:function(){this.element.removeClassName("intrastitial");if(this.pi){this.pi.spinnerElement.remove();delete this.pi}this.location=new google.maps.LatLng(this.params.location.latitude,this.params.location.longitude);if(this.params.map){this.showMap()}if(this.params.streetview){this.enableStreetview()}},enableStreetview:function(){var A=this.params.location;GoogleMapUtil.getStreetView(new google.maps.LatLng(A.latitude,A.longitude),function(B){if(B){this.panoData=B}if(this.params.map){this.toggleLink=new Element("a",{"class":"link toggleLink"});this.element.insertBefore(this.toggleLink,this.mapElement);this.toggleLink.update(this.params.switchToStreetviewText);Event.observe(this.toggleLink,"click",this.toggleMaps.bindAsEventListener(this))}else{this.showStreetview()}}.bind(this))},toggleMaps:function(){if(this.currentMap==this.mapElement){this.showStreetview()}else{this.showMap()}},showMap:function(){if(!this.mapElement){this.mapElement=new Element("div",{"class":"standardMap"});this.element.appendChild(this.mapElement);var A={center:this.location,mapTypeControl:true,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.DEFAULT},scaleControl:true,scrollwheel:false,streetViewControl:false,zoom:this.params.zoom};this.map=new google.maps.Map(this.mapElement,A);this.marker=new google.maps.Marker({clickable:false,map:this.map,position:this.location});if(this.map.getTilt()==0){this.map.setTilt(45)}}if(this.currentMap){this.currentMap.hide()}this.mapElement.show();google.maps.event.trigger(this.map,"resize");this.currentMap=this.mapElement;if(this.toggleLink){this.toggleLink.update(this.params.switchToStreetviewText)}},showStreetview:function(){if(!this.streetviewElement){this.streetviewElement=new Element("div",{"class":"streetview"});this.element.appendChild(this.streetviewElement);this.streetviewElement.show();this.streetview=new google.maps.StreetViewPanorama(this.streetviewElement,{position:this.panoData.location.latLng,pov:{heading:GoogleMapUtil.calculateBearing(this.panoData.location.latLng,this.location),pitch:3,zoom:1},scrollwheel:false})}if(this.currentMap){this.currentMap.hide()}this.streetviewElement.show();google.maps.event.trigger(this.streetview,"resize");this.currentMap=this.streetviewElement;if(this.toggleLink){this.toggleLink.update(this.params.switchToMapText)}}});var GooglePlusOne=Class.create();GooglePlusOne.prototype=Object.extend(new Abstract.Agent(),{onDOMReady:true,initExtend:function(){if(!this.params.size){this.params.size="medium"}if(!this.params.annotation){this.params.size="bubble"}var A=this.params.locale||"en_US";GooglePlusOneAPILoader.load(this.renderButton.bind(this),A)},renderButton:function(){gapi.plusone.render(this.element,{size:this.params.size,annotation:this.params.annotation,align:"left"})}});var HIAMicroContentAgent=Class.create();HIAMicroContentAgent.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initialize:function(A,C){Object.extend(this,C);this.element=Element.extend(A);var B=[this.element];this.dialogObject=new HIAMicroContent(B,C.params.content,C.params.options)}});var HIAMicroContent=Class.create(Microcontent,{positionInViewport:function(){var A={x1:this.trigger.pos.x-this.triggerContext.pos.x,y1:this.trigger.pos.y-this.triggerContext.pos.y,x2:this.trigger.pos.x-this.triggerContext.pos.x+this.trigger.dim.width,y2:this.trigger.pos.y-this.triggerContext.pos.y+this.trigger.dim.height};var C=this.markup.dialogWrapper.getDimensions();this.markup.beak.className="microcontentBeakTop";var B=this.markup.beak.getDimensions();this.markup.beak.setStyle({left:(C.width-B.width)/2+"px"});this.markup.beak.setStyle({top:this.markup.top.dim.height+"px"});this.dialogBoundingBox={x1:(A.x1+A.x2)/2-C.width/2,y1:A.y2+B.height-10};this.markup.dialogWrapper.setStyle({left:((this.dialogBoundingBox.x1)/Units.PX_TO_EM)+"em"});this.markup.dialogWrapper.setStyle({top:((this.dialogBoundingBox.y1)/Units.PX_TO_EM)+"em"})}});var HideReveal=Class.create();HideReveal.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){log.info(this.selectors);this.targets=$A();this.swapContent=(this.swapContent)?this.swapContent:this.content;if(this.selectors){this.selectors=this.selectors.split(",")}if(this.swapSelectors){this.swapSelectors=this.swapSelectors.split(",")}switch(this.element.tagName){case"SPAN":this.hrType="link";if(!this.element.hasClassName("progressive")){this.bindObserver();this.updateContent()}break;case"DL":this.hrType="link";this.bindObserver();this.updateContent();break;case"A":this.hrType="link";this.bindObserver();this.updateContent();break;case"LABEL":this.inputs=this.element.getElementsByTagName("INPUT");if(this.inputs){var A=0;while(this.inputs[A]&&this.inputs[A].type=="hidden"){A++}this.input=this.inputs[A];this.hrType=this.input.type;switch(this.input.type){case"radio":new HideRevealRadio(this);break;case"checkbox":Event.observe(this.input,this.eventType,this.toggle.bindAsEventListener(this));if(this.input.checked){this.toggle()}break;default:log.warning('&lt;input type="'+this.input.type+'"&gt; not supported in HideReveal agent.');log.info("Please edit HideReveal.initExtend if you wish to implement hide/reveal functionality for this input type.")}}else{log.warning("&lt;label&gt; tag does not contain an input.")}break;case"DIV":this.bindObserver();break;default:log.warning("&lt;"+this.element.tagName+"&gt; tag not supported in HideReveal agent.");log.info("Please edit HideReveal.initExtend if you wish to implement hide/reveal functionality for this tag type.");break}},bindObserver:function(B,C){var A=B?B:this.toggle;var D=C?C:this;Event.observe(this.element,this.eventType,A.bindAsEventListener(D));if(this.radioValue){Event.observe(this.element,this.eventType,this.changeRadio.bind(this))}if(this.checkboxValue){Event.observe(this.element,this.eventType,this.toggleCheckbox.bind(this));Event.observe(this.input,this.eventType,this.toggleCheckbox.bind(this))}},toggleCheckbox:function(){this.input.checked=!(this.input.checked)},updateContent:function(A){var B=A?A:this.content;if(B){this.element.update(B);log.info("HideReveal is updating content to "+B)}else{B=this.element.innerHTML}this.content=this.swapContent;this.swapContent=B},findTargets:function(){this.targets=this._findTargets(this.selectors);if(this.swapSelectors){this.swapTargets=this._findTargets(this.swapSelectors)}var A=this.targets.length;log.info(A+" "+(A!=1?"targets":"target")+" found for HideReveal")},_findTargets:function(B){var A=[];B.each(function(C){if(this.parentClass){var E=this.element.getParentByClassName(this.parentClass);var F=E.getElementsBySelector(C);for(var D=0;F[D];D++){A.push(F[D])}}else{if(this.parentTag){var E=this.element.getParentByTagName(this.parentTag);var F=E.getElementsBySelector(C);for(var D=0;F[D];D++){A.push(F[D])}}else{var F=$$(C);for(var D=0;F[D];D++){A.push(F[D])}}}}.bind(this));return A},changeRadio:function(){var B=this.radioValue;var A,C;if(this.parentClass){ancestor=this.element.getParentByClassName(this.parentClass)}else{if(this.parentTag){ancestor=this.element.getParentByTagName(this.parentTag)}}if(ancestor){A=$A(ancestor.getElementsByClassName("radio"));A.each(function(E){var D=E.getElementsByTagName("input")[0];if(D.value==B){D.click()}})}},hide:function(A){for(var B=0;A[B];B++){A[B].hideByClass()}},show:function(A){for(var B=0;A[B];B++){A[B].showByClass()}},toggle:function(C){if(this.targets.length==0&&this.selectors.length>0){this.findTargets()}if(C){var B=Element.extend(Event.element(C));if(B.hasClassName("selected")){B.removeClassName("selected")}else{B.addClassName("selected")}if(this.hrType=="link"){Event.stop(C);this.updateContent()}if(this.removeOnEvent){this.element.remove()}}if(this.exclusive){if(this.currentState=="show"){this.hide(this.targets);if(this.swapTargets){this.show(this.swapTargets)}this.currentState="hide"}else{this.show(this.targets);if(this.swapTargets){this.hide(this.swapTargets)}this.currentState="show"}}else{for(var A=0;this.targets[A];A++){this.targets[A].toggleByClass()}}}});var HideRevealRadio=Class.create();HideRevealRadio.prototype={initialize:function(A){this.hrRadio=A;this.groupName=this.hrRadio.input.name;if(!Page.hideRevealRadios[this.groupName]){Page.hideRevealRadios[this.groupName]=[]}Event.observe(this.hrRadio.input,this.hrRadio.eventType,this.groupEvent.bindAsEventListener(this));Page.hideRevealRadios[this.groupName].push(this);if(this.hrRadio.input.checked){if(!this.hrRadio.input.defaultChecked){var C=Page.hideRevealRadios[this.groupName];for(var B=0;C[B];B++){if(C[B].hrRadio.input.defaultChecked){C[B].hrRadio.toggle()}C[B].checked=false}this.hrRadio.toggle()}this.checked=true}},groupEvent:function(C){var B=Event.element(C);if(this.checked){return}var D=Page.hideRevealRadios[this.groupName];for(var A=0;D[A];A++){if(D[A].checked){D[A].hrRadio.toggle(C)}D[A].checked=false}this.hrRadio.toggle(C);this.checked=true}};HideReveal.Progressive=Class.create();HideReveal.Progressive.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(A){if(!this.params.validIndices||!this.params.validIndices.length||this.params.currentIndex!=0&&this.params.currentIndex!=1||!this.params.expandSelectors||!this.params.expandLinks||!this.params.scopeClass||!this.params.linkClass){log.warning("HideReveal.Progressive.initExtend: exiting because required params missing or invalid");return}this.setIndex(this.params.currentIndex);this.createHideReveal(true);log.info("HideReveal.Progressive.initExtend has successfully completed")},setIndex:function(A){this.currentIndex=!isNaN(A)?A:this.getNextIndex();log.info("HideReveal.Progressive.currentIndex="+this.currentIndex)},getNextIndex:function(){var A=-1;for(var C=0;C<this.params.validIndices.length;C++){var B=parseInt(this.params.validIndices[C]);if(B>this.currentIndex){A=B;break}}return A},createLinkNode:function(){if(!this.linkNode){this.linkNode=this.element.appendChild(document.createElement("div"));this.linkNodeLink=this.linkNode.appendChild(document.createElement("span"));this.linkNodeLink.className="link "+this.params.linkClass;log.info("HideReveal.Progressive has created its link node")}},destroyLinkNode:function(){this.element.removeChild(this.linkNode);log.info("HideReveal.Progressive has destroyed its link node")},createHideReveal:function(A){if(A){this.createLinkNode()}if(this.getNextIndex()>=0){this.hideRevealLink=new HideReveal(this.linkNodeLink,{type:"HideReveal [inside HideReveal.Progressive]",eventType:"click",parentClass:this.params.scopeClass,selectors:"."+this.params.expandSelectors[this.getNextIndex()]});log.info("HideReveal.Progressive.hideRevealLink="+this.hideRevealLink);if(A){this.hideRevealLink.bindObserver(this.updateLink,this)}this.hideRevealLink.updateContent(this.params.expandLinks[this.currentIndex])}else{this.destroyLinkNode();log.info("HideReveal.Progressive has no hideRevealLink because index is out of bounds.")}},updateLink:function(){log.info("HideReveal.Progressive.updateLink called");log.info("type="+this.type);this.hideRevealLink.toggle();this.setIndex();this.createHideReveal()}});var HighlightContainerOnHover=Class.create(Abstract.Agent,{initExtend:function(){if(!this.params.parentClass){log.error("Invalid HighlightContainerOnHover params.");return}this.highlightClass="highlight";this.element.observe("mouseover",this.handleMouseOver.bind(this));this.element.observe("mouseout",this.handleMouseOut.bind(this))},initContainer:function(){if(!this.container){this.container=this.element.getParentByClassName(this.params.parentClass)}},handleMouseOver:function(){this.initContainer();if(this.container){this.container.addClassName(this.highlightClass)}},handleMouseOut:function(){this.initContainer();if(this.container){this.container.removeClassName(this.highlightClass)}}});var HotelRateCalendar=Class.create(Abstract.Agent,{initExtend:function(){var C=this.element;var G=false;var P;var A=this.params.checkInDiv;var L=this.params.checkOutDiv;var B=this.params.checkOutImg;var I=this.params.calendarMonthsAjaxUrl;var O;var K=this.params.targets;C.on("click",function(U){var V=U.findElement("td");if(!V||!V.hasClassName("active")){return}var W=V.readAttribute("data-date");var T;if(!G){T=0}else{if(W<=P.readAttribute("data-date")){T=0}else{T=1}}document.fire("calendar:selectDate",{selectedDate:W,dateInputIndex:T,clickedCell:V})});var M=function(T){if(C.descendantOf(document)){if(T.memo.dateInputIndex==0){Q(T)}else{D(T)}}else{document.stopObserving("calendar:selectDate",this.updateObserver)}};this.updateObserver=M.bind(this);document.observe("calendar:selectDate",this.updateObserver);var F=function(T){T.removeClassName("highlight");S(T)};var E={};for(i=0;i<K.length;i++){E[K[i]]=""}var H={message:E,requestor:this.element};var Q=function(X){var U=X.memo.selectedDate;var Z=X.memo.clickedCell;if(!Z||P){J().each(function(b){F(b);if(b.readAttribute("data-date")==U){Z=b}})}if(!Z){var Y=U.split("-");var a=Y[0]+"";var T=Y[1]+"";var W=I+"&hrcv.month="+T+"&hrcv.year="+a;var V=new Ajax.Request(W,{method:"get",onSuccess:(function(b){try{H.message=b.responseText.unescapeJSON().evalJSON();document.fire("content:update",H)}catch(c){document.fire("content:failure",H);log.error("ClickElementTrigger: Improper response from application for Element Updates");return}document.fire("calendar:selectDate",{selectedDate:U,dateInputIndex:0})}).bind(this),onFailure:(function(){document.fire("contentUpdate:failure",H);log.error("ClickUpdateTrigger: No response from application for Element Updates")}).bind(this)})}else{Z.addClassName("highlight");Z.insert({top:A});P=Z;G=true}};var D=function(T){var a=T.memo.selectedDate;if(a<=P.readAttribute("data-date")){return}var Z=T.memo.clickedCell;if(!Z){J().each(function(e){if(e.readAttribute("data-date")==a){Z=e}})}if(!Z){return}var W=Z.readAttribute("data-date");var d=J();var Y=C.down("div.checkOut");if(Y){var b=Y.up("td");var U=b.getAttribute("data-date");if(U>W){for(var X=0;d[X].readAttribute("data-date")<=U;X++){if(d[X].readAttribute("data-date")>W){S(d[X]);d[X].removeClassName("highlight")}}}else{S(b);b.removeClassName("highlight")}}var V=P.readAttribute("data-date");for(var X=0;d[X].readAttribute("data-date")<W;X++){if(d[X].readAttribute("data-date")>V){d[X].addClassName("highlight")}}Z.addClassName("highlight");Z.insert({top:L});var c=Z.down("span.priceText");if(c){c.hide();Z.insert({bottom:B})}G=false};var J=function(){return O||(O=C.select("td"))};var S=function(U){var T=U.down("span.priceText");if(T){T.show()}var W=U.down("div");if(W){W.remove()}var V=U.down("img");if(V){V.remove()}}}});var ClickElementUpdater=Class.create();ClickElementUpdater.prototype=Object.extend(new Abstract.Agent(),{lazy:true,initExtend:function(){if(this.params.intrastitialMessage){this.intrastitial=new Intrastitial(this.params.intrastitialMessage,$(this.element.up()),true)}document.observe("content:init",this.prepareUpdate.bindAsEventListener(this));document.observe("content:update",this.updateContent.bindAsEventListener(this));document.observe("content:failure",this.errorOnUpdate.bindAsEventListener(this))},beginWait:function(){document.body.style.cursor="wait";if(this.intrastitial){this.element.up().select(".select").each(function(A){A.setStyle({visibility:"hidden"})});this.intrastitial.show()}},endWait:function(){document.body.style.cursor="default";if(this.intrastitial){this.element.up().select(".select").each(function(A){A.setStyle({visibility:"visible"})});this.intrastitial.hide()}},prepareUpdate:function(A){if(this.params.sourceKey in A.memo.message){this.beginWait();this.alertTrigger(this.params.sourceKey,A.memo.requestor,"content:initComplete")}},updateContent:function(A){if(this.params.sourceKey in A.memo.message){try{this.element.update(A.memo.message[this.params.sourceKey]);Page.initializeDOMFragment(this.element)}catch(B){log.error("ClickElementUpdater: Error");Errors.capture(B)}this.alertTrigger(this.params.sourceKey,A.memo.requestor,"content:updateComplete");this.endWait()}},errorOnUpdate:function(A){if(this.params.sourceKey in A.memo.message){this.alertTrigger(this.params.sourceKey,A.memo.requestor,"content:updateFailure");this.endWait()}},alertTrigger:function(C,B,D){var E={};E[C]=D;var A={message:E,requestor:B};document.fire(D,A)}});var ClickElementTrigger=Class.create();ClickElementTrigger.prototype=Object.extend(new Abstract.Agent(),{lazy:true,initExtend:function(){this.ajaxUrl=this.params.ajaxUrl;this.ajaxUrlParams="";this.targets=this.params.targets;Event.observe(this.element,"click",this.handleEvent.bindAsEventListener(this))},handleEvent:function(B){B.preventDefault();this.targetStatus={};for(i=0;i<this.targets.length;i++){this.targetStatus[this.targets[i]]="content:init"}var A={message:this.targetStatus,requestor:this.element};document.fire("content:init",A);B.memo=A;this.retrieveContentAndUpdate(B)},retrieveContentAndUpdate:function(C){if(C.memo.requestor==this.element){var A={message:C.memo.message,requestor:C.memo.requestor};var B=new Ajax.Request(this.ajaxUrl,{method:"get",parameters:this.ajaxUrlParams,onSuccess:(function(D){try{A.message=D.responseText.unescapeJSON().evalJSON();document.fire("content:update",A)}catch(E){document.fire("content:failure",A);log.error("ClickElementTrigger: Improper AJAX response recieved from application")}}).bind(this),onFailure:(function(){document.fire("content:failure",A);log.error("ClickElementTrigger: No response from application for Element Updates")}).bind(this)})}}});var ChangeElementTrigger=Class.create(ClickElementTrigger,{initExtend:function(){this.dropDown=this.element.getElementsByTagName("select")[0];this.ajaxUrl=this.dropDown.form.action;this.targets=this.params.targets;Event.observe(this.dropDown,"change",this.handleEvent.bindAsEventListener(this))},handleEvent:function($super,A){this.ajaxUrlParams=$(this.dropDown.form).serialize();$super(A)}});var HotelRateCalendarTrigger=Class.create(ClickElementTrigger,{initExtend:function($super){$super();this.toggler={isActive:false,toggle:function(){this.isActive=!this.isActive;return this.isActive}};this.triggerWrapper=this.element.up(".viewRates");this.calendarContainer=this.triggerWrapper.up();document.observe("content:initComplete",this.updateTargetStatus.bindAsEventListener(this));document.observe("content:updateComplete",this.becomeAvailable.bind(this));document.observe("content:updateFailure",this.becomeAvailable.bind(this))},handleEvent:function(B){B.preventDefault();if(!this.busy){this.busy=true;this.targetStatus={};for(i=0;i<this.targets.length;i++){this.targetStatus[this.targets[i]]="content:init"}var A={message:this.targetStatus,requestor:this.element};if(this.toggler.toggle()){document.fire("content:init",A);document.fire("pullDown:show",A);this.triggerWrapper.addClassName("selected");this.calendarContainer.addClassName("displayHotelRateCalendar")}else{document.fire("pullDown:hide",A);this.triggerWrapper.removeClassName("selected");this.calendarContainer.removeClassName("displayHotelRateCalendar");this.becomeAvailable()}}},updateTargetStatus:function(B){var A=0;for(target in B.memo.message){this.targetStatus[target]=B.memo.message[target]}for(target in this.targetStatus){if(this.targetStatus[target]=="content:initComplete"){A++}}if(A==this.targets.length){this.retrieveContentAndUpdate(B)}},becomeAvailable:function(){this.busy=false}});var HotelReviewSubmit=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){if(!(this.params.bazaarvoiceApiUri||this.params.userAuthString||this.params.propertyId)){log.error("HotelReviewSubmit: Required field missing");return}this.showReviewForm()},configureDisplay:function(){if(this.params.promotionMarkup){var B=this.element,A=this.params.promotionMarkup;$BV.configure("rr",{onEvent:function(C){if(C.eventSource=="Display"){if(C.pageType=="Confirm"){var D=document.createElement("div");D.innerHTML=A;B.appendChild(D)}}}})}},showReviewForm:function(){if(window.$BV){var A=this.params.userAuthString,B=this.params.propertyId;this.configureDisplay();$BV.ui("rr","submit_review",{allowSamePageSubmission:true,userToken:A,productId:B,onEvent:function(C){if(C.eventSource=="Action"){if(C.eType=="Write"||C.eType=="Support"){document.fire("webtrends:multiTrackEvent",{"WT.ti":"Form:"+C.formAction.toLowerCase()+" link","WT.dl":"1"})}}else{if(C.eventSource=="Display"){if(C.pageType=="Confirm"){document.fire("webtrends:multiTrackEvent",{"WT.ti":"Form:submit successful","WT.dl":"0"})}window.onbeforeunload=function(){document.fire("webtrends:multiTrackEvent",{"WT.ti":"Form:"+C.pageType.toLowerCase()+" close","WT.dl":"1"});return}.bind(this);if(C.pageStatus=="validationError"){document.fire("webtrends:multiTrackEvent",{"WT.ti":"Form:input error","WT.dl":"0"})}}}}})}else{BazaarvoiceAPILoader.load(this.params.bazaarvoiceApiUri,this.showReviewForm.bind(this))}}});var HotelReviewTab=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){if(!(this.params.bazaarvoiceApiUri||this.params.hotelId)){log.error("HotelReviewTab: Required field missing");return}if(window.$BV){this.configureTabDisplay();this.showReviews()}else{BazaarvoiceAPILoader.load(this.params.bazaarvoiceApiUri,function(){this.configureTabDisplay();this.showReviews()}.bind(this))}},configureTabDisplay:function(){if(window.$BV){$BV.configure("global",{submissionContainerUrl:"/trips/writeReview?hid="+this.params.hotelId,messageContainerUrl:"/info/win?id=ReviewCount&locale="+this.params.locale,doLogin:function(A,B){return false},onEvent:function(A){if(A.eventSource=="Action"&&A.eType=="Write"){window.open(this.submissionContainerUrl,PopupWindow.FullSizeNoToolBar.prototype.windowName,PopupWindow.FullSizeNoToolBar.prototype.windowProps)}if(A.eventSource=="Action"&&A.eType=="Read"&&A.eName=="ReadAll"){window.open(this.messageContainerUrl,PopupWindow.FullSizeNoToolBar.prototype.windowName,PopupWindow.FullSizeNoToolBar.prototype.windowProps)}}})}},showReviews:function(){var A=this.params.hotelId;$BV.ui("rr","show_reviews",{productId:A})}});var HotelFormMboxTracking=Class.create(Abstract.Agent,{initExtend:function(){var A=this.element;var B="349";A.on("click",function(C){if(window.mboxUpdate){mboxUpdate(B,"AdditionalOptionsClicked=true")}})}});var HotelXSellOnPC=Class.create();HotelXSellOnPC.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.element.on("click","a[href]",function(B){this.element.fire("webtrends:multiTrackEvent",{"DCSext.xsellpp":"HOT"})}.bind(this));var A=this.element.down("div.hideFromNonJS");new Ajax.Request(this.params.searchUrl,{method:"get",onCreate:(function(B){this.mostRecentRequest=B.transport}).bind(this),onSuccess:(function(C){if(C.transport==this.mostRecentRequest){var B=$(document.createElement("DIV"));B.innerHTML=C.responseText;if(B.select(".multiNodeUpdate .hotelResults").length>0){B.select("a[href]").each(function(D){D.setAttribute("target","_blank")});Page.initializeDOMFragment(B);this.mostRecentRequest=null}else{this.element.remove()}}}).bind(this),onFailure:(function(B){if(B.transport==this.mostRecentRequest){this.mostRecentRequest=null;this.element.remove()}}).bind(this)})}});var HPCDriverOptionToggle=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){if(this.params.switchTo==="select"){Event.observe(this.element,"click",this.pickFromTravellers.bindAsEventListener(this))}else{if(this.params.switchTo==="text"){Event.observe(this.element,"click",this.nameAsText.bindAsEventListener(this))}else{log.error("HPCDriverOptionToggle.initExtend: can't initialize, unrecognized mode")}}},findTargetElements:function(){if(this.textModeWrapper&&this.pickModeWrapper&&this.defaultModeWrapper){return true}else{this.textModeWrapper=$$(".hpcDriverTextMode")[0];this.selectModeWrapper=$$(".hpcDriverSelectMode")[0];this.defaultModeWrapper=$$(".hpcDriverDefaultMode")[0];if(this.textModeWrapper&&this.selectModeWrapper&&this.defaultModeWrapper){return true}else{log.error("HPCDriverOptionToggle.findTargetElements: not all target elements could be found");return false}}},pickFromTravellers:function(){if(this.findTargetElements()){this.defaultModeWrapper.hideByClass();this.textModeWrapper.hideByClass();this.selectModeWrapper.showByClass();this.textModeWrapper.select("input[type=radio]")[0].checked=false;this.selectModeWrapper.select("input[type=radio]")[0].checked=true}return false},nameAsText:function(){if(this.findTargetElements()){this.defaultModeWrapper.hideByClass();this.textModeWrapper.showByClass();this.selectModeWrapper.hideByClass();this.textModeWrapper.select("input[type=radio]")[0].checked=true;this.selectModeWrapper.select("input[type=radio]")[0].checked=false}return false}});var Interstitial=Class.create(Abstract.Agent,{interstitialResponseTimeout:2000,interstitialAssetsTimeout:2000,url:"/helper/interstitial",initExtend:function(){var A=this.element.tagName;if(A==="INPUT"){Event.observe(this.element,"click",function(){Event.observe(this.element.form,"submit",this.requestFormInterstitial.bind(this))}.bind(this))}else{if(A==="A"){Event.observe(this.element,"click",this.requestLinkInterstitial.bindAsEventListener(this))}else{if(A==="TABLE"||A==="TBODY"){this.element.on("click","td",this.requestTableInterstitial.bind(this))}else{log.warning("Interstitial: tried to initialize, but failed on element.tagName")}}}},requestFormInterstitial:function(B){Form.HiddenField.add(this.element.form,this.element.name,this.element.value);var A=Form.serialize(this.element.form);this.action=function(){log.debug("Interstitial: submitting form");this.element.form.submit()}.bind(this);this.getInterstitial(A.deleteQueryStringParam("execution"));B.preventDefault()},requestLinkInterstitial:function(A){if(this.element&&this.element.href){var B=this.element.href.split("?")[1]||"";this.action=function(){log.debug("Interstitial: following link");window.location=this.element.href}.bind(this);this.getInterstitial(B.deleteQueryStringParam("execution"));A.preventDefault()}else{log.info("Interstitial: invalid or missing link element");return}},requestTableInterstitial:function(B,A){this.element=A.down("a");this.requestLinkInterstitial(B)},getInterstitial:function(D){var A=setTimeout(this.action,this.interstitialResponseTimeout);Event.observe(window,"pageshow",function(E){if(E.persisted){this.hideInterstitial()}}.bind(this));var C=new Ajax.Request(this.url,{parameters:D,onSuccess:this.showInterstitial.bind(this,A)});this.hiddenElements=$(document.body).childElements();this.hiddenElements.invoke("hide");var B=$(this.params.targetParent?window.parent.document.body:document.body);B.addClassName("interstitial")},showInterstitial:function(C,F){clearTimeout(C);if(F.responseText.indexOf('status:"failed"')>-1){return}else{var E=this.content=$(document.createElement("div"));E.innerHTML=F.responseText;document.body.appendChild(E);Page.initializeDOMFragment(E)}var B=E.getElementsByTagName("IFRAME");if(B.length>0){var D=B[0];var A=function(){if(!D.contentWindow.adLoaded||!D.contentWindow.resized){window.setTimeout(A.bind(this),50)}else{log.debug("Interstitial: advert loaded and resized");window.clearTimeout(this.advertTimeout);this.action()}};this.advertTimeout=setTimeout(this.action,this.interstitialAssetsTimeout);A.call(this)}else{this.action()}},hideInterstitial:function(){document.body.removeClassName("interstitial");this.content.remove().purge();this.hiddenElements.invoke("show");this.hiddenElements=null}});var StreamingInterstitial=Class.create(Interstitial,{requestFormInterstitial:function($super,C){var A=this.element;var B=A.form.elements["ar.rt.flexAirSearch"];if(B.checked){$super(C)}else{A.addClassName("disabled")}}});var Intrastitial=Class.create();Intrastitial.prototype={initialize:function(C,B,A){if(arguments.length>=2){this.targetElement=B;this.mask=new Element("div",{"class":"resultsIntrastitial"});this.messageDiv=new Element("div",{"class":"message"});this.messageDiv.innerHTML=C;this.disableCenterInViewport=A;this.hide();this.mask.appendChild(this.messageDiv);this.targetElement.appendChild(this.mask);Page.initializeDOMFragment(this.messageDiv,true)}else{log.error("Intrastitial.initialize: too few arguments!")}},show:function(){if(this.mask){this.resize();this.mask.show()}},resize:function(){var A=this.targetElement.getDimensions();this.mask.setStyle({width:A.width+"px",height:A.height+"px"});if(!this.disableCenterInViewport&&this.messageDiv){this.messageDiv.style.position="relative";this.messageDiv.style.left="25%";this.messageDiv.style.width="50%";this.messageDiv.style.top=((document.viewport.getHeight()/2)-(this.messageDiv.getDimensions().height/2))-this.targetElement.viewportOffset().top+"px"}},hide:function(){if(this.mask){this.mask.hide()}},destroy:function(){if(this.mask){this.mask.remove()}}};var JumpList=Class.create();JumpList.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(window.msPerformance===undefined||!window.external.msIsSiteMode()){log.info("failed tests, window.msPerformance: "+window.msPerformance+" | window.external.msIsSiteMode(): "+window.external.msIsSiteMode());return}var A=this.params.listHeader||null;if(!A){log.error("JumpList: No 'listHeader' parameter was passed to agent");return}var C=this.params.jumpListItems||null;if(!C||typeof C!="object"){log.error("JumpList: No 'jumpListItems' parameter was passed to agent or jumpListItems is not an object");return}window.external.msSiteModeClearJumplist();window.external.msSiteModeCreateJumplist(A);for(var B=C.length-1;B>=0;B--){window.external.msSiteModeAddJumpListItem(C[B].text,C[B].link,C[B].icon);log.info("added a jump list item - "+C[B].text+" - "+C[B].link+" - "+C[B].icon)}window.external.msSiteModeShowJumplist()}});var LazyLoader=Class.create();LazyLoader.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){var A=(this.params.url)?this.params.url:null;if(!A){log.error("LazyLoader: No 'url' parameter was passed to agent");return}var B=(this.params.filetype)?this.params.filetype.toUpperCase():null;if(!B){log.error("LazyLoader: No 'filetype' parameter was passed to agent");return}var C=function(){switch(B){case"JS":var D=document.createElement("script");D.type="text/javascript";D.src=document.location.protocol+"//"+A;document.getElementsByTagName("head")[0].appendChild(D);break;case"CSS":var D=document.createElement("link");D.type="text/css";D.rel="stylesheet";D.media=(this.params.media)?this.params.media.toLowerCase():"all";D.href=document.location.protocol+"//"+A;document.getElementsByTagName("head")[0].appendChild(D);break;default:log.warning("&lt;"+B+"&gt; file not supported in LazyLoader agent.");log.info("Please edit LazyLoader.initExtend if you wish to implement lazy loading functionality for this file type.");break}};if(Page.onLoadFired){C()}else{Event.observe(window,"load",C.bind(this))}}});var LightboxAgent=Class.create();LightboxAgent.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initialize:function(A,B){Object.extend(this,B);this.element=Element.extend(A);this.dialogObject=new Lightbox([this.element],B.params.content,B.params.options)}});var LinkAddParam=Class.create(Abstract.Agent,{initExtend:function(){var B=this.element.readAttribute("href");var C=B.split("?");var A=this.params.qsParams;if(C.size()>1){var A=C[1].replace(/\+/g," ").toQueryParams();Object.extend(A,this.params.qsParams)}this.element.writeAttribute("href",C[0]+"?"+Object.toQueryString(A))}});var SimulateLocationFilterSelection=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){var A=this.element;document.stopObserving("map:locationLabelClicked");document.observe("map:locationLabelClicked",this.selectLocationFilter.bind(this));function B(C){if(/^(input||a||img)$/.test(C.findElement().tagName.toLowerCase())){document.fire("agent:locationFilterClicked");A.stopObserving("click",B)}}A.stopObserving("click",B);A.observe("click",B)},selectLocationFilter:function(B){if(B.memo.filterType&&B.memo.filterType==="checkbox"){var C=this.element.select("input[value="+B.memo.locId+"]")[0];if(C&&!C.checked){C.checked=true;C.fire("agent:filter")}}else{var A=this.element.select("a[href="+B.memo.searchUrl+"]")[0];if(A){A.fire("agent:filter",{url:B.memo.searchUrl})}}B.stopPropagation()}});var LoyaltyProgram=Class.create();LoyaltyProgram.prototype={initialize:function(A){this.containerElement=A;this.isVisible=A.visibleByClass();if(this.isVisible){this.completeInitialization()}},completeInitialization:function(){var C=this.containerElement.getElementsByTagName("label");this.clearableFields=$A();for(var B=0;B<C.length;B++){var A=C[B].getElementsByTagName("input")[0];if(A==null){A=C[B].getElementsByTagName("select")[0]}if(A){this.clearableFields.push(A)}}this.deleteLink=this.containerElement.getLastElementByClassName("deleteProgram","span");Event.observe(this.deleteLink,"click",this.deleteProgram.bindAsEventListener(this))},addProgram:function(){this.containerElement.showByClass();this.completeInitialization()},deleteProgram:function(){this.clearableFields.each(function(B){B.value="";if(document.fireEvent){B.fireEvent("onchange")}else{var A=document.createEvent("HTMLEvents");A.initEvent("change",true,true);B.dispatchEvent(A)}});this.containerElement.hideByClass()}};var LoyaltyPrograms=Class.create();LoyaltyPrograms.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.loyaltyPrograms=$A();this.nextAvailableLoyaltyProgram=0;var A=this.element.getElementsByTagAndClass("div","loyaltyProgram");for(var B=0;B<A.length;B++){var C=new LoyaltyProgram(A[B]);if(C.isVisible){this.nextAvailableLoyaltyProgram++}this.loyaltyPrograms.push(C)}this.numLoyaltyPrograms=this.loyaltyPrograms.length;this.addProgramLink=this.element.getLastElementByClassName("addProgramLink","p");Event.observe(this.addProgramLink,"click",this.addAnotherProgram.bindAsEventListener(this))},addAnotherProgram:function(){if(this.nextAvailableLoyaltyProgram<this.loyaltyPrograms.length){this.loyaltyPrograms[this.nextAvailableLoyaltyProgram].addProgram();this.nextAvailableLoyaltyProgram++;if(this.nextAvailableLoyaltyProgram>=this.loyaltyPrograms.length){this.addProgramLink.remove()}}else{log.error("no more to show")}}});var HpcHotelMarkerToolTip={populateToolTip:function(A){HotelMarkerToolTip.populateToolTip.call(this,A)}};var HpcHotelMapInfoWindow={setHeader:function(D){var B=D.resultCardElement;this.markup.dialogTitle.innerHTML="";var A=new Element("h3");var E=B.down("a.hotelNameLink");if(E){this.addWebTrendsEventListener(A.appendChild(E.cloneNode(true)),"Hotel name");A.insert({bottom:D.productPlusText});this.markup.dialogTitle.appendChild(A)}var C=B.down("img.stars");if(C){this.markup.dialogTitle.appendChild(C.cloneNode(true))}Page.initializeDOMFragment(this.markup.dialogTitle)},populateInfoWindow:function(H){var F=H.resultCardElement;var I=new Element("div",{className:"infoWindowContent"});var E=new Element("div",{className:"price"});this.markup.mainInfo.innerHTML="";var D=F.down("a.thumbnail");if(D){this.addWebTrendsEventListener(this.markup.mainInfo.appendChild(D.cloneNode(true)),"Hotel photo")}var C=F.down("div.priceAndDisclaimers");var K=$(C.cloneNode(true));E.appendChild(K);I.appendChild(E);var A=F.down(".hotelUserRatingsSummary");if(A){I.appendChild(A.cloneNode(true))}var J=new Element("UL",{"class":"pipedList"});var G=F.down("a.detailsLink");if(G){this.addWebTrendsEventListener(J.appendChild(new Element("LI").update(G.cloneNode(true))),"More hotel details")}I.appendChild(J);this.markup.mainInfo.appendChild(I);var B=F.down(".priceButtonLink");B=this.addWebTrendsEventListener(this.markup.mainInfo.appendChild(B.cloneNode(true)),(H.rate)?"Select":"Check rates");this.markup.mainInfo.descendants().each(function(L){L.removeAttribute("id")});Page.initializeDOMFragment(this.markup.mainInfo);GoogleMapUtil.getStreetView(this.getPosition(),this.enableStreetview.bind(this))}};var HpcCarMarkerToolTip={populateToolTip:function(A){var B=((A.vendorName)?'<strong class="name">'+A.vendorName+"</strong>":"")+"<span>"+A.carLocation+"</span>";this.overlay.update(B)}};var HpcCarMapInfoWindow={setHeader:function(C){this.markup.dialogTitle.innerHTML="";var D=C.resultCardElement;var B=D.down("div.summary").down("div.data");var E=B.down("div.brand");var A=new Element("div",{className:"carLocation"});A.innerHTML=C.carLocation;this.markup.dialogTitle.appendChild(E.cloneNode(true));this.markup.dialogTitle.appendChild(A)},populateInfoWindow:function(D){var E=D.resultCardElement;var A=new Element("div",{className:"infoWindowContent"});this.markup.mainInfo.innerHTML="";var C=E.down("div.imageColumn");var B=E.down("div.summary").down("div.data");this.markup.mainInfo.appendChild(C.cloneNode(true));this.markup.mainInfo.appendChild(B.cloneNode(true));this.markup.mainInfo.down("div.brand").remove();this.markup.mainInfo.down("li.inclusionExclusion").remove()}};var PkgMarkerToolTip={populateToolTip:function(A){if(!A.name){A.name=A.resultCardElement.down("p.hotelName").down("a").innerHTML}var B='<strong class="name">'+A.name+"</strong>"+((A.stars)?'<img class="stars" src="/style/global/img/star'+A.stars+'.png" alt="'+A.stars+' stars" height="13" width="70" />':"")+((A.rating)?'<span class="pkgRating">'+A.rating+"</span>":"");this.overlay.update(B)}};var PkgMapInfoWindow={setHeader:function(D){var B=D.resultCardElement;this.markup.dialogTitle.innerHTML="";var A=new Element("h3");var E=B.down("p.hotelName").down("a");if(E){this.addWebTrendsEventListener(A.appendChild(E.cloneNode(true)),"Hotel name");A.insert({bottom:D.productPlusText});this.markup.dialogTitle.appendChild(A)}var C=B.down("img.stars");if(C){this.markup.dialogTitle.appendChild(C.cloneNode(true))}Page.initializeDOMFragment(this.markup.dialogTitle)},populateInfoWindow:function(H){var A=H.resultCardElement;var D=new Element("div",{className:"infoWindowContent"});var E=new Element("div",{className:"price"});this.markup.mainInfo.innerHTML="";var G=A.down(".hotelThumb").addClassName("thumbnail");if(G){this.markup.mainInfo.appendChild(G.cloneNode(true))}var C=A.down(".hotelUserRatingsSummary").addClassName("pkgRating");if(C){D.appendChild(C.cloneNode(true))}var B=new Element("UL",{"class":"pipedList"});var F=H.detailsLink;if(F){this.addWebTrendsEventListener(B.appendChild(new Element("LI").update(F)),"More hotel details")}D.appendChild(B);this.markup.mainInfo.appendChild(D);this.markup.mainInfo.descendants().each(function(I){I.removeAttribute("id")});Page.initializeDOMFragment(this.markup.mainInfo);GoogleMapUtil.getStreetView(this.getPosition(),this.enableStreetview.bind(this))}};var SimpleResultSetMap=Class.create(Abstract.Agent,MapResultSetBase,{beforeDOMReady:true,initExtend:function(){this.commonInit();this.createMapMarkup();this.load()},createMapMarkup:function(){this.element.addClassName("bigResultsMapModule");this.headerWrapper=new Element("DIV",{className:"mapHeader"});this.element.appendChild(this.headerWrapper);this.mapElement=new Element("DIV",{className:"resultsMap bigResultsMapContainer"});this.element.appendChild(this.mapElement);this.mapElement.style.backgroundImage="url("+this.params.staticMap+")";if(!this.pi){this.pi=new ProgressIndicator(this.mapElement)}},mapLoadCallback:function(){google.maps.event.addDomListener(window,"unload",this.onUnload.bind(this));var B=this;this.infoWindowVisible=false;this.streetViewVisible=false;if(this.pi){this.pi.spinnerElement.remove()}var C=new google.maps.Map(this.mapElement,{panControl:true,scaleControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE},streetViewControl:false,scrollwheel:false});document.observe("agent:resultsUpdated",function(){this.resetMap();this.setMapMarkers(this.getMainMarkerData());this.handleCloseZoom();this.map.fitBounds(this.bounds)}.bind(this));this.infoWindowData=this.params.infoWindowData;this.datedSearch=this.params.datedSearch;this.map=C;var A=this.getMainMarkerData(true);this.setMapMarkers(A,this.markerLimit);C.setMapTypeId(google.maps.MapTypeId.ROADMAP);this.handleCloseZoom();this.map.fitBounds(this.bounds);google.maps.event.addListener(C,"zoom_changed",function(){if(this.infoWindowVisible){this.infoWindow.close()}if(this.tooltip){this.tooltip.close()}}.bind(this))},setMapMarkers:function(markerData,limit){if(this.markers){this.clearMapMarkers()}var bounds=new google.maps.LatLngBounds();var markers=[];var currentMarkers=[];var data=[];var marker;if(limit){for(var i=0;i<markerData.length;i++){if(currentMarkers.length<limit){var datum=markerData[i];var markerLatLng=new google.maps.LatLng(datum.lat,datum.lng);if(!bounds.contains(markerLatLng)){continue}currentMarkers.push(markerData[i])}else{break}}}else{currentMarkers=markerData}for(var i=currentMarkers.length;i--;){var datum=currentMarkers[i];var markerOptions={position:new google.maps.LatLng(datum.lat,datum.lng),type:datum.type,map:this.map,label:datum.label};datum.tooltip=eval(datum.type+"MarkerToolTip");datum.infoWindow=eval(datum.type+"MapInfoWindow");markerOptions.currentPage=datum.currentPage;if(datum.isFeatured){markerOptions.classes="featured"}marker=new MapMarker(markerOptions);datum.datedSearch=this.datedSearch;marker.id=i;if(markerOptions.currentPage){bounds.extend(marker.getPosition());google.maps.event.addListener(marker,"click",this.markerClick.bind(this,marker,true));google.maps.event.addListenerOnce(marker,"click",this.markerVisited.bind(this,marker))}google.maps.event.addListener(marker,"mouseover",this.markerMouseover.bind(this,marker));google.maps.event.addListener(marker,"mouseout",this.markerMouseout.bind(this,marker));markers[i]=marker;data[i]=datum}this.bounds=bounds;this.markers=markers;this.data=data}});var ResizeableResultSetMap=Class.create(SimpleResultSetMap,{beforeDOMReady:true,initExtend:function(){this.commonInit();this.mapState=(this.params.initialMapState?this.params.initialMapState:"wee");this.checkPersist();this.createInitialMapMarkup();this.load()},toggleMapState:function(){this.mapState=(this.mapState==="wee"?"big":"wee")},checkPersist:function(){if(Persist){var A=this.mapData=Persist.get("ResizeableResultSetMapAgent",true);if(A){if(A.searchKey==this.params.searchKey){if(A.mapState==="big"){this.persistMapDetails=function(){return/showDetails=true/.test(document.referrer)}();this.mapState=A.mapState}}}}},createInitialMapMarkup:function(){if(this.mapState==="big"){this.createBigMapModuleMarkup();this.createBigMapContainerMarkup();this.createToggleSizeLink();this.mapElement=this.bigResultsMapContainer}else{this.createWeeMapModuleMarkup();this.createWeeMapContainerMarkup();this.createToggleSizeLink();this.mapElement=this.weeResultsMapContainer}if(!this.pi){this.pi=new ProgressIndicator(this.mapElement)}},createWeeMapModuleMarkup:function(){this.weeMapModuleContainer=new Element("DIV",{className:"weeResultsMapModule","data-context":"hotelMap"});$$(this.params.weeMapModuleContainerSelector)[0].insert({top:this.weeMapModuleContainer});this.weeMapHeader=new Element("DIV",{className:"mapHeader"});this.weeMapModuleContainer.appendChild(this.weeMapHeader);var A=new Element("H3",{className:"mapLabel"});A.appendChild(document.createTextNode(this.params.weeMapHeading));this.weeMapHeader.appendChild(A)},createWeeMapContainerMarkup:function(){this.weeResultsMapContainer=new Element("DIV",{className:"resultsMap weeResultsMapContainer","data-context":"hotelMapMap"});this.weeResultsMapContainer.style.backgroundImage="url("+this.params.weeStaticMap+")";this.weeMapModuleContainer.appendChild(this.weeResultsMapContainer)},createBigMapModuleMarkup:function(){this.element.addClassName("bigResultsMapModule");this.headerWrapper=new Element("DIV",{className:"mapHeader"});this.element.appendChild(this.headerWrapper);this.bigMapHeader=this.element.down("div.mapHeader")},createBigMapContainerMarkup:function(){this.element.style.position="relative";this.bigResultsMapContainer=new Element("DIV",{className:"resultsMap bigResultsMapContainer"});this.element.appendChild(this.bigResultsMapContainer);this.bigResultsMapContainer.style.backgroundImage="url("+this.params.staticMap+")"},mapLoadCallback:function(){google.maps.event.addDomListener(window,"unload",this.onUnload.bind(this));var C=this;this.infoWindowVisible=false;this.streetViewVisible=false;if(this.pi){this.pi.spinnerElement.remove()}this.element.style.position="relative";var E=new google.maps.Map(this.mapElement,{panControl:true,scaleControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},streetViewControl:false,scrollwheel:false});document.observe("agent:resultsUpdated",function(){this.resetMap();this.setMapMarkers(this.getMainMarkerData());this.handleCloseZoom();this.map.fitBounds(this.bounds)}.bind(this));this.infoWindowData=this.params.infoWindowData;this.datedSearch=this.params.datedSearch;this.map=E;this.setMapOptions[this.mapState].call(this);var B=this.getMainMarkerData(true);this.setMapMarkers(B,this.markerLimit);if(this.persistMapDetails){var D=this.mapData;E.setMapTypeId(D.mapType);E.setCenter(new google.maps.LatLng(D.position.lat,D.position.lng));E.setZoom(D.zoom);if(D.activeId){var A=this.getMapMarker(D.activeId);if(A){google.maps.event.addListener(A,"domready",this.markerClick.bind(this,A,false))}}}else{E.setMapTypeId(google.maps.MapTypeId.ROADMAP);this.handleCloseZoom();this.map.fitBounds(this.bounds)}google.maps.event.addListener(E,"zoom_changed",function(){if(this.infoWindowVisible){this.infoWindow.close()}if(this.tooltip){this.tooltip.close()}}.bind(this))},createToggleSizeLink:function(){var B=(this.mapState==="big"?this.bigMapHeader:this.weeMapHeader);var A=B.appendChild(new Element("A",{className:"mapLink",id:"mapToggleSize",href:"javascript:void(0);",delegatedtracking:"true"}));A.appendChild(document.createTextNode(this.params.linkText[this.mapState]));if(this.mapState==="big"){A.observe("click",this.toggleDynamicMapSize.bind(this))}else{this.weeMapModuleContainer.observe("click",this.toggleDynamicMapSize.bind(this))}},toggleDynamicMapSize:function(){this.toggleMapState();this.setMapOptions[this.mapState].call(this);var A=$("mapToggleSize");A.removeChild($("mapToggleSize").firstChild);A.appendChild(document.createTextNode(this.params.linkText[this.mapState]));if(this.mapState==="big"){if(this.weeMapModuleContainer){this.weeMapModuleContainer.stopObserving("click");this.weeMapModuleContainer.addClassName("noneBlock");this.mapElement.removeClassName("weeResultsMapContainer").addClassName("bigResultsMapContainer")}if(this.bigMapHeader){this.element.removeClassName("noneBlock")}else{this.createBigMapModuleMarkup()}this.element.appendChild(this.mapElement);this.mapElement.style.backgroundImage="url("+this.params.staticMap+")";this.bigMapHeader.appendChild(A);A.observe("click",this.toggleDynamicMapSize.bind(this))}else{if(this.bigMapHeader){A.stopObserving("click");this.element.addClassName("noneBlock");this.mapElement.removeClassName("bigResultsMapContainer").addClassName("weeResultsMapContainer")}if(this.weeMapHeader){this.weeMapModuleContainer.removeClassName("noneBlock")}else{this.createWeeMapModuleMarkup()}this.weeMapModuleContainer.appendChild(this.mapElement);this.mapElement.style.backgroundImage="url("+this.params.weeStaticMap+")";this.weeMapHeader.appendChild(A);this.weeMapModuleContainer.observe("click",this.toggleDynamicMapSize.bind(this))}this.fireWebtrendsToggleSizeEvent();this.mapResizeHelper()},mapResizeHelper:function(){google.maps.event.trigger(this.map,"resize");this.map.fitBounds(this.bounds)},setMapOptions:{wee:function(){this.resetMap();this.map.setOptions({disableDefaultUI:true,disableDoubleClickZoom:true,draggable:false,keyboardShortcuts:false,mapTypeControl:false,panControl:false,zoomControl:false,scaleControl:false,scrollwheel:false,mapTypeId:google.maps.MapTypeId.ROADMAP})},big:function(){this.map.setOptions({disableDefaultUI:false,disableDoubleClickZoom:false,draggable:true,keyboardShortcuts:true,mapTypeControl:true,panControl:false,zoomControl:true,minZoom:6,scaleControl:true,scrollwheel:false})}},onUnload:function(){var A=this.map.getCenter();var B;if(this.infoWindowVisible){B=this.data[this.getInfoWindow().marker.id].id}if(Persist){var C={searchKey:this.params.searchKey,mapState:this.mapState,zoom:this.map.getZoom(),position:{lat:A.lat(),lng:A.lng()},mapType:this.map.getMapTypeId(),activeId:B};Persist.set("ResizeableResultSetMapAgent",C,true)}if(this.infoWindow){this.infoWindow.destroy()}if(this.tooltip){this.tooltip.destroy()}this.clearMapMarkers()},markerClick:function(B,A){if(this.mapState=="wee"||this.disableInfoWindow){return false}var C=this.data[B.id];this.getInfoWindow().open(B,C);B.overlay.addClassName("mapMarkerCurrent");if(this.tooltip){this.getMarkerTooltip().close()}if(A){this.fireWebTrendsEvent(C.type+" pin",this.params.locationId)}},markerMouseover:function(A){if(this.mapState=="wee"){return false}var B=this.data[A.id];A.overlay.addClassName("mapMarkerHover");if(this.getMarkerTooltip()){this.getMarkerTooltip().open(A,B)}},markerMouseout:function(A){if(this.mapState=="wee"){return false}A.overlay.removeClassName("mapMarkerHover");if(this.tooltip){this.getMarkerTooltip().close()}},fireWebtrendsToggleSizeEvent:function(){var A=(this.mapState==="wee"?"collapsed":"expanded");this.fireWebTrendsEvent(A+" map",this.params.locationId)}});var DestinationExplorerResultSetMap=Class.create(ResizeableResultSetMap,{beforeDOMReady:true,initExtend:function(){this.commonInit();this.mapState=(this.params.initialMapState?this.params.initialMapState:"wee");this.mboxId="HOTEL200_DestinationExplorer";this.markerLimit=this.params.markerLimit;this.weeMapMarkerLimit=5;this.markerLevel=(this.params.markerLevel&&!(this.mapState=="wee")?this.params.markerLevel:"property");this.toggleLocationPropertyMarkers=(this.params.toggleLocationPropertyMarkers?this.params.toggleLocationPropertyMarkers:true);this.locationViewDefault=(this.params.locationViewDefault?this.params.locationViewDefault:false);this.locationLabelsWithPrices=(this.params.locationLabelsWithPrices?this.params.locationLabelsWithPrices:false);this.checkPersist();this.createInitialMapMarkup();this.load()},checkPersist:function(){if(Persist){var A=this.mapData=Persist.get("DestinationExplorerResultSetMapAgent",true);if(A){if(A.searchKey==this.params.searchKey){if(A.mapState==="big"){this.persistMapDetails=function(){return/showDetails=true/.test(document.referrer)}();this.mapState=A.mapState;this.markerLevel=A.markerLevel;this.zoomLevelToShowLocations=A.zoomLevelToShowLocations}}}}},mapLoadCallback:function(){google.maps.event.addDomListener(window,"unload",this.onUnload.bind(this));var A=this;this.infoWindowVisible=false;this.streetViewVisible=false;if(this.pi){this.pi.spinnerElement.remove()}this.element.style.position="relative";var B=new google.maps.Map(this.mapElement,{panControl:true,scaleControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},streetViewControl:false,scrollwheel:false});document.observe("agent:resultsUpdated",function(){google.maps.event.trigger(B,"resultsUpdated");this.propertyMarkerData=null;this.updateMapData();this.resetMap();this.clearMapMarkers();this.setInitialMarkerLevel();this.map.fitBounds(new google.maps.LatLngBounds());this.loadMarkers(function(){google.maps.event.trigger(this.map,"resize");this.setZoomAndCenter()}.bind(this))}.bind(this));this.infoWindowData=this.params.infoWindowData;this.datedSearch=this.params.datedSearch;this.map=B;this.setMapOptions[this.mapState].call(this);if(!this.markerLevel||!this.locationViewDefault){this.setInitialMarkerLevel()}this.loadMarkers(this.postInitialMapLoad.bind(this))},postInitialMapLoad:function(){var C=this.map;if(this.persistMapDetails){var B=this.mapData;C.setMapTypeId(B.mapType);C.setCenter(new google.maps.LatLng(B.position.lat,B.position.lng));C.setZoom(B.zoom);this.prevZoomLevel=B.zoom;if(B.activeId){var A=this.getMapMarker(B.activeId);if(A){google.maps.event.addListener(A,"domready",this.markerClick.bind(this,A,false))}}}else{C.setMapTypeId(google.maps.MapTypeId.ROADMAP);this.setZoomAndCenter()}google.maps.event.addListener(C,"zoom_changed",function(){if(this.infoWindowVisible){this.infoWindow.close()}if(this.tooltip){this.tooltip.close()}}.bind(this));this.setMarkerLevelListeners();GoogleMapControls.OutlierControl(this);if(window.mboxFactoryDefault&&mboxFactoryDefault.get(this.mboxId)){this.setMBoxListeners()}},updateMapData:function(){var A=document.getElementById("mapInfo").getAttribute("data-map-data").evalJSON();if(this.params.outlierAjaxURL){this.params.outlierAjaxURL=A.outlierAjaxURL}this.params.detailsLinkTemplate=A.detailsLinkTemplate;this.params.zoomLevel=A.zoomLevel;this.params.lat=A.lat;this.params.lng=A.lng;this.locationViewDefault=A.locationViewDefault},setInitialMarkerLevel:function(){if(this.toggleLocationPropertyMarkers&&this.getShowLocationLabelsFlag()&&this.locationViewDefault&&this.mapState!=="wee"){this.markerLevel="location"}else{this.markerLevel="property"}},getMarkerLimit:function(){return(this.mapState==="wee")?this.weeMapMarkerLimit:this.markerLimit},loadMarkers:function(E){var E=E||function(){};if(this.idleListener){google.maps.event.removeListener(this.idleListener);delete this.idleListener}if(this.boundsListener){google.maps.event.removeListener(this.boundsListener);delete this.boundsListener}if(this.markerLevel==="location"){if(this.locationLabelData){this.setLocationMarkers(this.locationLabelData);E()}else{this.getLocationMarkerData(0,function(F){this.setLocationMarkers(F);google.maps.event.trigger(this.map,"markersLoaded");E()}.bind(this))}}else{if(this.propertyMarkerData){var D=new google.maps.LatLngBounds();var A=(this.mapState==="wee")?this.weeMapMarkerLimit:this.propertyMarkerData.length;var C=0;this.propertyMarkerData.each(function(F){if(F.currentPage&&C<A){D.extend(new google.maps.LatLng(F.lat,F.lng));C++}});this.bounds=D;this.boundsListener=google.maps.event.addListenerOnce(this.map,"bounds_changed",function(){this.setPropertyMarkers(this.propertyMarkerData,this.getMarkerLimit());this.setReplot()}.bind(this));E()}else{var B=this.getMainMarkerData(true,this.getMarkerLimit());this.boundsListener=google.maps.event.addListenerOnce(this.map,"bounds_changed",function(){this.setPropertyMarkers(B,this.getMarkerLimit());this.getOutlierMarkerData(0)}.bind(this));E()}}},setZoomAndCenter:function(){if(this.params.zoomLevel&&this.params.lat&&this.markerLevel==="location"&&this.locationViewDefault){this.map.setCenter(new google.maps.LatLng(this.params.lat,this.params.lng));this.map.setZoom(this.params.zoomLevel);this.prevZoomLevel=this.params.zoomLevel;this.zoomLevelToShowLocations=(this.zoomLevelToShowLocations?this.zoomLevelToShowLocations:this.map.getZoom())}else{this.handleCloseZoom();this.map.fitBounds(this.bounds);this.prevZoomLevel=this.map.getZoom()}},clearInvalidMarkers:function(A){var A=A||[];while(A.length){A.shift().destroy()}},setReplot:function(){var A;if(this.markerLimit&&!this.idleListener&&this.mapState!=="wee"){google.maps.event.addListenerOnce(this.map,"idle",function(){this.idleListener=google.maps.event.addListener(this.map,"idle",function(){if(this.markerLevel==="property"&&this.mapState!=="wee"){A=this.markers;this.markers=null;this.setPropertyMarkers(this.propertyMarkerData,this.markerLimit);setTimeout(this.clearInvalidMarkers.bind(this,A),0)}}.bind(this))}.bind(this))}},setPropertyMarkers:function(markerData,limit){var bounds=this.map.getBounds()||new google.maps.LatLngBounds();var markers=[];var currentMarkers=[];var data=[];var marker;var idOffset;if(this.markers&&this.markers.length){this.propertyMarkerData=this.propertyMarkerData.concat(markerData);idOffset=this.markers.length;limit-=this.markers.length;this.totalMarkers+=markerData.length}else{this.propertyMarkerData=markerData;idOffset=0;this.totalMarkers=markerData.length;this.markers=[];this.data=[]}if(limit!==undefined){for(var i=0,len=markerData.length;i<len;i++){if(currentMarkers.length<limit){var datum=markerData[i];var markerLatLng=new google.maps.LatLng(datum.lat,datum.lng);if(!bounds.contains(markerLatLng)){continue}datum.latLng=markerLatLng;currentMarkers.push(datum)}else{break}}}else{currentMarkers=markerData}for(var i=0,len=currentMarkers.length;i<len;i++){var datum=currentMarkers[i];var markerOptions={position:datum.latLng||new google.maps.LatLng(datum.lat,datum.lng),type:datum.type,map:this.map,label:datum.label};datum.tooltip=eval(datum.type+"MarkerToolTip");datum.infoWindow=eval(datum.type+"MapInfoWindow");markerOptions.currentPage=datum.currentPage;if(datum.isFeatured){markerOptions.classes="featured"}marker=new MapMarker(markerOptions);datum.datedSearch=this.datedSearch;marker.id=i+idOffset;if(markerOptions.currentPage&&markerOptions.label&&datum.datedSearch=="true"){bounds.extend(markerOptions.position);google.maps.event.addListener(marker,"click",this.markerClick.bind(this,marker,true));google.maps.event.addListenerOnce(marker,"click",this.markerVisited.bind(this,marker))}google.maps.event.addListener(marker,"mouseover",this.markerMouseover.bind(this,marker));google.maps.event.addListener(marker,"mouseout",this.markerMouseout.bind(this,marker));markers[i]=marker;data[i]=datum}this.bounds=bounds;this.markers=this.markers.concat(markers);this.data=this.data.concat(data)},setLocationMarkers:function(markerData){var bounds=new google.maps.LatLngBounds();var markers=[],data=[],marker,locationDetails,labelText,markup,descMarkup,clickToFilter,descAvail,style;if(this.locationDetails){locationDetails=this.locationDetails.data}else{log.warning("DestinationExplorerResultsSetMapAgent - setLocationMarkers - Label details (prices per rating) is undefined. Ajax call failed or returned empty object most likely.")}for(var i=0,markerLen=markerData.length;i<markerLen;i++){var datum=markerData[i];datum.tooltip=eval(datum.type+"MarkerToolTip");if(datum.hotelCountNumber){clickToFilter=true}if(datum.hotelCountNumber){datum.viewAllLinkText=this.params.viewAllInAreaLink}if(this.locationDetails){datum.hotelsText=this.locationDetails.hotelsText}if(!this.locationLabelData){datum.locName=datum.label;if(locationDetails&&this.locationLabelsWithPrices){var ratingInfo=locationDetails[datum.locId];if(ratingInfo){datum.ratingInfo=ratingInfo}else{log.warning("DestinationExplorerResultsSetMapAgent - setLocationMarkers - No details returned for location "+datum.locId)}}datum.descAvail=descAvail}else{datum.label=this.locationLabelData[i].label;datum.ratingInfo=this.locationLabelData[i].ratingInfo;datum.labelMainContentOffset=this.locationLabelData[i].labelMainContentOffset;datum.descAvail=this.locationLabelData[i].descAvail}var markerOptions={position:new google.maps.LatLng(datum.lat,datum.lng),type:datum.type,map:this.map,label:datum.label,labelMainContentOffset:datum.labelMainContentOffset};marker=new LocationMarker(markerOptions);marker.id=i;bounds.extend(marker.getPosition());google.maps.event.addListener(marker,"click",this.locationMarkerClick.bind(this,marker,true));google.maps.event.addListener(marker,"mouseover",this.locationMarkerMouseover.bind(this,marker));google.maps.event.addListener(marker,"mouseout",this.locationMarkerMouseout.bind(this,marker));markers[i]=marker;data[i]=datum}this.bounds=bounds;this.data=data;this.locationLabelData=data;this.markers=markers},getLocationTooltip:function(){return this.locationTooltip||(this.locationTooltip=new LocationToolTip(this.map))},getOutlierMarkerData:function(attemptNumber){if(!this.params.outlierAjaxURL){var outlierMarkers=document.getElementById("mapInfo");if(outlierMarkers&&!outlierMarkers.innerHTML.blank()){this.setPropertyMarkers(eval("(["+outlierMarkers.innerHTML+"])"),this.getMarkerLimit());this.setReplot()}}else{new Ajax.Request(this.params.outlierAjaxURL+"&retryAttempt="+attemptNumber,{method:"get",onSuccess:function(response){var jsonResponse=response.responseText.evalJSON();if(jsonResponse.retry&&attemptNumber<this.params.retryAttempts){this.getOutlierMarkerData.bind(this).delay(this.params.retryInterval,attemptNumber+1)}else{var results=jsonResponse.mapData.otherHotels;if(results&&results.length){this.setPropertyMarkers(results,this.getMarkerLimit());this.setReplot()}}}.bind(this)})}},getMainMarkerData:function(F,B){var A;var E=new google.maps.LatLngBounds();var D=$("main").select("div[data-map-info]");var C=0;var B=B||D.length;var G=D.collect(function(I){var H=I.getAttribute("data-map-info").evalJSON();H.resultCardElement=I;H.currentPage=true;if(F&&C++<B){E.extend(new google.maps.LatLng(H.lat,H.lng))}return H});if(F){this.bounds=E}return G},getLocationMarkerData:function(C,B){var A=$$(this.params.weeMapModuleContainerSelector)[0].select("label[data-params]","li[data-params]").collect(function(E){var D=E.getAttribute("data-params").evalJSON();return D});if(this.locationLabelsWithPrices&&this.params.outlierAjaxURL){new Ajax.Request(this.params.outlierAjaxURL+"&retryAttempt="+C,{method:"get",onSuccess:function(D){var E=D.responseText.evalJSON();if(E.retry&&C<this.params.retryAttempts){this.getLocationMarkerData.bind(this).delay(this.params.retryInterval,C+1,B)}else{this.locationDetails=E.mapData.locations;B(A)}}.bind(this)})}else{B(A)}},mapResizeHelper:function(){this.zoomLevelChangedOnResizeMap=true;if(this.toggleMarkerListener){google.maps.event.removeListener(this.toggleMarkerListener)}if(this.mapState==="big"){this.setMarkerLevelListeners()}this.setInitialMarkerLevel();this.clearMapMarkers();this.loadMarkers(function(){google.maps.event.trigger(this.map,"resize");this.setZoomAndCenter()}.bind(this))},getShowLocationLabelsFlag:function(){if($("showMapLocationLabelsFlag")){return true}else{return false}},setMarkerLevelListeners:function(){if(this.toggleLocationPropertyMarkers&&this.mapState==="big"){this.toggleMarkerListener=google.maps.event.addListener(this.map,"zoom_changed",this.checkMarkerLevelOnZoom.bind(this));if(this.locationViewDefault){if(!this.params.zoomLevel&&this.params.markerLevel==="location"&&!this.zoomLevelToShowLocations){google.maps.event.addListenerOnce(this.map,"idle",this.setDefaultZoomLevelForLocations.bind(this))}}else{if(!this.zoomLevelToShowProperties){google.maps.event.addListenerOnce(this.map,"idle",this.setDefaultZoomLevelForProperties.bind(this))}}}},setDefaultZoomLevelForLocations:function(){this.zoomLevelToShowLocations=this.map.getZoom()},setDefaultZoomLevelForProperties:function(){this.zoomLevelToShowProperties=this.map.getZoom()},checkMarkerLevelOnZoom:function(){if(this.mapState==="big"&&!this.zoomLevelChangedOnResizeMap){var B=this.map.getZoom();var A=this.prevZoomLevel<B?"zoomin":"zoomout";this.prevZoomLevel=B;this.fireWebTrendsEvent(A,{"DCSext.de_city":this.params.locationId,"DCSext.zoomLevel":B});if(this.locationViewDefault){if((B>this.zoomLevelToShowLocations&&this.markerLevel==="location")||(B<=this.zoomLevelToShowLocations&&this.markerLevel==="property"&&this.getShowLocationLabelsFlag())){this.toggleMarkerLevel()}}else{if((B>=this.zoomLevelToShowProperties&&this.markerLevel==="location")||(B<this.zoomLevelToShowProperties&&this.markerLevel==="property"&&this.getShowLocationLabelsFlag())){this.toggleMarkerLevel()}}}this.zoomLevelChangedOnResizeMap=false},toggleMarkerLevel:function(){this.clearMapMarkers();if(this.markerLevel==="location"){this.markerLevel="property"}else{this.markerLevel="location"}this.loadMarkers()},onUnload:function(){var A=this.map.getCenter();var B;if(this.infoWindowVisible){B=this.data[this.getInfoWindow().marker.id].id}if(Persist){var C={searchKey:this.params.searchKey,mapState:this.mapState,zoom:this.map.getZoom(),position:{lat:A.lat(),lng:A.lng()},mapType:this.map.getMapTypeId(),activeId:B,markerLevel:this.markerLevel,zoomLevelToShowLocations:this.zoomLevelToShowLocations};Persist.set("DestinationExplorerResultSetMapAgent",C,true)}if(this.infoWindow){this.infoWindow.destroy()}if(this.tooltip){this.tooltip.destroy()}this.clearMapMarkers()},markerClick:function(B,A){if(this.mapState==="wee"||this.disableInfoWindow){return false}var C=this.data[B.id];this.getInfoWindow().open(B,C);B.overlay.addClassName("mapMarkerCurrent");if(this.tooltip){this.getMarkerTooltip().close()}if(A){this.fireWebTrendsEvent(C.type+" pin",{"DCSext.de_city":this.params.locationId})}google.maps.event.trigger(this.map,"overlayClicked")},markerMouseover:function(A){if(this.mapState=="wee"){return false}var B=this.data[A.id];A.focus();this.getMarkerTooltip().open(A,B)},markerMouseout:function(A){if(this.mapState=="wee"){return false}var B=this.data[A.id];A.blur();if(this.tooltip){this.getMarkerTooltip().close()}},locationMarkerClick:function(B,A){var C=this.data[B.id];var D=this.getLocationTooltip();if(D.getVisible()){if(C.hotelCountNumber){D.close();this.markers.each(function(E){E.clearDomListeners()});document.fire("map:locationLabelClicked",{locId:C.locId,searchUrl:C.searchUrl,filterType:C.locFilterType})}else{return false}if(A){this.fireWebTrendsEvent("location label click",{"DCSext.de_city":this.params.locationId,"DCSext.de_area":C.locName})}google.maps.event.trigger(this.map,"overlayClicked")}else{this.locationMarkerMouseover(B)}},locationMarkerMouseover:function(A){var B=this.data[A.id];A.focus();this.getLocationTooltip().open(A,B);this.fireWebTrendsEvent("location label hover",{"DCSext.de_city":this.params.locationId,"DCSext.de_area":B.locName})},locationMarkerMouseout:function(A){var B=this.data[A.id];A.blur();if(this.locationTooltip){this.getLocationTooltip().close()}},fireMBoxEvent:function(){if(!this.mboxListeners||this.mboxListeners.length<1){return}if(window.mboxUpdate){mboxUpdate(this.mboxId,"DEInteracted=true")}this.clearMBoxListeners()},setMBoxListeners:function(){google.maps.event.addListenerOnce(this.map,"idle",function(){var B=this.map;var A=false;this.mboxListeners=[];this.mboxListeners.push(google.maps.event.addListener(B,"resultsUpdated",function(){A=true}.bind(this)));this.mboxListeners.push(google.maps.event.addListener(B,"dragstart",function(){this.fireMBoxEvent()}.bind(this)));this.mboxListeners.push(google.maps.event.addListener(B,"zoom_changed",function(){if(!A){this.fireMBoxEvent()}else{A=false}}.bind(this)));this.mboxListeners.push(google.maps.event.addListener(B,"dblclick",function(){this.fireMBoxEvent()}.bind(this)));this.mboxListeners.push(google.maps.event.addListener(B,"overlayClicked",function(){this.fireMBoxEvent()}.bind(this)));document.observe("agent:locationFilterClicked",function(){document.stopObserving("agent:locationFilterClicked");this.fireMBoxEvent()}.bind(this))}.bind(this))},clearMBoxListeners:function(){var A=this.mboxListeners||[];while(A.length){google.maps.event.removeListener(A.shift())}}});var SimilarHotelsResultSetMap=Class.create(SimpleResultSetMap,{beforeDOMReady:false,setMapMarkers:function(markerData){if(this.markers){this.clearMapMarkers()}var bounds=this.map.getBounds()||new google.maps.LatLngBounds();var markers=[];var currentMarkers=[];var data=[];var marker;currentMarkers=markerData;for(var i=currentMarkers.length;i--;){var datum=currentMarkers[i];var markerOptions={position:new google.maps.LatLng(datum.lat,datum.lng),type:datum.type,map:this.map,label:datum.label};datum.tooltip=eval(datum.type+"MarkerToolTip");datum.infoWindow=eval(datum.type+"MapInfoWindow");if(!datum.iconSrc){marker=new MapMarker(markerOptions)}else{marker=new IconMapMarker(new google.maps.LatLng(datum.lat,datum.lng),datum.type,this.map,datum.iconSrc,datum.isFeatured&&"featured")}marker.id=i;bounds.extend(marker.getPosition());google.maps.event.addListener(marker,"click",this.markerClick.bind(this,marker,true));google.maps.event.addListenerOnce(marker,"click",this.markerVisited.bind(this,marker));google.maps.event.addListener(marker,"mouseover",this.markerMouseover.bind(this,marker));google.maps.event.addListener(marker,"mouseout",this.markerMouseout.bind(this,marker));markers[i]=marker;data[i]=datum}this.bounds=bounds;this.markers=markers;this.data=data}});var IconMapMarker=function(A,E,F,B,D){var C=new Element("IMG",{src:B,"class":"mapMarker"});C.className="mapMarker";C.style.position="absolute";IconMapMarker=function(G,J,K,H,I){this.overlay=C.cloneNode(true);this.overlay.addClassName(J+"MapMarker");if(I){this.overlay.addClassName(I)}this.setPosition(G);this.setMap(K);this.addDomListener(this.overlay,"mouseover",function(){google.maps.event.trigger(this,"mouseover")}.bind(this));this.addDomListener(this.overlay,"mouseout",function(){google.maps.event.trigger(this,"mouseout")}.bind(this));this.addDomListener(this.overlay,"click",function(){google.maps.event.trigger(this,"click")}.bind(this))};IconMapMarker.prototype=Object.extend(new BaseOverlay(),{getPane:function(){return this.getPanes().overlayImage},getPosition:function(){return this.get("position")},getNorthEast:function(H,G){return new google.maps.Point(H.x+(G.width)-5,H.y-(G.height))},getSouthWest:function(H,G){return new google.maps.Point(H.x-5,H.y)},getCenter:function(H,G){return new google.maps.Point((H.x-5)+(G.width/2),H.y-(G.height/2))}});return new IconMapMarker(A,E,F,B,D)};var SimilarHotelMarkerToolTip={populateToolTip:function(A){if(!A.name){A.name=A.resultCardElement.down("a.hotelNameLink").innerHTML}var B='<strong class="name">'+A.name+"</strong>"+((A.stars)?'<img class="stars" src="/style/global/img/star'+A.stars+'.png" alt="'+A.stars+' stars" height="13" width="70" />':"")+((A.rating)?'<span class="rating"><strong><span>'+A.rating+"</span></strong></span>":"");this.overlay.update(B)}};var SimilarHotelMapInfoWindow={setHeader:function(A){},populateInfoWindow:function(A){}};var Matrix=Class.create();Matrix.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.table=this.element;var A=this.table.tBodies[0].rows[0].getElementsByTagName("TH").length;$A(this.table.tHead.rows).each(function(B){$A(B.cells).each(function(C,D){if(D<A){return}if(C.title!=""){C.title=C.title.strip()}$(C);if(C.innerHTML==""||C.hasClassName("noHighlight")){return}Event.observe(C,"mouseover",this.colHeaderMouseEvent.bind(this,D));Event.observe(C,"mouseout",this.colHeaderMouseEvent.bind(this,D));Event.observe(C,"click",this.cellClickEvent.bind(this,"TH",this.params.columnHeaderWTLabel))}.bind(this))}.bind(this));$A(this.table.tBodies[0].rows).each(function(B){$A(B.cells).each(function(C,D){if(C.title!=""){C.title=C.title.strip()}$(C);if(C.innerHTML==""||C.hasClassName("noHighlight")){return}if(C.tagName=="TH"){Event.observe(C,"mouseover",this.rowHeaderMouseEvent.bind(this));Event.observe(C,"mouseout",this.rowHeaderMouseEvent.bind(this));Event.observe(C,"click",this.cellClickEvent.bind(this,"TH",this.params.rowHeaderWTLabel))}else{Event.observe(C,"mouseover",this.cellMouseEvent.bind(this,D));Event.observe(C,"mouseout",this.cellMouseEvent.bind(this,D));Event.observe(C,"click",this.cellClickEvent.bind(this,"TD",this.params.cellWTLabel))}}.bind(this))}.bind(this));document.observe("agent:updatingResults",this.handleResultsUpdated.bind(this))},cellMouseEvent:function(A,C){var B=C.findElement("td");var D=(C.type=="mouseover");this.highlightCell(B,D);this.highlightRowHeader(B,D);this.highlightColumnHeader(A,D)},rowHeaderMouseEvent:function(B){var A=B.findElement("th");this.highlightRow(A,(B.type=="mouseover"))},colHeaderMouseEvent:function(A,B){this.highlightColumn(A,(B.type=="mouseover"))},cellClickEvent:function(B,A,D){if(!this.params.ignoreClicks){var C=D.findElement(B);if(C.getElementsByTagName("a")[0]){if(A){C.fire("webtrends:multiTrackEvent",{"WT.ti":A,"WT.dl":"1"})}window.location=C.getElementsByTagName("a")[0].href}D.preventDefault()}},highlightRowHeader:function(A,B){$A(A.parentNode.cells).each(function(C){if(C.tagName!="TH"){throw $break}this.highlightCell(C,B)}.bind(this))},highlightColumnHeader:function(A,B){$A(this.table.tHead.rows).each(function(C){this.highlightCell(C.cells[A],B)}.bind(this))},highlightRow:function(A,C,B){$A(A.parentNode.cells).each(function(D){this.highlightCell(D,C)}.bind(this))},highlightColumn:function(B,C,A){$A(this.table.rows).each(function(D){this.highlightCell(D.cells[B],C)}.bind(this))},highlightCell:function(A,B){if(A.hasClassName("noHighlight")){return}if(B){A.addClassName("hover")}else{A.removeClassName("hover")}},handleResultsUpdated:function(){$A(this.table.tHead.rows).each(function(A){$A(A.cells).each(function(B){$(B).removeClassName("selected")})});$A(this.table.tBodies[0].rows).each(function(A){$A(A.cells).each(function(B){$(B).removeClassName("selected")})})}});var merchMiniAirForm=Class.create();merchMiniAirForm.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(this.params.setUpDefaults){this.params.mcOptions.setUp=function(){var A=this.dialogObject.markup.mainInfo.down("form");if(this.dialogObject.dataJSON.defaultOrigin&&this.dialogObject.dataJSON.defaultDestination){A.elements["ar.rt.leaveSlice.orig.key"].value=this.dialogObject.dataJSON.defaultOrigin;A.elements["ar.rt.leaveSlice.dest.key"].value=this.dialogObject.dataJSON.defaultDestination}}.bind(this)}this.dialogObject=new Microcontent(this.element.select(".miniAirFormTrigger a"),{jsTemplate:{id:this.params.templateId,dataAttributeName:"data-mini-air-form"}},this.params.mcOptions)}});var MicrocontentAgent=Class.create();MicrocontentAgent.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initialize:function(A,C){Object.extend(this,C);this.element=Element.extend(A);var B=$A();if(!C.params.useAdditionalTriggersOnly){B.push(this.element)}if(C.params.additionalTriggers){C.params.additionalTriggers.each(function(D){$$(D).each(function(E){B.push(E)})})}this.dialogObject=new Microcontent(B,C.params.content,C.params.options)}});var SavedHotelsMicrocontent=Class.create(MicrocontentAgent,{initialize:function($super,A,B){B.params.options.setUp=SavedHotelsWebtrendsEventSender.onSavedHotelsListViewed.bind(this,B.params.viewMyFavoritesLink,B.params.context);$super(A,B)}});var TotalPriceMicrocontent=Class.create();TotalPriceMicrocontent.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.markup=this.params.dynamicMarkup;this.options={dialogGroup:"totalPrice"};this.options.setUp=function(){if(!this.domNodes){this.domNodes=new Element("div").insert(this.markup).childElements()}this.mainElement=this.microcontent.markup.mainInfo.down(".totalPriceMicrocontent");for(var A=0;A<this.domNodes.length;A++){this.mainElement.appendChild(this.domNodes[A])}}.bind(this);this.options.tearDown=function(){for(var A=0;A<this.domNodes.length;A++){this.mainElement.removeChild(this.domNodes[A])}}.bind(this);this.options=Object.extend(this.params.options,this.options);this.microcontent=new Microcontent([this.element],this.params.content,this.options);document.observe("dialog:dialogOpen",this.close.bindAsEventListener(this))},close:function(A){if(A&&A.memo&&A.memo.dialog!=this.microcontent&&A.memo.dialog.options.dialogGroup==this.options.dialogGroup){this.microcontent.close()}}});var MicrocontentFromTemplate=Class.create(Abstract.Agent,{initExtend:function(){this.dialogObject=new Microcontent(this.element.select(this.params.identifier),{jsTemplate:{id:this.params.templateId,dataAttributeName:this.params.dataAttribute}},this.params.mcOptions)}});var MultiNodeUpdaterTarget=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){Page.multiNodeTargets=Page.multiNodeTargets||{};this.dialogManager=new DialogManager(this.element);if(Page.multiNodeTargets[this.params.targetId]){try{var B=Page.multiNodeTargets[this.params.targetId];B.dialogManager.destroy();B.element.parentNode.replaceChild(this.element,B.element);delete B}catch(A){Errors.capture(A)}}Page.multiNodeTargets[this.params.targetId]=this}});var NonLocalizedContentManager=Class.create();NonLocalizedContentManager.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){Event.observe(this.element.down("a"),"click",function(A){this.element.replace(this.params.content);A.preventDefault()}.bindAsEventListener(this))}});var RevealOtherActivitiesControl=Class.create(Abstract.Agent,{initExtend:function(){var B=function(C){if(C.target.tagName.toLowerCase()=="a"){document.fire("otherActivities:reveal");A(C)}};var A=function(C){this.element.stopObserving("click",B)}.bindAsEventListener(this);Event.observe(this.element,"click",B);document.observe("otherActivitiesControl:remove",A)}});var RevealOtherActivities=Class.create(Abstract.Agent,{initExtend:function(){var D=new Element("div").addClassName("otherCategoriesReveal");var B=new Element("a").addClassName("link").update(this.params.linkText);D.appendChild(B);var C=function(E){this.element.showByClass();this.element.getElementsByTagName("input")[0].value=true;A(E);E.preventDefault()}.bindAsEventListener(this);var A=function(E){B.stopObserving("click",C);D.removeChild(B);this.element.parentNode.removeChild(D);document.fire("otherActivitiesControl:remove")}.bindAsEventListener(this);Event.observe(B,"click",C);document.observe("otherActivities:reveal",C);this.element.parentNode.appendChild(D)}});var OasOptionsToggle=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.moreOptionsLink=null;this.element.addClassName("collapsedView");this.showMoreOptionsLink=new Element("a",{href:"#"}).update(this.params.showDetailsText);this.element.down(".oasProductFooter").insert({top:this.showMoreOptionsLink});this.showMoreOptionsLink.observe("click",function(A){if(this.element.hasClassName("collapsedView")){this.showMoreOptionsLink.update(this.params.hideDetailsText);this.element.removeClassName("collapsedView")}else{this.showMoreOptionsLink.update(this.params.showDetailsText);this.element.addClassName("collapsedView")}A.preventDefault()}.bindAsEventListener(this))}});var OasSubOptionEventManager=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var B=$A();$A(this.element.getElementsByTagName("input")).each(function(C){if(C.type.toLowerCase()==="checkbox"){B.push(C)}});var A=function(){var C=[];B.each(function(E){if(E.checked){var D=E.name.substring(E.name.lastIndexOf("['")+2,E.name.lastIndexOf("']"));C[C.length]=D}});return C};Event.observe(this.element,"click",function(E){var D=E.target;if(D.tagName.toLowerCase()==="input"&&D.type.toLowerCase()==="checkbox"){var C=A();document.fire("oasSubOptions"+this.params.activityKey+":changed",C)}}.bindAsEventListener(this));document.observe("oasSubOptions"+this.params.activityKey+":getKey",function(D){var C=A().toString();if(C!=D.memo.displayedKey){var E={memo:C};D.memo.callback(E)}}.bindAsEventListener(this))}});var OasOptionsTableManager=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var B=function(H){if(H.target.tagName.toLowerCase()=="input"){var G=Element.extend(H.target).getParentByTagName("tbody").getElementsByClassName("displayedRow")[0];if(G){G.removeClassName("displayedRow")}var F=Element.extend(H.target).getParentByTagName("tr");F.addClassName("displayedRow");document.fire("oasOption"+this.params.activityKey+":changed",this.element)}}.bindAsEventListener(this);Event.observe(this.element,"click",B);if(this.params.subOptions){var E=function(){var H=$A();var G=this.element.getElementsByTagName("input");for(var I=0;I<G.length;I++){var F=G[I];if(F.type=="radio"){H.push(F)}}return H}.bindAsEventListener(this);var A=function(){var H=false;var I=E();for(var G=0;G<I.length;G++){var F=I[G];if(F.checked){H=F.value}}return H};var D=function(I){var J=E();var H=false;for(var G=0;G<J.length;G++){var F=J[G];if(F.value==I){F.click();H=true;return}}if(!H){log.debug("defaulting selected option to first radio since lists did not match");J[0].click()}};var C=function(G){if(this.params.subOptions[G.memo]){var H=A();var F=this.params.subOptions[G.memo];this.element.update(F);D(H)}}.bindAsEventListener(this);document.observe("oasSubOptions"+this.params.activityKey+":changed",C);document.fire("oasSubOptions"+this.params.activityKey+":getKey",{displayedKey:this.params.displayedKey,callback:C})}}});var OasSubOptionEventManagerAjax=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.element.on("click",function(C){var B=C.findElement("input[type=checkbox]");if(B&&B!=document){if(!this.pi){this.pi=new ProgressIndicator(this.element.down("fieldset"))}A(B.up("form"))}}.bind(this));var A=function(B){var D=B.serialize()+"&"+this.params.eventId+"=true&pageView=optionsAjax";var C=new Ajax.Request(B.action,{method:"get",parameters:D,onSuccess:function(E){try{this.element.update(E.responseText)}catch(F){log.error("OasSubOptionEventManagerAjax: Error");Errors.capture(F)}}.bind(this),onFailure:function(){log.error("SubmitUpdateTrigger: No response from application for OasSubOptionEventManagerAjax");this.pi.spinnerElement.remove();delete this.pi}})}.bind(this)}});var OpinionLabsInitializer=Class.create(Abstract.Agent,{beforeROMReady:false,initExtend:function(){this.OOobj=new OnlineOpinion.ocode();this.OOobj.Preferences.Persistence={enabled:true,cookie_name:"oo_r",cookie_type:"page",expiration:3600};this.OOobj.Preferences.Render={type:"floating",main_div_id:"oo_feedback_float",up_div_id:"olUp",over_div_id:"olOver",img_path:this.params.imagePath,feedback_span_id:"fbText",feedback_html:this.params.feedbackText,click_html:this.params.clickText};this.OOobj.Preferences.Plugins.URLRewrite={active:true,regex_search_pattern:"://",regex_replace_pattern:"://"+this.params.locale+"."};this.OOobj.Metrics.custom.sessionId=this.params.sessionId;OnlineOpinion.util.SafeAddOnUnLoadEvent(function(){this.OOobj.onExit()}.bindAsEventListener(this));this.OOobj.render(function(){this.OOobj.show();this.removeHeaderListItem()}.bindAsEventListener(this));if(!this.OOobj.Cookie.matchurl(this.OOobj.Metrics.core.referer,this.OOobj.Preferences.Persistence.cookie_type)){if(this.params.displayLink){this.attachHeaderLink()}else{this.removeHeaderListItem()}}else{this.removeHeaderListItem()}},attachHeaderLink:function(){var A=new Element("a",{"class":"link",href:"#"}).update(this.params.feedbackText);var C=function(D){this.OOobj.show();Event.stopObserving(A,"click",B);this.removeHeaderListItem();D.preventDefault()};var B=C.bindAsEventListener(this);Event.observe(A,"click",B);this.element.appendChild(A)},removeHeaderListItem:function(){var A=this.element.next(0);if(typeof A=="undefined"&&this.element.tagName.toLowerCase()=="li"){this.element.previous(0).addClassName("last")}this.element.parentNode.removeChild(this.element)}});var Pagination=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){if(this.params.streaming){document.on("agent:streamingComplete",this.initAjaxButton.bind(this));document.on("agent:streamingUpdate",this.handleStreamingUpdate.bind(this))}else{this.initAjaxButton()}},handleStreamingUpdate:function(A){if(event.memo.status=="timedout"){this.initAjaxButton()}},initAjaxButton:function(){this.element.on("click",this.onMoreResultsClick.bind(this));this.canUpdate=true;document.on("agent:updatingResults",this.onUpdatingResults.bind(this))},onMoreResultsClick:function(B){if(this.canUpdate){document.fire("agent:updatingResults");this.element.innerHTML=this.params.loadingText;var A=this.element.down(".animate");if(A){Effect.Pulsate(A,{pulses:60,duration:60})}this.element.addClassName("loading");this.update()}B.preventDefault()},update:function(){this.request=new Ajax.IncrementalPartialPage(this.element.readAttribute("href"),{method:"get",parameters:"rep=pagination&models['searchView'].startingIndex="+this.params.startingIndex})},onUpdatingResults:function(A){this.canUpdate=false}});var PanelCollapse=Class.create(Abstract.Agent,Persistent,{beforeDOMReady:true,initExtend:function(){this.titleBar=this.element.getFirstElementByClassName("titleBar","div");this.titleBar.addClassName("collapsible");this.initPersistence(this.params.persistenceId);try{this.opened=this.getPersistent("opened")}catch(F){this.opened=null;log.error("PanelCollapse: get persistence failed: "+F)}if(this.opened===null){this.opened=(this.params.collapseState==="opened")}this.panelContent=this.element.getFirstElementByClassName("panelContent","div");this.instructionLink=this.titleBar.getFirstElementByClassName("panelCollapse");if(this.opened){this.open()}else{this.close()}this.panelMessageElement=this.element.getFirstElementByClassName("panelMessage","div");this.panelMessage="";if(this.panelMessageElement!=null){this.panelMessage=this.panelMessageElement.innerHTML}this.dirtyFieldsMessage="";this.fieldsDirty=false;if(this.panelMessageElement!=null){var E=this.panelMessageElement.getParams();if((E!=null)&&(E.dirtyFieldsMessage!=null)){this.dirtyFieldsMessage=E.dirtyFieldsMessage}}this.fieldsToObserve=[];if(this.dirtyFieldsMessage!=""){var C=$A(this.element.getElementsByTagName("input"));var A=$A(this.element.getElementsByTagName("select"));var D=$A(this.element.getElementsByTagName("textArea"));this.fieldsToObserve=C.concat(A,D)}log.info(this.type+".fieldsToObserve: "+this.fieldsToObserve.length);for(var B=0;B<this.fieldsToObserve.length;B++){Event.observe(this.fieldsToObserve[B],"change",this.setFieldsDirty.bindAsEventListener(this))}this.titleBar.on("click",this.toggleCollapse.bind(this))},setFieldsDirty:function(){this.fieldsDirty=true;log.info("fields dirtied")},open:function(){this.titleBar.addClassName("open");this.titleBar.removeClassName("closed");this.panelContent.showByClass();if(!this.contentInitialized&&this.params.initLazyAgents){Page.initializeLazyAgents(this.panelContent);this.contentInitialized=true}},close:function(){this.titleBar.addClassName("closed");this.titleBar.removeClassName("open");this.panelContent.hideByClass()},toggleCollapse:function(A){this.opened=!this.opened;if(this.opened){this.open();if(this.params.webtrendsLabel){this.element.fire("webtrends:multiTrackEvent",{"WT.ti":"Link: Expand "+this.params.webtrendsLabel,"WT.dl":"1"})}}else{this.close();if(this.params.webtrendsLabel){this.element.fire("webtrends:multiTrackEvent",{"WT.ti":"Link: Collapse "+this.params.webtrendsLabel,"WT.dl":"1"})}}try{this.setPersistent("opened",this.opened)}catch(B){log.error("PanelCollapse: set persistence failed: "+B)}if(this.fieldsDirty){if(this.opened){this.panelMessageElement.update(this.panelMessage)}else{this.panelMessageElement.update(this.dirtyFieldsMessage)}}A.preventDefault()}});var PhotoCarousel=Class.create(Abstract.Agent,{beforeDOMReady:true,bgOpacity:0.5,posIndex:0,lastImage:0,canMove:false,imagesInCache:0,disabled:false,lockButtons:false,buttonOpacity:0.5,initExtend:function(){if(!this.createCarouselImages()||this.params.imageSet.length<2){return}if(this.params.imageSet.length==2){this.params.imageSet[2]=this.params.imageSet[0];this.params.imageSet[3]=this.params.imageSet[1]}this.cacheSize=this.params.imageSet.length;this.cache=$A(this.cacheSize);this.cacheImage(0,this.element.getFirstElementByClassName("slide"));if(!this.params.lookAhead||(this.params.lookAhead>=this.cacheSize)){this.params.lookAhead=1}this.lookAhead=this.params.lookAhead;this.imgLink=this.element.getFirstElementByClassName("link");this.photoFrame=this.element.getFirstElementByClassName("photoFrame");this.imgWidth=this.element.getFirstElementByClassName("slide").getWidth();this.photoFrame.setStyle({width:this.imgWidth*(this.lookAhead*2+1)+"px"});this.buttonOpacity=(this.params.buttonOpacity?this.params.buttonOpacity:this.buttonOpacity);this.lockButtons=this.params.lockButtons;this.createControlPanel()},updatePhotoFrame:function(){this.updateCache(this.lookAhead);var E=this.imgLink.clone(false);var B=this.posIndex-this.lookAhead;if(B<0){B=this.cacheSize+B}var G=(this.lookAhead*2)+1;for(var D=0,C=B;D<G;D++){var F=(B+D)%this.cacheSize;if(this.imageIsPresent(this.cache[F])){E.insert({bottom:this.cache[F]})}else{E.insert({bottom:this.placeHolderImg.clone(true)})}}var A=-((G-1)/2)*this.imgWidth;this.photoFrame.setStyle({left:A+"px",position:"relative"});this.imgLink.update(E.innerHTML);this.canMove=true},imageIsPresent:function(A){if(!A.loaded||((typeof A.naturalWidth)!=undefined&&A.naturalWidth==0)){return false}else{return true}},updateCache:function(B){if(this.imagesInCache>=this.cacheSize){return}var A=this.posIndex-B;if(A<0){A=this.cacheSize+A}var F=(B*2)+1;for(var C=0;C<F;C++){var E=(A+C)%this.cacheSize;if(!this.cache[E]){var D=new Element("img",{"class":"slide",src:this.params.imageSet[E]});this.cacheImage(E,D)}}},cacheImage:function(A,B){Event.observe(B,"error",function(){Event.stopObserving(B,"error");log.info(B.src);if(this.placeHolderImg.src){B.src=this.placeHolderImg.src}}.bind(this));if(!B.loaded){Event.observe(B,"load",function(){Event.stopObserving(B,"load");B.loaded=true}.bind(this));B.src=B.src}B.removeAttribute("width");B.removeAttribute("height");this.cache[A]=B;this.imagesInCache++},createCarouselImages:function(){try{this.placeHolderImg=new Element("span").update(this.params.placeHolderImage);this.placeHolderImg=this.placeHolderImg.down("img");this.prev=new Element("a",{"class":"prevImageIcon",href:"#"}).update(this.params.previousButtonMarkup);this.nxt=new Element("a",{"class":"nextImageIcon",href:"#"}).update(this.params.nextButtonMarkup);return((this.placeHolderImg!=undefined)&&(this.prev.down("img")!=undefined)&&(this.nxt.down("img")!=undefined))}catch(A){log.error(A);return false}return false},createControlPanel:function(){this.ctrlPanel=new Element("div",{"class":"controlPanel"});if(!this.lockButtons){this.ctrlPanel.hide()}this.ctrlPanel.insert({bottom:this.prev});this.prev.observe("click",this.scrollImageList.bindAsEventListener(this,"prev"));this.prev.setOpacity(this.buttonOpacity);this.ctrlPanel.insert({bottom:this.nxt});this.nxt.observe("click",this.scrollImageList.bindAsEventListener(this,"next"));this.nxt.setOpacity(this.buttonOpacity);this.element.insert({bottom:this.ctrlPanel});this.parentElement=this.element.up();if(!this.lockButtons){this.parentElement.observe("mouseenter",this.showControls.bindAsEventListener(this));this.parentElement.observe("mouseleave",this.hideControls.bindAsEventListener(this))}else{this.parentElement.observe("mouseenter",this.updatePhotoFrame.bind(this));this.parentElement.observe("mouseleave",this.updatePhotoFrame.bind(this))}},showControls:function(){this.ctrlPanel.appear({duration:0.25,afterFinish:this.updatePhotoFrame.bind(this)})},hideControls:function(){this.ctrlPanel.fade({duration:0.25});this.ctrlPanel.hide()},scrollImageList:function(A,B){A.preventDefault();if(this.canMove){this.canMove=false;var C;if(B=="next"){this.posIndex=(this.posIndex+1)%this.cacheSize;C=-1}else{this.posIndex--;if(this.posIndex<0){this.posIndex=this.cacheSize+this.posIndex}C=1}new Effect.MoveBy(this.photoFrame,0,C*this.imgWidth,{duration:0.4,transition:Effect.Transitions.sinoidal,afterFinish:this.updatePhotoFrame.bind(this)})}}});var PhotoGallery=Class.create();PhotoGallery.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){var A=this.element.parentNode;this.images=$A();this.imageIndex=0;$A(A.getElementsByTagName("A")).each(function(D){this.images.push(D)}.bind(this));A.removeChild(this.element);this.image=document.createElement("IMG");this.header=document.createElement("P");this.image.src=this.images[this.imageIndex].href;this.image.alt="";this.header.appendChild(document.createTextNode("1"));this.header.appendChild(document.createTextNode(" "+this.params.numText.strip()+" "+this.images.length));if(this.images.length>1){this.header.appendChild(document.createTextNode(" : "));var B=document.createElement("A");var C=document.createElement("A");B.appendChild(document.createTextNode(this.params.nextLink.strip()));C.appendChild(document.createTextNode(this.params.previousLink.strip()));B.href="#";C.href="#";this.header.appendChild(C);this.header.appendChild(document.createTextNode(" | "));this.header.appendChild(B);Event.observe(B,"click",this.nextClick.bind(this));Event.observe(C,"click",this.previousClick.bind(this));A.appendChild(this.header)}A.appendChild(this.image)},nextClick:function(A){this.imageIndex=(this.imageIndex+1>=this.images.length)?0:this.imageIndex+1;this.image.src=this.images[this.imageIndex].href;this.image.alt=this.images[this.imageIndex].title;this.header.firstChild.nodeValue=this.imageIndex+1;Event.stop(A)},previousClick:function(A){this.imageIndex=(this.imageIndex-1<0)?this.images.length-1:this.imageIndex-1;this.image.src=this.images[this.imageIndex].href;this.image.alt=this.images[this.imageIndex].title;this.header.firstChild.nodeValue=this.imageIndex+1;Event.stop(A)}});var PhotoViewer=Class.create(Abstract.Agent,{beforeDOMReady:true,bgOpacity:0.5,initExtend:function(){this.thCon=this.element.getFirstElementByClassName("thumbnails");this.img=this.element.getFirstElementByClassName("photo");this.thLst=this.thCon.getFirstElementByClassName("thumbnailLists");this.thOpn=false;this.cGrp=0;this.tGrps=$A();this.eff=false;this.numImagesLoaded=0;this.neverOpened=true;this.initializeThumbnailGroups();this.createToggleImages();this.createControlBackground();if(this.params.imageList.length>this.params.groupSize){this.createNextThumbnailsImage();this.createPreviousThumbnailsImage()}if(!Page.onLoadFired){Event.observe(window,"load",this.firstRun.bind(this))}else{if(this.params.isAjax){setTimeout(function(){this.firstRun()}.bind(this),2000)}else{this.firstRun()}}},initializeThumbnailGroups:function(){var A=this.params.imageList.eachSlice(this.params.groupSize);var F;for(var G=0;G<A.length;G++){var E=$A();this.tGrps[G]={};if(G==0){this.tGrps[G].wrapper=this.thCon.down("ul");var B=this.tGrps[G].wrapper.getElementsByTagName("img");var D=function(H){Event.observe(H,"load",function(){Event.stopObserving(H,"load");this.numImagesLoaded++;if(this.numImagesLoaded==B.length){this.firstRun()}}.bind(this))}.bind(this);for(var C=0;C<B.length;C++){D(B[C])}this.tGrps[G].initialized=true;this.offset=parseInt(window.getComputedStyle?window.getComputedStyle(this.thLst,null).left:this.thLst.currentStyle.left);F=this.tGrps[G].wrapper.getWidth()}else{this.tGrps[G].wrapper=$(new Element("ul",{"class":"hidden"}));this.tGrps[G].initialized=false}this.tGrps[G].wrapper.setStyle({left:(G*F)+"px"});for(var C=0;C<A[G].length;C++){E.push({imageURL:A[G][C].imgURL,thumbURL:A[G][C].thumbURL})}this.tGrps[G].images=E;this.tGrps[G].wrapper.observe("click",this.changeDisplayImage.bindAsEventListener(this))}},createToggleImages:function(){this.opn=new Element("a",{"class":"thumbnailsToggle block",href:"#"}).update(this.params.openButtonMarkup);this.opn.observe("click",this.toggleThumbnailList.bindAsEventListener(this));this.thCon.insert({bottom:this.opn});this.cls=new Element("a",{"class":"thumbnailsToggle noneBlock",href:"#"}).update(this.params.closeButtonMarkup);this.cls.observe("click",this.toggleThumbnailList.bindAsEventListener(this));this.thCon.insert({bottom:this.cls})},createNextThumbnailsImage:function(){this.nxt=new Element("a",{"class":"noneBlock nextThumbsIcon",href:"#"}).update(this.params.nextButtonMarkup);this.nxt.observe("click",this.scrollThumbnailList.bindAsEventListener(this,"next"));this.thCon.insert({bottom:this.nxt})},createPreviousThumbnailsImage:function(){this.prv=new Element("a",{"class":"noneBlock previousThumbsIcon",href:"#"}).update(this.params.previousButtonMarkup);this.prv.observe("click",this.scrollThumbnailList.bindAsEventListener(this,"previous"));this.thCon.insert({top:this.prv})},createControlBackground:function(){this.bck=new Element("div",{"class":"noneBlock controlBar"});this.bck.setOpacity(this.bgOpacity);this.thCon.insert({before:this.bck})},createNewThumbnailGroup:function(D){var E=this.tGrps[D];if(!E||E.initialized){return}for(var C=0;C<E.images.length;C++){var B=(new Element("li")).update(new Element("a",{href:E.images[C].imageURL}));var A=new Element("img");if(E.images[C].thumbURL){A.src=E.images[C].thumbURL}else{A.src=E.images[C].imageURL}B.down("a").update(A);E.wrapper.insert({bottom:B})}E.initialized=true;this.thLst.insert({bottom:E.wrapper})},firstRun:function(){if(!this.neverOpened){return}this.neverOpened=false;this.toggleThumbnailList()},toggleThumbnailList:function(F){if(F){F.preventDefault()}if(this.eff){return}this.eff=true;var A=this.tGrps[this.cGrp].wrapper.childElements();if(this.thOpn){this.bck.hideByClass();if(this.nxt){this.nxt.hideByClass()}if(this.prv){this.prv.hideByClass()}var G=this.tGrps[this.cGrp].wrapper.getPositionOffset(this.cls).x;var D=0;A.each(function(H){H.setStyle({position:"absolute",left:D+"px"});D=D+H.getWidth()});this.unsetSelectedImage();for(var C=0;C<A.length;C++){var B={style:"left: "+G+"px",duration:0.35-0.3*C/(this.params.groupSize-1),transition:Effect.Transitions.easeFrom};if(C==0){B.afterFinish=function(){this.tGrps[this.cGrp].wrapper.hideByClass();this.cls.hideByClass();this.opn.showByClass();this.thOpn=false;this.eff=false}.bind(this)}new Effect.Morph(A[C],B)}}else{var G=this.tGrps[this.cGrp].wrapper.getPositionOffset(this.opn).x;A.each(function(H){H.setStyle({position:"absolute",left:G+"px"})});this.tGrps[this.cGrp].wrapper.showByClass();var E=A[0].getWidth();var D=E*(A.length-1);for(var C=A.length-1;C>-1;C--){var B={style:"left: "+D+"px",duration:0.35-0.3*C/(this.params.groupSize-1),transition:Effect.Transitions.easeTo};if(C==0){B.afterFinish=function(){A.each(function(I){I.setStyle({position:"",left:""});var J=this.currentImageLink;if(J){this.setSelectedImage(J)}else{this.setSelectedImage(A[0].down("a"))}}.bind(this));var H=$A([{el:this.bck,op:this.bgOpacity}]);if(this.cGrp!=0){H.push({el:this.prv,op:1})}if(this.cGrp<this.tGrps.length-1){H.push({el:this.nxt,op:1})}H.each(function(I){I.el.setStyle({opacity:0});I.el.showByClass();new Effect.Morph(I.el,{style:"opacity: "+I.op,duration:0.25})});this.cls.showByClass();this.opn.hideByClass();this.eff=false;this.thOpn=true;this.createNewThumbnailGroup(this.cGrp+1)}.bind(this)}new Effect.Morph(A[C],B);D-=E}}},scrollThumbnailList:function(C,D){C.preventDefault();if(this.eff){return}this.eff=true;var B,E,A;if(D=="next"){B=this.cGrp+1}else{B=this.cGrp-1}E=this.tGrps[B].wrapper;A=this.tGrps[this.cGrp].wrapper;if(B==this.tGrps.length-1){this.nxt.hideByClass()}if(B==0){this.prv.hideByClass()}E.showByClass();new Effect.Morph(this.thLst,{style:"left: "+(-1*parseFloat(E.getStyle("left"))+this.offset)+"px",duration:0.35,transition:Effect.Transitions.sinoidal,afterFinish:function(){A.hideByClass();if(B<this.tGrps.length-1){this.nxt.showByClass()}if(B>0){this.prv.showByClass()}this.eff=false}.bind(this)});if(B<this.tGrps.length-1){this.createNewThumbnailGroup(B+1)}this.cGrp=B},changeDisplayImage:function(B){var A=Element.extend(B.findElement("a"));B.preventDefault();if(A==this.currentImageLink){return}if(A){var D=new Element("img",{src:A.href});this.unsetSelectedImage();this.setSelectedImage(A);var C=this.img;new Effect.Morph(C,{style:"opacity: 0",duration:0.25,afterFinish:function(){C.update(D);new Effect.Morph(C,{style:"opacity: 1",duration:0.25})}})}},setSelectedImage:function(A){this.currentImageLink=A;A.up("li").addClassName("current")},unsetSelectedImage:function(){var A=this.currentImageLink;if(A){A.up("li").removeClassName("current")}}});var PkgCardToggle=Class.create();PkgCardToggle.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){var B=this.element.getFirstElementByClassName("titleLink");var A=(new Element("a").update(B.innerHTML).addClassName("link")).insert({top:this.params.collapseImg}).insert({top:this.params.expandImg});A.observe("click",this.toggle.bindAsEventListener(this));B.replace(A);if(this.params.expanded){this.swapIcon(this.element)}},toggle:function(B){if(this.element.next().hasClassName(this.params.targetClass)){this.element.next().toggleByClass()}else{var A=$(this.element.up("."+this.params.parentClass)).getElementsByClassName(this.params.targetClass)[0].clone(true);A.showByClass();Page.initializeDOMFragment(A);this.element.insert({after:A})}this.swapIcon(this.element)},swapIcon:function(A){$A(A.getElementsByTagName("img")).each(function(B){B.toggleByClass()})}});var PkgMatrix=Class.create(Abstract.Agent,{initExtend:function(){this.headTable=$$(".pkgHeaderGroup")[0];this.element.on("mouseover",this.over.bind(this));this.element.on("mouseout",this.out.bind(this))},over:function(B){var D=B.findElement("td.pkgMatrixCell");if(D&&D!=document){var A=D.parentNode.down("th"),C=$(this.headTable.tBodies[0].rows[0].cells[D.cellIndex-1]);if(A&&C){[D,A,C].each(function(E){E.addClassName("hover")})}}},out:function(B){var D=B.findElement("td.pkgMatrixCell");if(D&&D!=document){var A=D.parentNode.down("th"),C=$(this.headTable.tBodies[0].rows[0].cells[D.cellIndex-1]);if(A&&C){[D,A,C].each(function(E){E.removeClassName("hover")})}}}});var PopupWindow=Class.create();PopupWindow.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,windowProps:"width=620,height=400,left=20,top=20,resizable=yes,scrollbars=yes,status=yes",windowName:"popWin",initExtend:function(){this.element.target=this.windowName;Event.observe(this.element,"click",this.popWindow.bindAsEventListener(this))},popWindow:function(B){var A=window.open("",this.windowName,this.windowProps);A.focus();if(this.mboxParams){if(window.mboxUpdate&&window.mboxFactoryDefault&&mboxFactoryDefault.get(this.mboxId)){mboxUpdate(this.mboxId,this.mboxParams)}}if(B){B.stopPropagation()}}});PopupWindow.FullSize=Class.create();PopupWindow.FullSize.prototype=Object.extend(new PopupWindow(),{windowProps:"width=720,height=500,left=0,top=0,resizable=yes,toolbar=yes,location=yes,scrollbars=yes,status=yes",windowName:"popWinFullSize"});PopupWindow.FullSizeNoToolBar=Class.create();PopupWindow.FullSizeNoToolBar.prototype=Object.extend(new PopupWindow(),{windowProps:"width=720,height=500,left=0,top=0,resizable=yes,toolbar=no,location=yes,scrollbars=yes,status=yes",windowName:"popWinFullSizeNoToolBar"});PopupWindow.LargeSize=Class.create();PopupWindow.LargeSize.prototype=Object.extend(new PopupWindow(),{windowProps:"width=800,height=600,left=0,top=0,resizable=yes,toolbar=yes,location=yes,scrollbars=yes,status=yes",windowName:"popWinLargeSize"});PopupWindow.LargeSizeNoToolBar=Class.create();PopupWindow.LargeSizeNoToolBar.prototype=Object.extend(new PopupWindow(),{windowProps:"width=800,height=600,left=0,top=0,resizable=yes,toolbar=no,location=yes,scrollbars=yes,status=yes",windowName:"popWinLargeSizeNoToolBar"});PopupWindow.FullWindow=Class.create();PopupWindow.FullWindow.prototype=Object.extend(new PopupWindow(),{windowProps:"width="+screen.availWidth+",height="+screen.availHeight+",left=0,top=0,resizable=yes,toolbar=no,location=yes,scrollbars=yes,directories=no,status=no",windowName:"popWinFullScreen"});PopupWindow.CurrencyConverter=Class.create();PopupWindow.CurrencyConverter.prototype=Object.extend(new PopupWindow(),{windowProps:"width=450,height=255,left=0,top=0,resizable=yes,toolbar=no,location=no,scrollbars=no,status=no",windowName:"popWinCurrencyConverter"});PopupWindow.VirtualTour=Class.create();PopupWindow.VirtualTour.prototype=Object.extend(new PopupWindow(),{windowProps:"width=750,height=600,left=0,top=0,resizable=yes,toolbar=no,location=yes,scrollbars=yes,status=yes",windowName:"popWinVirtualTour",mboxId:"691",mboxParams:"virtualTourClicked=true"});PopupWindow.FullSite=Class.create();PopupWindow.FullSite.prototype=Object.extend(new PopupWindow(),{windowProps:"width=1024,height=700,left=0,top=0,resizable=yes,toolbar=yes,location=yes,scrollbars=yes,status=yes,directories=yes",windowName:"popWinFullSite"});var Print=Class.create();Print.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){window.print()}});ProductNav=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){Page.initializeLazyAgents(this.element);this.radios=this.element.select(".radio input");this.radios.each(function(A){A.on("click",this.selectProduct.bind(this));if(A.checked){this.currentType=A.value}}.bind(this))},isAjaxUpdateEnabled:function(){return this.params.quickSearch&&Page.isDOMReady},selectProduct:function(C){var B=C.element();var A=B.value;if(A!=this.currentType){document.fire("webtrends:multiTrackEvent",{"DCSext.rbck":A});if(this.isAjaxUpdateEnabled()&&A!="cru"){this.element.fire("agent:showIntrastitial");if(this.request){this.request.abort()}var D=A.substring(0,10)=="thirdParty";var E=D?"/helper/searchFormThirdParty":"/";this.request=new Ajax.PartialPage(E,{parameters:"quickSearch=true&pathId=home&rep=form&type="+A+"&adChannel="+this.params.adChannel,onSuccess:function(F){this.element.fire("agent:hideIntrastitial");this.request=null}.bind(this),onFailure:function(){log.error("No response from /shop/searchForm");this.request=null}.bind(this)});this.currentType=A}else{location.href=B.getAttribute("data-url")}}}});var ProgressBar=Class.create();ProgressBar.prototype={initialize:function(A,B){this.progress=0;this.container=$(A);this.bar=new Element("div");this.bar.setStyle({width:"100%",height:"100%",position:"absolute",top:"0px",right:"0px"});this.container.appendChild(this.bar);this.width=this.bar.getDimensions().width;this.options={interval:0.25,step:1};Object.extend(this.options,B||{})},start:function(){this.executer=new PeriodicalExecuter(this.step.bind(this,this.options.step),this.options.interval)},stop:function(){if(this.executer){this.executer.stop()}},step:function(A){this.progress=Math.min(100,this.progress+A);this.bar.setStyle({width:(this.width-Math.floor((parseInt(this.progress,10)/100)*this.width))+"px"});if(this.progress>=100){this.stop()}}};var ProgressIndicatorAgent=Class.create(Abstract.Agent,{initExtend:function(){new ProgressIndicator(this.element,this.params.radius,this.params.symbol)}});var PullDownContent=Class.create();PullDownContent.prototype=Object.extend(new Abstract.Agent(),{lazy:true,initExtend:function(){this.isMoving;this.element.hide();document.observe("pullDown:show",this.showContent.bindAsEventListener(this));document.observe("pullDown:hide",this.hideContent.bindAsEventListener(this))},showContent:function(A){if(!this.isMoving&&this.params.sourceKey in A.memo.message){this.isMoving=true;document.body.style.cursor="wait";new Effect.BlindDown(this.element,{duration:0.5,afterFinish:function(){this.isMoving=false;document.body.style.cursor="default"}.bind(this)})}},hideContent:function(A){if(!this.isMoving&&this.params.sourceKey in A.memo.message){this.isMoving=true;document.body.style.cursor="wait";new Effect.BlindUp(this.element,{duration:0.5,afterFinish:function(){this.isMoving=false;document.body.style.cursor="default"}.bind(this)})}}});var QuickSearch=Class.create();QuickSearch.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(!this.params.instructions){log.error("QuickSearch: No instruction content found")}this.instructions=this.params.instructions;this.element.insert({before:this.instructions});this.instructions=this.element.previous();this.link=$(this.instructions.getElementsByTagName("A")[0]);if(!this.link){log.error("QuickSearch: No link found in instruction content")}this.link.observe("click",this.showContent.bindAsEventListener(this))},showContent:function(A){this.instructions.remove();this.element.showByClass();A.preventDefault()}});var RadioAsLink=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){if(!this.params.name){log.error("RadioAsLink: Missing arg");return}if(!this.params.value){this.params.value=""}var C="control radio",D="";if(this.params.checked){C+=" checked";D='checked="checked"'}var B=new Element("label",{"class":C,"data-agent":'{"type":"Radio"}'});var A="<input "+D+' name="'+this.params.name+'" type="radio" value="'+this.params.value+'" data-url="'+this.element.href+'" /><span class="primaryRadioMessage">'+this.element.innerHTML+"</span></label>";B.update(A);this.element.replace(B).purge();Page.initializeDOMFragment(B,true)}});var RateCalendar=Class.create(Abstract.Agent,{initExtend:function(){this.isPartial=false;this.calendarContainerReference=this.element;this.params.mcOptions.tearDown=this.addDialogContentToRecentlyViewedBox.bind(this);this.dialogObject=new Microcontent(this.element.select(".miniAirFormTrigger a"),{jsTemplate:{id:this.params.templateId,dataAttributeName:"data-mini-air-form"}},this.params.mcOptions);this.attachEventHandlers(false);if(this.params.intrastitialMessage){this.intrastitial=new Intrastitial(this.params.intrastitialMessage,$(this.element.parentNode),true)}},addDialogContentToRecentlyViewedBox:function(B){var E;var C;if(B){E=this.recentlyViewedList;C=this.recentlyViewedHeader}else{var A=$(this.dialogObject.markup.mainInfo).getFirstElementByClassName("airFareDatesContainer");E=A&&A.innerHTML;C=A&&this.dialogObject.markup.mainInfo.getFirstElementByClassName("dateSelectionHeading").innerHTML}if(E){if(!this.recentlyViewedList||B){this.element.down(".rateCalendar").insert({after:this.params.recentlyViewedMarkup})}try{this.recentlyViewedList=E;this.recentlyViewedHeader=C;Page.initializeDOMFragment($(this.element).getFirstElementByClassName("airFareDatesContainer").update(E));$(this.element).getFirstElementByClassName("recentlyViewedHeader").update(C)}catch(D){log.error("Could not update recently viewed box with elements from microcontent.")}}},fetch:function(A){A.preventDefault();this.dialogObject.close();this.intrastitial.show();new Ajax.PartialRequest(encodeURI($(Event.findElement(A,"a")).readAttribute("href")),{onComplete:function(B){this.initPartial(B)}.bind(this),method:"get"})},ajaxSubmit:function(B){this.dialogObject.close();this.intrastitial.show();var A=B.element();new Ajax.PartialRequest(A.form.action,{parameters:$(A.form).serialize(),onComplete:function(C){this.initPartial(C)}.bind(this),method:"get"})},attachEventHandlers:function(A){if(A){this.dialogObject.attachTriggers($(this.calendarContainerReference).select(".miniAirFormTrigger a"))}$A(this.calendarContainerReference.getElementsByClassName("monthLink")).each(function(B){$(B).observe("click",this.fetch.bindAsEventListener(this))}.bind(this));$A(this.calendarContainerReference.getElementsByTagName("select")).each(function(B){$(B).observe("change",this.ajaxSubmit.bindAsEventListener(this))}.bind(this))},initPartial:function(A){this.dialogObject.close();this.calendarContainerReference.update(A.responseText);this.addDialogContentToRecentlyViewedBox(true);this.attachEventHandlers(true);this.intrastitial.hide()}});var ReadMore=Class.create(Abstract.Agent,{beforeDOMReady:true,minLinesForFade:6,initExtend:function(){if(!this.params.lines||!this.params.moreLink){log.error("ReadMoreFade: Missing required param");return}if(this.params.minLinesForFade){this.minLinesForFade=this.params.minLinesForFade}var B=this.element;B.addClassName("readMoreAgent");var I=B.getLayout().get("height");var G=B.getStyle("line-height");G=G.substring(G.length-2)=="pt"?Math.round(parseFloat(G)*4/3):parseFloat(G);var H=G*this.params.lines;if(I<=H){return}H-=G;var C=new Element("div",{"class":"readMoreContent"});$A(B.childNodes).each(function(J){C.appendChild(J)});B.appendChild(C);if(this.params.lines>this.minLinesForFade){var A=new Element("div",{"class":"fade"})}var E=new Element("span").update(this.params.moreLink).down();E.addClassName("moreLink");E.writeAttribute("href","#");E.observe("click",function(J){if(A){A.remove()}E.remove();if(D){B.insert({bottom:D})}C.setStyle({height:"",overflow:""});J.preventDefault()});var F=function(J){if(D){D.remove()}if(A){B.insert({bottom:A})}B.insert({bottom:E});C.setStyle({height:H+"px",overflow:"hidden"});if(J){J.preventDefault()}};F();if(this.params.lessLink){var D=new Element("span").update(this.params.lessLink).down();D.addClassName("lessLink");D.writeAttribute("href","#");D.observe("click",F)}}});var RecentlyViewed=Class.create(Abstract.Agent,{initExtend:function(){var C="recentlyViewedAll";var A=".hidereveal";var D=".delete";var B=this.element;B.on("click",D,function(F,E){F.preventDefault();new Ajax.Request(E.readAttribute("href"),{method:"get",onSuccess:(function(I){if(E.hasClassName("deleteAll")||B.select(D).length<=2){B.up().remove()}else{var G=E.up().remove();var J=B.down("."+C);if(!G.hasClassName(C)&&J){J.removeClassName(C);J.removeClassName("block");J.removeClassName("noneBlock")}var H=B.down(A);if(!B.down("."+C)&&H){H.remove()}}})})})}});var RecentlyViewedWebtrends=Class.create(Abstract.Agent,{initExtend:function(){Event.observe(this.element,"click",function(A){this.element.fire("webtrends:multiTrackEvent",this.params.tags)}.bind(this))}});var RecentSearchClear=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.element.observe("click",this.clear.bindAsEventListener(this))},clear:function(B){B.preventDefault();var A=new Ajax.Request("/helper/clearRecentSearch?type="+this.params.type,{onSuccess:function(D){var C=D.responseText.unescapeJSON().evalJSON();var E=this.element.up(".recentSearch");E.insert({before:C.message});E.hide()}.bind(this)})}});var RedirectOpenerOnClose=Class.create();RedirectOpenerOnClose.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.popupWindow=self;this.popupOpener=self.opener;if(this.popupOpener!=null&&this.params.sendOpenerTo!=null&&this.params.sendOpenerTo!=""){this.redirectOpenerURL=this.params.sendOpenerTo;Event.observe(self,"unload",this.redirectOpener.bindAsEventListener(this))}else{log.error(this.popupWindow+" missing sendOpenerTo param, or window is not a popup")}},redirectOpener:function(){if(this.redirectOpenerURL!=null){this.popupOpener.location.href=this.redirectOpenerURL}}});var RemoveLinks=Class.create();RemoveLinks.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){$A(this.element.getElementsByTagName("a")).each(function(B){var C=document.createElement("span");C.innerHTML=B.innerHTML;var A=B.parentNode;A.replaceChild(C,B)})}});var Reveal=Class.create();Reveal.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){if(!this.params.label){log.error('Reveal: Required parameter "label" missing');return}if(this.params.selector){this.hiddenElements=this.element.select(this.params.selector)}else{this.hiddenElements=this.element.getElementsByTagAndClass("*","noneBlock")}if(this.hiddenElements.length!=0){this.revealLink=new Element("a",{"class":"link revealLink",href:"#"});this.revealLink.update(this.params.label);this.element.insert({bottom:this.revealLink});this.revealLink.observe("click",this.reveal.bindAsEventListener(this))}},reveal:function(C){this.revealLink.remove();this.revealLink=null;for(var B=0,A=this.hiddenElements.length;B<A;B++){this.hiddenElements[B].showByClass()}C.preventDefault()}});var ScriptContent=Class.create(Abstract.Agent,{initExtend:function(){if(!this.params.multiContent&&!this.params.content){log.warning("ScriptContent.initExtend: exiting because required params missing or invalid");return}this.insertionsToProcess=(this.params.multiContent?this.params.multiContent:[this.params]);this.insertionsToProcess.each(function(H){var D=H.targetClass?this.element.getFirstElementByClassName(H.targetClass):this.element;if(!D){log.warning("ScriptContent.initExtend: exiting because target node [class: "+H.targetClass+"] was not valid")}else{var G=new Element(H.containerType||"div");G.innerHTML=H.content;if(H.containerClass){G.className=H.containerClass}var B;if(!H.containerType){var F=document.createDocumentFragment();B=G.childElements();while(G.firstChild){F.appendChild(G.firstChild)}G=F}var A=H.insertAtTop?D.insertBefore(G,D.firstChild):D.appendChild(G);if(H.containerType){B=[A]}if(this.clickHandler){var I=this.clickHandler.bindAsEventListener(this,H);for(var C=0,E=B.length;C<E;C++){Event.observe(B[C],"click",I)}}for(var C=0,E=B.length;C<E;C++){Page.initializeDOMFragment(B[C],true)}}}.bind(this))}});var ScriptContentCloseWindow=Class.create(ScriptContent,{clickHandler:function(){window.close()}});var ScriptContentCloseSelf=Class.create(ScriptContent,{clickHandler:function(){self.close()}});var ScriptContentCloseMobilePopup=Class.create(ScriptContent,{clickHandler:function(){var A=location.href;window.history.back();setTimeout(function(){if(A==location.href&&location.hash){location.hash=""}},0)}});var ScriptContentPrint=Class.create(ScriptContent,{clickHandler:function(){window.print()}});var ScriptContentGoTo=Class.create(ScriptContent,{clickHandler:function(B,A){window.location.href=A.url}});var ScriptContentAccountBookingPanel=Class.create(ScriptContent,{clickHandler:function(A){Event.stop(A);window.location=Event.element(A)}});var SearchForm=Class.create(Abstract.Agent,{initExtend:function(){this.numErrors=0;this.dialogManager=new DialogManager(this.element);this.form=this.element.getFirstElementByClassName("searchFormForm","form");this.initializeChildren();var A=this.form.strm;if(A){A.value=true}this.showListener=this.showIntrastitial.bindAsEventListener(this);this.hideListener=this.hideIntrastitial.bindAsEventListener(this);document.observe("agent:showIntrastitial",this.showListener);document.observe("agent:hideIntrastitial",this.hideListener)},showIntrastitial:function(A){if(A.memo.form&&this.form!=A.memo.form){return}if(!this.element.descendantOf(document)){this.destroy();return}this.dialogManager.close();this.element.addClassName("hidden");if(this.pi){this.pi.start()}else{this.pi=new ProgressIndicator();this.element.insert({top:this.pi.spinnerElement});this.pi.start()}},hideIntrastitial:function(C){if(C.memo.form&&this.form!=C.memo.form){return}if(!this.element.descendantOf(document)){this.destroy();return}if(this.pi){this.pi.stop()}this.element.removeClassName("hidden");if(C&&C.memo&&C.memo.newMarkup){this.destroy();var B=this.element.parentNode;this.element=null;B.update(C.memo.newMarkup.stripNoScripts());try{Page.initializeDOMFragment(B)}catch(A){Errors.capture(A,"SearchForm Ajax initialization failed")}}},destroy:function(){this.numErrors=0;document.stopObserving("agent:showIntrastitial",this.showListener);document.stopObserving("agent:hideIntrastitial",this.hideListener)},addError:function(){this.numErrors++;if(this.numErrors==1){this.disableSubmits(true)}},disableSubmits:function(A){var B=this.form.select(".buttons .submit input");B.each(function(C){C.disabled=A;if(A){C.addClassName("disabled")}else{C.removeClassName("disabled")}})},removeError:function(){if(this.numErrors>0){this.numErrors--}if(this.numErrors==0){this.disableSubmits(false)}}});SearchForm.SearchTypes=Class.create(Abstract.ChildAgent,{initExtend:function(B,A){this.searchForm=A;$A(this.element.getElementsByTagName("input")).each(function(C){Event.observe(C,"click",this.onClick.bind(this));if(C.checked){this.currentType=C.value}}.bind(this))},onClick:function(E){var B=E.findElement(),A=B.value;if(A!=this.currentType){var D=B.readAttribute("data-url").toQueryParams();var C=$(this.searchForm.form);if(this.params.path=="air"){document.fire("dateInput:clearField");D=C.serialize({hash:true,submit:false});delete D.search;delete D["aph.search"];D["ar.newType"]=A}D.rep="form";if(this.request){this.request.abort()}this.currentType=A;this.element.fire("agent:showIntrastitial",{form:this.searchForm.form});this.request=new Ajax.PartialPage(C.action,{method:"GET",parameters:D,onFailure:this.failure.bind(this),onSuccess:this.success.bind(this)})}},failure:function(){log.error("SearchForm: No response.");this.request=null},success:function(){this.element.fire("agent:hideIntrastitial",{form:this.searchForm.form});this.request=null}});SearchForm.HotelTravelers=Class.create(Abstract.ChildAgent,{initExtend:function(B,A){this.searchForm=A;this.element=B;["addRoom","removeRoom"].each(function(D){var C=new Element("a",{"class":"link "+D,href:"#"}).update(this.params[D+"Text"]);C.observe("click",this[D].bind(this));this[D+"Item"]=new Element("li").update(C)}.bind(this));this.addRemove=B.down("ul.addRemove").remove();this.updateLinks()},updateLinks:function(){var B=this.addRemove;while(B.firstChild){B.removeChild(B.firstChild)}var C=this.element.getElementsByTagName("fieldset");var A=C.length;if(A<this.params.maxRooms){B.appendChild(this.addRoomItem)}if(A>1){B.appendChild(this.removeRoomItem)}$(C[A-1]).down(".guests").appendChild(B)},addRoom:function(B){B.preventDefault();if(this.busy){return}this.busy=true;var C=this.searchForm.form.serialize()+"&hotel.addRoom=true";var A=new Ajax.Request("/helper/hotelRoom",{method:"get",parameters:C,onSuccess:this.insertNewRoom.bind(this),onFailure:this.failure.bind(this)})},insertNewRoom:function(A){var C=this.searchForm.form.down(".travelers");var D=new Element("div").update(A.responseText);var F=D.down("ul.addRemove");if(F){F.remove()}var E=D.childElements();for(var B=0;B<E.length;B++){C.appendChild(E[B]);Page.initializeDOMFragment(E[B],true)}this.updateLinks();this.busy=false},failure:function(){log.error("No response from /helper/hotelRoom");this.busy=false},removeRoom:function(A){A.preventDefault();var B=this.element.getElementsByTagName("fieldset");$(B[B.length-1]).remove();this.updateLinks()}});SearchForm.MultiroomGuests=Class.create(Abstract.ChildAgent,{initExtend:function(C,A){this.guestLabels=this.element.select("label");this.guestDropdowns=this.element.select("label select");this.guestDropdowns.each(function(D,E){if(E!=0){D.removeChild(D.down("option"))}});this.dialogManager=new DialogManager(this.element);this.multipleRoomsOptionText=this.params.multipleRoomsText;this.visibilityClass=this.params.visibilityClass;var B=$(A.form).down("div.rooms select");this.showGuestCounts(B);this.element.showByClass();Event.observe(B,"change",this.onChange.bindAsEventListener(this))},onChange:function(B){var A=Event.element(B);this.showGuestCounts(A);if(A.value<=1){this.dialogManager.close()}},showGuestCounts:function(A){var D=(A)?parseInt(A.value):1;var B=(D<=this.guestLabels.length)?D:1;var C=this.visibilityClass;var E=this.multipleRoomsOptionText;this.guestLabels.each(function(H,F){var G=H.down("span");if(B==1&&G){G.addClassName(C);this.element.removeClassName("extraRoomSelectsShown")}else{G.removeClassName(C);this.element.addClassName("extraRoomSelectsShown")}if((B==E)||(F<B)){H.removeClassName("noneInlineBlock")}else{H.addClassName("noneInlineBlock")}}.bind(this))}});SearchForm.APHButton=Class.create(Abstract.ChildAgent,{initExtend:function(C,B){var A=this.element;var D=function(F){if(F&&A.disabled){return}A.disabled=F;A[(F)?"addClassName":"removeClassName"]("disabled")};var E=B.form.select(this.params.selectors);E.each(function(F){if(F.checked){D(true)}F.observe("click",function(){var G=false;if(this.checked){D(true)}else{E.each(function(H){if(H.checked){G=true;throw $break}});D(G)}})})}});SearchForm.CarLocationTypes=Class.create(Abstract.ChildAgent,{initExtend:function(B,A){this.searchForm=A;this.parentForm=$(this.searchForm.form);if(this.params.pickupType){this.pickup=B.getElementsBySelector('[name="'+this.params.pickupType+'"]')[0]}else{this.pickup=B.getElementsBySelector('[name="car.pickupType"]')[0]}Event.observe(this.pickup,"change",this.requestForm.bindAsEventListener(this));if(this.params.dropoffType){this.dropoff=B.getElementsBySelector('[name="'+this.params.dropoffType+'"]')[0]}else{this.dropoff=B.getElementsBySelector('[name="car.dropoffType"]')[0]}if(this.dropoff){Event.observe(this.dropoff,"change",this.requestForm.bindAsEventListener(this))}this.element.down(".submit").remove()},requestForm:function(D){var B="";if(/\/home/.test(location.pathname)){B="&quickSearch=true"}var C=this.searchForm.form.action;if(/\/book/.test(location.pathname)){C="/book/bookingpath";var A=this.searchForm.form.elements.execution.value;B="&quickSearch=true&changeSearch=true&_eventId=changeSearchXSellCar&execution="+A}document.fire("dateInput:clearField");var E=Form.serialize(this.searchForm.form).deleteQueryStringParam("search",false)+B;if(/\/book/.test(location.pathname)){new Ajax.Request(C,{parameters:E,onSuccess:this.updateMarkupManually.bind(this),onFailure:this.failure})}else{new Ajax.PartialPage(C+"?rep=form",{parameters:E,onFailure:this.failure})}this.element.fire("agent:showIntrastitial",{form:this.searchForm.form})},updateMarkupManually:function(A){this.element.fire("agent:hideIntrastitial",{newMarkup:A.responseText,form:this.searchForm.form})},failure:function(){log.error("No response from /shop/searchForm")}});SearchForm.CarDriverAgeNote=Class.create(Abstract.ChildAgent,{initExtend:function(C,B){var A=C.getElementsByTagName("select")[0];this.ageNote=C.getNthElementByClassName("alert",[1],"p");if(A.value=="21"){this.toggleNoteDisplay()}Event.observe(A,"change",this.toggleNoteDisplay.bindAsEventListener(this))},toggleNoteDisplay:function(){this.ageNote.toggleByClass()}});SearchForm.FauxRoomsDropdown=Class.create(Abstract.ChildAgent,{initExtend:function(C,B){this.formSubmits=$A();$A(B.element.getElementsByClassName("submit")).each(function(H){this.formSubmits.push(H.getElementsByTagName("input")[0])}.bind(this));this.multiBookingAlert=C.getFirstElementByClassName("alert","p");this.multipleRoomsOptionText=this.params.multipleRoomsText;if(this.multipleRoomsOptionText!=null&&this.formSubmits.length>0){if(C.getFirstElementByClassName("readOnlyValue","span")){var G=C.getFirstElementByClassName("readOnlyValue","span");var E=G.innerHTML;var D=Element.extend(C.getElementsByTagName("input")[0]);if(D){var A=D.name;var F=D.value;D.remove()}else{A="fakeRoomsSelect";F=E}optionText=E;this.fauxSelect=Element.extend(document.createElement("select"));this.fauxSelect.name=A;this.addOptionToSelect(this.fauxSelect,F,optionText);G.parentNode.appendChild(this.fauxSelect);G.remove()}else{if(C.getElementsByTagName("select")[0]){this.fauxSelect=C.getElementsByTagName("select")[0]}else{log.error("fauxRoomsDropdown: nothing to convert to a select");return false}}this.addOptionToSelect(this.fauxSelect,this.multipleRoomsOptionText,this.multipleRoomsOptionText);this.checkForFauxSelection();Event.observe(this.fauxSelect,"change",this.checkForFauxSelection.bindAsEventListener(this))}},addOptionToSelect:function(A,D,C){var B=Element.extend(document.createElement("option"));B.value=D;B.update(C);A.appendChild(B)},checkForFauxSelection:function(){if(this.fauxSelect.options[this.fauxSelect.selectedIndex].value==this.multipleRoomsOptionText){this.formSubmits.each(function(A){if(!A.disabled){this.toggleSubmitEnabled(A)}}.bind(this));this.multiBookingAlert.showByClass();this.element.addClassName("hasAlertShown")}else{this.formSubmits.each(function(A){if(A.disabled){this.toggleSubmitEnabled(A)}}.bind(this));this.multiBookingAlert.hideByClass();this.element.removeClassName("hasAlertShown")}},toggleSubmitEnabled:function(A){A=$(A);A.disabled=!A.disabled;A.toggleClassName("disabled")}});SearchForm.RailFlyCheckbox=Class.create(Abstract.ChildAgent,{initExtend:function(B,A){var C=B.getParentByTagName("form");this.checkbox=B.down('input[type="checkbox"]');this.textField=C.down('.location input[type="text"]');if(this.params.naCheckBoxName){this.naCheckbox=C.down('input[name="'+this.params.naCheckBoxName+'"]');if(!this.naCheckbox){log.error("SearchForm.RailFlyCheckbox: nearby airports checkbox not found");return}}if(!this.checkbox){log.error("SearchForm.RailFlyCheckbox: checkbox not found");return}else{if(!this.textField){log.error("SearchForm.RailFlyCheckbox: text field not found");return}}if(this.checkbox.checked){this.checkbox.value="";this.disableTextField()}Event.observe(this.checkbox,"click",this.toggleTextField.bindAsEventListener(this))},toggleTextField:function(){this.checkbox.checked?this.disableTextField():this.enableTextField()},disableTextField:function(){this.oldTextFieldValue=this.textField.value;this.textField.value=this.params.railAndFlyText?this.params.railAndFlyText:"";this.textField.disabled=true;if(this.naCheckbox){this.naCheckbox.checked=false;this.naCheckbox.disabled=true}log.info("RailFlyCheckbox: disabled departure text")},enableTextField:function(){this.textField.value=this.oldTextFieldValue?this.oldTextFieldValue:"";this.textField.disabled=false;if(this.naCheckbox){this.naCheckbox.disabled=false}log.info("RailFlyCheckbox: enabled departure text")}});SearchForm.OandDValidator=Class.create(Abstract.ChildAgent,{initExtend:function(C,B){var A=C.select('.location input[type="text"]');this.searchForm=B;this.element=C;this.errorSelector=".message-"+this.params.errorCode;if(A.length<2){log.error("SearchForm.OandDValidator: could not find origin and destination fields");return}this.originField=A[0];this.destinationField=A[1];this.originField.observe("blur",this.validateLocations.bind(this));this.destinationField.observe("blur",this.validateLocations.bind(this));var D=this.element.select(this.errorSelector);if(D.length>0){D.each(function(){this.searchForm.addError()}.bind(this))}else{this.validateLocations()}},validateLocations:function(C){var D=this.originField.value.strip().toLowerCase();var A=this.destinationField.value.strip().toLowerCase();var B=this.element.down(this.errorSelector);if(D&&D===A){if(!B){this.searchForm.addError();this.element.insert({top:this.params.errorMsgMarkup})}}else{if(B){B.remove();this.searchForm.removeError()}}}});SearchForm.XSliceMatchValidator=Class.create(Abstract.ChildAgent,{initExtend:function(C,B){this.element=C;this.errorSelector=".message-"+this.params.errorCode;this.locations=this.element.select('.location input[type="text"]');this.searchForm=B;if(this.locations.length<4){log.error("SearchForm.XSliceMatchValidator: could not find origin and destination fields");return}var D=this.validateLocations.bind(this);for(var A=0;A<this.locations.length;A++){this.locations[A].observe("blur",D)}var E=this.element.select(this.errorSelector);if(E.length>0){E.each(function(){this.searchForm.addError()}.bind(this))}else{this.validateLocations()}},validateLocations:function(F){var A=$A();var G=this.locations.length;for(var E=0;E<G;E++){A[E]=this.locations[E].value.strip().toLowerCase()}this.element.select(this.errorSelector).each(function(H){H.remove();this.searchForm.removeError()}.bind(this));for(var D=0;D<(G-2);D+=2){if(A[D]&&A[D+1]){for(var C=D+2;C<G;C+=2){if(A[D]===A[C]&&A[D+1]===A[C+1]){this.element.fire("webtrends:multiTrackEvent",{"DCSext.er":this.params.errorCode});var B=this.locations[C].up(".locations");B.insert({top:this.params.errorMsgMarkup});this.searchForm.addError();return}}}}}});SearchFormChildTravelers=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.dropdown=this.element.down("select");this.childTravelers=this.element.getParentByTagName("fieldset").down(".childTravelers");this.childAgeDropdowns=this.childTravelers.select(".select");this.dropdown.observe("change",this.showChildAges.bind(this));this.showChildAges()},showChildAges:function(){var B=this.dropdown.value;for(var A=0;A<this.childAgeDropdowns.length;A++){if(A<B){this.childAgeDropdowns[A].showByClass()}else{this.childAgeDropdowns[A].hideByClass()}}if(B>0){this.childTravelers.showByClass()}else{this.childTravelers.hideByClass()}}});SearchForm.MoreSearchOptions=Class.create(Abstract.ChildAgent,{initExtend:function(D,C){var B=this.params.url.unescapeHTML();var A=B.toQueryParams();this.element.on("click",function(F){F.preventDefault();var E=C.form.serialize({hash:true,submit:false});delete E.search;delete E["aph.search"];document.fire("lightbox:open",{url:B.split("?")[0]+"?"+Object.toQueryString(E)})})}});SearchForm.MboxUpdater=Class.create(Abstract.ChildAgent,{initExtend:function(D,C){var B=this.params.dataMboxUpdate;if(B){var A=C.form.serialize();var E=false;$A(C.form.elements).each(function(F){$(F).on("blur",function(){var G=C.form.serialize();if(!E&&G!=A){document.fire("mbox:update",{mboxData:B});E=true}})})}else{log.error("SearchForm.MboxUpdater: invalid mbox data.")}}});var SeatMap=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.element.addClassName("interactiveMap");this.element.on("click",".available",this.handleSeatClicked.bind(this));document.on("agent:seatSelected",this.handleSeatSelected.bind(this));document.on("agent:resetSeats",this.handleResetSeats.bind(this));this.dialog=new Microcontent(this.element.select(".blocked"),{string:this.params.mcContent},Object.extend({compact:true,triggerEvent:"click",classes:"seatMapDialog",dialogGroup:"seatMap"},this.params.mcOptions));document.on("tab:change",function(){this.dialog.close()}.bind(this))},initSeats:function(){if(!this.seats){var B=$H();var A=this.element.select(".available");A.each(function(C){var D=new SeatMapCell(C,this.params.flightNumber,this.params.premiumLabel,this.params.exitLabel);B.set(D.data.seatId,D);C.store("seat",D)},this);this.seats=B}},handleSeatClicked:function(C,B){var A;this.dialog.close();this.initSeats();var D=B.retrieve("seat");if(D.data.isExit){A=new Element("div").update(this.params.confirmMarkup);A.on("click",".exitAccept",function(E){E.preventDefault();document.fire("agent:seatMapSeatClicked",Object.clone(D.data))});document.fire("modal:open",{content:A})}else{document.fire("agent:seatMapSeatClicked",Object.clone(D.data))}},handleSeatSelected:function(C){var A=C.memo.traveler;var B=C.memo.seatId;if(C.memo.flightNumber!=this.params.flightNumber){return}this.initSeats();this.seats.values().each(function(D){if(D.data.seatId==B){D.setTraveler(A)}else{if(D.data.travelerNumber==A.number){D.clear()}}})},handleResetSeats:function(A){if(A.memo.flightNumber!=this.params.flightNumber){return}this.dialog.close();this.initSeats();this.seats.values().each(function(B){if(A.memo.canClearSeats){B.clear()}else{B.reset()}})}});var SeatMapTravelerList=Class.create(Abstract.Agent,{initExtend:function(){this.travelers=$H();this.element.select(".traveler").each(function(D,C){var A=D.down("select");var B=new SeatMapTraveler(D,this.params.flightNumber,C+1,this.params.chooseSeatText);this.travelers.set(B.number,B);if(B.isModified(this.params.canClearSeats)){this.initResetLink()}A.store("traveler",B)},this);document.on("agent:seatMapSeatClicked",this.handleSeatClicked.bind(this));document.on("agent:seatSummaryCellClicked",this.handleSummaryCellClicked.bind(this));this.element.on("click",".traveler .control",this.handleTravelerClicked.bind(this));this.element.on("change","select",this.handleSelectChanged.bind(this));this.element.on("click",".resetSelections",this.handleResetClicked.bind(this));this.selectTraveler(1)},initResetLink:function(){if(!this.resetLink&&this.params.resetLinkText){var A=this.element.down(".travelers");this.resetLink=new Element("a",{"class":"resetSelections block",href:"#"});this.resetLink.innerHTML=this.params.resetLinkText;A.insert(this.resetLink)}},handleSeatClicked:function(A){if(A.memo.flightNumber!=this.params.flightNumber){return}this.selectSeat(A.memo.seatId,A.memo);this.selectNextTraveler()},handleSummaryCellClicked:function(A){if(A.memo.flightNumber!=this.params.flightNumber){return}this.selectTraveler(A.memo.travelerNumber)},handleTravelerClicked:function(C,B){var A=C.findElement("input");if(A){this.selectTraveler(A.value)}},handleSelectChanged:function(B,A){this.selectTraveler(A.retrieve("traveler").number);this.selectSeat(A.value)},handleResetClicked:function(A){A.stop();this.travelers.values().each(function(B){if(this.params.canClearSeats){B.clear()}else{B.reset()}},this);if(this.resetLink){this.resetLink.hideByClass()}this.selectTraveler(1);document.fire("agent:resetSeats",{flightNumber:this.params.flightNumber,canClearSeats:this.params.canClearSeats})},selectTraveler:function(A){if(A!=this.selectedTraveler){this.travelers.values().each(function(B){if(B.number==A){B.select();this.selectedTraveler=B}else{B.deselect()}},this)}this.element.fire("agent:fixedContentChanged",{focusRequested:true})},selectNextTraveler:function(){var A=this.travelers.values().length;var C=this.selectedTraveler.number;for(var D=C+1;D<=A;D++){if(!this.travelers.get(D).hasSeat()){this.selectTraveler(D);return}}for(var B=1;B<C;B++){if(!this.travelers.get(B).hasSeat()){this.selectTraveler(B);return}}this.selectTraveler(this.selectedTraveler)},selectSeat:function(C,A){var B=false;this.travelers.values().each(function(E){if(E.number==this.selectedTraveler.number){E.setSeat(C);document.fire("agent:seatSelected",{flightNumber:this.params.flightNumber,traveler:E,seatId:C})}else{if(E.seatId==C){E.clear()}}if(E.isModified(this.params.canClearSeats)){B=true}},this);if(A&&(A.isPremium||A.isExit)){var D=[];if(A.isPremium){D.push(A.premiumLabel)}if(A.isExit){D.push(A.exitLabel)}this.selectedTraveler.setLabel("- "+D.join(", "))}if(B){if(this.resetLink){this.resetLink.showByClass()}else{this.initResetLink()}}else{if(this.resetLink){this.resetLink.hideByClass()}}this.element.fire("agent:fixedContentChanged")}});var SeatMapTraveler=Class.create({initialize:function(D,G,F,A){this.element=D;this.number=F;this.selectEl=D.down("select");this.defaultIndex=this.selectEl.selectedIndex;this.chooseSeatText=A;this.controlEl=new Element("label",{"class":"control radio"});var C=this.element.down(".primaryLabel").clone(true);this.radioEl=new Element("input",{type:"radio",name:"travelers"+G,value:F});this.controlEl.insert(C);this.controlEl.insert({top:this.radioEl});this.element.insert({top:this.controlEl});var B=this.element.down(".radio .name");this.name=B.innerHTML.strip();this.seatEl=new Element("span",{"class":"selectedSeat"});B.innerHTML=B.innerHTML+" -";var E=this.selectEl.options[this.selectEl.selectedIndex];this.seatEl.innerHTML=E.value||E.text;B.insert(this.seatEl)},select:function(){this.element.addClassName("selected");this.radioEl.checked=true;this.radioEl.focus();if(this.selectEl.selectedIndex==0&&this.chooseSeatText){this.seatEl.innerHTML=this.chooseSeatText}},deselect:function(){this.element.removeClassName("selected");this.radioEl.checked=false;if(this.selectEl.selectedIndex==0){this.seatEl.innerHTML=this.selectEl.options[this.selectEl.selectedIndex].text}},setSeat:function(A){this.seatId=A;this.selectEl.value=A;this.seatEl.innerHTML=A},setLabel:function(A){this.seatEl.innerHTML=this.seatEl.innerHTML+A},clear:function(){this.seatId=null;this.selectEl.selectedIndex=0;this.seatEl.innerHTML=this.selectEl.options[this.selectEl.selectedIndex].text},reset:function(){this.selectEl.selectedIndex=this.defaultIndex;this.seatEl.innerHTML=this.selectEl.options[this.selectEl.selectedIndex].text},isModified:function(A){return(A)?(this.selectEl.selectedIndex>0):(this.selectEl.selectedIndex!=this.defaultIndex)},hasSeat:function(){return(this.selectEl.selectedIndex>0)}});var SeatMapCell=Class.create({initialize:function(B,E,D,A){this.element=B;this.descriptionEl=this.element.down(".description");this.travelerEl=this.element.down(".traveler");this.data={travelerNumber:0,isPremium:false,isExit:false,flightNumber:E,premiumLabel:D,exitLabel:A};var C=this.element.readAttribute("data-seat");if(C){Object.extend(this.data,C.unescapeJSON().evalJSON())}if(this.data.travelerNumber>0){this.data.travelerName=this.element.readAttribute("title")}this.defaultTraveler={name:this.data.travelerName,number:this.data.travelerNumber}},setTraveler:function(A){if(this.data.travelerNumber!=A.number){if(!this.travelerEl){this.travelerEl=new Element("span",{"class":"traveler"});this.element.insert(this.travelerEl)}this.data.travelerNumber=A.number;this.data.travelerName=A.name;this.travelerEl.innerHTML=A.number;this.descriptionEl.hide();this.element.addClassName("selected");this.element.setAttribute("title",A.name);this.element.fire("agent:seatMapCellUpdated",Object.clone(this.data))}},clear:function(){if(this.data.travelerNumber!=0){this.data.travelerNumber=0;this.data.travelerName="";if(this.travelerEl){this.travelerEl.innerHTML=""}this.descriptionEl.show();this.element.removeClassName("selected");var A=this.data.seatId;if(this.data.isPremium){A+=this.data.premiumLabel}this.element.setAttribute("title",A);this.element.fire("agent:seatMapCellUpdated",Object.clone(this.data))}},reset:function(){if(this.defaultTraveler.number==0){this.clear()}else{this.setTraveler(this.defaultTraveler)}}});var SeatMapPreferences=Class.create(Abstract.Agent,{initExtend:function(){this.element.on("click",".radio",this.handleClick.bind(this))},handleClick:function(F,E){var C=E.down("input");var D=E.down("span");if(!D){log.error("Invalid markup for SeatMapPreferences radio button");return}var A=E.down(".seatId");var B={travelerNumber:this.params.travelerNumber,preference:D.innerHTML.strip(),flightNumber:this.params.flightNumber};if(A){B.preference=A.innerHTML.strip();B.seatId=C.value}this.element.fire("agent:seatPreferencesUpdated",B)}});var SeatSummary=Class.create(Abstract.Agent,{initExtend:function(){document.on("agent:seatPreferencesUpdated",this.handleUpdate.bind(this));document.on("agent:seatMapCellUpdated",this.handleUpdate.bind(this));this.element.on("click",".seatSelection",this.handleClick.bind(this))},initCells:function(){if(!this.cells){var A=this.element.select(".seatSelection");this.cells=$A();A.each(function(D,C){var B=this.cells[C]=new SeatSummaryCell(D,this.params.premiumMarkup);D.store("seatSummaryCell",B)},this)}},handleClick:function(C,B){this.initCells();var A=B.retrieve("seatSummaryCell");this.element.fire("agent:seatSummaryCellClicked",{flightNumber:A.data.flightNumber,travelerNumber:A.data.travelerNumber})},handleUpdate:function(A){this.initCells();this.cells.each(function(B){if(B.data.flightNumber!=A.memo.flightNumber){return}if(B.data.travelerNumber==A.memo.travelerNumber){B.update(A.memo)}else{if(B.data.seatId&&B.data.seatId==A.memo.seatId){B.clear()}}})}});var SeatSummaryCell=Class.create({initialize:function(B,A){this.element=B;this.premiumMarkup=A;this.link=B.down("a");this.status=B.down(".seatStatus");this.endColor=B.up("tr").getStyle("backgroundColor").parseColor("#ffffff");this.data={preference:this.link.innerHTML};var C=B.readAttribute("data-seat");if(C){Object.extend(this.data,C.unescapeJSON().evalJSON())}this.origSeat=this.data.seatId},update:function(B){var A;this.data.seatId=B.seatId;if(B.preference){A=B.preference}else{A=B.seatId;if(B.isPremium){A+=this.premiumMarkup}}if(this.status){if(B.seatId==this.origSeat){this.status.show()}else{this.status.hide()}}this.link.innerHTML=A;this.highlight()},clear:function(){this.link.innerHTML=this.data.preference;this.data.seatId=null;if(this.status){this.status.hide()}this.highlight()},highlight:function(){var A=new Effect.Highlight(this.element,{startcolor:"#FEF19B",endcolor:this.endColor,restorecolor:this.endColor,duration:3})}});var SeatPreferences=Class.create();SeatPreferences.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){this.target=this.element.down(this.params.preferencesTarget);if(!this.target){log.error('SeatPreferences: Required parameter "preferencesTarget" missing');return}this.element.on("click",(function(A){switch(A.target.value){case this.params.hideOnValue:this.target.hideByClass();break;case this.params.showOnValue:this.target.showByClass();break;default:break}}).bindAsEventListener(this))}});var SecondaryDate=Class.create(Abstract.Agent,{initExtend:function(){this.dateDiv=new Element("div").addClassName(this.params.divClass);this.element.appendChild(this.dateDiv);document.observe("secondaryDate:changeDate",this.changeDate.bindAsEventListener(this));document.fire("calendar:formatDate",{dateInputIndex:this.params.index,callback:this.setDate.bind(this)})},setDate:function(A){this.dateDiv.update(A)},changeDate:function(A){if(this.params.index==A.memo.index){document.fire("calendar:formatDate",{dateInputIndex:this.params.index,callback:this.setDate.bind(this)})}}});var SelectHideReveal=Class.create();SelectHideReveal.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){log.debug("SelectHideReveal...");this.dropDown=$(this.element.getElementsByTagName("select")[0]);this.parentNode=this.dropDown.getParentByClassName(this.params.parentClass);this.toggleElements();Event.observe(this.dropDown,"change",this.toggleElements.bindAsEventListener(this))},toggleElements:function(){var C=(this.dropDown[this.dropDown.selectedIndex].value!=="")?this.dropDown[this.dropDown.selectedIndex].value:this.params.blankOptionName;for(var B=0;B<this.params.listOptions[C].showClasses.length;B++){$A(this.parentNode.getElementsByClassName(this.params.listOptions[C].showClasses[B])).each(function(D){D.showByClass()})}for(var A=0;A<this.params.listOptions[C].hideClasses.length;A++){$A(this.parentNode.getElementsByClassName(this.params.listOptions[C].hideClasses[A])).each(function(D){D.hideByClass()})}}});var SendFlightStatus=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){this.flightStatusTypes=Element.extend(this.element.getElementsByTagName("input"));this.hideAndReveal();function A(B){this.hideAndReveal()}Event.observe(this.flightStatusTypes[0],"click",A.bindAsEventListener(this));Event.observe(this.flightStatusTypes[1],"click",A.bindAsEventListener(this))},hideAndReveal:function(){if(!this.flightStatusTypes[0].checked&&this.flightStatusTypes[1].checked){this.element.getElementsByClassName("showFlightAlerts")[0].style.display="inline"}else{if(this.flightStatusTypes[0].checked&&!this.flightStatusTypes[1].checked){this.element.getElementsByClassName("showFlightAlerts")[0].style.display="none"}}}});var SendOntimeAlerts=Class.create();SendOntimeAlerts.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:true,initExtend:function(){this.onTimeAlerts=this.element.getElementsByTagName("input");this.hourPrefSelect=this.element.getElementsByTagName("select")[0];this.hideAndReveal();Event.observe(this.onTimeAlerts[0],"click",this.hideAndReveal.bindAsEventListener(this));Event.observe(this.hourPrefSelect,"change",this.hideAndReveal.bindAsEventListener(this))},hideAndReveal:function(){if(this.onTimeAlerts[0].checked){this.hourPrefSelect.disabled=false;if(this.params.hourPrefInfo==""){return}if(this.params.hourPrefInfo.indexOf(this.hourPrefSelect.options[this.hourPrefSelect.selectedIndex].value)>=0){this.element.getElementsByClassName("alert")[0].style.display="inline"}else{this.element.getElementsByClassName("alert")[0].style.display="none"}}else{if(!this.onTimeAlerts[0].checked){this.hourPrefSelect.disabled=true;if(this.params.hourPrefInfo!==""){this.element.getElementsByClassName("alert")[0].style.display="none"}}}}});var SessionRenew=Class.create(Abstract.Agent,{initExtend:function(A){A.on("click",function(B){Page.SessionRenew();A.fire("modal:close");B.preventDefault()})}});var Slider=Class.create(Abstract.Agent,{restricted:true,snapInterval:false,tickSubdivisions:false,tickInterval:false,sliderPosition:"bottom",trackType:"lessThan",hideTicks:false,initExtend:function(){Object.extend(this,this.params||{});this.useTouchEvents=("ontouchstart" in document);this.container=this.getContainer();this.fields=this.getFields();if(!this.fields||this.fields.length<=0){log.error("Slider: Invalid slider backing fields");return}this.min=this.getMin();this.max=this.getMax();if(this.min===undefined||this.max===undefined){log.error("Slider: Invalid slider min/max");return}this.initMarkup()},getMin:function(){return this.min},getMax:function(){return this.max},show:function(){if(!this.track){this.initMarkup()}},initMarkup:function(){this.disabled=this.disabled||(this.min==this.max)||(this.snapInterval&&(this.max-this.min==this.snapInterval));var B=new Element("div",{"class":"slider "});if(this.fields.length===1){B.addClassName(this.trackType)}var C="sliderTrack";if(this.hideTicks==true){C=C+" noTicks"}this.track=new Element("div",{"class":C});this.track.setStyle({position:"relative"});var H=document.createDocumentFragment();this.ticks=[];if(this.tickInterval&&(this.min!=this.max)){this.tickInterval=this.tickInterval/this.tickSubdivisions;var A=(Math.floor(this.min/this.tickInterval)+1)*this.tickInterval;var D=(Math.ceil(this.max/this.tickInterval)-1)*this.tickInterval;var K=Math.ceil((D-A)/this.tickInterval)+3;var L=(Math.floor(this.min/this.tickSubdivisions/this.tickInterval)+1)*this.tickInterval*this.tickSubdivisions;var M=(Math.round((L-A)/this.tickInterval)+1)%this.tickSubdivisions}else{var K=2}for(var F=0;F<K;F++){var J;if(F==0){J="tick lowRange"}else{if(F==K-1){J="tick highRange"}else{if(F%this.tickSubdivisions==M){J="tick"}else{J="minorTick"}}}var G=new Element("div",{"class":J});this.ticks.push(G);H.appendChild(G)}this.trackLeft=new Element("div",{"class":"trackLeft"});H.appendChild(this.trackLeft);this.trackRight=new Element("div",{"class":"trackRight"});H.appendChild(this.trackRight);this.handles=[];for(var F=0;F<this.fields.length;F++){var E=new Element("div",{"class":"handle"});if(this.fields.length>1){E.addClassName("handle"+F)}E.style.cursor="pointer";this.handles[F]={element:E,index:F,field:this.fields[F]};H.appendChild(E)}this.track.appendChild(H);var O=new Element("div",{"class":"sliderRange"});O.appendChild((new Element("span",{"class":"rangeLow"})).insert(this.rangeMinLabel||this.min));O.appendChild((new Element("span",{"class":"rangeHigh"})).insert(this.rangeMaxLabel||this.max));B.insert(this.track);if(this.sliderPosition==="top"){O.addClassName("aboveTrack");B.insert({top:O})}else{B.insert(O)}if(this.sliderPosition==="top"){this.container.insert({top:B})}else{this.container.insert(B)}for(var F=0;F<this.fields.length;F++){var I=this.fields[F];I.index=F;this.updateField(I);I.store("lastValue",I.value);if(this.min!=this.max){this.addFieldEventListeners(I)}}this.fieldTimestamp=new Date();this.update();if(this.disabled){this.disable()}else{if(this.useTouchEvents){B.observe("touchstart",this.startDrag.bindAsEventListener(this))}else{B.observe("mousedown",this.startDrag.bindAsEventListener(this))}}this.slider=B},getFields:function(){return this.fields||this.container.select(".textInput input")},addFieldEventListeners:function(A){A.observe("blur",this.checkFieldAndUpdate.bindAsEventListener(this));A.observe("keypress",this.handleFieldKeyPress.bindAsEventListener(this))},getContainer:function(){var A=this.container;if(!A&&this.selector){A=this.element.down(this.selector)}A=A||this.element;return A},startDrag:function(D){D.preventDefault();var B=D.element();for(var A=0;A<this.handles.length;A++){if(this.handles[A].element==B){var F=this.handles[A];break}}if(!F||(this.useTouchEvents&&D.touches.length>1)||(!this.useTouchEvents&&!D.isLeftClick())){return}document.body.style.cursor="pointer";var E=0;if(this.restricted&&F.index>0){var C=this.handles[F.index-1].element;E=parseInt(C.getStyle("marginLeft"))}var G=this.width;if(this.restricted&&F.index<this.handles.length-1){var C=this.handles[F.index+1].element;G=parseInt(C.getStyle("marginLeft"))}this.drag={handle:F,mousePos:this.getEventX(D),handlePos:parseInt(B.getStyle("marginLeft")),minimum:E,maximum:G};if(this.useTouchEvents){this.eventListeners={touchmove:this.continueDrag.bindAsEventListener(this),touchend:this.stopDrag.bindAsEventListener(this),touchcancel:this.stopDrag.bindAsEventListener(this),selectstart:this.preventTextSelection.bindAsEventListener(this)}}else{this.eventListeners={mousemove:this.continueDrag.bindAsEventListener(this),mouseup:this.stopDrag.bindAsEventListener(this),selectstart:this.preventTextSelection.bindAsEventListener(this)}}for(var A in this.eventListeners){document.observe(A,this.eventListeners[A])}},continueDrag:function(A){A.preventDefault();if(!this.drag||(this.useTouchEvents&&A.touches.length>1)){return}var C=this.getEventX(A)-this.drag.mousePos+this.drag.handlePos;if(C<this.drag.minimum){C=this.drag.minimum}else{if(C>this.drag.maximum){C=this.drag.maximum}}var B=this.pixelsToValue(C);if(this.snapInterval){var B=this.snapValue(B);C=this.valueToPixels(B)}this.moveHandle(this.drag.handle,C);if(new Date()-this.fieldTimestamp>=50){this.updateField(this.drag.handle.field,B);this.handleDrag(this.drag.handle)}},stopDrag:function(B){B.preventDefault();if(!this.drag){return}var D=parseInt(this.drag.handle.element.getStyle("marginLeft"));var C=this.pixelsToValue(D);if(this.snapInterval){C=this.snapValue(C)}this.updateField(this.drag.handle.field,C);this.handleUpdate(this.drag.handle);this.drag=false;document.body.style.cursor="auto";for(var A in this.eventListeners){document.stopObserving(A,this.eventListeners[A])}this.eventListeners=null},moveHandle:function(A,B){A.element.style.marginLeft=B+"px";if(A.index==0){this.trackLeft.style.width=B+"px"}if(A.index==this.handles.length-1){this.trackRight.style.width=this.width-B+"px"}},updateField:function(B){var A=arguments[1]||B.value;A=this.correctFieldValue(B,A);if(B.value!=A){B.value=A;this.fieldTimestamp=new Date()}},handleDrag:function(A){},handleUpdate:function(A){if(A.field.retrieve("lastValue")!=A.field.value){A.field.store("lastValue",A.field.value);this.fireFilterEvent([this.fields[A.index]]);this.fireWebTrendsEvent()}},checkFieldAndUpdate:function(C){var B=C.element();for(var A=0;A<this.handles.length;A++){if(this.handles[A].field==B){var F=this.handles[A];break}}if(!F){return}this.updateField(F.field);var E=this.correctHandleValue(this.correctFieldValue(F.field));var D=this.min;if(this.restricted&&F.index>0){D=this.correctFieldValue(this.handles[F.index-1].field)}var G=this.max;if(this.restricted&&F.index<this.handles.length-1){G=this.correctFieldValue(this.handles[F.index+1].field)}if(E<D){E=D}else{if(E>G){E=G}}if(this.snapInterval){E=this.snapValue(E)}this.moveHandle(F,this.valueToPixels(E));this.handleDrag(F);this.handleUpdate(F)},handleFieldKeyPress:function(A){if(Event.KEY_RETURN==A.keyCode){this.checkFieldAndUpdate(A)}},update:function(){this.width=this.track.getWidth();for(var A=0;A<this.handles.length;A++){var C=this.correctFieldValue(this.handles[A].field);this.moveHandle(this.handles[A],this.valueToPixels(C))}this.ticks[0].setStyle({marginLeft:this.valueToPixels(this.min)+"px"});var B=(Math.floor(this.min/this.tickInterval)+1)*this.tickInterval;for(var A=1;A<this.ticks.length-1;A++){this.ticks[A].setStyle({marginLeft:this.valueToPixels(B)+"px"});B+=this.tickInterval}this.ticks[this.ticks.length-1].setStyle({marginLeft:this.valueToPixels(this.max)+"px"})},disable:function(){for(var A=0;A<this.handles.length;A++){this.handles[A].element.hide()}for(var A=0;A<this.fields.length;A++){this.fields[A].disabled=true}var B=Math.round(this.width/2);this.trackLeft.addClassName("disabled");this.trackRight.addClassName("disabled");this.trackLeft.style.width=B+"px";this.trackRight.style.width=this.width-B+"px"},pixelsToValue:function(B){var A=((this.max-this.min)*B/this.width)+this.min;return this.correctHandleValue(A)},valueToPixels:function(A){A=this.correctHandleValue(A);return Math.round((A-this.min)/(this.max-this.min)*this.width)},correctHandleValue:function(A){if(A===""||A===undefined||A===null||isNaN(A)){if(this.trackType==="lessThan"){A=this.max}else{A=this.min}}if(A<this.min){A=this.min}else{if(A>this.max){A=this.max}}return A},correctFieldValue:function(B){var A=arguments[1]||B.value;return parseFloat(A).toFixed(0)},snapValue:function(A){var B=Math.round(A/this.snapInterval)*this.snapInterval;if(this.max-A<A-B){B=this.max}else{if(A-this.min<B-A){B=this.min}}return B},preventTextSelection:function(A){A.preventDefault()},getEventX:function(A){if(this.useTouchEvents){var C=A.touches[0];var B=C.pageX}else{var B=A.pointerX()}return B},fireFilterEvent:function(A){var B={};A=A||this.fields;A.each(function(C){B[C.name]=C.value},this);this.container.fire("agent:filter",{params:B})},fireWebTrendsEvent:function(){}});var FlightTimesFilter=Class.create(Slider,{beforeDOMReady:true,sliderPosition:"top",hideTicks:true,snapInterval:1,hidden:false,interacted:false,initExtend:function($super){$super();this.labels=this.container.select("label.select");this.initToggle();if(this.fields[0].selectedIndex!=this.min||this.fields[1].selectedIndex!=this.max){this.interacted=true;this.show()}},getMin:function(){return 0},getMax:function(){return this.fields[1].options.length-1},getFields:function(){return this.fields||this.container.select("select")},initToggle:function(){if(this.showLinkText&&this.hideLinkText){var E=new Element("div",{"class":"collapseLink"});this.expandCollapseLink=new Element("a",{href:"#"});E.insert(this.expandCollapseLink);this.container.insert({top:E});this.expandCollapseLink.on("click",this.handleToggle.bind(this));if(this.hidden){this.expandCollapseLink.insert(this.showLinkText)}else{this.expandCollapseLink.insert(this.hideLinkText)}}else{if(this.toggleLabelText){var B=this.element.down(".subheading");if(!B){log.error("No toggle element found.");return}var A=B.down(".toggle");if(!A){A=new Element("div",{"class":"toggle"});B.insert(A)}var C=new Element("label");this.toggle=new Element("input",{type:"checkbox","class":"agentCtrl"});var D=new Element("span");C.insert(this.toggle);D.insert(this.toggleLabelText);C.insert(D);A.insert(C);if(!this.hidden){this.toggle.checked=true}C.on("click",this.handleToggle.bind(this))}}},initMarkup:function($super){if(this.hidden){return}$super();this.sliderLabel=new Element("span",{"class":"sliderLabel"});this.sliderLabelValue=new Element("span");this.sliderLabelValue.insert(this.getLabelValue());this.sliderLabel.insert(this.sliderLabelText);this.sliderLabel.insert(this.sliderLabelValue);if(this.sliderPosition=="bottom"){this.slider.insert({top:this.sliderLabel})}else{this.slider.insert(this.sliderLabel)}this.startColor=this.track.getStyle("color").parseColor("#ffffff");this.endColor=this.container.getStyle("backgroundColor").parseColor("#ffffff")},addFieldEventListeners:function(A){A.observe("change",this.checkFieldAndUpdate.bindAsEventListener(this))},updateField:function(B){var A=arguments[1];if(A===undefined||A===null){return}B.selectedIndex=A;this.fieldTimestamp=new Date()},updateLabel:function(){if(this.sliderLabelValue){this.sliderLabelValue.update(this.getLabelValue())}},correctFieldValue:function(D){var B=arguments[1]||D.selectedIndex;var A=D.options.length-1;var C=0;if(D.index>0){C=this.fields[D.index-1].selectedIndex}if(D.index<this.fields.length-1){A=this.fields[D.index+1].selectedIndex}if(B<C){B=C}else{if(B>A){B=A}}return B},handleDrag:function(A){var B=this.fields[A.index];this.updateLabel();this.interacted=true;this.sliderLabel.highlight({startcolor:this.startColor,endcolor:this.endColor,restorecolor:this.endColor,duration:4})},fireWebTrendsEvent:function(){this.element.fire("webtrends:multiTrackEvent",{"DCSext.fctkw":"Flight Times Filter"})},getLabelValue:function(){var A=this.fields[0].options[this.fields[0].selectedIndex].text;var B=this.fields[1].options[this.fields[1].selectedIndex].text;if(A!=B){return A+" - "+B}else{return A}},handleToggle:function(B){var A=(this.toggle)?this.toggle.checked:this.hidden;if(A){this.show()}else{this.hide()}},hide:function(){if(!this.hidden){this.hidden=true;this.slider.hide();if(this.toggle){this.toggle.checked=false;for(var B=0;B<this.fields.length;B++){var C=this.fields[B];var A=(B==0)?0:C.options.length-1;C.selectedIndex=A;if(this.labels[B]){this.labels[B].remove()}}if(this.interacted){this.fireFilterEvent();this.interacted=false}this.updateLabel()}if(this.expandCollapseLink){this.expandCollapseLink.update(this.showLinkText)}}},show:function(){if(this.hidden){this.hidden=false;if(this.toggle){this.toggle.checked=true;if(this.slider){for(var A=0;A<this.labels.length;A++){if(this.sliderLabel){this.sliderLabel.insert({before:this.labels[A]})}else{this.container.insert(this.labels[A])}}}}if(this.expandCollapseLink){this.expandCollapseLink.update(this.hideLinkText)}if(this.slider){this.slider.show();if(!this.disabled){this.update()}}else{this.initMarkup()}}}});var PriceFilter=Class.create(Slider,{beforeDOMReady:true,sliderPosition:"top",hideTicks:true,initExtend:function($super){$super();this.fields[0].observe("focus",this.handleFocus.bindAsEventListener(this));this.fields[0].observe("blur",this.handleBlur.bindAsEventListener(this));this.fields[0].observe("keypress",this.handleKeyPress.bindAsEventListener(this))},initMarkup:function($super){$super();this.startColor=this.track.getStyle("color").parseColor("#ffffff");this.endColor=this.fields[0].getStyle("backgroundColor").parseColor("#ffffff")},correctFieldValue:function(B){var A=arguments[1]||B.value;if(A){if(typeof A==="string"){A=A.strip();var D=1.1;var C=D.toLocaleString().substring(1,2);if(C!="."){A=A.replace(C,".")}else{A=A.replace(",","")}}A=parseFloat(A).toFixed(0);if(isNaN(A)||A<0){A=B.retrieve("lastValue")||""}}return A},handleFocus:function(A){this.addHighlight(A.element())},handleBlur:function(A){this.fadeHighlight(A.element())},handleKeyPress:function(B){if(Event.KEY_RETURN==B.keyCode){var A=B.element();A.blur()}},handleDrag:function(A){var B=this.fields[A.index];B.blur();B.highlight({startcolor:this.startColor,endcolor:this.endColor,restorecolor:this.endColor,duration:4})},fireWebTrendsEvent:function(){this.element.fire("webtrends:multiTrackEvent",{"DCSext.fctkw":"Total Price Filter"})}});var ReviewerScoreFilter=Class.create(Slider,{beforeDOMReady:true,tickInterval:1,tickSubdivisions:2,correctFieldValue:function(D){var C=arguments[1]||D.value;C=this.correctHandleValue(C);C=parseFloat(C).toFixed(1);var A=parseFloat(this.max).toFixed(1);var B=parseFloat(this.min).toFixed(1);if(D.index>0){B=this.fields[D.index-1].value}if(D.index<this.fields.length-1){A=this.fields[D.index+1].value}if(C<B){C=B}else{if(C>A){C=A}}return C},fireWebTrendsEvent:function(){this.element.fire("webtrends:multiTrackEvent",{"DCSext.fctkw":"Reviewer score","WT.dl":"6","WT.ti":"Slider: Reviewer score"})},fireFilterEvent:function(){this.element.fire("agent:filter")}});var SlideShow=Class.create(Abstract.Agent,{initExtend:function(){this.container=Element.extend(this.element.parentNode);if(this.params.compactMode){this.container.addClassName("compactImageGallery")}var D=new ProgressIndicator(this.container.parentNode);this.startSlideShowOnLoad=false;this.endlessLoop=false;this.imagesPerGroup=this.params.thumbnailCount?Number(this.params.thumbnailCount):4;this.slideShowController=false;this.slideShowWaitTime=2;this.images=$A();this.currentImageIndex=0;this.loadAdvanceImages=2;this.timeToWaitForLoad=1500;$A(this.container.getElementsByTagName("A")).each(function(G,F){var H=Element.extend(G);this.images.push({imageRef:H,initialized:false,parent:Element.extend(H.parentNode),imageIndex:F});if(F===0){this.images[F].parent.addClassName("current")}if(F>=this.imagesPerGroup){this.images[F].parent.hide()}}.bind(this));this.galleryExists=this.images.length>1;if(!this.galleryExists||this.params.compactMode){this.element.hide()}this.groups=this.images.inGroupsOf(this.imagesPerGroup);this.currentThumbGroup=0;this.initializeThumbGroup(this.currentThumbGroup);var E=new Element("div").addClassName("mainImage");this.image=new Element("img",{alt:""});E.appendChild(this.image);this.header=new Element("div").addClassName("galleryHeader");var C=new Element("div").addClassName("galleryControls");if(this.params.virtualTourLink){var B=new Element("div").addClassName("tourLink");B.update(this.params.virtualTourLink);this.header.appendChild(B);Page.initializeDOMFragment(B)}this.currentPosition=new Element("span").update(this.currentImageIndex+1);C.appendChild(this.currentPosition);C.appendChild(new Element("span").update("&nbsp;"+this.params.numText.strip()+"&nbsp;"+this.images.length));if(this.galleryExists){this.nextButtonMarkup=this.params.nextButtonMarkup;this.previousButtonMarkup=this.params.previousButtonMarkup;this.nextButtonDisabledMarkup=this.params.nextButtonDisabledMarkup;this.previousButtonDisabledMarkup=this.params.previousButtonDisabledMarkup;this.nextButton=new Element("a",{href:"#"}).update(this.nextButtonMarkup);this.previousButton=(new Element("a",{href:"#"}).update(this.previousButtonMarkup));this.startSlideshowButtonMarkup=this.params.startSlideshowButtonMarkup;this.stopSlideshowButtonMarkup=this.params.stopSlideshowButtonMarkup;this.showButton=new Element("a",{href:"#"}).addClassName("slideshowControl").update(this.startSlideshowButtonMarkup);var A=function(F){if(F.findElement("a")===this.previousButton){this.previousClick(true)}if(F.findElement("a")===this.nextButton){this.nextClick(true)}if(F.findElement("a")===this.showButton){if(this.slideShowController){this.stopSlideShow()}else{this.startSlideShow()}}F.stop()}.bindAsEventListener(this);Event.observe(this.header,"click",A);C.insert({top:this.previousButton,bottom:this.nextButton});this.header.appendChild(C);this.header.appendChild(this.showButton)}this.container.appendChild(this.header);this.container.appendChild(E);this.showImage(0,0);if(this.galleryExists&&!this.params.compactMode){this.container.appendChild(this.setupThumbnails());this.element.show()}setTimeout(function(){D.stop();D.spinnerElement.remove();delete D;this.container.showByClass();if(this.startSlideShowOnLoad){this.startSlideShow()}}.bindAsEventListener(this),this.timeToWaitForLoad)},setupThumbnails:function(){var B=new Element("div").addClassName("slideshowThumbnails");B.appendChild(this.element);if(this.groups.length>1){this.backControl=this.previousButton.cloneNode(true).addClassName("backControl");this.forwardControl=this.nextButton.cloneNode(true).addClassName("forwardControl");B.insert({top:this.backControl,bottom:this.forwardControl})}var A=function(C){var F=C.target;if(C.findElement("a")===this.backControl){this.previousThumbGroup()}if(C.findElement("a")===this.forwardControl){this.nextThumbGroup()}if(F.hasClassName("thumbnail")){var E=this.images.detect(function(G){if(F.src==G.imageRef){return G}});this.showImage(this.currentImageIndex,E.imageIndex);var D=this.currentImageIndex+this.loadAdvanceImages;if(D>=this.images.length){D=0}if(!this.images[D].initialized){this.initializeThumbGroup(this.currentThumbGroup+1)}this.currentPosition.update(this.currentImageIndex+1)}this.stopSlideShow();C.stop()}.bindAsEventListener(this);Event.observe(B,"click",A);return B},startSlideShow:function(){if(!this.endlessLoop&&(this.currentImageIndex)+1==this.images.length){this.swapGroupVisibility(this.currentThumbGroup,0);this.showImage(this.currentImageIndex,0)}this.slideShowController=new PeriodicalExecuter(function(A){this.nextClick(false)}.bind(this),this.slideShowWaitTime);this.showButton.update(this.stopSlideshowButtonMarkup)},stopSlideShow:function(){if(this.slideShowController){this.slideShowController.stop()}this.slideShowController=false;this.showButton.update(this.startSlideshowButtonMarkup)},initializeThumbnail:function(B,A){var C=new Element("img",{src:this.images[A].imageRef.href,"class":"thumbnail"});B.update(C);this.images[A].initialized=true},initializeThumbGroup:function(B){for(var A=0;A<this.imagesPerGroup;A++){if(this.groups[B][A]){this.groups[B][A].groupIndex=B;this.initializeThumbnail(this.groups[B][A].imageRef,this.groups[B][A].imageIndex)}}},showImage:function(B,A){this.images[B].parent.removeClassName("current");this.currentImageIndex=A;this.currentPosition.update(this.currentImageIndex+1);this.image.src=this.images[A].imageRef.href;this.images[A].parent.addClassName("current");if(this.galleryExists){if(!this.endlessLoop&&A===0){this.disableLink(this.previousButton,"back")}else{this.enableLink(this.previousButton,"back")}if(!this.endlessLoop&&A===this.images.length-1){this.disableLink(this.nextButton,"forward")}else{this.enableLink(this.nextButton,"forward")}}},enableLink:function(A,B){A.innerHTML=((B=="back")?this.previousButtonMarkup:this.nextButtonMarkup)},disableLink:function(A,B){A.innerHTML=((B=="forward")?this.nextButtonDisabledMarkup:this.previousButtonDisabledMarkup)},nextClick:function(A){var D=this.currentImageIndex+1;var B=D>=this.images.length;if(this.endlessLoop&&B){D=0;B=false}if(!B){this.showImage(this.currentImageIndex,D);var E=this.currentImageIndex+this.loadAdvanceImages;if(E>=this.images.length){E=0}if(!this.images[E].initialized){var C=this.currentThumbGroup+1;if(C>this.groups.length){C=0}this.initializeThumbGroup(C)}if(this.currentThumbGroup!==this.images[this.currentImageIndex].groupIndex){this.swapGroupVisibility(this.currentThumbGroup,this.images[this.currentImageIndex].groupIndex)}B=(!this.endlessLoop&&this.currentImageIndex===this.images.length-1)}if(A||B){this.stopSlideShow()}},previousClick:function(A){var D=this.currentImageIndex-1;var B=D<0;if(this.endlessLoop&&B){D=this.images.length-1;B=false}if(!B){this.showImage(this.currentImageIndex,D);var E=this.currentImageIndex-this.loadAdvanceImages;if(E<=0){E=this.images.length-1}if(!this.images[E].initialized){var C=this.currentThumbGroup-1;if(C<=0){C=this.groups.length-1}this.initializeThumbGroup(C)}if(this.currentThumbGroup!==this.images[this.currentImageIndex].groupIndex){this.swapGroupVisibility(this.currentThumbGroup,this.images[this.currentImageIndex].groupIndex)}B=(!this.endlessLoop&&this.currentImageIndex===0)}if(A||B){this.stopSlideShow()}},nextThumbGroup:function(){var B=this.currentThumbGroup;var C=this.currentThumbGroup+1;var A=C>=this.groups.length;if(this.endlessLoop&&A){C=0;A=false}if(!A){if(!this.groups[C][0].initialized){this.initializeThumbGroup(C)}this.swapGroupVisibility(B,C)}},previousThumbGroup:function(){var B=this.currentThumbGroup;var C=this.currentThumbGroup-1;var A=C<0;if(this.endlessLoop&&A){C=this.groups.length-1;A=false}if(!A){if(!this.groups[C][0].initialized){this.initializeThumbGroup(C)}this.swapGroupVisibility(B,C)}},swapGroupVisibility:function(B,C){this.currentThumbGroup=C;for(var A=0;A<this.imagesPerGroup;A++){if(this.groups[B][A]){this.groups[B][A].parent.hide()}if(this.groups[C][A]){this.groups[C][A].parent.show()}}if(!this.endlessLoop&&C===0){this.disableLink(this.backControl,"back")}else{this.enableLink(this.backControl,"back")}if(!this.endlessLoop&&C===this.groups.length-1){this.disableLink(this.forwardControl,"forward")}else{this.enableLink(this.forwardControl,"forward")}}});var SplashOverlayDesktop=Class.create(Abstract.Agent,{initExtend:function(){if(!this.params.content){log.error("Required param missing for agent SplashOverlayDesktop.");return}document.observe("page:complete",this.initSplash.bind(this));if(this.params.webTrendsData){if(Page.initializationComplete){this.fireWebTrendsEvent()}else{document.observe("page:complete",this.fireWebTrendsEvent.bind(this))}}},initSplash:function(){document.fire("modal:open",{content:this.params.content});if(this.params.lightboxClassName){$("lightbox").addClassName(this.params.lightboxClassName)}if(this.params.removerSelector){$("lightbox").on("click",this.params.removerSelector,this.removeSplash.bind(this))}},fireWebTrendsEvent:function(){window.setTimeout(function(){this.element.fire("webtrends:multiTrackEvent",this.params.webTrendsData);if(this.params.lightboxClassName){var A=this.element.up("div."+this.params.lightboxClassName);if(A){A.remove().purge()}}}.bind(this),0)},removeSplash:function(A){document.fire("modal:close")}});var StreamingStatus=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){var C=this.element;var B=this.params.dataMboxUpdate;if(B){document.fire("mbox:update",{mboxData:B.gsub("'","")})}document.fire("agent:streamingUpdate",{url:this.params.url,numResults:this.params.numResults||0});var A=this.params.timedOutMessage;document.on("agent:streamingTimedOut",function D(E){if(C.descendantOf(document)){C.insert(A);Page.initializeDOMFragment(C,true)}else{log.debug("StreamingResults: element is no longer in document");document.stopObserving("agent:streamingError",D)}})}});var StreamingPoller=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.pollTimedOut=false;this.interval=this.params.interval||1;this.numResults=this.params.numResults||0;this.minResults=this.params.minResults||200;this.pollTimer=this.handlePollTimeout.bind(this).delay(this.params.pollTimeout||20);document.on("agent:streamingUpdate",this.handleStreamingUpdate.bind(this));document.on("agent:updatingResults",this.cancelPoll.bind(this))},handleStreamingUpdate:function(A){if(A.memo.url){log.info("StreamingPoller: results incomplete.");if(!this.intrastitial){this.intrastitial=new Intrastitial(this.params.message,$("main"),true);this.intrastitial.mask.addClassName("streamingIntrastitial");this.intrastitial.show()}this.numResults=A.memo.numResults||0;this.poll(A.memo.url)}else{log.info("StreamingPoller: results complete.");this.destroy()}},poll:function(A){if(this.pollTimedOut){return}this.request=new Ajax.StreamingPartialPage(A,{method:"get",onSuccess:function(D,C){if(this.pollTimedOut){return}var E=false;for(var B in C.modules){E=true;break}if(E){document.fire("agent:resultsUpdated")}else{this.delay=this.poll.bind(this).delay(this.interval,A)}if(this.intrastitial){this.intrastitial.resize()}}.bind(this),onFailure:function(B){log.error("StreamingPoller: Poll request failed.")}.bind(this)})},handlePollTimeout:function(){log.error("StreamingPoller: timed out.");document.fire("mbox:update",{mboxData:"283,timedout=true"});document.fire("webtrends:multiTrackEvent",{"DCSext.ARSRC":"ICE266_T"});this.pollTimedOut=true;if(this.numResults<this.minResults){document.fire("agent:streamingTimedOut")}this.destroy()},cancelPoll:function(){if(this.request){this.request.abort();this.request=null}if(this.delay){window.clearTimeout(this.delay)}if(this.intrastitial){this.intrastitial.destroy();this.intrastitial=null}},destroy:function(){this.cancelPoll();if(this.pollTimer){window.clearTimeout(this.pollTimer)}if(this.element){this.element.remove();this.element=null}}});var SubmitControlOnChange=Class.create();SubmitControlOnChange.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.control=this.element.getElementsByTagName("select")[0]||this.element.getElementsByTagName("input")[0];if(this.params.submitButtonName){this.submitButton=document.getElementsByName(this.params.submitButtonName)[0]}if(!this.control){log.error(this.type+": Required element undefined");return}if($(this.control).tagName=="SELECT"){this.control.observe("change",this.onChange.bindAsEventListener(this))}else{this.control.observe("click",this.onChange.bindAsEventListener(this))}},onChange:function(A){if(this.control.value){if(this.params.webtrendsLabel){this.element.fire("webtrends:multiTrackEvent",{"WT.ti":this.params.webtrendsLabel})}if(this.submitButton){this.submitButton.click()}else{$(this.control.form).down("input[type=submit]").click()}}}});var TableScroller=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){if(!this.params.numVisibleColumns||!this.params.scrollIncrement||!this.params.tableSelector||!this.params.scrollRightSelector||!this.params.scrollLeftSelector){log.error("TableScroller.initExtend: too few parameters")}else{this.table=this.element.down(this.params.tableSelector);this.scrollRightElem=this.element.down(this.params.scrollRightSelector);this.scrollLeftElem=this.element.down(this.params.scrollLeftSelector);if(!this.table||!this.scrollLeftElem||!this.scrollRightElem){log.error("TableScroller.initExtend: one or more required element not found")}else{if(this.params.classes){this.element.addClassName(this.params.classes)}this.gatherColumns();if(this.columns.length>this.params.numVisibleColumns){var A=new Element("span");A.innerHTML=this.params.scrollRightLabel;this.scrollRightElem.appendChild(A);var B=new Element("span");B.innerHTML=this.params.scrollLeftLabel;this.scrollLeftElem.appendChild(B);this.scrollPosition=0;this.scrollLeftElem.observe("click",this.scrollLeft.bindAsEventListener(this));this.scrollRightElem.observe("click",this.scrollRight.bindAsEventListener(this));this.updateView()}}}},gatherColumns:function(){if(!this.columns){var C=this.table.rows;this.columns=$A();for(var B=0;B<C.length;B++){var D=$(C[B]).childElements();for(var A=1;A<D.length;A++){if(!this.columns[A-1]){this.columns[A-1]=$A()}this.columns[A-1].push(D[A])}}}},updateView:function(){for(var C=0;C<this.columns.length;C++){var B=this.columns[C];if(C>=this.scrollPosition&&C<this.scrollPosition+this.params.numVisibleColumns){for(var A=0;A<B.length;A++){B[A].removeClassName("noneTableCell")}}else{for(var A=0;A<B.length;A++){B[A].addClassName("noneTableCell")}}}if(this.scrollPosition<=0){this.scrollLeftElem.addClassName("disabled");this.scrollLeftElem.removeClassName("link")}else{this.scrollLeftElem.removeClassName("disabled");this.scrollLeftElem.addClassName("link")}if(this.scrollPosition+this.params.numVisibleColumns>=this.columns.length){this.scrollRightElem.addClassName("disabled");this.scrollRightElem.removeClassName("link")}else{this.scrollRightElem.removeClassName("disabled");this.scrollRightElem.addClassName("link")}},scrollRight:function(){if(!this.scrollRightElem.hasClassName("disabled")){if(this.scrollPosition+this.params.scrollIncrement<this.columns.length){this.scrollPosition+=this.params.scrollIncrement}else{this.scrollPosition=this.columns.length}this.updateView()}},scrollLeft:function(){if(!this.scrollLeftElem.hasClassName("disabled")){if(this.scrollPosition-this.params.scrollIncrement>0){this.scrollPosition-=this.params.scrollIncrement}else{this.scrollPosition=0}this.updateView()}}});var TabMenu=Class.create();TabMenu.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.tabs=$A();this.id=this.params.id;this.parent=Element.extend(this.element.parentNode);this.container=Element.extend(this.parent.parentNode);this.parent.addClassName("tabBar");var B=this.element.getElementsByTagName("li");for(var C=0,A=B.length;C<A;C++){this.tabs.push(new Tab(B[C],this.container,this))}if(this.params.affectHistory){document.observe("hash:change",this.updateTabs.bindAsEventListener(this));document.fire("hash:check")}document.observe("tab:show",this.updateTabs.bindAsEventListener(this));this.selectedTab.initTabAgents();this.busy=false;this.updateAllAjaxTabsOnFirstRequest=(this.params.ajaxURL)?true:false},loadContent:function(A){if(!this.busy){this.busy=true;ajaxUrl=(this.updateAllAjaxTabsOnFirstRequest)?this.params.ajaxURL:A.link.href;ajaxUrl=ajaxUrl.concat(((ajaxUrl.indexOf("?")<0)?"?ajax=true":"&ajax=true"));log.debug("loading content from: "+ajaxUrl);var B=ajaxUrl.split("?");new Ajax.Request(B[0],{parameters:B[1],onSuccess:function(C){var D=C.responseText;if(D.isJSON()){this.populateContent(D.evalJSON())}else{this.selectedTab.populateContentBlock(D)}this.busy=false}.bind(this),onFailure:function(){log.error("TabMenu.loadContent AJAX request failed.\n JSON formatted response:"+response.responseText.unescapeJSON().isJSON());this.verifyContentPopulated();this.busy=false}.bind(this),method:"get"})}else{log.warning("TabMenu busy, request to load content ignored")}},populateContent:function(A){for(tabId in A){for(var B=0;B<this.tabs.length;B++){var C=this.tabs[B];if(C.type==="ajax"&&C.tabId===tabId){C.populateContentBlock(A[tabId]);break}}}this.verifyContentPopulated()},verifyContentPopulated:function(){for(var A=0;A<this.tabs.length;A++){if(this.tabs[A].type==="ajax"){this.tabs[A].indicateError(this.tabs[A].tabId)}}},selectTabByKey:function(A){this.tabs.each(function(B){if(B.key==A){B.selectTab();throw $break}})},updateTabs:function(A){var H=A.memo.hash;if(H){for(var I=0;I<this.tabs.length;I++){if(this.tabs[I].key==H){var D=this.tabs[I];break}}if(D){if(!D.selected){D.click();if(A.memo.scrollToTab){D.scrollTo()}}}else{var E,C,B=this.container.getElementsByTagName("A");for(var G=0;G<B.length;G++){var J=Element.extend(B[G]);if(J.name&&J.name==H){C=J.up("div.tabContent").getElementsByTagName("A")[0];break}}if(C){for(var F=0;F<this.tabs.length;F++){if(this.tabs[F].key==C.name&&!this.tabs[F].selected){E=this.tabs[F];break}}if(E){E.click();J.scrollTo()}}}}else{if(!this.defaultTab.selected){this.defaultTab.click()}}}});var Tab=Class.create();Tab.prototype={initialize:function(C,B,A){this.link=C.getElementsByTagName("A")[0];this.element=$(C);this.tabMenu=A;this.contentWrapper=B;this.selected=false;this.contentBlock=null;this.type=this.link.rel==="ajax"?"ajax":"dom";this.tabId=this.type==="ajax"?this.element.getAttribute("data-tab"):null;this.key=(this.tabId)?this.tabId+this.tabMenu.id:this.link.href.substring((this.link.href.indexOf("#")+1));this.contentPopulated=this.type==="ajax"?false:true;if(!this.tabMenu.params||!this.tabMenu.params.affectHistory){this.element.observe("click",this.click.bindAsEventListener(this))}if(this.element.hasClassName("currentTab")){this.selected=true;this.tabMenu.selectedTab=this;this.tabMenu.defaultTab=this}},click:function(A){if(A){A.preventDefault()}this.tabMenu.selectedTab.deselectTab();this.selectTab();if(this.type==="ajax"){this.tabMenu.loadContent(this)}else{this.initTabAgents()}},findContentBlock:function(){if(!this.contentBlock){var D=this.contentWrapper.getElementsByTagName("A");for(var C=0,A=D.length;C<A;C++){var B=Element.extend(D[C]);if(B.name&&B.name==this.key){this.contentBlock=B.getParentByClassName("tabContent");return}}}},populateContentBlock:function(A){this.type="dom";this.findContentBlock();this.contentBlock.removeClassName("loadingAJAXTabContent");this.contentBlock.removeClassName("unloadedAJAXTabContent");this.contentBlock.update(A);Page.initializeDOMFragment(this.contentBlock);if(this.selected&&!this.agentsInitialized){this.initTabAgents()}},indicateError:function(A){log.error("Tab: "+A+" content expected but not found in response")},selectTab:function(){this.findContentBlock();this.selected=true;this.element.addClassName("currentTab");if(this.type==="ajax"){this.contentBlock.removeClassName("unloadedAJAXTabContent");this.contentBlock.addClassName("loadingAJAXTabContent");new ProgressIndicator(this.contentBlock)}if(this.contentBlock&&!this.contentBlock.visibleByClass()){this.contentBlock.showByClass()}this.tabMenu.selectedTab=this;document.fire("tab:change",{hash:this.key})},deselectTab:function(){this.selected=false;this.element.removeClassName("currentTab");this.findContentBlock();if(this.contentBlock&&this.contentBlock.visibleByClass()){this.contentBlock.hideByClass()}this.tabMenu.selectedTab=null},initTabAgents:function(){if(!this.agentsInitialized){this.agentsInitialized=true;this.findContentBlock();Page.initializeLazyAgents(this.contentBlock)}},scrollTo:function(){if(this.element.cumulativeScrollOffset().top>0){this.element.scrollTo()}}};var TabMenuPagination=Class.create(Abstract.Agent,{initExtend:function(){var A=this.params.selector||"a";this.element.on("click",A,function(C,B){var D=B.readAttribute("href").split("#")[1];document.fire("tab:show",{hash:D})})}});var ToggleInsurance=Class.create(Abstract.Agent,{beforeDOMReady:false,initExtend:function(){this.element.down("input").on("click",this.update.bind(this))},update:function(){var A=this.element.up("form");if(A){Form.HiddenField.add(A,"_eventId_updateInsuranceSinglePageCar","true");A.submit()}else{log.error("UpdateView.getUpdate failed: couldn't find the form");return}}});var ToggleParentClassOnClick=Class.create(Abstract.Agent,{initExtend:function(){if(!this.params.parentClass){log.error("Param parenClass is required by agent ToggleParentClassOnClick.");return}this.highlightClass="highlight";this.element.observe("click",this.handleClickOver.bind(this))},initContainer:function(){if(!this.container){this.container=this.element.getParentByClassName(this.params.parentClass);if(!this.container){log.error("Unable to find parentClass element in agent ToggleParentClassOnClick.");return}}},handleClickOver:function(A){this.initContainer();A.stop();this.container.toggleClassName(this.highlightClass);this.element.getParentByTagName("body").observe("click",this.handleClickOut.bind(this))},handleClickOut:function(A){this.initContainer();if(!A.target.getParentByClassName(this.params.parentClass)){this.container.removeClassName(this.highlightClass);this.element.getParentByTagName("body").stopObserving("click",this.handleClickOut)}}});var SavedTraveler=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var F=$H(this.params);var H=F.get("travelerIndex");var I=F.get("pageHasFormValidationErrors")?F.get("pageHasFormValidationErrors"):false;var E=this.element.down("select");var C=this.element.down("input[type=radio]");var G=function(K,M){var J=new Hash();J.set("index",H);var L=E.options[K];J.set("name",L.value==""?"":L.text);J.set("travelerInformation",M);J.set("useSavedTraveler",C.checked);return J};var B=function(J){return G(J,F.get("traveler"+E.options[J].value))};var D=function(J){return G(J,{})};var A=function(K){if((K.target.type=="radio"&&K.target.checked)||K.target.type!="radio"){var J="traveler"+H;log.debug(J+":switched");document.fire(J+":switched",B(E.selectedIndex));log.debug(J+":nameChanged");document.fire(J+":nameChanged",D(E.selectedIndex))}};E.on("change",A);C.on("click",A);document.on("traveler"+H+":getData",function(K){if(I){var J={memo:D(E.selectedIndex)}}else{var J={memo:B(E.selectedIndex)}}K.memo.callback(J)})}});var TravelerName=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var H=this.params;var C=new Hash();var G=function(){var J=C.values();var I="";J.each(function(K){if(K.type==="select-one"){var L=K.options[K.selectedIndex];if(L.value!=""){I+=L.text+" "}}else{if(K.type!="radio"){I+=K.value+" "}}});return I.strip()};var E=function(){log.debug("TravelerName.clearName");C.values().each(function(I){if(I.type==="select-one"){I.selectedIndex=0}else{if(I.type!="radio"){I.value=""}}})};var F=function(){if(H.newTraveler){var I=new Hash();I.set("index",H.travelerIndex);I.set("name",G());I.set("travelerInformation",H.newTraveler);return I}};var B=function(){var I=new Hash();I.set("index",H.travelerIndex);I.set("name",G());return I};var A=function(){log.debug("traveler"+H.travelerIndex+" travelerNameChanged");document.fire("traveler"+H.travelerIndex+":nameChanged",B())};var D=function(){log.debug("traveler"+H.travelerIndex+" switched from saved traveler");E();document.fire("traveler"+H.travelerIndex+":nameChanged",B());document.fire("traveler"+H.travelerIndex+":switched",F())};this.element.select("select").each(function(I){C.set(I.name.substring(I.name.indexOf("name.")+5),I);I.on("change",A)});this.element.select("input").each(function(I){if(I.type!=="radio"){C.set(I.name.substring(I.name.indexOf("name.")+5),I);I.on("change",A)}else{I.on("click",D)}});document.on("traveler"+H.travelerIndex+":getName",function(J){log.debug("traveler"+H.travelerIndex+":getName");var I={memo:B()};J.memo.callback(I)})}});var TravelerDisplayName=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var B=this.element;var C=this.params;var A=this.element.innerHTML.strip();var D=function(F){var E=F.memo.get("name").strip();log.debug("TravelerDisplayName "+C.travelerIndex+" :update: "+E);if(E!=""){if(!C.nameOnly){E=E+" ("+A.replace(":","").strip()+")"}B.update(E)}else{B.update(A)}};document.on("traveler"+C.travelerIndex+":nameChanged",D);document.fire("traveler"+C.travelerIndex+":getData",{callback:function(E){if(E.memo.get("useSavedTraveler")){D(E)}else{document.fire("traveler"+C.travelerIndex+":getName",{callback:D})}}})}});var TravelerTSAInfo=Class.create(Abstract.Agent,{initExtend:function(){var I=this.element;var G=this.params;var K=G.travelerIndex;var E=I.select("select");var H=I.up().select(".nonTsaDob select");E=E.concat(H);var F=I.down(".optionalTSAInfo");var J=F.down("input[name$=redressNumber]");var D=F.down("input[name$=travelerNumber]");if(J.value.strip()!=""||D.value.strip()!=""||F.select("p.error").length>0){var M='checked="checked"'}var L=new Element("label",{"class":"checkbox hideRevealCheckbox"});L.insert('<input name="" value="" type="checkbox" '+M+"/><span>"+G.checkboxLabel+"</span>");Page.initializeDOMFragment(L);F.insert({top:L});var C=L.down("input");var A=function(){if(C.checked){J.up("label").show();D.up("label").show()}else{J.value="";D.value="";J.up("label").hide();D.up("label").hide()}};A();C.on("click",A);var B=$H();E.each(function(P){B.set(P.name.substring((P.name.lastIndexOf(".")+1)),P)});var O=function(P){var S=P.memo.get("travelerInformation");if(S&&S.tsaInfo!==undefined){log.debug("TravelerTSAInfo "+K+" :updateFields");var Q=$H(S.tsaInfo);B.each(function(T){T.value.value=Q.get(T.key)});J.value=Q.get("redressNumber").strip();D.value=Q.get("knownTravelerNumber").strip();C.checked=(J.value!="")||(D.value!="")?"checked":""}A()};if(K!==undefined){document.on("traveler"+K+":switched",O);document.fire("traveler"+K+":getData",{callback:O})}}});var TravelerPhoneNumber=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var A=this.element.down("select");var D=this.element.down("input");var G=this.element.down("input",1);var C=this.params.travelerIndex;var F=function(I){var J=I.memo.get("travelerInformation");if(J&&J.phone!==undefined){log.debug("TravelerPhoneNumber "+C+" :updateFields");var H=J.phone;A.value=H.countryCode;D.value=H.phoneNumber;if(G){G.value=H.extension}}};var E=document.on("traveler"+C+":switched",F);var B=function(){if(E){log.debug("traveler"+C+" TravelerPhoneNumber detached");E=E.stop()}};A.on("change",B);D.on("change",B);if(G){G.on("change",B)}document.fire("traveler"+C+":getData",{callback:F})}});var TravelerEmailAddress=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var B=this.params.travelerIndex;var A=this.element.down("input");var C=function(D){var E=D.memo.get("travelerInformation");if(E&&E.email!==undefined){log.debug("TravelerEmailAddress "+B+" :updateFields");A.value=E.email.strip()}};document.on("traveler"+B+":switched",C);document.fire("traveler"+B+":getData",{callback:C})}});var TravelerLoyaltyPrograms=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var A=this.element.down("input");var D=this.params.travelerIndex;var B=this.params.loyaltyProgramType;var C=this.params.loyaltyProgramCode;var E=function(G){var H=G.memo.get("travelerInformation");if(H&&H.loyaltyPrograms!==undefined){log.debug("TravelerLoyaltyPrograms "+D+" :updateFields");var F=$H(H.loyaltyPrograms).get(B+"LoyaltyProgram"+C);A.value=F?F:""}};document.on("traveler"+D+":switched",E);document.fire("traveler"+D+":getData",{callback:E})}});var FrequentFlierTraveler=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var C=this.params.travelerIndex;var G=this.params.defaultCarrierCode;var A=this.element.down("select");var D=this.element.down("input");var F=null;var B=function(){log.debug("FrequentFlierTraveler "+C+":onProgramChange");if(F){var H=F.get("airLoyaltyProgram"+A.value);if(H){D.value=H}else{D.value=""}}else{D.value=""}};var E=function(I){var J=I.memo.get("travelerInformation");if(J&&J.loyaltyPrograms!==undefined){log.debug("FrequentFlierTraveler "+C+" :onTravelerChange");F=$H(J.loyaltyPrograms);if(A){var H=F.get("airLoyaltyProgram"+A.value)}else{var H=F.get("airLoyaltyProgram"+G)}D.value=H?H:""}};if(A){A.on("change",B)}document.on("traveler"+C+":switched",E);document.fire("traveler"+C+":getData",{callback:E})}});var SeatPreferencesTraveler=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var B=this.params.travelerIndex;var E=this.params.defaultSeatPrefType;var C=this.element.select("input[type=radio]");var A=function(G){var F=G||E;C.each(function(H){H.checked=(H.value===F)?true:false})};var D=function(F){var G=F.memo.get("travelerInformation");if(G&&G.flightPreferences!==undefined){log.debug("SeatPreferencesTraveler "+B+" :onTravelerChange");if(G.flightPreferences.seat){A(G.flightPreferences.seat)}else{A(E)}}};document.on("traveler"+B+":switched",D);document.fire("traveler"+B+":getData",{callback:function(F){D(F)}})}});var TravelerSeatPreferences=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var A=this.params.travelerIndex;var C=this.element.getElementsByTagName("select")[0];var B=function(D){var E=D.memo.get("travelerInformation");if(E&&E.flightPreferences!==undefined){log.debug("TravelerSeatPreferences "+A+" :updateFields");C.value=E.flightPreferences.seat?E.flightPreferences.seat:"N"}};document.on("traveler"+A+":switched",B);document.fire("traveler"+A+":getData",{callback:B})}});var TravelerFlightSpecialRequests=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var B;var C;var A=this.params.travelerIndex;this.element.select("select").each(function(F){var E=F.name.substr(F.name.lastIndexOf(".")+1);if(E=="meal"){B=F}else{if(E=="specialRequest"){C=F}}});var D=function(E){var F=E.memo.get("travelerInformation");if(F&&F.flightPreferences!==undefined){log.debug("TravelerFlightSpecialRequests "+A+" :updateFields");B.value=F.flightPreferences.meal!==undefined?F.flightPreferences.meal:"";C.value=F.flightPreferences.specialRequest!==undefined?F.flightPreferences.specialRequest:""}};document.on("traveler"+A+":switched",D);document.fire("traveler"+A+":getData",{callback:D})}});var NameFromListToggle=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var F=this.params;var E=this.element.update(this.params.content);var D=E.up(1);var C=D.down("input[type=radio]");if(C.checked){D.showByClass()}else{D.hideByClass()}var A=function(G){document.fire("savedTraveler"+F.travelerIndex+":toggle",{action:F.action});G.preventDefault()};var B=function(G){if(G.memo.action==F.action){D.hideByClass()}else{C.click();D.showByClass()}};E.on("click",A);document.on("savedTraveler"+F.travelerIndex+":toggle",B)}});var BookerTraveling=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var D=this.element.down("input[type=checkbox]");var B=this.element.up();var C=B.down(".whosBookingName");var A=function(){if(D.checked){B.addClassName("highlight");C.showByClass()}else{B.removeClassName("highlight");C.hideByClass()}};A();D.on("click",A)}});var NameInstruction=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var D=this.element.adjacent(".nameInstructionForAir");if(D.length>0){var E=function(){D[0].addClassName("highlight")};var B=function(){D[0].removeClassName("highlight")};var A=this.element.down("select");A.on("focus",E);A.on("blur",B);var C=this.element.select("input");for(i=0;i<C.length;i++){C[i].on("focus",E);C[i].on("blur",B)}}}});var PackageDefaultTraveler=Class.create(Abstract.Agent,{beforeDOMReady:true,initExtend:function(){var A=new Element("span").addClassName("heldByLabel");A.update(this.params.content);this.element.insertBefore(A,this.element.firstChild);Page.initializeDOMFragment(A)}});var UserReviewGraph=Class.create(Abstract.Agent,{initExtend:function(){$A(this.element.getElementsByClassName("score")).each(function(C){var D=C.innerHTML.replace(/,/g,".");C.style.width=(D/0.05)+"%"});var B='<dt class="noneBlock graphHeading">&nbsp;</dt><dd class="graphHeading"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span></dd>';var A=$(this.element.getElementsByTagName("dl")[0]).insert({top:B});this.element.addClassName("userReviewGraph")}});var WebTrends=Class.create();WebTrends.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){if(this.enabled){this.webTrendsCallback=(function(){var A=["DCS.dcsuri",location.pathname,"WT.ti",this.title];for(i in this.nameValuePairs){A.push(this.webTrendsPrefix+i);A.push(this.nameValuePairs[i])}dcsSetVar.apply(undefined,A);if(!this.persistent){Event.stopObserving(this.element,this.eventType,this.webTrendsCallback)}}).bind(this);Event.observe(this.element,this.eventType,this.webTrendsCallback)}}});var WebTrendsMultiTrackListener=Class.create();WebTrendsMultiTrackListener.prototype=Object.extend(new Abstract.Agent(),{beforeDOMReady:false,initExtend:function(){this.defaultTags=$H({"DCS.dcsuri":"","DCS.dcsqry":"","WT.ti":"","WT.ad":"","WT.mc_id":"","WT.sp":""});document.observe("webtrends:multiTrackEvent",function(D){var F=D;var E=F.pathname?((F.pathname.indexOf("/")!=0)?"/"+F.pathname:F.pathname):"/";var B=F.textContent||F.innerText||F.innerHTML||"";var C=this.defaultTags.clone();C.set("DCS.dcsuri",E);C.set("DCS.dcsqry",F.search||"");C.update($H(D.memo));var A=[];C.each(function(G){A.push(G.key);A.push(G.value)});log.debug("WebTrends, sending: dcsMultiTrack() with parameters: "+A);dcsMultiTrack.apply(undefined,A);dcsCleanUp()}.bind(this));document.observe("content:update",function(E){var G=E;var F=G.pathname?((G.pathname.indexOf("/")!=0)?"/"+G.pathname:G.pathname):"/";var C=G.textContent||G.innerText||G.innerHTML||"";var D=this.defaultTags.clone();D.set("DCS.dcsuri",F);D.set("DCS.dcsqry",G.search||"");var B=E.memo.webtrends;D.update(Object.isString(B)?B.evalJSON():B);var A=[];D.each(function(H){A.push(H.key);A.push(H.value)});log.debug("WebTrends, sending: dcsMultiTrack() with parameters: "+A);dcsMultiTrack.apply(undefined,A);dcsCleanUp()}.bind(this))}});var WebTrendsTrackElement=Class.create();WebTrendsTrackElement.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){var A=this.element.tagName.toLowerCase();if(A!="a"){this.tags=this.params.tags;Event.observe(this.element,this.params.event,function(B){this.element.fire("webtrends:multiTrackEvent",this.params.tags)}.bind(this))}}});var WebTrendsTrackSliderChange=Class.create();WebTrendsTrackSliderChange.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.tags=this.params.tags;this.element.observe("agent:sliderChange",function(A){this.element.fire("webtrends:multiTrackEvent",this.tags)}.bind(this))}});var WebTrendsTrackCheckboxList=Class.create();WebTrendsTrackCheckboxList.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.tags=this.params.tags;this.checkboxes=this.element.select("input[type=checkbox]");this.tagPrefixes=$H();if(this.params.dynamicallyAddValue){this.params.dynamicallyAddValue.each(function(A){this.tagPrefixes.set(A,this.tags[A])}.bind(this))}this.checkboxes.each(function(A){A.observe("click",function(B){elem=B.element();if(elem.checked){if(this.params.dynamicallyAddValue){this.params.dynamicallyAddValue.each(function(C){this.tags[C]=this.tagPrefixes.get(C)+elem.value}.bind(this))}this.element.fire("webtrends:multiTrackEvent",this.tags)}}.bind(this))}.bind(this))}});var WebTrendsTrackSelectBox=Class.create();WebTrendsTrackSelectBox.prototype=Object.extend(new Abstract.Agent(),{initExtend:function(){this.tags=this.params.tags;var A=this.element.select("select");for(i=0;i<A.length;i++){Event.observe(A[i],"change",function(B){elem=B.element();if(this.params.dynamicallyAddValue){this.params.dynamicallyAddValue.each(function(C){this.tags[C]+=elem.value}.bind(this))}elem.fire("webtrends:multiTrackEvent",this.tags)}.bind(this))}}});