/*
 * Copyright (c) 2007-2012, Marketo, Inc. All rights reserved.
 * Marketo marketing automation web activity tracking script
 *
 * $Id: munchkin.js 48595 2012-11-13 23:09:29Z dj $
 * $Rev: 48595 $
 */
(function(n){if(!n.Munchkin){var k=function(a){if(null===a)return null;if(0===a.length)return"";try{return decodeURIComponent(a)}catch(b){var c=a.indexOf("?");if(-1!==c)try{return decodeURIComponent(a.substr(0,c))+a.substr(c)}catch(e){}return String(a)}},q=function(a){try{var b=document.createElement("a");b.href=a;var a={},c=b.search.replace(/^\?/,"").split("&"),e=c.length,d,g;for(d=0;d<e;d+=1)c[d]&&(g=c[d].split("="),a[k(g[0])]=k(g[1]));return a}catch(f){return null}},h=function(a){return"undefined"!==
typeof a&&null!==a},f={customName:null,notifyPrefix:null,wsInfo:null,altIds:[],visitorToken:null,cookieLifeDays:730,clickTime:250,cookieAnon:!0,mkt_tok:null,domainLevel:null,disableClickDelay:!1,useReferrerToken:!1},r=navigator.cookieEnabled||document.hasOwnProperty("cookie")&&(0<document.cookie.length||-1<(document.cookie="testcookie=test; max-age=10000").indexOf.call(document.cookie,"testcookie=test;")),m={ASSOCIATE_LEAD:"associateLead",CLICK_LINK:"clickLink",VISIT_WEB_PAGE:"visitWebPage",init:function(a,
b){if(r&&!(null==a||0==a.length)){i.discoverClientLibrary();j.id=a;var c=document.location;f.notifyPrefix=c.protocol+"//"+j.id+".mktoresp.com/";if(h(b)){var e;if(h(b)&&h(f))for(e in f)f.hasOwnProperty(e)&&h(b[e])&&(f[e]=b[e])}e="";var d=q(n.location.toString());h(d)&&0<d.length&&(h(d.mkt_tok)&&(f.mkt_tok=d.mkt_tok),h(d.lpview)&&(e=d.lpview),h(d.mkt_dbg)&&(j.debug=1==d.mkt_dbg));if(f.useReferrerToken&&!h(f.mkt_tok)){var d=document.referrer,g=q(d);if(h(g.enid)&&h(g.type)&&!h(g.mkt_tok)){var p=d.indexOf("mkt_tok=");
if(-1!==p){var l=d.indexOf("%26",p);-1===l&&(l=d.length);f.mkt_tok=k(d.substring(p+8,l))}}h(g.mkt_tok)&&(f.mkt_tok=g.mkt_tok)}if(!("preview"==e&&/\/lpeditor\/preview$/.test(c.pathname))){j.capable=!0;try{i.$(document).ready(function(){j.initialize()})}catch(m){}}}},munchkinFunction:function(a,b,c){var e={},d;null!=c&&(e._mchKy=c);switch(a){case m.ASSOCIATE_LEAD:for(d in b)e["_mchAt"+d]=b[d];j.createTrackingCookie(!0);j.post("webevents/associateLead",e);break;case m.CLICK_LINK:null!=b.href&&(e._mchHr=
e._mchLr=k(b.href));j.post("webevents/clickLink",e,{_mchCn:h(f.customName)?f.customName:""},0);break;case m.VISIT_WEB_PAGE:null!=b.url&&(e._mchRu=k(b.url)),null!=b.params&&(e._mchQp=k(b.params.replace(/&/g,"__-__"))),null!=b.name&&(e._mchCn=b.name),j.post("webevents/visitWebPage",e,{_mchRe:k(document.location.href)},0)}},createTrackingCookie:function(a){j.createTrackingCookie(a)},debug:function(a,b){var c={_mchId:j.Cookie.id,_mchTk:j.Cookie.token,_mchMsg:j.debugSeq++,_mchUa:navigator.userAgent};h(f.mkt_tok)&&
(c.mkt_tok=f.mkt_tok);null!=a&&(c._mchMsg+=" - "+a);if(null!=b){var e=i.$("#"+b);0<e.length&&(c._mchScr=e.html())}c._mchVr=j.VERSION;e=f.notifyPrefix+"webevents/debug";e+="?_mchNc="+(new Date).getTime()+"&"+i.$.param(c);c=new Image(1,1);c.onload=function(){};c.src=e}},j={capable:!1,inited:!1,id:null,cookie:null,debug:!1,debugSeq:1,defQ:[],VERSION:"136",LINK_SELECTOR:'a[href]:not([href^="#"],[href=],[class~="mchNoDecorate"],[href^="javascript"],[href^="mailto"]),area[href]:not([href^="#"],[href=],[class~="mchNoDecorate"],[href^="javascript"],[href^="mailto"])',
initialize:function(){if(this.capable){if(!this.inited){this.inited=!0;for(var a=this.createTrackingCookie(h(f.mkt_tok));0<this.defQ.length;){var b=this.defQ.shift();switch(b[0]){case "createTrackingCookie":a=this.createTrackingCookie(b[1]);break;case "post":this.post(b[1],b[2],h(b[3])?b[3]:null,h(b[4])?b[4]:null,h(b[5])?b[5]:null)}}null!=a&&(a=document.location,this.post("webevents/visitWebPage",{_mchCn:h(f.customName)?f.customName:""},{_mchHa:k(a.hash),_mchRe:k(document.referrer),_mchQp:k(a.search.substr(1).replace(/&/g,
"__-__"))},0))}}else i.updateLpForm("")},createTrackingCookie:function(a){if(this.inited){if(null!=this.cookie)return this.cookie;this.domain=i.getDomain(document.location.hostname);var b=new i.Cookie("_mkto_trk");return h(b.id)||f.cookieAnon||a?(b.id=this.id,null==b.token&&(b.token=h(f.visitorToken)&&"VISITOR_MKTTOK_REPLACE"!=f.visitorToken?f.visitorToken:i.generateToken(this.domain)),b.store(f.cookieLifeDays,"/",this.domain,!1),i.updateLpForm("id:"+b.id+"&token:"+b.token),this.instrumentLinks(),
this.cookie=b):null}this.defQ.push(["createTrackingCookie",a])},post:function(a,b,c,e,d){if(this.inited)if(null!=this.cookie){var g=document.location,j,l;b._mchId=this.cookie.id;b._mchTk=this.cookie.token;h(f.mkt_tok)&&(b.mkt_tok=f.mkt_tok);null!=f.wsInfo&&(b._mchWs=f.wsInfo);b._mchHo=g.hostname;b._mchPo=g.port;null==b._mchRu&&(b._mchRu=k(g.pathname));b._mchPc=g.protocol;if(null!=c)for(j in c)b[j]=c[j];b._mchVr=this.VERSION;if(null==b._mchHo||0==b._mchHo.length||"file:"==b._mchPc)this.debug&&alert("Ignoring munchkin post: "+
a);else for(l in a+="?_mchNc="+(new Date).getTime(),i.doImageGet(f.notifyPrefix,a,b,e,d),f.altIds)c=f.altIds[l],b._mchId=c,i.doImageGet(f.notifyPrefix.replace(/\w{3}\-\w{3}\-\w{3}\.mktoresp\.com/i,c+".mktoresp.com"),a,b,e)}else this.debug&&alert("Cannot post without cookie");else this.defQ.push(["post",a,b,c,e,d])},findEventTgtLink:function(a){for(;"A"!=a.tagName&&"AREA"!=a.tagName&&null!=a.parentNode;)a=a.parentNode;return"A"==a.tagName||"AREA"==a.tagName?a:null},addEventListenerRepost:function(a,
b){return function(){i.isUndefined(b._mchInRepost)&&(b._mchInRepost=!0,a.dispatchEvent(b))}},addEventListenerDelay:function(a){var b=a.target||a.srcElement;if(a._mchInRepost||"undefined"!==typeof a.button&&0!==a.button)return!0;var c=j.findEventTgtLink(b);if(null==c||!i.$(c).is(j.LINK_SELECTOR))return!0;var e=!1,d=""==c.target||"_self"==c.target||"_top"==c.target||"_parent"==c.target,g;if(g=!a.ctrlKey){a:{g=n.jQuery;var p;if(h(g)&&(p=h(g._data)?g._data:g.data,h(p)&&(g=p.call(g,c,"events"),h(g)&&h(g.click)))){g=
!0;break a}g=!1}g=!g&&d&&!0!==f.disableClickDelay}g&&(e=!0);var l;e&&(d=document.createEvent("MouseEvents"),d.initMouseEvent("click",a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget),l=j.addEventListenerRepost(b,d),a.preventDefault(),a.stopPropagation());j.post("webevents/clickLink",{_mchCn:h(f.customName)?f.customName:"",_mchHr:k(c.href)},null,0,l);return e?(setTimeout(l,f.clickTime),!1):!0},instrumentLinks:function(){var a=
i.$.browser,b,c=a.version.indexOf(".");b=-1!=c?a.version.substr(0,c):a.version;c=h(a.mozilla)&&a.mozilla&&6>b;a=h(a.msie)&&a.msie&&9>b;c||a?i.$(j.LINK_SELECTOR).live("mouseup",function(){null!=this.href&&(0<this.href.length&&!/^mailto:/.test(this.href))&&j.post("webevents/clickLink",{_mchCn:h(f.customName)?f.customName:"",_mchHr:k(this.href)},null,100);return!0}):document.addEventListener&&document.addEventListener("click",function(a){return j.addEventListenerDelay(a)},!0)}},i={$:null,jQueryPriv:!1,
clientLib:null,clientLibMajorVer:0,clientLibMinorVer:0,clientLibPatchVer:0,clientLibRevisionVer:0,CLIENT_NONE:0,CLIENT_JQUERY:1,discoverClientLibrary:function(){if(null!=this.clientLib)return this.clientLib;if(!this.jQueryPriv)try{return this.parseVersion(jQuery.fn.jquery),this.clientLib=this.CLIENT_JQUERY}catch(a){}return this.clientLib=this.CLIENT_NONE},parseVersion:function(a){if(this.isDefined(a))a=/^([0-9])\.([0-9])\.?([0-9])?\.?([0-9])?$/.exec(a),null!=a&&(this.clientLibMajorVer=a[1],this.clientLibMinorVer=
a[2],this.isDefined(a[3])&&(this.clientLibPatchVer=a[3]),this.isDefined(a[4])&&(this.clientLibRevisionVer=a[4]));else throw"Invalid version";},doImageGet:function(a,b,c,e,d){var b=a+b+"&"+this.$.param(c),g=!1,a=new Image(1,1);a.onload=function(){g=!0;h(d)&&d()};a.src=b;if(0<e)for(b=(new Date).getTime();!g&&!((new Date).getTime()-b>e););},loadAsync:function(a,b){var c=document.createElement("script");c.type="text/javascript";c.async=!0;c.src=a;var e=!1,d=function(){!1===e&&(e=!0,b())};b&&(c.onreadystatechange=
function(){("complete"==this.readyState||"loaded"==this.readyState)&&d()},c.onload=d);document.getElementsByTagName("head")[0].appendChild(c)},updateLpForm:function(a){this.$("input[type=hidden][name=_mkt_trk]").attr("value",a)},getDomain:function(a){if(h(f.domainLevel)&&f.domainLevel===parseInt(f.domainLevel,10)){for(a=a.split(".");a.length>f.domainLevel&&2<a.length;)a.shift();return a.join(".")}var b=/([^.]+\.[^.]{3,})$/i.exec(a);if(null!=b)return b[1];b=/([^.]+\.[^.]+\.[^.]{2})$/i.exec(a);return null!=
b?b[1]:a},rand:function(a,b){return b?Math.floor(Math.random()*(b-a+1))+a:Math.floor(Math.random()*(a+1))},generateToken:function(a){return"_mch-"+a+"-"+(new Date).getTime()+"-"+this.rand(1E4,99999)},isUndefined:function(a){return"undefined"==typeof a},Cookie:function(a){this.$name=a;var b=document.cookie;if(""!=b){for(var c=b.split(";"),e=null,b=0;b<c.length;b++){var d=c[b].replace(/^\s+/,"");if(d.substring(0,a.length+1)==a+"="){e=d;break}}if(null!=e){a=e.substring(a.length+1).split("&");for(b=0;b<
a.length;b++)a[b]=a[b].split(":");for(b=0;b<a.length;b++)this[a[b][0]]=k(a[b][1])}}}};i.Cookie.prototype.store=function(a,b,c,e){var d="",g;for(g in this)if(!("$"==g.charAt(0)||"function"==typeof this[g])){""!=d&&(d+="&");var f=encodeURIComponent(this[g]),d=d+(g+":"+f)}d=this.$name+"="+d;0<a&&(g=new Date,g.setTime(g.getTime()+864E5*a),d+="; expires="+g.toGMTString());b&&(d+="; path="+b);c&&-1!=c.indexOf(".")&&(d+="; domain="+c);e&&(d+="; secure");document.cookie=d};try{if(i.discoverClientLibrary()==
i.CLIENT_JQUERY&&(1==i.clientLibMajorVer&&3<=i.clientLibMinorVer||1<i.clientLibMajorVer))i.$=jQuery;else throw"Invalid jQuery version";}catch(s){i.loadAsync(document.location.protocol+"//munchkin.marketo.net/jquery-latest.min.js",function(){i.$=jQuery.noConflict(!0);i.jQueryPriv=!0;i.$(document).ready(function(){j.initialize()})})}n.Munchkin=m;n.mktoMunchkin=m.init;n.mktoMunchkinDebug=m.debug;n.mktoMunchkinFunction=m.munchkinFunction}})(window);
