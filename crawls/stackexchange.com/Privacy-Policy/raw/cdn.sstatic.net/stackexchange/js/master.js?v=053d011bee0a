window.StackExchange={};StackExchange.init=(function(){var b=function(){$(document).keyup(function(a){if(a.which==27){$(".error-notification, .popup").fadeOutAndRemove();if(window.genuwine&&genuwine.isVisible()){genuwine.click()}}})};return function(a){$.ajaxSetup({cache:false});StackExchange.init.createJqueryExtensions();$(function(){b()})}})();StackExchange.init.createJqueryExtensions=function(){$.fn.extend({fadeOutAndRemove:function(b){return this.each(function(){var a=$(this);a.fadeOut("fast",function(){a.trigger("removing").remove()})})},center:function(){var e=this.parent();if(e.css("position")==="static"){e=e.offsetParent()}var d=e.offset();var f=$(window);this.css("position","absolute");this.css("top",(f.height()-this.height())/2+f.scrollTop()-d.top+"px");this.css("left",(f.width()-this.width())/2+f.scrollLeft()-d.left+"px");return this}})};StackExchange.helpers=(function(){var b={addSpinner:function(a,d){$(a).append(b.getSpinnerImg(d))},getSpinnerImg:function(a){var d=$('<img class="ajax-loader" src="/content/img/progress-dots.gif" title="loading..." alt="loading..." />');if(a){d.css(a)}return d},removeSpinner:function(){$("img.ajax-loader").remove()},showErrorPopup:function(g,a,i){$(".error-notification").remove();var j=$('<div class="error-notification supernovabg"><h2>'+a+"</h2>"+(i?"":'<span class="error-close">(click on this box to dismiss)</span>')+"</div>");var h=function(){j.fadeOutAndRemove()};$(g).append(j);j.click(h).fadeIn("fast");setTimeout(h,(i?Math.max(2500,a.length*40):1000*30))},removeErrorPopup:function(){$(".error-notification").fadeOutAndRemove()}};return b})();StackExchange.init();var genuwine=function(){var b;return{url:"",init:function(a){var d=$(".genu");b=a;genuwine.url=d.attr("href");d.removeAttr("href").add(".unreadCount").click(genuwine.click);$(document).click(function(c){if(genuwine.isVisible()&&!$.contains($("#portalLink")[0],c.target)){genuwine.click()}})},isVisible:function(){return $(".genu").hasClass("genu-on")},click:function(){var a=$(".genu");var g=$("#seWrapper");if(g.length==0){genuwine.appendWrapper();g=$("#seWrapper");var f;if(inboxUnviewedCount>0){f=$("#seTabInbox");genuwine.ensureInbox(f)}else{f=$("#seTabHot");genuwine.ensureHot(f)}f.addClass("seCurrent")}var h=a.hasClass("genu-on");if(h){$(".unreadCountTab").hide();$(".itemBoxNew").removeClass("itemBoxNew");g.fadeOut("fast")}else{g.fadeIn("fast");$(".unreadCount").hide()}a.toggleClass("genu-on",!h);if(inboxUnviewedCount==-1){$(a).ready(function(){$("#seTabInbox").hide()})}},appendWrapper:function(){var a='<div id="seWrapper" style="position:absolute; display:none;"><div class="seIntro"><a href="'+genuwine.url+'">Stack Exchange</a> is a network of free, community-driven Q&A sites.</div><div class="seNav"><ul class="seNavLinks"><li><a id="seTabHot" onclick="genuwine.tabClick($(this))">Hot Questions</a></li><li><a id="seTabSites" onclick="genuwine.tabClick($(this))">All Sites</a></li><li><a id="seTabInbox" onclick="genuwine.tabClick($(this))">Inbox</a></li></ul></div><div class="seContainer"></div><div class="seFooter"><a>close</a></div></div>';$(a).appendTo("#portalLink");$(".seFooter").live("click",genuwine.click)},tabClick:function(a){$(".seNavLinks a").removeClass("seCurrent");a.addClass("seCurrent");switch(a.attr("id")){case"seTabHot":genuwine.ensureHot(a);$("#seContainerSites, #seContainerInbox").hide();$("#seContainerHot").fadeIn("fast");break;case"seTabSites":genuwine.ensureSites(a);$("#seContainerHot, #seContainerInbox").hide();$("#seContainerSites").fadeIn("fast");break;case"seTabInbox":genuwine.ensureInbox(a);$("#seContainerHot, #seContainerSites").hide();$("#seContainerInbox").fadeIn("fast");break}},ensureHot:function(a){if($("#seContainerHot").length==0){genuwine.loadHot(a)}},loadHot:function(a){genuwine.load(a,genuwine.url+"/genuwine?callback=?","jsonp",genuwine.renderHot)},renderHot:function(m,n){var q=$("<div/>");var p='<div id="seContainerHot" style="display:none">';for(var i=0;i<n.length;i++){var r=n[i];var a=r.SiteId;var l='href="http://'+a+"/q/"+r.Id+'?hq=1"';var o=parseInt(r.DisplayScore,10);p+='<div class="itemBox"><a '+l+' class="seNumAnswer">'+o+'</a><div class="siteInfo"><p><a '+l+">"+q.text(r.Title).html()+'</a></p><a href="http://'+a+'" class="siteLink">'+a+"</a></div></div>"}p+="</div>";genuwine.render(m,p)},ensureSites:function(a){if($("#seContainerSites").length==0){genuwine.loadSites(a)}},loadSites:function(a){genuwine.load(a,genuwine.url+"/genuwine/sites"+(!!b?("?accountId="+b+"&callback=?"):"?callback=?"),"jsonp",genuwine.renderSites)},renderSites:function(k,m){var n='<div id="seContainerSites" style="display:none">';for(var l=0;l<m.length;l++){var j=m[l];var i=j.Name;var a='href="http://'+j.Id+'?as=1"';n+='<div class="itemBox"><a '+a+' class="siteFavicon"><img src="'+j.FaviconUrl+'" alt="'+i+'"></a><div class="siteInfo"><p><a '+a+">"+i+"</a></p><a "+a+' class="siteLink">'+j.Description+"</a></div></div>"}n+="</div>";genuwine.render(k,n)},ensureInbox:function(a){if(inboxUnviewedCount==-1){return}if($("#seContainerInbox").length==0){genuwine.loadInbox(a)}if(inboxUnviewedCount>0&&a.find(".unreadCountTab").length==0){a.prepend('<span class="unreadCountTab">'+inboxUnviewedCount+"</span>")}},loadInbox:function(a){genuwine.load(a,"/inbox/genuwine","json",genuwine.renderInbox,true)},renderInbox:function(u,r){var v='<div id="seContainerInbox" style="display:none">';for(var i=0;i<r.length;i++){var q=r[i];var p='href="'+q.Url+'"';var a='title="'+q.CreationDate+'"';var n=q.Count;var o=q.IsNew?" itemBoxNew":"";v+='<div class="itemBox'+o+'"><a '+p+' class="siteLinkFavicon"><img src="'+q.FaviconUrl+'" alt="'+q.SiteUrl+'"></a><div class="siteInfo">';if(q.Type=="careers message"){v+="<p><a "+p+' style="font-weight:normal"><b>'+q.Title+"</b> wants to contact you on <b>Stack Overflow Careers</b></a></p>"}else{if(q.Type=="invitation"){var s=q.Count;var t="invitation"+(s>1?"s":"");v+="<p><a "+p+' style="font-weight:normal"><b>'+s+"</b> "+t+" awarded on <b>Stack Overflow Careers</b></a></p>"}else{v+="<p>"+(n>1?n+" ":"")+q.Type+" on <a "+p+" "+a+">"+q.Title+"</a></p>"}}v+='<p class="inboxSummary">'+(q.Summary||"")+"</p></div></div>"}if(b&&r.length>=5){v+='<div class="itemMoreContainer"><div class="seIntro"><a href="http://stackexchange.com/users/'+b+'?tab=inbox">more inbox messages &hellip;</a></div></div>'}v+="</div>";genuwine.render(u,v)},currentlyLoading:{},load:function(l,i,a,k,j){var n=l.attr("id");if(genuwine.currentlyLoading[n]){genuwine.addSpinnerToContainer();return}genuwine.currentlyLoading[n]=true;genuwine.addSpinnerToContainer();var m=function(){genuwine.currentlyLoading[n]=false;StackExchange.helpers.showErrorPopup($(".seContainer"),"An error occurred while loading - please try again.")};$.ajax({type:"GET",url:i,dataType:a,success:function(c){if(c&&(c.length>0||j)){k(l,c)}else{m()}},error:m,complete:StackExchange.helpers.removeSpinner})},render:function(a,f){var e=$(f);e.appendTo(".seContainer");if(a.hasClass("seCurrent")){e.fadeIn("fast")}},addSpinnerToContainer:function(){StackExchange.helpers.removeSpinner();StackExchange.helpers.addSpinner(".seContainer",{position:"relative",left:"10px",top:"10px"})}}}();(function(){var b=genuwine.init;$.extend(genuwine,{loadUnviewedCount:function(){$.get("/inbox/genuwine/unviewed-count",null,genuwine.renderUnviewedCount,"json")},renderUnviewedCount:function(a){if(a&&typeof(a.UnviewedCount)=="number"){window.inboxUnviewedCount=a.UnviewedCount}if(a&&a.UnviewedCount>0){var d=$("<a />").addClass("unreadCount").text(Math.min(a.UnviewedCount,99)).click(genuwine.click);$(".genu").after(d).removeClass("genu-loading");$("#seTabInbox").show()}},init:function(){if($(".genu").hasClass("genu-loading")){genuwine.loadUnviewedCount()}b.apply(this,arguments)}})})();