window.StackExchange={};StackExchange.init=(function(){var a=function(){$(document).keyup(function(b){if(b.which==27){$(".error-notification, .popup").fadeOutAndRemove();if(window.genuwine&&genuwine.isVisible()){genuwine.click()}}})};return function(b){$.ajaxSetup({cache:false});StackExchange.init.createJqueryExtensions();$(function(){a()})}})();StackExchange.init.createJqueryExtensions=function(){$.fn.extend({fadeOutAndRemove:function(a){return this.each(function(){var b=$(this);b.fadeOut("fast",function(){b.trigger("removing").remove()})})},center:function(){var a=this.parent();if(a.css("position")==="static"){a=a.offsetParent()}var b=a.offset();var c=$(window);this.css("position","absolute");this.css("top",(c.height()-this.height())/2+c.scrollTop()-b.top+"px");this.css("left",(c.width()-this.width())/2+c.scrollLeft()-b.left+"px");return this}})};StackExchange.helpers=(function(){var a={addSpinner:function(b,c){$(b).append(a.getSpinnerImg(c))},getSpinnerImg:function(b){var c=$('<img class="ajax-loader" src="/content/img/progress-dots.gif" title="loading..." alt="loading..." />');if(b){c.css(b)}return c},removeSpinner:function(){$("img.ajax-loader").remove()},showErrorPopup:function(c,f,b){$(".error-notification").remove();var d=$('<div class="error-notification supernovabg"><h2>'+f+"</h2>"+(b?"":'<span class="error-close">(click on this box to dismiss)</span>')+"</div>");var e=function(){d.fadeOutAndRemove()};$(c).append(d);d.click(e).fadeIn("fast");setTimeout(e,(b?Math.max(2500,f.length*40):1000*30))},removeErrorPopup:function(){$(".error-notification").fadeOutAndRemove()}};return a})();StackExchange.init();var genuwine=function(){var a;return{url:"",init:function(b){var c=$(".genu");a=b;genuwine.url=c.attr("href");c.removeAttr("href").add(".unreadCount").click(genuwine.click);$(document).click(function(d){if(genuwine.isVisible()&&!$.contains($("#portalLink")[0],d.target)){genuwine.click()}})},isVisible:function(){return $(".genu").hasClass("genu-on")},click:function(){var b=$(".genu");var d=$("#seWrapper");if(d.length==0){genuwine.appendWrapper();d=$("#seWrapper");var e;if(inboxUnviewedCount>0){e=$("#seTabInbox");genuwine.ensureInbox(e)}else{e=$("#seTabHot");genuwine.ensureHot(e)}e.addClass("seCurrent")}var c=b.hasClass("genu-on");if(c){$(".unreadCountTab").hide();$(".itemBoxNew").removeClass("itemBoxNew");d.fadeOut("fast")}else{d.fadeIn("fast");$(".unreadCount").hide()}b.toggleClass("genu-on",!c);if(inboxUnviewedCount==-1){$(b).ready(function(){$("#seTabInbox").hide()})}},appendWrapper:function(){var b='<div id="seWrapper" style="position:absolute; display:none;"><div class="seIntro"><a href="'+genuwine.url+'">Stack Exchange</a> is a network of free, community-driven Q&A sites.</div><div class="seNav"><ul class="seNavLinks"><li><a id="seTabHot" onclick="genuwine.tabClick($(this))">Hot Questions</a></li><li><a id="seTabSites" onclick="genuwine.tabClick($(this))">All Sites</a></li><li><a id="seTabInbox" onclick="genuwine.tabClick($(this))">Inbox</a></li></ul></div><div class="seContainer"></div><div class="seFooter"><a>close</a></div></div>';$(b).appendTo("#portalLink");$(".seFooter").live("click",genuwine.click)},tabClick:function(b){$(".seNavLinks a").removeClass("seCurrent");b.addClass("seCurrent");switch(b.attr("id")){case"seTabHot":genuwine.ensureHot(b);$("#seContainerSites, #seContainerInbox").hide();$("#seContainerHot").fadeIn("fast");break;case"seTabSites":genuwine.ensureSites(b);$("#seContainerHot, #seContainerInbox").hide();$("#seContainerSites").fadeIn("fast");break;case"seTabInbox":genuwine.ensureInbox(b);$("#seContainerHot, #seContainerSites").hide();$("#seContainerInbox").fadeIn("fast");break}},ensureHot:function(b){if($("#seContainerHot").length==0){genuwine.loadHot(b)}},loadHot:function(b){genuwine.load(b,genuwine.url+"/genuwine?callback=?","jsonp",genuwine.renderHot)},renderHot:function(e,k){var h=$("<div/>");var g='<div id="seContainerHot" style="display:none">';for(var j=0;j<k.length;j++){var d=k[j];var f=d.SiteId;var c='href="http://'+f+"/q/"+d.Id+'?hq=1"';var b=parseInt(d.DisplayScore,10);g+='<div class="itemBox"><a '+c+' class="seNumAnswer">'+b+'</a><div class="siteInfo"><p><a '+c+">"+h.text(d.Title).html()+'</a></p><a href="http://'+f+'" class="siteLink">'+f+"</a></div></div>"}g+="</div>";genuwine.render(e,g)},ensureSites:function(b){if($("#seContainerSites").length==0){genuwine.loadSites(b)}},loadSites:function(b){genuwine.load(b,genuwine.url+"/genuwine/sites"+(!!a?("?accountId="+a+"&callback=?"):"?callback=?"),"jsonp",genuwine.renderSites)},renderSites:function(d,c){var f='<div id="seContainerSites" style="display:none">';for(var g=0;g<c.length;g++){var h=c[g];var e=h.Name;var b='href="http://'+h.Id+'?as=1"';f+='<div class="itemBox"><a '+b+' class="siteFavicon"><img src="'+h.FaviconUrl+'" alt="'+e+'"></a><div class="siteInfo"><p><a '+b+">"+e+"</a></p><a "+b+' class="siteLink">'+h.Description+"</a></div></div>"}f+="</div>";genuwine.render(d,f)},ensureInbox:function(b){if(inboxUnviewedCount==-1){return}if($("#seContainerInbox").length==0){genuwine.loadInbox(b)}if(inboxUnviewedCount>0&&b.find(".unreadCountTab").length==0){b.prepend('<span class="unreadCountTab">'+inboxUnviewedCount+"</span>")}},loadInbox:function(b){genuwine.load(b,"/inbox/genuwine","json",genuwine.renderInbox,true)},renderInbox:function(f,m){var g='<div id="seContainerInbox" style="display:none">';for(var l=0;l<m.length;l++){var e=m[l];var b='href="'+e.Url+'"';var k='title="'+e.CreationDate+'"';var d=e.Count;var j=e.IsNew?" itemBoxNew":"";g+='<div class="itemBox'+j+'"><a '+b+' class="siteLinkFavicon"><img src="'+e.FaviconUrl+'" alt="'+e.SiteUrl+'"></a><div class="siteInfo">';if(e.Type=="careers message"){g+="<p><a "+b+' style="font-weight:normal"><b>'+e.Title+"</b> wants to contact you on <b>Stack Overflow Careers</b></a></p>"}else{if(e.Type=="invitation"){var c=e.Count;var h="invitation"+(c>1?"s":"");g+="<p><a "+b+' style="font-weight:normal"><b>'+c+"</b> "+h+" awarded on <b>Stack Overflow Careers</b></a></p>"}else{g+="<p>"+(d>1?d+" ":"")+e.Type+" on <a "+b+" "+k+">"+e.Title+"</a></p>"}}g+='<p class="inboxSummary">'+(e.Summary||"")+"</p></div></div>"}if(a&&m.length>=5){g+='<div class="itemMoreContainer"><div class="seIntro"><a href="http://stackexchange.com/users/'+a+'?tab=inbox">more inbox messages &hellip;</a></div></div>'}g+="</div>";genuwine.render(f,g)},currentlyLoading:{},load:function(g,f,b,e,h){var d=g.attr("id");if(genuwine.currentlyLoading[d]){genuwine.addSpinnerToContainer();return}genuwine.currentlyLoading[d]=true;genuwine.addSpinnerToContainer();var c=function(){genuwine.currentlyLoading[d]=false;StackExchange.helpers.showErrorPopup($(".seContainer"),"An error occurred while loading - please try again.")};$.ajax({type:"GET",url:f,dataType:b,success:function(i){if(i&&(i.length>0||h)){e(g,i)}else{c()}},error:c,complete:StackExchange.helpers.removeSpinner})},render:function(c,d){var b=$(d);b.appendTo(".seContainer");if(c.hasClass("seCurrent")){b.fadeIn("fast")}},addSpinnerToContainer:function(){StackExchange.helpers.removeSpinner();StackExchange.helpers.addSpinner(".seContainer",{position:"relative",left:"10px",top:"10px"})}}}();(function(){var a=genuwine.init;$.extend(genuwine,{loadUnviewedCount:function(){$.get("/inbox/genuwine/unviewed-count",null,genuwine.renderUnviewedCount,"json")},renderUnviewedCount:function(b){if(b&&typeof(b.UnviewedCount)=="number"){window.inboxUnviewedCount=b.UnviewedCount}if(b&&b.UnviewedCount>0){var c=$("<a />").addClass("unreadCount").text(Math.min(b.UnviewedCount,99)).click(genuwine.click);$(".genu").after(c).removeClass("genu-loading");$("#seTabInbox").show()}},init:function(){if($(".genu").hasClass("genu-loading")){genuwine.loadUnviewedCount()}a.apply(this,arguments)}})})();