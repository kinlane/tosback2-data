window.StackExchange={};StackExchange.init=(function(){var a=function(){$(document).keyup(function(b){if(b.which==27){$(".error-notification, .popup").fadeOutAndRemove();if(window.genuwine&&genuwine.isVisible()){genuwine.click()}}})};return function(b){$.ajaxSetup({cache:false});StackExchange.init.createJqueryExtensions();$(function(){a()})}})();StackExchange.init.createJqueryExtensions=function(){$.fn.extend({fadeOutAndRemove:function(a){return this.each(function(){var b=$(this);b.fadeOut("fast",function(){b.trigger("removing").remove()})})},center:function(){var c=this.parent();if(c.css("position")==="static"){c=c.offsetParent()}var b=c.offset();var a=$(window);this.css("position","absolute");this.css("top",(a.height()-this.height())/2+a.scrollTop()-b.top+"px");this.css("left",(a.width()-this.width())/2+a.scrollLeft()-b.left+"px");return this}})};StackExchange.helpers=(function(){var a={addSpinner:function(c,b){$(c).append(a.getSpinnerImg(b))},getSpinnerImg:function(c){var b=$('<img class="ajax-loader" src="/content/img/progress-dots.gif" title="loading..." alt="loading..." />');if(c){b.css(c)}return b},removeSpinner:function(){$("img.ajax-loader").remove()},showErrorPopup:function(e,d,f){$(".error-notification").remove();var b=$('<div class="error-notification supernovabg"><h2>'+d+"</h2>"+(f?"":'<span class="error-close">(click on this box to dismiss)</span>')+"</div>");var c=function(){b.fadeOutAndRemove()};$(e).append(b);b.click(c).fadeIn("fast");setTimeout(c,(f?Math.max(2500,d.length*40):1000*30))},removeErrorPopup:function(){$(".error-notification").fadeOutAndRemove()}};return a})();StackExchange.init();var genuwine=function(){var a;return{url:"",init:function(c){var b=$(".genu");a=c;genuwine.url=b.attr("href");b.removeAttr("href").add(".unreadCount").click(genuwine.click);$(document).click(function(d){if(genuwine.isVisible()&&!$.contains($("#portalLink")[0],d.target)){genuwine.click()}})},isVisible:function(){return $(".genu").hasClass("genu-on")},click:function(){var d=$(".genu");var c=$("#seWrapper");if(c.length==0){genuwine.appendWrapper();c=$("#seWrapper");var b;if(inboxUnviewedCount>0){b=$("#seTabInbox");genuwine.ensureInbox(b)}else{b=$("#seTabHot");genuwine.ensureHot(b)}b.addClass("seCurrent")}var e=d.hasClass("genu-on");if(e){$(".unreadCountTab").hide();$(".itemBoxNew").removeClass("itemBoxNew");c.fadeOut("fast")}else{c.fadeIn("fast");$(".unreadCount").hide()}d.toggleClass("genu-on",!e);if(inboxUnviewedCount==-1){$(d).ready(function(){$("#seTabInbox").hide()})}},appendWrapper:function(){var b='<div id="seWrapper" style="position:absolute; display:none;"><div class="seIntro"><a href="'+genuwine.url+'">Stack Exchange</a> is a network of free, community-driven Q&A sites.</div><div class="seNav"><ul class="seNavLinks"><li><a id="seTabHot" onclick="genuwine.tabClick($(this))">Hot Questions</a></li><li><a id="seTabSites" onclick="genuwine.tabClick($(this))">All Sites</a></li><li><a id="seTabInbox" onclick="genuwine.tabClick($(this))">Inbox</a></li></ul></div><div class="seContainer"></div><div class="seFooter"><a>close</a></div></div>';$(b).appendTo("#portalLink");$(".seFooter").live("click",genuwine.click)},tabClick:function(b){$(".seNavLinks a").removeClass("seCurrent");b.addClass("seCurrent");switch(b.attr("id")){case"seTabHot":genuwine.ensureHot(b);$("#seContainerSites, #seContainerInbox").hide();$("#seContainerHot").fadeIn("fast");break;case"seTabSites":genuwine.ensureSites(b);$("#seContainerHot, #seContainerInbox").hide();$("#seContainerSites").fadeIn("fast");break;case"seTabInbox":genuwine.ensureInbox(b);$("#seContainerHot, #seContainerSites").hide();$("#seContainerInbox").fadeIn("fast");break}},ensureHot:function(b){if($("#seContainerHot").length==0){genuwine.loadHot(b)}},loadHot:function(b){genuwine.load(b,genuwine.url+"/genuwine?callback=?","jsonp",genuwine.renderHot)},renderHot:function(g,d){var k=$("<div/>");var j='<div id="seContainerHot" style="display:none">';for(var c=0;c<d.length;c++){var h=d[c];var b=h.SiteId;var f='href="http://'+b+"/q/"+h.Id+'?hq=1"';var e=parseInt(h.DisplayScore,10);j+='<div class="itemBox"><a '+f+' class="seNumAnswer">'+e+'</a><div class="siteInfo"><p><a '+f+">"+k.text(h.Title).html()+'</a></p><a href="http://'+b+'" class="siteLink">'+b+"</a></div></div>"}j+="</div>";genuwine.render(g,j)},ensureSites:function(b){if($("#seContainerSites").length==0){genuwine.loadSites(b)}},loadSites:function(b){genuwine.load(b,genuwine.url+"/genuwine/sites"+(!!a?("?accountId="+a+"&callback=?"):"?callback=?"),"jsonp",genuwine.renderSites)},renderSites:function(g,e){var h='<div id="seContainerSites" style="display:none">';for(var d=0;d<e.length;d++){var f=e[d];var c=f.Name;var b='href="http://'+f.Id+'?as=1"';h+='<div class="itemBox"><a '+b+' class="siteFavicon"><img src="'+f.FaviconUrl+'" alt="'+c+'"></a><div class="siteInfo"><p><a '+b+">"+c+"</a></p><a "+b+' class="siteLink">'+f.Description+"</a></div></div>"}h+="</div>";genuwine.render(g,h)},ensureInbox:function(b){if(inboxUnviewedCount==-1){return}if($("#seContainerInbox").length==0){genuwine.loadInbox(b)}if(inboxUnviewedCount>0&&b.find(".unreadCountTab").length==0){b.prepend('<span class="unreadCountTab">'+inboxUnviewedCount+"</span>")}},loadInbox:function(b){genuwine.load(b,"/inbox/genuwine","json",genuwine.renderInbox,true)},renderInbox:function(l,j){var m='<div id="seContainerInbox" style="display:none">';for(var c=0;c<j.length;c++){var e=j[c];var d='href="'+e.Url+'"';var b='title="'+e.CreationDate+'"';var f=e.Count;var g=e.IsNew?" itemBoxNew":"";m+='<div class="itemBox'+g+'"><a '+d+' class="siteLinkFavicon"><img src="'+e.FaviconUrl+'" alt="'+e.SiteUrl+'"></a><div class="siteInfo">';if(e.Type=="careers message"){m+="<p><a "+d+' style="font-weight:normal"><b>'+e.Title+"</b> wants to contact you on <b>Stack Overflow Careers</b></a></p>"}else{if(e.Type=="invitation"){var k=e.Count;var h="invitation"+(k>1?"s":"");m+="<p><a "+d+' style="font-weight:normal"><b>'+k+"</b> "+h+" awarded on <b>Stack Overflow Careers</b></a></p>"}else{m+="<p>"+(f>1?f+" ":"")+e.Type+" on <a "+d+" "+b+">"+e.Title+"</a></p>"}}m+='<p class="inboxSummary">'+(e.Summary||"")+"</p></div></div>"}if(a&&j.length>=5){m+='<div class="itemMoreContainer"><div class="seIntro"><a href="http://stackexchange.com/users/'+a+'?tab=inbox">more inbox messages &hellip;</a></div></div>'}m+="</div>";genuwine.render(l,m)},currentlyLoading:{},load:function(d,c,b,g,f){var h=d.attr("id");if(genuwine.currentlyLoading[h]){genuwine.addSpinnerToContainer();return}genuwine.currentlyLoading[h]=true;genuwine.addSpinnerToContainer();var e=function(){genuwine.currentlyLoading[h]=false;StackExchange.helpers.showErrorPopup($(".seContainer"),"An error occurred while loading - please try again.")};$.ajax({type:"GET",url:c,dataType:b,success:function(i){if(i&&(i.length>0||f)){g(d,i)}else{e()}},error:e,complete:StackExchange.helpers.removeSpinner})},render:function(d,c){var b=$(c);b.appendTo(".seContainer");if(d.hasClass("seCurrent")){b.fadeIn("fast")}},addSpinnerToContainer:function(){StackExchange.helpers.removeSpinner();StackExchange.helpers.addSpinner(".seContainer",{position:"relative",left:"10px",top:"10px"})}}}();(function(){var a=genuwine.init;$.extend(genuwine,{loadUnviewedCount:function(){$.get("/inbox/genuwine/unviewed-count",null,genuwine.renderUnviewedCount,"json")},renderUnviewedCount:function(c){if(c&&typeof(c.UnviewedCount)=="number"){window.inboxUnviewedCount=c.UnviewedCount}if(c&&c.UnviewedCount>0){var b=$("<a />").addClass("unreadCount").text(Math.min(c.UnviewedCount,99)).click(genuwine.click);$(".genu").after(b).removeClass("genu-loading");$("#seTabInbox").show()}},init:function(){if($(".genu").hasClass("genu-loading")){genuwine.loadUnviewedCount()}a.apply(this,arguments)}})})();