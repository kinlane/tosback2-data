bc.namespace("bc.module");bc.module.FloaterVideo=function(b){var e=this;e.brcvExperience=b.brcvExperience;e._initialVideoReferenceId=b.initialVideoReferenceId;e._contentIdParamName=b.contentIdParamName;e._pageViewURL=b.pageViewURL;e._experienceModule=this.brcvExperience.getModule(APIModules.EXPERIENCE);e._videoTitle=b.videoTitle;e._advertisingModule=this.brcvExperience.getModule(APIModules.ADVERTISING);e._videoPlayerModule=this.brcvExperience.getModule(APIModules.VIDEO_PLAYER);e._contentModule=this.brcvExperience.getModule(APIModules.CONTENT);e._socialModule=this.brcvExperience.getModule(APIModules.SOCIAL);e._didTrackingOnAdComplete=false;e._popupPrefix=b.popupPrefix;e._adsShown=false;$("#"+e._popupPrefix+"Closer"+e._initialVideoReferenceId).click(function(){e._videoPlayerModule.pause(true);});this._onTemplateReady=function(){e._doOmnitureTracking("LIGHTBOX_OPEN");e._videoPlayerModule.loadVideo(e._initialVideoReferenceId,"referenceId");e.adServerURL="http://ad.doubleclick.net/pfadx/bc3.video/";var g={type:"GET",async:false,url:"/ad/adInfo.htm?contentType=video&contentId="+e._initialVideoReferenceId,data:null,dataType:"json",cache:false,success:function(j,i,h){g.data=j;},error:function(i,h,j){new bc.Exception("Error in bc.module.FloaterVideo.Dialog.\n\ntype = "+h+"\nmessage = "+j.message);}};$.ajax(g);if(g.data&&g.data.keywords){var f=new Object();f.adServerURL=e.adServerURL+";"+g.data.keywords;e._advertisingModule.setAdPolicy(f);}e._setShareLinkURL(e._initialVideoReferenceId);$(".videoFloater .seeAllLink a").click(function(h){e._doOmnitureTracking("LIGHTBOX_SEEALL");});};this._onAdComplete=function(f){e._advertisingModule.showSponsorMessage(false);e._didTrackingOnAdComplete=true;e._doOmnitureTracking(f);};this._onAdClick=function(){e._advertisingModule.showSponsorMessage(false);};this._onStreamStart=function(f){if(!e._didTrackingOnAdComplete){this._doOmnitureTracking(f);e._didTrackingOnAdComplete=false;}};this._onExternalAd=function(f){var m;if(window.ActiveXObject){m=new ActiveXObject("Microsoft.XMLDOM");m.async=false;m.loadXML(f.ad);}else{if(window.XMLHttpRequest){m=(new DOMParser()).parseFromString(f.ad,"text/xml");}}var g=false;var l=new Object();var o=false;var n=new Object();l.type="videoAd";l.duration=m.firstChild.getAttribute("duration");l.trackStartURLs=m.firstChild.getAttribute("trackStartURLs").replace("[%Track Start URLs%]","").split(",");l.trackMidURLs=m.firstChild.getAttribute("trackMidURLs").replace("[%Track Mid URLs%]","").split(",");l.trackEndURLs=m.firstChild.getAttribute("trackEndURLs").replace("[%Track End URLs%]","").split(",");l.trackPointTime="0";n.type="Banner468x60";var h=m.firstChild.firstChild;for(var k=0;k<m.firstChild.childNodes.length;k++){var j=null;var p=null;if(h.firstChild){switch(h.nodeName){case"videoURL":g=true;l.videoURL=h.firstChild.nodeValue;break;case"videoClickURL":l.videoClickURL=h.firstChild.nodeValue;break;case"collapsedBannerURL":o=true;n.bannerURL=h.firstChild.nodeValue;break;case"collapsedBannerClickURL":n.bannerClickURL=h.firstChild.nodeValue;break;default:continue;}}h=h.nextSibling;}if(o){$("#logoAd"+e._initialVideoReferenceId).remove();$("#"+e._popupPrefix+e._initialVideoReferenceId+" .inner").prepend("<div id='logoAd"+e._initialVideoReferenceId+"'><span style='display: inline-block; vertical-align: top;'>Sponsored by&nbsp;</span><a href='"+n.bannerClickURL+"' target='_blank'><img src='"+n.bannerURL+"'/></a></div>");}if(g&&!e._adsShown){e._advertisingModule.showAd(l);}};this._setShareLinkURL=function(f){e._socialModule.setLink("http://"+window.location.host+"/2_video_"+f+".bc");};this._doOmnitureTracking=function(g){var f=g.type||g;if(f=="LIGHTBOX_OPEN"){bc.frag.tracking.OmnitureManager.trackAction("event15",{eVar9:"Video promo module | Click"},null);}else{if(f=="LIGHTBOX_SEEALL"){bc.frag.tracking.OmnitureManager.trackPageExitAction(null,null,{prop11:"BC_Body",prop12:"BC_LightBoxVideo_SeeAll"},null);}else{var i="event16";var h="Embedded Video | "+((e._videoTitle!=undefined)?e._videoTitle:e._videoID+"");bc.frag.tracking.OmnitureManager.trackAction(i,{eVar20:h},null);}}};var d=function(f){e._onAdComplete(f);};var a=function(f){e._onStreamStart(f);};var c=function(f){e._videoPlayerModule.stop(true);};this._advertisingModule.enableExternalAds(true);this._experienceModule.addEventListener(BCExperienceEvent.TEMPLATE_READY,this._onTemplateReady);this._advertisingModule.addEventListener(BCAdvertisingEvent.EXTERNAL_AD,e._onExternalAd);this._advertisingModule.addEventListener(BCAdvertisingEvent.AD_COMPLETE,d);this._advertisingModule.addEventListener(BCAdvertisingEvent.AD_CLICK,e._onAdClick);this._advertisingModule.addEventListener(BCAdvertisingEvent.AD_PAUSE,e._onAdClick);this._videoPlayerModule.addEventListener(BCVideoEvent.STREAM_START,a);this._videoPlayerModule.addEventListener(BCVideoEvent.VIDEO_COMPLETE,c);};bc.module.FloaterVideo.Dialog=function(a){var b=this;b._videoID=a.videoID;b._videoTitle=a.videoTitle;b.openerID=a.openerPrefix+b._videoID;b.popupID=a.popupPrefix+b._videoID;b.closerBtnId=a.popupPrefix+"Closer"+b._videoID;$("#"+b.openerID).click(function(c){c.preventDefault();globalCurrentVideoID=b._videoID;globalCurrentVideoTitle=b._videoTitle;if(!brightcove.checkFlashSupport()){$("#"+b.popupID+" iframe,").remove();var d='<object id="popExperience" class="BrightcoveExperience">';d+='   <param name="bgcolor" value="#FFFFFF" />';d+='   <param name="width" value="494" />';d+='   <param name="height" value="418" />';d+='   <param name="playerID" value="979142054001" />';d+='   <param name="publisherID" value="1546279903" />';d+='   <param name="@videoPlayer" value="ref:'+b._videoID+'" />';d+='   <param name="isVid" value="true" />';d+='   <param name="isUI" value="true" />';d+='   <param name="wmode" value="transparent" />';d+=" </object>";$("#"+b.popupID+" .inner").before(d);brightcove.createExperiences();}b.videoDialog=new bc.module.Dialog(b.popupID,true);b.videoDialog.open();$("#"+b.popupID).css({"z-index":16777270});});$("#"+b.closerBtnId).click(function(){b.videoDialog.close();$("#logoAd"+b._videoID).remove();});};