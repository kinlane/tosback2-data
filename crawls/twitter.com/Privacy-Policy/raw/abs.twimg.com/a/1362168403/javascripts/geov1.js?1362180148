twttr.geo={LOG_VERSION:2,LOCATION_CACHE_INTERVAL:30000,BROWSER_GEO_BANNER_APPEAR_DELAY:500,BROWSER_GEO_BANNER_DISAPPEAR_INTERVAL:100,PLACE_SEARCH_AUTOCOMPLETE_DELAY:250,MAX_NEARBY_PLACES:12,MAX_PLACE_SEARCH_RESULTS:50,MAX_PLACE_AUTOCOMPLETE_RESULTS:8,PLACE_SEARCH_RESULTS_PER_PAGE:5,PLACE_CREATION_ACCURACY_THRESHOLD:500,ACCEPTABLE_LOCATION_ACCURACY:1000,ACCEPTABLE_LOCATION_TIMEOUT:5000,LOCATION_TIMEOUT:25000,LOCATION_MAXIMUM_AGE:60000,MAX_SIMILAR_PLACES:5,GENERIC_PLACE_TYPES:{city:null,neighborhood:null,admin:null,country:null},TARGET_POI_NAME_LENGTH:40,TARGET_PLACE_NAME_LENGTH:50,templates:{dropdownItem:{container:'<li id="place_{{id}}"><span class="place_item_icon">&nbsp;</span><span class="place_noicon">{{formatted_name}}</span></li>',poi:'<li id="place_{{id}}"><span class="place_item_icon">&nbsp;</span><span class="place_icon">&nbsp;</span> {{formatted_name}} <span class="place_details">{{details}}</span></li>'},searchResultItem:{container:'<li id="result_place_{{id}}"><span class="place_noicon"><a href="#">{{formatted_name}}</a></span></li>',poi:'<li id="result_place_{{id}}"><span class="place_icon">&nbsp;</span> <a href="#">{{formatted_name}}</a> <span class="place_details">{{details}}</span></li>'},autocompleteItem:{container:'<li><span class="place_noicon">{{formatted_name}}</span></li>',poi:'<li><span class="place_icon">&nbsp;</span> {{formatted_name}} <span class="place_details">{{details}}</span></li>'},nearbyActivityHeader:{container:'<span><a href="#">{{formatted_name}}</a></span>',poi:'<span><a href="#">{{full_name}} <span class="place_icon">&nbsp;</span></a></span>'},nearbyActivityItem:{container:'<li id="result_place_{{id}}"><a href="#"><span class="place_noicon">{{formatted_name}}</span></a><div class="geo_address">{{details}}</div></li>',poi:'<li id="result_place_{{id}}"><a href="#">{{formatted_name}}&nbsp;<span class="place_icon">&nbsp;</span></a><div class="geo_address">{{details}}</div></li>'}},options:{more_places:false,autocomplete:false,autocomplete_zero_delay:false,place_creation:false,place_creation_needs_high_accuracy:false,allow_set_location_manually:false,show_place_details_in_map:false}};twttr.geo.getBestContainer=function(a){if(!a){return{name:"",full_name:"",contained_within:[],place_type:"city",bounding_box:{type:"Polygon",coordinates:[[[-122.51368188,37.70813196],[-122.35845384,37.70813196],[-122.35845384,37.83245301],[-122.51368188,37.83245301]]]}}}var b={name:a.part_of_name||"",full_name:a.part_of_name||"",contained_within:[],place_type:"city"};if(a.contained_within){a.contained_within.every(function(c){b=c;return c.place_type!="city"})}return b};twttr.geo.getBestCity=function(a){return(a&&a.place_type=="city")?a:twttr.geo.getBestContainer(a)};twttr.geo.getLocationFromPlace=function(a){if(!a||!a.bounding_box||a.bounding_box.type!="Polygon"||!a.bounding_box.coordinates){return null}var b=a.bounding_box.coordinates[0];if(!b||b.length!=4){return null}return{accuracy:500*twttr.geo.greatCircleDistanceInKm(b[0][1],b[0][0],b[2][1],b[2][0]),latitude:(b[0][1]+b[2][1])*0.5,longitude:(b[0][0]+b[2][0])*0.5}};twttr.geo.getPlacePageLinkFromPlace=function(a){return"/search?"+$.param({q:"place:"+a.id,format:"html"})};twttr.geo.getPlacePageLinkAttrsFromPlace=function(a){var c=[a.attributes?a.attributes.street_address:null,a.contained_within&&a.contained_within.length>0?a.contained_within[0].full_name:null].filter(function(d){return d}).join(", ");var b=a.place_type=="poi"?c:a.name+", "+c;return{title:a.full_name,_query:"place:"+a.id,_place_details:c,_place_map_link:"http://maps.google.com/maps?"+$.param({q:b})}};twttr.geo.getPlaceDetails=function(a){if(a.attributes&&a.attributes.street_address){return a.attributes.street_address}switch(a.place_type){case"city":return _("a city");case"neighborhood":return _("a neighborhood");case"country":return _("a country");case"admin":return _("a state or province");default:return _("a place")}return twttr.geo.getBestContainer(a).name};twttr.geo.formatPlaceName=function(a,b){if(a.length<=b){return a}a=a.replace(/ [(].*[)]/g,"");if(a.length<=b){return a}var c="...";return a.substr(0,b-c.length)+c};twttr.geo.renderPlace=function(b,a){if(a.place_type in twttr.geo.GENERIC_PLACE_TYPES){b=b.container;a.formatted_name=twttr.geo.formatPlaceName(a.full_name,twttr.geo.TARGET_PLACE_NAME_LENGTH)}else{b=b.poi;a.formatted_name=twttr.geo.formatPlaceName(a.name,twttr.geo.TARGET_POI_NAME_LENGTH)}a.details=twttr.geo.getPlaceDetails(a);return $(Mustache.to_html(b,a))};twttr.geo.geoScribe=function(a,b){scribe($.extend({event_name:a,ui_version:1,log_version:twttr.geo.LOG_VERSION},b),"geo_checkins")};twttr.geo.Exceptions={GeoSupportException:function(){this.msg=_("This browser does not support GeoLocation")}};twttr.geo.Errors={PermissionDeniedError:function(){this.allowRetry=false;this.fatal=true;this.msg=_("Please grant your web browser permission to tell Twitter where you are.")},LocationDetectionError:function(){this.allowRetry=true;this.fatal=false;this.msg=_("We were unable to detect your location.")}};twttr.geo.greatCircleDistanceInKm=function(h,f,g,e){var c=Math.PI/180;var a=Math.sin((g-h)*c*0.5);var b=Math.sin((e-f)*c*0.5);var d=a*a+Math.cos(h*c)*Math.cos(g*c)*b*b;return 12742*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))};twttr.klass("twttr.geo.Map",function(b){if(!twttr.geo.mapsUI.mapsAvailable()){return}var a={mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:true,scrollwheel:false,navigationControl:true,navigationControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,style:google.maps.NavigationControlStyle.SMALL}};this.map=new google.maps.Map(b,a);this.bounds=null}).method("createMapOverlay",function(){function a(b){this.setMap(b)}a.prototype=new google.maps.OverlayView();a.prototype.onAdd=function(){};a.prototype.onRemove=function(){};a.prototype.draw=function(){};this.mapOverlay=new a(this.map)}).method("extendBounds",function(a){if(!this.bounds){this.bounds=new google.maps.LatLngBounds()}this.bounds.extend(a)}).method("addPoint",function(a,c){var e=this;var f=new google.maps.LatLng(a[1],a[0]);e.extendBounds(f);var d=new google.maps.MarkerImage("http://abs.twimg.com/a/1362168403/images/pin.png",new google.maps.Size(43,32),null,new google.maps.Point(14,33));e.marker=new google.maps.Marker({flat:true,icon:d,map:e.map,position:f,clickable:false,zIndex:2});if(c){var b=new google.maps.MarkerImage(c,new google.maps.Size(24,24),null,new google.maps.Point(13,32));e.avatar=new google.maps.Marker({flat:true,icon:b,map:e.map,position:f,zIndex:3})}}).method("addPoi",function(b,d){var f=this;var a=typeof(d)=="function";var g=new google.maps.LatLng(b[1],b[0]);f.extendBounds(g);var e=new google.maps.MarkerImage("http://abs.twimg.com/a/1362168403/images/poi-pin.png",new google.maps.Size(43,32),null,new google.maps.Point(14,33));var c=new google.maps.Marker({flat:true,icon:e,map:f.map,position:g,draggable:a,clickable:a,zIndex:2});if(a){google.maps.event.addListener(c,"dragend",function(h){d(h.latLng.lat(),h.latLng.lng())})}}).method("addFocusablePoint",function(a,f){var d=this;var g=new google.maps.LatLng(a[1],a[0]);d.extendBounds(g);var e=new google.maps.MarkerImage("http://abs.twimg.com/a/1362168403/images/place-minor10x.png",new google.maps.Size(10,10),new google.maps.Point(10,0),new google.maps.Point(5,5));var c=new google.maps.MarkerImage("http://abs.twimg.com/a/1362168403/images/place-minor10x.png",new google.maps.Size(10,10),null,new google.maps.Point(5,5));var b=new google.maps.Marker({flat:true,icon:c,map:d.map,position:g,clickable:f!==undefined,zIndex:2});if(f){if(d.mapOverlay===undefined){d.createMapOverlay()}google.maps.event.addListener(b,"mouseover",function(h){f(true,d.mapOverlay.getProjection().fromLatLngToContainerPixel(g))});google.maps.event.addListener(b,"mouseout",function(h){f(false,d.mapOverlay.getProjection().fromLatLngToContainerPixel(g))})}return function(h){if(h){b.setIcon(e);b.setZIndex(3)}else{b.setIcon(c);b.setZIndex(2)}}}).method("addAccuracyRing",function(b,a,f){var e=new google.maps.LatLng(b[1],b[0]);var d=new google.maps.Circle({map:f?this.map:null,center:e,radius:a,clickable:false,fillColor:"#0040FF",fillOpacity:0.08,strokeColor:"#2929D4",strokeOpacity:0.7,strokeWeight:0.5,zIndex:1});var c=d.getBounds();if(a>200){this.extendBounds(c.getNorthEast());this.extendBounds(c.getSouthWest())}}).method("addPlacePolygon",function(b){if(b[0][0] instanceof Array){b=b[0]}var d=[];for(var c=0;c<b.length;c++){var a=new google.maps.LatLng(b[c][1],b[c][0]);d.push(a);this.extendBounds(a)}var e=new google.maps.Polygon({path:d,strokeColor:"#FF0000",strokeOpacity:0.5,strokeWeight:0.5,fillColor:"#FF0000",fillOpacity:0.2});e.setMap(this.map)}).method("isEmpty",function(){return !this.bounds}).method("adjustBounds",function(b){var a=this.bounds.getSouthWest();var e=this.bounds.getNorthEast();if(e.equals(a)){this.map.setZoom(b||13);this.map.setCenter(e)}else{var g=this.bounds.getCenter();var d=0.7;function f(h,c){return h*d+c*(1-d)}this.map.fitBounds(new google.maps.LatLngBounds(new google.maps.LatLng(f(a.lat(),g.lat()),f(a.lng(),g.lng())),new google.maps.LatLng(f(e.lat(),g.lat()),f(e.lng(),g.lng()))))}}).method("resize",function(){google.maps.event.trigger(this.map,"resize")});twttr.geo.mapsUI={templates:{mapProgress:'<div id="geo_map_progress" class="hoverer"><div class="hovercard-divot"></div><div class="hoverer-inner"><div id="geo_map_spinner">&nbsp;</div></div></div>',mapWithPlace:'<div id="geo_modal" class="hoverer"><div class="hovercard-divot"></div><div class="hoverer-inner geo_map_with_place"><div id="map_canvas"></div><div class="geo_map_place_details"><div class="geo_map_place_name"></div><div class="geo_map_place_address"></div><div class="geo_map_place_container"></div><div class="geo_map_place_phone"></div><div class="geo_map_place_tweets"><a href="javascript:undefined">{{_i}}Tweets at this place &rarr;{{/i}}</a></div></div><a href="#" class="map_close">&times;</a></div></div>',mapWithoutPlace:'<div id="geo_modal" class="hoverer"><div class="hovercard-divot"></div><div class="hoverer-inner"><div id="map_canvas"></div><a href="#" class="map_close">&times;</a></div></div>'},googleApiAvailable:function(){return typeof google!="undefined"},loadMaps:function(c){if(this.googleApiAvailable()&&google.load!==undefined){var b=window.location.hostname.match(/^(.+\.)?twitter\.com$/);var a=google.load("maps","3",{callback:c,other_params:b?"client=free-twitter&sensor=false":"sensor=false"})}else{c()}},mapsAvailable:function(){return this.googleApiAvailable()&&google.maps!==undefined},initialize:function(){var a=this;if(a.googleApiAvailable()){a.liveClickHandler=function(c){c.preventDefault();var b=$(this).closest("span.entry-meta");a.openMapModal(b.meta(),b.find("a.geocoded_google_link"))};$(".geo-pin, a.geocoded_google_link").live("click",a.liveClickHandler)}},closeMapModal:function(){$(".geo-pin.selected").removeClass("selected");$("#geo_modal").remove();$("#geo_map_progress").remove();this.geoMap=null},openMapModal:function(g,b){var d=this;d.closeMapModal();var c=$(b);c.addClass("selected");c.after(Mustache.to_html(d.templates.mapProgress));d.showHover($("#geo_map_progress"),c,150);var f=g.place_id;var e=f&&twttr.geo.options.show_place_details_in_map?d.templates.mapWithPlace:d.templates.mapWithoutPlace;c.after(Mustache.to_html(e));$("html").one("click",function(h){d.closeMapModal()});$(".map_close").click(function(h){h.preventDefault();d.closeMapModal()});var a=$("#map_canvas").get(0);twttr.geo.mapsUI.loadMaps(function(){d.geoMap=new twttr.geo.Map(a);var h=d.geoMap;var i=false;var j=function(){if(!i&&g.latlng){d.geoMap.addPoint(g.latlng.slice().reverse(),g.avatar_url)}if(d.geoMap.isEmpty()){d.closeMapModal();return}d.geoMap.adjustBounds();$("#geo_map_progress").remove();d.showHover($("#geo_modal"),c,0)};if(f){twttr.api.getPlaceDetails({place_id:g.place_id,success:function(l,n){if(h!=d.geoMap){return}var m=l.geometry.coordinates;if(l.geometry.type=="Polygon"){d.geoMap.addPlacePolygon(m)}else{if(l.geometry.type=="MultiPolygon"){m.forEach(function(o){d.geoMap.addPlacePolygon(o)})}else{if(l.geometry.type=="Point"){d.geoMap.addPoint(m,g.avatar_url);i=true}}}$(".geo_map_place_name").text(l.name);$(".geo_map_place_address").text((l.attributes&&l.attributes.street_address)||"");var k=twttr.geo.getBestContainer(l);$(".geo_map_place_container").text(k.full_name||"");$(".geo_map_place_phone").text((l.attributes&&l.attributes.phone)||"");$(".geo_map_place_tweets a").attr("href",twttr.geo.getPlacePageLinkFromPlace(l));if(window.location.pathname=="/"){$(".geo_map_place_tweets a").attr(twttr.geo.getPlacePageLinkAttrsFromPlace(l)).isSearchLink().click(function(){d.closeMapModal()})}j()}})}else{j()}})},showHover:function(a,b,c){a.visible(false);twttr.SimplePositioner.setPosition(a,b,{itemHeight:180,offsets:{above:{top:-10,left:-40},below:{top:10,left:-40}},direction:"prefer below",hasContainer:true});a.click(function(d){d.stopPropagation()});setTimeout(function(){a.visible(true)},c)}};$(function(){twttr.geo.mapsUI.initialize()});twttr.klass("twttr.geo.PlacesDropdown",function(b,d){var c=this;c.placer=b;c.opts=d;var a="<a id='place_link' href='#'><span id='place_name'></span> ▾</a><ul class='round places_list'/>";$("#place_content").html(a).bind("tweet",function(){var e=c.placer.getState();c.placer.determinePlaces(function(){c.rebuildPlacesDropdown()},function(){$(".geo_disable_webclient:first").click()});if($("#place_id").val()!=""){twttr.geo.geoScribe("geotweet",e)}});c.$placesList=$("#place_content ul.places_list");c.rebuildPlacesDropdown();$("#place_link").click(function(f){f.preventDefault();if($("#place_content ul.places_list:visible").length>0){c.closeMenu()}else{c.openMenu();f.stopPropagation()}})}).method("rebuildPlacesDropdown",function(){var a=this;a.$placesList.empty();a.appendPoiPlaces(a.placer.places);a.appendNonPoiPlaces(a.placer.places);a.appendMorePlaces();$(".geo_more_places").click(function(b){b.preventDefault();new twttr.geo.PlaceSearchDialog(a.placer,a.opts,function(){a.rebuildPlacesDropdown();a.showSelectedPlace()});twttr.geo.geoScribe("click_search_places")});a.showSelectedPlace()}).method("appendPoiPlaces",function(a){var b=false;a.forEach(function(c){if(c.place_type=="poi"){this.$placesList.append(this.createPlaceItem(c));b=true}},this);return b}).method("appendNonPoiPlaces",function(a){a.forEach(function(b){if(b.place_type!="poi"){this.$placesList.append(this.createPlaceItem(b))}},this)}).method("createPlaceItem",function(a){var c=this;var b=twttr.geo.renderPlace(twttr.geo.templates.dropdownItem,a);b.click(function(d){d.preventDefault();c.placer.selectPlace(a);c.rebuildPlacesDropdown();c.closeMenu();twttr.geo.geoScribe("click_place_item",c.placer.getState())});return b}).method("appendMorePlaces",function(){if(this.opts.more_places){this.$placesList.append('<li class="geo_more_places"><span class="place_item_icon more_places">&nbsp;</span>'+_("Search places...")+"</li>")}}).method("showSelectedPlace",function(){var a=this.placer.selectedPlace;var b;if(a.place_type!="poi"){b=_("in {{full_name}}")}else{b='<span class="place_icon">&nbsp;</span>'+_("at {{full_name}}")}$("#place_id").val(a.id);$("#place_name").html(Mustache.to_html(b,a));this.$placesList.children("li.selected").removeClass("selected");$("#place_"+a.id).addClass("selected")}).method("openMenu",function(){var b=this;var a=$("#place_link");var c=$("#place_link").position();b.$placesList.css({left:c.left,top:c.top+a.outerHeight()}).show();$(document).one("click",function(){b.closeMenu()});twttr.geo.geoScribe("open_places_dropdown",b.placer.getState())}).method("closeMenu",function(){this.$placesList.hide()});twttr.klass("twttr.geo.PlaceSearchDialog",function(e,b,h){var f=this;f.opts=b;f.onPlaceAccepted=h;f.place=e.selectedPlace;f.placer=e;f.city=twttr.geo.getBestCity(f.place);f.originalCity=f.city;f.placeHeading="{{_i}}Where are you?{{/i}}";f.placeString=(f.place&&f.place.place_type!="city")?f.place.name:"";f.originalPlaceString=f.placeString;f.placeHtml='<form id="place_search_form"><table class="geo_place_search_table"><tr><td class="geo_place_search_col1 geo_place_search_city">{{_i}}City{{/i}}</td><td class="geo_place_search_city">{{city}}&#32;&nbsp;<a href="#" id="change_city">{{_i}}Change{{/i}}</a></td></tr><tr><td class="geo_place_search_col1 geo_place_search_place">{{_i}}Place Name{{/i}}</td><td class="geo_place_search_place"><input id="place_search_query" type="text" autocomplete="off" class="round-left help-focusable" title="{{_i}}Type the name of a place{{/i}}"/><span class="place_search_submit round-right" title="{{_i}}Search{{/i}}">&nbsp;</span><ul class="round places_list place_search_dropdown"></ul></td></tr><tr><td></td><td class="geo_place_search_hint">{{_i}}Optional{{/i}}</td></tr><tr><td></td><td><div id="place_search_results"></div><button type="button" class="btn" id="place_search_done">{{_i}}Done{{/i}}</button><button type="button" class="btn hidden" id="place_search_cancel">{{_i}}Cancel{{/i}}</button></td></tr></table></form>';f.cityHeading="{{_i}}Change City{{/i}}</a>";f.cityHtml='<form id="place_search_form"><table class="geo_place_search_table"><tr><td class="geo_place_search_col1 geo_place_search_place">{{_i}}City{{/i}}</td><td class="geo_place_search_place"><input id="place_search_query" type="text" autocomplete="off" class="round-left help-focusable" title="{{_i}}Enter a city, state{{/i}}"/><span class="place_search_submit round-right" title="{{_i}}Search{{/i}}">&nbsp;</span><ul class="round places_list place_search_dropdown"></ul></td></tr><tr><td></td><td><div id="place_search_results"></div></td></tr></table></form>';f.noCityHeading="{{_i}}Where are you?{{/i}}</a>";$(".place_search_dialog").remove();f.dialog=new twttr.dialog({content:$("<div/>").appendTo("body"),heading:$('<div><span id="geo_search_places_title"></span></div>'),footer:null,cssClass:"place_search_dialog",closeButton:true,renderInline:true,modal:true,fixed:false});var d=e.opts.geoParams;f.searchParams={max_results:twttr.geo.MAX_PLACE_SEARCH_RESULTS,granularity:d.granularity};if(e.detectedPlace&&f.city.id==twttr.geo.getBestCity(e.detectedPlace).id&&d.lat!==undefined&&d.lon!==undefined&&d.accuracy!==undefined){twttr.merge(f.searchParams,{lat:d.lat,lon:d.lon,accuracy:d.accuracy})}else{f.setSearchParamsFromCity()}f.setCityMode(false);var g=$("#place_search_results");g.append("<ul/>");for(var c=0,a=g.find("ul");c<twttr.geo.MAX_PLACE_SEARCH_RESULTS;c++){a.append("<li>&nbsp;</li>")}f.dialog.open();g.empty();$("#place_search_query").focus().select()}).method("setHeadingAndContent",function(a,b){$("#geo_search_places_title").html(Mustache.to_html(a));$(".place_search_dialog .modal-content").html(Mustache.to_html(b,{city:this.city.full_name}))}).method("scribeSearch",function(b,c,a){var d=this;twttr.geo.geoScribe(b,$.extend({query:$("#place_search_query").helpVal(),mode:c?"city":"place",container_id:d.city.id,place_creation_allowed:d.shouldAllowPlaceCreation(c)},d.searchParams,a))}).method("setCityMode",function(b){var c=this;if(c.city.full_name==""){c.setHeadingAndContent(c.noCityHeading,c.cityHtml);b=true}else{if(b){c.setHeadingAndContent(c.cityHeading,c.cityHtml)}else{c.setHeadingAndContent(c.placeHeading,c.placeHtml)}}var a=$("#place_search_query");if(b){a.val(c.city.full_name)}else{a.val(c.placeString)}a.helpText().selectOnClick();if(twttr.geo.options.autocomplete){c.placeAutocomplete=new twttr.autocomplete({$input:a,$dropdown:$(".place_search_dropdown"),getInputVal:function(){return a.helpVal()},fetchMatches:function(e,g,f){twttr.api.search({data:twttr.merge({},c.searchParams,{query:e,autocomplete:"true",max_results:twttr.geo.MAX_PLACE_AUTOCOMPLETE_RESULTS,granularity:b?"city":c.searchParams.granularity}),success:function(h,i){g(h.result.places)},error:function(){f()}})},renderMatch:function(f,e,g){return twttr.geo.renderPlace(twttr.geo.templates.autocompleteItem,f).click(function(i){var h=[];g.forEach(function(j){h.push(j.id)});c.placeAccepted(f,b);c.scribeSearch("place_search_dialog_select_autocomplete",b,{selected_id:f.id,selected_index:e,place_ids:h})})},delay:twttr.geo.options.autocomplete_zero_delay?0:twttr.geo.PLACE_SEARCH_AUTOCOMPLETE_DELAY})}var d=$("#place_search_form");d.submit(function(f){f.preventDefault();var g=a.helpVal();if(c.placeAutocomplete){c.placeAutocomplete.hide()}if(!g){c.placeAccepted(c.city,b);return}if(b&&g==c.city.full_name){c.setCityMode(false);return}c.setWaitCursor(true);$("#place_search_done").hide();$("#place_search_cancel").show();$("#place_search_results").html(Mustache.to_html('<div class="geo_search_message">{{_i}}Searching for "{{query}}"...{{/i}}</div>',{query:g})).show();twttr.api.search({data:twttr.merge({},c.searchParams,{query:g,granularity:b?"city":c.searchParams.granularity}),success:function(e){c.setWaitCursor(false);c.searchResultPlaces=e.result.places;twttr.geo.mapsUI.loadMaps(function(){c.displayResults(0,b)})},error:function(e,i,h){c.setWaitCursor(false);c.displaySearchError(e,b)}})});$(".place_search_submit").click(function(){c.searchTrigger="click_icon";d.submit()});a.keydown(function(f){if(f.keyCode==13){c.searchTrigger="enter_key";f.preventDefault();d.submit()}});$("#place_search_done").click(function(){c.searchTrigger="click_done";var e=a.helpVal();if(c.place&&c.place.name==e&&c.city==c.originalCity){c.placeAccepted(c.place,b);c.scribeSearch("place_search_dialog_done_no_changes",b)}else{d.submit()}});$("#place_search_cancel").click(function(){c.dialog.close();c.scribeSearch("place_search_dialog_close",b,{triggered_by:"click_cancel"})});$("#change_city").click(function(f){f.preventDefault();c.placeString=a.helpVal();c.setCityMode(true);c.scribeSearch("place_search_dialog_change_city")});a.focus().select()}).method("setWaitCursor",function(a){$(".place_search_submit").toggleClass("loading",a)}).method("shouldAllowPlaceCreation",function(a){return !a&&this.opts.place_creation&&twttr.geo.mapsUI.mapsAvailable()&&(!this.opts.place_creation_needs_high_accuracy||this.searchParams.accuracy!==undefined&&this.searchParams.accuracy<=twttr.geo.PLACE_CREATION_ACCURACY_THRESHOLD)&&this.city.country_code=="US"}).method("displayResults",function(i,g){var e=this;var b=i*twttr.geo.PLACE_SEARCH_RESULTS_PER_PAGE;var f=b+twttr.geo.PLACE_SEARCH_RESULTS_PER_PAGE;var a=e.searchResultPlaces.slice(b,f);var j=$("#place_search_results").empty();var h=$("#place_search_query").helpVal();if(a.length==0){j.html(Mustache.to_html('<div class="geo_search_message">{{_i}}We couldn\'t find "{{query}}."{{/i}}</div>',{query:h}))}var c=[];var d=$("<ul/>").appendTo(j);a.forEach(function(k,l){c.push(k.id);var m=twttr.geo.renderPlace(twttr.geo.templates.searchResultItem,k);m.find("a").click(function(n){n.preventDefault();e.scribeSearch("place_search_dialog_select_result",g,{place_ids:c,selected_id:k.id,selected_index:l});e.placeAccepted(k,g)}).attr("title",twttr.geo.getPlaceDetails(k));d.append(m)});if(e.searchResultPlaces.length>twttr.geo.PLACE_SEARCH_RESULTS_PER_PAGE){j.append(Mustache.to_html('<div class="geo_next_prev"><a href="#" id="geo_prev_result">&laquo;&nbsp;{{_i}}Prev{{/i}}</a><a href="#" id="geo_next_result">{{_i}}Next{{/i}}&nbsp;&raquo;</a></div>'));e.setNextPrev($("#geo_prev_result"),i>0,i-1,g);e.setNextPrev($("#geo_next_result"),f<e.searchResultPlaces.length,i+1,g)}if(e.shouldAllowPlaceCreation(g)){j.append(Mustache.to_html("<div class='geo_add_place'>{{#found}}{{_i}}Not what you're looking for?{{/i}}&#32;{{/found}}<a href='#'>{{_i}}Add this place!{{/i}}</a></div>",{found:a.length>0}));$(".geo_add_place a").click(function(k){k.preventDefault();e.dialog.close();new twttr.geo.PlaceCreationDialog(e.city,h,e.searchParams,function(l){e.placeAccepted(l,false)},e.opts.queryParams.accuracyring!==undefined);e.scribeSearch("place_search_dialog_add",g,{place_ids:c})})}e.scribeSearch("place_search_dialog_show_results",g,{place_ids:c,triggered_by:e.searchTrigger})}).method("setNextPrev",function(a,d,c,b){var e=this;a.click(function(f){f.preventDefault();if(d){e.displayResults(c,b)}});if(!d){a.addClass("link-disabled")}}).method("placeAccepted",function(a,b){var c=this;if(b){if(!a.id){c.dialog.close()}else{if(c.city.id!=a.id){c.city=a;if(c.placeString!=c.originalPlaceString){c.placeString=""}c.setSearchParamsFromCity()}}c.setCityMode(false)}else{c.dialog.close();if(c.originalCity!=c.city){c.placer.selectPlace(c.city)}c.placer.selectPlace(a);c.onPlaceAccepted()}}).method("setSearchParamsFromCity",function(){var a=this;if(a.city&&a.city.id){delete a.searchParams.lat;delete a.searchParams.lon;delete a.searchParams.accuracy;a.searchParams.contained_within=a.city.id}}).method("displaySearchError",function(b,a){$("#place_search_results").text(_("Sorry, search is temporarily unavailable, please try again later."));this.scribeSearch("place_search_dialog_error",a)});twttr.klass("twttr.geo.PlaceCreationDialog",function(c,f,d,e,b){var g=this;g.container=c;if(d.contained_within!==undefined){var a=twttr.geo.getLocationFromPlace(c);if(a){g.lat=a.latitude;g.lon=a.longitude;g.accuracy=a.accuracy}}else{g.lat=d.lat;g.lon=d.lon;g.accuracy=d.accuracy}g.originalGeoParams=d;g.placeName=f;g.onPlaceCreated=e;g.showAccuracyRing=b;g.draggedPin=false;g.streetAddress="";g.createHtml='<div class="geo_map"><div class="geo_map_canvas"></div><div class="geo_map_hint"><span></span><div class="round">{{_i}}Click and move the pin to edit this location.{{/i}}</div></div></div><div class="geo_place_create"><table cellspacing="0" cellpadding="0"><tr><td class="geo_place_creation_row1 geo_place_search_col1">{{_i}}Name{{/i}}</td><td class="geo_place_creation_row1"><input id="geo_place_name" class="geo_form_input round help-focusable" type="text"title="{{_i}}Type the name of a place{{/i}}"/></td></tr><tr><td class="geo_place_search_col1 geo_place_creation_row2">{{_i}}Address{{/i}}</td><td class="geo_place_creation_row2"><input id="geo_place_address" class="geo_form_input round help-focusable" type="text"title="{{_i}}Optional{{/i}}"/></td></tr><tr><td></td><td><div class="geo_place_creation_hint">{{_i}}"795 Folsom St" or "19th and Urban"{{/i}}</div><div class="geo_place_city">{{_i}}In {{city_name}}{{/i}}</div><div><button type="button" class="btn" id="geo_create_place">{{_i}}Add this Place{{/i}}</button><span id="geo_creating_place">&nbsp;</span></div><div class="error" id="geo_creation_error"></div></td></tr></table></div>';g.similarHtml='<div class="geo_map"><div class="geo_map_canvas" /><div class="geo_map_place_bubble"><span/><div class="round"><div class="geo_place_title" /><div class="geo_place_details" /></div></div></div><div class="geo_place_create"><div>{{_i}}This place may already exist. Did you mean:{{/i}}</div><ul/><div><button type="button" class="btn" id="geo_create_place">{{_i}}No, Just Add this Place{{/i}}</button><a href="#" class="geo_go_back">{{_i}}Go Back{{/i}}</a><span id="geo_creating_place">&nbsp;</span></div><div class="error" id="geo_creation_error"></div></div>';$(".place_creation_dialog").remove();g.dialog=new twttr.dialog({content:$("<div/>").appendTo("body"),heading:$(Mustache.to_html("<div>{{_i}}Add this place.{{/i}}</div>")),footer:null,cssClass:"place_creation_dialog",closeButton:true,renderInline:true,modal:true,fixed:false});g.showCreatePlace()}).method("showCreatePlace",function(){var b=this;$(".place_creation_dialog .modal-content").html(Mustache.to_html(b.createHtml,{city_name:b.container.full_name}));b.inProgress=false;$("#geo_place_name").val(b.placeName).helpText().change(function(c){b.updateState()}).keydown(function(c){setTimeout(function(){b.updateState()},0)});$("#geo_create_place").click(function(){b.placeName=$("#geo_place_name").helpVal();b.streetAddress=$("#geo_place_address").helpVal();b.callSimilarPlaces()});b.dialog.open();b.updateMapHeight();b.geoMap=new twttr.geo.Map($(".geo_map_canvas").get(0));b.geoMap.addPoi([b.lon,b.lat],function(c,d){b.lat=c;b.lon=d;b.draggedPin=true});b.geoMap.addAccuracyRing([b.lon,b.lat],b.accuracy,b.showAccuracyRing);b.geoMap.adjustBounds(15);b.updateState();$("#geo_place_address").val(b.streetAddress).helpText().focus();var a=true;setTimeout(function(){if(a){$(".geo_map_hint").fadeTo(700,0.8)}},700);$(".geo_map").mousedown(function(c){a=false;$(".geo_map_hint").fadeOut(200)})}).method("showSimilarPlaces",function(){var b=this;$(".place_creation_dialog .modal-content").html(Mustache.to_html(b.similarHtml));b.inProgress=false;$("#geo_create_place").click(function(){b.callCreatePlace()});$("a.geo_go_back").click(function(d){d.preventDefault();b.showCreatePlace()});var c=$(".geo_place_create ul");b.similarPlaces.forEach(function(d){$placeItem=twttr.geo.renderPlace(twttr.geo.templates.searchResultItem,d);$placeItem.find("a").click(function(f){f.preventDefault();b.dialog.close();b.onPlaceCreated(d)}).attr("title",twttr.geo.getPlaceDetails(d));c.append($placeItem)});b.updateMapHeight();b.geoMap=new twttr.geo.Map($(".geo_map_canvas").get(0));b.geoMap.addPoi([b.lon,b.lat]);$geoMapPlaceBubble=$(".geo_map_place_bubble");var a=$(".geo_map_canvas").position();b.similarPlaces.slice().reverse().forEach(function(e){var d=e.bounding_box.coordinates[0][0];var f=b.geoMap.addFocusablePoint(d,function(h,g){if(h){$geoMapPlaceBubble.find(".geo_place_title").text(e.name);$geoMapPlaceBubble.find(".geo_place_details").text(twttr.geo.getPlaceDetails((e)));$geoMapPlaceBubble.show().css({left:a.left+g.x-$geoMapPlaceBubble.width()/2,top:a.top+g.y,opacity:0.8})}else{$geoMapPlaceBubble.hide()}});$("#result_place_"+e.id).hover(function(){f(true)},function(){f(false)})});b.geoMap.adjustBounds(15);b.updateState()}).method("getPlaceCreationParams",function(){var b=this;var a={lat:b.lat,lon:b.lon,name:b.placeName,contained_within:b.container.id,accuracy:b.draggedPin?0:b.originalGeoParams.accuracy};if(b.token){a.token=b.token}if(b.streetAddress){a["attribute:street_address"]=b.streetAddress}return a}).method("callSimilarPlaces",function(){var a=this;if(!a.inProgress){a.inProgress=true;a.updateState();twttr.api.similarPlaces({data:a.getPlaceCreationParams(),success:function(b){a.token=b.result.token;a.inProgress=false;a.similarPlaces=b.result.places.slice(0,twttr.geo.MAX_SIMILAR_PLACES);if(a.similarPlaces.length>0&&twttr.geo.options&&twttr.geo.options.show_similar_places){a.showSimilarPlaces()}else{a.callCreatePlace()}},error:function(){a.onCreationError();a.scribeCreatePlace("similar_places_error")}})}}).method("callCreatePlace",function(){var a=this;if(!a.inProgress){a.inProgress=true;a.updateState();twttr.api.createPlace({data:a.getPlaceCreationParams(),success:function(b){a.inProgress=false;a.updateState();a.dialog.close();a.onPlaceCreated(b);a.scribeCreatePlace("success")},error:function(){a.onCreationError();a.scribeCreatePlace("create_place_error")}})}}).method("scribeCreatePlace",function(a){var b=this;twttr.geo.geoScribe("create_place",$.extend({status:a,original_lat:b.originalGeoParams.lat,original_lon:b.originalGeoParams.lon,original_accuracy:b.originalGeoParams.accuracy,dragged_pin:b.draggedPin},b.getPlaceCreationParams()))}).method("onCreationError",function(){this.inProgress=false;$("#geo_creation_error").text(_("We couldn't add this place.  Please try again."));this.updateState();this.updateMapHeight();this.geoMap.resize()}).method("updateState",function(){$("#geo_creating_place").toggleClass("geo_spinner",this.inProgress)}).method("updateMapHeight",function(){var d=$(".geo_map_canvas");var a=Math.max(210,$(".geo_place_create").outerHeight());d.height(a);var b=$(".geo_map_hint");var c=d.position();b.css({left:c.left+(d.width()-b.width())/2-1,top:c.top+a/2})});twttr.klass("twttr.geo.Locator",function(b){var a=this;a.position=null;a.locator=null;a.locatorType="none";if(b&&b.lat!==undefined&&b.lon!==undefined){a.locatorType="manual";a.locator={watchPosition:function(c){c({coords:{latitude:b.lat,longitude:b.lon,accuracy:parseInt(b.accuracy)||200}});return 0},clearWatch:function(){}}}else{if(navigator&&navigator.geolocation){a.locatorType="html5";a.locator=navigator.geolocation;if(navigator.userAgent.indexOf("Firefox")!=-1){a.browserGeoPermissionsHelpBannerTemplate=a.templates.firefoxGeoPermissionsHelpBanner}else{if(navigator.userAgent.indexOf("Chrome")!=-1){a.browserGeoPermissionsHelpBannerTemplate=a.templates.chromeGeoPermissionsHelpBanner}else{if(navigator.userAgent.indexOf("MSIE")!=-1&&navigator.userAgent.indexOf("GTB")!=-1){a.browserGeoPermissionsHelpBannerTemplate=a.templates.ieGoogleToolbarGeoPermissionsHelpBanner}}}}else{if(typeof google!="undefined"&&typeof google.gears!="undefined"){a.locatorType="gears";a.locator=google.gears.factory.create("beta.geolocation")}}}}).augmentProto({templates:{firefoxGeoPermissionsHelpBanner:'<div id="geo_browser_help_banner" class="geo_firefox"><div>{{_i}}Before Twitter can get your location...{{/i}}</div><div><img src="http://abs.twimg.com/a/1362168403/images/geo_browser_help_banner_1.png" />{{_i}}Check "Remember for this site"{{/i}}</div><div><img src="http://abs.twimg.com/a/1362168403/images/geo_browser_help_banner_2.png" />{{_i}}Click "Share Location"{{/i}}</div></div>',chromeGeoPermissionsHelpBanner:'<div id="geo_browser_help_banner" class="geo_chrome"><div>{{_i}}Click "Allow" to let Twitter get your location.{{/i}}</div></div>',ieGoogleToolbarGeoPermissionsHelpBanner:'<div id="geo_browser_help_banner" class="geo_ie_gtb"><div>{{_i}}Before Twitter can get your location...{{/i}}</div><div><img src="http://abs.twimg.com/a/1362168403/images/geo_browser_help_banner_1.png" />{{_i}}Check "Remember for this site"{{/i}}</div><div><img src="http://abs.twimg.com/a/1362168403/images/geo_browser_help_banner_2.png" />{{_i}}Click "Share my location"{{/i}}</div></div>'}}).method("isLocatable",function(){return !!(this.locator)}).method("getLocation",function(a){var c=this;if(!c.isLocatable()){throw new twttr.geo.Exceptions.GeoSupportException()}var b=$.extend({onSuccess:function(d){},onFailure:function(d){},options:{timeout:twttr.geo.LOCATION_TIMEOUT,enableHighAcuracy:true,maximumAge:twttr.geo.LOCATION_MAXIMUM_AGE}},a);if(!c.getBrowserGeoPermissionsHelpBannerSeen()){c.detectBrowserGeoPermissionsBanner()}c.position=null;c.waitForAcceptableId=setTimeout(function(){c.waitForAcceptableId=null;if(c.watchId!=null){c.watchPositionAcceptable(b.onSuccess)}},twttr.geo.ACCEPTABLE_LOCATION_TIMEOUT);c.watchId=null;c.watchId=c.locator.watchPosition(function(d){setTimeout(function(){if(c.watchId!=null){c.watchPositionSuccess(d,b.onSuccess)}},0)},function(d){setTimeout(function(){if(c.watchId!=null){c.watchPositionError(d,b.onFailure)}},0)},b.options)}).method("watchPositionSuccess",function(a,c){var b=this;b.setBrowserGeoPermissionsHelpBannerSeen();b.position={latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy};if(b.waitForAcceptableId==null||(b.position.accuracy!=undefined&&b.position.accuracy<twttr.geo.ACCEPTABLE_LOCATION_ACCURACY)){b.watchPositionAcceptable(c)}}).method("watchPositionError",function(b,c){var d=this;d.setBrowserGeoPermissionsHelpBannerSeen();var a;if(b.code==b.PERMISSION_DENIED){a=new twttr.geo.Errors.PermissionDeniedError()}else{a=new twttr.geo.Errors.LocationDetectionError()}if(a.fatal){var e=new ShortNotification();e.setMessage(a.msg);e.show()}d.watchPositionCleanup();c(a)}).method("watchPositionAcceptable",function(b){var a=this;if(a.position){a.watchPositionCleanup();b(a.position)}}).method("watchPositionCleanup",function(){var a=this;clearTimeout(a.waitForAcceptableId);a.locator.clearWatch(a.watchId);a.watchId=null}).method("getWindowHeight",function(){return $(window).height()}).method("getBrowserGeoPermissionsHelpBannerSeen",function(){return $.cookie("geo_browser_help_banner")}).method("setBrowserGeoPermissionsHelpBannerSeen",function(){var a=this;if(a.showBrowserGeoPermissionsHelpBanner){a.clearDetectBrowserGeoPermissionsBanner();if(!a.getBrowserGeoPermissionsHelpBannerSeen()){$.cookie("geo_browser_help_banner","1",{expires:3650})}}}).method("showBrowserGeoPermissionsHelpBanner",function(){$("body").append(Mustache.to_html(this.browserGeoPermissionsHelpBannerTemplate))}).method("detectBrowserGeoPermissionsBanner",function(){var b=this;if(b.browserGeoPermissionsHelpBannerTemplate){var a=b.getWindowHeight();this.browserGeoPermissionsHelpTimer=setTimeout(function(){if(b.getWindowHeight()<a){b.showBrowserGeoPermissionsHelpBanner();b.browserGeoPermissionsHelpInterval=setInterval(function(){if(b.getWindowHeight()==a){b.clearDetectBrowserGeoPermissionsBanner()}},twttr.geo.BROWSER_GEO_BANNER_DISAPPEAR_INTERVAL)}},twttr.geo.BROWSER_GEO_BANNER_APPEAR_DELAY)}}).method("clearDetectBrowserGeoPermissionsBanner",function(){clearTimeout(this.browserGeoPermissionsHelpTimer);clearInterval(this.browserGeoPermissionsHelpInterval);$("#geo_browser_help_banner").remove()});twttr.klass("twttr.geo.Placer",function(a){var c=this;c.opts=a;c.places=[];c.detectedParams={};var b=c.opts.geoParams;if(b.lat!==undefined&&b.lon!==undefined){c.detectedParams.lat=parseFloat(b.lat).toFixed(4);c.detectedParams.lon=parseFloat(b.lon).toFixed(4)}if(b.ip!==undefined){c.detectedParams.ip=b.ip}}).augmentProto({PLACE_OVERRIDES_COOKIE:"place_overrides",RECENT_PLACE_COOKIE:"recent_place",MAX_PLACE_OVERRIDES:8,STICKY_RADIUS_IN_KM:0.1}).method("search",function(f,c,b){var a=this;try{twttr.api.search({data:a.opts.geoParams,success:function(e){a.places=e.result.places;a.determinePlaces(f,c)},error:function(e){if(e.status==503){b()}else{c()}}})}catch(d){c()}}).method("determinePlaces",function(c,b){var a=this;if(a.places.every(function(d){if(d.place_type!="poi"){a.detectedPlace=d;return false}return true})){b();return}if(a.getOverrides().every(function(d){if(a.isOverrideCloseToDetected(d)){a.selectPlaceById(d.id,c,b);return false}return true})){a.selectPlace(a.detectedPlace);c()}}).method("selectPlaceById",function(f,d,b){var a=this;if(a.places.every(function(e){if(e.id==f){a.selectPlace(e);d();return false}return true})){try{twttr.api.getPlaceDetails({place_id:f,success:function(e){a.selectPlace(e);d()},error:function(){b()}})}catch(c){b()}}}).method("setOverrides",function(a){if(a!=this.getOverrides()){if(a.length>0){$.cookie(this.PLACE_OVERRIDES_COOKIE,a.map(function(b){return $.param(b)}).join(","),{expires:3650})}else{$.cookie(this.PLACE_OVERRIDES_COOKIE,null)}}}).method("getOverrides",function(){return($.cookie(this.PLACE_OVERRIDES_COOKIE)||"").split(",").filter(function(a){return a!=""}).map(function(a){return twttr.unparam(a)})}).method("selectPlace",function(a){var b=this;if(b.places.every(function(c){if(a.id==c.id){b.selectedPlace=c;return false}return true})){b.places.unshift(a);b.selectedPlace=a}if(b.selectedPlace.place_type!="poi"){b.setOverride();b.setRecentPlaceId(b.selectedPlace.id)}}).method("setOverride",function(){var a=this;var b=a.getOverrides().filter(function(c){return !a.isOverrideCloseToDetected(c)});if(a.detectedPlace&&a.selectedPlace.id!=a.detectedPlace.id){b.unshift(twttr.merge({id:a.selectedPlace.id},a.detectedParams))}a.setOverrides(b.slice(0,a.MAX_PLACE_OVERRIDES))}).method("getRecentPlaceId",function(){return $.cookie(this.RECENT_PLACE_COOKIE)}).method("setRecentPlaceId",function(a){$.cookie(this.RECENT_PLACE_COOKIE,a,{expires:3650})}).method("isOverrideCloseToDetected",function(a){var b=this.detectedParams;if(!b){return false}if(a.lat!==undefined&&a.lon!==undefined&&b.lat!==undefined&&b.lon!==undefined&&twttr.geo.greatCircleDistanceInKm(a.lat,a.lon,b.lat,b.lon)<this.STICKY_RADIUS_IN_KM){return true}return b.ip&&b.ip==a.ip}).method("getState",function(){var a=this;var b={geo_params:a.opts.geoParams,place_ids:[]};var c=[];a.places.forEach(function(d,e){b.place_ids.push(d.id);if(a.selectedPlace&&a.selectedPlace.id==d.id){b.selected_place_index=e}});if(a.selectedPlace){b.selected_place_id=a.selectedPlace.id}if(a.detectedPlace){b.detected_place_id=a.detectedPlace.id}return b});twttr.klass("twttr.geo.NearbyPlacer",function(a){var b=this;b.opts=a;b.places=[]}).method("search",function(d,b){var a=this;try{twttr.api.search({data:twttr.merge({require_activity:true},a.opts.geoParams),success:function(e){a.places=e.result.places;a.determinePlaces(d,b)},error:function(e){b()}})}catch(c){b()}}).method("determinePlaces",function(c,b){var a=this;if(!a.detectedPlace){a.places.every(function(d){if(d.place_type!="poi"){a.detectedPlace=d;return false}return true})}if(!a.selectedPlace){a.selectPlace(a.detectedPlace)}if(a.selectedPlace){a.places.every(function(d,e){if(d.id==a.selectedPlace.id){a.places.splice(e,1);return false}return true});a.fudgePlaceRanking(a.places);c()}else{b()}}).method("fudgePlaceRanking",function(c){var a=c.length;var b=0;for(var d=0;d<a;d++){if(c[d].place_type!="poi"){c.splice(b,0,c.splice(d,1)[0]);b+=1;if(b==2){break}}}}).method("selectPlace",function(b){var c=this;c.selectedPlace=b;if(b!=c.detectedPlace){var a=twttr.geo.getLocationFromPlace(b);c.opts.geoParams.lat=a.latitude;c.opts.geoParams.lon=a.longitude;c.opts.geoParams.accuracy=a.accuracy;delete c.opts.geoParams.contained_by;delete c.opts.geoParams.ip}});twttr.klass("twttr.geo.NearbyActivity",function(a){var b=this;b.$nearbyActivity=$("#side_geo_nearby_activity .sidebar-menu");b.placer=new twttr.geo.NearbyPlacer({geoParams:{granularity:"poi",max_results:30}});if(a){twttr.merge(b.placer.opts.geoParams,a.opts.geoParams,{granularity:"poi",max_results:30});b.placer.detectedPlace=a.detectedPlace;b.placer.selectPlace(a.selectedPlace);b.search()}else{if(twttr.geo.IP){b.placer.opts.geoParams.ip=twttr.geo.IP;b.search()}else{b.showError()}}}).augmentProto({templates:{choose:'<p class="geo_nearby_activity"><small>{{_i}}Find interesting places nearby and see what people are saying there! To get started, tell us where you\'d like to explore:{{/i}}</small></p><p class="geo_nearby_activity"><a href="#" class="geo_nearby_activity_change">{{_i}}Search places...{{/i}}</a></p>',finding:'<p class="geo_nearby_activity geo_find_in_progress"><small>{{_i}}Finding places nearby...{{/i}}</small></p>',places:'<div class="geo_nearby_activity"><small><span class="geo_nearby_activity_header"></span>&#32;<a href="#" class="geo_nearby_activity_change geo_minorlink">{{_i}}Change{{/i}}</a></small><ul/></div>',error:'<p class="geo_nearby_activity"><small>{{_i}}Location service is currently unavailable.{{/i}}&#32;<a href="#" class="geo_nearby_activity_retry">{{_i}}Try again{{/i}}</a></small></p>',nextPrev:'<p class="geo_nearby_activity"><a href="#" class="geo_prev">{{_i}}Prev{{/i}}</a><span class="geo_prev_next_separator">&nbsp;|&nbsp;</span><a href="#" class="geo_next">{{_i}}Next{{/i}}</a></p>',noPlaces:'<p class="geo_nearby_activity"><small>{{_i}}No active places nearby.{{/i}}</small></p>'}}).method("show",function(b,a){var c=this;c.$nearbyActivity.html(Mustache.to_html(b));c.$nearbyActivity.find(".geo_nearby_activity_change").click(function(d){d.preventDefault();new twttr.geo.PlaceSearchDialog(c.placer,{},function(){c.search()})});c.$nearbyActivity.find(".geo_nearby_activity_retry").click(function(d){d.preventDefault();c.search()});$("#na_menu span").hide().filter(a?".with-place":".without-place").show()}).method("search",function(){var a=this;a.show(a.templates.finding);a.placer.search(function(){a.showPlaces(0)},function(){a.showError()})}).method("showError",function(){var a=this;a.show(a.placer.selectedPlace?a.templates.error:a.templates.choose)}).method("showPlaces",function(c){var f=this;f.show(f.templates.places,true);f.$nearbyActivity.find(".geo_nearby_activity_header").append(f.renderPlace(twttr.geo.templates.nearbyActivityHeader,f.placer.selectedPlace));var e=f.placer.places.length;if(e==0){f.$nearbyActivity.append(Mustache.to_html(f.templates.noPlaces));return}var b=c*twttr.geo.PLACE_SEARCH_RESULTS_PER_PAGE;var a=b+twttr.geo.PLACE_SEARCH_RESULTS_PER_PAGE;var d=f.placer.places.slice(b,a);d.forEach(function(g){f.$nearbyActivity.find("ul").append(f.renderPlace(twttr.geo.templates.nearbyActivityItem,g))});if(e>twttr.geo.PLACE_SEARCH_RESULTS_PER_PAGE){f.$nearbyActivity.append(Mustache.to_html(f.templates.nextPrev));f.setNextPrev(f.$nearbyActivity.find(".geo_prev"),c>0,c-1);f.setNextPrev(f.$nearbyActivity.find(".geo_next"),a<e,c+1)}}).method("renderPlace",function(b,a){var c=this;var d=twttr.geo.renderPlace(b,a);d.find("a").attr(twttr.geo.getPlacePageLinkAttrsFromPlace(a)).isSearchLink().click(function(){c.placer.selectPlace(a);c.search()});return d}).method("setNextPrev",function(a,c,b){var d=this;a.click(function(f){f.preventDefault();if(c){d.showPlaces(b)}});if(!c){a.addClass("link-disabled")}});twttr.klass("twttr.geo.UpdateUi",function(b){var a=this;a.opts=twttr.merge({geo_enabled:false,has_dismissed_geo_promo:false,current_user_path:null,granularity:"neighborhood",queryParams:twttr.unparam(window.location.search.substr(1))},twttr.geo.options,b);if(a.opts.queryParams.ip){twttr.geo.IP=a.opts.queryParams.ip}a.locator=new twttr.geo.Locator(a.opts.queryParams);$(".geo_enable_webclient").live("click",function(c){c.preventDefault();a.enableGeoForWebClient()});$(".geo_disable_webclient").live("click",function(c){c.preventDefault();a.disableGeoForWebClient()});if(a.opts.geo_enabled){if($.cookie("geo_webclient")){a.detectLocation(false)}else{a.disableGeoForWebClient();a.initNearbyActivity()}}else{if(!$.cookie("geo_promo_hidden")&&!$("#latest_status.first-tweet").length){a.setGeoStatus('<span class="geo_new">'+_("New!")+"</span> "+_("Add a location to your tweets.")+' <a id="show_geo_dialog" href="#">'+_("Turn it on")+'</a> - <a id="hide_geo_promo" href="#">'+_("No thanks")+"</a>");$("#hide_geo_promo").click(function(c){c.preventDefault();if(!$(this).hasClass("link-disabled")){a.hidePromoDialog();$.cookie("geo_promo_hidden","1",{expires:3650});$("#geo_status").slideUp();twttr.geo.geoScribe("promo_bar_no_thanks")}});$("#show_geo_dialog").click(function(c){c.preventDefault();c.stopPropagation();if(!$(this).hasClass("link-disabled")){a.showPromoDialog();twttr.geo.geoScribe("promo_bar_dialog_open")}});if(!a.opts.has_dismissed_geo_promo){a.showPromoDialog();twttr.geo.geoScribe("promo_bar_dialog_pop")}twttr.geo.geoScribe("promo_bar_shown")}a.initNearbyActivity()}}).augmentProto({templates:{disable_geo:' <a href="#" class="geo_disable_webclient"><span>&nbsp;</span></a>'}}).method("initNearbyActivity",function(a){if(twttr.geo.options.nearby_activity&&!this.nearbyActivity){this.nearbyActivity=new twttr.geo.NearbyActivity(a)}}).method("setGeoStatus",function(a){$("#geo_status").html(a)}).method("scribeLocationDetection",function(a,b){twttr.geo.geoScribe("location_detection_complete",$.extend({status:a,locator_type:this.locator.locatorType},b))}).method("lookupPlacesAndShowDropdown",function(b,d){var c=this;var a=new twttr.geo.Placer({geoParams:b});a.search(function(){c.scribeLocationDetection("place_lookup_succeeded",a.getState());c.setGeoStatus('<span id="place_content"></span>'+c.templates.disable_geo);new twttr.geo.PlacesDropdown(a,c.opts);c.initNearbyActivity(a)},function(){c.cannotDetectLocation(d);c.scribeLocationDetection("place_lookup_failed",a.getState())},function(){c.setGeoStatus(_("Location service is currently unavailable.")+' <a href="#" class="geo_enable_webclient">'+_("Try again")+"</a>"+c.templates.disable_geo);c.initNearbyActivity()})}).method("detectLocationByIp",function(b){var a=this;if(twttr.geo.IP){$("#lat").val();$("#lon").val();a.lookupPlacesAndShowDropdown({ip:twttr.geo.IP,accuracy:16000,granularity:a.opts.granularity,max_results:twttr.geo.MAX_NEARBY_PLACES},b)}else{a.scribeLocationDetection("place_lookup_no_ip");a.cannotDetectLocation(b)}}).method("cannotDetectLocation",function(b){var a=this;if(a.opts.allow_set_location_manually){if(b){a.setLocationManually()}else{a.setGeoStatus(_("We couldn't find you!")+' <a href="#" class="geo_add_manual">'+_("Add Location")+"</a>"+a.templates.disable_geo);$(".geo_add_manual").click(function(c){c.preventDefault();a.setLocationManually()})}}else{a.setGeoStatus(_("Unable to associate your coordinates with a place.")+' <a href="#" class="geo_enable_webclient">'+_("Try again")+"</a>"+a.templates.disable_geo)}a.initNearbyActivity()}).method("setLocationManually",function(){var d=this;var c=new twttr.geo.Placer({geoParams:{granularity:d.opts.granularity}});var a=function(){d.setGeoStatusAddYourLocation();new twttr.geo.PlaceSearchDialog(c,d.opts,function(){d.setGeoStatus('<span id="place_content"></span>'+d.templates.disable_geo);new twttr.geo.PlacesDropdown(c,d.opts)});twttr.geo.geoScribe("set_location_manually")};var b=c.getRecentPlaceId();if(b){d.setGeoStatus('<span class="crosshairs">&nbsp;</span><span class="geo_progress">'+_("Getting recent location...")+"</span>"+d.templates.disable_geo);c.selectPlaceById(b,function(){a()},function(){a()})}else{a()}}).method("detectLocation",function(b){$("#lat").val("");$("#lon").val("");$("#place_id").val("");this.setGeoStatus('<span class="crosshairs">&nbsp;</span><span class="geo_progress">'+_("Getting your location...")+"</span>"+this.templates.disable_geo);var a=this;if(!a.locator.isLocatable()||a.opts.queryParams.nodetect!==undefined){a.detectLocationByIp(b)}else{a.locator.getLocation({onSuccess:function(c){$("#lat").val(c.latitude);$("#lon").val(c.longitude);a.lookupPlacesAndShowDropdown({lat:c.latitude,lon:c.longitude,accuracy:c.accuracy,granularity:a.opts.granularity,max_results:twttr.geo.MAX_NEARBY_PLACES},false)},onFailure:function(c){if(!c.fatal){a.detectLocationByIp(b)}else{a.disableGeoForWebClient();a.scribeLocationDetection("denied_by_user")}}})}}).method("showPromoDialog",function(){var b=this;var c=$("#show_geo_dialog");var a=$('<div class="hoverer" id="geo-promo-hoverer">         <div class="hoverer-inner">          <div class="tiny-map"><img src="http://abs.twimg.com/a/1362168403/images/tiny-map.gif"></div>          <h3>'+_("Add a location to your tweets")+'</h3>          <div id="geo_dialog_descr">'+_('Ever had something you wanted to share ("fireworks!", "party!", "ice cream truck!", or "quicksand...") that would be better with a location?')+" "+_("By turning on this feature, you can include location information like neighborhood, town, or exact point when you tweet.")+"<br><br>"+_("When you tweet with a location, Twitter stores that location.")+" "+_("You can switch location on/off before each tweet and always have the option to delete your location history.")+' <a id="geo_learn_more" href="http://support.twitter.com/forums/26810/entries/78525" target="_blank">'+_("Learn more")+'</a>          </div>          <div>            <button id="geo_turn_location_on" class="btn">'+_("Turn location on")+'</button>            <a href="#" id="geo_not_now" class="geo_dialog_close">'+_("Not now")+'</a>          </div>        </div>        <div class="hovercard-divot"></div>      </div>').insertAfter(c);twttr.SimplePositioner.setPosition(a,c,{direction:"below",offsets:{below:{top:10,left:-50}},hasContainer:true});$("#show_geo_dialog,#hide_geo_promo").addClass("link-disabled");$("#geo_turn_location_on").click(function(){b.turnLocationOn();twttr.geo.geoScribe("promo_dialog_turn_location_on")});$(".geo_dialog_close").click(function(d){d.preventDefault();b.hidePromoDialog();twttr.geo.geoScribe("promo_dialog_not_now")});$("#geo-promo-hoverer").click(function(d){d.stopPropagation()});$("html").one("click",function(){if($("#geo-promo-hoverer:visible").length>0){b.hidePromoDialog();twttr.geo.geoScribe("promo_dialog_click_outside")}});a.css("visibility","visible")}).method("hidePromoDialog",function(){if(!this.opts.has_dismissed_geo_promo){this.setUserFlag("has_dismissed_geo_promo");this.opts.has_dismissed_geo_promo=true}$("#geo-promo-hoverer").remove();$("#show_geo_dialog,#hide_geo_promo").removeClass("link-disabled")}).method("turnLocationOn",function(){this.setUserFlag("geo_enabled");this.opts.geo_enabled=true;this.hidePromoDialog();this.enableGeoForWebClient()}).method("setUserFlag",function(a){data={authenticity_token:twttr.form_authenticity_token,_method:"put"};data["user["+a+"]"]="1";$.ajax({type:"POST",url:this.opts.current_user_path,data:data})}).method("enableGeoForWebClient",function(){if(!$.cookie("geo_webclient")){$.cookie("geo_webclient","1",{expires:3650})}this.detectLocation(true)}).method("setGeoStatusAddYourLocation",function(){this.setGeoStatus('<span class="crosshairs">&nbsp;</span><a href="#" class="geo_enable_webclient">'+_("Add your location")+"</a>")}).method("disableGeoForWebClient",function(){$("#lat").val("");$("#lon").val("");$("#place_id").val("");if($.cookie("geo_webclient")){$.cookie("geo_webclient",null)}this.setGeoStatusAddYourLocation()});