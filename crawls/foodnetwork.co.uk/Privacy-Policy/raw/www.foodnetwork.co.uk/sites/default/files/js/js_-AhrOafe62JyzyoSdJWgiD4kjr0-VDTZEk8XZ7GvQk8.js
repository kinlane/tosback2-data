(function($){Drupal.behaviors.field_ooyala_player={attach:function(context,settings){jQuery(".field-type-ooyala").addClass("field_ooyala_image").click(function(){var player=jQuery(this).find(".field_ooyala_player");var embedcode=player.find(".embedcode").text();var playerId=player.find(".playerid").text();var playerContainerId=player.find(".playerContainerId").text();var ooyala_pcode=player.find(".ooyala_pcode").text();var width=parseInt(player.find(".width").text());var height=parseInt(player.find(".height").text());if(embedcode&&playerContainerId){jQuery.getScript('http://player.ooyala.com/v3/98a84f8c68654a34ab5d2376241bccef',function(){var myPlayer=OO.Player.create(playerContainerId,embedcode,{width:width,height:height,autoplay:true});player.parents(".field-type-ooyala").addClass('field_ooyala_loading').removeClass('field_ooyala_image');});}});}};})(jQuery);function receiveOoyalaEvent(playerId,eventName,p){var parentContainer=jQuery('#'+ playerId).parents(".field-type-ooyala");var debugContainer=parentContainer.find(".field_ooyala_debug");var debugString='['+ eventName+'] ';switch(eventName){case'embedCodeChanged':{break;}
case'playheadTimeChanged':{debugString='';break;}
case'stateChanged':debugString+='('+ p.state+') ';switch(p.state){case'error':{debugString+=p.errorCode+':'+ p.errorText;parentContainer.addClass('field_ooyala_'+ p.errorCode).removeClass('field_ooyala_loading');}}
break;case'apiReady':{parentContainer.addClass('field_ooyala_loaded').removeClass('field_ooyala_loading');break;}}
if(debugString)debugContainer.html(debugContainer.html()+'<li>'+ debugString+"</li>\n");return;};(function($){function FN_Gallery(_jFN_Gallery,_view_name){var self=this;this.AJAX_LOAD_AHEAD_PAGES=2;this.BUTTON_APPEAR_SPEED=400;this.jFN_Gallery=_jFN_Gallery;this.name=this.jFN_Gallery.find(".fn-gallery-view-details .name").html();this.vid=this.jFN_Gallery.find(".fn-gallery-view-details .vid").html();this.args=this.jFN_Gallery.find(".fn-gallery-view-details .args").html();this.args_ids=this.jFN_Gallery.find(".fn-gallery-view-details .args_ids").html();this.jCarouselMain=this.jFN_Gallery.find(".jcarousel-skin-default:first .jcarousel-container-horizontal");this.jCarouselNavi=this.jFN_Gallery.find(".attachment-after .jcarousel-skin-default .jcarousel-container-horizontal");this.selected_index=null;this.carousel_button_hide_timer=null;this.jContextMenu=this.jFN_Gallery.find(".contextual-links-wrapper");this.jDrag=null;this.carousel_main=this.jCarouselMain.find(".jcarousel").data('jcarousel');this.carousel_navi=this.jCarouselNavi.find(".jcarousel").data('jcarousel');if(this.carousel_main&&this.carousel_navi){if(this.jCarouselNavi.sortable)this.jCarouselNavi.find(".jcarousel").sortable({axis:'x',start:function(e){self.jDrag=jQuery(this);},stop:function(e){self.navi_sort(e);self.jDrag=null;}});this.jPageCounter=jQuery('<div class="jcarousel-page-counter"></div>');this.jCarouselMain.find(".jcarousel-next-horizontal").after(this.jPageCounter);this.jCarouselMain.mouseenter(function(e){self.main_mouseenter(jQuery(this),e);});this.jCarouselMain.mouseleave(function(e){self.main_mouseleave(jQuery(this),e);});this.jCarouselMain.find(".jcarousel-next-horizontal").click(function(e){if($(this).attr("disabled")!='true')self.main_buttonCallback(jQuery(this),e);});this.jCarouselMain.find(".jcarousel-prev-horizontal").click(function(e){if($(this).attr("disabled")!='true')self.main_buttonCallback(jQuery(this),e);});this.jCarouselNavi.find(".jcarousel-item").live("click",function(e){self.navi_click(jQuery(this),e);});this.jCarouselNavi.find(".jcarousel-next-horizontal").mouseenter(function(e){self.navi_next_mouseenter(jQuery(this),e);});this.jCarouselNavi.find(".jcarousel-prev-horizontal").mouseenter(function(e){self.navi_prev_mouseenter(jQuery(this),e);});this.jCarouselNavi.find(".jcarousel-item").live("mouseenter",function(e){self.navi_mouseenter(jQuery(this),e);}).live("mouseleave",function(e){self.navi_mouseleave(jQuery(this),e);});this.jContextMenu.find("a").live("click",function(e){self.contextMenu_click(jQuery(this).parent("li"),e);});this.carousel_main.options.itemFirstOutCallback=function(e){self.item_first_out(self.carousel_main,e);};this.carousel_navi.options.itemFirstOutCallback=function(e){self.item_first_out(self.carousel_navi,e);};this.select(this.carousel_main.first?this.carousel_main.first:1);if(!FN_Gallery.persistent_interface_mode)self.button_hide();}}
window.FN_Gallery=FN_Gallery;Drupal.behaviors.fn_gallery={attach:function(context,settings){setTimeout(function(){FN_Gallery.attach();},0);}};FN_Gallery.persistent_interface_mode=false;FN_Gallery.carousels=new Object;FN_Gallery.get_view_id=function get_view_id(jView){return jView.attr("class").replace(/.*view-id-([^ ]+).*/,'$1')}
FN_Gallery.attach=function attach(){jQuery(".fn-gallery:not(.fn-gallery-processed)").once("fn-gallery",function(){var view_name=FN_Gallery.get_view_id(jQuery(this));FN_Gallery.carousels[view_name]=new FN_Gallery(jQuery(this),view_name);});jQuery(".jcarousel-item:not(.jcarousel-item-processed)").once("jcarousel-item",function(){var view_name=FN_Gallery.get_view_id(jQuery(this).parents(".fn-gallery"));var fnGallery=FN_Gallery.carousels[view_name];if(view_name&&fnGallery)fnGallery.jcarousel_item_behavior(jQuery(this));});}
FN_Gallery.prototype.toString=function toString(){return'FN_Gallery:'+ this.vid+':'+ this.name+':'+ this.args;}
FN_Gallery.prototype.jcarousel_item_behavior=function jcarousel_item_behavior(jCarouselItem){if(this.item_is_in_nav(jCarouselItem))this.post_navi_jcarousel_item_load(jCarouselItem);else this.post_main_jcarousel_item_load(jCarouselItem);}
FN_Gallery.prototype.navi_click=function navi_click(jCarouselItem,e){var index=this.item_to_index(jCarouselItem);this.select(index);e.stopPropagation();}
FN_Gallery.prototype.main_buttonCallback=function main_buttonCallback(jButtonNext,e){var self=this;setTimeout(function(){self.select(self.carousel_main.first);},0);}
FN_Gallery.prototype.navi_mouseenter=function navi_mouseenter(jCarouselItem,e){if(!jCarouselItem.hasClass("selected"))jCarouselItem.find("img").animate({opacity:1.0},"slow");e.stopPropagation();}
FN_Gallery.prototype.navi_mouseleave=function navi_mouseleave(jCarouselItem,e){if(!jCarouselItem.hasClass("selected"))jCarouselItem.find("img").animate({opacity:0.6},"slow");e.stopPropagation();}
FN_Gallery.prototype.main_mouseleave=function main_mouseleave(jMain,e){var self=this;if(this.carousel_button_hide_timer)clearTimeout(this.carousel_button_hide_timer);if(!FN_Gallery.persistent_interface_mode)this.carousel_button_hide_timer=setTimeout(function(){self.button_hide()},1000);e.stopPropagation();}
FN_Gallery.prototype.button_hide=function button_hide(){this.jCarouselMain.find(".jcarousel-next-horizontal").animate({width:'0px'},'slow');this.jCarouselMain.find(".jcarousel-prev-horizontal").animate({width:'0px'},'slow');this.jPageCounter.slideUp("slow");this.carousel_button_hide_timer=null;}
FN_Gallery.prototype.main_mouseenter=function main_mouseenter(jMain,e){if(!FN_Gallery.persistent_interface_mode){this.jCarouselMain.find(".jcarousel-next-horizontal").animate({width:'50px'},this.BUTTON_APPEAR_SPEED);this.jCarouselMain.find(".jcarousel-prev-horizontal").animate({width:'50px'},this.BUTTON_APPEAR_SPEED);if(this.carousel_button_hide_timer){clearTimeout(this.carousel_button_hide_timer);this.carousel_button_hide_timer=null;}}
this.jPageCounter.slideDown("slow");e.stopPropagation();}
FN_Gallery.prototype.select=function select(index){if(this.selected_index){var jCarouselMainPrevItemSelected=this.index_to_item(this.jCarouselMain,this.selected_index);if(jCarouselMainPrevItemSelected.find("object").length){this.destroy_slide(this.carousel_main,jCarouselMainPrevItemSelected);}}
this.selected_index=index;this.main_show(this.selected_index);this.navi_show(this.selected_index);this.main_highlight(this.selected_item_in_main());this.navi_highlight(this.selected_item_in_navi());}
FN_Gallery.prototype.main_show=function main_show(index){this.carousel_main.scroll(index,true);}
FN_Gallery.prototype.navi_show=function navi_show(index){var scrollTo=index- 2<1?1:index- 2;this.carousel_navi.scroll(scrollTo,true);}
FN_Gallery.prototype.post_main_jcarousel_item_load=function post_main_jcarousel_item_load(jCarouselItem){if(this.item_to_index(jCarouselItem)==this.selected_index)this.main_highlight(jCarouselItem);}
FN_Gallery.prototype.post_navi_jcarousel_item_load=function post_navi_jcarousel_item_load(jCarouselItem){if(this.item_to_index(jCarouselItem)==this.selected_index)this.navi_highlight(jCarouselItem);}
FN_Gallery.prototype.item_first_out=function item_first_out(carousel,e){carousel.last+=carousel.pageSize*this.AJAX_LOAD_AHEAD_PAGES;Drupal.jcarousel.ajaxLoadCallback(carousel);if(this.jDrag)this.jCarouselNavi.find(".jcarousel").sortable("refreshPositions");if(window.refreshBanners&&carousel==this.carousel_main){if(this.selected_index>1)
window.refreshBanners(carousel.last);}
if(window.omPGClickEvent&&carousel==this.carousel_main){var t=this.item_to_nodeid(this.index_to_item(this.jCarouselNavi,this.selected_index));omPGClickEvent(t);}}
FN_Gallery.prototype.main_highlight=function main_highlight(jCarouselItem,e){this.jCarouselMain.find(".jcarousel-item.selected").removeClass("selected");jCarouselItem.addClass("selected");if(jCarouselItem.hasClass('fn-gallery-video'))this.jFN_Gallery.addClass('fn-gallery-video');else this.jFN_Gallery.removeClass('fn-gallery-video');}
FN_Gallery.prototype.navi_highlight=function navi_highlight(jCarouselItem,e){this.jCarouselNavi.find(".jcarousel-item.selected").removeClass("selected").find("img").css('opacity','');jCarouselItem.addClass("selected");jCarouselItem.find("img").css('opacity','');this.jPageCounter.html(this.item_to_index(jCarouselItem)+" / "+ this.carousel_main.size());}
FN_Gallery.prototype.contextMenu_click=function contextMenu_click(jCommandLI,e){var self=this;if(jCommandLI.attr("class").match(/ajax/)){var jA=jCommandLI.find("a");var url=jA.attr("href");var urlp=url.replace(/\?.*/,'');urlp+='/'+ this.name+'/'+ this.args;e.preventDefault();jQuery.ajax({url:urlp,dataType:'json',success:function(data,status,jqXHR){self.contextMenu_click_callback(jCommandLI,data,status,jqXHR);},error:function(){alert('oops, didn\'t quite manage that task. please call support');}});}}
FN_Gallery.prototype.contextMenu_click_callback=function contextMenu_click_callback(jCommandLI,data,status,jqXHR){if(data.message)alert(data.message);else{var jCarouselMainItem=jCommandLI.closest(".jcarousel-item");var index=this.item_to_index(jCarouselMainItem);var jCarouselNaviItem=this.index_to_item(this.jCarouselNavi,index);if(data.removeClass){jCarouselMainItem.removeClass(data.removeClass);jCarouselNaviItem.removeClass(data.removeClass);}
if(data.addClass){jCarouselMainItem.addClass(data.addClass);jCarouselNaviItem.addClass(data.addClass);}
if(data.reload)this.reload(jCarouselMainItem);8
if(data.navigate)document.location=document.location.protocol+'//'+ document.location.host+ data.navigate;if(data.overlay)document.location=document.location.protocol+'//'+ document.location.host+ document.location.pathname+'#overlay='+ data.overlay;}}
FN_Gallery.prototype.navi_sort=function navi_sort(){var self=this;var nids=[];this.jCarouselNavi.find(".jcarousel-item").each(function(){if(nid=self.item_to_nodeid(jQuery(this)))nids.push(parseInt(nid));});if(nids.length){jQuery.ajax({url:'/fn_gallery/'+ this.name+'/'+ this.args+'/ajax/resort/'+ nids+'/'+ this.item_to_nodeid(this.jDrag),complete:function(jqXHR,textStatus){self.navi_sort_callback(jqXHR,textStatus);}});}else alert('can not sort these node types cause the node id is not found by the somewhat subjective FN_Gallery.prototype.item_to_nodeid()');}
FN_Gallery.prototype.navi_sort_callback=function navi_sort_callback(jqXHR,textStatus){var self=this;this.jCarouselNavi.animate({opacity:'0.5'},{complete:function(){self.jCarouselNavi.animate({opacity:'1.0'},'slow');}},'slow');;}
FN_Gallery.prototype.navi_next_mouseenter=function navi_next_mouseenter(jCarouselItem,e){if(this.jDrag)this.carousel_navi.next();}
FN_Gallery.prototype.navi_prev_mouseenter=function navi_prev_mouseenter(jCarouselItem,e){if(this.jDrag)this.carousel_navi.prev();}
FN_Gallery.prototype.selected_item_in_navi=function selected_item_in_navi(){return this.index_to_item(this.jCarouselNavi,this.selected_index);}
FN_Gallery.prototype.selected_item_in_main=function selected_item_in_main(){return this.index_to_item(this.jCarouselMain,this.selected_index);}
FN_Gallery.prototype.destroy_slide=function destroy_slide(carousel,jCarouselItem){var index=this.item_to_index(jCarouselItem);jCarouselItem.addClass('jcarousel-item-placeholder').addClass('jcarousel-item-placeholder-horizontal').empty();}
FN_Gallery.prototype.item_is_in_nav=function item_is_in_nav(jCarouselItem){return jCarouselItem.parents(".attachment-after").length==1;}
FN_Gallery.prototype.index_to_item=function index_to_item(jCarousel,index){return jCarousel.find(".jcarousel-item-"+ index);}
FN_Gallery.prototype.item_to_index=function item_to_index(jCarouselItem){return parseInt(jCarouselItem.attr("jcarouselindex"));}
FN_Gallery.prototype.reload=function reload(jCarouselItem){var nodeid=this.item_to_nodeid(jCarouselItem);this.carousel_main.reset();this.carousel_main.reload();this.carousel_navi.reset();this.carousel_navi.reload();}
FN_Gallery.prototype.item_to_nodeid=function item_to_nodeid(jCarouselItem){var nid,jArticle=jCarouselItem.find("div:first");if(aid=jArticle.attr("id"))nid=aid.replace(/[^0-9]/g,'');return nid;}
FN_Gallery.prototype.nodeid_to_item=function nodeid_to_item(nodeid,jCarousel){if(!jCarousel)jCarousel=this.jCarouselNavi;return jCarousel.find("div[id=node-"+ nodeid+"]").closest(".jcarousel-item");}
FN_Gallery.prototype.scrollToNodeID=function scrollToNodeID(nodeid){var index,jCarouselItem;if(jCarouselItem=this.nodeid_to_item(nodeid)){index=this.item_to_index(jCarouselItem);this.navi_show(index);this.carousel_main.scroll(index,true);}}})(jQuery);;