if(typeof pstr=="undefined"||!pstr){var pstr={};pstr.psid='ab9b27a6-bfb5-11e2-a5d0-1231390469af';pstr.useguid='1';pstr.pswecdom='.pswec.com';pstr.client_id='a3db52a436';pstr.ckdomain='barneys.com';pstr.wecsubdom='t';pstr.clientax='gg';pstr.test='XX_TEST_XX';pstr.cookie_name='psrw';pstr.emailRegex=/[\w!#$%&'*+\/=\?^_`{|}~-]+(?:\.[\w!#$%&'*+\/=\?^_`{|}~-]+)*@(?:(?:[\w-]*\w)?\.)+(?:com|org|net|edu|gov|mil|biz|info|mobi|name|aero|asia|jobs|museum|[a-z]{2})/i;pstr.naturalKeyName="nkid";pstr.events_off='XX_WEC_EVENTS_OFF_XX';pstr.auto_browse='XX_AUTO_BROWSE_XX';pstr.ifsend_only='XX_IFRAME_ONLY_XX';pstr.ckidparam='__'+pstr.cookie_name;pstr.jsidparam='__psrj';pstr.cidparam='__psc';pstr.eparam='e';pstr.__p_ver="3.0";pstr.__p_show_log=false;pstr.head=document.getElementsByTagName('head').item(0);pstr.debug='';pstr.psessid=(function(){return(new Date()).getTime()+'.'+(''+Math.random()).substring(2)})();if(pstr.useguid.indexOf('XX_')!=-1)pstr.useguid=true;if(pstr.wecsubdom.indexOf('XX_')!=-1)pstr.wecsubdom='wecqa';if(pstr.pswecdom.indexOf('XX_')!=-1)pstr.pswecdom='pswec.com';if(pstr.clientax.indexOf('XX_')!=-1)pstr.clientax='';if(pstr.test.indexOf('XX_')!=-1)pstr.test='0';if(pstr.debug.indexOf('XX_')!=-1||pstr.debug=='')pstr.debug=false;pstr.auto_browse=(pstr.auto_browse.indexOf('XX_')==-1&&pstr.auto_browse=='1')?true:false;pstr.events_off=(pstr.events_off.indexOf('XX_')==-1&&pstr.events_off=='1')?true:false;pstr.ifsend_only=(pstr.ifsend_only.indexOf('XX_')==-1&&pstr.ifsend_only=='1')?true:false}if(typeof pstr.util=="undefined"||!pstr.util){pstr.util={img:new Image(1,1),srcId:(function(f){return function(){++f;return'ps_scr_'+f+'_'+(''+Math.random()).substring(2,10)}})(0),__p_log:"",__p_lvl:2,log:function(k,o){var f=['D','I','W','E'];o=(arguments.length!=2)?0:o;if(o>=pstr.util.__p_lvl){pstr.util.__p_log+=pstr.util.prclv_dt()+'['+f[o]+']: '+k+((pstr.util.isIE())?'</br>':'\n');pstr.util.__refreshLog()}},d:function(f){pstr.util.log(f,0)},i:function(f){pstr.util.log(f,1)},w:function(f){pstr.util.log(f,2)},e:function(f){pstr.util.log(f,3)},showLog:function(f){if(arguments.length==0)return pstr.__p_show_log;pstr.__p_show_log=f},__refreshLog:function(){if(pstr.__p_show_log==false){return}if(document&&document.body){var f=document.getElementById('__ps_log_area');if(f==null){document.body.innerHTML+='\n\n\n<br/><br/>';document.body.innerHTML+='<table border="1"><tr><td> <pre id="__ps_log_area"> Log Area: </pre> </td></tr></table>';f=document.getElementById('__ps_log_area')}f.innerHTML=pstr.util.__p_log}},url:function(o,a,k,r,f){a=(a)?a.replace(/\.+$/,''):a;k=k.replace(/^\.+/,'');return o+'://'+((a)?a+'.':'')+k+'/'+r+'?'+f},rpc:function(o){var f=document.createElement('script');f.id=pstr.util.srcId();f.type='text/javascript';f.defer=false;f.src=o;void(pstr.head.appendChild(f));pstr.util.log('rpc() sending '+f.id+' to  :  '+f.src);return f.id},removeScript:function(f){var o=document.getElementById(f);if(o)pstr.head.removeChild(o)},isSafariRe:new RegExp('Safari/\\d{1,3}\.\\d{1,3}'),isChromeRe:new RegExp('Chrome/\\d{1,3}\.\\d{1,3}'),isAndroidRe:new RegExp('Android/\\d{1,3}\.\\d{1,3}'),isIERe:new RegExp('MSIE'),isSafari:function(){var f=navigator.userAgent;if(f.match(pstr.util.isSafariRe)){if(!f.match(pstr.util.isChromeRe)&&!f.match(pstr.util.isAndroidRe))return true;else return false}else{return false}},isIE:function(){return(navigator.userAgent.match(pstr.util.isIERe))?true:false},getIf:function(){var f=document.createElement('iframe');f.width=0;f.height=0;f.frameborder=0;f.hidden=true;return f},imgSend:function(f){var k=new Image(1,1);var o=pstr.util.srcId();k.id=o;k.onload=function(){pstr.util.d('removing image w/ id : '+o+'. URL='+f);delete k};k.src=f},iframeSend:function(o){if(pstr.ifsend_only||pstr.util.isSafari()){var f=pstr.util.getIf();var a=pstr.util.srcId();f.name=a;f.id=a;f.src=o;var k=(document.body==null)?true:false;var r=function(){pstr.util.d('iFrame cleaning up with id/name : '+a+' ...');if(k){void(pstr.head.removeChild(f))}else{void(document.body.removeChild(f))}delete f;pstr.util.d('... done removing iFrame with id/name : '+a)};if(f.attachEvent&&pstr.util.isIE()){f.attachEvent("onload",r)}else{f.onload=r}if(k){pstr.util.d('appeneding to head : '+a+". URL: "+o);void(pstr.head.appendChild(f))}else{pstr.util.d('appeneding to body : '+a+". URL: "+o);void(document.body.appendChild(f))}}else{pstr.util.imgSend(o)}},oldIframeSend:function(o){if(pstr.ifsend_only||pstr.util.isSafari()){var f=pstr.util.getIf();var r=pstr.util.srcId();f.name=r;var a=document.createElement('form');a.action=o;a.method='POST';a.target=r;var k=false;if(document.body==null){void(pstr.head.appendChild(a));void(pstr.head.appendChild(f));k=true}else{void(document.body.appendChild(a));void(document.body.appendChild(f))}if(a.submit()){if(k){void(document.head.removeChild(f));void(document.head.removeChild(a))}else{void(document.body.removeChild(f));void(document.body.removeChild(a))}}}else{pstr.util.imgSend(o)}},getParams:function(){var f={},qs="",qq=window.location.href.split('?');if(qq.length==2){qs=qq[1]}if(qs==""){return f}var k=qs.split('&');for(var a=0,len=k.length;a<len;a++){var o=k[a].split('=');f[o[0]]=o[1]}return f},getCookies:function(){var f=document.cookie.split(';'),ch={},re=/\s*(.+)\s*\=\s*(.+)\s*/;for(var k=0;k<f.length;k++){var o=f[k].match(re);if(o&&o[1].indexOf('__utm')<0){ch[o[1]]=o[2]}}return ch},cookieExpireDays:365*2,setCookie:function(k,r,o,f){var q=new Date();if(!f){f=this.cookieExpireDays}q.setDate(q.getDate()+f);if(!o){o=pstr.ckdomain}if(!o||document.location.hostname.indexOf(o)==-1){o=document.location.hostname}var a=k+"="+escape(r);a+="; path=/";a+=((o==null)?"":"; domain="+o);a+=((f==null)?"":"; expires="+q.toGMTString());this.log(a);document.cookie=a},inarr:function(f,k){for(var o=0,l=k.length;o<l;o++){if(f===k[o]){return true}}return false},getPageAndRef:function(){var f=document.location.href,ref=document.referrer;if(f.indexOf('://')==-1){f=''}if(ref.indexOf('://')==-1){ref=''}return{'page':f,'ref':ref}},checksum:function(f){if(!f||f=="")return-1;var k=0;for(var o=0;o<f.length;o++){k+=f.charCodeAt(o)}return k},trim:function(f){if(f&&typeof f=='string'){return(typeof f.trim=='function')?f.trim():f.replace(/^\s*/,"").replace(/\s*$/,"")}else return f},_Sk:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rev:function(f){if(!f||f=="")return"";f=""+f;var o,b,c,d="",_1,_2,_3,_4,i=0;(function(){_1=o,_2=b,_3=c,_4=d})();do{o=f.charCodeAt(i++);b=f.charCodeAt(i++);c=f.charCodeAt(i++);_1=o>>2;_2=((o&3)<<4)|(b>>4);_3=((b&15)<<2)|(c>>6);_4=c&63;if(isNaN(b)){_3=_4='@'.charCodeAt(0)}else if(isNaN(c)){_4='@'.charCodeAt(0)}d=d+this._Sk.charAt(_1)+this._Sk.charAt(_2)+this._Sk.charAt(_3)+this._Sk.charAt(_4)}while(i<f.length);return d},padZero:function(f){if(f<10)return"0"+f;return f},prclv_dt:function(f){if(f==null)f=new Date();var o=''+f.getFullYear()+'-'+this.padZero(f.getMonth()+1)+'-'+this.padZero(f.getDate());o+=' '+f.getHours()+':'+this.padZero(f.getMinutes())+':'+this.padZero(f.getSeconds());return o},isDate:function(f){return(f instanceof Date)},isArray:function(f){return(f instanceof Array)},isEmail:function(f){if(f){return pstr.emailRegex.test(pstr.util.trim(f.toLowerCase()))}return false},isEmpty:function(f){return(f==null)?true:(pstr.util.trim(f)=="")?true:false},isOffline:function(){if(pstr.util.trim(document.location.href.toLowerCase()).indexOf("file")==0){return true}return false},aflatten:function aflatten(f){var a=[];if(pstr.util.isArray(f)){for(var k=0,l=f.length;k<l;k++){var o=Object.prototype.toString.call(f[k]).split(' ').pop().split(']').shift().toLowerCase();if(o){a=a.concat(/^(array|collection|arguments|object)$/.test(o)?aflatten(f[k]):f[k])}}}else{a.push(f)}return a},maskPiiEmail:function(f){if(!pstr.emailRegex.test(f)){return f}var p=null;var a=f.split('?');if(a){p=a[0]}else{return f}var s=f.match(/\?.*$/);if((!s)||(s.length!=1)){console.log("WARNING! Malformed URL ["+f+"]");return f}else{query=s[0]}var q=query.split('&');for(ind=0,len=q.length;ind<len;ind++){if(ind>0){p+='&'}var n=q[ind].indexOf("=");if((n>0)&&(q[ind].length>n)){var r=q[ind].substr(0,n);var k=q[ind].substr(n+1,q[ind].length);var o=k.match(pstr.emailRegex);if(o){p+=r+'=';p+=pstr.util.md5.hex_md5(o[0].toLowerCase())}else{p+=q[ind]}}else{p+=q[ind]}}return p},hpii:function(f){var m=f.split('&');var j='';for(var h=0,len=m.length;h<len;h++){var q=m[h];var s=q.split('=');var p=s[0];if(pstr.util.isPii(p)){j+=p+'=';var o=m[h].split('=');var n=decodeURIComponent(o[1]);var a=n.split(';');var k='';for(var r=0,len_v_varr=a.length;r<len_v_varr;r++){if(p=="email"){if(pstr.util.isEmail(a[r])){k+=pstr.util.md5.hex_md5(pstr.util.trim(a[r].toLowerCase()))}else{k+=a[r]}}else{k+=pstr.util.md5.hex_md5(a[r])}if(r!=(len_v_varr-1)){k+=';'}}j+=encodeURIComponent(k)}else{j+=m[h]}if(h!=(m.length-1)){j+='&'}}return j},isPii:function(f){f=pstr.util.trim(f).toLowerCase();var k=['email'];for(var o=0,len=k.length;o<len;o++){if(f==k[o]){return true}}return false}};pstr.util.md5={hexcase:0,hex_md5:function(f){return this.rstr2hex(this.rstr_md5(this.str2rstr_utf8(f)))},hex_hmac_md5:function(f,o){return this.rstr2hex(this.rstr_hmac_md5(this.str2rstr_utf8(f),this.str2rstr_utf8(o)))},md5_vm_test:function(){return this.hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"},rstr_md5:function(f){return this.binl2rstr(this.binl_md5(this.rstr2binl(f),f.length*8))},rstr_hmac_md5:function(o,q){var f=this.rstr2binl(o);if(f.length>16){f=this.binl_md5(f,o.length*8)}var k=Array(16),d=Array(16);for(var r=0;r<16;r++){k[r]=f[r]^909522486;d[r]=f[r]^1549556828}var a=this.binl_md5(k.concat(this.rstr2binl(q)),512+q.length*8);return this.binl2rstr(this.binl_md5(d.concat(a),512+128))},rstr2hex:function(f){try{pstr.util.md5.hexcase}catch(g){pstr.util.md5.hexcase=0}var r=pstr.util.md5.hexcase?"0123456789ABCDEF":"0123456789abcdef";var k="";var o;for(var a=0;a<f.length;a++){o=f.charCodeAt(a);k+=r.charAt((o>>>4)&15)+r.charAt(o&15)}return k},str2rstr_utf8:function(k){var a="";var o=-1;var f,e;while(++o<k.length){f=k.charCodeAt(o);e=o+1<k.length?k.charCodeAt(o+1):0;if(55296<=f&&f<=56319&&56320<=e&&e<=57343){f=65536+((f&1023)<<10)+(e&1023);o++}if(f<=127){a+=String.fromCharCode(f)}else{if(f<=2047){a+=String.fromCharCode(192|((f>>>6)&31),128|(f&63))}else{if(f<=65535){a+=String.fromCharCode(224|((f>>>12)&15),128|((f>>>6)&63),128|(f&63))}else{if(f<=2097151){a+=String.fromCharCode(240|((f>>>18)&7),128|((f>>>12)&63),128|((f>>>6)&63),128|(f&63))}}}}}return a},rstr2binl:function(k){var o=Array(k.length>>2);for(var f=0;f<o.length;f++){o[f]=0}for(var f=0;f<k.length*8;f+=8){o[f>>5]|=(k.charCodeAt(f/8)&255)<<(f%32)}return o},binl2rstr:function(k){var o="";for(var f=0;f<k.length*32;f+=8){o+=String.fromCharCode((k[f>>5]>>>(f%32))&255)}return o},binl_md5:function(q,p){q[p>>5]|=128<<((p)%32);q[(((p+64)>>>9)<<4)+14]=p;var h=1732584193;var o=-271733879;var k=-1732584194;var r=271733878;for(var n=0;n<q.length;n+=16){var a=h;var s=o;var j=k;var f=r;h=this.md5_ff(h,o,k,r,q[n+0],7,-680876936);r=this.md5_ff(r,h,o,k,q[n+1],12,-389564586);k=this.md5_ff(k,r,h,o,q[n+2],17,606105819);o=this.md5_ff(o,k,r,h,q[n+3],22,-1044525330);h=this.md5_ff(h,o,k,r,q[n+4],7,-176418897);r=this.md5_ff(r,h,o,k,q[n+5],12,1200080426);k=this.md5_ff(k,r,h,o,q[n+6],17,-1473231341);o=this.md5_ff(o,k,r,h,q[n+7],22,-45705983);h=this.md5_ff(h,o,k,r,q[n+8],7,1770035416);r=this.md5_ff(r,h,o,k,q[n+9],12,-1958414417);k=this.md5_ff(k,r,h,o,q[n+10],17,-42063);o=this.md5_ff(o,k,r,h,q[n+11],22,-1990404162);h=this.md5_ff(h,o,k,r,q[n+12],7,1804603682);r=this.md5_ff(r,h,o,k,q[n+13],12,-40341101);k=this.md5_ff(k,r,h,o,q[n+14],17,-1502002290);o=this.md5_ff(o,k,r,h,q[n+15],22,1236535329);h=this.md5_gg(h,o,k,r,q[n+1],5,-165796510);r=this.md5_gg(r,h,o,k,q[n+6],9,-1069501632);k=this.md5_gg(k,r,h,o,q[n+11],14,643717713);o=this.md5_gg(o,k,r,h,q[n+0],20,-373897302);h=this.md5_gg(h,o,k,r,q[n+5],5,-701558691);r=this.md5_gg(r,h,o,k,q[n+10],9,38016083);k=this.md5_gg(k,r,h,o,q[n+15],14,-660478335);o=this.md5_gg(o,k,r,h,q[n+4],20,-405537848);h=this.md5_gg(h,o,k,r,q[n+9],5,568446438);r=this.md5_gg(r,h,o,k,q[n+14],9,-1019803690);k=this.md5_gg(k,r,h,o,q[n+3],14,-187363961);o=this.md5_gg(o,k,r,h,q[n+8],20,1163531501);h=this.md5_gg(h,o,k,r,q[n+13],5,-1444681467);r=this.md5_gg(r,h,o,k,q[n+2],9,-51403784);k=this.md5_gg(k,r,h,o,q[n+7],14,1735328473);o=this.md5_gg(o,k,r,h,q[n+12],20,-1926607734);h=this.md5_hh(h,o,k,r,q[n+5],4,-378558);r=this.md5_hh(r,h,o,k,q[n+8],11,-2022574463);k=this.md5_hh(k,r,h,o,q[n+11],16,1839030562);o=this.md5_hh(o,k,r,h,q[n+14],23,-35309556);h=this.md5_hh(h,o,k,r,q[n+1],4,-1530992060);r=this.md5_hh(r,h,o,k,q[n+4],11,1272893353);k=this.md5_hh(k,r,h,o,q[n+7],16,-155497632);o=this.md5_hh(o,k,r,h,q[n+10],23,-1094730640);h=this.md5_hh(h,o,k,r,q[n+13],4,681279174);r=this.md5_hh(r,h,o,k,q[n+0],11,-358537222);k=this.md5_hh(k,r,h,o,q[n+3],16,-722521979);o=this.md5_hh(o,k,r,h,q[n+6],23,76029189);h=this.md5_hh(h,o,k,r,q[n+9],4,-640364487);r=this.md5_hh(r,h,o,k,q[n+12],11,-421815835);k=this.md5_hh(k,r,h,o,q[n+15],16,530742520);o=this.md5_hh(o,k,r,h,q[n+2],23,-995338651);h=this.md5_ii(h,o,k,r,q[n+0],6,-198630844);r=this.md5_ii(r,h,o,k,q[n+7],10,1126891415);k=this.md5_ii(k,r,h,o,q[n+14],15,-1416354905);o=this.md5_ii(o,k,r,h,q[n+5],21,-57434055);h=this.md5_ii(h,o,k,r,q[n+12],6,1700485571);r=this.md5_ii(r,h,o,k,q[n+3],10,-1894986606);k=this.md5_ii(k,r,h,o,q[n+10],15,-1051523);o=this.md5_ii(o,k,r,h,q[n+1],21,-2054922799);h=this.md5_ii(h,o,k,r,q[n+8],6,1873313359);r=this.md5_ii(r,h,o,k,q[n+15],10,-30611744);k=this.md5_ii(k,r,h,o,q[n+6],15,-1560198380);o=this.md5_ii(o,k,r,h,q[n+13],21,1309151649);h=this.md5_ii(h,o,k,r,q[n+4],6,-145523070);r=this.md5_ii(r,h,o,k,q[n+11],10,-1120210379);k=this.md5_ii(k,r,h,o,q[n+2],15,718787259);o=this.md5_ii(o,k,r,h,q[n+9],21,-343485551);h=this.safe_add(h,a);o=this.safe_add(o,s);k=this.safe_add(k,j);r=this.safe_add(r,f)}return Array(h,o,k,r)},md5_cmn:function(k,f,r,o,a,q){return this.safe_add(this.bit_rol(this.safe_add(this.safe_add(f,k),this.safe_add(o,q)),a),r)},md5_ff:function(a,r,k,p,f,q,o){return this.md5_cmn((r&k)|((~r)&p),a,r,f,q,o)},md5_gg:function(a,r,k,p,f,q,o){return this.md5_cmn((r&p)|(k&(~p)),a,r,f,q,o)},md5_hh:function(a,r,k,p,f,q,o){return this.md5_cmn(r^k^p,a,r,f,q,o)},md5_ii:function(a,r,k,p,f,q,o){return this.md5_cmn(k^(r|(~p)),a,r,f,q,o)},safe_add:function(o,a){var f=(o&65535)+(a&65535);var k=(o>>16)+(a>>16)+(f>>16);return(k<<16)|(f&65535)},bit_rol:function(f,o){return(f<<o)|(f>>>(32-o))}};pstr.util.params=pstr.util.getParams();pstr.util.send=pstr.util.iframeSend;if(pstr.debug){pstr.util.send=pstr.util.rpc}Object.size=function(f){var o=0,key;for(key in f){if(f.hasOwnProperty(key))o++}return o};if('__ps_show_log'in pstr.util.params){pstr.util.showLog(true)}if('__ps_debug'in pstr.util.params){pstr.debug=true;pstr.util.__p_lvl=1}if(window.location.href.indexOf('test_ie.html')>=0){pstr.debug=true;pstr.util.__p_lvl=0;pstr.util.showLog(true)}}if(pstr.useguid){var guidCookie=pstr.util.getCookies()[pstr.ckidparam];pstr.util.log('guidCookie = '+guidCookie);if(guidCookie==undefined||guidCookie==null){pstr.util.log('tryin to set cookie');if(pstr.psid!='OO'){pstr.util.setCookie(pstr.ckidparam,pstr.psid,pstr.ckdomain,pstr.util.cookieExpireDays)}}}if(typeof pstr.mwec=="undefined"||!pstr.mwec){pstr.mwec={protocol:("https"==document.location.protocol.substring(0,5))?"https":"http",collect:'collect',valcollect:'validate'};pstr.mwec.getCurr=(function(f){return function(){return f}})({});pstr.mwec.initCurr=function(){var f={};pstr.mwec.getCurr=function(){return f}};pstr.mwec.currcoll=pstr.mwec.collect;pstr.mwec.collectUrl=function(f){return pstr.util.url(pstr.mwec.protocol,pstr.wecsubdom,pstr.pswecdom,pstr.mwec.currcoll,f)};pstr.mwec.obj_add=function obj_add(f,a,k){a=pstr.util.trim(a.toString().toLowerCase());pstr.util.log('obj_add adding '+a+'='+k);if(a in f){if(k==='undefined')return;var o=f[a];var r=typeof o;if(r==='object'&&pstr.util.isArray(o)){f[a].push(k)}else{f[a]=[o,k]}}else{f[a]=k}};pstr.mwec.obj_update=function obj_update(f,k,o){k=pstr.util.trim(k.toString().toLowerCase());pstr.util.log('obj_overwrite putting  '+k+'='+o);if(!(k in f)){f[k]=o}};pstr.mwec.obj_overwrite=function obj_overwrite(f,k,o){k=pstr.util.trim(k.toString().toLowerCase());pstr.util.log('obj_overwrite putting  '+k+'='+o);f[k]=o};pstr.mwec.sflatten=function sflatten(f,o){if(o==null)return;if(o===pstr||o===wec||o===pstr.mwec||o===pstr.util||o===pstr.ax){pstr.util.e('Attempt to add self to self!');return}if(arguments.length>2){for(var k=1,l=arguments.length;k<l;k++){sflatten(f,arguments[k])}return}var s=typeof o;switch(s){case'string':if(o.indexOf('=')==-1){this.obj_add(f,o,'')}else{var a=o.split('=');if(a.length==2){this.obj_add(f,a[0],a[1])}else{this.obj_add(f,a[0],o.substring(o.indexOf('=')+1))}}return;case'object':if(pstr.util.isArray(o)){for(var p in o){pstr.mwec.sflatten(f,o[p])}}else{for(var q in o){var r=o[q];switch(typeof r){case'string':case'number':case'boolean':this.obj_add(f,q,r);break;case'object':if(pstr.util.isArray(r)){this.obj_add(f,q,pstr.util.aflatten(r));break}default:pstr.util.w('WEC.add: Throwing away bad value in hash! Got Key: ['+q+'] Value: '+((typeof r=='function')?'function':r));break}}}return;case'function':default:return}};pstr.mwec.h2s=function(p){var n=function n(f){var a=pstr.util.aflatten(f);var k='';for(var o=0,l=a.length;o<l;o++){k+=a[o]+';'}return k.substring(0,k.length-1)};var q="";for(var s in p){var r=(p[s]===undefined)?'':n(p[s]).toString();q+=(s+'='+encodeURIComponent(r)+'&')}pstr.util.log('h2s: '+q);return q.substring(0,q.length-1)};pstr.mwec.prepSend=function prepSend(f){var r=pstr.util.getPageAndRef();pstr.mwec.obj_update(pstr.mwec.getCurr(),'current_url',pstr.util.maskPiiEmail(r['page']));pstr.mwec.obj_update(pstr.mwec.getCurr(),'referrer',pstr.util.maskPiiEmail(r['ref']));pstr.mwec.obj_update(pstr.mwec.getCurr(),'browser_ts',pstr.util.prclv_dt());pstr.mwec.obj_update(pstr.mwec.getCurr(),'ps_page_id',pstr.psessid);var a=pstr.mwec.h2s(pstr.mwec.getCurr());var o=pstr.util.hpii(a);var k='data='+pstr.util.rev(o)+'|'+pstr.util.checksum(o)+'|'+pstr.__p_ver;k+='&'+pstr.ckidparam+'='+pstr.util.getCookies()[pstr.ckidparam];k+='&'+pstr.jsidparam+'='+pstr.psid;k+='&'+pstr.cidparam+'='+pstr.client_id;k+='&'+pstr.eparam+'='+f;k+='&nosync';if(parseInt(pstr.test)==1){k+='&dev=1'}return k};pstr.mwec.s=function(o,r){if(pstr.events_off===true){return 0}var k=pstr.mwec.prepSend(o);var a=pstr.mwec.collectUrl(k);if(r){a+=r}var f=a;a=pstr.util.maskPiiEmail(f);try{if(a.length>4096){pstr.util.e('URI length is too long: '+a.length,3);pstr.util.e(a,3);pstr.util.send(a.substring(0,a.length-4096))}else{pstr.util.log('URI length is OK: '+a.length);pstr.util.send(a)}pstr.mwec.initCurr()}catch(e){pstr.util.e(' Failed to send() data: '+e)}return a.length};pstr.mwec.getNaturalKey=function(f){if(!f){return null}var o="";var k=pstr.mwec.getCurr()[f];if(k){o=pstr.mwec.wrapNkid(k)}return o};pstr.mwec.wrapNkid=function(f){if(f){f=encodeURIComponent(f);return pstr.mwec.wrapNaturalKey(pstr.naturalKeyName,f)}else{return null}};pstr.mwec.wrapNaturalKey=function(f,o){return'&'+f+'='+o};pstr.mwec.isRepeatOrder=function(f){if(pstr.util.isEmpty(f)){return false}var o=pstr.mwec.getExistingOrders();return pstr.util.inarr(f,o)};pstr.mwec.getExistingOrders=function(){var p=wec.getCookie('__psord');if(pstr.util.isEmpty(p)){return[]}var a=p.split('|');var r=[];for(var q=0;q<a.length;q++){r.push(unescape(a[q]))}return r.filter(function(f,o,k){return!pstr.util.isEmpty(f)})};pstr.mwec.saveOrderID=function(f){var o=wec.getCookie('__psord');if(pstr.util.isEmpty(o)){o=''}o+=escape(f)+"|";pstr.util.setCookie('__psord',o,null,null)};pstr.mwec.getOrderID=function(){return pstr.mwec.getCurr()["order_id"]}}if(!pstr.ax||typeof pstr.ax=='undefined'){pstr.ax={aup:'add_user'};pstr.ax.axUrl=function(f){return pstr.util.url(pstr.mwec.protocol,pstr.wecsubdom,pstr.pswecdom,pstr.ax.aup,f)};pstr.ax.au=function(f){var o='ax='+f+'&s='+pstr.client_id;if(parseInt(pstr.test)==1){o+='&dev=1'}return pstr.ax.axUrl(o)};pstr.ax.cn=function(){if(pstr.clientax=="")return;var k=pstr.clientax.split(',');for(var f=0,len=k.length;f<len;f++){var o=pstr.util.trim(k[f]);if(o){o=pstr.ax.au(o);pstr.util.log(o);pstr.util.send(o)}}};pstr.ax.cn()}if(typeof wec=='undefined'||!wec){var wec={};wec.__validate=function(f){pstr.debug=(f)?true:false;pstr.util.__p_lvl=(pstr.debug)?1:2;pstr.util.showLog(pstr.debug);pstr.mwec.currcoll=(pstr.debug)?pstr.mwec.valcollect:pstr.mwec.collect;pstr.util.send=(pstr.debug)?pstr.util.rpc:pstr.util.imgSend};wec.__log=function(f,o){pstr.util.log(f,o)};wec.getById=function(f){return document.getElementById(f)};wec.getCookie=function(o){var f=pstr.util.getCookies()[o];return(f)?unescape(f):f};wec.getParam=function(f){return pstr.util.params[f]};wec.addCookieByName=function(f){return wec.add({cookie:wec.getCookie(f)})};wec.addCookieId=function(f){return wec.add({cookie:f})};wec.addSessionByName=function(f){return wec.add({session:wec.getCookie(f)})};wec.addSessionId=function(f){return wec.add({session:f})};wec.addServerTs=function(f){return wec.add({server_ts:((pstr.util.isDate(f))?pstr.util.prclv_dt(f):f)})};wec.addHeir=function(f){return wec.add({heir:f})};wec.addPageType=function(f){return wec.add({page_type:f})};wec.addPageName=function(f){return wec.add({page_name:f})};wec.add=function add(){for(var f=0,l=arguments.length;f<l;f++){pstr.mwec.sflatten(pstr.mwec.getCurr(),arguments[f])}return wec};pstr.mwec.getValidator=function(r){var q={required:function(f){var o=r['required'];var k=r['req_values'];if(o){pstr.util.i("checking required values ...");for(var a=0,l=o.length;a<l;a++){if(!(o[a]in f)){pstr.util.w(o[a]+" param not found in input.");return false}pstr.util.i(o[a]+" param found in input.");if(k){if(o[a]in k){pstr.util.i("Checking "+o[a]+"'s value ...");if(!pstr.util.inarr(f[o[a]],k[o[a]])){pstr.util.e(o[a]+"'s value ["+f[o[a]]+"] is not in allowed fields ["+k[o[a]]+"]");return false}pstr.util.i(o[a]+"'s value ["+f[o[a]]+"] is OK.")}}}}return true},short_hand:function(){return false},run:function(f){var o=false;if(this.required(f)){o=true}return(o==true)?true:this.short_hand(f)}};if(r['short_hand']&&typeof r['short_hand']=='function'){q.short_hand=r['short_hand']}return q};wec.browse=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','browse');var r=pstr.mwec.getValidator({required:['viewtype','viewid'],req_values:{'viewtype':['dept','cat','sub_cat','brand','prod','page','token']},short_hand:function(f){for(var o in f){if(pstr.util.inarr(o,['dept','cat','sub_cat','prod','page','token'])){pstr.util.i('Found acceptable short hand value `'+o+'` in input');wec.add({viewtype:o,viewid:f[o]});delete pstr.mwec.getCurr()[o];return true}}return false}}).run(pstr.mwec.getCurr());if(!r){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.browse() is missing required fields!')}}var a=null;var q='b';if('viewtype'in pstr.mwec.getCurr()){var k=pstr.mwec.getCurr().viewtype;k=k.toString();switch(k){case'dept':q='bd';a=pstr.mwec.getNaturalKey("viewid");break;case'cat':q='bc';a=pstr.mwec.getNaturalKey("viewid");break;case'sub_cat':q='bsc';break;case'brand':q='bb';break;case'prod':q='bp';a=pstr.mwec.getNaturalKey("viewid");break;case'page':q='p';a=pstr.mwec.getNaturalKey("viewid");break;case'token':q='bt';a='&node='+pstr.mwec.getCurr()['viewid'];break;default:q='b';break}}pstr.mwec.s(q,a);return r};wec.search=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','search');var f=pstr.mwec.getValidator({required:['term']}).run(pstr.mwec.getCurr());if(!f){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.search() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}pstr.mwec.s('s');return f};wec.cart_insert=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','cart');pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'cart','add');var k=pstr.mwec.getValidator({required:['sku','price','qty'],short_hand:function(f){if('cartitem'in f){pstr.util.i('Found acceptable short hand value `cartitem` in input');return true}return false}}).run(pstr.mwec.getCurr());if(!k){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.cart_insert() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}var o=pstr.mwec.getNaturalKey('sku');if(o==null&&'cartitem'in pstr.mwec.getCurr()){var a=pstr.mwec.getCurr()['cartitem'];if(a.indexOf(',')>=0){pstr.mwec.wrapNkid(a.split(",")[0])}}pstr.mwec.s('ci',o);return k};wec.cart_remove=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','cart');pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'cart','remove');var o=pstr.mwec.getValidator({required:['sku','qty'],short_hand:function(f){return('cartitem'in f)}}).run(pstr.mwec.getCurr());if(!o){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.cart_remove() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}pstr.mwec.s('cr');return o};wec.cart_reset=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','cart');pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'cart','reset');var f=pstr.mwec.getValidator({required:['cartitem']}).run(pstr.mwec.getCurr());if(!f){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.cart_reset() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}pstr.mwec.s('crs');return f};wec.order=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','order');var s=pstr.mwec.getValidator({required:['lineitems','order_total','order_id','email']}).run(pstr.mwec.getCurr());if(!s){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.order() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}var m=pstr.mwec.getOrderID();if(pstr.mwec.isRepeatOrder(m)){pstr.util.w('Detected repeat wec.order() event with order id ['+m+'] from existing order in cookie');pstr.mwec.s('or','&repeat_order=true');return false}if(pstr.util.isOffline()){pstr.util.w('Detected wec.order() event with order id ['+m+'] from a saved file');pstr.mwec.s('or','&offline_order=true');return false}var h=pstr.mwec.getCurr()['order_total'];var q="";if(h){q="&tpr="+pstr.util.rev(h)}var p=function(o,f){var a="";if(o){var k=o.split(';');for(ind=0,len=k.length;ind<len;ind++){a+=k[ind].split(',')[0]+","}if(f){a=a.substring(0,a.length-1)}}return a};if('lineitems'in pstr.mwec.getCurr()){var n=pstr.mwec.getCurr()['lineitems'];var j="";if(pstr.util.isArray(n)){for(var r=0,len=n.length;r<len;r++){if(n[r].indexOf(";")>-1){j+=p(n[r])}else{j+=n[r].split(',')[0]+','}}j=j.substring(0,j.length-1)}else{if(n.indexOf(";")>0){j=p(n,true)}else{j=n.split(',')[0]}}q+=pstr.mwec.wrapNkid(j)}pstr.mwec.s('o',q);pstr.mwec.saveOrderID(m);return s};wec.register=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','register');var o=pstr.mwec.getValidator({required:['email','user_id'],short_hand:function(f){return('email'in f||'user_id'in f)}}).run(pstr.mwec.getCurr());if(!o){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.register() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}pstr.mwec.s('r');return o};wec.login=function(){wec.add.apply(null,arguments);pstr.mwec.obj_overwrite(pstr.mwec.getCurr(),'event','login');var k=pstr.mwec.getValidator({required:['login_type','login_id'],req_values:{'login_type':['email','user_id']},short_hand:function(f){for(var o in f){if(pstr.util.inarr(o,['email','user_id'])){return true}}return false}}).run(pstr.mwec.getCurr());if(!k){wec.add({jserr:1});if(pstr.debug){pstr.util.e('WEC ERROR: wec.login() is missing required fields!')}}else{delete pstr.mwec.getCurr()['jserr']}pstr.mwec.s('l');return k};if('__ps_validate'in pstr.util.params){wec.__validate(true)}}(function(){var o=function(){var f=wec.getParam('email');if(!f)f=wec.getParam('email_address');if(f){if('utm_medium'in pstr.util.params&&wec.getParam('utm_medium')=='email'){wec.send({event:'em_url',email:f})}}};var a=function(){if(pstr.auto_browse===true){pstr.util.log('Auto browsing current page');if(typeof ps_token_id!='undefined'){if(pstr.util.isEmpty(ps_token_id)){wec.add({token:""})}else{wec.add({token:pstr.util.trim(ps_token_id)})}}else{wec.add({page:'auto_browse'})}wec.browse()}};a();var k=function(){if(typeof _pswf=='string'&&typeof _pswa!='undefined'){_pswf=_pswf.toLowerCase();if(wec.hasOwnProperty(_pswf)&&pstr.util.inarr(_pswf,['browse','cart_insert','cart_remove','cart_reset','order','login','register','search'])){return wec[_pswf](_pswa)}}};k()})();