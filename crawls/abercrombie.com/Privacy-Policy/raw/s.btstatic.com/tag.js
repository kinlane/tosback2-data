window.BrightTag=function(c){function p(a,c){return Object.prototype.toString.call(a)==="[object "+c+"]"}if(c)return bt_log("tried to load tag.js again"),c;var c={pushIfDefined:function(a,c,f){a&&(a.constructor==Array&&null!=c)&&a.push(f||c)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},Escaper:{cookie:function(a){return!m.isString(a)?a:a.replace(/%/g,"%25").replace(/#/g,"%23").replace(/&/g,"%26").replace(/'/g,"%27").replace(/;/g,"%3B").replace(/</g,"%3C").replace(/>/g,"%3E")},
javascript:function(a){return!m.isString(a)?a:a.replace(/\\/g,"\\\\").replace(/'/g,"\\x27").replace(/"/g,"\\x22").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}},Random:{integer:function(a){return Math.floor(Math.random()*(a||1E8))}},defaultConfig:function(){var a=new c.HTTP.Cookie(document);return{loadOnly:!1,window:window,document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,data:{},store:a,errorManager:new c.ErrorManager(a)}}},
v=c.eval=function(a,c,f){try{return f&&(a+=y(f)),eval.call(void 0,a)}catch(d){c&&c(d)}},y=function(a){return"\n//at-sourceURL=/BrightTag/"+a.replace(/\s+/g,"_")+".js"},r=c.extend=function(a,c){for(var f in c)c.hasOwnProperty(f)&&(a[f]=c[f]);return a},m=c.Types={isString:function(a){return p(a,"String")},isArray:function(a){return p(a,"Array")},isNumber:function(a){return p(a,"Number")},isFunction:function(a){return p(a,"Function")},isObject:function(a){return null===a||void 0===a?!1:p(a,"Object")}},
l=c.each=function(a,c){if(a)if(m.isArray(a)||a.length)for(var f=0,d=a.length;f<d;f++)c(a[f],f);else if(m.isObject(a))for(f in a)a.hasOwnProperty(f)&&c(f,a[f])};c.Blab={};c.Blab.Engine=function(a){function c(){n=!0;o=s.length;g("engine:off")}function f(){n=!1;A=0;(s[o++]||c)()}function d(){g("block:finish");f()}function b(b,e){return function(){var j=!1,h=a.createElement("script");h.onload=h.onreadystatechange=function(){var a;if(!(a=j)){a:{switch(h.readyState){case void 0:case "loaded":case "complete":a=
!0;break a}a=!1}a=!a}a||(j=!0,d())};h.onerror=function(){g("block:error",{type:"script",exception:"Problem loading "+b});j||d()};h.src=b;h.text=e;g("block:start",b);var c=a.getElementsByTagName("script")[0];c.parentNode.insertBefore(h,c)}}function e(b){return function(){try{if(g("block:start",b),b.constructor==String)if(a.defaultView){var e=y("tags/"+(x.tagId||"adhoc")+"-inline-b"+(o-1));a.defaultView.eval.call(void 0,b+e)}else a.parentWindow?a.parentWindow.execScript(b):g("block:error",{type:"wait",
exception:"Could not evaluate wait block ["+b+"]"});else b()}catch(h){g("block:error",{type:"wait",exception:h})}finally{d()}}}function h(a){s.push(a);n&&f();return k}function j(a){s.splice(o+A++,0,a);return k}function g(a){var b=Array.prototype.slice.call(arguments,1);l(t,function(e){var g=[k].concat(b);(e[a]||q).apply(null,g)})}var k=this,q=function(){},t=[],n=!1,x={},s=[],o=0,A=0;k.run=function(){g("engine:on");f()};k.options=function(a){r(x,a);return k};k.option=function(a){return x[a]};k.script=
function(a){return h(b(a))};k.wait=function(a){return h(e(a))};k.preemptScript=function(a,e){return j(b(a,e))};k.preemptWait=function(a){return j(e(a))};k.listen=function(a){t.push(a);(a["engine:listen"]||q).apply(null,[k]);return k}};c.Blab.Group=function(){function a(a){b.push(a)}function c(a){a.run()}function f(){var a=b[e++];a?a.listen(h).run():d.doNotQueue()}var d=this,b=[],e=0,h={"engine:off":function(){f()}};d.doNotQueue=function(){a=c};d.push=function(b){a(b);return b};d.run=function(){f()};
d.applyListener=function(a){for(var g=e,h=b.length;g<h;g++)b[g].listen(a)}};c.Blab.Manager=function(a){function i(e){var h=new f.Engine(a);l(b,function(a){h.listen(a)});return(d[e]||(d[e]=new f.Group)).push(h)}var f=c.Blab,d={undefined:new f.Group},b=[];d[void 0].doNotQueue();this.addGlobalListener=function(a){b.push(a);l(d,function(b){d[b].applyListener(a)})};this.group=function(a){return i(a)};this.listen=function(){return i().listen.apply(null,arguments)};this.script=function(){return i().script.apply(null,
arguments)};this.wait=function(){return i().wait.apply(null,arguments)};this.run=function(a){(d[a]||(d[a]=new f.Group)).run()};this.setOptions=function(){return i()}};var u,B=[],D=function(a){u.push(a)};c.Blab.SwapwriteListener=function(a){function c(a){a.src?d.preemptScript(a.src,a.innerHTML):a.innerHTML&&d.preemptWait(a.innerHTML)}function f(b){try{a.body.appendChild(b.cloneNode(!0))}catch(h){bt_log("error appending content to body: "+h)}}var d,b=a.createElement("div");this["block:start"]=function(){var b=
a;B.push([u,b.write,b.writeln]);u=[];b.write=b.writeln=D};this["block:finish"]=function(){try{if(0!=u.length){b.innerHTML="<br/>"+u.join("");for(var e=b.childNodes||[],h=1,j=e.length;h<j;h++)("SCRIPT"==e[h].tagName?c:f)(e[h])}}finally{e=a,h=B.pop(),u=h[0],e.write=h[1],e.writeln=h[2]}};this["engine:listen"]=function(a){d=a}};c.Blab.GlobalSwapwriteListener=function(a){var i=c.Blab;this["engine:listen"]=function(c){c.listen(new i.SwapwriteListener(a))}};c.EventsManager=function(){function a(){}function i(a,
b,g){e(a,b,function(){(!g||g())&&c.EventListenerOverride(a,b)})}function f(a){var b=a.readyState;if("loading"==b)return!1;if("complete"==b)return!0;if(a.addEventListener)return"interactive"==b;a:{a=a.documentElement.doScroll||function(){throw"No doScroll";};try{a("left")}catch(g){a=!1;break a}a=!0}return a}function d(a,b,g){var c=this;setTimeout(function(){a()?b.call(c):d(a,b,g)},g)}var b=this,e=b.listen=function(a,b,g){a.addEventListener?a.addEventListener(b,g,!1):a.attachEvent&&a.attachEvent("on"+
b,g)};b.domReady=function(a,b){f(a)?b.call(this):a.addEventListener?e(a,"DOMContentLoaded",b):d(function(){return f(a)},b,1)};b.enablePageReadyOverrides=function(e,d){b.enablePageReadyOverrides=a;"complete"==d.readyState?c.EventListenerOverride(e,"load"):i(e,"load");if(d.addEventListener){var g=d.readyState;"complete"==g||"interactive"==g?c.EventListenerOverride(d,"DOMContentLoaded"):i(d,"DOMContentLoaded")}}};c.EventListenerOverride=function(a,c){function f(a){var b=this;setTimeout(function(){try{a.call(b)}catch(d){bt_log("error overriding "+
c+" event: "+d)}},0)}var d=a.addEventListener?"addEventListener":"attachEvent",b=a[d];a[d]=function(e,h,j){if("function"==typeof h)if(e==c||e=="on"+c)f(h);else try{"addEventListener"==d?b.call(a,e,h,j):b(e,h)}catch(g){bt_log("error proxying "+e+" event: "+g)}}};c.Events=new c.EventsManager;c.EventBindingManager=function(a,i){function f(a,b){l(b,function(b,c){a[a.type+"."+b]=c});i.push(a)}function d(a){function c(a){var b=this,g=[];b.appendData=function(a){g.push(function(b){b.appendData(a)});return b};
b.appendJs=function(a){g.push(function(b){b.appendJs(a)});return b};b.postProcess=function(a){l(g,function(b){b(a)})};b.tagId=a;b.execute=e.execute;b.fire=e.fire;b.evaluate=e.evaluate}var e=this,d=[],j=[],i="true";e.execute=function(b,c){var j=r({eventName:a},c||{});if(m.isFunction(b))d.push(r(b,j));else if(m.isString(b))try{var k=y("events/"+a+"-tag-"+(j.tagId||"adhoc")),n=h.functionWithAccess(["eventObject","eventData"],b+k);d.push(r(n,j))}catch(i){f({type:"evparse",message:i.toString(),tagId:j.tagId||
-1},{eventName:a})}else bt_log("when.execute: unknown action: "+b);return e};e.evaluate=function(a){i=a;return e};e.fire=function(a){a=new c(a);j.push(a);return a};e.handler=function(a,c){var g=i;v(i,function(a){bt_log("Invalid post-event conditional fire expression: "+g+", exception = "+a)})&&(b.executeActions(d,a,c),b.fireTags(j))}}var b={},e={},h=c.jQueryLoader(a,"BrightTag.jQuery");b.Binder=function(a,b){var d=this,j=[],n={},i=(b||{}).pageId;d.data=function(a,b){j.push({name:a,dbe:b});return d};
d.bindData=function(b,e,d){l(j,function(j){var k=j.name;try{var z=n[j.dbe];if(!z){var C=j.dbe,q,t=j.dbe,m=y("event-dbes/"+k+"-page-"+(i||"adhoc")+"-event-"+a);q=h.functionWithAccess(["eventObject","eventData"],"return "+t+";"+m);z=n[C]=q}c.instance.data(k,z.call(b,e,d))}catch(l){f({type:"evdbe",message:l.toString(),pageId:i||-1},{name:k,eventName:a})}})};d.handler=function(b){var c=e[a];if(c){var j=Array.prototype.slice.call(arguments,1);d.bindData(b.target,b,j);c.handler(b,j)}}};var j=/^direct\//i;
b.bind=function(a,c,e,d){var f=new b.Binder(a,d);h.ensureJQuery(function(){var a=h.getJQuery()(c);a.live&&c.constructor===String&&!j.test(e)?a.live(e,f.handler):a.bind(e.split(j).pop(),f.handler)});return f};b.when=function(a){return e[a]||(e[a]=new d(a))};b.executeActions=function(a,b,c){l(a,function(a){try{a.call(b.target,b,c)}catch(e){f({type:"evwait",message:e.toString(),tagId:a.tagId||-1},{eventName:a.eventName})}})};b.fireTags=function(a){if(0<a.length){var b=c.instance.serverURL();l(a,function(a){b.cf(a.tagId);
a.postProcess(b)});c.Blab.script(b.asString())}};return b};c.HTTP={};c.HTTP.Cookie=function(a){function i(a){for(var c,f,a=a.split(/; ?/),j=0,g=a.length;j<g;j++){f=a[j];c=f.indexOf("=");var i=d,q=f.slice(0,c);c=f.slice(c+1);c=unescape(c);i[q]=c}}var f=this,d={};f.get=function(a){return d[a]};f.remove=function(a,c){f.set(a,"",r(c||{},{expires:0}))};f.set=function(b,e,d){if(b){d=d||{};b=[b+"="+c.Escaper.cookie(e||"")];if((e=d.expires)||0===e)m.isNumber(e)&&(e=(new Date(e)).toGMTString()),b.push("expires="+
e);(e=d.path)&&b.push("path="+e);(e=d.domain)&&b.push("domain="+e);!0===d.secure&&b.push("Secure");!0===d.httponly&&b.push("HttpOnly");d=b.join(";");if(4096>d.length)a.cookie=d;else throw{name:"CookieTooLongError",message:"Cookie reached 4096 byte limit"};i(a.cookie)}};f.findEach=function(a,c){for(key in d)d.hasOwnProperty(key)&&key.match(a)&&c(key,d[key])};i(a.cookie||"")};c.HTTP.QueryString=function(a){function c(a){if(a&&"string"==typeof a){var d=a.split("&"),a={};l(d,function(c){var d=c.split("="),
c=decodeURIComponent(d[0]),d=d[1]&&decodeURIComponent(d[1].replace(/\+/g," "));a[c]=d})}return a}var f=this,d={};r(d,c(a));f.param=function(a){return d[a]||""};f.params=function(){return d};f.appendParam=function(a,c){a&&(void 0!=c&&""!==c)&&(d[a]=c);return this};f.appendParams=function(a){l(a,f.appendParam);return this};f.alwaysAppendParam=function(a,c){a&&(d[a]=void 0!=c?c:"");return this};f.alwaysAppendParams=function(a){l(a,f.alwaysAppendParam);return this};f.appendPartialQueryString=function(a){a&&
f.alwaysAppendParams(c(a));return this};f.deleteParam=function(a){delete d[a]};f.toString=function(){var a=[],c;for(c in d){var f=encodeURIComponent(c),j=encodeURIComponent(d[c]);a.push(f+"="+j)}return a.join("&")}};c.HTTP.URL=function(a){var i=this,f,d,b,e=a.indexOf("#");-1<e&&(b=a.substring(e+1),a=a.substring(0,e));e=a.indexOf("?");-1<e&&(d=a.substring(e+1),a=a.substring(0,e));f=a;a=new c.HTTP.QueryString(d);r(i,a);i.queryString=a.toString;i.toString=function(){var a=i.queryString();return f+(a.length>
0?"?"+a:"")};i.asString=i.toString;i.fragment=function(){return b}};c.ServerURL=function(a){function i(a,b){b&&b.findEach(a,function(a,b){d.appendParam(a,b)})}function f(a,b){return function(c){bt_log("invalid "+a+" expression: "+b+", exception = "+c)}}var d=this,b=a.window,e=a.parentReferrer,h=a.referrer;c.HTTP.URL.call(this,0===a.host.length?"":(a.host.match("^[a-z0-9+.-]+://.+")?"":"//")+a.host+"/tag");d.appendParams({site:a.site,referrer:h,docReferrer:a.docReferrer,mode:a.mode});h!==e&&d.appendParam("parentReferrer",
e);i(/^btps\..+/,new c.HTTP.Cookie(a.document));i(/^btpdb\..+/,a.store);d.appendData=function(a){var c=bt_data(a),c=m.isArray(c)||m.isObject(c)?b.JSON.stringify(c):c;return d.alwaysAppendParam("_cb_"+("bt_data('"+a+"')"),c)};d.appendJs=function(a){var b=f("client binding expression",a);return d.alwaysAppendParam("_cb_"+a,v(a,b))};d.cf=function(a){m.isArray(a)||(a=[a]);var b=d.param("cf");b&&(a=Array(b).concat(a));d.appendParam("cf",a.join());return d};d.addCf=function(a,b){if(!v(b,f("conditional fire",
b,"tags/"+a+"-cf.js")))return!1;var c=d.param("cf");d.appendParam("cf",c?c+","+a:a);return!0}};c.Page=function(a,i){function f(a){l(m.isArray(a)?a:[a],function(a){m.isFunction(a)?a():n.write('<script type="text/javascript" src="'+a+'"><\/script>')})}function d(a){var b=s.group().options({tagId:-2});l(m.isArray(a)?a:[a],function(a){(m.isFunction(a)?b.wait:b.script)(a)})}function b(a){n.write(a)}function e(a,b){var c={};b&&b.tagId&&(c.tagId=b.tagId);s.group(!u?"domready":void 0).options(c).wait(function(){n.write(a)})}
function h(a){l(a,function(a){if(a.name){var b=r({},a);delete b.name;delete b.value;p.set(a.name,a.value,b)}})}function j(b){o.hasErrors()&&(b.appendParam("errors",o.toJSON()),2083<b.toString().length&&(b.deleteParam("errors"),o.tooManyErrors(),b.appendParam("errors",o.toJSON())));o.reset({site:a.site,referrer:a.referrer||n.location.href})}var g=this,k=void 0,q=a.data||{},t=void 0,n=a.document||{},x=a.window||{},s=a.blab||c.Blab,o=a.errorManager,p=a.store,u=!1;g.referrer=a.referrer;g.parentReferrer=
a.parentReferrer;g.docReferrer=a.docReferrer;g.site=a.site;g.host=a.host;o&&s.addGlobalListener(o);var w="sync"===a.mode;g.writeScript=w?f:d;g.appendContent=w?b:e;g.domReady=function(){u=!0;s.addGlobalListener(new s.GlobalSwapwriteListener(n));"sync"===a.mode&&(g.writeScript=d,g.appendContent=e);s.run("domready")};g.parameter=function(a){void 0==k&&(k=new c.HTTP.URL(n.location.href));return k.param(a)};g.meta=function(a){t||(t={},l(n.getElementsByTagName("meta"),function(a){t[a.getAttribute("name")]=
a.getAttribute("content")}));return t[a]||""};g.cookie=function(a){return(new c.HTTP.Cookie(n)).get(a)||""};g.data=function(a,b){if(void 0!==b)return q[a]=b;b=q[a];return void 0==b?"":b};g.dbe=function(a,b,c){g.data(a,v(b,function(b){o&&o.push({type:"dbe",message:b.toString(),"dbe.name":a,pageId:(c||{}).pageId||-1})},"page-dbes/"+a+"-page-"+(c&&c.pageId||"adhoc")))};g.errors=function(a){o.configure(a)};g.store=p?h:function(){};g.serverURL=function(){return new c.ServerURL(a)};g.defaultBaseUri=function(){return("https:"==
n.location.protocol?"https:":"http:")+"//s.btstatic.com/"};g.baseUri=function(){var a=/\btag(\.[^.]+|-n)?\.js(#.*)?$/;return i&&i.src&&i.src.replace(a,"")||g.defaultBaseUri()};g.primary=function(){var a=[];x.JSON||a.push(g.baseUri()+"json2.js");a.push(function(){var a=g.serverURL();o&&(o.processStoredErrors(),j(a));return a.toString()}());g.writeScript(a)};g.secondary=function(a){var b=g.serverURL(),c=b.toString();a(b);b.toString()!=c&&(o&&j(b),g.writeScript(b.toString()))}};c.ErrorManager=function(a,
c){function f(c){g.push(d(c));a.set(k,b.toJSON(),{path:"/"})}function d(a){var b=m.isObject(a)?r({},a):{};b.type=b.type||"unknown";b.message=b.message||a.toString();b.timestamp=q;return b}if(!a)throw"ErrorManager requires a store";var b={},e,h,j=!0,g=[],k="__bterr",q=+new Date,l=b.configure=function(a){a.hasOwnProperty("enabled")&&(j=a.enabled);a.hasOwnProperty("timestamp")&&(q=a.timestamp);a.hasOwnProperty("site")&&(e=a.site);a.hasOwnProperty("referrer")&&(h=a.referrer)};c&&l(c);b.reset=function(b){b&&
l(b);g=[];a.remove(k);a.remove(k,{path:"/"})};b.hasErrors=function(){return 0<g.length};b.toArray=function(){return g};b.toJSON=function(){try{return JSON.stringify({site:e,referrer:h,errors:g})}catch(a){bt_log("problem serializing errors: "+a.message)}};b.push=function(a){bt_log("error: "+JSON.stringify(a));if(j&&a&&!(-1>a.tagId||-1>a.pageId))try{f(a)}catch(c){if("CookieTooLongError"!=c.name)throw c;b.tooManyErrors()}};b.tooManyErrors=function(){b.reset();f({type:"runtime",message:"Too many errors"})};
b["block:error"]=function(a,c){if(c){var d=c.type,f=c.exception||c,e=a.option("tagId")||-1;b.push({type:d,message:f.toString(),tagId:e})}};b.processStoredErrors=function(){var b=a.get(k);if(b)try{var c=JSON.parse(b);e=c.site;h=c.referrer;m.isArray(c.errors)&&(g=g.concat(c.errors))}catch(d){bt_log("problem reading stored errors: "+d.message)}};return b};c.CookieSyncEngine=function(a){var i={fn:function(a){a()},next:null},f=i,d=a.document,b=function(a){if("function"!=typeof a)return!1;a={fn:a,next:null};
f=f.next=a;return!0},e=function(){if(i){var a=i.fn;i=i.next;a(e)}},h=e;c.Events.listen(a,"load",h);return{sync:h,push:function(a){return b(a)},pushImage:function(c){return b(function(b){var d=new a.Image;d.onerror=d.onload=b;d.src=c})},pushIframe:function(a){return b(function(b){var c=d.createElement("iframe");c.onerror=c.onload=b;c.width=0;c.height=0;c.style.border=0;c.src=a;d.body.appendChild(c)})}}};c.jQueryLoader=function(a,i){return new function(a,d){function b(a){k.wait(a)}function e(a){function d(){i=
c.jQuery;b(a)}g="var $ = BrightTag.$; ";c.jQuery?d():k.script(c.instance.baseUri()+"BrightTag.jquery-1.5.1.js").wait(d)}var h={},i=a.jQuery,g="",k=c.Blab.group(d);h.getJQuery=function(){return i};h.functionWithAccess=function(a,b){return new Function(a,g+b)};h.ensureJQuery=function(a){h.ensureJQuery=b;(i?b:e)(a);c.Blab.run(d)};return h}(a,i)};c.Main=function(a){var i=c.Events,f;a:{f=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/;for(var d=a.document.getElementsByTagName("script"),b=d.length-1;-1<b;b--){var e=d[b];
if(f.test(e.src)){f=e;break a}}f=void 0}f&&((d=(new c.HTTP.URL(f.src)).fragment())&&r(a,(new c.HTTP.QueryString(d)).params()),d=function(a){bt_log("configuration error: "+a)},b=c.trim(f.innerHTML),0!==b.length&&r(a,v("(\n"+b+"\n)",d,"site-config")));if(void 0!=a.site){i.enablePageReadyOverrides(a.window,a.document);try{var h=new c.Page(a,f);i.domReady(a.document,function(){h.domReady()});a.loadOnly||h.primary();return h}catch(j){bt_log("execution error: "+j)}}};var w=c.defaultConfig();r(c.Blab,new c.Blab.Manager(w.document));
c.$LAB=c.Blab;c.EventBinding=c.EventBindingManager(w.window,w.errorManager);c.CookieSync=c.CookieSyncEngine(w.window);c.instance=c.Main(w);return c}(window.BrightTag);function bt_parameter(c){return BrightTag.instance.parameter(c)}function bt_meta(c){return BrightTag.instance.meta(c)}function bt_cookie(c){return BrightTag.instance.cookie(c)}function bt_data(c,p){return BrightTag.instance.data(c,p)}window.bt_data_escaped=bt_data;
function bt_log(c){window.console&&console.log&&console.log("BrightTag: "+c)}var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;function btServe(c){if(void 0==BrightTag.instance){var p=BrightTag,v=p.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},p.defaultConfig());void 0!=_bt_url_prefix&&(v.host=_bt_url_prefix);p.instance=p.Main(p.extend(v,c||{}))}};
