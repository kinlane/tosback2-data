/*
 *  (c) 2000-2013 deviantART, Inc. All rights reserved.
 */
window.FilmBox={hover:function(e){var a=$(e);var d=a.width();var c=a.find("b.film");Station.stopAnimation(c[0]);var f=parseInt(Station.read(c[0],"left"))||0;var b=[c[0],"left",{from:f,to:f,time:500}];while(f>-(d*5)){b=b.concat([{from:f,to:f=((f-d)-(f%d)),time:300,f:Interpolators.pulse},{from:f,to:f,time:700}])}Station.run.apply(Station,b)},out:function(a){$filmstrip=$(a).find("b.film");Station.stopAnimation($filmstrip[0]);Station.run($filmstrip[0],"display",{to:"block",time:25},"left",{from:parseInt(Station.read($filmstrip[0],"left")||0),to:0,f:Interpolators.pulse,time:600})}};if(window.DWait){DWait.run("jms/lib/filmbox.js")};
window.Subby={warning:function(f,h,g,e){var b=$(f),a,d,c;if(h===undefined){h="Get"}else{h=h||""}g=g||"this feature";e=e?" "+e:"";d='<div class="subblebubble">'+h+" <strong>"+g+"</strong>"+e+" when you upgrade to <strong>Premium&nbsp;Membership</strong></div>";a=$(d).css({visibility:"hidden",position:"absolute","z-index":300}).appendTo("body");b.addClass("subble").data("subby",a);c=Subby.getPosition(a[0],Ruler.document.jq_node(f));a.css({left:c.x,top:c.y,visibility:"visible"})},getPosition:function(d,b){var a,c;c={x:b.x,y:b.y2,w:d.offsetWidth,h:d.offsetHeight};c.x2=c.x+c.w;c.y2=c.y+c.h;a=Ruler.screen.rect();if((c.x2+30)>a.x2){c.x=Math.max(0,b.x2-c.w);c.x2=c.x+c.w}if(c.y2>a.y2){c.y=Math.max(0,b.y-c.h);c.y2=c.y+c.h}return c},out:function(b){var a;a=$(b).data("subby");if(a){a.remove()}$(b).data("subby",null)}};if(window.DWait){DWait.run("jms/pages/subby.js")};
window.popupSitback=function(g,f,c,a){var e="http://justsitback.deviantart.com";var d="menubar=no,width=640,height=480,toolbar=no,status=no,location=no,directories=no,resizable=yes";if(vms_feature("html5_sitback")){d="menubar=no,width=640,height=510,toolbar=no,status=no,location=no,directories=no,resizable=yes"}if(Browser.isIE){g="Slideshow"}var b=e+"?title="+encodeURIComponent(g)+"&rssQuery="+encodeURIComponent(f);window.open(b,"SitBack",d);if(window.event){event.cancelBubble=true}return false};if(window.DWait){DWait.run("jms/pages/sitback.js")};
DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){(function(a){a(function(){var b;if(a("body").hasClass("maturehide")&&(b=a("#browse2 .tt-ismature, #browse-results .tt-ismature").length)&&(a("#browse2 .tt-a, #browse-results .tt-a").length==b)){a("#maturehider_explanation").show()}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browsesearch.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/quantcast.js","jms/lib/dtlocal.js","jms/lib/bind.js","jms/pages/ccommentthread.js","jms/lib/glbl.js","jms/lib/analytics.js"],function(){DWait.ready("jms/lib/gmi.js",function(){window.TalkPostWrapper=GMIBase.extend({gmiConstructor:function(){console.log("GMI Constructor");var a;this.talkpost=new TalkPost(this);this.talkpost.node=this.gmi_node;this.talkpost.comment=this.gmi_args;this.reset=bind(this.talkpost,this.talkpost.reset);this.talkpost.hookDrawingUI();$(this.gmi_node).data("TalkPost",this.talkpost);this.textarea=this.gmi_node.getElementsByTagName("textarea")[0];a=this.getCacheName();if(TalkPostWrapper.textCache[a]){this.textarea.value=TalkPostWrapper.textCache[a].shift()||""}this.stdPostHook();if(vms_feature("writer_anywhere")){$(this.gmi_node).addClass("ccexpanded").children(".inputs").hide();DWait.ready(["cssms/lib/writer.css","cssms/pages/stash/stash.override.thumbs.css","cssms/pages/writeranywhere.css","cssms/lib/writer-subtoolbar.css","cssms/lib/canvas_drawing.css","jms/lib/writer/factory.js","jms/lib/writer/sidebar.js"],function(){console.log("WriterAnywhere preloaded")})}else{this.refreshTextareaState();this.textarea.onfocus=bind(this,this.textareaFocus);this.textarea.onblur=bind(this,this.textareaBlur);$(document.documentElement).bind("keydown",this.keypress=bind(this,this.keypress))}},gmiDestructor:function(){var a;$(document.documentElement).unbind("keydown",this.keypress);if(this.textarea){a=this.getCacheName();if(!TalkPostWrapper.textCache[a]){TalkPostWrapper.textCache[a]=[]}TalkPostWrapper.textCache[a].push(this.textarea.value||"")}this.talkpost.localDestroy()},previewClick:function(){this.talkpost.confirmPreview()},sendClick:function(){if(window.event){event.cancelBubble=true}this.talkpost.confirmPost();return false},getCacheName:function(){return[this.gmi_args.typeid||"",this.gmi_args.itemid||"",this.gmi_args.parentid||"",this.gmi_args.time_index||""].join(":")},keypress:function(a){this.tab_pressed=(a.keyCode==9);if(this.textarea_focused&&(a.keyCode==13||a.keyCode==10)&&(((Browser.isMac&&a.metaKey)&&!Browser.isOpera)||a.ctrlKey)){a.target.blur();return this.sendClick()}},setCallback:function(a){this.talkpost.callback=a},hookSend:function(){if(vms_feature("writer_anywhere")){$("input.post[type=submit]",this.talkpost.node).click(function(){return false})}else{var a,b;a=this.talkpost.node.getElementsByTagName("input");a[a.length-1].onclick=bind(this,this.sendClick)}},stdPostHook:function(){this.setCallback(bind(this,this.stdPostHookDone));this.hookSend()},stdPostHookDone:function(d,b){var a,e,c,f;TalkPostWrapper.one_comment_posted=1;if(d!="posted"){return}a=(GMI.up(this.gmi_node)||this).gmiQuery("CCommentThread")[0]||GMI.query("CCommentThread")[0];this.reset(false);a.renderNewComment(b,{fast:true,scroll_to:true});PubSub.publish("PageViewTracker.pageview",{page:"/vpv/difi/commentpost",tag:"Dynamic.Comment"})},refreshTextareaState:function(){var b,a;if(this.textarea_focused||this.writer_focused||this.sidebar_hovered||this.textarea.value||this.mood_hovered||this.talkpost.drawplz_hovered||this.talkpost.commentDrawin||this.talkpost.collection_hovered){if(!this.logged_expand){this.logged_expand=true}$(".show_collections").unbind("mouseover").mouseover(bind(this,this.collectionHover));$(".show_collections").unbind("mouseout").mouseout(bind(this,this.collectionOut));if(!this.moods){this.moods=this.talkpost.renderMoodBox();if(this.moods){this.moods.onmouseover=bind(this,this.moodHover);this.moods.onmouseout=bind(this,this.moodOut)}a=this.gmi_node.getElementsByTagName("a");a=a[a.length-1];if($(a).is(".emoticons")){a.onmouseover=bind(this,this.moodHover);a.onmouseout=bind(this,this.moodOut)}}if(vms_feature("writer_anywhere")||!this.talkpost.commentDrawing){$(this.gmi_node).find(".drawPlz").show()}$(this.gmi_node).addClass("ccexpanded");if(!(document.body.scrollTop||document.documentElement.scrollTop)){if(window.scrollTo){window.scrollTo(0,1)}else{document.body.scrollTop=1}b=Ruler.document.node(this.gmi_node).y2+10-Ruler.screen.rect().y2;if(b>0){if(window.scrollTo){window.scrollTo(0,b)}else{document.body.scrollTop=b}}}}else{if(!vms_feature("writer_anywhere")){this.$.removeClass("ccexpanded").find(".drawPlz").hide()}}},textareaFocus:function(){this.textarea_focused=1;this.refreshTextareaState()},textareaBlur:function(){if(this.writer_focused||this.sidebar_hovered||this.collection_hovered){return}this.textarea_focused=0;this.refreshTextareaState();if(this.tab_pressed&&document.activeElement.className.indexOf("comment-submit")==-1){var a=this.textarea;setTimeout(function(){$(a).closest("form").find(".comment-submit:visible").focus()},100)}},moodHover:function(){this.mood_hovered=1},moodOut:function(){this.mood_hovered=0},collectionHover:function(){this.collection_hovered=1},collectionOut:function(){this.collection_hovered=0}});TalkPostWrapper.textCache={}});window.show_emoticons_modal=function(){var a=$("<div style='width:470px;' />");$("<h2>Emoticons</h2>").appendTo(a);$("<iframe style='width:100%; height:450px; border: none; border-bottom: 1px solid #AAB5AB; -webkit-box-shadow: rgba(255,255,255, 0.75) 0px 1px 0px; -moz-box-shadow: rgba(255, 255, 255, 0.75) 0px 1px 0px;' frameBorder='0' src='http://comments.deviantart.com/emoticons' />").appendTo(a);var b=Modals.factory(a,{cssShadows:true,showCloseButton:true,showButtonsSeparator:false,ignoreinvincible:true});b.addButton("Close","smbutton-lightgreen",function(){Modals.pop("closed");return false});Modals.push(b);return false};$(document).on("click",".show_emoticons_modal",window.show_emoticons_modal);$(document).on("click",".show_collections",function(){Lub.go();da_minish_lub.buttonClicked();return false});window.TalkPost=function(a,e,d,b){var c;DTLocal.infect(this);if(typeof a=="function"){return}this.owner=a;this.current_mode="normal";if(window.TalkPostWrapper&&(a instanceof TalkPostWrapper)){return}if($("div.mczone").first().parents("div#output").is(":visible")){this.node=$(this.template_message_center)[0]}else{this.node=$(this.template)[0]}if(vms_feature("writer_anywhere")){$(this.node).find("textarea").addClass("writeranywhere")}this.comment=e;this.callback=d;DRE.assert(!(b instanceof Array));for(c in (b||{})){this[c]=b[c]}this.on()};TalkPost.prototype={debug_label:"TalkPost",on:function(){console.log("Talkpost On");DRE.assert(this.node);DRE.assert(this.comment);DRE.assert(this.comment.typeid);DRE.assert(this.comment.itemid);$(this.node).data("TalkPost",this);if(Number(this.comment.parentid)){$(this.node).addClass("talk-post-reply")}this.localEventHook($(".cx",this.node)[0],"click",bind(this,this.confirmExit));this.localEventHook($(".cancel",this.node)[0],"click",bind(this,this.confirmCancel));var b=$(".post",this.node);this.localEventHook(b[0],"click",bind(this,this.confirmPost));this.localEventHook($(b).parent()[0],"keypress",bind(this,this.confirmPost));this.localEventHook($(".preview",this.node)[0],"click",bind(this,this.confirmPreview));this.textarea=$("textarea",this.node)[0];this.localEventHook(this.textarea,"keydown",bind(this,this.textareaKeydown));this.localEventHook(this.textarea,"blur",bind(this,this.textareaBlur));this.hookDrawingUI();$(".name",this.node)[0].innerHTML=deviantART.deviant&&deviantART.deviant.username?this.PHP_userlink(deviantART.deviant):"Your Comment";this.current_mode="normal";$(".text",this.node)[0].value=this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]||"";if(!deviantART.deviant||!deviantART.deviant.username){this.node.style.display="none"}var a=$("div.moodbox",this.node)[0];if(a){if(this.hide_moods){a.parentNode.style.display="none"}else{this.renderMoodBox()}}if(vms_feature("writer_anywhere")&&Number(this.comment.parentid)){setTimeout(bind(this,function(){$(document).trigger($.Event("click",{target:$(this.node).find(".writeranywhere")[0]}))}),10)}},off:function(){var a=true;this.drawPlz_hide(a);$(".cancel",this.node).hide();if(this.owner.local){this.owner.localClean(TalkPost)}},localRecv:function(a){if(a=="destroy"){this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=$(".text",this.node)[0].value;if(this.owner.local){if(this.local_tie){this.owner.localClean(this.local_tie)}if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}}}},PHP_userlink:function(b,a){if(typeof b=="object"){a=b.symbol;b=b.username}return a+'<a class="u" href="http://'+b.toLowerCase()+'.deviantart.com/">'+b+"</a>"},template:'<div class="talk-post" keeper="TalkPost"><img class="cx" src="http://st.deviantart.com/minish/messages/neutral-x.gif" alt="x"/><div class="name"></div><div class="h"><div class="previewbox" style="display:none"></div><table class="f"><tr><td class="f"><textarea class="text" tabindex="4"></textarea></td><td class="f rr moodbox-zone"><div class="moodbox"></div></td></tr></table></div><div class="inputs" style="position:relative; text-align: right"><div class="scripted"><a class="smbutton smbutton-big preview" tabindex="6" onclick="return false"><span>Preview</span></a><span style="display: inline-block; width: 10px">&nbsp;</span><a class="smbutton smbutton-'+(vms_feature("writer_anywhere")?"green comment-submit":"blue")+' smbutton-big post" tabindex="5" onclick="return false"><span class="post">'+(vms_feature("writer_anywhere")?"Submit":"Add")+' Comment</span></a></div><div class="unscripted"><input class="post" type="submit" value="Send" tabindex="1"></div><div style="position:absolute;left:0;top:0;font-size:8.25pt">'+(vms_feature("writer_anywhere")?"":'<a class="emoticons show_emoticons_modal" href="http://comments.deviantart.com/emoticons" onclick="return false;" >Emoticons</a><input type="checkbox" id="remove_message_after_reply" value="1" checked style="display: none">')+"</div></div></div>",template_message_center:'<div class="talk-post" keeper="TalkPost"><img class="cx" src="http://st.deviantart.com/minish/messages/neutral-x.gif" alt="x"/><div class="name"></div><div class="h"><div class="previewbox" style="display:none"></div><table class="f"><tr><td class="f"><textarea class="text" tabindex="4"></textarea></td><td class="f rr moodbox-zone"><div class="moodbox"></div></td></tr></table></div><div class="inputs" style="position:relative; text-align: right"><div class="scripted"><a class="smbutton smbutton-big preview" tabindex="6" onclick="return false"><span>Preview</span></a><span style="display: inline-block; width: 10px">&nbsp;</span><a class="smbutton smbutton-blue smbutton-big" tabindex="5" onclick="return false"><span class="post">Add Comment</span></a></div><div class="unscripted"><input class="post" type="submit" value="Send" tabindex="1"></div><div style="position:absolute;left:0;top:0;font-size:8.25pt;text-align:left"><a class="emoticons show_emoticons_modal" href="http://comments.deviantart.com/emoticons" onclick="return false;" >Emoticons</a><br><input type="checkbox" id="remove_message_after_reply" value="1" checked><label for="remove_message_after_reply">Remove this message after I reply</label></div></div></div>',nodeMap:{files:{get:function(){return $("div.talk-files",this.node)[0]}}},renderMoodBox:function(){DWait.ready("jms/lib/pager.js.mood.js",bind(this,this.renderMoodBox2));return $(".moodbox",this.node)[0]},renderMoodBox2:function(){var c,d,a,b;if(vms_feature("writer_anywhere")){c=null;$(".f.rr",this.node).remove()}else{c=$(".moodbox",this.node)[0]}if(!c){return false}DRE.assert(c.childNodes.length==0,"First post!");b=this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))];a=Pager.create({more_links:true,rootri:"mood",theme:this.pager_theme||($(document.body).hasClass("deviant")?"deviant":"light"),selection:b,class_name:"pager2 talk-pager",icon_base_url:"http://e.deviantart.com/emoticons/moods/",callback:bind(this,function(f,e){var g;this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=f;this.mood=f.split("/").pop();if(g=$("input.mood")[0]){g.value=this.mood}if(f){this.focus()}return false})});c.appendChild(a.node);Pager.loadPage(a,b?b.split("/").reverse().slice(1).reverse().join("/")||"mood":"mood");if(b){this.mood=b.split("/").pop()}DiFi.timer(10);this.pager=a;return c},getText:function(){return $("textarea.text",this.node).val()},getTextToSave:function(){var b=this.getText();if(!$("textarea.text",this.node).attr("writer")){return b}var a=document.createElement("div");a.innerHTML=b;if(a.innerHTML.length<b.length){return b}$(a).find("span > .embedded-devation, span > .shadow-holder").not(function(){return $(this).siblings().length}).unwrap();return a.innerHTML},setPreviewText:function(a){$(".previewbox",this.node).html('<strong style="cursor:pointer">Preview <img src="http://st.deviantart.com/minish/messages/neutral-x.gif" style="position:relative;top:2px"></strong><br/><br/>'+a+"</div>");$(".previewbox strong",this.node).on("click",bind(this,function(){this.goMode("normal")}))},focus:function(){if(this.current_mode=="normal"){$(".text",this.node)[0].focus()}},textareaKeydown:function(a){this.tab_pressed=(a.keyCode==9)},textareaBlur:function(){if(this.tab_pressed&&document.activeElement.className.indexOf("post")==-1){var a=this.textarea;setTimeout(function(){$(a).closest(".talk-post").find(".post:visible").parent().focus()},100)}},current_mode:null,goMode:function(d,a){if(d==this.current_mode){return}var c=$(this.node),b=this.current_mode;this.current_mode=d;switch(d){case"busy":case"muro_saving":c.find(".text, .preview, .post").attr("disabled","disabled");c.find(".preview, .post").addClass("disabledbutton");break;case"normal":c.find(".text, .preview, .post").removeAttr("disabled");c.find(".preview span, span.preview").val("Preview").html("Preview");c.find(".preview, .post").removeClass("disabledbutton");c.find(".previewbox").hide();c.find(".text").css("visibility","visible");if(a!==false){c.find(".text").focus()}break;case"preview":c.find(".preview span, span.preview").val("Preview Off").html("Preview Off").removeAttr("disabled");c.find(".preview, .post").removeAttr("disabled").removeClass("disabledbutton");c.find(".previewbox").css({visibility:"hidden",display:"block"});if(vms_feature("writer_anywhere")){c.find(".previewbox").addClass("ccwriter-preview").css({height:c.find(".writer").outerHeight(),width:c.find(".writer").outerWidth()})}else{c.find(".previewbox").css({height:c.find(".text").outerHeight(),width:c.find(".text").outerWidth()})}c.find(".text").css("visibility","hidden");c.find(".previewbox").css("visibility","visible");break;case"fail":DiFi.stdErr(null,this.last_fail_reason);this.goMode("normal");break}},showCancel:function(){$(".cancel",this.node).show()},confirmCancel:function(b){$(".cancel",this.node).hide();if(vms_feature("writer_anywhere")){var a=$(this.node).find(":gmi(WriterAnywhere)");if(a.length){a.gmi()[0].collapseWriterUI()}}return false},confirmExit:function(b){if(this.commentDrawing&&!confirm("If you do this, you will lose your current drawing.\nAre you sure?")){return false}if(this.callback){this.callback("closed")}if(vms_feature("writer_anywhere")){var a=$(this.node).find(":gmi(WriterAnywhere)");if(a.length){a.gmi()[0].closeWriterUI(bind(this,function(){this.off()}),true)}else{this.off()}}else{this.off()}return false},confirmPost:function(f){try{if(!this.commentDrawing&&mgr&&mgr.canvasDrawing){this.commentDrawing=mgr.canvasDrawing}}catch(f){}if(window.event){event.cancelBubble=true}if(this.current_mode=="busy"){return}if(f!==undefined&&f.type==="keypress"&&f.keyCode!==13){return}var d,c,b,a;if(this.getText().search(/[^\s]/g)==-1&&!this.commentDrawing){this.focus();return false}if(this.drawplz_saving>0){if(this.current_mode=="muro_saving"){return}this.goMode("muro_saving");var h=setInterval(bind(this,function(){if(this.drawplz_saving>0){return}this.confirmPost();clearInterval(h)}),100);return}this.goMode("busy");d=0;c=0;if(this.exo_files){if(this.exo_files[0]&&this.exo_files[0].file){d=this.exo_files[0].file.deckId}if(this.exo_files[1]&&this.exo_files[1].file){c=this.exo_files[1].file.deckId}}else{if($(".talk-files",this.node)[0]){b=$(".talk-files a",this.node);DRE.assert(b.length==2);d=Number(b[0].getAttribute("attachdeckid")||0);c=Number(b[1].getAttribute("attachdeckid")||0)}}if(this.comment.time_index||d||c){DiFi.pushPost("Comments","filmPost",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0,this.comment.time_index||0],this.posted,this)}else{a=GMI.up(this.node,"CCommentThread");if(a&&a.rcpStallQueue){a.rcpStallQueue(true)}if(this.commentDrawing){var g;if(g=this.getCommentImage()){DiFi.pushPost("DrawPlz","post_comment",[this.getTextToSave(),g,this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0],this.posted,this);DiFi.send();return}}if(deviantART.pageData.messages){DiFi.pushPost("Comments","post_from_messagecenter",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0,$("#remove_message_after_reply").attr("checked")?1:0],this.posted,this)}else{if(this.comment.typeid==61&&Glbl("Site.is_stash")){PubSub.publish("Minibrowse.uncache",deviantART.pageData.privateid)}DiFi.pushPost("Comments","post",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0],this.posted,this)}}DiFi.send()},confirmPreview:function(){if(window.event){event.cancelBubble=true}if(vms_feature("writer_anywhere")){$(this.node).find(".commentwriter-toolbar .commentwriter-preview").toggleClass("active")}if(this.current_mode=="preview"){this.goMode("normal");return}this.setPreviewText("Loading preview");previewHasThumbs=0;if(vms_feature("writer_anywhere")||this.comment.typeid==18||this.comment.typeid==39){previewHasThumbs=1}DiFi.pushPost("Comments","preview",[this.getText(),previewHasThumbs],this.preview,this);DiFi.send();this.goMode("preview")},preview:function(b,a){if(!b){if(this.current_mode=="preview"){this.goMode("normal");this.setPreviewText("")}return}this.setPreviewText(a.response.content)},posted:function(j,d,a){var h,i,g,c,k,b;threadGMI=$(this.node).parents(":gmi(CCommentThread)");if(threadGMI.length){thread=threadGMI.gmi1();if(thread&&thread.rcpStallQueue){if(j){thread.recently_rendered[d.response.content.commentid]=1}thread.rcpStallQueue(false)}}if(!j){this.last_fail_reason=(typeof(d.response.content||{}).error)=="string"?d.response.content.error:"There was an error while posting the comment.\n\nPlease try again soon.";this.goMode(a?"normal":"fail");return}h=d.response.content;i={commentid:h.id,parentid:this.comment.parentid,typeid:this.comment.typeid,itemid:this.comment.itemid,username:deviantART.deviant.username,symbol:deviantART.deviant.symbol,usericon:deviantART.deviant.usericon,ts:Math.floor((new Date).valueOf()/1000),attributes:(d.request.args[5]<<16)|(d.request.args[4]<<3),depth:undefined,text:h.body,signature:null,files:h.files,html:h.html};try{HALT()}catch(f){}this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=null;this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=null;$(".text",this.node)[0].value="";if(this.callback){this.callback("posted",i)}if(vms_feature("writer_anywhere")){$(this.node).find(":gmi(WriterAnywhere)").gmi()[0].closeWriterUI(bind(this,function(){if(this.owner){this.off()}}))}else{if(this.owner){this.off()}}},reset:function(b){var a,d,c;this.goMode("normal",b);this.node.getElementsByTagName("textarea")[0].value="";if(this.owner){this.owner.textarea_focused=0;this.owner.refreshTextareaState()}if(this.pager){Pager.select(this.pager,"");Pager.loadPage(this.pager,"mood")}if(this.exo_files){for(c=0;c!=this.exo_files.length;c++){if(this.exo_files[c]&&this.exo_files[c].file){this.exo_files[c].deckNuke()}}}},browserSupportsCommentDrawings:function(){return(!Browser.isIE55)&&(!Browser.isIE6)&&(!Browser.isIE7)&&(!Browser.isIE8)},hookDrawingUI:function(){var c=this.comment.allowdrawings&&this.browserSupportsCommentDrawings();if(!c){return}var b='<div class="drawPlz"><div class="topbar hh">'+(c?'<a href="#showDrawPlz" class="showDrawPlz">Add a Drawing</a>':"")+"</div></div>";var e=jQuery("textarea",this.node);var a=(" "+this.node.className+" ").indexOf(" talk-post-reply ")!=-1;if(a){b='<tr><td colspan="2">'+b+"</td></tr>";e.closest("tr").after(jQuery(b))}else{jQuery(".cctextarea",this.node).append(jQuery(b))}$(this.node).on("click",".editDrawing",this.drawPlz_edit.bindTo(this));$(this.node).on("click",".hideDrawPlz, .hideDrawing",this.drawPlz_hide.bindTo(this));this.drawplz_saving=this.drawplz_saving||0;$(".showDrawPlz",this.node);var d=$(".showDrawPlz",this.node)[0];this.localEventHook(d,"click",this.drawPlz_show.bindTo(this));this.localEventHook(d,"mouseover",this.drawPlz_mouseover.bindTo(this));this.localEventHook(d,"mouseout",this.drawPlz_mouseout.bindTo(this))},drawPlz_show:function(j){j.preventDefault();var d=450;var h=340;var b=$(this.node);if(vms_feature("writer_anywhere")){var a=b.find(".writeranywhere");if(a){a.click()}var f=b.find(":gmi(WriterAnywhere)").gmi1().writer;if(!f){return}var c,k,g;var i=this;f.frame("http://sta.sh/muro/iframe?width="+d+"&height="+h+"&background=clear",function(m,n){var l="remove";switch(m.action){case"error":if(n.hidden){n.act("show")}return;case"cancel":return"remove";case"got_id":k=m.id&&parseInt(m.id,36);return;case"done":g=m.img||g;i.drawplz_saving++;l="hide";break;case"save":k=m.privateid||m.id||k;g=m.img||g;i.drawplz_saving--;break;case"ready":return"show";default:return}if(k&&g&&!c){var e=$("<img>",{src:g,"class":"writer-embed writer-deviation-image writer-deviation-redraw",embedid:k,embedtype:"deviation",embedformat:"image"});f.insert(e);WriterEmbed.runLoaders(f.$node);c=true}return l});return}b.find(".drawPlz").hide();stdLog("MainNode: ",b.get(0));DiFi.pushPost("DrawPlz","inline_html",[],function(o,n){if(n.response.status!="SUCCESS"){return}var l=n.response.content.htmlContent;var m=this.node.className.indexOf("talk-post-reply")!=-1;if(m){var e=b.find("tr").get(0);stdLog("firstTR: ",e);$(e).after('<tr><td colspan="2">'+l+"</td></tr>")}else{if(vms_feature("writer_anywhere")){b.find(".cc-without-moods").append(l)}else{b.find(".cc-with-moods").append(l)}}if(Browser.isIE){b.find("canvas").each(function(){var s={};el=this;var r=["class","style","width","height"];for(var p in r){var q=el.getAttribute(r[p]);if(q){s[r[p]]=q}}var u=$(el).parent().get(0);$(el).remove();var t=document.createElement("canvas");for(var p in s){t.setAttribute(p,s[p])}u.appendChild(t)})}DWait.ready(["jms/lib/localStorage.js","jms/pages/drawplz/managers.js"],function(){window.manager=new Managers(b.find(".drawPlzContainer").get(0),d,h);this.commentDrawing=manager.canvasDrawing}.bindTo(this))}.bindTo(this));DiFi.send()},drawPlz_updateImage:function(e,b){this.commentDrawing=e;var a=$(this.node);var c=b;var d=a.hasClass("talk-post-reply");if(d){a.find(".drawPlzComment").parents("tr").remove();a.find("tr").eq(0).after('<tr><td colspan="2">'+c+"</td></tr>")}else{a.find(".drawPlzComment").remove();a.find(".cc-with-moods .cctextarea").append(c)}},drawPlz_edit:function(){},drawPlz_hide:function(b){this.drawplz_hovered=0;if(this.commentDrawing){if(b!=true&&!confirm("If you do this, you will lose your current drawing.\nAre you sure?")){return}var a=$(this.node);a.find(".hideDrawPlz, .info").hide().eq(0).parent().find(".showDrawPlz").show();a.find(".drawPlz").show();a.find(".drawPlzContainer, .drawPlzComment").remove();this.commentDrawing=null}},getCommentImage:function(){if(this.commentDrawing&&this.commentDrawing.hasUnsavedWork()){return this.commentDrawing.getSaveData()}return false},drawPlz_mouseover:function(){this.drawplz_hovered=1},drawPlz_mouseout:function(){this.drawplz_hovered=0}};if(vms_feature("writer_anywhere")){$(":gmi(TalkPostWrapper)").gmiWake()}if(window.DWait){DWait.run("jms/pages/talkpost.js")}});
DWait.ready(["jms/lib/bind.js","jms/lib/gwebpage.js","jms/lib/popup2.js",".jquery"],function(){(function(a){window.GiveMenu={show:function(b,c){popup=new Popup2("GiveMenu","body",{classes:"givemenu",content:'<div class="pager2"><div class="blockmenu"><div class="loading">Loading</div></div></div>',destroy:true});popup.show(popup.position(a(b),{align:"right",bump:{left:15}}));DiFi.pushPublicGet("User","getGiveMenu",[c],bind(this,this.difiCallback,b,popup));DiFi.send()},difiCallback:function(d,c,h,f,b){if(!h||!f.response.content.html){return b?null:DiFi.stdErr("Failed to load give menu",f.response.content)}gWebPage.update(f.response.content);var g=a(f.response.content.html);var e=this;g.find("a.morelink").click(function(i){g.find(a(this).attr("rel")).show();a(this).remove();e.heightCalc(c)});setTimeout(bind(this,this.actualDisplay,g,d,c),50)},actualDisplay:function(d,c,b){b.$node.html(d.show());this.heightCalc(b)},heightCalc:function(b){b.$node.height(b.$node.find("div.blockmenu").height()+(a.browser.msie?4:0))}};a(document).on("click","[givemenu]",function(b){b.preventDefault();b.stopPropagation();GiveMenu.show(this,a(this).attr("givemenu"))})})(jQuery);if(window.DWait){DWait.run("jms/pages/givemenu.js")}});
DWait.ready(["jms/lib/gmi.js"],function(){window.CCommentThread=CCommentThread=(window.GMIHub||GMIBase).extend({gmiConstructor:function(){},DR_SEL:"span.drawplz.closed",HT_SEL:"span.thumb-attachment.closed",B_SEL:"div.drawplz-attachment-ctrl",recently_rendered:{},toggleAttachmentButton:function(){if(this.$.parent().find(this.DR_SEL).length||this.$.parent().find(this.HT_SEL).length){this.$.parent().find(this.B_SEL).show().find(".gmbutton2").click(bind(this,this.clickAttachmentButton))}},clickAttachmentButton:function(a){this.$.parent().find(this.B_SEL).hide();this.$.parent().find(this.DR_SEL).removeClass("closed").unbind("click").removeClass("dwait");this.$.parent().find(this.HT_SEL).each(function(){$(this).removeClass("closed").unbind("click").removeClass("dwait").next(".shadow-holder, .embedded-deviation").show()});return false},hubRecv:function(a){switch(a.cmd){case"new":if(a.commentid in this.recently_rendered){return}this.renderNewComment(a,{});break}},renderNewComment:function(f,c){var h,e,a,g;console.log("renderNewComment",f,c);this.recently_rendered[f.commentid]=1;if(this.gmi_node.firstChild&&(this.gmi_node.firstChild.className||"").indexOf("expendable")>=0){this.gmi_node.innerHTML=""}g=Number(f.parentid);var b=[];if(g&&g!=this.gmi_args.rootid){$.each(this.gmiQuery("CComment",{match:{commentid:f.parentid}}),function(i,j){h=j.gmi_node;if(h){if($(h.nextSibling).hasClass("nest")){h=h.nextSibling}else{h=$('<div class="nest"></div>').insertAfter(h)[0]}}b.push(h)})}else{$.each(GMI.query("CCommentThread"),function(i,j){if(f.itemid==j.gmi_args.itemid&&f.typeid==j.gmi_args.typeid){h=j.gmi_node;b.push(h)}})}if(b.length){var d=this;$.each(b,function(i,j){$(f.html).hide()[Number(d.gmi_args.order)==2?"prependTo":"appendTo"](j).fadeIn(400)})}else{console.log("Skipped comment rendering; parent is out of view")}if(e&&c.scroll_to){a=Ruler.document.node(e).y-30;if(window.scrollTo){window.scrollTo(0,a)}else{document.body.scrollTop=a}}return e}});window.CCommentMaster=CCommentMaster=GMIBase.extend({gmiConstructor:function(){}});if(window.DWait){DWait.run("jms/pages/ccommentthread.js")}});
DWait.ready(["jms/lib/gmi.js","jms/lib/dtlocal.js","jms/lib/popup2.js","jms/pages/ccommentthread.js","jms/lib/analytics.js"],function(){window.CComment=CComment=GMIBase.extend({gmiConstructor:function(){DTLocal.infect(this);this.permahidden=this.gmi_args.permahidden;this.$.find("span.drawplz.closed").click(this.specialAttachmentClick);this.$.find("span.thumb-attachment.closed").click(this.thumbAttachmentClick);this.$.find("span.thumb-attachment.closed").each(function(){$(this).show().next(".shadow-holder, .embedded-deviation").hide()})},gmiDestructor:function(){this.localDestroy()},replyClick:function(){var d,b,c;if(window.event){event.cancelBubble=true}if(this.local.talkpost){this.local.talkpost.focus();return false}this.local.talkpostnode=d=document.createElement("div");d.className="nest";d.innerHTML=('<div class="ccomment ccomment-post ch"><i class="tl c"><i></i><b></b></i><i class="tr c"><i></i><b></b></i><i class="bl c"><i></i><b></b></i><i class="br c"><i></i><b></b></i><div class="ch-ctrl"><br/></div></div>');this.local.talkpost=b=new TalkPost(this,{typeid:this.gmi_args.typeid||-1,itemid:this.gmi_args.itemid||-1,parentid:this.gmi_args.commentid,allowdrawings:this.gmi_args.allowdrawings},bind(this,this.replyCallback),{pager_theme:"light",show_icon:true,hide_moods:this.gmi_args.hidemoods});b.local_tie="talkpostnode";c=d.getElementsByTagName("br")[0];b.node.style.display="block";c.parentNode.replaceChild(b.node,c);this.gmi_node.className+=" ccomment-activereply";if(this.gmi_node.nextSibling){this.gmi_node.parentNode.insertBefore(d,this.gmi_node.nextSibling)}else{this.gmi_node.parentNode.appendChild(d)}b.focus();if(!this.logged_expand){this.logged_expand=true}return false},replyCallback:function(d,c){if(!this.local.talkpost){return}switch(d){case"posted":var e;if(this.callback_post){this.callback_post(c)}this.local.talkpost.local_tie=null;this.localClean(TalkPost);this.local.talkpostnode.parentNode.removeChild(this.local.talkpostnode);var b=this.gmiUp("CCommentThread");if(!b){b=GMI.query("CCommentThread")[0]}console.log("ccommentthread",b);if(b&&!b.renderNewComment(c,{fast:true,scroll_to:true})){}this.local.talkpostnode=null;PubSub.publish("PageViewTracker.pageview",{page:"/vpv/difi/commentpost",tag:"Dynamic.Comment"});case"closed":this.gmi_node.className=this.gmi_node.className.replace(/\bactivereply\b/g,"");break}},unhideClick:function(){if(this.permahidden){this.setHideState(false)}else{this.difi("unhide","displaying this comment")}if(window.event){event.cancelBubble=true}return false},hideClick:function(){if(this.permahidden){this.setHideState(true)}else{this.difi("hide","hiding this comment")}},reportClick:function(){if(this.permahidden){alert("This comment has already been reported.")}else{if(!this.loading&&confirm("Report this comment as spam?")){this.difi("reportSpam","reporting this comment as spam")}}},doPopup:function(c){var d="<div class='blockmenu'><div style='position:relative'><a class='f' href='#' onclick='GMI.up(this).hideClick();Popup2.hideAll(); return GMI.evCancel();'>Hide Comment</a>";if(c===false){d+="<a href='#' class='f' onclick='GMI.up(this).reportClick();Popup2.hideAll(); return GMI.evCancel();'>Report Spam</a><a class='f' href='#' onclick='GMI.up(this).blockClick();Popup2.hideAll();return GMI.evCancel();'>Block User</a>"}d+="</div></div>";var b=$(this.gmi_node).find(".gm-chaos");CComment.popup=new Popup2("GroupListManage","body",{classes:"ccomment-manage",content:d,destroy:true,created:function(e){e.$node.attr("gmi-redirect",this.gmi_node.getAttribute("gmindex"))}.bindTo(this),hidden:function(){b.find(".gmbutton2").removeClass("active")},shown:function(){b.find(".gmbutton2").addClass("active")}});CComment.popup.show(CComment.popup.position(b,{align:"right"}));return false},blockClick:function(){a=$("a.u",this.gmi_node)[0];author=a.firstChild.nodeValue;if(confirm("Add "+author+" to your blocked users list?")){DiFi.pushPost("User","block",[author],function(c,b){if(c){alert(author+" has been added to your list of blocked users.")}else{if(b.response.content.error){alert(b.response.content.error)}else{alert("deviantART was unable to add "+author+" to your blocked users list.")}}});DiFi.send()}},specialAttachmentClick:function(){$(this).removeClass("closed").unbind("click").removeClass("dwait")},thumbAttachmentClick:function(){$(this).closest(".ccomment").find(".thumb-attachment.closed").each(function(){$(this).removeClass("closed").unbind("click").removeClass("dwait").next(".shadow-holder, .embedded-deviation").show()})},difi:function(c,b){var b;if(this.loading){return}this.loading=true;this.gmi_node.className+=" ccomment-loading";DiFi.pushPost("CommentAttributes",c,[this.gmi_args.commentid,this.gmi_args.itemid,this.gmi_args.typeid],bind(this,this.difiDone,b));DiFi.timer(1)},difiDone:function(c,g,f){this.gmi_node.className=this.gmi_node.className.replace(/\bccomment.loading\b/g,"");this.loading=false;if(!g){alert("There was an error while "+c+".\n\nPlease try again soon.");return}switch(f.request.method){case"reportSpam":this.permahidden=true;if(!CComment.SPAM_REPORT_DONE){var b,d,e;CComment.SPAM_REPORT_DONE=true;b=$("a.u",this.gmi_node)[0];d=b.firstChild.nodeValue;e=b.previousSibling.nodeValue;if(f.response.content.can_report_all&&d&&(confirm("Would you also like to scan for comments by "+e+d+" on your user page, deviations, journals, etc.?"))){DiFi.pushPost("CommentAttributes","removeSpamOnUser",[d],function(i,h){if(i){alert("The process of removing spam from your user page, deviations, journals, etc., has started.\nYou will be notified with a note once this is complete.")}else{alert("deviantART was unable to start the process of removing all spam by this user.\nWe appreciate your effort, and ask you to please try again shortly.")}});DiFi.timer(1)}else{alert("Thank you for your report.")}}case"hide":this.makeUnhideLink();this.setHideState(true);break;case"unhide":this.setHideState(false);break}},makeUnhideLink:function(){var b,c;b=(this.gmi_node.getElementsByTagName("a")||[])[0];if(!b||b.className!="creason"){b=document.createElement("a");b.onclick=bind(this,this.unhideClick);b.href="#";b.className="creason";c=this.gmi_node.getElementsByTagName("div")[0];c.insertBefore(b,c.firstChild)}b.innerHTML="<span>"+(this.permahidden?"Flagged as Spam":"Hidden by Owner")+"</span><em>"+(this.permahidden?"Peek":"Undo Hide")+"</em>"},setHideState:function(b){if(b){this.gmi_node.className+=" ccomment-hidden"}else{this.gmi_node.className=this.gmi_node.className.replace(/\bccomment.hidden\b/g,"")}}});if(vms_feature("writer_anywhere")){$(":gmi(CComment) .thumb-attachment.closed").each(function(){$(this).gmiUp()})}if(window.DWait){DWait.run("jms/pages/ccomment.js")}});
window.TabledResourceStream=ResourceStream.extend({domFindVisible:function(){var a,b,f,e;b={};e=0;var d=$(this.gmi_node).find(".tt-a, .rs-customicon-cont, .gl-text");for(a=0;f=d[a];a++){if(!f.getAttribute("rs_ignore")){b[(e++)+this.gs_offset]=f}}return b},dataFetch:function(){},gmiConstructor:function(){this.preview_override_selection_type=TabledResourceStreamSimpleSelection;this.base()},get_stream_node_from_clicked_node:function(a){return $(a).closest(".tt-a").get(0)}});window.TabledResourceStreamSimpleSelection=window.ResourceStreamSimpleSelection.extend({getAllSelectable:function(){return $(".tt-a",this.root).toArray()},isSelectable:function(a){return $(a).hasClass("tt-a")}});if(window.DWait){DWait.run("jms/lib/gstream/tabled_resource_stream.js")};
DWait.ready(["jms/lib/Base.js","jms/legacy/modals.js","cssms/modals/signup-modal.css"],function(){SignupBase=Base.extend({constructor:function(){$(window).bind("message",function(a){if(a.originalEvent.origin==="http://verify.deviantart.com"){Modals.pop("finished")}})},modalUp:false,dificalls:[],modal:function(a,d,g){var h,f,c="475";if(g){f=g}else{var e=location.hostname.split(".")[0];if(window.location.hostname.match(/sta.sh$/)){f="https://sta.sh/login/oauth/modal";c="550"}else{if(((window.deviantART||{}).deviant||{}).id){f="http://verify.deviantart.com/?from=Modal&subdomain="+e+"&referrer="+encodeURIComponent(location.href)}else{f="https://www.deviantart.com/join/?joinview=Modal&joinpoint="+encodeURIComponent(d.request["class"])+"&subdomain="+e}}}h=$('<div class="secure"><div class="join-modal-title"><h3>Sign Up<span> or Log In</span></h3></div><div class="join-modal-contents" style="height:'+c+'px;"><div id="loading_iframe"><img src="http://s.deviantart.com/emoticons/e/eager.gif" />Loading&hellip;</div><iframe scrolling="no" allowtransparency="true"  src="'+f+"\" frameBorder=\"0\" onload=\"$(this).show().closest('.secure').addClass('loaded').parent().width($(this).closest('.secure').width()).height($(this).closest('.secure').height()); $('#loading_iframe').hide();\"></iframe></div></div>")[0];Modals.lightfade=true;this.dificalls.push([a,d]);if(!this.modalUp){var b=Modals.factory(h);Modals.push(b,bind(this,this.done),"join-modal")}this.modalUp=true},done:function(f){if(f){gWebPage.update(f)}this.modalUp=false;var b,a,e,c=false;while(b=this.dificalls.pop()){a=b[0];e=b[1];if(f&&f.result=="finished"&&e){c=true;DiFi.pushPost(e.request["class"],e.request.method,e.request.args,a[0][0],a[1][0])}else{a[0][0].call(a[1][0],f&&f.result=="finished",e,true)}}if(c){var d=window.location.hostname.match(/sta.sh$/)?"Stash":"DAWebpageHeader";DiFi.pushPrivateGet(d,"getHeaderHTML",[],this.headerRefresh);DiFi.send()}},headerRefresh:function(b,a){if(b){$("#overhead-sc").fadeOut(function(){gWebPage.update(a.response.content);$(this).html(a.response.content.html);PubSub.publish("Signup.headerRefresh");$(this).fadeIn()});$("#overhead tr").fadeOut(function(){gWebPage.update(a.response.content);$(this).html(a.response.content.html);PubSub.publish("Signup.headerRefresh");$(this).fadeIn()})}else{console.log("Err",a.response.content)}}});window.Signup=new SignupBase();if(window.DWait){DWait.run("jms/pages/signup.js")}});
DiFi.errorHooks.push(function(c,b,a){if(!c&&b.response.content&&b.response.content.error=="DiFi Security Access Error"&&b.response.content.details.privs&&((((b.response.content.details.privs[0]||[])[2]||[])[0]==PRIV_LOGGEDIN)||(((b.response.content.details.privs[0]||[])[2]||[])[0]==PRIV_VERIFIED))&&window.Signup&&!window.location.hostname.match("dreamup")){Signup.modal(a,b);return true}});if(window.DWait){DWait.run("jms/pages/difi_errorhook_signup.js")};
(function(a){a(".gmbutton2searchcancel").each(function(){var c=a(this);var d=c.parent().find("input.gmbutton2");c.click(function(){d.val("");d.change();c.parents("form").submit()});var b=function(){if(d.val()){c.addClass("show")}else{c.removeClass("show")}};d.change(b);d.keyup(b);d.change()})})(jQuery);if(window.DWait){DWait.run("jms/chrome/searchcancel.js")};
DWait.ready([".jquery",".domready"],function(){var a=window.location.href.substring(window.location.href.indexOf("?")+1);$("a.expand").each(function(){var b=$(this).attr("href");if(b.substring(0,9)!="#_expand_"){return}var d=b.substring(9);var c=$("div[skinscript=expandable_"+d+"]");if(!c.length){return}c.hide();$(this).click(function(){c.toggle();return false});if(a==$(this).attr("href").substring(1)||a.match("_expand_all")){$(this).click()}});if(window.DWait){DWait.run("jms/pages/catskin-expander.js")}});
(function(b){if(vms_feature("writer_anywhere")){b(document).on("click.writeranywhere",function(g){var h=g.target||g.srcElement;do{if(h.className&&h.className.indexOf("writeranywhere")!==-1){var f=b(h);if(!f.is("textarea")){f=f.siblings("textarea")}f.wrap(b("<div>",{"data-gmiclass":"WriterAnywhere"}));f.gmiWake();g.cancelBubble=true;return false}}while(h=h.parentNode)});var c=function(){var e='<a class="showMedia" href="#showMedia">Add Media</a>';var f='<div class="drawPlz"><div class="topbar hh">'+e+"</div></div>";b("textarea.writeranywhere").each(function(h,j){var g=b(j);if(j.className.indexOf("butan")!=-1){return}g.addClass("butan");if(!Glbl("Site.is_stash")){var k=g.parent().parent();if(k.hasClass("cctextarea")||k.children("td.f").length){if(k.children("td.f").length){k=k.parents("table");if(k.find(".drawPlz").length){k.find(".topbar").prepend(e)}else{k.find("td.f").append(f)}}else{if(k.find(".drawPlz").length){k.find(".topbar").prepend(e)}else{k.append(f)}}}else{g.after(f)}b("a.showMedia",k).off("click.writeranywhere").on("click.writeranywhere",function(){var i=b(this);do{i=i.parent()}while(!i.find("textarea.writeranywhere, div.ccwriter-wrapper").length);i.find("textarea.writeranywhere").addClass("expandplz").click();return false})}if(g.val().length){g.hide().after(b('<div class="writeranywhere commentwriter-underlay">').html(g.val()))}})};DWait.ready(".domready",function(){c();if(document.addEventListener){b("body")[0].addEventListener("DOMNodeInserted",c,false)}else{b(document).on("readystatechange.ccw, propertychange.ccw",c)}})}var a=null;var d=function(h){h=h||false;var e=b.Deferred();var g=b(":gmi(WriterAnywhere)");var j=g.length;if(h||!j){e.resolve()}else{var i=b.Deferred();var f=0;i.done(bind(this,function(){e.resolve()}));g.each(function(){var k=b(this).gmi1();if(k!=-1&&k.ccwriter_inited){var l=k.closeWriterUI();l.done(function(){f++;if(f==j){i.resolve()}})}else{f++;if(f==j){i.resolve()}}})}return e};window.WriterAnywhere=GMIBase.extend({writer:null,writer_focused:0,sidebar_hovered:0,sidebar_clicked:0,TRIGGER_HEIGHT:64,TOP_OFFSET:0,BOTTOM_OFFSET:0,EXPANSION_EVENTS:"keypress.ccwriter paste.ccwriter",ccwriter:0,ccwriter_deviation:0,ccwriter_toplevel:0,ccwriter_expanded:0,ccwriter_wide:0,ccwriter_scrolloffset:null,ccwriter_inited:0,drawplz:0,gmiConstructor:function(){this.$.removeClass("dwait");this.ccwriter=this.$.parents(":gmi(CCommentThread), :gmi(TalkPostWrapper), .ccomment-post").length;this.ccwriter_deviation=Glbl("Site.is_stash")?deviantART.pageData.deviationid:(window.da_preview_master&&typeof window.da_preview_master.current_stream!="undefined");this.ccwriter_toplevel=this.$.parents(":gmi(TalkPostWrapper)").length;var e=d();e.done(this.hookWriterUI.bindTo(this))},hookWriterUI:function(){if(!this.writer){DWait.ready(["cssms/lib/writer.css","cssms/pages/stash/stash.override.thumbs.css","cssms/pages/stash/stash.header.css","cssms/lib/writer-subtoolbar.css","cssms/lib/canvas_drawing.css","jms/lib/writer/factory.js","jms/lib/writer/sidebar.js"],bind(this,function(){var g=b(".commentwriter-toolbar");var i=b(".commentwriter-sidebar");var f=b("<div>");this.$writer_ui=g.add(i).add(f).click(bind(this,function(){this.sidebar_clicked=1})).mouseenter(bind(this,function(){this.sidebar_hovered=1})).mouseleave(bind(this,function(){this.sidebar_hovered=0;this.writer.sync()}));b(this.$writer_ui[2]).find(".commentwriter-drawing").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(l){var k=this.$.parents(":gmi(TalkPostWrapper)").gmi1().talkpost;k.drawPlz_show.call(k,l)}));if(this.ccwriter){b(this.$.parents(":gmi(TalkPostWrapper)").gmi1().gmi_node).children(".inputs").show()}this.$.find("textarea").show().wrap('<div class="ccwriter-content"></div>');this.$.siblings(".commentwriter-underlay").remove();this.$writer_ui.hide();this.writer=WriterFactory.toggle(this.$.find("textarea"),{storage:"NoSaveStorage",imagecontrol_attach_point:".ccwriter-content",valid_tags:["br","hr","strong","small","b","code","sub","sup","tt","acronym","a","abbr","strike","em","i","u","ins","span","div","blockquote","p","bcode","ul","li","ol"],toolbars:[{toolbar_name:"writersub",toolbar_node:b(".commentwriter-toolbar-inner")[0],toolbar_button_class:"subToolbarButton",toolbar_menu_class:"subToolbarMenu",toolbar_popup_class:"stashwriter-subtoolbar-menu stashwriter-subtoolbar-menu",toolbar_order:["undo","redo","separator","bold","italic","underline","separator","ul","ol","blockquote"]}]},{separate_ident:true});var h=this;var e=this.ccwriter_toplevel?114:120;var j=this.$.parent().siblings(".drawPlz");if(j.length){this.BOTTOM_OFFSET=j.outerHeight()}this.sidebar=new WriterSidebar(i,bind(h,function(l,k){this.writer.insert_thumb(l,true)}),{initial_selection:this.ccwriter?"conversation":"stash",upload_thumb:true,height_drop:this.TOP_OFFSET+27+46+45,sections:["gallery","faves","friends","search",this.ccwriter?"conversation":"","stash","art","emotes"]});this.writer.$node.focus(bind(this,function(){this.writer_focused=1;b(this.$writer_ui[0]).addClass("open");if(this.ccwriter_inited&&Glbl("Site.is_stash")&&!this.ccwriter_expanded){this.expandWriterUI()}}));this.writer.$node.blur(bind(this,function(k){this.writer_focused=0;this.writer.sync();setTimeout(bind(this,function(){if(this.sidebar_clicked||!this.sidebar){return}b(this.$writer_ui[0]).removeClass("open")}),100)}));this.writer.$node.css("padding-bottom","");if(Glbl("Site.is_stash")||this.writer.$textarea.hasClass("expandplz")){setTimeout(bind(this,function(){this.writer.$textarea.removeClass("expandplz");this.expandWriterUI()}),25)}else{this.collapseWriterUI(true);this.writer.$node.off(this.EXPANSION_EVENTS)}this.$.addClass("ccwriter-wrapper").find("textarea").removeClass("writeranywhere");this.sidebar.$.css({top:this.TOP_OFFSET}).hide();this.writer.$node.focus();this.ccwriter_inited=1;a=this;PubSub.subscribe([{eventname:"Location.changed",subscriber:a,callback:a.closeWriterUI,empty_queue_if_first_subscriber:true}])}))}},expansionThreshold:function(){var f=b("<div>").appendTo(this.writer.$node);var e=f.offset().top-this.writer.$node.offset().top;f.remove();if(e>this.TRIGGER_HEIGHT){this.expandWriterUI();this.writer.$node.off(this.EXPANSION_EVENTS)}},closeWriterUI:function(g,e){var f=b.Deferred();e=e||false;g=g||null;if(g=="Location.changed"){PubSub.publish("WriterSidebar.stop_stash");this.sidebar.destroy();this.writer.destroy();b("body").removeClass("ccwriter-subframe stickhelper");b("#dv7").css("min-height",Ruler.screen.rect().y2+(Browser.isIE?32:0));b(".commentwriter-toolbar-inner").empty();b(".commentwriter-toolbar").after(b('<div class="commentwriter-sidebar"><h3>Add Media</h3></div>'));b(".commentwriter-interface").hide();f.resolve()}else{this.collapseWriterUI(true,true,bind(this,function(){var h=this.writer.$textarea;this.writer.destroy();if(e){h.val("")}h.unwrap().unwrap().addClass("writeranywhere").removeClass("writer").hide().after(b('<div class="writeranywhere commentwriter-underlay">').html(h.val()));if(g){g.call()}f.resolve()}))}f.done(function(){if(a){PubSub.unsubscribe([{eventname:"Location.changed",subscriber:a}]);a=null}});return f},scrollToWriterUI:function(e){var f=e?"#dv7, #output:visible":document;if(this.ccwriter_scrolloffset){b(f).scrollTop(this.ccwriter_scrolloffset.top);b(f).scrollLeft(this.ccwriter_scrolloffset.left)}else{if(typeof f=="string"){b(document).scrollTop(1)}}},recordScrollPosition:function(e){var f=b("#dv7, #output:visible");var g=(f.length&&e)?f:b(document);this.ccwriter_scrolloffset={top:(f.length&&f.scrollTop())?f.scrollTop():g.scrollTop(),left:(f.length&&f.scrollLeft())?f.scrollLeft():g.scrollLeft()};console.log("[CCW] Recorded scroll offset:",e,f.length,this.ccwriter_scrolloffset)},expandWriterUI:function(){var g=this;if(typeof da_minish_lub!="undefined"){da_minish_lub.init()}if(typeof Lub!="undefined"){Lub.shutdown()}if(b(window).width()-this.$.offset().left-this.$.width()<300){this.ccwriter_wide=1;var f=b(window).scrollTop(),i=this.$.offset().top;b("body").addClass("ccwriter-subframe");b(window).scrollTop(f+this.$.offset().top-i)}else{this.ccwriter_wide=0;this.recordScrollPosition();b("body").addClass("ccwriter-subframe");b("#dv7").css("min-height",Ruler.screen.rect().y2-46-32);this.scrollToWriterUI(true)}if(b(".ohm-stickhelper").length){b("body").addClass("stickhelper")}b(".commentwriter-interface").show();var h=b("table#commentwriter-topmenu");h.removeAttr("style");b(this.$writer_ui[0]).find("table").show();b(this.$writer_ui[0]).show().height(0).animate({height:46},180);this.sidebar.$.show().width(0).animate({width:300},200);if(Glbl("Stash.mode")!="plain"){PubSub.publish("WriterSidebar.start_stash")}b.each(this.writer.toolbars,function(j,k){k.destroy()});this.writer.createToolbars(null,[{toolbar_name:"writersub",toolbar_node:b(".commentwriter-toolbar-inner")[0],toolbar_button_class:"subToolbarButton",toolbar_menu_class:"subToolbarMenu",toolbar_popup_class:"stashwriter-subtoolbar-menu stashwriter-subtoolbar-menu",toolbar_order:["separator","undo","redo","separator","bold","italic","underline","separator","ul","ol","blockquote","separator","alignl","alignc","alignr","separator","link2"]}]);b.each(this.writer.toolbars,function(j,k){k.rebind();k.show()});b(this.$writer_ui[0]).find(".commentwriter-cancel, .commentwriter-submit, .commentwriter-preview").off("click.writeranywhere");if(this.ccwriter){var e;if(this.ccwriter_toplevel){e=this.$.parents(":gmi(TalkPostWrapper)").gmi1().talkpost}else{e=this.$.parents(".talk-post").data("TalkPost")}e.showCancel();b(this.$writer_ui[0]).find(".commentwriter-cancel").on("click.writeranywhere",bind(this,function(){e.confirmCancel();return false}));b(this.$writer_ui[0]).find(".commentwriter-submit").on("click.writeranywhere",bind(this,function(){this.collapseWriterUI();e.confirmPost();return false}));b(this.$writer_ui[0]).find(".commentwriter-preview").on("click.writeranywhere",bind(this,function(){e.confirmPreview();return false}));b(this.$writer_ui[0]).find(".oh-stashmain").hover(function(){b(this).addClass("mmhover")},function(){b(this).removeClass("mmhover")});b(e.node).find(".drawPlz .showMedia").text("Hide Media").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(){this.collapseWriterUI();return false}))}else{b(this.$writer_ui[0]).find(".commentwriter-cancel").on("click.writeranywhere",bind(this,function(){this.collapseWriterUI();return false}));this.$.siblings(".drawPlz").find(".showMedia").text("Hide Media").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(){this.collapseWriterUI();return false}))}b(this.$writer_ui[2]).find(".commentwriter-expand").addClass("active").text("Hide Media").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(){this.collapseWriterUI()}));this.$.addClass("expanded");this.ccwriter_expanded=1},collapseWriterUI:function(h,g,k){var i=this;h=h||false;g=g||false;this.writer.$node.off("focus.writeranywhere");if(this.ccwriter_wide){var f=b(window).scrollTop(),j=this.$.offset().top;b("body").removeClass("ccwriter-subframe");b(window).scrollTop(f+this.$.offset().top-j)}else{this.recordScrollPosition(!h);b("body").removeClass("ccwriter-subframe");b("#dv7").css("min-height",Ruler.screen.rect().y2+(Browser.isIE?32:0));i.scrollToWriterUI()}b("body").removeClass("stickhelper");this.ccwriter_wide=0;if(this.ccwriter){var e;if(this.ccwriter_toplevel){e=this.$.parents(":gmi(TalkPostWrapper)").gmi1().talkpost}else{e=this.$.parents(".talk-post").data("TalkPost")}b(e.node).find(".drawPlz .showMedia").text("Add Media").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(){this.expandWriterUI();return false}))}else{this.$.siblings(".drawPlz").find(".showMedia").text("Add Media").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(){this.expandWriterUI();return false}))}b(this.$writer_ui[0]).animate({height:0},180,function(){b(this).hide()});b(this.$writer_ui[2]).find(".commentwriter-expand").removeClass("active").text("Add Media").off("click.writeranywhere").on("click.writeranywhere",bind(this,function(){this.expandWriterUI()}));this.$.removeClass("expanded");PubSub.publish("WriterSidebar.stop_stash");if(!h){b.each(this.writer.toolbars,function(l,m){m.destroy()});this.writer.createToolbars(null);b.each(this.writer.toolbars,function(l,m){m.rebind();m.show()});if(typeof Lub!="undefined"){Lub.reboot();setTimeout(function(){if(typeof da_minish_lub!="undefined"){da_minish_lub.init()}},1000)}}this.ccwriter_expanded=0;this.sidebar.$.animate({width:0},200,bind(this,function(){if(g){this.sidebar.destroy();b(".commentwriter-toolbar").after(b('<div class="commentwriter-sidebar"><h3>Add Media</h3></div>'))}b(".commentwriter-interface").hide();if(k){k.call()}}));b('<input style="position:fixed; left: 0; top: 0">').appendTo("body").focus().remove()}})})(jQuery);if(window.DWait){DWait.run("jms/pages/writeranywhere.js")};
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/glbl.js"],function(){window.BrowserSupport={getBrowser:function(d){for(var a=0;a<d.length;a++){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!=-1){return d[a]}}else{if(c){if(navigator.userAgent){if(navigator.userAgent.indexOf(d[a].identity)!=-1){return d[a]}}else{return d[a]}}}}return null},getVersion:function(a){var b=new RegExp(this.versionSearchString+"/? ?([0-9]+(.?[0-9]+)*)");var c=a.match(b);if(!c){return null}return c[1].split(".")},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome",min:[8,0],link:"http://www.google.com/chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version",min:[4,0],link:"http://www.apple.com/safari/"},{prop:window.opera,identity:"Opera Mini",versionSearch:"Version",min:[10,50],link:"http://www.opera.com/"},{prop:window.opera,identity:"Opera",versionSearch:"Version",min:[11,50],link:"http://www.opera.com/"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox",min:[3,6],link:"http://getfirefox.com"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE",min:[8,0],link:"http://microsoft.com/ie"}],enforce:function(){if(Glbl("Site.is_mobile")){return}var c=this.getBrowser(this.dataBrowser);var b=this.getVersion(navigator.userAgent);if(!c||!b){return}var a=undefined;$.each(c.min,function(d,e){if(a===undefined&&b[d]){if(b[d]<e){a=false}if(b[d]>e){a=true}}});if(a===false||(a===undefined&&c.min.length>b.length)){this.showBanner(c.link)}},showBanner:function(a){$("#overhead-collect").before('<div style="background:url(http://st.deviantart.net/misc/updatebrowser_ylw_bg.png) repeat-x;width:100%;height:10px;line-height:10px;text-align:center;position:absolute;top:-1px;z-index:1000;font-family:verdana;font-size:10px;color:#3c3838;padding:10px 0px;text-shadow:#fff 1px 1px;">Please <a href="'+a+'" style="color:#1965B6;">upgrade your browser</a> to access deviantART</div>')}};BrowserSupport.enforce();if(window.DWait){DWait.run("jms/pages/browser_support.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/Base.js","jms/lib/pubsub.js"],function(){(function(c){var b=Base.extend({_resize_throttle:100,_debounce_fill_ad:800,_page_debounce_times:{},_minimum_boundary:100,_init:false,_resize_mode:false,_superbrowse_mode:false,_stashed_ad_html:[],_waiting_ad_units:[],_ads:{},_pool:[],_win_w:0,_$win:null,constructor:function(){this._$win=c(window);this._win_w=this._$win.width()},fill_ad_slot:function(d,e){if(this._resize_mode){return}d=String(d);var f=c.now();if(this._page_debounce_times[d]&&f<this._page_debounce_times[d]){return}this._page_debounce_times[d]=f+this._debounce_fill_ad;e=c(e);if(!this.is_valid_ad_request(d,e)){return}if(this._ads[d]){this.position_ad(d,e);return}this.show_container();this.get_an_offscreen_ad(d);this.position_ad(d,e);if(!this._init){this._init=true;this.bind_window_resize();PubSub.subscribe([{eventname:"Superbrowse.open",subscriber:this,callback:this.superbrowse_opened},{eventname:"Superbrowse.closed",subscriber:this,callback:this.superbrowse_closed}])}},stash_ad_html:function(d){if(this._waiting_ad_units.length){c(this._waiting_ad_units.shift()).html(d);return}if(this._stashed_ad_html.length<=5){this._stashed_ad_html.push(d)}},scroll_manager_is_done_resizing:function(){if(!this._resize_mode||this._superbrowse_mode){return}this._win_w=this._$win.width();this.show_container();for(var e=0,d=this._pool.length;e<d;++e){this.position_ad(this._pool[e])}this.enter_normal_mode()},enter_normal_mode:function(){this._resize_mode=false;this.show_container();this.bind_window_resize()},enter_resize_mode:function(){this._resize_mode=true;this.unbind_window_resize();this.hide_container()},unbind_window_resize:function(){this._$win.off("resize.browselikethis_ad_pool")},bind_window_resize:function(){this._$win.on("resize.browselikethis_ad_pool",c.throttle(this._resize_throttle,this.window_resize.bindTo(this)))},window_resize:function(){var d=this._$win.width();if(d==this._win_w){return}this._win_w=d;this.enter_resize_mode()},superbrowse_opened:function(){this._superbrowse_mode=true;this.enter_resize_mode()},superbrowse_closed:function(){this._superbrowse_mode=false;this.enter_normal_mode()},position_ad:function(d,e){var f=this.get_ad_by_page_id(d);if(f){e=c(e);if(e.length){f.$node=e}f.offset=f.$node.offset();if(f.offset<this._minimum_boundary){f.offset={top:-9999,left:-9999}}f.$el.css(f.offset)}},is_valid_ad_request:function(e,g){if(!g.length){return false}var f=this.get_ad_by_page_id(e);if(!f){return true}if(!f.$node.is(g)){return true}var d=g.offset();if(Math.floor(d.top)!=Math.floor(f.offset.top)||Math.floor(d.left)!=Math.floor(f.offset.left)){return true}return false},get_ad_by_page_id:function(d){return this._ads[d]},get_an_offscreen_ad:function(o){var k=this._pool.length,l=this._$win.scrollTop(),e=l+this._$win.height();for(var f=0;f<k;++f){var g=this._pool[f],n=this.get_ad_by_page_id(g);if(!n){continue}var d=n.offset.top,j=d+this.ad_height,m=((d>=l&&d<=e)||(l>=d&&l<=j));if(!m){this._pool.splice(f,1);this._pool.push(o);this._ads[g]=null;this._ads[o]=n;return n}}var h={"$el":this.create_ad_element(),"$node":c()};h.offset=h.$el.offset();this._pool.push(o);this._ads[o]=h;if(!this.ad_height){this.ad_height=h.$el.height()}return h},get_container:function(){if(!this.$container){this.$container=c("<div>").addClass("blt-ad-container").prependTo(document.body)}return this.$container},hide_container:function(){this._container_hidden=true;this.get_container().addClass("hidden")},show_container:function(){this._container_hidden=false;this.get_container().removeClass("hidden")},create_ad_element:function(){var d=this._stashed_ad_html.shift(),e=c("<div>").addClass("blt-ad").appendTo(this.get_container());if(!d){this._waiting_ad_units.push(e)}else{e.html(d)}return e}});var a=new b();PubSub.publish("BrowseLikeThisAdPool.instance_loaded",a)})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.ads.js")}});
(function(c){if(window.location.hash.indexOf("offset")>-1){var f=/[\&\?]?offset\=\d+/,b=window.location.search.replace(f,""),d=window.location.hash.replace(f,""),e=parseInt(/offset=(\d+)/.exec(window.location.hash)[1],10),a="offset="+String(e);c("#browse-results-page-1").html('<span class="browse-loading">Loading from result '+(e+1)+"...</span>");if(d==="#"){d=""}if(b.length==0){b="?"+a}else{b+="&"+a}window.location=window.location.pathname+b+d}})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.onload_url_hash_handler.js")};
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js",".domready"],function(){(function(b){var c=Base.extend({handlers:{load_comments_clicked:function(g){g.preventDefault();var f=b(this);var e=f.data("CommentsLoader");if(!e){var h=f.data("itemid");var d=f.closest(".deviation-full-minipage");e=new a(h,d);f.data("CommentsLoader",e)}e.load_more()},show_description_clicked:function(){b(this).siblings(".minipage-description").css({height:"auto",overflow:"auto"}).find(".description-fader").remove();b(this).remove()}},constructor:function(){b("#browse-results").on("click",".comments-count:not(.disabled)",this.handlers.load_comments_clicked).on("click",".minipage-show-description",this.handlers.show_description_clicked);this.adjust_description_height();PubSub.subscribe([{eventname:"BrowseLikeThisStreamView.pages_visible",subscriber:this,callback:this.adjust_description_height}])},adjust_description_height:function(){var d=43;b(".minipage-description .text-ctrl").not(".height-adjusted").each(function(){var e=b(this);if(e.height()<=d){e.siblings(".description-fader").remove();e.parent().height(e.height()).siblings(".minipage-show-description").remove()}e.addClass("height-adjusted")})}});var a=Base.extend({COMMENT_DEVIATION:1,$comments:null,$comments_loaded:null,$comments_count:null,itemid:null,offset:0,limit:25,templates:{loading:"<div class='comments-loading browse-loading'>Loading...</div>",end:"<div class='browse-done'>End of Comments</div>"},constructor:function(e,d){this.itemid=e;this.$comments=d.find(".minipage-comments-container");this.$comments_loaded=d.find(".comments-loaded");this.$comments_count=d.find(".comments-count")},load_more:function(e,d){this.show_loading();DiFi.pushPublicGet("Comments","getLimitedComments",[this.COMMENT_DEVIATION,this.itemid,0,this.offset,this.limit+1],this.load_more_done.bindTo(this));DiFi.send()},load_more_done:function(h,g){this.remove_loading();if(g.response.content.error){this.disable_more();return}var f=b(g.response.content.html);var d=f.find(".ccomment");var e=d.length;if(e<this.limit+1){this.disable_more()}else{e--;d.last().remove()}this.$comments.append(f);this.offset+=e;this.update_comments_loaded()},show_loading:function(){this.$comments.append(this.templates.loading)},remove_loading:function(){this.$comments.find(".comments-loading").remove()},disable_more:function(){this.$comments_count.parent().prepend(this.templates.end);this.$comments_count.remove()},update_comments_loaded:function(){this.$comments_loaded.text(this.offset);this.$comments_loaded.parent().show()}});new c()})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.minipage.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/pages/browselikethis/browselikethis.stream.fetcher.js"],function(){(function(){var a=Base.extend({_fetcher:null,_max_page_id:0,_loaded_pages:[],_loading_queue:[],_pages:{},_current_page:null,_page_skeleton:{id:null,number:null,portal_api:null,query_params:{},display_method:"php",results_dom:null,advert_dom:null,state:"unloaded",has_more:false,error_state:0,max_offset:null,result_type:null},handlers:{init:function(c,b){var d=this._create_page(b);d.state="loaded";d.display_method="php";this._add_loaded_page(d);this.handlers.set_current_page.bindTo(this)(null,d.id);this._fetcher=new BLTStreamFetcher({cache_size:20});PubSub.unsubscribe({eventname:"BrowseLikeThisStream.init",subscriber:this});PubSub.subscribe([{eventname:"BrowseLikeThisStream.load_next",subscriber:this,callback:this.handlers.load_next},{eventname:"BrowseLikeThisStream.set_current_page",subscriber:this,callback:this.handlers.set_current_page},{eventname:"BrowseLikeThisStream.update_page_url",subscriber:this,callback:this.handlers.update_page_url.bindTo(this)}])},load_next:function(c,e){if(this._loading_queue[0]){return}var b=this._loaded_pages[this._loaded_pages.length-1],d;if(!b.has_more){return}d=this._create_page(b);d.number++;d.query_params.offset=parseInt(d.query_params.offset,10)+parseInt(d.query_params.length,10);d.display_method=e?"auto":"button";d.state="pending";if(d.query_params.view_mode=="full"){d.query_params.results_shown=(parseInt(d.query_params.results_shown,10)||0)+(parseInt(d.query_params.length,10)||0);d.query_params.length=5}if(Number(d.max_offset)&&d.query_params.offset>=Number(d.max_offset)){return}this._load_new_page(d)},set_current_page:function(c,b){if(this._pages.hasOwnProperty(b)){this._current_page=this._pages[b];PubSub.publish("BrowseLikeThisStream.current_page_changed",this._current_page);this._update_page_url()}},update_page_url:function(b,c){this._update_page_url(c)}},constructor:function(){this._loading_queue=[];this._loaded_pages=[];this._pages={};PubSub.subscribe({eventname:"BrowseLikeThisStream.init",subscriber:this,callback:this.handlers.init})},_create_page:function(c){var b=$.extend(true,{},this._page_skeleton,c);b.id=this._next_page_id();this._pages[b.id]=b;return b},_load_new_page:function(b){var c=this._fetcher.fetch(b.portal_api,b.query_params);if(this._loading_queue.length<1){PubSub.publish("BrowseLikeThisStream.next_page_loading",b)}this._loading_queue.push(b);this._handle_promise(c,b).always(this._process_queue.bindTo(this))},_process_queue:function(){var b=0,c;while(this._loading_queue[0]&&this._loading_queue[0].state!=="pending"){c=this._loading_queue.shift();if(c.state=="loaded"||c.state=="error"){this._add_loaded_page(c)}b++}if(this._loading_queue.length<1){PubSub.publish("BrowseLikeThisStream.next_page_loading",false)}else{PubSub.publish("BrowseLikeThisStream.next_page_loading",c)}},_update_page_url:function(e){var d=Glbl("Location.get_params"),b="",c=d.offset;if(e===undefined){e=c=Number(this._current_page.query_params.offset)}if(e){d.offset=e}else{if(d.offset!==undefined){delete d.offset}}if(!$.isEmptyObject(d)){b="?"+$.param(d)}if(Glbl("Location.pushstate_enabled")){b+=window.location.hash}PubSub.publish("Location.replace",window.location.pathname+b);if(e!==c){PubSub.publish("BrowseLikeThisStream.page_url_updated",e)}},_handle_promise:function(c,b){return c.done(function(d){b.advert_dom=d.advert_dom;b.results_dom=d.results_dom;b.has_more=d.has_more;b.error_state=d.error_state;b.state="loaded"}).fail(function(d){b.state="error";b.error=d})},_add_loaded_page:function(b){this._loaded_pages.push(b);if(b.display_method!=="php"){PubSub.publish("BrowseLikeThisStream.new_page_added",b)}},_next_page_id:function(){return ++this._max_page_id}});new a()})();if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.js")}});
DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/difi.js"],function(){(function(a){window.BLTStreamFetcher=Base.extend({_options:{},_defaults:{},constructor:function(b){this._options=a.extend({},this._defaults,b)},fetch:function(c,b){var d=a.Deferred();d.request={portal_api:c,query_params:b,advert_dom:"",results_dom:[],has_more:false,error_state:0};DiFi.pushPublicGet("PortalCore","get_result_thumbs",[d.request.portal_api,d.request.query_params],this._difi_callback.bindTo(this,d));DiFi.send();return d.promise()},_difi_callback:function(c,g,f){if(g&&f.response.content.resources){var e,d=f.response.content.resources,b=[];for(e=0;e<d.length;e++){b.push(d[e][2])}c.request.advert_dom=f.response.content.ad;c.request.results_dom=b;c.request.has_more=Boolean(f.response.content.has_more);c.request.error_state=parseInt(f.response.content.error_state);c.resolve(c.request)}else{c.reject(f.response.content.error||"Unknown DiFi Error")}}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.fetcher.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/gmi.js","jms/lib/popup2.js","jms/lib/jquery/jquery.current.js",".domready","jms/pages/superbrowse/master.js","jms/lib/gstream/resource_stream.js","jms/pages/browselikethis/browselikethis.previewselection.js","jms/pages/browselikethis/browselikethis.stream.scroll_manager.js"],function(){(function(a){window.BrowseLikeThisStreamView=window.PortalCoreResourceStream.extend({_infinite_scroll_enable:false,_reached_end:false,_$paging_container:null,_$load_more_button:null,_$gear_menu_button:null,_$first_paging_results:null,_$loading_indicator:null,_$loading_message:null,_prevent_waypoint_triggers:false,_scroll_manager:null,_results_since_last_ad:0,preview_override_selection_type:window.BrowseLikeThisPreviewSelection,_jump_to_offset:NaN,_allow_show_more:false,_jupiter_is_inline_with_saturn_abracadabra_make_superbrowse_zoom_bug_go_away:false,templates:{errors:{generic:'<span class="browse-error">There was an error loading this page.</error>',states:{1:'<div class="browse-no-results">There was an error performing your request. Please try again later.</div>',2:'<div class="browse-no-results">Sorry, deviantART does not serve more than @_MAX_OFFSET_@ results for this query.</div>',3:'<div class="browse-no-results">Sorry, we found no relevant results.</div>',4:'<div class="browse-no-results">Sorry, we don\'t have that many results.</div>',5:'<div class="browse-no-results">All of the results on this page have been hidden due to your Mature Content Settings.</div>',6:'<div class="browse-no-results">All of the results on this page have been hidden due to the owner putting them into storage. There may be more visible results on later pages.</div>',7:'<div class="browse-no-results">All of the results on this page have been hidden due to the owner deleting them. There may be more visible results on later pages.</div>'}}},handlers:{next_page_loading:function(c,e){if(e){var d="#browse-results-page-"+e.id;if(a(d).length<1){e.results_dom=[];var b=this._make_page(e);this._$paging_container.before(b)}this._hide_reached_end();this._$load_more_button.hide();this._$gear_menu_button.hide();this._$first_paging_results.hide();this._$loading_indicator.show()}else{if(!this._infinite_scroll_enable&&!this._reached_end){this._$load_more_button.show();this._$gear_menu_button.show();this._$first_paging_results.show()}this._$loading_indicator.hide()}},cancel_pending:function(d,b){for(var c=0;c<b.length;c++){a("#browse-results-page-"+b[c].id).remove()}},new_page_added:function(c,b){setTimeout(function(){if(!this._infinite_scroll_enable&&!this._reached_end){this._$load_more_button.show();this._$gear_menu_button.show();this._$first_paging_results.show()}var e=a("#browse-results-page-"+b.id);if(e.length<1){e=this._make_page(b)}else{e.detach().find(".page-results").html(this._make_contents_html(b))}this._scroll_manager.add_page(b.id,e);if(b.has_more&&(Number(b.query_params.offset)+Number(b.query_params.length))<b.max_offset){this._reached_end=false;this._hide_reached_end()}else{this._$load_more_button.hide();this._$gear_menu_button.hide();this._$first_paging_results.hide();this._reached_end=true;this._show_reached_end()}this._make_legacy_js_happy(e);var d="/vpv/"+window.location.host.split(".")[0]+window.location.pathname+"?offset="+b.query_params.offset;PubSub.publish("PageViewTracker.pageview",{page:d,tag:"Dynamic.BrowseResultsPage"});if(this.preview_selector&&this.preview_selector.retry_jump){this.preview_selector.retry_jump()}if(this._infinite_scroll_enable){a("#depths").remove();this._$paging_container.css("padding-bottom","300px")}}.bindTo(this),1)},infinite_scroll_enabled:function(b){this._infinite_scroll_enable=true;this._$load_more_button.hide();this._$gear_menu_button.hide();this._$first_paging_results.hide();if(b!=="Superbrowse.closed"){PubSub.subscribe({eventname:"Superbrowse.closed",subscriber:this,callback:this.handlers.infinite_scroll_enabled})}},infinite_scroll_disabled:function(b){this._infinite_scroll_enable=false;this._$load_more_button.show();this._$gear_menu_button.show();this._$first_paging_results.show()},super_browse_open:function(){this._prevent_waypoint_triggers=true},super_browse_closed:function(){this._prevent_waypoint_triggers=false},popup_trigger_click:function(){a(".pane-switch").css("z-index",10);var e=a(this);var b=e.data("name");if(!Popup2.getPopup(b)){new Popup2(b,"body",{classes:b,content:a("#"+b).clone(true).show(),hidden:function(){e.removeClass("popupactive");if(e.data("type")){this.$node.removeClass(e.data("type"))}},shown:function(){e.addClass("popupactive");this.$node.addClass(e.data("type"))}})}var d=Popup2.getPopup(b);if(d.active){d.hide()}else{var c={keepOnScreen:false};if(b=="browse-paging-popup"){c.valign="center";c.bump={top:7,left:-9}}d.show(d.position(e,c));a(".paging-results-go-input:visible").focus()}return false},popup_active_check:function(){if(Popup2.getPopup(a(this).data("name")).active){return false}},ignore_journal_preview_click:function(f){var d=a(f.target);if(d.closest(".journalcontrol,.blogcontrol")[0]){f.preventDefault();f.stopPropagation();var b=d.closest(".journal-browse").find(".journal-footer:last > a:first");if(a("#browse2, #browse-results").length){b.click()}else{var c=d.closest(".journal-browse").find(".journalcontrol .metadata a:first");if(d.is("[href]")){document.location=d.attr("href")}else{if(c.length){document.location=c.attr("href")}else{document.location=b.attr("href")}}}}},top_button_click:function(){window.scrollTo(0,0);return false},ie8_hover_fix:function(){a(this).find(".mlt-link").css("background-color","#196BA7").find(".mlt-text").css("display","block")}},gmiConstructor:function(){this.$.removeClass("dwait");this.$.find(".browse-no-results a").click(function(){window.location=this.href;return false});this._init_stream();this._$paging_container=a(".browse-paging",this.gmi_node);var e=a(".load_more",this._$paging_container);if(!e.hasClass("disabled")){this._$load_more_button=e.click(this._load_more_click.bindTo(this)).closest(".pagination")}this._allow_show_more=!e.hasClass("disabled");this._$gear_menu_button=a(".paging-dropdown-trigger",this._$paging_container);this._$first_paging_results=a(".paging-results-first-page",this._$paging_container);this._$loading_indicator=a('<span class="browse-loading">Loading ...</span>').hide().appendTo(this._$paging_container);a("body").on("keydown",".paging-results-go-input",this._keydown_go_input.bindTo(this)).on("click",".paging-results-go",this._set_offset.bindTo(this)).on("click",".paging-style-link",this._change_paging_style);var f=a("#browse-results");f.on("click",".popup-trigger",this.handlers.popup_trigger_click).on("mousedown",".popup-trigger",this.handlers.popup_active_check).on("mousedown",".journal-browse",this.handlers.ignore_journal_preview_click).on("click","a.browse-top-link",this.handlers.top_button_click);if(a.browser.msie&&a.browser.version=="8.0"){f.on("mouseenter",".tt-a, .deviation-full-data",this.handlers.ie8_hover_fix)}this.base();if(!this.gmi_args.result_type||this.gmi_args.result_type==="deviations"){PreviewStream.gmiEmbed(this,{},a.extend({},OUTLINE_PreviewStream,{previewLoadOffset:function(){},domClearAll:function(){},domDrawItem:function(){},loaderItemRead:this._override_loader_item_read.bindTo(this),streamSelect:this._override_stream_select.bindTo(this)}));if(da_preview_master&&da_preview_master.paddlesDrawn){var b=da_preview_master.last_sent_id,c,d;for(c=0;c<this.contents.length;c++){d=this.contents[c];if(d[0]==1&&d[1]==b){this._jupiter_is_inline_with_saturn_abracadabra_make_superbrowse_zoom_bug_go_away=true;this.preview_selector.setSelection(d[2]);this._jupiter_is_inline_with_saturn_abracadabra_make_superbrowse_zoom_bug_go_away=false;break}}}}var g=a("<div></div>");this._$paging_container.before(g);this._scroll_manager=new BrowseLikeThisScrollManager(g);a(this._scroll_manager).bind("top_page_changed",this._top_page_changed.bindTo(this));a(this._scroll_manager).bind("needs_more",this._needs_more.bindTo(this));a(this._scroll_manager).bind("pages_became_visible",this._pages_became_visible.bindTo(this));PubSub.subscribe([{eventname:"BrowseLikeThisStream.next_page_loading",subscriber:this,callback:this.handlers.next_page_loading},{eventname:"BrowseLikeThisStream.cancel_pending_pages",subscriber:this,callback:this.handlers.cancel_pending},{eventname:"BrowseLikeThisStream.new_page_added",subscriber:this,callback:this.handlers.new_page_added},{eventname:"Superbrowse.open",subscriber:this,callback:this.handlers.super_browse_open},{eventname:"Superbrowse.closed",subscriber:this,callback:this.handlers.super_browse_closed},{eventname:"BrowseLikeThisStream.infinite_scroll_enabled",subscriber:this,callback:this.handlers.infinite_scroll_enabled},{eventname:"BrowseLikeThisStream.infinite_scroll_disabled",subscriber:this,callback:this.handlers.infinite_scroll_disabled},{eventname:"BrowseLikeThisStream.page_url_updated",subscriber:this,callback:this.go_to_offset.bindTo(this)}])},_init_stream:function(){var b={number:Math.floor(this.gmi_args.query_params.offset/this.gmi_args.count_per_page)+1,portal_api:this.gmi_args.portal,query_params:this.gmi_args.query_params,results_dom:a("#browse-results-page-1 .page-results",this.gmi_node).html(),has_more:Boolean(this.gmi_args.more_to_load),max_offset:this.gmi_args.max_offset,result_type:this.gmi_args.paging_result_type,ad_settings:this.gmi_args.ad_settings};PubSub.publish("BrowseLikeThisStream.init",b);this._init_ads()},_init_ads:function(){var b=Number(this.gmi_args.ad_settings.results_before_first||0),c=Number(this.gmi_args.count_per_page);if(b<c){this._results_since_last_ad=c-b}},_load_more_click:function(b){PubSub.publish("BrowseLikeThisStream.load_next",false);PubSub.publish("BrowseLikeThisStream.infinite_scroll_enabled");return false},_keydown_go_input:function(b){if(b.keyCode==13){this._set_offset()}},_set_offset:function(){this._jump_to_offset=Math.max((parseInt(a(".paging-results-go-input:visible").val(),10)-1),0);if(!isNaN(this._jump_to_offset)){PubSub.publish("BrowseLikeThisStream.update_page_url",this._jump_to_offset)}},go_to_offset:function(b,c){if(c===this._jump_to_offset){window.location=window.location}},_change_paging_style:function(){var b=a(".thumb-limit-picker").data("offset");if(b){window.location=a(this).attr("href")+"&offset="+b;return false}},_show_reached_end:function(){a('<div class="browse-end">End of Results</div>').appendTo(this._$paging_container)},_hide_reached_end:function(){a(".browse-end").remove()},_needs_more:function(b){if(!this._prevent_waypoint_triggers&&this._infinite_scroll_enable){PubSub.publish("BrowseLikeThisStream.load_next",true)}},_top_page_changed:function(c,b){if(!this._prevent_waypoint_triggers){if(!b){b=1}PubSub.publish("BrowseLikeThisStream.set_current_page",b)}},_pages_became_visible:function(c,b){PubSub.publish("BrowseLikeThisStreamView.pages_visible",b)},_find_dom_nodes_in_container:function(b){return b.find("> .tt-a, > .deviation-full-container > .deviation-full-data").get()},domFindVisible:function(){var c={};if(!this.contents||!this.contents.length){c=this._find_dom_nodes_in_container(a(".page-results"));var d=a(".mlt-seed-container .tt-a");if(d.length){c.unshift(d.get(0))}return c}for(var b in this.contents){if(!this.contents.hasOwnProperty(b)){continue}if(this.contents[b][2]&&document.body.contains(this.contents[b][2])){c[b]=this.contents[b][2]}}return c},_make_page:function(d){var c="results-page-"+d.query_params.view_mode;if(d.query_params.thumb_mode=="grid"){c+=" stream-fh-grid";if(vms_feature("responsive_grid")){c+=" stream-fh-grid-responsive responsive-full-width"}}var b='<div class="browse-results-page" id="browse-results-page-'+d.id+'"><hr class="browse-divider browse-page-divider"><div class="browse-page-header"><div class="paging-results browse-link-button popup-trigger" data-name="paging-results-popup">'+d.result_type+' <div class="paging-results-count">'+(parseInt(d.query_params.offset,10)+1)+" - "+(parseInt(d.query_params.offset,10)+parseInt(d.query_params.length))+'</div></div><a href="javascript:void(0)" class="browse-top-link browse-proper-button"><span>&uarr;</span> Top</a>';if(d.id==2){b+='<div data-name="browse-paging-popup" data-type="paging-gear" data-offset="'+d.query_params.offset+'" class="thumb-limit-picker paging-dropdown-trigger popup-trigger"><span></span></div>'}b+='</div><div class="page-results '+c+'">'+this._make_contents_html(d)+"</div></div>";return a(b)},_make_contents_html:function(d){if(d.state=="error"){return this.templates.errors.generic}else{if(d.error_state>0){var b=this.templates.errors.states[d.error_state];return b.replace("@_MAX_OFFSET_@",this.gmi_args.max_offset)}}if(!d.ad_settings.disabled&&d.results_dom.length){var e,c="browse-results-page-"+d.id;if(Number(d.ad_settings.results_between)==0){e=0}else{if(this._results_since_last_ad==null){e=Number(d.ad_settings.results_before_first)-Number(this.gmi_args.count_per_page)}else{e=Number(d.ad_settings.results_between)-this._results_since_last_ad}}if(e<d.results_dom.length){if(d.advert_dom){d.results_dom.splice(e,0,d.advert_dom)}this._results_since_last_ad=d.results_dom.length-e-1}else{this._results_since_last_ad=(this._results_since_last_ad||0)+d.results_dom.length}}return d.results_dom.join("")},get_all_selectable_result_nodes:function(){return a.map(this.contents,function(b){return b[2]})},get_stream_node_from_clicked_node:function(b){return a(b).closest(".tt-a, .deviation-full-data").get(0)},_override_loader_item_read:function(c){var b=a(c),d=b.hasClass("journal-wrapper")?b:b.find(".journal-wrapper:first");if(d.length&&!d.find('[id="news-special"]').length){return a(d.html()).find(".journal-footer").remove().end()}else{return OUTLINE_PreviewStream.loaderItemRead.apply(this,arguments)}},_override_stream_select:function(e,d,b){var c=OUTLINE_PreviewStream.streamSelect.bindTo(this);c(e,d,b);if(!e.length){if(d[0]&&document.body.contains(d[0])){if(a("#hey-wow-pay-attention-banner-banner").length){PreviewStream.scrollTo(a(d[0]).offset().top-(140+a("#hey-wow-pay-attention-banner-banner").height()))}else{PreviewStream.scrollTo(a(d[0]).offset().top-100)}}}},_make_legacy_js_happy:function(d){var c=this._find_dom_nodes_in_container(d.find(".page-results"));for(var e=0;e<c.length;e++){var f=c[e],b=a(f);if(f&&f.getAttribute&&(f.getAttribute("collect_rid")||b.hasClass("journal-browse"))){this.contents.push(this.domReadOne(f))}else{f=b.find("[collect_rid]").get(0);if(f&&f.getAttribute&&f.getAttribute("collect_rid")){this.contents.push(this.domReadOne(f))}}}},commsMakeCustomSurfer:function(i,h,g){var b=a(g);if(h[0]==1&&b.hasClass("deviation-full-data")&&b.find(".journal-wrapper").length){var d=b.find("h2:first").get(0),c=Surfer.create(i,d,undefined,undefined,true,true),f=a(c.node);f.addClass("browse-title-surfer");if(f.find("img").length<1){f.addClass("lit-title-surfer")}c.mod_down={x:-(f.width()/2),y:-(f.height()/2)};return c}return false}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.view.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/pages/browselikethis/browselikethis.ads.js",".domready"],function(){(function(c){var d=null;PubSub.subscribe({eventname:"BrowseLikeThisAdPool.instance_loaded",subscriber:{},callback:function(e,f){d=f}});var b=Base.extend({$node:null,has_ad:false,$ad_container:null,ad_height:0,ad_offset:null,page_id:null,height:0,offset:0,is_on_screen:false,last_measured_at:null,constructor:function(e,f){this.page_id=e;this.$node=f;var h=this.$node.find("iframe");if(h.length){this.has_ad=true;this.$ad_container=h.parent();this.ad_height=h.height();var g=c("<div>");h.appendTo(g);if(d){d.stash_ad_html(g.html())}}},measure:function(){if(!this.is_on_screen){throw new Error("Cannot measure page that is not visible")}this.height=this.$node.outerHeight();this.last_measured_at=new Date().getTime();if(this.has_ad){this.ad_offset=this.offset+this.$ad_container.offset().top-this.$node.offset().top}},render_ad:function(){if(d){d.fill_ad_slot(this.page_id,this.$ad_container)}},stash:function(){if(this.is_on_screen){this.$node.detach();this.is_on_screen=false}}});var a=false;window.pause_scroll=function(){a=true};window.resume_scroll=function(){a=false};window.BrowseLikeThisScrollManager=Base.extend({_$node:null,_$top_buffer:null,_$bottom_buffer:null,_$w:null,_pages:[],_scroll_throttle:300,_resize_debounce:500,_advert_throttle:500,_remeasure_throttle:2000,_viewport_height:null,_last_scroll_top:-1,_last_update_needed_more:false,_first_visible_index:-1,_last_visible_index:-1,_current_top_page_idx:-1,_visible_pixels_threshold:700,_load_more_threshold:1500,constructor:function(e){this._$node=e;this._pages=[];this._$w=c(window);this._$top_buffer=c("<div></div>");this._$bottom_buffer=c("<div></div>");this._$node.prepend(this._$top_buffer);this._$node.append(this._$bottom_buffer);this._$w.on("scroll",c.throttle(this._scroll_throttle,this._on_scroll.bindTo(this)));this._throttled_render_ads=c.throttle(this._advert_throttle,this._render_ads.bindTo(this));this._$w.on("scroll",this._throttled_render_ads);this._$w.on("resize",c.debounce(this._resize_debounce,this._on_resize.bindTo(this)));this._measure_viewport()},add_page:function(e,f){var h=new b(e,f),g=this._pages[this._pages.length-1];this._pages.push(h);f.insertBefore(this._$bottom_buffer);h.is_on_screen=true;if(g){h.offset=g.offset+g.height}h.measure();if(this._pages.length==1){this._first_visible_index=0;this._last_visible_index=0}if(g&&!g.is_on_screen){h.stash()}else{this._last_visible_index=this._pages.length-1;c(this).trigger("pages_became_visible",[h.$node]);this._throttled_render_ads()}},_on_scroll:function(k){if(!this._pages.length||a){return}if(!this._$node.is(":visible")){return}var o,f,l,p=this._$node.offset().top,r=this._$w.scrollTop()-p;if(!k&&r==this._last_scroll_top){return}o=this._find_at_offset(r-this._visible_pixels_threshold,this._first_visible_index);f=this._find_at_offset(r+this._viewport_height+this._visible_pixels_threshold,this._last_visible_index);if(o<0){o=0}if(f<0){f=this._pages.length-1}if(o!==this._first_visible_index||f!==this._last_visible_index){this._$top_buffer.height(this._pages[o].offset);for(l=this._first_visible_index;l<=this._last_visible_index;l++){if(l<o||l>f){this._pages[l].stash()}}var q=true,e=[];for(l=o;l<=f;l++){if(this._pages[l].is_on_screen){q=false}else{if(q){this._$top_buffer.after(this._pages[l].$node)}else{this._$bottom_buffer.before(this._pages[l].$node)}this._pages[l].is_on_screen=true;e.push(this._pages[l].$node)}}if(e.length){c(this).trigger("pages_became_visible",e)}var s=this._pages[this._pages.length-1],j=s.offset+s.height,n=this._pages[f],h=n.offset+n.height,m;this._remeasure_pages(o,f+1);if((n.offset+n.height)!==h){h=m=n.offset+n.height;for(l=f+1;l<this._pages.length;l++){this._pages[l].offset=m;m+=this._pages[l].height}}this._$bottom_buffer.height(j-h)}var g=this._find_at_offset(r,this._current_top_page_idx);if(g!==this._current_top_page_idx){c(this).trigger("top_page_changed",(g<0)?null:this._pages[g].page_id);this._current_top_page_idx=g}this._last_scroll_top=r;this._first_visible_index=o;this._last_visible_index=f;this._load_more_if_necessary(r)},_load_more_if_necessary:function(f){var g=this._pages[this._pages.length-1],e=f+this._viewport_height;if((e+this._load_more_threshold)>(g.offset+g.height)){c(this).trigger("needs_more")}},_render_ads:function(){if(!this._pages.length||a||!this._$node.is(":visible")){return}var e=this._$w.scrollTop()-this._$node.offset().top,j=e+this._viewport_height;for(var f=0;f<this._pages.length;++f){if(this._pages[f].has_ad&&this._pages[f].is_on_screen){var h=this._pages[f].ad_offset-50,g=h+this._pages[f].ad_height+100;if((h>=e&&h<=j)||(e>=h&&e<=g)){this._pages[f].render_ad()}}}},_on_resize:function(){this._measure_viewport();var e,f=3;for(e=0;e<this._pages.length;e+=f){this._remeasure_pages(e,Math.min(e+f,this._pages.length))}this._on_scroll(true);if(d){d.scroll_manager_is_done_resizing()}this._throttled_render_ads()},_remeasure_pages:function(j,f){var h,k,m=[],g=this._pages[j-1]||null,l=g?(g.offset+g.height):0,e=(new Date).getTime();for(h=j;h<f;h++){k=this._pages[h];if(!k.is_on_screen){m.push(k);k.$node.insertBefore(this._$bottom_buffer);k.is_on_screen=true}}for(h=j;h<f;h++){k=this._pages[h];if(k.last_measured_at+this._remeasure_throttle<e){k.measure()}k.offset=l;l+=k.height}for(h=0;h<m.length;h++){m[h].stash()}},_measure_viewport:function(){this._viewport_height=(window.innerHeight?window.innerHeight:this._$w.height())},_find_at_offset:function(h,f){var e=Math.max(f,0),g=this._pages[e];if(g.offset>h){do{e--;g=this._pages[e]}while(e>=0&&g&&g.offset>h);return e}else{if((g.offset+g.height)<h){do{e++;g=this._pages[e]}while(e<this._pages.length&&g&&(g.offset+g.height)<h);return(e<this._pages.length)?e:-1}}return e}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.scroll_manager.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/gmi.js","jms/lib/jquery/jquery.current.js"],function(){(function(a){window.BrowseLikeThisPreviewSelection=window.PreviewStreamSelection.extend({_jump:null,retry_jump:function(){if(this._jump){this.setRelativeSelection(this._jump,null,true);this._jump=null}},setRelativeSelection:function(c,d,f){var g,e,b,h;if(!f){if(this._jump){return}g=this.getSelection(true);h=this.preview_stream_owner;for(e in g){e=Number(e);b=e+c;if(b>=h.contents.length){this._jump=c;PubSub.publish("BrowseLikeThisStream.load_next",true);return}break}}(window.SimpleSelection.prototype.setRelativeSelection.bindTo(this))(c,d)},isSelectable:function(b){return a(b).hasClass("tt-a")||a(b).hasClass("deviation-full-data")},getAllSelectable:function(){return this.preview_stream_owner.get_all_selectable_result_nodes()}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.previewselection.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/popup2.js",".domready"],function(){(function(b){b(".browse-top-bar-mc-filter").on("click",function(){var d=b(this);b(".mature-filter-popup-container").hide();if(!deviantART.deviant.loggedIn){window.location="https://www.deviantart.com/join/?from=mature";return false}var c=Number(d.data("value"))?1:0;DiFi.pushPost("Settings","updateMatureFilter",[c],function(f,e){if(f){window.location.reload()}else{d.removeClass("working disabled");alert("Sorry there was an error while changing your settings.\n\nYou must be 18 or over to turn off mature filter.\n\nIf you are, please try again in a minute.")}});d.addClass("working").addClass("disabled");DiFi.send()});var a=false;b(".browse-top-bar-mc-filter-trigger").on("mousedown",function(){if((a)&&(a.visible())){return false}});b(".browse-top-bar-mc-filter-trigger").on("click",function(){var c=b(this);if(!a){a=new Popup2("BrowseMaturePopup","body",{classes:"browse-mature-popup",content:b(".mature-filter-popup-container").clone(true).show(),hidden:function(){c.removeClass("popupactive")},shown:function(){c.addClass("popupactive")}})}if(a.visible()){a.hide()}else{a.show(a.position(c.parent(),{align:"center"}))}return false});window.BrowseLikeThisSearchBox=GMIBase.extend({_$input:null,_$term:null,_$button:null,_initial_val:"",_initially_disabled:false,gmiConstructor:function(){this.$.removeClass("dwait");this._init_terms();this._init_input();b(".browse-top-bar .browse-search-container").click(this._search_container_click.bindTo(this));b(".browse-top-bar .search-clear").click(this._clear_search_box.bindTo(this));b(".browse-top-bar .browse-search-input").blur(this._input_blur.bindTo(this))},_init_terms:function(){this._$term=this.$.find(".search-term-container")},_init_input:function(){this._$input=this.$.find(".browse-search-input");this._$button=this.$.find(".browse-search-button");this._initial_val=this._$input.val();this._initially_disabled=this.$.hasClass("disabled");this._$input.on("keydown",this._input_keydown.bindTo(this));this._$input.on("keyup",this._input_keyup.bindTo(this));if(!window.location.hash&&!this._initially_disabled){this._make_editable(true)}else{this._input_blur()}},_clear_search_box:function(){this._make_editable(false);return false},_search_container_click:function(){if(!this._$input.is(":focus")){this._make_editable(true)}return false},_make_editable:function(c){this._$term.hide();this.$.removeClass("disabled");this._$button.attr("disabled",false);this._$input.attr("disabled",false).removeClass("disabled").show();if(b.browser.mozilla){this._$input.css("position","fixed").focus().css("position","static")}else{this._$input.focus()}this._$input.select();if(!c){this._$input.val("")}if(this._$input.val()==""){this.$.find(".search-box-clear").hide()}},_input_blur:function(){var c=this._$input.val();if(c==this._initial_val){this._$input.hide();this._$term.show();this._$input.val(this._initial_val);if(this._initially_disabled){this.$.addClass("disabled");this._$input.attr("disabled",true);this._$button.attr("disabled",true);this.$.find(".search-box-clear").hide()}else{this.$.find(".search-box-clear").show()}}},_input_keydown:function(c){if(c.keyCode in {40:0,34:0,35:0}&&b(this).val()==""){b(this).blur()}},_input_keyup:function(){this.$.find(".search-box-clear").toggle(this._$input.val()!=="")}});b(function(){b(":gmi(BrowseLikeThisSearchBox)").gmi()})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.top_bar.js")}});
DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js"],function(){(function(b){var c=Base.extend({handlers:{show_more_clicked:function(f){f.preventDefault();var e=b(f.currentTarget).closest(".minimore");var d=e.data("MiniMoreLoader");if(!d){d=new a(e);e.data("MiniMoreLoader",d)}d.load_more()}},constructor:function(){b("#browse-results").on("click",".mini-show-more",this.handlers.show_more_clicked.bindTo(this))}});var a=Base.extend({$node:null,$deviations:null,$show_more_button:null,offset:0,params:null,portal_api:null,default_params:{length:24},templates:{loading:"<div class='comments-loading browse-loading'>Loading...</div>",end:"<div class='browse-done'>End of Results</div>"},constructor:function(d){this.$node=d;this.$deviations=this.$node.find(".deviations");this.$show_more_button=this.$node.find(".mini-show-more");this.params=this.$node.data("params");this.portal_api=d.data("portal_api")},load_more:function(){this.show_loading();var d=b.extend({},this.default_params,this.params);DiFi.pushPublicGet("PortalCore","get_result_thumbs",[this.portal_api,d],this.load_more_done.bindTo(this));DiFi.send()},load_more_done:function(j,h){this.remove_loading();var f=h.response.content.resources;var d=new Array();var g=this.$node.data("seed_id");this.$deviations.addClass("expanded").children(".hidden-thumb").show();if(h.response.content.error){this.end_of_results();return}for(var e=0;e<(f.length||0);e++){if(f[e][0]==1&&f[e][1]!==g){d.push(f[e][2])}}this.$deviations.append(d.join(""));if(h.response.content.has_more){this.params.offset=parseInt(this.params.offset)+h.request.args[1].length}else{this.end_of_results()}},show_loading:function(){this.$show_more_button.before(this.templates.loading)},remove_loading:function(){this.$node.find(".comments-loading").remove()},end_of_results:function(){this.$show_more_button.before(this.templates.end);this.$show_more_button.remove()}});new c()})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.minimore.js")}});if(window.DWait){DWait.count()}