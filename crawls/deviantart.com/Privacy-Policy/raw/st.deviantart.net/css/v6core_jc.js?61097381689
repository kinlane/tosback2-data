/*
 *  (c) 2000-2013 deviantART, Inc. All rights reserved.
 */
window.FilmBox={hover:function(e){var a=$(e);var d=a.width();var c=a.find("b.film");Station.stopAnimation(c[0]);var f=parseInt(Station.read(c[0],"left"))||0;var b=[c[0],"left",{from:f,to:f,time:500}];while(f>-(d*5)){b=b.concat([{from:f,to:f=((f-d)-(f%d)),time:300,f:Interpolators.pulse},{from:f,to:f,time:700}])}Station.run.apply(Station,b)},out:function(a){$filmstrip=$(a).find("b.film");Station.stopAnimation($filmstrip[0]);Station.run($filmstrip[0],"display",{to:"block",time:25},"left",{from:parseInt(Station.read($filmstrip[0],"left")||0),to:0,f:Interpolators.pulse,time:600})}};if(window.DWait){DWait.run("jms/lib/filmbox.js")};
DWait.ready(["jms/lib/minibrowse.view.js","jms/lib/pubsub.js","jms/lib/analytics.js"],function(){(function(b){var a={_has_next:false,_has_prev:false,_has_mobile_ad:true,_textad_suppressed:false,_current_item_id:null,_reload_anchor:null,constructor:function(){PubSub.subscribe([{eventname:"MinibrowseView.take_over_page",subscriber:this,callback:this.da__handlers.take_over_page},{eventname:"MinibrowseView.restore_page",subscriber:this,callback:this.da__handlers.restore_page},{eventname:"MinibrowseView.populate_main",subscriber:this,callback:this.da__handlers.populate_main},{eventname:"MinibrowseView.populate_extra",subscriber:this,callback:this.da__handlers.populate_extra},{eventname:"MinibrowseView.preload_main",subscriber:this,callback:this.da__handlers.preload_main},{eventname:"MinibrowseView.preload_extra",subscriber:this,callback:this.da__handlers.preload_extra},{eventname:"MinibrowseView.populate_failed",subscriber:this,callback:this.da__handlers.populate_failed},{eventname:"MinibrowseView.init_extras",subscriber:this,callback:this.da__handlers.init_extras},{eventname:"Duperbrowse.has_next",subscriber:this,callback:this.da__handlers.has_next},{eventname:"Duperbrowse.has_prev",subscriber:this,callback:this.da__handlers.has_prev},{eventname:"Duperbrowse.opened",subscriber:this,callback:this.da__handlers.opened},{eventname:"Duperbrowse.pageload_failed",subscriber:this,callback:this.da__handlers.pageload_failed},{eventname:"Duperbrowse.disable_paddle",subscriber:this,callback:this.da__handlers.disable_paddle}])},da__handlers:{populate_main:function(d,c){PubSub.publish("PageViewTracker.pageview",{page:"/vpv"+Glbl("Location.path"),tag:"Dynamic.Deviation"});if(window.DDD){DDD.subject=null}var e=this._get_container();if(e.find("iframe.madefire-player").length){e.addClass("madefire")}},populate_extra:function(f,d){var g=this._get_container(),c=b(".resview7-about .sban-dyn",g),e=b(".resview7-meta .sbmn-dyn",g);if(vms_feature("new_devpage")){c=b(".dev-view-about .dev-view-about-content",g);e=b(".dev-view-meta .dev-view-meta-content",g)}if(Glbl("Site.is_mobile")&&deviantART.pageData.overlay_sponsor&&b("#superbrowse-deviation-ad").length===0){g.prepend('<div id="superbrowse-deviation-ad"></div>')}if(d.edit===true){DWait.ready(["jms/pages/ile/ile.js"],b.proxy(function(){c.html(d.content.html_col1);e.html(d.content.html_col2);g.prepend(c.find("#ile-container"));PubSub.publish("InlineEditor.open");g.show();this._init_deviation_extras(d,c,e)},this))}else{c.html(d.content.html_col1);e.html(d.content.html_col2);this._init_deviation_extras(d,c,e)}if(d.content){gWebPage.update(d.content)}},take_over_page:function(c){this._get_container().css("min-height",b(window).height());b("#depths").appendTo("body");b("#depths").show();if(!Glbl("Site.is_mobile")&&(!deviantART.deviant.loggedIn||deviantART.deviant.ads)){if(!Glbl("ads.minibrowse_has_textbanner")){Glbl("ads.minibrowse_has_textbanner",true);this._get_container().prepend('<div class="textbanner-ad is-visible"><div class="tbacontent"></div></div>')}else{b(".textbanner-ad").addClass("loading is-visible")}}if(window.Popup2){Popup2.hideAll()}this._take_over_overhead_box();this._add_loading_text()},restore_page:function(c){this._restore_overhead_box();this._current_item_id=null;b("#ile-container").empty();Glbl("InlineEditor.loaded",false)},has_next:function(d,c){this._has_next=Boolean(c)},has_prev:function(d,c){this._has_prev=Boolean(c)},opened:function(c,d){if(this.debugging){console.log("[MinibrowseView] Duperbrowse has been opened")}this._current_item_id=d.id},preload_main:function(e,d){var f=d.content;switch(f.pageData.deviation_preload_type){case"image":var c=b(":gmi(ResViewSizer_img)",f.html).first();this._preload_image(c.attr("src"));break;case"embed":this._preload_image(f.pageData.deviation_preload_file);break;case"html":this._preload_html(f.html);break;case"none":break;default:if(this.debugging){console.log("[MinibrowseView] unknown preload type:",f.pageData.deviation_preload_type)}}},preload_extra:function(d,c){var f=c.content;var e=b("img.avatar",f.html_col1).first();this._preload_image(e.attr("src"))},populate_failed:function(d,e){var c='<div><h1 style="color:#607066;text-align:center;padding-top:4em;">An error occurred while displaying this deviation</h1><p style="text-align:center;">Please visit <a href="'+Glbl("Location.path")+'">the deviation page</a> to try again.</p></div>';if(vms_feature("new_devpage")){b(".dev-page-container.minibrowse-container").html(c)}else{b("div#dv7").html(c)}},pageload_failed:function(d,e){var c='<div><h1 style="color:#607066;text-align:center;padding-top:4em;">An error occurred while loading the next set of deviations</h1><p style="text-align:center;">Please try again.</p></div>';if(vms_feature("new_devpage")){b(".dev-page-container.minibrowse-container").html(c)}else{b("div#dv7").html(c)}},disable_paddle:function(d,e){var c=e===true?".minibrowse_prev":".minibrowse_next";b(c,window.da_overhead_box.$node).addClass("disabled")},init_extras:function(f,d){var g=this._get_container(),c=b(".resview7-about .sban-dyn",g),e=b(".resview7-meta .sbmn-dyn",g);if(!c.length){c=b(".resview7-about",g)}if(!e.length){e=b(".resview7-meta",g)}if(vms_feature("new_devpage")){c=b(".dev-view-about .dev-view-about-content",g);e=b(".dev-view-meta .dev-view-meta-content",g)}this._init_deviation_extras(d,c,e)}},_preload_html:function(c){if(!c){return}if(this.debugging){console.log("[MinibrowseView] preloading HTML")}var d=this._make_preloader(b("<iframe><html><body></body></html></iframe>")).find("body").html(c).each(function(){b(this).find("embed, object").remove()}).end().appendTo("body");return d},_preload_image:function(d){if(!d){return}if(this.debugging){console.log("[MinibrowseView] preloading image",d)}var c=this._make_preloader(b("<img>")).attr("src",d).appendTo("body");return c},_make_preloader:function(c){return c.css({position:"absolute",top:-100,left:-100,width:1,height:1,overflow:"hidden",visibility:"hidden"}).load(function(){b(this).remove()})},_take_over_overhead_box:function(){var g=window.da_overhead_box.$node,i="",e="",d=!this._has_prev?" disabled":"",f=!this._has_next?" disabled":"";i+='<td class=f><a href="javascript:void(0)" class="gmbutton2 gmhuge gmbutton2top ntfirst minibrowse_prev'+d+'"><img src="//st.deviantart.net/minish/main/superbrowse/3dleft.png" alt="Left" width=8 height=9> Prev</a></td>';i+='<td class=f><a href="javascript:void(0)" class="gmbutton2 gmhuge gmbutton2top ntmid minibrowse_close">&nbsp;<img src="//st.deviantart.net/minish/main/superbrowse/3dback.png" alt="All" width=9 height=9> All&nbsp;</a></td>';i+='<td class=f><a href="javascript:void(0)" class="gmbutton2 gmhuge gmbutton2top ntlast minibrowse_next'+f+'">Next <img src="//st.deviantart.net/minish/main/superbrowse/3dright.png" alt="Right" width=8 height=9></a></td>';window.da_overhead_box.setHTML(i);if(!window.da_overhead_box.$node.data("minibrowse_paddles_bound")){window.da_overhead_box.$node.data("minibrowse_paddles_bound",true).on("click.minibrowse",".minibrowse_prev",function(j){if(!b(this).hasClass("disabled")){PubSub.publish("Minibrowse.prev_click")}return false}).on("click.minibrowse",".minibrowse_next",function(j){if(!b(this).hasClass("disabled")){PubSub.publish("Minibrowse.next_click")}return false}).on("click.minibrowse",".minibrowse_close",function(j){PubSub.publish("Minibrowse.close_click");return false})}var h=b(document.body);if(!h.data("minibrowse_keys_bound")){var c=this;h.data("minibrowse_keys_bound",true).on("keydown.minibrowse",function(j){if(c._get_eventname_from_keypress(j)){j.preventDefault()}}).on("keyup.minibrowse",function(k){var j=c._get_eventname_from_keypress(k);if(!j){return}if(window.Popup2){Popup2.hideAll()}PubSub.publish(j)})}},_get_eventname_from_keypress:function(e){var d={39:"Minibrowse.next_click",37:"Minibrowse.prev_click",27:"Minibrowse.close_click"};if(!d[e.which]){return}if(e.metaKey||e.altKey||e.shiftKey||e.ctrlKey){return}var c=b(e.target);if((e.target.isContentEditable||c.attr("contenteditable")||c.is(":input"))&&c.is(":visible")){return}return d[e.which]},_restore_overhead_box:function(){b(document.body).off(".minibrowse").removeData("minibrowse_keys_bound");window.da_overhead_box.$node.off(".minibrowse").removeData("minibrowse_paddles_bound");window.da_overhead_box.setHTML(null)},_add_loading_text:function(){var d=b('<h1 class="loading_text" style="color:#607066;text-align:center;padding:4em 0">Loading...</h1>');var c=function(){d.animate({opacity:0.3},700,e)};var e=function(){d.animate({opacity:0.99},700,c)};if(vms_feature("new_devpage")){this._get_container().find(".dev-view-deviation").append(d)}else{b(":gmi(ResourcePageDisplayPane)","body > div#dv7").append(d)}c()},_init_deviation_extras:function(f,g,q){if(Glbl("ResView.message_button")===true){Glbl.del("ResView.message_button");buttons=GMI.query(q[0],"ResourceViewMessageButton");for(var h=0,o=buttons.length;h<o;h++){buttons[h].render()}}buttons=GMI.query(g[0],"GPageButton").concat(GMI.query(g[0],"GMoodButton"));for(var h=0,o=buttons.length;h<o;h++){b(buttons[h].gmi_node).on("click.comments_pager",this._comments_pager_click.bindTo(this));buttons[h].gmi_node.eventonclickclaimed=1}if(this._has_mobile_ad){b("#superbrowse-deviation-ad").html(f.content.html_col3||"")}if(Glbl("ads.minibrowse_has_textbanner")){var m=f.content.banner_ad,c=b(".textbanner-ad").addClass("is-visible").removeClass("loading").find(".tbacontent"),e=c.find("iframe").length,r=b.now(),n=r-(Glbl("ads.ts_last_bannerad")||0);if(f.content.bannerhide){c.closest(".textbanner-ad").removeClass("is-visible");PubSub.publish("DaGa.track_event",{category:"Deviation",action:"ad_impressions_suppressed",label:"sb_"+(((window.deviantART||{}).deviant||{}).loggedIn?"loggedin":"loggedout")})}else{if(!m){if(deviantART.deviant.loggedIn){c.html(['<div style="text-align:center">','<h2 style="margin:4px 0 0 0;">','<a href="https://www.deviantart.com/checkout/?mx=premium&subpref=22870_0&utm_source=deviantart&utm_medium=header&utm_campaign=030713_MKT_PremiumHeader">',"Receive advanced feedback on your art with Critiques &#187;","</a>","</h2>",'<a style="text-decoration:none;" href="https://www.deviantart.com/checkout/?mx=premium&subpref=22870_0&utm_source=deviantart&utm_medium=header&utm_campaign=030713_MKT_PremiumHeader">',"Upgrade to a deviantART Premium Membership today!","</a>","</div>"].join(""))}else{c.html(['<div style="text-align:center">','<h2 style="margin:4px 0 0 0;">','<a href="http://www.deviantart.com/join/?joinpoint=Ads&utm_source=DA&utm_medium=banner-textad">',"Join deviantART for FREE &raquo;","</a>","</h2>",'<a style="text-decoration:none;" href="http://www.deviantart.com/join/?joinpoint=Ads&utm_source=DA&utm_medium=banner-textad">',"Collect, Watch, Comment, Contribute. Join the world's largest art community today!","</a>","</div>"].join(""))}}else{if(!e||n>10000){if(vms_feature("new_devpage")){var l=b(".dev-view-about",this._get_container()).width()-64}else{var l=b(":gmi(ResourcePageAboutPane)","body > div#dv7").width()-64}m=m.replace('style="','style="max-width:'+l+"px;");b(m).appendTo(c.empty());Glbl("ads.ts_last_bannerad",r)}}}}if(deviantART&&deviantART.pageData.is_not_favouritable){b("#zoomed-in").addClass("no-lub")}if(f.content.pageData&&f.content.pageData.deviation_has_print==1){var p="sb_"+(deviantART.deviant.loggedIn?"loggedin":"loggedout");var j=(f.content.pageData||{}).printtabs_group;if(j){p+="_printtabs_"+j}PubSub.publish("DaGa.track_event",{category:"Deviation",action:(f.content.pageData.deviation_has_printtabs==1)?"printtabs_pageview":"printbutton_pageview",label:p})}else{((window.deviantART||{}).pageData||{}).deviation_has_print=0;((window.deviantART||{}).pageData||{}).deviation_has_printbutton=0;((window.deviantART||{}).pageData||{}).deviation_has_printtabs=0}b(":gmi(ResourceViewFaveButton)",q).gmi();b(":gmi(ResourceViewVoteButton)",q).gmi();b(":gmi(ResourceViewPrintButton)",q).gmi();b(":gmi(ResourceViewWatchButton)",q).gmi();if("test"==((window.deviantART||{}).pageData||{}).dock_atf_test_group){b(":gmi(ResourcePageAtfDockAd)",q).gmi()}b(":gmi(ResourcePageMLTPreviewClickTracker)",q).gmi();b(":gmi(ResourcePageBtfDockAd)",q).gmi();b(":gmi(ResourceViewShare)",q).gmi();b(":gmi(ResourceStream)",q).gmi();if(this._reload_anchor){var k=b("a[id="+this._reload_anchor+"]").first().offset().top;var d=b(window).scrollTop();if(!(k>d&&k<(d+b(window).height()))){b(window).scrollTop(k)}this._reload_anchor=null}PubSub.publish("DeviationExtras.loaded")},_comments_pager_click:function(h){var g=0,k=false,c=b(h.currentTarget),j={};if(c.attr("gmi-offset")){g=c.attr("gmi-offset");k=true;j.offset=g}if(c.data("gmiclass")=="GMoodButton"){j.offset=g;var i=c.attr("href").match(/moodonly=(\d+)/);if(i){j.moodonly=i[1];k=true}else{if(c.hasClass("moodx")){k=true}}}if(window.PaginationGoto){window.PaginationGoto.clearSuperbrowsableData();var d=GMI.query(h.target,"GPageButton");if(d&&d[0].gmi_args.gotoboxinputid){var l=b("#"+d[0].gmi_args.gotoboxinputid);var f=window.PaginationGoto.calculateOffsetFromPageNumber(l.val(),d[0].gmi_args.currentpage,d[0].gmi_args.lastpage,d[0].gmi_args.interval);if(f===false){window.PaginationGoto.errorAlert()}else{g=f;j.offset=g;k=true}}}if(k){this._reload_anchor="comments";PubSub.publish("Minibrowse.reload_extras",{itemid:this._current_item_id,extras_parameters:j})}return false}};if(Glbl("Site.is_deviantart")){PubSub.publish("MinibrowseView.js_factory",a)}})(jQuery);if(window.DWait){DWait.run("jms/lib/minibrowse.view.da.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/location.js","jms/lib/minibrowse.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/pages/duperbrowse/duperbrowse.helpers.js"],function(){(function(){var f="prev",d="next",b=/^\/?art\/.+-([0-9]+)$/,h=/^\/?art\/.+-([0-9]+)\?hf=1$/,c=false,a;if(window.location.hash&&!window.location.pathname.match(b)&&Glbl("Location.path").match(b)&&!document.referrer.match("deviantart")){console.log("[Duperbrowse] redirecting to canonical URL from hash");PubSub.publish("Location.redirect_to_canonical_url");return}else{if(Glbl("Location.path").match(b)&&!Glbl("Location.pushstate_enabled")){c=true;a=b}else{if(Glbl("Location.path").match(h)){c=true;a=h}}}if(Glbl("Duperbrowse.disabled")){console.log("[Duperbrowse] disabled");return}var e=Base.extend({debugging:false,is_open:false,opened_from:null,streams:[],stream_stack:[],current_stream:null,deviation_urls:{},last_scroll_position:0,active_promise:null,last_url_was_faked:false,last_open_was_faked:false,waiting_for_next_item:false,waiting_for_prev_item:false,subscribed:false,constructor:function(){if(this.debugging){console.log("[Duperbrowse] instance created from:",window.location.href)}PubSub.subscribe([{eventname:"Duperbrowse.map_url",subscriber:this,callback:this.handlers.map_url},{eventname:"Location.changed",subscriber:this,callback:this.handlers.location_changed},{eventname:"Location.anchor_changed",subscriber:this,callback:this.handlers.location_changed},{eventname:"Location.changed_without_push",subscriber:this,callback:this.handlers.bad_location_state}]);if((!Browser.isChrome&&!Browser.isSafari&&!Browser.isIE10)&&Glbl("Location.pushstate_enabled")){$(window).on("unload.duperbrowse",this.handlers.fix_redirect_history.bindTo(this))}$(window).on("popstate.duperbrowse",this.handlers.popstate.bindTo(this))},subscribe:function(){if(this.subscribed){return}this.subscribed=true;PubSub.subscribe([{eventname:"Minibrowse.next_click",subscriber:this,callback:this.handlers.next_click},{eventname:"Minibrowse.close_click",subscriber:this,callback:this.handlers.close_click},{eventname:"Minibrowse.prev_click",subscriber:this,callback:this.handlers.prev_click},{eventname:"DeviationExtras.loaded",subscriber:this,callback:this.handlers.extras_loaded}])},handlers:{popstate:function(i){if(this.is_open&&!i.originalEvent.state&&!Glbl("Location.path").match(b)){this.close_silently()}},next_click:function(i){this.next()},prev_click:function(i){this.prev()},close_click:function(i){this.close()},extras_loaded:function(j){if(!this._ready_to_preload()){return}var k;if(this.current_stream.direction===d){if(this.current_stream.has_next_callback()){k=this.current_stream.next_item_callback()}}else{if(this.current_stream.has_prev_callback()){k=this.current_stream.prev_item_callback()}}if(!k){if(this.debugging){console.log("[Duperbrowse] ready to preload, but could not get item")}return}var i=this;k.done(function(l){if(i.debugging){console.log("[Duperbrowse] preloading",i.current_stream.direction,l)}PubSub.publish("Minibrowse.preload",l.itemid)})},location_changed:function(l,n){if(this.debugging){console.log("[Duperbrowse] location changed",JSON.stringify(n))}var m;if(c){c=false;m=Glbl("Location.path").match(a);if(m&&m[1]){this.last_open_was_faked=true;DWait.ready(".domready",function(){this._open_fake(m[1])}.bindTo(this))}if(this.debugging){console.log("[Duperbrowse] Opened duper instead of redirect",History.state)}}if(this.is_open&&this.last_open_was_faked&&n.origin==="hashchange"&&Glbl("Location.pushstate_enabled")){this.close_silently();this.last_open_was_faked=false}if(n.origin==="hashchange"&&Glbl("Location.pushstate_enabled")&&Glbl("Location.path").match(h)){m=Glbl("Location.path").match(h);if(m&&m[1]){this._open_fake(m[1])}}if(n.origin!=="popstate"&&n.origin!=="hashchange"&&n.origin!=="anchorchange"){return}var k=window.location.pathname+window.location.search,i=(n.origin!=="hashchange"&&Glbl("Location.pushstate_enabled"));if(n.state&&n.state.duper_state){if(this.is_open&&!Glbl("Location.pushstate_enabled")&&!Glbl("Location.path").match(b)){this.close_silently();return}this.unfreeze_state(n.state);var j=this._get_browse_options(n.state.item);if(!j){if(this.debugging){console.log("[Duperbrowse] open failed")}return}PubSub.publish("Minibrowse.open",j)}else{if(this.is_open&&k!==n.path&&i){this.close_silently()}else{if(this.is_open&&k===n.path&&this.current_stream){PubSub.publish("Location.push",{url:window.location.pathname+window.location.search+window.location.hash,state:this.freeze_state({itemid:this.current_stream.current_id,stream_offset:this.current_stream.current_offset}),replace:true})}else{if(i){this.clear_state()}else{if(!Glbl("Location.pushstate_enabled")&&n.origin==="hashchange"){if(this.streams.length===0&&n.origin==="hashchange"){m=Glbl("Location.path").match(b);if(m){if(this.debugging){console.log("[Duperbrowse] Got bad hashstate",n,this.streams,m[1])}if(m[1]){var o=null;if(!this.opened_from){o={url:n.path,title:window.document.title}}this._open_fake(m[1],o);return}}}if(window.Messages){return}this.close_silently()}}}}}},bad_location_state:function(i,j){if(this.streams.length===0&&j.origin==="popstate"&&(j.state&&j.state.duper_state)){if(this.debugging){console.log("[Duperbrowse] Got bad popstate",j,this.streams)}var k=null;if(!this.opened_from){k=j.state.opened_from}this._open_fake(j.state.item.itemid,k)}},map_url:function(i,j){if($.isPlainObject(j)&&j.itemid&&j.url){if(!this.deviation_urls[j.itemid]){this.deviation_urls[j.itemid]={}}this.deviation_urls[j.itemid][this._get_context(j.context)]=j.url;if(this.current_stream&&this.current_stream.current_id==j.itemid&&this.last_url_was_faked){this.last_url_was_faked=false;PubSub.publish("Location.push",{url:this._get_url(j.itemid,this._get_context(j.context)),state:this.freeze_state({itemid:this.current_stream.current_id,stream_offset:this.current_stream.current_offset}),replace:true})}}},fix_redirect_history:function(){if(this.is_open&&Glbl("Location.pushstate_enabled")&&window.location.pathname.match(b)){PubSub.publish("Location.push",{url:"/#"+window.location.pathname+"?hf=1",state:{},replace:true})}}},push_stream:function(i){Glbl("Duperbrowse.preload_active",0);this.streams.push(i);this.stream_stack.push(this.streams.length-1)},get_stream:function(i){return this.streams[i]},get_current_stream:function(){return this.streams[this.streams.length-1]},freeze_state:function(i){return{duper_state:true,debugging:this.debugging,is_open:this.is_open,opened_from:this.opened_from,stream_stack:this.stream_stack,last_scroll_position:this.last_scroll_position,last_url_was_faked:this.last_url_was_faked,item:i}},unfreeze_state:function(i){this.debugging=i.debugging;this.is_open=i.is_open;this.opened_from=i.opened_from;this.stream_stack=i.stream_stack;this.last_scroll_position=i.last_scroll_position;this.current_stream=this.get_stream(i.stream_stack[i.stream_stack.length-1]);this.last_url_was_faked=i.last_url_was_faked},clear_state:function(){this.opened_from=null;this.stream_stack=[];this.last_scroll_position=null;this.current_stream=null;this.last_url_was_faked=false},close_silently:function(){this.is_open=false;if(this.current_stream){var i=this.current_stream.scroll_position;setTimeout(function(){$(window).scrollTop(i)},1)}this.clear_state();PubSub.publish("Minibrowse.close");PubSub.publish("Duperbrowse.closed")},open:function(m,j){if(this.debugging){console.log("[Duperbrowse] open",m,j)}var n=this.get_stream(this.stream_stack[this.stream_stack.length-1]);if(!n){return this.close(true)}if(!this.is_open){this.is_open=true;this.opened_from={url:window.location.pathname+window.location.search+window.location.hash,title:window.document.title};this.subscribe()}var l=false;if(n!==this.current_stream){if(this.debugging){console.log("[Duperbrowse] moving into a new stream",n,this.current_stream,this)}this.current_stream=n;n.direction=d;n.direction_confirmed=false}if(m){n.current_id=m.itemid;n.current_offset=m.stream_offset}else{if(n.current_id){m={itemid:n.current_id,stream_offset:n.current_offset}}}var k=this._get_browse_options(m);if(!k){if(this.debugging){console.log("[Duperbrowse] open failed")}return}if(n.on_stream_item_opened){n.on_stream_item_opened(m)}if(n.has_next_callback){k.show_next=Boolean(n.has_next_callback());PubSub.publish("Duperbrowse.has_next",k.show_next)}if(n.has_prev_callback){k.show_prev=Boolean(n.has_prev_callback());PubSub.publish("Duperbrowse.has_prev",k.show_prev)}var o=this._get_url(k.id,k.context);PubSub.publish("Location.push",{url:o,state:this.freeze_state(m)});PubSub.publish("Minibrowse.open",k);if(l){var i=this;this.current_stream.next_item_callback().done(function(p){if(i.debugging){console.log("[Duperbrowse] eager preloading",p)}PubSub.publish("Minibrowse.preload",p.itemid)})}PubSub.publish("Duperbrowse.opened",{id:k.id,url:o,fresh:Boolean(j)})},close:function(i){if(!this.is_open){return false}if(this.current_stream){this.last_scroll_position=this.current_stream.scroll_position}if(this.debugging){console.log("[Duperbrowse] close",i)}if(i){this.is_open=false;$(document).off(".duperbrowse");PubSub.publish("Minibrowse.close");if(this.opened_from&&this.opened_from.url){if(!Glbl("Location.pushstate_enabled")){this.opened_from.url=this.opened_from.url.replace(/^.*#/,"")}PubSub.publish("Location.set",this.opened_from.url);PubSub.publish("DuperBrowse.set_closing_location",this.opened_from.url)}if(this.opened_from&&this.opened_from.title){window.document.title=this.opened_from.title}this.opened_from=null;if(this.current_stream){$(window).scrollTop(this.last_scroll_position)}if(this.current_stream.on_stream_item_closed){this.current_stream.on_stream_item_closed(this.current_stream)}this.current_stream=null;this.stream_stack=[];PubSub.publish("Duperbrowse.closed",i)}else{this.stream_stack.pop();this.open()}},next:function(){if(!this.current_stream){return}if(this.waiting_for_next_item){return}if(!this.current_stream.has_next_callback()){return}PubSub.publish("Duperbrowse.next");PubSub.publish("DaGa.track_event",{category:"Duperbrowse",action:"navigate_next"});this._cancel_promise();var i=this;this.active_promise=this.current_stream.next_item_callback().done(function(j){i._ready_to_preload(d);i.open(j)}).fail(function(j){if(j===DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM||j===DuperbrowseHelpers.PROMISE_STATE_CANCELLED||j===DuperbrowseHelpers.PROMISE_STATE_OVERPAGED){return}PubSub.publish("Duperbrowse.pageload_failed",j)}).always(function(){i.waiting_for_next_item=false});if(this.active_promise.state()==="pending"){this.waiting_for_next_item=true}else{this.waiting_for_next_item=false}},prev:function(){if(!this.current_stream){return}if(this.waiting_for_prev_item){return}if(!this.current_stream.has_prev_callback()){return}PubSub.publish("Duperbrowse.prev");PubSub.publish("DaGa.track_event",{category:"Duperbrowse",action:"navigate_prev"});this._cancel_promise();var i=this;this.active_promise=this.current_stream.prev_item_callback().done(function(j){i._ready_to_preload(f);i.open(j)}).fail(function(j){if(j===DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM||j===DuperbrowseHelpers.PROMISE_STATE_CANCELLED||j===DuperbrowseHelpers.PROMISE_STATE_OVERPAGED){return}PubSub.publish("Duperbrowse.pageload_failed",j)}).always(function(){i.waiting_for_prev_item=false});if(this.active_promise.state()==="pending"){this.waiting_for_prev_item=true}else{this.waiting_for_prev_item=false}},_ready_to_preload:function(i){if(!this.current_stream){return}if(i===f||i===d){if(this.current_stream.direction!==i){Glbl("Duperbrowse.preload_active",0);this.current_stream.direction=i;this.current_stream.direction_confirmed=false;if(this.debugging){console.log("[Duperbrowse] user started moving",i)}}else{if(!this.current_stream.direction_confirmed){this.current_stream.direction_confirmed=true;if(this.debugging){console.log("[Duperbrowse] user confirmed moving",i)}}}if(this.current_stream.direction_confirmed){Glbl.plus("Duperbrowse.preload_active")}}return this.current_stream.direction_confirmed},_get_url:function(j,i){var k=(this.deviation_urls[j]||{})[this._get_context(i)];if(k){k=k.replace(/^.*[\/]/g,"")}else{if(j){k="d"+parseInt(j,10).toString(36);this.last_url_was_faked=true}else{return false}}if(this.debugging){console.log("[Duperbrowse] got url for item",j,i,k)}return"/art/"+k},_get_context:function(i){return i||"default"},_get_browse_options:function(i){if(!i||!i.itemid){return false}return{id:i.itemid,type:i.type,context:i.context,show_next:false,show_prev:false}},_cancel_promise:function(){if(this.active_promise&&this.active_promise.state()==="pending"&&this.active_promise.cancel){this.active_promise.cancel();if(this.debugging){console.log("[Duperbrowse] Cancelled pending promise",this.active_promise)}}},_open_fake:function(j,i){this.current_stream={scroll_position:0};this.subscribe();this.is_open=true;this.opened_from=i||null;this.stream_was_faked=true;if(this.deviation_urls[j]){Glbl("Location.path",this.deviation_urls[j])}PubSub.publish("Minibrowse.open",{id:j,type:1,show_next:false,show_prev:false})}});var g=new e();window.Duperbrowse={open:function(i,j){if(g.waiting_for_item){j=g.get_current_stream()}j=$.extend({current_id:i.itemid,current_offset:i.stream_offset,scroll_position:$(window).scrollTop()},j);if(!g.waiting_for_stream){g.push_stream(j)}g.open(i,true)},close:function(i){g.close(i)},debug:function(i){g.debugging=Boolean(i);if(g.debugging){console.log("[Duperbrowse] master debugging enabled")}}}})();if(window.DWait){DWait.run("jms/pages/duperbrowse/duperbrowse.master.js")}});
DWait.ready(["jms/thirdparty/lib/spin.js","jms/lib/spinpreset.js"],function(){(function(){var a={PROMISE_STATE_END_OF_STREAM:1,PROMISE_STATE_CANCELLED:2,PROMISE_STATE_OVERPAGED:3,click_handler:function(c){var b={open_duperbrowse:true,click_return:false,wait_for_load:false};if(c.metaKey||c.altKey||c.shiftKey||c.ctrlKey){b.open_duperbrowse=false;b.click_return=true}if(c.which>1){b.open_duperbrowse=false;b.click_return=true}if(Glbl("Duperbrowse.pause")===true){b.open_duperbrowse=false;b.click_return=true}return b},map_url:function(d,b,c){if(b){PubSub.publish("Duperbrowse.map_url",{itemid:d,url:b,context:c})}},get_element_super_dimensions:function(b){var d={};if(b.data("super-img")){var c={"super-img":"src","super-width":"width","super-height":"height","super-full-img":"full_src","super-full-width":"full_width","super-full-height":"full_height","super-transparent":"transparent"};$.each(c,function(f,e){var g=b.data(f);if(g){d[e]=g}})}return d},cache_dimensions_for_item:function(b,d){var c=this.get_element_super_dimensions(b);if(!$.isEmptyObject(c)){c.id=d;PubSub.publish("Minibrowse.cache_main_html_dimensions",c)}},cache_dimensions_for_legacy_item:function(b,e){var d={};var c={super_img:"src",super_w:"width",super_h:"height",super_fullimg:"full_src",super_fullw:"full_width",super_fullh:"full_height",super_transparent:"transparent"};$.each(c,function(g,f){var h=b.attr(g);if(h){d[f]=h}});if(!$.isEmptyObject(d)){d.id=e;PubSub.publish("Minibrowse.cache_main_html_dimensions",d)}},init_thumb_data:function(c,d,b){d.find(b).each(function(e,f){$anchor=$(this);if($anchor.length===0||d.length===0){return}DuperbrowseHelpers.cache_dimensions_for_item($anchor,c.itemid);DuperbrowseHelpers.map_url(c.itemid,$anchor.attr("href"),$anchor.data("duper-context"))});d.data(c)},scroll_to_thumb:function(e){var d=$(window),c=e.offset().top,b=d.scrollTop();if(!(c>b&&c<(b+d.height()))){d.scrollTop(c)}}};window.DuperbrowseHelpers=a})();if(window.DWait){DWait.run("jms/pages/duperbrowse/duperbrowse.helpers.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/plugins/jquery.gmi.js"],function(){(function(b){var c=vms_feature("dre");var a=Base.extend({constructor:function(){PubSub.subscribe([{eventname:"DuperbrowseStreamLoader.load",subscriber:this,callback:this.handlers.load}])},dot_to_camel:function(d){return(d+"").replace(/\b[a-z]/g,this.make_uppercase).replace(".","")},make_uppercase:function(d){return d.toUpperCase()},handlers:{load:function(g,h){if(!h||!h.stream||!/^[a-z]+\.[a-z]+$/.test(h.stream)){return}var e;if(h.gmi&&/^[a-zA-Z]+$/.test(h.gmi)){e=h.gmi}else{e="Duperbrowse"+this.dot_to_camel(h.stream)+"Stream"}var f;if(h.node){f=b(h.node)}else{var f=b(":gmi("+e+")")}if(!f.length){if(c){console.log("[DuperbrowseStream] loader aborted, GMI node not found",e)}return}if(window[e]&&!h.delay_gmi){f.gmi()}else{if(!f.hasClass("dwait_stream")){var d=(h.selector||"a.thumb, a.embedded-deviation");var i={stream_file:"jms/pages/duperbrowse/stream/"+h.stream+".stream.js",stream_gmi:e};if(c){console.log("[DuperbrowseStream] loader requested",i)}f.addClass("dwait_stream").on("click.dwait_stream",d,i,this.events.click)}}}},events:{click:function(e){if(e.metaKey||e.altKey||e.shiftKey||e.ctrlKey||e.which>1){return}if(!e.data||!e.data.stream_file||!e.data.stream_gmi){return}var d=b(e.target).addClass("dwaiting");DWait.ready(e.data.stream_file,function(){if(c){console.log("[DuperbrowseStream] loader finished",e.data.stream_file,e.data.stream_gmi)}d.closest(":gmi("+e.data.stream_gmi+")").off(".dwait_stream").gmi();d.removeClass("dwaiting").trigger("click")});return false}}});new a()})(jQuery);if(window.DWait){DWait.run("jms/pages/duperbrowse/loader/stream.loader.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/gmi.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.somedata.js","jms/pages/duperbrowse/duperbrowse.helpers.js"],function(){(function(d,c){var e={dataFetchComplete:function(l,n,j,h,m,k){ResourceStream.prototype.dataFetchComplete.call(this,l,n,j,h,m,k);var i=n,g={status:m,rids:[],total:k.response.content.total,offset:n,count:j};if(m){d.each(k.response.content.resources,function(o,p){if(d(p[2]).data("deviation-inactive")){i++;return}g.rids.push({itemid:p[1],stream_offset:i});i++})}this.$.trigger("dataFetchComplete",g)}};var a=0;var b=Base.extend({id:0,range_start:0,range_end:0,has_more:false,has_less:false,constructor:function(j,g,i,h){this.id=a;a++;this.range_start=j;this.range_end=g-1;this.has_more=i;this.has_less=h},offset_in_range:function(g){return(g>=this.range_start&&g<=this.range_end)}});var f=vms_feature("dre");c.DuperbrowseStandardResourceStream=Base.extend({_resource_stream:null,_current_page:null,_current_item:null,_current_offset:null,_pages:{},_missing_offsets:{},_previous_offset:0,paging_disabled:false,fake_paging:false,factory:function(h,i){var g="Duperbrowse"+(h.duperbrowse_class||"Standard")+"ResourceStream";if(!c[g]){if(f){console.log("[DuperbrowseStream] could not locate class for stream",h)}return}if(f){console.log("[DuperbrowseStream] creating resource stream",g)}return new c[g](i)},constructor:function(g){this._pages={};this._missing_offsets={};this._resource_stream=g;this._init_stream()},_init_stream:function(){this._bind_clicks();this._patch_resource_stream();if(this.fake_paging===true&&this._resource_stream.contents.length>this._resource_stream.gs_count_per_page){this._create_pages_from_overflow()}else{var g=new b(this._resource_stream.gs_offset,(this._resource_stream.gs_offset+this._resource_stream.gs_count_per_page),(parseInt(this._resource_stream.gs_more_to_load,10)===1),(this._resource_stream.gs_offset>0));this._current_page=g;this._pages[g.id]=g;this._find_missing_offsets(g)}},_patch_resource_stream:function(){this._resource_stream.extend(e);this._resource_stream.$.on("dataFetchComplete",this._handle_contents_change.bindTo(this))},_handle_contents_change:function(){this._bind_clicks()},_bind_clicks:function(){var g=this;d.each(this._resource_stream.contents,function(h,i){if(!i){return}var j=d(i[2]);if(j.length){g._init_thumb_data(h,i,j,"a.thumb");d("a.thumb, span a.t",j).off("click.duperbrowse").on("click.duperbrowse",g._open_duperbrowse.bindTo(g))}})},_init_thumb_data:function(j,i,k,g){var h={type:i[0],itemid:i[1],stream_offset:j};DuperbrowseHelpers.init_thumb_data(h,k,g)},_open_duperbrowse:function(j){if((j.metaKey||j.altKey||j.shiftKey||j.ctrlKey)&&this._resource_stream.edit_mode===true){j.preventDefault();return true}var l=DuperbrowseHelpers.click_handler(j),h=["itemid","stream_offset","type"];if(l.open_duperbrowse){var g=d(j.currentTarget),k=g.closest(".tt-a, .tt-aa").someData(h);if(!d.isEmptyObject(k)){var i={next_item_callback:this._next_item_callback.bindTo(this),prev_item_callback:this._prev_item_callback.bindTo(this),has_next_callback:this._has_next_callback.bindTo(this),has_prev_callback:this._has_prev_callback.bindTo(this),on_stream_item_opened:this._on_stream_item_opened.bindTo(this),on_stream_item_closed:this._on_stream_item_closed.bindTo(this)};k.wait_for_load=l.wait_for_load;Duperbrowse.open(k,i);return false}return true}return l.click_return},_get_item:function(h){var g=this._resource_stream.contents[h];if(this._missing_offsets[h]===true){return false}if(g===undefined){return g}if(!g[2]||d(g[2]).data("deviation-inactive")){return false}return{itemid:g[1],stream_offset:h}},_move_stream:function(g,i){this._resource_stream.gs_offset=g;this._resource_stream.domClearAll();var h=this._resource_stream.gs_count_per_page;d.each(this._missing_offsets,function(k,j){if(i&&i.offset_in_range(k)){h--}});this._resource_stream.domDrawRange(g,h);this._update_pager(g)},_update_pager:function(h){if(!this._resource_stream.gmi_args.pager_id){return}var g=d("#"+this._resource_stream.gmi_args.pager_id).gmi1();if(!g){return}g.update_to_offset(h)},_find_next:function(k){var i=(k==1?this._current_offset+1:this._current_offset-1),h=null,g=0;while(h===null){var j=this._get_item(i);if(j===undefined||!d.isEmptyObject(j)){h=j}else{i=(k==1?i+1:i-1)}g++;if(g>this._resource_stream.gs_count_per_page){h=undefined}}return h},_find_missing_offsets:function(j){for(var h=j.range_start,g=j.range_end+1;h<g;h++){if(this._resource_stream.contents[h]===undefined){this._missing_offsets[h]=true}}},_create_pages_from_overflow:function(){var k=Math.ceil(this._resource_stream.contents.length/this._resource_stream.gs_count_per_page),h=0,g,j;for(g=0;g<k;g++){j=new b(h,(h+this._resource_stream.gs_count_per_page),(g<(k-1)),(g>0));this._pages[j.id]=j;if(h===0){this._current_page=j}this._find_missing_offsets(j);h=h+this._resource_stream.gs_count_per_page}},_next_item_callback:function(){var g=this._find_next(true);if(g!==undefined){return d.Deferred().resolve(g).promise()}if(g===undefined&&this._current_page.has_more&&!this.paging_disabled){return this._create_next_item_promise(false)}return d.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_prev_item_callback:function(){var g=this._find_next(false);if(g!==undefined){return d.Deferred().resolve(g).promise()}if(g===undefined&&this._current_page.has_less&&!this.paging_disabled){return this._create_next_item_promise(true)}return d.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_has_next_callback:function(){var g=this._find_next(true);if(g!==undefined){return true}if(this._current_page.has_more===true){return true}return false},_has_prev_callback:function(){var g=this._current_offset-1;if(g<0){return false}var h=this._find_next(false);if(h!==undefined){return true}if(h===undefined&&this._current_page.has_less){return true}return false},_on_stream_item_opened:function(h){var j,i=false,g=this;if(this._get_item(h.stream_offset)!==undefined){j=this._get_item(h.stream_offset);this._current_item=j;this._current_offset=j.stream_offset;d.each(this._pages,function(l,k){if(g._current_page&&k.id!=g._current_page.id&&k.offset_in_range(h.stream_offset)){i=k}});if(i){this._move_stream(i.range_start,i);this._current_page=i}}else{this._current_item=null;this._current_offset=null}},_on_stream_item_closed:function(i){var h=this._resource_stream.contents[i.current_offset];if(h===undefined){return}var g=d(h[2]);if(g.length===0){return}DuperbrowseHelpers.scroll_to_thumb(g)},_handle_page_promise:function(g){var h=false;if(g.total&&this._resource_stream.contents.length<g.total){h=true}var i=new b(g.offset,(g.offset+g.count),h,(g.offset>0));this._current_page=i;this._pages[i.id]=i;this._find_missing_offsets(i);this._bind_clicks()},_handle_page_promise_failure:function(g,h){this._move_stream(this._previous_offset,this._current_page);if(g===DuperbrowseHelpers.PROMISE_STATE_OVERPAGED){if(h){this._current_page.has_less=false}else{this._current_page.has_more=false}PubSub.publish("Duperbrowse.disable_paddle",h)}},_create_next_item_promise:function(k){var l=d.Deferred(),i,j,m=false,h=this,g=this._resource_stream.gs_offset+this._resource_stream.gs_count_per_page;this._previous_offset=this._resource_stream.gs_offset;if(k){g=this._resource_stream.gs_offset-this._resource_stream.gs_count_per_page;if(g<0){g=0}}this._move_stream(g);this._resource_stream.$.on("dataFetchComplete",function(o,n){if(n.status){if(n.rids.length===0){l.reject(DuperbrowseHelpers.PROMISE_STATE_OVERPAGED,k)}else{l.resolve(n)}}else{l.reject("failed to load thumbs")}});l.done(h._handle_page_promise.bindTo(h)).fail(h._handle_page_promise_failure.bindTo(h));j=function(n){if(m){return d.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise()}return n.rids[0]};prev_pipe=function(n){if(m){return d.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise()}return n.rids[n.rids.length-1]};i=d.when(l.promise()).pipe((k===true?prev_pipe:j));i.cancel=function(){m=true};return i}})})(jQuery,window);if(window.DWait){DWait.run("jms/pages/duperbrowse/stream/standard.resource.stream.js")}});
DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/pages/duperbrowse/stream/standard.resource.stream.js"],function(){(function(b,a){a.DuperbrowseChannelResourceStream=DuperbrowseStandardResourceStream.extend({_init_stream:function(){var c=this._resource_stream.$.find("smoothie").attr("q");if(c=="special:newest"){this.paging_disabled=true}else{if(c&&c.match(/special:(popular|dd)/)){this.fake_paging=true}}this.base()}})})(jQuery,window);if(window.DWait){DWait.run("jms/pages/duperbrowse/stream/channel.resource.stream.js")}});
window.Subby={warning:function(f,h,g,e){var b=$(f),a,d,c;if(h===undefined){h="Get"}else{h=h||""}g=g||"this feature";e=e?" "+e:"";d='<div class="subblebubble">'+h+" <strong>"+g+"</strong>"+e+" when you upgrade to <strong>Premium&nbsp;Membership</strong></div>";a=$(d).css({visibility:"hidden",position:"absolute","z-index":300}).appendTo("body");b.addClass("subble").data("subby",a);c=Subby.getPosition(a[0],Ruler.document.jq_node(f));a.css({left:c.x,top:c.y,visibility:"visible"})},getPosition:function(d,b){var a,c;c={x:b.x,y:b.y2,w:d.offsetWidth,h:d.offsetHeight};c.x2=c.x+c.w;c.y2=c.y+c.h;a=Ruler.screen.rect();if((c.x2+30)>a.x2){c.x=Math.max(0,b.x2-c.w);c.x2=c.x+c.w}if(c.y2>a.y2){c.y=Math.max(0,b.y-c.h);c.y2=c.y+c.h}return c},out:function(b){var a;a=$(b).data("subby");if(a){a.remove()}$(b).data("subby",null)}};if(window.DWait){DWait.run("jms/pages/subby.js")};
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js"],function(){$(window).on("message.AdCatch",function(b){var a=b.originalEvent.data&&b.originalEvent.data.match?b.originalEvent.data.match(/^adcatch::(all|one)::/):false;if(!a||b.originalEvent.origin!=window.location.origin){return}DWait.ready("jms/modals/adcatch-modal.js",function(){PubSub.publish("AdCatchModal.prime",{is_all:(a[1]=="all"),content:b.originalEvent.data.substr(a[0].length)})})});if(window.DWait){DWait.run("jms/lib/adcatch_listener.js")}});
window.popupSitback=function(g,f,c,a){var e="http://justsitback.deviantart.com";var d="menubar=no,width=640,height=480,toolbar=no,status=no,location=no,directories=no,resizable=yes";if(Browser.isIE){g="Slideshow"}var b=e+"?title="+encodeURIComponent(g)+"&rssQuery="+encodeURIComponent(f);window.open(b,"SitBack",d);if(window.event){event.cancelBubble=true}return false};if(window.DWait){DWait.run("jms/pages/sitback.js")};
DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){(function(a){a(function(){var b;if(a("body").hasClass("maturehide")&&(b=a("#browse2 .tt-ismature, #browse-results .tt-ismature").length)&&(a("#browse2 .tt-a, #browse-results .tt-a").length==b)){a("#maturehider_explanation").show()}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browsesearch.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/quantcast.js","jms/lib/dtlocal.js","jms/lib/bind.js","jms/pages/ccommentthread.js","jms/lib/glbl.js","jms/lib/analytics.js"],function(){DWait.ready("jms/lib/gmi.js",function(){window.TalkPostWrapper=GMIBase.extend({gmiConstructor:function(){if(vms_feature("dre")){console.log("GMI Constructor")}var a;this.talkpost=new TalkPost(this);this.talkpost.node=this.gmi_node;this.talkpost.comment=this.gmi_args;this.reset=bind(this.talkpost,this.talkpost.reset);this.talkpost.hookDrawingUI();$(this.gmi_node).data("TalkPost",this.talkpost);this.textarea=this.gmi_node.getElementsByTagName("textarea")[0];a=this.getCacheName();if(TalkPostWrapper.textCache[a]){this.textarea.value=TalkPostWrapper.textCache[a].shift()||""}this.stdPostHook();if(vms_feature("comment_writer")){$(this.gmi_node).addClass("ccexpanded").children(".inputs").hide();$(this.gmi_node).find("textarea").addClass("writeranywhere");this.talkpost.commentwriter=WriterAnywhereFactory.get("comment",$(this.gmi_node).find("textarea"),false,true)}else{this.refreshTextareaState();this.textarea.onfocus=bind(this,this.textareaFocus);this.textarea.onblur=bind(this,this.textareaBlur);$(document.documentElement).bind("keydown",this.keypress=bind(this,this.keypress))}},gmiDestructor:function(){var a;$(document.documentElement).unbind("keydown",this.keypress);if(this.textarea){a=this.getCacheName();if(!TalkPostWrapper.textCache[a]){TalkPostWrapper.textCache[a]=[]}TalkPostWrapper.textCache[a].push(this.textarea.value||"")}this.talkpost.localDestroy()},previewClick:function(){this.talkpost.confirmPreview()},sendClick:function(){if(window.event){event.cancelBubble=true}this.talkpost.confirmPost();return false},getCacheName:function(){return[this.gmi_args.typeid||"",this.gmi_args.itemid||"",this.gmi_args.parentid||"",this.gmi_args.time_index||""].join(":")},keypress:function(a){this.tab_pressed=(a.keyCode==9);if(this.textarea_focused&&(a.keyCode==13||a.keyCode==10)&&(((Browser.isMac&&a.metaKey)&&!Browser.isOpera)||a.ctrlKey)){a.target.blur();return this.sendClick()}},setCallback:function(a){this.talkpost.callback=a},hookSend:function(){if(vms_feature("comment_writer")){$("input.post[type=submit]",this.talkpost.node).click(function(){return false})}else{var a,b;a=this.talkpost.node.getElementsByTagName("input");a[a.length-1].onclick=bind(this,this.sendClick)}},stdPostHook:function(){this.setCallback(bind(this,this.stdPostHookDone));this.hookSend()},stdPostHookDone:function(d,b){var a,e,c,f;TalkPostWrapper.one_comment_posted=1;if(d!="posted"){return}a=(GMI.up(this.gmi_node)||this).gmiQuery("CCommentThread")[0]||GMI.query("CCommentThread")[0];this.reset(false);a.renderNewComment(b,{fast:true,scroll_to:true});PubSub.publish("PageViewTracker.pageview",{page:"/vpv/difi/commentpost",tag:"Dynamic.Comment"});PubSub.publish("Minibrowse.uncache",b.itemid)},refreshTextareaState:function(){var b,a;if(this.textarea_focused||this.writer_focused||this.sidebar_hovered||this.textarea.value||this.mood_hovered||this.talkpost.drawplz_hovered||this.talkpost.commentDrawin||this.talkpost.collection_hovered){if(!this.logged_expand){this.logged_expand=true}$(".show_collections").unbind("mouseover").mouseover(bind(this,this.collectionHover));$(".show_collections").unbind("mouseout").mouseout(bind(this,this.collectionOut));if(!this.moods){this.moods=this.talkpost.renderMoodBox();if(this.moods){this.moods.onmouseover=bind(this,this.moodHover);this.moods.onmouseout=bind(this,this.moodOut)}a=this.gmi_node.getElementsByTagName("a");a=a[a.length-1];if($(a).is(".emoticons")){a.onmouseover=bind(this,this.moodHover);a.onmouseout=bind(this,this.moodOut)}}if(vms_feature("comment_writer")||!this.talkpost.commentDrawing){$(this.gmi_node).find(".drawPlz").show()}$(this.gmi_node).addClass("ccexpanded");if(!(document.body.scrollTop||document.documentElement.scrollTop)){if(window.scrollTo){window.scrollTo(0,1)}else{document.body.scrollTop=1}b=Ruler.document.node(this.gmi_node).y2+10-Ruler.screen.rect().y2;if(b>0){if(window.scrollTo){window.scrollTo(0,b)}else{document.body.scrollTop=b}}}}else{if(!vms_feature("comment_writer")){this.$.removeClass("ccexpanded").find(".drawPlz").hide()}}},textareaFocus:function(){this.textarea_focused=1;this.refreshTextareaState()},textareaBlur:function(){if(this.writer_focused||this.sidebar_hovered||this.collection_hovered){return}this.textarea_focused=0;this.refreshTextareaState();if(this.tab_pressed&&document.activeElement.className.indexOf("comment-submit")==-1){var a=this.textarea;setTimeout(function(){$(a).closest("form").find(".comment-submit:visible").focus()},100)}},moodHover:function(){this.mood_hovered=1},moodOut:function(){this.mood_hovered=0},collectionHover:function(){this.collection_hovered=1},collectionOut:function(){this.collection_hovered=0}});TalkPostWrapper.textCache={}});window.show_emoticons_modal=function(){var a=$("<div style='width:470px;' />");$("<h2>Emoticons</h2>").appendTo(a);$("<iframe style='width:100%; height:450px; border: none; border-bottom: 1px solid #AAB5AB; -webkit-box-shadow: rgba(255,255,255, 0.75) 0px 1px 0px; -moz-box-shadow: rgba(255, 255, 255, 0.75) 0px 1px 0px;' frameBorder='0' src='http://comments.deviantart.com/emoticons' />").appendTo(a);var b=Modals.factory(a,{cssShadows:true,showCloseButton:true,showButtonsSeparator:false,ignoreinvincible:true});b.addButton("Close","smbutton-lightgreen",function(){Modals.pop("closed");return false});Modals.push(b);return false};$(document).on("click",".show_emoticons_modal",window.show_emoticons_modal);$(document).on("click",".show_collections",function(){Lub.go();da_minish_lub.buttonClicked();return false});window.TalkPost=function(a,e,d,b){var c;DTLocal.infect(this);if(typeof a=="function"){return}this.owner=a;this.current_mode="normal";if(window.TalkPostWrapper&&(a instanceof TalkPostWrapper)){return}if($("div.mczone").first().parents("div#output").is(":visible")){this.node=$(this.template_message_center)[0]}else{this.node=$(this.template)[0]}if(vms_feature("comment_writer")){$(this.node).find("textarea").addClass("writeranywhere")}this.comment=e;this.callback=d;DRE.assert(!(b instanceof Array));for(c in (b||{})){this[c]=b[c]}this.on()};TalkPost.prototype={debug_label:"TalkPost",on:function(){console.log("Talkpost On");DRE.assert(this.node);DRE.assert(this.comment);DRE.assert(this.comment.typeid);DRE.assert(this.comment.itemid);$(this.node).data("TalkPost",this);if(Number(this.comment.parentid)){$(this.node).addClass("talk-post-reply")}this.localEventHook($(".cx",this.node)[0],"click",bind(this,this.confirmExit));this.localEventHook($(".cancel",this.node)[0],"click",bind(this,this.confirmCancel));var b=$(".post",this.node);this.localEventHook(b[0],"click",bind(this,this.confirmPost));this.localEventHook($(b).parent()[0],"keypress",bind(this,this.confirmPost));this.localEventHook($(".preview",this.node)[0],"click",bind(this,this.confirmPreview));this.textarea=$("textarea",this.node)[0];this.localEventHook(this.textarea,"keydown",bind(this,this.textareaKeydown));this.localEventHook(this.textarea,"blur",bind(this,this.textareaBlur));this.hookDrawingUI();$(".name",this.node)[0].innerHTML=deviantART.deviant&&deviantART.deviant.username?this.PHP_userlink(deviantART.deviant):"Your Comment";this.current_mode="normal";$(".text",this.node)[0].value=this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]||"";if(!deviantART.deviant||!deviantART.deviant.username){this.node.style.display="none"}var a=$("div.moodbox",this.node)[0];if(a){if(this.hide_moods){a.parentNode.style.display="none"}else{this.renderMoodBox()}}if(vms_feature("comment_writer")){setTimeout(bind(this,function(){$(this.node).find("textarea").addClass("writeranywhere");this.commentwriter=WriterAnywhereFactory.get("comment",$(this.node).find(".writeranywhere"),true,true)}),10)}},off:function(){var a=true;this.drawPlz_hide(a);$(".cancel",this.node).hide();if(this.owner.local){this.owner.localClean(TalkPost)}},localRecv:function(a){if(a=="destroy"){this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=$(".text",this.node)[0].value;if(this.owner.local){if(this.local_tie){this.owner.localClean(this.local_tie)}if(this.node.parentNode){this.node.parentNode.removeChild(this.node)}}}},PHP_userlink:function(b,a){if(typeof b=="object"){a=b.symbol;b=b.username}return a+'<a class="u" href="http://'+b.toLowerCase()+'.deviantart.com/">'+b+"</a>"},template:'<div class="talk-post" keeper="TalkPost"><img class="cx" src="//st.deviantart.com/minish/messages/neutral-x.gif" alt="x"/><div class="name"></div><div class="h"><div class="previewbox" style="display:none"></div><table class="f"><tr><td class="f"><textarea class="text" tabindex="4"></textarea></td><td class="f rr moodbox-zone"><div class="moodbox"></div></td></tr></table></div><div class="inputs" style="position:relative; text-align: right"><div class="scripted"><a class="smbutton smbutton-big preview" tabindex="6" onclick="return false"><span>Preview</span></a><span style="display: inline-block; width: 10px">&nbsp;</span><a class="smbutton smbutton-'+(vms_feature("comment_writer")?"green comment-submit":"blue")+' smbutton-big post" tabindex="5" onclick="return false"><span class="post">'+(vms_feature("comment_writer")?"Submit":"Add")+' Comment</span></a></div><div class="unscripted"><input class="post" type="submit" value="Send" tabindex="1"></div><div style="position:absolute;left:0;top:0;font-size:8.25pt">'+(vms_feature("comment_writer")?"":'<a class="emoticons show_emoticons_modal" href="http://comments.deviantart.com/emoticons" onclick="return false;" >Emoticons</a><input type="checkbox" id="remove_message_after_reply" value="1" checked style="display: none">')+"</div></div></div>",template_message_center:'<div class="talk-post" keeper="TalkPost"><img class="cx" src="//st.deviantart.com/minish/messages/neutral-x.gif" alt="x"/><div class="name"></div><div class="h"><div class="previewbox" style="display:none"></div><table class="f"><tr><td class="f"><textarea class="text" tabindex="4"></textarea></td><td class="f rr moodbox-zone"><div class="moodbox"></div></td></tr></table></div><div class="inputs" style="position:relative; text-align: right"><div class="scripted"><a class="smbutton smbutton-big preview" tabindex="6" onclick="return false"><span>Preview</span></a><span style="display: inline-block; width: 10px">&nbsp;</span><a class="smbutton smbutton-blue smbutton-big" tabindex="5" onclick="return false"><span class="post">Add Comment</span></a></div><div class="unscripted"><input class="post" type="submit" value="Send" tabindex="1"></div><div style="position:absolute;left:0;top:0;font-size:8.25pt;text-align:left"><a class="emoticons show_emoticons_modal" href="http://comments.deviantart.com/emoticons" onclick="return false;" >Emoticons</a><br><input type="checkbox" id="remove_message_after_reply" value="1" checked><label for="remove_message_after_reply">Remove this message after I reply</label></div></div></div>',nodeMap:{files:{get:function(){return $("div.talk-files",this.node)[0]}}},renderMoodBox:function(){DWait.ready("jms/lib/pager.js.mood.js",bind(this,this.renderMoodBox2));return $(".moodbox",this.node)[0]},renderMoodBox2:function(){var c,d,a,b;if(vms_feature("comment_writer")){c=null;$(".f.rr",this.node).remove()}else{c=$(".moodbox",this.node)[0]}if(!c){return false}DRE.assert(c.childNodes.length==0,"First post!");b=this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))];a=Pager.create({more_links:true,rootri:"mood",theme:this.pager_theme||($(document.body).hasClass("deviant")?"deviant":"light"),selection:b,class_name:"pager2 talk-pager",icon_base_url:"http://e.deviantart.com/emoticons/moods/",callback:bind(this,function(f,e){var g;this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=f;this.mood=f.split("/").pop();if(g=$("input.mood")[0]){g.value=this.mood}if(f){this.focus()}return false})});c.appendChild(a.node);Pager.loadPage(a,b?b.split("/").reverse().slice(1).reverse().join("/")||"mood":"mood");if(b){this.mood=b.split("/").pop()}DiFi.timer(10);this.pager=a;return c},getText:function(){return $("textarea.text",this.node).val()},getTextToSave:function(){var b=this.getText();if(!$("textarea.text",this.node).attr("writer")){return b}var a=document.createElement("div");a.innerHTML=b;if(a.innerHTML.length<b.length){return b}$(a).find("span > .embedded-devation, span > .shadow-holder").not(function(){return $(this).siblings().length}).unwrap();return a.innerHTML},setPreviewText:function(a){$(".previewbox",this.node).html('<strong style="cursor:pointer">Preview <img src="//st.deviantart.com/minish/messages/neutral-x.gif" style="position:relative;top:2px"></strong><br/><br/>'+a+"</div>");$(".previewbox strong",this.node).on("click",bind(this,function(){this.goMode("normal")}))},focus:function(){if(this.current_mode=="normal"){$(".text",this.node)[0].focus()}},textareaKeydown:function(a){this.tab_pressed=(a.keyCode==9)},textareaBlur:function(){if(this.tab_pressed&&document.activeElement.className.indexOf("post")==-1){var a=this.textarea;setTimeout(function(){$(a).closest(".talk-post").find(".post:visible").parent().focus()},100)}},current_mode:null,goMode:function(d,a){if(d==this.current_mode){return}var c=$(this.node),b=this.current_mode;this.current_mode=d;switch(d){case"busy":case"muro_saving":c.find(".text, .preview, .post").attr("disabled","disabled");c.find(".preview, .post").addClass("disabledbutton");break;case"normal":c.find(".text, .preview, .post").removeAttr("disabled");c.find(".preview span, span.preview").val("Preview").html("Preview");c.find(".preview, .post").removeClass("disabledbutton");c.find(".previewbox").hide();c.find(".text").css("visibility","visible");if(a!==false){c.find(".text").trigger("focus.talkpost")}break;case"preview":c.find(".preview span, span.preview").val("Preview Off").html("Preview Off").removeAttr("disabled");c.find(".preview, .post").removeAttr("disabled").removeClass("disabledbutton");c.find(".previewbox").css({visibility:"hidden",display:"block"});if(vms_feature("comment_writer")){c.find(".previewbox").addClass("ccwriter-preview").css({height:c.find(".writer").outerHeight(),width:c.find(".writer").outerWidth()})}else{c.find(".previewbox").css({height:c.find(".text").outerHeight(),width:c.find(".text").outerWidth()})}c.find(".text").css("visibility","hidden");c.find(".previewbox").css("visibility","visible");break;case"fail":DiFi.stdErr(null,this.last_fail_reason);this.goMode("normal");break}},showCancel:function(){$(".cancel",this.node).show()},confirmCancel:function(a){$(".cancel",this.node).hide();if(vms_feature("comment_writer")){PubSub.publish("WriterAnywhere.collapse")}return false},confirmExit:function(a){if(this.commentDrawing&&!confirm("If you do this, you will lose your current drawing.\nAre you sure?")){return false}if(this.callback){this.callback("closed")}if(vms_feature("comment_writer")){PubSub.subscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this,empty_queue_if_first_subscriber:true,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this}]);this.off()}}]);this.commentwriter.detach();WriterAnywhereFactory.remove($(this.node).find("textarea"))}else{this.off()}return false},confirmPost:function(f){try{if(!this.commentDrawing&&mgr&&mgr.canvasDrawing){this.commentDrawing=mgr.canvasDrawing}}catch(f){}if(window.event){event.cancelBubble=true}if(this.current_mode=="busy"){return}if(f!==undefined&&f.type==="keypress"&&f.keyCode!==13){return}var d,c,b,a;if(this.getText().search(/[^\s]/g)==-1&&!this.commentDrawing){this.focus();return false}if(this.drawplz_saving>0){if(this.current_mode=="muro_saving"){return}this.goMode("muro_saving");var h=setInterval(bind(this,function(){if(this.drawplz_saving>0){return}this.confirmPost();clearInterval(h)}),100);return}this.goMode("busy");d=0;c=0;if(this.exo_files){if(this.exo_files[0]&&this.exo_files[0].file){d=this.exo_files[0].file.deckId}if(this.exo_files[1]&&this.exo_files[1].file){c=this.exo_files[1].file.deckId}}else{if($(".talk-files",this.node)[0]){b=$(".talk-files a",this.node);DRE.assert(b.length==2);d=Number(b[0].getAttribute("attachdeckid")||0);c=Number(b[1].getAttribute("attachdeckid")||0)}}if(this.comment.time_index||d||c){DiFi.pushPost("Comments","filmPost",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0,this.comment.time_index||0],this.posted,this)}else{a=GMI.up(this.node,"CCommentThread");if(a&&a.rcpStallQueue){a.rcpStallQueue(true)}if(this.commentDrawing){var g;if(g=this.getCommentImage()){DiFi.pushPost("DrawPlz","post_comment",[this.getTextToSave(),g,this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0],this.posted,this);DiFi.send();return}}if(deviantART.pageData.messages){DiFi.pushPost("Comments","post_from_messagecenter",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0,$("#remove_message_after_reply").attr("checked")?1:0],this.posted,this)}else{if(this.comment.typeid==61&&Glbl("Site.is_stash")){PubSub.publish("Minibrowse.uncache",deviantART.pageData.privateid)}DiFi.pushPost("Comments","post",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0],this.posted,this)}}DiFi.send()},confirmPreview:function(){if(window.event){event.cancelBubble=true}if(vms_feature("comment_writer")){$(this.node).find(".commentwriter-toolbar .commentwriter-preview").toggleClass("active")}if(this.current_mode=="preview"){this.goMode("normal");return}this.setPreviewText("Loading preview");previewHasThumbs=0;if(vms_feature("comment_writer")||this.comment.typeid==18||this.comment.typeid==39){previewHasThumbs=1}DiFi.pushPost("Comments","preview",[this.getText(),previewHasThumbs],this.preview,this);DiFi.send();this.goMode("preview")},preview:function(b,a){if(!b){if(this.current_mode=="preview"){this.goMode("normal");this.setPreviewText("")}return}this.setPreviewText(a.response.content)},posted:function(j,d,a){var h,i,g,c,k,b;threadGMI=$(this.node).parents(":gmi(CCommentThread)");if(threadGMI.length){thread=threadGMI.gmi1();if(thread&&thread.rcpStallQueue){if(j){thread.recently_rendered[d.response.content.commentid]=1}thread.rcpStallQueue(false)}}if(!j){this.last_fail_reason=(typeof(d.response.content||{}).error)=="string"?d.response.content.error:"There was an error while posting the comment.\n\nPlease try again soon.";this.goMode(a?"normal":"fail");return}h=d.response.content;i={commentid:h.id,parentid:this.comment.parentid,typeid:this.comment.typeid,itemid:this.comment.itemid,username:deviantART.deviant.username,symbol:deviantART.deviant.symbol,usericon:deviantART.deviant.usericon,ts:Math.floor((new Date).valueOf()/1000),attributes:(d.request.args[5]<<16)|(d.request.args[4]<<3),depth:undefined,text:h.body,signature:null,files:h.files,html:h.html};try{HALT()}catch(f){}this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=null;this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=null;$(".text",this.node)[0].value="";if(this.callback){this.callback("posted",i)}if(vms_feature("comment_writer")){PubSub.subscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this,empty_queue_if_first_subscriber:true,callback:function(){PubSub.unsubscribe([{eventname:"WriterAnywhere.collapsed",subscriber:this}]);if(this.owner){this.off()}}}]);this.commentwriter.detach();WriterAnywhereFactory.remove($(this.node).find("textarea"))}else{if(this.owner){this.off()}}},reset:function(b){var a,d,c;this.goMode("normal",b);this.node.getElementsByTagName("textarea")[0].value="";if(this.owner){this.owner.textarea_focused=0;this.owner.refreshTextareaState()}if(this.pager){Pager.select(this.pager,"");Pager.loadPage(this.pager,"mood")}if(this.exo_files){for(c=0;c!=this.exo_files.length;c++){if(this.exo_files[c]&&this.exo_files[c].file){this.exo_files[c].deckNuke()}}}},browserSupportsCommentDrawings:function(){return(!Browser.isIE55)&&(!Browser.isIE6)&&(!Browser.isIE7)&&(!Browser.isIE8)},hookDrawingUI:function(){var c=this.comment.allowdrawings&&this.browserSupportsCommentDrawings();if(!c){return}var b='<div class="drawPlz"><div class="topbar hh">'+(c?'<a href="#showDrawPlz" class="showDrawPlz">Add a Drawing</a>':"")+"</div></div>";var e=jQuery("textarea",this.node);var a=(" "+this.node.className+" ").indexOf(" talk-post-reply ")!=-1;if(a){b='<tr><td colspan="2">'+b+"</td></tr>";e.closest("tr").after(jQuery(b))}else{jQuery(".cctextarea",this.node).append(jQuery(b))}$(this.node).on("click",".editDrawing",this.drawPlz_edit.bindTo(this));$(this.node).on("click",".hideDrawPlz, .hideDrawing",this.drawPlz_hide.bindTo(this));this.drawplz_saving=this.drawplz_saving||0;$(".showDrawPlz",this.node);var d=$(".showDrawPlz",this.node)[0];this.localEventHook(d,"click",this.drawPlz_show.bindTo(this));this.localEventHook(d,"mouseover",this.drawPlz_mouseover.bindTo(this));this.localEventHook(d,"mouseout",this.drawPlz_mouseout.bindTo(this))},drawPlz_show:function(j){j.preventDefault();var d=450;var h=340;var b=$(this.node);if(vms_feature("comment_writer")){var a=b.find(".writeranywhere");if(a){a.click()}var f=this.commentwriter.ccwriter.writer;if(!f){return}var c,k,g;var i=this;f.frame("http://sta.sh/muro/iframe?width="+d+"&height="+h+"&background=clear",function(m,n){var l="remove";switch(m.action){case"error":if(n.hidden){n.act("show")}return;case"cancel":return"remove";case"got_id":k=m.id&&parseInt(m.id,36);return;case"done":g=m.img||g;i.drawplz_saving++;l="hide";break;case"save":k=m.privateid||m.id||k;g=m.img||g;i.drawplz_saving--;break;case"ready":return"show";default:return}if(k&&g&&!c){var e=$("<img>",{src:g,"class":"writer-embed writer-deviation-image writer-deviation-redraw",embedid:k,embedtype:"deviation",embedformat:"image"});f.insert(e);WriterEmbed.runLoaders(f.$node);c=true}return l});return}b.find(".drawPlz").hide();stdLog("MainNode: ",b.get(0));DiFi.pushPost("DrawPlz","inline_html",[],function(o,n){if(n.response.status!="SUCCESS"){return}var l=n.response.content.htmlContent;var m=this.node.className.indexOf("talk-post-reply")!=-1;if(m){var e=b.find("tr").get(0);stdLog("firstTR: ",e);$(e).after('<tr><td colspan="2">'+l+"</td></tr>")}else{if(vms_feature("comment_writer")){b.find(".cc-without-moods").append(l)}else{b.find(".cc-with-moods").append(l)}}if(Browser.isIE){b.find("canvas").each(function(){var s={};el=this;var r=["class","style","width","height"];for(var p in r){var q=el.getAttribute(r[p]);if(q){s[r[p]]=q}}var u=$(el).parent().get(0);$(el).remove();var t=document.createElement("canvas");for(var p in s){t.setAttribute(p,s[p])}u.appendChild(t)})}DWait.ready(["jms/lib/localStorage.js","jms/pages/drawplz/managers.js"],function(){window.manager=new Managers(b.find(".drawPlzContainer").get(0),d,h);this.commentDrawing=manager.canvasDrawing}.bindTo(this))}.bindTo(this));DiFi.send()},drawPlz_updateImage:function(e,b){this.commentDrawing=e;var a=$(this.node);var c=b;var d=a.hasClass("talk-post-reply");if(d){a.find(".drawPlzComment").parents("tr").remove();a.find("tr").eq(0).after('<tr><td colspan="2">'+c+"</td></tr>")}else{a.find(".drawPlzComment").remove();a.find(".cc-with-moods .cctextarea").append(c)}},drawPlz_edit:function(){},drawPlz_hide:function(b){this.drawplz_hovered=0;if(this.commentDrawing){if(b!=true&&!confirm("If you do this, you will lose your current drawing.\nAre you sure?")){return}var a=$(this.node);a.find(".hideDrawPlz, .info").hide().eq(0).parent().find(".showDrawPlz").show();a.find(".drawPlz").show();a.find(".drawPlzContainer, .drawPlzComment").remove();this.commentDrawing=null}},getCommentImage:function(){if(this.commentDrawing&&this.commentDrawing.hasUnsavedWork()){return this.commentDrawing.getSaveData()}return false},drawPlz_mouseover:function(){this.drawplz_hovered=1},drawPlz_mouseout:function(){this.drawplz_hovered=0}};if(vms_feature("comment_writer")){DWait.ready(["cssms/lib/writer.css","cssms/pages/stash/stash.override.thumbs.css","cssms/pages/stash/stash.header.css","cssms/lib/writer-subtoolbar.css","cssms/lib/canvas_drawing.css","jms/lib/writer/factory.js","jms/lib/writer/sidebar.js"],function(){$(":gmi(TalkPostWrapper)").gmiWake()})}if(window.DWait){DWait.run("jms/pages/talkpost.js")}});
DWait.ready(["jms/lib/bind.js","jms/lib/gwebpage.js","jms/lib/popup2.js","jms/lib/jquery/jquery.current.js"],function(){(function(a){window.GiveMenu={show:function(b,c){popup=new Popup2("GiveMenu","body",{classes:"givemenu",content:'<div class="pager2"><div class="blockmenu"><div class="loading">Loading</div></div></div>',destroy:true});popup.show(popup.position(a(b),{align:"right",bump:{left:15}}));DiFi.pushPublicGet("User","getGiveMenu",[c],bind(this,this.difiCallback,b,popup));DiFi.send()},difiCallback:function(d,c,h,f,b){if(!h||!f.response.content.html){return b?null:DiFi.stdErr("Failed to load give menu",f.response.content)}gWebPage.update(f.response.content);var g=a(f.response.content.html);var e=this;g.find("a.morelink").click(function(i){g.find(a(this).attr("rel")).show();a(this).remove();e.heightCalc(c)});setTimeout(bind(this,this.actualDisplay,g,d,c),50)},actualDisplay:function(d,c,b){b.$node.html(d.show());this.heightCalc(b)},heightCalc:function(b){b.$node.height(b.$node.find("div.blockmenu").height()+(a.browser.msie?4:0))}};a(document).on("click","[givemenu]",function(b){b.preventDefault();b.stopPropagation();GiveMenu.show(this,a(this).attr("givemenu"))})})(jQuery);if(window.DWait){DWait.run("jms/pages/givemenu.js")}});
DWait.ready(["jms/lib/gmi.js"],function(){window.CCommentThread=CCommentThread=(window.GMIHub||GMIBase).extend({gmiConstructor:function(){},DR_SEL:"span.drawplz.closed",HT_SEL:"span.thumb-attachment.closed",B_SEL:"div.drawplz-attachment-ctrl",recently_rendered:{},toggleAttachmentButton:function(){if(this.$.parent().find(this.DR_SEL).length||this.$.parent().find(this.HT_SEL).length){this.$.parent().find(this.B_SEL).show().find(".gmbutton2").click(bind(this,this.clickAttachmentButton))}},clickAttachmentButton:function(a){this.$.parent().find(this.B_SEL).hide();this.$.parent().find(this.DR_SEL).removeClass("closed").unbind("click").removeClass("dwait");this.$.parent().find(this.HT_SEL).each(function(){$(this).removeClass("closed").unbind("click").removeClass("dwait").next(".shadow-holder, .embedded-deviation").show();$(this).next("a.thumb-attachment-content").replaceWith(function(){return $(this).data("html")})});return false},hubRecv:function(a){switch(a.cmd){case"new":if(a.commentid in this.recently_rendered){return}this.renderNewComment(a,{});break}},renderNewComment:function(f,c){var h,e,a,g;console.log("renderNewComment",f,c);this.recently_rendered[f.commentid]=1;if(this.gmi_node.firstChild&&(this.gmi_node.firstChild.className||"").indexOf("expendable")>=0){this.gmi_node.innerHTML=""}g=Number(f.parentid);var b=[];if(g&&g!=this.gmi_args.rootid){$.each(this.gmiQuery("CComment",{match:{commentid:f.parentid}}),function(i,j){h=j.gmi_node;if(h){if($(h.nextSibling).hasClass("nest")){h=h.nextSibling}else{h=$('<div class="nest"></div>').insertAfter(h)[0]}}b.push(h)})}else{$.each(GMI.query("CCommentThread"),function(i,j){if(f.itemid==j.gmi_args.itemid&&f.typeid==j.gmi_args.typeid){h=j.gmi_node;b.push(h)}})}if(b.length){var d=this;$.each(b,function(i,j){$(f.html).hide()[Number(d.gmi_args.order)==2?"prependTo":"appendTo"](j).fadeIn(400)})}else{console.log("Skipped comment rendering; parent is out of view")}if(e&&c.scroll_to){a=Ruler.document.node(e).y-30;if(window.scrollTo){window.scrollTo(0,a)}else{document.body.scrollTop=a}}return e}});window.CCommentMaster=CCommentMaster=GMIBase.extend({gmiConstructor:function(){}});if(window.DWait){DWait.run("jms/pages/ccommentthread.js")}});
DWait.ready(["jms/lib/gmi.js","jms/lib/dtlocal.js","jms/lib/popup2.js","jms/pages/ccommentthread.js","jms/lib/analytics.js"],function(){window.CComment=CComment=GMIBase.extend({gmiConstructor:function(){DTLocal.infect(this);this.permahidden=this.gmi_args.permahidden;this.$.find("span.drawplz.closed").click(this.specialAttachmentClick);this.$.find("span.thumb-attachment.closed").click(this.thumbAttachmentClick);this.$.find("span.thumb-attachment.closed").each(function(){$(this).show().next(".shadow-holder, .embedded-deviation").hide()});if(Glbl("Site.is_stash")){this.$.find("span.thumb-attachment.closed").click()}},gmiDestructor:function(){this.localDestroy()},replyClick:function(){var d,b,c;if(window.event){event.cancelBubble=true}if(this.local.talkpost){this.local.talkpost.focus();return false}this.local.talkpostnode=d=document.createElement("div");d.className="nest";d.innerHTML=('<div class="ccomment ccomment-post ch"><i class="tl c"><i></i><b></b></i><i class="tr c"><i></i><b></b></i><i class="bl c"><i></i><b></b></i><i class="br c"><i></i><b></b></i><div class="ch-ctrl"><br/></div></div>');this.local.talkpost=b=new TalkPost(this,{typeid:this.gmi_args.typeid||-1,itemid:this.gmi_args.itemid||-1,parentid:this.gmi_args.commentid,allowdrawings:this.gmi_args.allowdrawings},bind(this,this.replyCallback),{pager_theme:"light",show_icon:true,hide_moods:this.gmi_args.hidemoods});b.local_tie="talkpostnode";c=d.getElementsByTagName("br")[0];b.node.style.display="block";c.parentNode.replaceChild(b.node,c);this.gmi_node.className+=" ccomment-activereply";if(this.gmi_node.nextSibling){this.gmi_node.parentNode.insertBefore(d,this.gmi_node.nextSibling)}else{this.gmi_node.parentNode.appendChild(d)}b.focus();if(!this.logged_expand){this.logged_expand=true}return false},replyCallback:function(d,c){if(!this.local.talkpost){return}switch(d){case"posted":var e;if(this.callback_post){this.callback_post(c)}this.local.talkpost.local_tie=null;this.localClean(TalkPost);this.local.talkpostnode.parentNode.removeChild(this.local.talkpostnode);var b=this.gmiUp("CCommentThread");if(!b){b=GMI.query("CCommentThread")[0]}console.log("ccommentthread",b);if(b&&!b.renderNewComment(c,{fast:true,scroll_to:true})){}this.local.talkpostnode=null;PubSub.publish("PageViewTracker.pageview",{page:"/vpv/difi/commentpost",tag:"Dynamic.Comment"});case"closed":this.gmi_node.className=this.gmi_node.className.replace(/\bactivereply\b/g,"");break}},unhideClick:function(){if(this.permahidden){this.setHideState(false)}else{this.difi("unhide","displaying this comment")}if(window.event){event.cancelBubble=true}return false},hideClick:function(){if(this.permahidden){this.setHideState(true)}else{this.difi("hide","hiding this comment")}},reportClick:function(){if(this.permahidden){alert("This comment has already been reported.")}else{if(!this.loading&&confirm("Report this comment as spam?")){this.difi("reportSpam","reporting this comment as spam")}}},doPopup:function(c){var d="<div class='blockmenu'><div style='position:relative'><a class='f' href='#' onclick='GMI.up(this).hideClick();Popup2.hideAll(); return GMI.evCancel();'>Hide Comment</a>";if(c===false){d+="<a href='#' class='f' onclick='GMI.up(this).reportClick();Popup2.hideAll(); return GMI.evCancel();'>Report Spam</a><a class='f' href='#' onclick='GMI.up(this).blockClick();Popup2.hideAll();return GMI.evCancel();'>Block User</a>"}d+="</div></div>";var b=$(this.gmi_node).find(".gm-chaos");CComment.popup=new Popup2("GroupListManage","body",{classes:"ccomment-manage",content:d,destroy:true,created:function(e){e.$node.attr("gmi-redirect",this.gmi_node.getAttribute("gmindex"))}.bindTo(this),hidden:function(){b.find(".gmbutton2").removeClass("active")},shown:function(){b.find(".gmbutton2").addClass("active")}});CComment.popup.show(CComment.popup.position(b,{align:"right"}));return false},blockClick:function(){a=$("a.u",this.gmi_node)[0];author=a.firstChild.nodeValue;if(confirm("Add "+author+" to your blocked users list?")){DiFi.pushPost("User","block",[author],function(c,b){if(c){alert(author+" has been added to your list of blocked users.")}else{if(b.response.content.error){alert(b.response.content.error)}else{alert("deviantART was unable to add "+author+" to your blocked users list.")}}});DiFi.send()}},specialAttachmentClick:function(){$(this).removeClass("closed").unbind("click").removeClass("dwait")},thumbAttachmentClick:function(){$(this).closest(".ccomment").find(".thumb-attachment.closed").each(function(){$(this).removeClass("closed").unbind("click").removeClass("dwait").next(".shadow-holder, .embedded-deviation").show();$(this).next("a.thumb-attachment-content").replaceWith(function(){return $(this).data("html")})})},difi:function(c,b){var b;if(this.loading){return}this.loading=true;this.gmi_node.className+=" ccomment-loading";DiFi.pushPost("CommentAttributes",c,[this.gmi_args.commentid,this.gmi_args.itemid,this.gmi_args.typeid],bind(this,this.difiDone,b));DiFi.timer(1)},difiDone:function(c,g,f){this.gmi_node.className=this.gmi_node.className.replace(/\bccomment.loading\b/g,"");this.loading=false;if(!g){alert("There was an error while "+c+".\n\nPlease try again soon.");return}switch(f.request.method){case"reportSpam":this.permahidden=true;if(!CComment.SPAM_REPORT_DONE){var b,d,e;CComment.SPAM_REPORT_DONE=true;b=$("a.u",this.gmi_node)[0];d=b.firstChild.nodeValue;e=b.previousSibling.nodeValue;if(f.response.content.can_report_all&&d&&(confirm("Would you also like to scan for comments by "+e+d+" on your user page, deviations, journals, etc.?"))){DiFi.pushPost("CommentAttributes","removeSpamOnUser",[d],function(i,h){if(i){alert("The process of removing spam from your user page, deviations, journals, etc., has started.\nYou will be notified with a note once this is complete.")}else{alert("deviantART was unable to start the process of removing all spam by this user.\nWe appreciate your effort, and ask you to please try again shortly.")}});DiFi.timer(1)}else{alert("Thank you for your report.")}}case"hide":this.makeUnhideLink();this.setHideState(true);break;case"unhide":this.setHideState(false);break}},makeUnhideLink:function(){var b,c;b=(this.gmi_node.getElementsByTagName("a")||[])[0];if(!b||b.className!="creason"){b=document.createElement("a");b.onclick=bind(this,this.unhideClick);b.href="#";b.className="creason";c=this.gmi_node.getElementsByTagName("div")[0];c.insertBefore(b,c.firstChild)}b.innerHTML="<span>"+(this.permahidden?"Flagged as Spam":"Hidden by Owner")+"</span><em>"+(this.permahidden?"Peek":"Undo Hide")+"</em>"},setHideState:function(b){if(b){this.gmi_node.className+=" ccomment-hidden"}else{this.gmi_node.className=this.gmi_node.className.replace(/\bccomment.hidden\b/g,"")}}});if(vms_feature("writer_anywhere")){$(":gmi(CComment) .thumb-attachment.closed").each(function(){$(this).gmiUp()})}if(window.DWait){DWait.run("jms/pages/ccomment.js")}});
window.TabledResourceStream=ResourceStream.extend({domFindVisible:function(){var a,b,f,e;b={};e=0;var d=$(this.gmi_node).find(".tt-a, .rs-customicon-cont, .gl-text");for(a=0;f=d[a];a++){if(!f.getAttribute("rs_ignore")){b[(e++)+this.gs_offset]=f}}return b},dataFetch:function(){},gmiConstructor:function(){this.preview_override_selection_type=TabledResourceStreamSimpleSelection;this.base()},get_stream_node_from_clicked_node:function(a){return $(a).closest(".tt-a").get(0)}});window.TabledResourceStreamSimpleSelection=window.ResourceStreamSimpleSelection.extend({getAllSelectable:function(){return $(".tt-a",this.root).toArray()},isSelectable:function(a){return $(a).hasClass("tt-a")}});if(window.DWait){DWait.run("jms/lib/gstream/tabled_resource_stream.js")};
DWait.ready(["jms/lib/Base.js","jms/legacy/modals.js","cssms/modals/signup-modal.css"],function(){SignupBase=Base.extend({constructor:function(){$(window).bind("message",function(a){if(a.originalEvent&&a.originalEvent.origin==="http://verify.deviantart.com"&&a.originalEvent.data.match(/"command":"close"/)){Modals.pop("finished")}})},modalUp:false,dificalls:[],modal:function(a,d,g){var h,f,c="475";if(g){f=g}else{var e=location.hostname.split(".")[0];if(window.location.hostname.match(/sta.sh$/)){f="https://sta.sh/login/oauth/modal";c="550"}else{if(((window.deviantART||{}).deviant||{}).id){f="http://verify.deviantart.com/?from=Modal&subdomain="+e+"&referrer="+encodeURIComponent(location.href)}else{f="https://www.deviantart.com/join/?joinview=Modal&joinpoint="+encodeURIComponent(d.request["class"])+"&subdomain="+e}}}h=$('<div class="secure"><div class="join-modal-title"><h3>Sign Up<span> or Log In</span></h3></div><div class="join-modal-contents" style="height:'+c+'px;"><div id="loading_iframe"><img src="http://s.deviantart.com/emoticons/e/eager.gif" />Loading&hellip;</div><iframe scrolling="no" allowtransparency="true"  src="'+f+"\" frameBorder=\"0\" onload=\"$(this).show().closest('.secure').addClass('loaded').parent().width($(this).closest('.secure').width()).height($(this).closest('.secure').height()); $('#loading_iframe').hide();\"></iframe></div></div>")[0];Modals.lightfade=true;this.dificalls.push([a,d]);if(!this.modalUp){var b=Modals.factory(h);Modals.push(b,bind(this,this.done),"join-modal")}this.modalUp=true},done:function(f){if(f){gWebPage.update(f)}this.modalUp=false;var b,a,e,c=false;while(b=this.dificalls.pop()){a=b[0];e=b[1];if(f&&f.result=="finished"&&e){c=true;DiFi.pushPost(e.request["class"],e.request.method,e.request.args,a[0][0],a[1][0])}else{a[0][0].call(a[1][0],f&&f.result=="finished",e,true)}}if(c){var d=window.location.hostname.match(/sta.sh$/)?"Stash":"DAWebpageHeader";DiFi.pushPrivateGet(d,"getHeaderHTML",[],this.headerRefresh);DiFi.send()}},headerRefresh:function(b,a){if(b){$("#overhead-sc").fadeOut(function(){gWebPage.update(a.response.content);$(this).html(a.response.content.html);PubSub.publish("Signup.headerRefresh");$(this).fadeIn()});$("#overhead tr").fadeOut(function(){gWebPage.update(a.response.content);$(this).html(a.response.content.html);PubSub.publish("Signup.headerRefresh");$(this).fadeIn()})}else{console.log("Err",a.response.content)}}});window.Signup=new SignupBase();if(window.DWait){DWait.run("jms/pages/signup.js")}});
DiFi.errorHooks.push(function(c,b,a){if(!c&&b.response.content&&b.response.content.error=="DiFi Security Access Error"&&b.response.content.details.privs&&((((b.response.content.details.privs[0]||[])[2]||[])[0]==PRIV_LOGGEDIN)||(((b.response.content.details.privs[0]||[])[2]||[])[0]==PRIV_VERIFIED))&&window.Signup&&!window.location.hostname.match("dreamup")){Signup.modal(a,b);return true}});if(window.DWait){DWait.run("jms/pages/difi_errorhook_signup.js")};
(function(a){a(".gmbutton2searchcancel").each(function(){var c=a(this);var d=c.parent().find("input.gmbutton2");c.click(function(){d.val("");d.change();c.parents("form").submit()});var b=function(){if(d.val()){c.addClass("show")}else{c.removeClass("show")}};d.change(b);d.keyup(b);d.change()})})(jQuery);if(window.DWait){DWait.run("jms/chrome/searchcancel.js")};
DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){var a=window.location.href.substring(window.location.href.indexOf("?")+1);$("a.expand").each(function(){var b=$(this).attr("href");if(b.substring(0,9)!="#_expand_"){return}var d=b.substring(9);var c=$("div[skinscript=expandable_"+d+"]");if(!c.length){return}c.hide();$(this).click(function(){c.toggle();return false});if(a==$(this).attr("href").substring(1)||a.match("_expand_all")){$(this).click()}});if(window.DWait){DWait.run("jms/pages/catskin-expander.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/glbl.js"],function(){window.BrowserSupport={getBrowser:function(d){for(var a=0;a<d.length;a++){var b=d[a].string;var c=d[a].prop;this.versionSearchString=d[a].versionSearch||d[a].identity;if(b){if(b.indexOf(d[a].subString)!=-1){return d[a]}}else{if(c){if(navigator.userAgent){if(navigator.userAgent.indexOf(d[a].identity)!=-1){return d[a]}}else{return d[a]}}}}return null},getVersion:function(a){var b=new RegExp(this.versionSearchString+"/? ?([0-9]+(.?[0-9]+)*)");var c=a.match(b);if(!c){return null}return c[1].split(".")},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome",min:[8,0],link:"http://www.google.com/chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version",min:[4,0],link:"http://www.apple.com/safari/"},{prop:window.opera,identity:"Opera Mini",versionSearch:"Version",min:[10,50],link:"http://www.opera.com/"},{prop:window.opera,identity:"Opera",versionSearch:"Version",min:[11,50],link:"http://www.opera.com/"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox",min:[3,6],link:"http://getfirefox.com"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE",min:[8,0],link:"http://microsoft.com/ie"}],enforce:function(){if(Glbl("Site.is_mobile")){return}var c=this.getBrowser(this.dataBrowser);var b=this.getVersion(navigator.userAgent);if(!c||!b){return}var a=undefined;$.each(c.min,function(d,e){if(a===undefined&&b[d]){if(b[d]<e){a=false}if(b[d]>e){a=true}}});if(a===false||(a===undefined&&c.min.length>b.length)){this.showBanner(c.link)}},showBanner:function(a){$("#overhead-collect").before('<div style="background:url(http://st.deviantart.net/misc/updatebrowser_ylw_bg.png) repeat-x;width:100%;height:10px;line-height:10px;text-align:center;position:absolute;top:-1px;z-index:1000;font-family:verdana;font-size:10px;color:#3c3838;padding:10px 0px;text-shadow:#fff 1px 1px;">Please <a href="'+a+'" style="color:#1965B6;">upgrade your browser</a> to access deviantART</div>')}};BrowserSupport.enforce();if(window.DWait){DWait.run("jms/pages/browser_support.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/Base.js","jms/lib/pubsub.js"],function(){(function(c){var b=Base.extend({_resize_throttle:100,_debounce_fill_ad:800,_page_debounce_times:{},_minimum_boundary:100,_init:false,_resize_mode:false,_duperbrowse_mode:false,_stashed_ad_html:[],_waiting_ad_units:[],_ads:{},_pool:[],_win_w:0,_$win:null,constructor:function(){this._$win=c(window);this._win_w=this._$win.width()},fill_ad_slot:function(d,e){if(this._resize_mode){return}d=String(d);var f=c.now();if(this._page_debounce_times[d]&&f<this._page_debounce_times[d]){return}this._page_debounce_times[d]=f+this._debounce_fill_ad;e=c(e);if(!this.is_valid_ad_request(d,e)){return}if(this._ads[d]){this.position_ad(d,e);return}this.show_container();this.get_an_offscreen_ad(d);this.position_ad(d,e);if(!this._init){this._init=true;this.bind_window_resize();PubSub.subscribe([{eventname:"Duperbrowse.opened",subscriber:this,callback:this.duperbrowse_opened},{eventname:"Duperbrowse.closed",subscriber:this,callback:this.duperbrowse_closed}])}},stash_ad_html:function(d){if(this._waiting_ad_units.length){c(this._waiting_ad_units.shift()).html(d);return}if(this._stashed_ad_html.length<=5){this._stashed_ad_html.push(d)}},scroll_manager_is_done_resizing:function(){if(!this._resize_mode||this._duperbrowse_mode){return}this._win_w=this._$win.width();this.show_container();for(var e=0,d=this._pool.length;e<d;++e){this.position_ad(this._pool[e])}this.enter_normal_mode()},enter_normal_mode:function(){this._resize_mode=false;this.show_container();this.bind_window_resize()},enter_resize_mode:function(){this._resize_mode=true;this.unbind_window_resize();this.hide_container()},unbind_window_resize:function(){this._$win.off("resize.browselikethis_ad_pool")},bind_window_resize:function(){this._$win.on("resize.browselikethis_ad_pool",c.throttle(this._resize_throttle,this.window_resize.bindTo(this)))},window_resize:function(){var d=this._$win.width();if(d==this._win_w){return}this._win_w=d;this.enter_resize_mode()},duperbrowse_opened:function(){this._duperbrowse_mode=true;this.enter_resize_mode()},duperbrowse_closed:function(){this._duperbrowse_mode=false;this.enter_normal_mode()},position_ad:function(d,e){var f=this.get_ad_by_page_id(d);if(f){e=c(e);if(e.length){f.$node=e}f.offset=f.$node.offset();if(f.offset<this._minimum_boundary){f.offset={top:-9999,left:-9999}}f.$el.css(f.offset)}},is_valid_ad_request:function(e,g){if(!g.length){return false}var f=this.get_ad_by_page_id(e);if(!f){return true}if(!f.$node.is(g)){return true}var d=g.offset();if(Math.floor(d.top)!=Math.floor(f.offset.top)||Math.floor(d.left)!=Math.floor(f.offset.left)){return true}return false},get_ad_by_page_id:function(d){return this._ads[d]},get_an_offscreen_ad:function(o){var k=this._pool.length,l=this._$win.scrollTop(),e=l+this._$win.height();for(var f=0;f<k;++f){var g=this._pool[f],n=this.get_ad_by_page_id(g);if(!n){continue}var d=n.offset.top,j=d+this.ad_height,m=((d>=l&&d<=e)||(l>=d&&l<=j));if(!m){this._pool.splice(f,1);this._pool.push(o);this._ads[g]=null;this._ads[o]=n;return n}}var h={"$el":this.create_ad_element(),"$node":c()};h.offset=h.$el.offset();this._pool.push(o);this._ads[o]=h;if(!this.ad_height){this.ad_height=h.$el.height()}return h},get_container:function(){if(!this.$container){this.$container=c("<div>").addClass("blt-ad-container").prependTo(document.body)}return this.$container},hide_container:function(){this._container_hidden=true;this.get_container().addClass("hidden")},show_container:function(){this._container_hidden=false;this.get_container().removeClass("hidden")},create_ad_element:function(){var d=this._stashed_ad_html.shift(),e=c("<div>").addClass("blt-ad").appendTo(this.get_container());if(!d){this._waiting_ad_units.push(e)}else{e.html(d)}return e}});var a=new b();PubSub.publish("BrowseLikeThisAdPool.instance_loaded",a)})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.ads.js")}});
(function(e){if(window.location.hash.indexOf("offset")>-1){var h=d(window.location.hash.split("?",2)[1]||""),a=d(window.location.search.replace(/^\?/,"")),f=parseInt(h.offset||0,10),b,g,c;if(h.offset==undefined){return}e("#browse-results-page-1").html('<span class="browse-loading">Loading from result '+(f+1)+"...</span>");delete h.offset;g=e.param(h);b=window.location.hash.replace(/\?.*$/,g.length?"?"+g:"");if(b==="#"||b==="#/"){b=""}a.offset=f;c="?"+e.param(a);window.location=window.location.pathname+c+b}function d(j){var m=j.split("&"),n={},l;for(var k=0;k<m.length;k++){if(!m[k].length){continue}l=m[k].split("=",2);n[l[0]]=l[1]}return n}})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.onload_url_hash_handler.js")};
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js",".domready"],function(){(function(b){var c=Base.extend({handlers:{load_comments_clicked:function(g){g.preventDefault();var f=b(this);var e=f.data("CommentsLoader");if(!e){var h=f.data("itemid");var d=f.closest(".deviation-full-minipage");e=new a(h,d);f.data("CommentsLoader",e)}e.load_more()},show_description_clicked:function(){b(this).siblings(".minipage-description").css({height:"auto",overflow:"auto"}).find(".description-fader").remove();b(this).remove()}},constructor:function(){b("#browse-results").on("click",".comments-count:not(.disabled)",this.handlers.load_comments_clicked).on("click",".minipage-show-description",this.handlers.show_description_clicked);this.adjust_description_height();PubSub.subscribe([{eventname:"BrowseLikeThisStreamView.pages_visible",subscriber:this,callback:this.adjust_description_height}])},adjust_description_height:function(){var d=43;b(".minipage-description .text-ctrl").not(".height-adjusted").each(function(){var e=b(this);if(e.height()<=d){e.siblings(".description-fader").remove();e.parent().height(e.height()).siblings(".minipage-show-description").remove()}e.addClass("height-adjusted")})}});var a=Base.extend({COMMENT_DEVIATION:1,$comments:null,$comments_loaded:null,$comments_count:null,itemid:null,offset:0,limit:25,templates:{loading:"<div class='comments-loading browse-loading'>Loading...</div>",end:"<div class='browse-done'>End of Comments</div>"},constructor:function(e,d){this.itemid=e;this.$comments=d.find(".minipage-comments-container");this.$comments_loaded=d.find(".comments-loaded");this.$comments_count=d.find(".comments-count")},load_more:function(e,d){this.show_loading();DiFi.pushPublicGet("Comments","getLimitedComments",[this.COMMENT_DEVIATION,this.itemid,0,this.offset,this.limit+1],this.load_more_done.bindTo(this));DiFi.send()},load_more_done:function(h,g){this.remove_loading();if(g.response.content.error){this.disable_more();return}var f=b(g.response.content.html);var d=f.find(".ccomment");var e=d.length;if(e<this.limit+1){this.disable_more()}else{e--;d.last().remove()}this.$comments.append(f);this.offset+=e;this.update_comments_loaded()},show_loading:function(){this.$comments.append(this.templates.loading)},remove_loading:function(){this.$comments.find(".comments-loading").remove()},disable_more:function(){this.$comments_count.parent().prepend(this.templates.end);this.$comments_count.remove()},update_comments_loaded:function(){this.$comments_loaded.text(this.offset);this.$comments_loaded.parent().show()}});new c()})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.minipage.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/pages/browselikethis/browselikethis.stream.fetcher.js","jms/pages/duperbrowse/duperbrowse.helpers.js"],function(){(function(){var a=Base.extend({_fetcher:null,_stream_stack:null,_max_page_id:0,_loaded_pages:[],_loading_queue:[],_pages:{},_first_visible_page:null,_current_item_page:null,_current_item:null,_current_offset:null,_items:{},_page_skeleton:{id:null,number:null,portal_api:null,query_params:{},results_dom:null,results_rids:null,paging_mode:"infinite",is_initial_page:false,advert_dom:null,state:"unloaded",has_more:false,has_less:false,error_state:0,max_offset:null,result_type:null,result_limit:null},handlers:{init:function(c,b){var d=this._create_page(b);d.state="loaded";d.is_initial_page=true;this._add_loaded_page(d);this._add_loaded_items(b.results_rids,d.id);this.handlers.set_first_visible_page.bindTo(this)(null,d.id);this._set_current_item_page(d);this._fetcher=new BLTStreamFetcher({cache_size:20});PubSub.unsubscribe({eventname:"BrowseLikeThisStream.init",subscriber:this});PubSub.subscribe([{eventname:"BrowseLikeThisStream.load_next",subscriber:this,callback:this.handlers.load_next},{eventname:"BrowseLikeThisStream.set_first_visible_page",subscriber:this,callback:this.handlers.set_first_visible_page},{eventname:"BrowseLikeThisStream.open_duperbrowse",subscriber:this,callback:this.handlers.open_duperbrowse.bindTo(this)}])},load_next:function(b,d){if(this._loading_queue[0]){return}var c=this._init_new_page(d);if(c){this._load_new_page(c)}},set_first_visible_page:function(d,b){if(this._pages.hasOwnProperty(b)){var e=!this._current_page;if(e||this._current_page.id!==b){this._current_page=this._pages[b];PubSub.publish("BrowseLikeThisStream.current_page_changed",this._current_page);if(!e){var c=BrowseLikeThisStream.get_blt_url_for_offset(this._current_page.query_params.offset);PubSub.publish("Location.replace",c)}}}},open_duperbrowse:function(d,b){var c={next_item_callback:this._next_item_callback.bindTo(this),prev_item_callback:this._prev_item_callback.bindTo(this),has_next_callback:this._has_next_callback.bindTo(this),has_prev_callback:this._has_prev_callback.bindTo(this),on_stream_item_opened:this._on_stream_item_opened.bindTo(this),on_stream_item_closed:this._on_stream_item_closed.bindTo(this)};Duperbrowse.open(b,c)}},constructor:function(){this._loading_queue=[];this._loaded_pages=[];this._pages={};this._items={};PubSub.subscribe({eventname:"BrowseLikeThisStream.init",subscriber:this,callback:this.handlers.init})},_create_page:function(c){var b=$.extend(true,{},this._page_skeleton,c);b.id=this._next_page_id();this._pages[b.id]=b;return b},_load_new_page:function(b){var c=this._fetcher.fetch(b.portal_api,b.query_params,b.result_limit);if(this._loading_queue.length<1){PubSub.publish("BrowseLikeThisStream.next_page_loading",b)}this._loading_queue.push(b);this._handle_promise(c,b).always(this._process_queue.bindTo(this))},_set_current_item_page:function(b){this._current_item_page=b},_process_queue:function(){var b=0,c;while(this._loading_queue[0]&&this._loading_queue[0].state!=="pending"){c=this._loading_queue.shift();if(c.state=="loaded"||c.state=="error"){this._add_loaded_page(c)}b++}if(this._loading_queue.length<1){PubSub.publish("BrowseLikeThisStream.next_page_loading",false)}else{PubSub.publish("BrowseLikeThisStream.next_page_loading",c)}},_handle_promise:function(d,c){var b=this;return d.done(function(e){c.advert_dom=e.advert_dom;c.results_dom=e.results_dom;c.results_rids=e.results_rids;c.has_more=e.has_more;c.has_less=Boolean((e.query_params.offset>0));c.error_state=e.error_state;c.state="loaded";b._add_loaded_items(e.results_rids,c.id)}).fail(function(e){c.state="error";c.error=e})},_add_loaded_page:function(b){this._loaded_pages.push(b);if(!b.is_initial_page&&b.paging_mode!="paged"){PubSub.publish("BrowseLikeThisStream.new_page_added",b)}},_add_loaded_items:function(d,b){if(!d){return}var c=this;$.each(d,function(e,f){c._items[f.stream_offset]={itemid:parseInt(f.itemid,10),stream_offset:parseInt(f.stream_offset,10),pageid:parseInt(b,10)}})},_next_page_id:function(){return ++this._max_page_id},_init_new_page:function(f,b){var e,d=0,c;if(b){c=this._loaded_pages[0]}else{c=this._loaded_pages[this._loaded_pages.length-1]}if((!c.has_more&&!b)||(!c.has_less&&b)){return}e=this._create_page(c);if(b){d=parseInt(e.query_params.offset,10)-parseInt(e.query_params.length,10);e.number--}else{d=parseInt(e.query_params.offset,10)+parseInt(e.query_params.length,10);e.number++}if(d<0){d=0;e.result_limit=e.query_params.offset}e.query_params.offset=d;e.display_method=f?"auto":"button";e.state="pending";e.is_initial_page=false;if(e.query_params.view_mode=="full"){e.query_params.results_shown=(parseInt(e.query_params.results_shown,10)||0)+(parseInt(e.query_params.length,10)||0);e.query_params.length=5;if(e.paging_mode==="paged"){e.query_params.results_shown=0}}if(Number(e.max_offset)&&e.query_params.offset>=Number(e.max_offset)){return}return e},_next_item_callback:function(){var b=this._current_offset+1,c=this._items[b];if(c!==undefined){return $.Deferred().resolve(c).promise()}if(c===undefined&&this._current_item_page.has_more){return this._create_next_item_promise(false)}return $.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_prev_item_callback:function(){var b=this._current_offset-1,c=this._items[b];if(c!==undefined){return $.Deferred().resolve(c).promise()}if(c===undefined&&this._current_item_page.has_less){return this._create_next_item_promise(true)}return $.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_has_next_callback:function(){var b=this._current_offset+1;if(this._items[b]!==undefined){return true}if(this._current_item_page.has_more===true&&b<parseInt(this._current_item_page.max_offset,10)){return true}return false},_has_prev_callback:function(){var b=this._current_offset-1;if(b<0){return false}if(this._items[b]!==undefined){return true}if(this._items[b]===undefined&&this._current_item_page.paging_mode!="infinite"){return true}return false},_on_stream_item_opened:function(c){var d,b;if(this._items[c.stream_offset]!==undefined){d=this._items[c.stream_offset];b=this._current_item;if(b&&b.pageid!=d.pageid){if(this._pages.hasOwnProperty(d.pageid)){this._current_item_page=this._pages[d.pageid];PubSub.publish("BrowseLikeThisStream.current_item_page_changed",{new_page:this._current_item_page,old_page:this._pages[b.pageid]})}}this._current_item=d;this._current_offset=d.stream_offset}else{this._current_item=null;this._current_offset=null}},_on_stream_item_closed:function(b){if(this._items[b.current_offset]===undefined){return}PubSub.publish("BrowseLikeThisStream.duperbrowse_stream_item_closed",this._items[b.current_offset])},_create_next_item_promise:function(e){var i,d,h,g,c,f=false,b=this;c=function(j){if(f){return $.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise()}return j.results_rids[0]};g=function(j){if(f){return $.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise()}return j.results_rids[j.results_rids.length-1]};i=this._init_new_page(true,e);if(!i){return $.Deferred().reject("no page").promise()}d=this._fetcher.fetch(i.portal_api,i.query_params,i.result_limit);if(this._loading_queue.length<1){PubSub.publish("BrowseLikeThisStream.next_page_loading",i)}this._loading_queue.push(i);this._handle_promise(d,i).always(this._process_queue.bindTo(this));h=$.when(d).pipe((e===true?g:c));h.cancel=function(){f=true};return h}});new a();window.BrowseLikeThisStream={get_blt_url_for_offset:function(d){var c=Glbl("Location.get_params"),b="";d=d||0;if(d){c.offset=d}else{if(c.offset!==undefined){delete c.offset}}if(!$.isEmptyObject(c)){b="?"+$.param(c)}if(Glbl("Location.pushstate_enabled")){b+=window.location.hash}return window.location.pathname+b}}})();if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.js")}});
DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/difi.js"],function(){(function(a){window.BLTStreamFetcher=Base.extend({_options:{},_defaults:{},constructor:function(b){this._options=a.extend({},this._defaults,b)},fetch:function(c,b,d){var e=a.Deferred();e.request={portal_api:c,query_params:b,advert_dom:"",results_dom:[],results_rids:[],has_more:false,error_state:0,result_limit:d};DiFi.pushPublicGet("PortalCore","get_result_thumbs",[e.request.portal_api,e.request.query_params],this._difi_callback.bindTo(this,e));DiFi.send();return e.promise()},_difi_callback:function(c,j,h){if(j&&h.response.content.resources){var g,f=h.response.content.resources,b=[],e=parseInt(c.request.query_params.offset,10),d=parseInt(c.request.result_limit,10);if(d>0){f=f.slice(0,d)}for(g=0;g<f.length;g++){c.request.results_rids.push({type:f[g][0],itemid:f[g][1],stream_offset:e});b.push(f[g][2]);e++}c.request.advert_dom=h.response.content.ad;c.request.results_dom=b;c.request.has_more=Boolean(h.response.content.has_more);c.request.error_state=parseInt(h.response.content.error_state,10);c.resolve(c.request)}else{c.reject(h.response.content.error||"Unknown DiFi Error")}}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.fetcher.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/gmi.js","jms/lib/popup2.js","jms/lib/jquery/jquery.current.js",".domready","jms/lib/gstream/resource_stream.js","jms/lib/gstream/portal_core_resource_stream.js","jms/pages/browselikethis/browselikethis.stream.scroll_manager.js","jms/pages/duperbrowse/duperbrowse.helpers.js","jms/lib/jquery/plugins/jquery.somedata.js"],function(){(function(d,c){var a="infinite",b="paged";c.BrowseLikeThisStreamView=c.PortalCoreResourceStream.extend({_infinite_scroll_enable:false,_reached_end:false,_$paging_container:null,_$load_more_button:null,_$gear_menu_button:null,_$first_paging_results:null,_$loading_indicator:null,_$loading_message:null,_scroll_manager:null,_results_since_last_ad:0,preview_override_selection_type:c.BrowseLikeThisPreviewSelection,_allow_show_more:false,_removed_pages:{},_current_page_offset:0,_initial_location:{path:Glbl("Location.path"),query:Glbl("Location.get_params")},_$ad_container:null,_ad_html:null,templates:{errors:{generic:'<span class="browse-error">There was an error loading this page.</error>',states:{1:'<div class="browse-no-results">There was an error performing your request. Please try again later.</div>',2:'<div class="browse-no-results">Sorry, deviantART does not serve more than @_MAX_OFFSET_@ results for this query.</div>',3:'<div class="browse-no-results">Sorry, we found no relevant results.</div>',4:'<div class="browse-no-results">Sorry, we don\'t have that many results.</div>',5:'<div class="browse-no-results">All of the results on this page have been hidden due to your Mature Content Settings.</div>',6:'<div class="browse-no-results">All of the results on this page have been hidden due to the owner putting them into storage. There may be more visible results on later pages.</div>',7:'<div class="browse-no-results">All of the results on this page have been hidden due to the owner deleting them. There may be more visible results on later pages.</div>'}}},handlers:{next_page_loading:function(f,h){if(h){var g="#browse-results-page-"+h.id;if(d(g).length<1){h.results_dom=[];var e=this._make_page(h);this._$paging_container.before(e)}this._hide_reached_end();this._$load_more_button.hide();this._$gear_menu_button.hide();this._$first_paging_results.hide();this._$loading_indicator.show()}else{if(!this._infinite_scroll_enable&&!this._reached_end){this._$load_more_button.show();this._$gear_menu_button.show();this._$first_paging_results.show()}this._$loading_indicator.hide()}},cancel_pending:function(g,e){for(var f=0;f<e.length;f++){d("#browse-results-page-"+e[f].id).remove()}},new_page_added:function(f,e){setTimeout(function(){if(this._infinite_scroll_enable){d("#depths").hide().data("infinite_scroll_enabled",true);this._$paging_container.css("padding-bottom","300px")}else{if(!this._reached_end){this._$load_more_button.show();this._$gear_menu_button.show();this._$first_paging_results.show()}}var h=d("#browse-results-page-"+e.id);if(h.length<1){h=this._make_page(e)}else{h.detach().find(".page-results").html(this._make_contents_html(e))}if(this._scroll_manager&&e.paging_mode===a){this._scroll_manager.add_page(e.id,h)}else{this.add_non_scroll_page(e,h)}if(e.has_more&&(Number(e.query_params.offset)+Number(e.query_params.length))<e.max_offset){this._reached_end=false;this._hide_reached_end()}else{this._$load_more_button.hide();this._$gear_menu_button.hide();this._$first_paging_results.hide();this._reached_end=true;this._show_reached_end()}this._make_legacy_js_happy(h);var g="/vpv/"+c.location.host.split(".")[0]+c.location.pathname+"?offset="+e.query_params.offset;PubSub.publish("PageViewTracker.pageview",{page:g,tag:"Dynamic.BrowseResultsPage"});this._init_new_thumbs(e.results_rids,d("#browse-results-page-"+e.id+" .page-results"));if(this._infinite_scroll_enable){d("#depths").remove();this._$paging_container.css("padding-bottom","300px")}}.bindTo(this),1)},infinite_scroll_enabled:function(e){this._infinite_scroll_enable=true;this._$load_more_button.hide();this._$gear_menu_button.hide();this._$first_paging_results.hide()},infinite_scroll_disabled:function(e){this._infinite_scroll_enable=false;this._$load_more_button.show();this._$gear_menu_button.show();this._$first_paging_results.show()},current_item_page_changed:function(e,f){if(this.gmi_args.paging_mode===b){if(this._removed_pages[f.old_page.id]!==undefined){f.new_page.ad_settings.disabled=true}this.handlers.new_page_added.bindTo(this)(e,f.new_page);this._removed_pages[f.old_page.id]=true;this._current_page_offset=f.new_page.query_params.offset}},duperbrowse_stream_item_closed:function(j,i){var g=["#browse-results-page-"+i.pageid+" .page-results > .tt-a","#browse-results-page-"+i.pageid+" .page-results > .deviation-full-container > .deviation-full-data","#browse-results-page-"+i.pageid+" .page-results > .tt-a > .journal-wrapper.tt-a"];var f=d(g.join(",")).filter(function(){return d.data(this,"itemid")==i.itemid});if(f.length===0){return}var h=f.offset().top;var e=d(c).scrollTop();if(!(h>e&&h<(e+d(c).height()))){d(c).scrollTop(h)}if(this.gmi_args.paging_mode===b){if(this._$ad_container&&this._ad_html){this._$ad_container.html(this._ad_html)}}},duperbrowse_set_closing_location:function(f,e){if(this.gmi_args.paging_mode===b){var g=Glbl("Location.get_params"),h=Number(this._current_page_offset);e=this._replace_url_offset(e,g,h);PubSub.publish("Location.replace",e)}},popup_trigger_click:function(){d(".pane-switch").css("z-index",10);var h=d(this);var e=h.data("name");if(!Popup2.getPopup(e)){new Popup2(e,"body",{classes:e,content:d("#"+e).clone(true).show(),hidden:function(){h.removeClass("popupactive");if(h.data("type")){this.$node.removeClass(h.data("type"))}},shown:function(){h.addClass("popupactive");this.$node.addClass(h.data("type"))}})}var g=Popup2.getPopup(e);if(g.active){g.hide()}else{var f={keepOnScreen:false};if(e=="browse-paging-popup"){f.valign="center";f.bump={top:7,left:-9}}g.show(g.position(h,f));d(".paging-results-go-input:visible").focus()}return false},popup_active_check:function(){if(Popup2.getPopup(d(this).data("name")).active){return false}},ignore_journal_preview_click:function(i){var h=d(i.target);if(h.closest(".journalcontrol,.blogcontrol")[0]){i.preventDefault();i.stopPropagation();var f=h.closest(".journal-browse").find(".journal-footer:last > a:first");if(d("#browse2, #browse-results").length){f.click()}else{var g=h.closest(".journal-browse").find(".journalcontrol .metadata a:first");if(h.is("[href]")){document.location=h.attr("href")}else{if(g.length){document.location=g.attr("href")}else{document.location=f.attr("href")}}}}},top_button_click:function(){c.scrollTo(0,0);return false},ie8_hover_fix:function(){d(this).find(".mlt-link").css("background-color","#196BA7").find(".mlt-text").css("display","block")},points_download_button_click:function(f){f.preventDefault();PubSub.publish("PointsDownload.download_click",d(f.currentTarget))},show_purchasable_tooltip:function(){var f=d(this);var e=0;if(f.hasClass("purchasable-pcp")&&f.parent().hasClass("tt-fh-purchasable-contain-both")){e=30}f.data("title",f.attr("title"));f.removeAttr("title");f.after(d("<div>").addClass("purchasable-tooltip").css({top:-32,left:e}).text(f.data("title")))},hide_purchasable_tooltip:function(){d(".purchasable-tooltip").remove()}},gmiConstructor:function(){this.$.removeClass("dwait");this.$.find(".browse-no-results a").click(function(){c.location=this.href;return false});this._init_stream();this._$paging_container=d(".browse-paging",this.gmi_node);var e=d(".load_more",this._$paging_container);if(!e.hasClass("disabled")){this._$load_more_button=e.click(this._load_more_click.bindTo(this)).closest(".pagination")}this._allow_show_more=!e.hasClass("disabled");this._$gear_menu_button=d(".paging-dropdown-trigger",this._$paging_container);this._$first_paging_results=d(".paging-results-first-page",this._$paging_container);this._$loading_indicator=d('<span class="browse-loading">Loading ...</span>').hide().appendTo(this._$paging_container);d("body").on("keydown",".paging-results-go-input",this._keydown_go_input.bindTo(this)).on("click",".paging-results-go",this._set_offset.bindTo(this)).on("click",".paging-style-link",this._change_paging_style);var f=d("#browse-results");f.on("click",".popup-trigger",this.handlers.popup_trigger_click).on("mousedown",".popup-trigger",this.handlers.popup_active_check).on("mousedown",".journal-browse",this.handlers.ignore_journal_preview_click).on("click","a.browse-top-link",this.handlers.top_button_click).on("mouseenter",".tt-fh-purchasable",this.handlers.show_purchasable_tooltip).on("mouseleave",".tt-fh-purchasable",this.handlers.hide_purchasable_tooltip);if(d.browser.msie&&d.browser.version=="8.0"){f.on("mouseenter",".tt-a, .deviation-full-data",this.handlers.ie8_hover_fix)}this.base();var g=d("<div></div>");this._$paging_container.before(g);if(this.gmi_args.paging_mode===a){this._scroll_manager=new BrowseLikeThisScrollManager(g);d(this._scroll_manager).bind("top_page_changed",this._top_page_changed.bindTo(this));d(this._scroll_manager).bind("needs_more",this._needs_more.bindTo(this));d(this._scroll_manager).bind("pages_became_visible",this._pages_became_visible.bindTo(this))}PubSub.subscribe([{eventname:"BrowseLikeThisStream.next_page_loading",subscriber:this,callback:this.handlers.next_page_loading},{eventname:"BrowseLikeThisStream.cancel_pending_pages",subscriber:this,callback:this.handlers.cancel_pending},{eventname:"BrowseLikeThisStream.new_page_added",subscriber:this,callback:this.handlers.new_page_added},{eventname:"BrowseLikeThisStream.infinite_scroll_enabled",subscriber:this,callback:this.handlers.infinite_scroll_enabled},{eventname:"BrowseLikeThisStream.infinite_scroll_disabled",subscriber:this,callback:this.handlers.infinite_scroll_disabled},{eventname:"BrowseLikeThisStream.current_item_page_changed",subscriber:this,callback:this.handlers.current_item_page_changed},{eventname:"BrowseLikeThisStream.duperbrowse_stream_item_closed",subscriber:this,callback:this.handlers.duperbrowse_stream_item_closed},{eventname:"DuperBrowse.set_closing_location",subscriber:this,callback:this.handlers.duperbrowse_set_closing_location}])},_init_stream:function(){var g={number:Math.floor(this.gmi_args.query_params.offset/this.gmi_args.count_per_page)+1,portal_api:this.gmi_args.portal,query_params:this.gmi_args.query_params,results_dom:d("#browse-results-page-1 .page-results",this.gmi_node).html(),has_more:Boolean(this.gmi_args.more_to_load),has_less:Boolean((this.gmi_args.query_params.offset>0)),max_offset:this.gmi_args.max_offset,result_type:this.gmi_args.paging_result_type,ad_settings:this.gmi_args.ad_settings,paging_mode:this.gmi_args.paging_mode};var e=this._find_dom_nodes_in_container(d("#browse-results-page-1 .page-results")),h=[],f=this,i=g.query_params.offset;d.each(e,function(l,j){var q=d(j),m=q.attr("collect_rid"),p={stream_offset:i};if(m){m=m.split(":");if(m[0]&&m[1]){p.type=m[0];p.itemid=m[1]}}if(p.itemid&&q.hasClass("tt-fh")){DuperbrowseHelpers.init_thumb_data(p,q,"a.thumb, a.tt-fh-purchasable");h.push(p);d("a.thumb, span.details a.t",q).on("click.duperbrowse",f._open_duperbrowse)}if(p.itemid&&q.hasClass("deviation-full-data")){DuperbrowseHelpers.init_thumb_data(p,q,"a.full-view-link");h.push(p);$anchor=q.parent().next().find(".minipage-title a");$anchor.on("click.duperbrowse",f._open_duperbrowse);if(q.find("> div.journal-wrapper.tt-a").length===0){q.on("click.duperbrowse",f._open_duperbrowse)}}if(!p.itemid&&q.length>0){var o=q.find("div.journal-footer a.more"),n=q.find("div.journal-wrapper.tt-a");p.type=1;p.itemid=o.data("deviationid");DuperbrowseHelpers.init_thumb_data(p,n,"div.journal-footer a.more");h.push(p);n.on("click.duperbrowse",f._open_duperbrowse)}if(!p.itemid&&q.length===0){console.log("[BrowseStreamView] Init found invalid stream item")}i++});g.results_rids=h;PubSub.publish("BrowseLikeThisStream.init",g);this._init_ads()},_init_ads:function(){var e=Number(this.gmi_args.ad_settings.results_before_first||0),f=Number(this.gmi_args.count_per_page);if(e<f){this._results_since_last_ad=f-e}},_init_new_thumbs:function(f,g){var e=this;d.each(f,function(h,i){var m=g.find('> .tt-a[collect_rid="'+i.type+":"+i.itemid+'"]');if(m.length!==0){DuperbrowseHelpers.init_thumb_data(i,m,"a.thumb, a.tt-fh-purchasable");d("a.thumb, span.details a.t",m).on("click.duperbrowse",e._open_duperbrowse);return}m=g.find('> .deviation-full-container .deviation-full-data[collect_rid="'+i.type+":"+i.itemid+'"]');if(m.length!==0){DuperbrowseHelpers.init_thumb_data(i,m,"a.full-view-link");if(m.find("> div.journal-wrapper.tt-a").length===0){m.on("click.duperbrowse",e._open_duperbrowse)}$anchor.on("click.duperbrowse",e._open_duperbrowse);return}if(m.length===0){var l=g.find('> .tt-a .journal-footer a.more[data-deviationid="'+i.itemid+'"]');if(l.length===0){console.log("[BrowseStreamView] RID Item not found in stream DOM",i);return}var j=l.closest("div.journal-wrapper.tt-a");DuperbrowseHelpers.init_thumb_data(i,j,"div.journal-footer a.more");j.on("click.duperbrowse",e._open_duperbrowse)}})},_open_duperbrowse:function(g){var i=c.DuperbrowseHelpers.click_handler(g),f=["itemid","stream_offset","type"];if(i.open_duperbrowse){var e=d(this),h=e.closest(".tt-a").someData(f);if(e.hasClass("deviation-full-data")){h=e.someData(f)}if(d.isEmptyObject(h)&&e.parent().hasClass("minipage-title")){h=e.closest(".deviation-full-minipage").prev().find(".deviation-full-data").someData(f)}if(!d.isEmptyObject(h)){h.wait_for_load=i.wait_for_load;h.context=e.data("duper-context");PubSub.publish("BrowseLikeThisStream.open_duperbrowse",h);return false}return true}return i.click_return},_load_more_click:function(e){PubSub.publish("BrowseLikeThisStream.load_next",false);PubSub.publish("BrowseLikeThisStream.infinite_scroll_enabled");return false},_keydown_go_input:function(f){if(f.keyCode==13){this._set_offset()}},_set_offset:function(){var e=Math.max((parseInt(d(".paging-results-go-input:visible").val(),10)-1),0);c.location=BrowseLikeThisStream.get_blt_url_for_offset(e)},_change_paging_style:function(){var e=d(".thumb-limit-picker").data("offset");if(e){c.location=d(this).attr("href")+"&offset="+e;return false}},_show_reached_end:function(){d('<div class="browse-end">End of Results</div>').appendTo(this._$paging_container)},_hide_reached_end:function(){d(".browse-end").remove()},_needs_more:function(e){if(this._infinite_scroll_enable){PubSub.publish("BrowseLikeThisStream.load_next",true)}},_top_page_changed:function(f,e){if(!e){e=1}PubSub.publish("BrowseLikeThisStream.set_first_visible_page",e)},_pages_became_visible:function(f,e){PubSub.publish("BrowseLikeThisStreamView.pages_visible",e)},_find_dom_nodes_in_container:function(e){return e.find("> .tt-a, > .deviation-full-container > .deviation-full-data").get()},domFindVisible:function(){var f={};if(!this.contents||!this.contents.length){f=this._find_dom_nodes_in_container(d(".page-results"));var g=d(".mlt-seed-container .tt-a");if(g.length){f.unshift(g.get(0))}return f}for(var e in this.contents){if(!this.contents.hasOwnProperty(e)){continue}if(this.contents[e][2]&&document.body.contains(this.contents[e][2])){f[e]=this.contents[e][2]}}return f},_make_page:function(g){var f="results-page-"+g.query_params.view_mode;if(g.query_params.thumb_mode=="grid"){f+=" stream-fh-grid";if(vms_feature("responsive_grid")){f+=" stream-fh-grid-responsive responsive-full-width"}}var e;if(g.paging_mode===b){e='<div class="browse-results-page" id="browse-results-page-'+g.id+'">';e+='<div class="page-results '+f+'">'+this._make_contents_html(g)+"</div>";e+="</div>";return d(e)}e='<div class="browse-results-page" id="browse-results-page-'+g.id+'"><hr class="browse-divider browse-page-divider"><div class="browse-page-header"><div class="paging-results browse-link-button popup-trigger" data-name="paging-results-popup">'+g.result_type+' <div class="paging-results-count">'+(parseInt(g.query_params.offset,10)+1)+" - "+(parseInt(g.query_params.offset,10)+parseInt(g.query_params.length,10))+'</div></div><a href="javascript:void(0)" class="browse-top-link browse-proper-button"><span>&uarr;</span> Top</a>';if(g.id==2){e+='<div data-name="browse-paging-popup" data-type="paging-gear" data-offset="'+g.query_params.offset+'" class="thumb-limit-picker paging-dropdown-trigger popup-trigger"><span></span></div>'}e+='</div><div class="page-results '+f+'">'+this._make_contents_html(g)+"</div></div>";return d(e)},_make_contents_html:function(g){if(g.state=="error"){return this.templates.errors.generic}else{if(g.error_state>0){var e=this.templates.errors.states[g.error_state];return e.replace("@_MAX_OFFSET_@",this.gmi_args.max_offset)}}if(!g.ad_settings.disabled&&g.results_dom.length){var h,f="browse-results-page-"+g.id;if(Number(g.ad_settings.results_between)==0){h=0}else{if(this._results_since_last_ad==null){h=Number(g.ad_settings.results_before_first)-Number(this.gmi_args.count_per_page)}else{h=Number(g.ad_settings.results_between)-this._results_since_last_ad}}if(h<g.results_dom.length){if(g.advert_dom){g.results_dom.splice(h,0,g.advert_dom)}this._results_since_last_ad=g.results_dom.length-h-1}else{this._results_since_last_ad=(this._results_since_last_ad||0)+g.results_dom.length}}if(!(d.isArray(g.results_dom))){return g.results_dom}return g.results_dom.join("")},add_non_scroll_page:function(k,j){var m=parseInt(k.query_params.offset,10)+1,n=parseInt(k.query_params.offset,10)+parseInt(k.query_params.length,10),g=d(".browse-results-page"),h=d(".next a","div.browse-paging div.pagination"),e=d(".prev a","div.browse-paging div.pagination"),o=["th","st","nd","rd"],p,l=j.find('iframe[data-da-ad="1"]');if(l.length>0){this._$ad_container=l.parent();this._ad_html=l.appendTo("<div>").parent().html();l.remove()}g.replaceWith(j);d(".paging-results-count").text(m+" - "+n);if(m>1){p=(m-parseInt(k.query_params.length,10))-1;e.removeClass("disabled").attr("href",this._replace_url_offset(this._initial_location.path,this._initial_location.query,p));var i=o[(m%10>3)?0:m%10];if((m%100>=11)&&(m%100<=13)){i="th"}var f='<span class="showing-page">Starting from '+m+"<sup>"+i+'</sup> result</span><span class="first-result-spacer"></span><a class="browse-back-to-first-result" href="http://browse.deviantart.com/"> Go to first result </a>';d("div.page-results").before(f)}else{e.addClass("disabled").attr("href","")}if(k.has_more){h.removeClass("disabled").attr("href",this._replace_url_offset(this._initial_location.path,this._initial_location.query,n))}else{h.addClass("disabled").attr("href","")}},_replace_url_offset:function(g,h,f){var e="",i=Number(f);if(i){h.offset=i}else{if(h.offset!==undefined){delete h.offset}}if(d.isEmptyObject(h)){return g.replace(/\?[^?#]*/,"")}e="?"+d.param(h);g=g.replace(/\?.*/,"");return g+e},get_all_selectable_result_nodes:function(){return d.map(this.contents,function(e){return e[2]})},get_stream_node_from_clicked_node:function(e){return d(e).closest(".tt-a, .deviation-full-data").get(0)},_override_loader_item_read:function(f){var e=d(f),g=e.hasClass("journal-wrapper")?e:e.find(".journal-wrapper:first");if(g.length&&!g.find('[id="news-special"]').length){return d(g.html()).find(".journal-footer").remove().end()}else{return OUTLINE_PreviewStream.loaderItemRead.apply(this,arguments)}},_make_legacy_js_happy:function(g){var f=this._find_dom_nodes_in_container(g.find(".page-results"));for(var h=0;h<f.length;h++){var j=f[h],e=d(j);if(j&&j.getAttribute&&(j.getAttribute("collect_rid")||e.hasClass("journal-browse"))){this.contents.push(this.domReadOne(j))}else{j=e.find("[collect_rid]").get(0);if(j&&j.getAttribute&&j.getAttribute("collect_rid")){this.contents.push(this.domReadOne(j))}}}},commsMakeCustomSurfer:function(l,k,j){var f=d(j);if(k[0]==1&&f.hasClass("deviation-full-data")&&f.find(".journal-wrapper").length){var h=f.find("h2:first").get(0),g=Surfer.create(l,h,undefined,undefined,true,true),i=d(g.node);i.addClass("browse-title-surfer");if(i.find("img").length<1){i.addClass("lit-title-surfer")}g.mod_down={x:-(i.width()/2),y:-(i.height()/2)};return g}return false}})})(jQuery,window);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.view.js")}});
DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/pages/browselikethis/browselikethis.ads.js",".domready"],function(){(function(c){var d=null;PubSub.subscribe({eventname:"BrowseLikeThisAdPool.instance_loaded",subscriber:{},callback:function(e,f){d=f}});var b=Base.extend({$node:null,has_ad:false,$ad_container:null,ad_height:0,ad_offset:null,page_id:null,height:0,offset:0,is_on_screen:false,last_measured_at:null,constructor:function(e,f){this.page_id=e;this.$node=f;var h=this.$node.find('iframe[data-da-ad="1"]');if(h.length){this.has_ad=true;this.$ad_container=h.parent();this.ad_height=h.height();var g=c("<div>");h.appendTo(g);if(d){d.stash_ad_html(g.html())}}},measure:function(){if(!this.is_on_screen){throw new Error("Cannot measure page that is not visible")}this.height=this.$node.outerHeight();this.last_measured_at=new Date().getTime();if(this.has_ad){this.ad_offset=this.offset+this.$ad_container.offset().top-this.$node.offset().top}},render_ad:function(){if(d){d.fill_ad_slot(this.page_id,this.$ad_container)}},stash:function(){if(this.is_on_screen){this.$node.detach();this.is_on_screen=false}}});var a=false;window.pause_scroll=function(){a=true};window.resume_scroll=function(){a=false};window.BrowseLikeThisScrollManager=Base.extend({_$node:null,_$top_buffer:null,_$bottom_buffer:null,_$w:null,_pages:[],_scroll_throttle:300,_resize_debounce:500,_advert_throttle:500,_remeasure_throttle:2000,_viewport_height:null,_last_scroll_top:-1,_last_update_needed_more:false,_first_visible_index:-1,_last_visible_index:-1,_current_top_page_idx:-1,_visible_pixels_threshold:700,_load_more_threshold:1500,constructor:function(e){this._$node=e;this._pages=[];this._$w=c(window);this._$top_buffer=c("<div></div>");this._$bottom_buffer=c("<div></div>");this._$node.prepend(this._$top_buffer);this._$node.append(this._$bottom_buffer);this._$w.on("scroll",c.throttle(this._scroll_throttle,this._on_scroll.bindTo(this)));this._throttled_render_ads=c.throttle(this._advert_throttle,this._render_ads.bindTo(this));this._$w.on("scroll",this._throttled_render_ads);this._$w.on("resize",c.debounce(this._resize_debounce,this._on_resize.bindTo(this)));this._measure_viewport()},add_page:function(e,f){var h=new b(e,f),g=this._pages[this._pages.length-1];this._pages.push(h);f.insertBefore(this._$bottom_buffer);h.is_on_screen=true;if(g){h.offset=g.offset+g.height}h.measure();if(this._pages.length==1){this._first_visible_index=0;this._last_visible_index=0}if(g&&!g.is_on_screen){h.stash()}else{this._last_visible_index=this._pages.length-1;c(this).trigger("pages_became_visible",[h.$node]);this._throttled_render_ads()}},_on_scroll:function(k){if(!this._pages.length||a){return}if(!this._$node.is(":visible")){return}var o,f,l,p=this._$node.offset().top,r=this._$w.scrollTop()-p;if(!k&&r==this._last_scroll_top){return}o=this._find_at_offset(r-this._visible_pixels_threshold,this._first_visible_index);f=this._find_at_offset(r+this._viewport_height+this._visible_pixels_threshold,this._last_visible_index);if(o<0){o=0}if(f<0){f=this._pages.length-1}if(o!==this._first_visible_index||f!==this._last_visible_index){this._$top_buffer.height(this._pages[o].offset);for(l=this._first_visible_index;l<=this._last_visible_index;l++){if(l<o||l>f){this._pages[l].stash()}}var q=true,e=[];for(l=o;l<=f;l++){if(this._pages[l].is_on_screen){q=false}else{if(q){this._$top_buffer.after(this._pages[l].$node)}else{this._$bottom_buffer.before(this._pages[l].$node)}this._pages[l].is_on_screen=true;e.push(this._pages[l].$node)}}if(e.length){c(this).trigger("pages_became_visible",e)}var s=this._pages[this._pages.length-1],j=s.offset+s.height,n=this._pages[f],h=n.offset+n.height,m;this._remeasure_pages(o,f+1);if((n.offset+n.height)!==h){h=m=n.offset+n.height;for(l=f+1;l<this._pages.length;l++){this._pages[l].offset=m;m+=this._pages[l].height}}this._$bottom_buffer.height(j-h)}var g=this._find_at_offset(r,this._current_top_page_idx);if(g!==this._current_top_page_idx){c(this).trigger("top_page_changed",(g<0)?null:this._pages[g].page_id);this._current_top_page_idx=g}this._last_scroll_top=r;this._first_visible_index=o;this._last_visible_index=f;this._load_more_if_necessary(r)},_load_more_if_necessary:function(f){var g=this._pages[this._pages.length-1],e=f+this._viewport_height;if((e+this._load_more_threshold)>(g.offset+g.height)){c(this).trigger("needs_more")}},_render_ads:function(){if(!this._pages.length||a||!this._$node.is(":visible")){return}var e=this._$w.scrollTop()-this._$node.offset().top,j=e+this._viewport_height;for(var f=0;f<this._pages.length;++f){if(this._pages[f].has_ad&&this._pages[f].is_on_screen){var h=this._pages[f].ad_offset-50,g=h+this._pages[f].ad_height+100;if((h>=e&&h<=j)||(e>=h&&e<=g)){this._pages[f].render_ad()}}}},_on_resize:function(){this._measure_viewport();var e,f=3;for(e=0;e<this._pages.length;e+=f){this._remeasure_pages(e,Math.min(e+f,this._pages.length))}this._on_scroll(true);if(d){d.scroll_manager_is_done_resizing()}this._throttled_render_ads()},_remeasure_pages:function(j,f){var h,k,m=[],g=this._pages[j-1]||null,l=g?(g.offset+g.height):0,e=(new Date).getTime();for(h=j;h<f;h++){k=this._pages[h];if(!k.is_on_screen){m.push(k);k.$node.insertBefore(this._$bottom_buffer);k.is_on_screen=true}}for(h=j;h<f;h++){k=this._pages[h];if(k.last_measured_at+this._remeasure_throttle<e){k.measure()}k.offset=l;l+=k.height}for(h=0;h<m.length;h++){m[h].stash()}},_measure_viewport:function(){this._viewport_height=(window.innerHeight?window.innerHeight:this._$w.height())},_find_at_offset:function(h,f){var e=Math.max(f,0),g=this._pages[e];if(g.offset>h){do{e--;g=this._pages[e]}while(e>=0&&g&&g.offset>h);return e}else{if((g.offset+g.height)<h){do{e++;g=this._pages[e]}while(e<this._pages.length&&g&&(g.offset+g.height)<h);return(e<this._pages.length)?e:-1}}return e}})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.stream.scroll_manager.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/popup2.js","jms/lib/browser.js",".domready"],function(){(function(b){b(".browse-top-bar-mc-filter").on("click",function(){var d=b(this);b(".mature-filter-popup-container").hide();if(!deviantART.deviant.loggedIn){window.location="https://www.deviantart.com/join/?from=mature";return false}var c=Number(d.data("value"))?1:0;DiFi.pushPost("Settings","updateMatureFilter",[c],function(f,e){if(f){window.location.reload()}else{d.removeClass("working disabled");alert("Sorry there was an error while changing your settings.\n\nYou must be 18 or over to turn off mature filter.\n\nIf you are, please try again in a minute.")}});d.addClass("working").addClass("disabled");DiFi.send()});var a=false;b(".browse-top-bar-mc-filter-trigger").on("mousedown",function(){if((a)&&(a.visible())){return false}});b(".browse-top-bar-mc-filter-trigger").on("click",function(){var c=b(this);if(!a){a=new Popup2("BrowseMaturePopup","body",{classes:"browse-mature-popup",content:b(".mature-filter-popup-container").clone(true).show(),hidden:function(){c.removeClass("popupactive")},shown:function(){c.addClass("popupactive")}})}if(a.visible()){a.hide()}else{a.show(a.position(c.parent(),{align:"center"}))}return false});window.BrowseLikeThisSearchBox=GMIBase.extend({_$input:null,_$term:null,_$button:null,_initial_val:"",_initially_disabled:false,gmiConstructor:function(){this.$.removeClass("dwait");this._init_terms();this._init_input();b(".browse-top-bar .browse-search-container").click(this._search_container_click.bindTo(this));b(".browse-top-bar .search-clear").click(this._clear_search_box.bindTo(this));b(".browse-top-bar .browse-search-input").blur(this._input_blur.bindTo(this))},_init_terms:function(){this._$term=this.$.find(".search-term-container")},_init_input:function(){this._$input=this.$.find(".browse-search-input");this._$button=this.$.find(".browse-search-button");this._initial_val=this._$input.val();this._initially_disabled=this.$.hasClass("disabled");this._$input.on("keydown",this._input_keydown.bindTo(this));this._$input.on("keyup",this._input_keyup.bindTo(this));if(!window.location.hash&&!this._initially_disabled&&!Browser.isTouch){this._make_editable(true)}else{this._input_blur()}},_clear_search_box:function(){this._make_editable(false);return false},_search_container_click:function(){if(!this._$input.is(":focus")){this._make_editable(true)}return false},_make_editable:function(c){this._$term.hide();this.$.removeClass("disabled");this._$button.attr("disabled",false);this._$input.attr("disabled",false).removeClass("disabled").show();if(b.browser.mozilla){this._$input.css("position","fixed").focus().css("position","static")}else{this._$input.focus()}this._$input.select();if(!c){this._$input.val("")}if(this._$input.val()==""){this.$.find(".search-box-clear").hide()}},_input_blur:function(){var c=this._$input.val();if(c==this._initial_val){this._$input.hide();this._$term.show();this._$input.val(this._initial_val);if(this._initially_disabled){this.$.addClass("disabled");this._$input.attr("disabled",true);this._$button.attr("disabled",true);this.$.find(".search-box-clear").hide()}else{this.$.find(".search-box-clear").show()}}},_input_keydown:function(c){if(c.keyCode in {40:0,32:0,34:0,35:0}&&this._$input.val()==""){this._$input.blur()}},_input_keyup:function(){this.$.find(".search-box-clear").toggle(this._$input.val()!=="")}});b(function(){b(":gmi(BrowseLikeThisSearchBox)").gmi()})})(jQuery);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.top_bar.js")}});
DWait.ready(["jms/lib/jquery/jquery.current.js","jms/pages/duperbrowse/stream/base.custom.stream.js"],function(){(function(b){var a=window.DuperbrowseBaseCustomStream.extend({init_stream:function(){var d=b(".pcp-side-bar .pcp-thumb"),c=this;d.each(function(g,i){var f=b(i),e=f.find(".tt-aa").attr("collect_rid").split(":")[1],h={itemid:e,stream_offset:g};DuperbrowseHelpers.init_thumb_data(h,f,"a.thumb");c._items[g]=h;f.find("a").on("click",c._open_duperbrowse.bindTo(c))})},_get_item_data_from_clicked_element:function(c){var d=c.closest(".pcp-thumb").someData("itemid","stream_offset");console.log("Item data is: ",d);return d}});DWait.ready([".domready","jms/pages/duperbrowse/stream/base.custom.stream.js"],function(){new a()})})(jQuery,window);if(window.DWait){DWait.run("jms/pages/browselikethis/browselikethis.pcpstream.js")}});
(function(){var c=/^t6273hack::/;var a=function(d){var e=d.data;if(!e||!e.match||!e.match(c)){return}DWait.ready("jms/lib/jquery/jquery.current.js",function(){try{var h=JSON.parse(e.replace(c,"")),g=h.me;delete h.me;var f=encodeURIComponent(JSON.stringify(h));$("iframe").each(function(){if($(this).attr("src")==g){var j=(window.location.hostname.match(/lan$/))?"vm"+$.now():1422442270;$(this).attr("src","http://www.da-ads.com/da_custom.html?cb="+j+"#;0;beautiful_creatures;bc;1358903672;"+f);return false}})}catch(i){}})};try{if(window.postMessage){if(window.addEventListener){window.addEventListener("message",a,false)}else{window.attachEvent("onmessage",a)}}}catch(b){}})();if(window.DWait){DWait.run("jms/lib/adhack_t6273.js")};if(window.DWait){DWait.count()}