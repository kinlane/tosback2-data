/*
 *  (c) 2000-2013 deviantART, Inc. All rights reserved.
 */
window.FilmBox={hover:function(e){var t=$(e),n=t.width(),r=t.find("b.film");Station.stopAnimation(r[0]);var i=parseInt(Station.read(r[0],"left"))||0,s=[r[0],"left",{from:i,to:i,time:500}];while(i>-(n*5))s=s.concat([{from:i,to:i=i-n-i%n,time:300,f:Interpolators.pulse},{from:i,to:i,time:700}]);Station.run.apply(Station,s)},out:function(e){$filmstrip=$(e).find("b.film"),Station.stopAnimation($filmstrip[0]),Station.run($filmstrip[0],"display",{to:"block",time:25},"left",{from:parseInt(Station.read($filmstrip[0],"left")||0),to:0,f:Interpolators.pulse,time:600})}},window.DWait&&DWait.run("jms/lib/filmbox.js");

DWait.ready(["jms/lib/minibrowse.view.js","jms/lib/pubsub.js","jms/lib/analytics.js","jms/lib/cbc.js"],function(){(function(e){var t={_has_next:!1,_has_prev:!1,_has_mobile_ad:!0,_textad_suppressed:!1,_current_item_id:null,_reload_anchor:null,_print_tabs_def:null,constructor:function(){PubSub.subscribe([{eventname:"MinibrowseView.take_over_page",subscriber:this,callback:this.da__handlers.take_over_page},{eventname:"MinibrowseView.restore_page",subscriber:this,callback:this.da__handlers.restore_page},{eventname:"MinibrowseView.populate_main",subscriber:this,callback:this.da__handlers.populate_main},{eventname:"MinibrowseView.populate_extra",subscriber:this,callback:this.da__handlers.populate_extra},{eventname:"MinibrowseView.preload_main",subscriber:this,callback:this.da__handlers.preload_main},{eventname:"MinibrowseView.preload_extra",subscriber:this,callback:this.da__handlers.preload_extra},{eventname:"MinibrowseView.populate_failed",subscriber:this,callback:this.da__handlers.populate_failed},{eventname:"MinibrowseView.init_extras",subscriber:this,callback:this.da__handlers.init_extras},{eventname:"Duperbrowse.has_next",subscriber:this,callback:this.da__handlers.has_next},{eventname:"Duperbrowse.has_prev",subscriber:this,callback:this.da__handlers.has_prev},{eventname:"Duperbrowse.opened",subscriber:this,callback:this.da__handlers.opened},{eventname:"Duperbrowse.pageload_failed",subscriber:this,callback:this.da__handlers.pageload_failed},{eventname:"Duperbrowse.disable_paddle",subscriber:this,callback:this.da__handlers.disable_paddle},{eventname:"ProductTabsLoader.loaded",subscriber:this,callback:this.da__handlers.print_tabs_loaded}])},da__handlers:{populate_main:function(e,t){PubSub.publish("PageViewTracker.pageview",{page:"/vpv"+Glbl("Location.path"),tag:"Dynamic.Deviation"}),PubSub.publish("DaGa.track_tao_pageview",{page_namespace:"deviation"}),window.DDD&&(DDD.subject=null);var n=this._get_container();n.find("iframe.madefire-player").length&&n.addClass("madefire"),vms_feature("new_devpage")&&n.find(":gmi(DeviationPageView)").removeClass("duper-loading")},populate_extra:function(t,n){var r=this._get_container(),i=this._get_about(),s=this._get_meta(),o=[],u;Glbl("Site.is_mobile")&&deviantART.pageData.overlay_sponsor&&e("#superbrowse-deviation-ad").length===0&&r.prepend('<div id="superbrowse-deviation-ad"></div>');if(n.edit===!0)DWait.ready(["jms/pages/ile/ile.js"],e.proxy(function(){i.html(n.content.html_col1),s.html(n.content.html_col2),r.prepend(i.find("#ile-container")),PubSub.publish("InlineEditor.open"),r.show(),this._init_deviation_extras(n,i,s)},this));else{(vms_feature("helloandre")||vms_feature("new_devpage"))&&Glbl("PurchaseAutoload.purchase")=="prints"&&(this._print_tabs_def=e.Deferred(),o.push(this._print_tabs_def));if(vms_feature("new_devpage")){var a=e.Deferred();o.push(a),u=new CBC(function(){a.resolve()})}o.length&&(i.hide(),s.hide(),e.when.apply(e,o).done(function(){i.show(),s.show(),PubSub.publish("DeviationExtras.shown")})),i.html(n.content.html_col1),s.html(n.content.html_col2),this._init_deviation_extras(n,i,s)}n.content&&(gWebPage.update(n.content,u),u&&u.start())},take_over_page:function(t){this._get_container().css("min-height",e(window).height()),e("#depths").appendTo("body"),e("#depths").show(),!Glbl("Site.is_mobile")&&(!deviantART.deviant.loggedIn||deviantART.deviant.ads)&&(Glbl("ads.minibrowse_has_textbanner")?e(".textbanner-ad").addClass("loading is-visible"):(Glbl("ads.minibrowse_has_textbanner",!0),this._get_container().prepend('<div class="textbanner-ad is-visible"><div class="tbacontent"></div></div>'))),window.Popup2&&Popup2.hideAll(),this._take_over_overhead_box(),this._add_loading_text()},restore_page:function(t){this._restore_overhead_box(),this._current_item_id=null,e("#ile-container").empty(),Glbl("InlineEditor.loaded",!1)},has_next:function(e,t){this._has_next=Boolean(t)},has_prev:function(e,t){this._has_prev=Boolean(t)},opened:function(e,t){this.debugging&&console.log("[MinibrowseView] Duperbrowse has been opened"),this._current_item_id=t.id},preload_main:function(t,n){var r=n.content;switch(r.pageData.deviation_preload_type){case"image":var i=e(":gmi(ResViewSizer_img)",r.html).first();this._preload_image(i.attr("src"));break;case"embed":this._preload_image(r.pageData.deviation_preload_file);break;case"html":this._preload_html(r.html);break;case"none":break;default:this.debugging&&console.log("[MinibrowseView] unknown preload type:",r.pageData.deviation_preload_type)}},preload_extra:function(t,n){var r=n.content,i=e("img.avatar",r.html_col1).first();this._preload_image(i.attr("src"))},populate_failed:function(t,n){var r='<div><h1 style="color:#607066;text-align:center;padding-top:4em;">An error occurred while displaying this deviation</h1><p style="text-align:center;">Please visit <a href="'+Glbl("Location.path")+'">the deviation page</a> to try again.</p>'+"</div>";vms_feature("new_devpage")?e(".dev-page-container.minibrowse-container").html(r):e("div#dv7").html(r)},pageload_failed:function(t,n){var r='<div><h1 style="color:#607066;text-align:center;padding-top:4em;">An error occurred while loading the next set of deviations</h1><p style="text-align:center;">Please try again.</p></div>';vms_feature("new_devpage")?e(".dev-page-container.minibrowse-container").html(r):e("div#dv7").html(r)},disable_paddle:function(t,n){var r=n===!0?".minibrowse_prev":".minibrowse_next";e(r,window.da_overhead_box.$node).addClass("disabled")},init_extras:function(e,t){this._init_deviation_extras(t,this._get_about(),this._get_meta())},print_tabs_loaded:function(e){this._print_tabs_def&&this._print_tabs_def.resolve()}},_preload_html:function(t){if(!t)return;this.debugging&&console.log("[MinibrowseView] preloading HTML");var n=this._make_preloader(e("<iframe><html><body></body></html></iframe>")).find("body").html(t).each(function(){e(this).find("embed, object").remove()}).end().appendTo("body");return n},_preload_image:function(t){if(!t)return;this.debugging&&console.log
("[MinibrowseView] preloading image",t);var n=this._make_preloader(e("<img>")).attr("src",t).appendTo("body");return n},_make_preloader:function(t){return t.css({position:"absolute",top:-100,left:-100,width:1,height:1,overflow:"hidden",visibility:"hidden"}).load(function(){e(this).remove()})},_take_over_overhead_box:function(){var t=window.da_overhead_box.$node,n="",r="",i=this._has_prev?"":" disabled",s=this._has_next?"":" disabled";n+='<td class=f><a href="javascript:void(0)" class="gmbutton2 gmhuge gmbutton2top ntfirst minibrowse_prev'+i+'"><img src="//st.deviantart.net/minish/main/superbrowse/3dleft.png" alt="Left" width=8 height=9> Prev</a></td>',n+='<td class=f><a href="javascript:void(0)" class="gmbutton2 gmhuge gmbutton2top ntmid minibrowse_close">&nbsp;<img src="//st.deviantart.net/minish/main/superbrowse/3dback.png" alt="All" width=9 height=9> All&nbsp;</a></td>',n+='<td class=f><a href="javascript:void(0)" class="gmbutton2 gmhuge gmbutton2top ntlast minibrowse_next'+s+'">Next <img src="//st.deviantart.net/minish/main/superbrowse/3dright.png" alt="Right" width=8 height=9></a></td>',window.da_overhead_box.setHTML(n),window.da_overhead_box.$node.data("minibrowse_paddles_bound")||window.da_overhead_box.$node.data("minibrowse_paddles_bound",!0).on("click.minibrowse",".minibrowse_prev",function(t){return e(this).hasClass("disabled")||PubSub.publish("Minibrowse.prev_click"),!1}).on("click.minibrowse",".minibrowse_next",function(t){return e(this).hasClass("disabled")||PubSub.publish("Minibrowse.next_click"),!1}).on("click.minibrowse",".minibrowse_close",function(e){return PubSub.publish("Minibrowse.close_click"),!1});var o=e(document.body);if(!o.data("minibrowse_keys_bound")){var u=this;o.data("minibrowse_keys_bound",!0).on("keydown.minibrowse",function(e){u._get_eventname_from_keypress(e)&&e.preventDefault()}).on("keyup.minibrowse",function(e){var t=u._get_eventname_from_keypress(e);if(!t)return;window.Popup2&&Popup2.hideAll(),PubSub.publish(t)})}},_get_eventname_from_keypress:function(t){var n={39:"Minibrowse.next_click",37:"Minibrowse.prev_click",27:"Minibrowse.close_click"};if(!n[t.which])return;if(t.metaKey||t.altKey||t.shiftKey||t.ctrlKey)return;var r=e(t.target);if((t.target.isContentEditable||r.attr("contenteditable")||r.is(":input"))&&r.is(":visible"))return;return n[t.which]},_restore_overhead_box:function(){e(document.body).off(".minibrowse").removeData("minibrowse_keys_bound"),window.da_overhead_box.$node.off(".minibrowse").removeData("minibrowse_paddles_bound"),window.da_overhead_box.setHTML(null)},_add_loading_text:function(){var t=e('<h1 class="loading_text" style="color:#607066;text-align:center;padding:4em 0">Loading...</h1>'),n=function(){t.animate({opacity:.3},700,r)},r=function(){t.animate({opacity:.99},700,n)};vms_feature("new_devpage")?this._get_container().find(":gmi(DeviationPageView)").addClass("duper-loading").find(".dev-view-deviation").append(t):e(":gmi(ResourcePageDisplayPane)","body > div#dv7").append(t),n()},_init_deviation_extras:function(t,n,r){if(Glbl("ResView.message_button")===!0){Glbl.del("ResView.message_button"),buttons=r.add(n).find(":gmi(ResourceViewMessageButton)").gmi();for(var i=0,s=buttons.length;i<s;i++)buttons[i].render()}buttons=GMI.query(n[0],"GPageButton").concat(GMI.query(n[0],"GMoodButton"));for(var i=0,s=buttons.length;i<s;i++)e(buttons[i].gmi_node).on("click.comments_pager",this._comments_pager_click.bindTo(this)),buttons[i].gmi_node.eventonclickclaimed=1;this._has_mobile_ad&&e("#superbrowse-deviation-ad").html(t.content.html_col3||""),Glbl("ads.minibrowse_has_textbanner")&&this._fill_textbanner_ad(t),deviantART&&deviantART.pageData.is_not_favouritable&&e("#zoomed-in").addClass("no-lub"),t.content.pageData&&t.content.pageData.deviation_has_print==1?PubSub.publish("DaGa.track_event",{category:"Deviation",action:t.content.pageData.deviation_has_printtabs==1?"printtabs_pageview":"printbutton_pageview"}):(((window.deviantART||{}).pageData||{}).deviation_has_print=0,((window.deviantART||{}).pageData||{}).deviation_has_printbutton=0,((window.deviantART||{}).pageData||{}).deviation_has_printtabs=0),e(":gmi(ResourceViewFaveButton)",r).gmi(),e(":gmi(ResourceViewVoteButton)",r).gmi(),e(":gmi(ResourceViewPrintButton)",r).gmi(),e(":gmi(ResourceViewWatchButton)",r).gmi(),e(":gmi(ResourcePageBtfDockAd)",r).gmi(),e(":gmi(ResourceViewShare)",r).gmi(),e(":gmi(ResourceStream)",r).gmi(),e(":gmi(CCommentThread)",this._get_container()).gmi();if(this._reload_anchor){var o=e("a[id="+this._reload_anchor+"]").first().offset().top,u=e(window).scrollTop();o>u&&o<u+e(window).height()||e(window).scrollTop(o),this._reload_anchor=null}PubSub.publish("DeviationExtras.loaded")},_comments_pager_click:function(t){var n=0,r=!1,i=e(t.currentTarget),s={};i.attr("gmi-offset")&&(n=i.attr("gmi-offset"),r=!0,s.offset=n);if(i.data("gmiclass")=="GMoodButton"){s.offset=n;var o=i.attr("href").match(/moodonly=(\d+)/);o?(s.moodonly=o[1],r=!0):i.hasClass("moodx")&&(r=!0)}if(window.PaginationGoto){window.PaginationGoto.clearSuperbrowsableData();var u=GMI.query(t.target,"GPageButton");if(u&&u[0].gmi_args.gotoboxinputid){var a=e("#"+u[0].gmi_args.gotoboxinputid),f=window.PaginationGoto.calculateOffsetFromPageNumber(a.val(),u[0].gmi_args.currentpage,u[0].gmi_args.lastpage,u[0].gmi_args.interval);f===!1?window.PaginationGoto.errorAlert():(n=f,s.offset=n,r=!0)}}return r&&(this._reload_anchor="comments",PubSub.publish("Minibrowse.reload_extras",{itemid:this._current_item_id,extras_parameters:s})),!1},_get_about:function(){var t=this._get_container(),n=e(".resview7-about .sban-dyn",t);return n.length||(n=e(".resview7-about",t)),vms_feature("new_devpage")&&(n=e(".dev-view-about .dev-view-about-content",t)),n},_get_meta:function(){var t=this._get_container(),n=e(".resview7-meta .sbmn-dyn",t);return n.length||(n=e(".resview7-meta",t)),vms_feature("new_devpage")&&(n=e(".dev-view-meta .dev-view-meta-content",t)),n},_fill_textbanner_ad:function(t){var n=t.content.banner_ad,r=e(".textbanner-ad")
.addClass("is-visible").removeClass("loading"),i=r.find(".tbacontent"),s=i.find("iframe").length;if(t.content.bannerhide)i.closest(".textbanner-ad").removeClass("is-visible"),PubSub.publish("DaGa.track_event",{category:"Deviation",action:"ad_impressions_suppressed"});else if(!n){var o=r.find(".tbahouse");o.length||(o=e('<div class="tbahouse">').appendTo(r),deviantART.deviant.loggedIn?o.html(['<div style="text-align:center">','<h2 style="margin:4px 0 0 0;">','<a href="https://www.deviantart.com/checkout/?mx=premium&subpref=22870_0&utm_source=deviantart&utm_medium=header&utm_campaign=030713_MKT_PremiumHeader">',"Receive advanced feedback on your art with Critiques &#187;","</a>","</h2>",'<a style="text-decoration:none;" href="https://www.deviantart.com/checkout/?mx=premium&subpref=22870_0&utm_source=deviantart&utm_medium=header&utm_campaign=030713_MKT_PremiumHeader">',"Upgrade to a deviantART Premium Membership today!","</a>","</div>"].join("")):o.html(['<div style="text-align:center">','<h2 style="margin:4px 0 0 0;">','<a href="http://www.deviantart.com/join/?joinpoint=Ads&utm_source=DA&utm_medium=banner-textad">',"Join deviantART for FREE &raquo;","</a>","</h2>",'<a style="text-decoration:none;" href="http://www.deviantart.com/join/?joinpoint=Ads&utm_source=DA&utm_medium=banner-textad">',"Collect, Watch, Comment, Contribute. Join the world's largest art community today!","</a>","</div>"].join(""))),i.is(o)||(i.removeClass("tbacontent").addClass("tbahidden"),o.addClass("tbacontent"))}else if(!s){var u=!0;i.hasClass("tbahouse")&&(i.removeClass("tbacontent"),i=i.siblings(".tbahidden").removeClass("tbahidden").addClass("tbacontent"),u=!i.find("iframe").length);if(u){if(vms_feature("new_devpage"))var a=e(".dev-view-about",this._get_container()).width()-64;else var a=e(":gmi(ResourcePageAboutPane)","body > div#dv7").width()-64;n=n.replace('style="','style="max-width:'+a+"px;"),e(n).appendTo(i.empty())}}}};Glbl("Site.is_deviantart")&&PubSub.publish("MinibrowseView.js_factory",t)})(jQuery),window.DWait&&DWait.run("jms/lib/minibrowse.view.da.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/location.js","jms/lib/minibrowse.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/pages/duperbrowse/duperbrowse.helpers.js"],function(){(function(){var e="prev",t="next",n=/^\/?art\/.+-([0-9]+)(?!.*[?&]hf=1)/,r=/^\/?art\/.+-([0-9]+)(.*[?&]hf=1)/,i=!1,s;if(window.location.hash&&!n.test(window.location.pathname)&&n.test(Glbl("Location.path"))&&!document.referrer.match("deviantart")){console.log("[Duperbrowse] redirecting to canonical URL from hash"),PubSub.publish("Location.redirect_to_canonical_url");return}n.test(Glbl("Location.path"))&&!Glbl("Location.pushstate_enabled")?(i=!0,s=n):r.test(Glbl("Location.path"))&&(i=!0,s=r);if(Glbl("Duperbrowse.disabled")){console.log("[Duperbrowse] disabled");return}var o=Base.extend({debugging:!1,is_open:!1,opened_from:null,streams:[],stream_stack:[],current_stream:null,deviation_urls:{},last_scroll_position:0,active_promise:null,last_url_was_faked:!1,last_open_was_faked:!1,waiting_for_next_item:!1,waiting_for_prev_item:!1,subscribed:!1,constructor:function(){this.debugging&&console.log("[Duperbrowse] instance created from:",window.location.href),PubSub.subscribe([{eventname:"Duperbrowse.map_url",subscriber:this,callback:this.handlers.map_url},{eventname:"Location.changed",subscriber:this,callback:this.handlers.location_changed},{eventname:"Location.anchor_changed",subscriber:this,callback:this.handlers.location_changed},{eventname:"Location.changed_without_push",subscriber:this,callback:this.handlers.bad_location_state}]),!Browser.isChrome&&!Browser.isSafari&&!Browser.isIE10&&Glbl("Location.pushstate_enabled")&&$(window).on("unload.duperbrowse",this.handlers.fix_redirect_history.bindTo(this)),$(window).on("popstate.duperbrowse",this.handlers.popstate.bindTo(this))},subscribe:function(){if(this.subscribed)return;this.subscribed=!0,PubSub.subscribe([{eventname:"Minibrowse.next_click",subscriber:this,callback:this.handlers.next_click},{eventname:"Minibrowse.close_click",subscriber:this,callback:this.handlers.close_click},{eventname:"Minibrowse.prev_click",subscriber:this,callback:this.handlers.prev_click},{eventname:"DeviationExtras.loaded",subscriber:this,callback:this.handlers.extras_loaded}])},handlers:{popstate:function(e){this.debugging&&console.log("[Duperbrowse] Raw popstate",e,Glbl("Location.path"));if(!Glbl("Location.path"))return;if(this.is_open&&!e.originalEvent.state&&!n.test(Glbl("Location.path")))this.close_silently(),window.location.search!==""&&window.location.reload();else if(!this.is_open&&!e.originalEvent.state&&n.test(Glbl("Location.path"))&&!n.test(window.location.pathname))window.location.reload();else if(this.streams.length===0&&e.originalEvent.state&&e.originalEvent.state.duper_state){this.debugging&&console.log("[Duperbrowse] Got bad raw popstate reloading page");var t=Glbl("Location.path").match(n);t&&t[1]!=e.originalEvent.state.item.itemid&&window.location.reload()}},next_click:function(e){this.next()},prev_click:function(e){this.prev()},close_click:function(e){this.close()},extras_loaded:function(e){if(!this._ready_to_preload())return;var n;this.current_stream.direction===t?this.current_stream.has_next_callback()&&(n=this.current_stream.next_item_callback()):this.current_stream.has_prev_callback()&&(n=this.current_stream.prev_item_callback());if(!n){this.debugging&&console.log("[Duperbrowse] ready to preload, but could not get item");return}var r=this;n.done(function(e){r.debugging&&console.log("[Duperbrowse] preloading",r.current_stream.direction,e),PubSub.publish("Minibrowse.preload",e.itemid)})},location_changed:function(e,t){this.debugging&&console.log("[Duperbrowse] location changed",JSON.stringify(t));var o;i&&(i=!1,o=Glbl("Location.path").match(s),o&&o[1]&&(this.last_open_was_faked=!0,DWait.ready(".domready",function(){this._open_fake(o[1])}.bindTo(this))),this.debugging&&console.log("[Duperbrowse] Opened duper instead of redirect",History.state)),this.is_open&&this.last_open_was_faked&&t.origin==="hashchange"&&Glbl("Location.pushstate_enabled")&&(this.debugging&&console.log("[Duperbrowse] silently closed, blocking redirect loop"),this.close_silently(),this.last_open_was_faked=!1),t.origin==="hashchange"&&Glbl("Location.pushstate_enabled")&&r.test(Glbl("Location.path"))&&(o=Glbl("Location.path").match(r),o&&o[1]&&this._open_fake(o[1]));if(t.origin!=="popstate"&&t.origin!=="hashchange"&&t.origin!=="anchorchange")return;var u=window.location.pathname+window.location.search,a=t.origin!=="hashchange"&&Glbl("Location.pushstate_enabled");if(t.state&&t.state.duper_state){if(this.is_open&&!Glbl("Location.pushstate_enabled")&&!n.test(Glbl("Location.path"))){this.debugging&&console.log("[Duperbrowse] silently closed, this is not an art url",Glbl("Location.path")),this.close_silently();return}this.unfreeze_state(t.state);var f=this._get_browse_options(t.state.item);if(!f){this.debugging&&console.log("[Duperbrowse] open failed");return}PubSub.publish("Minibrowse.open",f)}else if(this.is_open&&u!==t.path&&a)this.debugging&&console.log("[Duperbrowse] silently closed, state is not from duper",Glbl("Location.path")),this.close_silently();else if(this.is_open&&u===t.path&&this.current_stream)PubSub.publish("Location.push",{url:window.location.pathname+window.location.search+window.location.hash,state:this.freeze_state({itemid:this.current_stream.current_id,stream_offset:this.current_stream.current_offset}),replace:!0});else if(a)this.clear_state();else if(!Glbl("Location.pushstate_enabled")&&t.origin==="hashchange"){if(this.streams.length===0&&t.origin==="hashchange"){o=Glbl("Location.path").match(n);if(o){this.debugging&&console.log("[Duperbrowse] Got bad hashstate",t,this.streams,o[1]);if(o[1]){var l=null;this.opened_from||(l={url:t.path,title:window.document.title}),this._open_fake(o[1],l);return}}}this.debugging&&console.log("[Duperbrowse] silently closed, last resort failed",Glbl("Location.path")),this.close_silently()}},bad_location_state:function(e,t){if(this.streams.length===0&&
t.origin==="popstate"&&t.state&&t.state.duper_state&&!n.test(Glbl("Location.path"))){this.debugging&&console.log("[Duperbrowse] Got bad popstate",t,this.streams);var r=null;this.opened_from||(r=t.state.opened_from),this._open_fake(t.state.item.itemid,r)}},map_url:function(e,t){$.isPlainObject(t)&&t.itemid&&t.url&&(this.deviation_urls[t.itemid]||(this.deviation_urls[t.itemid]={}),this.deviation_urls[t.itemid][this._get_context(t.context)]=t.url,this.current_stream&&this.current_stream.current_id==t.itemid&&this.last_url_was_faked&&(this.debugging&&console.log("[Duperbrowse] resetting location from map_url"),this.last_url_was_faked=!1,PubSub.publish("Location.push",{url:this._get_url(t.itemid,this._get_context(t.context)),state:this.freeze_state({itemid:this.current_stream.current_id,stream_offset:this.current_stream.current_offset}),replace:!0})))},fix_redirect_history:function(){if(this.is_open&&Glbl("Location.pushstate_enabled")&&n.test(window.location.pathname)){var e="/#"+window.location.pathname+"?hf=1";this.opened_from&&this.opened_from.url&&(e=this.opened_from.url.substr(0,this.opened_from.url.indexOf("#")),e=e.replace(/\/$/,"")+"/#"+window.location.pathname+"?hf=1"),PubSub.publish("Location.push",{url:e,state:{},replace:!0})}}},push_stream:function(e){Glbl("Duperbrowse.preload_active",0),this.streams.push(e),this.stream_stack.push(this.streams.length-1)},get_stream:function(e){return this.streams[e]},get_current_stream:function(){return this.streams[this.streams.length-1]},freeze_state:function(e){return{duper_state:!0,debugging:this.debugging,is_open:this.is_open,opened_from:this.opened_from,stream_stack:this.stream_stack,last_scroll_position:this.last_scroll_position,last_url_was_faked:this.last_url_was_faked,item:e}},unfreeze_state:function(e){this.debugging=e.debugging,this.is_open=e.is_open,this.opened_from=e.opened_from,this.stream_stack=e.stream_stack,this.last_scroll_position=e.last_scroll_position,this.current_stream=this.get_stream(e.stream_stack[e.stream_stack.length-1]),this.last_url_was_faked=e.last_url_was_faked},clear_state:function(){this.opened_from=null,this.stream_stack=[],this.last_scroll_position=null,this.current_stream=null,this.last_url_was_faked=!1},close_silently:function(){this.is_open=!1;if(this.current_stream){var e=this.current_stream.scroll_position;setTimeout(function(){$(window).scrollTop(e)},1)}this.clear_state(),PubSub.publish("Minibrowse.close"),PubSub.publish("Duperbrowse.closed")},open:function(e,n){this.debugging&&console.log("[Duperbrowse] open",e,n);var r=this.get_stream(this.stream_stack[this.stream_stack.length-1]);if(!r)return this.close(!0);this.is_open||(this.is_open=!0,this.opened_from={url:window.location.pathname+window.location.search+window.location.hash,title:window.document.title},this.subscribe());var i=!1;r!==this.current_stream&&(this.debugging&&console.log("[Duperbrowse] moving into a new stream",r,this.current_stream,this),this.current_stream=r,r.direction=t,r.direction_confirmed=!1),e?(r.current_id=e.itemid,r.current_offset=e.stream_offset):r.current_id&&(e={itemid:r.current_id,stream_offset:r.current_offset});var s=this._get_browse_options(e);if(!s){this.debugging&&console.log("[Duperbrowse] open failed");return}r.on_stream_item_opened&&r.on_stream_item_opened(e),r.has_next_callback&&(s.show_next=Boolean(r.has_next_callback()),PubSub.publish("Duperbrowse.has_next",s.show_next)),r.has_prev_callback&&(s.show_prev=Boolean(r.has_prev_callback()),PubSub.publish("Duperbrowse.has_prev",s.show_prev));var o=this._get_url(s.id,s.context);PubSub.publish("Location.push",{url:o,state:this.freeze_state(e)}),PubSub.publish("Minibrowse.open",s);if(i){var u=this;this.current_stream.next_item_callback().done(function(e){u.debugging&&console.log("[Duperbrowse] eager preloading",e),PubSub.publish("Minibrowse.preload",e.itemid)})}PubSub.publish("Duperbrowse.opened",{id:s.id,url:o,fresh:Boolean(n)})},close:function(e){if(!this.is_open)return!1;this.current_stream&&(this.last_scroll_position=this.current_stream.scroll_position),this.debugging&&console.log("[Duperbrowse] close",e),e?(this.is_open=!1,$(document).off(".duperbrowse"),PubSub.publish("Minibrowse.close"),this.opened_from&&this.opened_from.url?(Glbl("Location.pushstate_enabled")||(this.opened_from.url=this.opened_from.url.replace(/^.*#/,"")),PubSub.publish("Location.set",this.opened_from.url),PubSub.publish("DuperBrowse.set_closing_location",this.opened_from.url)):r.test(Glbl("Location.path"))&&PubSub.publish("Location.push",{url:window.location.pathname,state:{}}),this.opened_from&&this.opened_from.title&&(window.document.title=this.opened_from.title),this.opened_from=null,this.current_stream&&$(window).scrollTop(this.last_scroll_position),this.current_stream.on_stream_item_closed&&this.current_stream.on_stream_item_closed(this.current_stream),this.current_stream=null,this.stream_stack=[],PubSub.publish("Duperbrowse.closed",e)):(this.stream_stack.pop(),this.open())},next:function(){if(!this.current_stream)return;if(this.waiting_for_next_item)return;if(!this.current_stream.has_next_callback())return;PubSub.publish("Duperbrowse.next"),PubSub.publish("DaGa.track_event",{category:"Duperbrowse",action:"navigate_next"}),this._cancel_promise();var e=this;this.active_promise=this.current_stream.next_item_callback().done(function(n){e._ready_to_preload(t),e.open(n)}).fail(function(e){if(e===DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM||e===DuperbrowseHelpers.PROMISE_STATE_CANCELLED||e===DuperbrowseHelpers.PROMISE_STATE_OVERPAGED)return;PubSub.publish("Duperbrowse.pageload_failed",e)}).always(function(){e.waiting_for_next_item=!1}),this.active_promise.state()==="pending"?this.waiting_for_next_item=!0:this.waiting_for_next_item=!1},prev:function(){if(!this.current_stream)return;if(this.waiting_for_prev_item)return;if(!this.current_stream.has_prev_callback())return;PubSub.publish("Duperbrowse.prev");var t=((window.deviantART||{}).deviant||{}).loggedIn?"loggedin":"loggedout",n=((window.deviantART||
{}).pageData||{}).tao_footer_test_group;!deviantART.deviant.loggedIn&&n&&(t+="_dt28:"+n),PubSub.publish("DaGa.track_event",{category:"Duperbrowse",action:"navigate_prev"}),this._cancel_promise();var r=this;this.active_promise=this.current_stream.prev_item_callback().done(function(t){r._ready_to_preload(e),r.open(t)}).fail(function(e){if(e===DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM||e===DuperbrowseHelpers.PROMISE_STATE_CANCELLED||e===DuperbrowseHelpers.PROMISE_STATE_OVERPAGED)return;PubSub.publish("Duperbrowse.pageload_failed",e)}).always(function(){r.waiting_for_prev_item=!1}),this.active_promise.state()==="pending"?this.waiting_for_prev_item=!0:this.waiting_for_prev_item=!1},_ready_to_preload:function(n){if(!this.current_stream)return;if(n===e||n===t)this.current_stream.direction!==n?(Glbl("Duperbrowse.preload_active",0),this.current_stream.direction=n,this.current_stream.direction_confirmed=!1,this.debugging&&console.log("[Duperbrowse] user started moving",n)):this.current_stream.direction_confirmed||(this.current_stream.direction_confirmed=!0,this.debugging&&console.log("[Duperbrowse] user confirmed moving",n)),this.current_stream.direction_confirmed&&Glbl.plus("Duperbrowse.preload_active");return this.current_stream.direction_confirmed},_get_url:function(e,t){var n=(this.deviation_urls[e]||{})[this._get_context(t)];if(n)n=n.replace(/^.*[\/]/g,""),t||(n=n.replace(/\?.*$/,""));else{if(!e)return!1;n="d"+parseInt(e,10).toString(36),this.last_url_was_faked=!0}return this.debugging&&console.log("[Duperbrowse] got url for item",e,t,n),"/art/"+n},_get_context:function(e){return e||"default"},_get_browse_options:function(e){return!e||!e.itemid?!1:{id:e.itemid,type:e.type,context:e.context,show_next:!1,show_prev:!1}},_cancel_promise:function(){this.active_promise&&this.active_promise.state()==="pending"&&this.active_promise.cancel&&(this.active_promise.cancel(),this.debugging&&console.log("[Duperbrowse] Cancelled pending promise",this.active_promise))},_open_fake:function(e,t){this.current_stream={scroll_position:0},this.subscribe(),this.is_open=!0,this.opened_from=t||null,this.stream_was_faked=!0,this.deviation_urls[e]&&Glbl("Location.path",this._get_url(e,null)),PubSub.publish("Minibrowse.open",{id:e,type:1,show_next:!1,show_prev:!1})}}),u=new o;window.Duperbrowse={open:function(e,t){u.waiting_for_item&&(t=u.get_current_stream()),t=$.extend({current_id:e.itemid,current_offset:e.stream_offset,scroll_position:$(window).scrollTop()},t),u.waiting_for_stream||u.push_stream(t),u.open(e,!0)},close:function(e){u.close(e)},debug:function(e){u.debugging=Boolean(e),u.debugging&&console.log("[Duperbrowse] master debugging enabled")}}})(),window.DWait&&DWait.run("jms/pages/duperbrowse/duperbrowse.master.js")});

DWait.ready(["jms/thirdparty/lib/spin.js","jms/lib/spinpreset.js"],function(){(function(){var e={PROMISE_STATE_END_OF_STREAM:1,PROMISE_STATE_CANCELLED:2,PROMISE_STATE_OVERPAGED:3,click_handler:function(e){var t={open_duperbrowse:!0,click_return:!1,wait_for_load:!1};if(e.metaKey||e.altKey||e.shiftKey||e.ctrlKey)t.open_duperbrowse=!1,t.click_return=!0;return e.which>1&&(t.open_duperbrowse=!1,t.click_return=!0),Glbl("Duperbrowse.pause")===!0&&(t.open_duperbrowse=!1,t.click_return=!0),t},map_url:function(e,t,n){t&&PubSub.publish("Duperbrowse.map_url",{itemid:e,url:t,context:n})},get_element_super_dimensions:function(e){var t={};if(e.data("super-img")){var n={"super-img":"src","super-width":"width","super-height":"height","super-full-img":"full_src","super-full-width":"full_width","super-full-height":"full_height","super-transparent":"transparent"};$.each(n,function(n,r){var i=e.data(n);i&&(t[r]=i)})}return t},cache_dimensions_for_item:function(e,t){var n=this.get_element_super_dimensions(e);$.isEmptyObject(n)||(n.id=t,PubSub.publish("Minibrowse.cache_main_html_dimensions",n))},cache_dimensions_for_legacy_item:function(e,t){var n={},r={super_img:"src",super_w:"width",super_h:"height",super_fullimg:"full_src",super_fullw:"full_width",super_fullh:"full_height",super_transparent:"transparent"};$.each(r,function(t,r){var i=e.attr(t);i&&(n[r]=i)}),$.isEmptyObject(n)||(n.id=t,PubSub.publish("Minibrowse.cache_main_html_dimensions",n))},init_thumb_data:function(e,t,n){t.find(n).each(function(n,r){$anchor=$(this);if($anchor.length===0||t.length===0)return;DuperbrowseHelpers.cache_dimensions_for_item($anchor,e.itemid),DuperbrowseHelpers.map_url(e.itemid,$anchor.attr("href"),$anchor.data("duper-context"))}),t.data(e)},scroll_to_thumb:function(e){var t=$(window),n=e.offset().top,r=t.scrollTop();n>r&&n<r+t.height()||t.scrollTop(n)}};window.DuperbrowseHelpers=e})(),window.DWait&&DWait.run("jms/pages/duperbrowse/duperbrowse.helpers.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/plugins/jquery.gmi.js"],function(){(function(e){var t=vms_feature("dre"),n=Base.extend({constructor:function(){PubSub.subscribe([{eventname:"DuperbrowseStreamLoader.load",subscriber:this,callback:this.handlers.load}])},dot_to_camel:function(e){return(e+"").replace(/\b[a-z]/g,this.make_uppercase).replace(".","")},make_uppercase:function(e){return e.toUpperCase()},handlers:{load:function(n,r){if(!r||!r.stream||!/^[a-z]+\.[a-z]+$/.test(r.stream))return;var i;r.gmi&&/^[a-zA-Z]+$/.test(r.gmi)?i=r.gmi:i="Duperbrowse"+this.dot_to_camel(r.stream)+"Stream";var s;if(r.node)s=e(r.node);else var s=e(":gmi("+i+")");if(!s.length){t&&console.log("[DuperbrowseStream] loader aborted, GMI node not found",i);return}if(window[i]&&!r.delay_gmi)s.gmi();else if(!s.hasClass("dwait_stream")){var o=r.selector||"a.thumb, a.embedded-deviation",u={stream_file:"jms/pages/duperbrowse/stream/"+r.stream+".stream.js",stream_gmi:i};t&&console.log("[DuperbrowseStream] loader requested",u),s.addClass("dwait_stream").on("click.dwait_stream",o,u,this.events.click)}}},events:{click:function(n){if(n.metaKey||n.altKey||n.shiftKey||n.ctrlKey||n.which>1)return;if(!n.data||!n.data.stream_file||!n.data.stream_gmi)return;var r=e(n.target).addClass("dwaiting");return DWait.ready(n.data.stream_file,function(){t&&console.log("[DuperbrowseStream] loader finished",n.data.stream_file,n.data.stream_gmi),r.closest(":gmi("+n.data.stream_gmi+")").off(".dwait_stream").gmi(),r.removeClass("dwaiting").trigger("click")}),!1}}});new n})(jQuery),window.DWait&&DWait.run("jms/pages/duperbrowse/loader/stream.loader.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/gmi.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.somedata.js","jms/pages/duperbrowse/duperbrowse.helpers.js"],function(){(function(e,t){var n={dataFetchComplete:function(t,n,r,i,s,o){ResourceStream.prototype.dataFetchComplete.call(this,t,n,r,i,s,o);var u=n,a={status:s,rids:[],total:o.response.content.total,offset:n,count:r,more:o.response.content.more};s&&e.each(o.response.content.resources,function(t,n){if(e(n[2]).data("deviation-inactive")){u++;return}a.rids.push({itemid:n[1],stream_offset:u}),u++}),this.$.trigger("dataFetchComplete",a)}},r=0,i=Base.extend({id:0,range_start:0,range_end:0,has_more:!1,has_less:!1,constructor:function(e,t,n,i){this.id=r,r++,this.range_start=e,this.range_end=t-1,this.has_more=n,this.has_less=i},offset_in_range:function(e){return e>=this.range_start&&e<=this.range_end}}),s=vms_feature("dre");t.DuperbrowseStandardResourceStream=Base.extend({_resource_stream:null,_current_page:null,_current_item:null,_current_offset:null,_pages:{},_missing_offsets:{},_previous_offset:0,paging_disabled:!1,fake_paging:!1,factory:function(n,r){var i="Duperbrowse"+(n.duperbrowse_class||"Standard")+"ResourceStream";if(!t[i]){s&&console.log("[DuperbrowseStream] could not locate class for stream",n);return}return s&&console.log("[DuperbrowseStream] creating resource stream",i),e(":gmi(GPager2)").gmi(),new t[i](r)},constructor:function(e){this._pages={},this._missing_offsets={},this._resource_stream=e,this._init_stream()},_init_stream:function(){this._bind_clicks(),this._patch_resource_stream();if(this.fake_paging===!0&&this._resource_stream.contents.length>this._resource_stream.gs_count_per_page)this._create_pages_from_overflow();else{var e=new i(this._resource_stream.gs_offset,this._resource_stream.gs_offset+this._resource_stream.gs_count_per_page,parseInt(this._resource_stream.gs_more_to_load,10)===1,this._resource_stream.gs_offset>0);this._current_page=e,this._pages[e.id]=e,this._find_missing_offsets(e)}},_patch_resource_stream:function(){this._resource_stream.extend(n),this._resource_stream.$.on("dataFetchComplete",this._handle_contents_change.bindTo(this))},_handle_contents_change:function(){this._bind_clicks()},_bind_clicks:function(){var t=this;e.each(this._resource_stream.contents,function(n,r){if(!r)return;var i=e(r[2]);i.length&&(t._init_thumb_data(n,r,i,"a.thumb, a.tt-fh-purchasable"),e("a.thumb, span a.t",i).off("click.duperbrowse").on("click.duperbrowse",t._open_duperbrowse.bindTo(t)))})},_init_thumb_data:function(e,t,n,r){var i={type:t[0],itemid:t[1],stream_offset:e};DuperbrowseHelpers.init_thumb_data(i,n,r)},_open_duperbrowse:function(t){if((t.metaKey||t.altKey||t.shiftKey||t.ctrlKey)&&this._resource_stream.edit_mode===!0)return t.preventDefault(),!0;var n=DuperbrowseHelpers.click_handler(t),r=["itemid","stream_offset","type"];if(n.open_duperbrowse){var i=e(t.currentTarget),s=i.closest(".tt-a, .tt-aa").someData(r);if(!e.isEmptyObject(s)){var o={next_item_callback:this._next_item_callback.bindTo(this),prev_item_callback:this._prev_item_callback.bindTo(this),has_next_callback:this._has_next_callback.bindTo(this),has_prev_callback:this._has_prev_callback.bindTo(this),on_stream_item_opened:this._on_stream_item_opened.bindTo(this),on_stream_item_closed:this._on_stream_item_closed.bindTo(this)};return s.wait_for_load=n.wait_for_load,s.context=i.data("duper-context"),Duperbrowse.open(s,o),!1}return!0}return n.click_return},_get_item:function(t){var n=this._resource_stream.contents[t];return this._missing_offsets[t]===!0?!1:n===undefined?n:!n[2]||e(n[2]).data("deviation-inactive")?!1:{itemid:n[1],stream_offset:t}},_move_stream:function(t,n){this._resource_stream.gs_offset=t,this._resource_stream.domClearAll();var r=this._resource_stream.gs_count_per_page;e.each(this._missing_offsets,function(e,t){n&&n.offset_in_range(e)&&r--}),this._resource_stream.domDrawRange(t,r),this._update_pager(t)},_update_pager:function(t){if(!this._resource_stream.gmi_args.pager_id)return;var n=e("#"+this._resource_stream.gmi_args.pager_id).gmi1();if(!n)return;n.update_to_offset(t)},_find_next:function(t){var n=t==1?this._current_offset+1:this._current_offset-1,r=null,i=0;while(r===null){var s=this._get_item(n);s===undefined||!e.isEmptyObject(s)?r=s:n=t==1?n+1:n-1,i++,i>this._resource_stream.gs_count_per_page&&(r=undefined)}return r},_find_missing_offsets:function(e){for(var t=e.range_start,n=e.range_end+1;t<n;t++)this._resource_stream.contents[t]===undefined&&(this._missing_offsets[t]=!0)},_create_pages_from_overflow:function(){var e=Math.ceil(this._resource_stream.contents.length/this._resource_stream.gs_count_per_page),t=0,n,r;for(n=0;n<e;n++)r=new i(t,t+this._resource_stream.gs_count_per_page,n<e-1,n>0),this._pages[r.id]=r,t===0&&(this._current_page=r),this._find_missing_offsets(r),t+=this._resource_stream.gs_count_per_page},_next_item_callback:function(){var t=this._find_next(!0);return t!==undefined?e.Deferred().resolve(t).promise():t===undefined&&this._current_page.has_more&&!this.paging_disabled?this._create_next_item_promise(!1):e.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_prev_item_callback:function(){var t=this._find_next(!1);return t!==undefined?e.Deferred().resolve(t).promise():t===undefined&&this._current_page.has_less&&!this.paging_disabled?this._create_next_item_promise(!0):e.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_has_next_callback:function(){var e=this._find_next(!0);return e!==undefined?!0:this._current_page.has_more===!0?!0:!1},_has_prev_callback:function(){var e=this._current_offset-1;if(e<0)return!1;var t=this._find_next(!1);return t!==undefined?!0:t===undefined&&this._current_page.has_less?!0:!1},_on_stream_item_opened:function(t){var n,r=!1,i=this;this._get_item(t.stream_offset)!==undefined?(n=this._get_item(t.stream_offset),this._current_item=n,this._current_offset=n.stream_offset,e.each(this._pages,function(e,n){i._current_page&&
n.id!=i._current_page.id&&n.offset_in_range(t.stream_offset)&&(r=n)}),r&&(this._move_stream(r.range_start,r),this._current_page=r)):(this._current_item=null,this._current_offset=null)},_on_stream_item_closed:function(t){var n=this._resource_stream.contents[t.current_offset];if(n===undefined)return;var r=e(n[2]);if(r.length===0)return;DuperbrowseHelpers.scroll_to_thumb(r)},_handle_page_promise:function(e){var t=!1;e.total&&this._resource_stream.contents.length<e.total&&(t=!0),e.total===0&&e.more===!0&&e.rids.length>0&&(t=!0);var n=new i(e.offset,e.offset+e.count,t,e.offset>0);this._current_page=n,this._pages[n.id]=n,this._find_missing_offsets(n),this._bind_clicks()},_handle_page_promise_failure:function(e,t){this._move_stream(this._previous_offset,this._current_page),e===DuperbrowseHelpers.PROMISE_STATE_OVERPAGED&&(t?this._current_page.has_less=!1:this._current_page.has_more=!1,PubSub.publish("Duperbrowse.disable_paddle",t))},_create_next_item_promise:function(t){var n=e.Deferred(),r,i,s=!1,o=this,u=this._resource_stream.gs_offset+this._resource_stream.gs_count_per_page;return this._previous_offset=this._resource_stream.gs_offset,t&&(u=this._resource_stream.gs_offset-this._resource_stream.gs_count_per_page,u<0&&(u=0)),this._move_stream(u),this._resource_stream.$.on("dataFetchComplete",function(e,r){r.status?r.rids.length===0?n.reject(DuperbrowseHelpers.PROMISE_STATE_OVERPAGED,t):n.resolve(r):n.reject("failed to load thumbs")}),n.done(o._handle_page_promise.bindTo(o)).fail(o._handle_page_promise_failure.bindTo(o)),i=function(t){return s?e.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise():t.rids[0]},prev_pipe=function(t){return s?e.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise():t.rids[t.rids.length-1]},r=e.when(n.promise()).then(t===!0?prev_pipe:i),r.cancel=function(){s=!0},r}})})(jQuery,window),window.DWait&&DWait.run("jms/pages/duperbrowse/stream/standard.resource.stream.js")});

DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/pages/duperbrowse/stream/standard.resource.stream.js"],function(){(function(e,t){t.DuperbrowseChannelResourceStream=DuperbrowseStandardResourceStream.extend({_init_stream:function(){var e=this._resource_stream.$.find("smoothie").attr("q");e=="special:newest"?this.paging_disabled=!0:e&&e.match(/special:(popular|dd)/)&&(this.fake_paging=!0),this.base()}})})(jQuery,window),window.DWait&&DWait.run("jms/pages/duperbrowse/stream/channel.resource.stream.js")});

DWait.ready(["jms/lib/Base.js","jms/lib/gmi.js","jms/lib/jquery/jquery.current.js","jms/pages/duperbrowse/duperbrowse.helpers.js","jms/pages/duperbrowse/stream/standard.resource.stream.js"],function(){(function(e,t){t.DuperbrowseCropthumbResourceStream=DuperbrowseStandardResourceStream.extend({_items:[],_current_item:null,_current_offset:null,constructor:function(e){this._resource_stream=e,this._items=[],this.init_stream()},init_stream:function(){var t=this;this._resource_stream.$.find(".tt-crop").each(function(n,r){var i=e(this),s=parseInt(i.attr("collect_rid").split(":")[1],10),o={itemid:s,stream_offset:n};t._items.push(o),i.on("click.cropthumb",t._open_duperbrowse.bindTo(t)),i.data(o),DuperbrowseHelpers.cache_dimensions_for_item(i,s),DuperbrowseHelpers.map_url(s,i.find("a").attr("href"))})},_open_duperbrowse:function(n){var r=t.DuperbrowseHelpers.click_handler(n),i=["itemid","stream_offset"],s=e(n.currentTarget),o=s.closest(".stream"),u=o.find(".tt-crop"),a=o.parent().is(".deviation-visit")?"mfa_thumb":"mlt_thumb",f=u.index(s),l="r"+parseInt(f/3+1)+"c"+(f%3+1);PubSub.publish("DaGa.track_event_link",{event:n,element:s[0],category:"Deviation",action:a,label:"thumbpos-"+l});if(r.open_duperbrowse){var c=s.someData(i);if(!e.isEmptyObject(c)){var h={next_item_callback:this._next_item_callback.bindTo(this),prev_item_callback:this._prev_item_callback.bindTo(this),has_next_callback:this._has_next_callback.bindTo(this),has_prev_callback:this._has_prev_callback.bindTo(this),on_stream_item_opened:this._on_stream_item_opened.bindTo(this)};return c.wait_for_load=r.wait_for_load,Duperbrowse.open(c,h),!1}return!0}return r.click_return},_next_item_callback:function(){var t=this._current_offset+1,n=this._items[t];return n!==undefined?e.Deferred().resolve(n).promise():e.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_prev_item_callback:function(){var t=this._current_offset-1,n=this._items[t];return n!==undefined?e.Deferred().resolve(n).promise():e.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_has_next_callback:function(){var e=this._current_offset+1;return this._items[e]!==undefined?!0:!1},_has_prev_callback:function(){var e=this._current_offset-1;return e<0?!1:this._items[e]!==undefined?!0:!1},_on_stream_item_opened:function(e){this._items[e.stream_offset]!==undefined?(this._current_item=e,this._current_offset=e.stream_offset):(this._current_item=null,this._current_offset=null)}})})(jQuery,window),window.DWait&&DWait.run("jms/pages/duperbrowse/stream/cropthumb.resource.stream.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/pubsub.js"],function(){$(window).on("message.AdCatch",function(e){var t=e.originalEvent.data&&e.originalEvent.data.match?e.originalEvent.data.match(/^adcatch::(all|one)::/):!1;if(!t||e.originalEvent.origin!=window.location.origin)return;DWait.ready("jms/modals/adcatch-modal.js",function(){PubSub.publish("AdCatchModal.prime",{is_all:t[1]=="all",content:e.originalEvent.data.substr(t[0].length)})})}),window.DWait&&DWait.run("jms/lib/adcatch_listener.js")});

window.popupSitback=function(e,t,n,r){var i="http://justsitback.deviantart.com",s="menubar=no,width=640,height=480,toolbar=no,status=no,location=no,directories=no,resizable=yes";Browser.isIE&&(e="Slideshow");var o=i+"?title="+encodeURIComponent(e)+"&rssQuery="+encodeURIComponent(t);return window.open(o,"SitBack",s),window.event&&(event.cancelBubble=!0),!1},window.DWait&&DWait.run("jms/pages/sitback.js");

DWait.ready(["jms/lib/jquery/jquery.current.js"],function(){(function(e){e(function(){var t;e("body").hasClass("maturehide")&&(t=e("#browse2 .tt-ismature, #browse-results .tt-ismature").length)&&e("#browse2 .tt-a, #browse-results .tt-a").length==t&&e("#maturehider_explanation").show()})})(jQuery),window.DWait&&DWait.run("jms/pages/browsesearch.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/quantcast.js","jms/lib/dtlocal.js","jms/lib/bind.js","jms/pages/ccommentthread.js","jms/lib/glbl.js","jms/lib/analytics.js"],function(){DWait.ready("jms/lib/gmi.js",function(){window.TalkPostWrapper=GMIBase.extend({gmiConstructor:function(){vms_feature("dre")&&console.log("TalkPost GMI constructor");var e;this.talkpost=new TalkPost(this),this.talkpost.node=this.gmi_node,this.talkpost.comment=this.gmi_args,this.reset=bind(this.talkpost,this.talkpost.reset),this.talkpost.hookDrawingUI(),$(this.gmi_node).data("TalkPost",this.talkpost),this.textarea=this.gmi_node.getElementsByTagName("textarea")[0],e=this.getCacheName(),TalkPostWrapper.textCache[e]&&(this.textarea.value=TalkPostWrapper.textCache[e].shift()||""),this.stdPostHook(),this.refreshTextareaState(),vms_feature("comment_writer")?($(this.gmi_node).addClass("ccexpanded ccwriter-raisin").children(".inputs").hide(),$(this.gmi_node).find("textarea").addClass("writeranywhere"),this.talkpost.commentwriter=WriterAnywhereFactory.get("comment",$(this.gmi_node).find("textarea"),!1,!0)):(this.textarea.onfocus=bind(this,this.textareaFocus),this.textarea.onblur=bind(this,this.textareaBlur),$(document.documentElement).bind("keydown",this.keypress=bind(this,this.keypress)))},gmiDestructor:function(){var e;$(document.documentElement).unbind("keydown",this.keypress),this.textarea&&(e=this.getCacheName(),TalkPostWrapper.textCache[e]||(TalkPostWrapper.textCache[e]=[]),TalkPostWrapper.textCache[e].push(this.textarea.value||"")),this.talkpost.localDestroy()},previewClick:function(){this.talkpost.confirmPreview()},sendClick:function(){return window.event&&(event.cancelBubble=!0),this.talkpost.confirmPost(),!1},getCacheName:function(){return[this.gmi_args.typeid||"",this.gmi_args.itemid||"",this.gmi_args.parentid||"",this.gmi_args.time_index||""].join(":")},keypress:function(e){this.tab_pressed=e.keyCode==9;if(this.textarea_focused&&(e.keyCode==13||e.keyCode==10)&&(Browser.isMac&&e.metaKey&&!Browser.isOpera||e.ctrlKey))return e.target.blur(),this.sendClick()},setCallback:function(e){this.talkpost.callback=e},hookSend:function(){if(vms_feature("comment_writer"))$("input.post[type=submit]",this.talkpost.node).click(function(){return!1});else{var e,t;e=this.talkpost.node.getElementsByTagName("input"),e[e.length-1].onclick=bind(this,this.sendClick)}},stdPostHook:function(){this.setCallback(bind(this,this.stdPostHookDone)),this.hookSend()},stdPostHookDone:function(e,t){var n,r,i,s;TalkPostWrapper.one_comment_posted=1;if(e!="posted")return;n=(GMI.up(this.gmi_node)||this).gmiQuery("CCommentThread")[0]||GMI.query("CCommentThread")[0],this.reset(!1),vms_feature("comment_writer")&&$(this.gmi_node).find(".inputs").hide(),n.renderNewComment(t,{fast:!0,scroll_to:!0}),PubSub.publish("PageViewTracker.pageview",{page:"/vpv/difi/commentpost",tag:"Dynamic.Comment"}),PubSub.publish("Minibrowse.uncache",t.itemid)},refreshTextareaState:function(){var e,t;this.textarea_focused||this.writer_focused||this.sidebar_hovered||this.textarea.value||this.mood_hovered||this.talkpost.drawplz_hovered||this.talkpost.commentDrawin||this.talkpost.collection_hovered?(this.logged_expand||(this.logged_expand=!0),$(".show_collections").unbind("mouseover").mouseover(bind(this,this.collectionHover)),$(".show_collections").unbind("mouseout").mouseout(bind(this,this.collectionOut)),this.moods||(this.moods=this.talkpost.renderMoodBox(),this.moods&&(this.moods.onmouseover=bind(this,this.moodHover),this.moods.onmouseout=bind(this,this.moodOut)),t=this.gmi_node.getElementsByTagName("a"),t=t[t.length-1],$(t).is(".emoticons")&&(t.onmouseover=bind(this,this.moodHover),t.onmouseout=bind(this,this.moodOut))),(vms_feature("comment_writer")||!this.talkpost.commentDrawing)&&$(this.gmi_node).find(".drawPlz").show(),$(this.gmi_node).addClass("ccexpanded"),vms_feature("comment_writer")&&$(this.gmi_node).addClass("ccwriter-raisin"),!document.body.scrollTop&&!document.documentElement.scrollTop&&(window.scrollTo?window.scrollTo(0,1):document.body.scrollTop=1,e=Ruler.document.node(this.gmi_node).y2+10-Ruler.screen.rect().y2,e>0&&(window.scrollTo?window.scrollTo(0,e):document.body.scrollTop=e))):this.$.removeClass("ccexpanded").find(".drawPlz").hide()},textareaFocus:function(){this.textarea_focused=1,this.refreshTextareaState()},textareaBlur:function(){if(this.writer_focused||this.sidebar_hovered||this.collection_hovered)return;this.textarea_focused=0,this.refreshTextareaState();if(this.tab_pressed&&document.activeElement.className.indexOf("comment-submit")==-1){var e=this.textarea;setTimeout(function(){$(e).closest("form").find(".comment-submit:visible").focus()},100)}},moodHover:function(){this.mood_hovered=1},moodOut:function(){this.mood_hovered=0},collectionHover:function(){this.collection_hovered=1},collectionOut:function(){this.collection_hovered=0}}),TalkPostWrapper.textCache={}}),window.show_emoticons_modal=function(){var e=$("<div style='width:470px;' />");$("<h2>Emoticons</h2>").appendTo(e),$("<iframe style='width:100%; height:450px; border: none; border-bottom: 1px solid #AAB5AB; -webkit-box-shadow: rgba(255,255,255, 0.75) 0px 1px 0px; -moz-box-shadow: rgba(255, 255, 255, 0.75) 0px 1px 0px;' frameBorder='0' src='http://comments.deviantart.com/emoticons' />").appendTo(e);var t=Modals.factory(e,{cssShadows:!0,showCloseButton:!0,showButtonsSeparator:!1,ignoreinvincible:!0});return t.addButton("Close","smbutton-lightgreen",function(){return Modals.pop("closed"),!1}),Modals.push(t),!1},$(document).on("click",".show_emoticons_modal",window.show_emoticons_modal),$(document).on("click",".show_collections",function(){return Lub.go(),da_minish_lub.buttonClicked(),!1}),window.TalkPost=function(e,t,n,r){var i;DTLocal.infect(this);if(typeof e=="function")return;this.owner=e,this.current_mode="normal";if(window.TalkPostWrapper&&e instanceof TalkPostWrapper)return;$("div.mczone").first().parents("div#output").is(":visible")?this.node=$(this.template_message_center)[0]:this
.node=$(this.template)[0],vms_feature("comment_writer")&&$(this.node).find("textarea").addClass("writeranywhere"),this.comment=t,this.callback=n,DRE.assert(!(r instanceof Array));for(i in r||{})this[i]=r[i];this.on()},TalkPost.prototype={debug_label:"TalkPost",on:function(){console.log("Talkpost On"),DRE.assert(this.node),DRE.assert(this.comment),DRE.assert(this.comment.typeid),DRE.assert(this.comment.itemid),$(this.node).data("TalkPost",this),Number(this.comment.parentid)&&($(this.node).addClass("talk-post-reply"),vms_feature("comment_writer")&&$(this.node).addClass("ccwriter-raisin")),this.localEventHook($(".cx",this.node)[0],"click",bind(this,this.confirmExit)),this.localEventHook($(".cancel",this.node)[0],"click",bind(this,this.confirmCancel));var e=$(".post",this.node);this.localEventHook(e[0],"click",bind(this,this.confirmPost)),this.localEventHook($(e).parent()[0],"keypress",bind(this,this.confirmPost)),this.localEventHook($(".preview",this.node)[0],"click",bind(this,this.confirmPreview)),this.textarea=$("textarea",this.node)[0],this.localEventHook(this.textarea,"keydown",bind(this,this.textareaKeydown)),this.localEventHook(this.textarea,"blur",bind(this,this.textareaBlur)),this.hookDrawingUI(),$(".name",this.node)[0].innerHTML=deviantART.deviant&&deviantART.deviant.username?this.PHP_userlink(deviantART.deviant):"Your Comment",this.current_mode="normal",$(".text",this.node)[0].value=this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]||"";if(!deviantART.deviant||!deviantART.deviant.username)this.node.style.display="none";var t=$("div.moodbox",this.node)[0];t&&(this.hide_moods?t.parentNode.style.display="none":this.renderMoodBox()),vms_feature("comment_writer")&&setTimeout(bind(this,function(){$(this.node).find("textarea").addClass("writeranywhere"),this.commentwriter=WriterAnywhereFactory.get("comment",$(this.node).find(".writeranywhere"),!0,!0)}),10)},off:function(){var e=!0;this.drawPlz_hide(e),$(".cancel",this.node).hide(),this.owner.local&&this.owner.localClean(TalkPost)},localRecv:function(e){e=="destroy"&&(this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=$(".text",this.node)[0].value,this.owner.local&&(this.local_tie&&this.owner.localClean(this.local_tie),this.node.parentNode&&this.node.parentNode.removeChild(this.node)))},PHP_userlink:function(e,t){return typeof e=="object"&&(t=e.symbol,e=e.username),t+'<a class="u" href="ht'+"tp://"+e.toLowerCase()+'.deviantart.com/">'+e+"</a>"},template:'<div class="talk-post" keeper="TalkPost"><img class="cx" src="//st.deviantart.com/minish/messages/neutral-x.gif" alt="x"/><div class="name"></div><div class="h"><div class="previewbox" style="display:none"></div><table class="f"><tr><td class="f"><textarea class="text" tabindex="4"></textarea></td><td class="f rr moodbox-zone"><div class="moodbox"></div></td></tr></table></div><div class="inputs" style="position:relative; text-align: right"><div class="scripted"><a class="smbutton smbutton-big preview" tabindex="6" onclick="return false"><span>Preview</span></a><span style="display: inline-block; width: 10px">&nbsp;</span><a class="smbutton smbutton-'+(vms_feature("comment_writer")?"green comment-submit":"blue")+' smbutton-big post" tabindex="5" onclick="return false"><span class="post">'+(vms_feature("comment_writer")?"Submit":"Add")+" Comment</span></a>"+"</div>"+'<div class="unscripted">'+'<input class="post" type="submit" value="Send" tabindex="1">'+"</div>"+'<div style="position:absolute;left:0;top:0;font-size:8.25pt">'+(vms_feature("comment_writer")?"":'<a class="emoticons show_emoticons_modal" href="http://comments.deviantart.com/emoticons" onclick="return false;" >Emoticons</a><input type="checkbox" id="remove_message_after_reply" value="1" checked style="display: none">')+"</div>"+"</div>"+"</div>",template_message_center:'<div class="talk-post" keeper="TalkPost"><img class="cx" src="//st.deviantart.com/minish/messages/neutral-x.gif" alt="x"/><div class="name"></div><div class="h"><div class="previewbox" style="display:none"></div><table class="f"><tr><td class="f"><textarea class="text" tabindex="4"></textarea></td><td class="f rr moodbox-zone"><div class="moodbox"></div></td></tr></table></div><div class="inputs" style="position:relative; text-align: right"><div class="scripted"><a class="smbutton smbutton-big preview" tabindex="6" onclick="return false"><span>Preview</span></a><span style="display: inline-block; width: 10px">&nbsp;</span>'+(vms_feature("comment_writer")?'<a class="smbutton smbutton-green smbutton-big" tabindex="5" onclick="return false"><span class="post">Submit Comment</span></a>':'<a class="smbutton smbutton-blue smbutton-big" tabindex="5" onclick="return false"><span class="post">Add Comment</span></a>')+"</div>"+'<div class="unscripted">'+'<input class="post" type="submit" value="Send" tabindex="1">'+"</div>"+'<div style="position:absolute;left:0;top:0;font-size:8.25pt;text-align:left">'+(vms_feature("comment_writer")?"":'<a class="emoticons show_emoticons_modal" href="http://comments.deviantart.com/emoticons" onclick="return false;" >Emoticons</a>')+'<br><input type="checkbox" id="remove_message_after_reply" value="1" checked><label for="remove_message_after_reply">Remove this message after I reply</label>'+"</div>"+"</div>"+"</div>",nodeMap:{files:{get:function(){return $("div.talk-files",this.node)[0]}}},renderMoodBox:function(){return DWait.ready("jms/lib/pager.js.mood.js",bind(this,this.renderMoodBox2)),$(".moodbox",this.node)[0]},renderMoodBox2:function(){var e,t,n,r;return vms_feature("comment_writer")?(e=null,$(".f.rr",this.node).remove()):e=$(".moodbox",this.node)[0],e?(DRE.assert(e.childNodes.length==0,"First post!"),r=this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))],n=Pager.create({more_links:!0,rootri:"mood",theme:this.pager_theme||($(document.body).hasClass("deviant")?"deviant":"light"),selection
:r,class_name:"pager2 talk-pager",icon_base_url:"http://e.deviantart.com/emoticons/moods/",callback:bind(this,function(e,t){var n;this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=e,this.mood=e.split("/").pop();if(n=$("input.mood")[0])n.value=this.mood;return e&&this.focus(),!1})}),e.appendChild(n.node),Pager.loadPage(n,r?r.split("/").reverse().slice(1).reverse().join("/")||"mood":"mood"),r&&(this.mood=r.split("/").pop()),DiFi.timer(10),this.pager=n,e):!1},getText:function(){return $("textarea.text",this.node).val()},getTextToSave:function(){var e=this.getText();if(!$("textarea.text",this.node).attr("writer"))return e;var t=document.createElement("div");t.innerHTML=e;if(t.innerHTML.length<e.length)return e;var n=[".embedded-deviation",".shadow-holder",".writer-embed","da\\:deviation","da\\:thumb"];return $(t).find($.map(n,function(e){return"span>"+e}).join(",")).not(function(){return $(this).siblings().length}).unwrap(),$(t).find($.map(n,function(e){return"div>"+e}).join(",")).not(function(){return $(this).siblings(":not(br)").length}).unwrap(),t.innerHTML},setPreviewText:function(e){vms_feature("comment_writer")?($(".previewbox",this.node).html(['<i class="l"></i>','<a class="previewclose">Close Preview</a>','<div class="previewbox-content">',e,"</div>"].join("")),$(".previewbox .previewbox-content",this.node).height($(".previewbox",this.node).height()-16),$(".previewbox .previewclose",this.node).on("click",bind(this,function(){this.goMode("normal")}))):($(".previewbox",this.node).html('<strong style="cursor:pointer">Preview <img src="//st.deviantart.com/minish/messages/neutral-x.gif" style="position:relative;top:2px"></strong><br/><br/>'+e+"</div>"),$(".previewbox strong",this.node).on("click",bind(this,function(){this.goMode("normal")})))},focus:function(){this.current_mode=="normal"&&$(".text",this.node)[0].focus()},textareaKeydown:function(e){this.tab_pressed=e.keyCode==9},textareaBlur:function(){if(this.tab_pressed&&document.activeElement.className.indexOf("post")==-1){var e=this.textarea;setTimeout(function(){$(e).closest(".talk-post").find(".post:visible").parent().focus()},100)}},current_mode:null,goMode:function(e,t){if(e==this.current_mode)return;var n=$(this.node),r=this.current_mode;this.current_mode=e;switch(e){case"busy":case"muro_saving":n.find(".text, .preview, .post").attr("disabled","disabled"),n.find(".preview, .post").addClass("disabledbutton");break;case"normal":n.find(".text, .preview, .post").removeAttr("disabled"),n.find(".preview span, span.preview").val("Preview").html("Preview"),n.find(".preview, .post").removeClass("disabledbutton"),n.removeClass("ccwriter-preview").find(".previewbox").hide(),n.find(".text").css("visibility","visible"),t!==!1&&n.find(".text").trigger("focus.talkpost"),vms_feature("comment_writer")&&n.find(".drawPlz").show();break;case"preview":n.find(".preview, .post").removeAttr("disabled").removeClass("disabledbutton"),n.find(".previewbox").css({visibility:"hidden",display:"block"}),vms_feature("comment_writer")?(n.find(".preview span, span.preview").val("Edit").html("Edit").removeAttr("disabled"),n.addClass("ccwriter-preview").find(".previewbox").css({height:n.find(".cctextarea").outerHeight(),width:n.find(".cctextarea").outerWidth()})):(n.find(".preview span, span.preview").val("Preview Off").html("Preview Off").removeAttr("disabled"),n.find(".previewbox").css({height:n.find(".text").outerHeight(),width:n.find(".text").outerWidth()})),n.find(".text").css("visibility","hidden"),n.find(".previewbox").css("visibility","visible");break;case"fail":DiFi.stdErr(null,this.last_fail_reason),this.goMode("normal")}},showCancel:function(){$(".cancel",this.node).show()},confirmCancel:function(e){return $(".cancel",this.node).hide(),vms_feature("comment_writer")&&PubSub.publish("WriterAnywhere.collapse"),!1},confirmExit:function(e){return this.commentDrawing&&!confirm("If you do this, you will lose your current drawing.\nAre you sure?")?!1:(this.callback&&this.callback("closed"),vms_feature("comment_writer")?this.commentwriter.detach().done(bind(this,function(){WriterAnywhereFactory.remove($(this.node).find("textarea")),this.off()})):this.off(),!1)},confirmPost:function(e){try{!this.commentDrawing&&mgr&&mgr.canvasDrawing&&(this.commentDrawing=mgr.canvasDrawing)}catch(e){}window.event&&(event.cancelBubble=!0);if(this.current_mode=="busy")return;if(e!==undefined&&e.type==="keypress"&&e.keyCode!==13)return;var t,n,r,i;if(this.getText().search(/[^\s]/g)==-1&&!this.commentDrawing)return this.focus(),!1;if(this.drawplz_saving>0){if(this.current_mode=="muro_saving")return;this.goMode("muro_saving");var s=setInterval(bind(this,function(){if(this.drawplz_saving>0)return;this.confirmPost(),clearInterval(s)}),100);return}this.goMode("busy"),t=0,n=0,this.exo_files?(this.exo_files[0]&&this.exo_files[0].file&&(t=this.exo_files[0].file.deckId),this.exo_files[1]&&this.exo_files[1].file&&(n=this.exo_files[1].file.deckId)):$(".talk-files",this.node)[0]&&(r=$(".talk-files a",this.node),DRE.assert(r.length==2),t=Number(r[0].getAttribute("attachdeckid")||0),n=Number(r[1].getAttribute("attachdeckid")||0));if(this.comment.time_index||t||n)DiFi.pushPost("Comments","filmPost",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0,this.comment.time_index||0],this.posted,this);else{i=GMI.up(this.node,"CCommentThread"),i&&i.rcpStallQueue&&i.rcpStallQueue(!0);if(this.commentDrawing){var o;if(o=this.getCommentImage()){DiFi.pushPost("DrawPlz","post_comment",[this.getTextToSave(),o,this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0],this.posted,this),DiFi.send();return}}deviantART.pageData.messages?DiFi.pushPost("Comments","post_from_messagecenter",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0,$("#remove_message_after_reply").prop("checked")?1:0],this.posted,this):(this.comment.typeid==61&&Glbl("Site.is_stash"
)&&PubSub.publish("Minibrowse.uncache",deviantART.pageData.privateid),DiFi.pushPost("Comments","post",[this.getTextToSave(),this.comment.itemid,this.comment.parentid||0,this.comment.typeid,this.mood||0],this.posted,this))}DiFi.send()},confirmPreview:function(){window.event&&(event.cancelBubble=!0),vms_feature("comment_writer")&&$(this.node).find(".commentwriter-toolbar .commentwriter-preview").toggleClass("active");if(this.current_mode=="preview"){this.goMode("normal");return}this.setPreviewText("Loading preview"),previewHasThumbs=0;if(vms_feature("comment_writer")||this.comment.typeid==18||this.comment.typeid==39)previewHasThumbs=1;vms_feature("comment_writer")?DiFi.pushPost("Comments","preview_v2",[this.getText(),previewHasThumbs,this.comment.typeid,this.comment.itemid],this.preview,this):DiFi.pushPost("Comments","preview",[this.getText(),previewHasThumbs],this.preview,this),DiFi.send(),this.goMode("preview")},preview:function(e,t){if(!e){this.current_mode=="preview"&&(this.goMode("normal"),this.setPreviewText(""));return}this.setPreviewText(t.response.content)},posted:function(e,t,n){var r,i,s,o,u,a;threadGMI=$(this.node).parents(":gmi(CCommentThread)"),threadGMI.length&&(thread=threadGMI.gmi1(),thread&&thread.rcpStallQueue&&(e&&(thread.recently_rendered[t.response.content.commentid]=1),thread.rcpStallQueue(!1)));if(!e){this.last_fail_reason=typeof (t.response.content||{}).error=="string"?t.response.content.error:"There was an error while posting the comment.\n\nPlease try again soon.",this.goMode(n?"normal":"fail");return}r=t.response.content,i={commentid:r.id,parentid:this.comment.parentid,typeid:this.comment.typeid,itemid:this.comment.itemid,username:deviantART.deviant.username,symbol:deviantART.deviant.symbol,usericon:deviantART.deviant.usericon,ts:Math.floor((new Date).valueOf()/1e3),attributes:t.request.args[5]<<16|t.request.args[4]<<3,depth:undefined,text:r.body,signature:null,files:r.files,html:r.html};try{HALT()}catch(f){}this.constructor.localCache["text"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=null,this.constructor.localCache["mood"+(Number(this.comment.parentid)||"t"+(this.comment.time_index||0))]=null,$(".text",this.node)[0].value="",this.callback&&this.callback("posted",i),vms_feature("comment_writer")?(this.commentwriter.ccwriter.writer.syncer.sync(!0),this.commentwriter.detach().done(bind(this,function(){WriterAnywhereFactory.remove($(this.node).find("textarea")),this.owner?this.off():$(".inputs",this.node).hide()}))):this.owner&&this.off()},reset:function(e){var t,n,r;this.goMode("normal",e),$("textarea",this.node).val(""),this.owner&&(this.owner.textarea_focused=0,this.owner.refreshTextareaState()),this.pager&&(Pager.select(this.pager,""),Pager.loadPage(this.pager,"mood"));if(this.exo_files)for(r=0;r!=this.exo_files.length;r++)this.exo_files[r]&&this.exo_files[r].file&&this.exo_files[r].deckNuke()},browserSupportsCommentDrawings:function(){return!Browser.isIE8},hookDrawingUI:function(){var e=this.comment.allowdrawings&&this.browserSupportsCommentDrawings();if(!e)return;var t='<div class="drawPlz"><div class="topbar hh">'+(e?'<a href="#showDrawPlz" class="showDrawPlz">Add a Drawing</a>':"")+"</div>"+"</div>",n=jQuery("textarea",this.node),r=(" "+this.node.className+" ").indexOf(" talk-post-reply ")!=-1;r?(t='<tr><td colspan="2">'+t+"</td></tr>",n.closest("tr").after(jQuery(t))):jQuery(".cctextarea",this.node).append(jQuery(t)),$(this.node).on("click",".editDrawing",this.drawPlz_edit.bindTo(this)),$(this.node).on("click",".hideDrawPlz, .hideDrawing",this.drawPlz_hide.bindTo(this)),this.drawplz_saving=this.drawplz_saving||0;var i=$(".showDrawPlz",this.node)[0];this.localEventHook(i,"click",this.drawPlz_show.bindTo(this)),this.localEventHook(i,"mouseover",this.drawPlz_mouseover.bindTo(this)),this.localEventHook(i,"mouseout",this.drawPlz_mouseout.bindTo(this))},drawPlz_show:function(e){e.preventDefault();var t=450,n=340,r=$(this.node);if(vms_feature("comment_writer")){t*=3,n*=3;var i=r.find(".writeranywhere");i&&i.click();var s=this.commentwriter.ccwriter.writer;if(!s)return;var o=r.find(".showDrawPlz");if(o.is(".loading"))return;o.addClass("loading");var u=new Spinner($.extend({},SpinnerPresets.green,{left:"-22px"}));u.spin(o[0]);var a,f,l,c=this;s.frame("http://sta.sh/muro/iframe?width="+t+"&height="+n+"&background=clear",function(e,r){var i="remove";switch(e.action){case"error":o.removeClass("loading"),u.stop(),r.hidden&&r.act("show");return;case"cancel":return"remove";case"got_id":f=e.id&&parseInt(e.id,36);return;case"done":l=e.img||l,c.drawplz_saving++,i="hide";break;case"save":f=e.privateid||e.id||f,l=e.img||l,c.drawplz_saving--;break;case"ready":return setTimeout(function(){o.removeClass("loading"),u.stop()},1e3),"show";default:return}if(f&&l&&!a){var h=$("<img>",{src:l,"class":"writer-embed writer-deviation-image writer-deviation-redraw",embedid:f,embedtype:"deviation",embedformat:"image",embednaturalwidth:t,embednaturalheight:n});s.insert(h),WriterEmbed.runLoaders(s.$node),a=!0}return i});return}r.find(".drawPlz").hide(),stdLog("MainNode: ",r.get(0)),DiFi.pushPost("DrawPlz","inline_html",[],function(e,i){if(i.response.status!="SUCCESS")return;var s=i.response.content.htmlContent,o=this.node.className.indexOf("talk-post-reply")!=-1;if(o){var u=r.find("tr").get(0);stdLog("firstTR: ",u),$(u).after('<tr><td colspan="2">'+s+"</td></tr>")}else vms_feature("comment_writer")?r.find(".cc-without-moods").append(s):r.find(".cc-with-moods").append(s);Browser.isIE&&r.find("canvas").each(function(){var e={};el=this;var t=["class","style","width","height"];for(var n in t){var r=el.getAttribute(t[n]);r&&(e[t[n]]=r)}var i=$(el).parent().get(0);$(el).remove();var s=document.createElement("canvas");for(var n in e)s.setAttribute(n,e[n]);i.appendChild(s)}),DWait.ready(["jms/lib/localStorage.js","jms/pages/drawplz/managers.js"],function(){window.manager=new Managers(r.find(".drawPlzContainer").get(0),t,n),this.commentDrawing=manager.canvasDrawing}.bindTo(this
))}.bindTo(this)),DiFi.send()},drawPlz_updateImage:function(e,t){this.commentDrawing=e;var n=$(this.node),r=t,i=n.hasClass("talk-post-reply");i?(n.find(".drawPlzComment").parents("tr").remove(),n.find("tr").eq(0).after('<tr><td colspan="2">'+r+"</td></tr>")):(n.find(".drawPlzComment").remove(),n.find(".cc-with-moods .cctextarea").append(r))},drawPlz_edit:function(){},drawPlz_hide:function(e){this.drawplz_hovered=0;if(this.commentDrawing){if(e!=1&&!confirm("If you do this, you will lose your current drawing.\nAre you sure?"))return;var t=$(this.node);t.find(".hideDrawPlz, .info").hide().eq(0).parent().find(".showDrawPlz").show(),t.find(".drawPlz").show(),t.find(".drawPlzContainer, .drawPlzComment").remove(),this.commentDrawing=null}},getCommentImage:function(){return this.commentDrawing&&this.commentDrawing.hasUnsavedWork()?this.commentDrawing.getSaveData():!1},drawPlz_mouseover:function(){this.drawplz_hovered=1},drawPlz_mouseout:function(){this.drawplz_hovered=0}},function(e){var t=!1;vms_feature("comment_writer")&&!t&&e(document).on("mouseover.ccwriter",":gmi(CCommentThread), :gmi(TalkPostWrapper)",function(){DWait.ready(["cssms/lib/writer.css","cssms/pages/stash/stash.override.thumbs.css","cssms/pages/stash/stash.header.css","cssms/lib/writer-subtoolbar.css","cssms/lib/canvas_drawing.css","jms/lib/writer/factory.js","jms/lib/writer/sidebar.js"],function(){console.log("CommentWriter preloaded")}),e(document).off("mouseover.ccwriter"),t=!0})}(jQuery),window.DWait&&DWait.run("jms/pages/talkpost.js")});

DWait.ready(["jms/lib/bind.js","jms/lib/gwebpage.js","jms/lib/popup2.js","jms/lib/jquery/jquery.current.js"],function(){(function(e){window.GiveMenu={show:function(t,n){popup=new Popup2("GiveMenu","body",{classes:"givemenu",content:'<div class="pager2"><div class="blockmenu"><div class="loading">Loading</div></div></div>',destroy:!0}),popup.show(popup.position(e(t),{align:"right",bump:{left:15}})),DiFi.pushPublicGet("User","getGiveMenu",[n],bind(this,this.difiCallback,t,popup)),DiFi.send()},difiCallback:function(t,n,r,i,s){if(!r||!i.response.content.html)return s?null:DiFi.stdErr("Failed to load give menu",i.response.content);gWebPage.update(i.response.content);var o=e(i.response.content.html),u=this;o.find("a.morelink").click(function(t){o.find(e(this).attr("rel")).show(),e(this).remove(),u.heightCalc(n)}),setTimeout(bind(this,this.actualDisplay,o,t,n),50)},actualDisplay:function(e,t,n){n.$node.html(e.show()),this.heightCalc(n)},heightCalc:function(t){t.$node.height(t.$node.find("div.blockmenu").height()+(e.browser.msie?4:0))}},e(document).on("click","[givemenu]",function(t){t.preventDefault(),t.stopPropagation(),GiveMenu.show(this,e(this).attr("givemenu"))})})(jQuery),window.DWait&&DWait.run("jms/pages/givemenu.js")});

DWait.ready(["jms/lib/gmi.js"],function(){window.CCommentThread=CCommentThread=(window.GMIHub||GMIBase).extend({gmiConstructor:function(){},DR_SEL:"span.drawplz.closed",HT_SEL:"span.thumb-attachment.closed",B_SEL:"div.drawplz-attachment-ctrl",recently_rendered:{},toggleAttachmentButton:function(){(this.$.parent().find(this.DR_SEL).length||this.$.parent().find(this.HT_SEL).length)&&this.$.parent().find(this.B_SEL).show().find(".gmbutton2").click(bind(this,this.clickAttachmentButton))},clickAttachmentButton:function(e){return this.$.parent().find(this.B_SEL).hide(),this.$.parent().find(this.DR_SEL).removeClass("closed").unbind("click").removeClass("dwait"),this.$.parent().find(this.HT_SEL).each(function(){$(this).removeClass("closed").unbind("click").removeClass("dwait").next(".shadow-holder, .embedded-deviation").show(),$(this).next("a.thumb-attachment-content").replaceWith(function(){return $(this).data("html")})}),!1},hubRecv:function(e){switch(e.cmd){case"new":if(e.commentid in this.recently_rendered)return;this.renderNewComment(e,{})}},renderNewComment:function(e,t){var n,r,i,s;console.log("renderNewComment",e,t),this.recently_rendered[e.commentid]=1,this.gmi_node.firstChild&&(this.gmi_node.firstChild.className||"").indexOf("expendable")>=0&&(this.gmi_node.innerHTML=""),s=Number(e.parentid);var o=[];s&&s!=this.gmi_args.rootid?$.each(this.gmiQuery("CComment",{match:{commentid:e.parentid}}),function(e,t){n=t.gmi_node,n&&($(n.nextSibling).hasClass("nest")?n=n.nextSibling:n=$('<div class="nest"></div>').insertAfter(n)[0]),o.push(n)}):$.each(GMI.query("CCommentThread"),function(t,r){e.itemid==r.gmi_args.itemid&&e.typeid==r.gmi_args.typeid&&(n=r.gmi_node,o.push(n))});if(o.length){var u=this;$.each(o,function(t,n){$($.trim(e.html)).hide()[Number(u.gmi_args.order)==2?"prependTo":"appendTo"](n).fadeIn(400).gmiWake()})}else console.log("Skipped comment rendering; parent is out of view");return r&&t.scroll_to&&(i=Ruler.document.node(r).y-30,window.scrollTo?window.scrollTo(0,i):document.body.scrollTop=i),r}}),window.CCommentMaster=CCommentMaster=GMIBase.extend({gmiConstructor:function(){}}),window.DWait&&DWait.run("jms/pages/ccommentthread.js")});

DWait.ready(["jms/lib/gmi.js","jms/lib/dtlocal.js","jms/lib/popup2.js","jms/pages/ccommentthread.js","jms/lib/analytics.js"],function(){window.CComment=CComment=GMIBase.extend({gmiConstructor:function(){DTLocal.infect(this),this.permahidden=this.gmi_args.permahidden,this.$.find("span.drawplz.closed").click(this.specialAttachmentClick),this.$.find("span.thumb-attachment.closed").click(this.thumbAttachmentClick),this.$.find("span.thumb-attachment.closed").each(function(){$(this).show().next(".shadow-holder, .embedded-deviation").hide()}),this.groupAttachmentButtons()},gmiDestructor:function(){this.localDestroy()},groupAttachmentButtons:function(){$(".thumb-attachment.closed.show-image-thumbs",this.$).each(function(){var e=$(this),t=this,n=[];while(t=t.previousSibling)if(t.nodeType==3&&(t.textContent||t.nodeValue).match(/^\s+$/)||t.nodeName=="BR")n.unshift(t);else if(!$(t).is(".thumb-attachment-content")){if($(t).is(".thumb-attachment"))break;return}if(!t)return;var r=$(t);if(r.css("display")=="none"||$("img",t).length>=5)e.css("display","none"),$("img",t).length>=5&&!r.hasClass("contains-more-thumbs")&&r.addClass("contains-more-thumbs");else{var i="";for(var s=0;s<n.length;s++)i+=n[s].nodeType==3?n[s].textContent||n[s].nodeValue:n[s].outerHTML,this.parentNode.removeChild(n[s]);r.append($("img",e)),r.next("a.thumb-attachment-content").data({html:r.next("a.thumb-attachment-content").data("html")+i+e.next("a.thumb-attachment-content").data("html")}),e.next("a.thumb-attachment-content").add(e).remove()}}),Glbl("Site.is_stash")&&this.$.find("span.thumb-attachment.closed").click()},replyClick:function(){var e,t,n;return window.event&&(event.cancelBubble=!0),this.local.talkpost?(this.local.talkpost.focus(),!1):(this.local.talkpostnode=e=document.createElement("div"),e.className="nest",e.innerHTML='<div class="ccomment ccomment-post ch"><i class="tl c"><i></i><b></b></i><i class="tr c"><i></i><b></b></i><i class="bl c"><i></i><b></b></i><i class="br c"><i></i><b></b></i><div class="ch-ctrl"><br/></div></div>',this.local.talkpost=t=new TalkPost(this,{typeid:this.gmi_args.typeid||-1,itemid:this.gmi_args.itemid||-1,parentid:this.gmi_args.commentid,allowdrawings:this.gmi_args.allowdrawings},bind(this,this.replyCallback),{pager_theme:"light",show_icon:!0,hide_moods:this.gmi_args.hidemoods}),t.local_tie="talkpostnode",n=e.getElementsByTagName("br")[0],t.node.style.display="block",n.parentNode.replaceChild(t.node,n),this.gmi_node.className+=" ccomment-activereply",this.gmi_node.nextSibling?this.gmi_node.parentNode.insertBefore(e,this.gmi_node.nextSibling):this.gmi_node.parentNode.appendChild(e),t.focus(),this.logged_expand||(this.logged_expand=!0),!1)},replyCallback:function(e,t){if(!this.local.talkpost)return;switch(e){case"posted":var n;this.callback_post&&this.callback_post(t),this.local.talkpost.local_tie=null,this.localClean(TalkPost),this.local.talkpostnode.parentNode.removeChild(this.local.talkpostnode);var r=this.gmiUp("CCommentThread");r||(r=GMI.query("CCommentThread")[0]),console.log("ccommentthread",r),r&&!r.renderNewComment(t,{fast:!0,scroll_to:!0}),this.local.talkpostnode=null,PubSub.publish("PageViewTracker.pageview",{page:"/vpv/difi/commentpost",tag:"Dynamic.Comment"});case"closed":this.gmi_node.className=this.gmi_node.className.replace(/\bactivereply\b/g,"")}},unhideClick:function(){return this.permahidden?this.setHideState(!1):this.difi("unhide","displaying this comment"),window.event&&(event.cancelBubble=!0),!1},hideClick:function(){this.permahidden?this.setHideState(!0):this.difi("hide","hiding this comment")},reportClick:function(){this.permahidden?alert("This comment has already been reported."):!this.loading&&confirm("Report this comment as spam?")&&this.difi("reportSpam","reporting this comment as spam")},doPopup:function(e){var t="<div class='blockmenu'><div style='position:relative'><a class='f' href='#' onclick='GMI.up(this).hideClick();Popup2.hideAll(); return GMI.evCancel();'>Hide Comment</a>";e===!1&&(t+="<a href='#' class='f' onclick='GMI.up(this).reportClick();Popup2.hideAll(); return GMI.evCancel();'>Report Spam</a><a class='f' href='#' onclick='GMI.up(this).blockClick();Popup2.hideAll();return GMI.evCancel();'>Block User</a>"),t+="</div></div>";var n=$(this.gmi_node).find(".gm-chaos");return CComment.popup=new Popup2("GroupListManage","body",{classes:"ccomment-manage",content:t,destroy:!0,created:function(e){e.$node.attr("gmi-redirect",this.gmi_node.getAttribute("gmindex"))}.bindTo(this),hidden:function(){n.find(".gmbutton2").removeClass("active")},shown:function(){n.find(".gmbutton2").addClass("active")}}),CComment.popup.show(CComment.popup.position(n,{align:"right"})),!1},blockClick:function(){a=$("a.u",this.gmi_node)[0],author=a.firstChild.nodeValue,confirm("Add "+author+" to your blocked users list?")&&(DiFi.pushPost("User","block",[author],function(e,t){e?alert(author+" has been added to your list of blocked users."):t.response.content.error?alert(t.response.content.error):alert("deviantART was unable to add "+author+" to your blocked users list.")}),DiFi.send())},specialAttachmentClick:function(){$(this).removeClass("closed").unbind("click").removeClass("dwait")},thumbAttachmentClick:function(){$(this).closest(".ccomment").find(".thumb-attachment.closed").each(function(){$(this).removeClass("closed").unbind("click").removeClass("dwait").next(".shadow-holder, .embedded-deviation").show(),$(this).next("a.thumb-attachment-content").replaceWith(function(){return $(this).data("html")})})},difi:function(e,t){var t;if(this.loading)return;this.loading=!0,this.gmi_node.className+=" ccomment-loading",DiFi.pushPost("CommentAttributes",e,[this.gmi_args.commentid,this.gmi_args.itemid,this.gmi_args.typeid],bind(this,this.difiDone,t)),DiFi.timer(1)},difiDone:function(e,t,n){this.gmi_node.className=this.gmi_node.className.replace(/\bccomment.loading\b/g,""),this.loading=!1;if(!t){alert("There was an error while "+e+".\n\nPlease try again soon.");return}switch(n.request.method){case"reportSpam"
:this.permahidden=!0;if(!CComment.SPAM_REPORT_DONE){var r,i,s;CComment.SPAM_REPORT_DONE=!0,r=$("a.u",this.gmi_node)[0],i=r.firstChild.nodeValue,s=r.previousSibling.nodeValue,n.response.content.can_report_all&&i&&confirm("Would you also like to scan for comments by "+s+i+" on your user page, deviations, journals, etc.?")?(DiFi.pushPost("CommentAttributes","removeSpamOnUser",[i],function(e,t){e?alert("The process of removing spam from your user page, deviations, journals, etc., has started.\nYou will be notified with a note once this is complete."):alert("deviantART was unable to start the process of removing all spam by this user.\nWe appreciate your effort, and ask you to please try again shortly.")}),DiFi.timer(1)):alert("Thank you for your report.")};case"hide":this.makeUnhideLink(),this.setHideState(!0);break;case"unhide":this.setHideState(!1)}},makeUnhideLink:function(){var e,t;e=(this.gmi_node.getElementsByTagName("a")||[])[0];if(!e||e.className!="creason")e=document.createElement("a"),e.onclick=bind(this,this.unhideClick),e.href="#",e.className="creason",t=this.gmi_node.getElementsByTagName("div")[0],t.insertBefore(e,t.firstChild);e.innerHTML="<span>"+(this.permahidden?"Flagged as Spam":"Hidden by Owner")+"</span><em>"+(this.permahidden?"Peek":"Undo Hide")+"</em>"},setHideState:function(e){e?this.gmi_node.className+=" ccomment-hidden":this.gmi_node.className=this.gmi_node.className.replace(/\bccomment.hidden\b/g,"")}}),window.DWait&&DWait.run("jms/pages/ccomment.js")});

window.TabledResourceStream=ResourceStream.extend({domFindVisible:function(){var e,t,n,r;t={},r=0;var i=$(this.gmi_node).find(".tt-a, .rs-customicon-cont, .gl-text");for(e=0;n=i[e];e++)n.getAttribute("rs_ignore")||(t[r++ +this.gs_offset]=n);return t},dataFetch:function(){},gmiConstructor:function(){this.preview_override_selection_type=TabledResourceStreamSimpleSelection,this.base()},get_stream_node_from_clicked_node:function(e){return $(e).closest(".tt-a").get(0)}}),window.TabledResourceStreamSimpleSelection=window.ResourceStreamSimpleSelection.extend({getAllSelectable:function(){return $(".tt-a",this.root).toArray()},isSelectable:function(e){return $(e).hasClass("tt-a")}}),window.DWait&&DWait.run("jms/lib/gstream/tabled_resource_stream.js");

DWait.ready(["jms/lib/Base.js","jms/legacy/modals.js","cssms/modals/signup-modal.css"],function(){SignupBase=Base.extend({constructor:function(){$(window).bind("message",function(e){e.originalEvent&&e.originalEvent.origin==="http://verify.deviantart.com"&&e.originalEvent.data.match(/"command":"close"/)&&Modals.pop("finished")})},modalUp:!1,dificalls:[],modal:function(e,t,n){var r,i,s="520";if(n)i=n;else{var o=location.hostname.split(".")[0];window.location.hostname.match(/sta.sh$/)?(i="https://sta.sh/login/oauth/modal",s="550"):((window.deviantART||{}).deviant||{}).id?i="http://verify.deviantart.com/?from=Modal&subdomain="+o+"&referrer="+encodeURIComponent(location.href):i="https://www.deviantart.com/join/?joinview=Modal&joinpoint="+encodeURIComponent(t.request["class"])+"&subdomain="+o}r=$('<div class="secure"><div class="join-modal-title"><h3>Sign Up<span> or Log In</span></h3></div><div class="join-modal-contents" style="height:'+s+'px;">'+'<div id="loading_iframe">'+'<img src="http://s.deviantart.com/emoticons/e/eager.gif" />Loading&hellip;'+"</div>"+'<iframe scrolling="no" allowtransparency="true"  src="'+i+'" frameBorder="0" '+"onload=\"$(this).show().closest('.secure').addClass('loaded').parent().width($(this).closest('.secure').width()).height($(this).closest('.secure').height()); $('#loading_iframe').hide();\">"+"</iframe>"+"</div>"+"</div>")[0],this.dificalls.push([e,t]);if(!this.modalUp){var u=Modals.factory(r);Modals.push(u,bind(this,this.done),"join-modal")}this.modalUp=!0},done:function(e){e&&gWebPage.update(e),this.modalUp=!1;var t,n,r,i=!1;while(t=this.dificalls.pop())n=t[0],r=t[1],e&&e.result=="finished"&&r?(i=!0,DiFi.pushPost(r.request["class"],r.request.method,r.request.args,n[0][0],n[1][0])):n[0][0].call(n[1][0],e&&e.result=="finished",r,!0);if(i){var s=($("#overhead").data("header-refresh")||"DAWebpageHeader;getHeaderHTML").split(";");DiFi.pushPrivateGet(s[0],s[1],[],this.headerRefresh),DiFi.send()}},headerRefresh:function(e,t){e?($("#overhead-sc").fadeOut(function(){gWebPage.update(t.response.content),$(this).html(t.response.content.html),PubSub.publish("Signup.headerRefresh"),$(this).fadeIn()}),$("#overhead tr").fadeOut(function(){gWebPage.update(t.response.content),$(this).html(t.response.content.html),PubSub.publish("Signup.headerRefresh"),$(this).fadeIn()})):console.log("Err",t.response.content)}}),window.Signup=new SignupBase,window.DWait&&DWait.run("jms/pages/signup.js")});

DiFi.errorHooks.push(function(e,t,n){if(!e&&t.response.content&&t.response.content.error=="DiFi Security Access Error"&&t.response.content.details.privs&&(((t.response.content.details.privs[0]||[])[2]||[])[0]==PRIV_LOGGEDIN||((t.response.content.details.privs[0]||[])[2]||[])[0]==PRIV_VERIFIED)&&window.Signup&&!window.location.hostname.match("dreamup"))return Signup.modal(n,t),!0}),window.DWait&&DWait.run("jms/pages/difi_errorhook_signup.js");

(function(e){e(".gmbutton2searchcancel").each(function(){var t=e(this),n=t.parent().find("input.gmbutton2");t.click(function(){n.val(""),n.change(),t.parents("form").submit()});var r=function(){n.val()?t.addClass("show"):t.removeClass("show")};n.change(r),n.keyup(r),n.change()})})(jQuery),window.DWait&&DWait.run("jms/chrome/searchcancel.js");

DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){var e=window.location.href.substring(window.location.href.indexOf("?")+1);$("a.expand").each(function(){var t=$(this).attr("href");if(t.substring(0,9)!="#_expand_")return;var n=t.substring(9),r=$("div[skinscript=expandable_"+n+"]");if(!r.length)return;r.hide(),$(this).click(function(){return r.toggle(),!1}),(e==$(this).attr("href").substring(1)||e.match("_expand_all"))&&$(this).click()}),window.DWait&&DWait.run("jms/pages/catskin-expander.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/glbl.js"],function(){window.BrowserSupport={getBrowser:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,r=e[t].prop;this.versionSearchString=e[t].versionSearch||e[t].identity;if(n){if(n.indexOf(e[t].subString)!=-1)return e[t]}else if(r){if(!navigator.userAgent)return e[t];if(navigator.userAgent.indexOf(e[t].identity)!=-1)return e[t]}}return null},getVersion:function(e){var t=new RegExp(this.versionSearchString+"/? ?([0-9]+(\\.?[0-9]+)*)"),n=e.match(t);return n?n[1].split("."):null},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome",min:[8,0],link:"http://www.google.com/chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version",min:[4,0],link:"http://www.apple.com/safari/"},{prop:window.opera,identity:"Opera Mini",versionSearch:"Version",min:[10,50],link:"http://www.opera.com/"},{prop:window.opera,identity:"Opera",versionSearch:"Version",min:[11,50],link:"http://www.opera.com/"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox",min:[12,0],link:"http://getfirefox.com"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE",min:[8,0],link:"http://microsoft.com/ie"}],getSupported:function(){var e=this.getBrowser(this.dataBrowser),t=this.getVersion(navigator.userAgent);if(!e||!t)return;var n;return $.each(e.min,function(e,r){n===undefined&&t[e]&&(t[e]<r&&(n=!1),t[e]>r&&(n=!0))}),n===undefined&&(n=e.min.length<=t.length),{browser:e.identity,version:t.join("."),supported:n,link:e.link}}};if(!Glbl("Site.is_mobile")&&Glbl("BrowserSupport.enforce")!==!1){var e=BrowserSupport.getSupported();$.isPlainObject(e)&&!e.supported&&$("#overhead-collect").before('<div style="background:url(http://st.deviantart.net/misc/updatebrowser_ylw_bg.png) repeat-x;width:100%;height:10px;line-height:10px;text-align:center;position:absolute;top:-1px;z-index:1000;font-family:verdana;font-size:10px;color:#3c3838;padding:10px 0px;text-shadow:#fff 1px 1px;">Please <a href="'+e.link+'" style="color:#1965B6;">upgrade your browser</a> to access deviantART</div>')}window.DWait&&DWait.run("jms/pages/browser_support.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/Base.js","jms/lib/pubsub.js"],function(){(function(e){var t=Base.extend({_resize_throttle:100,_debounce_fill_ad:800,_page_debounce_times:{},_minimum_boundary:100,_init:!1,_resize_mode:!1,_duperbrowse_mode:!1,_stashed_ad_html:[],_waiting_ad_units:[],_ads:{},_pool:[],_win_w:0,_$win:null,constructor:function(){this._$win=e(window),this._win_w=this._$win.width()},fill_ad_slot:function(t,n){if(this._resize_mode)return;t=String(t);var r=e.now();if(this._page_debounce_times[t]&&r<this._page_debounce_times[t])return;this._page_debounce_times[t]=r+this._debounce_fill_ad,n=e(n);if(!this.is_valid_ad_request(t,n))return;if(this._ads[t]){this.position_ad(t,n);return}this.show_container(),this.get_an_offscreen_ad(t),this.position_ad(t,n),this._init||(this._init=!0,this.bind_window_resize(),PubSub.subscribe([{eventname:"Duperbrowse.opened",subscriber:this,callback:this.duperbrowse_opened},{eventname:"Duperbrowse.closed",subscriber:this,callback:this.duperbrowse_closed}]))},stash_ad_html:function(t){if(this._waiting_ad_units.length){e(this._waiting_ad_units.shift()).html(t);return}this._stashed_ad_html.length<=5&&this._stashed_ad_html.push(t)},scroll_manager_is_done_resizing:function(){if(!this._resize_mode||this._duperbrowse_mode)return;this._win_w=this._$win.width(),this.show_container();for(var e=0,t=this._pool.length;e<t;++e)this.position_ad(this._pool[e]);this.enter_normal_mode()},enter_normal_mode:function(){this._resize_mode=!1,this.show_container(),this.bind_window_resize()},enter_resize_mode:function(){this._resize_mode=!0,this.unbind_window_resize(),this.hide_container()},unbind_window_resize:function(){this._$win.off("resize.browselikethis_ad_pool")},bind_window_resize:function(){this._$win.on("resize.browselikethis_ad_pool",e.throttle(this._resize_throttle,this.window_resize.bindTo(this)))},window_resize:function(){var e=this._$win.width();if(e==this._win_w)return;this._win_w=e,this.enter_resize_mode()},duperbrowse_opened:function(){this._duperbrowse_mode=!0,this.enter_resize_mode()},duperbrowse_closed:function(){this._duperbrowse_mode=!1,this.enter_normal_mode()},position_ad:function(t,n){var r=this.get_ad_by_page_id(t);r&&(n=e(n),n.length&&(r.$node=n),r.offset=r.$node.offset(),r.offset<this._minimum_boundary&&(r.offset={top:-9999,left:-9999}),r.$el.css(r.offset))},is_valid_ad_request:function(e,t){if(!t.length)return!1;var n=this.get_ad_by_page_id(e);if(!n)return!0;if(!n.$node.is(t))return!0;var r=t.offset();return Math.floor(r.top)!=Math.floor(n.offset.top)||Math.floor(r.left)!=Math.floor(n.offset.left)?!0:!1},get_ad_by_page_id:function(e){return this._ads[e]},get_an_offscreen_ad:function(t){var n=this._pool.length,r=this._$win.scrollTop(),i=r+this._$win.height();for(var s=0;s<n;++s){var o=this._pool[s],u=this.get_ad_by_page_id(o);if(!u)continue;var a=u.offset.top,f=a+this.ad_height,l=a>=r&&a<=i||r>=a&&r<=f;if(!l)return this._pool.splice(s,1),this._pool.push(t),this._ads[o]=null,this._ads[t]=u,u}var c={$el:this.create_ad_element(),$node:e()};return c.offset=c.$el.offset(),this._pool.push(t),this._ads[t]=c,this.ad_height||(this.ad_height=c.$el.height()),c},get_container:function(){return this.$container||(this.$container=e("<div>").addClass("blt-ad-container").prependTo(document.body)),this.$container},hide_container:function(){this._container_hidden=!0,this.get_container().addClass("hidden")},show_container:function(){this._container_hidden=!1,this.get_container().removeClass("hidden")},create_ad_element:function(){var t=this._stashed_ad_html.shift(),n=e("<div>").addClass("blt-ad").appendTo(this.get_container());return t?n.html(t):this._waiting_ad_units.push(n),n}}),n=new t;PubSub.publish("BrowseLikeThisAdPool.instance_loaded",n)})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.ads.js")});

(function(e){function u(e){var t=e.split("&"),n={},r;for(var i=0;i<t.length;i++){if(!t[i].length)continue;r=t[i].split("=",2),n[r[0]]=r[1]}return n}if(window.location.hash.indexOf("offset")>-1){var t=u(window.location.hash.split("?",2)[1]||""),n=u(window.location.search.replace(/^\?/,"")),r=parseInt(t.offset||0,10),i,s,o;if(t.offset==undefined)return;e("#browse-results-page-1").html('<span class="browse-loading">Loading from result '+(r+1)+"...</span>"),delete t.offset,s=e.param(t),i=window.location.hash.replace(/\?.*$/,s.length?"?"+s:"");if(i==="#"||i==="#/")i="";n.offset=r,o="?"+e.param(n),window.location=window.location.pathname+o+i}})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.onload_url_hash_handler.js");

DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js",".domready"],function(){(function(e){var t=Base.extend({handlers:{load_comments_clicked:function(t){t.preventDefault();var r=e(this),i=r.data("CommentsLoader");if(!i){var s=r.data("itemid"),o=r.closest(".deviation-full-minipage");i=new n(s,o),r.data("CommentsLoader",i)}i.load_more()},show_description_clicked:function(){e(this).siblings(".minipage-description").css({height:"auto",overflow:"auto"}).find(".description-fader").remove(),e(this).remove()}},constructor:function(){e("#browse-results").on("click",".comments-count:not(.disabled)",this.handlers.load_comments_clicked).on("click",".minipage-show-description",this.handlers.show_description_clicked),this.adjust_description_height(),PubSub.subscribe([{eventname:"BrowseLikeThisStreamView.pages_visible",subscriber:this,callback:this.adjust_description_height}])},adjust_description_height:function(){var t=43;e(".minipage-description .text-ctrl").not(".height-adjusted").each(function(){var n=e(this);n.height()<=t&&(n.siblings(".description-fader").remove(),n.parent().height(n.height()).siblings(".minipage-show-description").remove()),n.addClass("height-adjusted")})}}),n=Base.extend({COMMENT_DEVIATION:1,$comments:null,$comments_loaded:null,$comments_count:null,itemid:null,offset:0,limit:25,templates:{loading:"<div class='comments-loading browse-loading'>Loading...</div>",end:"<div class='browse-done'>End of Comments</div>"},constructor:function(e,t){this.itemid=e,this.$comments=t.find(".minipage-comments-container"),this.$comments_loaded=t.find(".comments-loaded"),this.$comments_count=t.find(".comments-count")},load_more:function(e,t){this.show_loading(),DiFi.pushPublicGet("Comments","getLimitedComments",[this.COMMENT_DEVIATION,this.itemid,0,this.offset,this.limit+1],this.load_more_done.bindTo(this)),DiFi.send()},load_more_done:function(t,n){this.remove_loading();if(n.response.content.error){this.disable_more();return}var r=e(n.response.content.html),i=r.find(".ccomment"),s=i.length;s<this.limit+1?this.disable_more():(s--,i.last().remove()),this.$comments.append(r),this.offset+=s,this.update_comments_loaded()},show_loading:function(){this.$comments.append(this.templates.loading)},remove_loading:function(){this.$comments.find(".comments-loading").remove()},disable_more:function(){this.$comments_count.parent().prepend(this.templates.end),this.$comments_count.remove()},update_comments_loaded:function(){this.$comments_loaded.text(this.offset),this.$comments_loaded.parent().show()}});new t})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.minipage.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/pages/browselikethis/browselikethis.stream.fetcher.js","jms/pages/duperbrowse/duperbrowse.helpers.js"],function(){(function(){var e=Base.extend({_fetcher:null,_stream_stack:null,_max_page_id:0,_loaded_pages:[],_loading_queue:[],_pages:{},_first_visible_page:null,_current_item_page:null,_current_item:null,_current_offset:null,_items:{},_page_skeleton:{id:null,number:null,portal_api:null,query_params:{},results_dom:null,results_rids:null,paging_mode:"infinite",is_initial_page:!1,advert_dom:null,state:"unloaded",has_more:!1,has_less:!1,error_state:0,max_offset:null,result_type:null,result_limit:null},handlers:{init:function(e,t){var n=this._create_page(t);n.state="loaded",n.is_initial_page=!0,this._add_loaded_page(n),this._add_loaded_items(t.results_rids,n.id),this.handlers.set_first_visible_page.bindTo(this)(null,n.id),this._set_current_item_page(n),this._fetcher=new BLTStreamFetcher({cache_size:20}),PubSub.unsubscribe({eventname:"BrowseLikeThisStream.init",subscriber:this}),PubSub.subscribe([{eventname:"BrowseLikeThisStream.load_next",subscriber:this,callback:this.handlers.load_next},{eventname:"BrowseLikeThisStream.set_first_visible_page",subscriber:this,callback:this.handlers.set_first_visible_page},{eventname:"BrowseLikeThisStream.open_duperbrowse",subscriber:this,callback:this.handlers.open_duperbrowse.bindTo(this)}])},load_next:function(e,t){if(this._loading_queue[0])return;var n=this._init_new_page(t);n&&this._load_new_page(n)},set_first_visible_page:function(e,t){if(this._pages.hasOwnProperty(t)){var n=!this._current_page;if(n||this._current_page.id!==t){this._current_page=this._pages[t],PubSub.publish("BrowseLikeThisStream.current_page_changed",this._current_page);if(!n){var r=BrowseLikeThisStream.get_blt_url_for_offset(this._current_page.query_params.offset);PubSub.publish("Location.replace",r)}}}},open_duperbrowse:function(e,t){var n={next_item_callback:this._next_item_callback.bindTo(this),prev_item_callback:this._prev_item_callback.bindTo(this),has_next_callback:this._has_next_callback.bindTo(this),has_prev_callback:this._has_prev_callback.bindTo(this),on_stream_item_opened:this._on_stream_item_opened.bindTo(this),on_stream_item_closed:this._on_stream_item_closed.bindTo(this)};Duperbrowse.open(t,n)}},constructor:function(){this._loading_queue=[],this._loaded_pages=[],this._pages={},this._items={},PubSub.subscribe({eventname:"BrowseLikeThisStream.init",subscriber:this,callback:this.handlers.init})},_create_page:function(e){var t=$.extend(!0,{},this._page_skeleton,e);return t.id=this._next_page_id(),this._pages[t.id]=t,t},_load_new_page:function(e){var t=this._fetcher.fetch(e.portal_api,e.query_params,e.result_limit);this._loading_queue.length<1&&PubSub.publish("BrowseLikeThisStream.next_page_loading",e),this._loading_queue.push(e),this._handle_promise(t,e).always(this._process_queue.bindTo(this))},_set_current_item_page:function(e){this._current_item_page=e},_process_queue:function(){var e=0,t;while(this._loading_queue[0]&&this._loading_queue[0].state!=="pending")t=this._loading_queue.shift(),(t.state=="loaded"||t.state=="error")&&this._add_loaded_page(t),e++;this._loading_queue.length<1?PubSub.publish("BrowseLikeThisStream.next_page_loading",!1):PubSub.publish("BrowseLikeThisStream.next_page_loading",t)},_handle_promise:function(e,t){var n=this;return e.done(function(e){t.advert_dom=e.advert_dom,t.results_dom=e.results_dom,t.results_rids=e.results_rids,t.has_more=e.has_more,t.has_less=Boolean(e.query_params.offset>0),t.error_state=e.error_state,t.state="loaded",n._add_loaded_items(e.results_rids,t.id)}).fail(function(e){t.state="error",t.error=e})},_add_loaded_page:function(e){this._loaded_pages.push(e),!e.is_initial_page&&e.paging_mode!="paged"&&PubSub.publish("BrowseLikeThisStream.new_page_added",e)},_add_loaded_items:function(e,t){if(!e)return;var n=this;$.each(e,function(e,r){n._items[r.stream_offset]={itemid:parseInt(r.itemid,10),stream_offset:parseInt(r.stream_offset,10),pageid:parseInt(t,10)}})},_next_page_id:function(){return++this._max_page_id},_init_new_page:function(e,t){var n,r=0,i;t?i=this._loaded_pages[0]:i=this._loaded_pages[this._loaded_pages.length-1];if(!i.has_more&&!t||!i.has_less&&t)return;n=this._create_page(i),t?(r=parseInt(n.query_params.offset,10)-parseInt(n.query_params.length,10),n.number--):(r=parseInt(n.query_params.offset,10)+parseInt(n.query_params.length,10),n.number++),r<0&&(r=0,n.result_limit=n.query_params.offset),n.query_params.offset=r,n.display_method=e?"auto":"button",n.state="pending",n.is_initial_page=!1,n.query_params.view_mode=="full"&&(n.query_params.results_shown=(parseInt(n.query_params.results_shown,10)||0)+(parseInt(n.query_params.length,10)||0),n.query_params.length=5,n.paging_mode==="paged"&&(n.query_params.results_shown=0));if(Number(n.max_offset)&&n.query_params.offset>=Number(n.max_offset))return;return n},_next_item_callback:function(){var e=this._current_offset+1,t=this._items[e];return t!==undefined?$.Deferred().resolve(t).promise():t===undefined&&this._current_item_page.has_more?this._create_next_item_promise(!1):$.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_prev_item_callback:function(){var e=this._current_offset-1,t=this._items[e];return t!==undefined?$.Deferred().resolve(t).promise():t===undefined&&this._current_item_page.has_less?this._create_next_item_promise(!0):$.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_END_OF_STREAM).promise()},_has_next_callback:function(){var e=this._current_offset+1;return this._items[e]!==undefined?!0:this._current_item_page.has_more===!0&&e<parseInt(this._current_item_page.max_offset,10)?!0:!1},_has_prev_callback:function(){var e=this._current_offset-1;return e<0?!1:this._items[e]!==undefined?!0:this._items[e]===undefined&&this._current_item_page.paging_mode!="infinite"?!0:!1},_on_stream_item_opened:function(e){var t,n;this._items[e.stream_offset]!==undefined?(
t=this._items[e.stream_offset],n=this._current_item,n&&n.pageid!=t.pageid&&this._pages.hasOwnProperty(t.pageid)&&(this._current_item_page=this._pages[t.pageid],PubSub.publish("BrowseLikeThisStream.current_item_page_changed",{new_page:this._current_item_page,old_page:this._pages[n.pageid]})),this._current_item=t,this._current_offset=t.stream_offset):(this._current_item=null,this._current_offset=null)},_on_stream_item_closed:function(e){if(this._items[e.current_offset]===undefined)return;PubSub.publish("BrowseLikeThisStream.duperbrowse_stream_item_closed",this._items[e.current_offset])},_create_next_item_promise:function(e){var t,n,r,i,s,o=!1,u=this;return s=function(e){return o?$.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise():e.results_rids[0]},i=function(e){return o?$.Deferred().reject(DuperbrowseHelpers.PROMISE_STATE_CANCELLED).promise():e.results_rids[e.results_rids.length-1]},t=this._init_new_page(!0,e),t?(n=this._fetcher.fetch(t.portal_api,t.query_params,t.result_limit),this._loading_queue.length<1&&PubSub.publish("BrowseLikeThisStream.next_page_loading",t),this._loading_queue.push(t),this._handle_promise(n,t).always(this._process_queue.bindTo(this)),r=$.when(n).then(e===!0?i:s),r.cancel=function(){o=!0},r):$.Deferred().reject("no page").promise()}});new e,window.BrowseLikeThisStream={get_blt_url_for_offset:function(e){var t=Glbl("Location.get_params"),n="";return e=e||0,e?t.offset=e:t.offset!==undefined&&delete t.offset,$.isEmptyObject(t)||(n="?"+$.param(t)),Glbl("Location.pushstate_enabled")&&(n+=window.location.hash),window.location.pathname+n}}})(),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.stream.js")});

DWait.ready(["jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/difi.js"],function(){(function(e){window.BLTStreamFetcher=Base.extend({_options:{},_defaults:{},constructor:function(t){this._options=e.extend({},this._defaults,t)},fetch:function(t,n,r){var i=e.Deferred();return i.request={portal_api:t,query_params:n,advert_dom:"",results_dom:[],results_rids:[],has_more:!1,error_state:0,result_limit:r},DiFi.pushPublicGet("PortalCore","get_result_thumbs",[i.request.portal_api,i.request.query_params],this._difi_callback.bindTo(this,i)),DiFi.send(),i.promise()},_difi_callback:function(e,t,n){if(t&&n.response.content.resources){var r,i=n.response.content.resources,s=[],o=parseInt(e.request.query_params.offset,10),u=parseInt(e.request.result_limit,10);u>0&&(i=i.slice(0,u));for(r=0;r<i.length;r++)e.request.results_rids.push({type:i[r][0],itemid:i[r][1],stream_offset:o}),s.push(i[r][2]),o++;e.request.advert_dom=n.response.content.ad,e.request.results_dom=s,e.request.has_more=Boolean(n.response.content.has_more),e.request.error_state=parseInt(n.response.content.error_state,10),e.resolve(e.request)}else e.reject(n.response.content.error||"Unknown DiFi Error")}})})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.stream.fetcher.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/gmi.js","jms/lib/popup2.js","jms/lib/browser.js","jms/lib/jquery/jquery.current.js",".domready","jms/lib/gstream/resource_stream.js","jms/lib/gstream/portal_core_resource_stream.js","jms/pages/browselikethis/browselikethis.stream.scroll_manager.js","jms/pages/duperbrowse/duperbrowse.helpers.js","jms/lib/jquery/plugins/jquery.somedata.js"],function(){(function(e,t){var n="infinite",r="paged";t.BrowseLikeThisStreamView=t.PortalCoreResourceStream.extend({_infinite_scroll_enable:!1,_reached_end:!1,_$paging_container:null,_$load_more_button:null,_$gear_menu_button:null,_$first_paging_results:null,_$loading_indicator:null,_$loading_message:null,_scroll_manager:null,_results_since_last_ad:0,preview_override_selection_type:t.BrowseLikeThisPreviewSelection,_allow_show_more:!1,_removed_pages:{},_current_page_offset:0,_initial_location:{path:Glbl("Location.path"),query:Glbl("Location.get_params")},_$ad_container:null,_ad_html:null,templates:{errors:{generic:'<span class="browse-error">There was an error loading this page.</error>',states:{1:'<div class="browse-no-results">There was an error performing your request. Please try again later.</div>',2:'<div class="browse-no-results">Sorry, deviantART does not serve more than @_MAX_OFFSET_@ results for this query.</div>',3:'<div class="browse-no-results">Sorry, we found no relevant results.</div>',4:'<div class="browse-no-results">Sorry, we don\'t have that many results.</div>',5:'<div class="browse-no-results">All of the results on this page have been hidden due to your Mature Content Settings.</div>',6:'<div class="browse-no-results">All of the results on this page have been hidden due to the owner putting them into storage. There may be more visible results on later pages.</div>',7:'<div class="browse-no-results">All of the results on this page have been hidden due to the owner deleting them. There may be more visible results on later pages.</div>'}}},handlers:{next_page_loading:function(t,n){if(n){var r="#browse-results-page-"+n.id;if(e(r).length<1){n.results_dom=[];var i=this._make_page(n);this._$paging_container.before(i)}this._hide_reached_end(),this._$load_more_button.hide(),this._$gear_menu_button.hide(),this._$first_paging_results.hide(),this._$loading_indicator.show()}else!this._infinite_scroll_enable&&!this._reached_end&&(this._$load_more_button.show(),this._$gear_menu_button.show(),this._$first_paging_results.show()),this._$loading_indicator.hide()},cancel_pending:function(t,n){for(var r=0;r<n.length;r++)e("#browse-results-page-"+n[r].id).remove()},new_page_added:function(r,i){setTimeout(function(){this._infinite_scroll_enable?(e("#depths").data("infinite_scroll_enabled",!0),this._$paging_container.css("padding-bottom","300px")):this._reached_end||(this._$load_more_button.show(),this._$gear_menu_button.show(),this._$first_paging_results.show());var r=e("#browse-results-page-"+i.id);r.length<1?r=this._make_page(i):r.detach().find(".page-results").html(this._make_contents_html(i)),this._scroll_manager&&i.paging_mode===n?this._scroll_manager.add_page(i.id,r):this.add_non_scroll_page(i,r),i.has_more&&Number(i.query_params.offset)+Number(i.query_params.length)<i.max_offset?(this._reached_end=!1,this._hide_reached_end()):(this._$load_more_button.hide(),this._$gear_menu_button.hide(),this._$first_paging_results.hide(),this._reached_end=!0,this._show_reached_end()),this._make_legacy_js_happy(r);var s="/vpv/"+t.location.host.split(".")[0]+t.location.pathname+"?offset="+i.query_params.offset;PubSub.publish("PageViewTracker.pageview",{page:s,tag:"Dynamic.BrowseResultsPage"}),this._init_new_thumbs(i.results_rids,e("#browse-results-page-"+i.id+" .page-results")),this._infinite_scroll_enable&&(e("#depths").remove(),this._$paging_container.css("padding-bottom","300px"))}.bindTo(this),1)},infinite_scroll_enabled:function(e){this._infinite_scroll_enable=!0,this._$load_more_button.hide(),this._$gear_menu_button.hide(),this._$first_paging_results.hide()},infinite_scroll_disabled:function(e){this._infinite_scroll_enable=!1,this._$load_more_button.show(),this._$gear_menu_button.show(),this._$first_paging_results.show()},current_item_page_changed:function(e,t){this.gmi_args.paging_mode===r&&(this._removed_pages[t.old_page.id]!==undefined&&(t.new_page.ad_settings.disabled=!0),this.handlers.new_page_added.bindTo(this)(e,t.new_page),this._removed_pages[t.old_page.id]=!0,this._current_page_offset=t.new_page.query_params.offset)},duperbrowse_stream_item_closed:function(n,i){var s=["#browse-results-page-"+i.pageid+" .page-results > .tt-a","#browse-results-page-"+i.pageid+" .page-results > .deviation-full-container > .deviation-full-data","#browse-results-page-"+i.pageid+" .page-results > .tt-a > .journal-wrapper.tt-a"],o=e(s.join(",")).filter(function(){return e.data(this,"itemid")==i.itemid});if(o.length===0)return;var u=o.offset().top,a=e(t).scrollTop();u>a&&u<a+e(t).height()||e(t).scrollTop(u),this.gmi_args.paging_mode===r&&this._$ad_container&&this._ad_html&&this._$ad_container.html(this._ad_html)},duperbrowse_set_closing_location:function(e,t){if(this.gmi_args.paging_mode===r){var n=Glbl("Location.get_params"),i=Number(this._current_page_offset);t=this._replace_url_offset(t,n,i),PubSub.publish("Location.replace",t)}},popup_trigger_click:function(){e(".pane-switch").css("z-index",10);var t=e(this),n=t.data("name");Popup2.getPopup(n)||new Popup2(n,"body",{classes:n,content:e("#"+n).clone(!0).show(),hidden:function(){t.removeClass("popupactive"),t.data("type")&&this.$node.removeClass(t.data("type"))},shown:function(){t.addClass("popupactive"),this.$node.addClass(t.data("type"))}});var r=Popup2.getPopup(n);if(r.active)r.hide();else{var i={keepOnScreen:!1};n=="browse-paging-popup"&&(i.valign="center",i.bump={top:7,left:-9}),r.show(r.position(t,i)),e(".paging-results-go-input:visible").focus()}return!1},popup_active_check:function(){if(Popup2.getPopup(e(this).data("name")).active)return!1},ignore_journal_preview_click
:function(t){var n=e(t.target);if(n.closest(".journalcontrol,.blogcontrol")[0]){t.preventDefault(),t.stopPropagation();var r=n.closest(".journal-browse").find(".journal-footer:last > a:first");if(e("#browse2, #browse-results").length)r.click();else{var i=n.closest(".journal-browse").find(".journalcontrol .metadata a:first");n.is("[href]")?document.location=n.attr("href"):i.length?document.location=i.attr("href"):document.location=r.attr("href")}}},top_button_click:function(){return t.scrollTo(0,0),!1},ie8_hover_fix:function(){e(this).find(".mlt-link").css("background-color","#196BA7").find(".mlt-text").css("display","block")},points_download_button_click:function(t){t.preventDefault(),PubSub.publish("PointsDownload.download_click",e(t.currentTarget))}},gmiConstructor:function(){this.$.removeClass("dwait"),this.$.find(".browse-no-results a").click(function(){return t.location=this.href,!1}),this._init_stream(),this._$paging_container=e(".browse-paging",this.gmi_node);var r=e(".load_more",this._$paging_container);r.hasClass("disabled")||(this._$load_more_button=r.click(this._load_more_click.bindTo(this)).closest(".pagination")),this._allow_show_more=!r.hasClass("disabled"),this._$gear_menu_button=e(".paging-dropdown-trigger",this._$paging_container),this._$first_paging_results=e(".paging-results-first-page",this._$paging_container),this._$loading_indicator=e('<span class="browse-loading">Loading ...</span>').hide().appendTo(this._$paging_container),e("body").on("keydown",".paging-results-go-input",this._keydown_go_input.bindTo(this)).on("click",".paging-results-go",this._set_offset.bindTo(this)).on("click",".paging-style-link",this._change_paging_style);var i=e("#browse-results");i.on("click",".popup-trigger",this.handlers.popup_trigger_click).on("mousedown",".popup-trigger",this.handlers.popup_active_check).on("mousedown",".journal-browse",this.handlers.ignore_journal_preview_click).on("click","a.browse-top-link",this.handlers.top_button_click),Browser.isIE8&&i.on("mouseenter",".tt-a, .deviation-full-data",this.handlers.ie8_hover_fix),this.base();var s=e("<div></div>");this._$paging_container.before(s),this.gmi_args.paging_mode===n&&(this._scroll_manager=new BrowseLikeThisScrollManager(s),e(this._scroll_manager).bind("top_page_changed",this._top_page_changed.bindTo(this)),e(this._scroll_manager).bind("needs_more",this._needs_more.bindTo(this)),e(this._scroll_manager).bind("pages_became_visible",this._pages_became_visible.bindTo(this))),PubSub.subscribe([{eventname:"BrowseLikeThisStream.next_page_loading",subscriber:this,callback:this.handlers.next_page_loading},{eventname:"BrowseLikeThisStream.cancel_pending_pages",subscriber:this,callback:this.handlers.cancel_pending},{eventname:"BrowseLikeThisStream.new_page_added",subscriber:this,callback:this.handlers.new_page_added},{eventname:"BrowseLikeThisStream.infinite_scroll_enabled",subscriber:this,callback:this.handlers.infinite_scroll_enabled},{eventname:"BrowseLikeThisStream.infinite_scroll_disabled",subscriber:this,callback:this.handlers.infinite_scroll_disabled},{eventname:"BrowseLikeThisStream.current_item_page_changed",subscriber:this,callback:this.handlers.current_item_page_changed},{eventname:"BrowseLikeThisStream.duperbrowse_stream_item_closed",subscriber:this,callback:this.handlers.duperbrowse_stream_item_closed},{eventname:"DuperBrowse.set_closing_location",subscriber:this,callback:this.handlers.duperbrowse_set_closing_location}])},_init_stream:function(){var t={number:Math.floor(this.gmi_args.query_params.offset/this.gmi_args.count_per_page)+1,portal_api:this.gmi_args.portal,query_params:this.gmi_args.query_params,results_dom:e("#browse-results-page-1 .page-results",this.gmi_node).html(),has_more:Boolean(this.gmi_args.more_to_load),has_less:Boolean(this.gmi_args.query_params.offset>0),max_offset:this.gmi_args.max_offset,result_type:this.gmi_args.paging_result_type,ad_settings:this.gmi_args.ad_settings,paging_mode:this.gmi_args.paging_mode},n=this._find_dom_nodes_in_container(e("#browse-results-page-1 .page-results")),r=[],i=this,s=t.query_params.offset;e.each(n,function(t,n){var o=e(n),u=o.attr("collect_rid"),a={stream_offset:s};u&&(u=u.split(":"),u[0]&&u[1]&&(a.type=u[0],a.itemid=u[1])),a.itemid&&o.hasClass("tt-fh")&&(DuperbrowseHelpers.init_thumb_data(a,o,"a.thumb, a.tt-fh-purchasable"),r.push(a),e("a.thumb, span.details a.t",o).on("click.duperbrowse",i._open_duperbrowse)),a.itemid&&o.hasClass("deviation-full-data")&&(DuperbrowseHelpers.init_thumb_data(a,o,"a.full-view-link"),r.push(a),$anchor=o.parent().next().find(".minipage-title a"),$anchor.on("click.duperbrowse",i._open_duperbrowse),o.find("> div.journal-wrapper.tt-a").length===0&&o.on("click.duperbrowse",i._open_duperbrowse));if(!a.itemid&&o.length>0){var f=o.find("div.journal-footer a.more"),l=o.find("div.journal-wrapper.tt-a");a.type=1,a.itemid=f.data("deviationid"),DuperbrowseHelpers.init_thumb_data(a,l,"div.journal-footer a.more"),r.push(a),l.on("click.duperbrowse",i._open_duperbrowse)}!a.itemid&&o.length===0&&console.log("[BrowseStreamView] Init found invalid stream item"),s++}),t.results_rids=r,PubSub.publish("BrowseLikeThisStream.init",t),this._init_ads()},_init_ads:function(){var e=Number(this.gmi_args.ad_settings.results_before_first||0),t=Number(this.gmi_args.count_per_page);e<t&&(this._results_since_last_ad=t-e)},_init_new_thumbs:function(t,n){var r=this;e.each(t,function(t,i){var s=n.find('> .tt-a[collect_rid="'+i.type+":"+i.itemid+'"]');if(s.length!==0){DuperbrowseHelpers.init_thumb_data(i,s,"a.thumb, a.tt-fh-purchasable"),e("a.thumb, span.details a.t",s).on("click.duperbrowse",r._open_duperbrowse);return}s=n.find('> .deviation-full-container .deviation-full-data[collect_rid="'+i.type+":"+i.itemid+'"]');if(s.length!==0){DuperbrowseHelpers.init_thumb_data(i,s,"a.full-view-link"),s.find("> div.journal-wrapper.tt-a").length===0&&s.on("click.duperbrowse",r._open_duperbrowse),$anchor.on("click.duperbrowse",r._open_duperbrowse);return}if(s.length===0){var o=n.find('> .tt-a .journal-footer a.more[data-deviationid="'+
i.itemid+'"]');if(o.length===0){console.log("[BrowseStreamView] RID Item not found in stream DOM",i);return}var u=o.closest("div.journal-wrapper.tt-a");DuperbrowseHelpers.init_thumb_data(i,u,"div.journal-footer a.more"),u.on("click.duperbrowse",r._open_duperbrowse)}})},_open_duperbrowse:function(n){var r=t.DuperbrowseHelpers.click_handler(n),i=["itemid","stream_offset","type"];if(r.open_duperbrowse){var s=e(this),o=s.closest(".tt-a").someData(i);return s.hasClass("deviation-full-data")&&(o=s.someData(i)),e.isEmptyObject(o)&&s.parent().hasClass("minipage-title")&&(o=s.closest(".deviation-full-minipage").prev().find(".deviation-full-data").someData(i)),e.isEmptyObject(o)?!0:(o.wait_for_load=r.wait_for_load,o.context=s.data("duper-context"),PubSub.publish("BrowseLikeThisStream.open_duperbrowse",o),!1)}return r.click_return},_load_more_click:function(e){return PubSub.publish("BrowseLikeThisStream.load_next",!1),PubSub.publish("BrowseLikeThisStream.infinite_scroll_enabled"),!1},_keydown_go_input:function(e){e.keyCode==13&&this._set_offset()},_set_offset:function(){var n=Math.max(parseInt(e(".paging-results-go-input:visible").val(),10)-1,0);t.location=BrowseLikeThisStream.get_blt_url_for_offset(n)},_change_paging_style:function(){var n=e(".thumb-limit-picker").data("offset");if(n)return t.location=e(this).attr("href")+"&offset="+n,!1},_show_reached_end:function(){e('<div class="browse-end">End of Results</div>').appendTo(this._$paging_container)},_hide_reached_end:function(){e(".browse-end").remove()},_needs_more:function(e){this._infinite_scroll_enable&&PubSub.publish("BrowseLikeThisStream.load_next",!0)},_top_page_changed:function(e,t){t||(t=1),PubSub.publish("BrowseLikeThisStream.set_first_visible_page",t)},_pages_became_visible:function(e,t){PubSub.publish("BrowseLikeThisStreamView.pages_visible",t)},_find_dom_nodes_in_container:function(e){return e.find("> .tt-a, > .deviation-full-container > .deviation-full-data").get()},domFindVisible:function(){var t={};if(!this.contents||!this.contents.length){t=this._find_dom_nodes_in_container(e(".page-results"));var n=e(".mlt-seed-container .tt-a");return n.length&&t.unshift(n.get(0)),t}for(var r in this.contents){if(!this.contents.hasOwnProperty(r))continue;this.contents[r][2]&&document.body.contains(this.contents[r][2])&&(t[r]=this.contents[r][2])}return t},_make_page:function(t){var n="results-page-"+t.query_params.view_mode;t.query_params.thumb_mode=="grid"&&(n+=" stream-fh-grid",vms_feature("responsive_grid")&&(n+=" stream-fh-grid-responsive responsive-full-width"));var i;return t.paging_mode===r?(i='<div class="browse-results-page" id="browse-results-page-'+t.id+'">',i+='<div class="page-results '+n+'">'+this._make_contents_html(t)+"</div>",i+="</div>",e(i)):(i='<div class="browse-results-page" id="browse-results-page-'+t.id+'">'+'<hr class="browse-divider browse-page-divider">'+'<div class="browse-page-header">'+'<div class="paging-results browse-link-button popup-trigger" data-name="paging-results-popup">'+t.result_type+' <div class="paging-results-count">'+(parseInt(t.query_params.offset,10)+1)+" - "+(parseInt(t.query_params.offset,10)+parseInt(t.query_params.length,10))+"</div>"+"</div>"+'<a href="javascript:void(0)" class="browse-top-link browse-proper-button"><span>&uarr;</span> Top</a>',t.id==2&&e(".thumb-limit-picker").length&&(i+='<div data-name="browse-paging-popup" data-type="paging-gear" data-offset="'+t.query_params.offset+'" class="thumb-limit-picker paging-dropdown-trigger popup-trigger"><span></span></div>'),i+='</div><div class="page-results '+n+'">'+this._make_contents_html(t)+"</div>"+"</div>",e(i))},_make_contents_html:function(t){if(t.state=="error")return this.templates.errors.generic;if(t.error_state>0){var n=this.templates.errors.states[t.error_state];return n.replace("@_MAX_OFFSET_@",this.gmi_args.max_offset)}if(!t.ad_settings.disabled&&t.results_dom.length){var r,i="browse-results-page-"+t.id;Number(t.ad_settings.results_between)==0?r=0:this._results_since_last_ad==null?r=Number(t.ad_settings.results_before_first)-Number(this.gmi_args.count_per_page):r=Number(t.ad_settings.results_between)-this._results_since_last_ad,r<t.results_dom.length?(t.advert_dom&&t.results_dom.splice(r,0,t.advert_dom),this._results_since_last_ad=t.results_dom.length-r-1):this._results_since_last_ad=(this._results_since_last_ad||0)+t.results_dom.length}return e.isArray(t.results_dom)?t.results_dom.join(""):t.results_dom},add_non_scroll_page:function(t,n){var r=parseInt(t.query_params.offset,10)+1,i=parseInt(t.query_params.offset,10)+parseInt(t.query_params.length,10),s=e(".browse-results-page"),o=e(".next a","div.browse-paging div.pagination"),u=e(".prev a","div.browse-paging div.pagination"),a=["th","st","nd","rd"],f,l=n.find('iframe[data-da-ad="1"]');l.length>0&&(this._$ad_container=l.parent(),this._ad_html=l.appendTo("<div>").parent().html(),l.remove()),s.replaceWith(n),e(".paging-results-count").text(r+" - "+i);if(r>1){f=r-parseInt(t.query_params.length,10)-1,u.removeClass("disabled").attr("href",this._replace_url_offset(this._initial_location.path,this._initial_location.query,f));var c=a[r%10>3?0:r%10];r%100>=11&&r%100<=13&&(c="th");var h='<span class="showing-page">Starting from '+r+"<sup>"+c+"</sup> result</span>"+'<span class="first-result-spacer"></span>'+'<a class="browse-back-to-first-result" href="http://browse.deviantart.com/"> Go to first result </a>';e("div.page-results").before(h)}else u.addClass("disabled").attr("href","");t.has_more?o.removeClass("disabled").attr("href",this._replace_url_offset(this._initial_location.path,this._initial_location.query,i)):o.addClass("disabled").attr("href","")},_replace_url_offset:function(t,n,r){var i="",s=Number(r);return s?n.offset=s:n.offset!==undefined&&delete n.offset,e.isEmptyObject(n)?t.replace(/\?[^?#]*/,""):(i="?"+e.param(n),t=t.replace(/\?.*/,""),t+i)},get_all_selectable_result_nodes:function(){return e.map(this.contents,function(e){return e[2]})},get_stream_node_from_clicked_node:function(
t){return e(t).closest(".tt-a, .deviation-full-data").get(0)},_override_loader_item_read:function(t){var n=e(t),r=n.hasClass("journal-wrapper")?n:n.find(".journal-wrapper:first");return r.length&&!r.find('[id="news-special"]').length?e(r.html()).find(".journal-footer").remove().end():OUTLINE_PreviewStream.loaderItemRead.apply(this,arguments)},_make_legacy_js_happy:function(t){var n=this._find_dom_nodes_in_container(t.find(".page-results"));for(var r=0;r<n.length;r++){var i=n[r],s=e(i);i&&i.getAttribute&&(i.getAttribute("collect_rid")||s.hasClass("journal-browse"))?this.contents.push(this.domReadOne(i)):(i=s.find("[collect_rid]").get(0),i&&i.getAttribute&&i.getAttribute("collect_rid")&&this.contents.push(this.domReadOne(i)))}},commsMakeCustomSurfer:function(t,n,r){var i=e(r);if(n[0]==1&&i.hasClass("deviation-full-data")&&i.find(".journal-wrapper").length){var s=i.find("h2:first").get(0),o=Surfer.create(t,s,undefined,undefined,!0,!0),u=e(o.node);return u.addClass("browse-title-surfer"),u.find("img").length<1&&u.addClass("lit-title-surfer"),o.mod_down={x:-(u.width()/2),y:-(u.height()/2)},o}return!1}})})(jQuery,window),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.stream.view.js")});

DWait.ready(["jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js","jms/lib/jquery/plugins/jquery.throttle-debounce.js","jms/pages/browselikethis/browselikethis.ads.js",".domready"],function(){(function(e){var t=null;PubSub.subscribe({eventname:"BrowseLikeThisAdPool.instance_loaded",subscriber:{},callback:function(e,n){t=n}});var n=Base.extend({$node:null,has_ad:!1,$ad_container:null,ad_height:0,ad_offset:null,page_id:null,height:0,offset:0,is_on_screen:!1,last_measured_at:null,constructor:function(n,r){this.page_id=n,this.$node=r;var i=this.$node.find('iframe[data-da-ad="1"]');if(i.length){this.has_ad=!0,this.$ad_container=i.parent(),this.ad_height=i.height();var s=e("<div>");i.appendTo(s),t&&t.stash_ad_html(s.html())}},measure:function(){if(!this.is_on_screen)throw new Error("Cannot measure page that is not visible");this.height=this.$node.outerHeight(),this.last_measured_at=(new Date).getTime(),this.has_ad&&(this.ad_offset=this.offset+this.$ad_container.offset().top-this.$node.offset().top)},render_ad:function(){t&&t.fill_ad_slot(this.page_id,this.$ad_container)},stash:function(){this.is_on_screen&&(this.$node.detach(),this.is_on_screen=!1)}}),r=!1;window.pause_scroll=function(){r=!0},window.resume_scroll=function(){r=!1},window.BrowseLikeThisScrollManager=Base.extend({_$node:null,_$top_buffer:null,_$bottom_buffer:null,_$w:null,_pages:[],_scroll_throttle:300,_resize_debounce:500,_advert_throttle:500,_remeasure_throttle:2e3,_viewport_height:null,_last_scroll_top:-1,_last_update_needed_more:!1,_first_visible_index:-1,_last_visible_index:-1,_current_top_page_idx:-1,_visible_pixels_threshold:700,_load_more_threshold:1500,constructor:function(t){this._$node=t,this._pages=[],this._$w=e(window),this._$top_buffer=e("<div></div>"),this._$bottom_buffer=e("<div></div>"),this._$node.prepend(this._$top_buffer),this._$node.append(this._$bottom_buffer),this._$w.on("scroll",e.throttle(this._scroll_throttle,this._on_scroll.bindTo(this))),this._throttled_render_ads=e.throttle(this._advert_throttle,this._render_ads.bindTo(this)),this._$w.on("scroll",this._throttled_render_ads),this._$w.on("resize",e.debounce(this._resize_debounce,this._on_resize.bindTo(this))),this._measure_viewport()},add_page:function(t,r){var i=new n(t,r),s=this._pages[this._pages.length-1];this._pages.push(i),r.insertBefore(this._$bottom_buffer),i.is_on_screen=!0,s&&(i.offset=s.offset+s.height),i.measure(),this._pages.length==1&&(this._first_visible_index=0,this._last_visible_index=0),s&&!s.is_on_screen?i.stash():(this._last_visible_index=this._pages.length-1,e(this).trigger("pages_became_visible",[i.$node]),this._throttled_render_ads())},_on_scroll:function(t){if(!this._pages.length||r)return;if(!this._$node.is(":visible"))return;var n,i,s,o=this._$node.offset().top,u=this._$w.scrollTop()-o;if(!t&&u==this._last_scroll_top)return;n=this._find_at_offset(u-this._visible_pixels_threshold,this._first_visible_index),i=this._find_at_offset(u+this._viewport_height+this._visible_pixels_threshold,this._last_visible_index),n<0&&(n=0),i<0&&(i=this._pages.length-1);if(n!==this._first_visible_index||i!==this._last_visible_index){this._$top_buffer.height(this._pages[n].offset);for(s=this._first_visible_index;s<=this._last_visible_index;s++)(s<n||s>i)&&this._pages[s].stash();var a=!0,f=[];for(s=n;s<=i;s++)this._pages[s].is_on_screen?a=!1:(a?this._$top_buffer.after(this._pages[s].$node):this._$bottom_buffer.before(this._pages[s].$node),this._pages[s].is_on_screen=!0,f.push(this._pages[s].$node));f.length&&e(this).trigger("pages_became_visible",f);var l=this._pages[this._pages.length-1],c=l.offset+l.height,h=this._pages[i],p=h.offset+h.height,d;this._remeasure_pages(n,i+1);if(h.offset+h.height!==p){p=d=h.offset+h.height;for(s=i+1;s<this._pages.length;s++)this._pages[s].offset=d,d+=this._pages[s].height}this._$bottom_buffer.height(c-p)}var v=this._find_at_offset(u,this._current_top_page_idx);v!==this._current_top_page_idx&&(e(this).trigger("top_page_changed",v<0?null:this._pages[v].page_id),this._current_top_page_idx=v),this._last_scroll_top=u,this._first_visible_index=n,this._last_visible_index=i,this._load_more_if_necessary(u)},_load_more_if_necessary:function(t){var n=this._pages[this._pages.length-1],r=t+this._viewport_height;r+this._load_more_threshold>n.offset+n.height&&e(this).trigger("needs_more")},_render_ads:function(){if(!this._pages.length||r||!this._$node.is(":visible"))return;var e=this._$w.scrollTop()-this._$node.offset().top,t=e+this._viewport_height;for(var n=0;n<this._pages.length;++n)if(this._pages[n].has_ad&&this._pages[n].is_on_screen){var i=this._pages[n].ad_offset-50,s=i+this._pages[n].ad_height+100;(i>=e&&i<=t||e>=i&&e<=s)&&this._pages[n].render_ad()}},_on_resize:function(){this._measure_viewport();var e,n=3;for(e=0;e<this._pages.length;e+=n)this._remeasure_pages(e,Math.min(e+n,this._pages.length));this._on_scroll(!0),t&&t.scroll_manager_is_done_resizing(),this._throttled_render_ads()},_remeasure_pages:function(e,t){var n,r,i=[],s=this._pages[e-1]||null,o=s?s.offset+s.height:0,u=(new Date).getTime();for(n=e;n<t;n++)r=this._pages[n],r.is_on_screen||(i.push(r),r.$node.insertBefore(this._$bottom_buffer),r.is_on_screen=!0);for(n=e;n<t;n++)r=this._pages[n],r.last_measured_at+this._remeasure_throttle<u&&r.measure(),r.offset=o,o+=r.height;for(n=0;n<i.length;n++)i[n].stash()},_measure_viewport:function(){this._viewport_height=window.innerHeight?window.innerHeight:this._$w.height()},_find_at_offset:function(e,t){var n=Math.max(t,0),r=this._pages[n];if(r.offset>e){do n--,r=this._pages[n];while(n>=0&&r&&r.offset>e);return n}if(r.offset+r.height<e){do n++,r=this._pages[n];while(n<this._pages.length&&r&&r.offset+r.height<e);return n<this._pages.length?n:-1}return n}})})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.stream.scroll_manager.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js",".domready"],function(){(function(e){function t(e){var t=e.data("toggle_text");e.data("toggle_text",e.text()).text(t)}e(".browse-facet-toggle-hidden").on("click",function(){var n=e(this),r=n.data("toggle_text"),i=n.data("more_increment")||9999,s=n.closest(".browse-facet").find(".facet-link-hidden"),o=s.not(":visible").length==0;o?(s.hide(),t(n)):(s.not(":visible").slice(0,i).show(),s.not(":visible").length==0&&(r&&r.length?t(n):n.remove()))})})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.left_bar.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/lib/popup2.js","jms/lib/browser.js",".domready"],function(){(function(e){e(".browse-top-bar-mc-filter").on("click",function(){var t=e(this);e(".mature-filter-popup-container").hide();if(!deviantART.deviant.loggedIn)return window.location="https://www.deviantart.com/join/?from=mature",!1;var n=Number(t.data("value"))?1:0;DiFi.pushPost("Settings","updateMatureFilter",[n],function(e,n){e?window.location.reload():(t.removeClass("working disabled"),alert("Sorry there was an error while changing your settings.\n\nYou must be 18 or over to turn off mature filter.\n\nIf you are, please try again in a minute."))}),t.addClass("working").addClass("disabled"),DiFi.send()});var t=!1;e(".browse-top-bar-mc-filter-trigger").on("mousedown",function(){if(t&&t.visible())return!1}),e(".browse-top-bar-mc-filter-trigger").on("click",function(){var n=e(this);return t||(t=new Popup2("BrowseMaturePopup","body",{classes:"browse-mature-popup",content:e(".mature-filter-popup-container").clone(!0).show(),hidden:function(){n.removeClass("popupactive")},shown:function(){n.addClass("popupactive")}})),t.visible()?t.hide():t.show(t.position(n.parent(),{align:"center"})),!1}),window.BrowseLikeThisSearchBox=GMIBase.extend({_$input:null,_$term:null,_$button:null,_initial_val:"",_initially_disabled:!1,gmiConstructor:function(){this.$.removeClass("dwait"),this._init_terms(),this._init_input(),e(".browse-top-bar .browse-search-container").click(this._search_container_click.bindTo(this)),e(".browse-top-bar .search-clear").click(this._clear_search_box.bindTo(this)),e(".browse-top-bar .browse-search-input").blur(this._input_blur.bindTo(this))},_init_terms:function(){this._$term=this.$.find(".search-term-container")},_init_input:function(){this._$input=this.$.find(".browse-search-input"),this._$button=this.$.find(".browse-search-button"),this._initial_val=this._$input.val(),this._initially_disabled=this.$.hasClass("disabled"),this._$input.on("keydown",this._input_keydown.bindTo(this)),this._$input.on("keyup",this._input_keyup.bindTo(this));var t=e(document.activeElement);!window.location.hash&&!this._initially_disabled&&!Browser.isTouch&&!t.is(this._$input)&&!t.is(":input")?this._make_editable(!0):this._input_blur()},_clear_search_box:function(){return this._make_editable(!1),!1},_search_container_click:function(){return this._$input.is(":focus")||this._make_editable(!0),!1},_make_editable:function(e){this._$term.hide(),this.$.removeClass("disabled"),this._$button.attr("disabled",!1),this._$input.attr("disabled",!1).removeClass("disabled").show(),Browser.isFirefox?this._$input.css("position","fixed").focus().css("position","static"):this._$input.focus(),this._$input.select(),e||this._$input.val(""),this._$input.val()==""&&this.$.find(".search-box-clear").hide()},_input_blur:function(){var e=this._$input.val();e==this._initial_val&&(this._$input.hide(),this._$term.show(),this._$input.val(this._initial_val),this._initially_disabled?(this.$.addClass("disabled"),this._$input.attr("disabled",!0),this._$button.attr("disabled",!0),this.$.find(".search-box-clear").hide()):this.$.find(".search-box-clear").show())},_input_keydown:function(e){e.keyCode in{40:0,32:0,34:0,35:0}&&this._$input.val()==""&&this._$input.blur()},_input_keyup:function(){this.$.find(".search-box-clear").toggle(this._$input.val()!=="")}}),e(function(){e(":gmi(BrowseLikeThisSearchBox)").gmi()})})(jQuery),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.top_bar.js")});

DWait.ready(["jms/lib/jquery/jquery.current.js","jms/pages/duperbrowse/stream/base.custom.stream.js"],function(){(function(e){var t=window.DuperbrowseBaseCustomStream.extend({init_stream:function(){var t=e(".pcp-side-bar .pcp-thumb"),n=this;t.each(function(t,r){var i=e(r),s=i.find(".tt-aa").attr("collect_rid").split(":")[1],o={itemid:s,stream_offset:t};DuperbrowseHelpers.init_thumb_data(o,i,"a.thumb, a.tt-fh-purchasable"),n._items[t]=o,i.find("a").on("click",n._open_duperbrowse.bindTo(n))})},_get_item_data_from_clicked_element:function(e){var t=e.closest(".pcp-thumb").someData("itemid","stream_offset");return console.log("Item data is: ",t),t}});DWait.ready([".domready","jms/pages/duperbrowse/stream/base.custom.stream.js"],function(){new t})})(jQuery,window),window.DWait&&DWait.run("jms/pages/browselikethis/browselikethis.pcpstream.js")});
if(window.DWait){DWait.count()}