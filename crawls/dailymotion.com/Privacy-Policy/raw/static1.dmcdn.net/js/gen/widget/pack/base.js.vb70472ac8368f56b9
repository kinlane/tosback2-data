var EventSelectors={start:function(b){this.rules=b||{};this.assign(this.rules)},assign:function(b){$H(b).each(function(a){$$(a[0]).collect(a[1])})}};var Keyboard={TAB:9,BACKSPACE:8,ENTER:13,SHIFT:16,CONTROL:17,ESCAPE:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,COMMAND:91,SEMICOLON:59,COMA:188,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,is_an_input_modifier_key:function(b){return[Keyboard.ENTER,Keyboard.SHIFT,Keyboard.CONTROL,Keyboard.ESCAPE,Keyboard.SPACE,Keyboard.ARROW_LEFT,Keyboard.ARROW_UP,Keyboard.ARROW_RIGHT,Keyboard.ARROW_DOWN,Keyboard.COMMAND,Keyboard.TAB].indexOf(b)===-1}};var DM_Widget_Page={initEvents:function(){$j("span.linkable").each(function(){DM_Widget_Page.makeLinkable(this)})},makeLinkable:function(i){var m=$j(i);if(typeof i.outerHTML!="undefined"){var l=i.outerHTML;l=l.replace(/<span/i,"<a").replace(/<\/span>$/i,"</a>");if(m.hasClass("ajax_link")){l=l.replace("<a",'<a onclick="DM_Ajax.link(this); return false;"')}var r=document.createElement("div");r.innerHTML=l;n=$j(r.firstChild);var q=n.data("href");if(q){n.attr("href",q)}}else{var n=$j("<a>").html(i.innerHTML);for(var o=0;o<i.attributes.length;o++){var k=i.attributes[o].value,s=i.attributes[o].name;if(s=="data-href"){s="href"}n.attr(s,k)}if(m.hasClass("ajax_link")){n.attr("onclick","DM_Ajax.link(this); return false;")}}m.replaceWith(n)},notify:function(){var b=arguments;DM_JS.get("DM_Notify",function(){DM_Notify.notify.apply(DM_Notify,Array.prototype.slice.call(b))})},openLoginPopupForAction:function(b){DM_JS.get("DM_Widget_Popup",function(){var a=DM_Widget_Popup.getInstanceOrNew();a.loadPageItem("/pageitem/loginfull?restricted=1",document.location.pathname,{unlogged_action:b||""},function(){$j("#popupContent input[data-focus]").focus()})})},continuePendingActions:function(){var c;if(c=getCookie("dm_done")){deleteCookie("dm_done");window["DM_Widget_Page_"+c]&&DM_Widget_Page.notify(window["DM_Widget_Page_"+c],"info")}else{if(c=getCookie("dm_need")){deleteCookie("dm_need");var d=c.split(":");if(d.length>1&&d[0]=="popup"){DM_JS.get("DM_Widget_Popup",function(){var a=DM_Widget_Popup.getInstanceOrNew();a.loadPageItem(hex2str(d[1]),document.location.pathname)})}}}},initialize:function(){$j(function(){setCookie("timezoneOffset",new Date().getTimezoneOffset()*60,1);if(window.DM_WrongUserEmail){$j("#topwrapper").prepend(window.DM_WrongUserEmail)}DM_Widget_Page.continuePendingActions();DM_Widget_Page.initEvents()})}};DM_Widget_Page.initialize();var DM_Form_Inputs={inputs:{},getInstance:function(e,g){var h=e.getFormName(),f=$j(g).children(".dmco_form_input")[0].id;if(!DM_Form_Inputs.inputs[h]){DM_Form_Inputs.inputs[h]={}}if(!DM_Form_Inputs.inputs[h][f]){DM_Form_Inputs.inputs[h][f]=new DM_Form_Input(e,g)}return DM_Form_Inputs.inputs[h][f]},reset:function(d){var c=d.getFormName();if(!DM_Form_Inputs.inputs[c]){return}delete (DM_Form_Inputs.inputs[c])},getInstanceByFieldName:function(c,d){return DM_Form_Inputs.getInstance(c,c.getInputByName(d))}};(function(){var DM_Form_Input=function(dm_form,metaInput){this.observers=[];this.dm_form=dm_form;this._metaInputElement=metaInput;this.observedInputs={};this.changeObserved=false;this.$inputs=null;this.partialCheck=false;this.populateInputs();if($j(metaInput).findParamInClass("rule_visible")){this.initVisibility()}if(dm_form.liveCheck){this.liveCheckInit()}};DM_Form_Input.prototype={notify:function(msg){var that=this;$j.each(this.observers,function(){this.update(that,msg)})},register:function(observer){this.observers.push(observer)},liveCheckInit:function(){var that=this;this.$inputs.each(function(){var input=this,$input=$j(this);$input.on("blur",function(){$input.val($j.trim($input.val()));if(!/^\s*$/.test($input.val())){DM_Widget_Form.focus_id=null;that.validate()}});$input.on("focus",function(){DM_Widget_Form.focus_id=input.id});if(/rule_ajaxchecker/.test(input.className)){var timeoutKey=input.id+"_checktimeout",checker=function(){DM_Form_Validator.ajaxchecker(that)};$input.on("keyup",function(ev){ev=ev||window.event;var keyCode=ev.keyCode?ev.keyCode:ev.which;if(Keyboard.is_an_input_modifier_key(keyCode)){DM_Widget_Form[timeoutKey]&&clearTimeout(DM_Widget_Form[timeoutKey]);DM_Widget_Form[timeoutKey]=setTimeout(checker,$input.findParamInClass("interval")||500)}});$input.on("paste",function(){DM_Widget_Form[timeoutKey]=setTimeout(checker,100)})}})},populateInputs:function(){this.$inputs=$j(this._metaInputElement).find("input, select, textarea")},initVisibility:function(){var $_metaInputElement=$j(this._metaInputElement),param=$_metaInputElement.findParamsInClass("rule_visible");try{var regexp=/(.*)\-(.*)/;for(var i=0;i<param.length;i++){var values=value=mymatch=mymatch2=null;var mymatch=regexp.exec(param[i]);if(mymatch){var fieldname=mymatch[1],fieldnames=fieldname.split("?");if(fieldnames.length>1&&!$_metaInputElement.hasClassName("visible_and")){this.partialCheck=true}var value=mymatch[2],mymatch2=value.split("?");if(mymatch2){for(var j=0;j<fieldnames.length;j++){if(fieldnames[j]==this.name){var inputToCheck=this}else{var inputToCheck=DM_Form_Inputs.getInstanceByFieldName(this.dm_form,fieldnames[j])}var inputToCheckName=inputToCheck.getName();this.observedInputs[inputToCheckName]={};this.observedInputs[inputToCheckName].values=mymatch2;this.observedInputs[inputToCheckName].visible=false;inputToCheck.observeChange();inputToCheck.register(this);inputToCheck.notify()}}}}}catch(e){}return false},observeChange:function(){if(!this.changeObserved){var that=this;this.$inputs.each(function(){var $this=$j(this);if($this.attr("type").match(/radio|checkbox/)){$this.on("click",function(){that.notify()})}else{$this.on("change",function(){that.notify()})}});this.changeObserved=true}},update:function(observedInput,msg){var visible=true,values=observedInput.getValue(),that=this;this.observedInputs[observedInput.getName()].visible=false;$j.each(values,function(){if(that.observedInputs[observedInput.getName()].values.indexOf(this+"")>=0){that.observedInputs[observedInput.getName()].visible=true}});if(this.partialCheck){visible=false;$j.each(this.observedInputs,function(){visible=visible||this.visible})}else{$j.each(this.observedInputs,function(){visible=visible&&this.visible})}var container=this.getContainer();if(visible){this.visible=true;if(container){container.show()}}else{this.visible=false;if(container){container.hide()}}return},getContainer:function(){var realInput=this.getRealInput(),$realInput=$j(realInput);return((realInput&&$j("#"+realInput.id+"_cont")[0])||(realInput&&$realInput.closest(".form_item")[0])||realInput)},validate:function(){var that=this,result=true,hintResult=true,input=this.$inputs.filter(function(){return $j(this).hasClass("check")})[0]||this.$inputs.get(-1);if($j(input).hasClass("auto_complete")){input=this.$inputs[0]}var rules=$j.grep(input.className.split(" "),function(className){return className.match(/^rule_/)}),hints=$j.grep(input.className.split(" "),function(className){return className.match(/^hint_/)}),visibilityRule=$j.grep(rules,function(className){return className.startsWith("rule_visible")}).length,visible=true;if(visibilityRule){visible=this.visible}if(visible){$j.each(rules,function(){if(result!=true){return}var error=true;try{var fullRule=this.replace("rule_",""),ruleName=fullRule,ruleParams="",pos;if((pos=fullRule.indexOf("-"))>-1){ruleName=fullRule.slice(0,pos);ruleParams=fullRule.slice(pos+1);if(!ruleName.match(/^visible/)){result=eval("DM_Form_Validator."+ruleName)(that.getFilteredValue(),ruleParams);if(!result&&fullRule.match(/^enume/)){error=false}}}else{result=fullRule.match(/^altmultichoice/)?DM_Form_Validator.altmultichoice(that.getRealInput()):result=eval("DM_Form_Validator."+ruleName)(that.getFilteredValue())}}catch(e){}if(!result&&DM_Form_Validator[that.getFormName()]){if(error){var msgHashId=str2hex(ruleName);if(ruleParams&&["character","regex","ajaxchecker"].indexOf(ruleName)!=-1){msgHashId=ruleParams}try{var realInput=that.getRealInput(),$realInput=$j(realInput);if($realInput.hasClass("auto_complete")||$realInput.hasClass("dmco_form_olddate_select")){realInput=that.inputs[0]}DM_Widget_Form.removeInputMsgs(realInput,"info","for_ajaxchecker");that.displayError(DM_Form_Validator[that.getFormName()][realInput.name.replace(/\[.*\]/,"")][ruleName][msgHashId],msgHashId)}catch(e){}}}else{try{DM_Widget_Form.removeInputMsgs(that.getRealInput(),"error",msgHashId)}catch(e){}}})}return result},getFormName:function(){return this.dm_form.getFormName()},getName:function(){return this.getRealInput().name},getValue:function(){var length=this.$inputs.length,result=[];if(this.$inputs[0].type.match(/radio|checkbox/)){this.$inputs.each(function(){if(this.checked){result.push(this.value)}})}else{if(length==1){if(this.$inputs[0].type.match(/radio|checkbox/)){if(this.$inputs[0].checked){result.push(this.$inputs[0].value)}}else{if(this.$inputs[0].tagName.toLowerCase().match(/input|textarea/)){result.push(this.$inputs[0].value)}else{if(this.$inputs[0].tagName.toLowerCase()=="select"){result.push(this.$inputs[0].options[this.$inputs[0].selectedIndex].value)}}}}else{var realInput=this.getRealInput(),$realInput=$j(realInput);if($realInput.hasClass("auto_complete")||$realInput.hasClass("dmco_form_olddate_select")){realInput=this.$inputs[0]}result.push(realInput.value)}}return result},reset:function(){delete (this.value);this.filteredValue=[]},getFilteredValue:function(){var filteredValue=[],filters=$j.grep(this.getRealInput().className.split(" "),function(className){return className.match(/^filter_/)}),values=this.getValue();$j.each(values,function(){var value=this;$j.each(filters,function(index,filter){filter=filter.replace("filter_","");try{value=eval("DM_Form_Filter."+filter)(value.replace("'","'"))}catch(e){}});filteredValue.push(value)});return filteredValue},getRealInput:function(){return this.$inputs.get(-1)},getInputs:function(){return this.$inputs},displayError:function(message,classMatch){var input=this.getRealInput(),realInput=$j(input).next("span.dmco_form_input_info")[0];if(realInput){input=realInput}var $input=$j(input),$cont=$j(input).closest(".form_input");if($input.hasClass("auto_complete")){DM_Widget_PageItem_AutoComplete.storeValues()}if($cont[0]){if($input.hasClass("edit_in_place")){DM_Widget_Page.notify(message,"error")}else{var msgDisplayed=false;classMatch=classMatch?"msg_"+classMatch:classMatch;if(classMatch){$cont.find("div.error_msg").each(function(){var $el=$j(this);if($el.hasClass(classMatch)){$el.html(message);msgDisplayed=true;return false}})}if(!msgDisplayed){$cont.addClass("has_error").append($j('<div class="error_msg '+(classMatch||"")+'">').html(message))}}if($input.hasClass("auto_complete")){DM_Widget_PageItem_AutoComplete.setup(true)}}},displayInfo:function(message,classMatch){var input=this.getRealInput(),realInput=$j(input).next("span.dmco_form_input_info")[0];if(realInput){input=realInput}var $input=$j(input),$cont=$input.closest(".form_input");if($cont[0]){var msgDisplayed=false;classMatch=classMatch?"msg_"+classMatch:classMatch;if(classMatch){$cont.find("div.info_msg").each(function(){var $el=$j(el);if($el.hasClass(classMatch)){$el.html(message);msgDisplayed=true;return false}})}if(!msgDisplayed){$cont.append($j('<div class="info_msg '+(classMatch||"")+'">').html(message))}}}};window.DM_Form_Input=DM_Form_Input})();(function(){var b=function(f){this.form=f;var h=$j(f),g=this,a=h.find('input[name="form_name"]')[0];this.formName=a?a.value:"none";if(h.hasClass("live_check")){this.liveCheck=true}this.fieldsToCheck=[];this.fields=[];h.find(".form_input").each(function(){g.fields.push($j(this).closest(".form_item")[0])});if(this.fields.length){h.on("submit",$j.proxy(this.validate,this)).find(".form_input.check").each(function(){g.fieldsToCheck.push(DM_Form_Inputs.getInstance(g,this))})}};b.prototype={validate:function(k){var j=true,a=$j(this.form);try{$j.each(this.fieldsToCheck,function(){this.reset();j=this.validate()&&j})}catch(e){}if(!j){k.preventDefault();$noticeBox=$j("#notice_box");var l=this.getFormName();if($noticeBox[0]&&DM_Form_Validator[l]&&DM_Form_Validator[l]["error_msg"]){var i=$j('<div class="dmpi_notice dmpi_notice_error">').hide();i.html('<div class="notice_message"><div class="dmco_text">'+DM_Form_Validator[l]["error_msg"]+"</div></div>");$noticeBox.html(i);i.show("fast")}}else{try{if(!a.hasClass("persistent")){DM_Widget_Form.removeForm(this.form)}if(a.data("alreadyObserved")){k.preventDefault();if(!a.hasClass("no_submit")&&!this.form.cancelImmediateSubmit){DM_Ajax.submitForm(this.form)}this.form.cancelImmediateSubmit=false}else{return true}}catch(e){}}k.preventDefault();return false},getFormName:function(){return this.formName},getInputByName:function(d){var a=$j.grep(this.fields,function(c){var f=$j(c).find("#"+d)[0];if(f){return true}return false});return a[0]&&$j(a[0]).find(".form_input")[0]}};window.DM_Form=b})();var DM_Form_Filter={striptags:function(b){return $j.map(b,function(a){if($j.isString(a)){return $j.stripTags(a)}})}};var DM_Form_Validator={error_msg:[],required:function(d){if(d.length>0){var c=$j.map(d,function(a){if(!/^\s*$/.test(unescape(a))){return a}});if(c.length>0){return true}}return false},altmultichoice:function(e){var d=[],f=$j(e);f.find("option").each(function(){d.push(unescape($j(this).val()))});f.val(d);return true},compare:function(d,f){var e=f&&$j("#"+f);if(!e[0]){return false}d=unescape(d);if(d!==e.val()){return false}return true},emailaddress:function(b){return/^([^@]+)@([^@\.]+\.[^@]+)$/.test(unescape(b))},stringlength:function(e,f){if(e.length>0){var d=$j.map(e,function(b){b=unescape(b);var h=true;f=f.split("-");if(b){for(var c=0;c<f.length;c++){var a=f[c].split(":");if(a[0]=="max"){h=(b.length<=parseInt(a[1]))&&h}else{if(a[0]=="min"){h=(b.length>=parseInt(a[1]))&&h}else{if(a[0]=="equal"){h=(b.length==parseInt(a[1]))&&h}else{}}}}}return h});if(d.length>0){return true}}return false},character:function(d,f){d=$j.trim(unescape(d));if(!/^\s*$/.test(d)&&!/^\s*$/.test(f)){f=hex2str(f).split("::");var e="^["+f[1]+"]+$";if(f[0]=="refuse"){e="^[^"+f[1]+"]+$"}return d.match(e)}return true},regex:function(d,f){d=$j.trim(unescape(d));if(!/^\s*$/.test(d)&&!/^\s*$/.test(f)){f=hex2str(f).slice(1,-1);var e=new RegExp(f);return e.test(d)}return true},ajaxchecker:function(dm_form_input){if(!(dm_form_input instanceof DM_Form_Input)){return true}var input=dm_form_input.getRealInput(),ruleParamsMatches=input.className.match(/rule_ajaxchecker-([a-f0-9]+)/),ruleParams=ruleParamsMatches?ruleParamsMatches[1]:"",optionsProviderString=hex2str(ruleParams),options=eval(optionsProviderString),defaultOptions={url:null,pre_validate:function(){return true}};options=$j.extend(defaultOptions,$j.isString(options)?{}:options);if(options.url&&options.pre_validate(input.id)&&dm_form_input.validate()){if(options.url.match(/^\/ajax\//)){ajax_call(options.url.replace(/\/ajax\//,""),"check_input",input.id,$j(input).val(),function(res){var jsonRes=$j.parseJSON(res);if(jsonRes.valid){if(jsonRes.msg){DM_Widget_Form.removeInputMsgs(input,"error");DM_Widget_Form.removeInputMsgs(input,"error","for_ajaxchecker");dm_form_input.displayInfo.call(dm_form_input,jsonRes.msg,"for_ajaxchecker")}}else{var msg=jsonRes.msg||DM_Form_Validator[dm_form_input.getFormName()][input.name.sub(/\[.*\]/,"")]["ajaxchecker"][ruleParams];if(msg){DM_Widget_Form.removeInputMsgs(input,"info","for_ajaxchecker");dm_form_input.displayError.call(dm_form_input,msg,"for_ajaxchecker")}}})}else{}}else{DM_Widget_Form.removeInputMsgs(input,"info","for_ajaxchecker");DM_Widget_Form.removeInputMsgs(input,"error","for_ajaxchecker");if(DM_Widget_Form.focus_id==input.id&&!options.pre_validate(input.id)){DM_Widget_Form.removeInputMsgs(input,"error")}}return true}};var DM_Widget_Form={forms:$H(),initEvents:function(){$j("form.dmco_form").each(function(){var f=$j(this),g=f.find('input[name="form_name"]')[0],e=g?g.value:null;if(f.data("initdone")){return}f.data("initdone",true);if(e){if(!DM_Widget_Form.forms[e]){DM_Widget_Form.forms[e]=new DM_Form(this)}}if(f.hasClass("ajax")){DM_Ajax.addAjaxForm(this)}if(f.hasClass("form_with_confirm")){f.on("submit",function(){return DM_Form[e]&&confirm(DM_Form[e]["confirm"])})}f.find(".link_to_post a").on("click",function(a){a.preventDefault();f.submit()});f.find("textarea.counter, input.counter").each(function(){var b=$j(this);if(!b.next().hasClass("dmco_form_input_info")){var a=b.findParamInClass("count"),c=function(d){return d+"/"+a+" "+DM_Form.charactersUsedLabel};b.after($j('<span class="dmco_form_input_info">')).next().html(c(this.value.length)).on("keyup",function(){var j=$j(this),d=j.next();if(this.value.length>a){d.addClass("error_msg")}else{d.removeClass("error_msg")}d.html(c(this.value.length))})}});var h="placeholder" in document.createElement("input");if(!h){f.find("input[placeholder]").each(function(){var b=$j(this);hint=b.attr("placeholder");if(hint&&!b.prev("span.input_hint")[0]){b.before('<span onclick="$j(this).next().focus();" class="input_hint">'+hint+"</span>");var d=b.prev(),a=function(){if(this.value===""){d.show().removeClass("has_focus")}else{d.hide()}},c=function(){setTimeout(function(){if(this.value!==""){d.hide()}else{d.show()}},50)};b.on("focus",function(){d.addClass("has_focus");if(this.value){d.hide()}}).on("blur",a).on("paste",c).on("keydown",c).on("input",c);if(["username","password"].indexOf(this.name)!=-1){setTimeout(function(){arguments.callee.tries=arguments.callee.tries||0;if(b.val()===""){if(arguments.callee.tries++<30){return setTimeout(arguments.callee,50)}}else{a()}},20)}a()}})}f.find("input[data-focus]").first().focus();f.find("a#cantread").each(function(){$j(this).on("click",function(){$j("#captcha_image").replace('<div id="captcha_image" style="background-image:url(/dmcaptcha?rand='+new Date().getTime()+');"></div>')})});f.find("input.switcher").each(function(){var a=$j(this);a.on("click",function(){a.next().val(a.next().val()=="show"?"hide":"show");DM_Form_Inputs.getInstance(DM_Widget_Form.forms[e],a.parent().parent()[0]).notify()})});f.find("input.altmultichoice_action").on("click",function(){var b=$j(this),d=b.findParamInClass("actionType"),c=hex2str(b.findParamInClass("actionTarget")),a=null,j=null;switch(d){case"add":var a=$j("#src_"+c),j=$j("#dst_"+c);break;case"remove":var a=$j("#dst_"+c),j=$j("#src_"+c);break}if(a[0]&&a.find("option")[0]&&a.val().length){a.val().each(function(i){j.prepend(a.find('option[value="'+i+'"]').first().remove())})}});f.find("div.dmco_form_olddate select").each(function(){var a=$j(this),b=a.parent(),l=b.find("select.year"),d=b.find("select.month"),k=b.find("select.day"),c=function(){if(l.val()!=0&&d.val()!=0&&k.val()!=0){var i=new Date();i.setFullYear(parseInt(l.val()),parseInt(d.val()-1),parseInt(k.val()));a.next('input[type="hidden"]').val(i.toDBFormattedString())}else{a.next('input[type="hidden"]').val("")}};c();a.on("change",c)});f.find("input.dmco_form_submit").on("click",function(){$j(this).closest("form").find("div.ss_msg").each(function(){var b=$j(this),a=b.closest("div.form_input");a&&a.removeClass("has_error");b.remove()})})})},removeInputMsgs:function(d,f,e){e=e&&!e.match(/^msg_/)?"msg_"+e:e;$j(d.nodeName.toUpperCase()=="FORM"?d:d.parentNode).find("div."+f+"_msg").each(function(){var a=$j(this);if((!e&&!a.hasClass("msg_for_ajaxchecker"))||(e&&a.hasClass(e))){if(f=="error"){a.closest("div.form_input").removeClass("has_error")}a.remove()}})},removeFormByName:function(e){var f=DM_Widget_Form.forms[e];if(!f){return}var d=f.form;$j(d).off();DM_Form_Inputs.reset(f);delete (DM_Widget_Form.forms[e])},removeForm:function(f){var d=$j(f),e=d.find('input[name="form_name"]')[0];DM_Widget_Form.removeFormByName(e.value)},initialize:function(){$j(DM_Widget_Form.initEvents)}};DM_Widget_Form.initialize();var DM_Context=function(){this.timeout=1800;this.maxsize=3000;this.list=this.getList();if(this.expire()){this.save()}$j($j.proxy(this.apply,this))};DM_Context.prototype={apply:function(b){this.initEvents(b)},initEvents:function(g){var e="a[data-context]",f=$j.isString(g)?g+" "+e:e,h=this;$j(f).each(function(){if(this.dm_context_observed){return}this.dm_context_observed=true;$j(this).on("click",$j.proxy(h.put,h,this.href.split("#")[0],this.getAttribute("data-context")))})},getList:function(){var d={},e=getCookie("dm_context");try{if(e){d=$j.parseJSON(unescape(e))}if($j.isArray(d)){d={}}}catch(f){}return d},put:function(c,d){this.list[this.sign(c)]={c:d,t:this.timestamp()};this.reduce();this.save()},save:function(){setCookie("dm_context",this.serialize())},serialize:function(){return escape($j.toJSONString(this.list))},expire:function(){var d=false;for(key in this.list){if(this.list.hasOwnProperty(key)){var c=this.list[key].t;if(!$j.isNumeric(c)||this.timestamp()>(c+this.timeout)){delete (this.list[key]);d=true}}}return d},timestamp:function(){return Math.round(new Date().getTime()/1000)},reduce:function(){while(this.serialize().length>this.maxsize){var b=null;for(key in this.list){if(this.list.hasOwnProperty(key)){if(b==null||this.list[key].t<this.list[b].t){b=key}}}if(!b){break}delete (this.list[b])}},sign:function(b){return this.crc32(b.replace(/[^a-zA-Z0-9_]+/g,""))},crc32:function(k,m){var n="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";if(m==window.undefined){m=0}var j=0,i=0;m=m^(-1);for(var h=0,l=k.length;h<l;h++){j=(m^k.charCodeAt(h))&255;i="0x"+n.substr(j*9,8);m=(m>>>8)^i}return m^(-1)}};var dm_context=new DM_Context();var Sd_Header={canFocusSearch:true,initEvents:function(){$j("#header_search").submit(Sd_Header.onSearchSubmit);$j("#close_super_header").click(Sd_Header.onCloseSuperHeaderClick)},onSearchSubmit:function(){var h=$j("#input_search");var i=new RegExp("^(\\s|\\.)*$","g");if(h.length){if(i.test(h.val())){}else{var g="/relevance/search/"+encodeURIComponent(Request.cleanSearch(h.val()))+"/1";var j=$j("#search_hitmap");g+=j.length?j.val():"";try{if(window.external.msIsSiteMode()){g_ext=window.external;g_ext.msSiteModeCreateJumpList(DM_JumplistSearchLabel);g_ext.msSiteModeAddJumpListItem(h.val(),g,"/images/icons/magnifier.ico","self");g_ext.msSiteModeShowJumplist()}}catch(f){}document.location.href=g}}return false},onCloseSuperHeaderClick:function(){setCookie("hideSuperHeader",1,7);$j("#metaheader_style").remove();$j("#top_header_announcement").slideUp("fast");PubSub.publish("dm:close_super_header")},searchFieldFocusOnLoad:function(){Sd_Header.focusSearchField();if(typeof Sd_Header_search!="undefined"){$j("#input_search").val(Sd_Header_search)}},lockFocus:function(){Sd_Header.canFocusSearch=false},unlockFocus:function(){Sd_Header.canFocusSearch=true},focusSearchField:function(){if(window.page_has_intersticial||!Sd_Header.canFocusSearch){return}if($$("body.lt_homefeed, body.lt_homemedia").size()){$j("#input_search").focus()}},webappRedirect:function(){this.displayName="webappRedirect";var k="use_mobile_version",j="yes",i=3650,g=new Date(),h=g.setDate(g.getDate()+i),l={domain:".dailymotion.com",path:"/",expires:new Date(h)};document.cookie=k+"="+j+(l.expires?"; expires="+l.expires.toUTCString():"")+(l.path?"; path="+l.path:"")+(l.domain?"; domain="+l.domain:"")+(l.secure?"; secure":"");document.location.reload(true)},hideConnectLinkAndFB:function(){if($j(document.body).hasClass("dm_page_html_login")){$j("#login_info").children().eq(0).remove();$j("#login_infos").remove()}},hideAllAfterRegister:function(){$j("#popupContent div.register_form_box").css("width","auto");$j("#popupContent div.register_right_box, #popupContent div.box_sep").hide();$j("form.dmpi_registerform").removeClass("dmpi_registerform")},hideAllAfterLogin:function(){if($j("div.dmpi_loginfull").length){$j("div.dmpi_loginfull").css("width","auto");$j(".fb_signin_cont, #popup_title, #popupContent div.box_sep").hide();$j(".login_form").removeClass("dmpi_login")}},initialize:function(){this.webappRedirect.displayName="webappRedirect";PubSub.subscribe("masscast:intersticial_opened",Sd_Header.lockFocus);PubSub.subscribe("masscast:intersticial_closed",function(){Sd_Header.unlockFocus();Sd_Header.focusSearchField()});$j(function(){Sd_Header.initEvents();Sd_Header.searchFieldFocusOnLoad();Sd_Header.hideConnectLinkAndFB();$(document).observe("dm:intersticial_closed",Sd_Header.focusSearchField)})}};Sd_Header.initialize();var Sd_Footer={initialize:function(){$j(function(){if(navigator.userAgent.toLowerCase().indexOf("firefox")!=-1){$j("#footer_stream").remove()}})}};Sd_Footer.initialize();var DM_LocaleSelector={initEvents:function(){$j("#footer").on("click","#country_selector a.dmco_flag",DM_LocaleSelector.onCountryFlagClick)},onCountryFlagClick:function(){var d=$j(this).findParamInClass("country");var c=$j(this).findParamInClass("language");DM_LocaleSelector.changeLocale(c,d)},initCountrySelectorOnLoad:function(){var f=$j("#country_selector a");var d=document.location.search;var e=document.location.hash;if($j.trim(d)!=""){f.each(function(){$j(this).attr("href",$j(this).attr("href")+d)})}if($j.trim(e)!=""&&typeof DM_LocaleSelector_routeName!="undefined"&&DM_LocaleSelector_routeName=="faq"){f.each(function(){$j(this).attr("href",$j(this).attr("href")+e)})}},changeLocale:function(c,d){if(d){c=c+"_"+d.toUpperCase()}setCookie(DM_LoginCookie,"",-10);setCookie("lang",c,100)},initialize:function(){$j(function(){if($j("#country_selector").size()){DM_LocaleSelector.initEvents();DM_LocaleSelector.initCountrySelectorOnLoad()}})}};DM_LocaleSelector.initialize();var DM_Widget_PageItem_Facebook_Connect={popup:null,logoutAsked:null,doReload:true,enabled:false,debug:false,redirect:"",onLoginCallback:null,customReload:function(){if(DM_Widget_PageItem_Facebook_Connect.DmPendingAction){document.location=decodeURIComponent(DM_Widget_PageItem_Facebook_Connect.DmPendingAction);return}var d="http://"+document.location.hostname+document.location.pathname+document.location.search;if(d.indexOf("fbc=")>0){document.location=d.replace(/fbc=(\d+)/,"fbc="+Math.floor(Math.random()*1000))}else{var c="?";if(d.indexOf("?")>0){c="&"}document.location=d+c+"fbc="+Math.floor(Math.random()*1000)}},isFacebookMappedCallback:function(c){log("Connect",'Call "isFacebookMappedCallback"');datas=$j.parseJSON(decodeURIComponent(c));log("Connect",datas);if(typeof DM_Widget_PageItem_Facebook_Connect.onLoginCallback=="function"){DM_Widget_PageItem_Facebook_Connect.onLoginCallback(datas)}var d=(datas.dm_action=="create")?"register":datas.dm_action;switch(datas.state){case"true":log("Connect",'DM Ajax returned "true"');FB.api("/me?fields=id,name,picture&type=square",function(a){if(a&&a.id&&a.picture&&a.name){setCookie("facebook_infos",a.name.escapeUtf8()+"***"+a.picture.data["url"]+"***"+a.id,7);setCookie(DM_LoginCookie,c);PubSub.publish("dm:fb_cookie_updated");Stats_SiteCatalyst.onFacebookScAction(d);HeaderLogin.update()}});break;case"refresh_infos":log("Connect",'DM Ajax returned "refresh_infos"');log("Connect","About to reload the page");FB.api("/me?fields=id,name,picture&type=square",function(a){if(a&&a.id&&a.picture&&a.name){setCookie("facebook_infos",a.name.escapeUtf8()+"***"+a.picture.data["url"]+"***"+a.id,7);setCookie(DM_LoginCookie,c);PubSub.publish("dm:fb_cookie_updated");Stats_SiteCatalyst.onFacebookScAction(d);if(DM_Widget_PageItem_Facebook_Connect.doReload){return DM_Widget_PageItem_Facebook_Connect.customReload()}log("Connect","NO RELOAD because DM_Widget_PageItem_Facebook_Connect.doReload is set to false.")}});break;case"fail":log("Connect",'DM Ajax returned "fail"');break}},followPendingAction:function(){DM_Widget_PageItem_Facebook_Connect.DmPendingAction=window.DmPendingAction||null},resetLoginParams:function(){DM_Widget_PageItem_Facebook_Connect.loginParams=null},onLoginFacebook:function(c,d){log("Connect",'Call "onLoginFacebook"');deleteCookie("fb_autologin_disabled");if(c){DM_Widget_PageItem_Facebook_Connect.onLoginCallback=typeof c=="function"?c:DM_Widget_PageItem_Facebook_Connect.followPendingAction}if(typeof d=="function"){d()}else{DM_Widget_PageItem_Facebook_Connect.resetLoginParams()}log("Connect",'FB ajax call : "FB.login"');FB.login(DM_Widget_PageItem_Facebook_Connect.handleOnLoginFacebookResponse,{scope:"email,publish_actions"})},handleOnLoginFacebookResponse:function(b){if(b.authResponse){window.DM_Widget_Popup&&DM_Widget_Popup.close();log("Connect",'User logged on FB and linked with "Daily FB Connect App"');PubSub.publish("dm:fb_logged",true);log("Connect",'Make DM ajax call to "facebook login"');return ajax_call("facebook","login",$j.toJSONString(DM_Widget_PageItem_Facebook_Connect.loginParams),DM_Widget_PageItem_Facebook_Connect.isFacebookMappedCallback)}log("Connect","User cancelled login")},disconnect:function(b){if(b=="unknown"){PubSub.publish("dm:fb_unlogged")}else{if(b=="not_authorized"){PubSub.publish("dm:fb_not_authorized")}}deleteCookie("facebook_infos")},removePermissions:function(b){FB.api("/me/permissions","DELETE",function(a){if(a){if(a.error&&a.error.type=="OAuthException"){DM_Widget_PageItem_Facebook_Connect.onLoginFacebook(function(){DM_Widget_PageItem_Facebook_Connect.doReload=false;DM_Widget_PageItem_Facebook_Connect.removePermissions(b)})}else{b()}}})},handleSessionResponse:function(e){log("Connect",e);if(typeof e.authResponse=="undefined"||!e.authResponse){log("Connect","User is not logged on Facebook OR has not authorized application");return DM_Widget_PageItem_Facebook_Connect.disconnect(e.status)}log("Connect","User is logged on Facebook");var f=getCookie("facebook_infos");if(f){f=decodeURIComponent(f);var d=f.split("***")[2];if(e.authResponse.userID!=d){DM_Widget_PageItem_Facebook_Connect.disconnect(e.status);return}}FB.api("/me/permissions",function(b){if(!b.data[0].publish_actions||!b.data[0].email){log("Connect","User has not accept all permissons");DM_Widget_PageItem_Facebook_Connect.disconnect("not_authorized");return}log("Connect","User approves at least publish_actions and email permissions");log("Connect",'User logged on FB and linked with "Daily FB Connect App"');PubSub.publish("dm:fb_logged",false);var a=$j("div.dmpi_loginfull").length||($j("#login_infos").length&&!$j("#fb_login_id").length);if(a&&DM_Widget_PageItem_Facebook_Connect_AUTOLOGIN&&!getCookie("fb_autologin_disabled")){log("Connect","User is logged on FB, but header has no FB infos");log("Connect",'Make DM ajax call to "facebook login"');ajax_call("facebook","login",null,DM_Widget_PageItem_Facebook_Connect.isFacebookMappedCallback)}})},init:function(b){log("Connect",'Call "DM_Widget_PageItem_Facebook_Connect.init"');FB.init({appId:DM_Widget_PageItem_Facebook_Connect_APP_ID,status:true,cookie:true,xfbml:true,oauth:true});if(b){log("Connect","FB Script was late")}log("Connect","About to check FB user status");FB.getLoginStatus(DM_Widget_PageItem_Facebook_Connect.handleSessionResponse)},isFacebookScriptLoaded:function(){return(typeof FBScriptLoaded!="undefined"&&FBScriptLoaded)},initialize:function(b){$j(function(){log("Connect",'Call "DM_Widget_PageItem_Facebook_Connect.initialize"');if(DM_Widget_PageItem_Facebook_Connect.isFacebookScriptLoaded()){log("Connect","FB script is loaded");DM_Widget_PageItem_Facebook_Connect.init(b)}else{FBConnectInit=false;log("Connect","FB script is NOT loaded yet")}})}};DM_Widget_PageItem_Facebook_Connect.initialize();var DM_Widget_PageItem_Notice={initEvents:function(){$j("div.dmpi_notice").each(function(){var b=$j(this);if(b.hasClass("appear")&&!b.is(":visible")){b.fadeToggle(700)}}).on("click","div.close_notice",DM_Widget_PageItem_Notice.onClose).on("click","div.permanent_close_notice",DM_Widget_PageItem_Notice.onPermanentClose)},onClose:function(){$j(this).closest(".dmpi_notice").fadeToggle(400)},onPermanentClose:function(b){$j(this).closest(".dmpi_notice").fadeToggle(400);setCookie($j(this).findParamInClass("name"),"true",365)},initialize:function(){$j(function(){DM_Widget_PageItem_Notice.initEvents()})}};DM_Widget_PageItem_Notice.initialize();var DM_Widget_PageItem_Search={version:5,autocomplete_enabled:"0",language:"en",onSelect:function(e,f,g){var h=DM_Widget_PageItem_Search.autocomplete;if(e.length==6){h.updateShadow();h.updateInput(e[4]>0?h.inputValue.slice(0,e[4])+e[0]:e[0]);h.ignoreValueChange=true;if(h.options.autoSubmit&&h.el.up("form")&&!g){h.hide();h.el.up("form").submit()}}},onValueChange:function(){var b=DM_Widget_PageItem_Search.autocomplete;clearInterval(b.onChangeInterval);b.lastTypedValue=b.typedValue.toLowerCase();b.typedValue=b.el.value.toLowerCase();b.inputValue=b.el.value;b.selectedIndex=-1;b.log_groupend();b.log_groupstart(b.typedValue);if(!$(b.suggestionsId)){b.createSuggestionsContainer()}if(b.ignoreValueChange){b.ignoreValueChange=false;b.log_groupend();return}if(b.typedValue.blank()||b.typedValue.length<b.options.minChars||(b.options.maxChars&&b.typedValue.length>b.options.maxChars)){b.log("typed value empty || value length < minChars || value length > maxChars","hide container");b.log_groupend();b.hide();b.updateShadow()}else{b.getSuggestions()}},processResponse:function(g){var k=DM_Widget_PageItem_Search.autocomplete;var j=g;var i=j.request.url.substring(j.request.url.lastIndexOf("/")+1,j.request.url.length);var h;if(i.indexOf("?")!=-1){i=i.substring(0,i.indexOf("?"))}try{h=j.responseText.evalJSON();if(!Object.isArray(h)){h=[]}}catch(l){return}k.log("processResponse()",h);k.cachedResponse[encodeURIComponent(k.accentsTidy(k.typedValue))]=h;k.truncateSuggestions(h);if(k.suggestions.length<10&&k.options.allowRefineLocally){k.refineLocally=true}if(i===encodeURIComponent(k.el.value.toLowerCase())){k.suggest()}},suggest:function(){var f=DM_Widget_PageItem_Search.autocomplete;if(f.suggestions.length===0){f.updateShadow();f.log("no suggestions to display, hide container");f.hide();f.log_groupend();return}var d=[];var e="";d.push('<div class="suggestions foreground">');f.suggestions.each(function(b,j){e="";boldString="";var a=0,c=b[3];for(var l=0;l<c.length;l++){var i=c[l];if(a<i[0]){e+=b[0].slice(a,i[0])}a=i[0]+i[1];boldString=b[0].slice(i[0],a);e+="<b>"+boldString+"</b>"}if(a<b[0].length){e+=b[0].slice(a)}d.push((f.selectedIndex===j?'<div class="selected"':"<div"),' onclick="Autocomplete.instances[',f.instanceId,"].onSelect(",j,')"',' onmouseover="Autocomplete.instances[',f.instanceId,"].activate(",j,')">','<span class="suggestion" id="suggestion_',j,'"',">",e,"</span>");d.push('<div class="clear_suggestion"></div></div>');f.inputRuler.update(b[4]>0?f.inputValue.slice(0,b[4]).replace(/ /g,"&nbsp;"):"");if(j===0){if(b[5]||!boldString){f.updateShadow()}else{f.updateShadow(f.inputValue+boldString)}}}.bind(f));d.push("</div>");f.container.update(d.join("")).show();f.log_groupend();if(f.inputRuler&&f.inputRuler.getWidth()!==0){f.container.setStyle({width:"auto"});f.container.clonePosition(f.el,{offsetLeft:f.inputRuler.getWidth(),setHeight:false,setTop:false})}else{f.container.setStyle({width:null});f.container.clonePosition(f.el,{setHeight:false,setTop:false})}f.el.addClassName("no_border_bottom_left_radius")},configureSearchField:function(d){var c=d;c.inputRuler=new Element("div",{id:"input_ruler"});c.inputRuler.setStyle({position:"absolute",visibility:"hidden",padding:0,margin:0,fontSize:c.el.getStyle("font-size"),fontFamily:c.el.getStyle("font-family")});c.el.insert({after:c.inputRuler})},moveDown:function(){var b=DM_Widget_PageItem_Search.autocomplete;b.updateShadow();if(b.selectedIndex===(b.suggestions.length-1)){b.container.down().childNodes[b.selectedIndex].removeClassName("selected");b.selectedIndex=-1;b.updateInput(b.inputValue,true);return}b.activate(b.selectedIndex+1);b.updateInput(b.suggestions[b.selectedIndex][0])},moveUp:function(){var b=DM_Widget_PageItem_Search.autocomplete;b.updateShadow();if(b.selectedIndex===-1){b.selectedIndex=b.suggestions.length;b.activate(b.selectedIndex-1);b.updateInput(b.suggestions[b.selectedIndex][0]);return}if(b.selectedIndex===0){b.container.down().childNodes[0].removeClassName("selected");b.selectedIndex=-1;b.updateInput(b.inputValue,true);return}b.activate(b.selectedIndex-1);b.updateInput(b.suggestions[b.selectedIndex][0])},initialize:function(){Event.onDOMReady(function(){if(DM_Widget_PageItem_Search_autocomplete_enabled==1){var c="/json/complete/"+DM_Widget_PageItem_Search_language,d=$("input_search");if(d){(function(){if(!window.page_has_intersticial){DM_Widget_PageItem_Search.autocomplete=new Autocomplete("input_search",{allowRefineLocally:false,serviceUrl:c,deferRequestBy:10,maxChars:30,onSelect:DM_Widget_PageItem_Search.onSelect,onValueChange:DM_Widget_PageItem_Search.onValueChange,processResponse:DM_Widget_PageItem_Search.processResponse,suggest:DM_Widget_PageItem_Search.suggest,configureSearchField:DM_Widget_PageItem_Search.configureSearchField,moveDown:DM_Widget_PageItem_Search.moveDown,moveUp:DM_Widget_PageItem_Search.moveUp,withShadow:true})}else{setTimeout(arguments.callee,500)}})()}}})}};DM_Widget_PageItem_Search.initialize();var Autocomplete=Class.create({version:3,initialize:function(c,d){this.instanceId=Autocomplete.instances.push(this)-1;this.searchFieldId=c;this.suggestionsId="autocomplete_"+c;this.container=null;this.suggestions=[];this.selectedIndex=-1;this.boundKiller=null;this.ignoreValueChange=false;this.cachedResponse=[];this.onChangeInterval=null;this.typedValue="";this.inputValue="";this.lastTypedValue="";this.refineLocally=false;this.dataValue=null;this.shadowTimeout=null;this.options={serviceUrl:"",autoSubmit:true,minChars:1,maxChars:0,deferRequestBy:0,showInfo:true,autoPosition:false,appendMode:false,allowRefineLocally:true,suggestMax:10,headerOffset:36,suggestHeight:20,moveDown:null,moveUp:null,onKeyUp:null,onValueChange:null,onSelect:null,getSuggestions:null,processResponse:null,suggest:null,configureSearchField:null,withShadow:false};Object.extend(this.options,d);this.configureSearchField()},configureSearchField:function(){this.log("configureSearchField()");this.el=$(this.searchFieldId);this.el.setAttribute("autocomplete","off");this.el.observe("keydown",this.onKeyDown.bind(this));this.el.observe("keyup",this.onKeyUp.bind(this));this.el.observe("blur",this.enablekiller.bind(this));if(this.options.withShadow){this.shadowEl=new Element("input",{id:"input_search_shadow",type:"text"});this.el.addClassName("has_shadow");this.el.insert({after:this.shadowEl});this.shadowEl.show();this.shadowEl.setStyle({left:this.el.positionedOffset()[0]+"px",top:this.el.positionedOffset()[1]+"px",width:this.el.measure("width")+"px"})}if(this.options.configureSearchField&&typeof this.options.configureSearchField==="function"){this.options.configureSearchField(this)}},createSuggestionsContainer:function(){this.log("createSuggestionsContainer()");var c=new Element("div"),d={};c.addClassName("autocomplete");c.setAttribute("id",this.suggestionsId);d.display="none";if(this.options.autoPosition){d.top=(this.el.positionedOffset()[1]+this.el.getHeight())+"px"}this.el.insert({after:c.setStyle(d)});this.container=$(this.suggestionsId)},onKeyDown:function(b){if(this.options.withShadow){if(!this.shadowEl.value.startsWith(this.el.value+String.fromCharCode(b.keyCode).toLowerCase())){this.updateShadow()}}if((!this.container||!this.container.visible())&&b.keyCode!==Event.KEY_RETURN){if(this.options.withShadow&&b.keyCode===Event.KEY_TAB){b.stop()}return}switch(b.keyCode){case Event.KEY_ESC:this.el.value=this.inputValue;this.hide();break;case Event.KEY_RETURN:if(!this.options.autoSubmit){b.stop()}this.onSelect(this.selectedIndex);break;case Event.KEY_UP:this.moveUp();break;case Event.KEY_DOWN:this.moveDown();break;case Event.KEY_TAB:if(this.options.withShadow){b.stop();this.onSelect(0,true)}break;case Event.KEY_BACKSPACE:case 32:this.updateShadow();default:return}b.stop()},onKeyUp:function(b){if(this.options.onKeyUp&&typeof this.options.onKeyUp==="function"){this.options.onKeyUp(b)}else{switch(b.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:case Event.KEY_RETURN:return;default:break}clearInterval(this.onChangeInterval);this.ignoreValueChange=false;if(this.typedValue!==this.el.value.toLowerCase()){if(this.options.deferRequestBy>0){this.onChangeInterval=setInterval(this.onValueChange.bind(this),this.options.deferRequestBy)}else{this.onValueChange()}}}},enablekiller:function(b){if(this.boundKiller===null){this.boundKiller=this.killer.bind(this);document.observe("click",this.boundKiller)}},disablekiller:function(){if(this.boundKiller!==null){document.stopObserving("click",this.boundKiller);this.boundKiller=null}},killer:function(b){if(!b.findElement("#"+this.suggestionsId)&&!b.findElement("#"+this.searchFieldId)){this.hide();this.disablekiller()}},hide:function(){this.selectedIndex=-1;if(this.container){this.container.hide();$("input_search").removeClassName("no_border_bottom_left_radius")}},updateInput:function(h,f){this.log("update input text with new value",h);if(this.options.appendMode&&!f){var g=this.el.value.split(" "),i=g[g.length-1],j=new RegExp(i+"$");this.el.value=this.el.value.replace(j,h)}else{this.el.value=h}this.updateShadow(this.el.value)},moveUp:function(){if(this.options.moveUp&&typeof this.options.moveUp==="function"){this.options.moveUp()}else{this.updateShadow();if(this.selectedIndex===-1){this.selectedIndex=this.suggestions.length;this.activate(this.selectedIndex-1);this.updateInput(this.suggestions[this.selectedIndex][0]);return}if(this.selectedIndex===0){this.container.down().childNodes[0].removeClassName("selected");this.selectedIndex=-1;this.updateInput(this.inputValue,true);return}this.activate(this.selectedIndex-1);this.updateInput(this.suggestions[this.selectedIndex][0])}},moveDown:function(){if(this.options.moveDown&&typeof this.options.moveDown==="function"){this.options.moveDown()}else{this.updateShadow();if(this.selectedIndex===(this.suggestions.length-1)){this.container.down().childNodes[this.selectedIndex].removeClassName("selected");this.selectedIndex=-1;this.updateInput(this.inputValue,true);return}this.activate(this.selectedIndex+1);this.updateInput(this.suggestions[this.selectedIndex][0])}},onValueChange:function(){if(this.options.onValueChange&&typeof this.options.onValueChange==="function"){this.options.onValueChange()}else{clearInterval(this.onChangeInterval);this.lastTypedValue=this.typedValue.toLowerCase();this.typedValue=this.el.value.toLowerCase();this.inputValue=this.el.value;this.selectedIndex=-1;this.log_groupend();this.log_groupstart(this.typedValue);if(!$(this.suggestionsId)){this.createSuggestionsContainer()}if(this.ignoreValueChange){this.ignoreValueChange=false;this.log_groupend();return}this.typedValue=this.cleansSearchString(this.typedValue);if(this.typedValue.blank()||this.typedValue.length<this.options.minChars||(this.options.maxChars&&this.typedValue.length>this.options.maxChars)){this.log("typed value empty || < minChars || > maxChars");this.log_groupend();this.hide();this.updateShadow()}else{this.getSuggestions()}}},onSelect:function(d,f){var e=this.suggestions[d]||[this.cleansSearchString(this.el.value)];if(this.options.onSelect&&typeof this.options.onSelect==="function"){this.options.onSelect(e,this.suggestions,f)}else{if(e[0]){this.updateShadow();this.updateInput(e[0]);this.ignoreValueChange=true;this.hide()}}if(this.options.autoSubmit&&this.el.up("form")&&!f){this.el.up("form").submit()}},getSuggestions:function(){this.log("getSuggestions() for value",this.typedValue);if(Object.isArray(this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))])){this.truncateSuggestions(this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]);this.log("found cached response for value",this.typedValue,this.suggestions);this.suggest()}else{if(this.refineLocally&&this.options.allowRefineLocally){if(!this.lastTypedValue.blank()&&this.el.value.toLowerCase().startsWith(this.lastTypedValue)){this.suggestions=this.suggestions.findAll(function(a){return this.accentsTidy(a[0]).startsWith(this.accentsTidy(this.typedValue))},this);this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]=this.suggestions;this.suggest();return}else{this.refineLocally=false}}if(this.options.getSuggestions&&typeof this.options.getSuggestions==="function"){this.options.getSuggestions(this.typedValue)}else{var b=getCookie("dailymotion_auth");new Ajax.Request(this.options.serviceUrl+"/"+encodeURIComponent(this.typedValue)+(b?"?"+b:""),{onComplete:this.processResponse.bind(this),sanitizeJSON:true,method:"get"})}}},suggest:function(){this.log("suggest() results for value",this.typedValue);if(this.options.suggest&&typeof this.options.suggest==="function"){this.options.suggest()}else{if(this.suggestions.length===0){this.updateShadow();this.log("no suggestions to display, hide container");this.hide();this.log_groupend();return}var c=[];var d="";c.push('<div class="suggestions background foreground">');this.suggestions.each(function(a,b){if(b===0){this.updateShadow(a[0])}d=a[0];c.push((this.selectedIndex===b?'<div class="selected"':"<div"),' onclick="Autocomplete.instances[',this.instanceId,"].onSelect(",b,')"',' onmouseover="Autocomplete.instances[',this.instanceId,"].activate(",b,')">','<span class="suggestion" id="suggestion_',b,'"',">",d,"</span>");c.push('<div class="clear_suggestion"></div></div>')}.bind(this));c.push("</div>");this.container.update(c.join("")).show();this.log_groupend();if(this.searchFieldId=="input_search"){$("input_search").addClassName("no_border_bottom_left_radius")}this.container.clonePosition($(this.searchFieldId),{setHeight:false,setTop:false})}},processResponse:function(f){if(this.options.processResponse&&typeof this.options.processResponse==="function"){this.options.processResponse(f)}else{var i=f;var h=i.request.url.substring(i.request.url.lastIndexOf("/")+1,i.request.url.length);var g;if(h.indexOf("?")!=-1){h=h.substring(0,h.indexOf("?"))}try{g=i.responseText.evalJSON();if(!Object.isArray(g)){g=[]}}catch(j){return}this.log("processResponse()",g);this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]=g;this.truncateSuggestions(g);if(this.suggestions.length<10&&this.options.allowRefineLocally){this.refineLocally=true}if(h===encodeURIComponent(this.cleansSearchString(this.el.value.toLowerCase()))){this.suggest()}}},truncateSuggestions:function(e){this.suggestions=e;if($$("html")[0].hasClassName("win")&&($$("html")[0].hasClassName("webkit")||$$("html")[0].hasClassName("ie"))){var d=$("main_player")?$("main_player"):$$(".dmpi_video_playerv4")[0]?$$(".dmpi_video_playerv4")[0]:false;if(d){var f=d.cumulativeOffset()[1]-$("header").cumulativeOffset()[1]-this.options.headerOffset;this.options.suggestMax=Math.floor(f/this.options.suggestHeight);if(!$(document.body).hasClassName("dm_page_html_video")){this.options.suggestMax--}}if(this.options.suggestMax<10){this.suggestions=[];e.each(function(a,b){if(b<this.options.suggestMax){this.suggestions.push(a)}}.bind(this))}}},activate:function(e){var f;if(this.container&&this.container.visible()){var d=this.container.down().childNodes;if(this.selectedIndex!==-1&&d.length>this.selectedIndex){d[this.selectedIndex].removeClassName("selected")}this.selectedIndex=e;if(this.selectedIndex!==-1&&d.length>this.selectedIndex){f=$(d[this.selectedIndex]);f.addClassName("selected")}}return f},updateShadow:function(d){if(this.options.withShadow){var c=this;clearTimeout(c.shadowTimeout);if(d){c.shadowTimeout=setTimeout(function(){c.shadowEl.value=d;c.log("update shadow with value",d)},300)}else{c.shadowEl.value="";c.log("update shadow with value",d)}}},cleansSearchString:function(b){b=b.gsub(/\s{2,}/," ");b=b.gsub(/^\s+/,"");b=b.gsub("/","");return b},accentsTidy:function(d){var c=d.toLowerCase();c=c.replace(new RegExp("[àáâãäå]","g"),"a");c=c.replace(new RegExp("ç","g"),"c");c=c.replace(new RegExp("[èéêë]","g"),"e");c=c.replace(new RegExp("[ìíîï]","g"),"i");c=c.replace(new RegExp("ñ","g"),"n");c=c.replace(new RegExp("[òóôõö]","g"),"o");c=c.replace(new RegExp("[ùúûü]","g"),"u");c=c.replace(new RegExp("[ýÿ]","g"),"y");return c},log:function(){if(Autocomplete.debug&&typeof console!="undefined"){var j=new Date();var g=(j.getHours()<10)?"0"+j.getHours():j.getHours();var i=(j.getMinutes()<10)?"0"+j.getMinutes():j.getMinutes();var h=(j.getSeconds()<10)?"0"+j.getSeconds():j.getSeconds();var f=[[g,i,h].join(":"),this.searchFieldId];Array.prototype.slice.call(arguments).each(function(b,a){if(typeof b==="object"&&!b.nodeType){b=Object.extend({},b)}f.push(b)});console.log(f)}},log_groupstart:function(){if(Autocomplete.debug&&typeof console!="undefined"){var b=[this.searchFieldId];Array.prototype.slice.call(arguments).each(function(a,d){if(typeof a==="object"&&!a.nodeType){a=Object.extend({},a)}b.push(a)});console.group(b)}},log_groupend:function(){if(Autocomplete.debug&&typeof console!="undefined"){console.groupEnd()}}});Autocomplete.debug=false;Autocomplete.instances=[];var vsZone=null,vsZoneUsed=false,vskeys,vsUrl,cookieEnabled=(function(){setCookieWithFormat("cookie_enabled","y",1,"m");if(getCookie("cookie_enabled")=="y"){return true}return false})();if(cookieEnabled){vsZone=getCookie("vsz")||"";deleteCookie("vsz")}window.DM_Player&&DM_Player.addReadyCallback(VS_onDailymotionPlayerReady);function VS_onDailymotionPlayerReady(c){var d=$j("#"+c)[0];if(d){d.addEventListener("onVideoMetadata","onVSPlayerVideoMetadata")}}function onVSPlayerVideoMetadata(){if(window.logPageViewFromPlayer){vsStat()}}var instrumentActionCounter=[];function instrumentAction(elts,action,type,method){if(!cookieEnabled||!elts||!window.vsRedUrl){return}if(action=="OSU/Send"){return $j.get(vsRedUrl+"log=1&action="+encodeURIComponent(action)+"&country="+encodeURIComponent(vskeys.vs_country)+"&locale="+encodeURIComponent(vskeys.vs_locale))}var i=0,l=elts.length||0,el=elts.nodeType?elts:l?elts[0]:null;do{if(!el||el.is_vs_obs){return}var spa=encodeURIComponent(vskeys.vs_spa),url=vsRedUrl+"log=1&action="+encodeURIComponent(action);if(type=="video"){if(action.indexOf("related/related")===-1){url+="&video="+encodeURIComponent(vskeys.vs_video)+"&videotitle="+encodeURIComponent(vskeys.vs_videotitle)+"&user="+encodeURIComponent(vskeys.vs_user)+"&usertype="+encodeURIComponent(vskeys.vs_usertype)}url+="&actionpage="+encodeURIComponent(vskeys.vs_pagename)+"&country="+encodeURIComponent(vskeys.vs_country);if(typeof spa!="undefined"&&spa!="undefined"){url+="&spa="+spa}if(action.indexOf("related")==0){if(!instrumentActionCounter[action]){instrumentActionCounter[action]=0}instrumentActionCounter[action]++;url+="&spb="+instrumentActionCounter[action]}}if(type=="list"){url+="&experience="+encodeURIComponent(vskeys.vs_experience)+"&actionpage="+encodeURIComponent(vskeys.vs_pagename);var page="0";if("vs_page" in vskeys){page=vskeys.vs_page}url+="&rank="+encodeURIComponent(page+","+i)+"&actionchannel="+encodeURIComponent(vskeys.vs_channel)}var observer={elt:el,url:url,call:function(event){var doRedirect=false;if(this.elt.nodeName=="A"&&$j(this.elt).hasClass("not_ajax")&&this.elt.href.indexOf("javascript")==-1&&this.elt.href.indexOf("#")!=0&&this.elt.target!="_blank"){doRedirect=true;event.stop()}$j.get(this.url).always($j.proxy(function(){var time_out=0;if(typeof method!="undefined"){time_out=300;eval(method)(this.elt)}if(doRedirect){setTimeout($j.proxy(function(){document.location=this.elt.href},this),time_out)}},this))}};$j(el).on("click",$j.proxy(observer.call,observer));el.is_vs_obs=true}while(++i<l&&(el=elts[i]))}function vsStat(s){if(!cookieEnabled){return}var n=$j.extend({},vskeys),o=document,t=s||window.vskeys_extras;if(o.referrer){n.vs_dr=o.referrer}n.vs_dh=location.href;if(vsZone&&!vsZoneUsed){vsZoneUsed=true;n.vs_hitmap=vsZone}n.vs_cb=new Date().getTime();if(t){if(n.vs_pagename&&t["vs_pagename-extra"]){n.vs_pagename+=t["vs_pagename-extra"]}delete (t["vs_pagename-extra"]);for(var c in t){if(t.hasOwnProperty(c)){n[c]=t[c]}}}if(document.body.className.match(/dm_page_html_video\b/)){var q="",d=$j("#tabs a.context_tab_selected");if(d.length){$j(d[0].className.split(/ +/)).each(function(){if(this.match(/^tab_/)){q=this.replace(/^tab_/,"")}})}else{q="related"}n.vs_spd=q}var m=vsUrl;var r=true;for(var u in n){if(!r){m+="&"}m+=u.substr(3)+"="+encodeURIComponent(n[u]);r=false}ping(m,"vs")}function vsContextInstrument(d){if(document.body.className.match(/dm_page_html_videos\b|dm_page_html_daily50\b|dm_page_html_video\b/)){if($j("#dmpi_video_tools")[0]&&d&&!arguments.callee["doneTools"+d]){arguments.callee["doneTools"+d]=true;$j(d+" a").each(function(){var b=this.className.match(/\btool_([^\b\s]+)\b/),a=b&&b.length==2?"video/"+b[1].replace(/_/g,"/"):null;if(a){instrumentAction(this,a,"video")}})}}if(document.body.className.match(/dm_page_html_video\b/)){if(d=="#related"){if(!arguments.callee.doneRelated&&$j("#related div.dmpi_video_relatedlist")[0]){arguments.callee.doneRelated=true;instrumentAction($j("#all_videos")[0],"related/related/all","video")}}else{if(!arguments.callee.doneTabs&&$j("#player_page_tabs_nav")[0]){arguments.callee.doneTabs=true;$j("#player_page_tabs_nav span").each(function(){var b=this.className.match(/\btab_([^\b\s]+)\b/),a=b&&b.length==2?"video/tabs/"+b[1]:null;if(a){instrumentAction(this,a,"video")}})}if($j("#player_page_tabs")[0]&&d&&d.match(/tab_[a-z]+_content/)&&!arguments.callee["doneTab"+d]){arguments.callee["doneTab"+d]=true;var c=d.match(/tab_([a-z]+)_content/)[1];if(c=="playlists"){instrumentAction($j(d+" a.bottom_right"),"video/tabs/playlists/shownext","video")}else{instrumentAction($j(d+" input.long_button"),"video/tabs/"+c+"/showmore","video");instrumentAction($j(d+" a.bottom_right"),"video/tabs/"+c+"/shownext","video")}}}}$j("#small_embed_link").each(function(){instrumentAction(this,"video/embed","video")})}$j(function(){if(typeof(vskeys)!="undefined"){$j(document).on("mousedown","a[data-vszone]",function(c){var d=$j(this).data("vszone");if(d){setCookieWithFormat("vsz",d,1,"m")}});vsStat();vsContextInstrument();PubSub.subscribe("vs:action",onVsAction)}});function onVsAction(c){if(!cookieEnabled||!window.vsRedUrl){return}var d=vsRedUrl+"log=1&action="+encodeURIComponent(c);if(vskeys.vs_pagename){d+="&actionpage="+encodeURIComponent(vskeys.vs_pagename)}if(vskeys.vs_country){d+="&country="+encodeURIComponent(vskeys.vs_country)}ping(d,"vs")}function vsSimpleCall(c){if(!cookieEnabled||!window.vsRedUrl){return}if(c.indexOf("/lang/")>0){c=c.substr(c.indexOf("/lang/")+6,2)}else{c="All"}var d=vsRedUrl+"log=1&action=selectcomment/"+c;d+="&Video="+encodeURIComponent(vskeys.vs_video);d+="&Videotitle="+encodeURIComponent(vskeys.vs_videotitle);d+="&user="+encodeURIComponent(vskeys.vs_user);d+="&usertype="+encodeURIComponent(vskeys.vs_usertype);d+="&actionpage="+encodeURIComponent(vskeys.vs_pagename);d+="&spa="+encodeURIComponent(vskeys.vs_spa);$j.get(d)}var Stats_SiteCatalyst={onScAction:function(j){if("SiteCatalyst" in window){var k=window.SiteCatalyst.getInstance();var m=j.context;var n=j.label;switch(m){case"ajax home":case"ligue1":var i=n.pageName?n.pageName:k.pageName;var h=n.type?n.type:n;ajax_call("sitecatalyst","get_ajax_page_code",i,h,function(a){if(a){$j("#sitecatalyst").html(a)}});break;case"ticker":switch(n.action){case"minimize":k.events="event52";k.linkTrackVars="events";k.linkTrackEvents="event52";k.tl(this,"o",n.name);break;case"subscribe":break}break;case"subscription":var l=n.action+" "+n.type;if(n.action=="subscribe"){k.eVar40=l;k.events="event2";k.linkTrackVars="eVar40,events";k.linkTrackEvents="event2";k.tl(this,"o",l)}else{if(n.action=="unsubscribe"){k.eVar40=l;k.events="event3";k.linkTrackVars="eVar40,events";k.linkTrackEvents="event3";k.tl(this,"o",l)}}break;case"login":k.eVar39=n;k.events="event27";k.linkTrackVars="eVar39,events";k.linkTrackEvents="event27";k.tl(this,"o",n);break;case"register":k.eVar41=n;k.events="event26";k.linkTrackVars="eVar41,events";k.linkTrackEvents="event26";k.tl(this,"o",n);break;case"upload":var l=n.type;if(n.status=="request"){k.eVar65=l;k.events="event32";k.linkTrackVars="eVar65,events";k.linkTrackEvents="event32";k.tl(this,"o",l+" upload request")}else{if(n.status=="start"){k.eVar65=l;k.events="event49";k.linkTrackVars="eVar65,events";k.linkTrackEvents="event49";k.tl(this,"o",l+" upload start")}else{if(n.status=="success"){k.eVar65=l;k.events="event25";k.linkTrackVars="eVar65,events";k.linkTrackEvents="event25";k.tl(this,"o",l+" upload success")}else{if(n.status=="save"){k.eVar65=l;k.events="event51";k.linkTrackVars="eVar65,events";k.linkTrackEvents="event51";k.tl(this,"o",l+" upload form save")}}}}break}}},onUserPageScAction:function(){if("SiteCatalyst" in window){var b=window.SiteCatalyst.getInstance();$j(document).on("click",function(a){var f=b.prop18;var e=b.prop19;if($j(a.target).closest(".dmpi_user_tools .icon_export")[0]){b.eVar21=f;b.eVar22=e;b.events="event40";b.linkTrackVars="eVar21,eVar22,events";b.linkTrackEvents="event40";b.tl(this,"o","Promote a user")}else{if($j(a.target).closest(".dmpi_user_tools .icon_jukebox")[0]){b.eVar21=f;b.eVar22=e;b.events="event38";b.linkTrackVars="eVar21,eVar22,events";b.linkTrackEvents="event38";b.tl(this,"o","Create a Jukebox")}else{if($j(a.target).closest(".dmpi_user_tools .icon_film")[0]){b.eVar21=f;b.eVar22=e;b.events="event39";b.linkTrackVars="eVar21,eVar22,events";b.linkTrackEvents="event39";b.tl(this,"o","Create a Videowall")}}}})}},onVideoPageScAction:function(){if("SiteCatalyst" in window){var b=window.SiteCatalyst.getInstance();$j(document).on("click",function(k){var n=b.prop22;if($j(k.target).closest(".dmpi_abuse .dmco_form_submit")[0]){var i=$j("#comment").val();if(i>=10&&i<=400){b.eVar12="Report a video";b.eVar25=b.eVar13=n;b.events="event33,event43";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event43";b.tl(this,"o","Report a video")}}else{if($j(k.target).closest(".sd_video_socialbuttons .embed")[0]){b.eVar12="Use Embed Video Panel";b.eVar25=b.eVar13=n;b.events="event33,event41";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event41";b.tl(this,"o","Use Embed Video Panel")}else{if($j(k.target).closest(".sd_video_tools .tool_moveto_bookmark span").hasClass("favorite")){b.eVar12="Add to favorites";b.eVar25=b.eVar13=n;b.events="event33,event34";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event34";b.tl(this,"o","Add to favorites")}else{if($j(k.target).closest(".dmpi_playlist_create .dmco_form_submit")[0]){b.eVar12="Create a playlist";b.eVar25=b.eVar13=n;b.events="event33,event28";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event28";b.tl(this,"o","Create a playlist")}else{if($j(k.target).closest(".dmpi_video_tools_playlistadd .playlist_list .add")[0]){b.eVar12="Add to playlist";b.eVar25=b.eVar13=n;b.events="event33,event29";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event29";b.tl(this,"o","Add to playlist")}else{if($j(k.target).closest(".sd_video_tools .tool_moveto_quicklist")[0]){b.eVar12="Add to quicklist";b.eVar25=b.eVar13=n;b.events="event33,event35";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event35";b.tl(this,"o","Add to quicklist")}else{var l=$j(k.target).closest(".dmpi_video_tools_addorinvite.contest .group_list .dmco_link");if(l[0]){var j=true,m=l.siblings("form");if(m[0]){j=m.find("input").prop("checked")?true:false}if(!l.hasClass("remove_video_from_group")&&j){b.eVar12="Add to contest";b.eVar25=b.eVar13=n;b.events="event33,event37";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event37";b.tl(this,"o","Add to contest")}}else{var a=$j(k.target).closest(".dmpi_video_tools_addorinvite .group_list .dmco_link");if(a[0]){var j=true,m=a.siblings("form");if(m[0]){j=m.find("input").prop("checked")?true:false}if(!a.hasClass("remove_video_from_group")&&j){b.eVar12="Add to group";b.eVar25=b.eVar13=n;b.events="event33,event36";b.linkTrackVars="eVar12,eVar13,events";b.linkTrackEvents="event33,event36";b.tl(this,"o","Add to group")}}}}}}}}}})}},onFacebookScAction:function(b){PubSub.publish("sc:action",{context:b,label:"facebook "+b})},initialize:function(){$j(function(){PubSub.subscribe("sc:action",Stats_SiteCatalyst.onScAction)})}};Stats_SiteCatalyst.initialize();var TimeTracker=function(b){if(b){this.bucket_=b.sort(this.sortNumber)}else{this.bucket_=TimeTracker.DEFAULT_BUCKET}};TimeTracker.prototype.startTime_;TimeTracker.prototype.stopTime_;TimeTracker.prototype.bucket_;TimeTracker.DEFAULT_BUCKET=[100,500,1500,2500,5000];TimeTracker.prototype._getTimeDiff=function(){return(this.stopTime_-this.startTime_)};TimeTracker.prototype.sortNumber=function(a,b){return(a-b)};TimeTracker.prototype._recordStartTime=function(b){if(b!=undefined){this.startTime_=b}else{this.startTime_=(new Date()).getTime()}};TimeTracker.prototype._recordEndTime=function(b){if(b!=undefined){this.stopTime_=b}else{this.stopTime_=(new Date()).getTime()}};TimeTracker.prototype._track=function(i,h,l){var j;if(h!=undefined&&h.length!=0){j=i._createEventTracker(h)}else{j=i._createEventTracker("TimeTracker")}var k;var g;for(k=0;k<this.bucket_.length;k++){if((this._getTimeDiff())<this.bucket_[k]){if(k==0){g="0-"+(this.bucket_[0]);break}else{g=this.bucket_[k-1]+"-"+(this.bucket_[k]-1);break}}}if(!g){g=this.bucket_[k-1]+"+"}j._trackEvent(g,l,this._getTimeDiff())};TimeTracker.prototype._setHistogramBuckets=function(b){this.bucket_=b.sort(this.sortNumber)};var DM_Widget_PageItem_Video_Preview={item:null,container:null,sprite1:null,sprite2:null,state:0,step:0,total:0,timer:-1,infosTimer:null,flyoutTimer:null,flyoutEnabled:!(document.body&&/dm_page_html_videos\b/.test(document.body.className))||$("dual_list").hasClassName("grid_view"),videoListItems:null,flyoutPositions:[],flyoutElts:[],overQLDuration:0.15,overQLDelay:0.5,overQLEffect:null,rules:{"div.psprite":function(b){b.onmouseover=function(){DM_Widget_PageItem_Video_Preview.item=b;DM_Widget_PageItem_Video_Preview.state=0;DM_Widget_PageItem_Video_Preview.total=this.hasClassName("pmode8")?8:4;DM_JS.get("Extras",function(){window.clearTimeout(DM_Widget_PageItem_Video_Preview.timer);DM_Widget_PageItem_Video_Preview.timer=window.setTimeout(function(){DM_Widget_PageItem_Video_Preview.handler()},500)})};b.onmouseout=function(){window.clearTimeout(DM_Widget_PageItem_Video_Preview.timer);if(DM_Widget_PageItem_Video_Preview.container){DM_Widget_PageItem_Video_Preview.container.remove();DM_Widget_PageItem_Video_Preview.container=null}}},"div[data-flyout] div.dmpi_video_preview":function(b){DM_Widget_PageItem_Video_Preview.flyoutObservers(b)},"body.dm_page_html_videos div.dmpi_video_list_gridable div.dmpi_video_preview":function(b){DM_Widget_PageItem_Video_Preview.annotateObservers(b)},"div.dmpi_video_preview a.with_urlback":function(b){b.href+=b.href.querySeparator()+"urlback="+b.pathname}},flyoutRules:function(e){var d={},f="div[data-flyout] div.dmpi_video_preview";d[e+" "+f]=DM_Widget_PageItem_Video_Preview.rules[f];return d},animatedPreviewRules:function(d){var c={};c[d+" div.psprite"]=DM_Widget_PageItem_Video_Preview.rules["div.psprite"];return c},annotateObservers:function(b){if(b.down(".annotate")){b.observe("mouseover",function(a){a.stopPropagation();b.down(".annotate").show();b.down(".annotate").next().show()});b.observe("mouseout",function(a){a.stopPropagation();b.down(".annotate").hide();b.down(".annotate").next().hide()})}},flyoutObservers:function(b){if(typeof b.flyoutReady=="undefined"||!b.flyoutReady){b.observe("mouseover",function(a){if(!DM_Widget_PageItem_Video_Preview.flyoutEnabled){return}a.stopPropagation();DM_Widget_PageItem_Video_Preview.infosTimer=window.setTimeout(function(){DM_Widget_PageItem_Video_Preview.showFlyout(b)},500);DM_Widget_PageItem_Video_Preview.removeFlyout(b)});b.observe("mouseout",function(a){if(!DM_Widget_PageItem_Video_Preview.flyoutEnabled){return}DM_Widget_PageItem_Video_Preview.removeFlyout();a.stopPropagation();window.clearTimeout(DM_Widget_PageItem_Video_Preview.infosTimer);DM_Widget_PageItem_Video_Preview.infosTimer=null});b.flyoutReady=true}},updateFlyout:function(){$$("div[data-flyout] div.dmpi_video_preview").each(function(b){DM_Widget_PageItem_Video_Preview.flyoutObservers(b)})},activateFlyout:function(){DM_Widget_PageItem_Video_Preview.flyoutEnabled=true},deactivateFlyout:function(){DM_Widget_PageItem_Video_Preview.flyoutEnabled=false},removeFlyout:function(c){var d=$("video_flyout_box");if(d){if(c||DM_Widget_PageItem_Video_Preview.flyoutElts.indexOf(c)==-1){d.remove();DM_Widget_PageItem_Video_Preview.flyoutElts.clear()}}},getFlyoutPositionForItem:function(f){DM_Widget_PageItem_Video_Preview.nbItemsPerLine=(DM_Widget_PageItem_Video_Preview.nbItemsPerLine||(Math.floor(f.up().getWidth()/f.getWidth())));var d=DM_Widget_PageItem_Video_Preview.nbItemsPerLine,e=[0,3];if(d==1){e=[]}if(e.indexOf((DM_Widget_PageItem_Video_Preview.getVideoListItems().indexOf(f)+1)%d)!=-1){return"left"}return"right"},showFlyout:function(l){if(DM_Widget_PageItem_Video_Preview.flyoutElts.indexOf(l)==-1){var o=l.getWidth()+8,r=0,m="left",s=l.up(".dmpi_video_item");if(DM_Widget_PageItem_Video_Preview.getFlyoutPositionForItem(s)=="left"){o=-321;m="right"}if(!Prototype.Browser.Gecko){r=document.viewport.getScrollOffsets()["top"]}var j='<div class="video_flyout_box_content">'+s.innerHTML+'<div class="stem_'+m+'"></div></div>';var n=new Element("div",{id:"video_flyout_box","class":"background"});n.update(j);n.clonePosition(l,{setWidth:false,setHeight:false,offsetLeft:o,offsetTop:r});var k=n.down("div.dmpi_video_description").down();if(k&&k.innerHTML.blank()&&window.DM_Widget_PageItem_Video_Preview_NO_DESCRIPTION){k.update(DM_Widget_PageItem_Video_Preview_NO_DESCRIPTION).addClassName("foreground2")}var q=n.down("div.dmco_date");if(q){q.addClassName("foreground")}$(document.body).insert({top:n});DM_Widget_PageItem_Video_Preview.flyoutElts.push(n,l)}},getVideoListItems:function(){if(!DM_Widget_PageItem_Video_Preview.videoListItems){DM_Widget_PageItem_Video_Preview.videoListItems=$$("div[data-flyout] div.dmpi_video_item");if(/dm_page_html_user\b|dm_page_html_hub\b/.test(document.body.className)){DM_Widget_PageItem_Video_Preview.videoListItems=DM_Widget_PageItem_Video_Preview.videoListItems.concat($$("div[data-flyout] div.dmpi_video_empty"))}}return DM_Widget_PageItem_Video_Preview.videoListItems},handler:function(){switch(this.state){case 0:var b=0;if(typeof DM_Widget_PageItem_Video_Preview_SpriteOffset!="undefined"){b=DM_Widget_PageItem_Video_Preview_SpriteOffset}this.resizerEnabled=$("bodyall").hasClassName("resizer_enabled");this.path=this.item.up().down("img",0).readAttribute("data-spr");this.itemWidth=this.item.getWidth();this.itemHeight=this.item.getHeight();this.previewHeight=this.item.up().down("img",0).getHeight();this.spriteStep=Math.floor(this.itemWidth*120/160);this.spriteHeight=this.spriteStep*this.total;this.spriteTopOffset=Math.floor((this.spriteStep-this.itemHeight)/2);this.container=new Element("div",{id:"psprite_container"}).setStyle({position:"absolute",overflow:"hidden",top:-(this.spriteTopOffset+b)+"px",left:b+"px",width:this.itemWidth+"px",height:(this.itemHeight+this.spriteTopOffset)+"px",display:"none"});this.sprite2=new Element("img",{src:this.path}).setStyle({position:"absolute",border:"none",opacity:0,marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px"});this.container.insert(this.sprite2);this.item.insert({before:this.container});this.state++;break;case 1:if(this.sprite2.complete||(typeof(this.sprite2.naturalWidth)!="undefined"&&this.sprite2.naturalWidth!==0)){this.sprite1=new Element("img",{src:this.path}).setStyle({position:"absolute",border:"none",opacity:0,marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px"});this.container.insert({top:this.sprite1});this.container.setStyle({display:"block"});this.state++;this.step=0;new Effect.Opacity(this.sprite2,{from:0,to:1,duration:0.4})}break;case 2:this.step++;if(this.step>=this.total){this.step=0}this.sprite1.setStyle({opacity:1});if(DM_Widget_PageItem_Video_Preview.step%2){this.sprite1.setStyle({top:"-"+(this.step*this.spriteStep)+"px"});new Effect.Opacity(this.sprite2,{from:1,to:0,duration:0.4})}else{this.sprite2.setStyle({top:"-"+(this.step*this.spriteStep)+"px"});new Effect.Opacity(this.sprite2,{from:0,to:1,duration:0.4})}break}this.timer=window.setTimeout(function(){DM_Widget_PageItem_Video_Preview.handler()},this.state==1?50:1000)},addToQuicklist:function(h,i,j){if(j){if(j.stopPropagation){j.stopPropagation()}else{j.cancelBubble=true}}if(i){if(!h.hasClassName("remove")){ajax_call("quicklist","add_to_quicklist",i,function(a){DM_Widget_Page.notify(a.evalJSON(true).quicklist_status,"page");h.addClassName("remove");if(h.hasClassName("name")!=true){h.remove()}})}else{ajax_call("quicklist","remove_to_quicklist",i,function(a){h.removeClassName("remove");if(h.hasClassName("name")!=true){h.remove()}})}}else{DM_Widget_PageItem_Video_Preview.outQuicklist(h);var h=$(h);var k=h.up("a");var l=k.id||k.findParamInClass("id");var e=k.getDimensions();h.hide().onclick=function(){return false};h.setStyle({width:e.width-2+"px",height:e.height-2+"px",background:"#ffffff",opacity:0.4}).show().ql=true;ajax_call("quicklist","add_to_quicklist",l,function(a){DM_JS.get("Extras",function(){Effect.Fade(h,{duration:0.5,from:0.4,to:0,delay:0.2,afterFinish:function(){h.writeAttribute("style","").addClassName("ql_done").removeClassName("ql_chkbx").show()}})});DM_Widget_Page.notify(a.evalJSON(true).quicklist_status,"page")})}},overQuicklist:function(b){if(!b.ql&&(!window.IEVersion||window.IEVersion>6)){if(DM_Widget_PageItem_Video_Preview.overQLEffect){DM_Widget_PageItem_Video_Preview.overQLEffect.cancel();DM_Widget_PageItem_Video_Preview.overQLEffect=null}DM_JS.get("Extras",function(){DM_Widget_PageItem_Video_Preview.overQLEffect=new Effect.Morph($(b),{style:"width:105px;",duration:DM_Widget_PageItem_Video_Preview.overQLDuration,delay:DM_Widget_PageItem_Video_Preview.overQLDelay})})}},outQuicklist:function(b){if(!b.ql&&(!window.IEVersion||window.IEVersion>6)){if(DM_Widget_PageItem_Video_Preview.overQLEffect){DM_Widget_PageItem_Video_Preview.overQLEffect.cancel();$(b).writeAttribute("style","")}}},initialize:function(){Event.onDOMReady(function(){if(!window.Sd_Video_PreviewTwig){EventSelectors.start(DM_Widget_PageItem_Video_Preview.rules)}})}};DM_Widget_PageItem_Video_Preview.initialize();(function(d){d.tiny=d.tiny||{};d.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false,callbacks:{}}};d.fn.tinyscrollbar=function(a){var b=d.extend({},d.tiny.scrollbar.options,a);this.each(function(){d(this).data("tsb",new c(d(this),b))});return this};d.fn.tinyscrollbar_update=function(b){var a=d(this).data("tsb");if(a){return a.update(b)}return false};function c(G,S){var O=this,D=G,P={obj:d(".viewport",G)},R={obj:d(".overview",G)},V={obj:d(".scrollbar",G)},M={obj:d(".track",V.obj)},H={obj:d(".thumb",V.obj)},N=S.axis==="x",L=N?"left":"top",B=N?"Width":"Height",F=0,J={start:0,now:0},K={},U="ontouchstart" in document.documentElement;function X(){O.update();E();return O}this.update=function(e){P[S.axis]=P.obj[0]["offset"+B];R[S.axis]=R.obj[0]["scroll"+B];R.ratio=P[S.axis]/R[S.axis];V.obj.toggleClass("disable",R.ratio>=1);M[S.axis]=S.size==="auto"?P[S.axis]:S.size;H[S.axis]=Math.min(M[S.axis],Math.max(0,(S.sizethumb==="auto"?(M[S.axis]*R.ratio):S.sizethumb)));V.ratio=S.sizethumb==="auto"?(R[S.axis]/M[S.axis]):(R[S.axis]-P[S.axis])/(M[S.axis]-H[S.axis]);F=(e==="relative"&&R.ratio<=1)?Math.min((R[S.axis]-P[S.axis]),Math.max(0,F)):0;F=(e==="bottom"&&R.ratio<=1)?(R[S.axis]-P[S.axis]):isNaN(parseInt(e,10))?F:parseInt(e,10);b()};function b(){var e=B.toLowerCase();H.obj.css(L,F/V.ratio);R.obj.css(L,-F);K.start=H.obj.offset()[L];V.obj.css(e,M[S.axis]);M.obj.css(e,M[S.axis]);H.obj.css(e,H[S.axis])}function E(){if(!U){H.obj.bind("mousedown",Q);M.obj.bind("mouseup",C)}else{P.obj[0].ontouchstart=function(e){if(1===e.touches.length){Q(e.touches[0]);e.stopPropagation()}}}if(S.scroll&&window.addEventListener){D[0].addEventListener("DOMMouseScroll",a,false);D[0].addEventListener("mousewheel",a,false);D[0].addEventListener("MozMousePixelScroll",function(e){e.preventDefault()},false)}else{if(S.scroll){D[0].onmousewheel=a}}}function Q(e){d("body").addClass("noSelect");var f=parseInt(H.obj.css(L),10);K.start=N?e.pageX:e.pageY;J.start=f=="auto"?0:f;if(!U){d(document).bind("mousemove",C);d(document).bind("mouseup",T);H.obj.bind("mouseup",T)}else{document.ontouchmove=function(g){g.preventDefault();C(g.touches[0])};document.ontouchend=T}}function a(e){if(R.ratio<1){var f=e||window.event,g=f.wheelDelta?f.wheelDelta/120:-f.detail/3;F-=g*S.wheel;F=Math.min((R[S.axis]-P[S.axis]),Math.max(0,F));H.obj.css(L,F/V.ratio);R.obj.css(L,-F);if(S.lockscroll||(F!==(R[S.axis]-P[S.axis])&&F!==0)){f=d.event.fix(f);f.preventDefault()}I()}}function C(e){if(R.ratio<1){if(S.invertscroll&&U){J.now=Math.min((M[S.axis]-H[S.axis]),Math.max(0,(J.start+(K.start-(N?e.pageX:e.pageY)))))}else{J.now=Math.min((M[S.axis]-H[S.axis]),Math.max(0,(J.start+((N?e.pageX:e.pageY)-K.start))))}F=J.now*V.ratio;R.obj.css(L,-F);H.obj.css(L,J.now);I()}}function T(){d("body").removeClass("noSelect");d(document).unbind("mousemove",C);d(document).unbind("mouseup",T);H.obj.unbind("mouseup",T);document.ontouchmove=document.ontouchend=null}function W(){if(R.obj.offset().top+R.obj.height()<=P.obj.offset().top+P.obj.height()){return true}return false}function I(){for(var e in S.callbacks){if(typeof S.callbacks[e]!=="function"){return}if(e==="onContentEndReached"){if(W()){S.callbacks[e]()}}}}return X()}}(jQuery));var Sd_Ticker={maximizedByClick:false,feedPageEmpty:false,feedPage:1,pageCountBeforeFoldingFriends:5,feedPageOnGoingCall:false,needsFeedData:true,needsFriendsData:true,isFBLogged:false,needsFadeOutId:null,isMouseDown:false,width:220,widthThreshold:1280,bottomBarHeight:36,callToFBConnectHeight:240,titleHeight:36,feedPercent:60,friendPercent:40,isScrollbarVisible:false,$clickedScrollbar:null,cache:{enable:true,suffix:null,feedKey:"ticker_feed",friendsKey:"ticker_friends",fbFriendsKey:"ticker_fbFriends",get:function(b){if(!Sd_Ticker.cache.isAvailable()){return null}return localStorage.getItem(b+Sd_Ticker.cache.suffix)},set:function(f,e,g){if(!Sd_Ticker.cache.isAvailable()){return null}try{localStorage.setItem(f+Sd_Ticker.cache.suffix,$j.toJSONString({data:e,expire:new Date().getTime()+g}))}catch(h){Sd_Ticker.log("error while doing localStorage.setItem");Sd_Ticker.log(h)}return null},clear:function(){var d=[];for(var c=0;c<localStorage.length;c++){if(localStorage.key(c).match(/^ticker/)!==null){d.push(localStorage.key(c))}}for(c=0;c<d.length;c++){localStorage.removeItem(d[c])}Sd_Ticker.log("Ticker cache cleared.")},supports_html5_storage:function(){try{return"localStorage" in window&&window.localStorage!==null}catch(b){return false}},isAvailable:function(){return Sd_Ticker.cache.supports_html5_storage()&&Sd_Ticker.cache.enable===true}},showTooltip:function(w){var q=$j(this),u=$j.parseJSON(q.attr("data-tooltip")),o=q.offset().top-w.data.container.offset().top,m="";u.vszone="ticker-tooltip-"+u.type;if(u.type=="user.joinGroup"||u.type=="user.subscribeUser"){m='<div class="counter"><%=data.counter%></div>'}var s='<div id="ticker_tooltip" class="<%=data.objclass.toLowerCase()%> <%=data.type.replace(\'.\', \'_\')%>"><div class="arrow"></div><div class="media clearfix">%%sublayout%%</div></div>',n='<div class="media main clearfix"><a href="<%=data.link%>" data-vszone="<%=data.vszone%>" class="<%=(data.objclass.toLowerCase() == "dm_video" ? "imgblock" : "img")%>" style="width:<%=data.image.width%>px; height:<%=data.image.height%>px;"><img src="<%=data.image.url%>" width="<%=data.image.width%>" height="<%=data.image.height%>" alt="" /><div class="play"></div><div class="live">LIVE</div></a><div class="bd"><a href="<%=data.link%>" data-vszone="<%=data.vszone%>" class="tooltip_title"><%=data.title%></a>'+m+"</div></div>%%tpl%%",l='<div class="media main clearfix"><% for (var i = 0; data.videos && i < data.videos.length; i++) { %><a href="<%=data.videos[i].link%>" data-vszone="<%=data.vszone%>" class="img"><img src="<%=data.videos[i].image.url%>" width="<%=data.videos[i].image.width%>" height="<%=data.videos[i].image.height%>" alt="" /><div class="play"></div></a><% } %><div class="bd"><a href="<%=data.link%>" class="name" data-vszone="<%=data.vszone%>"><%=data.title%></a></div></div>%%tpl%%',t=n,r=null;switch(u.type){case"user.joinGroup":case"user.subscribeUser":r='<div class="tpl subscribe"><div id="subscribe_button_ph"></div></div>';break;case"user.addComment":r='<div class="tpl comment"><div class="desc"><%=data.desc%></div><div class="media clearfix"><a href="<%=data.poster_link%>" class="img"><img src="<%=data.poster_avatar.url%>" width="<%=data.poster_avatar.width%>" height="<%=data.poster_avatar.height%>" alt="" /></a><div class="bd clearfix"><div class="message"><div class="comment"><%=data.comment%></div><div class="date_created"><%=data.date_created%></div></div></div></div></div>';break;case"user.rateVideo":r='<div class="tpl"><div class="desc"><%=data.desc%></div><div class="date_created"><%=data.date_created%></div><div class="action"><%=data.action%></div></div>';break;case"user.addVideoToPlaylist":t=l;r='<div class="tpl"><div class="counter"><%=data.counter%></div><div class="date_created"><%=data.date_created%></div></div>';break;default:r='<div class="tpl"><div class="desc"><%=data.desc%></div><div class="date_created"><%=data.date_created%></div></div>';break}Sd_Ticker.removeTooltip();w.data.container.append($j.tmpl(s.replace("%%sublayout%%",t).replace("%%tpl%%",r),u));var v=$j("#ticker_tooltip");if(u.type==="user.subscribeUser"){v.find("#subscribe_button_ph").replaceWith(q.find(".subscribe_button").clone())}v.css({top:o+"px"})},handleFeedItemClick:function(){document.location.href=$j.parseJSON($j(this).attr("data-tooltip")).link},loadFeedNextPage:function(){if(Sd_Ticker.feedPageEmpty){return}if(Sd_Ticker.feedPageOnGoingCall===true){return}Sd_Ticker.feedPageOnGoingCall=true;Sd_Ticker.feedPage++;$j("#feed_page_loader").addClass("loading");DM_WidgetV3.get("/controller/Shared_Ticker","#feed_page_ph",null,{feed:1,"feed-page":Sd_Ticker.feedPage},function(b){$j("#feed_page_loader").removeClass("loading");if(b.responseText===""){Sd_Ticker.feedPageEmpty=true;return}Sd_Ticker.feedPageOnGoingCall=false;$j("#scrollable_feed_section").tinyscrollbar_update("relative");if(Sd_Ticker.needsFeedRefill()){Sd_Ticker.loadFeedNextPage()}})},handleCloseFBCall:function(){setCookie("tchfb","1",7);$j("#fbc_call").remove();Sd_Ticker.setActivitiesHeight();Sd_Ticker.cache.clear()},removeTooltip:function(){$j("#ticker_tooltip").remove()},setMaximized:function(){var b=$j("#ticker");if($j(window).width()<=Sd_Ticker.widthThreshold){b.addClass("medium");$j("#bodyall").removeClass("tickermaxi");PubSub.publish("ticker:mediumized")}else{b.removeClass("medium");$j("#bodyall").addClass("tickermaxi");PubSub.publish("ticker:maximized",Sd_Ticker.maximizedByClick)}b.removeClass("minimized");deleteCookie("tickermini");if(Sd_Ticker.needsFeedData){Sd_Ticker.getFeed()}else{Sd_Ticker.setActivitiesHeight(false)}if(Sd_Ticker.needsFriendsData){Sd_Ticker.getFriends()}else{Sd_Ticker.setActivitiesHeight(false)}},setMinimized:function(b){$j("#ticker").addClass("minimized").removeClass("medium");$j("#bodyall").removeClass("tickermaxi");if(b){setCookie("tickermini","1","365")}PubSub.publish("ticker:minimized")},toggleSize:function(){if($j("#ticker").hasClass("minimized")){Sd_Ticker.maximizedByClick=true;Sd_Ticker.setMaximized()}else{Sd_Ticker.setMinimized(true);Sd_Ticker.maximizedByClick=false;var b="Minimize ticker "+($j(window).width()>=1280?"more than 1280":"less than 1280");PubSub.publish("sc:action",{context:"ticker",label:{action:"minimize",name:b}})}},initSize:function(){if(getCookie("tickermini")||$j(window).width()<=Sd_Ticker.widthThreshold||Sd_Ticker.needHide()){Sd_Ticker.setMinimized(false)}else{Sd_Ticker.setMaximized()}},needsFriendsFolding:function(){return localStorage.getItem("page_count")>Sd_Ticker.pageCountBeforeFoldingFriends},setActivitiesHeight:function(l,g){if(typeof g==="undefined"){g=false}var i=null;var k=null;if($j("#ticker").hasClass("medium")){i=Math.round(document.viewport.getHeight()*(3/4))}else{i=document.viewport.getHeight()}if(!g){if(Sd_Ticker.needsFriendsFolding()){Sd_Ticker.setFriendPercentSize(0);k=i-(Sd_Ticker.titleHeight*2+Sd_Ticker.bottomBarHeight)}else{if($j("#fbc_call").length!==0&&$j(window).width()>Sd_Ticker.widthThreshold){Sd_Ticker.setFeedPercentSize(100);k=i-(Sd_Ticker.callToFBConnectHeight+Sd_Ticker.titleHeight+Sd_Ticker.bottomBarHeight)}else{if($j("#friend_section").length===0){Sd_Ticker.setFeedPercentSize(100);k=i-(Sd_Ticker.titleHeight+Sd_Ticker.bottomBarHeight)}else{Sd_Ticker.setFeedPercentSize(60);k=i-(Sd_Ticker.titleHeight*2+Sd_Ticker.bottomBarHeight)}}}}else{k=i-(Sd_Ticker.titleHeight*2+Sd_Ticker.bottomBarHeight)}var h=Math.round(k*Sd_Ticker.feedPercent/100);var j=Math.round(k*Sd_Ticker.friendPercent/100);$j("#activities_cont").css("height",(i-Sd_Ticker.bottomBarHeight)+"px");if(l){$j("#feed_section").animate({height:h+"px"},{step:$j.proxy(Sd_Ticker.resizeScrollbar,$j("#scrollable_feed_section"))});if($j("#friend_section").length){$j("#friend_section").animate({height:j+"px"},{step:$j.proxy(Sd_Ticker.resizeScrollbar,$j("#scrollable_friend_section"))})}}else{if($j("#feed_section").length){$j("#feed_section").css("height",h+"px");Sd_Ticker.resizeScrollbar.apply($j("#scrollable_feed_section"))}if($j("#friend_section").length){$j("#friend_section").css("height",j+"px");Sd_Ticker.resizeScrollbar.apply($j("#scrollable_friend_section"))}}},resizeScrollbar:function(){this.tinyscrollbar_update("relative")},needHide:function(){return Sd_Ticker.mc_right_visible},handleWindowResize:function(b){if(getCookie("tickermini")){return}if($j(window).width()<=Sd_Ticker.widthThreshold||Sd_Ticker.needHide()){if(!Sd_Ticker.maximizedByClick){Sd_Ticker.setMinimized(false)}}else{Sd_Ticker.setMaximized();Sd_Ticker.maximizedByClick=false}if(Sd_Ticker.needsFeedRefill()){Sd_Ticker.loadFeedNextPage()}},handleClickOnFriend:function(g){var e=$j(g.target),h="";g.stopPropagation();if(e.hasClass("sd_user_subscribe")||e.closest(".sd_user_subscribe").length){PubSub.publish("sc:action",{context:"ticker",label:{action:"subscribe",name:"Subscribed"}});var f=e.closest(".media.friend");f.find(".opacity_handler").remove();f.find(".addto_small").remove();f.find(".checked_sign").show();$j("#feed_reloaded").show();Sd_Ticker.cache.clear();Sd_Ticker.getFeed();return}if(e.find("a.img").length){h=e.find("a.img").attr("href")}else{if(e.closest(".media.friend").find("a.img").length){h=e.closest(".media.friend").find("a.img").attr("href")}}if(h.length){document.location.href=h}},handleClickOnFeedTitle:function(){Sd_Ticker.setMinimized(true)},setFriendPercentSize:function(f,d,e){Sd_Ticker.feedPercent=100-f;Sd_Ticker.friendPercent=f},setFeedPercentSize:function(f,d,e){Sd_Ticker.feedPercent=f;Sd_Ticker.friendPercent=100-f},handleClickOnFriendTitle:function(d){var c=Sd_Ticker.friendPercent===0?40:0;if(c>0){localStorage.setItem("page_count",0)}else{localStorage.setItem("page_count",Sd_Ticker.pageCountBeforeFoldingFriends)}Sd_Ticker.setFriendPercentSize(c);Sd_Ticker.setActivitiesHeight(true,true)},handleMouseenterScrollbar:function(d){if(Sd_Ticker.isScrollbarVisible===true&&Sd_Ticker.needsFadeOutId!==null){clearTimeout(Sd_Ticker.needsFadeOutId);return}var c=$j(this);if($j(d.currentTarget).hasClass("scrollable_content")){Sd_Ticker.needsFadeOutId=setTimeout(function(){return Sd_Ticker.fadeOut(c)},1000)}Sd_Ticker.fadeIn(c)},handleMouseleaveScrollbar:function(){if(Sd_Ticker.isScrollbarVisible===false||Sd_Ticker.isMouseDown===true){return}Sd_Ticker.fadeOut($j(this));Sd_Ticker.isScrollbarVisible=false},handleMousedownScrollbar:function(b){b.stopPropagation();Sd_Ticker.$clickedScrollbar=$j(this);Sd_Ticker.isMouseDown=true;$j(document).on("mouseup",Sd_Ticker.handleMouseupScrollbar)},handleMouseupScrollbar:function(c){var d=$j(c.target);Sd_Ticker.isMouseDown=false;if(!d.hasClass("track")&&!d.hasClass("thumb")){Sd_Ticker.fadeOut(Sd_Ticker.$clickedScrollbar);Sd_Ticker.isScrollbarVisible=false}$j(document).off("mouseup",Sd_Ticker.handleMouseupScrollbar)},toggleFriendOpacity:function(){$j(this).siblings(".opacity_handler").toggle()},fadeOut:function(b){b.animate({opacity:0});Sd_Ticker.isScrollbarVisible=false},fadeIn:function(b){b.animate({opacity:1});Sd_Ticker.isScrollbarVisible=true},getFeedCallback:function(e){if(e!==null){Sd_Ticker.cache.set(Sd_Ticker.cache.feedKey,e.responseText,120000)}var f=$j("#ticker"),g=$j("#feed_scrollbar"),h=$j("#scrollable_feed_section");h.tinyscrollbar({sizethumb:50,callbacks:{onContentEndReached:Sd_Ticker.loadFeedNextPage}});Sd_Ticker.setActivitiesHeight(false);if(!$j("html").hasClass("ie")){h.on("mouseenter",$j.proxy(Sd_Ticker.handleMouseenterScrollbar,g));g.on({mouseenter:Sd_Ticker.handleMouseenterScrollbar,mouseleave:Sd_Ticker.handleMouseleaveScrollbar,mousedown:Sd_Ticker.handleMousedownScrollbar,mousedown:Sd_Ticker.removeTooltip});g.find(".thumb").on("mousedown",$j.proxy(Sd_Ticker.handleMousedownScrollbar,g)).on("mousedown",Sd_Ticker.removeTooltip)}f.on("mouseenter",".media.feed",{container:$j("#scrollable_feed_section")},Sd_Ticker.showTooltip).on("click",".media.feed",Sd_Ticker.handleFeedItemClick);h.on("mouseleave",Sd_Ticker.removeTooltip);$j("#feed_title").on("click",Sd_Ticker.handleClickOnFeedTitle);$j("#fbc_call_close").on("click",Sd_Ticker.handleCloseFBCall);$j("#feed_reloaded").hide();if(Sd_Ticker.needsFeedRefill()){Sd_Ticker.loadFeedNextPage()}},getFriendsCallback:function(f){if(f!==null){Sd_Ticker.cache.set(Sd_Ticker.cache.friendsKey,f.responseText,120000)}var d=$j("#friend_scrollbar"),e=$j("#scrollable_friend_section");e.tinyscrollbar({sizethumb:50});Sd_Ticker.setActivitiesHeight(false);if(!$j("html").hasClass("ie")){e.on("mouseenter",$j.proxy(Sd_Ticker.handleMouseenterScrollbar,d));d.on("mouseenter",Sd_Ticker.handleMouseenterScrollbar).on("mouseleave",Sd_Ticker.handleMouseleaveScrollbar).on("mousedown",Sd_Ticker.handleMousedownScrollbar);d.find(".thumb").on("mousedown",$j.proxy(Sd_Ticker.handleMousedownScrollbar,d))}$j("#friend_title").on("click",Sd_Ticker.handleClickOnFriendTitle);$j("#ticker .media.friend").on("click",Sd_Ticker.handleClickOnFriend);$j("#ticker .media.friend .addto_small").on("mouseenter",Sd_Ticker.toggleFriendOpacity).on("mouseleave",Sd_Ticker.toggleFriendOpacity)},getFeed:function(){var b=Sd_Ticker.cache.get(Sd_Ticker.cache.feedKey);Sd_Ticker.needsFeedData=false;if(b){b=b.evalJSON();if(b.expire>=new Date().getTime()){if($j("#feed_placeholder").length){$j("#feed_placeholder").replaceWith(b.data)}Sd_Ticker.getFeedCallback(null);return}}DM_WidgetV3.get("/controller/Shared_Ticker","#feed_placeholder",null,{feed:1},Sd_Ticker.getFeedCallback)},getFriends:function(){if(!Sd_Ticker.isFBLogged){return}var b=Sd_Ticker.cache.get(Sd_Ticker.cache.fbFriendsKey);Sd_Ticker.needsFriendsData=false;if(b){Sd_Ticker.getFriendsOnDM(b)}else{FB.api("/me/friends?fields=id,name,picture",function(a){if(!a||a.error){return}Sd_Ticker.cache.set(Sd_Ticker.cache.fbFriendsKey,a,86400000);Sd_Ticker.getFriendsOnDM(a)})}},getFriendsOnDM:function(d){var c=Sd_Ticker.cache.get(Sd_Ticker.cache.friendsKey);if(c){c=c.evalJSON();if(c.expire>=new Date().getTime()){if($j("#friends_placeholder").length){$j("#friends_placeholder").replaceWith(c.data)}Sd_Ticker.getFriendsCallback(null);return}}DM_WidgetV3.get("/controller/Shared_Ticker","#friends_placeholder",null,{friends:1,data:$j.toJSONString({data:d.data})},Sd_Ticker.getFriendsCallback,"post")},log:function(b){if(typeof console==="undefined"){return}if(DM_Environment==="prod"){return}console.log(b)},needsFeedRefill:function(){if($j("#feed_empty_message").length>0){return false}return $j("#feed_section").height()>$j("#feed_section .overview").height()},onMasscastStatus:function(c,d){if(c!="Right"){return}if(d=="handled"){Sd_Ticker.mc_right_visible=true;Sd_Ticker.initSize()}},initialize:function(){PubSub.subscribe("masscast:position_status",Sd_Ticker.onMasscastStatus);var b=parseInt(localStorage.getItem("page_count"),10)||0;localStorage.setItem("page_count",++b);$j(function(){if(typeof Sd_Ticker_enabled==="undefined"){return}if(!Sd_Ticker_enabled||top!==self){return}if(getCookie("login_infos")!==null){Sd_Ticker.cache.suffix="_"+getCookie("login_infos").evalJSON().login}else{Sd_Ticker.cache.suffix="_anon"}if(typeof Request.getQueryParams(document.location.search).fbc!=="undefined"){Sd_Ticker.cache.clear()}$j(window).on("resize",Sd_Ticker.handleWindowResize);PubSub.subscribe("dm:fb_logged",function(){return Sd_Ticker.isFBLogged=true});$j("#minimize, #maximize").on("click",Sd_Ticker.toggleSize);Sd_Ticker.initSize();if(!getCookie("tickermini")&&!$j("#ticker").hasClass("minimized")){PubSub.subscribe("dm:fb_logged",function(){Sd_Ticker.getFriends()})}if(typeof DM_KeyHandler!=="undefined"){DM_KeyHandler.registerAction("tcc",DM_KeyHandler.shift,Sd_Ticker.cache.clear)}})}};Sd_Ticker.initialize();BOOMR_start=new Date().getTime();(function(g){if(g.parent!==g&&document.getElementById("boomr-if-as")&&document.getElementById("boomr-if-as").nodeName.toLowerCase()==="script"){g=g.parent}var i,j,d,h=g.document;if(g.BOOMR===undefined){g.BOOMR={}}BOOMR=g.BOOMR;if(BOOMR.version){return}BOOMR.version="0.9";BOOMR.window=g;i={beacon_url:"",site_domain:g.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",onloadfired:false,handlers_attached:false,events:{page_ready:[],page_unload:[],dom_loaded:[],visibility_changed:[],before_beacon:[],click:[]},vars:{},disabled_plugins:{},onclick_handler:function(b){var a;if(!b){b=g.event}if(b.target){a=b.target}else{if(b.srcElement){a=b.srcElement}}if(a.nodeType===3){a=a.parentNode}if(a&&a.nodeName.toUpperCase()==="OBJECT"&&a.type==="application/x-shockwave-flash"){return}i.fireEvent("click",a)},fireEvent:function(f,b){var e,c,a;if(!this.events.hasOwnProperty(f)){return false}a=this.events[f];for(e=0;e<a.length;e++){c=a[e];c[0].call(c[2],b,c[1])}return true},addListener:function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}}}};j={t_start:BOOMR_start,t_end:null,utils:{objectToString:function(a,b){var c=[],e;if(!a||typeof a!=="object"){return a}if(b===undefined){b="\n\t"}for(e in a){if(Object.prototype.hasOwnProperty.call(a,e)){c.push(encodeURIComponent(e)+"="+encodeURIComponent(a[e]))}}return c.join(b)},getCookie:function(c){if(!c){return null}c=" "+c+"=";var b,a;a=" "+h.cookie+";";if((b=a.indexOf(c))>=0){b+=c.length;a=a.substring(b,a.indexOf(";",b));return a}return null},setCookie:function(f,e,n){var c,m,a,b;if(!f||!i.site_domain){return false}c=this.objectToString(e,"&");m=f+"="+c;a=[m,"path=/","domain="+i.site_domain];if(n){b=new Date();b.setTime(b.getTime()+n*1000);b=b.toGMTString();a.push("expires="+b)}if(m.length<4000){h.cookie=a.join("; ");return(c===this.getCookie(f))}return false},getSubCookies:function(c){var e,f,l,a,b={};if(!c){return null}e=c.split("&");if(e.length===0){return null}for(f=0,l=e.length;f<l;f++){a=e[f].split("=");a.push("");b[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return b},removeCookie:function(a){return this.setCookie(a,{},0)},pluginConfig:function(a,m,c,e){var f,b=0;if(!m||!m[c]){return false}for(f=0;f<e.length;f++){if(m[c][e[f]]!==undefined){a[e[f]]=m[c][e[f]];b++}}return(b>0)}},init:function(c){var a,e,b=["beacon_url","site_domain","user_ip"];if(!c){c={}}for(a=0;a<b.length;a++){if(c[b[a]]!==undefined){i[b[a]]=c[b[a]]}}if(c.log!==undefined){this.log=c.log}if(!this.log){this.log=function(){}}for(e in this.plugins){if(this.plugins.hasOwnProperty(e)){if(c[e]&&c[e].hasOwnProperty("enabled")&&c[e].enabled===false){i.disabled_plugins[e]=1;continue}else{if(i.disabled_plugins[e]){delete i.disabled_plugins[e]}}if(typeof this.plugins[e].init==="function"){this.plugins[e].init(c)}}}if(i.handlers_attached){return this}if(!i.onloadfired&&(c.autorun===undefined||c.autorun!==false)){if(h.readyState&&h.readyState==="complete"){this.setImmediate(BOOMR.page_ready,null,null,BOOMR)}else{if(g.onpagehide||g.onpagehide===null){i.addListener(g,"pageshow",BOOMR.page_ready)}else{i.addListener(g,"load",BOOMR.page_ready)}}}i.addListener(g,"DOMContentLoaded",function(){i.fireEvent("dom_loaded")});(function(){var f=function(){i.fireEvent("visibility_changed")};if(h.webkitVisibilityState){i.addListener(h,"webkitvisibilitychange",f)}else{if(h.msVisibilityState){i.addListener(h,"msvisibilitychange",f)}else{if(h.visibilityState){i.addListener(h,"visibilitychange",f)}}}i.addListener(h,"mouseup",i.onclick_handler);if(!g.onpagehide&&g.onpagehide!==null){i.addListener(g,"unload",function(){BOOMR.window=g=null})}}());i.handlers_attached=true;return this},page_ready:function(){if(i.onloadfired){return this}i.fireEvent("page_ready");i.onloadfired=true;return this},setImmediate:function(c,b,e,a){var f=function(){c.call(a||null,b,e||{});f=null};if(g.setImmediate){g.setImmediate(f)}else{if(g.msSetImmediate){g.msSetImmediate(f)}else{if(g.webkitSetImmediate){g.webkitSetImmediate(f)}else{if(g.mozSetImmediate){g.mozSetImmediate(f)}else{setTimeout(f,10)}}}}},subscribe:function(r,a,f,q){var e,b,s,c;if(!i.events.hasOwnProperty(r)){return this}s=i.events[r];for(e=0;e<s.length;e++){b=s[e];if(b[0]===a&&b[1]===f&&b[2]===q){return this}}s.push([a,f||{},q||null]);if(r==="page_ready"&&i.onloadfired){this.setImmediate(a,null,f,q)}if(r==="page_unload"){c=function(k){if(a){a.call(q,k||g.event,f)}};if(g.onpagehide||g.onpagehide===null){i.addListener(g,"pagehide",c)}else{i.addListener(g,"unload",c)}i.addListener(g,"beforeunload",c)}return this},addVar:function(c,b){if(typeof c==="string"){i.vars[c]=b}else{if(typeof c==="object"){var a=c,e;for(e in a){if(a.hasOwnProperty(e)){i.vars[e]=a[e]}}}}return this},removeVar:function(b){var c,a;if(!arguments.length){return this}if(arguments.length===1&&Object.prototype.toString.apply(b)==="[object Array]"){a=b}else{a=arguments}for(c=0;c<a.length;c++){if(i.vars.hasOwnProperty(a[c])){delete i.vars[a[c]]}}return this},sendBeacon:function(){var b,a,c,e=0;for(b in this.plugins){if(this.plugins.hasOwnProperty(b)){if(i.disabled_plugins[b]){continue}if(!this.plugins[b].is_complete()){return this}}}i.vars.v=BOOMR.version;i.vars.u=h.URL.replace(/#.*/,"");if(g!==window){i.vars["if"]=""}i.fireEvent("before_beacon",i.vars);if(!i.beacon_url){return this}a=[];for(b in i.vars){if(i.vars.hasOwnProperty(b)){e++;a.push(encodeURIComponent(b)+"="+(i.vars[b]===undefined||i.vars[b]===null?"":encodeURIComponent(i.vars[b])))}}a=i.beacon_url+((i.beacon_url.indexOf("?")>-1)?"&":"?")+a.join("&");BOOMR.debug("Sending url: "+a.replace(/&/g,"\n\t"));if(e){c=new Image();c.src=a}return this}};delete BOOMR_start;(function(){var a=function(b){return function(e,c){this.log(e,b,"boomerang"+(c?"."+c:""));return this}};j.debug=a("debug");j.info=a("info");j.warn=a("warn");j.error=a("error")}());if(g.YAHOO&&g.YAHOO.widget&&g.YAHOO.widget.Logger){j.log=g.YAHOO.log}else{if(g.Y&&g.Y.log){j.log=g.Y.log}else{if(typeof console==="object"&&console.log!==undefined){j.log=function(c,b,a){console.log(a+": ["+b+"] "+c)}}}}for(d in j){if(j.hasOwnProperty(d)){BOOMR[d]=j[d]}}BOOMR.plugins=BOOMR.plugins||{}}(window));(function(){BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};var b={complete:false,done:function(){var a=BOOMR.window,g,j,h,i;g=a.performance||a.msPerformance||a.webkitPerformance||a.mozPerformance;if(g&&g.timing&&g.navigation){BOOMR.info("This user agent supports NavigationTiming.","nt");j=g.navigation;h=g.timing;i={nt_red_cnt:j.redirectCount,nt_nav_type:j.type,nt_nav_st:h.navigationStart,nt_red_st:h.redirectStart,nt_red_end:h.redirectEnd,nt_fet_st:h.fetchStart,nt_dns_st:h.domainLookupStart,nt_dns_end:h.domainLookupEnd,nt_con_st:h.connectStart,nt_con_end:h.connectEnd,nt_req_st:h.requestStart,nt_res_st:h.responseStart,nt_res_end:h.responseEnd,nt_domloading:h.domLoading,nt_domint:h.domInteractive,nt_domcontloaded_st:h.domContentLoadedEventStart,nt_domcontloaded_end:h.domContentLoadedEventEnd,nt_domcomp:h.domComplete,nt_load_st:h.loadEventStart,nt_load_end:h.loadEventEnd,nt_unload_st:h.unloadEventStart,nt_unload_end:h.unloadEventEnd};if(h.secureConnectionStart){i.nt_ssl_st=h.secureConnectionStart}if(h.msFirstPaint){i.nt_first_paint=h.msFirstPaint}BOOMR.addVar(i)}if(a.chrome&&a.chrome.loadTimes){h=a.chrome.loadTimes();if(h){i={nt_spdy:(h.wasFetchedViaSpdy?1:0),nt_first_paint:h.firstPaintTime};BOOMR.addVar(i)}}this.complete=true;BOOMR.sendBeacon()}};BOOMR.plugins.NavigationTiming={init:function(){BOOMR.subscribe("page_ready",b.done,null,b);return this},is_complete:function(){return b.complete}}}());(function(e){var f=e.document,d;BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};d={initialized:false,complete:false,timers:{},cookie:"RT",cookie_exp:600,strict_referrer:true,navigationType:0,navigationStart:undefined,responseStart:undefined,t_start:undefined,t_fb_approx:undefined,r:undefined,r2:undefined,setCookie:function(a,i){var b,j=new Date().getTime(),c;if(!this.cookie){return this}c=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{};if(a){c[a]=j}c.r=f.URL.replace(/#.*/,"");if(a==="cl"){if(i){c.nu=i}else{if(c.nu){delete c.nu}}}if(i===false){delete c.nu}BOOMR.debug("Setting cookie "+BOOMR.utils.objectToString(c),"rt");if(!BOOMR.utils.setCookie(this.cookie,c,this.cookie_exp)){BOOMR.error("cannot set start cookie","rt");return this}b=new Date().getTime();if(b-j>50){BOOMR.utils.removeCookie(this.cookie);BOOMR.error("took more than 50ms to set cookie... aborting: "+j+" -> "+b,"rt")}return this},initFromCookie:function(){var a;if(!this.cookie){return}a=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie));if(!a){return}a.s=Math.max(+a.ul||0,+a.cl||0);BOOMR.debug("Read from cookie "+BOOMR.utils.objectToString(a),"rt");if(a.s&&a.r){this.r=a.r;if(!this.strict_referrer||this.r===this.r2||(a.s===+a.cl&&a.nu===f.URL.replace(/#.*/,""))){this.t_start=a.s;if(+a.hd>a.s){this.t_fb_approx=parseInt(a.hd,10)}}else{this.t_start=this.t_fb_approx=undefined}}},checkPreRender:function(){if(!(f.webkitVisibilityState&&f.webkitVisibilityState==="prerender")&&!(f.msVisibilityState&&f.msVisibilityState===3)){return false}BOOMR.plugins.RT.startTimer("t_load",this.navigationStart);BOOMR.plugins.RT.endTimer("t_load");BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart);BOOMR.plugins.RT.startTimer("t_postrender");BOOMR.subscribe("visibility_changed",BOOMR.plugins.RT.done,null,BOOMR.plugins.RT);return true},initNavTiming:function(){var c,a,b;if(this.navigationStart){return}a=e.performance||e.msPerformance||e.webkitPerformance||e.mozPerformance;if(a&&a.navigation){this.navigationType=a.navigation.type}if(a&&a.timing){c=a.timing}else{if(e.chrome&&e.chrome.csi&&e.chrome.csi().startE){c={navigationStart:e.chrome.csi().startE};b="csi"}else{if(e.gtbExternal&&e.gtbExternal.startE()){c={navigationStart:e.gtbExternal.startE()};b="gtb"}}}if(c){BOOMR.addVar("rt.start",b||"navigation");this.navigationStart=c.navigationStart||c.fetchStart||undefined;this.responseStart=c.responseStart||undefined;if(navigator.userAgent.match(/Firefox\/[78]\./)){this.navigationStart=c.unloadEventStart||c.fetchStart||undefined}}else{BOOMR.warn("This browser doesn't support the WebTiming API","rt")}return},page_unload:function(a){BOOMR.debug("Unload called with "+BOOMR.utils.objectToString(a),"rt");this.setCookie(a.type==="beforeunload"?"ul":"hd")},onclick:function(a){if(!a){return}BOOMR.debug("Click called with "+a.nodeName,"rt");while(a&&a.nodeName.toUpperCase()!=="A"){a=a.parentNode}if(a&&a.nodeName.toUpperCase()==="A"){BOOMR.debug("passing through","rt");this.setCookie("cl",a.href)}},domloaded:function(){BOOMR.plugins.RT.endTimer("t_domloaded")}};BOOMR.plugins.RT={init:function(a){BOOMR.debug("init RT","rt");if(e!==BOOMR.window){e=BOOMR.window;f=e.document}BOOMR.utils.pluginConfig(d,a,"RT",["cookie","cookie_exp","strict_referrer"]);d.initFromCookie();if(d.initialized){return this}d.complete=false;d.timers={};BOOMR.subscribe("page_ready",this.done,null,this);BOOMR.subscribe("dom_loaded",d.domloaded,null,d);BOOMR.subscribe("page_unload",d.page_unload,null,d);BOOMR.subscribe("click",d.onclick,null,d);if(BOOMR.t_start){this.startTimer("boomerang",BOOMR.t_start);this.endTimer("boomerang",BOOMR.t_end);this.endTimer("boomr_fb",BOOMR.t_start)}d.r=d.r2=f.referrer.replace(/#.*/,"");d.initialized=true;return this},startTimer:function(b,a){if(b){if(b==="t_page"){this.endTimer("t_resp",a)}d.timers[b]={start:(typeof a==="number"?a:new Date().getTime())};d.complete=false}return this},endTimer:function(b,a){if(b){d.timers[b]=d.timers[b]||{};if(d.timers[b].end===undefined){d.timers[b].end=(typeof a==="number"?a:new Date().getTime())}}return this},setTimer:function(b,a){if(b){d.timers[b]={delta:a}}return this},done:function(){BOOMR.debug("Called done","rt");var m,k=new Date().getTime(),b={t_done:1,t_resp:1,t_page:1},n=0,c,a,l=[];d.complete=false;d.initFromCookie();d.initNavTiming();if(d.checkPreRender()){return this}if(d.responseStart){this.endTimer("t_resp",d.responseStart);if(d.timers.t_load){this.setTimer("t_page",d.timers.t_load.end-d.responseStart)}else{this.setTimer("t_page",k-d.responseStart)}}else{if(d.timers.hasOwnProperty("t_page")){this.endTimer("t_page")}else{if(d.t_fb_approx){this.endTimer("t_resp",d.t_fb_approx);this.setTimer("t_page",k-d.t_fb_approx)}}}if(d.timers.hasOwnProperty("t_postrender")){this.endTimer("t_postrender");this.endTimer("t_prerender")}if(d.navigationStart){m=d.navigationStart}else{if(d.t_start&&d.navigationType!==2){m=d.t_start;BOOMR.addVar("rt.start","cookie")}else{BOOMR.addVar("rt.start","none");m=undefined}}this.endTimer("t_done",k);BOOMR.removeVar("t_done","t_page","t_resp","r","r2","rt.tstart","rt.bstart","rt.end","t_postrender","t_prerender","t_load");BOOMR.addVar("rt.tstart",m);BOOMR.addVar("rt.bstart",BOOMR.t_start);BOOMR.addVar("rt.end",d.timers.t_done.end);for(c in d.timers){if(d.timers.hasOwnProperty(c)){a=d.timers[c];if(typeof a.delta!=="number"){if(typeof a.start!=="number"){a.start=m}a.delta=a.end-a.start}if(isNaN(a.delta)){continue}if(b.hasOwnProperty(c)){BOOMR.addVar(c,a.delta)}else{l.push(c+"|"+a.delta)}n++}}if(n){BOOMR.addVar("r",d.r);if(d.r2!==d.r){BOOMR.addVar("r2",d.r2)}if(l.length){BOOMR.addVar("t_other",l.join(","))}}d.timers={};d.complete=true;BOOMR.sendBeacon();return this},is_complete:function(){return d.complete}}}(window));(function(){if(!window.BOOMREnabled||(window.BOOMRWaitForPlayer&&(window.videoHasPartnerPlayer||window.flashOK===false))){return}BOOMR.init({beacon_url:window.BOOMRBeaconUrl,log:null,autorun:!window.BOOMRWaitForPlayer});BOOMR.addVar("browser",$j.browser.name);BOOMR.addVar("country",window.DMContext?DMContext.geoip_country:"unknown");BOOMR.addVar("routename",window.DMContext?DMContext.route_name:"unknown");BOOMR.addVar("logged",window.DMContext?DMContext.is_logged:"unknown");BOOMR.addVar("AS",window.DMContext?DMContext.geoip_as:"unknown");BOOMR.subscribe("before_beacon",function(a){var c=["u","v","nt_red_cnt","nt_nav_type","nt_red_st","nt_red_end","nt_spdy","nt_dns_st","nt_dns_end","nt_con_st","nt_con_end","nt_unload_st","nt_unload_end","nt_domloading","nt_domint","nt_fet_st","nt_load_st","nt_domcomp","r","r2","t_other","rt.start","rt.tstart","rt.bstart","rt.end","nt_res_end"];for(var b=0,d=c.length;b<d;b++){BOOMR.removeVar(c[b])}if(a.nt_first_paint&&(a.nt_first_paint+"").match(/\./)){a.nt_first_paint=Math.ceil(a.nt_first_paint*1000)}BOOMR.addVar("t_toppage",dm_times.start);BOOMR.addVar("t_first_domready",dm_times.firstdomready)});if(window.BOOMRWaitForPlayer&&window.DM_Player){BOOMR.addVar("with_ad_call",window.auditudeEnabledForVideo);var k={pageLoaded:false,playerPlaying:false};function i(a){var b=true;k[a]=true;for(p in k){if(!k.hasOwnProperty(p)){continue}b=b&&k[p]}if(b){BOOMR.page_ready()}}function g(){for(var a=0,b=BOOMRPlayerEvents.length;a<b;a++){window.BOOMRPlayer.removeEventListener("on"+BOOMRPlayerEvents[a],'BOOMRProxyPlayerHandler("'+BOOMRPlayerEvents[a]+'")')}delete (window.BOOMRPlayer)}$j(window).on("load",function(){setTimeout(function(){i("pageLoaded")},0)}).on("beforeunload",function(){BOOMR.addVar("t_usergone",new Date().getTime());BOOMR.page_ready()});window.BOOMRProxyPlayerHandler=function(a){return function(b){if(a=="VideoMetadata"){BOOMR.addVar("cell",b.streamInfo?b.streamInfo.cell||"n/a":"n/a");return}if(a=="StateChange"){a=a+"_"+b}BOOMR.addVar("t_"+a,new Date().getTime());if(a=="VideoProgress"){g();i("playerPlaying")}}};for(var l=0,h=BOOMRPlayerEventsQueue.length;l<h;l++){var j=BOOMRPlayerEventsQueue[l];BOOMRProxyPlayerHandler(j[0])(j[1])}}window.bottomBOOMR=function(){BOOMR.addVar("t_env_top",dm_times.env_top);BOOMR.addVar("t_script_bottom",dm_times.script_bottom)}})();