function RemarketingTag(conversionId){this._conversionId=conversionId;}
RemarketingTag.prototype.track=function(customParameters){var img=document.createElement("img");img.onload=function(){return;};var cp=this.encodeCustomParameters(customParameters);img.src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/"+this.conversionId()+"/?value=0&label=pybDCLndxgIQp5yP5gg&guid=ON&script=0&data="+cp;return this;}
RemarketingTag.prototype.encodeCustomParameters=function(customParameters){var encoding=[];if(customParameters){for(var name in customParameters){if(customParameters.hasOwnProperty(name)){encoding.push(name+'%3D'+customParameters[name]);}}}
return encoding.join('%3B');}
RemarketingTag.prototype.conversionId=function(){return this._conversionId;}
RemarketingTag.prototype.trackProductPurchase=function(id,price){var parameters={prodid:id,pagetype:'purchase'};if(price){parameters.price=price;}
return this.track(parameters);}
RemarketingTag.prototype.trackOrder=function(id,total){var parameters={orderid:id,pagetype:'order'};if(total){parameters.total=total;}
return this.track(parameters);}
RemarketingTag.prototype.trackUserJoin=function(id){return this.track({userid:id,pagetype:'join'});}
var ZeroClipboard={version:"1.0.7",clients:{},moviePath:'ZeroClipboard.swf',nextId:1,$:function(thingy){if(typeof(thingy)=='string')thingy=document.getElementById(thingy);if(!thingy.addClass){thingy.hide=function(){this.style.display='none';};thingy.show=function(){this.style.display='';};thingy.addClass=function(name){this.removeClass(name);this.className+=' '+name;};thingy.removeClass=function(name){var classes=this.className.split(/\s+/);var idx=-1;for(var k=0;k<classes.length;k++){if(classes[k]==name){idx=k;k=classes.length;}}
if(idx>-1){classes.splice(idx,1);this.className=classes.join(' ');}
return this;};thingy.hasClass=function(name){return!!this.className.match(new RegExp("\\s*"+name+"\\s*"));};}
return thingy;},setMoviePath:function(path){this.moviePath=path;},dispatch:function(id,eventName,args){var client=this.clients[id];if(client){client.receiveEvent(eventName,args);}},register:function(id,client){this.clients[id]=client;},getDOMObjectPosition:function(obj,stopObj){var info={left:0,top:0,width:obj.width?obj.width:obj.offsetWidth,height:obj.height?obj.height:obj.offsetHeight};while(obj&&(obj!=stopObj)){info.left+=obj.offsetLeft;info.top+=obj.offsetTop;obj=obj.offsetParent;}
return info;},Client:function(elem){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId='ZeroClipboardMovie_'+this.id;ZeroClipboard.register(this.id,this);if(elem)this.glue(elem);}};ZeroClipboard.Client.prototype={id:0,ready:false,movie:null,clipText:'',handCursorEnabled:true,cssEffects:true,handlers:null,glue:function(elem,appendElem,stylesToAdd){this.domElement=ZeroClipboard.$(elem);var zIndex=99;if(this.domElement.style.zIndex){zIndex=parseInt(this.domElement.style.zIndex,10)+1;}
if(typeof(appendElem)=='string'){appendElem=ZeroClipboard.$(appendElem);}
else if(typeof(appendElem)=='undefined'){appendElem=document.getElementsByTagName('body')[0];}
var box=ZeroClipboard.getDOMObjectPosition(this.domElement,appendElem);this.div=document.createElement('div');var style=this.div.style;style.position='absolute';style.left=''+box.left+'px';style.top=''+box.top+'px';style.width=''+box.width+'px';style.height=''+box.height+'px';style.zIndex=zIndex;if(typeof(stylesToAdd)=='object'){for(addedStyle in stylesToAdd){style[addedStyle]=stylesToAdd[addedStyle];}}
appendElem.appendChild(this.div);this.div.innerHTML=this.getHTML(box.width,box.height);},getHTML:function(width,height){var html='';var flashvars='id='+this.id+'&width='+width+'&height='+height;if(navigator.userAgent.match(/MSIE/)){var protocol=location.href.match(/^https/i)?'https://':'http://';html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+protocol+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+width+'" height="'+height+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+flashvars+'"/><param name="wmode" value="transparent"/></object>';}
else{html+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+width+'" height="'+height+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+flashvars+'" wmode="transparent" />';}
return html;},hide:function(){if(this.div){this.div.style.left='-2000px';}},show:function(){this.reposition();},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML='';var body=document.getElementsByTagName('body')[0];try{body.removeChild(this.div);}catch(e){;}
this.domElement=null;this.div=null;}},reposition:function(elem){if(elem){this.domElement=ZeroClipboard.$(elem);if(!this.domElement)this.hide();}
if(this.domElement&&this.div){var box=ZeroClipboard.getDOMObjectPosition(this.domElement);var style=this.div.style;style.left=''+box.left+'px';style.top=''+box.top+'px';}},setText:function(newText){this.clipText=newText;if(this.ready)this.movie.setText(newText);},addEventListener:function(eventName,func){eventName=eventName.toString().toLowerCase().replace(/^on/,'');if(!this.handlers[eventName])this.handlers[eventName]=[];this.handlers[eventName].push(func);},setHandCursor:function(enabled){this.handCursorEnabled=enabled;if(this.ready)this.movie.setHandCursor(enabled);},setCSSEffects:function(enabled){this.cssEffects=!!enabled;},receiveEvent:function(eventName,args){eventName=eventName.toString().toLowerCase().replace(/^on/,'');switch(eventName){case'load':this.movie=document.getElementById(this.movieId);if(!this.movie){var self=this;setTimeout(function(){self.receiveEvent('load',null);},1);return;}
if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var self=this;setTimeout(function(){self.receiveEvent('load',null);},100);this.ready=true;return;}
this.ready=true;this.movie.setText(this.clipText);this.movie.setHandCursor(this.handCursorEnabled);break;case'mouseover':if(this.domElement&&this.cssEffects){this.domElement.addClass('hover');if(this.recoverActive)this.domElement.addClass('active');}
break;case'mouseout':if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass('active')){this.domElement.removeClass('active');this.recoverActive=true;}
this.domElement.removeClass('hover');}
break;case'mousedown':if(this.domElement&&this.cssEffects){this.domElement.addClass('active');}
break;case'mouseup':if(this.domElement&&this.cssEffects){this.domElement.removeClass('active');this.recoverActive=false;}
break;}
if(this.handlers[eventName]){for(var idx=0,len=this.handlers[eventName].length;idx<len;idx++){var func=this.handlers[eventName][idx];if(typeof(func)=='function'){func(this,args);}
else if((typeof(func)=='object')&&(func.length==2)){func[0][func[1]](this,args);}
else if(typeof(func)=='string'){window[func](this,args);}}}}};var Ppr=function(){return{initCopyLink:function(){ZeroClipboard.setMoviePath('/flash/ZeroClipboard10.swf');var clip=new ZeroClipboard.Client();clip.setText(jQuery("#personalize_url_full").val());clip.glue('copy_to_clipboard_button','copy_to_clipboard_container');},init:function(){Ppr.initCopyLink();ideeli.orders.initReturnPolicyPopups()
var showmenu=ideeli.masthead.showMenus();if(showmenu){jQuery('#nav-one-hep').removeClass('no_dropdowns');ideeli.channels.select_channel('');}}}}();var NR_QUEUE=[];typeof window.NREUMQ!="undefined"?NR_QUEUE=NREUMQ:typeof window.EPISODES!="undefined"?NR_QUEUE=EPISODES.q:typeof window.NREUM!="undefined"&&(NR_QUEUE=NREUM.q);var NREUM=NREUM||{};NREUM.q=NR_QUEUE,NREUM.targetOrigin=document.location.protocol+"//"+document.location.host,NREUM.version=16,NREUM.autorun="undefined"!=typeof NREUM.autorun?NREUM.autorun:!0,NREUM.init=function(){NREUM.bDone=!1,NREUM.cycle=0,NREUM.logging=!1,NREUM.contentLoadFired=!1,NREUM.marks={},NREUM.measures={},NREUM.starts={},NREUM.findStartTime(),NREUM.load=null,NREUM.addEventListener("beforeunload",NREUM.beforeUnload,!1),NREUM.addEventListener("pagehide",NREUM.beforeUnload,!1),NREUM.processQ(),NREUM.beacon=null,NREUM.licenseKey=null,NREUM.applicationID=null,NREUM.transactionName=null,NREUM.txnParam=null,NREUM.unloaded=!1,document.readyState==="complete"?NREUM.domContentLoaded():"undefined"!=typeof document.addEventListener?document.addEventListener("DOMContentLoaded",NREUM.domContentLoaded,!1):"undefined"!=typeof document.attachEvent&&document.attachEvent("onreadystatechange",NREUM.readyStateChange),NREUM.load||document.loaded?NREUM.onload():NREUM.addEventListener("load",NREUM.onload,!1)},NREUM.processQ=function(){var a=NREUM.q.length,b,c,d;for(d=0;d<a;d++)b=NREUM.q[d],c=b[0],"mark"===c?NREUM.mark(b[1],b[2]):"measure"===c?NREUM.measure(b[1],b[2],b[3]):"done"===c?NREUM.done(b[1]):"nrf"===c||"nrfinish"===c?NREUM.nrfinish("t",b[1],b[2],b[3],b[4],b[5],b[6],b[7]):"nrf2"===c||"nrfinish2"===c?NREUM.nrfinish("to",b[1],b[2],b[3],b[4],b[5],b[6],b[7]):"load"===c?NREUM.load=b[1]:NREUM.dprint("Unknown queue command "+c)},NREUM.nrfinish=function(a,b,c,d,e,f,g,h){NREUM.dprint("NREUM: finish data received"),NREUM.txnParam=a,NREUM.beacon=b,NREUM.licenseKey=c,NREUM.applicationID=d,NREUM.transactionName=e,NREUM.measures.qt=f,NREUM.measures.ap=g,NREUM.dom_end_time=h},NREUM.mark=function(a,b){NREUM.dprint("NREUM.mark: "+a+", "+b);a?(NREUM.marks[a]=parseInt(b||(new Date).getTime(),10),"firstbyte"===a?(NREUM.measure("be","starttime","firstbyte"),NREUM.dom_start_time=NREUM.marks.firstbyte):"onload"===a?NREUM.measure("fe","firstbyte","onload"):"domContent"===a&&NREUM.measure("dc","firstbyte","domContent")):NREUM.dprint("Error: markName is undefined in NREUM.mark.")},NREUM.measure=function(a,b,c){NREUM.dprint("NREUM.measure: "+a+", "+b+", "+c);if(!a)NREUM.dprint("Error: episodeName is undefined in NREUM.measure.");else{var d;if("undefined"==typeof b)"number"==typeof NREUM.marks[a]?d=NREUM.marks[a]:d=(new Date).getTime();else if("number"==typeof NREUM.marks[b])d=NREUM.marks[b];else if("number"==typeof b)d=b;else{NREUM.dprint("Error: unexpected startNameOrTime in NREUM.measure: "+b);return}var e;if("undefined"==typeof c)e=(new Date).getTime();else if("number"==typeof NREUM.marks[c])e=NREUM.marks[c];else if("number"==typeof c)e=c;else{NREUM.dprint("NREUM: Error: unexpected endNameOrTime in NREUM.measure: "+c);return}NREUM.starts[a]=parseInt(d,10),NREUM.measures[a]=parseInt(e-d,10)}},NREUM.done=function(a){NREUM.bDone||(NREUM.bDone=!0,NREUM.mark("done"),NREUM.autorun&&NREUM.sendBeacon(),"function"==typeof a&&a())},NREUM.getMarks=function(){return NREUM.marks},NREUM.getMeasures=function(){return NREUM.measures},NREUM.getStarts=function(){return NREUM.starts},NREUM.sendBeacon=function(){var a=document.getElementById("nreum-send-beacon");if(!a){NREUM.processQ(),NREUM.domContentLoaded();if(NREUM.licenseKey===null||NREUM.applicationID===null){NREUM.dprint("NREUM: licenseKey or applicationID has not been set");return}NREUM.dom_end_time&&NREUM.dom_start_time&&(NREUM.dprint("NREUM: picking up DOM processing time from embedded JS"),NREUM.mark("domContent",NREUM.dom_end_time)),NREUM.load&&(NREUM.dprint("NREUM: picking up load event time from embedded JS"),NREUM.mark("onload",NREUM.load));var b=NREUM.getMeasures(),c="",d;for(d in b)c+=d+"="+b[d]+"&";var e;if(c){e=("http:"===document.location.protocol?"http:":"https:")+"//"+NREUM.beacon+"/1/"+NREUM.licenseKey,e+="?a="+NREUM.applicationID+"&",e+=c,NREUM.transactionName!==null&&NREUM.transactionName.length>0&&(e+=NREUM.txnParam+"="+encodeURIComponent(NREUM.transactionName),e+="&v="+NREUM.version);var f=new Image;f.src=e;var g=document.createElement("script");g.type="text/x-nreum-data",g.id="nreum-send-beacon",document.body.appendChild(g),NREUM.dprint("NREUM: (new) data sent",e)}}},NREUM.inlineHit=function(a,b,c,d,e,f){NREUM.cycle+=1;NREUM.licenseKey===null||NREUM.applicationID===null?NREUM.dprint("NREUM: licenseKey or applicationID has not been set"):(img=new Image,url=("http:"===document.location.protocol?"http:":"https:")+"//"+NREUM.beacon+"/1/"+NREUM.licenseKey,url+="?a="+NREUM.applicationID+"&",url+="t="+a+"&",url+="qt="+b+"&",url+="ap="+c+"&",url+="be="+d+"&",url+="dc="+e+"&",url+="fe="+f+"&",url+="c="+NREUM.cycle,img.src=url,NREUM.dprint("NREUM Inline: "+url))},NREUM.findStartTime=function(){var a=NREUM.findStartWebTiming()||NREUM.findStartGToolbar()||NREUM.findStartCookie();a?NREUM.mark("starttime",a):NREUM.dprint("NREUM: Error: couldn't find a start time")},NREUM.findStartWebTiming=function(){var a,b=window.performance||window.mozPerformance||window.msPerformance||window.webkitPerformance;"undefined"!=typeof b&&"undefined"!=typeof b.timing&&"undefined"!=typeof b.timing.navigationStart&&(a=b.timing.navigationStart,NREUM.dprint("NREUM.findStartWebTiming: startTime = "+a));return a},NREUM.findStartGToolbar=function(){var a;try{window.external&&window.external.pageT?a=(new Date).getTime()-window.external.pageT:window.gtbExternal&&window.gtbExternal.pageT?a=(new Date).getTime()-window.gtbExternal.pageT():window.chrome&&window.chrome.csi&&(a=(new Date).getTime()-window.chrome.csi().pageT),a&&NREUM.dprint("NREUM.findStartGToolbar: startTime = "+a)}catch(b){}return a},NREUM.findStartCookie=function(){var a=document.cookie.split(" "),b,c;for(b=0;b<a.length;b++)if(0===a[b].indexOf("NREUM=")){var d,e,f=a[b].substring("NREUM=".length).split("&"),g,h;for(c=0;c<f.length;c++)0===f[c].indexOf("s=")?g=f[c].substring(2):0===f[c].indexOf("p=")?(e=f[c].substring(2),e.charAt(e.length-1)===";"&&(e=e.substr(0,e.length-1))):0===f[c].indexOf("r=")&&(d=f[c].substring(2),d.charAt(d.length-1)===";"&&(d=d.substr(0,d.length-1)));if(d){var i=encodeURIComponent(document.referrer);h=i===d,h||(h=encodeURIComponent(document.location)===d&&i===e)}if(h&&g){NREUM.dprint("NREUM.findStartCookie: startTime = "+g);return g}}return undefined},NREUM.beforeUnload=function(a){if(!NREUM.unloaded){var b=new Date;b.setTime(b.getTime()+6e4),document.cookie="NREUM=s="+Number(new Date)+"&r="+encodeURIComponent(document.location)+"&p="+encodeURIComponent(document.referrer)+"; expires="+b.toGMTString()+"; path=/",NREUM.unloaded=!0}},NREUM.onload=function(a){NREUM.mark("onload"),NREUM.autorun&&NREUM.done()},NREUM.domContentLoaded=function(a){NREUM.contentLoadFired||(NREUM.mark("domContent",(new Date).getTime()),NREUM.contentLoadFired=!0)},NREUM.readyStateChange=function(a){document.readyState==="complete"&&NREUM.domContentLoaded()},NREUM.addEventListener=function(a,b,c){if("undefined"!=typeof window.attachEvent)return window.attachEvent("on"+a,b);if(window.addEventListener)return window.addEventListener(a,b,c)},"undefined"!=typeof console&&"undefined"!=typeof console.log?NREUM.dprint=function(a){NREUM.logging&&console.log(a)}:NREUM.dprint=function(a){},NREUM.init()
var Hum=(function(obj){var hum=obj||{},marks={};hum.init=function(location,opts){var q=HUMQ||[];q.push(['lastByte',new Date().getTime()]);var labs_data=(ideeli!=null&&ideeli.labs!=null)?ideeli.labs.evData():null;var labs_experiments=(labs_data!=null)?labs_data['experiments']:{};var opts_with_labs=jQuery.extend({},opts,{'labs_experiments':labs_experiments||{}});if(!window.HumDomLoaded){window.HumDomLoaded={};hum.attachEventHanders(q,location,opts_with_labs);};return true;};hum.attachEventHanders=function(humQueue,location,opts_with_labs){jQuery(document).ready(function(){humQueue.push(["domReady",new Date().getTime()]);});jQuery(window).load(function(){humQueue.push(["pageReady",new Date().getTime()]);hum.parseHUMQ(humQueue,location,opts_with_labs);});};hum.parameterizeMarks=function(){var params="?widget=hum&",validMarks=['firstByte','lastByte','domReady','pageReady'];for(var mark in marks){if(validMarks.indexOf(mark)>-1){params+=''+mark+'='+marks[mark]+'&';}}
return params.slice(0,params.length-1);};hum.parameterizeOpts=function(opts){var params=jQuery.param(opts);return params;};hum.parseHUMQ=function(humq,location,opts){var i=0;for(i=0;i<humq.length;i++){marks[humq[i][0]]=humq[i][1];}
return hum.reportBack(location,opts);};hum.reportBack=function(location,opts){var img=new Image();var params=hum.parameterizeMarks();params+='&'+hum.parameterizeOpts(opts);img.src=location+params;footer=jQuery('#footer_wrapper #footer_hidden');if(footer.length==0){document.body.appendChild(img);}else{footer.append(img);}
return true;};return hum;}(Hum||{}));var Cookie={set:function(name,value,expires){var expire='';if(!expires)expires=365;if(expires&&(typeof expires=='number'||expires.toUTCString)){var date;if(typeof expires=='number'){date=new Date();date.setTime(date.getTime()+(expires*24*60*60*1000));}else{date=expires;}
expire='expires='+date.toUTCString();}
var path="path=/"
var cookieValue=encodeURIComponent(name)+'='+encodeURIComponent(value||'')+'; '+path+'; '+expire+';';return document.cookie=cookieValue;},get:function(name){var cookie=document.cookie.match(new RegExp('(^|;)\\s*'+encodeURIComponent(name)+'=([^;\\s]+)'));return(cookie?decodeURIComponent(cookie[2]):null);},erase:function(name){var cookie=Cookie.get(name)||true;Cookie.set(name,'',-1);return cookie;},eraseAll:function(){var cookieString=""+document.cookie;var cookieArray=cookieString.split("; ");for(var i=0;i<cookieArray.length;++i)
{var singleCookie=cookieArray[i].split("=");if(singleCookie.length!=2)
continue;var name=decodeURIComponent(singleCookie[0]);Cookie.erase(name);}},accept:function(){if(typeof navigator.cookieEnabled=='boolean'){return navigator.cookieEnabled;}
Cookie.set('_test','1');return(Cookie.erase('_test')==='1');},exists:function(cookieName){var cookieValue=Cookie.get(cookieName);if(!cookieValue)return false;return cookieValue.toString()!="";}};var Flash=new Object();Flash.data={};Flash.transferFromCookies=function(){var data=unescape(Cookie.get("flash")).evalJSON();if(!data)data={};Flash.data=data;Cookie.erase("flash");};Flash.writeDataTo=function(name,element){element=$(element);var content="";if(Flash.data[name]){content=Flash.data[name].toString().gsub(/\+/,' ');}
if(element&&!content.blank()){element.update(unescape(content));if(!content.blank()&&!element.visible()){element.show();}}};Flash.showMessages=function(){Flash.transferFromCookies();Flash.writeDataTo('error',$('error_div_id'));Flash.writeDataTo('notice',$('notice_div_id'));$('notice_div_id').observe('click',function(){$('notice_div_id').hide();});};var ChannelTab=Class.create({initialize:function(el,clickListener){this.click=clickListener;this.channelEl=el;this.channelMenu=this.channelEl.next('.channel_menu_container');this.channel=this.channelEl.readAttribute('data-channel-type');this.shouldShowMenu=parseInt(this.channelEl.readAttribute('data-show-menu'),10)==1;this.boundSelectedListener=this.selected.bindAsEventListener(this);this.boundUnselectedListener=this.unselected.bindAsEventListener(this);this.boundClickListener=function(ev){if(history.pushState){ev.preventDefault();}
this.click(this.channel,true);}.bindAsEventListener(this);this.boundOverListener=this.mouseover.bindAsEventListener(this);this.boundOutListener=this.mouseout.bindAsEventListener(this);this.boundMenuOverListener=this.menuOver.bindAsEventListener(this);this.setUpMouseEvents();if(this.channelMenu){this.channelMenu.observe('mouseover',this.boundMenuOverListener);this.channelMenu.observe('mouseout',this.boundOutListener);}
this.over=false;this.channelEl.observe('click',this.boundClickListener);},setUpMouseEvents:function(){this.channelEl.observe('mouseover',this.boundOverListener);this.channelEl.observe('mouseout',this.boundOutListener);},tearDownMouseEvents:function(){this.channelEl.stopObserving('mouseover',this.boundOverListener);this.channelEl.stopObserving('mouseout',this.boundOutListener);},mouseover:function(event){this.over=true;if(this.channelMenu.down('li')||this.channel==='travel'){this.showMenu();}},menuOver:function(event){this.over=true;},mouseout:function(event){this.over=false;setTimeout(function(){if(!this.over){this.hideMenu();}}.bind(this),10);},showMenu:function(){setTimeout(function(){this.channelEl.addClassName('select');if(this.shouldShowMenu){if(Prototype.Browser.IE){if(this.channelEl.addClassName){this.channelEl.addClassName('sfHover');}}
if(this.channelMenu.appear){this.channelMenu.appear({duration:0.1});}}}.bind(this),10);},hideMenu:function(){this.channelMenu.fade({duration:0.1});$$('a.channel').invoke('removeClassName','select');if($('channel_link_'+ideeli.channels.selected_channel)){$('channel_link_'+ideeli.channels.selected_channel).addClassName('select');}
if(Prototype.Browser.IE){$$('.sfHover').invoke('removeClassName','sfHover');}},selected:function(){this.channelEl.addClassName('select');},unselected:function(){this.channelEl.removeClassName('select');}});if(typeof ideeli==='undefined'){ideeli={};}
ideeli.channels=(function(){return{selected_channel:'',init:function(){window.channel_tabs=[];$$('a.channel').each(function(channel_el){window.channel_tabs.push(new ChannelTab(channel_el,ideeli.latest_events.go_to_channel));});},load_channel:function(channel,channels){if(channel=='travel'&&$$('.channel_menu_single_container_travel')[0]){channel=ideeli.my_channels.first();}
if(window.current_user&&(window.current_user.hep_group_id>window.ELIGIBLE_HEP_GROUP_ID)&&channel=='all'){channel='women';}
ideeli.channels.select_channel(channel);},select_channel:function(channel_name){ideeli.channels.select_tab(channel_name);if($(channel_name+'_events_channel_container')){$$('.events_channel_container').invoke('hide');$(channel_name+'_events_channel_container').show();ideeli.channels.update_channel_cookie(channel_name);$$('.events_channel_container').invoke('update','<img src="http://0.cdn.ideeli.net/images/frontend/loading.gif" />');var url='/events/latest_by_channel_'+channel_name;if(channel_name=="ideelaccess"||channel_name=="group_buy"){window.opPage='shopping_events-latest-ideelaccess';var t=-1;if(window.current_user){try{t=Cookie.get("picked_iazone").evalJSON();if(window.ideeli.ideelaccess_dropdown_list.collect(function(d){return d[0];}).indexOf(t)<0){t=-1;}}
catch(e){t=-1;}}
url+="/"+t;}else{window.opPage='shopping_events-latest';}
if(window.opCodeVersions&&window.opCodeVersions[window.opPage]){window.opPage+="-v"+window.opCodeVersions[window.opPage];}
if(window.location.toString().match(/force_cache_write\=1/)){url+='?force_cache_write=1';}
var request=new Ajax.Updater(channel_name+'_events_channel_container',url,{method:'get',onComplete:function(){window.latest_events_loader=new LatestEventsLoader($('latest_json_url').getValue());},evalScripts:true});}},goto_channel:function(channel_name){if((channel_name=='travel'&&$$('.channel_menu_single_container_travel')[0])||window.isHepLatest){return false;}else{window.location.href='/events/latest#'+channel_name;ideeli.channels.select_channel(channel_name);return false;}},select_tab:function(channel_name){ideeli.channels.selected_channel=channel_name;ideeli.channels.update_channel_cookie(channel_name);$$('a.channel').invoke('removeClassName','select');$$('a.channel img').invoke('removeClassName','current_channel');if($('channel_link_'+channel_name)){$('channel_link_'+channel_name).addClassName('select');}
if(channel_name=='ideelaccess'){setTimeout(ideeli.iADropdown.select_locations.bind(ideeli.iADropdown),10);}},update_channel_cookie:function(channel_name){Cookie.set('channel',channel_name,0.5);},get_default_channel_from_cookie:function(default_channel){return(Cookie.exists('channel')?Cookie.get('channel'):default_channel);},get_channel_from_url:function(){var url_parts=window.location.pathname.split("/");var size=url_parts.length;var channel=url_parts[size-1];if(window.channels&&window.channels.include(channel)){return channel;}
var channel=(window.location.hash||'').replace('#','');if(window.channels&&window.channels.include(channel)){return channel;}
return window.preferred_channel||'all';},get_tab_to_be_selected:function(related_channels,fallback_channel){if(history.pushState){return ideeli.channels.get_channel_from_url();}
var channel_href=window.location.href.match(/#(\w+)/);if(channel_href&&related_channels.include(channel_href[1])){return channel_href[1];}
if(Cookie.exists('channel')&&related_channels.include(Cookie.get('channel'))){return Cookie.get('channel');}
return(related_channels.size()>0?related_channels[0]:fallback_channel);},get_ideelaccess_cached_menu:function(){var url='/events/ideelaccess_cached_menu_fragment/-1';if(window.location.toString().match(/force_cache_write\=1/)){url+='?force_cache_write=1';}
var req=new Ajax.Updater('ideelaccess_column_items',url,{method:'get'});},set_back_to_sales_channel:function(proper_names){if($('back_to_ideeli')){if(Cookie.exists('channel')){var source_channel=Cookie.get('channel');var channel_hash='#'+source_channel;window.back_to_sale='/events/latest'+channel_hash;$('back_to_ideeli').update('BACK TO '+proper_names[source_channel]);}else{window.back_to_sale='/events/latest';$('back_to_ideeli').update('BACK TO SALES');}}}};}());ideeli.iADropdown=(function(){return{init:function(){window.ideelAccessLocations=[];},current_city:'',current_target_area:null,write_cities:function(cityHTML){if(ideeli.iADropdown.current_city==''){ideeli.iADropdown.current_city=window.ideeli.ideelaccess_dropdown_list[0][1];};if($('ideelaccess_filter_cities')&&$('ideelaccess_current_location').innerHTML.length<5){$('ideelaccess_filter_cities').update(cityHTML);$('ideelaccess_current_location').update(ideeli.iADropdown.current_city);if($('ia_target_'+ideeli.iADropdown.current_target_area)){$('ia_target_'+ideeli.iADropdown.current_target_area).remove();}}
else if(!$('ideelaccess_current_location')||$('ideelaccess_current_location').innerHTML.length<5){setTimeout(function(){this.write_cities(cityHTML);}.bind(this),100);}},toggle_dropdown:function(){$('ideelaccess_location_dropdown').toggleClassName('location_dropdown_closed','location_dropdown_open');},change_location:function(target_area){this.current_target_area=target_area;if(window.current_user){window.current_user.default_iazone=target_area;Cookie.set('picked_iazone',target_area);}
ideeli.channels.select_channel('ideelaccess');ideeli.iADropdown.select_locations();},select_locations:function(){if(window.ideeli.ideelaccess_dropdown_list){var data=window.ideeli.ideelaccess_dropdown_list;var t=-1;if(window.current_user){try{t=Cookie.get("picked_iazone").evalJSON();if(data.collect(function(d){return d[0];}).indexOf(t)<0){t=-1;}}catch(e){t=-1;}}
ideeli.iADropdown.current_target_area=t;var cityHTML='',cityHTMLid='',cityHTMLids=[];data.each(function(item){try{if(ideeli.iADropdown.current_target_area==-1){ideeli.iADropdown.current_city=data[0][1];ideeli.iADropdown.current_target_area=-1;}else if(ideeli.iADropdown.current_target_area==0){ideeli.iADropdown.current_city=data[1][1];ideeli.iADropdown.current_target_area=0;}else if(ideeli.iADropdown.current_target_area&&ideeli.iADropdown.current_target_area==item[0]){ideeli.iADropdown.current_city=item[1];ideeli.iADropdown.current_target_area=item[0];}else if(!ideeli.iADropdown.current_target_area&&target&&target==item[0]){ideeli.iADropdown.current_city=item[1];ideeli.iADropdown.current_target_area=item[0];}}catch(e){ideeli.iADropdown.current_target_area=-1;ideeli.iADropdown.current_city=data[0][1];}
cityHTMLid='ia_target_'+item[0];if(cityHTMLids.indexOf(cityHTMLid)<0){cityHTML+='<li id="'+(cityHTMLid)+'" onclick="'+('ideeli.iADropdown.change_location(\''+(item[0])+'\')"');if(data.last()==item){cityHTML+=' class="ial_select_last_hover"';}
cityHTML+='>'+(item[1])+'</li>';var target=-1;if(window.current_user){try{target=Cookie.get("picked_iazone").evalJSON();if(window.ideeli.ideelaccess_dropdown_list.collect(function(d){return d[0];}).indexOf(target)<0){target=-1;}}catch(e){target=window.current_user.default_iazone;}}
cityHTMLids.push(cityHTMLid);}},this);ideeli.iADropdown.write_cities(cityHTML);}else{setTimeout(function(){this.select_locations();}.bind(this),10);}}};}());var LatestEventsLoader=Class.create({initialize:function(fetch_url){this.latest_events_data={};this.latest_events=[];this.fetch_url=fetch_url;this.boundStoreJSON=this.storeJSON.bind(this);this.boundClickTrack=this.clickTrack.bindAsEventListener(this);this.fetch();return this;},createEvents:function(){window.latest_data={premium_only_event_ids:this.latest_events_data.collect(function(latest_event){if(latest_event.first_row_only){return latest_event.event_id;}}).compact(),event_ids:this.latest_events_data.collect(function(latest_event){return latest_event.event_id;})};this.latest_events_data.each(function(latest_event){if($('polaroid_'+latest_event.event_id)||$('ideelaccess3_'+latest_event.event_id)){this.latest_events.push(new LatestEvent(latest_event,this.latest_events.size));}}.bind(this));this.markAsViewed();this.attachClickTrack();this.periodicalDealCounterRefresh();return true;},fetch:function(){var req=new Ajax.Request(this.fetch_url,{'method':'get','asynchronous':true,'evalJSON':true,'onComplete':this.boundStoreJSON,'onError':this.showLoadError,'onFailure':this.showLoadError});return true;},attachClickTrack:function(){$$('a.click_track').invoke('observe','click',this.boundClickTrack);},markAsViewed:function(){var uniq_ids=[],ids=[],event_id='',position='';$$('a.click_track').each(function(ele){event_id=ele.readAttribute('data-event-id');position=ele.readAttribute('data-grid-position');if(uniq_ids.indexOf(event_id)<0){uniq_ids.push(event_id);ids.push([event_id,position]);}});var req=new Ajax.Request('/el/image/latest_view/spacer.gif',{method:'get',parameters:Object.toQueryString({'ids[]':ids})});},showLoadError:function(message){ideeli.cart.message('Error loading latest events. '+message);return true;},showLoadInterrupted:function(message){ideeli.cart.message('Loading events interrupted... '+message);return true;},storeJSON:function(transport){if(transport&&transport.responseText&&(transport.getHeader('Content-Type').match(/application\/json/)||transport.getHeader('Content-Type').match(/text\/javascript/))){this.latest_events_data=transport.responseText.evalJSON();if(this.latest_events_data&&Object.isArray(this.latest_events_data)){this.createEvents();return true;}}
this.showLoadInterrupted('');return false;},clickTrack:function(ev){var el=ev.findElement('a.click_track');var event_id=el.readAttribute('data-event-id');var grid_position=el.readAttribute('data-grid-position');var grid_version=ideeli.channels.selected_channel;var params={'type':'latest_click','location':grid_position,'version':grid_version};new Ajax.Request('/el/click_track/'+event_id,{parameters:params,evalScripts:false,method:'get'});return true;}});var LatestEvent=Class.create({initialize:function(event_data,event_position){this.event_data=event_data;this.event_data_hash=$H(event_data);this.event_data_hash.update({grid_position:event_position});this.now=Clock.getNow();this.seconds_left=this.event_data.end_at-this.now;this.templates=this.generateTemplates();this.start();},generateTemplates:function(){return{'latestEventContainerBegin':new Template('<div id="event_#{event_id}" class="latest_event_container">'),'latestEventDefaultImageFirstRow':new Template('<div id="event_image_#{event_id}" class="latest_event_image first_row_only"><a class="click_track" data-grid-position="#{grid_position}" data-event-id="#{event_id}" href="#{event_url}">#{first_row_corner_image}#{latest_event_default_image}</a></div>'),'latestEventDefaultImage':new Template('<div id="event_image_#{event_id}" class="latest_event_image"><a class="click_track" data-grid-position="#{grid_position}" data-event-id="#{event_id}" href="#{event_url}">#{latest_event_default_image}</a></div>'),'latestEventTitleContainerBegin':new Template('<div id="event_title_#{event_id}" class="latest_event_title">'),'latestEventTitleContainerBox':new Template('<div id="event_title_box_#{event_id}" class="latest_event_title_box"><div class="title_inner_wrapper"><a class="click_track" data-grid-position="#{grid_position}" data-event-id="#{event_id}" href="#{event_url}">#{event_title}</a><br /><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track subtitle" href="#{event_url}">#{event_subtitle}</a></div></div>'),'latestEventTitleContainerBoxLogo':new Template('<div id="event_title_box_#{event_id}" class="latest_event_title_box"><a class="click_track" data-grid-position="#{grid_position}" data-event-id="#{event_id}" href="#{event_url}">#{event_logo_image}</a></div>'),'latestEventBoxBegin':new Template('<div id="event_box_#{event_id}">'),'latestEventTimers':new Template('<div id="event_timer_box_#{event_id}" class="latest_event_details_box latest_event_timers_box">'),'latestEventTimersBlock':new Template('<div id="latest_timer_#{event_id}" class="latest_timer">'),'latestEventTimersBeginsIn':new Template('<div class="timer_label" id="event_begins_in_#{event_id}" style="display: none">Begins In</div><div class="timer_latest" id="timer_event_begins_in_#{event_id}" style="display: none"><span id="countdown_event_start_#{event_id}" class="timer"></span></div>'),'latestEventTimersExclusiveEndsIn':new Template('<div class="timer_label" id="upgrade_presale_#{event_id}" style="display: none">Begins In</div><div class="timer_latest non_premium_timer" id="non_premium_timer_#{event_id}" style="display: none"><span id="countdown_event_exclusive_period_end_#{event_id}" class="timer"></span></div><div class="timer_label" id="upgrade_presale_msg_#{event_id}" style="display: none"><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{upgrade_url}">Upgrade For Access</a></div>'),'latestEventTimersExclusiveEndsInGiveaway':new Template('<div class="timer_label" id="upgrade_presale_#{event_id}" style="display: none">Begins In</div><div class="timer_latest non_premium_timer giveaway" id="non_premium_timer_#{event_id}" style="display: none"><span id="countdown_event_exclusive_period_end_#{event_id}" class="timer"></span></div><div class="timer_label" id="upgrade_presale_msg_#{event_id}" style="display: none"><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{upgrade_url}">Upgrade For Access</a></div>'),'latestEventTimersExclusiveEndsInFirstRow':new Template('<div class="timer_label" id="upgrade_presale_#{event_id}" style="display: none">Begins In</div><div class="timer_latest non_premium_timer first_row_only" id="non_premium_timer_#{event_id}" style="display: none"><span id="countdown_event_exclusive_period_end_#{event_id}" class="timer"></span></div><div class="timer_label" id="upgrade_presale_msg_#{event_id}" style="display: none"><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{upgrade_url}">Upgrade For Access</a></div>'),'latestEventTimersExclusiveEndsInFirstRowGiveaway':new Template('<div class="timer_label" id="upgrade_presale_#{event_id}" style="display: none">Begins In</div><div class="timer_latest non_premium_timer giveaway first_row_only" id="non_premium_timer_#{event_id}" style="display: none"><span id="countdown_event_exclusive_period_end_#{event_id}" class="timer"></span></div><div class="timer_label" id="upgrade_presale_msg_#{event_id}" style="display: none"><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{upgrade_url}">Upgrade For Access</a></div>'),'latestEventTimersEndsIn':new Template('<div class="timer_label event_ends_in" id="event_ends_in_#{event_id}" style="display: none">Ends In</div><div class="timer_latest" id="timer_event_ends_in_#{event_id}" style="display: none"><span id="countdown_event_end_#{event_id}" class="timer"></span></div>'),'latestEventTimersEndsInGiveaway':new Template('<div class="timer_label event_ends_in" id="event_ends_in_#{event_id}" style="display: none">Random Drawing In</div><div class="timer_latest" id="timer_event_ends_in_#{event_id}" style="display: none"><span id="countdown_event_end_#{event_id}" class="timer"></span></div>'),'latestEventTimersOther':new Template('<div class="sell_out_note" id="sell_out_note_#{event_id}" style="display: none">&nbsp;</div><div class="timer_latest event_over" id="event_over_#{event_id}" style="display: none">Event Over</div>'),'latestEventTimersBlockEnd':new Template('</div>'),'latestEventGiveawayEnd':new Template('<div class="timer_latest" style="display:none"><span id="countdown_giveaway_end_#{event_id}" class="timer"></span></div>'),'latestEventUpgradeSaleRunning':new Template('<div class="upgrade_sale_running" id="upgrade_sale_running_#{event_id}" style="display: none"><div class="timer_latest">Want Access?</div><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{upgrade_url}">Upgrade</a></div>'),'latestEventJoin':new Template('<div class="join" id="upgrade_join_#{event_id}" style="display: none"><div class="timer_latest">Want Access?</div><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{join_url}">Join</a></div></div>'),'latestEventVisitButton':new Template('<div id="event_visit_box_#{event_id}" class="latest_event_details_box"><a data-grid-position="#{grid_position}" data-event-id="#{event_id}" class="click_track" href="#{event_url}">#{visit_event_button}</a></div>'),'latestEventBoxEnd':new Template('</div>'),'latestEventTitleContainerEnd':new Template('</div>'),'latestEventContainerEnd':new Template('</div>')}},start:function(){if(this.seconds_left<1){TimerHelper.hideElementsForEvent(this.event_data.event_id,['event_ends_in_','timer_event_ends_in_','upgrade_sale_running_','upgrade_presale_msg_','upgrade_join_','sell_out_note_','non_premium_timer_']);TimerHelper.showElementsForEvent(this.event_data.event_id,['event_over_']);}
else{if(this.event_data.giveaway_only){if(this.event_data.start_at>this.now){TimerHelper.showElementsForEvent(this.event_data.event_id,['event_begins_in_','timer_event_begins_in_']);this.countdown=new EventStartsCountdown('countdown_event_start_'+this.event_data.event_id,this.event_data.start_at,{'shopping_event':this,'now':this.now});}
else{TimerHelper.showElementsForEvent(this.event_data.event_id,['event_ends_in_','timer_event_ends_in_']);this.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_data.event_id,this.event_data.end_at,{'shopping_event':this,'now':this.now});}}
else{setTimeout(this.startTimers.bind(this),100);}}},startTimers:function(){if(typeof(window.current_user)=='undefined'){ideeli.masthead.init();setTimeout(this.startTimers.bind(this),100);}
else{if((!window.current_user||window.current_user.is_premium_member.blank())&&(this.event_data.first_row_only||(this.now<(this.event_data.start_at+3600)))){if(!window.current_user){TimerHelper.showElementsForEvent(this.event_data.event_id,['event_ends_in_','timer_event_ends_in_','sell_out_note_']);this.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_data.event_id,this.event_data.end_at,{'shopping_event':this,'now':this.now});}
else{TimerHelper.hideElementsForEvent(this.event_data.event_id,['event_ends_in_','timer_event_ends_in_','sell_out_note_']);TimerHelper.showElementsForEvent(this.event_data.event_id,['upgrade_presale_','non_premium_timer_','upgrade_presale_msg_']);this.countdown=new EventExclusiveEndsCountdown('countdown_event_exclusive_period_end_'+this.event_data.event_id,(this.event_data.start_at+3600),{'shopping_event':this,'now':this.now});}}
else if((window.current_user&&window.current_user.is_premium_member==true)&&(this.now<this.event_data.start_at)){TimerHelper.hideElementsForEvent(this.event_data.event_id,['event_ends_in_','timer_event_ends_in_']);TimerHelper.showElementsForEvent(this.event_data.event_id,['event_begins_in_','timer_event_begins_in_']);this.countdown=new EventStartsCountdown('countdown_event_start_'+this.event_data.event_id,this.event_data.start_at,{'shopping_event':this,'now':this.now});}
else{TimerHelper.hideElementsForEvent(this.event_data.event_id,['event_begins_in_','timer_event_begins_in_','non_premium_timer_']);TimerHelper.showElementsForEvent(this.event_data.event_id,['event_ends_in_','timer_event_ends_in_','sell_out_note_']);this.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_data.event_id,this.event_data.end_at,{'shopping_event':this,'now':this.now});}}},draw:function(){return'';if(this.event_data.first_row_only&&!this.event_data.giveaway_only){return this.drawFirstRowSale();}
else if(this.event_data.first_row_only&&this.event_data.giveaway_only){return this.drawFirstRowGiveaway();}
else if(!this.event_data.first_row_only&&!this.event_data.giveaway_only){return this.drawSale();}
else if(!this.event_data.first_row_only&&this.event_data.giveaway_only){return this.drawGiveaway();}
return false;},drawFirstRowSale:function(){return''+
(this.templates.latestEventContainerBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventDefaultImageFirstRow.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerBegin.evaluate(this.event_data_hash))+
(this.event_data.use_logo_image?this.templates.latestEventTitleContainerBoxLogo.evaluate(this.event_data_hash):this.templates.latestEventTitleContainerBox.evaluate(this.event_data_hash))+
(this.templates.latestEventBoxBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventTimers.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlock.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBeginsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersExclusiveEndsInFirstRow.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersEndsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersOther.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlockEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventUpgradeSaleRunning.evaluate(this.event_data_hash))+
(this.templates.latestEventJoin.evaluate(this.event_data_hash))+
(this.templates.latestEventVisitButton.evaluate(this.event_data_hash)).gsub(/<img /,"<img onmouseover=\"this.old_src = this.src;this.src = '"+(this.event_data.visit_event_button_over)+"'\" onmouseout=\"this.src = this.old_src;\" ")+
(this.templates.latestEventBoxEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventContainerEnd.evaluate(this.event_data_hash));},drawFirstRowGiveaway:function(){return''+
(this.templates.latestEventContainerBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventDefaultImageFirstRow.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerBegin.evaluate(this.event_data_hash))+
(this.event_data.use_logo_image?this.templates.latestEventTitleContainerBoxLogo.evaluate(this.event_data_hash):this.templates.latestEventTitleContainerBox.evaluate(this.event_data_hash))+
(this.templates.latestEventBoxBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventTimers.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlock.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBeginsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersExclusiveEndsInFirstRowGiveaway.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersEndsInGiveaway.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersOther.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlockEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventGiveawayEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventUpgradeSaleRunning.evaluate(this.event_data_hash))+
(this.templates.latestEventJoin.evaluate(this.event_data_hash))+
(this.templates.latestEventVisitButton.evaluate(this.event_data_hash)).gsub(/<img /,"<img onmouseover=\"this.old_src = this.src;this.src = '"+(this.event_data.visit_event_button_over)+"'\" onmouseout=\"this.src = this.old_src;\" ")+
(this.templates.latestEventBoxEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventContainerEnd.evaluate(this.event_data_hash));},drawSale:function(){return''+
(this.templates.latestEventContainerBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventDefaultImage.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerBegin.evaluate(this.event_data_hash))+
(this.event_data.use_logo_image?this.templates.latestEventTitleContainerBoxLogo.evaluate(this.event_data_hash):this.templates.latestEventTitleContainerBox.evaluate(this.event_data_hash))+
(this.templates.latestEventBoxBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventTimers.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlock.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBeginsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersExclusiveEndsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersEndsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersOther.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlockEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventUpgradeSaleRunning.evaluate(this.event_data_hash))+
(this.templates.latestEventJoin.evaluate(this.event_data_hash))+
(this.templates.latestEventVisitButton.evaluate(this.event_data_hash)).gsub(/<img /,"<img onmouseover=\"this.old_src = this.src;this.src = '"+(this.event_data.visit_event_button_over)+"'\" onmouseout=\"this.src = this.old_src;\" ")+
(this.templates.latestEventBoxEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventContainerEnd.evaluate(this.event_data_hash));},drawGiveaway:function(){return''+
(this.templates.latestEventContainerBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventDefaultImage.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerBegin.evaluate(this.event_data_hash))+
(this.event_data.use_logo_image?this.templates.latestEventTitleContainerBoxLogo.evaluate(this.event_data_hash):this.templates.latestEventTitleContainerBox.evaluate(this.event_data_hash))+
(this.templates.latestEventBoxBegin.evaluate(this.event_data_hash))+
(this.templates.latestEventTimers.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlock.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBeginsIn.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersExclusiveEndsInGiveaway.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersEndsInGiveaway.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersOther.evaluate(this.event_data_hash))+
(this.templates.latestEventTimersBlockEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventGiveawayEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventUpgradeSaleRunning.evaluate(this.event_data_hash))+
(this.templates.latestEventJoin.evaluate(this.event_data_hash))+
(this.templates.latestEventVisitButton.evaluate(this.event_data_hash)).gsub(/<img /,"<img onmouseover=\"this.old_src = this.src;this.src = '"+(this.event_data.visit_event_button_over)+"'\" onmouseout=\"this.src = this.old_src;\" ")+
(this.templates.latestEventBoxEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventTitleContainerEnd.evaluate(this.event_data_hash))+
(this.templates.latestEventContainerEnd.evaluate(this.event_data_hash));}});var Clock=function(){var ticking=false,periodicalExecuter;return{fromBrowser:function(){return parseInt((new Date().getTime())/1000);},fromCookie:function(){var now=Cookie.get('now');if(now){return window.now=now;}
return false;},fromServer:function(){var req=jQuery.ajax({url:'/now',async:false,dataType:'json',success:function(response_json){if(response_json&&response_json.now){window.now=json.now;}else{window.now=Clock.fromBrowser();}},error:function(response){window.now=Clock.fromBrowser();}});},getNow:function(){if(typeof(window.now)=='undefined'&&!Clock.fromCookie()){Clock.fromServer();}
if(!ticking){Clock.start();}
return window.now;},start:function(){periodicalExecuter=new PeriodicalExecuter(function(){window.now=(parseInt(window.now)+1);},1);ticking=true;},stop:function(){periodicalExecuter.stop();ticking=false;},tick:function(){window.now+=1;}}}();var Countdown=Class.create({initialize:function(draw_el,end_at,options){this.options=options;this.end_at=end_at;this.now=Clock.getNow();this.seconds_left=end_at-this.now;this.draw_el=jQuery('#'+draw_el);},draw:function(){if(this.draw_el){this.draw_el.html(TimerHelper.secondsToTime(this.seconds_left));}},start:function(){this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},tick:function(){this.seconds_left=this.seconds_left-1;this.draw();if(this.options.aboutToExpireTime&&this.options.aboutToExpireTime>=this.seconds_left){this.draw_el.trigger('countdown.aboutToExpire');}
if(this.seconds_left<1){this.timeover();}},timeover:function(){this.periodicalExecuter.stop();this.draw_el.html('completed');this.draw_el.trigger('countdown.timeover');}});var EventStartsCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.event_id=this.draw_el.attr('id').match(/(\d+)$/)[1];this.start();},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},upgradeMessage:function(){if(typeof(window.current_user)=='undefined'){ideeli.masthead.init();setTimeout(this.upgradeMessage.bind(this),100);}
else{if(window.current_user&&window.current_user.is_premium_member==true){TimerHelper.hideElementsForEvent(this.event_id,['upgrade_presale_','non_premium_timer_','upgrade_presale_msg_','upgrade_sale_running']);TimerHelper.showElementsForEvent(this.event_id,['timer_event_ends_in_','event_ends_in_']);this.options.shopping_event.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_id,this.options.shopping_event.event_data.end_at,{'shopping_event':this.options.shopping_event,'now':this.now});}
else if(window.current_user&&!window.current_user.is_premium_member.blank()){TimerHelper.hideElementsForEvent(this.event_id,['upgrade_presale_','non_premium_timer_','upgrade_presale_msg_','upgrade_sale_running']);TimerHelper.showElementsForEvent(this.event_id,['timer_event_ends_in_','event_ends_in_']);this.options.shopping_event.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_id,this.options.shopping_event.event_data.end_at,{'shopping_event':this.options.shopping_event,'now':this.now});}
else if(window.current_user){if(jQuery('#non_premium_timer_'+this.event_id)&&!(jQuery('#non_premium_timer_'+this.event_id).hasClassName('giveaway')||jQuery('#non_premium_timer_'+this.event_id).hasClassName('first_row_only'))){TimerHelper.hideElementsForEvent(this.event_id,['timer_event_ends_in_','event_ends_in_']);TimerHelper.showElementsForEvent(this.event_id,['upgrade_presale_','non_premium_timer_','upgrade_presale_msg_','upgrade_sale_running']);}}}},timeoverListener:function(ev){if(this.seconds_left<1){TimerHelper.hideElementsForEvent(this.event_id,['timer_event_begins_in_','event_begins_in_']);if(jQuery('#non_premium_timer_'+this.event_id)&&jQuery('#non_premium_timer_'+this.event_id).hasClass('giveaway')){TimerHelper.showElementsForEvent(this.options.shopping_event.event_data.event_id,['timer_event_ends_in_','event_ends_in_']);this.options.shopping_event.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_id,this.options.shopping_event.event_data.end_at,{'shopping_event':this.options.shopping_event,'now':this.now});}
setTimeout("jQuery('#timer_event_begins_in_"+(this.event_id)+"').hide();jQuery('#event_begins_in_"+(this.event_id)+"').hide();",400);setTimeout(this.upgradeMessage.bind(this),100);if(jQuery('#giveaway_enter_disabled')&&jQuery('#giveaway_enter')){jQuery('#giveaway_enter_disabled').hide();jQuery('#giveaway_enter').show();}
if(jQuery('#see_drawing_disabled')&&jQuery('#see_drawing')){jQuery('#see_drawing_disabled').hide();jQuery('#see_drawing').show();}
if(typeof(Refresh)!='undefined'&&Refresh&&Refresh.refreshPage){Refresh.refreshPage();}}}});var EventEndsCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.event_id=options.shopping_event.event_data.event_id;this.start();},start:function(){if(jQuery(this.draw_el)){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));}
this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},timeoverListener:function(event){if(this.seconds_left<1){TimerHelper.hideElementsForEvent(this.event_id,['event_ends_in_','timer_event_ends_in_','upgrade_sale_running_','upgrade_presale_msg_','upgrade_join_','sell_out_note_','non_premium_timer_']);TimerHelper.showElementsForEvent(this.event_id,['event_over_']);if(jQuery('#enter_giveaway_before_drawing')&&jQuery('#enter_giveaway_before_drawing:visible')){try{var match=window.location.href.match(/(.*)(\/.*)/);var url=match[1];url+='/refresh_friends_joined';if(match[2].match(/enter_giveaway/)){var countdown=Math.floor(Math.random()*31)*1000;var timeout=setTimeout("jQuery.get('"+url+"', {method: 'get'})",countdown);}}
catch(e){window.location.reload();}}
if(Refresh&&Refresh.refreshPage){Refresh.refreshPage();}
if(Refresh&&Refresh.refreshGiveAway){Refresh.refreshGiveAway();}}}});var SweepstakeEndsCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.event_id=options.shopping_event.event_data.event_id;this.offer_id=options.shopping_event.event_data.offer_id;this.start();},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},timeoverListener:function(event){if(this.seconds_left<1){TimerHelper.hideElementsForEvent(this.event_id,['event_ends_in_','timer_event_ends_in_','upgrade_sale_running_','upgrade_presale_msg_','upgrade_join_','sell_out_note_','non_premium_timer_']);TimerHelper.showElementsForEvent(this.event_id,['event_over_']);if(jQuery('#status')){jQuery('#status').show();}
if(jQuery('#get_more_entries_container')){jQuery('#get_more_entries_container').hide();}
jQuery('#winnerarea').load('/store/list_winners/'+this.offer_id);jQuery('#feedback').load('/store/drawing_feedback/'+this.offer_id);}}});var EventExclusiveEndsCountdown=Class.create(Countdown,{initialize:function($super,draw_el,exclusive_end_at,options){$super(draw_el,exclusive_end_at,options);this.event_id=this.draw_el.attr('id').match(/(\d+)$/)[1];this.start();},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},timeoverListener:function(event){if(this.seconds_left<1){TimerHelper.hideElementsForEvent(this.event_id,['event_begins_in_','timer_event_begins_in_','non_premium_timer_','upgrade_presale_','non_premium_timer_','upgrade_presale_msg_']);TimerHelper.showElementsForEvent(this.event_id,['event_ends_in_','timer_event_ends_in_','sell_out_note_']);this.options.shopping_event.countdown=new EventEndsCountdown('countdown_event_end_'+this.event_id,this.options.shopping_event.event_data.end_at,{'shopping_event':this.options.shopping_event,'now':this.now});}}});var MastheadCartCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.seconds_left=Math.min(this.seconds_left,this.options.max);this.start();this.draw_el.show();jQuery('#cart_masthead_timer').show();},aboutToExpireListener:function(){try{if(window.current_user&&(window.current_user.current_order_id==null||Cookie.get('two_minute_cart_warning')==window.current_user.current_order_id||window.current_user.cart_items_count==0)){return;}
Cookie.set('two_minute_cart_warning',window.current_user.current_order_id);if(ideeli.cart&&!ideeli.cart.isCartOpen()){ideeli.two_minute_warning.showModal($('two_minute_warning_modal'),596);}}
catch(e){return;}},draw:function(){this.draw_el.html(TimerHelper.secondsToMins(this.seconds_left));},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.draw_el.bind('countdown.aboutToExpire',jQuery.proxy(this,'aboutToExpireListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},stop:function(){this.draw_el.unbind('countdown.timeover',this.timeoverListener);this.draw_el.html('');this.periodicalExecuter.stop();},timeoverListener:function(event){if(this.seconds_left<1){if(ideeli.two_minute_warning){ideeli.two_minute_warning.close();}
ideeli.cart.emptyCart();}else{}}});if(typeof(ideeli)=='undefined'){ideeli={};}
ideeli.two_minute_warning=function(){return{attachCloseOnOverlayClick:function(){if(this.modal){jQuery('#control_overlay').bind('click',this.close.bind(this));}},close:function(){if(this.modal){this.modal.close();}},open:function(){if(this.modal){this.modal.open();}},check_out_now:function(not_at_checkout){if(this.modal){var url='/el/image/two_minute_warning_modal_checkout_click/1/spacer.gif'
var req=jQuery.post(url);this.modal.close();if(not_at_checkout){ideeli.PromotionEngine.fire('cart_open','open');ideeli.cart.open();}}},afterOpen:function(){var url='/el/image/two_minute_warning_modal_shown/1/spacer.gif'
var req=jQuery.post(url);},showModal:function(el,width){if(jQuery("#quick_buy_modal").dialog("isOpen")){jQuery("#quick_buy_modal").dialog("close");}
this.modal=new Control.Modal(el,{closeOnClick:'overlay',constrainToViewport:true,fade:false,offsetTop:0,onComplete:this.attachCloseOnOverlayClick.bind(this),overlayOpacity:0.5,parameters:{},position:[parseInt((document.viewport.getWidth()-width)/2),135],height:175,afterOpen:function(){ideeli.two_minute_warning.afterOpen();if(jQuery('#control_overlay').is(':hidden')){jQuery('#control_overlay').show();}},width:width});el.hide().remove();jQuery('body').prepend(el);el.setStyle({'z-index':'17201'}).show();this.boundClose=this.close.bind(this);this.boundOpen=this.open.bind(this);this.modal.open();window.scrollTo(0,0);}}}();var ModalCartCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.seconds_left=Math.min(this.seconds_left,this.options.max);this.start();this.draw_el.show();jQuery('.modal_cart_expiration').show();},draw:function(){this.draw_el.html(TimerHelper.secondsToMinutes(this.seconds_left));},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},stop:function(){this.periodicalExecuter.stop();this.draw_el.unbind('countdown.timeover',this.timeoverListener);},timeoverListener:function(event){if(this.seconds_left<1){if(ideeli.two_minute_warning){ideeli.two_minute_warning.close();}
ideeli.cart.emptyCart();}}});var MediaInviteCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.start();this.draw_el.show();},draw:function(){this.draw_el.html(TimerHelper.secondsToTime(this.seconds_left));},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},timeoverListener:function(event){if(this.seconds_left<1){}}});var CartCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.seconds_left=Math.min(this.seconds_left,this.options.max);this.start();this.draw_el.show();jQuery('.timer').show();},draw:function(){this.draw_el.html(TimerHelper.secondsToMinutes(this.seconds_left));},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},timeoverListener:function(event){if(this.seconds_left<1){var on_sale_today_url="http://"+window.location.host+"/events/latest?open_cart=1";if(window.current_user.cart_items_count>0){ideeli.cart.cartExpired({redirect_to:on_sale_today_url});}}}});var UpdateOrderCountdown=Class.create(Countdown,{initialize:function($super,draw_el,end_at,options){$super(draw_el,end_at,options);this.start();this.draw_el.show();jQuery('.timer').show();},draw:function(){this.draw_el.html(TimerHelper.secondsToHours(this.seconds_left));},start:function(){this.draw_el.bind('countdown.timeover',jQuery.proxy(this,'timeoverListener'));this.periodicalExecuter=new PeriodicalExecuter(this.tick.bind(this),1);},timeoverListener:function(event){if(this.seconds_left<1){jQuery('#order_quantity_updateable').hide();jQuery('#order_quantity_not_updateable').show();jQuery('.item_qty_btns_remove').hide();jQuery('.item_qty_btns_decrement').hide();jQuery('.item_qty_btns_decrement_disabled').each(function(){if(!jQuery(this).hasClass('gift_card')){jQuery(this).show();}});jQuery('.cart_button_remove_icon').hide();}}});var TimerHelper=function(){return{hideElementsForEvent:function(event_id,els){var hider=function(event_id,el){if(jQuery('#'+el+event_id)){jQuery('#'+el+event_id).hide();}};els.each(hider.curry(event_id));},pluralize:function(number,word){if(number>1){number=''+number+' '+word+'s';}
else if(number==1){number=''+number+' '+word;}
else{number='';}
return number;},secondsToDays:function(seconds){var d=parseInt(seconds/(24*3600));d=TimerHelper.pluralize(d,'day');var h=parseInt(seconds/3600)%24;h=TimerHelper.pluralize(h,'hour');return d;},secondsToHours:function(seconds){var s=seconds%60;s=TimerHelper.zeroPad(s);var m=parseInt(seconds/60)%60;m=TimerHelper.zeroPad(m);var h=parseInt(seconds/3600)%24;if(seconds>=(24*3600)){h=24;}
h=TimerHelper.zeroPad(h);return''+h+':'+m+':'+s;},secondsToMins:function(seconds){if(seconds>60){var m=parseInt(seconds/60)%60;return''+TimerHelper.pluralize(m,'min');}
else{var s=seconds%60;return''+TimerHelper.pluralize(s,'sec');}},secondsToMinutes:function(seconds){var s=seconds%60;s=TimerHelper.zeroPad(s);var m=parseInt(seconds/60)%60;m=TimerHelper.zeroPad(m);return''+m+':'+s;},secondsToTime:function(seconds){return(seconds>(25*3600))?TimerHelper.secondsToDays(seconds):TimerHelper.secondsToHours(seconds);},showElementsForEvent:function(event_id,els){var shower=function(event_id,el){if(jQuery('#'+el+event_id)){jQuery('#'+el+event_id).show();}};els.each(shower.curry(event_id));},zeroPad:function(number){var n=number.toString();if(n.length<2){n='0'+n;}
return n;}}}();var Templater=function(){return{evaluate:function(elem_id,value_hash){document.observe("dom:loaded",function(){Templater.evaluateNow(elem_id,value_hash);});},evaluateNow:function(elem_id,value_hash){if($(elem_id)){$(elem_id).update((new Template($(elem_id).innerHTML)).evaluate(value_hash));$(elem_id).removeClassName('templated');}},conditionallyExecute:function(value,true_func,false_func){document.observe("dom:loaded",function(){if(value){true_func();}
else if(false_func){false_func();}});},readCookie:function(name){var mycookie=window.location.hostname.match(/blog\.ideeli\.com/)?window.jsBridge.cookie:document.cookie;var cookies=mycookie.match(name+'=(.*?)(;|$)');if(cookies){return(unescape(cookies[1].replace(/\+/g,"%20"))).evalJSON();}else{return null;}}};}();var BrowserCheck=function(){return{init:function(){var browserType=Cookie.get('browser_compatibility');if(browserType&&Cookie.get('ignore_browser_check')!='on'){if($('browser_compatibility')){$('browser_compatibility').addClassName(browserType).update(BrowserCheck.getMessage(browserType)).show();}}
else{if($('browser_compatibility')){$('browser_compatibility').hide();}}
this.setBrowserTypeClassOnHtml();},getMessage:function(type){var msg="<div class='generic_errors_container' style='position:relative;'>";if(type==='warning'){msg="<div class='generic_errors_container' style='position:relative;'><div class='error_header_wide'>Sorry, you're using an old browser. Our site uses advanced features, and may not work as intended. <a href='/upgrade.html' class='generic_error_link'>Upgrade your browser.</a></div>";}
else if(type==='scary'){msg="<div class='generic_errors_container' style='position:relative;'><div class='error_header_wide'>Internet Explorer 8 users may encounter some problems using this site. <a href='/upgrade.html' class='generic_error_link'>Switch your browser</a> to improve your experience.</div>";}
else{msg="<div class='error_header_wide'>We don't recognize your browser. As such, you may encounter some problems using this site.</div></div>";}
msg+=' <div style="position:absolute;top:8px;right:52px;"><a href="#" onclick="BrowserCheck.ignore();" class="generic_error_link" style="text-decoration:none;">( hide )</a></div></div>';return msg;},ignore:function(){if($('browser_compatibility')){$('browser_compatibility').hide();}},setBrowserTypeClassOnHtml:function(){var browserClass='';if(Prototype.Browser.WebKit){browserClass='webkit';}
else if(Prototype.Browser.Gecko){browserClass='gecko';}
else if(Prototype.Browser.IE){browserClass='msie';}
else{browserClass='unknown';}
$$('html').first().addClassName(browserClass);}}}();document.observe('dom:loaded',BrowserCheck.init.bind(BrowserCheck));if(typeof(ideeli)=='undefined'){ideeli={};}
if(typeof(ideeli.masthead)=='undefined'){ideeli.masthead={};}
ideeli.masthead=function(){initLock=false,DAILY_EXPIRATION_MS=86400000,echoTimeoutId=0,eventDataLoaded=false,lastCompareEchoStartTime=0,boundChannelClicks=false;return{channelMenuRefreshTimeoutId:0,showUserCallbacks:[],loadChannelCallbacks:[],eraseDeprecatedCookiesData:function(){if(Cookie.exists('GridInfo')){var GridInfoJson=Cookie.get('GridInfo').evalJSON();if(GridInfoJson.colorIds){delete GridInfoJson.colorIds;Cookie.set('GridInfo',Object.toJSON(GridInfoJson));}}},channelMenuItemClick:function(channel){ideeli.latest_events.update_channel_cookie(channel,true);ideeli.channels.select_tab(channel);Cookie.set('channel',channel);},buildChannelMenus:function(){var stored_latest_menus=amplify.store('latest_menus');if((stored_latest_menus&&stored_latest_menus.next_event_start_at)&&(stored_latest_menus.revision&&stored_latest_menus.revision===window.REVISION)&&(stored_latest_menus.next_event_start_at>Math.floor(new Date().getTime()/1000))){if(!window.fum_latest_menus_local){window.fum_latest_menus_local=new FUM('latest_menus_local',ideeli.masthead,ideeli.masthead.buildChannelMenusWithoutFUM,ideeli.masthead.buildChannelMenusSuccessMetric,{'callback_start_arguments':[stored_latest_menus],'callback_success_arguments':[stored_latest_menus]});}}
else{window.fum_latest_menus_fetch=new FUM('latest_menus_fetch',ideeli.masthead,ideeli.masthead.fetchAndBuildChannelMenusWithoutFUM,ideeli.masthead.buildChannelMenusSuccessMetric);}},buildChannelMenusFromData:function(latest_menus,store){if(store){try{amplify.store('latest_menus',latest_menus,{'expires':(60*60*1000)});}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store('latest_menus',latest_menus,{'expires':(60*60*1000)});}catch(e){FUMLSE.errorHandler(e,'latest_menus',latest_menus.length,'ideeli.masthead.buildChannelMenusFromData','masthead.js');throw(e);}}}
if(latest_menus){_.each(latest_menus.channel_menus,function(value,key,list){jQuery('table#channel_menu_'+key).replaceWith(value);});}
ideeli.latest_events.showOrHideChannelMenu();ideeli.latest_events.channelsView();},buildChannelMenusSuccessMetric:function(){var successful_run=false,error_message='',additional_info={},stored_latest_menus=false;if(error_message.length===0){successful_run=true;}
return[successful_run,error_message,additional_info];},buildChannelMenusWithoutFUM:function(stored_latest_menus){ideeli.masthead.buildChannelMenusFromData(stored_latest_menus);var refresh_data_timeout=(stored_latest_menus.next_event_start_at*1000)-new Date().getTime()-(6*(Math.floor(Math.random()*11))*1000);if(refresh_data_timeout>0){if(ideeli.masthead.channelMenuRefreshTimeoutId>0){clearTimeout(ideeli.masthead.channelMenuRefreshTimeoutId);}
ideeli.masthead.channelMenuRefreshTimeoutId=setTimeout(ideeli.masthead.buildChannelMenus,refresh_data_timeout);}},clearChannelMenuLocalStorage:function(){amplify.store('latest_menus',null);},clearLastCompareEchoStartTime:function(){amplify.store('lastCompareEchoStartTime',null);},clearUserData:function(){amplify.store('current_user',null);amplify.store('latest_events_data',null);amplify.store('latest_positions_flat',null);amplify.store('ideeli.labs.ev_data',null);ideeli.masthead.clearChannelMenuLocalStorage();Cookie.set('clear_user_data',window.location.protocol);Cookie.set("channel","");Cookie.set("preferred_channel","");},compareEcho:function(){if(window.current_user&&window.current_user.echo){var req=jQuery.post('/users/echo',function(data){if(window.current_user&&data&&(data!=window.current_user.echo)){ideeli.masthead.resetUserData(true);ideeli.latest_events.initLatest();document.location.reload();}});}},createCompareEchoTimeout:function(){var fire_in=(5*60+Math.floor(Math.random()*11))*1000;var randomMinutes=ideeli.masthead.randomSeconds(180);echoTimeoutId=setTimeout(ideeli.masthead.setupCompareEcho,fire_in+randomMinutes);},createVisitorTrackingCookie:function(){FUM.controlAndUpdateVisitorCookie();},determineCurrentChannel:function(){var channel='women';var document_location_pathname=document.location.pathname;var on_latest_page=(document_location_pathname=='/events/latest2')||(document_location_pathname=='/events/latest');var on_my_account_page=(document_location_pathname.indexOf('/my_account/edit_profile')>-1);var on_logout_page=(document_location_pathname.indexOf('logout')>-1);var on_comingsoon_page=(document_location_pathname=='/events/coming_soon');var on_confirm_password_page=(document_location_pathname=='/confirm_password');var on_taf_page=(document_location_pathname=='/tellafriend');var on_giftcards_page=(document_location_pathname=='/giftcards');var on_my_orders_page=(document_location_pathname.indexOf('/my_account/orders')>-1);var on_my_credits_page=(document_location_pathname=='/my_account/user_credits/show_profile');var on_login_details=(document_location_pathname=='/my_account/login_details/show_profile');var on_unsubscribe=(document_location_pathname.indexOf('/register/unsubscribe')>-1);var on_special_page=(on_my_account_page||on_latest_page||on_logout_page||on_comingsoon_page||on_confirm_password_page||on_taf_page||on_giftcards_page||on_my_orders_page||on_my_credits_page||on_unsubscribe||on_login_details);if(on_special_page){channel='all';}
if(Cookie.exists('preferred_channel')&&(ideeli.my_channels.indexOf(Cookie.get('preferred_channel'))!==-1)){channel=Cookie.get('preferred_channel');}
if(Cookie.exists('channel')&&(ideeli.my_channels.indexOf(Cookie.get('channel'))!==-1)){channel=Cookie.get('channel');}
var match=document.location.href.match(/#(\w+)/);if(match&&(ideeli.my_channels.indexOf(match[1])!==-1)){channel=match[1];}
return channel;},emptyCart:function(){if($('cart_items_count')){$('cart_items_count').update('&nbsp;');$('cart_links_items_img').removeClassName("header_sprite_cart_active").addClassName("header_sprite_cart_inactive");$('cart_link').addClassName('inactive');$('cart_links').show();$('cart_masthead_timer').hide();if(window.current_user){window.current_user.cart_items_count=0;}}},fetchAndBuildChannelMenusWithoutFUM:function(){ideeli.masthead.clearChannelMenuLocalStorage();ideeli.masthead.fetchChannelMenu();},fetchChannelMenu:function(){var url='/api201107/events/latest_menu';RequestProxy.getJSON(url,{},ideeli.masthead.fetchChannelMenuSuccessHandler,ideeli.masthead.fetchChannelMenuCleanup,ideeli.masthead,{});return true;},fetchChannelMenuCleanup:function(){try{if($$('.channel_menu_single_container_travel').any()&&$('channel_tabs_container')){var tOff=$('channel_tabs_container').cumulativeOffset()[0]-$$('.channel_menu_single_container_travel')[0].parentNode.cumulativeOffset()[0];$$('.channel_menu_single_container_travel')[0].setStyle({left:tOff+'px'});}}catch(e){}
try{_.each(ideeli.my_channels,function(channel){var boundClick=_.bind(ideeli.masthead.channelMenuItemClick,ideeli.masthead,channel);$$('table#channel_menu_'+channel+' a.channel_item_'+channel).click(boundClick);});}catch(e){}},fetchChannelMenuSuccessHandler:function(data){ideeli.masthead.buildChannelMenusFromData(data,true);},fetchUserData:function(){RequestProxy.getJSON('/users/data',{},ideeli.masthead.fetchUserDataSuccessHandler,ideeli.masthead.showUser,ideeli.masthead);},addCurrentUserLoadedEventHandler:function(callback){jQuery('body').bind('ideeli:currentUserLoaded',callback);if(window.current_user){callback();}},removeCurrentUserLoadedEventHandler:function(callback){jQuery('body').unbind('ideeli:currentUserLoaded',callback);},triggerCurrentUserLoaded:function(){setTimeout(function(){window.non_logged_user=true;jQuery('body').trigger('ideeli:currentUserLoaded');},15);},addNonLoggedUserEventHandler:function(callback){jQuery('body').bind('ideeli:nonLoggedUser',callback);if(window.non_logged_user){callback();}},removeNonLoggedUserEventHandler:function(callback){jQuery('body').unbind('ideeli:nonLoggedUser',callback);},triggerNonLoggedUser:function(){setTimeout(function(){jQuery('body').trigger('ideeli:nonLoggedUser');},15);},fetchUserDataSuccessHandler:function(data){if(jQuery.isEmptyObject(data)||data.toString().length<2){window.current_user=null;ideeli.masthead.triggerNonLoggedUser();}else{window.current_user=data;ideeli.masthead.persistUserData();ideeli.masthead.triggerCurrentUserLoaded();}},hideCart:function(){$('cart_masthead_timer').hide();$('cart_links_items_img').removeClassName("header_sprite_cart_active").addClassName("header_sprite_cart_inactive");$('cart_link').addClassName('inactive');},init:function(){ideeli.masthead.buildChannelMenus();ideeli.masthead.createVisitorTrackingCookie();if(!boundChannelClicks){jQuery('li.channel_items a.channel').click(function(){var clicked_channel=jQuery(this).attr('data-channel-type');if(clicked_channel!=='travel'){ideeli.latest_events.visitLatest(clicked_channel);}
return false;});boundChannelClicks=true;}
if(window.DO_NOT_LOAD_MASTHEAD){initLock=true};if(initLock!=true){initLock=true;jQuery(window).unload(ideeli.masthead.teardown);if(typeof(window.current_user)=='undefined'||!window.current_user||Cookie.exists('clear_user_data')||Cookie.exists('force_clear_user_data')){var current_user_local=amplify.store('current_user');if(Cookie.exists('force_clear_user_data')&&parseInt(Cookie.get('force_clear_user_data'))===1){current_user_local=null;Cookie.erase('force_clear_user_data');}
if(Cookie.exists('clear_user_data')&&(Cookie.get('clear_user_data')!=window.location.protocol)){current_user_local=null;Cookie.erase('clear_user_data');}
if(current_user_local&&current_user_local['echo']){window.current_user=current_user_local;ideeli.masthead.showUser();this.triggerCurrentUserLoaded();}else{ideeli.masthead.fetchUserData();}}
initLock=false;if(echoTimeoutId<1){ideeli.masthead.setupCompareEcho();}}
ideeli.labs.experiments.red_gray_button.useVariant();},isCreditCardAddPage:function(){return((document.location.href.match('credit_card')&&document.location.href.match('add'))?true:false);},isEditBillingAddressPage:function(){return((document.location.href.match('edit_shipping_address')&&this.isOrdersPage())?true:false);},isEditShippingAddressPage:function(){return((document.location.href.match('edit_billing_address')&&this.isOrdersPage())?true:false);},isJoinPage:function(){return(document.location.href.match('join')?true:false);},isLoginPage:function(){return((document.location.href.match('login')&&!document.location.href.match('login_details'))?true:false);},isLostPasswordPage:function(){return(document.location.href.match('register')&&document.location.href.match('lostpassword')&&!window.current_user?true:false);},isOrdersPage:function(){return(document.location.href.match('orders')?true:false);},isPlaceOrderPage:function(){return((document.location.href.match('store')&&!document.location.href.match('drawing')&&!document.location.href.match('stored_credit'))&&document.location.href.match('place_order')?true:false);},isStorePage:function(){return((document.location.href.match('store')&&!document.location.href.match('drawing')&&!document.location.href.match('stored_credit'))?true:false);},isUnsubscribePage:function(){return((document.location.href.match('unsubscribe')&&!window.current_user)?true:false);},teardown:function(){if(window.current_user&&window.current_user['echo']){ideeli.masthead.persistUserData();}},persistUserData:function(){try{amplify.store('current_user',window.current_user,{'expires':window.current_user.midnight_expiration});}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store('current_user',window.current_user,{'expires':window.current_user.midnight_expiration});}catch(e){FUMLSE.errorHandler(e,'current_user',window.current_user.length,'ideeli.masthead.persistUserData','masthead.js');throw(e);}}},resetUserData:function(dontReload){initLock=false;ideeli.masthead.clearUserData();window.current_user=null;if(dontReload!=true){ideeli.masthead.init();}},randomSeconds:function(seconds){var defaultSeconds=180;seconds=parseInt(seconds,10);if(seconds===NaN){seconds=defaultSeconds;}
return Math.floor(Math.random()*1000*seconds);},setupCompareEcho:function(){lastCompareEchoStartTime=amplify.store('lastCompareEchoStartTime');var now=new Date().getTime();var fiveMinutes=1000*60*5;var randomMinutes=ideeli.masthead.randomSeconds(180);var fiveMinutesAgo=now-(fiveMinutes+randomMinutes);if(!lastCompareEchoStartTime||(fiveMinutesAgo>parseInt(lastCompareEchoStartTime),10)){lastCompareEchoStartTime=now;try{amplify.store('lastCompareEchoStartTime',lastCompareEchoStartTime,{'expires':60*60*1000});}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store('lastCompareEchoStartTime',lastCompareEchoStartTime,{'expires':60*60*1000});}catch(e){FUMLSE.errorHandler(e,'lastCompareEchoStartTime',lastCompareEchoStartTime.length,'ideeli.masthead.setupCompareEcho','masthead.js');throw(e);}}
ideeli.masthead.compareEcho();}
ideeli.masthead.createCompareEchoTimeout();},showCart:function(){if($('cart_items_count')){$('cart_items_count').update('')};if($('cart_links')){$('cart_links').show();}
if($('cart_masthead_timer')){$('cart_masthead_timer').hide();}
var req=new Ajax.Request('/store/masthead_cart_expiration',{onComplete:function(){if($('masthead_cart_expirationtimer_top')){$('masthead_cart_expirationtimer_top').show();}
if($('cart_masthead_timer')&&window.current_user.cart_items_count>0){$('cart_masthead_timer').show();$('cart_links_items_img').addClassName("header_sprite_cart_active").removeClassName("header_sprite_cart_inactive");$('cart_link').removeClassName('inactive');ideeli.labs.experiments.red_gray_button.useVariant();}
if(window.location.href.match(/show_cart_on_load/)&&(typeof(ideeli.cart)!='undefined')){ideeli.masthead.showCartModal();}}});},showCartModal:function(){if(!ideeli.masthead.cartShown){ideeli.masthead.cartShown=true;if(window.location.href.match(/add_to_cart/)){var sku_id=window.location.href.match(/sku_id=(\d+)/)[1];var offer_id=window.location.href.match(/offer_id=(\d+)/)[1];if((sku_id>0)&&(offer_id>0)){ideeli.cart.addToCart(sku_id,offer_id);return true;}}
ideeli.cart.refresh();}},showUser:function(){if(window.current_user){var user_login=window.current_user.login.toString();var store_credit=window.current_user.store_credits?(window.current_user.store_credits/100):0;var gift_credit=window.current_user.gift_credits?(window.current_user.gift_credits/100):0;var promo_credit=window.current_user.discount_vouchers?(window.current_user.discount_vouchers/100):0;var total_credit=store_credit+gift_credit+promo_credit;if($('ideeli30_banner')&&window.current_user.ideeli30_banner){$('ideeli30_banner').update(window.current_user.ideeli30_banner);$('ideeli30_banner_wrapper').show();}
if($('ideeli30_unenrolled_tooltip')&&window.current_user.enrolled_in_ideeli30===false){tip=new Tip($('ideeli30_banner_wrapper'),$('ideeli30_unenrolled_tooltip').innerHTML,{closeButton:true,showOn:'click',hideOthers:true,hideOn:{element:'closeButton',event:'click'},stem:'rightMiddle',hook:{target:'leftMiddle',tip:'rightMiddle'},offset:{x:0,y:0},width:300});}
try{user_login=window.current_user.polite_name.toString();}catch(e){}
if(user_login.length<=15){$('welcome_user').update("#{user_login}'s Account");Templater.evaluateNow('welcome_user',{user_login:user_login});}else{$('welcome_user').update("My Account");Templater.evaluateNow('welcome_user');}
$('store_credits').update("$#{store_credit}");Templater.evaluateNow('store_credits',{store_credit:store_credit.toFixed(2)});$('gift_credits').update("$#{gift_credit}");Templater.evaluateNow('gift_credits',{gift_credit:gift_credit.toFixed(2)});$('promo_credits').update("$#{promo_credit}");Templater.evaluateNow('promo_credits',{promo_credit:promo_credit.toFixed(2)});$('total_credits').update("$#{total_credit}");Templater.evaluateNow('total_credits',{total_credit:total_credit.toFixed(2)});if(total_credit>0){$('credits_details').show();$('credits_tellafriend').hide();}
$$('.authenticated_user_main_nav').each(function(item){item.show();});if($('unauthenticated_user_menu')){$('unauthenticated_user_menu').hide();}
if($('authenticated_user_menu')){$('authenticated_user_menu').show();}
if(!window.current_user.is_premium_member.blank()){if($('welcome_user_premium')){$('welcome_user_premium').show();}}
else{if($('welcome_user_premium')){$('welcome_user_premium').hide();}
if($('welcome_upgrade')){$('welcome_upgrade').show();}}
$('user_nav_links_ul').setStyle({minWidth:'160px'});nh=$('user_nav_links_ul').getWidth();wh=$('welcome_user_li').getWidth();if(wh>160){nh=nh+(wh-160);$('user_nav_links_ul').setStyle({minWidth:nh+'px'});}
if(current_user.is_facebook_connected&&(typeof(ideeli)!='undefined')&&(typeof(ideeli.fb)!='undefined')){ideeli.fb.updateUserProfile();}
ideeli.masthead.updateCart();ideeli.zipcode_collector.init();if(ideeli.masthead.announcement!=null&&ideeli.masthead.announcement.canOpen()){ideeli.masthead.announcement.splashModalOpen();}}else{var unauthenticated_user_menu=jQuery('#unauthenticated_user_menu');if(unauthenticated_user_menu){unauthenticated_user_menu.show();}
jQuery('#promoUnitTxt').hide();var signup_banner_data_holder=jQuery('#signup_banner_data_holder');var url=signup_banner_data_holder.attr('data-signup-banner-path');if(!url.blank()){jQuery.ajax({url:url,type:'post',data:{current_page:signup_banner_data_holder.attr('data-current-page'),is_offers_or_product_page:signup_banner_data_holder.attr('data-is-offers-or-product-page')},success:function(html){var container=jQuery('#signup_banner_container');container.prepend(html);if(container.find('.signup_banner_error').size()>0){container.find('#user_email').focus();}}});}}
if(!eventDataLoaded){ideeli.masthead.toggleAllChannel();if(document.location.pathname.indexOf('latest_preview')<0){var current_channel=ideeli.masthead.determineCurrentChannel();ideeli.channels.load_channel(current_channel,ideeli.my_channels);ideeli.masthead.loadChannelCallbacks.each(function(fn){fn(current_channel);});}
eventDataLoaded=true;}
ideeli.masthead.showUserCallbacks.each(function(fn){fn();});ideeli.masthead.showUserCallbacks=[];},successMetric:function(){var successful_run=false,error_message='',additional_info={};if(window.current_user){if(amplify.store('current_user')===null){error_message+='No current_user in local storage. ';}
if(jQuery('#welcome_user').html().match(/\#\{.*\}/)){error_message+='No template rendered in masthead for a logged in user.';}
if(jQuery('#authenticated_user_menu:visible').length===0){error_message+='Authenticated menu is not visible, and should be. ';}
if(jQuery('#unauthenticated_user_menu:visible').length>0){error_message+='Unauthenticated menu is visible, and should not be. ';}
additional_info.login=window.current_user.login;}
else{if(jQuery('#welcome_user').html().match(/\#\{.*\}/).length===0){error_message+='A template should not be rendered in masthead for a logged out user.';}}
if(error_message.length===0){successful_run=true;}
return[successful_run,error_message,additional_info];},toggleAllChannel:function(){$$('.channel_menu_container_all').invoke('show');if($('nav_our_blog')){$('nav_our_blog').show();}
ideeli.latest_events.fillChannelMenus();},showMenus:function(){return!((document.location.href.match('pages')&&!(document.location.href.match('holidaypolicy'))&&!(document.location.href.match('holidaywishlist'))||this.isLostPasswordPage()||this.isJoinPage()||(this.isStorePage()&&!this.isPlaceOrderPage())||this.isLoginPage()||this.isUnsubscribePage()||this.isEditBillingAddressPage()||this.isEditShippingAddressPage()||this.isCreditCardAddPage()));},updateCart:function(){if(window.location.href.match(/confirm_reservation/)){ideeli.masthead.hideCart();}else{ideeli.masthead.showCart();}},quickBuyWorthy:function(){var isIE7=jQuery.browser.msie&&parseInt(jQuery.browser.version,10)===7;return!isIE7&&window.current_user!=null;}};}();if(typeof(ideeli)=='undefined'){ideeli=new Object();}
if(typeof(ideeli.cart)=='undefined'){ideeli.cart=new Object();}
ideeli.cart=function(){var cart_link,cart_link_el;var travel_bound=false;return{hideCartLink:function(){if(!document.location.href.match('invite_friends')){jQuery('#cart_links').css('display','none');nav_w=$('user_nav').getWidth();nav_w=nav_w-116;$('user_nav').setStyle({minWidth:nav_w+'px'});}},addToCart:function(sku_id,offer_id){var url='/cart_items';var req=new Ajax.Request(url,{method:'post',parameters:{'id':sku_id,'offer_id':offer_id,'sku_id':sku_id,'add_after_end_at':1}});},appendToOrderClick:function(ev){ev.stop();$$('.append_to_order_cbx').each(function(el){el.checked=false;},this);var el_id=ev.element().identify();jQuery('#multiple_order_shipping_fee_text').hide();jQuery('#multiple_order_free_shipping').hide();var el=jQuery('#'+el_id);if(el.attr('data-shipping')>0.0){jQuery('#multiple_order_shipping_fee_amount').html(el.attr('data-shipping'));jQuery('#multiple_order_shipping_fee_text').show();}else{jQuery('#multiple_order_free_shipping').show();}
setTimeout("document.getElementById('"+el_id+"').checked = 'checked';",10);},attachCloseOnOverlayClick:function(){if(this.cart){$('control_overlay').observe('click',this.close.bind(this));}},attachHeader:function(){if(this.cart&&!$('cart_modal_header_top')){this.headerElLoadingImg=new Element('img',{'id':'cart_modal_loading_icon','src':'http://0.cdn.ideeli.net/images/frontend/loading.gif','style':'position:absolute;top:11px;right:22px;display:none;'});this.headerElReturnToCart=new Element('img',{'id':'cart_modal_return_to_cart','src':'http://0.cdn.ideeli.net/images/frontend/ads_append_to_order_return_to_cart.png','style':'position:absolute;top:7px;left:0;display:none;'});this.headerElImg=new Element('img',{'id':'cart_modal_close_icon','src':'http://0.cdn.ideeli.net/images/cart/modal_close_button.png','style':'position:absolute;top:3px;right:19px;z-index:2;'});this.headerElLink=new Element('a',{'href':'#','border':0,'title':'close','alt':'close'}).update(this.headerElImg).insert({'bottom':this.headerElLoadingImg}).insert({'bottom':this.headerElReturnToCart});this.headerEl=new Element('div',{'id':'cart_modal_header_top','style':'height:19px;padding:0;margin:0;'}).update(this.headerElLink);this.attachHeaderListeners();var container=this.cart.getRemoteContentInsertionTarget();container.insert({'top':this.headerEl});}},attachHeaderListeners:function(){var that=this;this.headerElLoadingImg.hide();this.headerElImg.show();this.headerElImg.observe('click',this.boundClose);this.headerElLink.observe('click',function(event){that.boundClose();Event.stop(event);});this.headerEl.observe('click',this.boundClose);this.headerElReturnToCart.observe('click',this.boundShowCart);},attachTips:function(){if(!ideeli.cart.tooltips){ideeli.cart.tooltips=$H();}
var tip_names=['modal_cart_why_top','modal_cart_ads_learn_more'],tip=null;tip_names.each(function(tip_name){if($(tip_name)&&$(''+tip_name+'_link')){tip=new Tip($(''+tip_name+'_link'),$(tip_name),{closeButton:true,showOn:'click',hideOn:{element:'closeButton',event:'click'},stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:315});ideeli.cart.tooltips.set($(''+tip_name+'_link').identify(),tip);}},this);$$('.vcard_giftable_checkbox').each(function(el){tip=new Tip($(el),$('marked_as_gift').innerHTML,{style:'defaultNoClose',closeButton:true,showOn:false,hideOn:false,fixed:true,stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:326,hideAfter:3});ideeli.cart.tooltips.set(el.identify(),tip);},this);},bindAppendToOrderCheckboxes:function(){$$('.append_to_order_cbx').each(function(el){el.observe('click',this.appendToOrderClick.bindAsEventListener(this));},this);},cart:null,cartRemove:function(sku_id,item_id){var el=$('cart_item_'+(sku_id)+'_'+(item_id)+'_remove_all');if(!this.actionLink.isEnable(el)){return false;}
this.actionLink.disable(el);var rthis=this;new Ajax.Request(el.readAttribute('href'),{asynchronous:true,evalScripts:true,method:'delete',onLoading:function(request){ideeli.cart.detachHeaderListeners();},onComplete:function(){ideeli.PromotionEngine.fire('cart_change','remove',{'ignore_cart':window.current_user.current_order_id});rthis.actionLink.enable(el);}});},cartAddItem:function(sku_id){var el=$('cart_item_'+(sku_id)+'_add');if(!this.actionLink.isEnable(el)){return false;}
this.actionLink.disable(el);var offer_id=el.readAttribute('data-offer_id');var gift_recipient_id=el.readAttribute('data-gift_recipient_id');var rthis=this;new Ajax.Request('/cart_items/'+(sku_id)+'/add_item?gift_recipient_id='+(gift_recipient_id)+'&offer_id='+(offer_id),{asynchronous:true,evalScripts:true,method:'post',onLoading:function(request){ideeli.cart.detachHeaderListeners();},onComplete:function(){ideeli.PromotionEngine.fire('cart_change','additem');rthis.actionLink.enable(el);}});},cartRemoveItem:function(sku_id){var el=$('cart_item_'+(sku_id)+'_remove');if(!this.actionLink.isEnable(el)){return false;}
this.actionLink.disable(el);var rthis=this;var gift_recipient_id=el.readAttribute('data-gift_recipient_id');new Ajax.Request('/cart_items/'+(sku_id)+'/remove_item?gift_recipient_id='+(gift_recipient_id),{asynchronous:true,evalScripts:true,method:'post',onLoading:function(request){ideeli.cart.detachHeaderListeners();},onComplete:function(){ideeli.PromotionEngine.fire('cart_change','removeitem',{'ignore_cart':window.current_user.current_order_id});rthis.actionLink.enable(el);}});},actionLink:{in_process:false,disable:function(link){this.in_process=true},enable:function(link){this.in_process=false},isEnable:function(link){return false==this.in_process}},cartAfterOpen:function(){this.attachHeader();this.setUpModalCartExpiration();ideeli.orders.initReturnPolicyPopups();this.setCartFrameHeight();this.cart.position();this.setUpVcardGiftables();this.attachTips();ideeli.delayed_modal.delayedShow('.cart_modal_frame');},cartExpired:function(options){this.options=options;if(jQuery("#quick_buy_modal").dialog("isOpen")){jQuery("#quick_buy_modal").dialog("close");}
if(!ideeli.cart.cart_expired_modal){ideeli.cart.cart_expired_modal=new Control.Modal($('cart_expired'),{beforeClose:function(){ideeli.cart.setUpCartShowBleeds.bind(ideeli.cart);if(options&&options.redirect_to){window.location.href=options.redirect_to;}},beforeOpen:ideeli.cart.setUpCartHideBleeds.bind(ideeli.cart),className:'cart_exired_modal_frame',closeOnClick:'overlay',position:[parseInt((document.viewport.getWidth()-594)/2),0],constrainToViewport:true,fade:false,offsetTop:135,overlayOpacity:0.5,afterOpen:function(){ideeli.cart.setUpCartExpiredClose();if(jQuery('#control_overlay').is(':hidden')){jQuery('#control_overlay').show();}},parameters:{},width:594});}
ideeli.cart.cart_expired_modal.open();ideeli.labs.experiments.red_gray_button.useVariant();},close:function(){if(this.cart){this.cart.close();ideeli.delayed_modal.cancelShow('.cart_modal_frame');this.cart.isOpen=false;}},destroy:function(){if(this.cart){this.cart.destroy();this.cart=null;}},detachCloseOnOverlayClick:function(){if(this.cart){$('control_overlay').stopObserving('click',this.boundClose);}},detachHeaderListeners:function(){this.headerElImg.hide();this.headerElLoadingImg.show();this.headerElImg.stopObserving('click',this.boundClose);this.headerElLink.stopObserving('click',this.boundClose);this.headerEl.stopObserving('click',this.boundClose);this.headerElReturnToCart.stopObserving('click',this.boundShowCart);},doAddToExistingOrder:function(){if($$('.append_to_order_cbx:checked').any()||$$('.append_to_order_cbx').length==1){var order_el=$$('.append_to_order_cbx').first();if($$('.append_to_order_cbx:checked').any()){order_el=$$('.append_to_order_cbx:checked').first();}
var req=new Ajax.Request('/store/confirm_reservation_do_append_to_order',{parameters:{'order_id':order_el.value},method:'POST',onLoading:function(){$('cart_modal_close_icon').hide();$('cart_modal_loading_icon').show();},onLoaded:function(){$('cart_modal_loading_icon').hide();$('cart_modal_close_icon').show();}});}
else{setTimeout("ideeli.cart.message('To make this purchase please select an order to add your items to.')",100);}},emptyCart:function(){if(window.current_user&&window.current_user.cart_items_count>0){ideeli.masthead.emptyCart();ideeli.cart.close();this.cartExpired();}},getCartLink:function(){if(!cart_link){cart_link='/cart_items/index'}
return cart_link;},hideStoreCredits:function(){$$('div.store_credit_details_container').invoke('hide');$('store_credit_details_container').hide();},isCartOpen:function(){if(this.cart){return this.cart.isOpen;}
return false;},init:function(){if(!this.cart){window.fum_build_cart=new FUM('init_cart',ideeli.cart,ideeli.cart.initWithoutFUM,ideeli.cart.initSuccessMetric,{'callback_start_arguments':[],'callback_success_arguments':[]});}
else{this.refresh();}},initWithoutFUM:function(){if(!cart_link_el){cart_link_el=new Element('a',{'href':this.getCartLink(),'id':'cart_link','style':'display:none;'});}
$(document.body).insert({'bottom':cart_link_el});this.cart=new Control.Modal(cart_link_el,{beforeClose:this.setUpCartShowBleeds.bind(this),beforeOpen:this.setUpCartHideBleeds.bind(this),afterOpen:this.setUpCartAfterOpen.bind(this),afterClose:function(obj){ideeli.orders.initReturnPolicyPopups.bind(ideeli.orders);ideeli.cart.travel_bound=false;},className:'cart_modal_frame',closeOnClick:'overlay',constrainToViewport:true,isOpen:false,fade:false,offsetTop:0,onComplete:this.attachCloseOnOverlayClick.bind(this),overlayOpacity:0.5,parameters:{},position:[parseInt((document.viewport.getWidth()-740)/2),0],width:740});this.setCartFrameHeight();this.boundClose=this.close.bind(this);this.boundShowCart=this.showCart.bindAsEventListener(this);ideeli.cart.boundHidePromoCreditsWarning=ideeli.cart.hidePromoCreditsWarning.bindAsEventListener(ideeli.cart);this.cart.position();this.cart.open();},initSuccessMetric:function(){var successful_run=false,error_message='';var cart_el_present=jQuery('a#cart_link');if(!cart_el_present){error_message+='No a#cart_link found. ';}
if(error_message.length===0){successful_run=true;}
return[successful_run,error_message,{}];},message:function(string){if(!ideeli.cart.cart_modal_warning){ideeli.cart.cart_modal_warning=new Control.Window($('cart_modal_message_link'),{beforeClose:ideeli.cart.setUpCartShowBleeds.bind(ideeli.cart),beforeOpen:ideeli.cart.setUpCartHideBleeds.bind(ideeli.cart),closeOnClick:true,position:'center'});}
$('cart_modal_message').update(string);ideeli.cart.cart_modal_warning.open();},setUpCartExpiredClose:function(){$$('a.cart_expired_close').each(function(el){el.observe('click',function(ev){ideeli.cart.cart_expired_modal.close();ev.stop();});});},waitlistMessage:function(string,showWaitlistAction){if(!ideeli.cart.cart_waitlist_modal_warning){ideeli.cart.cart_waitlist_modal_warning=new Control.Modal($('cart_waitlist_modal_message_container'),{beforeClose:ideeli.cart.setUpCartShowBleeds.bind(ideeli.cart),beforeOpen:ideeli.cart.setUpCartHideBleeds.bind(ideeli.cart),className:'cart_waitlist_modal_frame',closeOnClick:'overlay',position:'center',constrainToViewport:true,fade:false,overlayOpacity:0.5,parameters:{},width:516});}
$('cart_waitlist_modal_message').update(string);if(showWaitlistAction){jQuery('#cart_waitlist_modal_action').show();}
ideeli.cart.cart_waitlist_modal_warning.open();},open:function(){if(!this.cart){this.init();}
else{this.cart.open();}
this.cart.isOpen=true;},refresh:function(){if(!this.cart){this.open();}
else{this.setCartFrameHeight();this.cart.ajaxRequest=new Ajax.Request(this.cart.href,{method:this.cart.options.method,parameters:this.cart.options.parameters,onComplete:function(request){if(parseInt(request.status,10)>303){$('control_overlay').hide();}else{this.notify('onComplete',request);this.ajaxRequest=false;$('control_overlay').show();ideeli.cart.attachHeader.call(ideeli.cart);}}.bind(this.cart),onSuccess:function(request){if(parseInt(request.status,10)>303){$('control_overlay').hide();}else{this.notify('onComplete',request);this.getRemoteContentInsertionTarget().update(request.responseText);this.notify('onSuccess',request);if(this.notify('onRemoteContentLoaded')!==false){if(this.options.indicator){this.hideIndicator();}
this.finishOpen();}}}.bind(this.cart),onFailure:function(request){this.notify('onFailure',request);if(this.options.indicator){this.hideIndicator();}
$('control_overlay').hide();}.bind(this.cart),onException:function(request,e){this.notify('onException',request,e);if(this.options.indicator){this.hideIndicator();}
$('control_overlay').hide();}.bind(this.cart)});}},setCartFrameHeight:function(){$$('.cart_modal_frame').first().setStyle({'width':'740px'});$$('.cart_modal_frame').first().addClassName('cart_modal_frame_tall');},setUpCartAfterOpen:function(){if($$('.cart_modal_frame').any()){$$('.cart_modal_frame').invoke('hide');}
if(Prototype.Browser.IE){setTimeout(ideeli.cart.cartAfterOpen.bind(ideeli.cart),100);}
else{this.cartAfterOpen();}},setUpCartHideBleeds:function(){if(Prototype.Browser.IE){$$('select').invoke('hide');if($$('.copy_to_clipboard_container')){$$('.copy_to_clipboard_container').invoke('hide');}
if($$('embed')){$$('embed').invoke('hide');}
if($$('object')){$$('object').invoke('hide');}}
else if(Prototype.Browser.Gecko&&navigator.userAgent.match(/Windows/)){if($$('.copy_to_clipboard_container')){$$('.copy_to_clipboard_container').invoke('hide');}
if($$('embed')){$$('embed').invoke('hide');}
if($$('object')){$$('object').invoke('hide');}}},setUpCartShowBleeds:function(){if(Prototype.Browser.IE){$$('select').invoke('show');if($$('.copy_to_clipboard_container')){$$('.copy_to_clipboard_container').invoke('show');}
if($$('embed')){$$('embed').invoke('show');}
if($$('object')){$$('object').invoke('show');}}
else if(Prototype.Browser.Gecko&&navigator.userAgent.match(/Windows/)){if($$('.copy_to_clipboard_container')){$$('.copy_to_clipboard_container').invoke('show');}
if($$('embed')){$$('embed').invoke('show');}
if($$('object')){$$('object').invoke('show');}}
if(Tips){Tips.hideAll();}
if($('promo_credits_gift_card_warning')){$('promo_credits_gift_card_warning').hide();}
if(this.footerBottomEl){this.footerBottomEl.remove();this.footerBottomEl=null;}},setUpModalCartExpiration:function(){var req=new Ajax.Request('/store/modal_cart_expiration',{onComplete:function(){$$('.modal_cart_expiration').invoke('show');}});},setUpVcardGiftables:function(){$$('.vcard_giftable_checkbox','.vcard_giftable_label').each(function(el){el.observe('click',ideeli.cart.toggleGiftable.bindAsEventListener(ideeli.cart,el.readAttribute('data-line-item-id')));});},showAppendToOrder:function(){requestPath='/store/confirm_reservation_show_append_to_order';if(this.travel_bound){requestPath+="?travel_bound=1";}
var req=new Ajax.Request(requestPath,{onLoading:this.showIndicator,onLoaded:this.hideIndicator,onSuccess:function(req){if(Tips){Tips.hideAll();}
var cart_modal=$$('.cart_modal_frame > #cart_modal').first();cart_modal.hide();$('cart_modal_return_to_cart').show();if($('append_to_order_modal')){$('append_to_order_modal').remove();}
cart_modal.insert({'after':req.responseText});ideeli.cart.setUpVcardGiftables();}.bind(this),evalScripts:true});},showAppendToOrderQuickBuy:function(){requestPath='/store/confirm_reservation_show_append_to_order?from_quick_buy=1';var req=new Ajax.Request(requestPath,{onSuccess:function(req){var quick_buy_modal=$$("#quick_buy_modal > #quick_buy_modal_body").first();quick_buy_modal.hide();quick_buy_modal.insert({'after':req.responseText});jQuery("#quick_buy_modal #append_to_order_modal").removeClass("cart_modal_frame_tile");},evalScripts:true});},showAppendToOrderRedGrayButton:function(){requestPath='/store/confirm_reservation_show_append_to_order?from_red_gray_button=1';var req=new Ajax.Request(requestPath,{onSuccess:function(req){var red_gray_button_modal=$$("#red_gray_button_modal > #red_gray_button_popup_header").first();red_gray_button_modal.insert({'after':req.responseText});jQuery("#red_gray_button_modal #append_to_order_modal").removeClass("cart_modal_frame_tile");ideeli.labs.experiments.red_gray_button.append_to_order_modal_show();},evalScripts:true});},showCart:function(ev){if(ev&&ev.stop){ev.stop();}
if(Tips){Tips.hideAll();}
$('append_to_order_modal').update('<img src="http://0.cdn.ideeli.net/images/frontend/loading_nobg.gif" /> Loading ... ');ideeli.PromotionEngine.fire('cart_open','open');ideeli.cart.init();},showPromoCreditsWarning:function(anchor_el_id){if(!ideeli.cart.boundHidePromoCreditsWarning){ideeli.cart.boundHidePromoCreditsWarning=ideeli.cart.hidePromoCreditsWarning.bindAsEventListener(ideeli.cart);}
var el=$('promo_credits_gift_card_warning').remove();$$('body').first().observe('click',ideeli.cart.boundHidePromoCreditsWarning);$$('body').first().insert({'top':el});var anchor_el=($(anchor_el_id))?$(anchor_el_id):$$('div.dv_label').first();var x=anchor_el.cumulativeOffset().top-30;var y=anchor_el.cumulativeOffset().left-240;el.setStyle({'top':''+x+'px','left':''+y+'px','position':'absolute','z-index':'19001','zIndex':'19001'}).show();},hidePromoCreditsWarning:function(){$('promo_credits_gift_card_warning').hide();$$('body').first().stopObserving('click',ideeli.cart.boundHidePromoCreditsWarning);},showStoreCredits:function(){if(($('total_tax_estimated')&&$('total_tax_estimated').visible())||($('total_tax_loading')&&$('total_tax_loading').visible())){$('store_credit_details_container').setStyle({'margin':'80px 0 0 0','margin-top':'60px'});}
else if(($('total_tax_estimated')&&!$('total_tax_estimated').visible()&&!$('total_tax_loading').visible())||window.location.href.match(/prepare_update/)){$('store_credit_details_container').setStyle({'margin':'30px 0 0 0','margin-top':'30px'});}
$$('div.store_credit_details_container').invoke('show');$('store_credit_details_container').show();},showQtyWarning:function(el_id){try{ideeli.cart.attachHeaderListeners();}catch(e){};if(ideeli.orders.tooltips){try{ideeli.orders.tooltips.get(el_id).element.prototip.show();}catch(e){};}},stopTimers:function(){if(window.masthead_cart){window.masthead_cart.stop();}
if(window.cart_top){window.cart_top.stop();}
if(window.cart_bottom){window.cart_bottom.stop();}
if(window.Clock){Clock.stop();}
if(typeof(Refresh)!='undefined'&&Refresh&&Refresh.stopPeriodicalRefreshPage){Refresh.stopPeriodicalRefreshPage();}
return true;},toggleGiftable:function(ev,line_item_id){ev.stop();var req=new Ajax.Request('/cart_items/toggle_giftable',{parameters:{'line_item_id':line_item_id},onLoading:function(){var el=$('vcard_giftable_'+line_item_id);if(el){el.hide();}
el=$('vcard_giftable_loading_'+line_item_id);if(el){el.show();}}});},toggleGiftableCheck:function(line_item_id,offer_id,sku_id,gift_recipient_id){var el=$('vcard_giftable_loading_'+line_item_id);if(el){el.hide();}
el=$('vcard_giftable_'+line_item_id);if(el){el.checked=true;el.show();try{ideeli.cart.tooltips.get(el.identify()).element.prototip.show();}catch(e){};}
el=$('give_as_gift_'+offer_id+'_'+sku_id);if(el){el.hide();}
el=$('this_is_a_gift'+offer_id+'_'+sku_id);if(el){el.show();}
el=$('cart_item_'+(sku_id)+'_remove');el.writeAttribute('data-offer_id',offer_id);el.writeAttribute('data-gift_recipient_id',gift_recipient_id);el=$('cart_item_'+(sku_id)+'_add');el.writeAttribute('data-offer_id',offer_id);el.writeAttribute('data-gift_recipient_id',gift_recipient_id);},toggleGiftableUncheck:function(line_item_id,offer_id,sku_id){var el=$('vcard_giftable_loading_'+line_item_id);if(el){el.hide();}
el=$('vcard_giftable_'+line_item_id);if(el){el.checked=false;el.show();}
el=$('this_is_a_gift'+offer_id+'_'+sku_id);if(el){el.hide();}
el=$('give_as_gift_'+offer_id+'_'+sku_id);if(el){el.show();}
el=$('cart_item_'+(sku_id)+'_remove');el.writeAttribute('data-offer_id',offer_id);el.writeAttribute('data-gift_recipient_id',0);el=$('cart_item_'+(sku_id)+'_add');el.writeAttribute('data-offer_id',offer_id);el.writeAttribute('data-gift_recipient_id',0);}}}();if(typeof(ideeli.checkout)=='undefined'){ideeli.checkout=new Object();}
ideeli.checkout=function(){return{attachHeader:function(modal_name){if(ideeli.checkout[modal_name]){var headerElImg=new Element('img',{'id':'cart_modal_close_icon','src':'http://0.cdn.ideeli.net/images/frontend/cart/close_button.png','style':'position:absolute;top:0;right:0;'}).observe('click',ideeli.checkout[modal_name].close.bind(ideeli.checkout[modal_name]));var headerElLink=new Element('a',{'href':'#','border':0,'title':'close','alt':'close'}).update(headerElImg).observe('click',ideeli.checkout[modal_name].close.bind(ideeli.checkout[modal_name]));var headerEl=new Element('div',{'id':'cart_modal_header','style':'height:17px;padding:0;margin:0 0 0 0;'}).update(headerElLink).observe('click',ideeli.checkout[modal_name].close.bind(ideeli.checkout[modal_name]));var container=ideeli.checkout[modal_name].container;if(container.innerHTML.indexOf('cart_modal_header')==-1){container.insert({'top':headerEl});}}},confirmGiftDestroy:function(){if($('gift_recipient_destroy_id')&&$('line_item_id')){var gift_recipient_destroy_id=$('gift_recipient_destroy_id').getValue();var line_item_id=$('line_item_id').getValue();if(gift_recipient_destroy_id&&line_item_id){var req=new Ajax.Request('/store/toggle_giftable',{parameters:{'line_item_id':line_item_id,'gift_recipient_id':gift_recipient_destroy_id,'destroy':'1'},onLoading:function(){$('vcard_giftable_'+line_item_id+'_'+gift_recipient_destroy_id).hide();$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_destroy_id).show();},onLoaded:function(){$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_destroy_id).hide();$('vcard_giftable_'+line_item_id+'_'+gift_recipient_destroy_id).show();},onFailure:function(){$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_destroy_id).hide();$('vcard_giftable_'+line_item_id+'_'+gift_recipient_destroy_id).show();}});}}},createGiftDestroyModal:function(line_item_id,gift_recipient_id,recipient_name){$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_id).hide();$('vcard_giftable_'+line_item_id+'_'+gift_recipient_id).show();$('line_item_id').value=line_item_id;$('gift_recipient_destroy_id').value=gift_recipient_id;if(recipient_name&&!recipient_name.blank()){$('gift_recipient_destroy_name').update(recipient_name);}
else{$('gift_recipient_destroy_name').update('this person');}
ideeli.checkout.giftDestroyModal=new Control.Modal($('confirm_gift_destroy'),{closeOnClick:true,position:'center'});ideeli.checkout.giftDestroyModal.open();},createCreditCardHints:function(){if(ideeli.checkout.credit_card_hints.any()){ideeli.checkout.credit_card_hints.each(function(hint){hint.destroy();});ideeli.checkout.credit_card_hints=[];}
$$('.credit_card_hint').each(function(el){ideeli.checkout.credit_card_hints.push(new Control.Window(el,{position:'relative',className:'hoverFrameFrame',closeOnClick:true,constrainToViewport:true}));});},createHints:function(){if(ideeli.checkout.hints.any()){ideeli.checkout.hints.each(function(hint){hint.destroy();});ideeli.checkout.hints=[];}
$$('.cart_hint').each(function(el){ideeli.checkout.hints.push(new Control.Window(el,{position:'relative',className:'hoverFrameCart',closeOnClick:true,constrainToViewport:false,offsetLeft:-145,offsetTop:15}));});},createModals:function(){this.use_store_credits_modal=new Control.Modal($('use_store_credits_modal'),{beforeClose:this.showSubmitButtons.bind(this),className:'modal',closeOnClick:'overlay',fade:false,height:125,overlayOpacity:0.5,position:'center',width:360});ideeli.checkout.attachHeader('use_store_credits_modal');},editCard:function(){$('edit_card_stored_credit_card_id').setValue($$('#enter_credit_card_form > input:checked').first().getValue());$('edit_card_form').submit();},editGiftRecipient:function(gift_recipient_id){if(gift_recipient_id&&$('gift_recipient_container_'+gift_recipient_id)){$('gift_recipient_container_'+gift_recipient_id).show();}
if($('gift_card_edit_info_link_'+gift_recipient_id)){$('gift_card_edit_info_link_'+gift_recipient_id).hide();}},hideSelects:function(){if(Prototype.Browser.IE){$$('.items_totals_content select').invoke('hide');}},init:function(){window.fum_build_checkout=new FUM('init_checkout',ideeli.checkout,ideeli.checkout.initWithoutFUM,ideeli.checkout.initSuccessMetric,{'callback_start_arguments':[],'callback_success_arguments':[]});},initWithoutFUM:function(){this.hints=[];this.credit_card_hints=[];this.createHints();if(Prototype.Browser.IE){setTimeout("ideeli.checkout.createModals()",1000);}
else{this.createModals();}
if(Prototype.Browser.IE){setTimeout("ideeli.checkout.updateBillingAddress()",500);}
else{this.updateBillingAddress();}
ideeli.checkout.selectFirstRecipientEmail();var el=$('gift_note_input_box');if(el){el.observe('keydown',ideeli.checkout.trackGiftNoteMessageKey.bindAsEventListener(ideeli.checkout,el));setTimeout('ideeli.checkout.trackGiftNoteMessageTimer("'+(el.id)+'")',200);}},initSuccessMetric:function(){var successful_run=false,error_message='';if(!ideeli.checkout.use_store_credits_modal){error_message+='No use_store_credits_modal initialized. ';}
if(error_message.length===0){successful_run=true;}
return[successful_run,error_message,{}];},initCVVLimiter:function(){if($('credit_card_verification_value')||$('credit_card_number')){validKeys=[8,9,35,36,37,38,39,40,45,46,47,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];if($('credit_card_verification_value')){$('credit_card_verification_value').observe('keydown',this.limitChars.bindAsEventListener(this));}
if($('credit_card_number')){$('credit_card_number').observe('keydown',this.limitChars.bindAsEventListener(this));}}},initBillingSameShippingCbx:function(){var el=$('use_shipping_address');if(el){el.observe('click',this.billingSameShippingCbxListener.bindAsEventListener(this,el));}
this.billingSameShippingCbxListener(null,el);},billingSameShippingCbxListener:function(ev,el){if(el){$$('.billingField').each(function(f){if(el.checked){f.clear();f.disable();f.removeClassName('generic_errors_field');}
else{f.enable();f.removeClassName('generic_errors_field');}},this);$$('.billingLabel','.billingField').each(function(f){el.checked?f.addClassName('disabled'):f.removeClassName('disabled');},this);}},limitChars:function(ev){var key=(document.all)?ev.keyCode:ev.which;if(validKeys.indexOf(key)<0||ev.altKey||ev.ctrlKey||ev.shiftKey){ev.stop();}},openUseStoreCreditModal:function(){ideeli.checkout.use_store_credits_modal.open();ideeli.checkout.use_store_credits_modal.bringToFront();$('use_store_credits_modal').setStyle({'zIndex':'20000'});},revertGiftRecipient:function(form_id,row_id,gr_id){var form=$(form_id);if(form){var els=$$('#'+form.id+' .gift_recipient_input');els.each(function(el){el.setValue(el.readAttribute('data-default-value'));});}
var row=$(row_id);if(row){row.hide();}
if($('gift_card_edit_info_link_'+gr_id)){$('gift_card_edit_info_link_'+gr_id).show();}
return false;},selectFirstRecipientEmail:function(){if(!Prototype.Browser.IE&&$$(".recipient_to_email").collect(function(el){if(el.visible()){return el;}}).any()){$$(".recipient_to_email").collect(function(el){if(el.visible()){return el;}}).first().focus();}},setupCheckoutTimers:function(){var url=$('cart_expiration_url').getValue();if(!url.blank()){var req=new Ajax.Request(url);}},setupCreditCardHints:function(){if(Prototype.Browser.IE){setTimeout("ideeli.checkout.createCreditCardHints();ideeli.checkout.initCVVLimiter();",1000);}
else{ideeli.checkout.createCreditCardHints();ideeli.checkout.initCVVLimiter();}},setUpVcardGiftables:function(){$$('.vcard_giftable_checkbox','.vcard_giftable_label').each(function(el){el.observe('click',ideeli.checkout.toggleGiftable.bindAsEventListener(ideeli.checkout,el.readAttribute('data-line-item-id'),el.readAttribute('data-gift-recipient-id')));});setTimeout('ideeli.checkout.selectFirstRecipientEmail();ideeli.checkout.setupVcardGiftableMessageCountdown();',500);},setupVcardGiftableMessageCountdown:function(){$$('.gift_recipient_form .recipient_gift_message').each(function(el){if(el.visible()){el.observe('keydown',ideeli.checkout.trackGiftableMessageKey.bindAsEventListener(ideeli.checkout,el));setTimeout('ideeli.checkout.trackGiftableMessageTimer("'+(el.id)+'")',200);}});},shippingAfterOpen:function(){$$('.shipping_form_el').invoke('observe','change',function(){if(ideeli.checkout.cancelShippingDifferent){ideeli.checkout.cancelShippingDifferent=false;}});},shippingBeforeClose:function(){this.showSelects();},showSelects:function(){if(Prototype.Browser.IE){$$('.items_totals_content select').invoke('show');}},showSubmitButtons:function(){if(ideeli.checkout.place_order_button_loader){$$('.place_order_button_loader').invoke('hide');$$('.place_order_buttons_disabled').invoke('hide');$$('.place_order_buttons').invoke('show');}},hideSubmitButtons:function(){if(ideeli.checkout.place_order_button_loader){$$('.place_order_button_loader').invoke('show');$$('.place_order_buttons').invoke('hide');$$('.place_order_buttons_disabled').invoke('hide');}},showGiftRecipientSaveModal:function(gift_card){if(gift_card){$$('.confirm_unsaved_gifts_saved').each(function(el){el.update('updated');},this);$$('.confirm_unsaved_gifts_save').each(function(el){el.update('update');},this);ideeli.checkout.giftRecipientSaveModal=new Control.Modal($('confirm_unsaved_gifts'),{closeOnClick:true,position:'center'});ideeli.checkout.giftRecipientSaveModal.open();}
else{$$('.confirm_unsaved_gifts_saved').each(function(el){el.update('saved');},this);$$('.confirm_unsaved_gifts_save').each(function(el){el.update('save');},this);ideeli.checkout.giftRecipientSaveModal=new Control.Modal($('confirm_unsaved_gifts'),{closeOnClick:true,position:'center'});ideeli.checkout.giftRecipientSaveModal.open();}},submitGiftRecipientSaveModal:function(){var form_ids=$('form_ids').getValue().split(',');if(form_ids.any()){var gift_recipients=[],gr={}
form_ids.each(function(form_id){gr=$(form_id).serialize(true);gift_recipients.push({'id':gr['gift_recipient[id]'],'from_name':gr['gift_recipient[from_name]'],'message':gr['gift_recipient[message]'],'quantity':gr['gift_recipient[quantity]'],'to_email':gr['gift_recipient[to_email]'],'to_name':gr['gift_recipient[to_name]']});});var obj=Object.toJSON(gift_recipients);window.gift_recipients=obj;var req=new Ajax.Request('/store/update_gift_recipients',{parameters:{"gift_recipients":obj.toString()}});}},submitPlaceOrderStoreCreditCheck:function(ignore_gift_recipients){if($$('.gift_recipient_input').any()&&!ignore_gift_recipients){var gift_recipient_differences=[];var gift_card_differences=[];$$('.gift_recipient_input').each(function(el){if(el.getValue()!=el.readAttribute('data-default-value')){if(el.readAttribute('data-gift-card').toString()=='1'){if(gift_card_differences.indexOf(el.form.id)<0){gift_card_differences.push(el.form.id);}}
else{if(gift_recipient_differences.indexOf(el.form.id)<0){gift_recipient_differences.push(el.form.id);}}}});if(gift_recipient_differences.length>0&&gift_card_differences.length==0){$('form_ids').setValue(gift_recipient_differences.join(','));setTimeout('ideeli.checkout.showGiftRecipientSaveModal()',300);return false;}
else if(gift_card_differences.length>0&&gift_recipient_differences.length==0){$('form_ids').setValue(gift_card_differences.join(','));setTimeout('ideeli.checkout.showGiftRecipientSaveModal(true)',300);return false;}
else if(gift_recipient_differences.length>0&&gift_card_differences.length>0){var differences=gift_recipient_differences.join(',');differences+=','+gift_card_differences.join(',');$('form_ids').setValue(differences);setTimeout('ideeli.checkout.showGiftRecipientSaveModal()',300);return false;}}
if($('store_credit_check_url')){$$('.place_order_buttons').invoke('hide');$$('.place_order_buttons_disabled').invoke('show');var url=$('store_credit_check_url').getValue();var req=new Ajax.Request(url);}},checkAuthorizationStatus:function(){if(Control.Modal.current&&Control.Modal.current.container.id=='cart_authorizing'&&$('authorization_status_url').value)
var req=new Ajax.Request($('authorization_status_url').value,{evalScripts:true,onSuccess:function(){if(Control.Modal.current&&Control.Modal.current.container.id=='cart_authorizing')
setTimeout('ideeli.checkout.checkAuthorizationStatus()',1000);}});},cartAuthorizing:function(){ideeli.checkout.cartAuthorizingModal=new Control.Modal($('cart_authorizing'),{position:'center',overlayOpacity:0.5,width:294,closeOnClick:false});ideeli.checkout.cartAuthorizingModal.open();},submitPlaceOrder:function(){$$('.place_order_buttons').invoke('hide');$$('.place_order_buttons_disabled').invoke('show');if($('add_a_gift_note')&&$('order_has_gift_note')&&($('order_has_gift_note').checked)){if($('place_order_gift_note')){$('place_order_gift_note').setValue($('gift_note_input_box').getValue());}else{$('enter_credit_card_form').insert({'bottom':new Element('input',{'type':'hidden','name':'gift_note','id':'place_order_gift_note','value':$('gift_note_input_box').getValue()})});}}else{if($('place_order_gift_note')){$('place_order_gift_note').setValue('');}}
var el=$('enter_credit_card_form');var req=new Ajax.Request(el.action,{parameters:el.serialize(),evalScripts:true,onLoading:function(){if($('authorization_status_url').value)ideeli.checkout.cartAuthorizing()}.bind(this),onSuccess:function(){if($('authorization_status_url').value)ideeli.checkout.checkAuthorizationStatus()}.bind(this)});},submitPlaceOrderNoStoreCredits:function(){if($('place_order_use_store_credits')){$('place_order_use_store_credits').setValue(0);}
else{$('enter_credit_card_form').insert({'bottom':new Element('input',{'type':'hidden','name':'use_store_credits','id':'place_order_use_store_credits','value':0})});}
ideeli.checkout.use_store_credits_modal.close();ideeli.checkout.submitPlaceOrder();},submitPlaceOrderUseStoreCredits:function(){if($('place_order_use_store_credits')){$('place_order_use_store_credits').setValue(1);}
else{$('enter_credit_card_form').insert({'bottom':new Element('input',{'type':'hidden','name':'use_store_credits','id':'place_order_use_store_credits','value':1})});}
ideeli.checkout.use_store_credits_modal.close();ideeli.checkout.submitPlaceOrder();},submitGiftable:function(form_el){var el=$(form_el)
if(!el){return;}
if(!ideeli.checkout.submitGiftableSending){var req=new Ajax.Request(el.action,{parameters:el.serialize(),onLoading:function(){ideeli.checkout.submitGiftableSending=true;}.bind(this),onFailure:function(){ideeli.checkout.submitGiftableSending=false;}.bind(this),onComplete:function(){ideeli.checkout.submitGiftableSending=false;}.bind(this)});}},selectNextCard:function(){var check=false;$$('.payment_card_cbx').each(function(i){if(i.checked){i.checked=false
check=true}else if(check&&!i.up().hasClassName('expired_item')&&!i.up().hasClassName('error_item')){i.checked=true
check=false}})},toggleShippingDifferent:function(){return true;},toggleShippingDifferentModal:function(){return true;},disableAddAGiftNote:function(){if($('add_a_gift_note')){$('gift_note_input_box').setValue('');$('gift_note_input_modal').hide();$('add_a_gift_note').hide();if($('order_has_gift_note').checked){$('order_has_gift_note').checked=false;ideeli.checkout.showIneligibleGiftNoteModal();}}},showIneligibleGiftNoteModal:function(){ideeli.checkout.show_ineligible_gift_note_modal=new Control.Modal($('show_ineligible_gift_note_modal'),{className:'ineligible_gift_note_modal',closeOnClick:'overlay',fade:false,height:74,overlayOpacity:0.5,position:'center',width:355});ideeli.checkout.show_ineligible_gift_note_modal.open();},toggleAddAGiftNoteInputModal:function(){if($('gift_note_input_modal').visible()){$('gift_note_input_modal').hide();$('gift_note_input_box').setValue('');$('order_has_gift_note').checked=false;}else{$('gift_note_input_modal').show();$('order_has_gift_note').checked=true;}},toggleGiftable:function(ev,line_item_id,gift_recipient_id){ev.stop();var params={'line_item_id':line_item_id};if(gift_recipient_id){params['gift_recipient_id']=gift_recipient_id;}
if(window.location.href.match(/prepare_update/)){params['from_update_order']=1;}
var req=new Ajax.Request('/store/toggle_giftable',{parameters:params,onLoading:function(){var el=gift_recipient_id?$('vcard_giftable_'+line_item_id+'_'+gift_recipient_id):$('vcard_giftable_'+line_item_id);if(el){el.hide();}
el=gift_recipient_id?$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_id):$('vcard_giftable_loading_'+line_item_id);if(el){el.show();}}});},toggleGiftableCheck:function(line_item_id,offer_id,sku_id,gift_recipient_id){var el=gift_recipient_id?$('vcard_giftable_'+line_item_id+'_'+gift_recipient_id):$('vcard_giftable_'+line_item_id);if(el){el.hide();}
el=$('vcard_giftable_'+line_item_id);if(el){el.checked=true;el.show();}
el=$('give_as_gift_'+offer_id+'_'+sku_id);if(el){el.hide();}
el=$('this_is_a_gift'+offer_id+'_'+sku_id);if(el){el.show();}},toggleGiftableUncheck:function(line_item_id,offer_id,sku_id,gift_recipient_id){var el=gift_recipient_id?$('vcard_giftable_'+line_item_id+'_'+gift_recipient_id):$('vcard_giftable_'+line_item_id);if(el){el.hide();}
el=$('vcard_giftable_'+line_item_id);if(el){el.checked=false;el.show();}
el=$('this_is_a_gift'+offer_id+'_'+sku_id);if(el){el.hide();}
el=$('give_as_gift_'+offer_id+'_'+sku_id);if(el){el.show();}},trackGiftableMessageCount:function(el_id){var el=$(el_id);if(el){var gift_recipient_id=el.readAttribute('data-id'),chars_left_el=$('chars_left_'+gift_recipient_id),el_length=el.getValue().length;if(chars_left_el&&(parseInt(chars_left_el.innerHTML)!=el_length)){if(el_length==0){chars_left_el.setStyle({'color':'#666'});chars_left_el.update('250');}
else{if(el_length>250){el.setValue(el.getValue().substring(0,250));el_length=el.getValue().length;}
var chars_left=Math.max((250-el_length),0);chars_left_el.update(''+chars_left);if(chars_left<=50){chars_left_el.setStyle({'color':'#c33'});}
else{chars_left_el.setStyle({'color':'#666'});}}}}},trackGiftableMessageKey:function(ev,el){if(el.getValue().length>250){var keys=[8,9,35,36,37,38,39,40,45,46,47];if(keys.indexOf(key)>=0){ev.stop();}
el.setValue(el.getValue().substring(0,250));}
else{ideeli.checkout.trackGiftableMessageCount(el.id);}},trackGiftableMessageTimer:function(el_id){ideeli.checkout.trackGiftableMessageCount(el_id);setTimeout('ideeli.checkout.trackGiftableMessageTimer("'+(el_id)+'")',200);},trackGiftNoteMessageCount:function(el_id){var el=$('gift_note_input_box');if(el){var chars_left_el=$('chars_left_gift_note_input_box'),el_length=el.getValue().length;if(chars_left_el&&(parseInt(chars_left_el.innerHTML)!=el_length)){if(el_length==0){chars_left_el.setStyle({'color':'#666'});chars_left_el.update('150');}
else{if(el_length>150){el.setValue(el.getValue().substring(0,150));el_length=el.getValue().length;}
var chars_left=Math.max((150-el_length),0);chars_left_el.update(''+chars_left);if(chars_left<=50){chars_left_el.setStyle({'color':'#c33'});}
else{chars_left_el.setStyle({'color':'#666'});}}}}},trackGiftNoteMessageKey:function(ev,el){el.setValue(el.getValue().replace(/[^a-zA-Z0-9\.\,\?\!\@\#\$\%\^\&\* ]/g,''));if($('gift_note_input_box').getValue().length>150){var key=(document.all)?ev.keyCode:ev.which;var keys=[8,9,35,36,37,38,39,40,45,46,47];if(keys.indexOf(key)>=0){ev.stop();}
$('gift_note_input_box').setValue($('gift_note_input_box').getValue().substring(0,150));}
else{ideeli.checkout.trackGiftNoteMessageCount('gift_note_input_box');}},trackGiftNoteMessageTimer:function(el_id){ideeli.checkout.trackGiftNoteMessageCount('gift_note_input_box');setTimeout('ideeli.checkout.trackGiftNoteMessageTimer("gift_note_input_box")',200);},updateBillingAddress:function(){var checked_radios=$$('#enter_credit_card_form > div > input:checked');if(checked_radios.length>0){var stored_credit_card_id=checked_radios.first().getValue();var req=new Ajax.Request($('update_billing_address_url').getValue(),{parameters:{'id':stored_credit_card_id},onLoading:function(){ideeli.checkout.hideSubmitButtons();$('check_out_billing_address').hide();$('check_out_billing_address_loading').show();},onFailure:function(){$('check_out_billing_address_loading').hide();$('check_out_billing_address').update('<div class="content">Error refreshing billing address. Trying again ...</div>').show();ideeli.checkout.updateBillingAddress.delay(3);},onSuccess:function(){ideeli.checkout.showSubmitButtons();}});}else{$("check_out_billing_address_loading").hide();if($$('#enter_credit_card_form > div > input[type=radio]').any()){$$('#enter_credit_card_form > div > input[type=radio]').first().writeAttribute('checked',true);ideeli.checkout.updateBillingAddress();}}},requestFallbackOrderTax:function(){var req=new Ajax.Request($('request_fallback_order_tax_url').getValue(),{parameters:{'id':$('order_id').getValue()},onLoading:function(){$('total_tax').hide();$('total_tax_loading').show();},onFailure:function(){$('total_tax_loading').hide();$('total_tax').update('Error requesting tax. Your tax will be finalized when the order is shipped.').show();},onSuccess:function(transport){}});},createPeriodicalRefreshTax:function(quantum){ideeli.checkout.count_for_periodical_refresh_tax=0;ideeli.checkout.tax_needs_recalculating='true';quantum=quantum||3;if($('total_tax')){ideeli.checkout.hideSubmitButtons();$('total_tax').hide();$('total_tax_loading').show();}
ideeli.checkout.periodical_executor=new PeriodicalExecuter(ideeli.checkout.refreshTaxRequester.bind(ideeli.checkout),quantum);},hidePlusMinusButtons:function(skuId){if($('cart_item_'+skuId+'_add')){$('cart_item_'+skuId+'_add').hide();}
if($('cart_item_'+skuId+'_add_disabled')){$('cart_item_'+skuId+'_add_disabled').show();}
if($('cart_item_'+skuId+'_minus')){$('cart_item_'+skuId+'_minus').hide();}
if($('cart_item_'+skuId+'_minus_disabled')&&!$('cart_item_'+skuId+'_minus_disabled').hasClassName('gift_card')){$('cart_item_'+skuId+'_minus_disabled').show();}
return true;},showPlusMinusButtons:function(skuId,atMaximum){if(!atMaximum){if($('cart_item_'+skuId+'_add')){$('cart_item_'+skuId+'_add').show();}
if($('cart_item_'+skuId+'_add_disabled')){$('cart_item_'+skuId+'_add_disabled').hide();}}else{if($('cart_item_'+skuId+'_add_disabled')){$('cart_item_'+skuId+'_add_disabled').show();}
if($('cart_item_'+skuId+'_add')){$('cart_item_'+skuId+'_add').hide();}}
if($('cart_item_'+skuId+'_minus')){$('cart_item_'+skuId+'_minus').show();}
if($('cart_item_'+skuId+'_minus_disabled')){$('cart_item_'+skuId+'_minus_disabled').hide();}
return true;},refreshTaxRequester:function(executer){if(++ideeli.checkout.count_for_periodical_refresh_tax>4){ideeli.checkout.requestFallbackOrderTax();executer.stop();}
else{ideeli.checkout.hideSubmitButtons();if(ideeli.checkout.tax_needs_recalculating=='true'){var req=new Ajax.Request($('request_true_order_tax_url').getValue(),{parameters:{'id':$('order_id').getValue()},onLoading:function(){$('total_tax').hide();$('total_tax_estimated').hide();$('total_tax_loading').show();},onFailure:function(){$('total_tax_loading').hide();$('total_tax').update('Error requesting tax. Your tax will be finalized when the order is shipped.').show();ideeli.checkout.place_order_button_loader=1;ideeli.checkout.showSubmitButtons();},onSuccess:function(transport){try{ideeli.checkout.tax_needs_recalculating=transport.responseText.match(/tax_needs_recalculating.*(true|false)/)[1]||'true';if(ideeli.checkout.tax_needs_recalculating=="false"){executer.stop();return true;}}
catch(e){return true;}}});}}},verifyShippingAddress:function(ret){if(!window.submitted){window.submitted=true;$$('#reservation_address_form').first().submit();return false;}
$$('.qas_error_field').each(function(item){item.removeClassName('qas_error_field');});var form=$$('#reservation_address_form').first();if($$('.shipping_form_el').first().readAttribute('disabled')==null){var pref=['user_billing_','user_shipping_'];}else{var pref=['user_billing_'];}
var isValid=true;var errsHTML='<li><br><a target="_new" href="http://support.ideeli.com/app/ask">Contact us</a> if you think you have received this message in error.</li>';if($('order_shipping_telephone').value.length<9){$('order_shipping_telephone').addClassName('qas_error_field');$('order_shipping_telephone').focus();isValid=false;errsHTML='<li>Phone is required</li>'+errsHTML;}
if($('credit_card_verification_value').value.length<3||$('credit_card_verification_value').value.startsWith(' ')){$('credit_card_verification_value').addClassName('qas_error_field');$('credit_card_verification_value').focus();isValid=false;errsHTML='<li>Credit card security code is required</li>'+errsHTML;}
if($('credit_card_number').value==''||$('credit_card_number').value.startsWith(' ')){$('credit_card_number').addClassName('qas_error_field');$('credit_card_number').focus();isValid=false;errsHTML='<li>Credit card number is required</li>'+errsHTML;}
if($('credit_card_last_name').value==''||$('credit_card_last_name').value.startsWith(' ')){$('credit_card_last_name').addClassName('qas_error_field');$('credit_card_last_name').focus();isValid=false;errsHTML='<li>Credit card last name is required</li>'+errsHTML;}
if($('credit_card_first_name').value==''||$('credit_card_first_name').value.startsWith(' ')){$('credit_card_first_name').addClassName('qas_error_field');$('credit_card_first_name').focus();isValid=false;errsHTML='<li>Credit card first name is required</li>'+errsHTML;}
pref.each(function(item){if(item=='order_billing_'){var errPref='Billing ';}else{var errPref='Shipping ';}
if($(item+'zip').value.length<5||$(item+'zip').value.startsWith(' ')){$(item+'zip').addClassName('qas_error_field');$(item+'zip').focus();isValid=false;errsHTML='<li>A valid '+errPref.toLowerCase()+'zip code is required</li>'+errsHTML;}
if($(item+'state').value==''){isValid=false;errsHTML='<li>'+errPref+'state is required</li>'+errsHTML;}
if($(item+'city').value==''||$(item+'city').value.startsWith(' ')){$(item+'city').addClassName('qas_error_field');$(item+'city').focus();isValid=false;errsHTML='<li>'+errPref+'city is required</li>'+errsHTML;}
if($(item+'address1').value==''||$(item+'address1').value.startsWith(' ')){$(item+'address1').addClassName('qas_error_field');$(item+'address1').focus();isValid=false;errsHTML='<li>'+errPref+'street address  is required</li>'+errsHTML;}
if($(item+'last_name').value==''||$(item+'last_name').value.startsWith(' ')){$(item+'last_name').addClassName('qas_error_field');$(item+'last_name').focus();isValid=false;errsHTML='<li>'+errPref+'last name is required</li>'+errsHTML;}
if($(item+'first_name').value==''||$(item+'first_name').value.startsWith(' ')){$(item+'first_name').addClassName('qas_error_field');$(item+'first_name').focus();isValid=false;errsHTML='<li>'+errPref+'first name is required</li>'+errsHTML;}
if(!isValid){if($('credit_card_errors')){$('credit_card_errors').hide();}
$$('#shipping_address_errors ul')[0].innerHTML=errsHTML;$('shipping_address_errors').show();return false;}else{$('shipping_address_errors').hide();if(ret){form.submit();}}});},actionLink:{in_process:false,disable:function(){this.in_process=true},enable:function(){this.in_process=false},isEnable:function(){return false==this.in_process}},shippingDateTests:function(start,end,segments,endAt,isCart){u=window.current_user;seg=segments.split(/\s*,\s*/);var isTesting=false
seg.each(function(num){if(u&&u.testing_segment_id&&(num==u.testing_segment_id)){isTesting=true;}});if(!isTesting){return}
var monthsArray=['January','February','March','April','May','June','July','August','September','October','November','December'];var startCur,endCur;if(!isCart){var shipDates=$('shipping_window_for_offer').innerHTML.substring(28,51).replace(',','');shipDates=shipDates.split(' ');monthsArray.each(function(item){if(item.substring(0,3)==shipDates[0]){startCur=new Date(item+' '+shipDates[1]+', '+shipDates[5])}
if(item.substring(0,3)==shipDates[3]){endCur=new Date(item+' '+shipDates[4]+', '+shipDates[5])}});endAt=new Date(endAt);endAt.setDate(endAt.getDate()-2);oStart=new Date(startCur);oEnd=new Date(endCur);startCur.setDate(startCur.getDate()+start);var weekends=0;((oStart.getDay()==5)&&(start>0))?weekends=1:weekends=0;if(start>0){for(var index=0;index<=start;++index){var item=new Date();item.setDate(oStart.getDate()+index);if(item.getDay()==0){++weekends;}
if(item.getDay()==6){weekends+=2;}}}else{if(oStart.getDay()==5){weekends=2}
for(var index=0;index>=start;--index){var item=new Date();item.setDate(startCur.getDate()+index);if(start<0){if(item.getDay()==6){--weekends;}
if(item.getDay()==0){--weekends;}}}}
startCur.setDate(startCur.getDate()+weekends);if(startCur.getDay()==0){if(start>0){startCur.setDate(startCur.getDate()+1);}else{startCur.setDate(startCur.getDate()-2);}}
if(startCur.getDay()==6){if(start>0){startCur.setDate(startCur.getDate()+2);}else{startCur.setDate(startCur.getDate()-1);}}
if(endAt>startCur){startCur=endAt}
endCur.setDate(endCur.getDate()+end);((oEnd.getDay()==5)&&(end>0))?weekends=1:weekends=0;if(end>0){for(var index=0;index<=end;++index){var item=new Date();item.setDate(oEnd.getDate()+index);if(end>0){if(item.getDay()==0){++weekends;}
if(item.getDay()==6){weekends+=2;}}}}else{if(oEnd.getDay()==5){weekends=2}
for(var index=0;index>=end;--index){var item=new Date();item.setDate(oEnd.getDate()+index);if(end<0){if(item.getDay()==6){--weekends;}
if(item.getDay()==0){weekends-=2;}}}}
endCur.setDate(endCur.getDate()+weekends);if(endCur.getDay()==0){if(end<0){endCur.setDate(endCur.getDate()-2);}else{endCur.setDate(endCur.getDate()+1);}}
if(endCur.getDay()==6){if(end>0){endCur.setDate(endCur.getDate()+2);}else{endCur.setDate(endCur.getDate()-1);}}
$('shipping_window_for_offer').update('EXPECTED TO SHIP BETWEEN <br>'+startCur.toDateString().substring(4,10)+' and '+endCur.toDateString().substring(4,10)+', '+endCur.getFullYear()+' <br>');$('shipping_window_for_offer').innerHTML;}else{var mDate=new Date();var shipDates=$$('.cart_item_ship_date_span');shipDates.each(function(item){var d=item.innerHTML.substring(8).replace('and ','');d=d.split(' ');monthsArray.each(function(mo){if(mo.substring(0,3)==d[0]){startCur=new Date(mo+' '+d[1]+', '+mDate.getFullYear())}
if(mo.substring(0,3)==d[2]){endCur=new Date(mo+' '+d[3]+', '+mDate.getFullYear())}});var offerId=item.id.substring(25);endAt=$('cart_item_ship_date_end_at_'+offerId).value;endAt=new Date(endAt);endAt.setDate(endAt.getDate()-2);oStart=new Date(startCur);oEnd=new Date(endCur);startCur.setDate(startCur.getDate()+start);var weekends=0;((oStart.getDay()==5)&&(start>0))?weekends=1:weekends=0;if(start>0){for(var index=0;index<=start;++index){var item=new Date();item.setDate(oStart.getDate()+index);if(item.getDay()==0){++weekends;}
if(item.getDay()==6){weekends+=2;}}}else{if(oStart.getDay()==5){weekends=2}
for(var index=0;index>=start;--index){var item=new Date();item.setDate(startCur.getDate()+index);if(start<0){if(item.getDay()==6){--weekends;}
if(item.getDay()==0){--weekends;}}}}
startCur.setDate(startCur.getDate()+weekends);if(startCur.getDay()==0){if(start>0){startCur.setDate(startCur.getDate()+1);}else{startCur.setDate(startCur.getDate()-2);}}
if(startCur.getDay()==6){if(start>0){startCur.setDate(startCur.getDate()+2);}else{startCur.setDate(startCur.getDate()-1);}}
if(endAt>startCur){startCur=endAt}
endCur.setDate(endCur.getDate()+end);((oEnd.getDay()==5)&&(end>0))?weekends=1:weekends=0;if(end>0){for(var index=0;index<=end;++index){var item=new Date();item.setDate(oEnd.getDate()+index);if(end>0){if(item.getDay()==0){++weekends;}
if(item.getDay()==6){weekends+=2;}}}}else{if(oEnd.getDay()==5){weekends=2}
for(var index=0;index>=end;--index){var item=new Date();item.setDate(oEnd.getDate()+index);if(end<0){if(item.getDay()==6){--weekends;}
if(item.getDay()==0){weekends-=2;}}}}
endCur.setDate(endCur.getDate()+weekends);if(endCur.getDay()==0){if(end<0){endCur.setDate(endCur.getDate()-2);}else{endCur.setDate(endCur.getDate()+1);}}
if(endCur.getDay()==6){if(end>0){endCur.setDate(endCur.getDate()+2);}else{endCur.setDate(endCur.getDate()-1);}}
$('cart_item_ship_date_span_'+offerId).update('Between '+startCur.toDateString().substring(4,10)+' and '+endCur.toDateString().substring(4,10));$('cart_item_ship_date_span_'+offerId).innerHTML;});}}}}();if(typeof(ideeli.update_order)=='undefined'){ideeli.update_order=new Object();}
ideeli.update_order=function(){return{attachHeader:function(modal_name){if(ideeli.update_order[modal_name]){var headerElImg=new Element('img',{'id':'cart_modal_close_icon','src':'http://0.cdn.ideeli.net/images/cart/cart_modal_close_red.gif','style':'position:absolute;top:0;right:0;'}).observe('click',ideeli.update_order[modal_name].close.bind(ideeli.update_order[modal_name]));var headerElLink=new Element('a',{'href':'#','border':0,'title':'close','alt':'close'}).update(headerElImg).observe('click',ideeli.update_order[modal_name].close.bind(ideeli.update_order[modal_name]));var headerEl=new Element('div',{'id':'cart_modal_header','style':'height:17px;padding:0;margin:0;'}).update(headerElLink).observe('click',ideeli.update_order[modal_name].close.bind(ideeli.update_order[modal_name]));var container=ideeli.update_order[modal_name].container;container.insert({'top':headerEl});}},closeCancelReasonModal:function(){ideeli.update_order.cancel_reason_modal.close();},closeWarningModal:function(){if(ideeli.update_order&&ideeli.update_order.warning_modal){ideeli.update_order.warning_modal.close();}},confirmGiftDestroy:function(){if($('gift_recipient_destroy_id')&&$('line_item_id')){var gift_recipient_destroy_id=$('gift_recipient_destroy_id').getValue();var line_item_id=$('line_item_id').getValue();if(gift_recipient_destroy_id&&line_item_id){var req=new Ajax.Request('/store/toggle_giftable',{parameters:{'line_item_id':line_item_id,'gift_recipient_id':gift_recipient_destroy_id,'destroy':'1','from_update_order':1},onLoading:function(){$('vcard_giftable_'+line_item_id+'_'+gift_recipient_destroy_id).hide();$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_destroy_id).show();},onLoaded:function(){$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_destroy_id).hide();$('vcard_giftable_'+line_item_id+'_'+gift_recipient_destroy_id).show();},onFailure:function(){$('vcard_giftable_loading_'+line_item_id+'_'+gift_recipient_destroy_id).hide();$('vcard_giftable_'+line_item_id+'_'+gift_recipient_destroy_id).show();}});}}},createCreditCardHints:function(){if(ideeli.update_order.credit_card_hints.any()){ideeli.update_order.credit_card_hints.each(function(hint){hint.destroy();});ideeli.update_order.credit_card_hints=[];}
$$('.credit_card_hint').each(function(el){ideeli.update_order.credit_card_hints.push(new Control.Window(el,{position:'relative',className:'hoverFrame',closeOnClick:true,constrainToViewport:true}));});},createHints:function(){if(ideeli.update_order.hints.any()){ideeli.update_order.hints.each(function(hint){hint.destroy();});ideeli.update_order.hints=[];}
$$('.cart_hint').each(function(el){ideeli.update_order.hints.push(new Control.Window(el,{position:'relative',className:'hoverFrame',closeOnClick:true,constrainToViewport:false,offsetLeft:-70}));});},createCancelReasonModal:function(){this.cancel_reason_modal=new Control.Modal($('cancel_reason_modal'),{beforeClose:this.showSelects.bind(this),beforeOpen:this.hideSelects.bind(this),className:'modal',closeOnClick:'overlay',fade:false,height:350,overlayOpacity:0.5,position:'center',width:425});ideeli.update_order.attachHeader('cancel_reason_modal');},createWarningModal:function(){this.warning_modal=new Control.Modal($('warning_modal'),{beforeClose:this.showSelects.bind(this),beforeOpen:this.hideSelects.bind(this),className:'modal',closeOnClick:'overlay',fade:false,height:150,overlayOpacity:0.5,position:'center',width:425});ideeli.update_order.attachHeader('warning_modal');},editCard:function(){var selected_cards=[];if((selected_cards=$$('#payment_methods_card_select > input:checked')).any()){$('edit_card_stored_credit_card_id').setValue(selected_cards.first().getValue());$('edit_card_form').submit();}
else{$('warning_modal_content').update('<div style="margin: 0 10px"><h3><b>Please select a credit card to edit.</b></h3><br /><br /><div style="float:left;width:200px;"><a href="#" onclick="ideeli.update_order.closeWarningModal();return false;">OK</a></div><br /></div>');ideeli.update_order.openWarningModal();}},hideSelects:function(){if(Prototype.Browser.IE){$$('.items_totals_content select').invoke('hide');}},init:function(){this.hints=[];this.credit_card_hints=[];this.createHints();this.updateBillingAddress();ideeli.checkout.setUpVcardGiftables();ideeli.checkout.selectFirstRecipientEmail();ideeli.update_order.initGiftNoteListeners();},initGiftNoteListeners:function(){var el=$('gift_note_input_box');if(el){el.observe('keydown',ideeli.update_order.trackGiftNoteMessageKey.bindAsEventListener(ideeli.update_order,el));setTimeout('ideeli.checkout.trackGiftNoteMessageTimer("'+(el.id)+'")',200);}},initCVVLimiter:function(){if($('credit_card_verification_value')||$('credit_card_number')){validKeys=[8,9,35,36,37,38,39,40,45,46,47,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];if($('credit_card_verification_value')){$('credit_card_verification_value').observe('keydown',this.limitChars.bindAsEventListener(this));}
if($('credit_card_number')){$('credit_card_number').observe('keydown',this.limitChars.bindAsEventListener(this));}}},limitChars:function(ev){var key=(document.all)?ev.keyCode:ev.which;if(validKeys.indexOf(key)<0||ev.altKey||ev.ctrlKey||ev.shiftKey){ev.stop();}},openCancelReasonModal:function(){if(!ideeli.update_order.cancel_reason_modal){ideeli.update_order.createCancelReasonModal();}
ideeli.update_order.cancel_reason_modal.open();},openWarningModal:function(){if(!ideeli.update_order.warning_modal){ideeli.update_order.createWarningModal();}
ideeli.update_order.warning_modal.open();},toggleShippingDifferent:function(){return true;},toggleShippingDifferentModal:function(){return true;},disableAddAGiftNote:function(){if($('add_a_gift_note')){$('gift_note_input_box').setValue('');$('gift_note_input_modal').hide();$('add_a_gift_note').hide();ideeli.update_order.updateGiftNote(false);if($('order_has_gift_note').checked){$('order_has_gift_note').checked=false;ideeli.update_order.showIneligibleGiftNoteModal();}}},showUpdateGiftNoteSuccess:function(){$('updated_gift_note_success').show();setTimeout(ideeli.update_order.hideUpdateGiftNoteSuccess,10000);},hideUpdateGiftNoteSuccess:function(){$('updated_gift_note_success').hide();},showIneligibleGiftNoteModal:function(){ideeli.update_order.show_ineligible_gift_note_modal=new Control.Modal($('show_ineligible_gift_note_modal'),{className:'ineligible_gift_note_modal',closeOnClick:'overlay',fade:false,height:74,overlayOpacity:0.5,position:'center',width:355});ideeli.update_order.show_ineligible_gift_note_modal.open();},updateGiftNote:function(prompt_user){prompt_user=(typeof prompt_user=='undefined')?true:false;var url=$('update_gift_note_url').getValue();if(url){var req=new Ajax.Request(url,{parameters:{'gift_note':$('gift_note_input_box').getValue(),'prompt_user':prompt_user?'1':'0'}});}},toggleAddAGiftNoteInputModal:function(){if($('gift_note_input_modal').visible()){$('gift_note_input_modal').hide();$('gift_note_input_box').setValue('');$('order_has_gift_note').checked=false;ideeli.update_order.updateGiftNote();}else{$('gift_note_input_modal').show();$('order_has_gift_note').checked=true;}},sendCancelReason:function(){var url=$('cancel_reason_url').getValue();if(url){var req=new Ajax.Request(url,{parameters:{'cancel_reason':$('cancel_reason').getValue(),'confirm_action':'1'}});}},setupCheckoutTimers:function(){var url=$('cart_expiration_url').getValue();if(!url.blank()){var req=new Ajax.Request(url);}},setupCreditCardHints:function(){if(Prototype.Browser.IE){setTimeout("ideeli.update_order.createCreditCardHints();ideeli.update_order.initCVVLimiter();",1000);}
else{ideeli.update_order.createCreditCardHints();ideeli.update_order.initCVVLimiter();}},shippingAfterOpen:function(){$$('.shipping_form_el').invoke('observe','change',function(){if(ideeli.update_order.cancelShippingDifferent){ideeli.update_order.cancelShippingDifferent=false;}});},shippingBeforeClose:function(){this.showSelects();},showSelects:function(){if(Prototype.Browser.IE){$$('.items_totals_content select').invoke('show');}},updateBillingAddress:function(){var stored_credit_card_id='current_order';var available_cards=[];if((available_cards=$$('#payment_methods_card_select > div > input:checked')).any()){stored_credit_card_id=available_cards.first().getValue();}
var req=new Ajax.Request($('update_billing_address_url').getValue(),{parameters:{'stored_credit_card_id':stored_credit_card_id,'id':$('order_id').getValue()},onLoading:function(){$('check_out_billing_address').hide();$('check_out_billing_address_loading').show();if($('authorization_status_url').value)ideeli.checkout.cartAuthorizing();},onFailure:function(){$('check_out_billing_address_loading').hide();$('check_out_billing_address').update('<div class="content">Error refreshing billing address. Trying again ...</div>').show();ideeli.checkout.updateBillingAddress.delay(3);},onSuccess:function(){ideeli.checkout.showSubmitButtons();if($('authorization_status_url').value)ideeli.checkout.checkAuthorizationStatus();}});},trackGiftNoteMessageCount:function(el_id){var el=$('gift_note_input_box');if(el){var chars_left_el=$('chars_left_gift_note_input_box'),el_length=el.getValue().length;if(chars_left_el&&(parseInt(chars_left_el.innerHTML)!=el_length)){if(el_length==0){chars_left_el.setStyle({'color':'#666'});chars_left_el.update('150');}
else{if(el_length>150){el.setValue(el.getValue().substring(0,150));el_length=el.getValue().length;}
var chars_left=Math.max((150-el_length),0);chars_left_el.update(''+chars_left);if(chars_left<=50){chars_left_el.setStyle({'color':'#c33'});}
else{chars_left_el.setStyle({'color':'#666'});}}}}},trackGiftNoteMessageKey:function(ev,el){el.setValue(el.getValue().replace(/[^a-zA-Z0-9\.\,\?\!\@\#\$\%\^\&\* ]/g,''));if($('gift_note_input_box').getValue().length>150){var key=(document.all)?ev.keyCode:ev.which;var keys=[8,9,35,36,37,38,39,40,45,46,47];if(keys.indexOf(key)>=0){ev.stop();}
$('gift_note_input_box').setValue($('gift_note_input_box').getValue().substring(0,150));}
else{ideeli.update_order.trackGiftNoteMessageCount('gift_note_input_box');}},trackGiftNoteMessageTimer:function(el_id){ideeli.update_order.trackGiftNoteMessageCount('gift_note_input_box');setTimeout('ideeli.checkout.trackGiftNoteMessageTimer("gift_note_input_box")',200);}}}();if(typeof(ideeli.update_payment_method)=='undefined'){ideeli.update_payment_method=new Object();}
ideeli.update_payment_method=function(){return{attachHeader:function(modal_name){if(ideeli.update_payment_method[modal_name]){var headerElImg=new Element('img',{'id':'cart_modal_close_icon','src':'http://0.cdn.ideeli.net/images/cart/cart_modal_close_red.gif','style':'position:absolute;top:0;right:0;'}).observe('click',ideeli.update_payment_method[modal_name].close.bind(ideeli.update_payment_method[modal_name]));var headerElLink=new Element('a',{'href':'#','border':0,'title':'close','alt':'close'}).update(headerElImg).observe('click',ideeli.update_payment_method[modal_name].close.bind(ideeli.update_payment_method[modal_name]));var headerEl=new Element('div',{'id':'cart_modal_header','style':'height:17px;padding:0;margin:0;'}).update(headerElLink).observe('click',ideeli.update_payment_method[modal_name].close.bind(ideeli.update_payment_method[modal_name]));var container=ideeli.update_payment_method[modal_name].container;container.insert({'top':headerEl});}},closeWarningModal:function(){ideeli.update_payment_method.warning_modal.close();if($('link_to_update_order_page')){window.location=$('link_to_update_order_page').innerHTML;}},createWarningModal:function(){this.warning_modal=new Control.Modal($('warning_modal'),{beforeClose:this.showSelects.bind(this),beforeOpen:this.hideSelects.bind(this),className:'modal',closeOnClick:'overlay',fade:false,height:150,overlayOpacity:0.5,position:'center',width:425});ideeli.update_payment_method.attachHeader('warning_modal');},disableAllCreditCardRadios:function(){var available_cards=[];if((available_cards=$$('#payment_methods_card_select > input:checked')).any()){stored_credit_card_id=available_cards.first().getValue();}
$$('input[name=stored_credit_card]').invoke('disable');},enableAllCreditCardRadios:function(){var available_cards=[];if((available_cards=$$('#payment_methods_card_select > input:checked')).any()){stored_credit_card_id=available_cards.first().getValue();}
$$('input[name=stored_credit_card]').invoke('enable');},hideSelects:function(){if(Prototype.Browser.IE){$$('.items_totals_content select').invoke('hide');}},init:function(){},initCVVLimiter:function(){if($('credit_card_verification_value')||$('credit_card_number')){validKeys=[8,9,35,36,37,38,39,40,45,46,47,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];if($('credit_card_verification_value')){$('credit_card_verification_value').observe('keydown',this.limitChars.bindAsEventListener(this));}
if($('credit_card_number')){$('credit_card_number').observe('keydown',this.limitChars.bindAsEventListener(this));}}},limitChars:function(ev){var key=(document.all)?ev.keyCode:ev.which;if(validKeys.indexOf(key)<0||ev.altKey||ev.ctrlKey||ev.shiftKey){ev.stop();}},openWarningModal:function(){if(!ideeli.update_payment_method.warning_modal){ideeli.update_payment_method.createWarningModal();}
ideeli.update_payment_method.warning_modal.open();},setCartFrameHeight:function(){if(parseInt(window.current_user.cart_items_count)>2){$$('.cart_modal_frame').first().setStyle({'height':'715px'});$$('.cart_modal_frame').first().addClassName('cart_modal_frame_tall');}
else{$$('.cart_modal_frame').first().setStyle({'height':'600px'});$$('.cart_modal_frame').first().removeClassName('cart_modal_frame_tall');}},showSelects:function(){if(Prototype.Browser.IE){$$('.items_totals_content select').invoke('show');}},toggleShippingDifferent:function(){return true;},shippingAfterOpen:function(){$$('.shipping_form_el').invoke('observe','change',function(){if(ideeli.update_payment_method.cancelShippingDifferent){ideeli.update_payment_method.cancelShippingDifferent=false;}});},shippingBeforeClose:function(){this.showSelects();},updateStoredCreditCard:function(credit_card_id){var req=new Ajax.Request($('update_stored_credit_card_url').getValue(),{parameters:{'stored_credit_card':credit_card_id,'id':$('order_id').getValue()},onLoading:function(){ideeli.update_payment_method.disableAllCreditCardRadios();$('update_stored_credit_card_loading').show();},onFailure:function(){$('update_stored_credit_card_loading').hide();$('payment_method_content').update('Error while authorizing credit card. Trying again ...').show();ideeli.update_payment_method.updateStoredCreditCard(credit_card_id).delay(3);}});}}}();if(typeof(ideeli.view_order)=='undefined'){ideeli.view_order={};}
ideeli.view_order=function(){return{init:function(){$$('.giftee_url').invoke('observe','click',this.gifteeUrlClick.bindAsEventListener(this));},createRedeemGiftCardLinkModal:function(el_id){this.redeem_gift_card_link_modal=new Control.Modal($(el_id),{className:'giftee_url_modal',closeOnClick:'overlay',fade:false,height:156,overlayOpacity:0.5,position:[parseInt((document.viewport.getWidth()-427)/2),135],width:427});this.redeem_gift_card_link_modal.open();window.scrollTo(0,0);},gifteeUrlClick:function(ev){var el=ev.element();el.select();}}}();if(typeof(ideeli)=='undefined'){ideeli=new Object();}
if(typeof(ideeli.orders)=='undefined'){ideeli.orders=new Object();}
ideeli.orders=function(){return{findReturnedItems:function(){var returnedItems=[];$$('.quantity_selector').each(function(el){if(el.selectedIndex>0){returnedItems.push(el);}});return returnedItems;},getIdForSelected:function(el){var id=el.id;var item_matches=id.match(/line_items_(\d+)_quantity/);if(Object.isArray(item_matches)&&item_matches.length>1){return item_matches[1];}
return false;},init:function(){$$('.quantity_selector').invoke('observe','change',this.quantitySelectorListener.bindAsEventListener(this));$$('.reason_selector').invoke('observe','change',this.reasonSelectorListener.bindAsEventListener(this));$$('.process_button').invoke('observe','click',this.processButtonListener.bindAsEventListener(this));this.initReturnPolicyPopups();},initReturnPolicyPopups:function(){if(!ideeli.orders.tooltips){ideeli.orders.tooltips=$H();}
var qty_warning=['.items_qty_content'];qty_warning.each(function(class_name){var els=$$(class_name);if(els.any()){els.each(function(el){tip=new Tip($(el),"That's all you're allowed!",{style:'warning',closeButton:true,showOn:false,hideOn:false,fixed:true,stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:190,hideAfter:3});ideeli.orders.tooltips.set(el.identify(),tip);},this);}},this);$$('.return_policy_popup').each(function(el){if(el&&el.hasAttribute('data-content')&&$(el.readAttribute('data-content'))){tip=new Tip(el,$(el.readAttribute('data-content')).innerHTML,{closeButton:true,showOn:'click',hideOthers:true,hideOn:{element:'closeButton',event:'click'},stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:315});tip.element.observe('prototip:shown',function(){$$('.hoverFrameCartClose').invoke('hide');if(this.hasAttribute('eligible_return_days')){$$('.eligible_return_days').invoke('update',this.readAttribute('eligible_return_days'));}
if(this.hasAttribute('holiday_return')&&this.readAttribute('holiday_return')=='yes'){$$('#eligible_return_standard_text').invoke('hide');$$('#eligible_return_holiday_text').invoke('show');}else{$$('#eligible_return_standard_text').invoke('show');$$('#eligible_return_holiday_text').invoke('hide');}});tip.element.observe('prototip:hidden',function(){$$('.hoverFrameCartClose').invoke('show');});ideeli.orders.tooltips.set(el.identify(),tip);}},this);$$('.cart_hint_popup').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:true,showOn:'click',hideOn:{element:'closeButton',event:'click'},stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:315});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.learn_more_popup').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:true,showOn:'click',hideOn:{element:'closeButton',event:'click'},stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:315});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.cart_hint_popup_ll_stem').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:true,showOn:'click',hideOn:{element:'closeButton',event:'click'},stem:'bottomLeft',hook:{target:'bottomRight',tip:'bottomLeft'},offset:{x:2,y:0},width:333});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.cart_hint_rollover').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:false,showOn:'mousemove',hideOn:'mouseout',stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:1},width:315,fixed:true});ideeli.orders.tooltips.set(el.identify(),tip);});this.initSamplingOpportunityPopups();},initSamplingOpportunityPopups:function(){if(!ideeli.orders.tooltips){ideeli.orders.tooltips=$H();}
$$('.sampling_opportunity_popup').each(function(el){tip=new Tip(el,$(el.readAttribute('data-content')).innerHTML,{closeButton:true,showOn:'click',hideOn:{element:'closeButton',event:'click'},stem:'topMiddle',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:2},width:315});tip.element.observe('prototip:shown',function(){$$('.hoverFrameCartClose').invoke('hide');if(this.hasAttribute('eligible_return_days')){$$('.eligible_return_days').invoke('update',this.readAttribute('eligible_return_days'));}});tip.element.observe('prototip:hidden',function(){$$('.hoverFrameCartClose').invoke('show');});ideeli.orders.tooltips.set(el.identify(),tip);},this);},processButtonListener:function(ev){this.showReturnItemConfirmationModal();ev.stop();return false;},quantitySelectorListener:function(ev){var el=ev.element();var item_id=this.getIdForSelected(el);if(item_id){if(el.selectedIndex>0){$('reasons_'+item_id+'_container').show();if(this.visibleReasonSelectorsPicked()){$$('.process_button_disabled').invoke('hide');$$('.process_button').invoke('show');}
else{$$('.process_button').invoke('hide');$$('.process_button_disabled').invoke('show');}}
else{$('reasons_'+item_id+'_container').hide();$$('.process_button').invoke('hide');$$('.process_button_disabled').invoke('show');}}},reasonSelectorListener:function(ev){var el=ev.element();var item_id=this.getIdForSelected(el);if(this.visibleReasonSelectorsPicked()){$$('.process_button_disabled').invoke('hide');$$('.process_button').invoke('show');}
else{$$('.process_button').invoke('hide');$$('.process_button_disabled').invoke('show');}},returnItemsButtonListener:function(ev){$('process_return_form').submit();},showReturnItemConfirmationModal:function(){var returnedItems=ideeli.orders.findReturnedItems();if(returnedItems.length>0){var id='',name='',returnItem='';$('return_items_list').update('');returnedItems.each(function(ri){id=ideeli.orders.getIdForSelected(ri);name=$('line_item_name_'+id).innerHTML;$('return_items_list').insert({'bottom':new Element('h3',{'style':'color:black;font-weight:bold;'}).update(''+ri.selectedIndex+' - '+name)});});ideeli.returnModal.open();}},visibleReasonSelectorsPicked:function(){var sel_els=$$('.quantity_selector').collect(function(el){return(el.selectedIndex>0)?el:null;}).compact();if(sel_els.length==0){return false;}
var els=$$('.reasons_selector_container').collect(function(el){return el.visible()?el:null;}).compact();if(els.length==0){return false;}
var return_els=els.collect(function(el){return(el.down('select').selectedIndex==0)?el:null;}).compact();return return_els.length==0;},initEditAddressPopups:function(){if(!ideeli.orders.tooltips){ideeli.orders.tooltips=$H();}
$$('.order_hint_billing_address_copy').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:false,showOn:'mousemove',hideOn:'mouseout',stem:'leftMiddle',className:'tooltip_unfixed_height',hook:{target:'rightMiddle',tip:'leftMiddle'},offset:{x:0,y:1},width:215,height:100,fixed:true});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.order_hint_shipping_address_copy').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:false,showOn:'mousemove',hideOn:'mouseout',stem:'leftMiddle',className:'tooltip_unfixed_height',hook:{target:'rightMiddle',tip:'leftMiddle'},offset:{x:0,y:1},width:215,height:100,fixed:true});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.order_hint_why_shipping_telephone').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:false,showOn:'mousemove',hideOn:'mouseout',stem:'topMiddle',className:'tooltip_unfixed_height',hook:{target:'bottomMiddle',tip:'topMiddle'},offset:{x:0,y:1},width:315,height:85,fixed:true});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.order_hint_cart_why').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:false,showOn:'mousemove',hideOn:'mouseout',stem:'topRight',className:'tooltip_tall',hook:{target:'bottomLeft',tip:'topRight'},offset:{x:0,y:1},width:315,height:120,fixed:true});ideeli.orders.tooltips.set(el.identify(),tip);});$$('.order_hint_cart_cvv').each(function(el){tip=new Tip($(el),$(el.readAttribute('data-content')).innerHTML,{closeButton:false,showOn:'mousemove',hideOn:'mouseout',stem:'rightMiddle',className:'tooltip_tall_cvv',hook:{target:'leftMiddle',tip:'rightMiddle'},offset:{x:0,y:1},width:315,height:250,fixed:true});ideeli.orders.tooltips.set(el.identify(),tip);});},copyAddress:function(from_to){var fields=['first_name','last_name','address1','address2','city','state','zip'],src='copy_billing_',dest='shipping_address_';if(from_to=='shipping_to_billing'){src='copy_shipping_';dest='stored_credit_card_billing_';}
else if(from_to=='shipping_to_billing_place_order'){src='shipping_address_';dest='order_billing_';}
fields.each(function(f){if($(src+f)&&$(dest+f)){if($(src+f).hasAttribute('data')){$(dest+f).setValue($(src+f).readAttribute('data'));}
else{$(dest+f).setValue($(src+f).getValue());}}});},initZipLimiter:function(){var valid_fields=['shipping_address_zip','stored_credit_card_billing_zip','order_billing_zip'];valid_fields.each(function(field){var el=$(field);if(el){validKeys=[8,9,35,36,37,38,39,40,45,46,47,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];numbers=[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];el.observe('keydown',this.limitChars.bindAsEventListener(this));el.observe('keydown',this.addDash.bindAsEventListener(this));el.observe('focus',this.emptyField.bindAsEventListener(this));}},this);},emptyField:function(ev){$('shipping_address_zip').value="";},limitChars:function(ev){var key=(document.all)?ev.keyCode:ev.which;if(validKeys.indexOf(key)<0||ev.altKey||ev.ctrlKey||ev.shiftKey){ev.stop();}},addDash:function(ev){var el=ev.element();var key=(document.all)?ev.keyCode:ev.which;if((el.getValue().length==5)&&(numbers.indexOf(key)>=0)){el.setValue(el.getValue()+'-');}}}}();if(typeof(ideeli.returnModal)=='undefined'){ideeli.returnModal=new Object();}
ideeli.returnModal=function(){var returnModal_link,returnModal_link_el,returnModal_submitting;return{attachCloseOnOverlayClick:function(){if(this.returnModal){$('control_overlay').observe('click',this.close.bind(this));}},attachHeader:function(){if(this.returnModal){this.headerElImg=new Element('img',{'id':'cart_modal_close_icon','src':'http://0.cdn.ideeli.net/images/cart/cart_modal_close_red.gif','style':'position:absolute;top:0;right:0;'}).observe('click',this.close.bind(this));this.headerElLink=new Element('a',{'href':'#','border':0,'title':'close','alt':'close'}).update(this.headerElImg).observe('click',this.close.bind(this));this.headerEl=new Element('div',{'id':'cart_modal_header','style':'height:17px;padding:0;margin:0;'}).update(this.headerElLink).observe('click',this.close.bind(this));var container=this.returnModal.getRemoteContentInsertionTarget();container.insert({'top':this.headerEl});}},returnModal:null,close:function(){if(this.returnModal){this.returnModal.close();}},destroy:function(){if(this.returnModal){this.returnModal.destroy();this.returnModal=null;}},detachCloseOnOverlayClick:function(){if(this.returnModal){$('control_overlay').stopObserving('click',this.close.bind(this));}},init:function(){if(!this.returnModal){this.returnModal=new Control.Modal($('return_modal'),{beforeClose:this.setUpReturnModalShowBleeds.bind(this),beforeOpen:this.setUpReturnModalHideBleeds.bind(this),className:'cart_modal_white',closeOnClick:'overlay',constrainToViewport:true,fade:false,onComplete:this.attachCloseOnOverlayClick.bind(this),overlayOpacity:0.5,parameters:{},width:425});this.attachHeader();this.returnModal.open();}
else{this.refresh();}
returnModal_submitting=false;},open:function(){if(!this.returnModal){this.init();}
else{this.returnModal.open();}},refresh:function(){if(!this.returnModal){returnModal.open();}
else{this.updateReturnedItemsList();}},setUpBeforeOpen:function(){this.updateReturnedItemsList();this.setUpReturnModalHideBleeds();},setUpReturnModalHideBleeds:function(){if(Prototype.Browser.IE){$$('select').invoke('hide');}},setUpReturnModalShowBleeds:function(){if(Prototype.Browser.IE){$$('select').invoke('show');}},submit:function(){if(!returnModal_submitting){$('process_return_form').submit();returnModal_submitting=true;}},updateReturnedItemsList:function(){}}}();if(typeof(ideeli)=='undefined'){ideeli=new Object();}
if(typeof(ideeli.fb)=='undefined'){ideeli.fb=new Object();}
ideeli.fb=function(){var is_initialized,facebook_authenticate_location,updated_user,connected,scope,scope_for_ticker,facebook_app_namespace;scope='email,publish_actions,offline_access';return{init:function(config){ideeli.fb.connected=false;ideeli.fb.is_initialized=false;facebook_authenticate_location=config.facebook_authenticate_location||this.warn("facebook_authenticate_location not set");ideeli.fb.facebook_app_namespace=config.facebook_app_namespace||this.warn("facebook_app_namespace not set");if(typeof(FB)!='undefined'){$$('.facebookloginbox').invoke('show');ideeli.fb.is_initialized=true;FB.getLoginStatus(ideeli.fb.handleSessionResponse);if(window.location.href.indexOf('#fbshare')>-1){new Ajax.Request('/events/'+window.latest_events[0].event_data.event_id+'/share_event_on_fb',{asynchronous:true,evalScripts:true,method:'get',onSuccess:function(transport){window.location.href='#';}});}
FB.Event.subscribe('auth.login',function(response){if(window.location.href.indexOf('/events')==-1){window.location=facebook_authenticate_location;}else{FB.getLoginStatus(ideeli.fb.handleSessionResponse);}});}else{setTimeout("ideeli.fb.init();",500);}},authenticate:function(returnToURL){if(typeof(FB)=='undefined'){setTimeout(ideeli.fb.authenticate.bind(ideeli.fb),500);return;}
if(ideeli.fb.connected&&ideeli.fb.callback){ideeli.fb.callback.call(ideeli.fb);return;}
FB.login(function(response){if(response.authResponse){if(!window.latest_events&&!window.coming_soon_data){window.location=facebook_authenticate_location+"?ac="+response.authResponse.accessToken;}
if(returnToURL!=undefined){window.location=facebook_authenticate_location+"?ac="+response.authResponse.accessToken+"&return_to="+returnToURL;}
if(ideeli.fb.callback){ideeli.fb.callback.call(ideeli.fb);}}else{}}.bind(ideeli.fb),{scope:scope});},authenticate_through_iframe:function(){if(typeof(FB)=='undefined'){setTimeout(ideeli.fb.authenticate_through_iframe.bind(ideeli.fb),500);return;}
if(ideeli.fb.connected&&ideeli.fb.callback){ideeli.fb.callback.call(ideeli.fb);return;}
FB.login(function(response){if(response.authResponse){window.top.location=facebook_authenticate_location+"?ac="+response.authResponse.accessToken;}else{}}.bind(ideeli.fb),{scope:scope});},updateUserProfile:function(){if(window.current_user&&ideeli.fb.is_initialized&&ideeli.fb.connected){$$('.facebook_hide_container').invoke('hide');$$('.facebook_connected_container').invoke('show');if(!ideeli.fb.updated_user){if($('fb_name')&&$('fb_profile_pic')){var fb_name=new Element('fb:name',{'uid':FB.getAuthResponse().userID,capitalize:'true',useyou:'false'});$('fb_name').appendChild(fb_name);var fb_profile_pic=new Element('fb:profile-pic',{'uid':FB.getAuthResponse().userID});$('fb_profile_pic').appendChild(fb_profile_pic);FB.XFBML.parse($('fb_name'));FB.XFBML.parse($('fb_profile_pic'));ideeli.fb.updated_user=true;}}}},handleSessionResponse:function(response){if(!response.authResponse){ideeli.fb.connected=false;return;}
ideeli.fb.connected=true;ideeli.fb.updateUserProfile();},ideeliLogout:function(){window.location='/logout?fblogout=1';},logout:function(){FB.logout(ideeli.fb.ideeliLogout);},warn:function(msg){},streamPublish:function(user_msg,short_msg,long_msg,img_url,invite_msg,invite_url,fn,show_caption){if((typeof(FB)!='undefined')&&ideeli.fb.is_initialized&&ideeli.fb.connected){if(invite_url.indexOf('mi=')!=-1){var wloc=window.location.href.split('#')[0];if(invite_url.split('?')[0]!=wloc){invite_url=wloc+'?'+invite_url.split('?')[1]}}
FB.ui({method:'stream.publish',message:user_msg,display:'dialog',attachment:{name:short_msg,caption:show_caption?short_msg:null,description:long_msg,href:invite_url,media:[{type:'image',src:img_url,href:invite_url}]},action_links:[{text:invite_msg,href:invite_url}],user_message_prompt:'Share on Facebook'},function(response){if(response&&response.post_id){}else{}});}
else{ideeli.fb.callback=ideeli.fb.streamPublish.bind(ideeli.fb,arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);if(!ideeli.fb.connected){fn.call(ideeli.fb);}}},trackEnterGiveaway:function(id,uid){var req=new Ajax.Request('/el/image/fb_enter_giveaway/'+id+'/spacer.gif',{parameters:{'user_id':uid},method:'GET'});},rsvp_attending:function(fb_event_id){if(ideeli.fb.is_initialized&&ideeli.fb.connected){FB.api('/'+fb_event_id+'/attending','post',function(response){if(!response||response.error){return false;}else{return true;}});}},rsvp_declined:function(fb_event_id){if(ideeli.fb.is_initialized&&ideeli.fb.connected){FB.api('/'+fb_event_id+'/declined','post',function(response){if(!response||response.error){return false;}else{return true;}});}},rsvp_status:function(event_id,fb_event_id){if(ideeli.fb.is_initialized&&ideeli.fb.connected){var query=FB.Data.query('select rsvp_status from event_member where uid={0} and eid={1}',FB.getAuthResponse().userID,fb_event_id);query.wait(function(response){if(response&&response[0]!=undefined&&response[0].rsvp_status=='attending'){new Ajax.Request('/shopping_events/fb_rsvp_status/',{method:'get',parameters:"id="+event_id+"&status=attending"});}else{new Ajax.Request('/shopping_events/fb_rsvp_status/',{method:'get',parameters:"id="+event_id+"&status=declined"});}});}},postShopTickForEvent:function(event_id,event_url,dont_retry){if(typeof(FB)=='undefined'){setTimeout(function(){ideeli.fb.postShopTickForEvent(event_id,event_url);},4000);return;}
if(!ideeli.fb.userFbTickEnabled()||!ideeli.fb.eventFbTickEnabled()){return;}
FB.api('/me/permissions',function(response){if(response.error==null){if(response.data[0].publish_actions==undefined){}else{if(!ideeli.fb.alreadyPostedShopTickForEvent(event_id)){var ticker_post_url='/me/'+ideeli.fb.facebook_app_namespace+':shop?event='+event_url;FB.api(ticker_post_url,'post',function(response){var fum_additional_info={'event_id':event_id,'hep_group_id':window.current_user.hep_group_id,'event_fb_tick_enabled':ideeli.fb.eventFbTickEnabled()};if(!response||response.error){var error_msg='';if(!response){error_msg='No response';}else{error_message=response.error;}
FUMAsync.errorHandler('fb_post_shop_tick_for_event',error_msg,fum_additional_info);}else{ideeli.fb.registerPostedShopTickForEvent(event_id,response.id);FUMAsync.successHandler('fb_post_shop_tick_for_event',fum_additional_info);}});}else{}}}else{if(dont_retry==undefined){setTimeout(function(){ideeli.fb.postShopTickForEvent(event_id,event_url,true);},4000);return;}}});},alreadyPostedShopTickForEvent:function(event_id){if(amplify.store('shop_tick_'+event_id)){return true;}else{return false;}},registerPostedShopTickForEvent:function(event_id,tick_id){amplify.store('shop_tick_'+event_id,tick_id,(1000*60*60*24));},eventFbTickEnabled:function(){if(window.EVENT_FB_TICK_ENABLED){return true;}else{return false;}},userFbTickEnabled:function(){return(window.current_user&&window.current_user.allow_fb_ticker==1);}};}();if(typeof(ideeli)=='undefined'){ideeli={};}
if(typeof(ideeli.prefetcher)=='undefined'){ideeli.prefetcher={};}
ideeli.prefetcher=function(){return{init:function(){if(!parseInt(Cookie.get('pf'))==1){var img=new Image();$$('.prefetcher_url').each(function(el){img=new Image();img.src=el.getValue();});Cookie.set('pf',1);}}}}();if(typeof(ideeli)=='undefined'){var ideeli={};}
ideeli.PromotionEngine=function(){return{init:function(){enabled=Cookie.get('promotion_engine');if(enabled==null){this.enabled=true;}else{enabled=enabled.evalJSON();this.enabled=enabled;}
this.bindProcessPromotionResponse=this.processPromotionResponse.bindAsEventListener(this);var triggers={'pe_fire_join_trigger':'add_to_segment','pe_fire_redirect_trigger':'add_to_segment_redirect','pe_logged_in_trigger':'logged_in','pe_fire_site_arrival_trigger':'site_arrival'};var customPetFired=false;$H(triggers).each(function(trigger){var exist=Cookie.get(trigger.key);if(exist&&!customPetFired){customPetFired=ideeli.PromotionEngine.fire(trigger.value,trigger.value);}
Cookie.erase(trigger.key);});},fire:function(section,action,options){if(this.enabled&&ideeli.PromotionEngine.petEnabled(section)){new Ajax.Request('/p',{parameters:{'pet':section,'user_action':action,'options':Object.toJSON(options)},onSuccess:this.bindProcessPromotionResponse});return true;}else{return false;}},petEnabled:function(code){var pets=Cookie.get('pe_triggers');if(pets!=null){pets=pets.evalJSON();for(var name in pets){if(name==code){return pets[name];}}}
return true;},processPromotionResponse:function(data){var outcomesData=data.responseJSON;if(outcomesData.enabled===false){this.disable();}else{this.handlersCol.handleData(outcomesData);}},replaceInviteFriendImage:function(){if(window.SHIPPING_PROMO_ENABLED===true){ideeli.labs.getVariant('shipping_tiers',function(variant){try{if(variant==='control'){if(jQuery('.tell_a_friend_unit').length>0){jQuery('.tell_a_friend_unit').show();}}
else{var shippingPromoSrc=null;if(variant==='flat595'){shippingPromoSrc=window.SHIPPING_PROMO_595_SRC_URL;}
else if(variant==='ideeli30'){shippingPromoSrc=window.SHIPPING_PROMO_30DAYS_SRC_URL;}
else if(variant==='tiered'){shippingPromoSrc=window.SHIPPING_PROMO_TIERED_SRC_URL;}
if(shippingPromoSrc!=null){if(jQuery('.tell_a_friend_unit').length==0){jQuery('#editorial_units').after(new Element('div',{'class':'tell_a_friend_unit'}));}
else{jQuery('.tell_a_friend_unit').empty();}
jQuery('.tell_a_friend_unit').append(new Element('img',{'src':shippingPromoSrc}));jQuery('.tell_a_friend_unit').show();}}}
catch(e){}});}
else{if(jQuery('.tell_a_friend_unit').length>0){jQuery('.tell_a_friend_unit').show();}}},disable:function(){this.handlersCol.disableAll();this.enabled=false;Cookie.set('promotion_engine','false',1/24);},handlersCol:{handlers:[],handleData:function(outcomesData){this.handlers.each(function(handler){if(outcomesData[handler.type]){handler.handleOutcome(outcomesData[handler.type]);}else{handler.disable();}});},disableAll:function(){this.handlers.each(function(outcomeHandler){outcomeHandler.disable();});}},HandlerBase:Class.create({initialize:function(){this.message=null;this.renderWaiter=null;this.integrityChecker=null;ideeli.PromotionEngine.handlersCol.handlers.push(this)},bindIntegrityChecker:function(){this.unbindIntegrityChecker();this.integrityChecker={onComplete:this.renderMessage.bind(this)};Ajax.Responders.register(this.integrityChecker);},unbindIntegrityChecker:function(){if(this.integrityChecker){Ajax.Responders.unregister(this.integrityChecker);this.integrityChecker=null;}},bindWaiter:function(){this.unbindWaiter();this.renderWaiter=new PeriodicalExecuter(this.checkRender.bind(this),0.1);},unbindWaiter:function(){if(this.renderWaiter){this.renderWaiter.stop();this.renderWaiter=null;}},checkRender:function(){if(this.renderMessage()){this.unbindWaiter();this.bindIntegrityChecker();}},showElement:function(el){if(el){el.invoke('show');}},hideElement:function(el){if(el){el.invoke('hide');}},unbind:function(){this.unbindIntegrityChecker();this.unbindWaiter();},handleOutcome:function(message){this.unbind();this.message=message;this.bindWaiter();},disable:function(){this.unbind();this.message=null;this.renderMessage();},refreshCart:function(){var total=$('total');var failureHandeler=function(){};var updateUrl='/cart_items/refresh';if(total&&total.visible()){var loaderImg=new Element('img',{'id':'pe_reload','src':'http://0.cdn.ideeli.net/images/frontend/loading.gif','style':'display:none;'});if(ideeli.cart.isCartOpen()){ideeli.cart.detachHeaderListeners();failureHandeler=ideeli.cart.attachHeaderListeners;}else if(ideeli.checkout.hints){ideeli.checkout.hideSubmitButtons();failureHandeler=ideeli.checkout.showSubmitButtons;updateUrl=updateUrl+'?from_check_out=true';}
total.hide();total.insert({after:loaderImg});loaderImg.show();new Ajax.Request(updateUrl,{onFailure:function(){$('total').show();loaderImg.hide();failureHandeler();}});}}})}}();ideeli.PromotionEngine.CartShippingFeeHandlerBase=Class.create(ideeli.PromotionEngine.HandlerBase,{renderMessage:function(){if(this.is_forced_free_shipping()){return false;}
var el=$('shipping_fee_row');if(el){if(this.message){$('shipping_fee_label').update(this.message.label);var amount_el=$('shipping');if(!amount_el){var amount_el=$('shipping_fee');}
amount_el.update(this.displayableFee());this.refreshCart();}
return true;}else{return false;}},displayableFee:function(){return this.message.amount;},checkRender:function(){if(this.renderMessage()){this.unbindWaiter();this.unbindIntegrityChecker();}},is_forced_free_shipping:function(){return!!$('ads_shipping_fee');}});ideeli.PromotionEngine.shopCartPromoUnitHandler=new(Class.create(ideeli.PromotionEngine.HandlerBase,{type:"PPromotionalUnitOutcome",renderMessage:function(){var img1=$('promotional_unit_image');var img2=$('promotional_unit_image_with_url');var url=$('promotional_unit_image_url');if(img1&&img2&&url){if(this.message&&!this.message.image_url.blank()){shownImageAttributes={height:null,width:null,src:this.message.image_url};if(this.message.target_url){Element.writeAttribute(url,'href',this.message.target_url).show();if(this.message.open_in_new_window)
Element.writeAttribute(url,'target','_blank');else
Element.writeAttribute(url,'target','');Element.writeAttribute(img2,shownImageAttributes).show();Element.writeAttribute(img1,'src','').hide();}
else{url.hide();Element.writeAttribute(img1,shownImageAttributes).show();}}else{Element.writeAttribute(img1,'src','http://0.cdn.ideeli.net/images/spacer.gif').hide();Element.writeAttribute(img2,'src','http://0.cdn.ideeli.net/images/spacer.gif').hide();}
return true;}else{return false;}}}));ideeli.PromotionEngine.shopCartMsgTopHandler=new(Class.create(ideeli.PromotionEngine.HandlerBase,{type:"PMessageOutcome",renderMessage:function(){var el=$('promotion_engine_message');if(el){if(this.message){if(el.update(this.message).show().empty()){el.hide();}
this.hideElement($$('div.all_day_shipping_note'));this.hideElement($$('div.all_day_shipping_note_check_out'));this.hideElement($('blank_stub'));}else{el.update('').hide();this.showElement($$('div.all_day_shipping_note'));this.showElement($$('div.all_day_shipping_note_check_out'));this.showElement($('blank_stub'));}
return true;}else{return false;}}}));ideeli.PromotionEngine.shopCartSplashModalHandler=new(Class.create(ideeli.PromotionEngine.HandlerBase,{type:"PSplashModalOutcome",renderMessage:function(){try{if(this.message){this.splash_modal=new ideeli.SplashModal(this.message);this.splash_modal.splashModalOpen();}else{if(this.splash_modal){this.splash_modal.splashModalClose();}}
return true;}
catch(e){}},checkRender:function(){if(this.renderMessage()){this.unbindWaiter();}}}));ideeli.PromotionEngine.loginFBTickerModalHandler=new(Class.create(ideeli.PromotionEngine.HandlerBase,{type:"PFbTickerModalOutcome",renderMessage:function(){try{if(this.message){Control.Window.windows.invoke('close');ideeli.fb_ticker_modal.fbTickerModalOpen();}else{if(ideeli.fb_ticker_modal){ideeli.fb_ticker_modal.fbTickerModalClose();}}
return true;}
catch(e){}},checkRender:function(){if(this.renderMessage()){this.unbindWaiter();}}}));ideeli.PromotionEngine.shopCartPomHandler=new(Class.create(ideeli.PromotionEngine.HandlerBase,{type:"PPomOutcome",renderMessage:function(){var el=$('promo_discount_row');if(el){if(this.message){if(this.message.redeem){el.hide();}
if(this.message.label){el.show();$('promo_discount_label').update(this.message.label);$('promo_discount_amount').update(this.message.amount);}
this.refreshCart();}
return true;}else{return false;}},checkRender:function(){if(this.renderMessage()){this.unbindWaiter();this.unbindIntegrityChecker();}}}));ideeli.PromotionEngine.shopCartFreeShippingFeeHandler=new(Class.create(ideeli.PromotionEngine.CartShippingFeeHandlerBase,{type:"PFreeShippingFeeOutcome",displayableFee:function(){return'<span class="free_shipping">Free</span>';}}));ideeli.PromotionEngine.shopCartShippingFeeHandler=new(Class.create(ideeli.PromotionEngine.CartShippingFeeHandlerBase,{type:"PShippingFeeOutcome"}));ideeli.PromotionEngine.shopCartMsgTopHandler=new(Class.create(ideeli.PromotionEngine.HandlerBase,{type:"POfferPromotionalUnitOutcome",renderMessage:function(){var el=$('promo_container');if(el){if(this.message.message){el.update('<span class="promo_container_text">'+this.message.message+'</span>');}else if(this.message.image_url){var content='<img src="'+this.message.image_url+'" alt="" />';if(this.message.target_url){content='<a target="_blank" href="'+this.message.target_url+'">'+content+'</a>';}
el.update(content);}else{el.update('');}
return true;}else{return false;}}}));if(typeof(ideeli)==='undefined'){ideeli={};}
var splashModalCounter=1;ideeli.SplashModal=Class.create({initialize:function(options){this.options=options;this.my_modal='';this.modal_added=false;this.splashModalId='splash_modal_'+splashModalCounter;this.splashModalAnchorId='splash_modal_close_'+splashModalCounter;this.addSplashModal();splashModalCounter++;},addSplashModal:function(){if($(this.splashModalId)!=null){return true;}
var splash_modal=document.createElement('div');splash_modal.setAttribute('id',this.splashModalId);splash_modal.setAttribute('style',"display:none;position:absolute;");if(this.options.click_url==undefined||this.options.click_url.blank())
{var image=document.createElement('img');image.setAttribute('src',this.options.image_url);if(this.options.close_on_click==1){image.observe('click',this.closeOnClick.bind(this));}
splash_modal.appendChild(image);}
else
{var image_anchor=document.createElement('a');image_anchor.setAttribute('href',this.options.click_url);if(this.options.target==undefined||this.options.target=="blank"||this.options.target=="_blank")
{image_anchor.setAttribute('target',"_blank");}
var image=document.createElement('img');image.setAttribute('src',this.options.image_url);image.setAttribute('width',this.options.width);image.setAttribute('height',this.options.height);image_anchor.appendChild(image);splash_modal.appendChild(image_anchor);}
if(this.options.close_link==undefined||this.options.close_link==true)
{close_anchor=document.createElement('a');close_anchor.setAttribute('id',this.splashModalAnchorId)
close_anchor.observe('click',this.closeOnClick.bind(this));text=document.createElement('textNode');close_anchor.appendChild(text);splash_modal.appendChild(close_anchor);}
this.modal_added=true;document.getElementsByTagName('body')[0].appendChild(splash_modal);},splashModalOpen:function(){if(this.modal_added){this.my_modal=new Control.Modal($(this.splashModalId),{className:'modal',closeOnClick:'overlay',constrainToViewport:true,isOpen:false,overlayOpacity:0.5,width:parseInt(this.options.width),height:parseInt(this.options.height),afterClose:this.removeAfterClose.bind(this)});this.storeModalOpen();this.my_modal.open();};},storeModalOpen:function(){if(typeof(this.options.announcement_id)!=="undefined"){if(this.options.interval>0){Cookie.set("announcement_"+this.options.announcement_id,1,this.options.interval);}else{var cookieVal="announcement_"+this.options.announcement_id+"=1; path=/;"
document.cookie=cookieVal;}}},canOpen:function(){if(window.location.href.toString().match(/open_cart=1/)||(ideeli.redeem_gift_cards!=null&&ideeli.redeem_gift_cards.modal!=null)){return false;}
if(typeof(this.options.announcement_id)!=="undefined"){return!Cookie.exists("announcement_"+this.options.announcement_id);}else{return true;}},splashModalClose:function(){this.my_modal.close();},closeOnClick:function(click){this.splashModalClose();},removeAfterClose:function(close){$(this.splashModalId).remove();}});if(typeof(ideeli)=='undefined'){ideeli=new Object();}
if(typeof(ideeli.fb_ticker_modal)=='undefined'){ideeli.fb_ticker_modal=new Object();}
ideeli.fb_ticker_modal=function(){return{fbTickerModalOpen:function(){ideeli.fb_ticker_modal.new_modal=new Control.Modal($('fb_ticker_modal_div'),{className:'fb_ticker_modal_div',closeOnClick:'overlay',constrainToViewport:true,fade:false,offset:{x:0,y:2},overlayOpacity:0.5,parameters:{},width:852,height:601,afterOpen:function(){jQuery('#fb_ticker_modal_div').find("#great_love_this_action").add('a#close').one('click',function(){ideeli.fb_ticker_modal.fbTickerModalClose();});}});ideeli.fb_ticker_modal.new_modal.open();},fbTickerModalClose:function(){ideeli.fb_ticker_modal.new_modal.close();}}}();if(typeof(ideeli)=='undefined'){ideeli={};}
if(typeof(ideeli.redeem_gift_cards)=='undefined'){ideeli.redeem_gift_cards={};}
ideeli.redeem_gift_cards=function(){return{init:function(){this.urlParams={};this.getUrlParams();if(this.getUrlParam('step')&&(this.getUrlParam('gcc')||(this.getUrlParam('step')=='logged_out_confirm_password'))){this.gotoStep(this.getUrlParam('step'));}},activate:function(){if(this.getUrlParam('step')=='redeem'&&this.getUrlParam('gcc')&&this.getUrlParam('gcc').length>0){window.location.href='/activate_gift_cards/'+this.getUrlParam('gcc');}},attachCloseOnOverlayClick:function(){if(this.model){$('control_overlay').observe('click',this.close.bind(this));}},beforeOpen:function(){setTimeout(this.updateModalContent.bind(this),100);},close:function(){if(this.modal){this.modal.close();}
if((this.getUrlParam('step')=='logged_out_confirm_password')&&$('login_field')){$('login_field').focus();}},getUrlParams:function(){var hashes=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');hashes.each(function(hash){this.urlParams[hash.split('=')[0]]=hash.split('=')[1];},this);return this.urlParams;},getUrlParam:function(name){return this.urlParams[name];},gotoStep:function(step){switch(step){case'activated':this.showModalActivated();return true;case'already_activated':this.showModalAlreadyActivated();return true;case'logged_out':this.showModalLoggedOut();return true;case'register_and_redeem':this.showModalRegisterAndRedeem();return true;case'register_already_redeemed':this.showModalRegisterAlreadyRedeemed();return true;case'redeem':this.showModalRedeem();return true;case'user_already_activated':this.showModalUserAlreadyActivated();return true;case'logged_out_confirm_password':this.showModalLoggedOutConfirmPassword();return true;}
return false;},open:function(){if(this.modal){this.modal.open();}},passwordFocus:function(){if($('password')){Form.Element.focus('password');}},redeemLogoutClickedFromRegister:function(){window.location.href="/logout?yes=1&autologout=1&gcc="+this.getUrlParam('gcc');},redeemLogoutClicked:function(){window.location.href="/logout?yes=1&autologout=1&gcc="+this.getUrlParam('gcc')+"&old_login="+window.current_user.login;},showModal:function(el,width){this.modal=new Control.Modal(el,{beforeClose:Prototype.K,beforeOpen:this.beforeOpen.bind(this),afterOpen:Prototype.K,afterClose:Prototype.K,className:'cart_gift_card_modal_frame',closeOnClick:'overlay',constrainToViewport:true,fade:false,offsetTop:0,onComplete:this.attachCloseOnOverlayClick.bind(this),overlayOpacity:0.5,parameters:{},position:[parseInt((document.viewport.getWidth()-width)/2),135],width:width});el.hide().remove();$$('body')[0].insert({'top':el});el.setStyle({'z-index':'17201'}).show();this.boundClose=this.close.bind(this);this.boundOpen=this.open.bind(this);this.modal.open();},showModalActivated:function(){var el=$('activated_gift_card');this.showModal(el,596);},showModalAlreadyActivated:function(){var el=$('already_activated_gift_card');this.showModal(el,596);},showModalUserAlreadyActivated:function(){var el=$('user_already_activated_gift_card');this.showModal(el,596);},showModalLoggedOut:function(){if(this.getUrlParam('old_login')){var el=$('logged_out_gift_card');this.showModal(el,666);}},showModalLoggedOutConfirmPassword:function(){if(this.getUrlParam('old_login')){if($('login_field')){$('login_field').setValue('').focus();}
var el=$('logged_out_confirm_password');this.showModal(el,666);}},showModalRedeem:function(){var el=$('redeem_gift_card');ideeli.redeem_gift_cards.updateContainerImage('#redeem_gift_card_image img');this.showModal(el,740);},showModalRegisterAndRedeem:function(){var el=$('register_member_gift_card');ideeli.redeem_gift_cards.updateContainerImage('#register_member_gift_card div.register_member_gift_card_left_col img');this.showModal(el,740);},showModalRegisterAlreadyRedeemed:function(){var el=$('register_already_redeemed_gift_card');this.showModal(el,596);},updateContainerImage:function(el){el=jQuery(el);if(el.attr('src')&&el.attr('data-src')&&el.attr('src').match('spacer.gif')){var new_src=el.attr('src').replace('spacer.gif',el.attr('data-src'));el.attr('src',new_src);}},updateModalContent:function(){if($$('.redeem_gift_card_logged_in_as').any()&&window.current_user&&window.current_user.login){$$('.redeem_gift_card_logged_in_as').invoke('update',window.current_user.login);}
if($('redeem_gift_card_polite_name')&&window.current_user&&window.current_user.polite_name){$('redeem_gift_card_polite_name').update(window.current_user.polite_name.toString().capitalize()+',');}
if($$('.redeem_gift_card_amount').any()&&this.getUrlParam('v')){$$('.redeem_gift_card_amount').invoke('update','$'+parseInt(this.getUrlParam('v')).toString());}
if($('redeem_to_name')&&this.getUrlParam('to_name')){$('redeem_to_name').update(decodeURIComponent(this.getUrlParam('to_name').gsub(/\+/,' ')));}
if($$('.redeem_old_login_name').any()&&this.getUrlParam('old_login')){$$('.redeem_old_login_name').each(function(el){el.update(decodeURIComponent(this.getUrlParam('old_login').gsub(/\+/,' ')));},this);}
ideeli.masthead.resetUserData();}}}();if(typeof(ideeli)=='undefined'){ideeli={};}
if(typeof(ideeli.errors)=='undefined'){ideeli.errors={};}
ideeli.errors=function(){return{cleanupAndShow:function(){$$('.generic_errors_field').each(function(el){el.removeClassName('generic_errors_field');});if($('reauth_errors_container')){$('reauth_errors_container').show();}},focusField:function(error_field){if(error_field&&$(error_field)){$(error_field).focus();}},highlightErrorFields:function(error_fields){if(error_fields&&error_fields.each){error_fields.each(ideeli.errors.highlightError,ideeli.errors);}},highlightError:function(field_id){if($(field_id)){$(field_id).addClassName('generic_errors_field');}},restore:function(){ideeli.errors.cleanupAndShow();$('reauth_errors_container').hide();},unhighlightErrorFields:function(error_fields){if(error_fields&&error_fields.each){error_fields.each(ideeli.errors.unhighlightError,ideeli.errors);}},unhighlightError:function(field_id){if($(field_id)){$(field_id).removeClassName('generic_errors_field');}}}}();if(typeof(window.DELAYED_MODALS)=='undefined'){window.DELAYED_MODALS={};}
if(typeof(ideeli)=='undefined'){ideeli={};}
if(typeof(ideeli.delayed_modal)=='undefined'){ideeli.delayed_modal={};}
ideeli.delayed_modal=function(){var TIMEOUT=5000,timers={};return{log:function(){if(window.location.href.match(/logger=1/)&&console&&console.log){console.log(arguments);}},cancelShow:function(modal_selector){try{clearTimeout(timers[modal_selector]);ideeli.delayed_modal.log("cleared timeout for timers[modal_selector] for %o in obj",modal_selector,window.DELAYED_MODALS);}
catch(e){ideeli.delayed_modal.log("did not find timers[modal_selector] for %o in obj",modal_selector,window.DELAYED_MODALS);}},delayedShow:function(modal_selector){try{if(window.DELAYED_MODALS[modal_selector]){ideeli.delayed_modal.log("found DELAYED_MODALS[modal_selector] for %o in obj: %o",modal_selector,window.DELAYED_MODALS);timers[modal_selector]=setTimeout(ideeli.delayed_modal.show.bind(ideeli.delayedShow,modal_selector),TIMEOUT);}
else{ideeli.delayed_modal.log("did not find DELAYED_MODALS[modal_selector] for %o in obj",modal_selector,window.DELAYED_MODALS);ideeli.delayed_modal.show(modal_selector);}}
catch(e){ideeli.delayed_modal.log("caught exception when firing delayedShow for: %o",modal_selector);ideeli.delayed_modal.show(modal_selector);}},show:function(modal_selector){ideeli.delayed_modal.log("showing modal: %o",modal_selector);if($$(modal_selector).any()){ideeli.delayed_modal.log("found modal, actually showing modal: %o",$$(modal_selector));$$(modal_selector).invoke('show');}}}}();if(typeof(ideeli)=='undefined'){var ideeli={};}
if(typeof(ideeli.latest_events_cache)=='undefined'){ideeli.latest_events_cache=function(){return{cached_positions:null,cached_events_data:null,cached_has_coming_soon_giveaways:{},cached_starting_soon:{},cached_started_today:{},cached_dom_elements:{},cached_additional_second_row_time:null,purge_cache_data:function(){ideeli.latest_events_cache.cached_has_coming_soon_giveaways={};ideeli.latest_events_cache.cached_starting_soon={};ideeli.latest_events_cache.cached_started_today={};},positions:function(){if(!ideeli.latest_events_cache.cached_positions){ideeli.latest_events_cache.cached_positions=amplify.store('latest_positions_flat');}
return ideeli.latest_events_cache.cached_positions;},events_data:function(){if(!ideeli.latest_events_cache.cached_events_data){ideeli.latest_events_cache.cached_events_data=amplify.store('latest_events_data');}
return ideeli.latest_events_cache.cached_events_data;},dom_element:function(selector_string){if(!ideeli.latest_events_cache.cached_dom_elements[selector_string]){ideeli.latest_events_cache.cached_dom_elements[selector_string]=jQuery(selector_string);}
return ideeli.latest_events_cache.cached_dom_elements[selector_string];}};}();}
if(typeof(ideeli.latest_events)=='undefined'){ideeli.latest_events=function(){var DAILY_EXPIRATION_MS=86400000,refetchTimeout=0,HOURLY_EXPIRATION_MS=(1000*60*60);Date.prototype.dayDiff=function(d2){var d=Math.abs(this-d2);var a=Math.floor(d/DAILY_EXPIRATION_MS);if(a>0){return a;}
else{if(d2.getDate()!=this.getDate()){return 1;}
else{return a;}}};return{reloading:false,killCount:0,retryUserCount:0,fourHourReloadCountdownId:0,initialNumberOfEventsToLoad:9,fingerprintChanged:function(){if((typeof(amplify.store("fingerprint"))==='undefined')||(amplify.store("fingerprint")!==window.FINGERPRINT)){try{amplify.store("fingerprint",window.FINGERPRINT);}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store("fingerprint",window.FINGERPRINT);}catch(e){FUMLSE.errorHandler(e,'fingerprint',window.FINGERPRINT.length,'ideeli.latest_events.fingerprintChanged','hep_channels_and_homepage.js');throw(e);}}
return true;}else{return false;}},refetchData:function(switchover,now){now=parseInt(now,10);switchover=parseInt((new Date(switchover).getTime()),10);var refetch_ms=(switchover-now+Math.floor(Math.random()*11))*1000;if(ideeli.latest_events.refetchTimeout){clearTimeout(ideeli.latest_events.refetchTimeout);}
if(switchover>now){var four_hours_in_ms=1000*60*60*4;var two_minutes_in_ms=1000*60*2;if(refetch_ms>four_hours_in_ms){refetch_ms=four_hours_in_ms;}
else if(refetch_ms<two_minutes_in_ms){refetch_ms=two_minutes_in_ms;}
ideeli.latest_events.refetchTimeout=setTimeout(window.refreshAfterCountdown,refetch_ms);}},secondRowMemberAdditionalTime:function(){if(!ideeli.latest_events_cache.cached_additional_second_row_time){ideeli.latest_events_cache.cached_additional_second_row_time=0;if(window.current_user&&window.current_user.is_premium_member.blank()){ideeli.latest_events_cache.cached_additional_second_row_time+=(60*60);}}
return ideeli.latest_events_cache.cached_additional_second_row_time;},hasComingSoonGiveaways:function(channel){if(!ideeli.latest_events_cache.cached_has_coming_soon_giveaways[channel]){var events_for_channel=ideeli.latest_events.eventsForChannel(channel);ideeli.latest_events_cache.cached_has_coming_soon_giveaways[channel]=ideeli.latest_events.ideeliLatestEvents.models.select(function(m){return(events_for_channel.include(m.attributes.id)&&(m.attributes.g===true)&&((m.attributes.s+window.LEAD_IN_PERIOD+ideeli.latest_events.secondRowMemberAdditionalTime())>ideeli_utils.now()));});}
return ideeli.latest_events_cache.cached_has_coming_soon_giveaways[channel];},startingSoon:function(channel){if(!ideeli.latest_events_cache.cached_starting_soon[channel]){var events_for_channel=ideeli.latest_events.eventsForChannel(channel);ideeli.latest_events_cache.cached_starting_soon[channel]=ideeli.latest_events.ideeliLatestEvents.models.select(function(m){return(events_for_channel.include(m.attributes.id)&&((m.attributes.s+window.LEAD_IN_PERIOD+ideeli.latest_events.secondRowMemberAdditionalTime())>ideeli_utils.now()));});}
return ideeli.latest_events_cache.cached_starting_soon[channel];},startedToday:function(channel){if(!ideeli.latest_events_cache.cached_started_today[channel]){var now=ideeli_utils.timestampToDate(ideeli_utils.now());var events_for_channel=ideeli.latest_events.eventsForChannel(channel);ideeli.latest_events_cache.cached_started_today[channel]=ideeli.latest_events.ideeliLatestEvents.models.select(function(m){var event_start=ideeli_utils.timestampToDate(m.attributes.s+window.LEAD_IN_PERIOD+ideeli.latest_events.secondRowMemberAdditionalTime());return(events_for_channel.include(m.attributes.id)&&(event_start.dayDiff(now)===0)&&event_start<now);});}
return ideeli.latest_events_cache.cached_started_today[channel];},eventsForChannel:function(channel){return ideeli.latest_events_cache.positions()[channel];},mostRecentStartTime:function(channel){var recent_start_times=ideeli.latest_events.startingSoon(channel).collect(function(e){return(e.attributes.s);});return(recent_start_times.min()+window.LEAD_IN_PERIOD+ideeli.latest_events.secondRowMemberAdditionalTime());},displayStartsSoon:function(collection){jQuery.each(collection,function(i,obj){jQuery('#event_'+obj.attributes.id+' .starts_soon').show();jQuery('#event_'+obj.attributes.id+' .ends_in').hide();jQuery('#event_'+obj.attributes.id+' .starts_in').hide();});},displayLatestSalesHeader:function(){jQuery("#on_sale_header").addClass("sprite-3_new_today_top_bar");jQuery("#on_sale_header").removeClass("sprite-3_header_bar_2");jQuery('#on_sale_header_new_today').removeClass("sprite-3_new_today_title");jQuery('#on_sale_header_new_today').addClass("sprite-3_title_latest_sales");},displayNewTodayAndMoreSaleStartingIn:function(){jQuery("#on_sale_header").removeClass("sprite-3_new_today_top_bar");jQuery("#on_sale_header").addClass("sprite-3_header_bar_2");jQuery("h1#on_sale_header div").hide();jQuery('#new_today_more_sales_starting_in_title').show();},displayNewSaleStartingIn:function(){jQuery("#on_sale_header").addClass("sprite-3_new_today_top_bar");jQuery("#on_sale_header").removeClass("sprite-3_header_bar_2");jQuery("h1#on_sale_header div").hide();jQuery('#on_sale_header_start_in').show();},displayNewTodayAndGiveawayStartingIn:function(){jQuery("#on_sale_header").removeClass("sprite-3_new_today_top_bar");jQuery("#on_sale_header").addClass("sprite-3_header_bar_2");jQuery("h1#on_sale_header div").hide();jQuery('#on_sale_header_new_today_giveaway_starts_in').show();},defModels:function(){this.LatestEventModel=Backbone.Model.extend({initialize:function(){},defaults:{'k':null,'pos':0,'b':null,'t':null,'u':null,'e':null,'s':null,'c':null,'lp_url':null,'d':null,'w':false,'m':false,'l':null,'g':false}});},defCollections:function(){this.LatestEventsCollection=Backbone.Collection.extend({model:this.LatestEventModel,initialize:function(){}});},latestView:function(){this.latestEventUnit=Backbone.View.extend({tagName:"div",className:"event_unit",initialize:function(){_.bindAll(this,"render");},render:function(w,h,pos){if(this.model){var lp_img=LPimage.initialize(this.model.get('u'),w,h);var size=w;this.model.set({'lp_url':lp_img.toURL(),'size':w,'pos':pos,'ending_soon':parseInt(w,10)===230});jQuery(this.el).html(_.template('<a href="/events/<%= id %>/latest_view" onclick="ideeli.latest_events.logEventClicked(<%= id %>, <%= pos %>, <%= ending_soon %>); return true;"><img id="latest_event_<%= id %>" class="event_image event_image_<%= size %>" data-ending-soon="<%= ending_soon ? 1 : 0 %>" src="<%= (size == "505") ? "http://0.cdn.ideeli.net/images/spinner_505x505.gif" : "http://0.cdn.ideeli.net/images/spinner_240x240.gif" %>" data-src="<%= lp_url %>" width="<%= size %>" height="<%= size %>" border="0"/><div><span class="event_grid_cta" id="event_<%= id %>"><b><%= b %></b> <span class="title"><%= t %></span><br /><span class="starts_soon">Starts Soon</span><span class="ends_in">ENDS IN: <span class="ending_soon_timer"><%= e %></span></span><span class="starts_in">STARTS IN: <span class="starting_in_timer"><%= s %></span></span></span></div></a>',this.model.toJSON()));return this;}}});},channelPlaceholderView:function(){this.channelPlaceholderUnit=Backbone.View.extend({tagName:"div",className:"event_unit",initialize:function(){_.bindAll(this,"render");},render:function(w,h,pos){if(this.model){var lp_img=LPimage.initialize(this.model.get('u'),w,h);var size=w;this.model.set({'lp_url':lp_img.toURL(),'size':w,'pos':pos,'ending_soon':parseInt(w,10)===230});var ad_click;var w_target;if(this.model.get('l')===1){ad_click="";this.model.set({'ad_click':ad_click});w_target=this.model.get('w')?"_blank":"";this.model.set({'w_target':w_target});}else{var ch=this.model.get('d').toLowerCase().replace('#','');ad_click='ideeli.channels.select_channel(\''+ch+'\');ideeli.latest_events.visitLatest(\''+ch+'\');';this.model.set({'ad_click':ad_click});w_target=null;this.model.set({'w_target':w_target});if(ch.charAt(0)!=='#'){this.model.set({'d':'#'+ch});}}
jQuery(this.el).html(_.template('<a href="<%= d %>" class="channel_placeholder_link" target="<%= w_target %>" onclick="ideeli.latest_events.logEventClicked(<%= id %>, <%= pos %>, <%= ending_soon %>);<%= ad_click %>"><img id="channel_placeholder_<%= id %>" class="channel_placeholder_image placeholder_image_<%= size %>" src="<%= lp_url %>" width="<%= size %>" height="<%= size %>" border="0"/></a>',this.model.toJSON()));return this;}}});},channelsView:function(){this.channelItemView=Backbone.View.extend({tagName:"li",initialize:function(){_.bindAll(this,"render");},render:function(channel_val){if(this.model){if(_.isUndefined(this.model.attributes.channel_val)){this.model.set({'channel_val':channel_val});}
jQuery(this.el).html(_.template('<a onclick="ideeli.latest_events.update_channel_cookie(\'<%= channel_val %>\');" class="channel_item_<%= id %> <%= channel_val %>" href="/events/<%= id %>/latest_view"><%= b %> <span><%= t %></span></a>',this.model.toJSON()));return this;}}});},startTimers:function(startTimestamp,endTimestamp,countContainer){setTimeout(ideeli.latest_events.startTimersWithoutSetTimeout.bind(ideeli.latest_events,startTimestamp,endTimestamp,countContainer),10);},startTimersWithoutSetTimeout:function(startTimestamp,endTimestamp,countContainer){seconds=endTimestamp-startTimestamp;if(seconds<64800){countContainer.countdown({until:"+"+seconds,format:'HMS',compact:true,onExpiry:window.refreshAfterCountdown});}
else{if(seconds>=64800&&seconds<86400){seconds+=86400;}
countContainer.countdown({until:"+"+seconds,format:'D',compact:false,onExpiry:window.refreshAfterCountdown});}},highlightActiveTab:function(channel){jQuery('ul#es_tabs li a').each(function(){if(this.href.match('tab_'+channel)){jQuery(this).parent().addClass('active');}else{jQuery(this).parent().removeClass('active');}});},clearEndingSoonCarouselAndPaginationContainers:function(channel){jQuery('#carousel_pagination').html('');jQuery('#horizontal_carousel').html('');jQuery('#carousel_button_next').unbind("click");jQuery('#carousel_button_prev').unbind("click");jQuery('#horizontal_carousel').append('<div class="container" id="horizontal_carousel_container"><ul id="ending_soon_carousel"></ul></div>');ideeli.latest_events.carousel=channel;ideeli.latest_events.buildLatest(true);},attachClickEventListenersToTabs:function(){jQuery('ul#es_tabs li a').unbind('click');jQuery('ul#es_tabs li a').bind('click',(function(){jQuery(this).toggleClass('Expanded');channel=this.href.split('#tab_')[1];ideeli.latest_events.clearEndingSoonCarouselAndPaginationContainers(channel);return false;}));},initTab:function(channel){ideeli.latest_events.highlightActiveTab(channel);ideeli.latest_events.attachClickEventListenersToTabs();},resetEndingSoonCarousel:function(){jQuery('#ending_soon_carousel').css({'width':'1020px'});jQuery('#carousel_pagination').html('');},addPaginationControls:function(pageBtns){if(pageBtns&&pageBtns.length>1){jQuery.each(pageBtns,function(i,val){jQuery('#carousel_pagination').append('<span class="'+i+'" ></span>');});jQuery('#carousel_pagination span:first-child').addClass('active');jQuery('.button').each(function(){jQuery(this).removeClass('disabled');jQuery(this).css({"opacity":"1"});});jQuery("#horizontal_carousel_container").jCarouselLite({btnNext:".next_button",btnPrev:".previous_button",visible:1,start:0,circular:false,btnGo:pageBtns,afterEnd:ideeli.latest_events.loadContainerImages});}else{jQuery('.button').each(function(){jQuery(this).addClass('disabled');jQuery(this).css({"opacity":"0.5"});});jQuery("#horizontal_carousel_container").jCarouselLite({btnNext:".next_button",btnPrev:".previous_button",visible:1,start:0,circular:false,afterEnd:ideeli.latest_events.loadContainerImages});}
jQuery(window).bind('scroll.prefetchEndingSoonCarousel',ideeli.latest_events.prefetchEndingSoonCarousel);},prefetchEndingSoonCarousel:function(){ideeli.latest_events.loadContainerImages(jQuery('ul#ending_soon_carousel').find('li'));jQuery(window).unbind('scroll.prefetchEndingSoonCarousel');},prefetchWomensTabCarouselPage:function(){ideeli.latest_events.loadContainerImages(jQuery('ul#ending_soon_carousel').find('li'));jQuery(window).unbind('scroll.prefetchWomensTabCarouselPage');},updateContainerImage:function(el){el=jQuery(el);if(el.attr('src')&&el.attr('data-src')&&el.attr('src')!==el.attr('data-src')){el.attr('src',el.attr('data-src'));}},loadContainerImages:function(visible_elements){var els=jQuery(visible_elements).find('img.event_image');_.each(els,ideeli.latest_events.updateContainerImage);},loadComingSoonImages:function(){var els=jQuery('img.coming_soon_event_view_image');_.each(els,ideeli.latest_events.updateContainerImage);jQuery('li.coming_soon_widget_event').unbind('hover.loadComingSoonImages');},buildTab:function(pageBtns){ideeli.latest_events.resetEndingSoonCarousel();ideeli.latest_events.addPaginationControls(pageBtns);jQuery("#ending_soon_tabs").show();},initChannel:function(channel){if(channel){this.channel=channel;}else{channel=this.get_tab_to_be_selected();this.channel=channel;}
if(!channel){channel=Cookie.exists('channel')?Cookie.get('channel'):'all';this.channel=channel;}
this.update_channel_cookie(channel,false);},initCarousel:function(channel){if(!this.carousel){this.carousel=channel;}},showChannelSpecificComingSoonWidget:function(channel){if((channel=='all'||channel=='women')&&jQuery('#coming_soon_widget_upcoming_'+channel)){jQuery('.coming_soon_widget_upcoming').hide();jQuery('#coming_soon_widget_upcoming_'+channel).show();jQuery('li.coming_soon_widget_event').bind('hover.loadComingSoonImages',ideeli.latest_events.loadComingSoonImages);}},showChannelSpecificEditorialUnit:function(channel){jQuery('.channel_editorial_units').hide();jQuery('#editorial_unit_'+channel).show();},hideComingSoonWidgetForDefaultChannels:function(channel){if(channel!=='women'&&channel!=='all'){jQuery('#on_sale_left_col').css({'min-height':'510px'});jQuery('#coming_soon_widget_hp').hide();jQuery('#ending_soon_tabs').hide();jQuery('#on_sale_header').hide();}else{jQuery('#coming_soon_widget_hp').show();jQuery('#on_sale_left_col').css({'min-height':'600px'});jQuery('#on_sale_header').show();}},getLatestEventsAndPositionsData:function(){if(this.needToRefresh()){ideeli.latest_events.latest_data_fetched=false;ideeli.latest_events.latest_positions_fetched=false;}
ideeli.latest_events.getLatestPositionsData();ideeli.latest_events.getLatestEventsData();},getLatestPositionsData:function(){if(this.needToRefresh()){var url='/api201107/events/latest_positions_flat';RequestProxy.getJSON(url,{'ts':(new Date()).getTime()},ideeli.latest_events.getLatestPositionsSuccessHandler,ideeli.latest_events.renderLatest,ideeli.latest_events);return true;}else{ideeli.latest_events.buildLatest();return true;}},getLatestEventsData:function(){if(this.needToRefresh()){if(document_latest_data){this.getLatestEventsSuccessHandler(document_latest_data);this.renderLatest();return true;}else{var url='/api201107/events/latest_data';RequestProxy.getJSON(url,{'ts':(new Date()).getTime()},ideeli.latest_events.getLatestEventsSuccessHandler,ideeli.latest_events.renderLatest,ideeli.latest_events);}}else{ideeli.latest_events.ideeliLatestEvents=new ideeli.latest_events.LatestEventsCollection(amplify.store("latest_events_data"));ideeli.latest_events.buildLatest();return true;}},getLatestEventsSuccessHandler:function(data){ideeli.latest_events.refetchData(data.next_event_start_at,ideeli_utils.now());try{amplify.store("next_event_start_at",data.next_event_start_at);}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store("next_event_start_at",data.next_event_start_at);}catch(e){FUMLSE.errorHandler(e,'next_event_start_at',data.next_event_start_at.length,'ideeli.latest_events.getLatestEventsSuccessHandler','hep_channels_and_homepage.js');throw(e);}}
ideeli.latest_events.ideeliLatestEvents=new ideeli.latest_events.LatestEventsCollection(data.events);ideeli.latest_events_cache.cached_events_data=null;try{amplify.store('latest_events_data',data.events,{'expires':HOURLY_EXPIRATION_MS});}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store('latest_events_data',data.events,{'expires':HOURLY_EXPIRATION_MS});}catch(e){FUMLSE.errorHandler(e,'latest_events_data',data.events.length,'ideeli.latest_events.getLatestEventsSuccessHandler','hep_channels_and_homepage.js');throw(e);}}
ideeli.latest_events.latest_data_fetched=true;return true;},renderLatest:function(){if(ideeli.latest_events.latest_data_fetched&&ideeli.latest_events.latest_positions_fetched){if(window.isHepLatest){ideeli.latest_events.buildLatest();}
ideeli.latest_events.fillChannelMenus();}
else{setTimeout(ideeli.latest_events.renderLatest,50);}
return true;},getLatestPositionsSuccessHandler:function(data){ideeli.latest_events_cache.cached_positions=null;try{amplify.store('latest_positions_flat',data,{'expires':HOURLY_EXPIRATION_MS});}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store('latest_positions_flat',data,{'expires':HOURLY_EXPIRATION_MS});}catch(e){FUMLSE.errorHandler(e,'latest_positions_flat',data.length,'ideeli.latest_events.getLatestPositionsSuccessHandler','hep_channels_and_homepage.js');throw(e);}}
ideeli.latest_events.latest_positions_fetched=true;return true;},getLatestPositionsErrorHandler:function(data){if(ideeli.latest_events_cache.positions()&&ideeli.latest_events_cache.events_data()){ideeli.latest_events.ideeliLatestEvents=new ideeli.latest_events.LatestEventsCollection(ideeli.latest_events_cache.events_data());if(window.isHepLatest){ideeli.latest_events.buildLatest();ideeli.latest_events.fillChannelMenus();}}
return true;},visitLatest:function(channel){if(document.location.href.match(/\/events\/latest2/)){ideeli.latest_events.initLatest(channel);return false;}
else{try{clearTimeout(ideeli.grid.pollUrlChangedId);}catch(e){}
setTimeout(function(){document.location.href="/events/latest?channel="+channel+'#'+channel;},1);return false;}},initLatest:function(channel){window.fum_init_latest=new FUM('init_latest',ideeli.latest_events,ideeli.latest_events.initLatestWithoutFUM,ideeli.latest_events.initLatestSuccessMetric,{'callback_start_arguments':[channel],'callback_success_arguments':[channel]});if(ideeli.latest_events.fourHourReloadCountdownId===0){ideeli.latest_events.fourHourReloadCountdownId=setTimeout(window.location.reload,(HOURLY_EXPIRATION_MS*4));}},needToRefresh:function(){if(!amplify.store("latest_events_data")||!amplify.store("latest_positions_flat")){return true;}
if(parseInt(amplify.store("next_event_start_at"),10)<parseInt(ideeli_utils.now(),10)){return true;}
if(window.REVISION!==amplify.store("stored_revision")){try{amplify.store("stored_revision",window.REVISION);}catch(e){try{ideeli.clearQuickBuyEventBuckets();amplify.store("stored_revision",window.REVISION);}catch(e){FUMLSE.errorHandler(e,'stored_revision',window.REVISION.length,'ideeli.latest_events.needToRefresh','hep_channels_and_homepage.js');throw(e);}}
return true;}
if(this.fingerprintChanged()){return true;}
return false;},loadFirstSetOfImages:function(carouselrefresh){var events=jQuery("#on_sale_left_col .event_unit");var first_set_no=(parseInt(events.size(),10)<this.initialNumberOfEventsToLoad)?parseInt(events.size(),10):this.initialNumberOfEventsToLoad;for(var i=0;i<this.initialNumberOfEventsToLoad;i++){ideeli.latest_events.loadContainerImages(events[i]);}
if(first_set_no===this.initialNumberOfEventsToLoad){jQuery(document).bind('scroll.loadRestOfImages',ideeli.latest_events.loadRestOfImages);setTimeout(ideeli.latest_events.loadRestOfImages,10000);}
if(carouselrefresh==true){ideeli.latest_events.prefetchEndingSoonCarousel();}},loadRestOfImages:function(){var events=jQuery("#on_sale_left_col .event_unit");ideeli.latest_events.loadContainerImages(events);jQuery(document).unbind('scroll.loadRestOfImages');},loadBottomPromoUnitsImages:function(){var units=jQuery("#bottom_promo_units").find('img');_.each(units,ideeli.latest_events.updateContainerImage);jQuery(document).unbind('scroll.loadBottomPromoUnitsImages');},onScrollLoadBottomPromoUnitsImages:function(){jQuery(document).bind('scroll.loadBottomPromoUnitsImages',ideeli.latest_events.loadBottomPromoUnitsImages);},initLatestWithoutFUM:function(channel){ideeli.latest_events.defModels();ideeli.latest_events.latestView();ideeli.latest_events.channelPlaceholderView();ideeli.latest_events.defCollections();ideeli.latest_events.initChannel(channel);ideeli.latest_events.initCarousel(ideeli.latest_events.channel);ideeli.latest_events.showChannelSpecificComingSoonWidget(ideeli.latest_events.channel);ideeli.latest_events.showChannelSpecificEditorialUnit(ideeli.latest_events.channel);ideeli.latest_events.hideComingSoonWidgetForDefaultChannels(ideeli.latest_events.channel);ideeli.latest_events.getLatestEventsAndPositionsData();ideeli.latest_events.loadFirstSetOfImages();ideeli.latest_events.onScrollLoadBottomPromoUnitsImages();return true;},initLatestSuccessMetric:function(channel){var successful_run=false,error_message='',additional_info={};if(error_message.length===0){successful_run=true;}
return[successful_run,error_message,additional_info];},buildLatest:function(carouselrefresh){if(amplify.store("latest_events_data")){ideeli.latest_events.ideeliLatestEvents=new ideeli.latest_events.LatestEventsCollection(amplify.store("latest_events_data"));}
window.fum_build_latest=new FUM('build_latest',ideeli.latest_events,ideeli.latest_events.buildLatestWithoutFUM,ideeli.latest_events.buildLatestSuccessMetric,{'callback_start_arguments':[carouselrefresh],'callback_success_arguments':[carouselrefresh]});},buildLatestWithoutFUM:function(carouselrefresh){var positions=ideeli.latest_events.getNewPositions(carouselrefresh);var events_for_channel=ideeli.latest_events.createPositionsAndDisplayArrayForCurrentChannel(positions);var view=ideeli.latest_events.createViewInstancesForEveryModel(events_for_channel,carouselrefresh,positions);var pageBtns=ideeli.latest_events.populatePageBtns();ideeli.latest_events.showAllEventsForSelectedChannel(carouselrefresh);ideeli.latest_events.showCarouselIfEndingSoonEvents(pageBtns,carouselrefresh);ideeli.latest_events.initTabWithChannelOrCarousel(carouselrefresh);ideeli.latest_events.loadFirstSetOfImages(carouselrefresh);},buildLatestSuccessMetric:function(carouselrefresh){var successful_run=false,error_message='',additional_info={};var channel=ideeli.latest_events.channel;var event_units=jQuery('div.event_unit').length;var positioned_events=0;if(ideeli.latest_events_cache.positions()){positioned_events=ideeli.latest_events_cache.positions()[channel].length;}
if(positioned_events>0&&event_units!==positioned_events){error_message+='Event units for channel '+channel+' should be '+positioned_events+', but is '+event_units+'. ';}
if(error_message.length===0){successful_run=true;}
additional_info[channel+'_event_units']=event_units;if(positioned_events>0){additional_info[channel+'_positioned_events']=positioned_events;}
return[successful_run,error_message,additional_info];},startLatestEventsTimersForDefaultChannels:function(){var now=ideeli_utils.now();jQuery('#latest_events_container .event_unit ').each(function(i,val){var event_unit=jQuery(this);if(event_unit.children()[0].className!="channel_placeholder_link"){eventStartAt=parseInt(event_unit.find('div .starts_in. .starting_in_timer').text(),10)+window.LEAD_IN_PERIOD+ideeli.latest_events.secondRowMemberAdditionalTime();if(now<eventStartAt){ideeli.latest_events.showStartsInTimer(event_unit,eventStartAt);}
else{ideeli.latest_events.showEndsInTimer(event_unit);}
countContainer.show();}});},showOnSaleTimerForEventsNotShoppable:function(mostRecentStartTime){var now=ideeli_utils.now();jQuery('#on_sale_header_start_in').show();ideeli.latest_events.displayNewSaleStartingIn();jQuery('#on_sale_timer_hep').show();jQuery('#latest_events_container .event_unit div .starts_in').hide();var countContainer=jQuery('#on_sale_timer_hep');countContainer.removeClass("hasCountdown");ideeli.latest_events.startTimers(now,mostRecentStartTime,countContainer);},showEndsInTimer:function(event_unit){if(event_unit){var now=ideeli_utils.now();event_unit.find('div .ends_in').show();countContainer=event_unit.find('div .ending_soon_timer');endAt=parseInt(countContainer.text(),10);ideeli.latest_events.startTimers(now,endAt,countContainer);}},showStartsInTimer:function(event_unit,eventStartAt){if(event_unit){var now=ideeli_utils.now();event_unit.find('div .starts_in').show();countContainer=event_unit.find('div .starting_in_timer');ideeli.latest_events.startTimers(now,eventStartAt,countContainer);}},displayStartingSoonGiveawaysAndEvents:function(comingSoonGiveaways,eventsStartingSoon){ideeli.latest_events.displayStartsSoon(comingSoonGiveaways);ideeli.latest_events.displayNewTodayAndGiveawayStartingIn();giveawayStartTime=comingSoonGiveaways[0].attributes.s+window.LEAD_IN_PERIOD;ideeli.latest_events.displayEventsWithTimers(giveawayStartTime,eventsStartingSoon);},displayEventsWithTimers:function(startTime,eventsStartingSoon){var now=ideeli_utils.now();ideeli.latest_events.displayStartsSoon(eventsStartingSoon);header_timer=jQuery('#on_sale_timer_hep');header_timer.removeClass("hasCountdown");ideeli.latest_events.startTimers(now,startTime,header_timer);header_timer.show();},displayEndsInTimersForIndividualEventUnits:function(){jQuery('#latest_events_container .event_unit div .ends_in').show();jQuery('#latest_events_container .event_unit div .ending_soon_timer').each(function(i,val){var countContainer=jQuery(this);var now=ideeli_utils.now();countContainer.show();var endAt=parseInt(countContainer.text(),10);ideeli.latest_events.startTimers(now,endAt,countContainer);});},displayLatestSalesGraphicHeader:function(){var now=ideeli_utils.now();var switchover=window.DAILY_SWITCHOVER;if(now<(switchover.valueOf()/1000)){ideeli.latest_events.displayLatestSalesHeader();}},hideElementsUnrelatedToCountdownTimers:function(){jQuery('#latest_events_container .event_unit div .ending_soon_timer').hide();jQuery('.starts_soon').hide();jQuery('#latest_events_container .event_unit div .ends_in').hide();jQuery('#latest_events_container .event_unit div .starts_in').hide();jQuery('#on_sale_header_start_in').hide();jQuery('#on_sale_timer_hep').hide();jQuery('#on_sale_header_new_today_giveaway_starts_in').hide();jQuery('#new_today_more_sales_starting_in_title').hide();},showAllEventsForSelectedChannel:function(carouselrefresh){var eventsStartingSoon=ideeli.latest_events.startingSoon(ideeli.latest_events.channel);var eventsStartedToday=ideeli.latest_events.startedToday(ideeli.latest_events.channel);var mostRecentStartTime=ideeli.latest_events.mostRecentStartTime(ideeli.latest_events.channel);if(!carouselrefresh){if(ideeli.latest_events.ideeliLatestEvents.models[0]){if(eventsStartedToday.length===0&&eventsStartingSoon.length>0&&(['all','women'].include(ideeli.latest_events.channel))){ideeli.latest_events.showOnSaleTimerForEventsNotShoppable(mostRecentStartTime);}
else{ideeli.latest_events.showTimersForEvents();}
ideeli.latest_events.addClassForHeroEvent();}}},resetTabsForEndingSoon:function(){jQuery('.es_tabs_nav a').hide();jQuery('.carousel_buttons').hide();jQuery('.carousel_buttons').css({'width':'442px'});ideeli.latest_events.showTabsForEndingSoon();},showTabsForEndingSoon:function(){var events=new ideeli.latest_events.LatestEventsCollection(ideeli.latest_events_cache.events_data());var switchover=window.DAILY_SWITCHOVER;jQuery(ideeli.my_channels).each(function(index,channel){var positions=ideeli.latest_events_cache.positions()[channel];var events_for_channel=ideeli.latest_events.createPositionsAndDisplayArrayForCurrentChannel(positions);var ending_soon_events=0;if(events_for_channel){var views=events_for_channel.each(function(event){var model=ideeli.latest_events.ideeliLatestEvents.get(event.id);if(typeof model!=='undefined'){var start=ideeli_utils.timestampToDate(model.attributes.s);var switchoverGreaterThanStart=(switchover.dayDiff(start)>1);var switchoverEqualStart=(switchover.dayDiff(start)===1);var nowGreaterThanSwitchover=(now>(switchover.valueOf()/1000));var isShoppingEvent=(model.attributes.k===0);var isEndingSoon=(switchoverGreaterThanStart||(switchoverEqualStart&&nowGreaterThanSwitchover));if(isShoppingEvent&&isEndingSoon){ending_soon_events++;}}});if(ending_soon_events===0){if(jQuery('#tab_'+channel).length){var pagination_width=39+jQuery('#tab_'+channel+' img').width()+jQuery('.carousel_buttons').width();jQuery('.carousel_buttons').css({'width':pagination_width+'px'});jQuery('#tab_'+channel).hide();}}else{jQuery('#tab_'+channel).show();}}});jQuery('.carousel_buttons').show();},showTimersForEvents:function(){var comingSoonGiveaways=ideeli.latest_events.hasComingSoonGiveaways(ideeli.latest_events.channel);var eventsStartingSoon=ideeli.latest_events.startingSoon(ideeli.latest_events.channel);var eventsStartedToday=ideeli.latest_events.startedToday(ideeli.latest_events.channel);var mostRecentStartTime=ideeli.latest_events.mostRecentStartTime(ideeli.latest_events.channel);ideeli.latest_events.hideElementsUnrelatedToCountdownTimers();if(['all','women'].include(ideeli.latest_events.channel)){ideeli.latest_events.displayLatestSalesGraphicHeader();ideeli.latest_events.displayEndsInTimersForIndividualEventUnits();if(comingSoonGiveaways.length>0){ideeli.latest_events.displayStartingSoonGiveawaysAndEvents(comingSoonGiveaways,eventsStartingSoon);}
else if(eventsStartedToday.length>0&&eventsStartingSoon.length>0){ideeli.latest_events.displayNewTodayAndMoreSaleStartingIn();ideeli.latest_events.displayEventsWithTimers(mostRecentStartTime,eventsStartingSoon);}
else{jQuery('#on_sale_header_new_today').show();}}else{jQuery('#on_sale_header_new_today').hide();ideeli.latest_events.startLatestEventsTimersForDefaultChannels();}},addClassForHeroEvent:function(){jQuery('#latest_events_container div.event_unit img.event_image_505').each(function(){jQuery(this).parent().parent().addClass('hero');});jQuery('#latest_events_container div.event_unit a img.placeholder_image_505').each(function(){jQuery(this).parent().parent().addClass('hero');});},initTabWithChannelOrCarousel:function(carouselrefresh){if(carouselrefresh){ideeli.latest_events.initTab(this.carousel);}else{ideeli.latest_events.initTab(this.channel);}},populatePageBtns:function(){var pageBtns=[];jQuery('ul#ending_soon_carousel li').each(function(index){pageBtns.push('#carousel_pagination .'+index);});return pageBtns;},addEventsToLatestAndCarouselContainers:function(view,pos){if(!jQuery('#latest_events_container').children()[0]){jQuery('#latest_events_container').append(view.render(505,505,pos).el);}else{jQuery('#latest_events_container').append(view.render(240,240,pos).el);}},getViewForModel:function(model){if(model&&model.attributes.k===0){try{return new ideeli.latest_events.customEventUnitView({model:model});}catch(e){return new ideeli.latest_events.latestEventUnit({model:model});}}else{return new ideeli.latest_events.channelPlaceholderUnit({model:model});}},createViewInstancesForEveryModel:function(events_for_channel,carouselrefresh,positions){var eventSet=jQuery(document.createElement('li'));var i;var j=0;var ev,model,view,display,start,switchover;var pos=0,pos_ending_soon=0;for(i=0;i<events_for_channel.length;i++){ev=events_for_channel[i];model=ideeli.latest_events.ideeliLatestEvents.get(ev.id);view=ideeli.latest_events.getViewForModel(model);if(model){display=ev.display;start=ideeli_utils.timestampToDate(model.attributes.s);switchover=window.DAILY_SWITCHOVER;if(ideeli.latest_events.channel=='women'||ideeli.latest_events.channel=='all'){if((switchover.dayDiff(start)===0)||(switchover.dayDiff(start)===1&&now<(switchover.valueOf()/1000))){if(!carouselrefresh){ideeli.latest_events.addEventsToLatestAndCarouselContainers(view,pos++);}}
else{if(!carouselrefresh&&model.attributes.k==1){ideeli.latest_events.addEventsToLatestAndCarouselContainers(view,pos++);}
else{if(model.attributes.k===0){if((j>7)&&(j%8===0)){ideeli.latest_events.appendEventSetToEndingSoonCarousel(eventSet);eventSet=jQuery(document.createElement('li'));}
eventSet.append(view.render(230,230,pos_ending_soon++).el);j++;if(i==(positions.length-1)){ideeli.latest_events.appendEventSetToEndingSoonCarousel(eventSet);}}}}
ideeli.latest_events.resetEndingSoonCarouselWidthAndLeftIfWomensChannel();}
else{ideeli.latest_events.appendViewToLatestEventsContainer(display,view,pos++);}
ideeli.latest_events.appendEventSetToEndingSoonCarousel(eventSet);}}},logEventClicked:function(event_id,position,isEndingSoon){var params={'type':isEndingSoon?'latest_click_hep_ending_soon':'latest_click_hep','location':position,'version':Cookie.get('channel')};new Ajax.Request('/el/click_track/'+event_id,{parameters:params,evalScripts:false,method:'get'});return true;},resetEndingSoonCarouselWidthAndLeftIfWomensChannel:function(){if(ideeli.latest_events.channel=='women'){jQuery('#ending_soon_carousel').css({'width':'1020px'});jQuery('#ending_soon_carousel').css({'left':'0px'});}},appendViewToLatestEventsContainer:function(display,view,pos){if((display=='2')||(jQuery('#latest_events_container').children()[0]===null)){jQuery('#latest_events_container').append(view.render(505,505,pos).el);}else{jQuery('#latest_events_container').append(view.render(240,240,pos).el);}},appendEventSetToEndingSoonCarousel:function(eventSet){if(eventSet.length>0){jQuery('#ending_soon_carousel').append(eventSet);}},getNewPositions:function(carouselrefresh){jQuery('#ending_soon_carousel').html('');if(!carouselrefresh){jQuery('#latest_events_container').html('');return ideeli.latest_events_cache.positions()[this.channel];}else{return ideeli.latest_events_cache.positions()[this.carousel];}},createPositionsAndDisplayArrayForCurrentChannel:function(positions){var events_for_channel=[];if(positions){var i=0;for(i=0;i<positions.length;i++){events_for_channel.push({'id':positions[i],'display':((i===0)?2:1),'pos':i});}}
return events_for_channel;},showCarouselIfEndingSoonEvents:function(pageBtns,carouselrefresh){if(jQuery('#ending_soon_carousel').children().first().html()!==''&&(this.channel=='women'||this.channel=='all')){jQuery('#ending_soon_tabs').show();if(this.channel=='all'){ideeli.latest_events.resetTabsForEndingSoon();jQuery('#carousel_container').removeClass('women');ideeli.latest_events.buildTab(pageBtns);}else{jQuery('#carousel_container').addClass('women');jQuery('.carousel_buttons').hide();jQuery('#ending_soon_carousel').attr('style','');jQuery(window).bind('scroll.prefetchWomensTabCarouselPage',ideeli.latest_events.prefetchWomensTabCarouselPage);}
jQuery('.ending_soon_timer').each(function(i,val){var now=ideeli_utils.now();var countContainer=jQuery(this);var endAt=parseInt(countContainer.text(),10);ideeli.latest_events.startTimers(now,endAt,countContainer);});}
if(jQuery('#ending_soon_carousel').children().first().html()===''&&!carouselrefresh){jQuery('#ending_soon_tabs').hide();}},update_channel_cookie:function(channel_name,erase){if(erase){Cookie.erase('preferred_channel');}
Cookie.set('channel',channel_name,1);},get_tab_to_be_selected:function(){var channel_href=window.location.href.match(/#(\w+)/);if(channel_href&&jQuery.inArray(channel_href[1],ideeli.my_channels)){return channel_href[1];}},go_to_channel:function(channel_name){if(channel_name=='travel'&&$$('.channel_menu_single_container_travel')[0]){return true;}
ideeli.latest_events.update_channel_cookie(channel_name);ideeli.channels.select_channel(channel_name);document.location.hash=channel_name;if(!window.isHepLatest){window.location.href='/events/latest#'+channel_name;}},sortEventsAlphabeticallyForDropdownMenus:function(){var data=ideeli.latest_events_cache.events_data();var events=null;if(data){jQuery(data).each(function(){if(this.b){this.b=this.b.toUpperCase();}});data=data.sort(ideeli_utils.sort_by('b',false));try{events=new ideeli.latest_events.LatestEventsCollection(data);}
catch(e){}}
return events;},getPositionsForEventsForChannels:function(index,channel){return ideeli.latest_events_cache.positions()[channel];},showOrHideChannelMenu:function(showmenu){if(!showmenu){showmenu=ideeli.masthead.showMenus();}
if(showmenu){jQuery('#nav-one-hep').removeClass('no_dropdowns');}
else{showmenu=false;jQuery('.channel_menu_container').remove();ideeli.cart.hideCartLink();return false;}},fillChannelMenus:function(showmenu){ideeli.masthead.buildChannelMenus();},fillChannelMenusWithoutFUM:function(showmenu){if(!ideeli.latest_events_cache.positions()||!ideeli.latest_events_cache.events_data()){ideeli.latest_events.initLatest();return false;}
ideeli.latest_events.showOrHideChannelMenu(showmenu);ideeli.latest_events.channelsView();jQuery('ul.channel_menu_column_items').html('');try{ideeli.latest_events.createChannelMenus();ideeli.latest_events.bindClickToChannelMenuColumnItems();ideeli.latest_events.showChannelMenuColumnItems();}
catch(e){if(ideeli.latest_events.killCount<1){amplify.store('latest_events_data',null);ideeli.latest_events_cache.cached_events_data=null;ideeli.latest_events.killCount=1;ideeli.latest_events.initLatest();}
return false;}
return true;},fillChannelMenusSuccessMetric:function(){var successful_run=false,error_message='',additional_info={},items_under_menu=0,positioned_events=0;jQuery.each(ideeli.my_channels,function(i,c){if(c==='travel'||c==='specials'){return true;}
positioned_events=0;items_under_menu=jQuery('li a.'+c).length;if(ideeli.latest_events_cache.positions()&&ideeli.latest_events_cache.events_data()){var p=ideeli.latest_events_cache.positions()[c];var d=ideeli.latest_events_cache.events_data();var event_ids=[];jQuery.each(d,function(i,event_data){if(event_data.k===0){event_ids.push(parseInt(event_data.id,10));}});jQuery.each(p,function(i,ev){for(var event_id in ev){if(ev.hasOwnProperty(event_id)){event_id=parseInt(event_id,10);if(event_id>0&&event_ids.indexOf(event_id)>-1){positioned_events+=1;}}}});}
if(!jQuery('.channel_menu_container_'+c+':visible')){error_message+='The class .channel_menu_container_'+c+':visible does not exist and should be visible. ';}
if(positioned_events>0&&items_under_menu!==positioned_events){error_message+='The '+c+' menu only has '+items_under_menu+' items when it should have '+positioned_events+'. ';}
additional_info[c+'_menu_items']=items_under_menu;});if(error_message.length===0){successful_run=true;}
return[successful_run,error_message,additional_info];},bindClickToChannelMenuColumnItems:function(){jQuery('#channel_menu_all tr td ul.channel_menu_column_items li a').bind('click',function(){ideeli.latest_events.update_channel_cookie('all',true);return true;});},createDefaultChannelMenus:function(events){var i=0,channel='';for(i=0;i<ideeli.my_channels.length;i++){channel=ideeli.my_channels[i];if(channel!='all'){var channelDropdowns=ideeli.latest_events.createDropdowns(channel);if(events){var eventsForChannel=ideeli.latest_events_cache.positions()[channel];var channelEvents=_.filter(events.models,function(model){return model.attributes.k===0&&_.include(eventsForChannel,model.attributes.id);});var channelViews=channelEvents.map(function(model,index){var view=new ideeli.latest_events.channelItemView({model:model});view=ideeli.latest_events.populateDropdowns(channel,view,channelDropdowns,model);});}}}},createChannelMenus:function(){var events=ideeli.latest_events.sortEventsAlphabeticallyForDropdownMenus();ideeli.latest_events.createDefaultChannelMenus(events);ideeli.latest_events.createAllChannelMenu(events);},showChannelMenuColumnItems:function(){var menu=jQuery('#channel_menu_all tr td ul.channel_menu_column_items');jQuery(menu).each(function(){if(this.childNodes&&this.childNodes.length>1){jQuery(this).show();}});},filterEvents:function(index,channel,model){var view=null;var events_for_channel=ideeli.latest_events.getPositionsForEventsForChannels(index,channel);if(events_for_channel){jQuery(events_for_channel).each(function(index,ev){if(model.attributes.k===0&&model.attributes.id==ev){view=new ideeli.latest_events.channelItemView({model:model});}});}
return view;},createTitlesForAllChannel:function(){var allchanneltitle=jQuery('#channel_menu_women tr td.channel_menu_column_left h3').html();jQuery('#channel_menu_all tr td.channel_menu_column_left').html('<h3>'+allchanneltitle+'</h3>');jQuery('#channel_menu_all tr td.channel_menu_column_right').html('<h3>Ending Soon</h3>');},createWomensDropdown:function(val){var channelDropdowns={};channelDropdowns.channelDropdownL=ideeli.latest_events_cache.dom_element('#channel_menu_'+val+' tr td.channel_menu_column_left ul.channel_menu_column_items');channelDropdowns.channelDropdownR=ideeli.latest_events_cache.dom_element('#channel_menu_'+val+' tr td.channel_menu_column_right ul.channel_menu_column_items');return channelDropdowns;},createDefaultDropdown:function(val){var channelDropdowns={};channelDropdowns.channelDropdown=ideeli.latest_events_cache.dom_element('#channel_menu_'+val+' tr td ul.channel_menu_column_items');return channelDropdowns;},createAllDropdown:function(view){var channelDropdowns={};category=view.model.attributes.channel_val;channelDropdowns.channelDropdownL=jQuery('#channel_menu_all '+'tr td.channel_menu_column_left ul.all_menu_'+category);channelDropdowns.channelDropdownR=jQuery('#channel_menu_all '+'tr td.channel_menu_column_right ul.all_menu_'+category);return channelDropdowns;},createDropdowns:function(val){var channelDropdowns={};if(val=='women'){channelDropdowns=ideeli.latest_events.createWomensDropdown(val);}else{channelDropdowns=ideeli.latest_events.createDefaultDropdown(val);}
return channelDropdowns;},populateDropdowns:function(channel,view,channelDropdowns,model){if(view){var now=ideeli_utils.now();var switchover=window.DAILY_SWITCHOVER;if(channel=='all'||channel=='women'){start=ideeli_utils.timestampToDate(model.attributes.s);if((switchover.dayDiff(start)===0)||(switchover.dayDiff(start)===1&&now<(switchover.valueOf()/1000))){channelDropdowns.channelDropdownL.append(view.render(channel).el);}else if(switchover.dayDiff(start)<0){}else{channelDropdowns.channelDropdownR.append(view.render(channel).el);}}else{channelDropdowns.channelDropdown.append(view.render(channel).el);}
return view;}},createMenu:function(val){var menu=jQuery(document.createElement('ul'));menu.addClass('channel_menu_column_items all_menu_'+val);menu.css('display','none');var menutitle=jQuery(document.createElement('li'));menutitle.addClass('menu_title');if(val=='women'||val=='men'){menutitle.html(val+"'s");}else{menutitle.html(val);}
menu.append(menutitle);jQuery('#channel_menu_all tr td.channel_menu_column').append(menu);},addClassAndClickBehaviourToChannelMenuColumnItems:function(val){jQuery('#channel_menu_'+val+' tr td ul.channel_menu_column_items li a').addClass(val);jQuery('#channel_menu_'+val+' tr td ul.channel_menu_column_items li a').bind('click',function(){ideeli.latest_events.update_channel_cookie(val,true);ideeli.channels.select_tab(val);Cookie.set('channel',val);return true;});},createAllChannelMenu:function(events){ideeli.latest_events.createTitlesForAllChannel();jQuery(ideeli.my_channels).each(function(index,channel){if(channel!='all'){ideeli.latest_events.addClassAndClickBehaviourToChannelMenuColumnItems(channel);ideeli.latest_events.createMenu(channel);}});if(events){var eventsForChannel=ideeli.latest_events_cache.positions()['all'];var channelEvents=_.filter(events.models,function(model){return model.attributes.k===0&&_.include(eventsForChannel,model.attributes.id);});var channelViews=channelEvents.map(function(model,index){var view=new ideeli.latest_events.channelItemView({model:model});var channelDropdowns=ideeli.latest_events.createAllDropdown(view);view=ideeli.latest_events.populateDropdowns('all',view,channelDropdowns,model);});}},markAsViewed:function(){var user_id=0;if(window.current_user){user_id=window.current_user.id;}
var req=new Ajax.Request('/el/image/latest_view2/'+user_id+'/spacer.gif',{method:'get'});}};}();}
function refreshAfterCountdown(){if(!ideeli.latest_events.reloading){ideeli.latest_events.reloading=true;var rand_secs=((Math.floor(Math.random()*11)*1000)+(Math.floor(Math.random()*11)*1000));setTimeout(function(){ideeli.latest_events_cache.purge_cache_data();amplify.store('latest_positions_flat',null);amplify.store('latest_events_data',null);window.location.reload();},rand_secs);}}
ideeli_utils={isiPad:function(){return navigator.userAgent.match(/iPad/i)!=null;},now:function(){return Clock.getNow();},today:function(){return ideeli_utils.timestampToDate(this.now());},sort_by:function(field,reverse,primer){reverse=(reverse)?-1:1;return function(a,b){a=a[field];b=b[field];if(typeof(primer)!='undefined'){a=primer(a);b=primer(b);}
if(a<b)return reverse*-1;if(a>b)return reverse*1;return 0;};},formatDate:function(datestring){if(datestring){var d=datestring.gsub(' ',',').gsub('-',',').gsub(':',',')+',0,0';d=d.split(',');d=new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5],d[6],d[7]);return d;}},timestampToDate:function(timestamp){if(timestamp){var d=new Date(timestamp*1000);return d;}},millisecondsUntilMidnight:function(){var midnight=new Date();midnight.setHours(24);midnight.setMinutes(0);midnight.setSeconds(0);midnight.setMilliseconds(0);return midnight.getTime()-new Date().getTime();}};(function(){FUM=function(widget_name,callback_this,callback_start,callback_success,opts){opts=opts||{};this.callback_this=callback_this;this.callback_start=callback_start;this.callback_success=callback_success;this.opts=opts;this.widget_name=widget_name;this.success=false;this.start_at=new Date().getTime();this.end_at=0;this.metric_end_at=0;this.exception_type='';this.browser=FUM.getBrowserString();this.version=jQuery.browser.version;this.current_url=document.location.href;this.revision=FUM.getRevision();this.additional_info={};this.fum_enabled=window.FUM_ENABLED;if(this.fum_enabled){this.fum_enabled=!!!(document.location.href.match(/disable_fum=1/));}
else{if(document.location.href.match(/enable_fum=1/)){this.fum_enabled=true;}
if(!this.fum_enabled&&amplify.store('enable_fum')){this.fum_enabled=true;}}
if(opts&&opts.additional_info){this.additional_info=opts.additional_info;}
if(opts&&opts.callback_start_arguments===undefined){opts.callback_start_arguments=[];}
if(opts&&opts.callback_success_arguments===undefined){opts.callback_success_arguments=[];}
if(opts&&opts.async){this.async=true;}
if(this.fum_enabled){try{FUMQ.init();callback_start.apply(callback_this,opts.callback_start_arguments);if(!this.async){this.end_at=new Date().getTime();var callback_metrics=callback_success.apply(callback_this,opts.callback_success_arguments);this.metric_end_at=new Date().getTime();var callback_succeeded=callback_metrics[0];var callback_message=callback_metrics[1];var additional_info=callback_metrics[2];if(callback_succeeded){this.recordSuccess(additional_info);}
else{this.recordFailure(callback_message,additional_info);}}}
catch(e){this.recordException(e);if(!!window.chrome){e=new Error(e.stack);}
throw e;}
finally{}}
else{callback_start.apply(callback_this,opts.callback_start_arguments);}
return this;};FUM.prototype.asyncWorkDone=function(){if(this.async){this.workDone();}};FUM.prototype.workDone=function(){try{this.end_at=new Date().getTime();var callback_metrics=this.callback_success.apply(this.callback_this,this.opts.callback_success_arguments);this.metric_end_at=new Date().getTime();var callback_succeeded=callback_metrics[0];var callback_message=callback_metrics[1];var additional_info=callback_metrics[2];if(callback_succeeded){this.recordSuccess(additional_info);}else{this.recordFailure(callback_message,additional_info);}}catch(e){this.recordException(e);if(!!window.chrome){e=new Error(e.stack);}
throw e;}finally{}};FUM.getBrowserString=function(){var browser='';jQuery.each(jQuery.browser,function(b){if(browser.length===0&&b!=='version'&&jQuery.browser[b]){browser=b;}
if(browser=='webkit'){if(!!window.chrome){browser='chrome';}else{browser='safari';}}});return browser;};FUM.getVisitorCookieValue=function(){if(Cookie.exists('v_trk')){return Cookie.get('v_trk');}
else{return null;}};FUM.setVisitorCookieValue=function(){Cookie.set('v_trk',FUM.getRevision());};FUM.shouldTrackVisitOnPage=function(){var on_latest_page=/\/events\/latest/.match(document.location.pathname);var on_latest2_page=/\/events\/latest2/.match(document.location.pathname);if(on_latest_page||on_latest2_page){return true;}
return false;};FUM.controlAndUpdateVisitorCookie=function(){if(FUM.shouldTrackVisitOnPage()){var revision=FUM.getRevision();var visitor_tracking=FUM.getVisitorCookieValue();if(visitor_tracking==null||visitor_tracking!=revision){FUM.setVisitorCookieValue();}}};FUM.getVisitStatus=function(){var visit_status='first';var stored_revision=FUM.getVisitorCookieValue();var revision=FUM.getRevision();if(stored_revision&&revision==stored_revision){visit_status='repeat';}
return visit_status;};FUM.getRevision=function(){var rev=window.REVISION;if(rev===undefined){var links=jQuery('link');var link_match=null;jQuery.each(links,function(linkIndex,linkVal){link_match=linkVal.href.match(/.*frontend_(\d+).css$/);if(link_match&&link_match.size>1){rev=link_match[1];}});window.REVISION=rev;}
return rev;};FUM.prototype.getBasicData=function(additional_info){var labs_data=(ideeli!=null&&ideeli.labs!=null)?ideeli.labs.evData():null;var labs_experiments=(labs_data!=null)?labs_data['experiments']:{};return{'fum[][widget]':this.widget_name,'fum[][browser]':this.browser,'fum[][version]':this.version,'fum[][url]':this.current_url,'fum[][revision]':this.revision,'fum[][optional]':jQuery.extend({},this.additional_info,additional_info),'fum[][labs_experiments]':labs_experiments||{}};};FUM.prototype.recordSuccess=function(additional_info){var data=this.getBasicData(additional_info);data['fum[][success]']=1;data['fum[][duration]']=(this.end_at-this.start_at);data['fum[][metric_duration]']=(this.metric_end_at-this.end_at);this.sendResult(data);};FUM.prototype.recordFailure=function(error_message,additional_info){var data=this.getBasicData(additional_info);data['fum[][success]']=0;data['fum[][duration]']=(this.end_at-this.start_at);data['fum[][metric_duration]']=(this.metric_end_at-this.end_at);data['fum[][error_message]']=error_message;this.sendResult(data);};FUM.prototype.recordException=function(exception){if(!window.FUM_RECURSION_COUNT[this.widget_name]){window.FUM_RECURSION_COUNT[this.widget_name]=0;}
if(window.FUM_RECURSION_COUNT[this.widget_name]<10){if(exception&&exception.message&&exception.message.toString().match(/stack|recurs/gi)){window.FUM_RECURSION_COUNT[this.widget_name]+=1;}
var additional_info={};if(window.FUM_RECURSION_COUNT[this.widget_name]>0){additional_info.recursion_count=window.FUM_RECURSION_COUNT[this.widget_name];}
var data=this.getBasicData(additional_info);data['fum[][success]']=0;data['fum[][duration]']=(new Date().getTime()-this.start_at);data['fum[][exception_type]']=exception.name;data['fum[][exception_msg]']=exception.message.toString().replace(/'/,'').replace(/"/,'');this.sendResult(data);}};FUM.prototype.sendResult=function(data){FUMQ.enqueue(data);};}).call(this);var FUMQ=(function(obj){var fumq=obj||{},inited=false,interval=5000;fumq.queue=[];fumq.enqueue=function(data){return fumq.queue.push(data);};fumq.init=function(){if(!inited){inited=true;setInterval(fumq.reportBack,interval);jQuery(window).unload(fumq.reportBack);}
return inited;};fumq.reportBack=function(){var data=fumq.queue;if(data.length>0){var query_data='';for(var i=0;i<data.length;i++){query_data+=jQuery.param(data[i])+'&';}
fumq.queue=[];jQuery.ajax({type:'POST',url:document.location.protocol+'//'+document.location.host+'/fum/m',cache:false,data:query_data});}
return true;};return fumq;}(FUMQ||{}));var FUME=(function(obj){var fume=obj||{};fume.errorHandler=function(msg,url,lineNumber){try{var data={'widget':'js_exception','success':0,'browser':FUM.getBrowserString(),'version':jQuery.browser.version,'url':document.location.href,'revision':FUM.getRevision(),'error_message':msg,'exception_type':url+':'+lineNumber,'exception_msg':'Error from JS in file '+url+' on line '+lineNumber+': '+msg};fume.sendResult(data);}
catch(e){}
finally{if(window.old_onerror){window.old_onerror(msg,url,lineNumber);}}
return this;};fume.sendResult=function(data){jQuery.ajax({type:'GET',url:document.location.protocol+'//'+document.location.host+'/fum/r',cache:false,data:data});return this;};fume.init=function(window){window.old_onerror=window.onerror;window.onerror=fume.errorHandler;return this;};fume.init(window);return fume;}(FUME||{}));var FUMLSE=(function(obj){var fumlse=obj||{};fumlse.errorHandler=function(exception_msg,key,data_length,msg,url,lineNumber){try{var detail_msg='Error while saving data in localstorage from JS in file '+url;if(typeof(msg)!=='undefined'){detail_msg+=' : '+msg;}
if(typeof(lineNumber)!=='undefined'){detail_msg+=' on line '+lineNumber;}
var data={'widget':'js_exception','success':0,'ls_key':key,'data_length':data_length,'browser':FUM.getBrowserString(),'version':jQuery.browser.version,'url':document.location.href,'revision':FUM.getRevision(),'error_message':exception_msg,'exception_type':url+':'+lineNumber,'exception_msg':detail_msg};fumlse.sendResult(data);}
catch(e){}
return this;};fumlse.sendResult=function(data){jQuery.ajax({type:'GET',url:document.location.protocol+'//'+document.location.host+'/fum/r',cache:false,data:data});return this;};return fumlse;}(FUMLSE||{}));var FUMAsync=(function(obj){var fumasync=obj||{};fumasync.errorHandler=function(widget_name,error_msg,additional_info){try{var data={'widget':widget_name,'success':0,'browser':FUM.getBrowserString(),'version':jQuery.browser.version,'revision':FUM.getRevision(),'error_message':error_msg,'optional':additional_info};fumasync.sendResult(data);}
catch(e){}
return this;};fumasync.successHandler=function(widget_name,additional_info){try{var data={'widget':widget_name,'success':1,'browser':FUM.getBrowserString(),'version':jQuery.browser.version,'url':document.location.href,'revision':FUM.getRevision(),'optional':additional_info};fumasync.sendResult(data);}
catch(e){}
return this;};fumasync.sendResult=function(data){jQuery.ajax({type:'GET',url:document.location.protocol+'//'+document.location.host+'/fum/r',cache:false,data:data});return this;};return fumasync;}(FUMAsync||{}));var RequestProxy=(function(obj,jQuery){var my=obj||{},url_callbacks={},request_queue=[],request_failure_errors={},request_failure_attempts={},request_failure_frequency=3,rate_limiting_queue={},rate_limit_frequency=10,rate_limit_duration=(30*1000),rate_limit_exceptions=[];my.addCallback=function(url,callback_context,callback){if(!url_callbacks[url]){url_callbacks[url]=[callback_context,[callback]];}
else{if(url_callbacks[url][1].indexOf(callback)<0){url_callbacks[url][1].push(callback);}
else{return false;}}
return true;};my.createAjaxOpts=function(method,url,data,success,opts){var ajax_opts={url:url,data:data,success:my.successThenCallbacks(success,url),error:_.bind(my.failureThenRetry,this,method,url,data,success,opts)};if('post'===method.toString().toLowerCase()){ajax_opts.type='POST';}
else{ajax_opts.type='GET';}
if(opts.dataType){ajax_opts.dataType=opts.dataType;}
return ajax_opts;};my.failureThenRetry=function(method,url,data,success,opts,jqXHR,textStatus,errorThrown){if(jqXHR.readyState==0||jqXHR.status==0)return;request_failure_errors[url]=[textStatus,errorThrown,jqXHR.readyState,jqXHR.status];my.retryAfterError(method,url,data,success,opts);};my.get=function(url,params,success,callback,callback_context,opts){return this.requestProxy('get',url,params,success,callback,callback_context,opts);};my.getJSON=function(url,params,success,callback,callback_context,opts){opts=_.extend({},opts);opts.dataType='json';return this.requestProxy('get',url,params,success,callback,callback_context,opts);};my.isRateLimited=function(url){var rate_limiting_timestamps=rate_limiting_queue[url];if(rate_limiting_timestamps){if(rate_limiting_timestamps.length<rate_limit_frequency){rate_limiting_queue[url].push(new Date().getTime());return false;}
else{var last_time_called=rate_limiting_timestamps[rate_limit_frequency-1];var rate_limit_threshold_timestamp=new Date().getTime()-rate_limit_duration;if(last_time_called<rate_limit_threshold_timestamp){rate_limiting_queue[url]=[new Date().getTime()];return false;}
else{if(rate_limit_exceptions.indexOf(url)===-1){rate_limit_exceptions.push(url);my.sendFUMReportRateLimited(url);}
return true;}}}
else{rate_limiting_queue[url]=[new Date().getTime()];return false;}};my.post=function(url,params,success,callback,callback_context,opts){return this.requestProxy('post',url,params,success,callback,callback_context,opts);};my.requestProxy=function(method,url,data,success,callback,callback_context,opts){if(my.isRateLimited(url)){return true;}
if(!my.addCallback(url,callback_context,callback)){return true;}
my.sendRequest(method,url,data,success,opts);return this;};my.retryAfterError=function(method,url,data,success,opts){var attempts=request_failure_attempts[url];if(_.isUndefined(attempts)){request_failure_attempts[url]=0;my.sendRequest(method,url,data,success,opts);my.sendFUMReportRequestFailure(url);}
else if(parseInt(attempts,10)<request_failure_frequency){request_failure_attempts[url]+=1;my.sendRequest(method,url,data,success,opts);my.sendFUMReportRequestFailure(url);}
else{my.sendFUMReportRequestFailure(url);}
return true;};my.sendRequest=function(method,url,data,success,opts){var ajax_opts=my.createAjaxOpts(method,url,data,success,opts);var req=jQuery.ajax(ajax_opts);request_queue.push(req);return true;};my.sendFUMReportGeneric=function(widget_type,fum_error_msg,opts){var data={'widget':widget_type,'browser':FUM.getBrowserString(),'version':jQuery.browser.version,'url':document.location.href,'revision':FUM.getRevision(),'success':0,'duration':0,'metric_duration':0,'error_message':fum_error_msg,'optional':opts};jQuery.ajax({type:'GET',url:'http://'+document.location.host+'/fum/r',cache:false,data:data});return true;};my.sendFUMReportRateLimited=function(rate_limited_url){return my.sendFUMReportGeneric('request_proxy_rate_limited','This url reached the request proxy rate limit',{'url':rate_limited_url,'rate_limit_frequency':rate_limit_frequency,'rate_limit_duration':rate_limit_duration});};my.sendFUMReportRequestFailure=function(url){var msg='This url returned a failed response ';msg+=(request_failure_attempts[url]<request_failure_frequency)?'and will be retried.':'and reached max frequency, not retrying.';var opts={'url':url,'request_failure_attempts':request_failure_attempts[url],'request_failure_frequency':request_failure_frequency,'text_status':request_failure_errors[url][0],'error_thrown':request_failure_errors[url][1],'xhr_ready_state':request_failure_errors[url][2],'xhr_status':request_failure_errors[url][3]};return my.sendFUMReportGeneric('request_proxy_url_failure_retry',msg,opts);};my.successThenCallbacks=function(success,url){return _.wrap(success,function(func,data,textStatus,jqXHR){func(data,textStatus,jqXHR);var bound_callback,i;if(url_callbacks[url]){for(i=0;i<url_callbacks[url][1].length;i++){bound_callback=_.bind(url_callbacks[url][1][i],url_callbacks[url][0]);bound_callback();}}
delete url_callbacks[url];delete request_failure_attempts[url];});};return my;}(RequestProxy||{},jQuery));(function(){var root=this;var LPimage;if(typeof exports!=='undefined'){LPimage=exports;}else{LPimage=root.LPimage={};}
LPimage.VERSION='0.0.1';LPimage.url='';var $=root.jQuery||root.Zepto;LPimage.initialize=function(src_path,width,height,opts){opts=opts||{};var defaultBaseURL='http://cidi.liquifire.com/';var baseURL=(typeof(LP_SRC_HOSTNAMES)!='undefined')?LP_SRC_HOSTNAMES:[defaultBaseURL];var source_hostname=(typeof(LP_S3_HOSTNAME)!='undefined')?LP_S3_HOSTNAME:'http://1.images-testing.ideeli.com/';var source_path=src_path||'attachments/1733169/1_grid_imagegrid_image240x340.jpg';var basePath='cidi.jpg?source=url['+source_hostname+source_path+'],name[img]';var color=opts.color||'white';var blank='&blank=width['+width+'],height['+height+'],color['+color+'],name[bg]';var resize='&resize=size['+width+'x'+height+'],filter[Lanczos]';var composite=(opts.composite||'compose[Over],image[img],gravity[Center]');composite='&composite='+composite;var sink='&sink';if(width<505){sink+='=quality[88]';}
var useDirectLF=document.location.href.match("use_direct_lf=1");var imageIdMatch=source_path.match(/attachments\/(\d+)\//);var imageId=(imageIdMatch&&(imageIdMatch.length===2))?parseInt(imageIdMatch[1]):1;this.source_uri=source_hostname+source_path;var moded_image_id=String(imageId);moded_image_id=moded_image_id.substr(0,moded_image_id.length-1);this.base_url=useDirectLF?defaultBaseURL:baseURL[Number(moded_image_id)%baseURL.length];this.base_uri=this.base_url+basePath;this.parameters=resize+sink;this.width=width;this.height=height;this.url=this.base_uri+resize+sink+"&mod=73";if(!USE_LP_IMAGES){this.url=this.source_uri;}
return this;};LPimage.toURL=function(){if(this.url.length>0){return this.url;}
else if(this.url.length===0&&arguments.length===4){this.initialize(arguments[0],arguments[1],arguments[2],arguments[3]);return this.url;}
else{throw"No LPimage initialized, and less than 4 arguments passed";}};LPimage.toElement=function(){if(this.url.length>0){var element=document.createElement('IMG');element.src=this.url;element.width=this.width;element.height=this.height;return element;}
else if(this.url.length===0&&arguments.length===4){this.initialize(arguments[0],arguments[1],arguments[2],arguments[3]);return this.toElement();}
else{throw"No LPimage initialized, and less than 4 arguments passed";}};}).call(this);if(typeof(ideeli)=='undefined'){ideeli=new Object();}
if(typeof(ideeli.zipcode_collector)=='undefined'){ideeli.zipcode_collector=new Object();}
ideeli.zipcode_collector=function(){return{hideButtonSubmit:function(){ideeli.zipcode_collector.zipcodeCollectorHide();var req=new Ajax.Request('/my_account/toggle_zipcode_collector',{parameters:{dismiss:1},method:'POST'});},init:function(){if(window.current_user&&!window.current_user.login.blank()&&!window.current_user.has_tz&&$('zipcode_collector_container')){ideeli.zipcode_collector.boundSendZipcode=ideeli.zipcode_collector.sendZipcode.bindAsEventListener(ideeli.zipcode_collector);ideeli.zipcode_collector.boundSetInputDefault=ideeli.zipcode_collector.setInputDefault.bindAsEventListener(ideeli.zipcode_collector);ideeli.zipcode_collector.boundSetInputClear=ideeli.zipcode_collector.setInputClear.bindAsEventListener(ideeli.zipcode_collector);ideeli.zipcode_collector.boundHideButtonSubmit=ideeli.zipcode_collector.hideButtonSubmit.bindAsEventListener(ideeli.zipcode_collector);ideeli.zipcode_collector.setInputDefault();$$('.zipcode_collector_input').each(function(el){ideeli.zipcode_collector.initLimiter(el);});$('zipcode_collector_input').observe('focus',ideeli.zipcode_collector.boundSetInputClear);$('zipcode_collector_input').observe('blur',ideeli.zipcode_collector.boundSetInputDefault);$('go_local_button').observe('click',ideeli.zipcode_collector.boundSendZipcode);$('zipcode_collector_hide_button').observe('click',ideeli.zipcode_collector.boundHideButtonSubmit);if(window.current_user.hide_zcc){ideeli.zipcode_collector.zipcodeCollectorHide();}
else{ideeli.zipcode_collector.zipcodeCollectorShow();}}},initLimiter:function(el){if(el){ideeli.zipcode_collector.navKeys=[8,9,35,36,37,38,39,40];ideeli.zipcode_collector.validKeys=[8,9,35,36,37,38,39,40,45,46,47,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105];el.observe('keydown',ideeli.zipcode_collector.limitChars.bindAsEventListener(ideeli.zipcode_collector,el));}},limitChars:function(ev,el){var key=(document.all)?ev.keyCode:ev.which;if(ideeli.zipcode_collector.validKeys.indexOf(key)<0||ev.altKey||ev.ctrlKey||ev.shiftKey){ev.stop();}
if($(el).getValue().length>=5&&ideeli.zipcode_collector.navKeys.indexOf(key)<0&&(getInputSelectionLength($(el))==0)){ev.stop();}},resetInputToDefault:function(){$('zipcode_collector_input').setValue($('zipcode_collector_input').readAttribute('data-default')).setStyle({'color':'#ccc','border':'1px solid #999999'});},sendZipcode:function(){var req=new Ajax.Request('/my_account/set_zipcode',{parameters:{zipcode:$F('zipcode_collector_input')},onLoading:function(){ideeli.zipcode_collector.submitButtonHide();},onLoaded:function(){ideeli.zipcode_collector.submitButtonShow();}});},setInputDefault:function(){if($('zipcode_collector_input').getValue().blank()){ideeli.zipcode_collector.resetInputToDefault();}},setInputClear:function(){if($('zipcode_collector_input').getValue()==$('zipcode_collector_input').readAttribute('data-default')){$('zipcode_collector_input').setValue('').setStyle({'color':'#333','border':'1px solid #999999'});}},submitButtonHide:function(){$('go_local_button').hide();$('go_local_button_disabled').show();$('go_local_button_loading').show();},submitButtonShow:function(){$('go_local_button_disabled').hide();$('go_local_button_loading').hide();$('go_local_button').show();},submitError:function(){$('zipcode_collector_error_container').show();$('zipcode_collector_container').setStyle({'height':'108px'});$$('.zipcode_collector_input').invoke('setStyle',{'border':'1px solid #c33'});},submitSuccess:function(){ideeli.zipcode_collector.zipcodeCollectorThanks();},zipcodeContentSlideDown:function(){if(!$('zipcode_collector_container').visible()){Effect.SlideDown($('zipcode_collector_container'),{'duration':0.5});}},zipcodeContentSlideUp:function(){if($('zipcode_collector_container').visible()){Effect.SlideUp($('zipcode_collector_container'),{'duration':0.5});}},zipcodeCollectorHide:function(){$('zipcode_collector_error_container').hide();ideeli.zipcode_collector.resetInputToDefault();ideeli.zipcode_collector.zipcodeContentSlideUp();Cookie.set('slide_zcc',0);$('welcome_show_zipcode_collector').show();},zipcodeCollectorShow:function(immediately){$('welcome_show_zipcode_collector').hide();$('zipcode_collector_error_container').hide();$('zipcode_collector_container').setStyle({'height':'74px'});$('zipcode_collector_thanks_container').hide();$('zipcode_collector_content_container').show();if(Cookie.get('slide_zcc')!=1){Cookie.set('slide_zcc',1);if(immediately){ideeli.zipcode_collector.zipcodeContentSlideDown();}
else{setTimeout("ideeli.zipcode_collector.zipcodeContentSlideDown()",1000);}}
else{$('zipcode_collector_container').show();}},zipcodeCollectorShowImmediately:function(){ideeli.zipcode_collector.zipcodeCollectorShow(true);},zipcodeCollectorThanks:function(){$('zipcode_collector_error_container').hide();$('zipcode_collector_container').setStyle({'height':'74px'});$('zipcode_collector_content_container').hide();$('zipcode_collector_thanks_container').show();setTimeout("ideeli.zipcode_collector.zipcodeContentSlideUp()",2000);}}}();if(typeof(ideeli)==='undefined'){ideeli={};}
if(typeof(ideeli.adometry)==='undefined'){ideeli.adometry={};}
ideeli.adometry=(function(){var src_url="http://log.dmtry.com/redir/1/0/2118/65331/0/1/1.ver?actionType=u&uid=";return{writeMacro:function(){if(ideeli.adometry.currentUserExists()){jQuery('#container').after(ideeli.adometry.prepareMacro());}},currentUserExists:function(){return window.current_user&&typeof(window.current_user.adometry_macro)!=='undefined'?true:false;},prepareMacro:function(){return jQuery('<img />',{width:'1',height:'1',src:ideeli.adometry.prepareMacroSrc()});},prepareMacroSrc:function(){if(!ideeli.adometry.currentUserExists()){return'';}
return src_url+window.current_user.adometry_macro;}};}());jQuery(function(){if(typeof(ideeli)!=='undefined'&&typeof(ideeli.masthead)!=='undefined'){ideeli.masthead.showUserCallbacks.push(ideeli.adometry.writeMacro);}});if(typeof(ideeli)=='undefined'){ideeli=new Object();}
if(typeof(ideeli.AddressBook)=='undefined'){ideeli.AddressBook=new Object();}
ideeli.AddressBook=function(){return{initMakePrimaryCheckbox:function(){jQuery("#shipping_address_preferred_checkbox").click(function(){if(jQuery("#shipping_address_preferred_checkbox").is(':checked')){jQuery("#shipping_address_preferred").val(1);}else{jQuery("#shipping_address_preferred").val(0);}});},init_from_confirm_reservation:function(){ideeli.AddressBook.initMakePrimaryCheckbox();jQuery("#address_book_modal").attr("title","");jQuery("#shipping_address_preferred_checkbox").attr("checked","checked");jQuery("#shipping_address_preferred").val(1);jQuery(".ship_to_this_address_button").live('click',function(){ideeli.ShippingAddress.shipToThisAddress(jQuery(this).attr("data_id"));});jQuery("#save_shipping_address").click(function(){ideeli.ShippingAddress.createShippingAddress();});jQuery(".cancel_add_shipping_address").click(function(){ideeli.AddressBook.cancelAddNewShippingAddress();jQuery("#shipping_address_preferred_checkbox").attr("checked","checked");jQuery("#shipping_address_preferred").val(1);});jQuery("#add_new_shipping_address_button").click(function(){ideeli.AddressBook.showAddNewShippingAddressForm();jQuery("#save_shipping_address").show();jQuery("#edit_shipping_address").hide();jQuery("#edit_modal_shipping_address").hide();jQuery("#make_primary_check_box").show();if(jQuery("#shipping_address_error_header").length<=0){jQuery("#shipping_address_preferred_checkbox").attr("checked","checked");jQuery("#shipping_address_preferred").val(1);}});jQuery("#edit_modal_shipping_address").live('click',function(){jQuery("#shipping_address_errors_container").hide();ideeli.AddressBook.editShippingAddress(jQuery(this).attr("data_id"),true);});jQuery(".edit_shipping_address").live('click',function(){ideeli.AddressBook.getShippingAddressInfo(jQuery(this).attr("data_id"));jQuery("#save_shipping_address").hide();jQuery("#edit_modal_shipping_address").show();jQuery("#edit_shipping_address").hide();jQuery("#make_primary_check_box").show();});jQuery("#save_shipping_address").removeClass("save_address").addClass("ship_to_this_address_button_big");jQuery("#add_new_shipping_address_title").hide();if(window.location.href.indexOf("prepare_update")>=0){jQuery("#address_book_modal .ideeli_form_timer").hide();}},init:function(){ideeli.AddressBook.initMakePrimaryCheckbox();jQuery(".make_primary_address_button").live('click',function(){ideeli.ShippingAddress.makePrimary(jQuery(this).attr("data_id"));});jQuery("#add_new_shipping_address_button").click(function(){if(jQuery("#flash_messages_container").length>0){jQuery("#flash_messages_container").remove();}
ideeli.AddressBook.showAddNewShippingAddressForm();jQuery("#save_shipping_address").show();jQuery("#edit_shipping_address").hide();jQuery("#edit_modal_shipping_address").hide();jQuery("#make_primary_check_box").show();if(jQuery("#shipping_address_error_header").length<=0){jQuery("#shipping_address_preferred_checkbox").attr("checked","checked");jQuery("#shipping_address_preferred").val(1);}
jQuery("#add_new_shipping_address_title").html("Add Shipping Address");if(jQuery("#flashboard").length>0){jQuery("#flashboard").remove();}});jQuery(".cancel_add_shipping_address").click(function(){ideeli.AddressBook.cancelAddNewShippingAddress();jQuery("#shipping_address_preferred_checkbox").attr("checked","checked");jQuery("#shipping_address_preferred").val(1);});jQuery(".edit_shipping_address").live('click',function(){ideeli.AddressBook.getShippingAddressInfo(jQuery(this).attr("data_id"));jQuery("#save_shipping_address").hide();jQuery("#edit_shipping_address").show();jQuery("#edit_modal_shipping_address").hide();jQuery("#make_primary_check_box").show();if(jQuery("#flash_messages_container").length>0){jQuery("#flash_messages_container").remove();}
if(jQuery("#flashboard").length>0){jQuery("#flashboard").remove();}});jQuery("#edit_shipping_address").live('click',function(){ideeli.AddressBook.editShippingAddress(jQuery(this).attr("data_id"),false);});jQuery(".remove_shipping_address").live('click',function(){ideeli.AddressBook.removeShippingAddress(jQuery(this).attr("data_id"));});if(jQuery("#shipping_address_error_header").length>0){jQuery("#add_new_shipping_address_button").trigger('click');}},getShippingAddressInfo:function(address_id){jQuery.post("/my_account/get_shipping_address",{address_id:address_id},function(data){if(data.success){ideeli.AddressBook.showAddNewShippingAddressForm();jQuery("#shipping_address_first_name").val(data.shipping_address.first_name);jQuery("#shipping_address_last_name").val(data.shipping_address.last_name);jQuery("#shipping_address_address1").val(data.shipping_address.address1);jQuery("#shipping_address_address2").val(data.shipping_address.address2);jQuery("#shipping_address_city").val(data.shipping_address.city);jQuery("#shipping_address_state").val(data.shipping_address.state);jQuery("#shipping_address_zip").val(data.shipping_address.zip);jQuery("#shipping_address_telephone").val(data.shipping_address.telephone);if(jQuery("#my_shipping_address_or_add_shipping_address_title").length>0){jQuery("#my_shipping_address_or_add_shipping_address_title").removeClass("address_book_sprite_my_shipping_addresses_title").removeClass("address_book_sprite_add_shipping_address_title").addClass("address_book_sprite_edit_shipping_address_title");}else{jQuery("#add_new_shipping_address_title").html("Edit Shipping Address")}
if(data.shipping_address.preferred){jQuery("#make_primary_check_box").hide();}else{jQuery("#make_primary_check_box").show();jQuery("#shipping_address_preferred_checkbox").removeAttr("checked");jQuery("#shipping_address_preferred").val(0);}}},"json");jQuery("#edit_shipping_address").attr("data_id",address_id);jQuery("#edit_modal_shipping_address").attr("data_id",address_id);},editShippingAddress:function(address_id,from_confirm_reservation_or_prepare_update){var shipping_address={};shipping_address['first_name']=jQuery("#shipping_address_first_name").val();shipping_address['last_name']=jQuery("#shipping_address_last_name").val();shipping_address['address1']=jQuery("#shipping_address_address1").val();shipping_address['address2']=jQuery("#shipping_address_address2").val();shipping_address['city']=jQuery("#shipping_address_city").val();shipping_address['state']=jQuery("#shipping_address_state").val();shipping_address['zip']=jQuery("#shipping_address_zip").val();shipping_address['telephone']=jQuery("#shipping_address_telephone").val();shipping_address['preferred']=jQuery("#shipping_address_preferred").val();jQuery.post("/my_account/update_shipping_address",{'shipping_address':shipping_address,'from_confirm_reservation_or_prepare_update':from_confirm_reservation_or_prepare_update,'shipping_address_id':address_id},function(data){if(data.success){if(data.from_confirm_reservation_or_prepare_update==="true"){ideeli.AddressBook.insertEditedAddress(address_id,data.address_id);ideeli.ShippingAddress.shipToThisAddress(data.address_id);ideeli.AddressBook.AddressBookModal.close();}else{jQuery("#flash_messages_container").remove();jQuery("#my_account_container").prepend("<div id='flashboard'><div id='notice_div_id' style=''>Your details have been updated. No orders have been affected by this update.</div><script type='text/javascript'>Flash.transferFromCookies();Flash.writeDataTo('error', $('error_div_id'));Flash.writeDataTo('notice', $('notice_div_id'));$('notice_div_id').observe('click', function(){$('notice_div_id').hide();});</script></div>");ideeli.AddressBook.insertEditedAddress(address_id,data.address_id);ideeli.AddressBook.cancelAddNewShippingAddress();}}else{if(data.from_confirm_reservation_or_prepare_update==="true"){ideeli.ShippingAddress.showModalErrors(data.shipping_address_errors);}else{ideeli.ShippingAddress.showMyAccountEditErrors(data.shipping_address_errors);}}});},removeShippingAddress:function(address_id){jQuery.post("/my_account/hide_shipping_address",{address_id:address_id},function(data){if(data.success){jQuery(".address_book_shipping_address_"+address_id).remove();}},"json");},insertEditedAddress:function(old_address_id,new_address_id){if(jQuery("#shipping_address_preferred_checkbox").attr('checked')&&jQuery("#shipping_address_preferred_checkbox").is(":visible")){jQuery(".shipping_address_id_"+old_address_id).remove();jQuery(".address_book_primary_shipping_address").clone().removeClass("address_book_primary_shipping_address").addClass("address_book_shipping_address").prependTo("#other_shipping_addresses_container");jQuery(".address_book_primary_shipping_address").removeClass().addClass("address_book_primary_shipping_address shipping_address_id_"+new_address_id);jQuery(".address_book_primary_shipping_address .address_name").html(jQuery("#shipping_address_first_name").val()+" "+jQuery("#shipping_address_last_name").val()).attr('class','address_name address_name_'+new_address_id);jQuery(".address_book_primary_shipping_address .address_line1").html(jQuery("#shipping_address_address1").val()).attr('class','address_line1 address_line1_'+new_address_id);jQuery(".address_book_primary_shipping_address .address_line2").html(jQuery("#shipping_address_address2").val()).attr('class','address_line2 address_line2_'+new_address_id);jQuery(".address_book_primary_shipping_address .city_state_zip").html(jQuery("#shipping_address_city").val()+", "+jQuery("#shipping_address_state").val()+" "+jQuery("#shipping_address_zip").val()).attr('class','city_state_zip city_state_zip_'+new_address_id);jQuery(".address_book_primary_shipping_address .phone_number").html(jQuery("#shipping_address_telephone").val()).attr('class','phone_number phone_number_'+new_address_id);jQuery(".address_book_primary_shipping_address .ship_to_this_address_button").attr('data_id',new_address_id);jQuery(".address_book_primary_shipping_address .edit_shipping_address").attr('data_id',new_address_id);if(window.location.href.indexOf("my_account")>=0){var moved_shipping_id=jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .edit_cancel_container .edit_shipping_address").attr("data_id");jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child").removeClass().addClass("address_book_shipping_address shipping_address_id_"+moved_shipping_id+" address_book_shipping_address_"+moved_shipping_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .edit_cancel_container").append("or <span class='remove_shipping_address' data_id='"+moved_shipping_id+"'>Remove</span>");jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child").append("<div><img alt='Make_primary_address_default' class='action_button active_action_button make_primary_address_button' data_id='"+moved_shipping_id+"' src='http://0.cdn.ideeli.net/images/Address_Book_Assets/make_primary_address_default.png'></div>");jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child img").attr("onmouseover","this.src='http://0.cdn.ideeli.net/images/Address_Book_Assets/make_primary_address_hover.png'");jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child img").attr("onmouseout","this.src='http://0.cdn.ideeli.net/images/Address_Book_Assets/make_primary_address_default.png'");}}else{jQuery(".shipping_address_id_"+old_address_id+" .address_name").html(jQuery("#shipping_address_first_name").val()+" "+jQuery("#shipping_address_last_name").val()).attr('class','address_name address_name_'+new_address_id);jQuery(".shipping_address_id_"+old_address_id+" .address_line1").html(jQuery("#shipping_address_address1").val()).attr('class','address_line1 address_line1_'+new_address_id);jQuery(".shipping_address_id_"+old_address_id+" .address_line2").html(jQuery("#shipping_address_address2").val()).attr('class','address_line2 address_line2_'+new_address_id);jQuery(".shipping_address_id_"+old_address_id+" .city_state_zip").html(jQuery("#shipping_address_city").val()+", "+jQuery("#shipping_address_state").val()+" "+jQuery("#shipping_address_zip").val()).attr('class','city_state_zip city_state_zip_'+new_address_id);jQuery(".shipping_address_id_"+old_address_id+" .phone_number").html(jQuery("#shipping_address_telephone").val()).attr('class','phone_number phone_number_'+new_address_id);jQuery(".shipping_address_id_"+old_address_id+" .ship_to_this_address_button").attr('data_id',new_address_id);jQuery(".shipping_address_id_"+old_address_id+" .edit_shipping_address").attr('data_id',new_address_id);jQuery(".shipping_address_id_"+old_address_id).removeClass("shipping_address_id_"+old_address_id).addClass("shipping_address_id_"+new_address_id);if(window.location.href.indexOf("my_account")>=0){jQuery(".shipping_address_id_"+old_address_id+" .remove_shipping_address").attr('data_id',new_address_id);jQuery(".shipping_address_id_"+old_address_id+" img").attr('data_id',new_address_id);}}},insertNewAddress:function(address_id){jQuery(".address_book_primary_shipping_address").clone().removeClass("address_book_primary_shipping_address").addClass("address_book_shipping_address").prependTo("#other_shipping_addresses_container");if(jQuery("#shipping_address_preferred_checkbox").attr('checked')){jQuery(".address_book_primary_shipping_address .address_name").html(jQuery("#shipping_address_first_name").val()+" "+jQuery("#shipping_address_last_name").val()).attr('class','address_name address_name_'+address_id);jQuery(".address_book_primary_shipping_address .address_line1").html(jQuery("#shipping_address_address1").val()).attr('class','address_line1 address_line1_'+address_id);jQuery(".address_book_primary_shipping_address .address_line2").html(jQuery("#shipping_address_address2").val()).attr('class','address_line2 address_line2_'+address_id);jQuery(".address_book_primary_shipping_address .city_state_zip").html(jQuery("#shipping_address_city").val()+", "+jQuery("#shipping_address_state").val()+" "+jQuery("#shipping_address_zip").val()).attr('class','city_state_zip city_state_zip_'+address_id);jQuery(".address_book_primary_shipping_address .phone_number").html(jQuery("#shipping_address_telephone").val()).attr('class','phone_number phone_number_'+address_id);jQuery(".address_book_primary_shipping_address .edit_shipping_address").attr('data_id',+address_id);jQuery(".address_book_primary_shipping_address .ship_to_this_address_button").attr('data_id',address_id);jQuery(".address_book_primary_shipping_address").removeClass().addClass("address_book_primary_shipping_address shipping_address_id_"+address_id);}else{jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .address_name").html(jQuery("#shipping_address_first_name").val()+" "+jQuery("#shipping_address_last_name").val()).attr('class','address_name address_name_'+address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .address_line1").html(jQuery("#shipping_address_address1").val()).attr('class','address_line1 address_line1_'+address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .address_line2").html(jQuery("#shipping_address_address2").val()).attr('class','address_line2 address_line2_'+address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .city_state_zip").html(jQuery("#shipping_address_city").val()+", "+jQuery("#shipping_address_state").val()+" "+jQuery("#shipping_address_zip").val()).attr('class','city_state_zip city_state_zip_'+address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .phone_number").html(jQuery("#shipping_address_telephone").val()).attr('class','phone_number phone_number_'+address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .ship_to_this_address_button").attr('data_id',address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child").removeClass().addClass("address_book_shipping_address shipping_address_id_"+address_id);jQuery("#other_shipping_addresses_container .address_book_shipping_address:first-child .edit_shipping_address").attr('data_id',+address_id);}},reset:function(){jQuery("#my_shipping_addresses_container").show();jQuery("#addresses").hide();jQuery("#address_book_modal_body").show();jQuery(".ideeli_form_small_heading").show();jQuery("#my_shipping_address_or_add_shipping_address_title").removeClass("address_book_sprite_edit_shipping_address_title").removeClass("address_book_sprite_add_shipping_address_title").addClass("address_book_sprite_my_shipping_addresses_title");jQuery("#shipping_address_error_body").html("");jQuery("#shipping_address_errors_container").hide();jQuery("#address_book_modal").css("height","670px");jQuery(".ideelifield").each(function(){jQuery(this).attr("value"," ");if(jQuery(this).hasClass("generic_errors_field")){jQuery(this).removeClass("generic_errors_field");}});if(jQuery(".ideeliselect").hasClass("generic_errors_field")){jQuery(".ideeliselect").removeClass("generic_errors_field");}
jQuery(".ideeliselect").val(jQuery('options:first',jQuery(".ideeliselect")).val());},showAddressBookModal:function(){ideeli.AddressBook.AddressBookModal=new Control.Modal($('address_book_modal'),{className:'address_book_popup_modal_frame',closeOnClick:'overlay',constrainToViewport:true,beforeClose:function(){if(jQuery(".prototip").length>0){jQuery(".prototip").hide();}},beforeOpen:ideeli.AddressBook.reset(),fade:false,overlayOpacity:0.5,parameters:{},offsetTop:0,width:747,height:670,position:[parseInt((document.viewport.getWidth()-740)/2),0]});ideeli.AddressBook.AddressBookModal.open();},showAddNewShippingAddressForm:function(){ideeli.ShippingAddress.clearFields();jQuery("#my_shipping_addresses_container").hide();jQuery("#addresses").show();jQuery("#address_book_modal_body").hide();jQuery(".ideeli_form_small_heading").hide();jQuery("#my_shipping_address_or_add_shipping_address_title").addClass("address_book_sprite_add_shipping_address_title").removeClass("address_book_sprite_edit_shipping_address_title").removeClass("address_book_sprite_my_shipping_addresses_title");},cancelAddNewShippingAddress:function(){ideeli.AddressBook.reset();},showAddresses:function(){jQuery.get('/my_account/make_shipping_address_primary',function(data){});}}}();if(typeof(ideeli.ShippingAddress)=='undefined'){ideeli.ShippingAddress=new Object();}
ideeli.ShippingAddress=function(){return{createShippingAddress:function(){var shipping_address={};shipping_address['first_name']=jQuery("#shipping_address_first_name").val();shipping_address['last_name']=jQuery("#shipping_address_last_name").val();shipping_address['address1']=jQuery("#shipping_address_address1").val();shipping_address['address2']=jQuery("#shipping_address_address2").val();shipping_address['city']=jQuery("#shipping_address_city").val();shipping_address['state']=jQuery("#shipping_address_state").val();shipping_address['zip']=jQuery("#shipping_address_zip").val();shipping_address['telephone']=jQuery("#shipping_address_telephone").val();shipping_address['preferred']=jQuery("#shipping_address_preferred").val();jQuery.post("/my_account/create_shipping_address",{'shipping_address':shipping_address,from_confirm_reservation:1},function(data){if(data.success){ideeli.AddressBook.insertNewAddress(data.address_id);ideeli.ShippingAddress.shipToThisAddress(data.address_id);ideeli.AddressBook.AddressBookModal.close();}else{ideeli.ShippingAddress.showModalErrors(data.shipping_address_errors);}},"json");},showMyAccountEditErrors:function(shipping_address_errors){var errors=ideeli.ShippingAddress.collectErrors(shipping_address_errors);ideeli.ShippingAddress.showErrorFields();jQuery(".ideeliform").prepend('<div id="shipping_address_errors_container" class="generic_errors_container">'
+'<div class="error_header">Please correct the errors marked below</div>'
+'<div class="error_body">'
+'</div>'
+'</div>');jQuery(".error_body").html(errors);},collectErrors:function(shipping_address_errors){var errors="";for(var i=0;i<shipping_address_errors.length;i++){errors+=". "+shipping_address_errors[i][1]+"<br />";}
return errors;},showErrorFields:function(){if(jQuery(".ideeliselect").val()==""){jQuery(".ideeliselect").addClass("generic_errors_field");}else{jQuery(".ideeliselect").removeClass("generic_errors_field");}
jQuery(".ideelifield").each(function(){if(jQuery(this).val().trim().length<=0&&jQuery(this).attr("id")!="shipping_address_address2"){jQuery(this).addClass("generic_errors_field");}else{jQuery(this).removeClass("generic_errors_field");}});},showModalErrors:function(shipping_address_errors){var errors=ideeli.ShippingAddress.collectErrors(shipping_address_errors);ideeli.ShippingAddress.showErrorFields();jQuery("#shipping_address_errors_container").show();jQuery("#shipping_address_error_body").html(errors);jQuery("#address_book_modal").css("height","710px");},clearFields:function(){if(jQuery("#shipping_address_error_header").length<1){jQuery(".ideelifield").each(function(){jQuery(this).attr("value"," ");if(jQuery(this).hasClass("generic_errors_field")){jQuery(this).removeClass("generic_errors_field");}});if(jQuery(".ideeliselect").hasClass("generic_errors_field")){jQuery(".ideeliselect").removeClass("generic_errors_field");}
jQuery(".ideeliselect").val(jQuery('options:first',jQuery(".ideeliselect")).val());}},makePrimary:function(id){jQuery.post("/my_account/make_shipping_address_primary",{shipping_address_id:id},function(data){if(data.success){window.location.reload();}});},shipToThisAddress:function(address_id){var change_order_shipping_address_path="/orders/change_order_shipping_address";if(window.location.href.indexOf("confirm_reservation_address")>0){change_order_shipping_address_path="/store/change_order_shipping_address";}
jQuery.post(change_order_shipping_address_path,{address_id:address_id,id:jQuery("#order_id").val()},function(data){window.location.reload();});}}}();if(typeof(ideeli)=='undefined'){var ideeli={};}
if(typeof(ideeli.labs)=='undefined'){ideeli.labs={};}
if(typeof(ideeli.labs.experiments)=='undefined'){ideeli.labs.experiments={};}
if(typeof(ideeli.labs.experiments.red_gray_button)=='undefined'){ideeli.labs.experiments.red_gray_button={};}
ideeli.labs.experiments.red_gray_button.get_variant_callback=function(variant){if(variant==='control')
return;var div='.checkout_'+variant+'_button';if(window.current_user.cart_items_count>0)
jQuery(div).show();else{jQuery(div).hide();}}
ideeli.labs.experiments.red_gray_button.useVariant=(function(){var assignedVariant=null;var getVariantInProgress=false;return function(){if(assignedVariant==null){if(!getVariantInProgress){getVariantInProgress=true;ideeli.labs.getVariant('red_gray_checkout',function(variant){assignedVariant=variant;ideeli.labs.experiments.red_gray_button.get_variant_callback(assignedVariant);getVariantInProgress=false;});}}
else{ideeli.labs.experiments.red_gray_button.get_variant_callback(assignedVariant);}};}());ideeli.labs.experiments.red_gray_button.init=function(){var f=function(){new Ajax.Request('/store/confirm_reservation_all_day_shipping_check',{parameters:{'from_red_gray_button':'1'},asynchronous:true,evalScripts:true,method:'post',onComplete:function(request){},onLoading:function(request){}});return false;};jQuery('.checkout_red_button').click(f);jQuery('.checkout_gray_button').click(f);ideeli.labs.experiments.red_gray_button.useVariant();}
ideeli.labs.experiments.red_gray_button.red_gray_button_modal=undefined;ideeli.labs.experiments.red_gray_button.append_to_order_modal_show=function(){ideeli.labs.experiments.red_gray_button.red_gray_button_modal=new Control.Modal($('red_gray_button_modal'),{className:'red_gray_button_popup_modal_frame',closeOnClick:'overlay',constrainToViewport:true,fade:false,offset:{x:0,y:2},overlayOpacity:0.5,parameters:{},width:547,beforeOpen:function(){jQuery("#control_overlay").css("background-color","#B3B3B3");},afterClose:function(){ideeli.labs.experiments.red_gray_button.red_gray_button_modal.close();jQuery("#control_overlay").css("background-color","#CCCCCC");if($('append_to_order_modal')){jQuery("#append_to_order_modal").remove();}
if($('ads_thanks_modal')){jQuery("#ads_thanks_modal").remove();}}});ideeli.labs.experiments.red_gray_button.red_gray_button_modal.open();}
ideeli.grid_cookie=(function(){var _cookie;var _info;var _eventId;var _urlHash;function _getCookie(){if(typeof(_cookie)==='undefined'){_cookie=(Cookie.exists('GridInfo')?Cookie.get('GridInfo'):'{"eventId":0, "urlHash": ""}');}
_info=_cookie.evalJSON();_eventId=_info.eventId;_urlHash=_info.urlHash;}
function _getEventId(){if(typeof(_eventId)==='undefined'){_getCookie();}
return _eventId;}
function _getUrlHash(){if(typeof(_urlHash)==='undefined'){_getCookie();}
return _urlHash;}
function setInfo(eventId,urlHash){var info={eventId:eventId,urlHash:urlHash};var jsonInfo=Object.toJSON(info);Cookie.set('GridInfo',jsonInfo);}
function returnToSaleUrl(url,eventId){if(ideeli.joinFlow.noLoggedUser()){ideeli.joinFlow.showJoinFlowModal();}else{if(_getEventId().toString()==eventId.toString()){url+=_getUrlHash();}
window.location=url;}}
var _instance={setInfo:setInfo,returnToSaleUrl:returnToSaleUrl}
return _instance;}());if(typeof(ideeli)=='undefined'){var ideeli={};}
if(typeof(ideeli.labs)=='undefined'){ideeli.labs={};}
ideeli.labs.EV_DATA_URL='/labs/variants_for_user';ideeli.labs.EV_EXPOSURE_URL='/labs/record_exposure';ideeli.labs.DATA_STORE_KEY='ideeli.labs.ev_data';ideeli.labs.CURRENT_USER_KEY='current_user';ideeli.labs.TIMEOUT_SECS_KEY='timeout_secs';ideeli.labs.EXPIRES_AT_MS_KEY='expires_at_ms';ideeli.labs.EV_DATA_POLL_MSECS=60000;ideeli.labs.COMPRESSED_CONTROL_VARIANT="_";ideeli.labs.CONTROL_VARIANT="control";ideeli.labs.NA_VARIANT="na";ideeli.labs.refresh_timeout_id=null;ideeli.labs.user_data_loaded=false;ideeli.labs.queued_get_variant_calls=[];ideeli.labs.debug=false;ideeli.labs.debug_variants={};ideeli.labs.currentUser=function(){var user=window.current_user;return(user==null)?null:user.login;}
ideeli.labs.isUserLoggedIn=function(){return ideeli.labs.currentUser()!=null;}
ideeli.labs.evRefreshNeeded=function(){if(ideeli.labs.debug)
console.log("ideeli.labs.evRefreshNeeded");var data=ideeli.labs.evData();if(!ideeli.labs.isUserLoggedIn()){if(data!=null)
ideeli.labs.eraseEvData();if(ideeli.labs.debug)
console.log("ideeli.labs.evRefreshNeeded: user not logged in");return false;}
if(data==null){if(ideeli.labs.debug)
console.log("ideeli.labs.evRefreshNeeded: data == null");return true;}
if(data[ideeli.labs.CURRENT_USER_KEY]!=ideeli.labs.currentUser()){if(ideeli.labs.debug)
console.log("ideeli.labs.evRefreshNeeded: user has changed");ideeli.labs.eraseEvData();return true;}
var expired=new Date().getTime()>=data[ideeli.labs.EXPIRES_AT_MS_KEY];if(ideeli.labs.debug)
console.log("ideeli.labs.evRefreshNeeded: expired = "+expired);return expired;}
ideeli.labs.refreshEvData=function(callback){if(ideeli.labs.debug)
console.log("ideeli.labs.refreshEvData, callback = "+callback);if(ideeli.labs.refresh_timeout_id!=null){clearTimeout(ideeli.labs.refresh_timeout_id);ideeli.labs.refresh_timeout_id=null;}
if(ideeli.labs.evRefreshNeeded()){if(ideeli.labs.debug)
console.log("ideeli.labs.refreshEvData requesting data from "+ideeli.labs.EV_DATA_URL);if(typeof(callback)=='undefined'||callback==null)
callback=function(){};RequestProxy.getJSON(ideeli.labs.EV_DATA_URL,{},function(data){data[ideeli.labs.CURRENT_USER_KEY]=ideeli.labs.currentUser();data[ideeli.labs.EXPIRES_AT_MS_KEY]=new Date().getTime()+data[ideeli.labs.TIMEOUT_SECS_KEY]*1000;amplify.store(ideeli.labs.DATA_STORE_KEY,data);},callback,this);}
else if(ideeli.labs.debug)
console.log("ideeli.labs.refreshEvData: refresh not needed");ideeli.labs.refresh_timeout_id=setTimeout("ideeli.labs.refreshEvData(null)",ideeli.labs.EV_DATA_POLL_MSECS);}
ideeli.labs.eraseEvData=function(){if(ideeli.labs.debug)
console.log("ideeli.labs.eraseEvData");amplify.store(ideeli.labs.DATA_STORE_KEY,null);}
ideeli.labs.evData=function(){return amplify.store(ideeli.labs.DATA_STORE_KEY);}
ideeli.labs.getVariant=function(experiment_symbol,callback,check_refresh){if(ideeli.labs.debug)
console.log("ideeli.labs.getVariant('"+experiment_symbol+"', "+callback+", "+check_refresh+")");if(!ideeli.labs.user_data_loaded){if(ideeli.labs.debug)
console.log("labs: user data not yet loaded; pushing getVariant call onto queued_get_variant_calls");ideeli.labs.queued_get_variant_calls.push(function(){ideeli.labs.getVariant(experiment_symbol,callback,check_refresh);});return;}
var variant=ideeli.labs.debug_variants['*']||ideeli.labs.debug_variants[experiment_symbol];if(variant){if(ideeli.labs.debug)
console.log("ideeli.labs.getVariant using debug_variants value "+variant);callback(variant);return;}
if(!ideeli.labs.isUserLoggedIn()){if(ideeli.labs.debug)
console.log("labs user not logged in; returning control");callback(ideeli.labs.CONTROL_VARIANT);}
if(typeof(check_refresh)=='undefined')
var check_refresh=true;if(check_refresh&&ideeli.labs.evRefreshNeeded()){if(ideeli.labs.debug)
console.log("labs: refresh needed, calling refresh with getVariant callback");ideeli.labs.refreshEvData(function(){ideeli.labs.getVariant(experiment_symbol,callback,false);});return;}
variant=ideeli.labs.CONTROL_VARIANT;try{var data=ideeli.labs.evData();if(data!=null){variant=data["experiments"][experiment_symbol];if(variant==null)
variant=ideeli.labs.COMPRESSED_CONTROL_VARIANT;}
if(variant!=ideeli.labs.NA_VARIANT)
ideeli.labs.recordExposure(experiment_symbol,variant);if(variant==ideeli.labs.COMPRESSED_CONTROL_VARIANT||variant==ideeli.labs.NA_VARIANT)
variant=ideeli.labs.CONTROL_VARIANT;}
catch(err){if(ideeli.labs.debug)
console.log("ideeli.labs.getVariant using control due to error: "+err);variant=ideeli.labs.CONTROL_VARIANT;}
if(ideeli.labs.debug)
console.log("ideeli.labs.getVariant found variant "+variant);callback(variant);}
ideeli.labs.recordExposure=function(experiment_symbol,variant){if(!ideeli.labs.isUserLoggedIn()){if(ideeli.labs.debug)
console.log("ideeli.labs.recordExposure skipped because user not logged in");return;}
var v=variant;if(v==ideeli.labs.CONTROL_VARIANT)
v=ideeli.labs.COMPRESSED_CONTROL_VARIANT;if(ideeli.labs.debug)
console.log("ideeli.labs.recordExposure; e = "+experiment_symbol+", v = "+v);RequestProxy.getJSON(ideeli.labs.EV_EXPOSURE_URL,{"e":experiment_symbol,"v":v},function(data){},function(){},this);}
ideeli.labs.userDataLoaded=function(){if(ideeli.labs.debug)
console.log("ideeli.labs.userDataLoaded");ideeli.labs.user_data_loaded=true;var call_queued_gv=function(){ideeli.labs.queued_get_variant_calls.each(function(fn){fn();});ideeli.labs.queued_get_variant_calls=[];};if(ideeli.labs.evRefreshNeeded()){ideeli.labs.refreshEvData(call_queued_gv);}
else{ideeli.labs.refreshEvData();call_queued_gv();}}
if(typeof(ideeli.masthead)=='undefined')
ideeli.masthead=ideeli.latest_head;ideeli.masthead.showUserCallbacks.push(ideeli.labs.userDataLoaded);if(typeof(ideeli)=='undefined'){var ideeli={};}
if(typeof(ideeli.UserFavorites)=='undefined'){ideeli.UserFavorites=new Object();}
ideeli.UserFavorites=function(){return{init:function(){if(!window.FAVORITES_ENABLED)return;this.getAndProcessUserFavorites();this.setUpButtons();this.showFavoritesHeader();if(this.onFavoritesPage()){ideeli.channels.select_channel('');}},setUpButtons:function(){var self=this;jQuery(document).on('click','.user_favorite_product_button, .user_favorite_product_big_button',function(e){e.stopPropagation();e.preventDefault();var that=jQuery(this);if(that.hasClass('selected')){self.deleteFavorite(that);}else{self.addFavorite(that);}
that.toggleClass('selected');});},showFavoritesHeader:function(){jQuery("#my_favorites_li").show();jQuery(".callout .close").click(function(){jQuery(this).parent('.callout').hide();Cookie.set('fav_callout_seen',1);});if(!Cookie.exists('fav_callout_seen')){jQuery("#my_favorites_li .callout").show();}
this.setMastheadFavLinkClass();},hearts:function(){return jQuery('.user_favorite_product_button').add('.user_favorite_product_big_button');},initializeHearts:function(){jQuery.each(this.hearts(),function(_,h){var heart=jQuery(h);var id=heart.data('color-id');if(window.favorite_ids.indexOf(id)!=-1){heart.addClass('selected');}});},getAndProcessUserFavorites:function(){var self=this;if(!window.favorite_ids){jQuery.ajax({url:"/my_account/favorites",cache:false,data:{event_id:this.findCurrentEventId()},dataType:"json",success:function(data){window.favorite_ids=data;window.current_user.has_favorites=data.length>0;window.current_user.favorites_count=data.length;ideeli.masthead.persistUserData();self.initializeHearts();}});}else{this.initializeHearts();}},findCurrentColorId:function(element){return jQuery(element).data('color-id');},findCurrentEventId:function(){return jQuery(".event").data('id')||0;},addFavorite:function(that){var self=this;var color_id=this.findCurrentColorId(that);var event_id=this.findCurrentEventId();var fum=new FUM('add_favorite',that,function(){jQuery.post("/my_account/favorites",{"color_id":color_id,"event_id":event_id},function(data){if(data.success){window.current_user.favorites_count=(window.current_user.favorites_count||0)+1;window.current_user.has_favorites=true;self.setMastheadFavLinkClass();ideeli.masthead.persistUserData();fum.asyncWorkDone();}});},function(){return[true,'',null];},{async:true,additional_info:{color_id:color_id,event_id:event_id}});},setMastheadFavLinkClass:function(){if(window.current_user.has_favorites){jQuery(".my_favorites_link_heart").removeClass("my_favorites_heart_gray").addClass("my_favorites_heart_red");}else{jQuery(".my_favorites_link_heart").removeClass("my_favorites_heart_red").addClass("my_favorites_heart_gray");}},replaceWithPlaceholder:function(image){image.onload=image.onabort=image.onerror=function placeholderResult(){fum.asyncWorkDone();image.onload=image.onabort=image.onerror=null;};var fum=new FUM('favorites_displayed_unpublishable_product',this,function fumPlaceholder(){image.src=window.FAVORITES_PLACEHOLDER_IMAGE;},function(){return[true,'',null];},{async:true});return true;},onFavoritesPage:function(){return window.location.href.match(/\/favorites/)!=null;},deleteFavorite:function(that){var self=this;var color_id=this.findCurrentColorId(that);var fum=new FUM('delete_favorite',that,function(){jQuery.post("/my_account/favorites/"+color_id,{_method:'delete'},function(data){if(data.success){if(jQuery(".my_favorite_color_"+color_id).length>0){jQuery(".my_favorite_color_"+color_id).fadeOut(400);}
if(jQuery("#favorites_count").length>0){window.current_user.favorites_count=parseInt(jQuery("#favorites_count").html(),10);}
if(window.current_user.favorites_count<=0){window.current_user.favorites_count=1;}
jQuery("#favorites_count").html(--window.current_user.favorites_count);window.current_user.has_favorites=window.current_user.favorites_count>0;self.setMastheadFavLinkClass();ideeli.masthead.persistUserData();fum.asyncWorkDone();if(jQuery('.user_favorite_product_button.selected').length==0&&self.onFavoritesPage()){var location=window.location.href.replace(/([\?|&])page\=[0-9]*/,function(match,questionMarkOrAmpersand){if(questionMarkOrAmpersand=='?'){return'?';}
return'';});if(location.indexOf('?')==(location.length-1)){location=location.replace('?','');}
window.location=location;}}});},function(){return[true,'',null];},{async:true});}}}();if(jQuery){jQuery.noConflict();}
if(typeof(ideeli)=='undefined'){ideeli={};}
ideeli.joinFlow=function(){return{showLogin:function(){jQuery("#join-flow-modal .join-flow-modal-signup").hide()
jQuery("#join-flow-modal .join-flow-modal-login").show().find('label').inFieldLabels({watchForAutocomplete:true});},showJoin:function(){jQuery("#join-flow-modal .join-flow-modal-login").hide()
jQuery("#join-flow-modal .join-flow-modal-signup").show().find('label').inFieldLabels({watchForAutocomplete:true});},noLoggedUser:function(){return!window.current_user;},userHasInvitation:function(){return Cookie.exists('invitation');},mustForcefullyOpen:function(){return this.userCameFromWelcomePage()||this.userHasInvitation();},userCameFromWelcomePage:function(){return document.referrer.indexOf("welcome")>-1},userIsMember:function(){return Cookie.exists('login');},dismissModalAndUnbindHandlers:function(){if(this.modal){this.modal.close();}
this.unbindHandlers();},boundDismissModalAndUnbindHandlers:function(){ideeli.joinFlow.dismissModalAndUnbindHandlers();},unbindHandlers:function(){this.allTriggerElements().unbind('click',this.boundShowModal);this.allLiveElements().off('click',this.boundShowModal);this.allLoginLiveElements().off('click',this.boundShowLogin);},boundShowModal:function(e){ideeli.joinFlow.showModal(e);},showModal:function(e){if(this.noLoggedUser()){this.showJoinModalForLoggedOutUserOnAnyAction(e);}else{this.dismissModalAndUnbindHandlers();}},boundShowLogin:function(e){ideeli.joinFlow.showLogin();e.stopPropagation();e.preventDefault();},allLiveElements:function(){return this.allLoginLiveElements().add(".event_unit").add("#channel_tabs_container_hep .channel_items").add("#prev_next_offer_container a");},allTriggerElements:function(){return jQuery(".join_flow_modal_class").add("#on_sale_right_col").add("#bottom_promo_units").add('.channel_items a.channel .channel_name').add('.channel_items a.channel').add('.join-link');},allLoginLiveElements:function(){return jQuery('.login-link');},bindHandlers:function(){this.allTriggerElements().bind('click',this.boundShowModal);this.allLiveElements().on('click',this.boundShowModal);this.allLoginLiveElements().on('click',this.boundShowLogin);},onLoginPage:function(){return jQuery.grep(['link_facebook_account','login','lostpassword'],function(path){return window.location.href.indexOf(path)!=-1;}).length>0;},init:function(){if(this.noLoggedUser()){ideeli.masthead.addCurrentUserLoadedEventHandler(this.boundDismissModalAndUnbindHandlers);if(this.mustForcefullyOpen()&&!this.onLoginPage()){this.showJoinFlowModal();if(this.userIsMember()){this.showLogin();}}else{this.bindHandlers();}}
this.hideJoinIdeeliInlineBanner();},showJoinFlowModal:function(){this.modal=new Control.Modal($('join-flow-modal'),{className:'join_flow_popup_modal_frame',closeOnClick:false,constrainToViewport:true,beforeClose:function(){if(jQuery(".prototip").length>0){jQuery(".prototip").hide();}},fade:false,overlayOpacity:0.5,offset:{x:0,y:2}});setTimeout(function(){ideeli.joinFlow.modal.open(0.5,false);},100);this.hideJoinIdeeliInlineBanner();this.showJoin();Event.observe(window,'resize',this.modal.positionHandler,false);},hideJoinIdeeliInlineBanner:function(){jQuery("#signup_banner_container").remove();},showJoinModalForLoggedOutUserOnAnyAction:function(event){event.preventDefault();event.stopPropagation();this.showJoinFlowModal();}}}();ideeli.joinModalForm={setUp:function joinModalForm_SetUp(){var self=this;this.form().append('<input type="hidden" name="return_to" value="'+window.location.href+'"/>');if(this.mediaInviteCode())this.form().append('<input type="hidden" name="mi" value="'+this.mediaInviteCode()+'"/>');this.form().submit(function onJoinFormSubmit(e){self.hideErrorMessage();self.removeHighlight();if(!self.validate()){e.preventDefault();e.stopPropagation();}});if(Cookie.exists('modal_join_result')){var result=Cookie.get('modal_join_result');Cookie.erase('modal_join_result');ideeli.joinFlow.showJoinFlowModal();ideeli.joinFlow.showJoin();switch(result){case'success':ideeli.joinModalForm.joinSuccessful();break;case'bad_email':ideeli.joinModalForm.showBadEmailError();break;case'bad_password':ideeli.joinModalForm.showBadPasswordError();break;}}},joinSuccessful:function joinModalForm_JoinSuccessful(){ideeli.masthead.addCurrentUserLoadedEventHandler(function(){var i=document.createElement("img");i.width=0;i.height=0;i.src="http://ace-tag.advertising.com/action/type=278362459/bins=1/rich=0/mnum=1516/site=695501/xssale=PRICE/xsmemid=ORDERID/xsstr1="+current_user.id+"/betr=ideeli_cs=[+]2[8760]";document.body.appendChild(i);ideeli.remarketing_tag.trackUserJoin(current_user.id);ideeli.nanigans.trackRegistration();});var axel=Math.random()+"";var a=axel*10000000000000;var ifr=document.createElement("iframe");ifr.width=1;ifr.height=1;ifr.frameborder=0;ifr.src="http://fls.doubleclick.net/activityi;src=2704923;type=signu314;cat=ideel408;ord="+a+"?";document.body.appendChild(ifr);var s=document.createElement("script");s.src="https://js.dmtry.com/channel.js"+"?_"+axel+"#gid:2118;advid:620;pid:63505";document.getElementsByTagName("HEAD")[0].appendChild(s);var i=document.createElement("img");i.width=1;i.height=1;i.src="http://t.optorb.com/cv?co=3320&ev=default&am=0.00";document.body.appendChild(i);this.optimalPixel();},optimalPixel:function(){window.fb_param={};window.fb_param.pixel_id='6006375056908';window.fb_param.value='0.00';(function(){var fpw=document.createElement('script');fpw.async=true;fpw.src=(location.protocol=='http:'?'http':'https')+'://connect.facebook.net/en_US/fp.js';var ref=document.getElementsByTagName('script')[0];ref.parentNode.insertBefore(fpw,ref);})();},mediaInviteCode:function joinModalForm_MediaInviteCode(){return Cookie.get('mi');},emailValue:function joinModalForm_EmailValue(){return jQuery.trim(this.emailField().get(0).value);},passwordValue:function joinModalForm_PasswordValue(){return jQuery.trim(this.passwordField().get(0).value);},validateEmail:function joinModalForm_ValidateEmail(){var email=this.emailValue();if(email){if(new RegExp('^[-!#$%&\'*+\\./0-9=?A-Z^_`a-z{|}~]+@[-!#$%&\'*+\\/0-9=?A-Z^_`a-z{|}~]+\.[-!#$%&\'*+\\./0-9=?A-Z^_`a-z{|}~]+$').test(email)){return true;}
this.showBadEmailError();}else{this.showEmptyEmailError();}
return false;},validatePassword:function joinModalForm_ValidatePassword(){var password=this.passwordValue();if(password){if(password.length<6||password.length>64){this.showBadPasswordError();}else{return true;}}else{this.showEmptyPasswordError();}
return false;},validate:function joinModalForm_Validate(){return this.validateEmail()&&this.validatePassword();},form:function joinModalForm_Form(){return jQuery('#join-flow-modal .join-flow-modal-signup form');},emailField:function joinModalForm_EmailField(){return this.form().find('input[name=email]');},passwordField:function joinModalForm_PasswordField(){return this.form().find('input[name=password]');},removeHighlight:function joinModalForm_RemoveHighlight(){this.emailField().removeClass('highlight');this.passwordField().removeClass('highlight');},highlightEmailField:function joinModalForm_HighlightEmailField(){this.emailField().addClass('highlight');},highlightPasswordField:function joinModalForm_HighlightPasswordField(){this.passwordField().addClass('highlight');},errorMessage:function joinModalForm_ErrorMessage(){return this.errorContainer().find('.error-message');},errorContainer:function joinModalForm_ErrorMessage(){return jQuery('#join-flow-modal .join-flow-modal-signup .error-container');},hideErrorMessage:function joinModalForm_HideErrorMessage(){this.errorContainer().hide();},showErrorMessage:function joinModalForm_ShowErrorMessage(message){this.errorContainer().show();this.errorMessage().text(message);},showEmptyEmailError:function joinModalForm_ShowEmptyEmailError(){this.showErrorMessage('Please enter an email address.');this.highlightEmailField();},showBadEmailError:function joinModalForm_ShowBadEmailError(){this.showErrorMessage('Sorry, you entered an invalid email address. Please try again.');this.highlightEmailField();},showEmptyPasswordError:function joinModalForm_ShowEmptyPasswordError(){this.showErrorMessage('Please enter a password.');this.highlightPasswordField();},showBadPasswordError:function joinModalForm_ShowBadPasswordError(){this.showErrorMessage('Sorry, but password must be between 6 and 64 characters. Please try again.');this.highlightPasswordField();}};ideeli.loginModalForm=(function(){var cons=function(){};cons.prototype=ideeli.joinModalForm;return new cons();})();ideeli.loginModalForm.errorContainer=function loginModalForm_ErrorMessage(){return jQuery('#join-flow-modal .join-flow-modal-login .error-container');};ideeli.loginModalForm.form=function loginModalForm_Form(){return jQuery('#join-flow-modal .join-flow-modal-login form');};ideeli.loginModalForm.emailField=function loginModalForm_EmailField(){return this.form().find('input[name=login]');};ideeli.loginModalForm.showBadLoginMessage=function loginModalForm_ShowBadLoginMessage(){this.showErrorMessage('There is no record of that email address and password combination.');this.highlightPasswordField();this.highlightEmailField();};ideeli.loginModalForm.validateEmail=function loginModalForm_ValidateEmail(){if(!this.emailValue()){this.showEmptyEmailError();return false;}
return true;};ideeli.loginModalForm.setUp=function loginModalForm_SetUp(){var self=this;this.form().append('<input type="hidden" name="return_to" value="'+window.location.href+'"/>');this.form().submit(function onLoginFormSubmit(e){self.hideErrorMessage();self.removeHighlight();if(!self.validate()){e.preventDefault();e.stopPropagation();}});if(Cookie.get('modal_login_error')=='true'){Cookie.set('modal_login_error','');ideeli.joinFlow.showJoinFlowModal();ideeli.joinFlow.showLogin();this.showBadLoginMessage();}};jQuery(function(){ideeli.joinModalForm.setUp();ideeli.loginModalForm.setUp();jQuery("#join-flow-modal .login a").click(function(e){ideeli.joinFlow.showLogin();e.preventDefault();e.stopPropagation();});jQuery("#join-flow-modal .join a").click(function(e){ideeli.joinFlow.showJoin();e.preventDefault();e.stopPropagation();});});;(function(window,document,$,undefined){"use strict";var namespace='carousel',defaults={animation:{duration:300,step:1},behavior:{horizontal:true,circular:false,autoplay:0,keyboardNav:true,pauseOnHover:true},elements:{prevNext:true,handles:true,counter:true},events:{start:false,stop:false},initialSlide:0,text:{next:'show next slide',prev:'show previous slide',counter:'%current% of %total%',handle:'%index%'},touch:{enabled:true,thresholds:{speed:0.4,distance:0.3}},visibleSlides:1},utils={getTransitionProperty:function(){var element=document.body||document.documentElement,property='transition',prefixedProperty,prefices=['Moz','ms','O','Webkit'],style=element.style;if(typeof style[property]==='string'){return property;}
property=property.charAt(0).toUpperCase()+property.substr(1);for(var i=0;i<prefices.length;i++){prefixedProperty=prefices[i]+property;if(typeof style[prefixedProperty]==='string'){return prefixedProperty;}}
return false;},getTransitionEndEvent:function(){var property=utils.getTransitionProperty(),map={'transition':'transitionend','MozTransition':'transitionend','msTransition':'msTransitionEnd','OTransition':'oTransitionEnd','WebkitTransition':'webkitTransitionEnd'};return map[property]||false;},getNamespacedEvents:function(events){var arr=events.split(' ');for(var i=0;i<arr.length;i++){arr[i]=arr[i]+'.'+namespace;}
return arr.join(' ');},enableButton:function($element){$element.removeClass('state-disabled').removeAttr('aria-disabled').attr("tabindex",0);},disableButton:function($element){$element.addClass('state-disabled').attr('aria-disabled',true).attr("tabindex",-1);}},support={touch:'ontouchstart'in window,transition:utils.getTransitionProperty()},events=utils.getNamespacedEvents(!support.touch?'click keydown':'touchstart'),hasMoved=false,instances=0;var Plugin=function(elem,options){this.$dom={slider:jQuery(elem),slides:jQuery(elem).children(),container:jQuery('<div class="'+namespace+'-container" tabindex="0" />'),frame:jQuery('<div class="'+namespace+'-frame" />'),navContainer:jQuery('<div class="'+namespace+'-nav" aria-hidden="true" />'),prev:jQuery('<span class="'+namespace+'-prev" role="button" tabindex="0" />'),next:jQuery('<span class="'+namespace+'-next" role="button" tabindex="0" />'),counter:jQuery('<div class="'+namespace+'-counter" aria-hidden="true" />'),handlesContainer:jQuery('<div class="'+namespace+'-handles" aria-hidden="true" />'),handles:null,handle:jQuery('<span class="'+namespace+'-handle" role="button" tabindex="0" />')};this.props={current:0,total:0,visible:0};this.state={enabled:false,animating:false};this.settings=jQuery.extend(true,{},options,this.$dom.slider.data(namespace+'-options'));};Plugin.prototype={init:function(){var self=this,$dom=this.$dom,resizeTimeout=null,sliderStyles;if(this.$dom.slider.data(namespace)||this.$dom.slider.length===0||this.$dom.slides.length<=1){return this;}
this.index=instances++;this.settings=jQuery.extend(true,{},defaults,this.settings);sliderStyles=this._getStyles($dom.slider);$dom.slider.data(namespace+'-css',sliderStyles);$dom.slides.each(function(){var $this=jQuery(this),styles=self._getStyles($this);$this.show();$this.data(namespace+'-css',styles);});$dom.container.hover(function(){$dom.container.data("hovering",true);},function(){$dom.container.data("hovering",false);});$dom.container.insertBefore($dom.slider);$dom.frame.appendTo($dom.container).append($dom.slider.addClass(namespace+'-slider'));if(this.settings.elements.prevNext){$dom.prev.appendTo($dom.navContainer).text(this.settings.text.prev);$dom.next.appendTo($dom.navContainer).text(this.settings.text.next);$dom.navContainer.appendTo($dom.container);$dom.nav=$dom.prev.add($dom.next);}
if(this.settings.elements.counter){$dom.counter.appendTo($dom.container);}
if(this.settings.elements.handles){$dom.handlesContainer.appendTo($dom.container);}
$dom.slides.addClass(namespace+'-slide');if(this.settings.behavior.circular){$dom.slides.each(function(i){jQuery(this).data(namespace+'-index',i);});}
if(!this.settings.behavior.horizontal){$dom.container.addClass(namespace+'-vertical');}
this.update();jQuery(window).on(utils.getNamespacedEvents('resize')+this.index,$.proxy(function(){if(resizeTimeout){clearTimeout(resizeTimeout);}
resizeTimeout=setTimeout($.proxy(function(){this.resize();},this),100);},this));$dom.slider.data(namespace,this);return this;},update:function(options){var self=this;$.extend(true,this.settings,options);this.$dom.slides=this.$dom.slides.parent().children();this.props.total=this.$dom.slides.length;this.props.current=this.settings.initialSlide;this.props.visible=this._getVisibleSlides();if(this.settings.elements.handles){this.$dom.handlesContainer.html(this._getHandles());this.$dom.handles=this.$dom.handlesContainer.children();}
this.resize();this.disable();this.enable();},resize:function(){var containerWidth=this.$dom.slider.data('width')||this.$dom.frame.width(),containerHeight,slidesWidth=this.settings.behavior.horizontal?containerWidth/this.props.visible:containerWidth,slidesHeight,sliderWidth=this.settings.behavior.horizontal?this.props.total*slidesWidth:slidesWidth;this.$dom.container.css('width',containerWidth);this.$dom.slides.width(slidesWidth);this.$dom.slider.width(sliderWidth).height('auto');slidesHeight=this._getHighestSlide();this.$dom.slides.css('min-height',slidesHeight);containerHeight=this.settings.behavior.horizontal?slidesHeight:this.props.visible*slidesHeight;this.$dom.frame.height(containerHeight);this.goTo(this.props.current,true);},enable:function(){var self=this;if(this.state.enabled||this.props.visible>this.props.total){return;}
if(this.settings.elements.prevNext){this.$dom.nav.on(events,function(event){var $this=jQuery(this),isDisabled=$this.hasClass('state-disabled'),dir,target,callback;if(isDisabled){return;}
dir=$this.is(self.$dom.next)?1:-1;target=dir*self.settings.animation.step+self.props.current;callback=function(){self.goTo(target);};self._handleButtonEvents(event,$this,callback);});}
if(this.settings.elements.handles){this.$dom.handles.on(events,function(event){var $this=jQuery(this),handleIndex=$this.index(),slideIndex=self._getSlideIndex(handleIndex),callback=function(){self.goTo(slideIndex);};self._handleButtonEvents(event,$this,callback);});}
if(this.settings.touch.enabled&&support.touch){this._touchEnable();}
if(this.settings.behavior.keyboardNav){this.$dom.container.on(utils.getNamespacedEvents('keydown'),$.proxy(function(event){var $target=jQuery(event.target),nodeName=$target.get(0).nodeName.toLowerCase(),isFormElement=$.inArray(nodeName,['input','textarea'])!==-1,success=false;if(!(isFormElement||event.metaKey||event.ctrlKey)){var code=event.keyCode||event.which,targetIndex,slideIndex;if($.inArray(code,[37,80])!==-1){this.prev();this.$dom.prev.focus();success=true;}else if($.inArray(code,[39,78])!==-1){this.next();this.$dom.next.focus();success=true;}else if(47<code&&code<58){targetIndex=code-49;slideIndex=self._getSlideIndex(targetIndex);this.goTo(slideIndex);if(this.settings.elements.handles){this.$dom.handles.eq(targetIndex).focus();}
success=true;}}
if(success){this._autoplayDisable();event.preventDefault();}},this));}
if(this.settings.behavior.autoplay){self.setupAutoAdvance();}
this.state.enabled=true;this._updateNav();},setupAutoAdvance:function(){var self=this;clearInterval(this.autoplay);var index=this._getValidatedTarget(this.props.current);var delay=parseInt(jQuery(this.$dom.slides[index]).data('seconds-visible'),10)*1000;if(!delay){delay=this.settings.behavior.autoplay;}
this.autoplay=setInterval(function(){self.autoAdvance();},delay);},autoAdvance:function(){var index=this._getValidatedTarget(this.props.current+this.settings.animation.step);if(index==this.props.current){index=0;}
if(this.settings.behavior.pauseOnHover){if(!this.isMouseOver())
this.goTo(index);}else{this.goTo(index);}
this.setupAutoAdvance();},isMouseOver:function(){return this.$dom.container.data("hovering")==true;},disable:function(args){if(!this.state.enabled){return;}
if(this.settings.elements.prevNext){this.$dom.nav.off(events);}
if(this.settings.elements.handles){this.$dom.handles.off(events);}
if(this.settings.touch.enabled&&support.touch){this._touchDisable();}
if(this.settings.behavior.keyboardNav){this.$dom.container.off(utils.getNamespacedEvents('keydown'));}
if(this.settings.behavior.autoplay){this._autoplayDisable();}
this.state.enabled=false;this._updateNav();},goTo:function(i,skipAnimation){var self=this,index=this._getValidatedTarget(i),cssPosition=this._getTargetPosition(index),duration=skipAnimation?0:this.settings.animation.duration,callback=function(){if(self.settings.events.stop){self.settings.events.stop(index);}
self.state.animating=false;},prop,transitionProp,endEvent,transition,oldTransition;if(!skipAnimation){this.state.animating=true;if(this.settings.events.start){this.settings.events.start(index);}
if(!support.transition){this.$dom.slider.animate(cssPosition,duration,function(){callback();});}else{prop=support.transition;transitionProp=this.settings.behavior.horizontal?'left':'top';endEvent=utils.getNamespacedEvents(utils.getTransitionEndEvent());oldTransition=this.$dom.slider.css(prop);transition=transitionProp+' '+duration/1000+'s ease-in-out';this.$dom.slider.css(prop,transition);this.$dom.slider.css(cssPosition);this.$dom.slider.on(endEvent,function(){self.$dom.slider.off(endEvent);self.$dom.slider.css(prop,oldTransition);callback();});}}else{this.$dom.slider.css(cssPosition);}
this.props.current=index;this._updateNav();},next:function(){this.goTo(this.props.current+this.settings.animation.step);},prev:function(){this.goTo(this.props.current-this.settings.animation.step);},destroy:function(){var $dom=this.$dom,sliderStyles=$dom.slider.data(namespace+'-css');$dom.slider.removeClass(namespace+'-slider').removeData(namespace).removeData(namespace+'-css').insertAfter($dom.container).css(sliderStyles);$dom.slides.removeClass(namespace+'-slide').removeData(namespace+'-index').each(function(){var $this=jQuery(this),styles=$this.data(namespace+'-css');$this.css(styles);}).removeData(namespace+'-css');$dom.container.remove();this.state.enabled=false;this.props.current=0;jQuery(window).off(utils.getNamespacedEvents('resize')+this.index);},_autoplayDisable:function(){},_handleButtonEvents:function(event,$target,callback){switch(event.type){case'keydown':if(!(event.metaKey||event.ctrlKey)){var code=event.keyCode||event.which;if($.inArray(code,[13,32])!==-1){callback();event.preventDefault();}}
break;case'touchstart':hasMoved=false;$target.on('touchmove.'+namespace,function(){hasMoved=true;});$target.on('touchend.'+namespace,function(){$target.off('touchmove.'+namespace);$target.off('touchend.'+namespace);if(!hasMoved){callback();}});break;default:callback();break;}
if(this.settings.behavior.autoplay){this._autoplayDisable();}},_getHandles:function(){var fragment=document.createDocumentFragment();for(var i=0;i<this.props.total;i++){var text=this.settings.text.handle.replace('%index%',(i+1)),handle=this.$dom.handle.clone().text(text).get(0);fragment.appendChild(handle);}
return jQuery(fragment);},_getHighestSlide:function(){var height=0;this.$dom.slides.each(function(){var slideHeight=jQuery(this).css('min-height',0).height();if(slideHeight>height){height=slideHeight;}});return height;},_getSlideIndex:function(index,original){if(this.settings.behavior.circular){this.$dom.slides.each(function(){var $this=jQuery(this),currentIndex=$this.index(),originalIndex=$this.data(namespace+'-index'),wantedIndex=original?currentIndex:originalIndex;if(index===wantedIndex){index=currentIndex;return false;}});}
return index;},_getStyles:function($element){var styles=['height','left','min-height','top','width'],selection={},transition;for(var i=0;i<styles.length;i++){selection[styles[i]]=$element.css(styles[i]);}
if(support.transition){transition=support.transition.charAt(0).toLowerCase()+support.transition.substr(1);selection[transition]=$element.css(transition);}
return selection;},_getTargetPosition:function(index){var slidesSize=this.settings.behavior.horizontal?this.$dom.slides.width():this.$dom.slides.height(),prop=this.settings.behavior.horizontal?'left':'top',css={};css[prop]=-index*slidesSize;return css;},_getValidatedTarget:function(i){if(!this.settings.behavior.circular){if(i<0){i=0;}else if(i>=(this.props.total-this.props.visible)){i=this.props.total-this.props.visible;}}else{if(i<0){var minIndex=this.props.total+i;if(this._shiftSlides(minIndex,-1)){return 0;}}else if(this.props.total>this.props.visible&&i>(this.props.total-this.props.visible)){var maxIndex=(i-1)-(this.props.total-this.props.visible);if(this._shiftSlides(maxIndex,1)){return i-(maxIndex+1);}}}
return i;},_getVisibleSlides:function(){if(this.settings.visibleSlides>0){return this.settings.visibleSlides;}else{var self=this,minSize=0,containerSize=this.settings.behavior.horizontal?this.$dom.frame.width():this.$dom.frame.height();this.$dom.slides.each(function(){var size=self.settings.behavior.horizontal?jQuery(this).width():jQuery(this).height();if(size>minSize){minSize=size;}});return Math.round(containerSize/minSize);}},_shiftSlides:function(index,dir){var selector=(dir===-1)?':gt('+(index-1)+')':':lt('+(index+1)+')',$slides=this.$dom.slides.filter(selector);if($slides.length>0){var axis=this.settings.behavior.horizontal?'left':'top',slideDimension=this.settings.behavior.horizontal?this.$dom.slides.width():this.$dom.slides.height(),currentPosition=this.$dom.slider.position(),newPosition={};newPosition[axis]=currentPosition[axis]+dir*$slides.length*slideDimension;if(dir===-1){$slides.prependTo(this.$dom.slider);}else{$slides.appendTo(this.$dom.slider);}
this.$dom.slides=this.$dom.slider.children();this.$dom.slider.css(newPosition);return true;}else{return false;}},_touchEnable:function(){var self=this,coords={start:{x:0,y:0},end:{x:0,y:0}},time={start:0,end:0},thresholds={distance:self.settings.touch.thresholds.distance*self.$dom.frame.width(),speed:self.settings.touch.thresholds.speed*self.$dom.frame.width()},sliderOffset={top:0,left:0},events={};function getDistance(){var distance={x:coords.end.x-coords.start.x,y:coords.end.y-coords.start.y};if(!self.settings.behavior.horizontal){distance={x:distance.y,y:distance.x};}
return distance;}
events['touchstart.'+namespace]=function(e){var event=e.originalEvent.targetTouches[0];coords.start.x=event.pageX;coords.start.y=event.pageY;sliderOffset=self.$dom.slider.position();time.start=new Date().getTime();hasMoved=false;};events['touchmove.'+namespace]=function(e){var event=e.originalEvent.targetTouches[0],distance=0,animProps={},positionProp=self.settings.behavior.horizontal?'left':'top',refDimension;coords.end.x=event.pageX;coords.end.y=event.pageY;distance=getDistance();if(Math.abs(distance.x)>Math.abs(distance.y)){refDimension=self.settings.behavior.horizontal?sliderOffset.left:sliderOffset.top;animProps[positionProp]=refDimension+distance.x;self.$dom.slider.css(animProps);hasMoved=true;e.preventDefault();}};events['touchend.'+namespace]=function(e){if(!hasMoved){return;}
var event=e.originalEvent.targetTouches[0],distance=getDistance(),speed,targetSlide=self.props.current;if(Math.abs(distance.x)>Math.abs(distance.y)){time.end=new Date().getTime();speed=Math.abs(distance.x)/(time.end-time.start)*1000;if(Math.abs(distance.x)>thresholds.distance||speed>thresholds.speed){var refDimension=self.settings.behavior.horizontal?self.$dom.slides.width():self.$dom.slides.height(),swipeDir=(distance.x>0)?-1:1,slidesSwiped=Math.abs(Math.round(distance.x/refDimension));if(slidesSwiped<1&&speed>thresholds.speed){slidesSwiped=1;}
targetSlide=self.props.current+swipeDir*slidesSwiped;}
self.goTo(targetSlide);if(self.settings.behavior.autoplay){self._autoplayDisable();}}};this.$dom.frame.on(events);},_touchDisable:function(){this.$dom.frame.off(utils.getNamespacedEvents('touchstart touchmove touchend'));},_updateNav:function(){if(this.state.enabled){if(this.settings.elements.prevNext){utils.enableButton(this.$dom.prev);utils.enableButton(this.$dom.next);if(!this.settings.behavior.circular){if(this.props.current===0){utils.disableButton(this.$dom.prev);}else{utils.enableButton(this.$dom.prev);}
if(this.props.current===this.props.total-this.props.visible){utils.disableButton(this.$dom.next);}else{utils.enableButton(this.$dom.next);}}}
if(this.settings.elements.handles){var currentIndex=this._getSlideIndex(this.props.current,true),currentHandles=(currentIndex>0)?':gt('+(currentIndex-1)+'):lt('+this.props.visible+')':':lt('+(currentIndex+this.props.visible)+')';utils.enableButton(this.$dom.handles);this.$dom.handles.removeClass('state-current');this.$dom.handles.filter(currentHandles).addClass('state-current');}}else{if(this.settings.elements.prevNext){utils.disableButton(this.$dom.prev);utils.disableButton(this.$dom.next);}
if(this.settings.elements.handles){utils.disableButton(this.$dom.handles);}}
if(this.settings.elements.counter){var counterCurrent=this._getSlideIndex(this.props.current,true)+1,counterCurrentMax=counterCurrent+(this.props.visible-1),text;if(this.props.visible>1){if(counterCurrentMax>this.props.total){counterCurrentMax=this.props.total;}
counterCurrent+='-'+counterCurrentMax;}
text=this.settings.text.counter.replace('%current%',counterCurrent).replace('%total%',this.props.total);this.$dom.counter.text(text);}}};$.fn[namespace]=function(options){var args=arguments;return this.each(function(){var $this=jQuery(this),instance=$this.data(namespace);if(instance){if(typeof options==='object'){instance.update.apply(instance,args);}else{instance[options].apply(instance,Array.prototype.slice.call(args,1));}}else{new Plugin(this,options).init();}});};window[namespace.charAt(0).toUpperCase()+namespace.substr(1)]=Plugin;})(window,document,jQuery);var ideeli=ideeli||{};if(typeof(ideeli.carousels)=='undefined'){ideeli.carousels={DEBUG:false,USE_LABS:true,EDITORIAL_UNIT_SELECTOR:"ul.editorial_unit_focus",EVENT_CAROUSEL_SELECTOR:"ul.carousel.banner",EXPERIMENT:"item_of_the_day_experiment",ALLOWED_VARIANTS:['carousel','carousel_and_twitter_feed'],carousels:[],inited:{},options:{elements:{counter:false,prevNext:false,handles:true},behavior:{autoplay:window.EDITORIAL_UNIT_CAROUSEL_TRANSITION_TIME_MS||5000,circular:false,keyboardNav:false}},init:function(){var _self=ideeli.carousels;_self.log("> init");if(ideeli.labs.isUserLoggedIn()){ideeli.labs.getVariant(_self.EXPERIMENT,_self.launch);}else{_self.launch();}},launch:function(variant){var _self=ideeli.carousels;var selectors=[_self.EDITORIAL_UNIT_SELECTOR];_self.log("> launch");if(_self.ALLOWED_VARIANTS.indexOf(variant)!==-1||!_self.USE_LABS){selectors.push(_self.EVENT_CAROUSEL_SELECTOR);}
jQuery(selectors.join(',')).each(function(i){var id=jQuery(this).attr('id');_self.options.elements.prevNext=!jQuery(this).hasClass('editorial_unit_focus');if(!_self.inited[id]){_self.log("activating carousel: "+id);var carousel=new Carousel(this,_self.options);carousel.init();if(typeof(carousel)=="Plugin")_self.carousels.push(carousel);_self.inited[id]=true;}});},refresh:function(){var _self=this;_self.log("> refresh");_self.init();for(var i=0;i<this.carousels.length;i++){var carousel=this.carousels[i];setTimeout(function(){carousel.resize()},50);}},log:function(msg){if(ideeli.carousels.DEBUG){msg=msg.toString();if(msg.substr(0,1)!==">"){msg="  "+msg;}
console.log("carousels: "+msg);}}};}
jQuery(function(){ideeli.carousels.init();});function asInt(stringOrInt){return stringOrInt?parseInt(stringOrInt,10):0;}
function RemainingItems(options){jQuery.extend(this,options);}
jQuery.extend(RemainingItems.prototype,{url:function(){return'';},onUpdate:function(data){},delay:function(){return 60*1000;},pollPeriodically:function(){var self=this;this._interval=setInterval(function(){self.poll()},this.delay());this.poll();},poll:function(){var self=this;jQuery.ajax({url:this.url(),type:'GET',cache:false}).done(function(data){self.onUpdate(data);});},stopPolling:function(){clearInterval(this._interval);this._interval=null;},parentSelector:function(){return'body';},counters:function(){return jQuery(this.parentSelector()).find('.remaining_items_counter');}});function SkuBasedRemainingItems(options){RemainingItems.call(this,options);}
(function(){var a=function(){};a.prototype=RemainingItems.prototype;SkuBasedRemainingItems.prototype=new a();})();jQuery.extend(SkuBasedRemainingItems.prototype,{onUpdate:function(data){this.updateCounters(data);},updateCounters:function(data){var skus=data.skus;var self=this;this.counters().addClass('with_enough_stock');if(!skus)return;jQuery.each(skus,function(id,stock){if(asInt(stock)==0){self.skuLabel(id).addClass('with_enough_stock');self.soldOutSku(id);}else{self.skuLabel(id).removeClass('with_enough_stock').find('.count').html(stock);self.sellSku(id);}});},skuLabel:function(id){return this.counters().filter('.sku_'+id);},soldOutSku:function(id){},sellSku:function(id){}});function EventRemainingItems(options){RemainingItems.call(this,options);this._currentFilters=NoFilter;}
(function(){var a=function(){};a.prototype=RemainingItems.prototype;EventRemainingItems.prototype=new a();})();jQuery.extend(EventRemainingItems.prototype,{onUpdate:function(data){var self=this;this._data=data;this.counters().addClass('with_enough_stock');this.currentFilters().updateCountersWith(data,this);},currentFilters:function(){return this._currentFilters;},addSizeToFilter:function(size){this._currentFilters=this.currentFilters().addSize(size);return this;},removeSizeFromFilter:function(size){this._currentFilters=this.currentFilters().removeSize(size);return this;},clearSizeFilter:function(){this._currentFilters=NoFilter;return this;},redraw:function(){this.onUpdate(this._data);},soldOutColor:function(id){jQuery('#color_'+id+' .quick_buy_button').removeClass('quick_buy_button_quick_buy').addClass('quick_buy_button_wait_list');jQuery('#join_waitlist_'+id).show();jQuery('#sold_out_corner_'+id).show();this.currentFilters().soldOut(id);},sellColor:function(id,stock){jQuery('#color_'+id+' .quick_buy_button').addClass('quick_buy_button_quick_buy').removeClass('quick_buy_button_wait_list');jQuery('#sold_out_corner_'+id).hide();jQuery('#join_waitlist_'+id).hide();jQuery('#sold_out_size_corner_'+id).hide();this.counters().filter('.color_'+id).removeClass('with_enough_stock').find('.count').html(stock);}});var NoFilter={updateCountersWith:function(data,remainingItems){if(!data)return;var colors=data.colors;var self=this;if(!colors)return;jQuery.each(colors,function(id,stock){if(asInt(stock)==0){remainingItems.soldOutColor(id);}else{remainingItems.sellColor(id,stock);}});},addSize:function(size){return new SizeFilter(size);},removeSize:function(_){return this;},soldOut:function(id){jQuery('#sold_out_size_corner_'+id).hide();}};function SizeFilter(size){this._sizes=[size];}
jQuery.extend(SizeFilter.prototype,{countUsing:function(skus){var sum=0;jQuery.each(this._sizes,function(_,size){sum+=asInt(skus[size]);});return sum;},updateCountersWith:function(data,remainingItems){if(!data)return;var self=this;var colors=data.skus;jQuery.each(colors,function(id,skus){var stock=self.countUsing(skus);if(stock==0){remainingItems.soldOutColor(id);}else{remainingItems.sellColor(id,stock);}});},addSize:function(size){if(this._sizes.indexOf(size)!=-1)return this;this._sizes.push(size);return this;},removeSize:function(size){var index=this._sizes.indexOf(size);if(index>=0){this._sizes.splice(index,1);if(this._sizes.length==0){return NoFilter;}}
return this;},soldOut:function(id){jQuery('#sold_out_size_corner_'+id).show();}});function MultiRemaingingItems(options){RemainingItems.call(this,options);this._remainingItems=[];}
(function(){var a=function(){};a.prototype=RemainingItems.prototype;MultiRemaingingItems.prototype=new a();})();jQuery.extend(MultiRemaingingItems.prototype,{add:function(remainingItems){this._remainingItems.push(remainingItems);},onUpdate:function(data){this._data=data;if(!data)return;jQuery.each(this._remainingItems,function(_,remainingItems){remainingItems.onUpdate(data);});},forceUpdate:function(){this.onUpdate(this._data);}});function onRemainingItemsExperiment(action){ideeli.labs.getVariant('sense_of_urgency_experiment',function(variant){if(variant=='expose'){action();}});}
if(!ideeli){ideeli={};}
ideeli.showOverlayWithVideo=function(content){var root=jQuery('#video-embed');var wrapper=root.find('.video-wrapper');wrapper.html(content);if(!ideeli.video_modal){ideeli.video_modal=new Control.Modal(Element.extend(root.get(0)),{closeOnClick:true,constrainToViewport:true,fade:false,overlayOpacity:0.5,offset:{x:0,y:2},afterClose:function(){wrapper.empty();jQuery(window).unbind('resize',ideeli.video_modal.positionHandler);}});jQuery(window).bind('resize',ideeli.video_modal.positionHandler);root.find('a[title=close]').click(function(e){e.preventDefault();e.stopPropagation();ideeli.video_modal.close();});}
setTimeout(function(){ideeli.video_modal.open(0.5,false);},100);};ideeli.bannerVideo={patterns:[/http:\/\/www.youtube.com\/watch\?v=([^&#]+)/,/http:\/\/www.youtube.com\/watch\/([^?#]+)/,/http:\/\/youtu.be\/(.+)/,/http:\/\/www.youtube.com\/embed\/([^?#]+)/],isYouTubeLink:function(url){return url&&this.videoId(url)!=null;},videoId:function(url){var videoId=null;jQuery.each(this.patterns,function(_,pattern){var match=pattern.exec(url);if(match&&match.length>1){videoId=match[1];}})
return videoId;},embedCode:function(vid){return'<iframe width="420" height="315" src="http://www.youtube.com/embed/'+vid+'" frameborder="0" allowfullscreen></iframe>'},extractHref:function(target){return target.attr('href')||target.parentsUntil('ul.banner li','[href]').attr('href');},init:function(){var self=this;jQuery(document).on('click','ul.banner li',function(e){var href=self.extractHref(jQuery(e.target));if(self.isYouTubeLink(href)){var vid=self.videoId(href);if(vid){e.preventDefault();e.stopPropagation();var content=self.embedCode(vid);ideeli.showOverlayWithVideo(content);}}});}};function QueryString(url){this._url=url;this._parameters=this.toObject();}
QueryString.prototype.hasParameterNamed=function(name){return this._parameters.hasOwnProperty(name);}
QueryString.prototype.parameterNamed=function(name){return this._parameters[name];}
QueryString.prototype.toObject=function(){var queryString=this.extractQueryString(this._url);var parameters=this.parseQueryString(queryString);return parameters}
QueryString.prototype.extractQueryString=function(url){var start=url.indexOf('?');var queryString='';if(start!=-1){start++;var end=url.indexOf('#');if(end==-1){queryString=url.substring(start);}else{queryString=url.substring(start,end);}}
return queryString;}
QueryString.prototype.parseQueryString=function(queryString){var pairs=queryString.split('&');var parameters={};function decode(x){return decodeURIComponent(x.replace(/\+/g," "));}
for(var i=0;i<pairs.length;i++){var pair=pairs[i];var keyAndValue=pair.split('=');if(keyAndValue.length==0)continue;if(keyAndValue.length==1){parameters[decode(keyAndValue[0])]=null;}else{parameters[decode(keyAndValue[0])]=decode(keyAndValue[1]);}}
return parameters;}
QueryString.current=function(){return new QueryString(window.location.search);}
QueryString.encode=function(object){return jQuery.param(object);}
function Nanigans(appId){this._appId=appId;}
Nanigans.prototype.track=function(options){options=this.merge(this.basicOptions(),options);if(!options.nan_pid)return;var trackingPixel=document.createElement('IMG');trackingPixel.style='display: none;';trackingPixel.src=this.baseUrl()+this.encodeAsParameters(options);document.body.appendChild(trackingPixel);return this;}
Nanigans.prototype.baseUrl=function(){return'//api.nanigans.com/event.php?';}
Nanigans.prototype.encodeAsParameters=function(options){return QueryString.encode(options);};Nanigans.prototype.trackLanding=function(){return this.track({type:'visit',name:'landing'});};Nanigans.prototype.trackAddToCart=function(sku,quantity,price){return this.track({type:'user',name:'add_to_cart',qty:quantity,sku:sku,value:price});}
Nanigans.prototype.trackProductPurchase=function(order,sku,quantity,price){return this.track({type:'purchase',name:'main',qty:quantity,sku:sku,value:price,unique:order+'-'+sku});}
Nanigans.prototype.trackRegistration=function(){return this.track({type:'install',name:'reg'});}
Nanigans.prototype.basicOptions=function(){var basic={app_id:this._appId,nan_pid:this.nanPid()};if(window.current_user){basic.user_id=window.current_user.id;}
return basic;}
Nanigans.prototype.nanPid=function(){var nanPid=this.nanPidFromUrl();if(nanPid){this.saveNanPidToCookie(nanPid);}else{nanPid=this.retrieveNanPidFromCookie();}
return nanPid;};Nanigans.prototype.nanPidFromUrl=function(){return QueryString.current().parameterNamed('nan_pid');}
Nanigans.prototype.saveNanPidToCookie=function(nanPid){return Cookie.set('nan_pid',nanPid,'_');}
Nanigans.prototype.retrieveNanPidFromCookie=function(){return Cookie.get('nan_pid');}
Nanigans.prototype.merge=function(){return jQuery.extend.apply(jQuery,jQuery.makeArray(arguments));}