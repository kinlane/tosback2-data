/* Copyright 2008-2012 Adometry, Inc. */
try{var DMTRY=DMTRY||{};DMTRY.CHANNEL=DMTRY.CHANNEL||{};(function(){var a="undefined";var b=DMTRY.CHANNEL;b.directory=b.directory||[];b.sendError=function(d){var e="log.dmtry.com",c="http://"+e+"/1.ver?at=e&d=ChannelError&msg="+encodeURIComponent(d);b.sendRequest(c)};b.sendRequest=function(d){var e=2048,c=new Image;c.border=0;c.vspace=0;c.hspace=0;c.height=1;c.width=1;if(c){if(d!=null&&d!=""){d=d.substring(0,e);if(d.length>0){c.src=d}}}else{throw new Error("No image created for log event")}return d};(function(d){var j={};try{var e=function(y){var x=this;x.qsPropertyKeys=y;x.propertyMap={}};j.scriptProps=null;j.isMaster=(d===0)?true:false;j.config={brand:"DMTRY",fPattern:/channel\.js/,host:"log.dmtry.com",ver:"chl-1.1.1",PATHORDER:["rand","bid","gid","pid","cid","sid","aid","srcid","advid"]};j.actions={refer:new e(["at","d","jsv","if","rev","chl_pass","chl","pg"]),link:new e(["at","d","jsv","if","rev","chl_pass","chl","pg"])};j.sendError=function(y){var x=r(j.config,j.scriptProps)+w(j.config,j.loggingProps)+"?at=e&d=ChannelInstError&msg="+encodeURIComponent(y);b.sendRequest(x)};var t=function(){var B={winObj:window,levelsUp:0},A=20,D=false,C=false,z;for(var y=window,x=0;;y=y.parent,x++){if(x==A){x=-1;break}try{if(y.document){B.winObj=y;B.levelsUp=x}else{C=true}}catch(E){C=true}if(y==y.parent){break}else{D=true}}z=x;return{bestWinObj:B.winObj,isTop:(z==B.levelsUp),inFrame:D,nonFriendlyPresent:C}};var l=function(x){if(x==null){throw new Error("invalid config")}var D={elem:null,protocol:"http",hash:null},z=x.brand||"tagproc",A=document.getElementsByTagName("script"),C,y,B;for(y=0;y<A.length;y++){D.elem=A[y];C=D.elem.src;if(C.search(x.fPattern)>=0&&D.elem[z]===undefined){D.elem[z]=true;B=C.indexOf(":");if(B>0){D.protocol=C.substring(0,B)}B=C.indexOf("#");if(B>0){D.hash=C.substring(B+1,C.length)}}}return D};var u=function(x,z){if(x==null){throw new Error("invalid config")}var y=t();s(x,z,y);if(j.isMaster===true){m(x,z,y)}};var s=function(z,C,A){var x="refer",D=C.hash,y={};try{y=j.actions[x].propertyMap}catch(B){b.sendError(B.message||"unknown")}if(D!=null&&D.length>0){o(z,y);i(y,D,A);y.at="v";y.d="Conv"}};var m=function(x,E,F){var D="link",y={},G={},C,z,B;try{y=j.actions[D].propertyMap}catch(A){b.sendError(A.message||"unknown")}if(F.bestWinObj!=null&&F.bestWinObj.document!=null){G=F.bestWinObj.document;C=G.URL;B=C.indexOf("?");if(B>-1){B=B+1;C=C.substring(B);z=n(C,"&","=");if(z!=null&&typeof z.dmtry!==a){o(x,y);i(y,z.dmtry,F);y.at="lk";y.d="Link"}}}};var i=function(E,y,z){var x="na",A,D=n(y,";",":"),z=z||t(),C=z.bestWinObj.document;for(A in D){if(D.hasOwnProperty(A)){E[A]=D[A]}}if(z.isTop===false){E["if"]=1;E.pg=C.referrer||x;E.chl=x}else{E.pg=C.URL||x;E.chl=C.referrer||x}if(D!=null&&typeof D.chl!==a&&D.chl.length>0){try{E.chl=decodeURIComponent(D.chl);E.chl_pass=1}catch(B){E.chl_pass=2}}};var r=function(y,z){var x=z.protocol||"http";x+="://";if(y.host!=null){x+=y.host+"/"}return x};var w=function(z,y){var C,B,A="",D=[],x=z.PATHORDER;for(C in x){if(x.hasOwnProperty(C)){B=x[C];D.push(y.propertyMap[B]||0)}}A+="redir/"+D.join("/")+"/1.ver";return A};var h=function(y,E){var z="",D=E.qsPropertyKeys,H=E.propertyMap,G=null,x,A,C=[],B=[],F=[];for(A=0;A<D.length;A++){G=D[A];x=H[G];if(x!=null&&typeof x!="function"){x=f(x);C.push(G+"="+x)}}for(G in H){if(H.hasOwnProperty(G)&&typeof H[G]!=="function"){if(!v(D,G)&&!v(j.config.PATHORDER,G)){B.push(G)}}}if(B.length>0){for(A=0;A<B.length;A++){G=B[A];x=H[G];F.push(G+"="+x)}C.push("cus="+f(F.join(";")))}if(C.length>0){z+="?"+C.join("&")}return z};var c=function(B,E,z){var A="",y,C,D,x=j.actions[z];y=r(B,E);C=w(B,x);D=h(B,x);if(y!=null&&C!=null&&D!=null&&y.length>0&&C.length>0&&D.length>0){A=y+C+D}return A};var f=function(y){if(y!=null&&typeof y!="function"){try{y=encodeURIComponent(y)}catch(x){y=escape(y)}}return y};var v=function(x,z){for(var y=0;y<x.length;y++){if(x[y]==z){return true}}return false};function o(y,x){x.jsv=y.ver||"na";x.rand=p(999999)}var n=function(y,x,D){if(y==null||y.length<1){return null}var F={},A=y.split(x),C,z,E,B;for(C=0;C<A.length;C++){z=A[C].indexOf(D);if(z>=0){E=A[C].substring(0,z);B=A[C].substring(z+1);F[E]=B}}return F};var p=function(x){var y=Math.random()*(x)+1;return Math.floor(y)};var k=function(){var x;if(j.config==null){throw new Error("invalid config")}j.scriptProps=l(j.config);u(j.config,j.scriptProps);if(j.isMaster===true){x=c(j.config,j.scriptProps,"link");b.sendRequest(x)}x=c(j.config,j.scriptProps,"refer");b.sendRequest(x)};b.directory.push(j);k()}catch(q){var g=q.message||"Unknown Channel Instance Error";if(typeof j.sendError!==a){j.sendError(g)}else{DMTRY.CHANNEL.sendError(g)}}})(b.directory.length)})()}catch(channelError){try{var msg=channelError.message||"Unknown Channel Error";DMTRY.CHANNEL.sendError(msg)}catch(lastEffortError){}};