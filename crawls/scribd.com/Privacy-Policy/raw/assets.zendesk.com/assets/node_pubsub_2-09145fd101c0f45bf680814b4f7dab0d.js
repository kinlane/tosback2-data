(function(){var c=this;function a(){return a}function b(g,e){var f=b.resolve(g),d=b.modules[f];if(!d){throw new Error('failed to require "'+g+'" from '+e)}if(!d.exports){d.exports={};d.call(d.exports,d,d.exports,b.relative(f),c)}return d.exports}b.modules={};b.resolve=function(f){var g=f,e=f+".js",d=f+"/index.js";return b.modules[e]&&e||b.modules[d]&&d||g};b.register=function(e,d){b.modules[e]=d};b.relative=function(d){return function(j){if("debug"==j){return a}if("."!=j.charAt(0)){return b(j)}var h=d.split("/"),f=j.split("/");h.pop();for(var g=0;g<f.length;g++){var e=f[g];if(".."==e){h.pop()}else{if("."!=e){h.push(e)}}}return b(h.join("/"),d)}};b.register("engine.io-client.js",function(f,d,e,g){d.version="0.2.2";d.protocol=1;d.util=e("./util");d.parser=e("./parser");d.Socket=e("./socket");d.EventEmitter=e("./event-emitter");d.Transport=e("./transport");d.transports=e("./transports")});b.register("event-emitter.js",function(g,e,f,i){g.exports=h;function h(){}h.prototype.on=function(j,k){if(!this.$events){this.$events={}}if(!this.$events[j]){this.$events[j]=k}else{if(d(this.$events[j])){this.$events[j].push(k)}else{this.$events[j]=[this.$events[j],k]}}return this};h.prototype.addListener=h.prototype.on;h.prototype.once=function(l,m){var k=this;function j(){k.removeListener(l,j);m.apply(this,arguments)}j.listener=m;this.on(l,j);return this};h.prototype.removeListener=function(k,n){if(this.$events&&this.$events[k]){var o=this.$events[k];if(d(o)){var p=-1;for(var m=0,j=o.length;m<j;m++){if(o[m]===n||(o[m].listener&&o[m].listener===n)){p=m;break}}if(p<0){return this}o.splice(p,1);if(!o.length){delete this.$events[k]}}else{if(o===n||(o.listener&&o.listener===n)){delete this.$events[k]}}}return this};h.prototype.removeAllListeners=function(j){if(j===undefined){this.$events={};return this}if(this.$events&&this.$events[j]){this.$events[j]=null}return this};h.prototype.listeners=function(j){if(!this.$events){this.$events={}}if(!this.$events[j]){this.$events[j]=[]}if(!d(this.$events[j])){this.$events[j]=[this.$events[j]]}return this.$events[j]};h.prototype.emit=function(m){if(!this.$events){return false}var p=this.$events[m];if(!p){return false}var k=Array.prototype.slice.call(arguments,1);if("function"==typeof p){p.apply(this,k)}else{if(d(p)){var o=p.slice();for(var n=0,j=o.length;n<j;n++){o[n].apply(this,k)}}else{return false}}return true};function d(j){return"[object Array]"==Object.prototype.toString.call(j)}h.prototype.addEventListener=h.prototype.on;h.prototype.removeEventListener=h.prototype.removeListener;h.prototype.dispatchEvent=h.prototype.emit});b.register("parser.js",function(h,e,g,j){var d=g("./util");var k=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var f=d.keys(k);var i={type:"error",data:"parser error"};e.encodePacket=function(m){var l=k[m.type];if(undefined!==m.data){l+=String(m.data)}return""+l};e.decodePacket=function(m){var l=m.charAt(0);if(Number(l)!=l||!f[l]){return i}if(m.length>1){return{type:f[l],data:m.substring(1)}}else{return{type:f[l]}}};e.encodePayload=function(q){if(!q.length){return"0:"}var p="",o;for(var n=0,m=q.length;n<m;n++){o=e.encodePacket(q[n]);p+=o.length+":"+o}return p};e.decodePayload=function(t){if(t==""){return[i]}var v=[],o="",p,q,m;for(var u=0,r=t.length;u<r;u++){var s=t.charAt(u);if(":"!=s){o+=s}else{if(""==o||(o!=(p=Number(o)))){return[i]}q=t.substr(u+1,p);if(o!=q.length){return[i]}if(q.length){m=e.decodePacket(q);if(i.type==m.type&&i.data==m.data){return[i]}v.push(m)}u+=p;o=""}}if(o!=""){return[i]}return v}});b.register("socket.js",function(h,k,i,f){var l=i("./util"),j=i("./transports"),d=i("debug")("engine-client:socket"),n=i("./event-emitter");h.exports=e;function e(p){if("string"==typeof p){var o=l.parseUri(p);p=arguments[1]||{};p.host=o.host;p.secure=o.scheme=="https"||o.scheme=="wss";p.port=o.port||(p.secure?443:80)}p=p||{};this.secure=p.secure||false;this.host=p.host||p.hostname||"localhost";this.port=p.port||80;this.query=p.query||{};this.query.uid=g();this.upgrade=false!==p.upgrade;this.resource=p.resource||"default";this.path=(p.path||"/engine.io").replace(/\/$/,"");this.path+="/"+this.resource+"/";this.forceJSONP=!!p.forceJSONP;this.timestampParam=p.timestampParam||"t";this.timestampRequests=!!p.timestampRequests;this.flashPath=p.flashPath||"";this.transports=p.transports||["polling","websocket","flashsocket"];this.readyState="";this.writeBuffer=[];this.policyPort=p.policyPort||843;this.open()}l.inherits(e,n);e.prototype.createTransport=function(o){d('creating transport "%s"',o);var p=m(this.query);p.transport=o;if(this.id){p.sid=this.id}var q=new j[o]({host:this.host,port:this.port,secure:this.secure,path:this.path,query:p,forceJSONP:this.forceJSONP,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,flashPath:this.flashPath,policyPort:this.policyPort});return q};function m(q){var r={};for(var p in q){if(q.hasOwnProperty(p)){r[p]=q[p]}}return r}e.prototype.open=function(){this.readyState="opening";var o=this.createTransport(this.transports[0]);o.open();this.setTransport(o)};e.prototype.setTransport=function(p){var o=this;if(this.transport){d("clearing existing transport");this.transport.removeAllListeners()}this.transport=p;p.on("drain",function(){o.flush()}).on("packet",function(q){o.onPacket(q)}).on("error",function(q){o.onError(q)}).on("close",function(){o.onClose("transport close")})};e.prototype.probe=function(p){d('probing transport "%s"',p);var q=this.createTransport(p,{probe:1}),o=this;q.once("open",function(){d('probe transport "%s" opened',p);q.send([{type:"ping",data:"probe"}]);q.once("packet",function(s){if("pong"==s.type&&"probe"==s.data){d('probe transport "%s" pong',p);o.upgrading=true;o.emit("upgrading",q);d('pausing current transport "%s"',o.transport.name);o.transport.pause(function(){if("closed"==o.readyState||"closing"==o.readyState){return}d("changing transport and sending upgrade packet");o.emit("upgrade",q);o.setTransport(q);q.send([{type:"upgrade"}]);q=null;o.upgrading=false;o.flush()})}else{d('probe transport "%s" failed',p);var r=new Error("probe error");r.transport=q.name;o.emit("error",r)}})});q.open();this.once("close",function(){if(q){d("socket closed prematurely - aborting probe");q.close();q=null}});this.once("upgrading",function(r){if(q&&r.name!=q.name){d('"%s" works - aborting "%s"',r.name,q.name);q.close();q=null}})};e.prototype.onOpen=function(){d("socket open");this.readyState="open";this.emit("open");this.onopen&&this.onopen.call(this);this.flush();if(this.upgrade&&this.transport.pause){d("starting upgrade probes");for(var p=0,o=this.upgrades.length;p<o;p++){this.probe(this.upgrades[p])}}};e.prototype.onPacket=function(q){if("opening"==this.readyState||"open"==this.readyState){d('socket receive: type "%s", data "%s"',q.type,q.data);switch(q.type){case"open":this.onHandshake(l.parseJSON(q.data));break;case"ping":this.sendPacket("pong");this.setPingTimeout();break;case"error":var p=new Error("server error");p.code=q.data;this.emit("error",p);break;case"message":this.emit("message",q.data);var o={data:q.data};o.toString=function(){return q.data};this.onmessage&&this.onmessage.call(this,o);break}}else{d('packet received with socket readyState "%s"',this.readyState)}};e.prototype.onHandshake=function(o){this.emit("handshake",o);this.id=o.sid;this.transport.query.sid=o.sid;this.upgrades=o.upgrades;this.pingTimeout=o.pingTimeout;this.onOpen();this.setPingTimeout()};e.prototype.setPingTimeout=function(){clearTimeout(this.pingTimeoutTimer);var o=this;this.pingTimeoutTimer=setTimeout(function(){o.onClose("ping timeout")},this.pingTimeout)};e.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){d("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.writeBuffer=[]}};e.prototype.send=function(o){this.sendPacket("message",o);return this};e.prototype.sendPacket=function(o,p){var q={type:o,data:p};this.writeBuffer.push(q);this.flush()};e.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.onClose("forced close");d("socket closing - telling transport to close");this.transport.close()}return this};e.prototype.onError=function(o){this.emit("error",o);this.onClose("transport error",o)};e.prototype.onClose=function(o,p){if("closed"!=this.readyState){d('socket close with reason: "%s"',o);this.readyState="closed";this.emit("close",o,p);this.onclose&&this.onclose.call(this)}};function g(){return String(Math.random()).substr(5)+String(Math.random()).substr(5)}});b.register("transport.js",function(g,e,f,i){var d=f("./util"),k=f("./parser"),h=f("./event-emitter");g.exports=j;function j(l){this.path=l.path;this.host=l.host;this.port=l.port;this.secure=l.secure;this.query=l.query;this.timestampParam=l.timestampParam;this.timestampRequests=l.timestampRequests;this.readyState=""}d.inherits(j,h);j.prototype.onError=function(n,m){var l=new Error(n);l.type="TransportError";l.description=m;this.emit("error",l);return this};j.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};j.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};j.prototype.send=function(l){if("open"==this.readyState){this.write(l)}else{throw new Error("Transport not open")}};j.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};j.prototype.onData=function(l){this.onPacket(k.decodePacket(l))};j.prototype.onPacket=function(l){this.emit("packet",l)};j.prototype.onClose=function(){this.readyState="closed";this.emit("close")}});b.register("transports/flashsocket.js",function(f,i,g,d){var e=g("./websocket"),l=g("../util");f.exports=j;function j(n){e.call(this,n);this.flashPath=n.flashPath;this.policyPort=n.policyPort}l.inherits(j,e);j.prototype.name="flashsocket";j.prototype.doOpen=function(){if(!this.check()){return}function o(q){return function(){var r=Array.prototype.join.call(arguments," ")}}WEB_SOCKET_LOGGER={log:o("debug"),error:o("error")};WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=true;WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=true;if("undefined"==typeof WEB_SOCKET_SWF_LOCATION){WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf"}var p=[this.flashPath+"web_socket.js"];if("undefined"==typeof swfobject){p.unshift(this.flashPath+"swfobject.js")}var n=this;m(p,function(){n.ready(function(){WebSocket.__addTask(function(){e.prototype.doOpen.call(n)})})})};j.prototype.doClose=function(){if(!this.socket){return}var n=this;WebSocket.__addTask(function(){e.prototype.doClose.call(n)})};j.prototype.write=function(){var n=this,o=arguments;WebSocket.__addTask(function(){e.prototype.write.apply(n,o)})};j.prototype.ready=function(o){if(typeof WebSocket=="undefined"||!("__initialize" in WebSocket)||!swfobject){return}if(swfobject.getFlashPlayerVersion().major<10){return}function p(){if(!j.loaded){if(843!=n.policyPort){WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort)}WebSocket.__initialize();j.loaded=true}o.call(n)}var n=this;if(document.body){return p()}l.load(p)};j.prototype.check=function(){if(typeof WebSocket!="undefined"&&!("__initialize" in WebSocket)){return false}if(window.ActiveXObject){var s=null;try{s=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(r){}if(s){return true}}else{for(var q=0,o=navigator.plugins.length;q<o;q++){for(var p=0,n=navigator.plugins[q].length;p<n;p++){if(navigator.plugins[q][p].description=="Shockwave Flash"){return true}}}}return false};var h={};function k(r,q){if(h[r]){return q()}var p=document.createElement("script"),n=false;p.onload=p.onreadystatechange=function(){if(n||h[r]){return}var s=p.readyState;if(!s||"loaded"==s||"complete"==s){p.onload=p.onreadystatechange=null;n=true;h[r]=true;q()}};p.async=1;p.src=r;var o=document.getElementsByTagName("head")[0];o.insertBefore(p,o.firstChild)}function m(n,o){function p(q){if(!n[q]){return o()}k(n[q],function(){p(++q)})}p(0)}});b.register("transports/index.js",function(e,i,g,d){var m=g("./polling-xhr"),l=g("./polling-jsonp"),h=g("./websocket"),j=g("./flashsocket"),k=g("../util");i.polling=f;i.websocket=h;i.flashsocket=j;function f(n){var q,o=false,p=false;if(d.location){o=n.host!=d.location.hostname||d.location.port!=n.port;p=(n.secure!==(d.location.protocol==="https:"))}q=k.request(o);if(p&&d.XDomainRequest&&q instanceof d.XDomainRequest){return new l(n)}if(q&&!n.forceJSONP){return new m(n)}else{return new l(n)}}});b.register("transports/polling-jsonp.js",function(e,g,f,d){var n=f("./polling"),h=f("../util");e.exports=j;var l=/\n/g;var m;var k=0;function i(){}function j(p){n.call(this,p);if(!m){if(!d.___eio){d.___eio=[]}m=d.___eio}this.index=m.length;var o=this;m.push(function(q){o.onData(q)});this.query.j=this.index}h.inherits(j,n);j.prototype.doOpen=function(){var o=this;h.defer(function(){n.prototype.doOpen.call(o)})};j.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null}n.prototype.doClose.call(this)};j.prototype.doPoll=function(){var o=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}o.async=true;o.src=this.uri();var p=document.getElementsByTagName("script")[0];p.parentNode.insertBefore(o,p);this.script=o;if(h.ua.gecko){setTimeout(function(){var q=document.createElement("iframe");document.body.appendChild(q);document.body.removeChild(q)},100)}};j.prototype.doWrite=function(u,w){var x=this;if(!this.form){var p=document.createElement("form"),q=document.createElement("textarea"),o=this.iframeId="eio_iframe_"+this.index,t;p.className="socketio";p.style.position="absolute";p.style.top="-1000px";p.style.left="-1000px";p.target=o;p.method="POST";p.setAttribute("accept-charset","utf-8");q.name="d";p.appendChild(q);document.body.appendChild(p);this.form=p;this.area=q}this.form.action=this.uri();function r(){s();w()}function s(){if(x.iframe){x.form.removeChild(x.iframe)}try{t=document.createElement('<iframe name="'+x.iframeId+'">')}catch(y){t=document.createElement("iframe");t.name=x.iframeId}t.id=x.iframeId;x.form.appendChild(t);x.iframe=t}s();this.area.value=u.replace(l,"\\n");try{this.form.submit()}catch(v){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(x.iframe.readyState=="complete"){r()}}}else{this.iframe.onload=r}}});b.register("transports/polling-xhr.js",function(f,h,g,e){var l=g("./polling"),m=g("../event-emitter"),i=g("../util");f.exports=j;f.exports.Request=d;function k(){}function j(n){l.call(this,n);if(e.location){this.xd=n.host!=e.location.hostname||e.location.port!=n.port}}i.inherits(j,l);j.prototype.doOpen=function(){var n=this;i.defer(function(){l.prototype.doOpen.call(n)})};j.prototype.request=function(n){n=n||{};n.uri=this.uri();n.xd=this.xd;return new d(n)};j.prototype.doWrite=function(q,o){var p=this.request({method:"POST",data:q}),n=this;p.on("success",o);p.on("error",function(r){n.onError("xhr post error",r)});this.sendXhr=p};j.prototype.doPoll=function(){var o=this.request(),n=this;o.on("data",function(p){n.onData(p)});o.on("error",function(p){n.onError("xhr poll error",p)});this.pollXhr=o};function d(n){this.method=n.method||"GET";this.uri=n.uri;this.xd=!!n.xd;this.async=false!==n.async;this.data=undefined!=n.data?n.data:null;this.create()}i.inherits(d,m);d.prototype.create=function(){var p=this.xhr=i.request(this.xd),n=this;p.open(this.method,this.uri,this.async);if("POST"==this.method){try{if(p.setRequestHeader){p.setRequestHeader("Content-type","text/plain;charset=UTF-8")}else{p.contentType="text/plain"}}catch(o){}}if(this.xd&&e.XDomainRequest&&p instanceof XDomainRequest){p.onerror=function(q){n.onError(q)};p.onload=function(){n.onData(p.responseText)};p.onprogress=k}else{if("withCredentials" in p){p.withCredentials=true}p.onreadystatechange=function(){var q;try{if(4!=p.readyState){return}if(200==p.status||1223==p.status){q=p.responseText}else{n.onError(p.status)}}catch(r){n.onError(r)}if(undefined!==q){n.onData(q)}}}p.send(this.data);if(e.ActiveXObject){this.index=d.requestsCount++;d.requests[this.index]=this}};d.prototype.onSuccess=function(){this.emit("success");this.cleanup()};d.prototype.onData=function(n){this.emit("data",n);this.onSuccess()};d.prototype.onError=function(n){this.emit("error",n);this.cleanup()};d.prototype.cleanup=function(){this.xhr.onreadystatechange=k;this.xhr.onload=this.xhr.onerror=k;try{this.xhr.abort()}catch(n){}if(e.ActiveXObject){delete d.requests[this.index]}this.xhr=null};d.prototype.abort=function(){this.cleanup()};if(e.ActiveXObject){d.requestsCount=0;d.requests={};e.attachEvent("onunload",function(){for(var n in d.requests){if(d.requests.hasOwnProperty(n)){d.requests[n].abort()}}})}});b.register("transports/polling.js",function(g,e,f,i){var k=f("../transport"),d=f("../util"),j=f("../parser");g.exports=h;function h(l){k.call(this,l)}d.inherits(h,k);h.prototype.name="polling";h.prototype.doOpen=function(){this.poll()};h.prototype.pause=function(l){var p=0,m=this;this.readyState="pausing";function o(){m.readyState="paused";l()}if(this.polling||!this.writable){var n=0;if(this.polling){n++;this.once("pollComplete",function(){--n||o()})}if(!this.writable){n++;this.once("drain",function(){--n||o()})}}else{o()}};h.prototype.poll=function(){this.polling=true;this.doPoll();this.emit("poll")};h.prototype.onData=function(o){var p=j.decodePayload(o);for(var n=0,m=p.length;n<m;n++){if("opening"==this.readyState){this.onOpen()}if("close"==p[n].type){this.onClose();return}this.onPacket(p[n])}this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{}};h.prototype.doClose=function(){this.send([{type:"close"}])};h.prototype.write=function(m){var l=this;this.writable=false;this.doWrite(j.encodePayload(m),function(){l.writable=true;l.emit("drain")})};h.prototype.uri=function(){var n=this.query||{},m=this.secure?"https":"http",l="";if(i.ActiveXObject||d.ua.android||this.timestampRequests){n[this.timestampParam]=+new Date}n=d.qs(n);if(this.port&&(("https"==m&&this.port!=443)||("http"==m&&this.port!=80))){l=":"+this.port}if(n.length){n="?"+n}return m+"://"+this.host+l+this.path+n}});b.register("transports/websocket.js",function(g,i,h,e){var j=h("../transport"),d=h("../parser"),k=h("../util");g.exports=f;function f(m){j.call(this,m)}k.inherits(f,j);f.prototype.name="websocket";f.prototype.doOpen=function(){if(!this.check()){return}var m=this;this.socket=new (l())(this.uri());this.socket.onopen=function(){m.onOpen()};this.socket.onclose=function(){m.onClose()};this.socket.onmessage=function(n){m.onData(n.data)};this.socket.onerror=function(n){m.onError("websocket error",n)}};f.prototype.write=function(o){for(var n=0,m=o.length;n<m;n++){this.socket.send(d.encodePacket(o[n]))}};f.prototype.doClose=function(){if(typeof this.socket!=="undefined"){this.socket.close()}};f.prototype.uri=function(){var o=this.query||{},n=this.secure?"wss":"ws",m="";if(this.port&&(("wss"==n&&this.port!=443)||("ws"==n&&this.port!=80))){m=":"+this.port}if(this.timestampRequests){o[this.timestampParam]=+new Date}o=k.qs(o);if(o.length){o="?"+o}return n+"://"+this.host+m+this.path+o};f.prototype.check=function(){var m=l();return !!m&&!("__initialize" in m&&this.name===f.prototype.name)};function l(){return e.WebSocket||e.MozWebSocket}});b.register("util.js",function(e,j,f,d){var p=false;j.inherits=function o(t,s){function u(){}u.prototype=s.prototype;t.prototype=new u};j.keys=Object.keys||function(v){var t=[],s=Object.prototype.hasOwnProperty;for(var u in v){if(s.call(v,u)){t.push(u)}}return t};j.on=function(t,v,u,s){if(t.attachEvent){t.attachEvent("on"+v,u)}else{if(t.addEventListener){t.addEventListener(v,u,s)}}};j.load=function(s){if(d.document&&document.readyState==="complete"||p){return s()}j.on(d,"load",s,false)};if("undefined"!=typeof window){j.load(function(){p=true})}j.defer=function(s){if(!j.ua.webkit||"undefined"!=typeof importScripts){return s()}j.load(function(){setTimeout(s,100)})};var k=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,n=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,g=/(?:^|:|,)(?:\s*\[)+/g,l=/^\s+/,m=/\s+$/;j.parseJSON=function(s){if("string"!=typeof s||!s){return null}s=s.replace(l,"").replace(m,"");if(d.JSON&&JSON.parse){return JSON.parse(s)}if(k.test(s.replace(r,"@").replace(n,"]").replace(g,""))){return(new Function("return "+s))()}};j.ua={};j.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&(function(){try{var s=new XMLHttpRequest()}catch(t){return false}return s.withCredentials!=undefined})();j.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);j.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);j.ua.android="undefined"!=typeof navigator&&/android/i.test(navigator.userAgent);j.request=function i(s){if(s&&"undefined"!=typeof XDomainRequest&&!j.ua.hasCORS){return new XDomainRequest()}try{if("undefined"!=typeof XMLHttpRequest&&(!s||j.ua.hasCORS)){return new XMLHttpRequest()}}catch(t){}if(!s){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}};var q=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var h=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];j.parseUri=function(v){var s=q.exec(v||""),u={},t=14;while(t--){u[h[t]]=s[t]||""}return u};j.qs=function(t){var u="";for(var s in t){if(t.hasOwnProperty(s)){if(u.length){u+="&"}u+=s+"="+encodeURIComponent(t[s])}}return u}});eio=b("engine.io-client")})();var MiniEventEmitter=function(){};MiniEventEmitter.prototype.each=function(g,e,d){var f={};if(g==null){return}if(Array.prototype.forEach&&g.forEach===Array.prototype.forEach){g.forEach(e,d)}else{if(g.length===+g.length){for(var c=0,a=g.length;c<a;c++){if(c in g&&e.call(d,g[c],c,g)===f){return}}}else{for(var b in g){if(g.hasOwnProperty(b)){if(e.call(d,g[b],b,g)===f){return}}}}}};MiniEventEmitter.prototype.filter=function(d,c,b){var a=[];if(d==null){return a}if(Array.prototype.filter&&d.filter===Array.prototype.filter){return d.filter(c,b)}MiniEventEmitter.prototype.each(d,function(g,e,f){if(c.call(b,g,e,f)){a[a.length]=g}});return a};MiniEventEmitter.prototype.on=function(a,b){if(a instanceof RegExp){this._routes||(this._routes=[]);this._routes.unshift([a,b])}else{this._events||(this._events={});this._events[a]||(this._events[a]=[]);this._events[a].unshift(b)}return this};MiniEventEmitter.prototype.addListener=MiniEventEmitter.prototype.on;MiniEventEmitter.prototype.once=function(c,d){var b=this;function a(){b.removeListener(c,a);d.apply(this,arguments)}a.listener=d;b.on(c,a);return this};MiniEventEmitter.prototype.when=function(c,d){var b=this;function a(){if(d.apply(this,arguments)){b.removeListener(c,a)}}a.listener=d;b.on(c,a);return this};MiniEventEmitter.prototype.removeListener=function(a,b){if(a instanceof RegExp&&this._routes){this._routes=MiniEventEmitter.prototype.filter(this._routes,function(c){return !(c[0].toString()==a.toString()&&(c[1]===b||(c[1].listener&&c[1].listener===b)))})}else{if(this._events&&this._events[a]){this._events[a]=MiniEventEmitter.prototype.filter(this._events[a],function(c){return !(c===b||(c.listener&&c.listener===b))})}}return this};MiniEventEmitter.prototype.removeAllListeners=function(a){if(arguments.length===0){this._events={};this._routes=[];return}if(a instanceof RegExp&&this._routes){this._routes=MiniEventEmitter.prototype.filter(this._routes,function(b){return !(b[0].toString()==a.toString())})}else{if(this._events&&this._events[a]){this._events[a]=[]}}return this};MiniEventEmitter.prototype.emit=function(c){var a=Array.prototype.slice.call(arguments,1);if(this._events&&this._events[c]){for(var b=this._events[c].length-1;b>-1&&this._events[c]&&this._events[c][b];b--){this._events[c][b].apply(this,a)}}if(this._routes){for(var b=this._routes.length-1;b>-1;b--){if(this._routes[b][0].test(c)){this._routes[b][1].apply(this,a)}}}return this};MiniEventEmitter.mixin=function(a){var c=["on","removeListener","removeAllListeners","emit","next","once","when"];for(var b=0;b<c.length;b++){a.prototype[c[b]]=MiniEventEmitter.prototype[c[b]]}};(function(){(function(){function i(u,m){for(var w=[],q=u.split("/"),l,p,v=0;p=q[v++];){".."==p?w.pop():"."!=p&&w.push(p)}w=w.join("/"),v=i,p=v.m[m||0],l=p[w+".js"]||p[w+"/index.js"]||p[w];if(p=l.c){l=v.m[m=p][u=l.m]}return l.exports||l(l,l.exports={},function(o){return v("."!=o.charAt(0)?o:u+"/../"+o,m)}),l.exports}i.m=[];i.m[0]={"engine.io-client":{exports:window.eio},"lib/backoff.js":function(n,l,m){function o(){this.failures=0}o.durations=[1000,2000,4000,8000,16000,32000];o.prototype.get=function(){return o.durations[this.failures]||99999000};o.prototype.increment=function(){this.failures++};o.prototype.success=function(){this.failures=0};n.exports=o},"lib/index.js":function(o,m,n){var p=n("./radar_client"),l=new p();l._log=n("minilog");o.exports=l},"lib/radar_client.js":function(l,p,n){var o=n("minilog")("radar_client"),u=n("microee"),r=n("engine.io-client"),t=n("./scope.js"),w=n("./state.js");function m(y){var x=this;this._me={accountName:"",userId:0,userType:0};this._ackCounter=1;this._channelSyncTimes={};this._users={};this.manager=new w();if(!y){y=r}this.manager.createSocket=function(z){return new y.Socket(z)};this.manager.handleMessage=function(A){try{A=JSON.parse(A)}catch(z){throw z}A.direction="in";o.info(A);switch(A.op){case"err":case"ack":case"get":x.emit(A.op,A);break;case"sync":x._batch(A);break;default:x.emit(A.to,A)}}}u.mixin(m);m.prototype.alloc=function(y,z){var x=this;o.info({op:"alloc",name:y});this._users[y]=true;z&&this.once("ready",function(){x._users.hasOwnProperty(y)&&z()});this.manager.connect();return this};m.prototype.dealloc=function(x){o.info({op:"dealloc",name:x});delete this._users[x];var z=0,y;for(y in this._users){if(this._users.hasOwnProperty(y)){z++}}if(z===0){this.manager.disconnect()}};m.prototype.configure=function(x){x||(x={});x.userType||(x.userType=0);this._me=x;this.manager.configure(this,x);return this};m.prototype.message=function(x){return new t("message:/"+this._me.accountName+"/"+x,this)};m.prototype.presence=function(x){return new t("presence:/"+this._me.accountName+"/"+x,this)};m.prototype.status=function(x){return new t("status:/"+this._me.accountName+"/"+x,this)};m.prototype.set=function(x,y,z){return this._write({op:"set",to:x,value:y,key:this._me.userId,type:this._me.userType},z)};m.prototype.publish=function(x,y,z){return this._write({op:"publish",to:x,value:y},z)};m.prototype.subscribe=function(x,y){return this._write({op:"subscribe",to:x},y)};m.prototype.unsubscribe=function(x,y){return this._write({op:"unsubscribe",to:x},y)};var v=function(x){m.prototype[x]=function(z,y,B){var A={op:x,to:z};if(typeof y=="function"){B=y}else{A.options=y}if(x=="sync"&&!A.options&&z.match(/^presence.+/)){this.once(z,B)}else{this.when("get",function(C){if(!C||!C.to||C.to!=z){return false}B&&B(C);return true})}return this._write(A)}};var s=["get","sync"];for(var q=0;q<s.length;q++){v(s[q])}m.prototype._write=function(x,y){if(this._me&&this._me.auth){x.auth=this._me.auth;x.userId=this._me.userId;x.userType=this._me.userType;x.accountName=this._me.accountName}if(y){x.ack=this._ackCounter++;this.when("ack",function(z){if(!z||!z.value||z.value!=x.ack){return false}y(x);return true})}this.manager.send(x);return this};m.prototype._batch=function(E){if(!(E.to&&E.value&&E.time)){return}var x=0,A=E.value.length,y=E.time,D=this._channelSyncTimes[E.to]||0;for(;x<A;x=x+2){var z=E.value[x],C=E.value[x+1];try{z=JSON.parse(z)}catch(B){throw B}if(C>D){this.emit(E.to,z)}if(C>y){y=C}}this._channelSyncTimes[E.to]=y};m.setBackend=function(x){r=x};l.exports=m},"lib/reconnector.js":function(o,l,m){var p=m("minilog")("radar_reconnect");function n(q){this.subscriptions={};this.presences={};this.mqueue=[];this.client=q;this.waitCounter=0}n.prototype.memorize=function(q){switch(q.op){case"unsubscribe":if(this.subscriptions[q.to]){delete this.subscriptions[q.to]}break;case"sync":case"subscribe":if(this.subscriptions[q.to]!="sync"){this.subscriptions[q.to]=q.op}break;case"set":if(q.to.substr(0,"presence:/".length)=="presence:/"){this.presences[q.to]=q.value}break}};n.prototype.queue=function(q){p.info("Queue message",q);this.mqueue.push(q)};n.prototype.restore=function(q){var r=this,u=0,w,t;function v(){r.waitCounter--;if(r.waitCounter===0){q()}}p.info({event:"restore-subscriptions"});for(w in this.subscriptions){if(!this.subscriptions.hasOwnProperty(w)){continue}var s=this.subscriptions[w];this.waitCounter++;u++;this.client[s](w,v)}for(w in this.presences){if(!this.presences.hasOwnProperty(w)){continue}this.waitCounter++;u++;this.client.set(w,this.presences[w],v)}t=this.mqueue.shift();while(t){this.client.manager._sendPacket(JSON.stringify(t));t=this.mqueue.shift()}if(u===0){q()}};o.exports=n},"lib/scope.js":function(p,m,n){function l(t,s){this.prefix=t;this.client=s}var q=["set","get","subscribe","unsubscribe","publish","sync","on","once","when","removeListener","removeAllListeners"];var r=function(s){l.prototype[s]=function(){var t=Array.prototype.slice.apply(arguments);t.unshift(this.prefix);this.client[s].apply(this.client,t);return this}};for(var o=0;o<q.length;o++){r(q[o])}p.exports=l},"lib/state.js":function(l,q,n){var p=n("minilog")("radar_state"),o=n("./reconnector"),r=n("microee"),m=n("./backoff");function t(){var u=this;this.connections=0;this._state=t.states.stopped;this.socket=null;this.queue=[];this.transitionTimer=null;this.socketConfig=null;this.guard=null;this.backoff=new m();this._timeout=null;this.sink=new r();this.createSocket=null;this.handleMessage=null;this.reconnector=null;this.waitingForConfig=false;this.auditSent=0;this.auditReceived=0}var s=t.states={permanently_disconnected:-2,stopped:-1,waiting:1,reconnect:2,disconnecting:3,connecting:4,connected:5,ready:6};t.prototype.set=function(u){if(typeof u!=="undefined"){p.debug({op:"change-state",from:this._state,to:u});this._state=u}};t.prototype.configure=function(v,u){u||(u={});u.upgrade=false;this.socketConfig=u;v&&(this.sink=v);if(this.waitingForConfig&&this._state==s.stopped){this.waitingForConfig=false;this.connect()}};t.prototype.connect=function(){if(this._state==s.stopped&&this.socketConfig){this.reconnector=new o(this.sink);this.set(s.reconnect)}else{this.waitingForConfig=true}this.run()};t.prototype.send=function(u){if(this._state<0){if(!this.socketConfig||!this.sink){return}this.connect()}this.reconnector.memorize(u);if(this._state<5){this.reconnector.queue(u)}else{this._sendPacket(JSON.stringify(u));u.direction="out";p.info(u)}};t.prototype._sendPacket=function(u){this.auditSent++;this.socket.sendPacket("message",u)};t.prototype.disconnect=function(){var u=this;p.info({op:"explicit-disconnect"});if(!this.socketConfig){this.waitingForConfig=false;return}this.set(s.disconnecting);if(this.socket){this.socket.removeAllListeners("close");this.socket.on("close",function(){u.set(s.stopped)});this.socket.close()}this.run()};t.prototype._connect=function(){if(this._state!=s.reconnect){p.error("Connect is only allowed from reconnecting state!");return}var v=this;var u=this.socket=this.createSocket(this.socketConfig);this.auditSent=0;this.auditReceived=0;u.once("open",function(){v.set(s.connected);v.run()});u.on("message",this.handleMessage);u.on("message",function(){v.auditReceived++});u.once("close",function(){v.handleDisconnect()});this._startGuard(function(){p.warn({event:"connection-guard-timeout"});v.handleDisconnect()},this.backoff.get()+6000);this.set(s.connecting)};t.prototype.handleDisconnect=function(){this._cancelGuard();this.backoff.increment();this.set(s.reconnect);if(this.backoff.get()>9000000){this.set(s.permanently_disconnected);this.retransition(1000)}else{this.retransition(this.backoff.get())}this.sink.emit("disconnected");p.info({event:"disconnected",wait:this.backoff.get()})};t.prototype.run=function(){var u=this,v=t.states;if(this.socketConfig){p.debug({op:"run-state",state:this._state})}switch(this._state){case v.permanently_disconnected:this.sink.emit("unavailable");break;case v.stopped:this.sink.emit("disconnected");break;case v.waiting:break;case v.reconnect:this._connect(this.socketConfig);break;case v.disconnecting:case v.connecting:this.retransition(1000);break;case v.connected:this._cancelGuard();this.reconnector.restore(function(){u.set(v.ready);u.run()});break;case v.ready:this.connections++;this.backoff.success();if(this.connections==1){this.sink.emit("connected")}else{this.sink.emit("reconnected")}this.sink.emit("ready");break}};t.prototype.retransition=function(v){var u=this;this._timeout=v;if(!this.transitionTimer){this.transitionTimer=setTimeout(function(){u.transitionTimer=null;p.info("Ran transition after",v);u.run()},v)}};t.prototype._startGuard=function(v,u){p.debug({event:"start guard",timeout:u});this.guard&&clearTimeout(this.guard);this.guard=setTimeout(v,u)};t.prototype._cancelGuard=function(){p.debug({event:"cancel-guard"});this.guard&&clearTimeout(this.guard)};t._setTimeout=function(u){setTimeout=u};l.exports=t},microee:{c:1,m:"/index.js"},minilog:{exports:window.Minilog}};i.m[1]={"/index.js":function(n,l,m){function o(){this._events={}}o.prototype={on:function(q,p){this._events||(this._events={});var r=this._events;(r[q]||(r[q]=[])).push(p);return this},removeListener:function(r,p){var s=this._events[r]||[],q;for(q=s.length-1;q>=0&&s[q];q--){if(s[q]===p||s[q].cb===p){s.splice(q,1)}}},removeAllListeners:function(p){if(!p){this._events={}}else{this._events[p]&&(this._events[p]=[])}},emit:function(r){this._events||(this._events={});var p=Array.prototype.slice.call(arguments,1),q,s=this._events[r]||[];for(q=s.length-1;q>=0&&s[q];q--){s[q].apply(this,p)}return this},when:function(q,p){return this.once(q,p,true)},once:function(r,q,p){if(!q){return this}function s(){if(!p){this.removeListener(r,s)}if(q.apply(this,arguments)&&p){this.removeListener(r,s)}}s.cb=q;this.on(r,s);return this}};o.mixin=function(q){var r=o.prototype,p;for(p in r){r.hasOwnProperty(p)&&(q.prototype[p]=r[p])}};n.exports=o}};RadarClient=i("lib/index.js")}());var c=0,d=10*60*1000;var k;var j=function(){if(!k){k=jQuery.ajax("/api/v2/users/radar_token.json",{dataType:"json",cache:false,success:function(i){if(i.auth){RadarClient._me.auth=i.auth;RadarClient._me.token_time=new Date().getTime()}}}).always(function(){k=null})}return k.promise()};RadarClient.on("err",function(i){if(i.value=="auth_expiring"&&c<new Date().getTime()-d){c=new Date().getTime();j()}});var f=["set","get","subscribe","unsubscribe","publish","sync","on","once","when","removeListener","removeAllListeners"];var h=function(i){return function(){var l=Array.prototype.slice.apply(arguments);var m=(RadarClient._me.token_time<new Date().getTime()-(30*60*1000));if((window.location.protocol=="https:")&&(!RadarClient._me.token_time||m)){j().always(function(){i.apply(RadarClient,l)});return RadarClient}else{return i.apply(RadarClient,l)}}};for(var e=0;e<f.length;e++){var a=RadarClient[f[e]];RadarClient[f[e]]=h(a)}if(typeof window!=="undefined"&&!window.radarClientAutoRefreshToken){var b=15*60*1000;var g=window.radarClientAutoRefreshToken=function(){setTimeout(function(){j().always(g)},b)};g()}window.radarClient={main:function(){return RadarClient}}}());