window.Zendesk.NS("Ticket.ViewingStatus",window.jQuery,window.Zendesk,window.currentUser,function(g,t,r){var n="",A="",k=[],H=null,C=new Date(),w=null,F=[15*1000,30*1000,45*1000,60*1000],i=0,j=false,c=false,s=null,p=14*60*1000,u=false,f=false,e=false,x;function h(){return !u&&!f;}function l(){return F[i];}function y(){i=Math.min(i+1,F.length-1);}function d(){i=0;}function z(K,J,I){H.setContent(K).addClass(J);if(I){H.reload().show();}else{H.reload().hide();}if(H.hidden()){H.appear();}}function B(){H.removeClass("normal urgent");if(s==="Viewing"){j=true;}else{if(s==="Updates"){c=true;}}}function G(){if(H.visible()){H.disappear(B);}else{B();}}function o(){if(w&&w>C&&!c){s="Updates";z("This ticket has been updated since you started viewing it.","urgent",true);}else{if(k.length>=3&&!j){s="Viewing";z(this.otherViewers.slice(0,2).join(", ")+", and "+(this.otherViewers.length-2)+(this.otherViewers.length>3?" others":" other")+" are also viewing this ticket.","normal");}else{if(k.length===2&&!j){s="Viewing";z(k.join(" and ")+" are also viewing this ticket.","normal");}else{if(k.length===1&&!j){s="Viewing";z(k[0]+" is also viewing this ticket.","normal");}else{s=null;G();}}}}}function m(I){var K=false;if(I&&I.others_viewing){K=K||!arrayEquals(k,I.others_viewing);k=I.others_viewing;}if(I&&I.updated_at){var J=new Date(I.updated_at);K=K||!dateEquals(w,J);w=J;}return K;}function q(){var I={};if(!e){I._method="PUT";}if(h()){g.ajax({url:x,dataType:"json",type:(e?"GET":"POST"),data:I,success:function(K,L,J){if(h()){if(m(K)){o();d();}else{y();}setTimeout(q,l());}},error:function(J,L,K){}});}}function v(){g(document).bind("idle.idleTimer",function(){u=true;});g(document).bind("active.idleTimer",function(){u=false;q();});g.idleTimer(p);}function b(){g("form").submit(function(){f=true;return true;});}function E(){e=r&&r.quietMode;}function a(){x="/api/v1/tickets/"+A+"/viewing_status";}function D(){var I=g("#ticket_viewing_status_data").html();if(I&&I.length>0){I=JSON.parse(I);n=I.accountID;A=I.ticketID;k=I.otherViewers||[];return(n&&A);}else{return false;}}this.init=function(){if(D()){H=t.Banner.create();v();b();E();a();o();setTimeout(q,l());}};g(function(){t.Ticket.ViewingStatus.init();});});