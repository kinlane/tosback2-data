var dust={};function getGlobal(){return(function(){return this.dust}).call(null)}(function(dust){dust.cache={};dust.register=function(name,tmpl){if(!name){return}dust.cache[name]=tmpl};dust.render=function(name,context,callback){var chunk=new Stub(callback).head;dust.load(name,chunk,Context.wrap(context)).end()};dust.stream=function(name,context){var stream=new Stream();dust.nextTick(function(){dust.load(name,stream.head,Context.wrap(context)).end()});return stream};dust.renderSource=function(source,context,callback){return dust.compileFn(source)(context,callback)};dust.compileFn=function(source,name){var tmpl=dust.loadSource(dust.compile(source,name));return function(context,callback){var master=callback?new Stub(callback):new Stream();dust.nextTick(function(){tmpl(master.head,Context.wrap(context)).end()});return master}};dust.load=function(name,chunk,context){var tmpl=dust.cache[name];if(tmpl){return tmpl(chunk,context)}else{if(dust.onLoad){return chunk.map(function(chunk){dust.onLoad(name,function(err,src){if(err){return chunk.setError(err)}if(!dust.cache[name]){dust.loadSource(dust.compile(src,name))}dust.cache[name](chunk,context).end()})})}return chunk.setError(new Error("Template Not Found: "+name))}};dust.loadSource=function(source,path){return eval(source)};if(Array.isArray){dust.isArray=Array.isArray}else{dust.isArray=function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}}dust.nextTick=(function(){if(typeof process!=="undefined"){return process.nextTick}else{return function(callback){setTimeout(callback,0)}}})();dust.isEmpty=function(value){if(dust.isArray(value)&&!value.length){return true}if(value===0){return false}return(!value)};dust.filter=function(string,auto,filters){if(filters){for(var i=0,len=filters.length;i<len;i++){var name=filters[i];if(name==="s"){auto=null}else{if(typeof dust.filters[name]==="function"){string=dust.filters[name](string)}}}}if(auto){string=dust.filters[auto](string)}return string};dust.filters={h:function(value){return dust.escapeHtml(value)},j:function(value){return dust.escapeJs(value)},u:encodeURI,uc:encodeURIComponent,js:function(value){if(!JSON){return value}return JSON.stringify(value)},jp:function(value){if(!JSON){return value}return JSON.parse(value)}};function Context(stack,global,blocks){this.stack=stack;this.global=global;this.blocks=blocks}dust.makeBase=function(global){return new Context(new Stack(),global)};Context.wrap=function(context){if(context instanceof Context){return context}return new Context(new Stack(context))};Context.prototype.get=function(key){var ctx=this.stack,value;while(ctx){if(ctx.isObject){value=ctx.head[key];if(!(value===undefined)){return value}}ctx=ctx.tail}return this.global?this.global[key]:undefined};Context.prototype.getPath=function(cur,down){var ctx=this.stack,len=down.length;if(cur&&len===0){return ctx.head}ctx=ctx.head;var i=0;while(ctx&&i<len){ctx=ctx[down[i]];i++}return ctx};Context.prototype.push=function(head,idx,len){return new Context(new Stack(head,this.stack,idx,len),this.global,this.blocks)};Context.prototype.rebase=function(head){return new Context(new Stack(head),this.global,this.blocks)};Context.prototype.current=function(){return this.stack.head};Context.prototype.getBlock=function(key,chk,ctx){if(typeof key==="function"){key=key(chk,ctx).data;chk.data=""}var blocks=this.blocks;if(!blocks){return}var len=blocks.length,fn;while(len--){fn=blocks[len][key];if(fn){return fn}}};Context.prototype.shiftBlocks=function(locals){var blocks=this.blocks,newBlocks;if(locals){if(!blocks){newBlocks=[locals]}else{newBlocks=blocks.concat([locals])}return new Context(this.stack,this.global,newBlocks)}return this};function Stack(head,tail,idx,len){this.tail=tail;this.isObject=!dust.isArray(head)&&head&&typeof head==="object";this.head=head;this.index=idx;this.of=len}function Stub(callback){this.head=new Chunk(this);this.callback=callback;this.out=""}Stub.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.out+=chunk.data}else{if(chunk.error){this.callback(chunk.error);this.flush=function(){};return}else{return}}chunk=chunk.next;this.head=chunk}this.callback(null,this.out)};function Stream(){this.head=new Chunk(this)}Stream.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.emit("data",chunk.data)}else{if(chunk.error){this.emit("error",chunk.error);this.flush=function(){};return}else{return}}chunk=chunk.next;this.head=chunk}this.emit("end")};Stream.prototype.emit=function(type,data){if(!this.events){return false}var handler=this.events[type];if(!handler){return false}if(typeof handler=="function"){handler(data)}else{var listeners=handler.slice(0);for(var i=0,l=listeners.length;i<l;i++){listeners[i](data)}}};Stream.prototype.on=function(type,callback){if(!this.events){this.events={}}if(!this.events[type]){this.events[type]=callback}else{if(typeof this.events[type]==="function"){this.events[type]=[this.events[type],callback]}else{this.events[type].push(callback)}}return this};Stream.prototype.pipe=function(stream){this.on("data",function(data){stream.write(data,"utf8")}).on("end",function(){stream.end()}).on("error",function(err){stream.error(err)});return this};function Chunk(root,next,taps){this.root=root;this.next=next;this.data="";this.flushable=false;this.taps=taps}Chunk.prototype.write=function(data){var taps=this.taps;if(taps){data=taps.go(data)}this.data+=data;return this};Chunk.prototype.end=function(data){if(data){this.write(data)}this.flushable=true;this.root.flush();return this};Chunk.prototype.map=function(callback){var cursor=new Chunk(this.root,this.next,this.taps),branch=new Chunk(this.root,cursor,this.taps);this.next=branch;this.flushable=true;callback(branch);return cursor};Chunk.prototype.tap=function(tap){var taps=this.taps;if(taps){this.taps=taps.push(tap)}else{this.taps=new Tap(tap)}return this};Chunk.prototype.untap=function(){this.taps=this.taps.tail;return this};Chunk.prototype.render=function(body,context){return body(this,context)};Chunk.prototype.reference=function(elem,context,auto,filters){if(typeof elem==="function"){elem.isFunction=true;elem=elem.apply(context.current(),[this,context,null,{auto:auto,filters:filters}]);if(elem instanceof Chunk){return elem}}if(!dust.isEmpty(elem)){return this.write(dust.filter(elem,auto,filters))}else{return this}};Chunk.prototype.section=function(elem,context,bodies,params){if(typeof elem==="function"){elem=elem.apply(context.current(),[this,context,bodies,params]);if(elem instanceof Chunk){return elem}}var body=bodies.block,skip=bodies["else"];if(params){context=context.push(params)}if(dust.isArray(elem)){if(body){var len=elem.length,chunk=this;if(len>0){if(context.stack.head){context.stack.head["$len"]=len}for(var i=0;i<len;i++){if(context.stack.head){context.stack.head["$idx"]=i}chunk=body(chunk,context.push(elem[i],i,len))}if(context.stack.head){context.stack.head["$idx"]=undefined;context.stack.head["$len"]=undefined}return chunk}else{if(skip){return skip(this,context)}}}}else{if(elem&&typeof elem=="object"){if(body){if(context.stack.head){context.stack.head["$idx"]=0;context.stack.head["$len"]=1}chunk=body(this,context.push(elem));if(context.stack.head){context.stack.head["$idx"]=undefined;context.stack.head["$len"]=undefined}return chunk}}else{if(elem===true||elem===0){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}}}return this};Chunk.prototype.exists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(!dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}return this};Chunk.prototype.notexists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}return this};Chunk.prototype.block=function(elem,context,bodies){var body=bodies.block;if(elem){body=elem}if(body){return body(this,context)}return this};Chunk.prototype.partial=function(elem,context,params){var partialContext;if(params){partialContext=dust.makeBase(context.global);if(context.stack&&context.stack.tail){partialContext.stack=context.stack.tail}partialContext=partialContext.push(params);partialContext=partialContext.push(context.stack.head)}else{partialContext=context}if(typeof elem==="function"){return this.capture(elem,partialContext,function(name,chunk){dust.load(name,chunk,partialContext).end()})}return dust.load(elem,this,partialContext)};Chunk.prototype.helper=function(name,context,bodies,params){if(dust.helpers[name]){return dust.helpers[name](this,context,bodies,params)}};Chunk.prototype.capture=function(body,context,callback){return this.map(function(chunk){var stub=new Stub(function(err,out){if(err){chunk.setError(err)}else{callback(out,chunk)}});body(stub.head,context).end()})};Chunk.prototype.setError=function(err){this.error=err;this.root.flush();return this};function Tap(head,tail){this.head=head;this.tail=tail}Tap.prototype.push=function(tap){return new Tap(tap,this)};Tap.prototype.go=function(value){var tap=this;while(tap){value=tap.head(value);tap=tap.tail}return value};var HCHARS=new RegExp(/[&<>\"\']/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(s){if(typeof s==="string"){if(!HCHARS.test(s)){return s}return s.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;")}return s};var BS=/\\/g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(s){if(typeof s==="string"){return s.replace(BS,"\\\\").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t")}return s}})(dust);if(typeof exports!=="undefined"){dust.helpers=require("./dust-helpers").helpers;if(typeof process!=="undefined"){require("./server")(dust)}module.exports=dust}(function(dust){var _console=(typeof console!=="undefined")?console:{log:function(){}};function isSelect(context){var value=context.current();return typeof value==="object"&&value.isSelect===true}function filter(chunk,context,bodies,params,filter){var params=params||{},actual,expected;if(params.key){actual=helpers.tap(params.key,chunk,context)}else{if(isSelect(context)){actual=context.current().selectKey;if(context.current().isResolved){filter=function(){return false}}}else{throw"No key specified for filter and no key found in context from select statement"}}expected=helpers.tap(params.value,chunk,context);if(filter(expected,coerce(actual,params.type,context))){if(isSelect(context)){context.current().isResolved=true}return chunk.render(bodies.block,context)}else{if(bodies["else"]){return chunk.render(bodies["else"],context)}}return chunk.write("")}function coerce(value,type,context){if(value){switch(type||typeof(value)){case"number":return +value;case"string":return String(value);case"boolean":return Boolean(value);case"date":return new Date(value);case"context":return context.get(value)}}return value}var helpers={sep:function(chunk,context,bodies){if(context.stack.index===context.stack.of-1){return chunk}return bodies.block(chunk,context)},idx:function(chunk,context,bodies){return bodies.block(chunk,context.push(context.stack.index))},contextDump:function(chunk,context,bodies){_console.log(JSON.stringify(context.stack));return chunk},tap:function(input,chunk,context){var output=input;if(typeof input==="function"){if((typeof input.isFunction!=="undefined")&&(input.isFunction===true)){output=input()}else{output="";chunk.tap(function(data){output+=data;return""}).render(input,context).untap();if(output===""){output=false}}}return output},"if":function(chunk,context,bodies,params){if(params&&params.cond){var cond=params.cond;cond=this.tap(cond,chunk,context);if(eval(cond)){return chunk.render(bodies.block,context)}if(bodies["else"]){return chunk.render(bodies["else"],context)}}else{_console.log("No condition given in the if helper!")}return chunk},select:function(chunk,context,bodies,params){if(params&&params.key){var key=this.tap(params.key,chunk,context);return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:key}))}else{_console.log("No key given in the select helper!")}return chunk},eq:function(chunk,context,bodies,params){return filter(chunk,context,bodies,params,function(expected,actual){return actual===expected})},lt:function(chunk,context,bodies,params){return filter(chunk,context,bodies,params,function(expected,actual){return actual<expected})},lte:function(chunk,context,bodies,params){return filter(chunk,context,bodies,params,function(expected,actual){return actual<=expected})},gt:function(chunk,context,bodies,params){return filter(chunk,context,bodies,params,function(expected,actual){return actual>expected})},gte:function(chunk,context,bodies,params){return filter(chunk,context,bodies,params,function(expected,actual){return actual>=expected})},"default":function(chunk,context,bodies,params){return filter(chunk,context,bodies,params,function(expected,actual){return true})},size:function(chunk,context,bodies,params){var subject=params.subject;var value=0;if(!subject){value=0}else{if(dust.isArray(subject)){value=subject.length}else{if(!isNaN(subject)){value=subject}else{if(Object(subject)===subject){var nr=0;for(var k in subject){if(Object.hasOwnProperty.call(subject,k)){nr++}}value=nr}else{value=(subject+"").length}}}}return chunk.write(value)}};dust.helpers=helpers})(typeof exports!=="undefined"?exports:getGlobal());(function(e){e.compile=function(r,p){try{var o=h(e.parse(r));return l(o,p)}catch(q){if(!q.line||!q.column){throw q}throw new SyntaxError(q.message+" At line : "+q.line+", column : "+q.column)}};function h(o){var p={};return e.filterNode(p,o)}e.filterNode=function(o,p){return e.optimizers[p[0]](o,p)};e.optimizers={body:a,buffer:m,special:d,format:b,reference:i,"#":i,"?":i,"^":i,"<":i,"+":i,"@":i,"%":i,partial:i,context:i,params:i,bodies:i,param:i,filters:m,key:m,path:m,literal:m,comment:b};e.pragmas={esc:function(s,r,p,t){var o=s.auto;if(!r){r="h"}s.auto=(r==="s")?"":r;var q=j(s,p.block);s.auto=o;return q}};function i(s,t){var p=[t[0]];for(var r=1,o=t.length;r<o;r++){var q=e.filterNode(s,t[r]);if(q){p.push(q)}}return p}function a(t,u){var q=[u[0]],p;for(var s=1,o=u.length;s<o;s++){var r=e.filterNode(t,u[s]);if(r){if(r[0]==="buffer"){if(p){p[1]+=r[1]}else{p=r;q.push(r)}}else{p=null;q.push(r)}}}return q}var c={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};function d(o,p){return["buffer",c[p[1]]]}function m(o,p){return p}function b(){}function l(o,p){var q={name:p,bodies:[],blocks:{},index:0,auto:"h"};return"(function(){dust.register("+(p?'"'+p+'"':"null")+","+e.compileNode(q,o)+");"+g(q)+f(q)+"return body_0;})();"}function g(q){var p=[],r=q.blocks;for(var o in r){p.push("'"+o+"':"+r[o])}if(p.length){q.blocks="ctx=ctx.shiftBlocks(blocks);";return"var blocks={"+p.join(",")+"};"}return q.blocks=""}function f(t){var r=[],q=t.bodies,p=t.blocks;for(var s=0,o=q.length;s<o;s++){r[s]="function body_"+s+"(chk,ctx){"+p+"return chk"+q[s]+";}"}return r.join("")}function j(r,p){var s="";for(var q=1,o=p.length;q<o;q++){s+=e.compileNode(r,p[q])}return s}e.compileNode=function(o,p){return e.nodes[p[0]](o,p)};e.nodes={body:function(p,q){var r=p.index++,o="body_"+r;p.bodies[r]=j(p,q);return o},buffer:function(o,p){return".write("+k(p[1])+")"},format:function(o,p){return".write("+k(p[1]+p[2])+")"},reference:function(o,p){return".reference("+e.compileNode(o,p[1])+",ctx,"+e.compileNode(o,p[2])+")"},"#":function(o,p){return n(o,p,"section")},"?":function(o,p){return n(o,p,"exists")},"^":function(o,p){return n(o,p,"notexists")},"<":function(r,t){var p=t[4];for(var q=1,o=p.length;q<o;q++){var u=p[q],s=u[1][1];if(s==="block"){r.blocks[t[1].text]=e.compileNode(r,u[2]);return""}}return""},"+":function(o,p){if(typeof(p[1].text)==="undefined"&&typeof(p[4])==="undefined"){return".block(ctx.getBlock("+e.compileNode(o,p[1])+",chk, ctx),"+e.compileNode(o,p[2])+", {},"+e.compileNode(o,p[3])+")"}else{return".block(ctx.getBlock("+k(p[1].text)+"),"+e.compileNode(o,p[2])+","+e.compileNode(o,p[4])+","+e.compileNode(o,p[3])+")"}},"@":function(o,p){return".helper("+k(p[1].text)+","+e.compileNode(o,p[2])+","+e.compileNode(o,p[4])+","+e.compileNode(o,p[3])+")"},"%":function(t,u){var r=u[1][1];if(!e.pragmas[r]){return""}var x=u[4];var o={};for(var w=1,y=x.length;w<y;w++){var z=x[w];o[z[1][1]]=z[2]}var q=u[3];var v={};for(var w=1,y=q.length;w<y;w++){var s=q[w];v[s[1][1]]=s[2][1]}var A=u[2][1]?u[2][1].text:null;return e.pragmas[r](t,A,o,v)},partial:function(o,p){return".partial("+e.compileNode(o,p[1])+","+e.compileNode(o,p[2])+","+e.compileNode(o,p[3])+")"},context:function(o,p){if(p[1]){return"ctx.rebase("+e.compileNode(o,p[1])+")"}return"ctx"},params:function(r,s){var p=[];for(var q=1,o=s.length;q<o;q++){p.push(e.compileNode(r,s[q]))}if(p.length){return"{"+p.join(",")+"}"}return"null"},bodies:function(r,s){var p=[];for(var q=1,o=s.length;q<o;q++){p.push(e.compileNode(r,s[q]))}return"{"+p.join(",")+"}"},param:function(o,p){return e.compileNode(o,p[1])+":"+e.compileNode(o,p[2])},filters:function(q,s){var t=[];for(var p=1,o=s.length;p<o;p++){var r=s[p];t.push('"'+r+'"')}return'"'+q.auto+'"'+(t.length?",["+t.join(",")+"]":"")},key:function(o,p){return'ctx.get("'+p[1]+'")'},path:function(q,s){var u=s[1],r=s[2],t=[];for(var p=0,o=r.length;p<o;p++){t.push('"'+r[p]+'"')}return"ctx.getPath("+u+",["+t.join(",")+"])"},literal:function(o,p){return k(p[1])}};function n(o,p,q){return"."+q+"("+e.compileNode(o,p[1])+","+e.compileNode(o,p[2])+","+e.compileNode(o,p[4])+","+e.compileNode(o,p[3])+")"}var k=(typeof JSON==="undefined")?function(o){return'"'+e.escapeJs(o)+'"'}:JSON.stringify})(typeof exports!=="undefined"?exports:getGlobal());(function(a){var b=(function(){function d(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(i,n){var g={body:z,part:o,section:t,sec_tag_start:v,end_tag:x,context:V,params:I,bodies:A,reference:Y,partial:M,filters:u,special:f,identifier:U,number:E,frac:W,integer:H,path:N,key:L,array:e,array_part:p,inline:R,inline_part:O,buffer:X,literal:j,esc:h,comment:G,tag:l,ld:F,rd:J,eol:q,ws:Q};if(n!==undefined){if(g[n]===undefined){throw new Error("Invalid rule name: "+d(n)+".")}}else{n="body"}var K={offset:0,line:1,column:1,seenCR:false};var T=0;var k={offset:0,line:1,column:1,seenCR:false};var s=[];function Z(ab,af,ad){var aa=ab;var ae=ad-ab.length;for(var ac=0;ac<ae;ac++){aa=af+aa}return aa}function C(ac){var ab=ac.charCodeAt(0);var aa;var ad;if(ab<=255){aa="x";ad=2}else{aa="u";ad=4}return"\\"+aa+Z(ab.toString(16).toUpperCase(),"0",ad)}function B(ab){var aa={};for(var ac in ab){aa[ac]=ab[ac]}return aa}function r(ae,ad){var aa=ae.offset+ad;for(var ac=ae.offset;ac<aa;ac++){var ab=i.charAt(ac);if(ab==="\n"){if(!ae.seenCR){ae.line++}ae.column=1;ae.seenCR=false}else{if(ab==="\r"||ab==="\u2028"||ab==="\u2029"){ae.line++;ae.column=1;ae.seenCR=true}else{ae.column++;ae.seenCR=false}}}ae.offset+=ad}function w(aa){if(K.offset<k.offset){return}if(K.offset>k.offset){k=B(K);s=[]}s.push(aa)}function z(){var ab,aa;var ac;ac=B(K);ab=[];aa=o();while(aa!==null){ab.push(aa);aa=o()}if(ab!==null){ab=(function(ag,ad,ae,af){return["body"].concat(af)})(ac.offset,ac.line,ac.column,ab)}if(ab===null){K=B(ac)}return ab}function o(){var aa;aa=G();if(aa===null){aa=t();if(aa===null){aa=M();if(aa===null){aa=f();if(aa===null){aa=Y();if(aa===null){aa=X()}}}}}return aa}function t(){var ag,af,ae,ad,ac,ab,aa;var ai,ah;T++;ai=B(K);ah=B(K);ag=v();if(ag!==null){af=[];ae=Q();while(ae!==null){af.push(ae);ae=Q()}if(af!==null){ae=J();if(ae!==null){ad=z();if(ad!==null){ac=A();if(ac!==null){ab=x();if(ab!==null){aa=(function(ao,ak,am,al,aj,an,ap){return al[1].text===ap.text})(K.offset,K.line,K.column,ag,ad,ac,ab)?"":null;if(aa!==null){ag=[ag,af,ae,ad,ac,ab,aa]}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}if(ag!==null){ag=(function(ao,ak,am,al,aj,an,ap){an.push(["param",["literal","block"],aj]);al.push(an);return al})(ai.offset,ai.line,ai.column,ag[0],ag[3],ag[4],ag[5])}if(ag===null){K=B(ai)}if(ag===null){ai=B(K);ah=B(K);ag=v();if(ag!==null){af=[];ae=Q();while(ae!==null){af.push(ae);ae=Q()}if(af!==null){if(i.charCodeAt(K.offset)===47){ae="/";r(K,1)}else{ae=null;if(T===0){w('"/"')}}if(ae!==null){ad=J();if(ad!==null){ag=[ag,af,ae,ad]}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}}else{ag=null;K=B(ah)}if(ag!==null){ag=(function(am,aj,al,ak){ak.push(["bodies"]);return ak})(ai.offset,ai.line,ai.column,ag[0])}if(ag===null){K=B(ai)}}T--;if(T===0&&ag===null){w("section")}return ag}function v(){var ag,ae,ad,ac,ab,aa;var ah,af;ah=B(K);af=B(K);ag=F();if(ag!==null){if(/^[#?^<+@%]/.test(i.charAt(K.offset))){ae=i.charAt(K.offset);r(K,1)}else{ae=null;if(T===0){w("[#?^<+@%]")}}if(ae!==null){ad=[];ac=Q();while(ac!==null){ad.push(ac);ac=Q()}if(ad!==null){ac=U();if(ac!==null){ab=V();if(ab!==null){aa=I();if(aa!==null){ag=[ag,ae,ad,ac,ab,aa]}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}if(ag!==null){ag=(function(am,ai,ak,aj,ao,an,al){return[aj,ao,an,al]})(ah.offset,ah.line,ah.column,ag[1],ag[3],ag[4],ag[5])}if(ag===null){K=B(ah)}return ag}function x(){var ag,ae,ad,ac,ab,aa;var ah,af;T++;ah=B(K);af=B(K);ag=F();if(ag!==null){if(i.charCodeAt(K.offset)===47){ae="/";r(K,1)}else{ae=null;if(T===0){w('"/"')}}if(ae!==null){ad=[];ac=Q();while(ac!==null){ad.push(ac);ac=Q()}if(ad!==null){ac=U();if(ac!==null){ab=[];aa=Q();while(aa!==null){ab.push(aa);aa=Q()}if(ab!==null){aa=J();if(aa!==null){ag=[ag,ae,ad,ac,ab,aa]}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}}else{ag=null;K=B(af)}if(ag!==null){ag=(function(ak,ai,aj,al){return al})(ah.offset,ah.line,ah.column,ag[3])}if(ag===null){K=B(ah)}T--;if(T===0&&ag===null){w("end tag")}return ag}function V(){var ad,ab;var ae,ac,aa;ae=B(K);ac=B(K);aa=B(K);if(i.charCodeAt(K.offset)===58){ad=":";r(K,1)}else{ad=null;if(T===0){w('":"')}}if(ad!==null){ab=U();if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(aa)}}else{ad=null;K=B(aa)}if(ad!==null){ad=(function(ah,af,ag,ai){return ai})(ac.offset,ac.line,ac.column,ad[1])}if(ad===null){K=B(ac)}ad=ad!==null?ad:"";if(ad!==null){ad=(function(ah,af,ag,ai){return ai?["context",ai]:["context"]})(ae.offset,ae.line,ae.column,ad)}if(ad===null){K=B(ae)}return ad}function I(){var ag,ae,ac,ab,aa;var ah,af,ad;T++;ah=B(K);ag=[];af=B(K);ad=B(K);ac=Q();if(ac!==null){ae=[];while(ac!==null){ae.push(ac);ac=Q()}}else{ae=null}if(ae!==null){ac=L();if(ac!==null){if(i.charCodeAt(K.offset)===61){ab="=";r(K,1)}else{ab=null;if(T===0){w('"="')}}if(ab!==null){aa=E();if(aa===null){aa=U();if(aa===null){aa=R()}}if(aa!==null){ae=[ae,ac,ab,aa]}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}if(ae!==null){ae=(function(am,ai,al,ak,aj){return["param",["literal",ak],aj]})(af.offset,af.line,af.column,ae[1],ae[3])}if(ae===null){K=B(af)}while(ae!==null){ag.push(ae);af=B(K);ad=B(K);ac=Q();if(ac!==null){ae=[];while(ac!==null){ae.push(ac);ac=Q()}}else{ae=null}if(ae!==null){ac=L();if(ac!==null){if(i.charCodeAt(K.offset)===61){ab="=";r(K,1)}else{ab=null;if(T===0){w('"="')}}if(ab!==null){aa=E();if(aa===null){aa=U();if(aa===null){aa=R()}}if(aa!==null){ae=[ae,ac,ab,aa]}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}if(ae!==null){ae=(function(am,ai,al,ak,aj){return["param",["literal",ak],aj]})(af.offset,af.line,af.column,ae[1],ae[3])}if(ae===null){K=B(af)}}if(ag!==null){ag=(function(al,ai,aj,ak){return["params"].concat(ak)})(ah.offset,ah.line,ah.column,ag)}if(ag===null){K=B(ah)}T--;if(T===0&&ag===null){w("params")}return ag}function A(){var af,ae,ad,ac,ab,aa;var ai,ah,ag;T++;ai=B(K);af=[];ah=B(K);ag=B(K);ae=F();if(ae!==null){if(i.charCodeAt(K.offset)===58){ad=":";r(K,1)}else{ad=null;if(T===0){w('":"')}}if(ad!==null){ac=L();if(ac!==null){ab=J();if(ab!==null){aa=z();if(aa!==null){ae=[ae,ad,ac,ab,aa]}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}if(ae!==null){ae=(function(an,aj,am,al,ak){return["param",["literal",al],ak]})(ah.offset,ah.line,ah.column,ae[2],ae[4])}if(ae===null){K=B(ah)}while(ae!==null){af.push(ae);ah=B(K);ag=B(K);ae=F();if(ae!==null){if(i.charCodeAt(K.offset)===58){ad=":";r(K,1)}else{ad=null;if(T===0){w('":"')}}if(ad!==null){ac=L();if(ac!==null){ab=J();if(ab!==null){aa=z();if(aa!==null){ae=[ae,ad,ac,ab,aa]}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}}else{ae=null;K=B(ag)}if(ae!==null){ae=(function(an,aj,am,al,ak){return["param",["literal",al],ak]})(ah.offset,ah.line,ah.column,ae[2],ae[4])}if(ae===null){K=B(ah)}}if(af!==null){af=(function(am,aj,ak,al){return["bodies"].concat(al)})(ai.offset,ai.line,ai.column,af)}if(af===null){K=B(ai)}T--;if(T===0&&af===null){w("bodies")}return af}function Y(){var ae,ac,ab,aa;var af,ad;T++;af=B(K);ad=B(K);ae=F();if(ae!==null){ac=U();if(ac!==null){ab=u();if(ab!==null){aa=J();if(aa!==null){ae=[ae,ac,ab,aa]}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}if(ae!==null){ae=(function(aj,ag,ah,ak,ai){return["reference",ak,ai]})(af.offset,af.line,af.column,ae[1],ae[2])}if(ae===null){K=B(af)}T--;if(T===0&&ae===null){w("reference")}return ae}function M(){var ah,ag,af,ae,ad,ac,ab,aa;var ak,aj,ai;T++;ak=B(K);aj=B(K);ah=F();if(ah!==null){if(i.charCodeAt(K.offset)===62){ag=">";r(K,1)}else{ag=null;if(T===0){w('">"')}}if(ag===null){if(i.charCodeAt(K.offset)===43){ag="+";r(K,1)}else{ag=null;if(T===0){w('"+"')}}}if(ag!==null){ai=B(K);af=L();if(af!==null){af=(function(ao,al,an,am){return["literal",am]})(ai.offset,ai.line,ai.column,af)}if(af===null){K=B(ai)}if(af===null){af=R()}if(af!==null){ae=V();if(ae!==null){ad=I();if(ad!==null){ac=[];ab=Q();while(ab!==null){ac.push(ab);ab=Q()}if(ac!==null){if(i.charCodeAt(K.offset)===47){ab="/";r(K,1)}else{ab=null;if(T===0){w('"/"')}}if(ab!==null){aa=J();if(aa!==null){ah=[ah,ag,af,ae,ad,ac,ab,aa]}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}}else{ah=null;K=B(aj)}if(ah!==null){ah=(function(aq,al,ao,an,at,ar,ap){var am=(an===">")?"partial":an;return[am,at,ar,ap]})(ak.offset,ak.line,ak.column,ah[1],ah[2],ah[3],ah[4])}if(ah===null){K=B(ak)}T--;if(T===0&&ah===null){w("partial")}return ah}function u(){var ae,ac,aa;var af,ad,ab;T++;af=B(K);ae=[];ad=B(K);ab=B(K);if(i.charCodeAt(K.offset)===124){ac="|";r(K,1)}else{ac=null;if(T===0){w('"|"')}}if(ac!==null){aa=L();if(aa!==null){ac=[ac,aa]}else{ac=null;K=B(ab)}}else{ac=null;K=B(ab)}if(ac!==null){ac=(function(ai,ag,ah,aj){return aj})(ad.offset,ad.line,ad.column,ac[1])}if(ac===null){K=B(ad)}while(ac!==null){ae.push(ac);ad=B(K);ab=B(K);if(i.charCodeAt(K.offset)===124){ac="|";r(K,1)}else{ac=null;if(T===0){w('"|"')}}if(ac!==null){aa=L();if(aa!==null){ac=[ac,aa]}else{ac=null;K=B(ab)}}else{ac=null;K=B(ab)}if(ac!==null){ac=(function(ai,ag,ah,aj){return aj})(ad.offset,ad.line,ad.column,ac[1])}if(ac===null){K=B(ad)}}if(ae!==null){ae=(function(aj,ag,ah,ai){return["filters"].concat(ai)})(af.offset,af.line,af.column,ae)}if(ae===null){K=B(af)}T--;if(T===0&&ae===null){w("filters")}return ae}function f(){var ae,ac,ab,aa;var af,ad;T++;af=B(K);ad=B(K);ae=F();if(ae!==null){if(i.charCodeAt(K.offset)===126){ac="~";r(K,1)}else{ac=null;if(T===0){w('"~"')}}if(ac!==null){ab=L();if(ab!==null){aa=J();if(aa!==null){ae=[ae,ac,ab,aa]}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}if(ae!==null){ae=(function(aj,ag,ai,ah){return["special",ah]})(af.offset,af.line,af.column,ae[2])}if(ae===null){K=B(af)}T--;if(T===0&&ae===null){w("special")}return ae}function U(){var aa;var ab;T++;ab=B(K);aa=N();if(aa!==null){aa=(function(ag,ad,ae,af){var ac=["path"].concat(af);ac.text=af[1].join(".");return ac})(ab.offset,ab.line,ab.column,aa)}if(aa===null){K=B(ab)}if(aa===null){ab=B(K);aa=L();if(aa!==null){aa=(function(ag,ad,af,ae){var ac=["key",ae];ac.text=ae;return ac})(ab.offset,ab.line,ab.column,aa)}if(aa===null){K=B(ab)}}T--;if(T===0&&aa===null){w("identifier")}return aa}function E(){var aa;var ab;T++;ab=B(K);aa=W();if(aa===null){aa=H()}if(aa!==null){aa=(function(ae,ac,ad,af){return["literal",af]})(ab.offset,ab.line,ab.column,aa)}if(aa===null){K=B(ab)}T--;if(T===0&&aa===null){w("number")}return aa}function W(){var ae,ac,ab,aa;var af,ad;T++;af=B(K);ad=B(K);ae=H();if(ae!==null){if(i.charCodeAt(K.offset)===46){ac=".";r(K,1)}else{ac=null;if(T===0){w('"."')}}if(ac!==null){aa=H();if(aa!==null){ab=[];while(aa!==null){ab.push(aa);aa=H()}}else{ab=null}if(ab!==null){ae=[ae,ac,ab]}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}}else{ae=null;K=B(ad)}if(ae!==null){ae=(function(ak,ah,ai,ag,aj){return parseFloat(ag+"."+aj.join(""))})(af.offset,af.line,af.column,ae[0],ae[2])}if(ae===null){K=B(af)}T--;if(T===0&&ae===null){w("frac")}return ae}function H(){var ab,aa;var ac;T++;ac=B(K);if(/^[0-9]/.test(i.charAt(K.offset))){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("[0-9]")}}if(aa!==null){ab=[];while(aa!==null){ab.push(aa);if(/^[0-9]/.test(i.charAt(K.offset))){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("[0-9]")}}}}else{ab=null}if(ab!==null){ab=(function(ag,ad,ae,af){return parseInt(af.join(""),10)})(ac.offset,ac.line,ac.column,ab)}if(ab===null){K=B(ac)}T--;if(T===0&&ab===null){w("integer")}return ab}function N(){var ad,ab,aa;var ae,ac;T++;ae=B(K);ac=B(K);ad=L();ad=ad!==null?ad:"";if(ad!==null){aa=p();if(aa===null){aa=e()}if(aa!==null){ab=[];while(aa!==null){ab.push(aa);aa=p();if(aa===null){aa=e()}}}else{ab=null}if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(aj,af,ah,ag,ai){ai=ai[0];if(ag&&ai){ai.unshift(ag);return[false,ai]}return[true,ai]})(ae.offset,ae.line,ae.column,ad[0],ad[1])}if(ad===null){K=B(ae)}if(ad===null){ae=B(K);ac=B(K);if(i.charCodeAt(K.offset)===46){ad=".";r(K,1)}else{ad=null;if(T===0){w('"."')}}if(ad!==null){ab=[];aa=p();if(aa===null){aa=e()}while(aa!==null){ab.push(aa);aa=p();if(aa===null){aa=e()}}if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(ai,af,ag,ah){if(ah.length>0){return[true,ah[0]]}return[true,[]]})(ae.offset,ae.line,ae.column,ad[1])}if(ad===null){K=B(ae)}}T--;if(T===0&&ad===null){w("path")}return ad}function L(){var ad,ab,aa;var ae,ac;T++;ae=B(K);ac=B(K);if(/^[a-zA-Z_$]/.test(i.charAt(K.offset))){ad=i.charAt(K.offset);r(K,1)}else{ad=null;if(T===0){w("[a-zA-Z_$]")}}if(ad!==null){ab=[];if(/^[0-9a-zA-Z_$\-]/.test(i.charAt(K.offset))){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("[0-9a-zA-Z_$\\-]")}}while(aa!==null){ab.push(aa);if(/^[0-9a-zA-Z_$\-]/.test(i.charAt(K.offset))){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("[0-9a-zA-Z_$\\-]")}}}if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(aj,af,ai,ah,ag){return ah+ag.join("")})(ae.offset,ae.line,ae.column,ad[0],ad[1])}if(ad===null){K=B(ae)}T--;if(T===0&&ad===null){w("key")}return ad}function e(){var af,ad,ab;var ag,ae,ac,aa;T++;ag=B(K);ae=B(K);ac=B(K);aa=B(K);if(i.charCodeAt(K.offset)===91){af="[";r(K,1)}else{af=null;if(T===0){w('"["')}}if(af!==null){if(/^[0-9]/.test(i.charAt(K.offset))){ab=i.charAt(K.offset);r(K,1)}else{ab=null;if(T===0){w("[0-9]")}}if(ab!==null){ad=[];while(ab!==null){ad.push(ab);if(/^[0-9]/.test(i.charAt(K.offset))){ab=i.charAt(K.offset);r(K,1)}else{ab=null;if(T===0){w("[0-9]")}}}}else{ad=null}if(ad!==null){if(i.charCodeAt(K.offset)===93){ab="]";r(K,1)}else{ab=null;if(T===0){w('"]"')}}if(ab!==null){af=[af,ad,ab]}else{af=null;K=B(aa)}}else{af=null;K=B(aa)}}else{af=null;K=B(aa)}if(af!==null){af=(function(ak,ai,aj,ah){return ah.join("")})(ac.offset,ac.line,ac.column,af[1])}if(af===null){K=B(ac)}if(af!==null){ad=p();ad=ad!==null?ad:"";if(ad!==null){af=[af,ad]}else{af=null;K=B(ae)}}else{af=null;K=B(ae)}if(af!==null){af=(function(al,ah,ak,aj,ai){if(ai){ai.unshift(aj)}else{ai=[aj]}return ai})(ag.offset,ag.line,ag.column,af[0],af[1])}if(af===null){K=B(ag)}T--;if(T===0&&af===null){w("array")}return af}function p(){var af,ad,ab;var ag,ae,ac,aa;T++;ag=B(K);ae=B(K);ac=B(K);aa=B(K);if(i.charCodeAt(K.offset)===46){ad=".";r(K,1)}else{ad=null;if(T===0){w('"."')}}if(ad!==null){ab=L();if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(aa)}}else{ad=null;K=B(aa)}if(ad!==null){ad=(function(ak,ah,aj,ai){return ai})(ac.offset,ac.line,ac.column,ad[1])}if(ad===null){K=B(ac)}if(ad!==null){af=[];while(ad!==null){af.push(ad);ac=B(K);aa=B(K);if(i.charCodeAt(K.offset)===46){ad=".";r(K,1)}else{ad=null;if(T===0){w('"."')}}if(ad!==null){ab=L();if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(aa)}}else{ad=null;K=B(aa)}if(ad!==null){ad=(function(ak,ah,aj,ai){return ai})(ac.offset,ac.line,ac.column,ad[1])}if(ad===null){K=B(ac)}}}else{af=null}if(af!==null){ad=e();ad=ad!==null?ad:"";if(ad!==null){af=[af,ad]}else{af=null;K=B(ae)}}else{af=null;K=B(ae)}if(af!==null){af=(function(al,ai,aj,ak,ah){if(ah){return ak.concat(ah)}else{return ak}})(ag.offset,ag.line,ag.column,af[0],af[1])}if(af===null){K=B(ag)}T--;if(T===0&&af===null){w("array_part")}return af}function R(){var ad,ab,aa;var ae,ac;T++;ae=B(K);ac=B(K);if(i.charCodeAt(K.offset)===34){ad='"';r(K,1)}else{ad=null;if(T===0){w('"\\""')}}if(ad!==null){if(i.charCodeAt(K.offset)===34){ab='"';r(K,1)}else{ab=null;if(T===0){w('"\\""')}}if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(ah,af,ag){return["literal",""]})(ae.offset,ae.line,ae.column)}if(ad===null){K=B(ae)}if(ad===null){ae=B(K);ac=B(K);if(i.charCodeAt(K.offset)===34){ad='"';r(K,1)}else{ad=null;if(T===0){w('"\\""')}}if(ad!==null){ab=j();if(ab!==null){if(i.charCodeAt(K.offset)===34){aa='"';r(K,1)}else{aa=null;if(T===0){w('"\\""')}}if(aa!==null){ad=[ad,ab,aa]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(ai,ag,ah,af){return["literal",af]})(ae.offset,ae.line,ae.column,ad[1])}if(ad===null){K=B(ae)}if(ad===null){ae=B(K);ac=B(K);if(i.charCodeAt(K.offset)===34){ad='"';r(K,1)}else{ad=null;if(T===0){w('"\\""')}}if(ad!==null){aa=O();if(aa!==null){ab=[];while(aa!==null){ab.push(aa);aa=O()}}else{ab=null}if(ab!==null){if(i.charCodeAt(K.offset)===34){aa='"';r(K,1)}else{aa=null;if(T===0){w('"\\""')}}if(aa!==null){ad=[ad,ab,aa]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(ai,af,ag,ah){return["body"].concat(ah)})(ae.offset,ae.line,ae.column,ad[1])}if(ad===null){K=B(ae)}}}T--;if(T===0&&ad===null){w("inline")}return ad}function O(){var aa;var ab;aa=f();if(aa===null){aa=Y();if(aa===null){ab=B(K);aa=j();if(aa!==null){aa=(function(af,ad,ae,ac){return["buffer",ac]})(ab.offset,ab.line,ab.column,aa)}if(aa===null){K=B(ab)}}}return aa}function X(){var ae,ad,ac,ab,aa;var ai,ah,ag,af;T++;ai=B(K);ah=B(K);ae=q();if(ae!==null){ad=[];ac=Q();while(ac!==null){ad.push(ac);ac=Q()}if(ad!==null){ae=[ae,ad]}else{ae=null;K=B(ah)}}else{ae=null;K=B(ah)}if(ae!==null){ae=(function(an,ak,al,am,aj){return["format",am,aj.join("")]})(ai.offset,ai.line,ai.column,ae[0],ae[1])}if(ae===null){K=B(ai)}if(ae===null){ai=B(K);ah=B(K);ag=B(K);af=B(K);T++;ad=l();T--;if(ad===null){ad=""}else{ad=null;K=B(af)}if(ad!==null){af=B(K);T++;ac=q();T--;if(ac===null){ac=""}else{ac=null;K=B(af)}if(ac!==null){af=B(K);T++;ab=G();T--;if(ab===null){ab=""}else{ab=null;K=B(af)}if(ab!==null){if(i.length>K.offset){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("any character")}}if(aa!==null){ad=[ad,ac,ab,aa]}else{ad=null;K=B(ag)}}else{ad=null;K=B(ag)}}else{ad=null;K=B(ag)}}else{ad=null;K=B(ag)}if(ad!==null){ad=(function(al,aj,ak,am){return am})(ah.offset,ah.line,ah.column,ad[3])}if(ad===null){K=B(ah)}if(ad!==null){ae=[];while(ad!==null){ae.push(ad);ah=B(K);ag=B(K);af=B(K);T++;ad=l();T--;if(ad===null){ad=""}else{ad=null;K=B(af)}if(ad!==null){af=B(K);T++;ac=q();T--;if(ac===null){ac=""}else{ac=null;K=B(af)}if(ac!==null){af=B(K);T++;ab=G();T--;if(ab===null){ab=""}else{ab=null;K=B(af)}if(ab!==null){if(i.length>K.offset){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("any character")}}if(aa!==null){ad=[ad,ac,ab,aa]}else{ad=null;K=B(ag)}}else{ad=null;K=B(ag)}}else{ad=null;K=B(ag)}}else{ad=null;K=B(ag)}if(ad!==null){ad=(function(al,aj,ak,am){return am})(ah.offset,ah.line,ah.column,ad[3])}if(ad===null){K=B(ah)}}}else{ae=null}if(ae!==null){ae=(function(am,ak,al,aj){return["buffer",aj.join("")]})(ai.offset,ai.line,ai.column,ae)}if(ae===null){K=B(ai)}}T--;if(T===0&&ae===null){w("buffer")}return ae}function j(){var af,ad,ab;var ag,ae,ac,aa;T++;ag=B(K);ae=B(K);ac=B(K);aa=B(K);T++;ad=l();T--;if(ad===null){ad=""}else{ad=null;K=B(aa)}if(ad!==null){ab=h();if(ab===null){if(/^[^"]/.test(i.charAt(K.offset))){ab=i.charAt(K.offset);r(K,1)}else{ab=null;if(T===0){w('[^"]')}}}if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(aj,ah,ai,ak){return ak})(ae.offset,ae.line,ae.column,ad[1])}if(ad===null){K=B(ae)}if(ad!==null){af=[];while(ad!==null){af.push(ad);ae=B(K);ac=B(K);aa=B(K);T++;ad=l();T--;if(ad===null){ad=""}else{ad=null;K=B(aa)}if(ad!==null){ab=h();if(ab===null){if(/^[^"]/.test(i.charAt(K.offset))){ab=i.charAt(K.offset);r(K,1)}else{ab=null;if(T===0){w('[^"]')}}}if(ab!==null){ad=[ad,ab]}else{ad=null;K=B(ac)}}else{ad=null;K=B(ac)}if(ad!==null){ad=(function(aj,ah,ai,ak){return ak})(ae.offset,ae.line,ae.column,ad[1])}if(ad===null){K=B(ae)}}}else{af=null}if(af!==null){af=(function(ak,ai,aj,ah){return ah.join("")})(ag.offset,ag.line,ag.column,af)}if(af===null){K=B(ag)}T--;if(T===0&&af===null){w("literal")}return af}function h(){var aa;var ab;ab=B(K);if(i.substr(K.offset,2)==='\\"'){aa='\\"';r(K,2)}else{aa=null;if(T===0){w('"\\\\\\""')}}if(aa!==null){aa=(function(ae,ac,ad){return'"'})(ab.offset,ab.line,ab.column)}if(aa===null){K=B(ab)}return aa}function G(){var ad,ac,ab,aa;var ai,ah,ag,af,ae;T++;ai=B(K);ah=B(K);if(i.substr(K.offset,2)==="{!"){ad="{!";r(K,2)}else{ad=null;if(T===0){w('"{!"')}}if(ad!==null){ac=[];ag=B(K);af=B(K);ae=B(K);T++;if(i.substr(K.offset,2)==="!}"){ab="!}";r(K,2)}else{ab=null;if(T===0){w('"!}"')}}T--;if(ab===null){ab=""}else{ab=null;K=B(ae)}if(ab!==null){if(i.length>K.offset){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("any character")}}if(aa!==null){ab=[ab,aa]}else{ab=null;K=B(af)}}else{ab=null;K=B(af)}if(ab!==null){ab=(function(al,aj,ak,am){return am})(ag.offset,ag.line,ag.column,ab[1])}if(ab===null){K=B(ag)}while(ab!==null){ac.push(ab);ag=B(K);af=B(K);ae=B(K);T++;if(i.substr(K.offset,2)==="!}"){ab="!}";r(K,2)}else{ab=null;if(T===0){w('"!}"')}}T--;if(ab===null){ab=""}else{ab=null;K=B(ae)}if(ab!==null){if(i.length>K.offset){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("any character")}}if(aa!==null){ab=[ab,aa]}else{ab=null;K=B(af)}}else{ab=null;K=B(af)}if(ab!==null){ab=(function(al,aj,ak,am){return am})(ag.offset,ag.line,ag.column,ab[1])}if(ab===null){K=B(ag)}}if(ac!==null){if(i.substr(K.offset,2)==="!}"){ab="!}";r(K,2)}else{ab=null;if(T===0){w('"!}"')}}if(ab!==null){ad=[ad,ac,ab]}else{ad=null;K=B(ah)}}else{ad=null;K=B(ah)}}else{ad=null;K=B(ah)}if(ad!==null){ad=(function(al,aj,ak,am){return["comment",am.join("")]})(ai.offset,ai.line,ai.column,ad[1])}if(ad===null){K=B(ai)}T--;if(T===0&&ad===null){w("comment")}return ad}function l(){var ag,af,ae,ad,ac,ab,aa;var aj,ai,ah;aj=B(K);ag=F();if(ag!==null){if(/^[#?^><+%:@\/~%]/.test(i.charAt(K.offset))){af=i.charAt(K.offset);r(K,1)}else{af=null;if(T===0){w("[#?^><+%:@\\/~%]")}}if(af!==null){ae=[];ad=Q();while(ad!==null){ae.push(ad);ad=Q()}if(ae!==null){ai=B(K);ah=B(K);T++;ac=J();T--;if(ac===null){ac=""}else{ac=null;K=B(ah)}if(ac!==null){ah=B(K);T++;ab=q();T--;if(ab===null){ab=""}else{ab=null;K=B(ah)}if(ab!==null){if(i.length>K.offset){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("any character")}}if(aa!==null){ac=[ac,ab,aa]}else{ac=null;K=B(ai)}}else{ac=null;K=B(ai)}}else{ac=null;K=B(ai)}if(ac!==null){ad=[];while(ac!==null){ad.push(ac);ai=B(K);ah=B(K);T++;ac=J();T--;if(ac===null){ac=""}else{ac=null;K=B(ah)}if(ac!==null){ah=B(K);T++;ab=q();T--;if(ab===null){ab=""}else{ab=null;K=B(ah)}if(ab!==null){if(i.length>K.offset){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("any character")}}if(aa!==null){ac=[ac,ab,aa]}else{ac=null;K=B(ai)}}else{ac=null;K=B(ai)}}else{ac=null;K=B(ai)}}}else{ad=null}if(ad!==null){ac=[];ab=Q();while(ab!==null){ac.push(ab);ab=Q()}if(ac!==null){ab=J();if(ab!==null){ag=[ag,af,ae,ad,ac,ab]}else{ag=null;K=B(aj)}}else{ag=null;K=B(aj)}}else{ag=null;K=B(aj)}}else{ag=null;K=B(aj)}}else{ag=null;K=B(aj)}}else{ag=null;K=B(aj)}if(ag===null){ag=Y()}return ag}function F(){var aa;if(i.charCodeAt(K.offset)===123){aa="{";r(K,1)}else{aa=null;if(T===0){w('"{"')}}return aa}function J(){var aa;if(i.charCodeAt(K.offset)===125){aa="}";r(K,1)}else{aa=null;if(T===0){w('"}"')}}return aa}function q(){var aa;if(i.charCodeAt(K.offset)===10){aa="\n";r(K,1)}else{aa=null;if(T===0){w('"\\n"')}}if(aa===null){if(i.substr(K.offset,2)==="\r\n"){aa="\r\n";r(K,2)}else{aa=null;if(T===0){w('"\\r\\n"')}}if(aa===null){if(i.charCodeAt(K.offset)===13){aa="\r";r(K,1)}else{aa=null;if(T===0){w('"\\r"')}}if(aa===null){if(i.charCodeAt(K.offset)===8232){aa="\u2028";r(K,1)}else{aa=null;if(T===0){w('"\\u2028"')}}if(aa===null){if(i.charCodeAt(K.offset)===8233){aa="\u2029";r(K,1)}else{aa=null;if(T===0){w('"\\u2029"')}}}}}}return aa}function Q(){var aa;if(/^[\t\x0B\f \xA0\uFEFF]/.test(i.charAt(K.offset))){aa=i.charAt(K.offset);r(K,1)}else{aa=null;if(T===0){w("[\\t\\x0B\\f \\xA0\\uFEFF]")}}if(aa===null){aa=q()}return aa}function D(ac){ac.sort();var ad=null;var ab=[];for(var aa=0;aa<ac.length;aa++){if(ac[aa]!==ad){ab.push(ac[aa]);ad=ac[aa]}}return ab}var y=g[n]();if(y===null||K.offset!==i.length){var P=Math.max(K.offset,k.offset);var m=P<i.length?i.charAt(P):null;var S=K.offset>k.offset?K:k;throw new b.SyntaxError(D(s),m,P,S.line,S.column)}return y},toSource:function(){return this._source}};c.SyntaxError=function(h,i,j,f,g){function e(m,n){var k,l;switch(m.length){case 0:k="end of input";break;case 1:k=m[0];break;default:k=m.slice(0,m.length-1).join(", ")+" or "+m[m.length-1]}l=n?d(n):"end of input";return"Expected "+k+" but "+l+" found."}this.name="SyntaxError";this.expected=h;this.found=i;this.message=e(h,i);this.offset=j;this.line=f;this.column=g};c.SyntaxError.prototype=Error.prototype;return c})();a.parse=b.parse})(typeof exports!=="undefined"?exports:getGlobal());var $=$||jQuery;var BB=BB||{};BB.Core=BB.Core||{};BB.Core.Util=(function(){return{format:function(c,d){var b,a;if(typeof(d)==="object"&&d!==null){for(a in d){if(d.hasOwnProperty(a)){b=new RegExp("{"+a+"}","g");c=c.replace(b,d[a])}}}return c},formatFloat:function(b,a){if(b===undefined||b===null||isNaN(b)){if(a===undefined||a===null){return"0"}else{return a}}else{return parseFloat(b,10).toString().replace(/\.([0-9]).*/,".$1").replace(/\.0/,"")}},formatInt:function(a,b){a=parseInt(a,10);if(isNaN(a)){return"0"}else{a=parseInt(a,10);if(b!==undefined&&b>0){return((a>b)?(b.toString(10)+"+"):a.toString(10))}else{return a.toString(10)}}},formatDate:function(b){var d=b.getMinutes().toString(),a=b.getHours(),c=BB.Loc.get("AM");if(d.length===1){d="0"+d}if(a>=12){if(a!==12){a=a-12}c=BB.Loc.get("PM")}else{if(a===0){a=12}}return(BB.Loc.get("MONTH_"+b.getMonth())+" "+b.getDate()+", "+b.getFullYear()+" "+a+":"+d+" "+c)},formatImageURLProfile:function(a,b){var c=BB.Data.Env.get(BB.Data.Env.keys.defaultAvatarURLPrefix);if(BB.Data.User.get(BB.Data.User.keys.isAvatarURLSet)){return a}else{switch(BB.Data.User.get(BB.Data.User.keys.gender)){case"his":case"male":return c+"Avatar-Male-Default_"+b+".jpg";case"her":case"female":return c+"Avatar-Female-Default_"+b+".jpg";default:return c+"Avatar-Unisex-Default_"+b+".jpg"}}},toKg:function(a){return(a*0.453592)},toCm:function(a){return(a*2.54)},toDate:function(a){var b=new Date(0);if(typeof(a)==="number"){b.setUTCSeconds(a)}else{b=a}return b},createNamespace:function(e){var f=e.split("."),c,d=BB,a,b=f.length;for(c=0;c<b;c++){a=f[c];if(a!=="BB"){d[a]=d[a]||{};d=d[a]}}return d},createRandomId:function(){return(Math.floor(Math.random()*(new Date()).getTime()))}}}());BB.Core.Util.cookie=(function(){var c=function(f){try{if(f===undefined||typeof f!=="string"){throw"You must define a name as a string when searching for a cookie"}}catch(h){BB.Tool.Debug.log(h);return null}var j=document.cookie.split(";"),g,d=j.length,l={},e,k;for(g=0;g<d;g++){e=j[g].split("=");k=e[0].replace(/^\s+|\s+$/g,"");if(k===f){l.name=k;l.value=e[1].replace(/^\s+|\s+$/g,"");break}}return l},a=function(e){e=e||{};try{if(e.name===undefined||e.value===undefined){throw"You must define an object when setting a cookie with at least a name and value parameter"}}catch(j){BB.Tool.Debug.log(j);return null}var g=new Date(),l=(e.expires!==undefined)?(g.setTime(g.getTime()))+(parseFloat(e.expires)*24*60*60*1000):"",f=(e.expires!==undefined)?"; expires="+new Date(l).toGMTString():"",n=(e.path!==undefined)?"; path="+e.path:"",h=(e.domain!==undefined)?"; domain="+e.domain:"",d=(e.secure!==undefined)?"; secure="+e.secure:"",m=e.name+"="+e.value,i=f+n+h+d+";",k=c(e.name);if(k===null){document.cookie=m+i;return m+i}else{if(e.overwrite){document.cookie=m+i;return m+i}}return k},b=function(d){try{if(d===undefined||typeof d!=="string"){throw"You must define a name as a string when removing a cookie"}}catch(e){BB.Tool.Debug.log(e);return null}return a({name:d,value:"",expires:-1})};return{set:function(d){return a(d)},get:function(d){return c(d)},remove:function(d){return b(d)}}}());BB.Core.Util.Base64=(function(){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=function(e){var d="",g=0;e=e.replace(/\r\n/g,"\n");for(g=0;g<e.length;g++){var f=e.charCodeAt(g);if(f<128){d+=String.fromCharCode(f)}else{if((f>127)&&(f<2048)){d+=String.fromCharCode((f>>6)|192);d+=String.fromCharCode((f&63)|128)}else{d+=String.fromCharCode((f>>12)|224);d+=String.fromCharCode(((f>>6)&63)|128);d+=String.fromCharCode((f&63)|128)}}}return d},c=function(d){var f="",h=0,k=0,j=0,g=0,e=0;while(h<d.length){k=d.charCodeAt(h);if(k<128){f+=String.fromCharCode(k);h++}else{if((k>191)&&(k<224)){g=d.charCodeAt(h+1);f+=String.fromCharCode(((k&31)<<6)|(g&63));h+=2}else{g=d.charCodeAt(h+1);e=d.charCodeAt(h+2);f+=String.fromCharCode(((k&15)<<12)|((g&63)<<6)|(e&63));h+=3}}}return f};return{encode:function(f){var d="",e=0,n,l,j,m,k,h,g;f=a(f);while(e<f.length){n=f.charCodeAt(e++);l=f.charCodeAt(e++);j=f.charCodeAt(e++);m=n>>2;k=((n&3)<<4)|(l>>4);h=((l&15)<<2)|(j>>6);g=j&63;if(isNaN(l)){h=g=64}else{if(isNaN(j)){g=64}}d=d+b.charAt(m)+b.charAt(k)+b.charAt(h)+b.charAt(g)}return d},decode:function(f){var d="",n,l,j,m,k,h,g,e=0;f=f.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(e<f.length){m=b.indexOf(f.charAt(e++));k=b.indexOf(f.charAt(e++));h=b.indexOf(f.charAt(e++));g=b.indexOf(f.charAt(e++));n=(m<<2)|(k>>4);l=((k&15)<<4)|(h>>2);j=((h&3)<<6)|g;d=d+String.fromCharCode(n);if(h!==64){d=d+String.fromCharCode(l)}if(g!==64){d=d+String.fromCharCode(j)}}d=c(d);return d}}}());(function(){BB.createNamespace("BB.Core.Util");BB.Core.Util.md5=(function(){var a=function(){var n=0,k=8,i=function(q,t){var s=(q&65535)+(t&65535),r=(q>>16)+(t>>16)+(s>>16);return(r<<16)|(s&65535)},m=function(q,r){return(q<<r)|(q>>>(32-r))},e=function(z,v,u,r,y,w){return i(m(i(i(v,z),i(r,w)),y),u)},j=function(u,r,z,y,q,w,v){return e((r&z)|((~r)&y),u,r,q,w,v)},o=function(u,r,z,y,q,w,v){return e(r^z^y,u,r,q,w,v)},h=function(u,r,z,y,q,w,v){return e(z^(r|(~y)),u,r,q,w,v)},g=function(B,v){var A=1732584193,z=-271733879,y=-1732584194,w=271733878,s,u,t,r,q;B[v>>5]|=128<<((v)%32);B[(((v+64)>>>9)<<4)+14]=v;for(s=0;s<B.length;s+=16){u=A;t=z;r=y;q=w;A=j(A,z,y,w,B[s],7,-680876936);w=j(w,A,z,y,B[s+1],12,-389564586);y=j(y,w,A,z,B[s+2],17,606105819);z=j(z,y,w,A,B[s+3],22,-1044525330);A=j(A,z,y,w,B[s+4],7,-176418897);w=j(w,A,z,y,B[s+5],12,1200080426);y=j(y,w,A,z,B[s+6],17,-1473231341);z=j(z,y,w,A,B[s+7],22,-45705983);A=j(A,z,y,w,B[s+8],7,1770035416);w=j(w,A,z,y,B[s+9],12,-1958414417);y=j(y,w,A,z,B[s+10],17,-42063);z=j(z,y,w,A,B[s+11],22,-1990404162);A=j(A,z,y,w,B[s+12],7,1804603682);w=j(w,A,z,y,B[s+13],12,-40341101);y=j(y,w,A,z,B[s+14],17,-1502002290);z=j(z,y,w,A,B[s+15],22,1236535329);A=d(A,z,y,w,B[s+1],5,-165796510);w=d(w,A,z,y,B[s+6],9,-1069501632);y=d(y,w,A,z,B[s+11],14,643717713);z=d(z,y,w,A,B[s],20,-373897302);A=d(A,z,y,w,B[s+5],5,-701558691);w=d(w,A,z,y,B[s+10],9,38016083);y=d(y,w,A,z,B[s+15],14,-660478335);z=d(z,y,w,A,B[s+4],20,-405537848);A=d(A,z,y,w,B[s+9],5,568446438);w=d(w,A,z,y,B[s+14],9,-1019803690);y=d(y,w,A,z,B[s+3],14,-187363961);z=d(z,y,w,A,B[s+8],20,1163531501);A=d(A,z,y,w,B[s+13],5,-1444681467);w=d(w,A,z,y,B[s+2],9,-51403784);y=d(y,w,A,z,B[s+7],14,1735328473);z=d(z,y,w,A,B[s+12],20,-1926607734);A=o(A,z,y,w,B[s+5],4,-378558);w=o(w,A,z,y,B[s+8],11,-2022574463);y=o(y,w,A,z,B[s+11],16,1839030562);z=o(z,y,w,A,B[s+14],23,-35309556);A=o(A,z,y,w,B[s+1],4,-1530992060);w=o(w,A,z,y,B[s+4],11,1272893353);y=o(y,w,A,z,B[s+7],16,-155497632);z=o(z,y,w,A,B[s+10],23,-1094730640);A=o(A,z,y,w,B[s+13],4,681279174);w=o(w,A,z,y,B[s],11,-358537222);y=o(y,w,A,z,B[s+3],16,-722521979);z=o(z,y,w,A,B[s+6],23,76029189);A=o(A,z,y,w,B[s+9],4,-640364487);w=o(w,A,z,y,B[s+12],11,-421815835);y=o(y,w,A,z,B[s+15],16,530742520);z=o(z,y,w,A,B[s+2],23,-995338651);A=h(A,z,y,w,B[s],6,-198630844);w=h(w,A,z,y,B[s+7],10,1126891415);y=h(y,w,A,z,B[s+14],15,-1416354905);z=h(z,y,w,A,B[s+5],21,-57434055);A=h(A,z,y,w,B[s+12],6,1700485571);w=h(w,A,z,y,B[s+3],10,-1894986606);y=h(y,w,A,z,B[s+10],15,-1051523);z=h(z,y,w,A,B[s+1],21,-2054922799);A=h(A,z,y,w,B[s+8],6,1873313359);w=h(w,A,z,y,B[s+15],10,-30611744);y=h(y,w,A,z,B[s+6],15,-1560198380);z=h(z,y,w,A,B[s+13],21,1309151649);A=h(A,z,y,w,B[s+4],6,-145523070);w=h(w,A,z,y,B[s+11],10,-1120210379);y=h(y,w,A,z,B[s+2],15,718787259);z=h(z,y,w,A,B[s+9],21,-343485551);A=i(A,u);z=i(z,t);y=i(y,r);w=i(w,q)}return new Array(A,z,y,w)},d=function(u,r,z,y,q,w,v){return e((r&y)|(z&(~y)),u,r,q,w,v)},b=function(t){var s=[],r,q=(1<<k)-1;for(r=0;r<t.length*k;r+=k){s[r>>5]|=(t.charCodeAt(r/k)&q)<<(r%32)}return s},p=function(s){var r=n?"0123456789ABCDEF":"0123456789abcdef",t="",q;for(q=0;q<s.length*4;q++){t+=r.charAt((s[q>>2]>>((q%4)*8+4))&15)+r.charAt((s[q>>2]>>((q%4)*8))&15)}return t},f=function(t){var q="",s,u,r;for(s=0;s<t.length;s++){u=t.charCodeAt(s);r="";if(u>255){while(u>=1){r="0123456789".charAt(u%10)+r;u=u/10}if(r===""){r="0"}r="#"+r;r="&"+r;r=r+";";q+=r}else{q+=t.charAt(s)}}return q},l=function(q){return p(g(b(q),q.length*k))},c=function(q){while(q.substring(0,1)===" "){q=q.substring(1,q.length)}while(q.substring(q.length-1,q.length)===" "){q=q.substring(0,q.length-1)}return q};this.md5hashAuto=function(r,q,u,s){if(parseInt(navigator.appVersion,10)>=4){var t=l(f(c(r.value)));q.value=t;if(u){t=l(c(r.value));u.value=t}if(!s){r.value=""}}return true};this.md5hash=function(s,r){if(typeof r==="undefined"){r=false}var q="";if(parseInt(navigator.appVersion,10)>=4){if(r){q=l(c(s.value));output_utf.value=md5string}else{q=l(f(c(s)))}}return q}};return new a()}());BB.Util.md5=BB.Core.Util.md5}());BB.Core.MessageController=function(a){this.messageQueue={};if(a){this.messageControllerName=a.name||"Unamed message controller";this.parentMessageController=a.parentMessageController||false}};BB.Core.MessageController.prototype.registerListener=function(b,a,c){if(this.messageQueue[b]){this.messageQueue[b][a]=c}else{this.messageQueue[b]={};this.messageQueue[b][a]=c}BB.Tool.Debug.log(this.messageControllerName+": "+a+" has been registered under "+b)};BB.Core.MessageController.prototype.sendMessage=function(f,g,c){var i,b;try{i=this.messageQueue[f];b=""}catch(h){BB.Tool.Debug.log(h);return false}for(b in i){if(i.hasOwnProperty(b)){try{i[b](g)}catch(d){BB.Tool.Debug.log(this.messageControllerName+": There was an error sending a message to a member of "+f+" with the UID of "+b);BB.Tool.Debug.log(d)}}}BB.Tool.Debug.log(this.messageControllerName+": "+g+" has been sent to all registered listeners attached to "+f);if(this.parentMessageController&&!c){try{BB.Tool.Debug.log(this.messageControllerName+": "+g+" has been forwarded to the parent message controller.");this.parentMessageController.sendMessage(f,g)}catch(a){BB.Tool.Debug.log(this.messageControllerName+": The parent message controller was called but returned an error.");BB.Tool.Debug.log(this.messageControllerName+": "+a)}}};BB.Core.MessageController.prototype.unregisterListener=function(b,a){try{delete this.messageQueue[b][a]}catch(c){BB.Core.Log.warn(c)}BB.Tool.Debug.log(this.messageControllerName+": "+a+" has been unregistered from "+b)};BB.Core.Messenger=new BB.Core.MessageController({name:"Global Message Controller"});BB.createNamespace("BB.Controller");BB.Controller.MessageController=BB.Core.MessageController;BB.Controller.Messenger=BB.Core.Messenger;BB.Core=BB.Core||{};BB.Core.Iris=(function(a){if(typeof BB.Util.Iris==="object"){return BB.Util.Iris}else{return{settings:{},localStorage:(function(){var f,b,c;try{c=new Date();(f=window.localStorage).setItem(c,c);b=f.getItem(c)!==c;f.removeItem(c)}catch(d){}return f}()),saveAPICall:function(c,b){if(this.localStorage&&!this.localStorage.getItem(c)){if(!this.settings.timeToExpire){var d=new Date().getTime()+(1000*60*60*8);d=new Date(d);this.settings.timeToExpire=d.toString()}if(this.settings.validateCachedData&&typeof(this.settings.validateCachedData)==="function"&&!this.settings.validateCachedData(b)){BB.Tool.Debug.log("Data not saved to localStorage, because it was invalid");return false}this.localStorage.setItem(c,JSON.stringify(b));this.localStorage.setItem("expires-"+c,this.settings.timeToExpire);return true}return false},getAPICall:function(c){if(this.localStorage&&this.localStorage.getItem(c)){if(this.localStorage.getItem("expires-"+c)){var d=this.localStorage.getItem("expires-"+c),b=new Date();d=new Date(d);if(b<=d){if(this.settings.validateCachedData&&typeof(this.settings.validateCachedData)==="function"&&!this.settings.validateCachedData(JSON.parse(this.localStorage.getItem(c)))){BB.Tool.Debug.log("Invalid data removed from localStorage");this.localStorage.removeItem(c);this.localStorage.removeItem("expires-"+c);return false}return JSON.parse(this.localStorage.getItem(c))}else{this.localStorage.removeItem(c);this.localStorage.removeItem("expires-"+c)}}}return false},callAPI:function(h,g,b,c,f){this.settings=a.extend({timeToExpire:"",validateCachedData:"",timeout:30000},c);if(!g){g=a.noop}if(this.getAPICall(h)){g(this.getAPICall(h),"localStorage")}else{var d=b||function(k,i,j){BB.Tool.Debug.log(j)},e=function(j,i){return function(m,k,n){var l;if(m.err_msg){l="URL "+j+" Returned with 200 success but actual data object had error message: ";BB.Tool.Debug.log(l,m.err_msg);d(n,"error",l);return false}i.saveAPICall(j,m);g(m,k,n)}};if(a.browser.msie){a.ajax({url:h,data:f,dataType:"jsonp",cache:false,crossDomain:true,success:e(h,this),error:d,timeout:this.settings.timeout})}else{a.ajax({url:h,data:f,dataType:"json",success:e(h,this),error:d,timeout:this.settings.timeout})}}}}}}(jQuery));BB.Tool=BB.Tool||{};BB.Tool.Debug=(function(){return{log:function(a){}}}());BB.Data=BB.Data||{};BB.Data.Env=(function(){var i={},k="currentLanguage",g="pageOwnerSlug",l="isHTTPS",e="isHTTP",f="isQuirksMode",a="protocol",c="url",h="pageId",j="strikes",d="urlCallback",b="defaultAvatarURLPrefix";i[b]="http://common.bbcomcdn.com/images/default-avatar/";i[k]="en-us";i[g]="";i[h]="";i[a]=window.location.protocol;i[l]=(i[a]==="https:");i[e]=(i[a]==="http:");i[f]=(document.compatMode!=="CSS1Compat"&&/MSIE/.test(navigator.userAgent)&&(!(/MSIE 10\.0/.test(navigator.userAgent))));i[d]=function(){var m="callback",o=new RegExp("[\\?&]"+m+"=([^&#]*)"),n=o.exec(window.location.search);if(n===null){return null}else{return decodeURIComponent(n[1].replace(/\+/g," "))}};i[j]=function(){var p=window.location.search.substring(1).split("&"),n,m=p.length,o,q=0;for(n=0;n<m;n++){o=p[n].split("=");if(o[0]==="s"&&o[1]>q){q=parseInt(o[1],10)}}return((q>5)?5:q)};i[c]=function(){var m=window.location.href.split("?"),p="",r,o,q,n;if(m.length>1&&m[1].length>0){r=m[1].split("&");o=r.length;for(n=0;n<o;n++){q=r[n].split("=");if(q[0]!=="s"){if(p===""){p="?"+r[n]}else{p=p+"&"+r[n]}}}}return m[0]+p};return{get:function(m){if(typeof(i[m])==="function"){return i[m]()}else{return i[m]}},set:function(m,n){i[m]=n},keys:{pageOwnerSlug:g,pageId:h,currentLanguage:k,strikes:j,isHTTPS:l,isHTTP:e,isQuirksMode:f,protocol:a,url:c,urlCallback:d,defaultAvatarURLPrefix:b}}}());BB.Data=BB.Data||{};BB.Data.Setup=(function(){var b=function(d){var e,f,c=0;if(d!==undefined&&d!==null){for(e in d){if(d.hasOwnProperty(e)){if(BB.Data[e]===undefined||BB.Data[e]===null){BB.Tool.Debug.log("NameSpace not wired on BB.Data."+e);return false}else{for(f in d[e]){if(d[e].hasOwnProperty(f)){if(BB.Data[e].get(f)===undefined){BB.Tool.Debug.log("Property not wired on BB.Data."+e+"."+f);return false}else{c++}}}}}}}else{return false}if(c===0){return false}else{return true}},a=function(d){var e,f,c=0;for(e in d){if(d.hasOwnProperty(e)){for(f in d[e]){if(d[e].hasOwnProperty(f)){BB.Data[e].set(f,d[e][f]);c++}}}}return c};return{"import":function(c){if(b(c)){return a(c)}return 0}}}());BB.Data=BB.Data||{};BB.Data.User=(function(){var q={},l={},r=new BB.Core.MessageController({name:"userObjectNotification"}),C="id",w="slug",M="userName",u="isLoggedIn",G="status",d="motivationLevel",D="fitStatus",c="notifications",L="actionItems",b="requests",H="messages",a="weight",B="bodyfat",p="height",n="avatarURL",h="gender",K="units",k="unitsOfWeight",F="unitsOfLength",i="isMetric",o="isImperial",f="isAvatarURLSet",v="isSuperModerator",m="isAdministrator",y="isModerator",A="isIFBB",z="isVideoAdmin",t="isActive",g="isInactive",e="isCOPPA",J="isBanned",j="isMotivationLevelSet",I="isFitStatusSet",E={isAvatarURLSet:true,isSuperModerator:true,isAdministrator:true,isModerator:true,isIFBB:true,isVideoAdmin:true,isActive:true,isInactive:true,isCOPPA:true,isBanned:true,isMetric:true,isImperial:true,unitsOfWeight:true,unitsOfLength:true,isFitStatusSet:true,isMotivationLevelSet:true},s=function(N,O){r.sendMessage("",{});switch(N){case n:if(O===undefined||O===null||typeof(O)!=="string"||O.length<25){q[f]=false;return false}else{q[f]=true}break;case K:switch(O){case"metric":q[i]=true;q[o]=false;q[k]="Kg.";q[F]="Lbs";break;default:q[i]=false;q[o]=true;q[k]="Lbs.";q[F]="in."}break;case G:switch(O){case 5:q[v]=true;q[t]=true;break;case 6:q[m]=true;q[t]=true;break;case 7:q[y]=true;q[t]=true;break;case 9:q[A]=true;q[t]=true;break;case 11:q[z]=true;q[t]=true;break;case 2:q[t]=true;break;case 3:case 10:q[g]=true;break;case 4:q[e]=true;break;case 8:q[J]=true;break;default:q[t]=true}break;case D:q[I]=true;break;case d:q[j]=true;break}q[N]=O;return true},x=function(O,Q){var P=O,N=Q;return{success:function(R){s(P,N)},error:function(R){}}};l[a]={suffixSet:"stats/set",suffixGet:"stats/get",params:function(N){return{value:N,stat:a,unit:BB.Data.User.get(BB.Data.User.keys.units)}},callbacks:x};l[B]={suffixSet:"stats/set",suffixGet:"stats/get",params:function(N){return{value:N,stat:B,unit:BB.Data.User.get(BB.Data.User.keys.units)}},callbacks:x};l[p]={suffixSet:"stats/set",suffixGet:"stats/get",params:function(N){return{value:N,stat:p,unit:BB.Data.User.get(BB.Data.User.keys.units)}},callbacks:x};l[D]={suffixSet:"fitstatus/set",suffixGet:"fitstatus/get",params:function(N){return{content:N}},callbacks:x};l[d]={suffixSet:"motivation/set",suffixGet:"motivation/get",params:function(N){return{level:N}},callbacks:x};q[C]=null;q[w]=null;q[M]=null;q[G]=null;q[u]=function(){return(BB.Core.Util.cookie.get("v1guid").name!==undefined&&typeof(q[w])==="string"&&q[w].length>0&&typeof(q[M])==="string"&&q[M].length>0)};q[d]=null;q[D]=null;q[I]=false;q[j]=false;q[v]=false;q[m]=false;q[y]=false;q[A]=false;q[z]=false;q[t]=false;q[g]=false;q[e]=false;q[J]=false;q[L]=null;q[H]=null;q[c]=null;q[b]=null;q[a]=null;q[B]=null;q[p]=null;q[n]=null;q[f]=false;q[h]=null;q[K]="imperial";q[i]=false;q[o]=true;q[k]="Lbs.";q[F]="in.";return{get:function(N){if(typeof(q[N])==="function"){return q[N]()}else{return q[N]}},clear:function(N){if(q[N]===undefined||E[N]){return false}else{q[N]=null}},set:function(N,O,P){if(q[N]===undefined||E[N]){return false}else{if(P){if(l[N]&&typeof(l[N].params)==="function"){BB.API.call(l[N].suffixSet,l[N].params(O),l[N].callbacks(N,O));return true}else{BB.Tool.Debug.log("APIcall was requested but no API accesPoint reference was found for:"+N);return false}}else{s(N,O);return true}}},registerForUpdates:function(N){r.registerListener("",BB.Core.Util.createRandomId(),N)},keys:{id:C,isLoggedIn:u,slug:w,userName:M,gender:h,status:G,units:K,unitsOfWeight:k,unitsOfLength:F,fitStatus:D,motivationLevel:d,notifications:c,actionItems:L,requests:b,messages:H,weight:a,bodyfat:B,height:p,avatarURL:n,isAvatarURLSet:f,isSuperModerator:v,isAdministrator:m,isModerator:y,isIFBB:A,isVideoAdmin:z,isActive:t,isInactive:g,isCOPPA:e,isBanned:J,isFitStatusSet:I,isMotivationLevelSet:j,isMetric:i,isImperial:o}}}());BB.Data=BB.Data||{};BB.Data.Action=(function(){var l={},c="valueRoller",g="modalUpdateAsyncDynamic",d="persistentClose",i="jqueryAction",j="exclusiveToggle",f="link",b="linkNewPage",m="workflow",e="forcedLogin",a="scroll",k="manual",h="validation";return{get:function(n){if(typeof(l[n])==="function"){return l[n]()}else{return l[n]}},set:function(n,o){l[n]=o},keys:{valueRoller:c,modalUpdateAsyncDynamic:g,persistentClose:d,jqueryAction:i,exclusiveToggle:j,link:f,linkNewPage:b,workflow:m,forcedLogin:e,scroll:a,manual:k,validation:h}}}());BB.Data=BB.Data||{};BB.Data.Callback=(function(){var c={},b="success",d="error",a="timeout";return{get:function(e){if(typeof(c[e])==="function"){return c[e]()}else{return c[e]}},keys:{success:b,error:d,timeout:a}}}());BB.Loc=(function(){var a="en-us",b=1350588632516,c="//common.bbcomcdn.com/loc/min/",d={"en-us":{MONTH_0:"Jan",MONTH_1:"Feb",MONTH_2:"Mar",MONTH_3:"Apr",MONTH_4:"May",MONTH_5:"Jun",MONTH_6:"Jul",MONTH_7:"Aug",MONTH_8:"Sep",MONTH_9:"Oct",MONTH_10:"Nov",MONTH_11:"Dec",AM:"am",PM:"pm",LAST_UPDATE:"Last Update",LAST_UPDATE_MOTIVATION_LEVEL:"Last updated to {motivation_level} on",ADV_1:"Free",ADV_2:"Join Now",ADV_3:"Customized Content",ADV_4:"Massive Online Community",ADV_5:"Track Your Progress",ADV_6:"",YES:"Yes",NO:"No",CLOSE:"Close",CANCEL:"Cancel",SAVE:"Save",SIGN_UP:"Sign Up",MEMBER_LOGIN:"Member Login",LOGIN:"Login",LOGIN_INSTRUCTIONS1:"Login using your BodySpace account. If you do not yet have a BodySpace account, click",LOGIN_INSTRUCTIONS_LINK:"New Account",LOGIN_INSTRUCTIONS2:"and we will get you all set up!",USERNAME_PLACEHOLDER:"Username / Email",PASSWORD_PLACEHOLDER:"Password",REMEMBER_ME:"Remember Me",LOG_IN:"Log In",FORGOT_LOG_IN:"Forgot Login Info?",FAIL_LOGIN_NAME_AND_PASSWORD:"Please enter your Username / Email and Password.",FAIL_LOGIN_NAME:"Please enter your Username / Email.",FAIL_LOGIN_PASSWORD:"Please enter your Password.",FAIL_LOGIN_STRIKES:"Login incorrect, you have {STRIKES} tries remaining.",BODYSPACE_ACTIVITY:"BodySpace Activity",VIEW_ALL:"View All",EDIT:"Edit",NO_PHOTO:"No Photo",MY_BODYSPACE:"My BodySpace",ORDERS:"Orders",WISH_LIST:"Wish List",CART:"Cart",LOG_OUT:"Log Out",NOTIFICATIONS:"Notifications",ACTION_ITEMS:"Action Items",REQUESTS:"Requests",MESSAGES:"Messages",BODY_WEIGHT:"Body Weight",HEIGHT:"Height",UPDATE_FIT_STATUS:"Update Fit Status",CONFIRM_CLOSE_UNSAVED_CHANGES:"You have unsaved changes. Are you sure you want to close this form?",UPDATE_BODY_WEIGHT:"Update Your Body Weight",UPDATE_BODY_FAT:"Update Your Body Fat Percentage",UPDATE_HEIGHT:"Update Your Height",UPDATE_FIT_STATUS_AND_MOTIVATION:"Update Your Fit Status & Motivation Level",BODY_FAT:"Body Fat",BF:"BF",MOTIVATION_LEVEL:"Motivation Level",FIT_STATUS:"Fit Status",NO_FIT_STATUS:"You have not entered a Fit Status.",NO_MOTIVATION_LEVEL_00:"You have not entered a",NO_MOTIVATION_LEVEL_01:"Motivation Level.",PREVIOUS_MOTIVATION_LEVEL_SET:"Previous motivation level set",INVALID_VALUE_WEIGHT:"Weight may not be less than {MIN} {UNIT} or greater than {MAX} {UNIT}",INVALID_VALUE_HEIGHT:"Height may not be less than {MIN} {UNIT} or greater than {MAX} {UNIT}",INVALID_VALUE_FAT:"Body fat must be between 4% and 75%",CHARACTERS_REMAINING:"Characters remaining",LBS:"Lbs.",KG:"kg",CHOOSE:"Choose...",UPLOAD_NEW:"Upload New",EDIT_INFO:"Edit Info",CROP_ROTATE:"Crop & Rotate",ACCOUNT_BANNED:"Your account is banned",ACCOUNT_NOT_ACTIVE:"Your account is not activated",INVALID_CHARACTERS:'{stat} can only be numbers or "."',NO_UPDATES:"No Updates"}};return{get:function(e,h,i){var g,f=BB.Data.Env.get(BB.Data.Env.keys.currentLanguage);if(d[f]){g=d[f][e]}else{g=d[a][e]}g=BB.Core.Util.format(g,h);return g},keys:d["en-us"]}}());BB.API=(function(){var a=BB.Data.Env.get(BB.Data.Env.keys.protocol)+"//api.bodybuilding.com/api-proxy/";return{call:function(c,d,b,e){d=d||{};d.needsuser=1;d.token=BB.Core.Util.cookie.get("v1guid").value;BB.Core.Iris.callAPI(a+c,(b)?b.success:undefined,(b)?b.error:undefined,{timeToExpire:new Date(new Date().getTime()+e)},d)}}}());BB.Action=BB.Action||{};BB.Action.Binder=(function(){var a=function(){var c={},g=$(this),f,b,d,e=g.data("action");if(e!==undefined&&e!==null&&typeof(e.behavior)==="string"&&e.behavior.length>0){if(e.behavior===BB.Data.Action.keys.persistentClose){if(new RegExp(e.target+"=bbcool;").test(document.cookie)){$(e.target).slideUp();return}else{$(e.target).slideDown()}}switch(e.behavior){case BB.Data.Action.keys.valueRoller:d=g.find("._value-roller-item");d.each(function(i,h){c[$(h).data("roll-order")]=$(h)});b=function(){BB.Action.Delegate[BB.Data.Action.keys.valueRoller]($(this).data("roll-order"),c)};d.each(function(){var h=$(this);if(h.data("roll-value")>0){h.unbind("blur");h.bind("blur",b)}});break;case BB.Data.Action.keys.modalUpdateAsyncDynamic:g.unbind("click");g.attr("data-update-key",e.target);if(BB.UI&&BB.UI.Modal){BB.UI.Modal.create(g)}break;case BB.Data.Action.keys.validation:break;default:g.unbind("click");g.bind("click",null,function(){var h=$(this);BB.Action.Delegate[h.data("action").behavior](h)});g.each(function(h,i){var j=$(i).data("onload");if(typeof(j)==="object"&&j!==null){BB.Action.Delegate.manual({data:function(){return j}})}})}}};return{wirePage:function(b){if(b===undefined||b===null){b=$(".bbAction")}if(b!==undefined&&b!==null&&b.length>0){b.each(a)}}}}());BB.Action.Binder.wirePage();BB.Action=BB.Action||{};BB.Action.Delegate={};BB.Action.Delegate[BB.Data.Action.keys.persistentClose]=function(a){var c=a.data("action"),b=c.target;document.cookie=b+"=bbcool";$(b).slideUp()};BB.Action.Delegate[BB.Data.Action.keys.jqueryAction]=function(c,g){var e=c.data("action"),f=e.target,b=c.data("desktop-id"),k=b.split(":"),a=f.split(":"),h,m=a.length,l,d,j;g=g||c;for(h=0;h<m;h++){l=k[h].split("(");if(l.length>1){d=l[1]}if(l[0]==="_trigger"){if(g!==undefined&&g!==null){$(g)[a[h]](d)}}else{if(/^_trigger_children_/.test(l[0])){j=l[0].replace("_trigger_children_","");$(g).find(j)[a[h]](d)}else{if(/^_trigger_parent_/.test(l[0])){j=l[0].replace("_trigger_parent_","");$(g).parent().find(j)[a[h]](d)}else{$(l[0])[a[h]](d)}}}}};BB.Action.Delegate[BB.Data.Action.keys.exclusiveToggle]=function(c){var d=c.data("action"),f="._exclusive-toggle",b=true,a=f+"-tab",e=f+"-desk";if(c.hasClass("selected")){b=false}$(a+", "+e).removeClass("selected");if(b){Cool.Helper.set_body_flag();c.parent().find(a).addClass("selected");c.parent().find(e).addClass("selected")}else{Cool.Helper.clear_body_flag();c.parent().find(a).removeClass("selected");c.parent().find(e).removeClass("selected")}};BB.Action.Delegate[BB.Data.Action.keys.link]=function(a){window.location=a.data("action").target};BB.Action.Delegate[BB.Data.Action.keys.linkNewPage]=function(a){window.open(a.data("action").target,"_blank")};BB.Action.Delegate[BB.Data.Action.keys.forcedLogin]=function(a){$("body").animate({scrollTop:0},function(){var b=$("#mobile-dashboard");if(!b.hasClass("active")){Cool.Trigger.toggle(b)}})};BB.Action.Delegate[BB.Data.Action.keys.scroll]=function(a){var b=a.data("action"),c=b.target;if(c==="/top"){$("body").animate({scrollTop:0})}else{$("body").animate({scrollTop:$("#"+c).offset().top})}};BB.Action.Delegate[BB.Data.Action.keys.valueRoller]=function(f,a){var c=a[f],i=c.data("roll-value"),h,e=c.val(),g=$(a[(parseInt(f,10)+1).toString()]),b,d;if(g!==undefined&&g!==null&&e>=i){b=g.val();if(isNaN(b)||b<1){b=0}d=parseInt(e/i,10)+parseInt(b,10);h=e%i;c.val(h.toString());g.val(d.toString());g.trigger("change")}};BB.Action.Delegate[BB.Data.Action.keys.manual]=function(a){var c=a.data("action"),d=c.target,b=$("#"+d).data("action").behavior;Cool.Trigger[b]($("#"+d))};BB.Action=BB.Action||{};BB.Action.Feed=(function(){return{prepareFeed:function(g){var d,b,a,f,c;try{if(g!==undefined&&g!==null&&typeof(g.eventType)==="string"&&g.eventType.length>0){g.amount=0;switch(g.eventType){case"FITSTATUS":break;case"BODYFAT":if(g.oldBodyFat!==undefined&&g.oldBodyFat!==null){b=BB.Core.Util.formatFloat(g.oldBodyFat-g.newBodyFat);if(b<0){b=b*-1;g.deltaVerb="a gain of "+b+"%"}else{if(b>0){g.deltaVerb="a loss of "+b+"%"}else{g.deltaVerb="no change"}}g.deltaDays=Math.abs(Math.floor((BB.Core.Util.toDate(g.newMeasurementDate)-BB.Core.Util.toDate(g.oldMeasurementDate))/86400000).toString(10));if(g.deltaDays===1){g.deltaDays=g.deltaDays+" day"}else{g.deltaDays=g.deltaDays+" days"}g.oldBodyFat=BB.Core.Util.formatFloat(g.oldBodyFat)}else{g.oldBodyFat=0;g.deltaVerb=""}g.newBodyFat=BB.Core.Util.formatFloat(g.newBodyFat);if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.linkURL=g.permalink}else{g.linkURL="http://bodyspace.bodybuilding.com/"+g.slug+"/more.php?section=progress"}break;case"PROGRESS_PHOTO":if(g.clazz==="com.bodybuilding.api.entity.feed.RollupEntity"){g.amount=g.events.length;g.plural=true;g.linkURL="http://bodyspace.bodybuilding.com/"+g.slug+"/more.php?section=progresspics"}else{g.amount="1";g.plural=false;if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.linkURL=g.permalink}else{g.linkURL="http://bodyspace.bodybuilding.com/"+g.slug+"/more.php?section=progresspics"}}break;case"PROFILE_PHOTO":break;case"WEIGHT_CHANGED":g.unit=BB.Data.User.get(BB.Data.User.keys.unitsOfWeight);if(g.oldWeight!==undefined&&g.oldWeight!==null&&g.oldWeight>0&&g.oldMeasurementDate!==undefined&&g.oldMeasurementDate!==null&&g.oldMeasurementDate>0){b=BB.Core.Util.formatFloat(g.oldWeight-g.newWeight);if(b<0){b=b*-1;if(g.unit==="kg"){d=BB.Core.Util.formatFloat(BB.Core.Util.toKg(b))+" kg"}else{d=b+((b==="1"||b==="1.0")?" Lb.":" Lbs.")}g.deltaVerb="a gain of "+d}else{if(b>0){if(g.unit==="kg"){d=BB.Core.Util.formatFloat(BB.Core.Util.toKg(b))+" kg"}else{d=b+((b==="1"||b==="1.0")?" Lb.":" Lbs.")}g.deltaVerb="a loss of "+d}else{g.deltaVerb="no change"}}g.deltaDays=Math.abs(Math.floor((BB.Core.Util.toDate(g.newMeasurementDate)-BB.Core.Util.toDate(g.oldMeasurementDate))/86400000).toString(10));if(g.deltaDays===1){g.deltaDays=g.deltaDays+" day"}else{g.deltaDays=g.deltaDays+" days"}if(g.unit==="kg"){g.oldWeight=BB.Core.Util.toKg(g.oldWeight)}g.oldWeight=BB.Core.Util.formatFloat(g.oldWeight)}else{g.oldWeight=0;g.deltaVerb=""}if(g.unit==="kg"){g.newWeight=BB.Core.Util.toKg(g.newWeight)}g.newWeight=BB.Core.Util.formatFloat(g.newWeight);if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.linkURL=g.permalink}else{g.linkURL="http://bodyspace.bodybuilding.com/"+g.slug+"/more.php?section=progress"}break;case"FRIEND":g.spellout=[];g.amount=0;if(g.clazz==="com.bodybuilding.api.entity.feed.RollupEntity"){f=g.events.length;if(f>2){g.amount=f-2;if(g.amount>1){g.plural="s"}else{g.plural=""}}for(c=0;c<f&&c<2;c++){g.spellout.push(g.events[c].friendUser);if(f>2){if(c!==1){g.events[c].friendUser.separator=", "}else{g.events[c].friendUser.separator=""}}else{if(f===2&&c!==1){g.events[c].friendUser.separator=" and "}else{g.events[c].friendUser.separator=""}}}}else{g.friendUser.separator="";g.spellout.push(g.friendUser)}break;case"INSPIREDBY":break;case"BLOG":break;case"MOTIVATION_PROGRAM":case"PROGRAM_UPDATED":switch(g.programType){case"SUPPLEMENTS":g.eventType="SUPPLEMENTS_PROGRAM";break;case"NUTRITION":g.eventType="NUTRITION_PROGRAM";break;case"WORKOUT":g.eventType="WORKOUT_PROGRAM";break}break;case"NUTRITION_PROGRAM":case"SUPPLEMENTS_PROGRAM":case"WORKOUT_PROGRAM":break;case"BODYSTAT":g.spellout=[];g.amount=0;g.plural="";g.unit=g.unit=BB.Data.User.get(BB.Data.User.keys.unitsOfLength);if(g.clazz==="com.bodybuilding.api.entity.feed.RollupEntity"){f=g.events.length;if(f>1){g.amount=f-1}if(g.amount>1){g.plural="s"}g.spellout.push(g.events[0])}else{g.spellout.push(g)}if(g.unit==="cm"){g.spellout[0].value=BB.Core.Util.toCm(g.spellout[0].value)}g.spellout[0].value=BB.Core.Util.formatFloat(g.spellout[0].value);if(g.spellout[0].oldValue&&g.spellout[0].oldValue>0&&g.spellout[0].oldMeasurementDate&&g.spellout[0].oldMeasurementDate>0){if(g.unit==="cm"){g.spellout[0].oldValue=BB.Core.Util.toCm(g.spellout[0].oldValue)}d=g.spellout[0].oldValue-g.spellout[0].value;b=BB.Core.Util.formatFloat(d);if(b<0){b=b*-1;g.spellout[0].deltaVerb=", a gain of "+b+" "+g.unit}else{if(b>0){g.spellout[0].deltaVerb=", a loss of "+b+" "+g.unit}else{g.spellout[0].deltaVerb=" no change"}}if(typeof(g.spellout[0].permalink)==="string"&&g.spellout[0].permalink.length>0){g.spellout[0].linkURL=g.spellout[0].permalink}else{g.spellout[0].linkURL="http://bodyspace.bodybuilding.com/"+g.spellout[0].slug+"/more.php?section=progress"}g.spellout[0].deltaDays=Math.abs(Math.floor((BB.Core.Util.toDate(g.spellout[0].measurementDate)-BB.Core.Util.toDate(g.spellout[0].oldMeasurementDate))/86400000)).toString(10);g.spellout[0].deltaDays=g.spellout[0].deltaDays+" day"+((g.spellout[0].deltaDays==="1")?"":"s");g.spellout[0].deltaVerb=g.spellout[0].deltaVerb+" in "+g.spellout[0].deltaDays}break;case"GROUP_JOIN":if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.groupUrl=g.permalink}break;case"FITBOARD_POST":g.plural="";g.amount=1;g.permalinkUrl="";if(g.clazz==="com.bodybuilding.api.entity.feed.RollupEntity"){f=g.events.length;g.amount=f;if(f>1){g.plural="s";g.permalinkUrl="http://bodyspace.bodybuilding.com/fitboard/board/user/"+g.slug}}if(g.permalinkUrl===""){if(typeof(g.permalink)!=="string"||g.permalink.length===0){g.permalinkUrl="http://bodyspace.bodybuilding.com/fitboard/item/id/"+g.postId}}break;case"GALLERY_PHOTO":g.plural="";g.amount=1;g.photosAddedLink="";if(g.clazz==="com.bodybuilding.api.entity.feed.RollupEntity"){f=g.events.length;g.amount=f;if(f>1){g.plural="s";g.photosAddedLink="http://bodyspace.bodybuilding.com/photos/view-user-photos/s/"+g.slug}}if(g.photosAddedLink===""){if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.photosAddedLink=g.permalink}else{g.photosAddedLink="http://bodyspace.bodybuilding.com/photos/view-user-photo/"+g.photoId}}break;case"GYM_JOIN":if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.linkURL=g.permalink}else{g.linkURL="http://bodyspace.bodybuilding.com/networks/view/gym/"+g.gymId+"/name/"+g.gymName.toLowerCase().replace(/ /g,"-")+g.gymCity.toLowerCase().replace(/ /g,"-")+g.gymState.toLowerCase().replace(/ /g,"-")+g.gymCountry.toLowerCase().replace(/ /g,"-")}break;case"GOAL_CHANGED":if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.linkURL=g.permalink}else{g.linkURL="http://bodyspace.bodybuilding.com/"+g.slug}break;case"CURRENT_SUPPLEMENT":case"REVIEWED_SUPPLEMENT":g.spellout=[];g.amount=0;if(g.clazz==="com.bodybuilding.api.entity.feed.RollupEntity"){f=g.events.length;if(f>1){g.amount=f-1}if(g.amount>1){g.plural="s"}else{g.plural=""}g.spellout.push(g.events[0]);a=g.events[0]}else{g.spellout.push(g);a=g}if(typeof(a.permalink)==="string"&&a.permalink.length>0){a.reviewUrl=a.permalink}else{if(a.productBrand&&a.productName&&a.productReviewId){a.reviewUrl="http://reviews.bodybuilding.com/"+a.productBrand.replace(/ /g,"_")+"/"+a.productName.replace(/ /g,"_")+"/"+a.slug+"/"+a.productReviewId.toString()}else{a.reviewUrl="http://reviews.bodybuilding.com"}}break;case"BODYGROUP":if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.groupUrl=g.permalink}break;case"PERSONAL_VIDEO":if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.videoUrlBodySpace=g.permalink}else{g.videoUrlBodySpace=g.profileUrl+"/more.php?section=videos&type=you&i="+g.videoId+"#"+g.videoId}break;case"MOTIVATION_LEVEL":if(typeof(g.permalink)==="string"&&g.permalink.length>0){g.linkURL=g.permalink}else{g.linkURL="http://bodyspace.bodybuilding.com/"+g.slug+"/motivationlevel.php"}break;default:}}else{return false}}catch(e){BB.Tool.Debug.log("Error Processing Feeds: "+e.message);return false}return true}}}());BB.Action.Like=(function(){var b="liking/",e="set",a="delete",d="getstats",c=function(g,h,f){BB.API.call(b+g,h,f,0)};return{call:function(h,i,f,g,k,j){var l={userid:i,ownerid:f,entityid:g,type:k,stats:true};c(((h)?e:a),l,j)},getStats:function(f,j,i,h,g){var k=$.extend(g||{},{ownerid:f,entityids:$.isArray(j)?j.join(","):j,type:i});c(d,k,h)}}}());BB.Action.Helpful=(function(){var b="helpful/",e="set",a="delete",d="getstats",c=function(g,h,f){BB.API.call(b+g,h,f)};return{call:function(j,f,g,i,h){var k={ownerid:f,entityid:g,type:i};c(((j)?e:a),k,h)},getStats:function(f,i,h,g){c(d,{ownerid:f,entityids:$.isArray(i)?i.join(","):i,type:h},g)}}}());BB.Action=BB.Action||{};BB.Action.Modal=(function(){var a=function(){var f=$(this),e,d,b=f.attr("data-update-key"),c;if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){if(BB.Data.User.get(BB.Data.User.keys.isBanned)){alert(BB.Loc.get("ACCOUNT_BANNED"))}else{alert(BB.Loc.get("ACCOUNT_NOT_ACTIVE"))}}else{if(BB.Data.User.get(BB.Data.User.keys.isBanned)){e=$(".interactive-sidebar.user-tooltip-banned");d=$(".standard-tooltip-arrow.interactive-sidebar.user-tooltip-banned");c=$(".standard-tooltip.interactive-sidebar.user-tooltip-banned")}else{e=$(".interactive-sidebar.user-tooltip-inactive");d=$(".standard-tooltip-arrow.interactive-sidebar.user-tooltip-inactive");c=$(".standard-tooltip.interactive-sidebar.user-tooltip-inactive")}if(typeof(e)==="object"&&e!==null&&e.length>0){if(b==="fitStatus"){e.addClass("standard-tooltip-top");d.css({top:f.position().top+f.height()+7,left:1});c.css({top:f.position().top-f.height()-c.height()-5,left:1})}else{e.removeClass("standard-tooltip-top");e.css({top:f.position().top+f.height()+7,left:1})}d.css({"margin-left":f.position().left+(f.width()/2)});e.removeClass("hide")}}};return{bind:function(b){if(BB.Data.User.get(BB.Data.User.keys.isActive)){b.bind("click",BB.UI.Modal.createCallback({key:b.attr("data-update-key"),defaultValue:b.data("current-value-seed")}))}else{b.bind("click",a)}}}}());BB.UI=BB.UI||{};BB.UI.TemplateCatalog=(function(){var a={},b=function(c){return(typeof(a[c]==="string"&&a[c].length>0))};return{set:function(c,d){a[c]=d},load:function(c,d){if(b(c)){dust.loadSource(dust.compile(a[c],c,d))}else{BB.Tool.Debug.log("template wasn't found:"+c)}},render:function(c,d,e){if(b(c)){dust.render(c,d,e)}else{BB.Tool.Debug.log("template wasn't found:"+c)}},keys:{}}}());(function(){var c="Modal_statUpdate",b="Modal_fitStatusInput",e="Modal_heightInput",a="Modal_login",d="Modal_userList";BB.UI.TemplateCatalog.keys.Modal_statUpdate=c;BB.UI.TemplateCatalog.keys.Modal_fitStatusInput=b;BB.UI.TemplateCatalog.keys.Modal_heightInput=e;BB.UI.TemplateCatalog.keys.Modal_login=a;BB.UI.TemplateCatalog.keys.Modal_userList=d;BB.UI.TemplateCatalog.set(c,'<div class="interactive-sidebar-update-stats-modal-popup" style="position: {@if cond="{quirks_mode}"}absolute{:else}fixed{/if};"><div class="interactive-sidebar-update-stats-modal"><div class="interactive-sidebar-modal-close">{lang.CLOSE}</div><div class="bodyspace-modal-content"><span class="bodyspace-modal-header">{message}:</span><div class="bodyspace-modal-input"><div class="input"><label for="data-input">{statName}:</label><input type="text" id="data-input" class="input-weight large" value="{defaultValue}" name="weightTextFieldContainer"><em>{unitOfWeight}</em><div class="standard-tooltip interactive-sidebar tooltip-validation-error-elements-quirks hide"><div class="text"></div></div><div class="standard-tooltip interactive-sidebar tooltip-validation-error-elements hide"><div class="text"></div></div><div class="standard-tooltip-arrow interactive-sidebar tooltip-validation-error-elements hide"></div></div><div class="bodyspace-modal-footer"><div class="cancel-link">{lang.CANCEL}</div><div class="button"><span id="submitStat" class="bb-button-v2 button-gradient-blue main-goal-save"><span>{lang.SAVE}</span></span></div></div></div></div></div><div class="standard-tooltip interactive-sidebar tooltip-close-confirm-elements hide"><div class="text">{lang.CONFIRM_CLOSE_UNSAVED_CHANGES}</div><div class="standard-tooltip-button confirm">{lang.YES}</div><div class="standard-tooltip-button">{lang.NO}</div></div><div class="standard-tooltip-arrow interactive-sidebar tooltip-close-confirm-elements hide"></div></div>');BB.UI.TemplateCatalog.set(b,'<div class="container"><div class="right"><div class="motivation header">{lang.MOTIVATION_LEVEL}</div><div class="motivation-graph"><ul><li><div class="motiv-item motivation-10"></div><div class="motiv-number">10</div></li><li><div class="motiv-item motivation-9"></div><div class="motiv-number">9</div></li><li><div class="motiv-item motivation-8"></div><div class="motiv-number">8</div></li><li><div class="motiv-item motivation-7"></div><div class="motiv-number">7</div></li><li><div class="motiv-item motivation-6"></div><div class="motiv-number">6</div></li><li><div class="motiv-item motivation-5"></div><div class="motiv-number">5</div></li><li><div class="motiv-item motivation-4"></div><div class="motiv-number">4</div></li><li><div class="motiv-item motivation-3"></div><div class="motiv-number">3</div></li><li><div class="motiv-item motivation-2"></div><div class="motiv-number">2</div></li><li><div class="motiv-item motivation-1"></div><div class="motiv-number">1</div></li></ul><div class="clearFloatNoHeight"></div></div><div class="motivation-legend">{lastMotivationUpdate}<br/>{lastMotivationUpdateTimeStamp}</div></div><div class="left"><div class="fit-status header">{lang.FIT_STATUS}</div><span class="wmwrap fit-status-input-container" style="position:relative;display:block;"><label class="watermark">{lang.NO_FIT_STATUS}</label><textarea maxlength="140" id="data-input" class="fit-status"></textarea></span><div class="fit-status-counter counter"><span>140</span> {lang.CHARACTERS_REMAINING}</div></div></div>');BB.UI.TemplateCatalog.set(e,'<div class="cool-action" data-action="{action}"><label for="data-input">{statName}:</label><input type="text" id="data-input" class="input-height large _value-roller-item" data-roll-order="2" value="{defaultValue1}" name="heightTextFieldContainer1"><em>{unitOfHeight1}</em><input type="text" id="data-input-2" class="input-height large _value-roller-item" data-roll-order="1" data-roll-value="{rollValue}" value="{defaultValue2}" name="heightTextFieldContainer2"><em>{unitOfHeight2}</em></div><div class="standard-tooltip interactive-sidebar tooltip-validation-error-elements-quirks hide"><div class="text"></div></div><div class="standard-tooltip interactive-sidebar tooltip-validation-error-elements hide"><div class="text"></div></div><div class="standard-tooltip-arrow interactive-sidebar tooltip-validation-error-elements hide"></div>');BB.UI.TemplateCatalog.set(a,'<div class="interactive-sidebar-update-stats-modal-popup" style="position: {@if cond="{quirks_mode}"}absolute{:else}fixed{/if};"><div class="interactive-sidebar-update-stats-modal"><div class="interactive-sidebar-modal-close">{lang.CLOSE}</div><div class="bodyspace-modal-content"><span class="bodyspace-modal-header">{lang.LOG_IN}</span><div class="bodyspace-modal-input"><div class="input"><form action="http://bodyspace.bodybuilding.com/login/login.php" method="post"><input name="callback" value="{callback}" type="hidden"><a href="http://bodyspace.bodybuilding.com/community/signup?callback={callback}" class="bb-button-v2 small button-gradient-blue"><span>{lang.SIGN_UP}</span></a><div class="login-inputs"><span class="wmwrap" style="position:relative;display:block;"><label class="watermark">Username / Email</label><input type="text" id="data-input" class="large" name="username"></span><span class="wmwrap" style="position:relative;display:block;"><label class="watermark">Password</label><input id="data-input-2" class="large" type="password" name="password"></span></div><div class="login-items"><div class="checkbox"><div class="input-checkbox-container"><input type="checkbox" name="rememberme"></div><div class="text-item bb-gray7"><label for="rememberme" class="remember-me">Remember Me</label></div></div><div class="right-item"><a href="#" class="bb-button-v2 small button-gradient-blue login-button"><span>Log In</span></a><div class="standard-tooltip interactive-sidebar tooltip-elements hide"><div class="text"></div><div class="standard-tooltip-button">OK</div></div><div class="standard-tooltip-arrow interactive-sidebar tooltip-elements hide"></div></div></div><input name="do" value="login" type="hidden"><input name="password_md5" type="hidden"></form> </div></div></div></div></div>');BB.UI.TemplateCatalog.set(d,'<div class="interactive-sidebar-update-stats-modal-popup" style="position: {@if cond="{quirks_mode}"}absolute{:else}fixed{/if};"><div class="interactive-sidebar-update-stats-modal"><div class="interactive-sidebar-modal-close">{lang.CLOSE}</div><div class="bodyspace-modal-content"><span class="bodyspace-modal-header">User list</span><div class="bodyspace-modal-input"><div class="input"><label for="data-input">User name / email:</label><input type="text" id="data-input" class="input-weight large" name="userName"><label for="data-input">Password:</label><input type="text" id="data-input" class="input-weight large" name="userName"></div><div class="bodyspace-modal-footer"><div class="cancel-link">{lang.CANCEL}</div><div class="button"><span id="submitStat" class="bb-button-v2 button-gradient-blue main-goal-save"><span>Ok</span></span></div></div></div></div></div><div class="standard-tooltip interactive-sidebar tooltip-close-confirm-elements hide"><div class="text">{lang.CONFIRM_CLOSE_UNSAVED_CHANGES}</div><div class="standard-tooltip-button confirm">{lang.YES}</div><div class="standard-tooltip-button">{lang.NO}</div></div><div class="standard-tooltip-arrow interactive-sidebar tooltip-close-confirm-elements hide"></div></div>')}());var Cool=Cool||null;BB.UI=BB.UI||{};BB.UI.Modal=(function(d){var c,b,g={login:"login"},e=function(l,j,k){j.each(function(){var n=d(this),m="";n.removeClass("in-progress");if(n.attr("data-units-requied")==="true"&&l&&(l.unitOfWeight||l.unitOfHeight1)){if(l.map_json_attr==="height"){if(BB.Data.User.get(BB.Data.User.keys.isMetric)){m=" "}n.html(c+l.unitOfHeight1b+m+b+l.unitOfHeight2b)}else{n.html(k+l.unitOfWeight)}}else{n.html(k)}})},f=false,h={weight:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_statUpdate,message:function(){return BB.Loc.get("UPDATE_BODY_WEIGHT")},statName:function(){return BB.Loc.get("BODY_WEIGHT")},unitOfWeight:"Lbs.",urlSuffixSet:"stats/set",urlSuffixGet:"stats/get",type:"number",map_json_attr:BB.Data.User.keys.weight,getDefaultValue:function(){return(BB.Data.User.get(BB.Data.User.keys.weight)||0)},self_refresh:true,default_save:true,validate:function(p,l){var n,m,j,k,o;if(l===undefined){l=p.val()}n=parseFloat(l);if(BB.Data.User.get(BB.Data.User.keys.isMetric)){m=22.6;j=453.5;k=BB.Loc.get("KG")}else{m=50;j=999.9;k=BB.Loc.get("LBS")}if(n>=m&&n<=j){return true}else{if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){alert(BB.Loc.get("INVALID_VALUE_WEIGHT",{MIN:m.toFixed(1),MAX:j.toFixed(1),UNIT:k}))}else{o=d(".tooltip-validation-error-elements");o.find(".text").html(BB.Loc.get("INVALID_VALUE_WEIGHT",{MIN:m.toFixed(1),MAX:j.toFixed(1),UNIT:k}));o.removeClass("hide")}return false}}},bodyfat:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_statUpdate,message:function(){return BB.Loc.get("UPDATE_BODY_FAT")},statName:function(){return BB.Loc.get("BODY_FAT")},unitOfWeight:"%",urlSuffixSet:"stats/set",urlSuffixGet:"stats/get",type:"number",map_json_attr:BB.Data.User.keys.bodyfat,getDefaultValue:function(){return(BB.Data.User.get(BB.Data.User.keys.bodyfat)||0)},self_refresh:true,default_save:true,validate:function(o,k){var m,l=4,j=75,n;if(k===undefined){k=o.val()}m=parseFloat(k);if(m>=l&&m<=j){return true}else{if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){alert(BB.Loc.get("INVALID_VALUE_FAT"))}else{n=d(".tooltip-validation-error-elements");n.find(".text").html(BB.Loc.get("INVALID_VALUE_FAT"));n.removeClass("hide")}return false}}},height:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_statUpdate,message:function(){return BB.Loc.get("UPDATE_HEIGHT")},statName:function(){return BB.Loc.get("HEIGHT")},customCreate:BB.UI.TemplateCatalog.keys.Modal_heightInput,customCreatePreProc:function(){if(BB.Data.User.get(BB.Data.User.keys.isMetric)){this.unitOfHeight1="m";this.unitOfHeight2="cm";this.unitOfHeight1b="m";this.unitOfHeight2b="cm";this.rollValue="100"}else{this.unitOfHeight1="feet";this.unitOfHeight2="inches";this.unitOfHeight1b="'";this.unitOfHeight2b='"';this.rollValue="12"}this.action='{"behavior": "value-roller", "target": ""}'},unitOfWeight:"",urlSuffixSet:"stats/set",urlSuffixGet:"stats/get",type:"number",map_json_attr:BB.Data.User.keys.height,getDefaultValue:function(){return(BB.Data.User.get(BB.Data.User.keys.height)||0)},self_refresh:true,default_save:true,validate:function(q,n,m){var o,l,j,k,p;if(BB.Data.User.get(BB.Data.User.keys.isMetric)){l=100;j=305;k="cm";o=parseFloat(n)*100+parseFloat(m)}else{l=36;j=120;k="inch.";o=parseFloat(n)*12+parseFloat(m)}if(o>=l&&o<=j){return true}else{if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){alert(BB.Loc.get("INVALID_VALUE_HEIGHT",{MIN:l.toFixed(1),MAX:j.toFixed(1),UNIT:k}))}else{p=d(".tooltip-validation-error-elements");p.find(".text").html(BB.Loc.get("INVALID_VALUE_HEIGHT",{MIN:l.toFixed(1),MAX:j.toFixed(1),UNIT:k}));p.removeClass("hide")}return false}}},fitStatus:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_statUpdate,message:BB.Loc.get("UPDATE_FIT_STATUS_AND_MOTIVATION"),customCreate:BB.UI.TemplateCatalog.keys.Modal_fitStatusInput,customCreatePreProc:function(){if(BB.Data.User.get(BB.Data.User.keys.isMotivationLevelSet)){this.lastMotivationUpdate=BB.Loc.get("LAST_UPDATE_MOTIVATION_LEVEL",{motivation_level:(BB.Data.User.get(BB.Data.User.keys.motivationLevel).value+"/10")});this.lastMotivationUpdateTimeStamp=BB.Core.Util.formatDate(BB.Core.Util.toDate(BB.Data.User.get(BB.Data.User.keys.motivationLevel).timeStamp))}else{this.lastMotivationUpdate="";this.lastMotivationUpdateTimeStamp=""}},map_json_attr:BB.Data.User.keys.fitStatus,getDefaultValue:function(){return""},urlSuffixSet:"fitstatus/set",urlSuffixGet:"fitstatus/get",type:"alpha",max:140,self_refresh:false,default_save:false,validate:function(){return true}},motivation:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_statUpdate,urlSuffixSet:"motivation/set",urlSuffixGet:"motivation/get",map_json_attr:BB.Data.User.keys.motivationLevel,getDefaultValue:function(){return 0},self_refresh:false},login:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_login,message:"Login",getDefaultValue:function(){return""},customCreatePreProc:function(){}},userList:{modalWrapper:BB.UI.TemplateCatalog.keys.Modal_userList,message:"Login",getDefaultValue:function(){return""},customCreatePreProc:function(){}}},i=function(l,k,j){BB.API.call(k.urlSuffixSet,l,{success:function(){if(k.map_json_attr===BB.Data.User.keys.fitStatus){BB.Data.User.set(BB.Data.User.keys.fitStatus,{value:l.content,timeStamp:new Date()})}else{if(k.map_json_attr===BB.Data.User.keys.motivationLevel){BB.Data.User.set(BB.Data.User.keys.motivationLevel,{value:l.level,timeStamp:new Date()})}else{BB.Data.User.set(k.map_json_attr,l.value)}}if(k.self_refresh){e(k,j,BB.Core.Util.formatFloat(l.value))}},error:function(m){if(k.self_refresh){e(k,j,BB.Core.Util.formatFloat(BB.Data.User.get(k.map_json_attr),"--"))}}})},a=function(l){var o=d("body"),p=d(window),j,n,k=l.key,m=l.defaultValue;return function(F){if(d(".interactive-sidebar-update-stats-modal-popup").length>0){return}var L,E=d(this),B=h[k],t=p.scrollTop(),r,K=550,H=250,J,A,I,D,x=function(){var P=J.val(),M=A.val(),N,O=d(".__dynamic-async-update__"+k+"__"),Q={};if(B.validate(J,P,M)){L("void");if(k==="height"){if(BB.Data.User.get(BB.Data.User.keys.isMetric)){Q.unit="metric";N=parseFloat(P)*100+parseFloat(M)}else{Q.unit="imperial";N=parseFloat(P)*12+(parseFloat(M))}c=P;b=M}else{N=P.replace(/^[0]+/,"")}if(O&&O.length>0){O.html("");O.addClass("in-progress");Q.stat=k;Q.value=N;Q.unit=BB.Data.User.get(BB.Data.User.keys.units);i(Q,B,O)}else{if(typeof(P)==="string"&&P.length>0){Q.content=P;i(Q,B,O)}}if(k==="fitStatus"){P=d(".interactive-sidebar-update-stats-modal-popup .motivation-graph").attr("data-set");if(P!==undefined&&P>0){Q={level:parseInt(P,10)};i(Q,h.motivation)}}}else{J.focus().select()}},G,v,s=function(M,S){var O=p.width(),N=p.height(),Q,R,P=d(".interactive-sidebar-update-stats-modal-popup");G.height(N+50);G.width(O);Q=O/2-(K/2);R=N/2-(H/2);if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){R=d("body").scrollTop()+R;P.css({left:Q,top:R,width:K,height:H});P.fadeIn(S)}else{if(M){P.animate({left:Q,top:R},S)}else{P.animate({width:K,height:H,left:Q,top:R},S)}}},z=true,w=function(){if(z){setTimeout(function(){s(true);z=true},300);z=false}},C=function(O,N){var R=d(".tooltip-close-confirm-elements"),Q=20,S=-130,P,M;if(J!==undefined&&J.length>0){P=J.val();M=A.val();if((P.length>0&&B.defaultValue!==undefined&&B.defaultValue!==null&&B.defaultValue.toString()!==P)||(k==="fitStatus"&&d(".motivation-graph").attr("data-set")!==undefined)||(k==="height"&&B.defaultValue1&&B.defaultValue1.toString()!==P)||(k==="height"&&B.defaultValue2&&B.defaultValue2.toString()!==M)){if(typeof(O)==="string"||N===undefined){N=d(".interactive-sidebar-update-stats-modal .interactive-sidebar-modal-close")}else{if(N.hasClass("cancel-link")){Q=25;S=-130}}if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){return !confirm(BB.Loc.get("CONFIRM_CLOSE_UNSAVED_CHANGES"))}else{R.css({top:N.position().top+Q,left:N.position().left+S});R.removeClass("hide");f=true;return true}}else{return false}}else{return false}},y=function(M){if(M.which===27){M.preventDefault();L("esc");f=false}},q=function(){if(J){J.blur()}},u=function(){var M,N=d(".tooltip-close-confirm-elements, .user-tooltip-banned, .user-tooltip-inactive");if(f){f=false}else{if(N&&N.length>0){N.addClass("hide");M=d(".interactive-sidebar-update-stats-modal-popup .input #data-input");if(M!==undefined&&M!==null&&M.length>0){M.focus().select()}}}};if(F){F.stopPropagation()}L=function(N){var M=d(".tooltip-close-confirm-elements");if((N!=="void")&&(!(!(M&&M.length>0)||M.hasClass("hide"))||C(N,d(this)))){return}p.unbind("resize",w);o.unbind("keydown",y);o.unbind("click",u);o.unbind("click",q);if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){r.fadeOut(function(){r.remove();r=undefined;G.remove();G=undefined})}else{t=p.scrollTop();d(".interactive-sidebar-update-stats-modal-popup").animate({width:1,height:1,left:E.offset().left+(E.width()/2),top:E.offset().top-t+(E.height()/2)},function(){r.remove();r=undefined;G.remove();G=undefined})}};if(typeof(m)==="object"&&m!==null){for(v in m){if(m.hasOwnProperty(v)){B[v]=m[v]}}}else{B.defaultValue=B.getDefaultValue()}B.quirks_mode=BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode);B.lang=BB.Loc.keys;BB.UI.TemplateCatalog.render(B.modalWrapper,B,function(Q,R){var O,N,M,U,T,S=function(){N.removeClass("button-gradient-grey").removeClass("inactive").addClass("button-gradient-blue").bind("click",x)},P=function(){N.addClass("button-gradient-grey").addClass("inactive").removeClass("button-gradient-blue").unbind("click",x)},V=function(X){var W=false,Y;X.each(function(){var Z=d(this).val(),ab=Z.replace(/[^0-9\.]/g,""),aa=Z.replace(/[^\.]/g,"");if(ab.length<Z.length||aa.length>1){W=true}});if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){Y=d(".tooltip-validation-error-elements-quirks")}else{Y=d(".tooltip-validation-error-elements")}if(W){P();Y.find(".text").html(BB.Loc.get("INVALID_CHARACTERS",{stat:B.statName}));Y.removeClass("hide")}else{Y.addClass("hide");if(N.hasClass("inactive")){S()}}};r=d(R);if(typeof(B.customCreate)==="string"&&B.customCreate.length>0){O=r.find(".input");O.html("");B.customCreatePreProc();BB.UI.TemplateCatalog.render(B.customCreate,B,function(Z,X){var ab=d(X),W=10,Y=ab.find("li"),aa=ab.find(".motivation-graph");switch(k){case"fitStatus":r.addClass("fit-status");H=320;ab.appendTo(O);aa.bind("hover",null,function(){Y.removeClass("selected-candidate")});Y.each(function(ad,ac){d(ac).bind("hover",function(){var ae=d(this).find(".motiv-item").attr("class").replace("motiv-item motivation-",""),af=10;Y.each(function(ah,ag){if(af<=ae){d(ag).addClass("selected-candidate")}else{d(ag).removeClass("selected-candidate")}af--})});d(ac).bind("click",function(){var ae=d(this).find(".motiv-item").attr("class").replace("motiv-item motivation-",""),af=10;aa.attr("data-set",ae);if(N.hasClass("inactive")){S()}Y.each(function(ah,ag){if(af<=ae){d(ag).addClass("selected")}else{d(ag).removeClass("selected")}af--})});W--});break;case"height":ab.appendTo(O);break;default:ab.appendTo(O)}})}if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){r.addClass("hide")}else{r.width(1);r.height(1);r.offset({left:E.offset().left+(E.width()/2),top:E.offset().top-t+(E.height()/2)})}G=d("<div/>",{id:"bodyspace-update-stats-modal-mask",style:"height:"+o.height()+"px;width:"+o.width()+"px;"}).appendTo(o);r.appendTo(o);j=d(".interactive-sidebar-update-stats-modal-popup .bodyspace-modal-content .bodyspace-modal-input .input .cool-action");if(Cool!==undefined&&Cool!==null&&Cool.Helper&&j&&j.length>0){Cool.Helper.action_binder(j)}J=d(".interactive-sidebar-update-stats-modal-popup .input #data-input");A=d(".interactive-sidebar-update-stats-modal-popup .input #data-input-2");N=d(".bodyspace-modal-footer .button span#submitStat");d(".interactive-sidebar.tooltip-close-confirm-elements .standard-tooltip-button.confirm").bind("click",function(){L("void")});if(J!==undefined&&J.length>0){if(B.type==="number"){J.focus().select();if(A!==undefined&&A.length>0){n=d(".interactive-sidebar-update-stats-modal-popup .input input")}else{n=J}n.bind("paste",function(W){W.preventDefault()});n.bind("keyup",function(W){switch(W.which){case 13:if(!N.hasClass("inactive")){x()}break;case 27:W.preventDefault();break;default:V(n);break}});n.change(function(W){V(n)});s()}else{if(B.type==="alpha"){if(B.max!==undefined&&B.max>0){M=d(".interactive-sidebar-update-stats-modal-popup .input .counter span");U=function(Y){var X,Z=J.val(),W=Z.length;if(W>B.max){W=B.max;X=Z.substring(0,W);J.val(X)}M.html((B.max-W).toString(10));if(W>0){if(N.hasClass("inactive")){S()}}else{if(d(".motivation-graph").attr("data-set")===undefined){P()}}};T=J.parent().find("label");if(BB.Data.User.get(BB.Data.User.keys.isFitStatusSet)){T.text(BB.Data.User.get(BB.Data.User.keys.fitStatus).value);T.html(T.html()+"<br/>"+BB.Loc.get("LAST_UPDATE")+": "+BB.Core.Util.formatDate(BB.Core.Util.toDate(BB.Data.User.get(BB.Data.User.keys.fitStatus).timeStamp)))}J.bind("paste",function(){S()});J.bind("paste",U);J.bind("keyup",U);J.bind("blur",function(){if(J.val().length===0){T.show()}else{T.hide()}});J.bind("focus",function(){T.hide()});T.bind("click",function(W){T.hide();J.focus();W.stopPropagation()})}}s(false,function(){J.blur()})}}if(B.default_save&&J!==undefined&&J.length>0&&parseInt(J.val(),10)>0){d("#submitStat").bind("click",x)}else{P()}d(".interactive-sidebar-modal-close, .cancel-link").bind("click",L);p.bind("resize",w);o.bind("keydown",y);o.bind("click",u);o.bind("click",q);if(J&&J.length>0){J.bind("click",function(W){W.stopPropagation()})}if(A&&A.length>0){A.bind("click",function(W){W.stopPropagation()})}})}};BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Modal_statUpdate);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Modal_fitStatusInput);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Modal_heightInput);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Modal_login);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Modal_userList);return{createCallback:function(j){return a(j)},trigger:function(k,j){a(k).call(j)},keys:g}}(jQuery));(function(f){var w="Feeds_container",b="Feeds_BLOG",d="Feeds_BODYFAT",h="Feeds_BODYGROUP",q="Feeds_BODYSTAT",n="Feeds_CURRENT_SUPPLEMENT",u="Feeds_FITBOARD_POST",e="Feeds_FITSTATUS",i="Feeds_FRIEND",C="Feeds_FRIEND_SPELLOUT",g="Feeds_GALLERY_PHOTO",k="Feeds_GOAL_CHANGED",x="Feeds_GROUP_JOIN",o="Feeds_GYM_JOIN",c="Feeds_INSPIREDBY",t="Feeds_MEASURE_UPDATE",E="Feeds_MOTIVATION_LEVEL",s="Feeds_MOTIVATION_PROGRAM",y="Feeds_NUTRITION_PROGRAM",l="Feeds_PERSONAL_VIDEO",p="Feeds_PROFILE_PHOTO",B="Feeds_PROGRAM_UPDATED",A="Feeds_PROGRESS_PHOTO",m="Feeds_REVIEWED_SUPPLEMENT",D="Feeds_SUPPLEMENT",z="Feeds_SUPPLEMENTS_PROGRAM",v="Feeds_SUPPLEMENT_R",r="Feeds_WEIGHT_CHANGED",a="Feeds_WORKOUT_PROGRAM",j="Feeds_basicFeed";BB.UI.TemplateCatalog.keys.Feeds_container=w;BB.UI.TemplateCatalog.keys.Feeds_BLOG=b;BB.UI.TemplateCatalog.keys.Feeds_BODYFAT=d;BB.UI.TemplateCatalog.keys.Feeds_BODYGROUP=h;BB.UI.TemplateCatalog.keys.Feeds_BODYSTAT=q;BB.UI.TemplateCatalog.keys.Feeds_CURRENT_SUPPLEMENT=n;BB.UI.TemplateCatalog.keys.Feeds_FITBOARD_POST=u;BB.UI.TemplateCatalog.keys.Feeds_FITSTATUS=e;BB.UI.TemplateCatalog.keys.Feeds_FRIEND=i;BB.UI.TemplateCatalog.keys.Feeds_FRIEND_SPELLOUT=C;BB.UI.TemplateCatalog.keys.Feeds_GALLERY_PHOTO=g;BB.UI.TemplateCatalog.keys.Feeds_GOAL_CHANGED=k;BB.UI.TemplateCatalog.keys.Feeds_GROUP_JOIN=x;BB.UI.TemplateCatalog.keys.Feeds_GYM_JOIN=o;BB.UI.TemplateCatalog.keys.Feeds_INSPIREDBY=c;BB.UI.TemplateCatalog.keys.Feeds_MEASURE_UPDATE=t;BB.UI.TemplateCatalog.keys.Feeds_MOTIVATION_LEVEL=E;BB.UI.TemplateCatalog.keys.Feeds_MOTIVATION_PROGRAM=s;BB.UI.TemplateCatalog.keys.Feeds_NUTRITION_PROGRAM=y;BB.UI.TemplateCatalog.keys.Feeds_PERSONAL_VIDEO=l;BB.UI.TemplateCatalog.keys.Feeds_PROFILE_PHOTO=p;BB.UI.TemplateCatalog.keys.Feeds_PROGRAM_UPDATED=B;BB.UI.TemplateCatalog.keys.Feeds_PROGRESS_PHOTO=A;BB.UI.TemplateCatalog.keys.Feeds_REVIEWED_SUPPLEMENT=m;BB.UI.TemplateCatalog.keys.Feeds_SUPPLEMENT=D;BB.UI.TemplateCatalog.keys.Feeds_SUPPLEMENTS_PROGRAM=z;BB.UI.TemplateCatalog.keys.Feeds_SUPPLEMENT_R=v;BB.UI.TemplateCatalog.keys.Feeds_WEIGHT_CHANGED=r;BB.UI.TemplateCatalog.keys.Feeds_WORKOUT_PROGRAM=a;BB.UI.TemplateCatalog.keys.Feeds_basicFeed=j;BB.UI.TemplateCatalog.set(w,'<div class="user-activity"><h5>{lang.BODYSPACE_ACTIVITY}</h5><div id="rs-feed-list">{@if cond="{feedEntityList.length} > 0"}{#feedEntityList}{>Feeds_basicFeed /}{/feedEntityList}{:else}<div class="no-updates"><div class="no-updates-inner">{lang.NO_UPDATES}</div></div>{/if}</div></div>');BB.UI.TemplateCatalog.set(j,'<div class="rs-feed"><div class="rs-feed-image"><a href="http://bodyspace.bodybuilding.com/{slug}"><img src="{profilePicUrl}" /></a></div><div class="rs-feed-text"><a href="http://bodyspace.bodybuilding.com/{slug}">{userName}</a> {>"Feeds_{eventType}" /}</div></div>');BB.UI.TemplateCatalog.set(E,'updated {gender} motivation level from {oldLevel}/10 to <a href="{linkURL}">{newLevel}/10</a>.');BB.UI.TemplateCatalog.set(e,"{newStatus}");BB.UI.TemplateCatalog.set(d,'updated {gender} body fat {@if cond="{oldBodyFat} > 0"}from {oldBodyFat}% {/if}to <a href="{linkURL}">{newBodyFat}%</a>{@if cond="{oldBodyFat} > 0"}, {deltaVerb} in {deltaDays}{/if}.');BB.UI.TemplateCatalog.set(r,'updated {gender} weight {@if cond="{oldWeight} > 0"}from {oldWeight} {unit} {/if}to <a href="{linkURL}">{newWeight} {unit}</a>{@if cond="{oldWeight} > 0"}, {deltaVerb} in {deltaDays}{/if}.');BB.UI.TemplateCatalog.set(A,'added {@if cond="{plural}"}<a href="{linkURL}">{amount} new photos</a> to {gender} <a href="{linkURL}">progress photos</a>{:else}a new <a href="{linkURL}">progress photo</a>{/if}.');BB.UI.TemplateCatalog.set(p,'added a new <a href="http://bodyspace.bodybuilding.com/{slug}">profile photo</a>.');BB.UI.TemplateCatalog.set(i,'is now friends with {#spellout}{>Feeds_FRIEND_SPELLOUT /}{/spellout}{@if cond="{amount} > 0"} and <a href="http://bodyspace.bodybuilding.com/friends/{slug}">{amount} other{plural}</a>{/if}.');BB.UI.TemplateCatalog.set(C,'<a href="http://bodyspace.bodybuilding.com/{slug}">{userName}</a>{separator}');BB.UI.TemplateCatalog.set(b,'created a new blog entry "<a href="{postUrl}">{postTitle}</a>"');BB.UI.TemplateCatalog.set(s,'updated {gender} <a href="http://bodyspace.bodybuilding.com/programs/my-motivation/{slug}">motivation program</a>.');BB.UI.TemplateCatalog.set(y,'updated {gender} <a href="http://bodyspace.bodybuilding.com/programs/my-nutrition/{slug}">nutrition program</a>.');BB.UI.TemplateCatalog.set(z,'updated {gender} <a href="http://bodyspace.bodybuilding.com/programs/my-supplements/{slug}">supplements program</a>.');BB.UI.TemplateCatalog.set(a,'updated {gender} <a href="http://bodyspace.bodybuilding.com/programs/my-workout/{slug}">workout program</a>.');BB.UI.TemplateCatalog.set(B,'updated {gender} <a href="http://bodyspace.bodybuilding.com/programs/my-motivation/{slug}">program</a>.');BB.UI.TemplateCatalog.set(q,'measured {gender} {#spellout}{>Feeds_MEASURE_UPDATE /}{/spellout}{@if cond="{amount} > 0"} and measured <a href="http://bodyspace.bodybuilding.com/{slug}/more.php?section=progress">{amount} other body part{plural}</a>{/if}.');BB.UI.TemplateCatalog.set(t,'<span class="body-part">{statType}</span> at <a href="{linkURL}">{value} {unit}</a>{deltaVerb}');BB.UI.TemplateCatalog.set(x,'joined the <a href="{groupUrl}">{groupName}</a> BodyGroup.');BB.UI.TemplateCatalog.set(g,'added <a href="{photosAddedLink}">{amount} new photo{plural}</a> to {gender} <a href="http://bodyspace.bodybuilding.com/photos/view-user-photos/s/{slug}">photo gallery</a>.');BB.UI.TemplateCatalog.set(u,'added <a href="{permalinkUrl}">{amount} new post{plural}</a> to {gender} <a href="http://bodyspace.bodybuilding.com/fitboard/board/user/{slug}">FitBoard</a>.');BB.UI.TemplateCatalog.set(o,'joined the <a href="{linkURL}">{gymName}</a>.');BB.UI.TemplateCatalog.set(k,'updated {gender} <a href="{linkURL}">overall goal</a>.');BB.UI.TemplateCatalog.set(n,'is taking {#spellout}{>Feeds_SUPPLEMENT /}{/spellout}{@if cond="{amount} > 0"} and <a href="http://bodyspace.bodybuilding.com/{slug}/more.php?section=currentsupplements">{amount} other product{plural}</a>{/if} as part of {gender} current supplements.');BB.UI.TemplateCatalog.set(D,' <a href="{productUrl}">{productName}</a>');BB.UI.TemplateCatalog.set(m,'rated{#spellout}{>Feeds_SUPPLEMENT_R /}{/spellout}{@if cond="{amount} > 0"} and <a href="http://bodyspace.bodybuilding.com/{slug}/more.php?section=supplement_review">{amount} other product{plural}</a>{/if}.');BB.UI.TemplateCatalog.set(v,' <a href="{reviewUrl}">{productName}</a> as a {rating}/10');BB.UI.TemplateCatalog.set(c,'is inspired by <a href="{userInspiredUrl}">{userInspiredName}</a>.');BB.UI.TemplateCatalog.set(l,'added the video <a href="{videoUrlBodySpace}">{videoTitle}</a>.');BB.UI.TemplateCatalog.set(h,'created the <a href="{groupUrl}">{groupName}</a> BodyGroup.')}(jQuery));BB.UI=BB.UI||{};BB.UI.Feed=(function(a){BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_container);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_BLOG);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_BODYFAT);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_BODYGROUP);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_BODYSTAT);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_CURRENT_SUPPLEMENT);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_FITBOARD_POST);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_FITSTATUS);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_FRIEND);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_FRIEND_SPELLOUT);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_GALLERY_PHOTO);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_GOAL_CHANGED);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_GROUP_JOIN);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_GYM_JOIN);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_INSPIREDBY);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_MEASURE_UPDATE);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_MOTIVATION_LEVEL);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_MOTIVATION_PROGRAM);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_NUTRITION_PROGRAM);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_PERSONAL_VIDEO);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_PROFILE_PHOTO);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_PROGRAM_UPDATED);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_PROGRESS_PHOTO);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_REVIEWED_SUPPLEMENT);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_SUPPLEMENT);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_SUPPLEMENTS_PROGRAM);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_SUPPLEMENT_R);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_WEIGHT_CHANGED);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_WORKOUT_PROGRAM);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.Feeds_basicFeed);return{create:function(b,c,d){b.lang=BB.Loc.keys;BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.Feeds_container,b,d)}}}(jQuery));(function(){var a="LikeButton_std",b="LikePanel_std";BB.UI.TemplateCatalog.keys.LikeButton_std=a;BB.UI.TemplateCatalog.keys.LikePanel_std=b;BB.UI.TemplateCatalog.set(a,"{?isLiked}Unlike{:else}Like{/isLiked}");BB.UI.TemplateCatalog.set(b,'<div class="multiple-like"><div class="arrow-up"></div><div class="multiple-like-container"><div class="like-icon"></div><span>{?isLiked}You{@select key="{recentsLength}"}{@eq value="1"} and {/eq}{@gt value="1"}, {/gt}{/select}{/isLiked} {#likeList}{?user}<a href="//bodyspace.bodybuilding.com/{slug}">{user}</a>{/user}{?amount}{amount} other{@gt key="{amount}" value="1"}s{/gt}{/amount}{sep}{/likeList} {verb} this.</span><div style="display:none"></div></div></div>')}());BB.UI=BB.UI||{};BB.UI.LikeButton=(function(){var f="LikeButton_",b="std",a,e,i,d={},c=function(n){var q,k,p,m,j,l,o;for(q in d){k=$("[data-id="+q+"]");m=k.data("userid");j=k.data("ownerid");l=k.data("id");o=k.data("liketype");p=d[q];delete d[q];k.data("liked",p);BB.Action.Like.call(p,m,j,l,o,{success:function(s,r,u){var t;if(s.data&&s.data.length===1){t=s.data[0];BB.UI.LikeStatusPanel.recreate(p,t.type,t.entityId,n)}else{BB.Tool.Debug.log("Stats not returned or not in expected format.",s.data)}},error:function(){BB.Tool.Debug.log("error:",arguments)}})}},h=function(k,j){BB.UI.TemplateCatalog.render(a,k,function(m,l){j.html(l)})},g=function(k,j,l){return k.find('[data-id="'+l+'"][data-liketype="'+j+'"]')};BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.LikeButton_std,true);return{callbacks:{likeChange:$.noop},create:function(m,l,o){var q,p=this,n,j,k;if(typeof o==="undefined"){o="body"}o=$(o);q=o.find("[data-type=like]");a=f+(l||b);if(typeof m==="undefined"){m=BB.UI.LikeStatusPanel.data()}if(typeof e==="undefined"){e={}}j=m.length;for(n=0;n<j;n++){k=m[n];e[k.type+"-"+k.entityId]=k}q.each(function(){var s=$(this),t,u,r,v;u=m.length;for(t=0;t<u;t++){r=m[t];v=r.entityId;if(v===s.data("id")){s.data("liked",r.isLiked);s.data("like-requested-value",r.isLiked);h(r,s);break}}s.off("click.like-button");s.on("click.like-button",function(A){var z=$(this),y=z.data("liked"),B=z.data("id"),w=z.data("liketype"),x;A.preventDefault();A.stopPropagation();x=!z.data("like-requested-value");s.data("like-requested-value",x);if(x===y){delete d[B]}else{d[B]=x}h({isLiked:x},s);BB.UI.LikeStatusPanel.recreate(x,w,B,o);p.callbacks.likeChange({isLiked:x,likeType:w,likeId:B,scope:o});clearInterval(i);i=setTimeout(c,1000,o)})})},repaint:function(n,j,o,m){var k,l;if(typeof m==="undefined"){m="body"}m=$(m);console.log("scope:",m);console.log("_likeDataById:",e);if(typeof e==="undefined"){return}k=e[j+"-"+o];l=g(m,j,o);console.log("likeData:",k);console.log("buttonElem[0]:",l[0]);if(!k){return}k.isLiked=n;h(k,l);console.log("END OF REPAINT ------------------------------------------")}}}());BB.UI=BB.UI||{};BB.UI.LikeStatusPanel=(function(){var i="LikePanel_",e="std",c,d,g,b="{type}",a="{id}",h="bblikestatus-"+b+"-"+a,f=function(k){return(k.total>1||k.isLiked)?"like":"likes"},j=function(k,l){if(k.total<1){l.html("");return}BB.UI.TemplateCatalog.render(c,k,function(n,m){if(n){BB.Tool.Debug.log("Render error:",n)}l.html(m)})};BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.LikePanel_std,true);return{data:function(){return d},getStatusId:function(l,k){return h.replace(b,l).replace(a,k)},create:function(o,u,y){var p,z,w,r,n,x,m,k,t,v=2,s,q,l=BB.Data.User.get(BB.Data.User.keys.slug);if(!y||typeof y==="undefined"){y="body"}y=$(y);c=i+(u||e);if(!$.isArray(o)){o=[o]}if(typeof d==="undefined"){d=o;g={}}else{d=d.concat(o)}z=o.length;for(p=0;p<z;p++){w=o[p];g[w.type+"-"+w.entityId]=w;t=w.recentsLength=w.total;x=w.recentLikeUsers.length;for(n=0;n<x;n++){m=w.recentLikeUsers[n];if(m.userName===l){w.isLiked=true;w.recentLikeUsers.splice(n,1);w.recentsLength-=1;break}}w.likeList=[];x=Math.min(v,t);for(n=0;n<x;n++){m=w.recentLikeUsers[n];if(typeof m!=="undefined"){k={user:m.userName,slug:m.slug,sep:", "};w.likeList.push(k)}}w.verb=f(w);if(t>v){s=t-v;if(w.isLiked){s--}if(s>0){w.likeList.push({user:"",amount:s})}}x=w.likeList.length;for(n=0;n<x;n++){k=w.likeList[n];if(n===x-2){k.sep=" and "}if(n===x-1){k.sep=""}}r=this.getStatusId(w.type,w.entityId);q=y.find("#"+r);j(w,q)}},recreate:function(p,o,l,n){var q,k,m;if(typeof n==="undefined"){n="body"}n=$(n);if(typeof g==="undefined"){return}q=this.getStatusId(o,l);k=g[o+"-"+l];m=n.find("#"+q);if(!k){k={recentLikeUsers:[],total:p?1:0,verb:"like"}}if(k.isLiked!==p){k.total+=p?1:-1}k.isLiked=p;k.verb=f(k);j(k,m)}}}());(function(b){var a="RightSidebar_LoginBottom",c="RightSidebar_LoginError";BB.UI.TemplateCatalog.keys.RightSidebar_LoginBottom=a;BB.UI.TemplateCatalog.keys.RightSidebar_LoginError=c;BB.UI.TemplateCatalog.set(c,'<div class="login-error">{err_msg}</div>');BB.UI.TemplateCatalog.set(a,'<div class="user-links"><ul><li><a href="http://my.bodybuilding.com/alerts/{slug}?tab=notifications" class="rsb-notifications"><span class="right-side-icon notifications"></span>{lang.NOTIFICATIONS}{@if cond="\'{stats.unreadAlertsCount}\'.replace(\'+\',\'\') > 0"}<span class="number-badge">{stats.unreadAlertsCount}</span> {/if}</a></li><li><a href="http://my.bodybuilding.com/alerts/{slug}?tab=actionitems" class="rsb-actionitems"><span class="right-side-icon action-items"></span>{lang.ACTION_ITEMS}{@if cond="\'{stats.actionItemCount}\'.replace(\'+\',\'\') > 0"}<span class="number-badge">{stats.actionItemCount}</span> {/if}</a></li><li><a href="http://my.bodybuilding.com/alerts/{slug}?tab=requests" class="rsb-requests"><span class="right-side-icon requests"></span>{lang.REQUESTS}{@if cond="\'{stats.requestsCount}\'.replace(\'+\',\'\') > 0"}<span class="number-badge">{stats.requestsCount}</span> {/if}</a></li><li class="last-item"><a href="http://forum.bodybuilding.com/private.php"><span class="right-side-icon messages"></span>{lang.MESSAGES}{@if cond="\'{stats.unreadMessageCount}\'.replace(\'+\',\'\') > 0"}<span class="number-badge">{stats.unreadMessageCount}</span> {/if}</a></li></ul></div>')}(jQuery));(function(f){var e="RightSidebar_LogoutTop",g="RightSidebar_LogoutMiddle",d="RightSidebar_LogoutBottom",c="RightSidebar_LoginTop",a="RightSidebar_LoginBottomLow",b="RightSidebar_LoginMiddle";BB.UI.TemplateCatalog.keys.RightSidebar_LoginMiddle=b;BB.UI.TemplateCatalog.keys.RightSidebar_LoginBottomLow=a;BB.UI.TemplateCatalog.keys.RightSidebar_LogoutTop=e;BB.UI.TemplateCatalog.keys.RightSidebar_LogoutMiddle=g;BB.UI.TemplateCatalog.keys.RightSidebar_LogoutBottom=d;BB.UI.TemplateCatalog.keys.RightSidebar_LoginTop=c;BB.UI.TemplateCatalog.set(e,'<div class="free-signup"><div class="large-text"><div class="free"><div class="text">{lang.ADV_1}</div><div class="raquo">&raquo;</div></div><div class="join">{lang.ADV_2}</div></div><ul><li><span class="icon">&raquo;</span>{lang.ADV_3}</li><li><span class="icon">&raquo;</span>{lang.ADV_4}</li><li><span class="icon">&raquo;</span>{lang.ADV_5}</li></ul><div class="button-row"><a href="http://bodyspace.bodybuilding.com/community/signup?callback={callback}" class="bb-button-v2 small button-gradient-blue"><span>{lang.SIGN_UP}</span></a></div></div>');BB.UI.TemplateCatalog.set(g,'<div class="user-login"><form action="{login_action}" method="post"><input name="callback" value="{callback}" type="hidden"><h5>{lang.MEMBER_LOGIN}</h5><div class="login-inputs">{@if cond="\'{err_msg}\'.length > 0"} {>RightSidebar_LoginError /} {/if}<span class="wmwrap" style="position:relative;display:block;"><label class="watermark">{lang.USERNAME_PLACEHOLDER}</label><input type="text" class="snifme" name="username" /></span><span class="wmwrap" style="position:relative;display:block;"><label class="watermark">{lang.PASSWORD_PLACEHOLDER}</label><input class="snifme enter-submit" type="password" name="password" /></span></div><div class="login-items"><div class="checkbox"><div class="input-checkbox-container"><input type="checkbox" name="rememberme" /></div><div class="text-item bb-gray7"><label for="rememberme" class="remember-me">{lang.REMEMBER_ME}</label></div></div><div class="right-item"><a href="#" class="bb-button-v2 small button-gradient-blue login-button"><span>{lang.LOG_IN}</span></a><div class="standard-tooltip interactive-sidebar tooltip-elements hide"><div class="text"></div><div class="standard-tooltip-button">OK</div></div><div class="standard-tooltip-arrow interactive-sidebar tooltip-elements hide"></div></div></div></form><ul class="user-tools"><li><a href="http://my.bodybuilding.com/login.php?do=lostpw">{lang.FORGOT_LOG_IN}</a></li></ul></div>');BB.UI.TemplateCatalog.set(d,'<div class="user-actions"><ul><li><a href="http://bodyspace.bodybuilding.com">{lang.VIEW_ALL}</a></li></ul></div>');BB.UI.TemplateCatalog.set(c,'{@if cond="{http}"}<div class="user-image"><a class="image" href="http://my.bodybuilding.com"><div class="image-fit"><img src="{profilePictureUrl}" alt="{userName}"></div></a><div class="edit">{lang.EDIT} &nbsp;<span></span></div><div class="menu hide">  <a href="http://my.bodybuilding.com/photos/view/type/profile" class="item">{lang.CHOOSE}</a><a href="http://my.bodybuilding.com/upload/agree/profile" class="item">{lang.UPLOAD_NEW}</a>{@if cond="{avatar_set}"}<a href="http://my.bodybuilding.com/upload/edit/details/type/profile/phid/{profilePic.photoId}" class="item">{lang.EDIT_INFO}</a><a href="http://my.bodybuilding.com/upload/edit/crop/type/profile/phid/{profilePic.photoId}" class="item">{lang.CROP_ROTATE}</a>{/if}    </div></div>{/if}');BB.UI.TemplateCatalog.set(b,'<div class="username"><a href="http://my.bodybuilding.com"><div class="text">{userName}</div></a></div><div class="stats"><div class="stat weight" data-update-key="weight"><span class="value bb-gray7 __dynamic-async-update__weight__">{stats.weight}</span> <span class="unit bb-gray6">{unitOfWeight}</span></div><div class="stat bodyfat" data-update-key="bodyfat"><span class="value bb-gray7 __dynamic-async-update__bodyfat__">{stats.bodyFatPercent}</span><span class="embed-unit bb-gray7">%</span> <span class="unit bb-gray6">{lang.BF}</span></div></div><div class="user-links"><ul><li><a href="http://my.bodybuilding.com"><span class="right-side-icon bodyspace"></span>{lang.MY_BODYSPACE}</a></li><li><a href="http://www.bodybuilding.com/store/orderstatus.htm"><span class="right-side-icon orders"></span>{lang.ORDERS}</a></li><li><a href="https://www.bodybuilding.com/store/account/wish-list.jsp"><span class="right-side-icon wish-list"></span>{lang.WISH_LIST}</a></li><li><a href="https://www.bodybuilding.com/store/commerce/cart.jsp"><span class="right-side-icon cart"></span>{lang.CART}</a></li><li class="last-item"><a href="http://bodyspace.bodybuilding.com/login/login.php?logout=true&callback={logoutcallback}"><span class="right-side-icon log-out"></span>{lang.LOG_OUT}</a></li></ul></div>');BB.UI.TemplateCatalog.set(a,'<div class="user-actions">{@if cond="{http}"}<div class="right"><a href="http://my.bodybuilding.com">{lang.VIEW_ALL}</a></div>{/if}<div class="fit-status" data-update-key="fitStatus">{lang.UPDATE_FIT_STATUS}</div></div><div class="standard-tooltip interactive-sidebar user-tooltip-banned hide"><div class="text">{lang.ACCOUNT_BANNED}</div></div><div class="standard-tooltip-arrow interactive-sidebar user-tooltip-banned hide"></div><div class="standard-tooltip interactive-sidebar user-tooltip-inactive hide"><div class="text">{lang.ACCOUNT_NOT_ACTIVE}</div></div><div class="standard-tooltip-arrow interactive-sidebar user-tooltip-inactive hide"></div>')}(jQuery));BB.UI=BB.UI||{};BB.UI.RightSidebar=(function(f){var d=0,q=new BB.Core.MessageController({name:"rsbLoaded"}),A="rightsidebar/getinfo",k,h={},t,w="#interactive-sidebar",y=false,j,n,u={},z={feedEntityList:[]},a=function(J){var F=f(".user-login form"),D=F.find("input[name=username]"),I=F.find("input[name=password]"),H=F.find("input[name=rememberme]"),B=I[0],G=F.find("input[name=password_md5]")[0],E=D.val().length,C=I.val().length,K=null;if(J!==null&&J!==undefined){J.preventDefault()}if(E===0){if(C===0){K=BB.Loc.get("FAIL_LOGIN_NAME_AND_PASSWORD")}else{K=BB.Loc.get("FAIL_LOGIN_NAME")}}else{if(C===0){K=BB.Loc.get("FAIL_LOGIN_PASSWORD")}}if(K!==null){if(BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode)){alert(K)}else{BB.UI.RightSidebar.loginError(K)}return}BB.Core.Util.md5.md5hashAuto(B,G);F.submit()},v=function(){var C=f(w+" form"),B=C.find(".snifme");C.append('<input name="do" value="login" type="hidden"><input name="password_md5" type="hidden" />');C.find("a.login-button").bind("click",a);C.find("input.enter-submit").bind("keyup",function(D){if(D.which===13){a();D.preventDefault()}});C.find("label.watermark").bind("click",function(){f(this).hide();f(this).parent().find("input").focus()});B.bind("blur",function(){if(f(this).val().length===0){f(this).parent().find("label").show()}});B.bind("focus",function(){f(this).parent().find("label").hide()})},o=function(){},r=function(B){if(BB.Data.Env.get(BB.Data.Env.keys.isHTTP)){BB.UI.Feed.create(z,undefined,B)}},m=function(){var B=function(D,C){n.append(C)};u.login_action=k;BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LogoutTop,u,B);BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LogoutMiddle,u,B);r(B);BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LogoutBottom,u,function(D,C){n.append(C);v();BB.UI.RightSidebar.wireLoggedOutPanel(w)})},g=function(){var B=function(D,C){n.append(C)};BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LoginTop,u,B);BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LoginMiddle,u,B);BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LoginBottom,u,B);r(B);BB.UI.TemplateCatalog.render(BB.UI.TemplateCatalog.keys.RightSidebar_LoginBottomLow,u,function(D,C){n.append(C);o();BB.UI.RightSidebar.wireLoggedInPanel(w)})},p=function(){j.removeClass("in-progress");if(BB.Data.User.get(BB.Data.User.keys.isLoggedIn)){g()}else{m()}},c=function(){var C,B;z={feedEntityList:[]};if(t.feed&&t.feed.feedEntityList){B=t.feed.feedEntityList.length;for(C=0;C<B;C++){if(BB.Action.Feed.prepareFeed(t.feed.feedEntityList[C])){z.feedEntityList.push(t.feed.feedEntityList[C])}}}},x=function(B){if(d<5){j.addClass("in-progress");setTimeout(b,200);d++}else{if(t!==null&&t!==undefined){t.user={};if(!(t.feed&&t.feed.feedEntityList)){t.feed={feedEntityList:[]}}}else{t={feed:{feedEntityList:[]},user:{}}}p()}},s=function(){var C,I,H,B,D,F,E,G;t=t||{};u=t.user||{};BB.Data.User.set(BB.Data.User.keys.slug,u.slug);BB.Data.User.set(BB.Data.User.keys.userName,u.userName);u.lang=BB.Loc.keys;if(BB.Data.User.get(BB.Data.User.keys.isLoggedIn)){BB.Data.User.set(BB.Data.User.keys.id,t.user.userId);BB.Data.User.set(BB.Data.User.keys.gender,t.user.gender);BB.Data.User.set(BB.Data.User.keys.notifications,t.unreadAlertsCount);C=BB.Core.Util.formatInt(t.unreadAlertsCount,99);BB.Data.User.set(BB.Data.User.keys.actionItems,t.actionItemCount);I=BB.Core.Util.formatInt(t.actionItemCount,99);BB.Data.User.set(BB.Data.User.keys.requests,t.requestsCount);H=BB.Core.Util.formatInt(t.requestsCount,99);BB.Data.User.set(BB.Data.User.keys.messages,t.unreadMessageCount);B=BB.Core.Util.formatInt(t.unreadMessageCount,99);BB.Data.User.set(BB.Data.User.keys.weight,t.weight);D=BB.Core.Util.formatFloat(t.weight,"--");BB.Data.User.set(BB.Data.User.keys.bodyfat,t.bodyFatPercent);F=BB.Core.Util.formatFloat(t.bodyFatPercent,"--");BB.Data.User.set(BB.Data.User.keys.avatarURL,t.user.profilePictureUrl);t.user.profilePictureUrl=BB.Core.Util.formatImageURLProfile(t.user.profilePictureUrl,"145x145");t.user.avatar_set=BB.Data.User.get(BB.Data.User.keys.isAvatarURLSet);BB.Data.User.set(BB.Data.User.keys.units,t.user.unitOfMeasure);t.user.unitOfWeight=BB.Data.User.get(BB.Data.User.keys.unitsOfWeight);t.user.unitOfLength=BB.Data.User.get(BB.Data.User.keys.unitsOfLength);BB.Data.User.set(BB.Data.User.keys.status,t.user.groupId);if(t.user.motivationLevel&&t.user.motivationLevel.level&&t.user.motivationLevel.level>0&&t.user.motivationLevel.timeStamp>0){BB.Data.User.set(BB.Data.User.keys.motivationLevel,{value:t.user.motivationLevel.level,timeStamp:t.user.motivationLevel.timeStamp})}else{BB.Data.User.clear(BB.Data.User.keys.motivationLevel)}if(t.user.fitStatus&&typeof(t.user.fitStatus.content)==="string"&&t.user.fitStatus.content.length>0&&t.user.fitStatus.timeStamp>0){BB.Data.User.set(BB.Data.User.keys.fitStatus,{value:t.user.fitStatus.content,timeStamp:t.user.fitStatus.timeStamp})}else{BB.Data.User.clear(BB.Data.User.keys.fitStatus)}t.user.http=BB.Data.Env.get(BB.Data.Env.keys.isHTTP);t.user.quirks_mode=BB.Data.Env.get(BB.Data.Env.keys.isQuirksMode);if(window.location.host==="www.teenbodybuilding.com"||window.location.host==="www.bodybuilders.com"){t.user.logoutcallback=BB.Core.Util.Base64.encode("http://www.bodybuilding.com")}else{t.user.logoutcallback=t.user.callback}t.user.stats={weight:D,bodyFatPercent:F,unreadAlertsCount:C,actionItemCount:I,requestsCount:H,unreadMessageCount:B}}c();E=BB.Data.Env.get(BB.Data.Env.keys.strikes);if(E>0&&(t.user===undefined||t.user===null)){u.err_msg=BB.Loc.get("FAIL_LOGIN_STRIKES",{STRIKES:(5-E).toString(10)})}G=BB.Data.Env.get(BB.Data.Env.keys.urlCallback);if(typeof(G)==="string"&&G.length>0){u.callback=G}else{u.callback=decodeURIComponent(BB.Core.Util.Base64.encode(BB.Data.Env.get(BB.Data.Env.keys.url)))}q.sendMessage("",{})},l=function(B){var C;if(typeof(B)==="string"){C=JSON.parse(B)}else{C=B}if(typeof(C)==="object"&&C!==null){t=C.data;s();if(!y){p()}}else{x()}},b=function(){BB.API.call(A,{},{error:x,success:l})},e=function(C,B){k=B||"http://bodyspace.bodybuilding.com/login/login.php";if(typeof(C)==="object"&&C!==null){l(C)}else{d=0;b()}},i=function(B){j=B;if(typeof(j)==="object"&&j!==null&&j.length>0){j.addClass("right-side-bar-global-container");j.empty();if(BB.Data.Env.get(BB.Data.Env.keys.isHTTPS)){j.addClass("right-side-bar-https")}n=f("<div/>",{id:"interactive-sidebar"});n.appendTo(j)}};BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LoginTop);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LoginMiddle);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LoginBottom);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LoginBottomLow);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LoginError);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LogoutTop);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LogoutMiddle);BB.UI.TemplateCatalog.load(BB.UI.TemplateCatalog.keys.RightSidebar_LogoutBottom);return{_protected:{registerForDrySetupCompleted:function(B){q.registerListener("",BB.Core.Util.createRandomId(),B)},setDOMContainer:i,setup:e,drySetup:function(C,B){y=true;e(C,B)},dryRender:function(B){if(y){i(B);p()}else{BB.Tool.Debug.log("expecting a dry run")}}},keys:h}}(jQuery));(function(a){a.extend(BB.UI.RightSidebar,(function(){var c,b;return{create:function(e,g,f,d){BB.UI.RightSidebar._protected.setDOMContainer((typeof(f)==="string"&&f.length>0)?a(f):a("#__interactive-sidebar"));BB.UI.RightSidebar._protected.setup(e,d)},wireLoggedInPanel:function(h){var d=a(h+" .stat.weight, "+h+" .stat.bodyfat, "+h+" .fit-status"),i=a(h+" .user-image .menu"),e=false,f=i.width(),g=i.height();d.each(function(){BB.Action.Modal.bind(a(this))});a(h+" .user-image .edit").bind("click",function(){if(i.hasClass("hide")){i.height(1);i.width(1);i.removeClass("hide");i.animate({width:f,height:g});e=true}});a("body").bind("click",function(){if(e){e=false}else{if(!i.hasClass("hide")){i.animate({width:1,height:1},function(){i.addClass("hide")});e=false}}})},wireLoggedOutPanel:function(){c=a("#interactive-sidebar .tooltip-elements");b=a("#interactive-sidebar .tooltip-elements .standard-tooltip-button");b.bind("click",function(){c.addClass("hide")})},loginError:function(f){var e=a("#interactive-sidebar .standard-tooltip"),d=a("#interactive-sidebar .tooltip-elements .text");d.html(f);c.removeClass("hide");e.css({"margin-top":-(d.height()+87)})},bindModal:function(d){BB.Action.Modal.bind(d)}}}()))}(jQuery));