(function(e){e.fn.lightbox_me=function(t){return this.each(function(){function n(){var t=u[0].style;s.destroyOnClose?u.add(a).remove():u.add(a).hide(),s.parentLightbox&&s.parentLightbox.fadeIn(200),l.remove(),u.undelegate(s.closeSelector,"click"),e(window).unbind("reposition",i),e(window).unbind("reposition",o),e(window).unbind("scroll",o),e(window).unbind("keyup.lightbox_me"),c&&t.removeExpression("top"),s.onClose()}function r(e){(27==e.keyCode||27==e.DOM_VK_ESCAPE&&0==e.which)&&s.closeEsc&&n()}function i(){e(window).height()<e(document).height()?(a.css({height:e(document).height()+"px"}),l.css({height:e(document).height()+"px"})):(a.css({height:"100%"}),c&&(e("html,body").css("height","100%"),l.css("height","100%")))}function o(){var t=u[0].style;if(u.css({left:"50%",marginLeft:-1*(u.outerWidth()/2),zIndex:s.zIndex+3}),u.height()+80>=e(window).height()&&("absolute"!=u.css("position")||c)){var n=e(document).scrollTop()+40;u.css({position:"absolute",top:n+"px",marginTop:0}),c&&t.removeExpression("top")}else if(u.height()+80<e(window).height())if(c)if(t.position="absolute",s.centered)t.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),t.marginTop=0;else{var r=s.modalCSS&&s.modalCSS.top?parseInt(s.modalCSS.top):0;t.setExpression("top","((blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+r+') + "px"')}else s.centered?u.css({position:"fixed",top:"50%",marginTop:-1*(u.outerHeight()/2)}):u.css({position:"fixed"}).css(s.modalCSS)}var s=e.extend({},e.fn.lightbox_me.defaults,t),a=e(),u=e(this),l=e('<iframe id="foo" style="z-index: '+(s.zIndex+1)+';border: none; margin: 0; padding: 0; position: absolute; width: 100%; height: 100%; top: 0; left: 0; filter: mask();"/>'),c=e.browser.msie&&7>e.browser.version;if(s.showOverlay){var d=e(".js_lb_overlay:visible");a=d.length>0?e('<div class="lb_overlay_clear js_lb_overlay"/>'):e('<div class="'+s.classPrefix+'_overlay js_lb_overlay"/>')}if(c){var f=/^https/i.test(window.location.href||"")?"javascript:false":"about:blank";l.attr("src",f),e("body").append(l)}e("body").append(u.hide()).append(a),s.showOverlay&&(i(),a.css({position:"absolute",width:"100%",top:0,left:0,right:0,bottom:0,zIndex:s.zIndex+2,display:"none"}),a.hasClass("lb_overlay_clear")||a.css(s.overlayCSS)),s.showOverlay?a.fadeIn(s.overlaySpeed,function(){o(),u[s.appearEffect](s.lightboxSpeed,function(){i(),o(),s.onLoad()})}):(o(),u[s.appearEffect](s.lightboxSpeed,function(){s.onLoad()})),s.parentLightbox&&s.parentLightbox.fadeOut(200),e(window).resize(i).resize(o).scroll(o),e(window).bind("keyup.lightbox_me",r),s.closeClick&&a.click(function(e){n(),e.preventDefault}),u.delegate(s.closeSelector,"click",function(e){n(),e.preventDefault()}),u.bind("close",n),u.bind("reposition",o)})},e.fn.lightbox_me.defaults={appearEffect:"fadeIn",appearEase:"",overlaySpeed:250,lightboxSpeed:300,closeSelector:".close",closeClick:!0,closeEsc:!0,destroyOnClose:!1,showOverlay:!0,parentLightbox:!1,onLoad:function(){},onClose:function(){},classPrefix:"lb",zIndex:999,centered:!1,modalCSS:{top:"40px"},overlayCSS:{background:"black",opacity:.3}}})(jQuery);