if(window.BrightTag==undefined){window.BrightTag={};BrightTag.module=function(a,i){for(var e=BrightTag,k=a.split("."),j=k.pop(),f=undefined,g=0,b=k.length;g<b;g++){f=k[g];e[f]||(e[f]={});e=e[f]}return e[j]||(e[j]=i)};BrightTag.each=function(a,i){if(a)if(BrightTag.Types.isArray(a)||a.length)for(var e=0,k=a.length;e<k;e++)i(a[e],e);else if(BrightTag.Types.isObject(a))for(e in a)a.hasOwnProperty(e)&&i(e,a[e])};BrightTag.pushIfDefined=function(a,i,e){if(a&&a.constructor==Array&&i!=null)a.push(e||i)};
BrightTag.extend=function(a,i){for(var e in i)if(i.hasOwnProperty(e))a[e]=i[e];return a};BrightTag.trim=function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};BrightTag.eval=function(a,i){try{return eval.call(undefined,a)}catch(e){i&&i(e)}};BrightTag.Types={isString:function(a){return Object.prototype.toString.call(a)==="[object String]"},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isNumber:function(a){return Object.prototype.toString.call(a)==="[object Number]"},
isFunction:function(a){return Object.prototype.toString.call(a)==="[object Function]"},isObject:function(a){if(a===null||a===undefined)return false;return Object.prototype.toString.call(a)==="[object Object]"}};BrightTag.Escaper={cookie:function(a){if(!BrightTag.Types.isString(a))return a;return a.replace(/%/g,"%25").replace(/#/g,"%23").replace(/&/g,"%26").replace(/'/g,"%27").replace(/;/g,"%3B").replace(/</g,"%3C").replace(/>/g,"%3E")},javascript:function(a){if(!BrightTag.Types.isString(a))return a;
return a.replace(/\\/g,"\\\\").replace(/'/g,"\\x27").replace(/"/g,"\\x22").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}};BrightTag.Random={integer:function(a){return Math.floor(Math.random()*(a||1E8))}};BrightTag.defaultConfig=function(){return{loadOnly:false,window:window,document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,data:{},errorManager:new BrightTag.ErrorManager(new BrightTag.HTTP.Cookie(document))}}}
BrightTag.module("Blab",{});
BrightTag.module("Blab.Engine",function(a){function i(){l=true;p=r.length;b("engine:off")}function e(){l=false;v=0;(r[p++]||i)()}function k(o){return function(){var q=false,u=a.createElement("script");u.onload=u.onreadystatechange=function(){var n;if(!(n=q)){a:{switch(u.readyState){case undefined:case "loaded":case "complete":n=true;break a}n=false}n=!n}if(!n){q=true;b("block:finish");e()}};u.src=o;b("block:start",o);var m=a.getElementsByTagName("script")[0];m.parentNode.insertBefore(u,m)}}function j(o){return function(){try{b("block:start",
o);if(o.constructor==String)if(a.defaultView)a.defaultView.eval.call(undefined,o);else a.parentWindow?a.parentWindow.execScript(o):b("block:error",{type:"wait",exception:"Could not evaluate wait block ["+o+"]"});else o()}catch(q){b("block:error",{type:"wait",exception:q})}finally{b("block:finish");e()}}}function f(o){r.push(o);l&&e();return d}function g(o){r.splice(p+v++,0,o);return d}function b(o){var q=Array.prototype.slice.call(arguments,1);BrightTag.each(h,function(u){var m=[d].concat(q);(u[o]||
c).apply(null,m)})}var d=this,c=function(){},h=[],l=false,s={},r=[],p=0,v=0;d.run=function(){b("engine:on");e()};d.options=function(o){BrightTag.extend(s,o);return d};d.option=function(o){return s[o]};d.script=function(o){return f(k(o))};d.wait=function(o){return f(j(o))};d.preemptScript=function(o){return g(k(o))};d.preemptWait=function(o){return g(j(o))};d.listen=function(o){h.push(o);(o["engine:listen"]||c).apply(null,[d]);return d}});
BrightTag.module("Blab.Group",function(){function a(b){j.push(b)}function i(b){b.run()}function e(){var b=j[f++];b?b.listen(g).run():k.doNotQueue()}var k=this,j=[],f=0,g={"engine:off":function(){e()}};k.doNotQueue=function(){a=i};k.push=function(b){a(b);return b};k.run=function(){e()};k.applyListener=function(b){for(var d=f,c=j.length;d<c;d++)j[d].listen(b)}});
BrightTag.module("Blab.Manager",function(a){function i(g){var b=new k.Engine(a);e.each(f,function(d){b.listen(d)});return(j[g]||(j[g]=new k.Group)).push(b)}var e=BrightTag,k=e.Blab,j={undefined:new k.Group},f=[];j[undefined].doNotQueue();this.addGlobalListener=function(g){f.push(g);e.each(j,function(b){j[b].applyListener(g)})};this.group=function(g){return i(g)};this.listen=function(){return i().listen.apply(null,arguments)};this.script=function(){return i().script.apply(null,arguments)};this.wait=
function(){return i().wait.apply(null,arguments)};this.run=function(g){(j[g]||(j[g]=new k.Group)).run()};this.setOptions=function(){return i()}});
BrightTag.module("Blab.SwapwriteListener",function(){var a,i=[],e=function(k){a.push(k)};return function(k){function j(d){d.src&&g.preemptScript(d.src);d.innerHTML&&g.preemptWait(d.innerHTML)}function f(d){try{k.body.appendChild(d.cloneNode(true))}catch(c){bt_handle_exception("BrightTag: error appending content to body: "+c)}}var g,b=k.createElement("div");this["block:start"]=function(){var d=k;i.push([a,d.write,d.writeln]);a=[];d.write=d.writeln=e};this["block:finish"]=function(){try{if(a.length!=
0){b.innerHTML="<br/>"+a.join("");for(var d=b.childNodes||[],c=1,h=d.length;c<h;c++)(d[c].tagName=="SCRIPT"?j:f)(d[c])}}finally{d=k;c=i.pop();a=c[0];d.write=c[1];d.writeln=c[2]}};this["engine:listen"]=function(d){g=d}}}());BrightTag.module("Blab.GlobalSwapwriteListener",function(a){var i=BrightTag.Blab;this["engine:listen"]=function(e){e.listen(new i.SwapwriteListener(a))}});
BrightTag.module("EventsManager",function(){function a(){}function i(b,d,c){g(b,d,function(){if(!c||c())BrightTag.EventListenerOverride(b,d)})}function e(b){b=b.documentElement.doScroll||function(){throw"No doScroll";};try{b("left")}catch(d){return false}return true}function k(b){var d=b.readyState;return d=="loading"?false:d=="complete"?true:b.addEventListener?d=="interactive":e(b)}function j(b,d,c){var h=this;setTimeout(function(){b()?d.call(h):j(b,d,c)},c)}var f=this,g=f.listen=function(b,d,c){if(b.addEventListener)b.addEventListener(d,
c,false);else b.attachEvent&&b.attachEvent("on"+d,c)};f.domReady=function(b,d){if(k(b))d.call(this);else b.addEventListener?g(b,"DOMContentLoaded",d):j(function(){return k(b)},d,1)};f.enablePageReadyOverrides=function(b,d){f.enablePageReadyOverrides=a;d.readyState=="complete"?BrightTag.EventListenerOverride(b,"load"):i(b,"load");if(d.addEventListener){var c=d.readyState;c=="complete"||c=="interactive"?BrightTag.EventListenerOverride(d,"DOMContentLoaded"):i(d,"DOMContentLoaded")}}});
BrightTag.module("EventListenerOverride",function(a,i){function e(f){var g=this;setTimeout(function(){try{f.call(g)}catch(b){bt_handle_exception("BrightTag error overriding "+i+" event: "+b)}},0)}var k=a.addEventListener?"addEventListener":"attachEvent",j=a[k];a[k]=function(f,g,b){if(typeof g=="function")if(f==i||f=="on"+i)e(g);else try{k=="addEventListener"?j.call(a,f,g,b):j(f,g)}catch(d){bt_handle_exception("BrightTag error proxying "+f+" event: "+d)}}});BrightTag.module("Events",new BrightTag.EventsManager);
BrightTag.module("EventBindingManager",function(a){var i={},e=[],k=BrightTag.jQueryLoader(a,"BrightTag.jQuery");i.Binder=function(g){var b=this,d=[];b.data=function(c,h){d.push({name:c,dbe:h});return b};b.bindData=function(c,h,l){BrightTag.each(d,function(s){try{BrightTag.instance.data(s.name,k.functionWithAccess(["eventObject","eventData"],"return "+s.dbe+";").call(c,h,l))}catch(r){bt_log("Error binding "+s+": "+r)}})};b.handler=function(c){var h=e[g];if(h){var l=Array.prototype.slice.call(arguments,
1);b.bindData(c.target,c,l);h.handler(c,l)}}};var j=function(){var g=this,b=[],d=[];g.execute=function(h){if(h.constructor==Function)b.push(h);else if(h.constructor==String)try{b.push(k.functionWithAccess(["eventObject","eventData"],h))}catch(l){bt_handle_exception("BrightTag could not execute action: "+l)}else bt_log("execute: bad action = "+h);return g};g.fire=function(h){h=new c(h);d.push(h);return h};g.handler=function(h,l){i.executeActions(b,h,l);i.fireTags(d)};var c=function(h){var l=this,s=
[];l.appendData=function(r){s.push(function(p){p.appendData(r)});return l};l.appendJs=function(r){s.push(function(p){p.appendJs(r)});return l};l.postProcess=function(r){BrightTag.each(s,function(p){p(r)})};l.tagId=h;l.execute=g.execute;l.fire=g.fire}},f=/^direct\//i;i.bind=function(g,b,d){var c=new i.Binder(g);k.ensureJQuery(function(){var h=k.getJQuery()(b);h.live&&b.constructor===String&&!f.test(d)?h.live(d,c.handler):h.bind(d.split(f).pop(),c.handler)});return c};i.when=function(g){return e[g]||
(e[g]=new j)};i.executeActions=function(g,b,d){BrightTag.each(g,function(c){try{c.call(b.target,b,d)}catch(h){bt_handle_exception(h)}})};i.fireTags=function(g){if(g.length>0){var b=BrightTag.instance.serverURL();BrightTag.each(g,function(d){b.cf(d.tagId);d.postProcess(b)});BrightTag.Blab.script(b.asString())}};return i});BrightTag.module("HTTP",{});
BrightTag.module("HTTP").Cookie=function(a){function i(j){var f,g;j=j.split(/; ?/);for(var b=0,d=j.length;b<d;b++){g=j[b];f=g.indexOf("=");var c=k,h=g.slice(0,f);f=g.slice(f+1);f=unescape(f);c[h]=f}}var e=this,k={};e.get=function(j){return k[j]};e.remove=function(j){e.set(j,"",{expires:0})};e.set=function(j,f,g){if(j){g=g||{};j=[j+"="+BrightTag.Escaper.cookie(f||"")];if((f=g.expires)||f===0){if(BrightTag.Types.isNumber(f))f=(new Date(f)).toGMTString();j.push("expires="+f)}(f=g.path)&&j.push("path="+
f);(f=g.domain)&&j.push("domain="+f);g.secure===true&&j.push("Secure");g.httponly===true&&j.push("HttpOnly");a.cookie=j.join("; ");i(a.cookie)}};e.findEach=function(j,f){for(key in k)k.hasOwnProperty(key)&&key.match(j)&&f(key,k[key])};i(a.cookie||"")};
BrightTag.module("HTTP").QueryString=function(a){function i(f){if(f&&typeof f=="string"){var g=f.split("&");f={};k.each(g,function(b){b=b.split("=");b={key:decodeURIComponent(b[0]),value:b[1]&&decodeURIComponent(b[1].replace(/\+/g," "))};f[b.key]=b.value})}return f}var e=this,k=BrightTag,j={};k.extend(j,i(a));e.param=function(f){return j[f]||""};e.params=function(){return j};e.appendParam=function(f,g){if(f&&g!=undefined&&g!=="")j[f]=g;return this};e.appendParams=function(f){k.each(f,e.appendParam);
return this};e.alwaysAppendParam=function(f,g){if(f)j[f]=g!=undefined?g:"";return this};e.alwaysAppendParams=function(f){k.each(f,e.alwaysAppendParam);return this};e.appendPartialQueryString=function(f){f&&e.alwaysAppendParams(i(f));return this};e.deleteParam=function(f){delete j[f]};e.toString=function(){var f=[];for(var g in j){var b={key:encodeURIComponent(g),value:encodeURIComponent(j[g])};f.push(b.key+"="+b.value)}return f.join("&")}};
BrightTag.module("HTTP").URL=function(a){var i=this,e,k,j,f=a.indexOf("#");if(f>-1){j=a.substring(f+1);a=a.substring(0,f)}f=a.indexOf("?");if(f>-1){k=a.substring(f+1);a=a.substring(0,f)}e=a;a=new BrightTag.HTTP.QueryString(k);BrightTag.extend(i,a);i.queryString=a.toString;i.toString=function(){var g=i.queryString();return e+(g.length>0?"?"+g:"")};i.asString=i.toString;i.fragment=function(){return j}};
BrightTag.module("ServerURL",function(a){function i(c,h){return function(l){bt_handle_exception("Invalid "+c+" expression: "+h+", exception = "+l)}}var e=this,k=a.host,j=BrightTag,f=a.window,g=a.parentReferrer,b=a.referrer,d="";if(k.length>0)d=(k.match("^[a-z0-9+.-]+://.+")?"":"//")+k+"/tag";j.HTTP.URL.call(this,d);e.appendParams({site:a.site,referrer:b,docReferrer:a.docReferrer,mode:a.mode});b!==g&&e.appendParam("parentReferrer",g);e.appendData=function(c){var h=bt_data(c),l;a:switch(Object.prototype.toString.apply(h)){case "[object Array]":case "[object Object]":l=
true;break a;default:l=false;break a}h=l?f.JSON.stringify(h):h;return e.alwaysAppendParam("_cb_"+("bt_data('"+c+"')"),h)};e.appendJs=function(c){var h=i("inline JavaScript",c);return e.alwaysAppendParam("_cb_"+c,j.eval(c,h))};e.cf=function(c){if(c.constructor!=Array)c=[c];var h=e.param("cf");if(h)c=Array(h).concat(c);e.appendParam("cf",c.join());return e};e.addCf=function(c,h){if(!j.eval(h,i("conditional fire",h)))return false;var l=e.param("cf");e.appendParam("cf",l?l+","+c:c);return true}});
BrightTag.module("Page",function(a,i){function e(m){h.each(h.Types.isArray(m)?m:[m],function(n){h.Types.isFunction(n)?n():p.write('<script type="text/javascript" src="'+n+'"><\/script>')})}function k(m){var n=o.group();h.each(h.Types.isArray(m)?m:[m],function(t){(h.Types.isFunction(t)?n.wait:n.script)(t)})}function j(m){p.write(m)}function f(m,n){var t={};if(n&&n.tagId)t.tagId=n.tagId;o.group(!u?"domready":undefined).options(t).wait(function(){p.write(m)})}function g(m){c.writeScript=m?e:k;c.appendContent=
m?j:f}function b(m){var n={site:a.site,referrer:a.referrer||p.location.href};if(q.hasErrors()){m.appendParam("errors",q.toJSON());if(m.toString().length>2083){m.deleteParam("errors");q.reset(n);q.push({type:"runtime",message:"Too many errors"});m.appendParam("errors",q.toJSON())}}q.reset(n)}function d(m){(new h.HTTP.Cookie(p)).findEach(/^btps\..+/,function(n,t){m.appendParam(n,t)})}var c=this,h=BrightTag,l=undefined,s=a.data||{},r=undefined,p=a.document||{},v=a.window||{},o=a.blab||h.Blab,q=a.errorManager,
u=false;c.referrer=a.referrer;c.parentReferrer=a.parentReferrer;c.docReferrer=a.docReferrer;q&&o.addGlobalListener(q);g(a.mode==="sync");c.domReady=function(){u=true;o.addGlobalListener(new o.GlobalSwapwriteListener(p));a.mode==="sync"&&g(false);o.run("domready")};c.parameter=function(m){if(l==undefined)l=new h.HTTP.URL(p.location.href);return l.param(m)};c.meta=function(m){if(!r){r={};h.each(p.getElementsByTagName("meta"),function(n){r[n.getAttribute("name")]=n.getAttribute("content")})}return r[m]||
""};c.data=function(m,n){if(n!==undefined)return s[m]=n;n=s[m];return n==undefined?"":n};c.dbe=function(m,n,t){c.data(m,h.eval(n,function(w){if(q){var x=t||{};q.push({type:"dbe",message:w.toString(),"dbe.name":m,pageId:x.pageId||-1})}}))};c.errors=function(m){q.configure(m)};c.serverURL=function(){return new h.ServerURL(a)};c.defaultBaseUri=function(){return(p.location.protocol=="https:"?"https:":"http:")+"//s.btstatic.com/"};c.baseUri=function(){var m=/\btag(\.[^.]+|-n)?\.js(#.*)?$/;return i&&i.src&&
i.src.replace(m,"")||c.defaultBaseUri()};c.primary=function(){function m(){var n=c.serverURL();d(n);if(q){q.processStoredErrors();b(n)}c.writeScript(n.toString())}v.JSON?m():c.writeScript([c.baseUri()+"json2.js",m])};c.secondary=function(m){var n=c.serverURL(),t=n.toString();m(n);if(n.toString()!=t){d(n);q&&b(n);c.writeScript(n.toString())}}});
BrightTag.module("ErrorManager",function(a){function i(h){var l=g.isObject(h)?f.extend({},h):{};l.type=l.type||"unknown";l.message=l.message||h.toString();l.timestamp=c;return l}if(!a)throw"ErrorManager requires a store";var e=this,k,j,f=BrightTag,g=f.Types,b=true,d=[],c=+new Date;e.configure=function(h){if(h.hasOwnProperty("enabled"))b=h.enabled;if(h.hasOwnProperty("timestamp"))c=h.timestamp};e.hasErrors=function(){return d.length>0};e.toArray=function(){return d};e.toJSON=function(){try{return JSON.stringify({site:k,
referrer:j,errors:d})}catch(h){bt_log("BrightTag: problem serializing errors: "+h.message)}};e.reset=function(h){k=h.site;j=h.referrer;d=[];a.remove("__bterr")};e.push=function(h){bt_log("BrightTag: error: "+JSON.stringify(h));if(b&&h){d.push(i(h));a.set("__bterr",e.toJSON())}};e["block:error"]=function(h,l){if(l){var s=l.type,r=l.exception||l,p=h.option("tagId")||-1;e.push({type:s,message:r.toString(),tagId:p})}};e.processStoredErrors=function(){var h=a.get("__bterr");if(h)try{var l=JSON.parse(h);
k=l.site;j=l.referrer;if(g.isArray(l.errors))d=d.concat(l.errors)}catch(s){bt_log("BrightTag: problem reading stored errors: "+s.message)}}});
BrightTag.module("CookieSyncEngine",function(a){var i={fn:function(b){b()},next:null},e=i,k=a.document,j=function(b){if(typeof b!="function")return false;b={fn:b,next:null};e=e.next=b;return true},f=function(){if(i){var b=i.fn;i=i.next;b(f)}},g=f;BrightTag.Events.listen(a,"load",g);return{sync:g,push:function(b){return j(b)},pushImage:function(b){return j(function(d){var c=new a.Image;c.onerror=c.onload=d;c.src=b})},pushIframe:function(b){return j(function(d){var c=k.createElement("iframe");c.onerror=
c.onload=d;c.width=0;c.height=0;c.style.border=0;c.src=b;k.body.appendChild(c)})}}});function bt_parameter(a){return BrightTag.instance.parameter(a)}function bt_meta(a){return BrightTag.instance.meta(a)}function bt_data(a,i){return BrightTag.instance.data(a,i)}function bt_data_escaped(a,i){return bt_data(a,i)}function bt_log(a){window.console&&console.log&&console.log(a)}var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;
function btServe(a){if(BrightTag.instance==undefined){var i=BrightTag,e=i.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},i.defaultConfig());if(_bt_url_prefix!=undefined)e.host=_bt_url_prefix;i.instance=i.Main(i.extend(e,a||{}))}}
BrightTag.module("jQueryLoader",function(a,i){return new (function(e,k){function j(h){c.wait(h)}function f(h){function l(){b=BrightTag.jQuery;j(h)}d="var $ = BrightTag.$; ";BrightTag.jQuery?l():c.script(BrightTag.instance.baseUri()+"BrightTag.jquery-1.5.1.js").wait(l)}var g={},b=e.jQuery,d="",c=BrightTag.Blab.group(k);g.getJQuery=function(){return b};g.functionWithAccess=function(h,l){return new Function(h,d+l)};g.ensureJQuery=function(h){g.ensureJQuery=j;(b?j:f)(h);BrightTag.Blab.run(k)};return g})(a,
i)});
BrightTag.module("Main",function(a){function i(b){(b=(new k.HTTP.URL(b.src)).fragment())&&k.extend(a,(new k.HTTP.QueryString(b)).params())}function e(b){b=k.trim(b.innerHTML);b.length!=0&&k.extend(a,k.eval("(\n"+b+"\n)",function(d){bt_handle_exception("BrightTag configuration error: "+d)}))}var k=BrightTag,j=function(){for(var b=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/,d=a.document.getElementsByTagName("script"),c=d.length-1;c>-1;c--){var h=d[c];if(b.test(h.src))return h}}();if(j){i(j);e(j)}if(a.site!=undefined){k.Events.enablePageReadyOverrides(a.window,
a.document);try{var f=new k.Page(a,j);k.Events.domReady(a.document,function(){f.domReady()});a.loadOnly||f.primary();return f}catch(g){bt_handle_exception("BrightTag execution error: "+g)}}});(function(a){if(a.instance==undefined){a.extend(a.Blab,new a.Blab.Manager(document));a.$LAB=a.Blab;a.EventBinding=a.EventBindingManager(window);a.CookieSync=a.CookieSyncEngine(window);a.instance=a.Main(a.defaultConfig())}else bt_log("Tried to load tag.js again")})(window.BrightTag);
